/*! Fiera.js Copyright 2016, www.homeTLT.ru (Denis Ponomarev <ponomarevtlt@gmail.com>) */
var fiera =
/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, {
/******/ 				configurable: false,
/******/ 				enumerable: true,
/******/ 				get: getter
/******/ 			});
/******/ 		}
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = 14);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ (function(module, exports) {

module.exports = fabric;

/***/ }),
/* 1 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

var utils = __webpack_require__(3);
utils.object = __webpack_require__(2);
utils.compile = __webpack_require__(5);

function capitalize(string, firstLetterOnly) {
  return string.charAt(0).toUpperCase() + (firstLetterOnly ? string.slice(1) : string.slice(1).toLowerCase());
}

function toDashed(str) {
  return str.replace(/([a-z])([A-Z])/g, '$1-$2').toLowerCase();
}

var Toolbar = function Toolbar(PARENT, el, options, menu) {
  this.initialize(PARENT, el, options, menu);
};

Toolbar._getKeyString = function (config) {
  var string = "";

  if (config.ctrlKey) string += "Ctrl + ";
  if (config.altKey) string += "Alt + ";
  if (config.shiftKey) string += "Shift + ";

  var _code = config.key;
  if (_code) {
    string += config.key;
  }
  return string;
};

Toolbar.makeActions = function (actions, PARENT) {
  var result = {};
  for (var i in actions) {
    actions[i].id = i;
    var _action = this.makeAction(actions[i], PARENT);
    if (_action) {
      result[i] = _action;
    }
  }
  return result;
};

Toolbar.makeAction = function (_ORIGINAL, parent) {

  if (_ORIGINAL.constructor === Function) {
    _ORIGINAL = _ORIGINAL.call(parent);
  }

  var target;

  if (_ORIGINAL.target && _ORIGINAL.target.constructor === Function) {
    target = _ORIGINAL.target.call(parent);
  } else {
    target = _ORIGINAL.target || parent;
  }

  var ___target = _ORIGINAL.target;
  var ___parent = _ORIGINAL.parent;
  delete _ORIGINAL.parent;
  delete _ORIGINAL.target;
  var RES = utils.object.cloneDeep(_ORIGINAL);
  _ORIGINAL.parent = ___parent;
  _ORIGINAL.target = ___target;

  RES.parent = ___parent;
  RES.target = target;
  RES.id = toDashed(_ORIGINAL.id);

  function createGetter(property, useParent) {
    if (property.constructor === Function) {
      return property;
    }
    if (property.constructor === String) {
      var negative = false;
      if (property[0] === "!") {
        property = property.substr(1);
        negative = true;
      }
      if (useParent) {
        return function () {
          return this && !!this[property] ^ negative;
        };
      } else {
        return function () {
          return this && !!this[property] ^ negative;
        };
      }
    }
    return null;
  }

  /*var _insert = _ORIGINAL.insert;
  if (!_insert || _insert.constructor == String) {
     if(_ORIGINAL.parent){
      var insertproperty = fabric.util.string.capitalize(fabric.util.string.camelize(_ORIGINAL.parent.id))
    }else{
      var insertproperty = _insert || "insert" + fabric.util.string.capitalize(id,true);
    }
     if(target[insertproperty] !== undefined){
      _insert = target[insertproperty]// createGetter(insertproperty,true)()
    }else{
      _insert = true;
    }
  }
   if(!_insert)return;*/

  if (!RES.type) {
    if (RES.menu) {
      RES.type = "menu";
    } else {
      RES.type = "button";
    }
  }
  if (!RES.action) {
    if (RES.type === "button") {
      RES.action = _ORIGINAL.id;
    }
  }

  if (RES.action) {
    if (RES.action.constructor === String) {
      RES.action = target[RES.action];
    }
    //RES = RES.action.bind(target);
    //RES.action = RES.action.bind(target);
    //_.extend(RES, _act);
    //arguments for action function
    if (_ORIGINAL.args) {
      RES._action = RES.action.bind(target, _ORIGINAL.args);
    } else {
      RES._action = RES.action.bind(target);
    }
    RES.action = function () {
      if (RES.disabled) return;
      RES._action.apply(this, arguments);
    };
  }

  if (_ORIGINAL.menu && _ORIGINAL.menu.constructor === Function) {
    RES.menu = _ORIGINAL.menu.bind(target);
  }
  if (_ORIGINAL.active) {
    RES.active = createGetter(_ORIGINAL.active).bind(target);
  }
  if (_ORIGINAL.visible) {
    RES.visible = createGetter(_ORIGINAL.visible).bind(target);
  }
  if (_ORIGINAL.enabled) {
    RES.enabled = createGetter(_ORIGINAL.enabled).bind(target);
  }
  if (!_ORIGINAL.value) {
    switch (_ORIGINAL.type) {
      case "color":
      case "text":
      case "number":
      case "range":
      case "label":
      case "select":
      case "checkbox":
        _ORIGINAL.value = _ORIGINAL.id;
      // console.log(id, _ORIGINAL);
    }
  }
  if (_ORIGINAL.value) {
    var _set, _get, _options;
    if (_ORIGINAL.value.constructor === String) {

      var setFunctionName = "set" + capitalize(_ORIGINAL.value, true),
          getFunctionName = "get" + capitalize(_ORIGINAL.value, true),
          minName = "min" + capitalize(_ORIGINAL.value, true),
          maxName = "max" + capitalize(_ORIGINAL.value, true),
          setFoo = function setFoo(val) {
        target[setFunctionName](val);
        // todo self.setFunctionCallback(target);
      },
          getFoo = target[getFunctionName],
          minFoo = target[minName],
          maxFoo = target[maxName];

      _set = setFoo || (_ORIGINAL.args ? function (val, args) {
        this[_ORIGINAL.value][args] = val;
      } : function (val) {
        this[_ORIGINAL.value] = val;
      });

      _get = getFoo || (_ORIGINAL.args ? function (args) {
        return this[_ORIGINAL.value][args];
      } : function () {
        return this[_ORIGINAL.value];
      });

      RES.value = {
        min: minFoo,
        max: maxFoo
      };
    } else {
      _set = _ORIGINAL.value.set;
      _get = _ORIGINAL.value.get;
      _options = _ORIGINAL.value.options;
    }

    if (RES.value.min !== undefined && RES.value.min.constructor === String) {
      RES.value.min = target[RES.value.min];
    }
    if (RES.value.max !== undefined && RES.value.max.constructor === String) {
      RES.value.max = target[RES.value.max];
    }
    if (RES.value.step !== undefined && RES.value.step.constructor === String) {
      RES.value.step = target[RES.value.step];
    }
    var _min = RES.value.min,
        _max = RES.value.max,
        _step = RES.value.step;

    if (_set) {
      RES.value.set = _ORIGINAL.args ? _set.bind(target, _ORIGINAL.args) : _set.bind(target);
    }
    if (_get) {
      RES.value.get = _ORIGINAL.args ? _get.bind(target, _ORIGINAL.args) : _get.bind(target);
    }
    if (_min && _min.constructor === Function) {
      RES.value.min = _ORIGINAL.args ? _min.bind(target, _ORIGINAL.args) : _min.bind(target);
    }
    if (_max && _max.constructor === Function) {
      RES.value.max = _ORIGINAL.args ? _max.bind(target, _ORIGINAL.args) : _max.bind(target);
    }
    if (_step && _step.constructor === Function) {
      RES.value.step = _ORIGINAL.args ? _step.bind(target, _ORIGINAL.args) : _step.bind(target);
    }
    if (_options) {
      RES.value.options = _ORIGINAL.args ? _options.bind(target, _ORIGINAL.args) : _options.bind(target);
    }
  }

  if (_ORIGINAL.data) {
    RES.data = _ORIGINAL.data.call(target);
  }
  if (RES.menu) {
    if (_ORIGINAL.menu.constructor === Function) {
      RES.menu = _ORIGINAL.menu.call(target);
    }
    if (RES.type === "options") {
      for (var i in RES.menu) {
        RES.menu[i].parent = RES;
        RES.menu[i].type = "option";
        if (!RES.menu[i].title) {
          RES.menu[i].title = i;
        }
        if (!RES.menu[i].option) {
          RES.menu[i].option = i;
        }
      }
    }
    for (var i in RES.menu) {
      if (RES.menu[i].constructor === String) {
        RES.menu[i] = fabric.util.object.clone(RES.target.actions[RES.menu[i]]);
        RES.menu[i].parent = RES;
      }
      if (!RES.menu[i].id) {
        RES.menu[i].id = i;
      }
      RES.menu[i] = Toolbar.makeAction(RES.menu[i], target);
      if (!RES.menu[i]) {
        delete RES.menu[i];
      }
    }
  }

  if (_ORIGINAL.keyboard !== false && (_ORIGINAL.key || _ORIGINAL.shiftKey || _ORIGINAL.altKey || _ORIGINAL.ctrlKey || _ORIGINAL.metaKey)) {
    if (_ORIGINAL.keyCode && _ORIGINAL.keyCode.constructor === String) {
      RES.keyCode = _ORIGINAL.keyCode.toUpperCase().charCodeAt(0);
      RES.key = String.fromCharCode(RES.keyCode);
    }
    RES.keyboard = true;
  };

  return RES;
};

Toolbar.getButtons = function (actions) {
  var _buttons = [];
  for (var i in actions) {
    var action = actions[i];
    if (action.keyboard) {
      action.title += " (" + Toolbar._getKeyString(action) + ")";
      _buttons.push(action);
    }
    if (actions.menu) {
      _buttons = _buttons.concat(Toolbar.getButtons(actions.menu));
    }
  };

  return _buttons;
};
Toolbar.initKeys = function (actions) {

  var buttons = Toolbar.getButtons(actions);

  var self = this;
  $("body").on("keydown", function (e) {
    for (var i in buttons) {
      var _config = buttons[i];

      if (_config.enabled && !_config.enabled()) {
        continue;
      }
      if (_config.disabled || _config.disabled) {
        continue;
      }
      if (!_config.disabled && !_config.hidden && (_config.keyCode == e.keyCode || _config.key == e.key) && (_config.ctrlKey === undefined || _config.ctrlKey == e.ctrlKey) && (_config.altKey === undefined || _config.altKey == e.altKey) && (_config.shiftKey === undefined || _config.shiftKey == e.shiftKey) && (_config.metaKey === undefined || _config.metaKey == e.metaKey)) {

        e.preventDefault();
        e.stopPropagation();
        if (_config.option !== undefined) {
          _config.action.call(_config.target, _config.option, e);
        } else {
          _config.action.call(_config.target, e);
        }
      }
    }
  });

  //$(window).on("mousewheel", function (event) {
  //  for (var i in self.buttons) {
  //    var data = self.buttons[i];
  //    if (!data.mousewheel)continue;
  //    if (!data.ctrlKey || data.ctrlKey && event.ctrlKey) {
  //      if (event.deltaY > 0 && data.mousewheel == ">") {
  //        data.action.call(target, data.option || event, event)
  //      }
  //      if (event.deltaY < 0 && data.mousewheel == "<") {
  //        data.action.call(target, data.option || event, event)
  //      }
  //      event.preventDefault();
  //      event.stopPropagation();
  //      return false;
  //    }
  //  }
  //});
};

Toolbar.prototype = {

  // setFunctionCallback: function(){},
  tools: {

    "label": {
      scope: function scope(data, options) {
        return {
          getValue: data.value.get,
          valueCurrent: data.value.get()
        };
      },
      template: '<div class="object-menu-item object-menu-label" title="{title}">',
      render: function render($item, data, options, tool, val) {
        var scope = fabric.util.object.defaults(tool.scope.call(this, data, options), data);
        $item.html(data.template.format(data.value.get()));
        utils.compile.compileElement($item, scope);
      }
    },
    "number": {
      scope: function scope(data, options) {
        return {
          getInputValue: function getInputValue() {
            return parseFloat(data.$item.find("input").val());
          },
          getValue: data.value.get,
          setValue: data.value.set,
          minValue: data.value.min && data.value.min(),
          maxValue: data.value.max && data.value.max(),
          valueCurrent: data.value.get(),
          onchange: function onchange(e) {
            data.value.set(parseFloat($(e.target).val()));
          }
        };
      },
      template: '<div class="object-menu-item object-menu-number" title="{title}">' + '<input type="number" min="{minValue}" max="{maxValue}" value="{valueCurrent}" onchange="onchange(event)">',
      render: function render($item, data, options, tool, val) {
        $item.find("input").val(data.value.get());
      }
    },
    "range": {
      scope: function scope(data, options) {
        return {
          minValue: data.value.min ? typeof data.value.min == "function" ? data.value.min() : data.value.min : 0,
          maxValue: data.value.max ? typeof data.value.max == "function" ? data.value.max() : data.value.max : 1,
          valueStep: data.value.step ? typeof data.value.step == "function" ? data.value.step() : data.value.step : 0.1,
          valueCurrent: data.value.get(),
          onchange: function onchange(e) {
            data.value.set(parseFloat($(e.target).val()));
          }
        };
      },
      template: '<div class="object-menu-item object-menu-range" title="{title}">' + '<input type="range" step="{valueStep}" min="{minValue}" max="{maxValue}" value="{valueCurrent}" onchange="onchange(event)">',
      render: function render($item, data, options, tool, val) {
        $item.find("input").val(data.value.get());
      }
    },
    "checkbox": {
      scope: function scope(data, options) {
        return {
          onchange: function onchange(e) {
            data.value.set(e.target.checked);
          },
          valueCurrent: data.value.get()
        };
      },
      template: '<div class="object-menu-item object-menu-checkbox" title="{title}">' + '<input type="checkbox" onchange="onchange(event)" dp-checked="{valueCurrent}" id="checkbox-{id}">' + '<label for="checkbox-{id}"  class="btn button-{id} {className}">',
      render: function render($item, data, options, tool, val) {
        $item.find("input").val(val);
      }
    },
    "menu": {
      template: '<div class="object-menu-item object-menu-menu" title="{title}">' + '<label dp-if="title" for="button-{id}">{title}</label>' + '<button class="btn button-menu-trigger button-{id} {className}" id="button-{id}"/>' + '<div class="object-menu submenu" transclude/>',
      post: function post($item, data, options, transclude) {
        //$item.find(".button-menu-trigger").click(function () {
        //  $item.find(".object-menu").toggle();
        //})
        if (data.hovered) {
          $item.addClass("hovered");
          this.toggleByHover($item, transclude, null, data);
        }
        if (data.toggled) {
          $item.addClass("toggled");
          this.toggleByButton($item, transclude);
        };
        this.generateMenu(data.target, transclude, options, data.menu);
      }
    },
    "button": {
      scope: function scope(data, options) {
        return {
          buttonsTitle: options.buttons && options.buttons.title || false,
          buttonscClassName: options.buttons && options.buttons.className || ''
        };
      },
      template: '<div class="object-menu-item" title="{title}">' + '<button class="btn button-{id} {className} {buttonscClassName}"  onclick="!disabled && option ? action(option) : action()">' + '<img dp-if="icon" dp-src="icon">' + '<span dp-include="svg" dp-if="svg"></span>' + '<span dp-if="buttonsTitle" class="button-title">{title}</span>'
    }
  },
  initialize: function initialize(PARENT, el, options, menu) {
    this.buttons = [];
    //todo это не совсем хорошо. нельзя создать улбраы с разными конфигами кнопок
    // this.tools = utils.object.cloneDeep(this.tools);


    this.options = options;
    // if (options) {
    //   if (options.button) {
    //     utils.object.extend(this.tools.button, options.button);
    //   }
    // }
    // if (!PARENT.generatedActions) {
    //   PARENT.makeActions( menu);
    // }

    if (el.constructor === String) {
      el = $(document.getElementById(el));
    }
    if (el.length) {
      this.generateMenu(PARENT, el, options, menu);
      this.onCreate();
      el.show();
    }
    Toolbar.initKeys(PARENT.generatedActions);
  },
  onCreate: function onCreate() {},
  destroy: function destroy(target) {
    for (var i = this.buttons.length; i--;) {
      var _config = this.buttons[i];
      if (target && _config.target != target) {
        continue;
      }
      this.buttons.splice(i, 1);
    }
    this.fire("destroy");
  },
  createInput: function createInput($item, data, type) {

    var target = data.target;
    var $input = $("<input>").attr("type", type).attr("min", data.value.min()).attr("max", data.value.max());

    $input.val(data.value.get());
    if (data.value.observe) {
      target.on(data.value.observe, function (val) {
        $input.val(data.value.get());
      });
    }
    $input.change(function (e) {
      data.value.set(parseFloat($input.val()));
    });
    $item.append($input);
  },
  initItem: function initItem($item, data) {

    if (data.active) {
      if (data.active.call(data.target, data.option)) {
        $item.addClass("active");
      }
    }

    if (data.visible !== undefined) {
      if (data.visible.constructor == Function) {
        if (!data.visible.call(data.target)) {
          $item.hide();
        }
      } else if (!data.visible) {
        $item.hide();
      }
    }

    data.disabled = false;
    if (data.enabled !== undefined) {
      if (data.enabled.constructor == Function) {
        if (!data.enabled.call(data.target)) {
          $item.attr("disabled", true);
          data.disabled = true;
        }
      }
    }

    if (data.observe) {
      //todo
      if (data.visible && data.visible.constructor == Function) {
        data.target && data.target.on(data.observe, function () {
          if (!data.visible.call(data.target)) {
            $item.hide();
            data.hidden = true;
          } else {
            $item.show();
            data.hidden = false;
          }
        });
      }

      if (data.type == "options") {
        data.target && data.target.on(data.observe, function () {
          var _val = data.value.get();
          $("[name=" + data.id + "]").prop("checked", false);
          $("[name=" + data.id + "][value=" + _val + "]").prop("checked", true);
        });
      }

      if (data.enabled && data.enabled.constructor == Function) {
        data.target && data.target.on(data.observe, function () {
          if (!data.enabled.call(data.target)) {
            $item.attr("disabled", true);
            data.disabled = true;
          } else {
            $item.removeAttr("disabled");
            data.disabled = false;
          }
        });
      }
    }
  },
  toggleByHover: function toggleByHover($item, $toggleElement, foo, data) {

    var onClose;

    $toggleElement.hide();
    $item.mouseout(function () {
      $toggleElement.hide();
      onClose && onClose();
    });
    $item.mouseover(function () {
      $toggleElement.show();
      onClose = foo && foo();
    });

    $item.click(function () {
      if (data && data.immediately) {
        data.action();
      }
    });
  },
  toggleByButton: function toggleByButton($item, $toggleElement, foo, data) {

    var onClose;
    var _try_hide = function _try_hide(e) {
      var _parents = $(e.target).parents();
      for (var i in _parents) {
        if (_parents[i] === $item[0]) {
          return false;
        }
      }
      if ($toggleElement.css("display") !== "none") {
        $toggleElement.hide();
        onClose && onClose();
      }
    };

    $toggleElement.click(function (e) {
      e.stopPropagation();
    });
    $toggleElement.hide();
    $item.click(function () {

      if ($toggleElement.css("display") !== "none") {
        $toggleElement.hide();
        onClose && onClose();
        $(window).off("click", _try_hide);
      } else {
        $toggleElement.show();
        $(window).on("click", _try_hide);

        onClose = foo && foo();

        if (data && data.immediately) {
          data.action();
        }
      }
    });
  },
  generateMenu: function generateMenu(target, $el, options, menu) {

    options = options || {
      title: false
    };
    options.buttons = options.buttons || {
      className: "",
      title: false
    };

    $el.empty();

    var _this = this;
    for (var i in menu) {
      var data = menu[i];
      if (!data || data.insert !== undefined && !data.insert) {
        continue;
      }
      data.type = data.type || "button";

      //todo непонятно зачем аргумент target в начале
      var target = data.target;

      var tool = this.tools[data.type];

      if (!tool) {
        console.warn("tool '" + data.type + "' undefined");
        continue;
      }
      var scope = data;
      if (tool.scope) {
        scope = fabric.util.object.defaults(tool.scope.call(this, data, options), data);
      }

      var $item = $(tool.template.format(scope));
      var transclude = $item.find("[transclude]");
      scope.$item = data.$item = $item;
      if (data.template) {
        $item.html(data.template.format(data.value.get()));
      }

      utils.compile.compileElement($item, scope);

      if (data.value && data.value.observe) {

        target.on(data.value.observe, function (val) {

          if (tool.post) {
            tool.post.call(_this, $item, scope, options, transclude.length ? transclude : null);
          }
          if (tool.render) {
            tool.render.call(_this, $item, data, options, tool, val);
          }
          //this.fire(data.type + ":render",{item: $item, data: data, options: options, tool: tool, val: val})
        });
      }

      this.initItem($item, data);

      if (tool.post) {
        tool.post.call(this, $item, scope, options, transclude.length ? transclude : null);
      }

      this.fire(data.type + ":created", { item: $item, data: data, options: options, tool: tool });

      $el.append($item);
    }
  }
};
utils.observable(Toolbar.prototype);

Toolbar.single = function (data, element) {
  data.$item = element;
  data.type = data.type || "button";

  var tool = Toolbar.prototype.tools[data.type];

  Toolbar.prototype.initItem(element, data);

  if (data.value && data.value.observe) {
    data.target.on(data.value.observe, function (val) {
      tool.render(element, data, {}, tool, val);
    });
  }

  if (tool.post) {
    var transclude = element.find("[transclude]");

    tool.post.call(Toolbar.prototype, element, data, {}, transclude.length ? transclude : null);
  }

  var scope = data;
  if (tool.scope) {
    scope = _.defaults(data, tool.scope.call(Toolbar.prototype, data, {}));
  }

  element.eachSelf("*", function () {
    var nodes = [],
        values = [];
    for (var att, i = 0, atts = this.attributes, n = atts.length; i < n; i++) {
      att = atts[i];
      nodes.push(att.nodeName);
      values.push(att.nodeValue);
      this.setAttribute(att.nodeName, att.nodeValue.format(scope));
    }
  });
  utils.compile.compileElement(element, scope);
};

module.exports = Toolbar;
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 2 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

var utils = {
  /**
   *
   * @param arr
   * @param arr2
   * @returns {{}}
   * @example
   *    x = {a: 1 ,b: 1, c: [1,2]}
   *    y = {a: 2 ,  c : 3 , d : 1}
   *
   *    extendArraysObject(x,y) = {a: [1,2] b : [1] c : [1,2,3], d [1] }
   */
  extendArraysObject: function extendArraysObject(arr, arr2) {
    var newArray = {};

    for (var i in arr) {
      if (arr[i].constructor == Array) {
        newArray[i] = [].concat(arr[i]);
      } else {
        newArray[i] = [arr[i]];
      }
    }

    for (var i in arr2) {
      if (newArray[i]) {
        newArray[i].push(arr2[i]);
      } else {
        newArray[i] = [arr2[i]];
      }
    }
    return newArray;
  },
  filterValues: function filterValues(array, values) {
    var new_array = [];
    for (var i in array) {
      var _new_object = {};
      for (var j in values) {
        _new_object[values[j]] = array[i][values[j]];
      }
      new_array.push(_new_object);
    }
    return new_array;
  },

  /**
   *  Тасование Фишера–Йетса,случайное тасование множества
   * @param object
   * @returns {*}
   */
  shuffle: function shuffle(object) {
    if (!object.length) return;
    var i = object.length;
    while (--i) {
      var j = Math.floor(Math.random() * (i + 1));
      var temp = object[i];
      object[i] = object[j];
      object[j] = temp;
    }

    return object; // for convenience, in case we want a reference to the array
  },
  /**
   * Dependency: underscore.js ( http://documentcloud.github.com/underscore/ )
   *
   * Mix it in with underscore.js:
   * _.mixin({deepExtend: deepExtend});
   *
   * Call it like this:
   * var myObj = utils.deepExtend(grandparent, child, grandchild, greatgrandchild)
   *
   * Notes:
   * Keep it DRY.
   * This function is especially useful if you're working with JSON config documents. It allows you to create a default
   * config document with the most common settings, then override those settings for specific cases. It accepts any
   * number of objects as arguments, giving you fine-grained control over your config document hierarchy.
   *
   * Special Features and Considerations:
   * - parentRE allows you to concatenate strings. example:
   *   var obj = utils.deepExtend({url: "www.example.com"}, {url: "http://#{_}/path/to/file.html"});
   *   console.log(obj.url);
   *   output: "http://www.example.com/path/to/file.html"
   *
   * - parentRE also acts as a placeholder, which can be useful when you need to change one value in an array, while
   *   leaving the others untouched. example:
   *   var arr = utils.deepExtend([100,    {id: 1234}, true,  "foo",  [250, 500]],
   *                          ["#{_}", "#{_}",     false, "#{_}", "#{_}"]);
   *   console.log(arr);
   *   output: [100, {id: 1234}, false, "foo", [250, 500]]
   *
   * - The previous example can also be written like this:
   *   var arr = utils.deepExtend([100,    {id:1234},   true,  "foo",  [250, 500]],
   *                          ["#{_}", {},          false, "#{_}", []]);
   *   console.log(arr);
   *   output: [100, {id: 1234}, false, "foo", [250, 500]]
   *
   * - And also like this:
   *   var arr = utils.deepExtend([100,    {id:1234},   true,  "foo",  [250, 500]],
   *                          ["#{_}", {},          false]);
   *   console.log(arr);
   *   output: [100, {id: 1234}, false, "foo", [250, 500]]
   *
   * - Array order is important. example:
   *   var arr = utils.deepExtend([1, 2, 3, 4], [1, 4, 3, 2]);
   *   console.log(arr);
   *   output: [1, 4, 3, 2]
   *
   * - You can remove an array element set in a parent object by setting the same index value to null in a child object.
   *   example:
   *   var obj = utils.deepExtend({arr: [1, 2, 3, 4]}, {arr: ["#{_}", null]});
   *   console.log(obj.arr);
   *   output: [1, 3, 4]
   *
   **/
  deepExtend: function deepExtend() /*obj_1, [obj_2], [obj_N]*/{
    if (arguments.length < 1 || _typeof(arguments[0]) !== 'object') {
      return false;
    }

    if (arguments.length < 2) return arguments[0];

    var target = arguments[0];

    // convert arguments to array and cut off target object
    var args = Array.prototype.slice.call(arguments, 1);

    var key, val, src, clone, tmpBuf;

    args.forEach(function (obj) {
      if ((typeof obj === 'undefined' ? 'undefined' : _typeof(obj)) !== 'object') return;

      for (key in obj) {
        if (!(key in obj)) continue;

        src = target[key];
        val = utils.cloneDeep(obj[key]);

        if ((typeof src === 'undefined' ? 'undefined' : _typeof(src)) !== 'object' || src === null) {
          target[key] = val;
        } else if (Array.isArray(val)) {
          clone = Array.isArray(src) ? src : [];

          val.forEach(function (item) {
            clone.push(utils.cloneDeep(item));
          });

          target[key] = clone;
          //todo  если заимствуем массив , то ссохраняем значения из обоих массивов
          //target[key] = utils.deepExtend(clone, val);
        } else {
          clone = !Array.isArray(src) ? src : {};
          target[key] = utils.deepExtend(clone, val);
        }
      }
    });

    return target;
  },
  cloneDeep: function cloneDeep(val) {

    if (typeof val === 'undefined') {
      return undefined;
    }

    if (val === null) {
      return null;
    } else if (val instanceof Date) {
      return new Date(val.getTime());
    } else if (val instanceof RegExp) {
      return new RegExp(val);
    }

    if (val.cloneSync) {
      return val.cloneSync();
    } else if (val.constructor == Object) {
      return utils.deepExtend({}, val);
    } else if (val.constructor == Array) {
      var clone = [];
      for (var i = 0; i < val.length; i++) {
        clone.push(utils.cloneDeep(val[i]));
      }
      return clone;
    } else {
      return val;
    }
  },
  rearrange: function rearrange(object, keys) {
    var _newOrder = {};
    for (var i in keys) {
      if (object[keys[i]] !== undefined) {
        _newOrder[keys[i]] = object[keys[i]];
      }
    }
    // for (i in object) {
    //   delete object[i];
    // }
    // for (i in _newOrder) {
    //   object[i] = _newOrder[i];
    // }
    return _newOrder;
  },
  map: _.map,
  sortBy: _.sortBy,
  defaults: _.defaults,
  where: _.where,
  findWhere: _.findWhere,
  filter: _.filter,
  pick: _.pick,
  pluck: _.pluck,
  extend: function extend(destination) {
    // JScript DontEnum bug is not taken care of
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];
      for (var property in source) {
        destination[property] = source[property];
      }
    }
    return destination;
  }
};
module.exports = utils;

/***/ }),
/* 3 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

var objectUtils = __webpack_require__(2);

var utils = {
  /**
   * will divide total width for every object in columnts array
   *
   *
   * @example
   *     var _flexArray = fabric.util.flex(200 , [{flex: 0},{value: 100, flex: 1},{flex: 0}] );
   * @param total
   * @param columns
   * @returns {Array}
   * @example [50,100,50]
   */
  flex: function flex(total, columns) {
    var _return = [];
    var split = 0;
    columns.forEach(function (column, index) {
      if (column.value === undefined) {
        split++;
      } else {
        total -= column.value;
      }
    });
    var _w = total / split;
    columns.forEach(function (column) {
      _return.push(column.value === undefined ? _w : column.value);
    });
    return _return;
  },
  worker: function worker(foo) {
    if (window.Worker) {
      var str = foo.toString();
      var eventArg = str.substring(str.indexOf("(") + 1, str.indexOf(","));
      var postMessageArg = str.substring(str.indexOf(",") + 1, str.indexOf(")"));
      var _functionBody = str.substring(str.indexOf("{") + 1);
      str = "onmessage=function(" + eventArg + "){" + postMessageArg + "= postMessage;" + _functionBody;
      var blob = new Blob([str]);
      //"onmessage = function(e) { postMessage('msg from worker'); }"]);
      var blobURL = window.URL.createObjectURL(blob);
      return new Worker(blobURL);
    } else {
      var worker = {
        terminate: function terminate() {},
        postMessage: function postMessage(data) {
          setTimeout(function () {
            foo({ data: data }, function (responseData) {
              worker.onmessage && worker.onmessage({ data: responseData });
            });
          });
        }
      };
      return worker;
    }
  },
  observable: function observable(obj) {
    _.extend(obj, {

      fire: function fire(eventName, options) {
        if (!this.__eventListeners) {
          return;
        }
        var listenersForEvent = this.__eventListeners[eventName];
        if (!listenersForEvent) {
          return;
        }
        for (var i = 0, len = listenersForEvent.length; i < len; i++) {
          listenersForEvent[i].call(this, options || {});
        }
        return this;
      },
      on: function on(eventName, handler) {
        if (eventName.constructor == Object) {
          for (var i in eventName) {
            this.on(i, eventName[i]);
          }
          return this;
        }
        var events = eventName.split(" ");
        for (var i in events) {
          this.observe(events[i], handler);
        }
        return this;
      },
      observe: function observe(eventName, handler) {
        if (!this.__eventListeners) {
          this.__eventListeners = {};
        }
        if (arguments.length === 1) {
          for (var prop in eventName) {
            this.on(prop, eventName[prop]);
          }
        } else {
          if (!this.__eventListeners[eventName]) {
            this.__eventListeners[eventName] = [];
          }
          this.__eventListeners[eventName].push(handler);
        }
        return this;
      },
      off: function stopObserving(eventName, handler) {
        function _removeEventListener(eventName, handler) {
          if (!this.__eventListeners[eventName]) {
            return;
          }

          if (handler) {
            var idx = this.__eventListeners[eventName].indexOf(handler);
            if (idx !== -1) {
              this.__eventListeners[eventName].splice(idx, 1);
            }
          } else {
            this.__eventListeners[eventName].length = 0;
          }
        }

        if (!this.__eventListeners) {
          return;
        }
        if (arguments.length === 0) {
          this.__eventListeners = {};
        } else if (arguments.length === 1 && _typeof(arguments[0]) === 'object') {
          for (var prop in eventName) {
            _removeEventListener.call(this, prop, eventName[prop]);
          }
        } else {
          _removeEventListener.call(this, eventName, handler);
        }
        return this;
      }
    });
  },
  inOrder: function inOrder(array, foo, callback) {
    var _index = 0;
    function _inOrderIndex() {
      if (++_index < array.length) {
        foo(array[_index], _index, _inOrderIndex);
      } else {
        callback && callback();
      }
    }
    foo(array[_index], _index, _inOrderIndex);
  },
  /**
   * возвращает объект с ключами строки url
   * @returns {{}}
   */
  queryString: function queryString(query) {
    if (query) {
      query = query.substr(query.indexOf("?") + 1);
    } else {
      query = window.location.search.substring(1);
    }
    var obj = {};
    var _length = 0;
    if (!query) return obj;
    var vars = query.split("&");
    for (var i = 0; i < vars.length; i++) {
      var pair = vars[i].split("=");
      var _vname = pair[0],
          val = pair[1];
      if (typeof obj[_vname] === "undefined") {
        obj[_vname] = val || "";
        Object.defineProperty(obj, _length, { value: _vname, enumerable: false });
        _length++;
        // If second entry with this name
      } else if (typeof obj[_vname] === "string") {
        var arr = [obj[_vname], val];
        obj[_vname] = arr;
        Object.defineProperty(obj, _length, { value: _vname, enumerable: false });
        _length++;
        // If third or later entry with this name
      } else {
        obj[_vname].push(val);
        Object.defineProperty(obj, _length, { value: _vname, enumerable: false });
        _length++;
      }
    }
    Object.defineProperty(obj, "length", { value: _length, enumerable: false });
    return obj;
  },
  copyValue: function copyValue(value) {
    if (value == null) {
      return null;
    }
    if (value == undefined) {
      return undefined;
    }
    switch (value.constructor) {
      case Object:
        return objectUtils.deepExtend({}, value);
      case Array:
        return objectUtils.deepExtend([], value);
      case String:
      case Number:
      case Boolean:
        return value;
      default:
        //console.log(value.constructor);
        return objectUtils.deepExtend({}, value);
    }
  },
  clearValue: function clearValue(value) {
    switch (value.constructor) {
      case Object:
        for (var member in value) {
          delete value[member];
        }break;
      case Array:
        value.length = 0;
        break;
      default:
      //delete value;
    }
  },
  objectsDifference: function objectsDifference(prev, now) {
    var changes = {};
    for (var prop in now) {
      if (!prev || prev[prop] !== now[prop]) {
        if (_typeof(now[prop]) == "object") {
          var c = utils.objectsDifference(prev[prop], now[prop]);
          if (!_.isEmpty(c)) // underscore
            changes[prop] = c;
        } else {
          changes[prop] = now[prop];
        }
      }
    }
    return changes;
  },
  splitBy: function splitBy(query, delimiter) {
    var traceQueries = [];
    var r = 0,
        f = 0,
        _p_start = 0;
    if (query == "") return [];
    for (var i = 0; i < query.length; i++) {
      var c = query[i];
      if (c == "(") {
        r++;
        f = 1;
      } else if (c == ")") {
        r--;
      }
      if (r == 0 && f == 1) f = 0;
      if (delimiter.indexOf(c) != -1 && r == 0 && f == 0) {
        traceQueries.push(query.substring(_p_start, i));
        _p_start = i + 1;
      }
    }
    traceQueries.push(query.substring(_p_start));
    return traceQueries;
  },
  queueLoad: function queueLoad(total, completeCB, progressCB) {
    var loader = function loader(el) {
      loader.loaded.push(el);
      loader.progressCB && loader.progressCB(loader.loaded.length, loader.total, el, loader.loaded);

      if (loader.loaded.length == loader.total) {
        loader.completeCB && loader.completeCB(loader.loaded);
        loader.fire("loaded");
      }
    };
    loader.completeCB = completeCB;
    loader.progressCB = progressCB;
    loader.total = total;
    loader.loaded = [];
    utils.observable(loader);

    return loader;
  }
};
module.exports = utils;

/***/ }),
/* 4 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


module.exports = {
  resolve: function resolve(path) {
    var chunks = path.split("/");
    var prev = 0;
    for (var i = chunks.length; i-- > 0;) {
      if (chunks[i] == "..") {
        prev++;
      } else {
        while (prev > 0) {
          chunks.splice(i, 1);
          chunks.splice(i--, 1);
          prev--;
        }
      }
    }
    return chunks.join("/");
  },
  getParentDirectoryUrl: function getParentDirectoryUrl(url) {
    return url.substr(0, url.lastIndexOf("/") + 1);
  }
};

/***/ }),
/* 5 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

String.prototype.format = function () {
  var str = this.toString();
  if (arguments.length) {
    var type = _typeof(arguments[0]),
        args = type == 'string' || type == 'number' ? Array.prototype.slice.call(arguments) : arguments[0];
    //
    // for (var arg in args) str = str.replace(new RegExp('\\{' + arg + '\\}', 'gi'), args[arg])

    str = str.replace(/\{([^}]*)\}/g, function (a, b) {
      return utils.evalInContext(b, args);
    });
  }

  return str;
};

var utils = {
  extractVariables: function extractVariables(str) {
    return str.match(/(?!(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$)[$A-Z\_a-z\xaa\xb5\xba\xc0-\xd6\xd8-\xf6\xf8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u08a0\u08a2-\u08ac\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097f\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58\u0c59\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d60\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f0\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191c\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19c1-\u19c7\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua697\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa80-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uabc0-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc][$A-Z\_a-z\xaa\xb5\xba\xc0-\xd6\xd8-\xf6\xf8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u08a0\u08a2-\u08ac\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097f\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58\u0c59\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d60\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f0\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191c\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19c1-\u19c7\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua697\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa80-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uabc0-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc0-9\u0300-\u036f\u0483-\u0487\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u0669\u0670\u06d6-\u06dc\u06df-\u06e4\u06e7\u06e8\u06ea-\u06ed\u06f0-\u06f9\u0711\u0730-\u074a\u07a6-\u07b0\u07c0-\u07c9\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0859-\u085b\u08e4-\u08fe\u0900-\u0903\u093a-\u093c\u093e-\u094f\u0951-\u0957\u0962\u0963\u0966-\u096f\u0981-\u0983\u09bc\u09be-\u09c4\u09c7\u09c8\u09cb-\u09cd\u09d7\u09e2\u09e3\u09e6-\u09ef\u0a01-\u0a03\u0a3c\u0a3e-\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a66-\u0a71\u0a75\u0a81-\u0a83\u0abc\u0abe-\u0ac5\u0ac7-\u0ac9\u0acb-\u0acd\u0ae2\u0ae3\u0ae6-\u0aef\u0b01-\u0b03\u0b3c\u0b3e-\u0b44\u0b47\u0b48\u0b4b-\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b66-\u0b6f\u0b82\u0bbe-\u0bc2\u0bc6-\u0bc8\u0bca-\u0bcd\u0bd7\u0be6-\u0bef\u0c01-\u0c03\u0c3e-\u0c44\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0c66-\u0c6f\u0c82\u0c83\u0cbc\u0cbe-\u0cc4\u0cc6-\u0cc8\u0cca-\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0ce6-\u0cef\u0d02\u0d03\u0d3e-\u0d44\u0d46-\u0d48\u0d4a-\u0d4d\u0d57\u0d62\u0d63\u0d66-\u0d6f\u0d82\u0d83\u0dca\u0dcf-\u0dd4\u0dd6\u0dd8-\u0ddf\u0df2\u0df3\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0e50-\u0e59\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0ed0-\u0ed9\u0f18\u0f19\u0f20-\u0f29\u0f35\u0f37\u0f39\u0f3e\u0f3f\u0f71-\u0f84\u0f86\u0f87\u0f8d-\u0f97\u0f99-\u0fbc\u0fc6\u102b-\u103e\u1040-\u1049\u1056-\u1059\u105e-\u1060\u1062-\u1064\u1067-\u106d\u1071-\u1074\u1082-\u108d\u108f-\u109d\u135d-\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b4-\u17d3\u17dd\u17e0-\u17e9\u180b-\u180d\u1810-\u1819\u18a9\u1920-\u192b\u1930-\u193b\u1946-\u194f\u19b0-\u19c0\u19c8\u19c9\u19d0-\u19d9\u1a17-\u1a1b\u1a55-\u1a5e\u1a60-\u1a7c\u1a7f-\u1a89\u1a90-\u1a99\u1b00-\u1b04\u1b34-\u1b44\u1b50-\u1b59\u1b6b-\u1b73\u1b80-\u1b82\u1ba1-\u1bad\u1bb0-\u1bb9\u1be6-\u1bf3\u1c24-\u1c37\u1c40-\u1c49\u1c50-\u1c59\u1cd0-\u1cd2\u1cd4-\u1ce8\u1ced\u1cf2-\u1cf4\u1dc0-\u1de6\u1dfc-\u1dff\u200c\u200d\u203f\u2040\u2054\u20d0-\u20dc\u20e1\u20e5-\u20f0\u2cef-\u2cf1\u2d7f\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua620-\ua629\ua66f\ua674-\ua67d\ua69f\ua6f0\ua6f1\ua802\ua806\ua80b\ua823-\ua827\ua880\ua881\ua8b4-\ua8c4\ua8d0-\ua8d9\ua8e0-\ua8f1\ua900-\ua909\ua926-\ua92d\ua947-\ua953\ua980-\ua983\ua9b3-\ua9c0\ua9d0-\ua9d9\uaa29-\uaa36\uaa43\uaa4c\uaa4d\uaa50-\uaa59\uaa7b\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uaaeb-\uaaef\uaaf5\uaaf6\uabe3-\uabea\uabec\uabed\uabf0-\uabf9\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\ufe33\ufe34\ufe4d-\ufe4f\uff10-\uff19\uff3f]*/gi);
  },
  evalInContext: function evalInContext(js) {
    js = js.replace(/\s+/g, '');

    var keys = [],
        values = [];

    for (var i = 1; i < arguments.length; i++) {
      keys = keys.concat(Object.keys(arguments[i]));
      for (var j in arguments[i]) {
        values.push(arguments[i][j]);
      }
    }

    //
    //if(_.isCorrectVariableName(js) && keys.indexOf(js) === -1){
    //  keys.push(js);
    //  values.push(undefined);
    //}

    var arr = utils.extractVariables(js);
    //console.log(arr);
    for (var i in arr) {
      if (keys.indexOf(arr[i]) === -1) {
        keys.push(arr[i]);
        values.push(undefined);
      }
    }
    js = "var foo = function(" + keys.join(",") + "){ var __return__value = " + js + " ;return __return__value;}; foo;";
    try {
      var foo = eval(js);
      return foo.apply(this, values);
    } catch (e) {
      return undefined;
    }
  },
  compileElement: function compileElement($item, scope) {

    function _eachSelf(el, selector, foo) {
      el.find(selector).each(foo);
      if (el.is(selector)) {
        foo.call(el[0]);
      }
    }

    //.addBack('selector')
    _eachSelf($item, "[onclick]", function () {
      var onClick = $(this).attr("onclick");
      $(this).removeAttr("onclick");
      $(this).click(function (event) {
        utils.evalInContext(onClick, scope, { event: event });
      });
    });

    _eachSelf($item, "[onchange]", function () {
      var onChange = $(this).attr("onchange");
      $(this).removeAttr("onchange");
      $(this).change(function (event) {
        utils.evalInContext(onChange, scope, { event: event });
      });
    });

    _eachSelf($item, "[dp-checked]", function () {
      var _val = $(this).attr("dp-checked");
      var val = utils.evalInContext(_val, scope);
      if (val) {
        $(this).attr("checked", "checked");
      } else {
        $(this).removeAttr("checked");
      }
    });
    _eachSelf($item, "[dp-src]", function () {
      var _val = $(this).attr("dp-src");
      var val = utils.evalInContext(_val, scope);
      if (val) {
        $(this).attr("src", val);
      }
    });
    _eachSelf($item, "[dp-if]", function () {
      var _val = $(this).attr("dp-if");
      if (_val === "false") {
        $(this).remove();
      }
      if (_val === "true") {} else {
        var val = utils.evalInContext(_val, scope);
        if (!val) {
          $(this).remove();
        }
      }
    });
    _eachSelf($item, "[dp-include]", function () {
      var _el = $(this);
      var _val = _el.attr("dp-include");
      var val = utils.evalInContext(_val, scope);
      _el.load(val);
    });
  },
  parseTemplate: function parseTemplate(tpl, scope) {
    var $item = $(tpl.format(scope));
    _.compileElement($item, scope);
    return $item;
  }
};
if (true) {
  module.exports = utils;
}

/***/ }),
/* 6 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

var ExtCanvasMixin = {
  defaultOptions: {},
  animated: false,
  fitIndex: 0.8,
  /**
   * required to show video
   */
  setAnimated: function setAnimated(val) {
    if (!val) {
      return;
    }

    fabric.util.requestAnimFrame(function render() {
      this.renderAll();
      fabric.util.requestAnimFrame(render);
    }.bind(this));
  },
  find: function find(options) {
    if (typeof options === "string") {
      options = {
        type: options
      };
    }
    return fabric.util.object.where(this._objects, options);
  },
  _update_background_image: function _update_background_image() {
    var photo = this.backgroundImage;
    if (!photo || photo.constructor == Object || photo.constructor == String) return;

    if (this.backgroundPosition === 'resize') {
      this.originalWidth = photo.width;
      this.originalHeight = photo.height;
    } else if (this.backgroundPosition !== 'manual') {

      var _w = this.originalWidth || this.width,
          _h = this.originalHeight || this.height;

      if (photo._originalElement) {
        var size = fabric.util.getProportions(photo._originalElement, {
          width: _w,
          height: _h
        }, this.backgroundPosition);
      } else {
        size = {
          width: _w,
          height: _h
        };
      }

      var _l;
      if (this.backgroundImage.originX == 'center') {
        _l = _w / 2;
      } else {
        _l = (_w - size.width) / 2;
      }
      var _t;
      if (this.backgroundImage.originY == 'center') {
        _t = _h / 2;
      } else {
        _t = (_h - size.height) / 2;
      }

      this.backgroundImage.set({
        left: _l + this.viewportTransform[4],
        top: _t + this.viewportTransform[5],
        width: size.width,
        height: size.height
      });
    } else {
      // var _orig = this.backgroundImage.getOriginalSize();
      // this.backgroundImage.set({
      //   originX: 'left',
      //   originY: 'top',
      //   left: 0, //this.viewportTransform[4],
      //   top: 0, //this.viewportTransform[5],
      //   width: _orig.width,
      //   height: _orig.height
      // });
    }
  },
  setBackgroundImage: function setBackgroundImage(bg, callback) {
    var _bgimageLoaded = function _bgimageLoaded(el) {

      if (this.loaded) {
        var originalState = { backgroundImage: this.backgroundImage };
      }

      this.backgroundImage = el;
      this.backgroundImage.canvas = this;
      this._update_background_image();
      if (this.backgroundPosition === "resize") {
        this.originalWidth = el.width;
        this.originalHeight = el.height;
      }

      if (this.loaded) {
        this.fire('modified', { states: {
            original: originalState,
            modified: { backgroundImage: this.backgroundImage }
          } });
      }

      this.fire("background-image:loaded", { target: el });
      callback && callback();
    };

    if (!bg) {
      this.backgroundImage = null;
      return callback();
    }
    if (bg instanceof HTMLImageElement || bg instanceof Image) {

      var el = new fabric.Image(bg, {
        width: bg.naturalWidth,
        height: bg.naturalHeight
      });

      _bgimageLoaded.call(this, el);
    }
    if (bg.constructor == String) {
      bg = {
        src: bg
      };
    }

    var _proto = this.application.prototypes;
    if (_proto && _proto.BackgroundImage) {
      fabric.util.object.extend(bg, _proto.BackgroundImage);
    }
    bg.application = this.application;
    bg.disableDefaultProperties = true;
    bg.type = bg.type || "image";
    // bg.width = bg.naturalWidth;
    // bg.height = bg.naturalHeight;
    //
    fabric.util.createObject(bg, _bgimageLoaded.bind(this));
  },
  createObjects: function createObjects(objects, callback) {

    if (this.application) {
      for (var i in objects) {
        if (objects[i].constructor == String) {
          objects[i] = this.application.objects[objects[i]];
        }
      }
    }

    var _canvas = this;

    function success(_objects) {
      _canvas.fire("progress:complete", { objects: objects });
      for (var i in _objects) {
        _canvas.add(_objects[i]);
      }
      _canvas.renderAll();
      callback && callback.call(_canvas);
    }

    function progress(l, t) {
      _canvas.fire("progress", { loaded: l, total: t });
      if (fabric.util.loaderDebug) {
        console.log("loaded " + l + " / " + t);
      }
    }

    var _objects = [];
    if (!objects || !objects.length) {
      success(_objects);
      return;
    }

    if (objects[0].constructor.name === "klass") {
      success(objects);
      return;
    }

    var queueLoadCallback = fabric.util.queueLoad(objects.length, function () {
      success(fabric.util.object.pluck(_objects, "object"));
    }, progress);

    queueLoadCallback.data = (this.title || "") + "objects";

    for (var i in objects) {
      (function (options) {
        var _object_slot = { object: null, options: options };
        _objects.push(_object_slot);

        options.application = _canvas.application;
        fabric.util.createObject(options, function (el) {
          _object_slot.object = el;
          queueLoadCallback();
        });
      }).call(this, objects[i]);
    }
  },
  /**
   * apply options for group of filtered objects
   * @param filter
   * @param options
   */
  applyOptions: function applyOptions(filter, options) {
    this._objects.forEach(function (_obj) {
      for (var prop in filter) {
        if (_obj[prop] !== filter[prop]) return;
      }
      _obj.setOptions(options);
    });
  },
  /**
   * Create Object by type and options
   * @param type
   * @param options
   * @param callback
   */
  createObject: function createObject(type, options, callback) {
    if (typeof type !== "string") {
      callback = options;
      options = fabric.util.object.clone(type);
      type = null;
    } else {
      options = fabric.util.object.clone(options);
      options.type = type;
    }

    var _self = this;
    options.application = this.application;
    // var _active = options.active;
    // var _position = options.position;
    //    delete options.active;
    //  delete options.position;


    function _add(el) {
      if (el.canvas) return;
      _self.add(el);
      /*
            if(_active){
            if(_active){
              _self.setActiveObject(el);
            }*/
      callback && callback(el);
    }

    var el = fabric.util.createObject(options, _add);
    el && _add(el);
    return el;
  },
  onLoad: function onLoad(callback) {
    this.processing = false;
    this.loaded = true;
    this.fire("loading:end", { type: "slide", target: this });
    this.renderAll();
    callback && callback.call(this);
  },
  load: function load(options, callback) {
    this.originalWidth = 0;
    this.originalHeight = 0;

    if (this.application.prototypes.Slide) {
      fabric.util.object.defaults(options, this.application.prototypes.Slide);
    }

    if (!options) return;

    if (!this.virtual) {
      this.clear();
    }

    if (options.width) {
      options.originalWidth = options.width;
      options.originalHeight = options.height;
    }

    this.processing = true;
    this.fire("loading:begin", { type: "slide", options: options });

    this.set(options, this.onLoad.bind(this, callback));

    //todo
    if (this.plugins) {
      this.plugins.preloaders.forEach(function (preloader) {
        preloader.call(this, options);
        this.onResize();
      }.bind(this));
    }
  },
  setObjects: function setObjects(objects, callback) {

    this.clear();
    this.createObjects(objects, function () {
      for (var i in this._objects) {
        this._objects[i].setCoords();
      }
      callback();
    });
  },
  onResize: function onResize() {
    var _scale = Math.min(1, 800 / this.width);
    // this.setZoom(_scale);
    this.setDimensions({ width: this.width, height: this.height });
  },
  getCenter: function getCenter(el) {
    return {
      top: (this.originalHeight || this.getHeight()) / 2,
      left: (this.originalWidth || this.getWidth()) / 2
    };
  },
  setOriginalSize: function setOriginalSize(w, h) {
    this.originalWidth = h ? w : w.naturalWidth || w.width;
    this.originalHeight = h ? h : w.naturalHeight || w.height;
    return this;
  }
};

fabric.util.object.extend(fabric.StaticCanvas.prototype, ExtCanvasMixin, {
  type: "slide",
  optionsOrder: function () {
    var oo = fabric.StaticCanvas.prototype.optionsOrder;
    oo.unshift("originalWidth", "originalHeight", "width", "height", "*");
    return oo;
  }(),
  _initEntity: function _initEntity(options) {
    options.application && options.application.fire("entity:created", { target: this, options: options });
  },
  _layers: ["_objects", "_areasObjects"],
  /**
   * Renders background, objects, overlay and controls.
   * @param {CanvasRenderingContext2D} ctx
   * @param {Array} objects to render
   * @return {fabric.Canvas} instance
   * @chainable
   */
  renderCanvas: function renderCanvas(ctx, objects) {
    this.clearContext(ctx);
    this.fire('before:render');
    if (this.clipTo) {
      fabric.util.clipContext(this, ctx);
    }
    this._renderBackground(ctx);

    ctx.save();
    //apply viewport transform once for all rendering process
    ctx.transform.apply(ctx, this.viewportTransform);
    this._renderBackgroundObjects(ctx);
    this._renderObjects(ctx, objects);
    this._renderOverlayObjects(ctx);
    ctx.restore();
    if (!this.controlsAboveOverlay && this.interactive) {
      this.drawControls(ctx);
    }
    if (this.clipTo) {
      ctx.restore();
    }
    this._renderOverlay(ctx);
    if (this.controlsAboveOverlay && this.interactive) {
      this.drawControls(ctx);
    }
    this.fire('after:render');
  },
  _renderOverlayObjects: function _renderOverlayObjects() {},
  _renderBackgroundObjects: function _renderBackgroundObjects() {},
  /**
   * @private
   * @param {HTMLElement | String} el &lt;canvas> element to initialize instance on
   * @param {Object} [options] Options object
   */
  _initStatic: function _initStatic(el, options) {
    this._objects = [];
    this._createLowerCanvas(el);
    this._initSize(options);
    this.set(options);
    this._setImageSmoothing();

    // only initialize retina scaling once
    if (!this.interactive) {
      this._initRetinaScaling();
    }
    this.calcOffset();
  },
  _initSize: function _initSize() {
    this.width = this.width || parseInt(this.lowerCanvasEl.width, 10) || 0;
    this.height = this.height || parseInt(this.lowerCanvasEl.height, 10) || 0;

    if (!this.lowerCanvasEl.style) {
      return;
    }

    this.lowerCanvasEl.width = this.width;
    this.lowerCanvasEl.height = this.height;

    this.lowerCanvasEl.style.width = this.width + 'px';
    this.lowerCanvasEl.style.height = this.height + 'px';

    this.viewportTransform = this.viewportTransform.slice();
  },
  initialize: function initialize(el, options) {
    options = fabric.util.object.defaults(fabric.util.object.deepExtend(options || {}), this.defaultOptions);
    this._initEntity(options);
    this._initStatic(el, options);
  },
  setData: function setData(data) {

    if (data.category == "background") {
      this.setBackgroundImage(data.src, this.renderAll.bind(this));
    } else {
      var id = this.activeArea && this.activeArea.id ? "#" + this.activeArea.id : "canvas";
      this.createObject(fabric.util.object.deepExtend({
        movementLimits: id,
        clipTo: id,
        position: data.left === undefined && data.top === undefined ? "center" : "manual",
        active: true
      }, fabric.util.object.clone(data)));
    }
  },
  setWidth: function setWidth(value) {
    return this.setDimensions({ width: value }, {});
  },
  setHeight: function setHeight(value) {
    return this.setDimensions({ height: value }, {});
  },
  /**
   * @private
   */

  getObjectByID: function getObjectByID(_id) {
    var _iteratorNormalCompletion = true;
    var _didIteratorError = false;
    var _iteratorError = undefined;

    try {
      for (var _iterator = this._layers[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
        var layerName = _step.value;
        var _iteratorNormalCompletion2 = true;
        var _didIteratorError2 = false;
        var _iteratorError2 = undefined;

        try {
          for (var _iterator2 = this[layerName][Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
            var o = _step2.value;

            if (o.id === _id) {
              return o;
            }
          }
        } catch (err) {
          _didIteratorError2 = true;
          _iteratorError2 = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion2 && _iterator2.return) {
              _iterator2.return();
            }
          } finally {
            if (_didIteratorError2) {
              throw _iteratorError2;
            }
          }
        }
      }
    } catch (err) {
      _didIteratorError = true;
      _iteratorError = err;
    } finally {
      try {
        if (!_iteratorNormalCompletion && _iterator.return) {
          _iterator.return();
        }
      } finally {
        if (_didIteratorError) {
          throw _iteratorError;
        }
      }
    }

    return null;
  },
  /*
   Add Custom Object Tranformations
   */
  getPointer: function getPointer(e, ignoreZoom, upperCanvasEl) {
    var pointer = _get_pointer_overwritten.call(this, e, ignoreZoom, upperCanvasEl);
    if (e._group) {
      return this._normalizePointer(e._group, pointer);
    }
    return pointer;
  },

  hasStateChanged: fabric.Object.prototype.hasStateChanged,
  /** Creates a bottom canvas
   * @private
   * @param {HTMLElement} [canvasEl]
   */
  _createLowerCanvas: function _createLowerCanvas(canvasEl) {
    if (typeof canvasEl == "string") {
      this.lowerCanvasEl = fabric.util.getById(canvasEl) || this._createCanvasElement();
    } else if (canvasEl) {
      this.lowerCanvasEl = canvasEl;
    } else {
      this.virtual = true;
      this.lowerCanvasEl = fabric.util.createCanvasElement();
    }

    this._initCanvasElement(this.lowerCanvasEl);

    fabric.util.addClass(this.lowerCanvasEl, 'lower-canvas');

    if (this.interactive) {
      this._applyCanvasStyle(this.lowerCanvasEl);
    }

    this.contextContainer = this.lowerCanvasEl.getContext('2d');
  },
  findTarget: function findTarget(e, skipGroup) {
    if (this.skipTargetFind) {
      return;
    }

    var ignoreZoom = true,
        pointer = this.getPointer(e, ignoreZoom),
        activeGroup = this.getActiveGroup(),
        activeObject = this.getActiveObject();
    if (activeGroup && !skipGroup && this._checkTarget(pointer, activeGroup)) {
      return activeGroup;
    }

    if (activeObject && this._checkTarget(pointer, activeObject)) {
      //added visceroid
      this._fireOverOutEvents(activeObject, e);
      return activeObject;
    }

    this.targets = [];

    var target = this._searchPossibleTargets(this._objects, pointer);
    this._fireOverOutEvents(target, e);
    return target;
  }
});
fabric.util.object.extend(fabric.Canvas.prototype, ExtCanvasMixin);
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 7 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.ImageMixin = {
  setElementFromMenu: function setElementFromMenu(data) {
    this.setElement(data.image);
  },
  initProportinalSize: true,
  /**
   * @private
   * @param {Object} [options] Object with width/height properties
   */
  _setWidthHeight: function _setWidthHeight(options) {
    if (this.element) {
      var _size = this.getOriginalSize();
    } else {
      _size = {};
    }
    if ('width' in options) {
      this.width = options.width;
    } else {
      if (!_size.width) {
        this.width = 100;
      } else {
        if (this.initProportinalSize && 'height' in options) {
          this.width = options.height / _size.height * _size.width;
        } else {
          this.width = _size.width;
        }
      }
    }

    if ('height' in options) {
      this.height = options.height;
    } else {
      if (!_size.height) {
        this.height = 100;
      } else {
        if (this.initProportinalSize && 'width' in options) {
          this.height = options.width / _size.width * _size.height;
        } else {
          this.height = _size.height;
        }
      }
    }
  }
};

fabric.Application.prototype.getLibraryElements = function (options) {
  return [];
};
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 8 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.util.object.extend(fabric.StaticCanvas.prototype, {

  optionsOrder: function () {
    var oo = fabric.StaticCanvas.prototype.optionsOrder;
    oo.splice(oo.indexOf("*"), 0, "areas", "offsets", "helpers");
    return oo;
  }(),
  _helpersObjects: null,
  _areasObjects: null,
  //offsets: {left: 0, top: 0, right: 0, bottom: 0},
  _update_clip_rect: function _update_clip_rect() {
    //todo
    return;
    if (this.areas || !this._areasObjects[0]) return;
    var geometry = this.getRect(this.offsets);
    this._areasObjects[0].set(geometry);
  },
  //offsets: {left : 0,top : 0, right: 0, bottom:0},
  setHelpers: function setHelpers(helpers, callback) {
    var _this2 = this;

    this.helpers = helpers;
    this._helpersObjects = [];
    if (helpers) {
      var _iteratorNormalCompletion = true;
      var _didIteratorError = false;
      var _iteratorError = undefined;

      try {
        for (var _iterator = helpers[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
          var h = _step.value;

          fabric.util.createObject(h, function (helper) {
            _this2._helpersObjects.push(helper);
            _this2.renderAll();
          });
        }
      } catch (err) {
        _didIteratorError = true;
        _iteratorError = err;
      } finally {
        try {
          if (!_iteratorNormalCompletion && _iterator.return) {
            _iterator.return();
          }
        } finally {
          if (_didIteratorError) {
            throw _iteratorError;
          }
        }
      }
    }
    callback && callback();
  },
  storeProperties: fabric.StaticCanvas.prototype.storeProperties.concat(["offsets", "helpers", "areas"]),
  areaActivating: false,
  addElementsInsideActiveArea: false,
  areaProperties: {
    originX: 'left',
    originY: 'top',
    fill: 'transparent',
    strokeDashArray: [5, 5],
    strokeWidth: 1,
    stroke: 'black',
    resizable: true
    //selectable: false
  },
  setAreaProperty: function setAreaProperty(property, value) {
    this["area_" + property] = value;
    if (this._offsetsObject) {
      this._offsetsObject[property] = value;
    }
    var _iteratorNormalCompletion2 = true;
    var _didIteratorError2 = false;
    var _iteratorError2 = undefined;

    try {
      for (var _iterator2 = this._areasObjects[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
        var object = _step2.value;

        object[property] = value;
      }
    } catch (err) {
      _didIteratorError2 = true;
      _iteratorError2 = err;
    } finally {
      try {
        if (!_iteratorNormalCompletion2 && _iterator2.return) {
          _iterator2.return();
        }
      } finally {
        if (_didIteratorError2) {
          throw _iteratorError2;
        }
      }
    }

    this.renderAll();
  },
  setActiveArea: function setActiveArea(area) {
    if (this.activeArea) {
      this.activeArea.setStroke("#000");
    }
    this.activeArea = area;
    if (area) {
      area.setStroke("#B7F1ED");
    }
  },
  setAreaActivating: function setAreaActivating(value /*, force*/) {
    //todo force
    var force = true;
    if (force || value && !this.areaActivating) {
      this.areaActivating = true;
      this.on("object:modified", function (e) {
        if (!this._areasObjects) return;
        if (this.editingObject) {
          return;
        }
        //todo event! не ъотел бы это тут испольовать,но работает
        var pointer = this.getPointer(event, true);
        var target = this._searchPossibleTargets(this._areasObjects, pointer);
        if (this._currentTransform && target && this.target.movementLimits != target) {
          this.target.set({
            movementLimits: target,
            clipTo: target
          });
          this.setActiveArea(target);
        }
      });
      this.on("mouse:down", function (e) {
        if (!this._areasObjects) return;
        var pointer = this.getPointer(e.e, true);
        var target = this._searchPossibleTargets(this._areasObjects, pointer);
        if (target) {
          this.setActiveArea(target);
        }
      });
    }
  },
  _update_area_geometry: function _update_area_geometry(el, options) {
    if (options.path) {

      options.width = options.width || el.width;
      var geometry = this.getRect(options);
      var _scale = el.width / geometry.width;
      el.set({
        left: geometry.left, ///* el.left * _scale*/,
        top: geometry.top, //+ el.top * _scale,
        scaleX: _scale,
        scaleY: _scale
      });
      return;
    }
    var geometry = this.getRect(options);

    if (options.src) {
      var _scale = geometry.width / img.width;
      el.set({
        left: geometry.left, // + el.left * _scale,
        top: geometry.top, //+ el.top * _scale,
        strokeWidth: this.areaProperties.strokeWidth / _scale,
        scaleX: _scale,
        scaleY: _scale
      });
    } else {
      el.set(geometry);
    }
  },
  _renderOverlayObjects: function _renderOverlayObjects(ctx) {
    if (this._offsetsObject) {
      this._offsetsObject.render(ctx);
    }
    if (this._areasObjects) {
      this._renderObjects(ctx, this._areasObjects);
    }
    if (this._helpersObjects) {
      this._renderObjects(ctx, this._helpersObjects);
    }
  },
  createArea: function createArea(area, callback) {

    var _this = this;

    var _finalize = function (path, area) {
      path.id = area.id;
      //
      // area.instance = path;
      // path.layer = "background";
      // this.add(path);
      this._update_area_geometry(path, area);
      this._areasObjects.push(path);
      // _this._backgroundLayer.push(path);
      // path.canvas = _this;
      callback();
    }.bind(this);

    var path, rectarea;
    if (area.path) {
      path = new fabric.Path(area.path, this.areaProperties);
      area.top = path.top;
      area.left = path.left;
      area.width = path.width;
      area.height = path.height;
      _finalize(path, area);
    } else if (area.src) {
      var clipFiller = new fabric.Pathfinder({});
      fabric.util.loadImage(area.src, function (img) {
        clipFiller.setImage(img);
        clipFiller.mask = MagicWand.selectBackground(clipFiller.getInfo(), null, 15);

        var contours = clipFiller.getContours();
        var clipPoints = contours[1].points;
        var pathData = fabric.PencilBrush.prototype.convertPointsToSVGPath(clipPoints).join(''); //todo
        path = new fabric.Path(pathData, _this.areaProperties);

        _finalize(path, area);
      });
    } else {
      path = new fabric.Rect(this.areaProperties);
      _finalize(path, area);
    }

    if ((area.right || area.bottom || area.path) && (!this.originalWidth || !this.originalHeight)) {
      this.on("background-image:loaded", function () {
        this._update_area_geometry(path, area);
        this.renderAll();
      }.bind(this));
    }

    /*
     app.canvas.setOffsets({
     right:  1,
     left:   1,
     top:    1,
     bottom: 1
     });
       app.canvas.clipTo = function (ctx) {
     var zoom = app.canvas_config.width / app.canvas.backgroundImage.filters[0].pathfinder.mask.width;
     ctx.save();
     ctx.scale(zoom, zoom);
     app.clipFiller.traceInner(ctx);
     ctx.restore();
     };*/
  },
  removeArea: function removeArea(area) {
    /*
        var objs = this.getObjects();
        for (var i in objs) {
          if (objs[i].movementLimits === area) {
            delete objs[i].movementLimits;
          }
          if (objs[i].clipTo === area) {
            //if(objs[i].olcClipToID){
            //    objs[i].clipToID = objs[i].oldClipToID;
            //}
            delete objs[i].clipTo;
            //objs[i].olcClipToID = area.id;
          }
        }
        area.remove();*/
  },
  /**
   *
   * @param offsets : {top: number, right: number, bottom: number, left: number} | number | [?number,?number,?number,?number]
   * @param callback
   */
  setOffsets: function setOffsets(offsets) {
    if (offsets === null) {
      this.offsets = { top: 0, right: 0, bottom: 0, left: 0 };
    } else if (offsets.constructor === Number) {
      this.offsets = { top: offsets, right: offsets, bottom: offsets, left: offsets };
    } else if (offsets.constructor === Array) {
      switch (offsets.length) {
        case 0:
          this.offsets = { top: 0, right: 0, bottom: 0, left: 0 };break;
        case 1:
          this.offsets = { top: offsets[0], right: offsets[0], bottom: offsets[0], left: offsets[0] };break;
        case 2:
          this.offsets = { top: offsets[0], right: offsets[1], bottom: offsets[0], left: offsets[1] };break;
        case 3:
          this.offsets = { top: offsets[0], right: offsets[1], bottom: offsets[2], left: offsets[1] };break;
        case 4:
          this.offsets = { top: offsets[0], right: offsets[1], bottom: offsets[2], left: offsets[3] };break;
      }
    } else {
      this.offsets = offsets;
    }

    if (this.offsets.top || this.offsets.bottom || this.offsets.left || this.offsets.right) {

      this._offsetsObject = new fabric.Rect(this.offsets);
      this._offsetsObject.set(this.areaProperties);
      this._update_area_geometry(this._offsetsObject, this.offsets);
      if (this.areaActivating) {
        this.setActiveArea(this._offsetsObject || null);
      }
    } else {
      this._offsetsObject = null;
    }

    this.renderAll();
  },
  setAreas: function setAreas(areas, callback) {
    this._areasObjects = [];
    areas = areas || [];
    if (this.areas) {
      for (var i = this.areas.length; i--;) {
        this.removeArea(this.areas[i].instance);
      }
    }
    this.areas = areas;

    var cb = fabric.util.queueLoad(areas.length + 1, function () {
      if (this.areaActivating) {
        this.setActiveArea(this._areasObjects[0] || null);
      }

      /* var objs = this.getObjects();
      //work with object
       if (!areas.length) {
         objs.length && this.clear();
       } else {
         /* todo : применить текущую зону ко всем объектам
          var _area = this.activeArea || this.layers.background.objects[0];
          for (var i in objs) {
          var obj = objs[i];
          obj.clipTo = _area;
          obj.setMovementLimits(_area);
          obj.setCoords();
          }*/
      //}*/
      callback && callback.call(this);
    }.bind(this));

    for (var i in areas) {
      if (!areas[i].id) {
        areas[i].id = "__" + i;
      }
      this.createArea(areas[i], cb);
    }
    cb();

    this.renderAll();
  }
});

fabric.util.object.extend(fabric.SlideCanvas.prototype, {
  defaultOptions: fabric.util.object.extend(fabric.SlideCanvas.prototype.defaultOptions, {
    //offsets: {left : 0,top : 0, right: 0, bottom:0}
  }),
  eventListeners: fabric.util.object.extendArraysObject(fabric.SlideCanvas.prototype.eventListeners, {
    "before:drop": function beforeDrop(e) {
      //todo;
      if (!this._backgroundLayer) {
        return;
      }
      var pointer = this.getPointer(e.originalEvent, true);
      var target = this._searchPossibleTargets(this._backgroundLayer, pointer);
      if (target) {
        this.setActiveArea(target);
        e.data.clipTo = "#" + target.id;
        e.data.movementLimits = "#" + target.id;
      }
    }
  })
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 9 */
/***/ (function(module, exports) {

module.exports = $;

/***/ }),
/* 10 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

var _templateObject = _taggedTemplateLiteral([''], ['']);

function _taggedTemplateLiteral(strings, raw) { return Object.freeze(Object.defineProperties(strings, { raw: { value: Object.freeze(raw) } })); }

fabric.util.object.extend(fabric.Canvas.prototype, {
  // enableClipAreaZooming: function(){
  //todo
  // this.on('viewport:scaled', function(){
  //   if (!this.layer("background").objects) return;
  //   this._backgroundLayer[0].setCoords();
  // });
  // },
  _fabric_clip_function: function _fabric_clip_function(ctx2) {

    var clipRect = this.clipRect;
    ctx2.save();
    clipRect.render(ctx2);
    ctx2.restore();
  }
});

fabric.util.object.extend(fabric.Object.prototype, {
  setClipTo: function setClipTo(val) {
    this.clipTo = val;

    if (typeof val !== 'string') {
      this._clipTo = val;
    }

    var functionBody = fabric.util.getFunctionBody(val);
    if (typeof functionBody !== 'undefined') {
      this._clipTo = new Function('ctx', functionBody);
    }
  },
  _initClipping: function _initClipping(options) {
    if (!options._clipTo) {
      x(_templateObject);
      return;
    }

    var functionBody = fabric.util.getFunctionBody(options.clipTo);
    if (typeof functionBody !== 'undefined') {
      this._clipTo = new Function('ctx', functionBody);
    }
  }
});

fabric.util.clipContext = function (receiver, ctx) {
  if (!receiver._clipTo) {
    if (receiver.clipTo === "canvas") {
      receiver._clipTo = receiver.canvas;
    } else {

      var _id = receiver.clipTo.substring(1);

      var _clipCtx = receiver.canvas.getObjectByID(_id);
      if (_clipCtx) {
        receiver.clipTo = _clipCtx;
      } else {
        console.warn("error: clipTo not found" + receiver.clipTo);
        delete receiver.clipTo;
        return;
      }
    }
  }

  ctx.save();
  ctx.beginPath();

  if (receiver._clipTo.constructor === Function) {
    receiver._clipTo(ctx);
  } else {
    fabric.util._clipToObject(receiver, ctx);
    ctx.clip();
  }
};

fabric.util._clipToObject = function (receiver, ctx) {
  ctx.save();
  ctx.beginPath();

  var fromLeft = false;
  var center = fromLeft ? receiver._getLeftTopCoords() : receiver.getCenterPoint();
  ctx.transform(1, Math.tan(fabric.util.degreesToRadians(-receiver.skewY)), 0, 1, 0, 0);
  ctx.transform(1, 0, Math.tan(fabric.util.degreesToRadians(-receiver.skewX)), 1, 0, 0);
  ctx.scale(1 / receiver.scaleX * (receiver.flipX ? -1 : 1), 1 / receiver.scaleY * (receiver.flipY ? -1 : 1));
  ctx.rotate(fabric.util.degreesToRadians(-receiver.angle));
  ctx.translate(-center.x, -center.y);

  var clipObject = receiver._clipTo;

  if (clipObject.points) {
    var ps = clipObject.points;
    ctx.moveTo(ps[0].x, ps[0].y);
    for (var j = 1; j < ps.length; j++) {
      ctx.lineTo(ps[j].x, ps[j].y);
    }
    //ctx.stroke();
  } else if (clipObject.type == "path") {

    ctx.globalAlpha = 0;
    clipObject.transform(ctx);
    clipObject._render(ctx);

    //todo очень плохо. изначально объекты имеют клип к слайду статичному. но потом к канвасу динамическому. нехорошо
  } else if (clipObject.type == "slide" || clipObject.type == "canvas") {
    var o = clipObject.offsets;
    ctx.rect(o.left, o.top, clipObject.width - o.left - o.right, clipObject.height - o.top - o.bottom);
  } else {
    ctx.translate(clipObject.left, clipObject.top);
    ctx.rotate(-(clipObject.angle * -1) * Math.PI / 180);
    ctx.rect(0, 0, clipObject.width, clipObject.height);
  }

  ctx.closePath();
  ctx.restore();
};
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 11 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

// Magic Wand (Fuzzy Selection Tool) for Javascript
//
// The MIT License (MIT)
//
// Copyright (c) 2014, Ryasnoy Paul (ryasnoypaul@gmail.com)
//
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
//
// The above copyright notice and this permission notice shall be included in
// all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
// THE SOFTWARE.

var MagicWand = function () {
  var lib = {};
  //var canvas = document.createElement("canvas");
  //var context = canvas.getContext("2d");

  function createCanvasElement() {
    if (typeof Canvas !== "undefined") {
      return new Canvas();
    }
    return document.createElement("canvas");
  }

  function SelectionMask(w, h, data) {
    if (arguments.length == 1) {
      for (var i in arguments[0]) {
        this[i] = arguments[0][i];
      }
    } else {
      this.data = new Uint8Array(data || w * h);
      this.width = w;
      this.height = h;
      this.count = 0;
      this.bounds = {
        minX: Infinity,
        minY: Infinity,
        maxY: -1,
        maxX: -1
      };
      // this.bounds = {
      //   minX: 0,
      //   minY: 0,
      //   maxY: h,
      //   maxX: w
      // };
    }
  }
  lib.SelectionMask = SelectionMask;

  SelectionMask.prototype.debug = function () {
    var canvas = document.createElement("canvas");
    canvas.width = this.width;
    canvas.height = this.height;
    var ctx = canvas.getContext('2d');
    this.render(ctx, {
      fill: "#fff",
      outerFill: "#000"
    });
    ctx.debug();
  };

  SelectionMask.prototype.makeCache = function (options) {
    this.cache = createCanvasElement();
    this.cache.width = this.bounds.maxX - this.bounds.minX + 1;
    this.cache.height = this.bounds.maxY - this.bounds.minY + 1;
    this.context = this.cache.getContext('2d');

    options = options || {};
    this.render(this.context, {
      fill: "#fff",
      outerFill: "#000",
      cache: false,
      left: -this.bounds.minX,
      top: -this.bounds.minY
    });
  };

  SelectionMask.prototype.add = function (mask) {
    var index, x, y;
    for (x = mask.bounds.minX; x <= mask.bounds.maxX; x++) {
      for (y = mask.bounds.minY; y <= mask.bounds.maxY; y++) {
        index = mask.width * y + x;
        if (mask.data[index] && !this.data[index]) {
          this.data[index] = 1;
          this.count++;
        }
      }
    }

    this.bounds.minX = Math.min(mask.bounds.minX, this.bounds.minX);
    this.bounds.maxX = Math.max(mask.bounds.maxX, this.bounds.maxX);
    this.bounds.minY = Math.min(mask.bounds.minY, this.bounds.minY);
    this.bounds.maxY = Math.max(mask.bounds.maxY, this.bounds.maxY);
  };
  function hexToRgb(hex) {
    // Expand shorthand form (e.g. "03F") to full form (e.g. "0033FF")
    var shorthandRegex = /^#?([a-f\d])([a-f\d])([a-f\d])$/i;
    hex = hex.replace(shorthandRegex, function (m, r, g, b) {
      return r + r + g + g + b + b;
    });

    var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
    return result ? {
      r: parseInt(result[1], 16),
      g: parseInt(result[2], 16),
      b: parseInt(result[3], 16)
    } : null;
  }

  SelectionMask.prototype.render = function (ctx, options) {
    if (!this.count) return;

    options = options || {};
    options.left = options.left || 0;
    options.top = options.top || 0;
    options.fill = options.fill || false; // [0,0,0,0];
    options.intersectionColor = options.intersectionColor || false; //  [0,0,0,0];

    options.outerFill = options.outerFill || false; // [0,0,0,0];
    options.outerIntersectionColor = options.outerIntersectionColor || false; //  [0,0,0,0];

    //if(this.cache && options.cache !== false){
    //
    //  var _ctx = this.context;
    //  _ctx.save();
    //  _ctx.globalCompositeOperation="source-in";
    //  _ctx.fillStyle= options.fill;
    //  _ctx.fillRect(0,0,this.cache.width,this.cache.height);
    //  _ctx.restore();
    //
    //  ctx.save();
    //  ctx.globalAlpha = options.opacity;
    //  ctx.drawImage(this.cache,this.bounds.minX,this.bounds.minY)
    //  ctx.restore();
    //  return;
    //}

    //todo do not use fabric here!
    function convertColor(color) {
      if (color.constructor == String) {
        if (color[0] == "#") {
          var _rgb = hexToRgb(color);
          return [_rgb.r, _rgb.g, _rgb.b, 255];
        }
        color = new fabric.Color(color)._source;
        color[3] *= 255;
      }
      return color;
    }

    var _w = this.bounds.maxX - this.bounds.minX + 1;
    var _h = this.bounds.maxY - this.bounds.minY + 1;

    //var imgData = ctx.getImageData(options.left,options.top,_w,_h);
    var imgData = ctx.getImageData(this.bounds.minX, this.bounds.minY, _w, _h);

    var color = convertColor(options.fill);
    var color2 = convertColor(options.intersectionColor);
    var color3 = convertColor(options.outerFill);
    var color4 = convertColor(options.outerIntersectionColor);

    for (var x = this.bounds.minX; x <= this.bounds.maxX; x++) {
      for (var y = this.bounds.minY; y <= this.bounds.maxY; y++) {
        var index = this.width * y + x;
        var index_small = _w * (y - this.bounds.minY) + x - this.bounds.minX;

        if (this.data[index]) {
          var _color = imgData.data[index_small * 4 + 3] ? color2 : color;
          if (!_color) continue;

          imgData.data[index_small * 4] = _color[0];
          imgData.data[index_small * 4 + 1] = _color[1];
          imgData.data[index_small * 4 + 2] = _color[2];
          imgData.data[index_small * 4 + 3] = _color[3];
        } else {
          var _color = imgData.data[index_small * 4 + 3] ? color4 : color3;
          if (!_color) continue;

          imgData.data[index_small * 4] = _color[0];
          imgData.data[index_small * 4 + 1] = _color[1];
          imgData.data[index_small * 4 + 2] = _color[2];
          imgData.data[index_small * 4 + 3] = _color[3];
        }
      }
    }

    // ctx.putImageData(imgData, options.left  , options.top  );
    ctx.putImageData(imgData, this.bounds.minX, this.bounds.minY);
  };

  /**
   * get array with begin and end indices of filled 1 intervals
   * @param ctx
   * @param options
   * @returns {Array}
   */
  SelectionMask.prototype.getIntervalsArray = function (ctx, options) {
    var _newData = [];
    for (var i = 0, _val = 0; i < array.length; i++) {
      if (_val != array[i]) {
        _newData.push(i);
        _val = array[i];
      }
    }
    return _newData;
  };

  SelectionMask.prototype.renderBorder = function (ctx, options) {

    options = options || {};
    options.left = options.left || 0;
    options.top = options.top || 0;
    options.hatchOffset = options.hatchOffset || 0;
    options.hatchLength = options.hatchLength || 4;
    options.opacity = options.opacity || 1;

    var imgData = ctx.getImageData(0, 0, this.width, this.height);

    if (!this.cacheInd) {
      this.cacheInd = MagicWand.getBorderIndices(this);
    }

    var x,
        y,
        i,
        j,
        k,
        w = imgData.width,
        h = imgData.height;
    var res = imgData.data;

    var len = this.cacheInd.length;
    for (j = 0; j < len; j++) {
      i = this.cacheInd[j];
      x = i % w; // calc x by index
      y = (i - x) / w; // calc y by index
      k = (y * w + x) * 4;

      if ((x + y + options.hatchOffset) % (options.hatchLength * 2) < options.hatchLength) {
        // detect hatch color

        res[k] = 0;
        res[k + 1] = 0;
        res[k + 2] = 0;
        res[k + 3] = 255; // black, change only alpha
      } else {
        res[k] = 255; // white
        res[k + 1] = 255;
        res[k + 2] = 255;
        res[k + 3] = 255;
      }
    }
    ctx.save();
    ctx.globalAlpha = options.opacity;
    ctx.putImageData(imgData, options.left || 0, options.top || 0);
    ctx.restore();
  };

  lib.createMask = function (w, h, data) {
    return new SelectionMask(w, h, data);
  };

  lib.difference = function (a, b) {
    return Math.max(b[0] !== false ? Math.abs(b[0] - a[0]) : 0, b[1] !== false ? Math.abs(b[1] - a[1]) : 0, b[2] !== false ? Math.abs(b[2] - a[2]) : 0, b[3] !== false ? Math.abs(b[3] - a[3]) : 0);
  };

  lib.acceptable = function (x, y, image, visited, sampleColor, colorThreshold) {
    // check whether the point has been visited
    if (visited[y * image.width + x] === 1) {
      return false;
    }
    var i = (y * image.width + x) * lib.bytes,
        color2 = [image.data[i], image.data[i + 1], image.data[i + 2], image.data[i + 3]];

    if (sampleColor[0] !== false && Math.abs(sampleColor[0] - color2[0]) > colorThreshold) return false;
    if (sampleColor[1] !== false && Math.abs(sampleColor[1] - color2[1]) > colorThreshold) return false;
    if (sampleColor[2] !== false && Math.abs(sampleColor[2] - color2[2]) > colorThreshold) return false;
    if (sampleColor[3] !== false && Math.abs(sampleColor[3] - color2[3]) > colorThreshold) return false;
    return true;
  };

  lib.selectAll = function (image, px, py, colorThreshold) {
    var i = (py * image.width + px) * lib.bytes,
        data = image.data,
        sampleColor = [data[i], data[i + 1], data[i + 2], data[i + 3]]; // start point color (sample)
    return lib.selectAllByColor(image, sampleColor, colorThreshold);
  };

  /**
   * Converts an RGB color value to HSL. Conversion formula
   * adapted from http://en.wikipedia.org/wiki/HSL_color_space.
   * Assumes r, g, and b are contained in the set [0, 255] and
   * returns h, s, and l in the set [0, 1].
   *
   * @param   Number  r       The red color value
   * @param   Number  g       The green color value
   * @param   Number  b       The blue color value
   * @return  Array           The HSL representation
   */
  lib.rgbToHsl = function (r, g, b) {
    r /= 255, g /= 255, b /= 255;
    var max = Math.max(r, g, b),
        min = Math.min(r, g, b);
    var h,
        s,
        l = (max + min) / 2;

    if (max == min) {
      h = s = 0; // achromatic
    } else {
      var d = max - min;
      s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
      switch (max) {
        case r:
          h = (g - b) / d + (g < b ? 6 : 0);break;
        case g:
          h = (b - r) / d + 2;break;
        case b:
          h = (r - g) / d + 4;break;
      }
      h /= 6;
    }

    return [h, s, l];
  };

  lib.selectColored = function (image, options) {

    var mask = new SelectionMask(image.width, image.height);

    mask.bounds = {
      minX: image.width,
      minY: image.height,
      maxY: -1,
      maxX: -1
    };

    var x, y;
    for (y = 0; y < image.height; y++) {
      for (x = 0; x < image.width; x++) {
        var index = y * image.width + x;
        var i = index * lib.bytes;
        //if (!image.data[i + 3]) continue;


        if (options.aMin && image.data[i + 3] < options.aMin) continue;

        var hsl = rgbToHsl(image.data[i], image.data[i + 1], image.data[i + 2]);

        if (options.sMin && hsl[1] < options.sMin) continue;
        if (options.sMax && hsl[1] > options.sMax) continue;
        if (options.bMin && hsl[2] < options.bMin) continue;
        if (options.bMax && hsl[2] > options.bMax) continue;

        mask.data[index] = 1;
        mask.count++;
        mask.bounds.minX = Math.min(mask.bounds.minX, x);
        mask.bounds.maxX = Math.max(mask.bounds.maxX, x);
        mask.bounds.minY = Math.min(mask.bounds.minY, y);
        mask.bounds.maxY = Math.max(mask.bounds.maxY, y);
      }
    }
    return mask;
  };

  lib.selectAllByColor = function (ctx, sampleColor, colorThreshold) {
    var image = _getImageData(ctx);

    var mask = new SelectionMask(image.width, image.height);

    mask.bounds = {
      minX: Infinity,
      minY: Infinity,
      maxY: -1,
      maxX: -1
    };

    var visited = new Uint8Array(image.width * image.height);
    var x, y;
    for (y = 0; y < image.height; y++) {
      for (x = 0; x < image.width; x++) {
        if (lib.acceptable(x, y, image, mask.data, sampleColor, colorThreshold)) {
          MagicWand.floodFill(image, x, y, colorThreshold, {
            sampleColor: sampleColor,
            activeMask: mask,
            visitedPoints: visited
          });
        }
      }
    }
    return mask;
  };

  lib.drawImage = function (ctx, canvas, mask, left, top) {

    var ctx2 = canvas.getContext('2d');

    var imgData = ctx.getImageData(0, 0, mask.width, mask.height);
    var imgDataOriginal = ctx2.getImageData(left, top, mask.width, mask.height);

    var b = mask.bounds;
    for (var x = b.minX; x <= b.maxX; x++) {
      for (var y = b.minY; y <= b.maxY; y++) {
        var i = y * mask.width + x; // * bytes; // point index in the image data
        if (mask.data[i]) {
          imgData.data[i * 4] = imgDataOriginal.data[i * 4];
          imgData.data[i * 4 + 1] = imgDataOriginal.data[i * 4 + 1];
          imgData.data[i * 4 + 2] = imgDataOriginal.data[i * 4 + 2];
          imgData.data[i * 4 + 3] = imgDataOriginal.data[i * 4 + 3];
        }
      }
    }ctx.putImageData(imgData, 0, 0);
  };

  function _getImageData(ctx) {
    if (ctx.constructor.name == "ImageData") {
      return ctx;
    } else {
      return ctx.getImageData(0, 0, ctx.canvas.width, ctx.canvas.height);
    }
  }

  lib.fillMask = function (ctx, mask, color) {
    var imgData = _getImageData(ctx);
    var b = mask.bounds;
    var w = imgData.width,
        h = imgData.height;

    for (var x = b.minX; x <= b.maxX; x++) {
      for (var y = b.minY; y <= b.maxY; y++) {
        var i = y * w + x; // * bytes; // point index in the image data
        if (mask.data[i]) {
          imgData.data[i * 4] = color[0];
          imgData.data[i * 4 + 1] = color[1];
          imgData.data[i * 4 + 2] = color[2];
          imgData.data[i * 4 + 3] = color[3];
        }
      }
    }if (ctx.constructor.name != "ImageData") {
      ctx.clearRect(0, 0, w, h);
      ctx.putImageData(imgData, 0, 0);
    }
  };

  lib.selectBackground = function (ctx, sampleColor, colorThreshold) {
    var image = _getImageData(ctx);

    colorThreshold = colorThreshold || 15;

    var mask = new SelectionMask(image.width, image.height);
    mask.bounds = {
      minX: Infinity,
      minY: Infinity,
      maxY: -1,
      maxX: -1
    };

    var data = image.data;

    sampleColor = sampleColor || [data[0], data[1], data[2], data[3]]; // start point color (sample)

    var color = sampleColor;

    function add(x, y) {
      if (!lib.acceptable(x, y, image, mask.data, sampleColor, colorThreshold)) return;
      if (!sampleColor) {
        var index = (y * image.width + x) * 4;
        color = [data[index], data[index + 1], data[index + 2], data[index + 3]];
      }
      var mask2 = MagicWand.floodFill(image, x, y, colorThreshold, null, color);
      mask = MagicWand.add(mask, mask2);
    }

    var x, y;

    for (x = 0; x < image.width; x++) {
      add(x, 0);
    }
    for (x = 0; x < image.width; x++) {
      add(x, image.height - 1);
    }
    for (y = 0; y < image.height; y++) {
      add(image.width - 1, y);
    }
    for (y = 0; y < image.height; y++) {
      add(0, y);
    }
    return mask;
  };

  lib.extractColors = function (mixedType, threshold) {
    threshold = threshold || 60;
    var imgData = lib.getImageData(mixedType);
    var _colors = [];
    var c1;
    for (var x = 1; x < imgData.width; x += 3) {
      for (var y = 1; y < imgData.height; y += 3) {
        var iii = (x + y * imgData.width) * 4;
        var iiA = (x - 1 + y * imgData.width) * 4;
        var iiB = (x + 1 + y * imgData.width) * 4;
        var iiC = (x - 1 + (y + 1) * imgData.width) * 4;
        var iiD = (x + 1 + (y + 1) * imgData.width) * 4;
        if (imgData.data[iii + 3] < 255) continue;

        c1 = [imgData.data[iii], imgData.data[iii + 1], imgData.data[iii + 2]];
        var cA = [imgData.data[iiA], imgData.data[iiA + 1], imgData.data[iiA + 2]];
        var cB = [imgData.data[iiB], imgData.data[iiB + 1], imgData.data[iiB + 2]];
        var cC = [imgData.data[iiC], imgData.data[iiC + 1], imgData.data[iiC + 2]];
        var cD = [imgData.data[iiD], imgData.data[iiD + 1], imgData.data[iiD + 2]];

        if (c1[0] != cA[0] || cA[0] != cB[0] || cB[0] != cC[0] || cC[0] != cD[0] || c1[1] != cA[1] || cA[1] != cB[1] || cB[1] != cC[1] || cC[1] != cD[1] || c1[2] != cA[2] || cA[2] != cB[2] || cB[2] != cC[2] || cC[2] != cD[2]) {
          continue;
        }

        var isNewColor = true;

        for (var i in _colors) {
          if (MagicWand.difference(_colors[i], c1) < threshold) {
            isNewColor = false;
            break;
          }
        }
        if (isNewColor) {
          _colors.push(c1);
        }
      }
    }
    return _colors;
  };

  /**
   * image
   * canvas - черно блое изображение.
   *
   * mask- предыдущая маска. на нее будет накладывать новая
   * mode - способ наложения.
   */
  lib.maskSelection = function (canvas, left, top, mask, mode) {
    left = left || 0;
    top = top || 0;
    if (canvas.constructor.name == "HTMLImageElement") {

      var __canvas = createCanvasElement();
      __canvas.width = canvas.width;
      __canvas.height = canvas.height;
      var __ctx = __canvas.getContext('2d');
      __ctx.drawImage(canvas, 0, 0);
      canvas = __canvas;
    }

    var ctx = canvas.getContext('2d'),
        imgData = ctx.getImageData(0, 0, canvas.width, canvas.height),
        mask = mask || MagicWand.createMask(canvas.width, canvas.height);

    var _x1 = Math.max(0, -left),
        _y1 = Math.max(0, -top),
        _x2 = Math.min(mask.width - left, canvas.width);
    _y2 = Math.min(mask.height - top, canvas.height);

    for (var x = _x1; x < _x2; x++) {
      for (var y = _y1; y < _y2; y++) {
        var index = (canvas.width * y + x) * 4;

        if (imgData.data[index] > 20) {
          var index2 = mask.width * (y + top) + x + left;
          mask.data[index2] = 1;
          mask.count++;
        }
      }
    }
    return mask;
  }, lib.selectRectangle = function (image, x1, y1, x2, y2) {

    var mask = new SelectionMask(image.width, image.height);
    var minX = Math.min(x1, x2);
    var maxX = Math.max(x1, x2);
    var minY = Math.min(y1, y2);
    var maxY = Math.max(y1, y2);

    var w = image.width,
        h = image.height;

    var data = image.data;
    for (var y = minY; y <= maxY; y++) {
      for (var x = minX; x <= maxX; x++) {
        if (data[(y * w + x) * 4 + 3]) {
          mask.data[y * w + x] = 1;
          mask.count++;
        }
      }
    }

    mask.bounds = {
      minX: minX,
      minY: minY,
      maxX: maxX,
      maxY: maxY
    };

    return mask;
  };

  lib.bytes = 4;

  lib.__floodFill = function (e, postMessage) {

    data = e.data;
    var image = data[0],
        px = data[1],
        py = data[2],
        colorThreshold = data[3],
        options = data[4];

    options = options || {};
    /*{
     visitedPointsArray,
     sampleColor,
     resultMask
     }*/

    var c,
        x,
        newY,
        el,
        xr,
        xl,
        dy,
        dyl,
        dyr,
        checkY,
        data = image.data,
        w = image.width,
        h = image.height,
        bytes = lib.bytes,
        i = py * w + px; // start point index in the mask data
    i = i * bytes; // start point index in the image data

    var visited = options.visitedPoints || new Uint8Array(w * h),
        // mask of visited points
    sampleColor = options.sampleColor || [data[i], data[i + 1], data[i + 2], data[i + 3]],
        // start point color (sample)
    result = options.activeMask;

    function acceptable(x, y) {
      // check whether the point has been visited
      if (visited[y * image.width + x] === 1) {
        return false;
      }
      var i = (y * image.width + x) * lib.bytes,
          color2 = [image.data[i], image.data[i + 1], image.data[i + 2], image.data[i + 3]];
      if (sampleColor[0] !== false && Math.abs(sampleColor[0] - color2[0]) > colorThreshold) return false;
      if (sampleColor[1] !== false && Math.abs(sampleColor[1] - color2[1]) > colorThreshold) return false;
      if (sampleColor[2] !== false && Math.abs(sampleColor[2] - color2[2]) > colorThreshold) return false;
      if (sampleColor[3] !== false && Math.abs(sampleColor[3] - color2[3]) > colorThreshold) return false;
      return true;
    };

    if (visited[i] === 1) return null;

    var first = true;
    var stack = [{ y: py, left: px - 1, right: px + 1, dir: 1 }]; // first scanning line

    var mode = 'strict';
    var _ci;
    do {
      el = stack.shift(); // get line for scanning

      checkY = false;
      for (x = el.left + 1; x < el.right; x++) {
        dy = el.y * w;

        if (mode == 'gradient' && !first) {
          _ci = (dy + x + (el.dir == -1 ? w : -w)) * 4;
          sampleColor = [data[_ci], data[_ci + 1], data[_ci + 2], data[_ci + 3]];
        }
        if (!acceptable(x, el.y, image, visited, sampleColor, colorThreshold)) continue;

        first = false;

        checkY = true; // if the color of the new point(x,y) is similar to the sample color need to check minmax for Y

        result.count++;

        result.data[dy + x] = 1; // mark a new point in mask
        visited[dy + x] = 1; // mark a new point as visited

        xl = x - 1;
        // walk to left side starting with the left neighbor
        while (xl > -1) {
          dyl = dy + xl;

          if (mode == 'gradient') {
            _ci = (dyl + 1) * 4;
            sampleColor = [data[_ci], data[_ci + 1], data[_ci + 2], data[_ci + 3]];
          }
          if (!acceptable(xl, el.y, image, visited, sampleColor, colorThreshold)) break;

          result.count++;
          result.data[dyl] = 1;
          visited[dyl] = 1;

          xl--;
        }
        xr = x + 1;
        // walk to right side starting with the right neighbor
        while (xr < w) {
          dyr = dy + xr;

          if (mode == 'gradient') {
            _ci = (dyr - 1) * 4;
            sampleColor = [data[_ci], data[_ci + 1], data[_ci + 2], data[_ci + 3]];
          }
          if (!acceptable(xr, el.y, image, visited, sampleColor, colorThreshold)) {
            break;
          }

          result.count++;
          result.data[dyr] = 1;
          visited[dyr] = 1;
          xr++;
        }

        // check minmax for X
        if (xl < result.bounds.minX) result.bounds.minX = xl + 1;
        if (xr > result.bounds.maxX) result.bounds.maxX = xr - 1;

        newY = el.y - el.dir;
        if (newY >= 0 && newY < h) {
          if (xl < xr) stack.push({ y: newY, left: xl, right: xr, dir: -el.dir }); // from "new left" to "new right"
          // add two scanning lines in the opposite direction (y - dir) if necessary
          // if (xl <= el.left) stack.push({y: newY, left: xl, right: el.left, dir: -el.dir}); // from "new left" to "current left"
          // if (el.right <= xr) stack.push({y: newY, left: el.right, right: xr, dir: -el.dir}); // from "current right" to "new right"
        }
        newY = el.y + el.dir;
        if (newY >= 0 && newY < h) {
          // add the scanning line in the direction (y + dir) if necessary
          if (xl < xr) stack.push({ y: newY, left: xl, right: xr, dir: el.dir }); // from "new left" to "new right"
        }
      }
      // check minmax for Y if necessary
      if (checkY) {
        if (el.y < result.bounds.minY) result.bounds.minY = el.y;
        if (el.y > result.bounds.maxY) result.bounds.maxY = el.y;
      }
    } while (stack.length > 0);

    postMessage && postMessage(result);
    return result;
  };

  lib.extendMask = function (mask, value) {

    var mask2 = new SelectionMask(mask.width + 2, mask.height + 2);
    if (value) {
      mask2.data.fill(value);
    }

    for (var y = 0; y < mask.height; y++) {
      for (var x = 0; x < mask.width; x++) {
        mask2.data[(y + 1) * mask2.width + x + 1] = mask.data[y * mask.width + x];
      }
    }
    mask2.count = mask.count;

    if (!value) {
      mask2.bounds = {
        minX: mask.bounds.minX + 1,
        maxX: mask.bounds.maxX + 1,
        maxY: mask.bounds.maxY + 1,
        minY: mask.bounds.minY + 1
      };
    } else {
      mask2.bounds = mask.bounds;
    }

    return mask2;
  };

  /** Create a binary mask on the image by color threshold
   * Algorithm: Scanline flood fill (http://en.wikipedia.org/wiki/Flood_fill)
   * @param {Object} image: {Uint8Array} data, {int} width, {int} height, {int} bytes
   * @param {int} x of start pixel
   * @param {int} y of start pixel
   * @param {int} color threshold
   * @param {Uint8Array} mask of visited points (optional)
   * @return {Object} mask: {Uint8Array} data, {int} width, {int} height, {Object} bounds
   */
  lib.floodFill = function (image, px, py, colorThreshold, options, color, callback) {
    options = options || {};
    options.activeMask = options.activeMask || new SelectionMask(image.width, image.height);

    return lib.__floodFill({ data: [image, px, py, colorThreshold, options, color] }, callback);

    /*
    var worker = _.worker(lib.__floodFill);
    worker.onmessage = function(e){
      var mask = new SelectionMask(e.data);
      callback && callback(mask);
    };
    worker.postMessage([image, px, py, colorThreshold, options]);
    */
  };

  lib.substract = function (mask, mask2) {
    var minX, maxX, minY, maxY;

    var result = new SelectionMask(mask.width, mask.height);
    var bounds = mask2.bounds;

    var minX = false,
        minY = mask.height,
        maxX = false,
        maxY = -1;

    for (var x = bounds.minX; x <= bounds.maxX; x++) {
      for (var y = bounds.minY; y <= bounds.maxY; y++) {
        var index = mask.width * y + x;

        if (!mask.data[index] && mask2.data[index]) {
          result.data[index] = 1;
          result.count++;
          if (result.bounds.minY > y) result.bounds.minY = y;
          if (result.bounds.maxY < y) result.bounds.maxY = y;
          if (result.bounds.minX > x) result.bounds.minX = x;
          if (result.bounds.maxX < x) result.bounds.maxX = x;
        }
      }
    }

    return result;
  };

  lib.getImageData = function (mixedType) {
    var canvas;
    if (mixedType.constructor.name == "Image" || mixedType.constructor.name == "HTMLImageElement") {
      var _canvas = createCanvasElement();
      _canvas.width = mixedType.width;
      _canvas.height = mixedType.height;
      var ctx = _canvas.getContext("2d");
      ctx.drawImage(mixedType, 0, 0);
      canvas = _canvas;
    } else {
      canvas = mixedType;
    }
    if (canvas.constructor.name == "HTMLCanvasElement" || canvas.constructor.name == "Canvas") {
      var imgData = canvas.getContext("2d").getImageData(0, 0, canvas.width, canvas.height);
    } else {
      imgData = mixedType;
    }
    return imgData;
  };

  lib.getColoredPixels = function (mixedType) {
    var imgData = lib.getImageData(mixedType);
    var data = imgData.data;
    var pixels = 0;
    for (var i = 3; i < data.length; i += 4) {
      if (data[i]) {
        pixels += data[i] / 255;
      }
    }
    return pixels;
  };

  lib.invertMask = function (mask) {
    var result = new SelectionMask(mask.width, mask.height);
    result.bounds = {
      minX: Infinity,
      minY: Infinity,
      maxY: -1,
      maxX: -1
    };

    for (var x = 0; x < mask.width; x++) {
      for (var y = 0; y < mask.height; y++) {
        var index = mask.width * y + x;
        if (!mask.data[index]) {
          result.data[index] = 1;
          result.count++;
          if (result.bounds.minY > y) result.bounds.minY = y;
          if (result.bounds.maxY < y) result.bounds.maxY = y;
          if (result.bounds.minX > x) result.bounds.minX = x;
          if (result.bounds.maxX < x) result.bounds.maxX = x;
        }
      }
    }
    return result;
  };

  lib.exclude = function (mask, mask2) {
    var result = new SelectionMask(mask.width, mask.height);
    var bounds = {
      minX: Math.min(mask.bounds.minX, mask2.bounds.minX),
      maxX: Math.max(mask.bounds.maxX, mask2.bounds.maxX),
      minY: Math.min(mask.bounds.minY, mask2.bounds.minY),
      maxY: Math.max(mask.bounds.maxY, mask2.bounds.maxY)
    };

    var minX = false,
        minY = mask.height,
        maxX = false,
        maxY = -1;

    for (var x = bounds.minX; x <= bounds.maxX; x++) {
      for (var y = bounds.minY; y <= bounds.maxY; y++) {
        var index = mask2.width * y + x;

        if (mask.data[index] ^ mask2.data[index]) {
          result.data[index] = 1;
          result.count++;
          maxX = x;
          if (minY > y) minY = y;
          if (maxY < y) maxY = y;
          if (minX === false) {
            minX = x;
          }
        }
      }
    }

    result.bounds = {
      minX: minX,
      maxX: maxX,
      minY: minY,
      maxY: maxY
    };

    return result;
  };

  lib.intersect = function (mask, mask2) {
    var minX, maxX, minY, maxY;

    var result = new SelectionMask(mask.width, mask.height);
    var bounds = {
      minX: Math.max(mask.bounds.minX, mask2.bounds.minX),
      maxX: Math.min(mask.bounds.maxX, mask2.bounds.maxX),
      minY: Math.max(mask.bounds.minY, mask2.bounds.minY),
      maxY: Math.min(mask.bounds.maxY, mask2.bounds.maxY)
    };

    var minX = false,
        minY = mask.height,
        maxX = false,
        maxY = -1;

    for (var x = bounds.minX; x <= bounds.maxX; x++) {
      for (var y = bounds.minY; y <= bounds.maxY; y++) {
        var index = mask2.width * y + x;

        if (mask.data[index] && mask2.data[index]) {
          result.data[index] = 1;
          result.count++;
          maxX = x;
          if (minY > y) minY = y;
          if (maxY < y) maxY = y;
          if (minX === false) {
            minX = x;
          }
        }
      }
    }

    result.bounds = {
      minX: minX,
      maxX: maxX,
      minY: minY,
      maxY: maxY
    };

    return result;
  };

  lib.add = function (mask, mask2) {
    var result = new SelectionMask(mask.width, mask.height);

    result.bounds = {
      minX: Math.min(mask.bounds.minX, mask2.bounds.minX),
      maxX: Math.max(mask.bounds.maxX, mask2.bounds.maxX),
      minY: Math.min(mask.bounds.minY, mask2.bounds.minY),
      maxY: Math.max(mask.bounds.maxY, mask2.bounds.maxY)
    };

    for (var x = result.bounds.minX; x <= result.bounds.maxX; x++) {
      for (var y = result.bounds.minY; y <= result.bounds.maxY; y++) {
        var index = mask2.width * y + x;

        if (mask.data[index] || mask2.data[index]) {
          result.data[index] = 1;
          result.count++;
        }
      }
    }

    return result;
  };

  /** Apply the gauss-blur filter to binary mask
   * Algorithms: http://blog.ivank.net/fastest-gaussian-blur.html
   * http://www.librow.com/articles/article-9
   * http://elynxsdk.free.fr/ext-docs/Blur/Fast_box_blur.pdf
   * @param {Object} mask: {Uint8Array} data, {int} width, {int} height, {Object} bounds
   * @param {int} blur radius
   * @return {Object} mask: {Uint8Array} data, {int} width, {int} height, {Object} bounds
   */
  lib.gaussBlur = function (mask, radius) {

    var i,
        k,
        k1,
        x,
        y,
        val,
        start,
        end,
        n = radius * 2 + 1,
        // size of the pattern for radius-neighbors (from -r to +r with the center point)
    s2 = radius * radius,
        wg = new Float32Array(n),
        // weights
    total = 0,
        // sum of weights(used for normalization)
    w = mask.width,
        h = mask.height,
        data = mask.data,
        minX = mask.bounds.minX,
        maxX = mask.bounds.maxX,
        minY = mask.bounds.minY,
        maxY = mask.bounds.maxY,
        count = 0;

    // calc gauss weights
    for (i = 0; i < radius; i++) {
      var dsq = (radius - i) * (radius - i);
      var ww = Math.exp(-dsq / (2.0 * s2)) / (2 * Math.PI * s2);
      wg[radius + i] = wg[radius - i] = ww;
      total += 2 * ww;
    }
    // normalization weights
    for (i = 0; i < n; i++) {
      wg[i] /= total;
    }

    var result = new Uint8Array(w * h),
        // result mask
    endX = radius + w,
        endY = radius + h;

    //walk through all source points for blur
    for (y = minY; y < maxY + 1; y++) {
      for (x = minX; x < maxX + 1; x++) {
        val = 0;
        k = y * w + x; // index of the point
        start = radius - x > 0 ? radius - x : 0;
        end = endX - x < n ? endX - x : n; // Math.min((((w - 1) - x) + radius) + 1, n);
        k1 = k - radius;
        // walk through x-neighbors
        for (i = start; i < end; i++) {
          val += data[k1 + i] * wg[i];
        }
        start = radius - y > 0 ? radius - y : 0;
        end = endY - y < n ? endY - y : n; // Math.min((((h - 1) - y) + radius) + 1, n);
        k1 = k - radius * w;
        // walk through y-neighbors
        for (i = start; i < end; i++) {
          val += data[k1 + i * w] * wg[i];
        }
        if (val > 0.5) {
          result[k] = 1;
          count++;
        } else {
          result[k] = 0;
        }
      }
    }return {
      count: count,
      data: result,
      width: w,
      height: h,
      bounds: {
        minX: minX,
        minY: minY,
        maxX: maxX,
        maxY: maxY
      }
    };
  };

  /** Create a border index array of boundary points of the mask with radius-neighbors
   * @param {Object} mask: {Uint8Array} data, {int} width, {int} height, {Object} bounds
   * @param {int} radius: blur radius
   * @param {Uint8Array} visited: mask of visited points (optional)
   * @return {Array} border index array of boundary points with radius-neighbors (only points need for blur)
   */
  function createBorderForBlur(mask, radius, visited) {

    var x,
        i,
        j,
        y,
        k,
        k1,
        k2,
        w = mask.width,
        h = mask.height,
        data = mask.data,
        visitedData = new Uint8Array(data),
        minX = mask.bounds.minX,
        maxX = mask.bounds.maxX,
        minY = mask.bounds.minY,
        maxY = mask.bounds.maxY,
        len = w * h,
        temp = new Uint8Array(len),
        // auxiliary array to check uniqueness
    border = [],
        // only border points
    x0 = Math.max(minX, 1),
        x1 = Math.min(maxX, w - 2),
        y0 = Math.max(minY, 1),
        y1 = Math.min(maxY, h - 2);

    if (visited && visited.length > 0) {
      // copy visited points (only "black")
      for (k = 0; k < len; k++) {
        if (visited[k] === 1) visitedData[k] = 1;
      }
    }

    // walk through inner values except points on the boundary of the image
    for (y = y0; y < y1 + 1; y++) {
      for (x = x0; x < x1 + 1; x++) {
        k = y * w + x;
        if (data[k] === 0) continue; // "white" point isn't the border
        k1 = k + w; // y + 1
        k2 = k - w; // y - 1
        // check if any neighbor with a "white" color
        if (visitedData[k + 1] === 0 || visitedData[k - 1] === 0 || visitedData[k1] === 0 || visitedData[k1 + 1] === 0 || visitedData[k1 - 1] === 0 || visitedData[k2] === 0 || visitedData[k2 + 1] === 0 || visitedData[k2 - 1] === 0) {
          //if (visitedData[k + 1] + visitedData[k - 1] +
          //    visitedData[k1] + visitedData[k1 + 1] + visitedData[k1 - 1] +
          //    visitedData[k2] + visitedData[k2 + 1] + visitedData[k2 - 1] == 8) continue;
          border.push(k);
        }
      }
    } // walk through points on the boundary of the image if necessary
    // if the "black" point is adjacent to the boundary of the image, it is a border point
    if (minX == 0) for (y = minY; y < maxY + 1; y++) {
      if (data[y * w] === 1) border.push(y * w);
    }if (maxX == w - 1) for (y = minY; y < maxY + 1; y++) {
      if (data[y * w + maxX] === 1) border.push(y * w + maxX);
    }if (minY == 0) for (x = minX; x < maxX + 1; x++) {
      if (data[x] === 1) border.push(x);
    }if (maxY == h - 1) for (x = minX; x < maxX + 1; x++) {
      if (data[maxY * w + x] === 1) border.push(maxY * w + x);
    }var result = [],
        // border points with radius-neighbors
    start,
        end,
        endX = radius + w,
        endY = radius + h,
        n = radius * 2 + 1; // size of the pattern for radius-neighbors (from -r to +r with the center point)

    len = border.length;
    // walk through radius-neighbors of border points and add them to the result array
    for (j = 0; j < len; j++) {
      k = border[j]; // index of the border point
      temp[k] = 1; // mark border point
      result.push(k); // save the border point
      x = k % w; // calc x by index
      y = (k - x) / w; // calc y by index
      start = radius - x > 0 ? radius - x : 0;
      end = endX - x < n ? endX - x : n; // Math.min((((w - 1) - x) + radius) + 1, n);
      k1 = k - radius;
      // walk through x-neighbors
      for (i = start; i < end; i++) {
        k2 = k1 + i;
        if (temp[k2] === 0) {
          // check the uniqueness
          temp[k2] = 1;
          result.push(k2);
        }
      }
      start = radius - y > 0 ? radius - y : 0;
      end = endY - y < n ? endY - y : n; // Math.min((((h - 1) - y) + radius) + 1, n);
      k1 = k - radius * w;
      // walk through y-neighbors
      for (i = start; i < end; i++) {
        k2 = k1 + i * w;
        if (temp[k2] === 0) {
          // check the uniqueness
          temp[k2] = 1;
          result.push(k2);
        }
      }
    }

    return result;
  };

  /** Apply the gauss-blur filter ONLY to border points with radius-neighbors
   * Algorithms: http://blog.ivank.net/fastest-gaussian-blur.html
   * http://www.librow.com/articles/article-9
   * http://elynxsdk.free.fr/ext-docs/Blur/Fast_box_blur.pdf
   * @param  {Object}     mask:     {Uint8Array} data, {int} width, {int} height, {Object} bounds
   * @param  {int}        radius:   blur radius
   * @param  {Uint8Array} visited:  mask of visited points (optional)
   * @return {Object}     mask:     {Uint8Array} data, {int} width, {int} height, {Object} bounds
   */
  lib.gaussBlurOnlyBorder = function (mask, radius, visited) {

    var border = createBorderForBlur(mask, radius, visited),
        // get border points with radius-neighbors
    ww,
        dsq,
        i,
        j,
        k,
        k1,
        x,
        y,
        val,
        start,
        end,
        n = radius * 2 + 1,
        // size of the pattern for radius-neighbors (from -r to +r with center point)
    s2 = 2 * radius * radius,
        wg = new Float32Array(n),
        // weights
    total = 0,
        // sum of weights(used for normalization)
    w = mask.width,
        h = mask.height,
        data = mask.data,
        minX = mask.bounds.minX,
        maxX = mask.bounds.maxX,
        minY = mask.bounds.minY,
        maxY = mask.bounds.maxY,
        len = border.length;

    // calc gauss weights
    for (i = 0; i < radius; i++) {
      dsq = (radius - i) * (radius - i);
      ww = Math.exp(-dsq / s2) / Math.PI;
      wg[radius + i] = wg[radius - i] = ww;
      total += 2 * ww;
    }
    // normalization weights
    for (i = 0; i < n; i++) {
      wg[i] /= total;
    }

    var result = new SelectionMask(w, h, data),
        // copy the source mask
    endX = radius + w,
        endY = radius + h;

    //walk through all border points for blur
    for (i = 0; i < len; i++) {
      k = border[i]; // index of the border point
      val = 0;
      x = k % w; // calc x by index
      y = (k - x) / w; // calc y by index
      start = radius - x > 0 ? radius - x : 0;
      end = endX - x < n ? endX - x : n; // Math.min((((w - 1) - x) + radius) + 1, n);
      k1 = k - radius;
      // walk through x-neighbors
      for (j = start; j < end; j++) {
        val += data[k1 + j] * wg[j];
      }
      if (val > 0.5) {
        result.data[k] = 1;
        result.count++;
        // check minmax
        if (x < minX) minX = x;
        if (x > maxX) maxX = x;
        if (y < minY) minY = y;
        if (y > maxY) maxY = y;
        continue;
      }
      start = radius - y > 0 ? radius - y : 0;
      end = endY - y < n ? endY - y : n; // Math.min((((h - 1) - y) + radius) + 1, n);
      k1 = k - radius * w;
      // walk through y-neighbors
      for (j = start; j < end; j++) {
        val += data[k1 + j * w] * wg[j];
      }
      if (val > 0.5) {
        result.data[k] = 1;
        result.count++;
        // check minmax
        if (x < minX) minX = x;
        if (x > maxX) maxX = x;
        if (y < minY) minY = y;
        if (y > maxY) maxY = y;
      } else {
        result.data[k] = 0;
      }
    }
    result.bounds = {
      minX: minX,
      minY: minY,
      maxX: maxX,
      maxY: maxY
    };

    return result;
  };

  /** Create a border mask (only boundary points)
   * @param {Object} mask: {Uint8Array} data, {int} width, {int} height, {Object} bounds
   * @return {Object} border mask: {Uint8Array} data, {int} width, {int} height, {Object} offset
   */
  lib.createBorderMask = function (mask) {

    var x,
        y,
        k,
        k1,
        k2,
        w = mask.width,
        h = mask.height,
        data = mask.data,
        minX = mask.bounds.minX,
        maxX = mask.bounds.maxX,
        minY = mask.bounds.minY,
        maxY = mask.bounds.maxY,
        rw = maxX - minX + 1,
        // bounds size
    rh = maxY - minY + 1,
        result = new Uint8Array(rw * rh),
        // reduced mask (bounds size)
    x0 = Math.max(minX, 1),
        x1 = Math.min(maxX, w - 2),
        y0 = Math.max(minY, 1),
        y1 = Math.min(maxY, h - 2),
        count = 0;

    // walk through inner values except points on the boundary of the image
    for (y = y0; y < y1 + 1; y++) {
      for (x = x0; x < x1 + 1; x++) {
        k = y * w + x;
        if (data[k] === 0) continue; // "white" point isn't the border
        k1 = k + w; // y + 1
        k2 = k - w; // y - 1
        // check if any neighbor with a "white" color
        if (data[k + 1] === 0 || data[k - 1] === 0 || data[k1] === 0 || data[k1 + 1] === 0 || data[k1 - 1] === 0 || data[k2] === 0 || data[k2 + 1] === 0 || data[k2 - 1] === 0) {
          //if (data[k + 1] + data[k - 1] +
          //    data[k1] + data[k1 + 1] + data[k1 - 1] +
          //    data[k2] + data[k2 + 1] + data[k2 - 1] == 8) continue;
          result[(y - minY) * rw + (x - minX)] = 1;
          count++;
        }
      }
    } // walk through points on the boundary of the image if necessary
    // if the "black" point is adjacent to the boundary of the image, it is a border point
    if (minX == 0) for (y = minY; y < maxY + 1; y++) {
      if (data[y * w] === 1) {
        result[(y - minY) * rw] = 1;
        count++;
      }
    }if (maxX == w - 1) for (y = minY; y < maxY + 1; y++) {
      if (data[y * w + maxX] === 1) {
        result[(y - minY) * rw + (maxX - minX)] = 1;
        count++;
      }
    }if (minY == 0) for (x = minX; x < maxX + 1; x++) {
      if (data[x] === 1) {
        result[x - minX] = 1;
        count++;
      }
    }if (maxY == h - 1) for (x = minX; x < maxX + 1; x++) {
      if (data[maxY * w + x] === 1) {
        result[(maxY - minY) * rw + (x - minX)] = 1;
        count++;
      }
    }return {
      count: count,
      data: result,
      width: rw,
      height: rh,
      offset: { x: minX, y: minY }
    };
  };

  /** Create a border index array of boundary points of the mask
   * @param {Object} mask: {Uint8Array} data, {int} width, {int} height
   * @return {Array} border index array boundary points of the mask
   */
  lib.getBorderIndices = function (mask) {

    var x,
        y,
        k,
        k1,
        k2,
        w = mask.width,
        h = mask.height,
        data = mask.data,
        border = [],
        // only border points
    x1 = w - 1,
        y1 = h - 1;

    // walk through inner values except points on the boundary of the image
    for (y = 1; y < y1; y++) {
      for (x = 1; x < x1; x++) {
        k = y * w + x;
        if (data[k] === 0) continue; // "white" point isn't the border
        k1 = k + w; // y + 1
        k2 = k - w; // y - 1
        // check if any neighbor with a "white" color
        if (data[k + 1] === 0 || data[k - 1] === 0 || data[k1] === 0 || data[k1 + 1] === 0 || data[k1 - 1] === 0 || data[k2] === 0 || data[k2 + 1] === 0 || data[k2 - 1] === 0) {
          //if (data[k + 1] + data[k - 1] +
          //    data[k1] + data[k1 + 1] + data[k1 - 1] +
          //    data[k2] + data[k2 + 1] + data[k2 - 1] == 8) continue;
          border.push(k);
        }
      }
    } // walk through points on the boundary of the image if necessary
    // if the "black" point is adjacent to the boundary of the image, it is a border point
    for (y = 0; y < h; y++) {
      if (data[y * w] === 1) border.push(y * w);
    }for (x = 0; x < w; x++) {
      if (data[x] === 1) border.push(x);
    }k = w - 1;
    for (y = 0; y < h; y++) {
      if (data[y * w + k] === 1) border.push(y * w + k);
    }k = (h - 1) * w;
    for (x = 0; x < w; x++) {
      if (data[k + x] === 1) border.push(k + x);
    }return border;
  };

  /** Create a compressed mask with a "white" border (1px border with zero values) for the contour tracing
   * @param {Object} mask: {Uint8Array} data, {int} width, {int} height, {Object} bounds
   * @return {Object} border mask: {Uint8Array} data, {int} width, {int} height, {Object} offset
   */
  function prepareMask(mask) {
    var x,
        y,
        w = mask.width,
        data = mask.data,
        minX = mask.bounds.minX,
        maxX = mask.bounds.maxX,
        minY = mask.bounds.minY,
        maxY = mask.bounds.maxY,
        rw = maxX - minX + 3,
        // bounds size +1 px on each side (a "white" border)
    rh = maxY - minY + 3,
        result = new Uint8Array(rw * rh); // reduced mask (bounds size)

    // walk through inner values and copy only "black" points to the result mask
    for (y = minY; y < maxY + 1; y++) {
      for (x = minX; x < maxX + 1; x++) {
        if (data[y * w + x] === 1) result[(y - minY + 1) * rw + (x - minX + 1)] = 1;
      }
    }return {
      data: result,
      width: rw,
      height: rh,
      offset: { x: minX - 1, y: minY - 1 }
    };
  };

  /** Create a contour array for the binary mask
   * Algorithm: http://www.sciencedirect.com/science/article/pii/S1077314203001401
   * @param {Object} mask: {Uint8Array} data, {int} width, {int} height, {Object} bounds
   * @return {Array} contours: {Array} points, {bool} inner, {int} label
   */
  lib.traceContours = function (mask) {
    var m = prepareMask(mask),
        contours = [],
        label = 0,
        w = m.width,
        w2 = w * 2,
        h = m.height,
        src = m.data,
        dx = m.offset.x,
        dy = m.offset.y,
        bounds,
        _p,
        dest = new Uint8Array(src),
        // label matrix
    i,
        j,
        x,
        y,
        k,
        k1,
        c,
        inner,
        dir,
        first,
        second,
        current,
        previous,
        next,
        d;

    // all [dx,dy] pairs (array index is the direction)
    // 5 6 7
    // 4 X 0
    // 3 2 1
    var directions = [[1, 0], [1, 1], [0, 1], [-1, 1], [-1, 0], [-1, -1], [0, -1], [1, -1]];

    for (y = 1; y < h - 1; y++) {
      for (x = 1; x < w - 1; x++) {
        k = y * w + x;
        if (src[k] === 1) {
          for (i = -w; i < w2; i += w2) {
            // k - w: outer tracing (y - 1), k + w: inner tracing (y + 1)
            if (src[k + i] === 0 && dest[k + i] === 0) {
              // need contour tracing
              inner = i === w; // is inner contour tracing ?
              label++; // label for the next contour

              c = [];
              bounds = {
                minX: w,
                minY: h,
                maxX: -1,
                maxY: -1
              };
              dir = inner ? 2 : 6; // start direction
              current = previous = first = { x: x, y: y };
              second = null;
              while (true) {
                dest[current.y * w + current.x] = label; // mark label for the current point
                // bypass all the neighbors around the current point in a clockwise
                for (j = 0; j < 8; j++) {
                  dir = (dir + 1) % 8;

                  // get the next point by new direction
                  d = directions[dir]; // index as direction
                  next = { x: current.x + d[0], y: current.y + d[1] };

                  k1 = next.y * w + next.x;
                  if (src[k1] === 1) // black boundary pixel
                    {
                      dest[k1] = label; // mark a label
                      break;
                    }
                  dest[k1] = -1; // mark a white boundary pixel
                  next = null;
                }
                if (next === null) break; // no neighbours (one-point contour)
                current = next;
                if (second) {
                  if (previous.x === first.x && previous.y === first.y && current.x === second.x && current.y === second.y) {
                    break; // creating the contour completed when returned to original position
                  }
                } else {
                  second = next;
                }
                _p = { x: previous.x + dx, y: previous.y + dy };
                if (bounds.minX > _p.x) bounds.minX = _p.x;
                if (bounds.maxX < _p.x) bounds.maxX = _p.x;
                if (bounds.minY > _p.y) bounds.minY = _p.y;
                if (bounds.maxY < _p.y) bounds.maxY = _p.y;
                c.push(_p);
                previous = current;
                dir = (dir + 4) % 8; // next dir (symmetrically to the current direction)
              }

              if (next != null) {
                _p = { x: first.x + dx, y: first.y + dy };
                if (bounds.minX > _p.x) bounds.minX = _p.x;
                if (bounds.maxX < _p.x) bounds.maxX = _p.x;
                if (bounds.minY > _p.y) bounds.minY = _p.y;
                if (bounds.maxY < _p.y) bounds.maxY = _p.y;
                c.push(_p); // close the contour
                contours.push({ inner: inner, label: label, points: c, bounds: bounds }); // add contour to the list
              }
            }
          }
        }
      }
    }return contours;
  };

  function rgbToHsl(r, g, b) {
    r /= 255, g /= 255, b /= 255;
    var max = Math.max(r, g, b),
        min = Math.min(r, g, b);
    var h,
        s,
        l = (max + min) / 2;

    if (max == min) {
      h = s = 0; // achromatic
    } else {
      var d = max - min;
      s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
      switch (max) {
        case r:
          h = (g - b) / d + (g < b ? 6 : 0);break;
        case g:
          h = (b - r) / d + 2;break;
        case b:
          h = (r - g) / d + 4;break;
      }
      h /= 6;
    }

    return [h * 255, s * 255, l * 255];
  }

  lib.simplifyContour = function (c, simplifyTolerant, simplifyCount) {
    var i, j, k, c, points, len, resPoints, lst, stack, ids, maxd, maxi, dist, r1, r2, r12, dx, dy, pi, pf, pl;

    points = c.points;
    len = c.points.length;

    if (len < simplifyCount) {
      // contour isn't simplified
      resPoints = [];
      for (k = 0; k < len; k++) {
        resPoints.push({ x: points[k].x, y: points[k].y });
      }
      return {
        bounds: c.bounds, inner: c.inner, label: c.label, points: resPoints, initialCount: len };
    }

    lst = [0, len - 1]; // always add first and last points
    stack = [{ first: 0, last: len - 1 }]; // first processed edge

    do {
      ids = stack.shift();
      if (ids.last <= ids.first + 1) // no intermediate points
        {
          continue;
        }

      maxd = -1.0; // max distance from point to current edge
      maxi = ids.first; // index of maximally distant point

      for (i = ids.first + 1; i < ids.last; i++) // bypass intermediate points in edge
      {
        // calc the distance from current point to edge
        pi = points[i];
        pf = points[ids.first];
        pl = points[ids.last];
        dx = pi.x - pf.x;
        dy = pi.y - pf.y;
        r1 = Math.sqrt(dx * dx + dy * dy);
        dx = pi.x - pl.x;
        dy = pi.y - pl.y;
        r2 = Math.sqrt(dx * dx + dy * dy);
        dx = pf.x - pl.x;
        dy = pf.y - pl.y;
        r12 = Math.sqrt(dx * dx + dy * dy);
        if (r1 >= Math.sqrt(r2 * r2 + r12 * r12)) dist = r2;else if (r2 >= Math.sqrt(r1 * r1 + r12 * r12)) dist = r1;else dist = Math.abs((dy * pi.x - dx * pi.y + pf.x * pl.y - pl.x * pf.y) / r12);

        if (dist > maxd) {
          maxi = i; // save the index of maximally distant point
          maxd = dist;
        }
      }

      if (maxd > simplifyTolerant) // if the max "deviation" is larger than allowed then...
        {
          lst.push(maxi); // add index to the simplified list
          stack.push({ first: ids.first, last: maxi }); // add the left part for processing
          stack.push({ first: maxi, last: ids.last }); // add the right part for processing
        }
    } while (stack.length > 0);

    resPoints = [];
    len = lst.length;
    lst.sort(function (a, b) {
      return a - b;
    }); // restore index order
    for (k = 0; k < len; k++) {
      resPoints.push({ x: points[lst[k]].x, y: points[lst[k]].y }); // add result points to the correct order
    }
    return {
      bounds: c.bounds,
      inner: c.inner, label: c.label, points: resPoints, initialCount: c.points.length
    };
  };

  /** Simplify contours
   * Algorithms: http://psimpl.sourceforge.net/douglas-peucker.html
   * http://neerc.ifmo.ru/wiki/index.php?title=%D0%A3%D0%BF%D1%80%D0%BE%D1%89%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BF%D0%BE%D0%BB%D0%B8%D0%B3%D0%BE%D0%BD%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D0%B9_%D1%86%D0%B5%D0%BF%D0%B8
   * @param {Array} contours: {Array} points, {bool} inner, {int} label
   * @param {float} simplify tolerant
   * @param {int} simplify count: min number of points when the contour is simplified
   * @return {Array} contours: {Array} points, {bool} inner, {int} label, {int} initialCount
   */
  lib.simplifyContours = function (contours, simplifyTolerant, simplifyCount) {
    var lenContours = contours.length,
        result = [];

    // walk through all contours
    for (var j = 0; j < lenContours; j++) {

      result.push(lib.simplifyContour(contours[j], simplifyTolerant, simplifyCount));
    }

    return result;
  };

  return lib;
}();
if (true) {
  module.exports = MagicWand;
}
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 12 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.StrokeMixin = {
  shape: {
    strokeWidthFull: 0,
    strokeWidthEmpty: 2,
    strokeWidthActive: 2,
    strokeDashArray: [5, 5],
    fill: "transparent",
    strokeEmpty: "red",
    strokeFull: "red",
    strokeActive: "green"
  },
  setShape: function setShape(el, cb) {

    el = fabric.util.object.extend({
      strokeWidthFull: this.shape.strokeWidthFull,
      strokeWidthEmpty: this.shape.strokeWidthEmpty,
      strokeWidthActive: this.shape.strokeWidthActive,
      dashArray: this.shape.dashArray,
      strokeEmpty: this.shape.strokeEmpty,
      strokeFull: this.shape.strokeFull,
      strokeActive: this.shape.strokeActive
    }, el);

    var _this = this;
    if (el && el.src && !el.paths) {
      fabric.loadSVGFromURL(el.src, function (paths, options) {
        el.paths = paths;
        fabric.util.object.extend(el, options);
        _this._set_shape(el);
        _this.add(_this._fabric_shape);
        _this._apply_shape();
        cb && cb();
      });
    } else {
      _this._set_shape(el);
      _this.add(_this._fabric_shape);
      _this._apply_shape();
      cb && cb();
    }
  },
  initShape: function initShape(options) {

    var _shapeOptions = fabric.util.object.extend(options.shape || {}, this.shape);

    this._fabric_shape = new fabric.Rect(fabric.util.object.extend({}, _shapeOptions, {
      width: options.width,
      height: options.height,
      stroke: _shapeOptions.strokeEmpty,
      strokeWidth: _shapeOptions.strokeWidthEmpty
    }));
  },

  /**
   * �������������� ����� �� ������� ������� ����
   * @private
   */
  _apply_shape: function _apply_shape() {
    var shape = this.shape;

    var _off = shape && shape.offsets;

    if (!_off) {
      _off = [0, 0, 0, 0];
    }

    var _off_units = shape && shape.offsets_units;

    if (!_off_units) {
      //if (frame.border_image) {todo
      //    _off_units = frame.border_image.width_units || [0, 0, 0, 0];
      //} else {
      _off_units = [1, 1, 1, 1];
      //}
    }

    /*else if(shape.offsets && shape.offsets_units){
     var s = this.slide.scaleValue;
     this._fabric_shape = new fabric.Rect({
     originX: 'center',
     originY: 'center',
     width:  (this.data.geometry.width - shape.offsets[3] - shape.offsets[1]) * s,
     height: (this.data.geometry.height -shape.offsets[0] - shape.offsets[2]) * s
     });*/

    _off = {
      top: _off[0] * (_off_units[0] ? this.height / 100 : 1) || 0,
      right: _off[1] * (_off_units[1] ? this.width / 100 : 1) || 0,
      bottom: _off[2] * (_off_units[2] ? this.height / 100 : 1) || 0,
      left: _off[3] * (_off_units[3] ? this.width / 100 : 1) || 0
    };

    var _w = this.width - _off.left - _off.right; // *this.slide.scaleValue;
    var _h = this.height - _off.top - _off.bottom; // *this.slide.scaleValue;


    //if(this.resources.frame.data.shape && this.resources.frame.data.shape.radius){
    //
    //    this._fabric_shape.set({
    //        left: -this.width/2  + _off.left ,
    //        top:  -this.height/2 + _off.top ,
    //        width: _w - _off.left -_off.right,
    //        height:  _h - _off.top -_off.bottom,
    //        scaleX:  1,
    //        scaleY:  1
    //    });
    //}else{


    if (this.shape.path || this.shape.paths || this.shape.offsets) {
      var _sw = this.shape.width || this._fabric_shape.width;
      var _sh = this.shape.height || this._fabric_shape.height;

      if (this._fabric_shape.strokeWidth) {
        _sw += this._fabric_shape.strokeWidth;
        _sh += this._fabric_shape.strokeWidth;
      }

      var options = {
        left: -this.width / 2 + _off.left,
        top: -this.height / 2 + _off.top,
        scaleX: _w / 100 / (_sw / 100), // * (shape.scaleX || 1),
        scaleY: _h / 100 / (_sh / 100), // * (shape.scaleY || 1)
        angle: 0
      };
    } else {
      var options = {
        left: -this.width / 2 + _off.left,
        top: -this.height / 2 + _off.top,
        width: _w, // * (shape.scaleX || 1),
        height: _h, // * (shape.scaleY || 1)
        angle: 0
      };
    }

    this._fabric_shape.set(options);

    this.updateStroke();
    this.canvas && this.canvas.renderAll();
  },
  _set_shape: function _set_shape(shape) {

    if (this._fabric_shape) {
      this.remove(this._fabric_shape);
      delete this._fabric_shape;
    }
    var _fabric_shape;
    var _options = {
      fill: "transparent",
      strokeDashArray: this.shape.dashArray
    };

    this.shape = shape;

    if (!shape) {
      _fabric_shape = new fabric.Rect({
        width: this.width,
        height: this.height
      });
      _fabric_shape.set(_options);
    } else if (shape.paths) {

      for (var i in shape.paths) {
        shape.paths[i].set(_options);
      }

      _fabric_shape = fabric.util.groupSVGElements(shape.paths, shape);
      //this._objects.unshift(this._objects.pop());
    } else {
      var path;

      if (shape.radius) {
        path = fabric.util.getRadiusClipPath(shape.radius, shape.radius_units, this.width, this.height);
        _fabric_shape = new fabric.Path(path, _options);
      } else if (shape.path) {
        _fabric_shape = new fabric.Path(shape.path, _options);
        //} else if(shape.offsets){
        //  path = fabric.util.getOffsetsClipPath(shape.offsets, shape.offsets_units)
      } else {
        path = 'M 0 0 L {width} 0 L {width} {height} L 0 {height} z'.format(fabric.util.object.extend({
          width: 100,
          height: 100
        }, shape));

        _fabric_shape = new fabric.Path(path, _options);
        //
        //_fabric_shape =  new fabric.Rect(fabric.util.object.extend({
        //  width:            100,
        //  height:           100
        //},shape));
      }
    }

    _fabric_shape.set({
      scaleX: this.width / _fabric_shape.width,
      scaleY: this.height / _fabric_shape.height,
      perPixelTargetFind: true,
      selectable: false,
      originX: "left",
      originY: "top"
    });

    this._fabric_shape = _fabric_shape;

    if (this.element) {
      this.element.clipTo = this._fabric_shape;
    }

    this.updateStroke();
  },

  updateStroke: function updateStroke() {

    var _stroke = this.shape.stroke;
    var _sw = 0;
    if ((this._activated || this._clipmode) && this.shape.strokeWidthActive) {
      _sw = this.shape.strokeWidthActive;
    } else if (this.element && this.shape.strokeWidthFull) {
      _sw = this.shape.strokeWidthFull;
    } else if (!this.element && this.shape.strokeWidthEmpty) {
      _sw = this.shape.strokeWidthEmpty;
    }
    if ((this._activated || this._clipmode) && this.shape.strokeActive) {
      _stroke = this.shape.strokeActive;
    } else if (this.element && this.shape.strokeFull) {
      _stroke = this.shape.strokeFull;
    } else if (!this.element && this.shape.strokeEmpty) {
      _stroke = this.shape.strokeEmpty;
    }

    var _strokeWidth = _sw / Math.max(this._fabric_shape.scaleX, this._fabric_shape.scaleY);

    if (this.shape) {
      if (this.shape.paths) {
        for (var i in this._fabric_shape.paths) {
          this._fabric_shape.paths[i].setStrokeWidth(_strokeWidth);
          this._fabric_shape.paths[i].setStroke(_stroke);
        }
      } else {
        this._fabric_shape.setStrokeWidth(_strokeWidth);
        this._fabric_shape.setStroke(_stroke);
      }
    }
  },
  /**
   * кобъект готовится к замену фото
   */
  activate: function activate() {
    this._activated = true;
    this._fabric_shape.setOpacity(1);
    this.updateStroke();
    this.canvas.renderAll();
  },
  /**
   * кобъект не готовится к замену фото
   */
  deactivate: function deactivate() {
    this._activated = false;
    this.updateStroke();
    this.canvas.renderAll();
  }
};
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 13 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

/**
  A javascript Bezier curve library by Pomax.

  Based on http://pomax.github.io/bezierinfo

  This code is MIT licensed.
**/
var Bezier = function () {
  "use strict";

  // math-inlining.

  var abs = Math.abs,
      min = Math.min,
      max = Math.max,
      acos = Math.acos,
      sqrt = Math.sqrt,
      pi = Math.PI,

  // a zero coordinate, which is surprisingly useful
  ZERO = { x: 0, y: 0, z: 0 };

  // math-inlining.
  var abs = Math.abs,
      cos = Math.cos,
      sin = Math.sin,
      acos = Math.acos,
      atan2 = Math.atan2,
      sqrt = Math.sqrt,
      pow = Math.pow,

  // cube root function yielding real roots
  crt = function crt(v) {
    return v < 0 ? -pow(-v, 1 / 3) : pow(v, 1 / 3);
  },

  // trig constants
  pi = Math.PI,
      tau = 2 * pi,
      quart = pi / 2,

  // float precision significant decimal
  epsilon = 0.000001;

  // Bezier utility functions
  var utils = {
    // Legendre-Gauss abscissae with n=24 (x_i values, defined at i=n as the roots of the nth order Legendre polynomial Pn(x))
    Tvalues: [-0.0640568928626056260850430826247450385909, 0.0640568928626056260850430826247450385909, -0.1911188674736163091586398207570696318404, 0.1911188674736163091586398207570696318404, -0.3150426796961633743867932913198102407864, 0.3150426796961633743867932913198102407864, -0.4337935076260451384870842319133497124524, 0.4337935076260451384870842319133497124524, -0.5454214713888395356583756172183723700107, 0.5454214713888395356583756172183723700107, -0.6480936519369755692524957869107476266696, 0.6480936519369755692524957869107476266696, -0.7401241915785543642438281030999784255232, 0.7401241915785543642438281030999784255232, -0.8200019859739029219539498726697452080761, 0.8200019859739029219539498726697452080761, -0.8864155270044010342131543419821967550873, 0.8864155270044010342131543419821967550873, -0.9382745520027327585236490017087214496548, 0.9382745520027327585236490017087214496548, -0.9747285559713094981983919930081690617411, 0.9747285559713094981983919930081690617411, -0.9951872199970213601799974097007368118745, 0.9951872199970213601799974097007368118745],
    // Legendre-Gauss weights with n=24 (w_i values, defined by a function linked to in the Bezier primer article)
    Cvalues: [0.1279381953467521569740561652246953718517, 0.1279381953467521569740561652246953718517, 0.1258374563468282961213753825111836887264, 0.1258374563468282961213753825111836887264, 0.1216704729278033912044631534762624256070, 0.1216704729278033912044631534762624256070, 0.1155056680537256013533444839067835598622, 0.1155056680537256013533444839067835598622, 0.1074442701159656347825773424466062227946, 0.1074442701159656347825773424466062227946, 0.0976186521041138882698806644642471544279, 0.0976186521041138882698806644642471544279, 0.0861901615319532759171852029837426671850, 0.0861901615319532759171852029837426671850, 0.0733464814110803057340336152531165181193, 0.0733464814110803057340336152531165181193, 0.0592985849154367807463677585001085845412, 0.0592985849154367807463677585001085845412, 0.0442774388174198061686027482113382288593, 0.0442774388174198061686027482113382288593, 0.0285313886289336631813078159518782864491, 0.0285313886289336631813078159518782864491, 0.0123412297999871995468056670700372915759, 0.0123412297999871995468056670700372915759],
    arcfn: function arcfn(t, derivativeFn) {
      var d = derivativeFn(t);
      var l = d.x * d.x + d.y * d.y;
      if (typeof d.z !== "undefined") {
        l += d.z * d.z;
      }
      return sqrt(l);
    },

    between: function between(v, m, M) {
      return m <= v && v <= M || utils.approximately(v, m) || utils.approximately(v, M);
    },

    approximately: function approximately(a, b, precision) {
      return abs(a - b) <= (precision || epsilon);
    },
    length: function length(derivativeFn) {
      var z = 0.5,
          sum = 0,
          len = utils.Tvalues.length,
          i,
          t;
      for (i = 0; i < len; i++) {
        t = z * utils.Tvalues[i] + z;
        sum += utils.Cvalues[i] * utils.arcfn(t, derivativeFn);
      }
      return z * sum;
    },

    map: function map(v, ds, de, ts, te) {
      var d1 = de - ds,
          d2 = te - ts,
          v2 = v - ds,
          r = v2 / d1;
      return ts + d2 * r;
    },

    lerp: function lerp(r, v1, v2) {
      var ret = {
        x: v1.x + r * (v2.x - v1.x),
        y: v1.y + r * (v2.y - v1.y)
      };
      if (!!v1.z && !!v2.z) {
        ret.z = v1.z + r * (v2.z - v1.z);
      }
      return ret;
    },

    pointToString: function pointToString(p) {
      var s = p.x + "/" + p.y;
      if (typeof p.z !== "undefined") {
        s += "/" + p.z;
      }
      return s;
    },

    pointsToString: function pointsToString(points) {
      return "[" + points.map(utils.pointToString).join(", ") + "]";
    },

    copy: function copy(obj) {
      return JSON.parse(JSON.stringify(obj));
    },

    angle: function angle(o, v1, v2) {
      var dx1 = v1.x - o.x,
          dy1 = v1.y - o.y,
          dx2 = v2.x - o.x,
          dy2 = v2.y - o.y,
          cross = dx1 * dy2 - dy1 * dx2,
          m1 = sqrt(dx1 * dx1 + dy1 * dy1),
          m2 = sqrt(dx2 * dx2 + dy2 * dy2),
          dot;
      dx1 /= m1;dy1 /= m1;dx2 /= m2;dy2 /= m2;
      dot = dx1 * dx2 + dy1 * dy2;
      return atan2(cross, dot);
    },

    // round as string, to avoid rounding errors
    round: function round(v, d) {
      var s = '' + v;
      var pos = s.indexOf(".");
      return parseFloat(s.substring(0, pos + 1 + d));
    },

    dist: function dist(p1, p2) {
      var dx = p1.x - p2.x,
          dy = p1.y - p2.y;
      return sqrt(dx * dx + dy * dy);
    },

    closest: function closest(LUT, point) {
      var mdist = pow(2, 63),
          mpos,
          d;
      LUT.forEach(function (p, idx) {
        d = utils.dist(point, p);
        if (d < mdist) {
          mdist = d;
          mpos = idx;
        }
      });
      return { mdist: mdist, mpos: mpos };
    },

    abcratio: function abcratio(t, n) {
      // see ratio(t) note on http://pomax.github.io/bezierinfo/#abc
      if (n !== 2 && n !== 3) {
        return false;
      }
      if (typeof t === "undefined") {
        t = 0.5;
      } else if (t === 0 || t === 1) {
        return t;
      }
      var bottom = pow(t, n) + pow(1 - t, n),
          top = bottom - 1;
      return abs(top / bottom);
    },

    projectionratio: function projectionratio(t, n) {
      // see u(t) note on http://pomax.github.io/bezierinfo/#abc
      if (n !== 2 && n !== 3) {
        return false;
      }
      if (typeof t === "undefined") {
        t = 0.5;
      } else if (t === 0 || t === 1) {
        return t;
      }
      var top = pow(1 - t, n),
          bottom = pow(t, n) + top;
      return top / bottom;
    },

    lli8: function lli8(x1, y1, x2, y2, x3, y3, x4, y4) {
      var nx = (x1 * y2 - y1 * x2) * (x3 - x4) - (x1 - x2) * (x3 * y4 - y3 * x4),
          ny = (x1 * y2 - y1 * x2) * (y3 - y4) - (y1 - y2) * (x3 * y4 - y3 * x4),
          d = (x1 - x2) * (y3 - y4) - (y1 - y2) * (x3 - x4);
      if (d == 0) {
        return false;
      }
      return { x: nx / d, y: ny / d };
    },

    lli4: function lli4(p1, p2, p3, p4) {
      var x1 = p1.x,
          y1 = p1.y,
          x2 = p2.x,
          y2 = p2.y,
          x3 = p3.x,
          y3 = p3.y,
          x4 = p4.x,
          y4 = p4.y;
      return utils.lli8(x1, y1, x2, y2, x3, y3, x4, y4);
    },

    lli: function lli(v1, v2) {
      return utils.lli4(v1, v1.c, v2, v2.c);
    },

    makeline: function makeline(p1, p2) {
      var x1 = p1.x,
          y1 = p1.y,
          x2 = p2.x,
          y2 = p2.y,
          dx = (x2 - x1) / 3,
          dy = (y2 - y1) / 3;
      return new Bezier(x1, y1, x1 + dx, y1 + dy, x1 + 2 * dx, y1 + 2 * dy, x2, y2);
    },

    findbbox: function findbbox(sections) {
      var mx = 99999999,
          my = mx,
          MX = -mx,
          MY = MX;
      sections.forEach(function (s) {
        var bbox = s.bbox();
        if (mx > bbox.x.min) mx = bbox.x.min;
        if (my > bbox.y.min) my = bbox.y.min;
        if (MX < bbox.x.max) MX = bbox.x.max;
        if (MY < bbox.y.max) MY = bbox.y.max;
      });
      return {
        x: { min: mx, mid: (mx + MX) / 2, max: MX, size: MX - mx },
        y: { min: my, mid: (my + MY) / 2, max: MY, size: MY - my }
      };
    },

    shapeintersections: function shapeintersections(s1, bbox1, s2, bbox2) {
      if (!utils.bboxoverlap(bbox1, bbox2)) return [];
      var intersections = [];
      var a1 = [s1.startcap, s1.forward, s1.back, s1.endcap];
      var a2 = [s2.startcap, s2.forward, s2.back, s2.endcap];
      a1.forEach(function (l1) {
        if (l1.virtual) return;
        a2.forEach(function (l2) {
          if (l2.virtual) return;
          var iss = l1.intersects(l2);
          if (iss.length > 0) {
            iss.c1 = l1;
            iss.c2 = l2;
            iss.s1 = s1;
            iss.s2 = s2;
            intersections.push(iss);
          }
        });
      });
      return intersections;
    },

    makeshape: function makeshape(forward, back) {
      var bpl = back.points.length;
      var fpl = forward.points.length;
      var start = utils.makeline(back.points[bpl - 1], forward.points[0]);
      var end = utils.makeline(forward.points[fpl - 1], back.points[0]);
      var shape = {
        startcap: start,
        forward: forward,
        back: back,
        endcap: end,
        bbox: utils.findbbox([start, forward, back, end])
      };
      var self = utils;
      shape.intersections = function (s2) {
        return self.shapeintersections(shape, shape.bbox, s2, s2.bbox);
      };
      return shape;
    },

    getminmax: function getminmax(curve, d, list) {
      if (!list) return { min: 0, max: 0 };
      var min = 0xFFFFFFFFFFFFFFFF,
          max = -min,
          t,
          c;
      if (list.indexOf(0) === -1) {
        list = [0].concat(list);
      }
      if (list.indexOf(1) === -1) {
        list.push(1);
      }
      for (var i = 0, len = list.length; i < len; i++) {
        t = list[i];
        c = curve.get(t);
        if (c[d] < min) {
          min = c[d];
        }
        if (c[d] > max) {
          max = c[d];
        }
      }
      return { min: min, mid: (min + max) / 2, max: max, size: max - min };
    },

    align: function align(points, line) {
      var tx = line.p1.x,
          ty = line.p1.y,
          a = -atan2(line.p2.y - ty, line.p2.x - tx),
          d = function d(v) {
        return {
          x: (v.x - tx) * cos(a) - (v.y - ty) * sin(a),
          y: (v.x - tx) * sin(a) + (v.y - ty) * cos(a)
        };
      };
      return points.map(d);
    },

    roots: function roots(points, line) {
      line = line || { p1: { x: 0, y: 0 }, p2: { x: 1, y: 0 } };
      var order = points.length - 1;
      var p = utils.align(points, line);
      var reduce = function reduce(t) {
        return 0 <= t && t <= 1;
      };

      if (order === 2) {
        var a = p[0].y,
            b = p[1].y,
            c = p[2].y,
            d = a - 2 * b + c;
        if (d !== 0) {
          var m1 = -sqrt(b * b - a * c),
              m2 = -a + b,
              v1 = -(m1 + m2) / d,
              v2 = -(-m1 + m2) / d;
          return [v1, v2].filter(reduce);
        } else if (b !== c && d === 0) {
          return [(2 * b - c) / 2 * (b - c)].filter(reduce);
        }
        return [];
      }

      // see http://www.trans4mind.com/personal_development/mathematics/polynomials/cubicAlgebra.htm
      var pa = p[0].y,
          pb = p[1].y,
          pc = p[2].y,
          pd = p[3].y,
          d = -pa + 3 * pb - 3 * pc + pd,
          a = (3 * pa - 6 * pb + 3 * pc) / d,
          b = (-3 * pa + 3 * pb) / d,
          c = pa / d,
          p = (3 * b - a * a) / 3,
          p3 = p / 3,
          q = (2 * a * a * a - 9 * a * b + 27 * c) / 27,
          q2 = q / 2,
          discriminant = q2 * q2 + p3 * p3 * p3,
          u1,
          v1,
          x1,
          x2,
          x3;
      if (discriminant < 0) {
        var mp3 = -p / 3,
            mp33 = mp3 * mp3 * mp3,
            r = sqrt(mp33),
            t = -q / (2 * r),
            cosphi = t < -1 ? -1 : t > 1 ? 1 : t,
            phi = acos(cosphi),
            crtr = crt(r),
            t1 = 2 * crtr;
        x1 = t1 * cos(phi / 3) - a / 3;
        x2 = t1 * cos((phi + tau) / 3) - a / 3;
        x3 = t1 * cos((phi + 2 * tau) / 3) - a / 3;
        return [x1, x2, x3].filter(reduce);
      } else if (discriminant === 0) {
        u1 = q2 < 0 ? crt(-q2) : -crt(q2);
        x1 = 2 * u1 - a / 3;
        x2 = -u1 - a / 3;
        return [x1, x2].filter(reduce);
      } else {
        var sd = sqrt(discriminant);
        u1 = crt(-q2 + sd);
        v1 = crt(q2 + sd);
        return [u1 - v1 - a / 3].filter(reduce);;
      }
    },

    droots: function droots(p) {
      // quadratic roots are easy
      if (p.length === 3) {
        var a = p[0],
            b = p[1],
            c = p[2],
            d = a - 2 * b + c;
        if (d !== 0) {
          var m1 = -sqrt(b * b - a * c),
              m2 = -a + b,
              v1 = -(m1 + m2) / d,
              v2 = -(-m1 + m2) / d;
          return [v1, v2];
        } else if (b !== c && d === 0) {
          return [(2 * b - c) / (2 * (b - c))];
        }
        return [];
      }

      // linear roots are even easier
      if (p.length === 2) {
        var a = p[0],
            b = p[1];
        if (a !== b) {
          return [a / (a - b)];
        }
        return [];
      }
    },

    inflections: function inflections(points) {
      var p = utils.align(points, { p1: points[0], p2: points[3] }),
          a = p[2].x * p[1].y,
          b = p[3].x * p[1].y,
          c = p[1].x * p[2].y,
          d = p[3].x * p[2].y,
          v1 = 18 * (-3 * a + 2 * b + 3 * c - d),
          v2 = 18 * (3 * a - b - 3 * c),
          v3 = 18 * (c - a);

      if (utils.approximately(v1, 0)) return [];

      var trm = v2 * v2 - 4 * v1 * v3,
          sq = Math.sqrt(trm),
          d = 2 * v1;

      if (utils.approximately(d, 0)) return [];

      return [(sq - v2) / d, -(v2 + sq) / d].filter(function (r) {
        return 0 <= r && r <= 1;
      });
    },

    bboxoverlap: function bboxoverlap(b1, b2) {
      var dims = ['x', 'y'],
          len = dims.length,
          i,
          dim,
          l,
          t,
          d;
      for (i = 0; i < len; i++) {
        dim = dims[i];
        l = b1[dim].mid;
        t = b2[dim].mid;
        d = (b1[dim].size + b2[dim].size) / 2;
        if (abs(l - t) >= d) return false;
      }
      return true;
    },

    expandbox: function expandbox(bbox, _bbox) {
      if (_bbox.x.min < bbox.x.min) {
        bbox.x.min = _bbox.x.min;
      }
      if (_bbox.y.min < bbox.y.min) {
        bbox.y.min = _bbox.y.min;
      }
      if (_bbox.z && _bbox.z.min < bbox.z.min) {
        bbox.z.min = _bbox.z.min;
      }
      if (_bbox.x.max > bbox.x.max) {
        bbox.x.max = _bbox.x.max;
      }
      if (_bbox.y.max > bbox.y.max) {
        bbox.y.max = _bbox.y.max;
      }
      if (_bbox.z && _bbox.z.max > bbox.z.max) {
        bbox.z.max = _bbox.z.max;
      }
      bbox.x.mid = (bbox.x.min + bbox.x.max) / 2;
      bbox.y.mid = (bbox.y.min + bbox.y.max) / 2;
      if (bbox.z) {
        bbox.z.mid = (bbox.z.min + bbox.z.max) / 2;
      }
      bbox.x.size = bbox.x.max - bbox.x.min;
      bbox.y.size = bbox.y.max - bbox.y.min;
      if (bbox.z) {
        bbox.z.size = bbox.z.max - bbox.z.min;
      }
    },

    pairiteration: function pairiteration(c1, c2) {
      var c1b = c1.bbox(),
          c2b = c2.bbox(),
          r = 100000,
          threshold = 0.5;
      if (c1b.x.size + c1b.y.size < threshold && c2b.x.size + c2b.y.size < threshold) {
        return [(r * (c1._t1 + c1._t2) / 2 | 0) / r + "/" + (r * (c2._t1 + c2._t2) / 2 | 0) / r];
      }
      var cc1 = c1.split(0.5),
          cc2 = c2.split(0.5),
          pairs = [{ left: cc1.left, right: cc2.left }, { left: cc1.left, right: cc2.right }, { left: cc1.right, right: cc2.right }, { left: cc1.right, right: cc2.left }];
      pairs = pairs.filter(function (pair) {
        return utils.bboxoverlap(pair.left.bbox(), pair.right.bbox());
      });
      var results = [];
      if (pairs.length === 0) return results;
      pairs.forEach(function (pair) {
        results = results.concat(utils.pairiteration(pair.left, pair.right));
      });
      results = results.filter(function (v, i) {
        return results.indexOf(v) === i;
      });
      return results;
    },

    getccenter: function getccenter(p1, p2, p3) {
      var dx1 = p2.x - p1.x,
          dy1 = p2.y - p1.y,
          dx2 = p3.x - p2.x,
          dy2 = p3.y - p2.y;
      var dx1p = dx1 * cos(quart) - dy1 * sin(quart),
          dy1p = dx1 * sin(quart) + dy1 * cos(quart),
          dx2p = dx2 * cos(quart) - dy2 * sin(quart),
          dy2p = dx2 * sin(quart) + dy2 * cos(quart);
      // chord midpoints
      var mx1 = (p1.x + p2.x) / 2,
          my1 = (p1.y + p2.y) / 2,
          mx2 = (p2.x + p3.x) / 2,
          my2 = (p2.y + p3.y) / 2;
      // midpoint offsets
      var mx1n = mx1 + dx1p,
          my1n = my1 + dy1p,
          mx2n = mx2 + dx2p,
          my2n = my2 + dy2p;
      // intersection of these lines:
      var arc = utils.lli8(mx1, my1, mx1n, my1n, mx2, my2, mx2n, my2n),
          r = utils.dist(arc, p1),

      // arc start/end values, over mid point:
      s = atan2(p1.y - arc.y, p1.x - arc.x),
          m = atan2(p2.y - arc.y, p2.x - arc.x),
          e = atan2(p3.y - arc.y, p3.x - arc.x),
          _;
      // determine arc direction (cw/ccw correction)
      if (s < e) {
        // if s<m<e, arc(s, e)
        // if m<s<e, arc(e, s + tau)
        // if s<e<m, arc(e, s + tau)
        if (s > m || m > e) {
          s += tau;
        }
        if (s > e) {
          _ = e;e = s;s = _;
        }
      } else {
        // if e<m<s, arc(e, s)
        // if m<e<s, arc(s, e + tau)
        // if e<s<m, arc(s, e + tau)
        if (e < m && m < s) {
          _ = e;e = s;s = _;
        } else {
          e += tau;
        }
      }
      // assign and done.
      arc.s = s;
      arc.e = e;
      arc.r = r;
      return arc;
    }
  };

  /**
   * Poly Bezier
   * @param {[type]} curves [description]
   */
  var PolyBezier = function PolyBezier(curves) {
    this.curves = [];
    this._3d = false;
    if (!!curves) {
      this.curves = curves;
      this._3d = this.curves[0]._3d;
    }
  };

  PolyBezier.prototype = {
    valueOf: function valueOf() {
      return this.toString();
    },
    toString: function toString() {
      return utils.pointsToString(this.points);
    },
    addCurve: function addCurve(curve) {
      this.curves.push(curve);
      this._3d = this._3d || curve._3d;
    },
    length: function length() {
      return this.curves.map(function (v) {
        return v.length();
      }).reduce(function (a, b) {
        return a + b;
      });
    },
    curve: function curve(idx) {
      return this.curves[idx];
    },
    bbox: function bbox() {
      var c = this.curves;
      var bbox = c[0].bbox();
      for (var i = 1; i < c.length; i++) {
        utils.expandbox(bbox, c[i].bbox());
      }
      return bbox;
    },
    offset: function offset(d) {
      var offset = [];
      this.curves.forEach(function (v) {
        offset = offset.concat(v.offset(d));
      });
      return new PolyBezier(offset);
    }
  };

  /**
   * Bezier curve constructor. The constructor argument can be one of three things:
   *
   * 1. array/4 of {x:..., y:..., z:...}, z optional
   * 2. numerical array/8 ordered x1,y1,x2,y2,x3,y3,x4,y4
   * 3. numerical array/12 ordered x1,y1,z1,x2,y2,z2,x3,y3,z3,x4,y4,z4
   *
   */
  var Bezier = function Bezier(coords) {
    var args = coords && coords.forEach ? coords : [].slice.call(arguments);
    var coordlen = false;
    if (_typeof(args[0]) === "object") {
      coordlen = args.length;
      var newargs = [];
      args.forEach(function (point) {
        ['x', 'y', 'z'].forEach(function (d) {
          if (typeof point[d] !== "undefined") {
            newargs.push(point[d]);
          }
        });
      });
      args = newargs;
    }
    var higher = false;
    var len = args.length;
    if (coordlen) {
      if (coordlen > 4) {
        if (arguments.length !== 1) {
          throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");
        }
        higher = true;
      }
    } else {
      if (len !== 6 && len !== 8 && len !== 9 && len !== 12) {
        if (arguments.length !== 1) {
          throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");
        }
      }
    }
    var _3d = !higher && (len === 9 || len === 12) || coords && coords[0] && typeof coords[0].z !== "undefined";
    this._3d = _3d;
    var points = [];
    for (var idx = 0, step = _3d ? 3 : 2; idx < len; idx += step) {
      var point = {
        x: args[idx],
        y: args[idx + 1]
      };
      if (_3d) {
        point.z = args[idx + 2];
      };
      points.push(point);
    }
    this.order = points.length - 1;
    this.points = points;
    var dims = ['x', 'y'];
    if (_3d) dims.push('z');
    this.dims = dims;
    this.dimlen = dims.length;
    (function (curve) {
      var a = utils.align(points, { p1: points[0], p2: points[curve.order] });
      for (var i = 0; i < a.length; i++) {
        if (abs(a[i].y) > 0.0001) {
          curve._linear = false;
          return;
        }
      }
      curve._linear = true;
    })(this);
    this._t1 = 0;
    this._t2 = 1;
    this.update();
  };

  Bezier.fromSVG = function (svgString) {
    var list = svgString.match(/[-+]?\d*\.?\d+(?:[eE][-+]?\d+)?/g).map(parseFloat);
    var relative = /[cq]/.test(svgString);
    if (!relative) return new Bezier(list);
    list = list.map(function (v, i) {
      return i < 2 ? v : v + list[i % 2];
    });
    return new Bezier(list);
  };

  Bezier.getABC = function (n, S, B, E, t) {
    if (typeof t === "undefined") {
      t = 0.5;
    }
    var u = utils.projectionratio(t, n),
        um = 1 - u,
        C = {
      x: u * S.x + um * E.x,
      y: u * S.y + um * E.y
    },
        s = utils.abcratio(t, n),
        A = {
      x: B.x + (B.x - C.x) / s,
      y: B.y + (B.y - C.y) / s
    };
    return { A: A, B: B, C: C };
  };

  Bezier.quadraticFromPoints = function (p1, p2, p3, t) {
    if (typeof t === "undefined") {
      t = 0.5;
    }
    // shortcuts, although they're really dumb
    if (t === 0) {
      return new Bezier(p2, p2, p3);
    }
    if (t === 1) {
      return new Bezier(p1, p2, p2);
    }
    // real fitting.
    var abc = Bezier.getABC(2, p1, p2, p3, t);
    return new Bezier(p1, abc.A, p3);
  };

  Bezier.cubicFromPoints = function (S, B, E, t, d1) {
    if (typeof t === "undefined") {
      t = 0.5;
    }
    var abc = Bezier.getABC(3, S, B, E, t);
    if (typeof d1 === "undefined") {
      d1 = utils.dist(B, abc.C);
    }
    var d2 = d1 * (1 - t) / t;

    var selen = utils.dist(S, E),
        lx = (E.x - S.x) / selen,
        ly = (E.y - S.y) / selen,
        bx1 = d1 * lx,
        by1 = d1 * ly,
        bx2 = d2 * lx,
        by2 = d2 * ly;
    // derivation of new hull coordinates
    var e1 = { x: B.x - bx1, y: B.y - by1 },
        e2 = { x: B.x + bx2, y: B.y + by2 },
        A = abc.A,
        v1 = { x: A.x + (e1.x - A.x) / (1 - t), y: A.y + (e1.y - A.y) / (1 - t) },
        v2 = { x: A.x + (e2.x - A.x) / t, y: A.y + (e2.y - A.y) / t },
        nc1 = { x: S.x + (v1.x - S.x) / t, y: S.y + (v1.y - S.y) / t },
        nc2 = { x: E.x + (v2.x - E.x) / (1 - t), y: E.y + (v2.y - E.y) / (1 - t) };
    // ...done
    return new Bezier(S, nc1, nc2, E);
  };

  var getUtils = function getUtils() {
    return utils;
  };

  Bezier.getUtils = getUtils;

  Bezier.prototype = {
    getUtils: getUtils,
    valueOf: function valueOf() {
      return this.toString();
    },
    toString: function toString() {
      return utils.pointsToString(this.points);
    },
    toSVG: function toSVG(relative) {
      if (this._3d) return false;
      var p = this.points,
          x = p[0].x,
          y = p[0].y,
          s = ["M", x, y, this.order === 2 ? "Q" : "C"];
      for (var i = 1, last = p.length; i < last; i++) {
        s.push(p[i].x);
        s.push(p[i].y);
      }
      return s.join(" ");
    },
    update: function update() {
      // one-time compute derivative coordinates
      this.dpoints = [];
      for (var p = this.points, d = p.length, c = d - 1; d > 1; d--, c--) {
        var list = [];
        for (var j = 0, dpt; j < c; j++) {
          dpt = {
            x: c * (p[j + 1].x - p[j].x),
            y: c * (p[j + 1].y - p[j].y)
          };
          if (this._3d) {
            dpt.z = c * (p[j + 1].z - p[j].z);
          }
          list.push(dpt);
        }
        this.dpoints.push(list);
        p = list;
      };
      this.computedirection();
    },
    computedirection: function computedirection() {
      var points = this.points;
      var angle = utils.angle(points[0], points[this.order], points[1]);
      this.clockwise = angle > 0;
    },
    length: function length() {
      return utils.length(this.derivative.bind(this));
    },
    _lut: [],
    getLUT: function getLUT(steps) {
      steps = steps || 100;
      if (this._lut.length === steps) {
        return this._lut;
      }
      this._lut = [];
      for (var t = 0; t <= steps; t++) {
        this._lut.push(this.compute(t / steps));
      }
      return this._lut;
    },
    on: function on(point, error) {
      error = error || 5;
      var lut = this.getLUT(),
          hits = [],
          c,
          t = 0;
      for (var i = 0; i < lut.length; i++) {
        c = lut[i];
        if (utils.dist(c, point) < error) {
          hits.push(c);
          t += i / lut.length;
        }
      }
      if (!hits.length) return false;
      return t /= hits.length;
    },
    project: function project(point) {
      // step 1: coarse check
      var LUT = this.getLUT(),
          l = LUT.length - 1,
          closest = utils.closest(LUT, point),
          mdist = closest.mdist,
          mpos = closest.mpos;
      if (mpos === 0 || mpos === l) {
        var t = mpos / l,
            pt = this.compute(t);
        pt.t = t;
        pt.d = mdist;
        return pt;
      }

      // step 2: fine check
      var ft,
          t,
          p,
          d,
          t1 = (mpos - 1) / l,
          t2 = (mpos + 1) / l,
          step = 0.1 / l;
      mdist += 1;
      for (t = t1, ft = t; t < t2 + step; t += step) {
        p = this.compute(t);
        d = utils.dist(point, p);
        if (d < mdist) {
          mdist = d;
          ft = t;
        }
      }
      p = this.compute(ft);
      p.t = ft;
      p.d = mdist;
      return p;
    },
    get: function get(t) {
      return this.compute(t);
    },
    point: function point(idx) {
      return this.points[idx];
    },
    compute: function compute(t) {
      // shortcuts
      if (t === 0) {
        return this.points[0];
      }
      if (t === 1) {
        return this.points[this.order];
      }

      var p = this.points;
      var mt = 1 - t;

      // linear?
      if (this.order === 1) {
        ret = {
          x: mt * p[0].x + t * p[1].x,
          y: mt * p[0].y + t * p[1].y
        };
        if (this._3d) {
          ret.z = mt * p[0].z + t * p[1].z;
        }
        return ret;
      }

      // quadratic/cubic curve?
      if (this.order < 4) {
        var mt2 = mt * mt,
            t2 = t * t,
            a,
            b,
            c,
            d = 0;
        if (this.order === 2) {
          p = [p[0], p[1], p[2], ZERO];
          a = mt2;
          b = mt * t * 2;
          c = t2;
        } else if (this.order === 3) {
          a = mt2 * mt;
          b = mt2 * t * 3;
          c = mt * t2 * 3;
          d = t * t2;
        }
        var ret = {
          x: a * p[0].x + b * p[1].x + c * p[2].x + d * p[3].x,
          y: a * p[0].y + b * p[1].y + c * p[2].y + d * p[3].y
        };
        if (this._3d) {
          ret.z = a * p[0].z + b * p[1].z + c * p[2].z + d * p[3].z;
        }
        return ret;
      }

      // higher order curves: use de Casteljau's computation
      var dCpts = JSON.parse(JSON.stringify(this.points));
      while (dCpts.length > 1) {
        for (var i = 0; i < dCpts.length - 1; i++) {
          dCpts[i] = {
            x: dCpts[i].x + (dCpts[i + 1].x - dCpts[i].x) * t,
            y: dCpts[i].y + (dCpts[i + 1].y - dCpts[i].y) * t
          };
          if (typeof dCpts[i].z !== "undefined") {
            dCpts[i] = dCpts[i].z + (dCpts[i + 1].z - dCpts[i].z) * t;
          }
        }
        dCpts.splice(dCpts.length - 1, 1);
      }
      return dCpts[0];
    },
    raise: function raise() {
      var p = this.points,
          np = [p[0]],
          i,
          k = p.length,
          pi,
          pim;
      for (var i = 1; i < k; i++) {
        pi = p[i];
        pim = p[i - 1];
        np[i] = {
          x: (k - i) / k * pi.x + i / k * pim.x,
          y: (k - i) / k * pi.y + i / k * pim.y
        };
      }
      np[k] = p[k - 1];
      return new Bezier(np);
    },
    derivative: function derivative(t) {
      var mt = 1 - t,
          a,
          b,
          c = 0,
          p = this.dpoints[0];
      if (this.order === 2) {
        p = [p[0], p[1], ZERO];a = mt;b = t;
      }
      if (this.order === 3) {
        a = mt * mt;b = mt * t * 2;c = t * t;
      }
      var ret = {
        x: a * p[0].x + b * p[1].x + c * p[2].x,
        y: a * p[0].y + b * p[1].y + c * p[2].y
      };
      if (this._3d) {
        ret.z = a * p[0].z + b * p[1].z + c * p[2].z;
      }
      return ret;
    },
    inflections: function inflections() {
      return utils.inflections(this.points);
    },
    normal: function normal(t) {
      return this._3d ? this.__normal3(t) : this.__normal2(t);
    },
    __normal2: function __normal2(t) {
      var d = this.derivative(t);
      var q = sqrt(d.x * d.x + d.y * d.y);
      return { x: -d.y / q, y: d.x / q };
    },
    __normal3: function __normal3() {
      // see http://stackoverflow.com/questions/25453159
      var r1 = this.derivative(t),
          r2 = this.derivative(t + 0.01),
          q1 = sqrt(r1.x * r1.x + r1.y * r1.y + r1.z * r1.z),
          q2 = sqrt(r2.x * r2.x + r2.y * r2.y + r2.z * r2.z);
      r1.x /= q1;r1.y /= q1;r1.z /= q1;
      r2.x /= q2;r2.y /= q2;r2.z /= q2;
      // cross product
      var c = {
        x: r2.y * r1.z - r2.z * r1.y,
        y: r2.z * r1.x - r2.x * r1.z,
        z: r2.x * r1.y - r2.y * r1.x
      };
      var m = sqrt(c.x * c.x + c.y * c.y + c.z * c.z);
      c.x /= m;c.y /= m;c.z /= m;
      // rotation matrix
      var R = [c.x * c.x, c.x * c.y - c.z, c.x * c.z + c.y, c.x * c.y + c.z, c.y * c.y, c.y * c.z - c.x, c.x * c.z - c.y, c.y * c.z + c.x, c.z * c.z];
      // normal vector:
      var n = {
        x: R[0] * r1.x + R[1] * r1.y + R[2] * r1.z,
        y: R[3] * r1.x + R[4] * r1.y + R[5] * r1.z,
        z: R[6] * r1.x + R[7] * r1.y + R[8] * r1.z
      };
      return n;
    },
    hull: function hull(t) {
      var p = this.points,
          _p = [],
          pt,
          q = [],
          idx = 0,
          i = 0,
          l = 0;
      q[idx++] = p[0];
      q[idx++] = p[1];
      q[idx++] = p[2];
      if (this.order === 3) {
        q[idx++] = p[3];
      }
      // we lerp between all points at each iteration, until we have 1 point left.
      while (p.length > 1) {
        _p = [];
        for (i = 0, l = p.length - 1; i < l; i++) {
          pt = utils.lerp(t, p[i], p[i + 1]);
          q[idx++] = pt;
          _p.push(pt);
        }
        p = _p;
      }
      return q;
    },
    split: function split(t1, t2) {
      // shortcuts
      if (t1 === 0 && !!t2) {
        return this.split(t2).left;
      }
      if (t2 === 1) {
        return this.split(t1).right;
      }

      // no shortcut: use "de Casteljau" iteration.
      var q = this.hull(t1);
      var result = {
        left: this.order === 2 ? new Bezier([q[0], q[3], q[5]]) : new Bezier([q[0], q[4], q[7], q[9]]),
        right: this.order === 2 ? new Bezier([q[5], q[4], q[2]]) : new Bezier([q[9], q[8], q[6], q[3]]),
        span: q
      };

      // make sure we bind _t1/_t2 information!
      result.left._t1 = utils.map(0, 0, 1, this._t1, this._t2);
      result.left._t2 = utils.map(t1, 0, 1, this._t1, this._t2);
      result.right._t1 = utils.map(t1, 0, 1, this._t1, this._t2);
      result.right._t2 = utils.map(1, 0, 1, this._t1, this._t2);

      // if we have no t2, we're done
      if (!t2) {
        return result;
      }

      // if we have a t2, split again:
      t2 = utils.map(t2, t1, 1, 0, 1);
      var subsplit = result.right.split(t2);
      return subsplit.left;
    },
    extrema: function extrema() {
      var dims = this.dims,
          result = {},
          roots = [],
          p,
          mfn;
      dims.forEach(function (dim) {
        mfn = function mfn(v) {
          return v[dim];
        };
        p = this.dpoints[0].map(mfn);
        result[dim] = utils.droots(p);
        if (this.order === 3) {
          p = this.dpoints[1].map(mfn);
          result[dim] = result[dim].concat(utils.droots(p));
        }
        result[dim] = result[dim].filter(function (t) {
          return t >= 0 && t <= 1;
        });
        roots = roots.concat(result[dim].sort());
      }.bind(this));
      roots.sort();
      result.values = roots;
      return result;
    },
    bbox: function bbox() {
      var extrema = this.extrema(),
          result = {};
      this.dims.forEach(function (d) {
        result[d] = utils.getminmax(this, d, extrema[d]);
      }.bind(this));
      return result;
    },
    overlaps: function overlaps(curve) {
      var lbbox = this.bbox(),
          tbbox = curve.bbox();
      return utils.bboxoverlap(lbbox, tbbox);
    },
    offset: function offset(t, d) {
      if (typeof d !== "undefined") {
        var c = this.get(t);
        var n = this.normal(t);
        var ret = {
          c: c,
          n: n,
          x: c.x + n.x * d,
          y: c.y + n.y * d
        };
        if (this._3d) {
          ret.z = c.z + n.z * d;
        };
        return ret;
      }
      if (this._linear) {
        var nv = this.normal(0);
        var coords = this.points.map(function (p) {
          var ret = {
            x: p.x + t * nv.x,
            y: p.y + t * nv.y
          };
          if (p.z && n.z) {
            ret.z = p.z + t * nv.z;
          }
          return ret;
        });
        return [new Bezier(coords)];
      }
      var reduced = this.reduce();
      return reduced.map(function (s) {
        return s.scale(t);
      });
    },
    simple: function simple() {
      if (this.order === 3) {
        var a1 = utils.angle(this.points[0], this.points[3], this.points[1]);
        var a2 = utils.angle(this.points[0], this.points[3], this.points[2]);
        if (a1 > 0 && a2 < 0 || a1 < 0 && a2 > 0) return false;
      }
      var n1 = this.normal(0);
      var n2 = this.normal(1);
      var s = n1.x * n2.x + n1.y * n2.y;
      if (this._3d) {
        s += n1.z * n2.z;
      }
      var angle = abs(acos(s));
      return angle < pi / 3;
    },
    reduce: function reduce() {
      var i,
          t1 = 0,
          t2 = 0,
          step = 0.01,
          segment,
          pass1 = [],
          pass2 = [];
      // first pass: split on extrema
      var extrema = this.extrema().values;
      if (extrema.indexOf(0) === -1) {
        extrema = [0].concat(extrema);
      }
      if (extrema.indexOf(1) === -1) {
        extrema.push(1);
      }
      for (t1 = extrema[0], i = 1; i < extrema.length; i++) {
        t2 = extrema[i];
        segment = this.split(t1, t2);
        segment._t1 = t1;
        segment._t2 = t2;
        pass1.push(segment);
        t1 = t2;
      }
      // second pass: further reduce these segments to simple segments
      pass1.forEach(function (p1) {
        t1 = 0;
        t2 = 0;
        while (t2 <= 1) {
          for (t2 = t1 + step; t2 <= 1 + step; t2 += step) {
            segment = p1.split(t1, t2);
            if (!segment.simple()) {
              t2 -= step;
              if (abs(t1 - t2) < step) {
                // we can never form a reduction
                return [];
              }
              segment = p1.split(t1, t2);
              segment._t1 = utils.map(t1, 0, 1, p1._t1, p1._t2);
              segment._t2 = utils.map(t2, 0, 1, p1._t1, p1._t2);
              pass2.push(segment);
              t1 = t2;
              break;
            }
          }
        }
        if (t1 < 1) {
          segment = p1.split(t1, 1);
          segment._t1 = utils.map(t1, 0, 1, p1._t1, p1._t2);
          segment._t2 = p1._t2;
          pass2.push(segment);
        }
      });
      return pass2;
    },
    scale: function scale(d) {
      var order = this.order;
      var distanceFn = false;
      if (typeof d === "function") {
        distanceFn = d;
      }
      if (distanceFn && order === 2) {
        return this.raise().scale(distanceFn);
      }

      // TODO: add special handling for degenerate (=linear) curves.
      var clockwise = this.clockwise;
      var r1 = distanceFn ? distanceFn(0) : d;
      var r2 = distanceFn ? distanceFn(1) : d;
      var v = [this.offset(0, 10), this.offset(1, 10)];
      var o = utils.lli4(v[0], v[0].c, v[1], v[1].c);
      if (!o) {
        console.log("cannot scale this curve. Try reducing it first.");return this;
      }
      // move all points by distance 'd' wrt the origin 'o'
      var points = this.points,
          np = [];

      // move end points by fixed distance along normal.
      [0, 1].forEach(function (t) {
        var p = np[t * order] = utils.copy(points[t * order]);
        p.x += (t ? r2 : r1) * v[t].n.x;
        p.y += (t ? r2 : r1) * v[t].n.y;
      }.bind(this));

      if (!distanceFn) {
        // move control points to lie on the intersection of the offset
        // derivative vector, and the origin-through-control vector
        [0, 1].forEach(function (t) {
          if (this.order === 2 && !!t) return;
          var p = np[t * order];
          var d = this.derivative(t);
          var p2 = { x: p.x + d.x, y: p.y + d.y };
          np[t + 1] = utils.lli4(p, p2, o, points[t + 1]);
        }.bind(this));
        return new Bezier(np);
      }

      // move control points by "however much necessary to
      // ensure the correct tangent to endpoint".
      [0, 1].forEach(function (t) {
        if (this.order === 2 && !!t) return;
        var p = points[t + 1];
        var ov = {
          x: p.x - o.x,
          y: p.y - o.y
        };
        var rc = distanceFn ? distanceFn((t + 1) / order) : d;
        if (distanceFn && !clockwise) rc = -rc;
        var m = sqrt(ov.x * ov.x + ov.y * ov.y);
        ov.x /= m;
        ov.y /= m;
        np[t + 1] = {
          x: p.x + rc * ov.x,
          y: p.y + rc * ov.y
        };
      }.bind(this));
      return new Bezier(np);
    },
    outline: function outline(d1, d2, d3, d4) {
      d2 = typeof d2 === "undefined" ? d1 : d2;
      var reduced = this.reduce(),
          len = reduced.length,
          fcurves = [],
          bcurves = [],
          p,
          alen = 0,
          tlen = this.length();

      var graduated = typeof d3 !== "undefined" && typeof d4 !== "undefined";

      function linearDistanceFunction(s, e, tlen, alen, slen) {
        return function (v) {
          var f1 = alen / tlen,
              f2 = (alen + slen) / tlen,
              d = e - s;
          return utils.map(v, 0, 1, s + f1 * d, s + f2 * d);
        };
      };

      // form curve oulines
      reduced.forEach(function (segment) {
        slen = segment.length();
        if (graduated) {
          fcurves.push(segment.scale(linearDistanceFunction(d1, d3, tlen, alen, slen)));
          bcurves.push(segment.scale(linearDistanceFunction(-d2, -d4, tlen, alen, slen)));
        } else {
          fcurves.push(segment.scale(d1));
          bcurves.push(segment.scale(-d2));
        }
        alen += slen;
      });

      // reverse the "return" outline
      bcurves = bcurves.map(function (s) {
        p = s.points;
        if (p[3]) {
          s.points = [p[3], p[2], p[1], p[0]];
        } else {
          s.points = [p[2], p[1], p[0]];
        }
        return s;
      }).reverse();

      // form the endcaps as lines
      var fs = fcurves[0].points[0],
          fe = fcurves[len - 1].points[fcurves[len - 1].points.length - 1],
          bs = bcurves[len - 1].points[bcurves[len - 1].points.length - 1],
          be = bcurves[0].points[0],
          ls = utils.makeline(bs, fs),
          le = utils.makeline(fe, be),
          segments = [ls].concat(fcurves).concat([le]).concat(bcurves),
          slen = segments.length;

      return new PolyBezier(segments);
    },
    outlineshapes: function outlineshapes(d1, d2) {
      d2 = d2 || d1;
      var outline = this.outline(d1, d2).curves;
      var shapes = [];
      for (var i = 1, len = outline.length; i < len / 2; i++) {
        var shape = utils.makeshape(outline[i], outline[len - i]);
        shape.startcap.virtual = i > 1;
        shape.endcap.virtual = i < len / 2 - 1;
        shapes.push(shape);
      }
      return shapes;
    },
    intersects: function intersects(curve) {
      if (!curve) return this.selfintersects();
      if (curve.p1 && curve.p2) {
        return this.lineIntersects(curve);
      }
      if (curve instanceof Bezier) {
        curve = curve.reduce();
      }
      return this.curveintersects(this.reduce(), curve);
    },
    lineIntersects: function lineIntersects(line) {
      var mx = min(line.p1.x, line.p2.x),
          my = min(line.p1.y, line.p2.y),
          MX = max(line.p1.x, line.p2.x),
          MY = max(line.p1.y, line.p2.y),
          self = this;
      return utils.roots(this.points, line).filter(function (t) {
        var p = self.get(t);
        return utils.between(p.x, mx, MX) && utils.between(p.y, my, MY);
      });
    },
    selfintersects: function selfintersects() {
      var reduced = this.reduce();
      // "simple" curves cannot intersect with their direct
      // neighbour, so for each segment X we check whether
      // it intersects [0:x-2][x+2:last].
      var i,
          len = reduced.length - 2,
          results = [],
          result,
          left,
          right;
      for (i = 0; i < len; i++) {
        left = reduced.slice(i, i + 1);
        right = reduced.slice(i + 2);
        result = this.curveintersects(left, right);
        results = results.concat(result);
      }
      return results;
    },
    curveintersects: function curveintersects(c1, c2) {
      var pairs = [];
      // step 1: pair off any overlapping segments
      c1.forEach(function (l) {
        c2.forEach(function (r) {
          if (l.overlaps(r)) {
            pairs.push({ left: l, right: r });
          }
        });
      });
      // step 2: for each pairing, run through the convergence algorithm.
      var intersections = [];
      pairs.forEach(function (pair) {
        var result = utils.pairiteration(pair.left, pair.right);
        if (result.length > 0) {
          intersections = intersections.concat(result);
        }
      });
      return intersections;
    },
    arcs: function arcs(errorThreshold) {
      errorThreshold = errorThreshold || 0.5;
      var circles = [];
      return this._iterate(errorThreshold, circles);
    },
    _error: function _error(pc, np1, s, e) {
      var q = (e - s) / 4,
          c1 = this.get(s + q),
          c2 = this.get(e - q),
          ref = utils.dist(pc, np1),
          d1 = utils.dist(pc, c1),
          d2 = utils.dist(pc, c2);
      return abs(d1 - ref) + abs(d2 - ref);
    },
    _iterate: function _iterate(errorThreshold, circles) {
      var s = 0,
          e = 1,
          safety;
      // we do a binary search to find the "good `t` closest to no-longer-good"
      do {
        safety = 0;

        // step 1: start with the maximum possible arc
        e = 1;

        // points:
        var np1 = this.get(s),
            np2,
            np3,
            arc,
            prev_arc;

        // booleans:
        var curr_good = false,
            prev_good = false,
            done;

        // numbers:
        var m = e,
            prev_e = 1,
            step = 0;

        // step 2: find the best possible arc
        do {
          prev_good = curr_good;
          prev_arc = arc;
          m = (s + e) / 2;
          step++;

          np2 = this.get(m);
          np3 = this.get(e);

          arc = utils.getccenter(np1, np2, np3);
          var error = this._error(arc, np1, s, e);
          curr_good = error <= errorThreshold;

          done = prev_good && !curr_good;
          if (!done) prev_e = e;

          // this arc is fine: we can move 'e' up to see if we can find a wider arc
          if (curr_good) {
            // if e is already at max, then we're done for this arc.
            if (e >= 1) {
              prev_e = 1;
              prev_arc = arc;
              break;
            }
            // if not, move it up by half the iteration distance
            e = e + (e - s) / 2;
          }

          // this is a bad arc: we need to move 'e' down to find a good arc
          else {
              e = m;
            }
        } while (!done && safety++ < 100);

        if (safety >= 100) {
          console.error("arc abstraction somehow failed...");
          break;
        }

        // console.log("[F] arc found", s, prev_e, prev_arc.x, prev_arc.y, prev_arc.s, prev_arc.e);

        prev_arc = prev_arc ? prev_arc : arc;
        circles.push(prev_arc);
        s = prev_e;
      } while (e < 1);
      return circles;
    },

    /**
     * edited Denis Ponomarev www.hometlt.ru
     */
    getTbyLength: function getTbyLength(length, accuracy, offsetT) {
      offsetT = offsetT || 0;
      accuracy = accuracy || 0.005;
      if (length == 0) return offsetT;
      var pt1 = this.get(offsetT),
          pt2,
          t = offsetT,
          dx,
          dy;
      var dist = 0;
      do {
        t += accuracy;
        pt2 = this.get(t);
        dx = pt2.x - pt1.x;
        dy = pt2.y - pt1.y;
        dist += Math.sqrt(dx * dx + dy * dy);
        pt1 = pt2;
        if (t >= 1) {
          return this.length();
        }
      } while (dist < length);

      return t;
    }
  };
  return Bezier;
}();

if (true) {
  module.exports = Bezier;
}

/***/ }),
/* 14 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.debug = true;

fabric.util.data = __webpack_require__(15);
fabric.util.path = __webpack_require__(4);
fabric.util.compile = __webpack_require__(5);
fabric.util.loader = __webpack_require__(17);
fabric.util.syntax = __webpack_require__(18);
fabric.util.object.extend(fabric.util.object, __webpack_require__(2));
fabric.util.object.extend(fabric.util, __webpack_require__(3));

//require('./modules');

__webpack_require__(19);
__webpack_require__(20);
__webpack_require__(21);
__webpack_require__(6);
__webpack_require__(22);
__webpack_require__(23);
__webpack_require__(24);
__webpack_require__(25);
__webpack_require__(26);
__webpack_require__(27);
__webpack_require__(28);
// require('./modules/slide.stretchable');
__webpack_require__(29);
__webpack_require__(8);
__webpack_require__(30);
__webpack_require__(31);
__webpack_require__(39);
__webpack_require__(40);
__webpack_require__(41);
__webpack_require__(43);
__webpack_require__(44);
__webpack_require__(45);
__webpack_require__(46);
__webpack_require__(47);
__webpack_require__(48);
__webpack_require__(50);
__webpack_require__(51);
__webpack_require__(52);
__webpack_require__(53);
__webpack_require__(10);
__webpack_require__(54);
__webpack_require__(56);
__webpack_require__(58);
__webpack_require__(59);
__webpack_require__(60);
__webpack_require__(61);
__webpack_require__(65);
__webpack_require__(66);
__webpack_require__(67);
__webpack_require__(68);
__webpack_require__(70);
__webpack_require__(71);
__webpack_require__(73);
__webpack_require__(74);
__webpack_require__(75);
__webpack_require__(79);
__webpack_require__(81);
__webpack_require__(85);
__webpack_require__(88);

// require('./shapes/bezierText');
__webpack_require__(90);
__webpack_require__(91);

if (!fabric.isLikelyNode) {
  /**
   * inline script images
   * @type {{error: string}}
   */
  fabric.media = {
    /**
     * replace images loaded with errors
     */
    error: 'data:image/svg+xml;base64,' + __webpack_require__(92)
  };
}

module.exports = fabric;
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 15 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var path = __webpack_require__(4);
var util = __webpack_require__(3);
var object = __webpack_require__(2);

function isServer() {
  return !(typeof window != 'undefined' && window.document);
}

if (isServer()) {
  var fs = __webpack_require__(16);
}

function _load_json(value, callback_success, callback_error) {

  var output = null;
  var errors = [];

  if (value.constructor == String) {

    var filename, regex_data, init_property;
    regex_data = /^([^#]*)#?(.*)$/.exec(value);

    filename = regex_data[1];
    init_property = regex_data[2];
    utils.getInlineJson(filename, "json", _loadJson_data, function (error) {
      errors.push(error);
      if (callback_error) {
        callback_error(error);
      } else {
        console.error("file: \"" + filename + "\". " + error.message);
      }
    });
  } else {
    _loadJson_data(value);
  }

  function _loadJson_data(data) {
    /*
     замена записей "url(./path/to/file)  на "../../path/to/file"
     url начинающиеся с ./ относительно родителького json файла
      url с "/" добавляется APP_STATIC_PATH
     */
    utils.recoursive(data, function (property, value, parent) {
      if (/^url\(.*\)$/.test(value)) {
        var regex_data = /^url\((\.?\/)?(.*)\)$/.exec(value);
        var url = regex_data[2];

        if (regex_data[1] == "/") {
          url = window.APP_STATIC_PATH + url;
        }
        if (regex_data[1] == "./") {
          url = path.getParentDirectoryUrl(filename) + url;
        }

        parent[property] = path.resolve(url);
      }
    });

    var loader = util.queueLoad(1, function finalize() {

      if (init_property) {
        var prop_arr = init_property.split("/");
        for (var i = 0; i < prop_arr.length; i++) {
          data = data[prop_arr[i]];
        }
      }

      if (errors.length) {
        if (callback_error) callback_error(errors);
      } else {
        if (callback_success) callback_success(data);
        output = data;
      }
    });

    /**
     * remove comments
     */
    utils.recoursive(data, function (property, value, parent) {
      /*
       remove comments like
       ["@comment()"]
       "@comment": {}
       */
      if (/^\/\/.*$/.test(value) || /^@comment\(.*\)$/.test(value) || property == "@comment") {
        if (parent.constructor == Array) {
          parent.splice(property, 1);
        } else {
          delete parent[property];
        }
      } else if (/^@extend.*$/.test(property)) {

        loader.total++;
        _load_json(value, function (data) {
          var ext_data = object.deepExtend(data, parent);
          object.deepExtend(parent, ext_data);
          delete parent["@extend"];
          loader();
        }, function (data, error) {
          errors.push(error);
          loader();
        });
      } else if (/^@extend\(.*\)$/.test(value)) {
        var _reg_data = /^@extend\((\.\/)?(.*)\)$/.exec(value);
        var url = _reg_data[2];
        if (_reg_data[1]) {
          url = path.getParentDirectoryUrl(filename) + url;
        }
        loader.total++;
        _load_json(url, function (data) {
          parent[property] = data;
          loader();
        }, function (data, error) {
          errors.push(error);
          loader();
        });
      } else if (/^@mixin\(.*\)$/.test(value)) {
        var _reg_data = /^@mixin\((\.\/)?(.*)\)$/.exec(value);
        var url = _reg_data[2];
        if (_reg_data[1]) {
          url = path.getParentDirectoryUrl(filename) + url;
        }
        loader.total++;
        _load_json(url, function (data) {
          if (parent.constructor == Array) {
            parent.splice(property, 1);
            for (var i in data) {
              parent.push(data[i]);
            }
          } else {
            delete parent[property];
            for (var i in data) {
              parent[i] = data[i];
            }
          }
          loader();
        }, function (data, error) {
          errors.push(error);
          loader();
        });
      } else if (/^@load\((.*)\)$/.test(value)) {
        var _reg_data = /^@load\((\.?\/)?(.*)\)$/.exec(value);
        var url = _reg_data[2];
        if (_reg_data[1] == "/") {
          url = window.APP_STATIC_PATH + url;
        }
        if (_reg_data[1] == "./") {
          url = path.getParentDirectoryUrl(filename) + url;
        }

        loader.total++;
        utils.getInlineJson(url, "html", function (data) {
          parent[property] = data;
          loader();
        }, function (data, error) {
          errors.push(error);
          loader();
        });
      }
    });
    loader();
  }

  return output;
}

var utils = {
  CACHED_JSON: {},
  loadJsonSync: function loadJsonSync(src) {
    var data;
    _load_json(src, function (_data) {
      data = _data;
    });
    return data;
  },

  /**
   позволяет использовать конструкции вида
   расширить данные из файла template.json
   "@extend" : "url(data/template.json)",
   "@extend" : "url(data/template.json#settings/stages)",
    //заменить строку наданные из файла
   "stages":       "url(data/template.json#settings/stages)",
    * @param filename
   * @param callback_success
   * @param callback_error
   */
  loadJson: function loadJson(value, resolve_cb, fail_cb) {
    return _load_json(value, function (data) {
      resolve_cb && resolve_cb(data);
    }, function (err) {
      fail_cb && fail_cb(err);
    });
  },

  removeComments: function removeComments(str) {
    str = str.replace(/^\s*(\/\/.*|(?:\/\*[\s\S]*?)\*\/\s*)$/gm, "");
    return str;
  },
  /**
   *
   * @param object
   * @param criteria - выполнять функцию со всеми объектами
   */
  recoursive: function recoursive(object, criteria) {
    var readed = [];
    if (!object) return;
    return function sub_recoursive(object) {
      if (readed.indexOf(object) != -1) {
        return;
      }
      readed.push(object);

      if (object instanceof Array) {
        for (var prop = object.length; prop--;) {
          if (object[prop] && (object[prop].constructor == Object || object[prop].constructor == Array)) {
            sub_recoursive(object[prop]);
          } else {
            var break_ = criteria(prop, object[prop], object);
          }
        }
      } else {
        for (var prop in object) {
          if (object[prop] && (object[prop].constructor == Object || object[prop].constructor == Array)) {
            sub_recoursive(object[prop]);
          } else {
            var break_ = criteria(prop, object[prop], object);
          }
        }
      }
    }(object);
  },

  parseCSV: function parseCSV(data) {
    var rows = data.split(/\n/);
    var columns = rows[0].split(',');
    rows.splice(0, 1);

    for (var i = 0; i < rows.length; i++) {
      var output_row_data = {};
      var row_data = [];

      var _quote = false,
          last = -1;
      var j = -1;
      var str = rows[i];
      while (++j < str.length) {
        if (!_quote) {
          if (str[j] == '\'' || str[j] == '\"') {
            _quote = str[j];
          }
          if (str[j] == ",") {
            var _val = str.substring(last, j);
            if (_val[0] == '\"' && _val[_val.length - 1] == '\"') {
              _val = _val.substring(1, _val.length - 1);
            }
            row_data.push(_val);
            last = j + 1;
          }
        } else {
          if (str[j] == _quote) {
            _quote = false;
          }
        }
      }

      for (var j in row_data) {
        output_row_data[columns[j]] = row_data[j];
      }
      rows[i] = output_row_data;
    }
    return rows;
  },
  /**
   *
   * https://stackoverflow.com/questions/4843746/regular-expression-to-add-double-quotes-around-keys-in-javascript
   */
  doubleQuote: function doubleQuote(jsonString) {
    var objKeysRegex = /({|,)(?:\s*)(?:')?([A-Za-z_$\.][A-Za-z0-9_ \-\.$]*)(?:')?(?:\s*):/g; // look for object names
    return jsonString.replace(objKeysRegex, "$1\"$2\":"); // all object names should be double quoted
  },
  parseData: function parseData(data, dataType) {
    var _parsed;
    if (dataType == "csv") {
      _parsed = utils.parseCSV(data);
    } else if (dataType == "json") {
      _parsed = data.trim();
      //if (data[0] != "{" && data[0] != "[") {
      //  return false;
      //}

      _parsed = utils.removeComments(_parsed);
      //data  = data.replace(/\n/g,"")


      _parsed = utils.doubleQuote(_parsed);

      try {
        var _parsed = JSON.parse(_parsed); //= JSON.parse(data.replace(/\/\*[\s\S]*?\*\/|\/\/.*/g,""));
      } catch (e) {
        return {
          status: "error",
          message: e.toString(),
          data: data
        };
      }
      //var script = $("<script type='text/json' id='" + url + "'>" + JSON.stringify(data) + "</script>");
    }
    return {
      status: "success",
      data: _parsed
    };
  },
  load: function load(url, dataType, callback_success, callback_error) {
    //todo
    if (isServer()) {
      try {
        var data = fs.readFileSync(url, 'utf8');
        data = data.replace(/^\uFEFF/, '');
        var _parsed = utils.parseData(data, dataType);
        if (_parsed.status == "error") {
          callback_error({
            status: "error",
            message: _parsed.message,
            data: _parsed.data
          });
          return;
        }
        callback_success(_parsed.data);
      } catch (e) {

        if (e.code === 'ENOENT') {
          console.log('File not found!');
        } else {
          throw e;
        }
        callback_error(data);
      }
    } else {

      var httpRequest = new XMLHttpRequest();

      httpRequest.onreadystatechange = function () {
        if (httpRequest.readyState === 4) {
          if (httpRequest.status === 200) {
            var data = httpRequest.responseText;
            var _parsed = utils.parseData(data, dataType);
            if (_parsed.status == "error") {
              callback_error({
                status: httpRequest.status,
                message: _parsed.message,
                response: httpRequest.responseText
              });
              return;
            }
            callback_success(_parsed.data);
          } else {
            callback_error(url, httpRequest);
          }
        }
      };
      httpRequest.open('GET', url);
      httpRequest.send();
    }
  },
  /**
   * Позволяетзагружать json файлы , содержащие ссылки на другие json файлы.
   * вместо ссылок типа
   *  "property" : "url(chunk.json)"
   *  будет загружено содержимое файла
   *  "property" : {...}
   *
   *  если указать якорь
   *  "property" : "url(chunk.json#settings/chunk/0/text)"
   *
   * то будет загружено содержимое поля settings.chunk[0].text из файла chunk.json
   *
   *
   * @param filename  путь к основному json файлу
   * @param callback  будет вызван после окончания загрузки всех файлов
   */
  getInlineJson: function getInlineJson(url, dataType, callback_success, callback_error) {

    if (dataType.constructor != String) {
      callback_error = callback_success;
      callback_success = dataType;
      dataType = "json";
    }

    if (typeof utils.CACHED_JSON !== "undefined" && utils.CACHED_JSON && utils.CACHED_JSON[url]) {
      callback_success(utils.CACHED_JSON[url]);
      return;
    }
    if (typeof $ !== "undefined") {
      if (typeof document !== "undefined") {
        var inline = $("script[id='" + url + "']");
        if (inline.length > 0) {
          var _data = inline[0].innerText || //all
          inline[0].textContent || //firefox
          inline[0].text; //ie8
          if (dataType == "json") {

            var _data = utils.removeComments(_data);
            callback_success(JSON.parse(_data));
          } else {
            callback_success(_data);
          }
          return;
        }
      }
    }
    utils.load(url, dataType, callback_success, callback_error);
  }
};

module.exports = utils;

/***/ }),
/* 16 */
/***/ (function(module, exports) {

module.exports = require("fs");

/***/ }),
/* 17 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


module.exports = {

  loadScript: function loadScript(requirement, helper, error) {
    var head = document.getElementsByTagName('head')[0];
    var script = document.createElement('script');
    script.type = 'text/javascript';
    script.onerror = error;
    script.onreadystatechange = function () {
      if (this.readyState == 'complete') {
        helper(script, __src);
      }
    };
    script.addEventListener("load", helper, true);
    script.src = requirement;
    head.appendChild(script);
  },
  scriptURL: function scriptURL() {

    if (document.currentScript) {
      return document.currentScript.src;
    }
    var scripts = document.getElementsByTagName('script');
    for (var i = scripts.length - 1; i--;) {
      if (scripts[i].src) {
        return scripts[i].src;
      }
    }
    return false;
  }
};

/***/ }),
/* 18 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var deepDiffMapper = {
  VALUE_CREATED: 'created',
  VALUE_UPDATED: 'updated',
  VALUE_DELETED: 'deleted',
  VALUE_UNCHANGED: 'unchanged',
  map: function map(obj1, obj2) {
    if (this.isFunction(obj1) || this.isFunction(obj2)) {
      throw 'Invalid argument. Function given, object expected.';
    }
    if (this.isValue(obj1) || this.isValue(obj2)) {
      return {
        '_map_type': this.compareValues(obj1, obj2),
        '_map_data': obj2 === undefined ? obj1 : obj2
      };
    }

    if (_.isArray(obj2)) {
      var _array = true;
      var diff = [];
    } else {
      var diff = {};
    }

    for (var key in obj1) {
      if (this.isFunction(obj1[key])) {
        continue;
      }

      var value2 = undefined;
      if ('undefined' != typeof obj2[key]) {
        value2 = obj2[key];
      }

      diff[key] = this.map(obj1[key], value2);
    }
    for (var key in obj2) {
      if (this.isFunction(obj2[key]) || 'undefined' != typeof diff[key]) {
        continue;
      }

      var _val = this.map(undefined, obj2[key]);
      if (_array) {
        diff.push(_val);
      } else {
        diff[key] = _val;
      }
    }

    return {
      '_map_type': '',
      '_map_data': diff
    };
  },
  compareValues: function compareValues(value1, value2) {
    if (value1 === value2) {
      return this.VALUE_UNCHANGED;
    }
    if ('undefined' == typeof value1) {
      return this.VALUE_CREATED;
    }
    if ('undefined' == typeof value2) {
      return this.VALUE_DELETED;
    }

    return this.VALUE_UPDATED;
  },
  isFunction: function isFunction(obj) {
    return {}.toString.apply(obj) === '[object Function]';
  },
  isArray: function isArray(obj) {
    return {}.toString.apply(obj) === '[object Array]';
  },
  isObject: function isObject(obj) {
    return {}.toString.apply(obj) === '[object Object]';
  },
  isValue: function isValue(obj) {
    return !this.isObject(obj) && !this.isArray(obj);
  }
};

module.exports = {
  differenceMap: deepDiffMapper.map.bind(deepDiffMapper),
  syntaxHighlight: function syntaxHighlight(json) {
    if (typeof json != 'string') {
      json = JSON.stringify(json, null, 2);
    }
    json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');

    json = json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {
      var cls = 'number';
      if (/^"/.test(match)) {
        if (/:$/.test(match)) {
          cls = 'key';
        } else {
          cls = 'string';
        }
      } else if (/true|false/.test(match)) {
        cls = 'boolean';
      } else if (/null/.test(match)) {
        cls = 'null';
      }
      return '<span class="' + cls + '">' + match + '</span>';
    });
    return json = json.replace(/[^,\n][^\n]*/g, function (match) {
      return '<span>' + match + '</span>';
    });
  },
  differenceHighlight: function differenceHighlight(json, output) {

    if (output) {
      output.empty();
    } else {
      output = $("<pre>");
    }

    function printObject(json, level, output, comma, objectIndex) {
      var _el = $("<p>");

      _el.append($("<span>").addClass("object-key").append($("<span>").text(new Array(level).join(' '))));
      if (objectIndex) {
        _el.append($("<span>").text('"').addClass("invisible"), $("<span>").addClass("key").text(objectIndex), $("<span>").text('"').addClass("invisible"), $("<span>").text(': '));
      }

      if (json && json._map_type !== undefined) {
        _el.addClass(json._map_type);

        if (_.isArray(json._map_data)) {
          _el.append($("<span>").text("["));
          var _last_key = json._map_data.length - 1;
          for (var i in json._map_data) {
            printObject(json._map_data[i], level + 1, _el, i != _last_key);
          }
          _el.append($("<p>").text(new Array(level).join(' ') + "]" + (comma ? "," : "")));
        } else if (_.isObject(json._map_data)) {
          _el.append($("<span>").text("{"));
          var _last_key = Object.keys(json._map_data).pop();
          for (var i in json._map_data) {
            printObject(json._map_data[i], level + 1, _el, i != _last_key, i);
          }
          _el.append($("<p>").text(new Array(level).join(' ') + "}" + (comma ? "," : "")));
        } else {

          if (_.isNull(json._map_data)) {
            _el.append($("<span>").text(JSON.stringify(json._map_data, null, 2)));
          } else if (json._map_data.constructor === String) {
            _el.append($("<span>").text('"'), $("<span>").addClass('string').text(json._map_data), $("<span>").text('"'));
          } else if (json._map_data.constructor === Number || json._map_data.constructor === Boolean) {
            _el.append($("<span>").addClass('number').text(json._map_data));
          } else {
            _el.append($("<span>").text(JSON.stringify(json._map_data, null, 2)));
          }
          if (comma) {
            _el.append($("<span>").text(","));
          }
        }
      } else {
        _el.append($("<span>").text(JSON.stringify(json, null, 2)));

        if (comma) {
          _el.append($("<span>").text(","));
        }
      }

      output.append(_el);
    }
    printObject(json, 1, output);
    return output;
  }
};

/***/ }),
/* 19 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

if (!Object.values) {
  Object.defineProperty(Object, 'values', {
    enumerable: false,
    configurable: false,
    writable: false,
    value: function value(_object) {
      var _values = [];
      Object.keys(_object).forEach(function (key) {
        _values.push(_object[key]);
        // use val
      });
      return _values;
    }
  });
}

fabric.util.object.extend(fabric, {
  errors: []
});

fabric.util.order = function (_array, context) {
  (function _call() {
    if (!_array.length) return;
    var foo = _array.shift();
    if (foo) {
      if (foo.length) {
        foo.call(context, _call);
      } else {
        foo.call(context);
        _call();
      }
    } else {
      _call();
    }
  })();
};

fabric.util.promise = {
  map: function map(data, foo) {

    if (data.constructor == Array) {
      return Promise.all(data.map(foo)).then(function (results, error) {
        if (error) {
          return Promise.reject(error);
        }
        return Promise.resolve(results);
      });
    }

    var keys = Object.keys(data);
    var urls = Object.values(data);
    return Promise.all(urls.map(foo)).then(function (results, error) {
      if (error) {
        return Promise.reject(error);
      }
      var _map = {};

      for (var i = 0; i < results.length; i++) {
        _map[keys[i]] = results[i];
      }
      return Promise.resolve(_map);
    });
  },
  wrap: function wrap(context) {
    return function wrap(foo) {
      return function () {
        var options = Array.prototype.slice.call(arguments, 1);
        if (!foo.length) {
          return new Promise(function (resolve, fail) {
            var _result = foo.call(context);
            _result || _result === undefined ? resolve() : fail();
          });
        } else {
          return new Promise(foo.bind(context));
        }
      };
    };
  }
};

fabric.Object.prototype.set = function (key, value) {
  if ((typeof key === 'undefined' ? 'undefined' : _typeof(key)) === 'object') {
    this._setObject(key, value);
  } else {
    if (typeof value === 'function' && key !== 'clipTo') {
      this._set(key, value(this.get(key)));
    } else {
      this._set(key, value);
    }
  }
  return this;
};

fabric.Object.prototype._setObject = function (options, callback) {
  var keys = Object.keys(options);
  if (this.optionsOrder) {
    var middleIndex = this.optionsOrder.indexOf("*") || -1;

    var i = middleIndex,
        prop,
        keyIndex;

    while (prop = this.optionsOrder[--i]) {
      if ((keyIndex = keys.indexOf(prop)) !== -1) {
        keys.splice(keyIndex, 1);
        keys.unshift(prop);
      }
    }
    i = middleIndex;
    while (prop = this.optionsOrder[++i]) {
      if ((keyIndex = keys.indexOf(prop)) !== -1) {
        keys.splice(keyIndex, 1);
        keys.push(prop);
      }
    }
  }
  for (var i = 0; i < keys.length; i++) {
    var prop = keys[i];
    if (typeof options[prop] == "function") {
      keys.splice(i, 1);
      keys.unshift(prop);
    }
  }
  var queue;
  for (var i in keys) {
    var _key = keys[i];
    if (options[_key] === undefined) continue;
    var _fooName = "set" + fabric.util.string.capitalize(_key, true);
    if (this[_fooName] && this[_fooName].name && this[_fooName].name != "anonymous") {
      if (this[_fooName].length == 2) {
        if (!queue) {
          queue = fabric.util.queueLoad(2, callback);
        } else {
          queue.total++;
        }
        this[_fooName](options[_key], function (_key) {
          queue();
        }.bind(this, _key));
      } else {
        this[_fooName](options[_key]);
      }
    } else {
      this.__set(_key, options[_key]);
    }
  }
  if (queue) {
    queue();
  } else if (callback) {
    callback();
  }
};

var _get_pointer_overwritten = fabric.Canvas.prototype.getPointer;

fabric.util.object.extend(fabric.StaticCanvas.prototype, {
  optionsOrder: [],
  __set: fabric.Object.prototype._set,
  _setObject: fabric.Object.prototype._setObject,
  get: fabric.Object.prototype.get,
  set: fabric.Object.prototype.set
});

fabric.util.object.extend(fabric.Canvas.prototype, {
  //  optionsOrder: ["*"],
  originalState: {},
  stateProperties: [],
  editingObject: null,

  getModifiedStates: function getModifiedStates(target) {
    var states = {
      original: {},
      modified: {}
    };
    for (var prop in target.originalState) {
      if (target.originalState[prop] !== target[prop]) {
        if (target.originalState[prop] instanceof Object) {
          if (JSON.stringify(target.originalState[prop]) == JSON.stringify(target[prop])) {
            continue;
          }
        }
        states.original[prop] = target.originalState[prop];
        states.modified[prop] = target[prop];
      }
    }
    return states;
  },
  _finalizeCurrentTransform: function _finalizeCurrentTransform() {

    var transform = this._currentTransform,
        target = transform.target;

    if (target._scaling) {
      target._scaling = false;
    }

    target.setCoords();

    this._restoreOriginXY(target);
    // only fire :modified event if target coordinates were changed during mousedown-mouseup
    this.fireModifiedIfChanged(target);
  },
  fireModifiedIfChanged: function fireModifiedIfChanged(target) {
    if (this.stateful) {
      var _states = target.hasStateChanged();
      if (_states) {
        this.fire('object:modified', { target: target, states: _states });
        target.fire('modified', { states: _states });
      }
    }
  }
});

fabric.util.object.extend(fabric.Object.prototype, {
  optionsOrder: [],
  setAngle: function setAngle(angle) {
    this.angle = angle;
  },

  setShadow: function setShadow(options) {
    return this.shadow = options ? new fabric.Shadow(options) : null;
  },
  __set: fabric.Object.prototype._set,

  _set: function _set(key, value, callback) {
    var _fooName = "set" + fabric.util.string.capitalize(key, true);
    if (this[_fooName] && this[_fooName].name && this[_fooName].name != "anonymous") {
      // if (this.specialProperties.indexOf(key) !== -1) {
      // if(this[_fooName]){
      this[_fooName](value, callback);
    } else {
      this.__set(key, value);
    }
    return this;
  },
  disable: function disable() {
    this.set({
      selectable: false,
      evented: false,
      hasControls: false,
      lockMovementX: true,
      lockMovementY: true
    });
  },
  stored: true,
  /**
   * Saves state of an object
   * @param {Object} [options] Object with additional `stateProperties` array to include when saving state
   * @return {fabric.Object} thisArg
   */
  saveState: function saveState(options) {
    //State: function(options) {

    this.originalState = this.toObject();
    /*
    // this.stateProperties.forEach(function(prop) {
    //   var _val = this.get(prop);
    //   if(_val instanceof Object){
    //     this.originalState[prop] = fabric.util.object.cloneDeep(_val);
    //   }else{
    //     this.originalState[prop] = _val;
    //   }
    // }, this);
     if (options && options.stateProperties) {
      options.stateProperties.forEach(function(prop) {
        this.originalState[prop] = this.get(prop);
      }, this);
    }*/
    return this;
  },
  hasStateChanged: function hasStateChanged() {
    var modified = 0;
    var states = {
      original: {},
      modified: {}
    };

    var state = this.toObject();

    for (var prop in this.originalState) {
      if (this.originalState[prop] !== state[prop]) {
        if (this.originalState[prop] instanceof Object) {
          if (JSON.stringify(this.originalState[prop]) == JSON.stringify(state[prop])) {
            continue;
          }
        }
        states.original[prop] = this.originalState[prop];
        states.modified[prop] = state[prop];
        modified++;
      }
    }
    return modified && states;
  }
});

fabric.util.getProportions = function (photo, container, mode) {
  mode = mode || 'fit';
  var _w = photo.naturalWidth || photo.width;
  var _h = photo.naturalHeight || photo.height;
  if (!container.height && !container.width) {
    return {
      scale: 1,
      width: _w,
      height: _h
    };
  }
  if (!photo.height && !photo.width) {
    return {
      scale: 0.001,
      width: container.width,
      height: container.height
    };
  }

  // var _asp = _w / _h, _c_asp = container.width / container.height;

  // if (_asp > _c_asp) {
  //   _h = container.height;
  //   _w = _h * _asp;
  //
  // } else {
  //   _w = container.width;
  //   _h = _w / _asp;
  // }
  // var scaleX = container.width / _w;
  // var scaleY = container.height / _h;
  var scaleX = container.width && container.width / _w || 999;
  var scaleY = container.height && container.height / _h || 999;

  var scale;
  if (mode === 'cover') {
    scale = Math.max(scaleX, scaleY);
  }
  if (mode === 'fit') {
    scale = Math.min(scaleX, scaleY);
  }
  if (mode === 'center') {
    scale = 1;
  }
  return {
    scale: scale,
    width: Math.floor(_w * scale),
    height: Math.floor(_h * scale)
  };
};

fabric.util.Utf8ArrayToStr = function (array) {
  var out, i, len, c;
  var char2, char3;

  out = "";
  len = array.length;
  i = 0;
  while (i < len) {
    c = array[i++];
    switch (c >> 4) {
      case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:
        // 0xxxxxxx
        out += String.fromCharCode(c);
        break;
      case 12:case 13:
        // 110x xxxx   10xx xxxx
        char2 = array[i++];
        out += String.fromCharCode((c & 0x1F) << 6 | char2 & 0x3F);
        break;
      case 14:
        // 1110 xxxx  10xx xxxx  10xx xxxx
        char2 = array[i++];
        char3 = array[i++];
        out += String.fromCharCode((c & 0x0F) << 12 | (char2 & 0x3F) << 6 | (char3 & 0x3F) << 0);
        break;
    }
  }

  return out;
};

fabric.util._idCounter = 1;

fabric.util.createObject = function (type, options, callback) {
  if (typeof type !== "string") {
    callback = options;
    options = type;
    type = null;
  } else {
    options.type = type;
  }
  var app = options.application;
  app && app.fire("entity:load", { options: options });

  var _klassName = fabric.util.string.camelize(fabric.util.string.capitalize(type || options.type || app.prototypes.Object.type, true));
  var _klass = fabric[_klassName];

  if (!_klass) {
    console.error(_klassName + " is undefined");

    var _text = options.text && options.text.constructor == String ? options.text : _klassName;
    delete options.text;
    return callback(new fabric.Text(_text, options));
  }

  var el = _klass.fromObject(options, function (el) {
    callback && callback(el);
    callback = null;
  });
  if (el) {
    callback && callback(el);
    callback = null;
  }
  return el;
};

fabric.util.dataURItoBlob = function (dataURI, dataTYPE) {
  var binary = atob(dataURI.split(',')[1]),
      array = [];
  for (var i = 0; i < binary.length; i++) {
    array.push(binary.charCodeAt(i));
  }
  return new Blob([new Uint8Array(array)], { type: dataTYPE });
};

fabric.util.blobToDataURL = function (blob, callback) {
  var a = new FileReader();
  a.onload = function (e) {
    callback(e.target.result);
  };
  a.readAsDataURL(blob);
};

fabric.util.createCanvasElementWithSize = function (size) {
  var canvas = fabric.util.createCanvasElement();
  canvas.width = size.width;
  canvas.height = size.height;
  return canvas;
};

fabric.util.string.toDashed = function (str) {
  return str.replace(/([a-z])([A-Z])/g, '$1-$2').toLowerCase();
};

fabric.util.string.uncapitalize = function (string) {
  return string.charAt(0).toLowerCase() + string.slice(1);
};
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 20 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

/**
 * @private
 * @param {String} eventName
 * @param {Function} handler
 */

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

function _removeEventListener(eventName, handler) {
  if (!this.__eventListeners[eventName]) {
    return;
  }
  var eventListener = this.__eventListeners[eventName];
  if (handler) {
    eventListener.splice(eventListener.indexOf(handler), 1);
  } else {
    eventListener.length = 0;
  }
}

fabric.Canvas.prototype.stopObserving = fabric.Object.prototype.stopObserving = function stopObserving(eventName, handler) {
  if (!this.__eventListeners) {
    return;
  }

  // remove all key/value pairs (event name -> event handler)
  if (arguments.length === 0) {
    for (eventName in this.__eventListeners) {
      _removeEventListener.call(this, eventName);
    }
  }
  // one object with key/value pairs was passed
  else if (arguments.length === 1 && _typeof(arguments[0]) === 'object') {
      for (var prop in eventName) {
        _removeEventListener.call(this, prop, eventName[prop]);
      }
    } else {
      _removeEventListener.call(this, eventName, handler);
    }
  return this;
};

fabric.Observable.on = fabric.Canvas.prototype.on = fabric.Object.prototype.on = function (eventName, handler, priority) {
  if (eventName.constructor == Object) {
    for (var i in eventName) {
      this.on(i, eventName[i], priority);
    }
    return this;
  }
  var events = eventName.split(" ");
  for (var i in events) {
    eventName = events[i];
    this.observe(eventName, handler);
    if (priority) {
      this.__eventListeners[eventName].unshift(this.__eventListeners[eventName].pop());
    }
  }
  return this;
};
fabric.Canvas.prototype.off = fabric.Object.prototype.off = function (eventName, handler) {
  var events = eventName.split(" ");
  for (var i in events) {
    this.stopObserving(events[i], handler);
  }
  return this;
};

fabric.Canvas.prototype.fire = fabric.Object.prototype.fire = function fire(eventName, options) {
  if (!this.__eventListeners) {
    return;
  }

  var listenersForEvent = this.__eventListeners[eventName];
  if (listenersForEvent) {
    for (var i = 0, len = listenersForEvent.length; i < len; i++) {
      listenersForEvent[i].call(this, options || {});
    }
  }

  var listenersForEventAll = this.__eventListeners['*'];
  if (listenersForEventAll) {
    options = options || {};
    options.eventName = eventName;
    options.listeners = listenersForEvent;
    for (i = 0, len = listenersForEventAll.length; i < len; i++) {
      listenersForEventAll[i].call(this, options);
    }
  }

  return this;
};
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 21 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

/**
 * # Application
 *
 * farbic.app function is the entry point of FabricJS application.
 * Application could be initialised with configuration object. Different extensions allows to initialize special application attributes such as *object prototypes*, *resizable canvas*, *available fonts*, etc.
 *
 * ### option: util
 * mediaRoot - root directory for all media files in fabric application
 *
 * ### option: resizable
 * makes canvas responsible. Canvas will be scaled to 100% of its container size
 *
 * ### option: onResize
 * function which override deafult canvas resize behavior.
 *
 * ### option: callback
 * function calls after canvas initialized
 *
 * ### option: initialize
 * function calls before canvas initialize
 *
 * @example
 *
 * new fabric.Application({
 *      resizable: true,
 *      onResize: function(){},
 *      util: {
 *        mediaRoot: '../../media/'
 *      },
 *      canvasContainer: "fiera-canvas",
 *      prototypes: {},
 *      objects: {},
 *      eventListeners: {},
 *      callback: function(){},
 *      initialize:  function(){}
 *      customPublicApplicationFunction: function(){},
 *      customPublicApplicationAttribute: value
 *  })
 *
 */

fabric.Application = function (options) {
  this.init(options);
};

fabric.Application.prototype = fabric.util.object.extend({}, fabric.Observable, {
  defaultOptions: {
    /**
     * id of target canvas element
     */
    canvasContainer: null
  },
  credentials: false,
  ready: false,
  canvasClass: 'Canvas',
  optionsOrder: ["canvasContainer", "*", "objects", "slide"],
  plugins: {
    preloaders: [],
    configuration: [],
    canvas: []
  },
  /**
   * Additional Event Listeners couldbe used to detect activeobject changes
   *  - canvas:created
   *  - entity:load - Event fired on creation of every new fabric instance(canvas,brush,object)
   *
   *  @example
   *  'entity:load' : function(e){
   *     if(e.options.boxType == 'machine') {
   *       e.options.type = "machine-mask-rectangle";
   *     }
   *   }
   */
  eventListeners: {
    "canvas:created": [],
    "entity:created": [function (e) {
      if (e.target.eventListeners) {
        for (var i in e.target.eventListeners) {
          var _listeners = e.target.eventListeners[i];
          if (_listeners.constructor == Array) {
            for (var j in _listeners) {
              e.target.on(i, _listeners[j]);
            }
          } else {
            e.target.on(i, _listeners);
          }
        }
      }

      if (e.options.eventListeners) {
        for (var i in e.options.eventListeners) {
          e.target.on(i, e.options.eventListeners[i]);
        }
      }
      delete e.options.eventListeners;

      if (e.target._default_event_listeners) {
        for (var i in e.target._default_event_listeners) {
          e.target.on(i, e.target._default_event_listeners[i]);
        }
      }
    }]
  },
  onSlideLoaded: function onSlideLoaded() {},
  onCanvasCreated: function onCanvasCreated() {},
  callback: function callback() {},

  init: function init(options) {
    this.initEventListeners();
    options = fabric.util.object.deepExtend({}, this.defaultOptions, options || {});

    this.fire("loading:begin", { options: options });

    this._options = options;

    $(document).ready(function () {
      fabric.util.order([this.preloader, this.loadConfiguration,
      //    this.createApp,
      this.initOptions, this.initialize, this.onApplicationCreated, this.postloader, this.callback && function () {
        setTimeout(this.callback.bind(this), 0);
      }, function () {
        this.fire("ready");
      }.bind(this)], this);
    }.bind(this));
  },
  onApplicationCreated: function onApplicationCreated() {
    this.ready = true;
    this.fire("loading:end", {});
  },
  setCredentials: function setCredentials(credentials) {
    if (credentials) {
      console.info("%cFiera Canvas Editor%c by %cDenis Ponomarev%c %c%6$s%c / %c%9$s%c", "color: #ffa500", "color: #202020", "color: #2EC06C", "color: #202020", "color: #337ab7", "www.hometlt.ru", "color: #202020", "color: #337ab7", "ponomarevtlt@gmail.com", "color: #202020");
    }
  },
  initOptions: function initOptions(resolve, error) {
    this.set(this._options, resolve);
  },
  configurationProperties: [],
  loadConfiguration: function loadConfiguration(resolve, error) {

    if (this.configurationProperties) {
      var _iteratorNormalCompletion = true;
      var _didIteratorError = false;
      var _iteratorError = undefined;

      try {
        for (var _iterator = this.configurationProperties[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
          var prop = _step.value;


          if (this._options[prop]) {
            if (!this._options.configuration) {
              this._options.configuration = {};
            }
            this._options.configuration[prop] = this._options[prop];
          }
        }
      } catch (err) {
        _didIteratorError = true;
        _iteratorError = err;
      } finally {
        try {
          if (!_iteratorNormalCompletion && _iterator.return) {
            _iterator.return();
          }
        } finally {
          if (_didIteratorError) {
            throw _iteratorError;
          }
        }
      }
    }

    if (!this._options.configuration) {
      return resolve();
    }
    var _app = this;
    fabric.util.promise.map(this._options.configuration, function (value) {
      return new Promise(function (resolve, fail) {
        fabric.util.data.loadJson(value, resolve, fail);
      });
    }).then(function (results) {
      fabric.util.object.extend(_app._options, results);
    }).then(resolve, error);
  },
  setCanvasContainer: function setCanvasContainer(canvasContainer) {
    this.canvasContainer = canvasContainer;

    if (canvasContainer.constructor == String) {
      var el = document.getElementById(canvasContainer);
    } else {
      el = canvasContainer;
    }
    this.canvas = new fabric[this.canvasClass](el, { application: this });
    // }else{
    //   this.canvas = new fabric[this.canvasClass]({application: this});
    // }

    this.fire("canvas:created");
    this.onCanvasCreated();
  },
  dispose: function dispose() {
    this.canvas.dispose();
  },

  //--------------------------------------------------------------------------------------------------------------------
  // Event Listeners
  //--------------------------------------------------------------------------------------------------------------------

  setEventListeners: function setEventListeners(val) {
    this.on(val);
  },
  initEventListeners: function initEventListeners() {
    if (!this.__eventListeners) {
      this.__eventListeners = {};
    }
    for (var event in this.eventListeners) {
      if (!this.__eventListeners[event]) {
        this.__eventListeners[event] = [];
      }
      this.__eventListeners[event] = this.__eventListeners[event].concat(this.eventListeners[event]);
    }
  },

  //--------------------------------------------------------------------------------------------------------------------
  //
  __set: fabric.Object.prototype.__set,
  _setObject: fabric.Object.prototype._setObject,
  set: fabric.Object.prototype.set,
  setOptions: fabric.Object.prototype.setOptions,
  actions: {
    save: {
      title: "save project",
      className: 'fa fa-floppy-o',
      action: function action() {
        var data = this.toObject();
        this.application.api.save(data);
      }
    }
  }
});

// fabric.Application.addPlugin = fabric.PluginsMixin.addPlugin.bind(fabric.Application);

fabric.app = function (options) {
  return new fabric.Application(options);
};
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 22 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

__webpack_require__(6);

/**
 * # SlideCanvas
 * Inherited from fabric.Canvas
 *
 *

 ## method: load

Mathod allows to add new objects and set new attributes of canvas.

 ```javascript
 load : ({
    backgroundImage: string,
    objects: [FabricShapeOptions],
    customSyncOption: any,
    customAsyncOption: any
  },callback) : void
 ```

 To extend loading behavior and use custom options it is possible to define **set fucntions** in Canvas prototype.

 ```javascript
 // Canvas Prototype
 setCustomAsyncOption: function(val,callback){
  this.doAsyncMethod(val,callback)
}
 setCustomSyncOption: function(val){
  this.customSyncOtion = val;
}
 ```

 ### attribute: backgroundImageProperties

 default attributes for background image

 ### freeDrawingBrush

 default active drawing brush

 ```
 freeDrawingBrush: "PaintBucketBrush" | "PaintPenBrush" | "PencilBrush"
 ```

 ### attribute: onSlideLoaded

 onSlideLoaded calls as a callback for load fucntion

 ### attribute: backgroundPosition

 onSlideLoaded calls as a callback for load fucntion

 ```
 backgroundPosition: 'manual' | 'resize' | 'fit' | 'cover' | 'center'
 ```

 - manual - background will ne not scaled and put at left top corner
 - resize - canvas will be resized according to image size
 - fit - will be scaled to fit canvas size
 - cover - will be scaled to cover all canvas size
 - center - backogrund will be not scaled but put in the middle

 ### method: setInteractiveMode

 switch between drawing and hand( moving cunvas by mouse) modes

 ```javascript
 canvas.setInteractiveMode( mode : "hand" | "mixed") : void
 ```

 ### drawingColor

 drawing color using by brushes

 */

fabric.util.object.extend(fabric.StaticCanvas.prototype, {

  setBackgroundColor: function setBackgroundColor(backgroundColor, callback) {

    if (this.loaded) {
      var originalState = { backgroundColor: this.backgroundColor };
    }

    return this.__setBgOverlayColor('backgroundColor', backgroundColor, function () {
      this.renderAll();

      if (this.loaded) {
        this.fire('modified', { states: {
            original: originalState,
            modified: { backgroundColor: backgroundColor }
          } });
      }
      callback && callback();
    }.bind(this));
  },
  storeProperties: ['*', 'backgroundColor', 'backgroundImage', 'width', 'height'],

  toObjectSync: function toObjectSync(propertiesToInclude) {
    propertiesToInclude = (propertiesToInclude || []).concat(this.storeProperties);

    var _data = {
      objects: this.getObjects(),
      width: this.originalWidth || this.width,
      height: this.originalHeight || this.height
    };
    fabric.util.populateWithProperties(this, _data, propertiesToInclude);

    this.fire("before:object", { object: _data });

    return _data;
  },
  toObject: function toObject(propertiesToInclude) {
    var _this = this;

    propertiesToInclude = (propertiesToInclude || []).concat(this.storeProperties);

    var _objs = this.getObjects();

    _objs = fabric.util.object.filter(_objs, { stored: true });
    _objs = _objs.map(function (instance) {
      return instance.toObject(_this.objectsPropertiesToInclude);
    });

    var _data = {
      objects: _objs
    };

    fabric.util.populateWithProperties(this, _data, propertiesToInclude);

    if (propertiesToInclude.indexOf('backgroundImage') !== -1) {
      fabric.util.object.extend(_data, this.__serializeBgOverlay());
    }

    if (propertiesToInclude.indexOf('width') !== -1 && this.originalWidth) {
      _data.width = this.originalWidth;
    }
    if (propertiesToInclude.indexOf('height') !== -1 && this.originalHeight) {
      _data.height = this.originalHeight;
    }

    /*
     function serializeThumb(propertiesToInclude, _data){
     if(propertiesToInclude.indexOf('thumb') !== -1){
     var size = fabric.util.getProportions(this.getOriginalSize(), this.thumbSize, 'fit');
     var canvas = fabric.util.createCanvasElement();
     canvas.width = size.width;
     canvas.height = size.height;
     this.renderThumb(canvas);
     _data.thumb = canvas.toDataURL();
     }
     },
     function serializeTemplate(propertiesToInclude, _data) {
     if (propertiesToInclude.indexOf('template') !== -1) {
     if (this.template) {
     for (var i in _data.template) {
     if (JSON.stringify(_data[i]) == JSON.stringify(_data.template[i])) {
     delete _data[i];
     }
     }
     _data.template = this.template.id;
     }
     }
     }*/

    this.fire("before:object", { object: _data });

    return _data;
  },
  setTemplate: function setTemplate(template) {

    this.template = template;
    if (!template) return;

    this.setWidth(this.slideWidth || template.width);
    this.setHeight(this.slideHeight || template.height);
    this.originalHeight = this.height;
    this.originalWidth = this.width;

    this.set(fabric.util.object.rearrange(template, ["areas", "helpers", "offsets"]));

    this._update_clip_rect();
    this._update_background_image();
    this.fire("modified", { type: "template" });
    this.renderAll();
  },
  addText: function addText(text, options) {
    this.createObject({
      position: "center",
      text: text,
      type: this.defaultTextType,
      clipTo: this.activeArea,
      movementLimits: this.activeArea
    });
  }
});

fabric.SlideCanvas = fabric.util.createClass(fabric.Canvas, fabric.PluginsMixin, {
  type: 'canvas',
  /**
   * initialized width of the canvas
   */
  width: 160,
  /**
   * initialized height of the canvas
   */
  height: 90,
  /**
   * output quality
   */
  dotsPerUnit: 1,
  scale: 1,
  loaded: false,
  /**
   * allow user to interact with canvas
   */
  interactive: true,
  /**
   * fill not the slide area, but whole canvas with background color
   */
  defaultText: "text",
  defaultTextType: "text",
  thumbSize: {
    width: 50,
    height: 100
  },

  contextTopImageSmoothingEnabled: true,
  plugins: {
    initialize: [],
    preloaders: [],
    loaders: []
  },
  setInteractive: function setInteractive(value) {
    this.interactive = value;
  },

  _createUpperCanvas: function _createUpperCanvas() {
    fabric.Canvas.prototype._createUpperCanvas.call(this);
    var ctx = this.contextTop;

    if (ctx.imageSmoothingEnabled) {
      ctx.imageSmoothingEnabled = this.contextTopImageSmoothingEnabled;
      return;
    }
    ctx.webkitImageSmoothingEnabled = this.contextTopImageSmoothingEnabled;
    ctx.mozImageSmoothingEnabled = this.contextTopImageSmoothingEnabled;
    ctx.msImageSmoothingEnabled = this.contextTopImageSmoothingEnabled;
    ctx.oImageSmoothingEnabled = this.contextTopImageSmoothingEnabled;
  },
  _onMouseUpInDrawingMode: function _onMouseUpInDrawingMode(e) {
    this._isCurrentlyDrawing = false;
    if (this.clipTo) {
      this.contextTop.restore();
    }
    var pointer = this.getPointer(e);
    this.freeDrawingBrush.onMouseUp(pointer);
    this._handleEvent(e, 'up');
  },
  initialize: function initialize(el, options, callback) {
    if (el && el.constructor == Object) {
      callback = options;
      options = el;
      el = null;
    }
    options = options || {};

    if (options.application) {
      options.application.fire("entity:created", { target: this, options: options });
    }

    this.id = fabric.SlideCanvas.__idcounter++;

    this._objects = [];
    this._createLowerCanvas(el);

    this.created = true;
    this._currentTransform = null;
    this._groupSelector = null;
    this._initWrapperElement();
    this._createUpperCanvas();
    this._initEventListeners();
    this._initRetinaScaling();
    this.calcOffset();

    this.wrapperEl.appendChild(this.upperCanvasEl);

    this._createCacheCanvas();
    this._setImageSmoothing();
    this._initRetinaScaling();

    this.set(options);
    this._initSize();

    this.calcOffset();

    this.fire("created");
    // if(this.application){
    //   this.application.fire("canvas:created",{target : this});
    // }
  },
  animated: false,
  setAnimated: function setAnimated(val) {
    this.animated = val;
    if (val) {
      fabric.util.requestAnimFrame(function render() {
        this.renderAll();
        fabric.util.requestAnimFrame(render);
      }.bind(this));
    }
  },
  create: function create() {
    this.created = true;
    this._initInteractive();
    this._createCacheCanvas();
  },
  /**
   * Additional Event Listeners
   *  - loading:end
   *  - target:modified - couldbe used to detect active object changes
   *  - target:changed
   *  - target:cleared
   */
  eventListeners: {
    'object:moving': function objectMoving(obj) {
      this.fire('target:modified', this, obj);
    },
    'selection:cleared': function selectionCleared(event) {
      if (!this.target) return;
      this.target.fire('deselected', event);
      this.target = null;
      this.fire('target:cleared', event);
    },
    'object:selected': function objectSelected(event) {
      event.previous = this.target;
      this.target = event.target;
      if (event.previous) {
        event.previous.fire('deselected', event);
      }
      this.fire('target:changed', event);
    },
    'group:selected': function groupSelected(event) {
      this.target = event.target;
      this.fire('target:changed', event);
    }
  }
});
fabric.SlideCanvas.__idcounter = 0;
fabric.SlideCanvas.fromJson = function (url, callback, element) {
  fabric.util.data.loadJson(url, function (data) {
    new fabric.SlideCanvas(element, data, callback);
  });
};

fabric.SlideCanvas.prototype.actions = fabric.util.object.extend({}, {
  selectAll: {
    title: 'selectAll',
    type: 'key'
  },
  backgroundColor: {
    type: "color"
  },
  addText: {
    className: 'fa fa-font',
    title: 'text',
    action: function action() {
      this.addText(this.defaultText, {});
    }
  }
});

fabric.util.object.extend(fabric.Application.prototype, {
  setSlide: function setSlide(value, callback) {
    var _canvas = this.canvas;
    if (_canvas.load) {
      _canvas.load(value, callback);
    } else {
      _canvas.createObjects(value, callback);
    }
  }
});

fabric.Application.prototype.canvasClass = 'SlideCanvas';
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 23 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.Slide = function (application, slide) {

  if (fabric.isLikelyNode) {
    // fabric.Canvas = fabric.SlideCanvas;
    var w = slide.slideWidth; //todo|| slide.template.width;
    var h = slide.slideHeight; //todo || slide.template.height;
    var zoom = fabric.SlideCanvas.prototype.zoom || 1;
    this.canvas = fabric.createCanvasForNode(w * zoom, h * zoom);
  } else {
    var $canvas = fabric.util.createCanvasElement();
    this.canvas = new fabric.StaticCanvas($canvas, { application: application, interactive: false });
  }

  this.object = slide;
  // this.data = slide.data;
  this.application = application;
  this.id = ++fabric.Slide._slides_id_counter;
};

fabric.Slide.prototype = fabric.util.object.extend({}, fabric.Observable);

fabric.Slide._slides_id_counter = 1;

fabric.Application.prototype.configurationProperties.push("slides");
fabric.util.object.extend(fabric.Application.prototype, {
  defaultOptions: fabric.util.object.extend(fabric.Application.prototype.defaultOptions, {
    activeSlide: 0
  }),
  optionsOrder: function () {
    var oo = fabric.Application.prototype.optionsOrder;
    oo.push("slides", "activeSlide");
    return oo;
  }(),
  /*initialize: function (options) {
    fabric.util.object.extend(this, {
   last_id: 1,
   scaleValue: 1,
   activeSlide: null,
   history: null,
   slides: [],
   canvas: null
   });
    this.aligmentLineX = false;
   this.aligmentLineY = false;
    fabric.util.object.extend(this,options);
   fabric.util.object.defaults(options,this.defultOptions);
    // this.setAccess(this.access);
    if(options.gridsnapper !== undefined) {
   this.gridsnapper = options.gridsnapper
   }
   if(options.history !== undefined) {
   this.history = options.history;
   }
   if(options.data){
   this.data = options.data;
   }
   if(this.history) {
   this.history = new History(this);
   this.history.application = this.application;
   }
     if(options.canvas){
   var _canvas = new fabric.SlideCanvas(document.getElementById(options.canvas));
   _canvas.application = this.application;
   _canvas.project = this;
   this.setCanvas(_canvas);
   }
    return this;
   },*/
  setSlides: function setSlides(value, callback) {
    var _this = this;

    fabric.util.data.loadJson(value, function (slides) {

      _this.slides = [];

      if (_this.canvas) {
        _this.canvas._objects.length = 0;
      }

      slides.forEach(function (slide) {
        return _this.addSlide(slide);
      });

      _this.preload();
      _this.lazyLoad();
      callback();
    }, function () {
      console.error("slides loading failed");
    });
  },
  _setActiveSlide: function _setActiveSlide(slide) {

    this.fire("slide:change:begin", { canvas: this.canvas });
    if (this.activeSlide) {
      delete this.activeSlide.canvas.mirrorSlide;
    }

    this.processing = true;
    if (this.unloadUnactiveSlides && this.canvas && this.activeSlide) {
      delete this.activeSlide.canvas;
      this.activeSlide.fire("canvas:changed", { canvas: null });
      this.activeSlide.data = this.canvas.toObject();
      this.canvas.clear();
    }
    this.activeSlide = slide;
    this.activeSlide.canvas.mirrorSlide = this.canvas;

    this.canvas.processing = true;
    this.canvas.setSlide(this.activeSlide);
    this.fire("slide:changed", { canvas: this.canvas });
    this.canvas.processing = false;
    this.canvas.renderAll();
  },

  setActiveSlide: function setActiveSlide(slideId) {
    var _this2 = this;

    var slide = void 0;

    if (!this.slides) {
      return false;
    }
    if (slideId.constructor === Number) {
      slide = this.slides[slideId];
    } else if (slideId.constructor === String) {} else {
      slide = slideId;
    }

    if (this.activeSlide === slide) return;

    if (slide.canvas.loaded) {
      this._setActiveSlide(slide);
    } else {
      slide.canvas.on("loading:end", function () {
        _this2._setActiveSlide(slide);
      });
    }
  },
  unloadUnactiveSlides: false,
  lazyLoadEnabled: true,
  lazyLoad: function lazyLoad() {

    var app = this;
    if (this.lazyLoadEnabled) {
      this.slides.forEach(function (slide) {
        if (!slide.canvas.loaded && !slide.canvas.processing) {
          slide.canvas.load(slide.object, function () {
            slide.fire("loaded");
            // if(app.activeSlide === slide.id){
            //   this.setActiveSlide(slide);
            // }

            app.fire("slide:loading:end", { target: this });

            for (var _s in app.slides) {
              if (!app.slides[_s].canvas.loaded) {
                return;
              }
            }
            app.fire("loading:end", {});
          }.bind(slide));
        }
      });
    } else {
      app.fire("loading:end", {});
    }
  },
  addSlide: function addSlide(options) {
    var slide = new fabric.Slide(this, options);
    this.slides.push(slide);
    return slide;
  },
  removeSlide: function removeSlide(slide) {
    var _s = this.slides;
    var _curPos = _s.indexOf(slide);
    _s.splice(_curPos, 1);

    if (slide === this.activeSlide) {
      delete this.activeSlide;
    }
  },
  /**
   * move slide to another position
   * @param slide
   * @param newPosition
   */
  moveSlide: function moveSlide(slide, newPosition) {
    var _s = this.slides;

    var _curPos = _s.indexOf(slide);
    newPosition = parseInt(newPosition);

    if (_curPos < newPosition) {
      _s.splice(_curPos, 1);
      _s.splice(newPosition, 0, slide);
    } else {
      _s.splice(_curPos, 1);
      _s.splice(newPosition, 0, slide);
    }
  },
  /**
   * replace slide
   * @param slide
   * @param newPosition - position of the second slide
   */
  replaceSlide: function replaceSlide(slide, newPosition) {
    var _s = this.slides;
    var _replacedSlide = _s[newPosition];
    var _curPos = _s.indexOf(slide);
    if (_curPos < newPosition) {
      _s.splice(newPosition, 1, slide);
      _s.splice(_curPos, 1, _replacedSlide);
    } else {
      _s.splice(_curPos, 1, _replacedSlide);
      _s.splice(newPosition, 1, slide);
    }
  },

  preload: function preload() {
    for (var i in this.slides) {
      var _slide = this.slides[i];
      // _slide.canvas.preload(_slide.object, function () {
      //   _slide.fire("modified");
      // });
    }
  },

  setActiveSlideByIndex: function setActiveSlideByIndex(index) {
    this.setActiveSlide(this.slides[index]);
  },
  setActiveSlideById: function setActiveSlideById(id) {
    this.setActiveSlide(fabric.util.object.findWhere(this.slides, { id: id }));
  },
  duplicateSlide: function duplicateSlide(slideData) {
    slideData = slideData.canvas.toObject();
    var _slide = this.addSlide(slideData);
    _slide.canvas.load(_slide.object);
  },

  nextSlide: function nextSlide() {
    var i = this.slides.indexOf(this.activeSlide);
    if (i < this.slides.length - 1) {
      this.setActiveSlide(i + 1);
    }
  },
  prevSlide: function prevSlide() {
    var i = this.slides.indexOf(this.activeSlide);
    if (i > 0) {
      this.setActiveSlide(i - 1);
    }
  },
  gotoSlide: function gotoSlide(slide) {
    this.setActiveSlide(slide - 1);
  },
  nextSlideAvailable: function nextSlideAvailable() {
    var i = this.slides.indexOf(this.activeSlide);
    return i < this.slides.length - 1;
  },
  prevSlideAvailable: function prevSlideAvailable() {
    var i = this.slides.indexOf(this.activeSlide);
    return i > 0;
  },
  createSlidesList: function createSlidesList($container) {
    var _this3 = this;

    var $slideList = this.$slidesList = $("<div>").addClass("slides-list");
    var $slideListInner = $("<div>").addClass("slides-list-inner");
    $slideList.append($slideListInner);

    $container.append(this.$slidesList);

    this.slides.forEach(function (slide) {
      var $element = slide.canvas.lowerCanvasEl;
      $element.setAttribute("height", 140);
      fabric.util.createThumb(slide, $element);

      var $slide = $("<div>").addClass("slide").click(function () {
        return _this3.setActiveSlide(slide);
      }).append($element).append($("<span>").html(slide.canvas.title));

      if (slide.canvas.description) {
        $slide.attr("title", slide.canvas.description);
      }

      slide.on("modified", function () {
        this.canvas.renderAll();
      });
      $slideListInner.append($slide);
    });

    return {
      list: $slideList

      //this.canvas.on( "dimensions:modified" ,this.updateThumbs.bind(this))
      //this.updateThumbs();
    };
  },

  updateThumbs: function updateThumbs() {
    var _this4 = this;

    this.slides.forEach(function (slide) {
      slide.canvas.setDimensions({ width: _this4.canvas.width, height: _this4.canvas.height });
    });
  }
});

fabric.util.object.extend(fabric.SlideCanvas.prototype, {
  title: "New Slide",
  /**
   * Copy the content of active slide to main canvas.
   * @param slide
   */
  setSlide: function setSlide(slide) {

    this.loaded = false;
    this._objects = [];

    this.set(slide.canvas.toObjectSync());
    this.slide = slide;
    var sc = slide.canvas;

    sc._objects = this._objects;

    this.discardActiveGroup();
    this.discardActiveObject();
    /*
    // this.slideWidth = sc.slideWidth;
    // this.slideHeight = sc.slideHeight;
    this.setOriginalSize({width: sc.originalWidth || sc.width, height: sc.originalHeight || sc.height})
    this.backgroundImage = sc.backgroundImage;
    this.backgroundColor = sc.backgroundColor;
     if(this.resizable) {
      this.originalWidth  = sc.originalWidth;
      this.originalHeight  = sc.originalHeight ;
    }else{
      this.setWidth((sc.originalWidth || sc.width)* this.viewportTransform[0]);
      this.setHeight((sc.originalHeight || sc.height)  * this.viewportTransform[0]);
    }*/
    this._onResize();
    // this.activeArea = sc.activeArea;
    //this.originalSlide = sc;

    // this.template = sc.template;
    //  this.offsets = sc.offsets;
    // this._objects = [];
    // this.layers = sc.layers;

    /* if(this.backgroundImage){
       this.backgroundImage.canvas = this;
     }*/
    //todo
    // if(this._backgroundLayer) {
    //   for (var i in this._backgroundLayer) {
    //     this._backgroundLayer[i].canvas = this;
    //     this._backgroundLayer[i].setCoords();
    //   }
    //   this.setActiveArea(true);
    // }cd fier

    /*for(var layerName in sc.layers) {
      this.layers[layerName].objects = [];
    }*/
    // this._objects = this._objects;

    /*if(sc.layers) {
      for(var layerName in sc.layers){
        for (var i in sc.layers[layerName].objects) {
          this.add(sc.layers[layerName].objects[i]);
        }
        sc.layers[layerName].objects = this.layers[layerName].objects;
      }
      sc._objects = this._objects;
    }else{*/

    /*this._objects = [];
    for (let i in sc._objects) {
      this.add(sc._objects[i]);
    }*/
    // }

    this.loaded = true;
    this.fire('changed', { target: sc });
  },
  unique: false,
  required: false,
  stateProperties: ["unique", "required"],
  removeSlide: function removeSlide() {
    this.project.removeSlide(this);
  },
  duplicateSlide: function duplicateSlide() {
    this.project.duplicateSlide(this);
  },

  eventListeners: fabric.util.object.extendArraysObject(fabric.SlideCanvas.prototype.eventListeners, {
    "modified": function modified(e) {
      if (this.slide) {
        this.slide.canvas.set(e.states.modified);
        this.slide.fire("modified");
      }
    },
    "object:modified": function objectModified() {
      if (this.slide) {
        this.slide.fire("modified");
      }
    }
  })
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 24 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

/**
 * # Prototypes

 Prototypes allows to define **prototypes** property in Application configuration.

 ```javascript
 Application ({
  prototypes: {
    ClassName: options
  }
 })
 ```

 If prototype is defined every new Object created by application will have this properties by default.

 ```javascript
   NewClass: {
    $super: "ParentClass",
    type: "new-class",
    \/*other properties and methods*\/
   }
  ```

 if property **type** of Object class is defined then every object be default will have this type.

 ```javascript
   Object: {
    type: "rectangle"
   }
 ...
 //rectangle will be created
 fabric.createObject({width:100, height: 100})
 ```
*/

fabric.util.object.extend(fabric.Application.prototype, {
  optionsOrder: function () {
    var oo = fabric.Application.prototype.optionsOrder;
    oo.splice(oo.indexOf("canvasContainer"), 0, "prototypes");
    return oo;
  }(),
  getDefaultProperties: function getDefaultProperties(proto) {
    if (!this.prototypes) return;

    var klassname = fabric.util.string.capitalize(fabric.util.string.camelize(proto.type), true);

    var _protoProperties = proto.__proto__ && proto.__proto__.type && this.getDefaultProperties(proto.__proto__) || {};
    var _defaultProperties = fabric.util.object.clone(this.prototypes[klassname]);

    fabric.util.object.extend(_protoProperties, _defaultProperties);

    return _protoProperties;
  },
  /**
   * default prototypes propertes for objects
   */
  prototypes: {
    Object: {
      includeDefaultValues: false
    },
    Canvas: {
      includeDefaultValues: false
    }
  },
  setUtils: function setUtils(utilsOptions) {

    if (!utilsOptions) {
      return;
    }
    fabric.util.object.extend(this.util || {}, utilsOptions);

    if (this.options['util']) {
      fabric.util.object.extend(fabric.util, this.options['util']);
    }
    if (this.options['fabric']) {
      fabric.util.object.extend(fabric, this.options['fabric']);
    }
    delete this.options['fabric'];
    delete this.options['util'];
  },
  setPrototypes: function setPrototypes(prototypes) {

    var _prototypes = fabric.util.object.deepExtend({}, this.prototypes, prototypes);

    this.prototypes = _prototypes;

    if (_prototypes.eventListeners) {
      _prototypes.eventListeners.$extend = 'array';
    }

    for (var klassName in _prototypes) {
      var _proto = _prototypes[klassName];

      for (var j in _proto) {
        if (_proto[j] && _proto[j]["$extend"]) {
          var _extend = _proto[j]["$extend"];
          if (_extend == "array") {
            _proto[j] = fabric.util.object.extendArraysObject(fabric[klassName].prototype[j], _proto[j]);
          } else if (_extend == "deep") {
            _proto[j] = fabric.util.object.deepExtend(fabric[klassName].prototype[j], _proto[j]);
          } else {
            _proto[j] = fabric.util.object.extend(fabric[klassName].prototype[j], _proto[j]);
          }
          delete _proto[j]["$extend"];
        }
      }

      if (_proto["$super"]) {
        var _superklass = fabric[_proto["$super"] || klassName];
        delete _proto["$super"];

        var _fromObject = _proto.fromObject || _superklass.fromObject;
        delete _proto.fromObject;
        var _klass = fabric[klassName] = fabric.util.createClass(_superklass, _proto);
        _klass.fromObject = _fromObject.bind(_klass);
      }

      //   if (klassName.actions && _proto.actions.constructor == Function) {
      //     fabric[klassName].prototype.actions = _proto.actions.call(fabric[klassName].prototype)
      //   }
    }

    if (_prototypes.Application) {
      fabric.util.object.deepExtend(this, _prototypes.Application);
    }

    // delete this.options['prototypes'];

    if (this.actions && this.actions.constructor == Function) {
      this.actions = this.actions.call(this);
    }
  },
  eventListeners: fabric.util.object.extendArraysObject(fabric.Application.prototype.eventListeners, {
    "entity:created": function entityCreated(e) {
      var target = e.target;
      target.application = this;

      if (!target.disableDefaultProperties) {

        fabric.util.object.defaults(e.options, this.getDefaultProperties(target, e.options));

        for (var key in e.options) {
          var value = e.options[key];
          if (key[0] == "+") {
            var _key = key.substr(1);
            var _arr = target.get(_key);
            if (_arr instanceof Array) {
              _arr = _arr.slice().concat(value);
            } else {
              _arr = fabric.util.object.extend({}, _arr, value);
            }
            e.options[_key] = _arr;
            delete e.options[key];
          }
        }
      }

      delete e.options.type;
      delete e.options.application;
    }
  })
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 25 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

var isVML = function isVML() {
  return typeof G_vmlCanvasManager !== 'undefined';
};

//weird stuff
// delete fabric.Rect.prototype.toObject;
// fabric.Rect.prototype.storeProperties = ["*","rx","ry"];

fabric.INCLUDE_ALL = "*";

var _toObject_overwritten = fabric.Object.prototype.toObject;
fabric.util.object.extend(fabric.Object.prototype, {
  storeProperties: ['*'],
  eventListeners: {},
  toObject: function toObject(propertiesToInclude) {
    if (propertiesToInclude == fabric.INCLUDE_ALL) {
      propertiesToInclude = [fabric.INCLUDE_ALL];
    }

    propertiesToInclude = propertiesToInclude || [];
    propertiesToInclude = propertiesToInclude.concat(this.storeProperties);

    var obj = _toObject_overwritten.call(this, propertiesToInclude);
    if (propertiesToInclude[0] !== fabric.INCLUDE_ALL) {
      if (!this.includeDefaultValues) {
        this._removeDefaultValues(obj);
      }
    }

    if (this.storeProperties.indexOf("*") == -1) {
      for (var i in obj) {
        if (this.storeProperties.indexOf(i) == -1) {
          delete obj[i];
        }
      }
    }

    this.fire("before:object", { object: obj });
    return obj;
  },
  /**
   * Sets object's properties from options
   * @param {Object} [options] Options object
   */
  setOptions: function setOptions(options) {
    this._setObject(options);
    // this._initGradient(options);
    // this._initPattern(options);
    // this._initClipping(options);
  },
  _initEntity: function _initEntity(options) {
    if (options.canvas && !options.application) {
      options.application = options.canvas.application;
    }
    options.application && options.application.fire("entity:created", { target: this, options: options });
  },
  initialize: function initialize(options, callback) {
    options = options || {};
    this._initEntity(options);
    // if(options.wholeCoordinates){
    //   var coordinates = ["left","top","width","height"];
    //   for(var i in coordinates){
    //     if(options[coordinates[i]]){
    //       options[coordinates[i]] = Math.round(options[coordinates[i]]);
    //     }
    //   }
    // }
    var _self = this;
    this._setObject(options, function () {
      _self.loaded = true;
      _self.fire("loaded");
      callback && callback(_self);
    });
  },
  add: function add(canvas) {
    canvas.add(this);
  },
  set: function set(key, value) {
    if ((typeof key === 'undefined' ? 'undefined' : _typeof(key)) === 'object') {
      this._setObject(key);
    } else {
      if (key[0] == "&") {
        key = key.substr(1);
        this._set(key, value(this.get(key)));
      } else {
        this._set(key, value);
      }
    }
    return this;
  }
});

fabric.util.object.extend(fabric.Object.prototype, {
  hasBoundsControls: true,
  stroke: "transparent",
  onTop: function onTop() {
    return this.canvas._objects.indexOf(this) == this.canvas._objects.length - 1;
  },
  flop: function flop() {
    this.flipY = !this.flipY;
    this.canvas.renderAll();
  },
  flip: function flip() {
    this.flipX = !this.flipX;
    this.canvas.renderAll();
  },
  onBottom: function onBottom() {
    return this.canvas._objects.indexOf(this) == 0;
  },
  duplicate: function duplicate() {
    var _object = this.toObject(fabric.INCLUDE_ALL);
    _object.active = true;
    _object.left += 10;
    _object.top += 10;
    var _clone = /*this.cloneSync && this.cloneSync() || */this.canvas.createObject(_object);
    return _clone;
  },
  minStrokeWidth: 0,
  maxStrokeWidth: function maxStrokeWidth() {
    return Math.min(this.width, this.height) / 2;
  },
  actions: {
    boundingRect: {
      type: 'label',
      template: '<dt>L:</dt><dd class="{leftClass}" title="{left}">{roundLeft}</dd><dt>T:</dt><dd class="{topClass}"  title="{top}">{roundTop}</dd><dt>R:</dt><dd class="{rightClass}" title="{right}">{roundRight}</dd><dt>B:</dt><dd class="{bottomClass}"  title="{bottom}">{roundBottom}</dd>',
      value: {
        observe: "modified scaling moving rotating",
        get: function get() {
          var _rect = this.getBoundingRect();

          if (this.movementLimits) {

            if (this.movementLimits == this.canvas) {
              var _v = this.canvas.viewportTransform;
              var _mlr = {
                left: _v[4],
                top: _v[5],
                width: (this.canvas.originalWidth || this.canvas.width) * _v[0],
                height: (this.canvas.originalHeight || this.canvas.height) * _v[3],
                right: 0,
                bottom: 0
              };
            } else {
              _mlr = this.movementLimits.getBoundingRect();
            }

            _rect.bottom = this.movementLimits.height - _rect.height;
            var _t = _rect.top - _mlr.top;
            var _l = _rect.left - _mlr.left;
            var _r = _mlr.width - _rect.width - _l;
            var _b = _mlr.height - _rect.height - _t;
          } else {
            _t = _rect.top;
            _l = _rect.left;
            _b = this.canvas.height - _rect.height - _rect.top;
            _r = this.canvas.width - _rect.width - _rect.left;
          }

          return {
            topClass: _t > 0 ? "positive" : _t < 0 ? "negative" : "zero",
            bottomClass: _b > 0 ? "positive" : _b < 0 ? "negative" : "zero",
            leftClass: _l > 0 ? "positive" : _l < 0 ? "negative" : "zero",
            rightClass: _r > 0 ? "positive" : _r < 0 ? "negative" : "zero",
            top: _t,
            left: _l,
            bottom: _b,
            right: _r,
            roundTop: Math.round(_t),
            roundLeft: Math.round(_l),
            roundBottom: Math.round(_b),
            roundRight: Math.round(_r)
          };
        }
      }
    },
    position: {
      title: 'position',
      type: 'menu',
      menu: {
        objectLeft: {
          type: 'number',
          title: 'left',
          value: {
            set: function set(val) {
              this.left = val;
              this.fire("modified");
              this.canvas.fire("object:modified", { target: this });
              this.canvas.renderAll();
            },
            get: function get() {
              return this.left;
            },
            observe: "modified"
          }
        },
        objectTop: {
          type: 'number',
          title: 'top',
          value: {
            set: function set(val) {
              this.top = val;
              this.fire("modified");
              this.canvas.fire("object:modified", { target: this });
              this.canvas.renderAll();
            },
            get: function get() {
              return this.top;
            },
            observe: "modified"
          }
        }
      }
    },
    dimensions: {
      title: 'dimensions',
      type: 'menu',
      menu: {
        objectWidth: {
          type: 'number',
          title: 'width',
          value: {
            set: function set(val) {
              this.saveState();
              this.dimensionsWidthValue = val;
              this.scaleToWidth(val * this.canvas.getZoom());
              this.canvas.fireModifiedIfChanged(this);
              this.canvas.renderAll();
              delete this.dimensionsWidthValue;
            },
            get: function get() {
              if (this.dimensionsWidthValue) {
                return this.dimensionsWidthValue;
              }
              return Math.round(this.getBoundingRect().width / this.canvas.getZoom());
            },
            observe: "modified"
          }
        },
        objectHeight: {
          type: 'number',
          title: 'height',
          value: {
            set: function set(val) {
              this.saveState();
              this.scaleToHeight(val * this.canvas.getZoom());
              this.dimensionsHeightValue = val;
              this.canvas.fireModifiedIfChanged(this);
              this.canvas.renderAll();
              delete this.dimensionsHeightValue;
            },
            get: function get() {
              if (this.dimensionsHeightValue) {
                return this.dimensionsHeightValue;
              }
              return Math.round(this.getBoundingRect().height / this.canvas.getZoom());
            },
            observe: "modified"
          }
        }
      }
    },
    center: {
      className: 'fa fa-bullseye',
      title: 'Center',
      action: function action() {
        this.center();
        this.setCoords();
      }
    },
    flip: {
      className: 'fa fa-arrows-h',
      title: 'flip',
      action: 'flip'
    },
    flop: {
      className: 'fa fa-arrows-v',
      title: 'flop'
    },
    bringForward: {
      title: 'bring forward',
      className: 'fa fa-level-up',
      disabled: 'onTop'
    },
    sendBackwards: {
      title: 'send backwards',
      className: 'fa fa-level-down',
      disabled: 'onBottom'
    },
    remove: {
      className: 'fa fa-trash',
      title: 'remove',
      key: "Delete"
    },
    duplicate: {
      className: 'fa fa-clone',
      title: 'duplicate'
    },
    fill: {
      type: 'color',
      title: 'fill',
      value: 'fill'
    }
  }
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 26 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

var textInitialize = fabric.Text.prototype.initialize;

fabric.util.object.extend(fabric.Text.prototype, {
  textInitialize: textInitialize,
  editTool: false,
  advancedColorsTools: false,
  textFontSizeTools: false,
  textAligmentTools: false,
  advancedTextStyleTools: false,
  rasterizeTool: false,
  rasterizeKlass: fabric.Image,
  initialize: function initialize(text, options) {
    this._initEntity(options);
    this.textInitialize(text, options);
    // this.updateCache();
  },
  _render_cache: function _render_cache(ctx) {
    ctx.save();
    ctx.scale(this.scaleX * (this.flipX ? -1 : 1), this.scaleY * (this.flipY ? -1 : 1));
    this.transform(ctx);
    this._setShadow(ctx);
    ctx.translate(-this.width / 2, -this.height / 2);
    ctx.drawImage(this._cache, 0, 0, this.width, this.height);
    ctx.restore();
  },
  updateCache: function updateCache() {

    var size = {
      width: this.width * this.canvas.dotsPerUnit,
      height: this.height * this.canvas.dotsPerUnit
    };

    var _clipTo = this.clipTo;
    delete this.clipTo;
    this._cache = fabric.util.createCanvasElementWithSize(size);
    var ctx = this._cache.getContext("2d");
    ctx.scale(this.canvas.dotsPerUnit, this.canvas.dotsPerUnit);
    ctx.translate(this.width / 2, this.height / 2);

    this.render(ctx, true);
    this.render = this._render_cache;
    this.clipTo = _clipTo;
  },
  rasterizeText: function rasterizeText() {
    this.updateCache();
    var img = fabric.util.createImage();

    img.onload = function () {
      var obj = this.toObject();
      obj.width = img.width;
      obj.height = img.height;
      obj.scaleX = this.scaleX * (this.height / img.height);
      obj.scaleY = this.scaleY * (this.width / img.width);
      obj.rasterizedType = obj.type;
      delete obj.type;

      var el = new this.rasterizeKlass(img, obj);
      this.canvas.add(el);
      this.canvas.remove(this);
      setTimeout(function () {
        this.canvas.setActiveObject(el);
        this.canvas.renderAll();
      }.bind(this));
    }.bind(this);
    img.src = this._cache.toDataURL();
    //this.on('modified',this.updateCache.bind(this));
  },
  getStyle: function getStyle(styleName) {
    var object = this;
    return object.getSelectionStyles && object.isEditing ? object.getSelectionStyles()[styleName] || object[styleName] : object[styleName] || object['__' + styleName] || '';
  },
  getPattern: function getPattern(url) {
    var _fill = this.getStyle('fill ');
    return _fill && _fill.source;
  },
  setPattern: function setPattern(url) {
    if (!url) {
      this.setStyle('fill');
    } else {
      // var _texture = _.findWhere(this.project.textures, {id: url});
      var _this = this;
      fabric.util.loadImage(url, function (img) {
        _this.setStyle('fill', new fabric.Pattern({
          source: img,
          repeat: 'repeat'
        }));
      });
    }
  },
  /* getOpacity: function () {
    return this.getStyle('opacity') * 100;
  },
  setOpacity: function (value) {
    this.setStyle('opacity', parseInt(value, 10) / 100);
  },*/
  getRadius: function getRadius() {
    return this.get('radius');
  },
  setShadow: function setShadow(options) {
    return this.setProperty('shadow', options ? new fabric.Shadow(options) : null);
  },
  setProperty: function setProperty(prop, value) {
    this[prop] = value;
    this.canvas && this.canvas.renderAll();
  },
  setRadius: function setRadius(value) {
    this.setProperty('radius', value);
  },
  getSpacing: function getSpacing() {
    return this.get('spacing');
  },
  setSpacing: function setSpacing(value) {
    this.setProperty('spacing', value);
  },
  getReverted: function getReverted() {
    return this.get('reverted');
  },
  setReverted: function setReverted(value) {
    this.setProperty('reverted', value);
  },
  getFill: function getFill() {
    return this.getStyle('fill');
  },
  setFill: function setFill(value) {
    this.setStyle('fill', value);
  },
  getText: function getText() {
    return this.get('text');
  },
  setText: function setText(value) {
    this.setProperty('text', value);
  },
  getTextAlign: function getTextAlign() {
    return this.get('textAlign');
  },
  setTextAlign: function setTextAlign(value) {
    this.setProperty('textAlign', value.toLowerCase());
  },
  getFontFamily: function getFontFamily() {
    return this.get('fontFamily');
  },
  setFontFamily: function setFontFamily(value) {
    this.setStyle('fontFamily', value);
  },
  getStyles: function getStyles() {
    return this.styles || {
      fill: this.fill,
      fontSize: this.fontSize,
      textBackgroundColor: this.textBackgroundColor,
      textDecoration: this.textDecoration,
      fontFamily: this.fontFamily,
      fontWeight: this.fontWeight,
      fontStyle: this.fontStyle,
      stroke: this.stroke,
      strokeWidth: this.strokeWidth
    };
  },
  getBgColor: function getBgColor() {
    return this.get('backgroundColor');
  },
  setBgColor: function setBgColor(value) {
    this.setProperty('backgroundColor', value);
  },
  getTextBgColor: function getTextBgColor() {
    return this.get('textBackgroundColor');
  },
  setTextBgColor: function setTextBgColor(value) {
    this.setProperty('textBackgroundColor', value);
  },
  getStroke: function getStroke() {
    return this.getStyle('stroke');
  },
  setStroke: function setStroke(value) {
    this.setStyle('stroke', value);
  },
  getStrokeWidth: function getStrokeWidth() {
    return this.getStyle('strokeWidth');
  },
  setStrokeWidth: function setStrokeWidth(value) {
    this.setStyle('strokeWidth', parseInt(value, 10));
  },
  decreaseFontSize: function decreaseFontSize() {
    this.setStyle('fontSize', parseInt(this.getStyle('fontSize')) - 1);
  },
  increaseFontSize: function increaseFontSize() {
    this.setStyle('fontSize', parseInt(this.getStyle('fontSize')) + 1);
  },
  getFontSize: function getFontSize() {
    return this.getStyle('fontSize');
  },
  setFontSize: function setFontSize(value) {
    this.setStyle('fontSize', parseInt(value, 10));
  },
  getLineHeight: function getLineHeight() {
    return this.getStyle('lineHeight');
  },
  setLineHeight: function setLineHeight(value) {
    this.setStyle('lineHeight', parseFloat(value, 10));
  },
  addText: function addText(text, options) {

    var _match = this.text.match(/\n/g);
    var _lineIndex = _match && _match.length || 0;
    var charIndex = this.text.length - this.text.lastIndexOf("\n") - 1;

    if (!this.styles[_lineIndex]) {
      this.styles[_lineIndex] = {};
    }

    if (!this.styles[_lineIndex][charIndex]) {
      this.styles[_lineIndex][charIndex] = {};
    }
    fabric.util.object.extend(this.styles[_lineIndex][charIndex], options);
    this.text += text;
    // this.styles;
  },
  getBold: function getBold() {
    return this.getStyle('fontWeight') === "bold";
  },
  setBold: function setBold(value) {
    this.setStyle('fontWeight', value ? 'bold' : '');
  },
  getItalic: function getItalic() {
    return this.getStyle('fontStyle') === 'italic';
  },
  setItalic: function setItalic(value) {
    this.setStyle('fontStyle', value ? 'italic' : '');
  },
  getUnderline: function getUnderline() {
    return this.getStyle('textDecoration').indexOf('underline') > -1;
  },
  setUnderline: function setUnderline(value) {
    value = value ? this.getStyle('textDecoration') + ' underline' : this.getStyle('textDecoration').replace('underline', '');

    this.setStyle('textDecoration', value);
  },
  getLinethrough: function getLinethrough() {
    return this.getStyle('textDecoration').indexOf('line-through') > -1;
  },
  setLinethrough: function setLinethrough(value) {
    value = value ? this.getStyle('textDecoration') + ' line-through' : this.getStyle('textDecoration').replace('line-through', '');

    this.setStyle('textDecoration', value);
  },
  getOverline: function getOverline() {
    return this.getStyle('textDecoration').indexOf('overline') > -1;
  },
  setOverline: function setOverline(value) {
    value = value ? this.getStyle('textDecoration') + ' overline' : this.getStyle('textDecoration').replace('overlin', '');

    this.setStyle('textDecoration', value);
  },
  setStyle: function setStyle(styleName, value) {
    var object = this;
    var _old = fabric.util.object.cloneDeep(object.getStyles());
    //var _old = fabric.util.object.deepExtend({}, object.getStyles);//getSelectionStyles();
    if (object.setSelectionStyles && object.isEditing) {
      var style = {};
      if (value !== undefined) {
        style[styleName] = value;
      } else {
        delete style[styleName];
      }
      object.setSelectionStyles(style);
      object.setCoords();
    } else {
      if (value !== undefined) {
        object[styleName] = value;
      } else {
        delete object[styleName];
      }
      for (var i in object.styles) {
        for (var j in object.styles[i]) {
          if (object.styles[i][j][styleName] !== undefined) {
            delete object.styles[i][j][styleName];
          }
        }
      }
    }

    var styles_data = object.getStyles();

    if (this.type != "text") {
      this.styles = fabric.util.object.cloneDeep(styles_data);
    }

    this.setCoords();

    this.fire("styles:modified", {
      original: _old,
      modified: styles_data
    });
    this.canvas && this.canvas.renderAll();
    /*
     this.project.history.add({
     slide: this.slide,
     object: this,
     undo: _old,
     redo: styles_data,
     type: 'styled',
     undoFn: function(){
     this.object.data.styles = this.undo;
     this.object.fabric.set('styles',this.undo);
     this.object.fabric.setCoords();
     this.object.slide.render();
     },
     redoFn:  function(){
     this.object.data.styles = this.redo;
     this.object.fabric.set('styles',this.redo);
     this.object.fabric.setCoords();
     this.object.slide.render();
     }
     });*/
  },

  generateTextStyle: function generateTextStyle() {
    return {
      'font-style': this.isItalic() ? 'italic' : 'normal',
      'font-weight': this.isBold() ? 700 : 400,
      'text-decoration': (this.isLinethrough() ? 'line-through ' : '') + (this.isOverline() ? 'overline ' : '') + (this.isUnderline() ? 'underline ' : '')
    };
  },
  actions: {
    fill: {
      type: 'color',
      title: 'fill',
      value: {
        get: function get() {
          //texture pattern fill fix
          return typeof this.fill == "string" ? this.fill : "transparent";
        },
        set: function set(value) {
          this.setFill(value);
        }
      }
    },
    rasterizeText: {
      insert: 'rasterizeTool',
      className: 'button-easel',
      title: 'rasterizeText'
      //   action: _TEX.rasterizeText
    },
    textBgcolor: {
      type: 'color',
      title: 'bgColor',
      value: 'bgColor'
    },
    textTextbgcolor: {
      type: 'color',
      title: 'textBgColor',
      value: 'textBgColor'
    },
    textBold: {
      type: "checkbox",
      title: 'bold',
      value: 'bold',
      className: 'fa fa-bold'
    },
    textItalic: {
      type: "checkbox",
      title: 'italic',
      value: 'italic',
      className: 'fa fa-italic'
    },
    textUnderline: {
      type: "checkbox",
      title: 'Underline',
      value: 'underline',
      className: 'fa fa-underline'
    },
    textLinethrough: {
      type: "checkbox",
      insert: 'advancedTextStyleTools',
      title: 'Linethrough',
      value: 'linethrough',
      className: 'text-linethrough fa fa-strikethrough'
    },
    textOverline: {
      type: "checkbox",
      insert: 'advancedTextStyleTools',
      title: 'overline',
      value: 'overline',
      className: 'text-overline fa fa-overline'
    },
    textAlign: {
      type: 'options',
      title: 'text align',
      insert: 'textAligmentTools',
      value: "textAlign",
      menu: {
        textAlignCenter: {
          title: 'align center',
          option: 'center',
          className: 'fa fa-align-center'
        },
        textAlignLeft: {
          title: 'align left',
          option: 'left',
          className: 'fa fa-align-left'
        },
        textAlignRight: {
          title: 'align right',
          option: 'right',
          className: 'fa fa-align-right'
        },
        textAlignJustify: {
          title: 'align justify',
          option: 'justify',
          className: 'fa fa-align-justify'
        }
      }
    },
    fontFamily: {
      type: 'fontFamily',
      title: 'font family',
      className: 'fa fa-text',
      value: 'fontFamily',
      data: function data() {
        return this.application._fonts;
      }
    },
    textFontSize: {
      insert: 'textFontSizeTools',
      type: 'number',
      title: 'fontSize',
      value: 'fontSize'
    },
    /*textFont: {
     insert: 'textFontSizeTools',
     type: 'menu',
     title: 'font',
     className: 'fa fa-font',
     menu: {
     textFontSizeDecrease: {
     title: 'decreaseFontSize',
     action: _TEX.decreaseFontSize,
     className: 'fa fa-font font-size-decrease'
     },
     textFontSizeIncrease: {
     title: 'increaseFontSize',
     action: _TEX.increaseFontSize,
     className: 'fa fa-font font-size-increase'
     }
     }
     }*/
    advancedColorsTools: {
      className: 'colors',
      type: 'menu',
      title: 'colors',
      toggled: true,
      menu: ["fill", "textBgcolor", "textTextbgcolor", "textFill"]
    },
    textStyle: {
      type: 'menu',
      title: 'text style',
      toggled: true,
      className: 'fa fa-font',
      style: 'generateTextStyle',
      menu: ["textBold", "textItalic", "textUnderline", "textLinethrough", "textOverline", "textAlign", "fontFamily", "textFontSize"]
    }
  }
});

fabric.util.object.extend(fabric.IText.prototype, {
  initHiddenTextarea_native: fabric.IText.prototype.initHiddenTextarea,
  initHiddenTextarea: function initHiddenTextarea() {
    this.initHiddenTextarea_native();
    this.hiddenTextarea.style.width = "9999px";
    this.hiddenTextarea.style["margin-left"] = "-9999px";
  },
  /**
   * Exits from editing state
   * @return {fabric.IText} thisArg
   * @chainable
   */
  exitEditing: function exitEditing() {
    // var isTextChanged = (this._textBeforeEdit !== this.text);
    this.selected = false;
    this.isEditing = false;
    this.selectable = true;

    this.selectionEnd = this.selectionStart;
    this.hiddenTextarea && this.canvas && this.hiddenTextarea.parentNode.removeChild(this.hiddenTextarea);
    this.hiddenTextarea = null;

    this.abortCursorAnimation();
    this._restoreEditingProps();
    this._currentCursorOpacity = 0;

    this.fire('editing:exited');
    // isTextChanged && this.fire('modified');
    if (this.canvas) {
      this.canvas.off('mouse:move', this.mouseMoveHandler);
      this.canvas.fire('text:editing:exited', { target: this });
      this.canvas.fireModifiedIfChanged(this);
    }
    return this;
  },
  maxStrokeWidth: function maxStrokeWidth() {
    return Math.ceil(this.getFontSize() / 10);
  },
  actions: {
    enterEditing: {
      insert: 'editTool',
      className: 'fa fa-pencil-square-o',
      title: 'edit'
      //action:     _TEX.enterEditing
    }
  }
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 27 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

var _GroupRemoveNetive = fabric.Group.prototype.remove;

fabric.util.object.extend(fabric.Group.prototype, {
  /**
   * Removes object from canvas to which it was added last
   * @return {fabric.Object} thisArg
   * @chainable
   */
  remove: function remove() {
    if (arguments.length === 0) {
      this.canvas && this.canvas.remove(this);
    } else {
      _GroupRemoveNetive.apply(this, arguments);
    }

    return this;
  }
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 28 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

__webpack_require__(7);

fabric.util.object.extend(fabric.Image.prototype, fabric.ImageMixin, {
  async: true,
  toObjectNative: fabric.Image.prototype.toObject,
  toObject: function toObject() {
    var obj = fabric.Image.prototype.toObjectNative.apply(this, arguments);
    if (obj.src.indexOf(fabric.util.mediaRoot) == 0) {
      obj.src = obj.src.replace(fabric.util.mediaRoot, "");
    }
    return obj;
  },
  initialize: function initialize(element, options, callback) {
    options || (options = {});
    this.filters = [];
    this.resizeFilters = [];

    if (options.originalSrc) {
      this._edited = true;
      fabric.util.loadImage(options.originalSrc, function (img) {
        this._originalElement = img;
      }.bind(this));
    }

    this._initElement(element, options, callback && function () {
      fabric.Object.prototype.initialize.call(this, options, callback);
    }.bind(this)); //adding callback
  },

  _initElement: function _initElement(element, options, callback) {
    this.setElement(fabric.util.getById(element), callback, options);
    fabric.util.addClass(this.getElement(), fabric.Image.CSS_CANVAS);
  },
  /**
   * Sets crossOrigin value (on an instance and corresponding image element)
   * @return {fabric.Image} thisArg
   * @chainable
   */
  setCrossOrigin: function setCrossOrigin(value) {
    this.crossOrigin = value;
    if (this._element) {
      this._element.crossOrigin = value;
    }
    return this;
  },
  setElement: function setElement(element, callback, options) {

    var _callback, _this;

    this._element = element;
    this._originalElement = element;
    this._initConfig(options);
    // this.setOptions(options );
    // this._setWidthHeight(this);
    // if (this._element && this.crossOrigin) {
    //   this._element.crossOrigin = this.crossOrigin;
    // }


    if (this.resizeFilters.length === 0) {
      _callback = callback;
    } else {
      _this = this;
      _callback = function _callback() {
        _this.applyFilters(callback, _this.resizeFilters, _this._filteredEl || _this._originalElement, true);
      };
    }

    if (this.filters.length !== 0) {
      this.applyFilters(_callback);
    } else if (_callback) {
      _callback(this);
    }
    if (this.canvas) {
      this.canvas.renderAll();
    }
    return this;
  },
  actions: {
    source: {
      type: 'effect',
      className: 'fa fa-file-image-o',
      title: "source",
      actionParameters: function actionParameters($el, data) {
        data.target.application.createGallery(data.target, $el);
      }
    }
  }
});

fabric.util.initFilters = function (img, object, callback) {

  // if (fabric.version >= 1.6) {
  fabric.Image.prototype._initFilters.call(object, object.filters, function (filters) {
    object.filters = filters || [];
    fabric.Image.prototype._initFilters.call(object, object.resizeFilters, function (resizeFilters) {
      object.resizeFilters = resizeFilters || [];
      callback(img, object);
    });
  });
  // } else {
  //   fabric.Image.prototype._initFilters.call(object, object, function (filters) {
  //     object.filters = filters || [];
  //     callback(img, object);
  //   });
  // }
};

fabric.util.initImageAndFilters = function (object, callback) {
  if (object.image) {
    var img = object.image;
    delete object.src;
    delete object.image;
    fabric.util.initFilters(img, object, callback);
  } else if (object.src) {
    fabric.util.loadImage(object.src, function (img) {
      //delete object.src;
      fabric.util.initFilters(img, object, callback);
    }, null, object.crossOrigin);
  } else {
    fabric.util.initFilters(null, object, callback);
  }
};

fabric.Image.fromObject = function (object, callback) {
  fabric.util.initImageAndFilters(object, function (img, object) {
    var instance = new fabric.Image(img, object, callback);
  });
};

fabric.Image.prototype._to_object_overwritten = fabric.Image.prototype.toObject;
fabric.Image.prototype.setSrc = function (opt) {
  console.log(opt);
};

fabric.Image.prototype.toObject = function (opt) {
  var obj = fabric.Image.prototype._to_object_overwritten.call(this, opt);

  if (this._edited) {
    obj.originalSrc = this._original_src || this._originalElement.src || this._element.src;
    obj.src = this._element.src;
  } else {
    obj.src = this._original_src || this._originalElement.src || this._element.src;
  }
  if (this.contentOffsets) {
    obj.contentOffsets = this.contentOffsets;
  }

  if (!this.includeDefaultValues) {
    if (!obj.filters.length) delete obj.filters;
  }
  //if(this._originalElement){
  //    obj.thumb = this._element.src;
  //}

  return obj;
};
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 29 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.Application.prototype.configurationProperties.push("templates");

fabric.util.object.extend(fabric.Application.prototype, {
  setTemplates: function setTemplates(value) {
    this.templates = value;
  }
});

fabric.util.object.extend(fabric.StaticCanvas.prototype, {
  eventListeners: fabric.util.object.extendArraysObject(fabric.StaticCanvas.prototype.eventListeners, {
    "loading:begin": function loadingBegin(e) {
      var val = e.options.template;
      if (val) {
        var tpl = this.getTemplate(val);
        fabric.util.object.extend(e.options, tpl.data);
      }
    }
  }),
  setTemplate: function setTemplate(value) {
    this.template = value;
  },
  //-------------------------------------------------------------------------------
  getTemplate: function getTemplate(id) {
    return fabric.util.object.findWhere(this.application.templates, { id: id });
  },
  updateSlideTemplate: function updateSlideTemplate(slide) {
    slide.canvas.setTemplate(slide.canvas.template);
    this.canvas.template = slide.canvas.template;
    if (this.activeSlide == slide) {
      this.canvas.setTemplate(slide.canvas.template);
    }
  },
  updateTemplate: function updateTemplate(template) {
    for (var i in this.slides) {
      if (this.slides[i].canvas.template == template) {
        this.updateSlideTemplate(this.slides[i]);
      }
    }
  }
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 30 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

/*todo
fabric.SlideCanvas.addPlugin("initialize",function(){
  if(typeof this.freeDrawingBrush == "string" ){
    this.setFreeDrawingBrush(this.freeDrawingBrush);
  }
});*/

fabric.util.object.extend(fabric.SlideCanvas.prototype, {
  /**
   * ['PencilBrush','RectangleBrush']
   */
  activeDrawingTools: [],
  /**
   *
     {
      BrushClassName: {
        className: 'brush className',
        title: 'brush title'
      }
    }
   */
  drawingTools: {},
  insertDrawingTool: false,
  actions: fabric.util.object.extend(fabric.SlideCanvas.prototype.actions, {
    drawingTool: {
      title: 'drawing-tool',
      type: 'options',
      value: 'freeDrawingBrush',
      menu: function menu() {
        var _tools = {};
        for (var i in this.activeDrawingTools) {
          var _tool = this.activeDrawingTools[i];
          _tools[_tool] = fabric.util.object.extend({ option: _tool }, this.drawingTools[_tool]);
        }
        return _tools;
      }
    }
  }),
  freeDrawingBrush: 'PencilBrush',
  drawingColor: [0, 0, 0, 255],
  _onMouseDownInDrawingMode: function _onMouseDownInDrawingMode(e) {
    this._isCurrentlyDrawing = true;
    if (!this.freeDrawingBrush.target) {
      this.discardActiveObject(e).renderAll();
    }
    if (this.clipTo) {
      fabric.util.clipContext(this, this.contextTop);
    }
    var pointer = this.getPointer(e);
    this.freeDrawingBrush.onMouseDown(pointer);
    this._handleEvent(e, 'down');
  },
  getFreeDrawingBrush: function getFreeDrawingBrush() {
    if (!this.freeDrawingBrush) {
      return "Selection";
    }
    return fabric.util.string.capitalize(fabric.util.string.camelize(this.freeDrawingBrush.type), true);
  },
  setFreeDrawingBrush: function setFreeDrawingBrush(brush) {

    if (brush == 'Selection') {
      this.isDrawingMode = false;
      this.freeDrawingBrush = "";
      return;
    }
    var className = fabric.util.string.capitalize(fabric.util.string.camelize(brush), true);
    if (this["__" + className]) {
      this.freeDrawingBrush = this["__" + className];
    } else {
      this.freeDrawingBrush = this["__" + className] = new fabric[className](this);
    }
    this.fire("brush:changed", { brush: this.freeDrawingBrush });
  },
  drawZoomedArea: function drawZoomedArea(ctx, left, top, width, height, pointer) {

    width = width || 90;
    height = height || 90;

    ctx.save();
    ctx.translate(left || 0, top || 0);

    ctx.fillStyle = 'black';
    ctx.strokeStyle = "#fff";
    ctx.strokeWidth = 1;
    ctx.setLineDash([2, 2]);
    ctx.drawImage(this.backgroundImage._element, Math.floor(pointer.x) - 4, Math.floor(pointer.y) - 4, 9, 9, 0, 0, width, width);
    ctx.strokeRect(0, 0, width, width);
    ctx.strokeRect(40, 40, 10, 10);
    ctx.restore();
  }
});

fabric.SlideCanvas.prototype.drawingTools.Selection = {
  className: 'fa fa-mouse-pointer',
  title: 'Selection'
};
fabric.SlideCanvas.prototype.activeDrawingTools.push("Selection");
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 31 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

if (!Toolbar) {
  var Toolbar = __webpack_require__(1);
  __webpack_require__(32);
  __webpack_require__(34);
  __webpack_require__(36);
  __webpack_require__(37);
  __webpack_require__(38);
}

Toolbar.prototype.setFunctionCallback = function (target) {
  if (target.canvas) {
    return target.canvas.renderAll();
  }
  if (target.renderAll) {
    return target.renderAll();
  }
};

fabric.ToolsMixin = {
  /**
   *
   * @param tools ["x", "*", "y"]
   * @param proto
   * @returns ["x", "a", "b", "c", "y"]
   * @private
   */
  _getTools: function _getTools(tools, proto) {
    var indexOfStar = -1;
    if ((indexOfStar = tools.indexOf("*")) == -1) {
      return tools;
    }

    var klassname = fabric.util.string.capitalize(fabric.util.string.camelize(proto.type), true);
    var protoFabric = fabric[klassname].prototype;
    var protoApp = this.application.prototypes[klassname];

    var tools2 = protoApp && protoApp.tools || protoFabric.tools;
    if (tools2) {
      tools.splice.apply(tools, [indexOfStar, 1].concat(tools2));
    }
    return this._getTools(tools, protoFabric.__proto__);
  },
  setTools: function setTools(tools) {
    this.tools = this._getTools(tools, this.__proto__.__proto__);
    this.makeActions();
  },
  _getActionValue: function _getActionValue(property) {
    var object = this;
    do {
      if (object.actions && object.actions[property]) {
        return object.actions[property];
      }
    } while (object = object.__proto__);
    return null;
  },
  makeActions: function makeActions() {
    var actions = {};
    var self = this;
    _.each(this.tools, function (tool) {
      var _val = self._getActionValue(tool);
      if (_val) {
        actions[tool] = _val;
      } else {
        console.warn("tool " + tool + " is undefined");
      }
    });
    this.generatedActions = Toolbar.makeActions(actions, this);
  }
};

fabric.Toolbar = Toolbar;

fabric.util.object.extend(fabric.Object.prototype, fabric.ToolsMixin, {
  optionsOrder: function () {
    var oo = fabric.Object.prototype.optionsOrder;
    oo.push("actions", "tools");
    return oo;
  }()
});

fabric.util.object.extend(fabric.Application.prototype, fabric.ToolsMixin, {
  optionsOrder: function () {
    var oo = fabric.Application.prototype.optionsOrder;
    oo.push("actions", "tools");
    return oo;
  }(),
  objectsToolbarContainer: null,
  setToolbars: function setToolbars(options) {
    if (options.application) {
      new fabric.Toolbar(this, options.application.container, options.application, this.generatedActions);
    }
    if (options.canvas) {
      new fabric.Toolbar(this.canvas, options.canvas.container, options.canvas, this.canvas.generatedActions);
    }
    if (options.objects) {
      var canvas = this.canvas;

      if (options.objects.container) {
        this.objectsToolbarContainer = $(document.getElementById(options.objects.container)).hide();
      } else {
        this.objectsToolbarContainer = $('<div>');
        $(this.wrapperEl).prepend(this.objectsToolbarContainer);
      }
      var $menu = this.objectsToolbarContainer;
      $menu.hide();
      if (options.objects.position) {
        fabric.util.objects.defaults(options.objects.position, {
          originX: "left",
          originY: "top",
          marginX: 0,
          marginY: 0
        });
        $menu.addClass("floated-menu");
        $menu.css({
          "position": "absolute",
          "z-index": 999
        });
      }

      var _last_target = canvas.target;
      canvas.on({
        'target:cleared': function targetCleared(event) {
          if (_last_target) {
            $menu.hide();
            canvas.objectToolbar.destroy();
            delete canvas.objectToolbar;
            _last_target = null;
          }
        },
        'target:changed': function targetChanged(event) {
          if (_last_target) {
            canvas.objectToolbar.destroy();
          }
          $menu.show();
          if (this.target.actions) {
            this.objectToolbar = new fabric.Toolbar(this.target, $menu, options.objects, this.target.generatedActions);
          }
          if (options.objects.position) {
            this.setToolbarCoords($menu, this.target, options.objects.position);
          }
          _last_target = event.target;
        },
        'object:moving': function objectMoving(event) {
          if (options.objects.position) {
            canvas.setToolbarCoords($menu, canvas.target, options.objects.position);
          }
        }
      });
    }
  },
  /*setToolbarOptions: function(toolbarOptions){
     fabric.util.object.deepExtend(Toolbar.tools, toolbarOptions.tools);
    for (var klassName in toolbarOptions.actions) {
      var actions = toolbarOptions.actions[klassName];
      if(!fabric[klassName].prototype.actions){
        fabric[klassName].prototype.actions = {}
      }
      var protoActions = fabric[klassName].prototype.actions;
       if (actions.constructor == Function) {
        actions = actions.call(fabric[klassName].prototype)
      }else{
        actions = fabric.util.object.cloneDeep(actions);
      }
     // var $order = actions["$order"];
     // delete actions["$order"];
       for (var j in actions) {
        if(protoActions[j]){
          if (actions[j]["$clone"]) {
            protoActions[j] = fabric.util.object.deepExtend({}, protoActions[j]);
            delete actions[j]["$clone"];
          }
          fabric.util.object.deepExtend(protoActions[j], actions[j]);
        }else{
          protoActions[j] = actions[j];
        }
      }
    }
  },*/
  eventListeners: fabric.util.object.extendArraysObject(fabric.Application.prototype.eventListeners, {
    // "canvas:created" : function(){
    //  this.initTools();
    // },
    //  "canvas:created": function(){
    //    this.createToolbars();
    //  }
  })
});

//todo нужно сделать порядок свойст унаследуемым
fabric.util.object.extend(fabric.StaticCanvas.prototype, fabric.ToolsMixin, {
  optionsOrder: function () {
    var oo = fabric.StaticCanvas.prototype.optionsOrder;
    oo.push("actions", "tools");
    return oo;
  }()
});

fabric.util.object.extend(fabric.Canvas.prototype, fabric.ToolsMixin, {
  // optionsOrder: (function(){
  //   var oo = fabric.Canvas.prototype.optionsOrder;
  //   oo.push("actions","tools");
  //   return oo;
  // })(),
  setToolbarCoords: function setToolbarCoords($menu, target, options) {

    options = fabric.util.object.extend({
      originX: "left",
      originY: "top",
      marginX: 0,
      marginY: 0
    }, options);

    target.setCoords();
    var r = target.getBoundingRect();

    var _left;
    switch (options.originX) {
      case "left":
        _left = r.left;
        break;
      case "right":
        _left = r.left + r.width;
        break;
      case "center":
        _left = r.left + r.width / 2;
        break;
    }
    ;
    var _top;
    switch (options.originY) {
      case "top":
        _top = r.top - $menu.height();
        break;
      case "bottom":
        _top = r.top + r.height;
        break;
      case "center":
        _top = r.top + r.height / 2 - $menu.height() / 2;
        break;
    }
    ;

    _top += options.marginY;
    _left += options.marginX;

    var _menuContainerOffset = $($menu.parents()[0]).offset();
    var _canvasOffset = $(this.wrapperEl).offset();

    _top += _canvasOffset.top - _menuContainerOffset.top;
    _left += _canvasOffset.left - _menuContainerOffset.left;

    var coords = {
      top: Math.max(3, _top),
      left: Math.min(Math.max(3, _left), $(this.wrapperEl).width() - $menu.width() - 5)
    };

    $(this.wrapperEl).offset();

    $menu.css(coords);
    return coords;
  }
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 32 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

if (!$.minicolors) {
  __webpack_require__(33);
}

if (typeof Toolbar === "undefined") {
  var Toolbar = __webpack_require__(1);
}

Toolbar.prototype.colorpicker = function (el, options) {
  options.format = 'rgb';
  options.opacity = true;
  el.minicolors(options);
};

Toolbar.prototype.colorpickerOptions = {
  position: "right bottom"
};

Toolbar.prototype.tools.color = {
  template: '<div class="object-menu-item" title="background color">' + '<div class="btn button-{id} {className}">' + '<input type="text" data-format="rgba" data-opacity="true" data-text="true" data-control="saturation" data-swatches="#fff|#000|#f00|#0f0|#00f|#ff0|#0ff"  value="{valueCurrent}" transclude>',
  post: function post($item, data, options, transclude) {
    //var target = data.target;

    var _visible = false;
    this.colorpicker(transclude, fabric.util.object.extend({
      // value:        data.value.get() ,//|| data.value.get(),
      defaultValue: /*data.value.defaultValue ||*/data.value.get(),
      control: 'hue',
      format: 'hex',
      keywords: '',
      inline: false,
      letterCase: 'lowercase',
      opacity: true,
      position: "right bottom",
      swatches: "#fff|#000|#f00|#0f0|#00f|#ff0|#0ff".split('|'),
      text: true,
      hide: function hide() {
        _visible = false;
      },
      show: function show() {
        _visible = true;
      },
      change: function change(value, opacity) {
        data.value.set(value);
      }
    }, options.colorpicker));

    var _el = $(transclude.parents()[0]).find(".minicolors-panel");

    var _HIDE = function _HIDE(e) {
      if (_visible && $(e.target).parents().index(_el) == -1) {
        transclude.minicolors("hide");
        $("body").off("mousedown", _HIDE);
      }
    };
    $("body").on("mousedown", _HIDE);
  }
};
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 33 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

/*
 * jQuery MiniColors: A tiny color picker built on jQuery
 *
 * Copyright: Cory LaViska for A Beautiful Site, LLC: http://www.abeautifulsite.net/
 *
 * Contribute: https://github.com/claviska/jquery-minicolors
 *
 * @license: http://opensource.org/licenses/MIT
 *
 */

(function (factory) {
  if (( false ? 'undefined' : _typeof(exports)) === 'object') {
    module.exports = factory(__webpack_require__(9));
  } else {
    factory(jQuery);
  }
})(function ($) {

  'use strict';
  //if(_ && _.styleSheetContains && !_.styleSheetContains('.minicolors')){
  //  _.linkCSS(_.scriptURL() + "/../../css/jquery.minicolors.css");
  //}

  // Defaults

  $.minicolors = {
    defaults: {
      animationSpeed: 50,
      animationEasing: 'swing',
      change: null,
      changeDelay: 0,
      control: 'hue',
      dataUris: true,
      defaultValue: '',
      format: 'hex',
      hide: null,
      hideSpeed: 100,
      inline: false,
      keywords: '',
      letterCase: 'lowercase',
      opacity: false,
      position: 'bottom left',
      show: null,
      showSpeed: 100,
      theme: 'default',
      swatches: []
    }
  };

  // Public methods
  $.extend($.fn, {
    minicolors: function minicolors(method, data) {

      switch (method) {

        // Destroy the control
        case 'destroy':
          $(this).each(function () {
            destroy($(this));
          });
          return $(this);

        // Hide the color picker
        case 'hide':
          hide();
          return $(this);

        // Get/set opacity
        case 'opacity':
          // Getter
          if (data === undefined) {
            // Getter
            return $(this).attr('data-opacity');
          } else {
            // Setter
            $(this).each(function () {
              updateFromInput($(this).attr('data-opacity', data));
            });
          }
          return $(this);

        // Get an RGB(A) object based on the current color/opacity
        case 'rgbObject':
          return rgbObject($(this), method === 'rgbaObject');

        // Get an RGB(A) string based on the current color/opacity
        case 'rgbString':
        case 'rgbaString':
          return rgbString($(this), method === 'rgbaString');

        // Get/set settings on the fly
        case 'settings':
          if (data === undefined) {
            return $(this).data('minicolors-settings');
          } else {
            // Setter
            $(this).each(function () {
              var settings = $(this).data('minicolors-settings') || {};
              destroy($(this));
              $(this).minicolors($.extend(true, settings, data));
            });
          }
          return $(this);

        // Show the color picker
        case 'show':
          show($(this).eq(0));
          return $(this);

        // Get/set the hex color value
        case 'value':
          if (data === undefined) {
            // Getter
            return $(this).val();
          } else {
            // Setter
            $(this).each(function () {
              if ((typeof data === 'undefined' ? 'undefined' : _typeof(data)) === 'object') {
                if (data.opacity) {
                  $(this).attr('data-opacity', keepWithin(data.opacity, 0, 1));
                }
                if (data.color) {
                  $(this).val(data.color);
                }
              } else {
                $(this).val(data);
              }
              updateFromInput($(this));
            });
          }
          return $(this);

        // Initializes the control
        default:
          if (method !== 'create') data = method;
          $(this).each(function () {
            init($(this), data);
          });
          return $(this);

      }
    }
  });

  var inputText, globalSettings, globalTarget, globalInput;
  // Initialize input elements
  function init(input, settings) {

    var minicolors = $('<div class="minicolors" />'),
        defaults = $.minicolors.defaults,
        size,
        swatches,
        textPanel,
        swatch,
        panel,
        globalTarget = input,
        i;

    // Do nothing if already initialized
    if (input.data('minicolors-initialized')) return;

    // Handle settings
    globalSettings = settings = $.extend(true, {}, defaults, settings);

    // The wrapper
    minicolors.addClass('minicolors-theme-' + settings.theme).toggleClass('minicolors-with-opacity', settings.opacity).toggleClass('minicolors-no-data-uris', settings.dataUris !== true);

    // Custom positioning
    if (settings.position !== undefined) {
      $.each(settings.position.split(' '), function () {
        minicolors.addClass('minicolors-position-' + this);
      });
    }

    // Input size
    if (settings.format === 'rgb') {
      size = settings.opacity ? '25' : '20';
    } else {
      size = settings.keywords ? '11' : '7';
    }
    globalInput = input;
    // The input
    input.addClass('minicolors-input').data('minicolors-initialized', false).data('minicolors-settings', settings).prop('size', size).wrap(minicolors).after('<div class="minicolors-panel minicolors-slider-' + settings.control + '">' + '<div class="minicolors-slider minicolors-sprite">' + '<div class="minicolors-picker"></div>' + '</div>' + '<div class="minicolors-opacity-slider minicolors-sprite">' + '<div class="minicolors-picker"></div>' + '</div>' + '<div class="minicolors-grid minicolors-sprite">' + '<div class="minicolors-grid-inner"></div>' + '<div class="minicolors-picker"><div></div></div>' + '</div>' + '</div>');

    // The swatch
    if (!settings.inline) {
      input.after('<span class="minicolors-swatch minicolors-sprite minicolors-input-swatch"><span class="minicolors-swatch-color"></span></span>');
      input.next('.minicolors-input-swatch').on('click', function (event) {
        event.preventDefault();
        input.focus();
      });
    }

    // Prevent text selection in IE
    panel = input.parent().find('.minicolors-panel');
    panel.on('selectstart', function () {
      return false;
    }).end();

    // Swatches
    if (settings.swatches && settings.swatches.length !== 0) {
      if (settings.swatches.length > 7) {
        settings.swatches.length = 7;
      }
      panel.addClass('minicolors-with-swatches');
      swatches = $('<ul class="minicolors-swatches"></ul>').appendTo(panel);
      for (i = 0; i < settings.swatches.length; ++i) {
        swatch = settings.swatches[i];
        swatch = isRgb(swatch) ? parseRgb(swatch, true) : hex2rgb(parseHex(swatch, true));
        $('<li class="minicolors-swatch minicolors-sprite"><span class="minicolors-swatch-color"></span></li>').appendTo(swatches).data('swatch-color', settings.swatches[i]).find('.minicolors-swatch-color').css({
          backgroundColor: rgb2hex(swatch),
          opacity: swatch.a
        });
        settings.swatches[i] = swatch;
      }
    }

    // Swatches
    if (settings.text) {
      panel.addClass('minicolors-with-text');
      textPanel = $('<div class="minicolors-text"></div>').appendTo(panel);
      inputText = $('<input type="text">').appendTo(textPanel);

      $(inputText).change(function () {
        input.val(inputText.val());
        updateFromInput(input, true);
      });
    }

    // Inline controls
    if (settings.inline) input.parent().addClass('minicolors-inline');

    updateFromInput(input, false);

    input.data('minicolors-initialized', true);
  }

  // Returns the input back to its original state
  function destroy(input) {

    var minicolors = input.parent();

    // Revert the input element
    input.removeData('minicolors-initialized').removeData('minicolors-settings').removeProp('size').removeClass('minicolors-input');

    // Remove the wrap and destroy whatever remains
    minicolors.before(input).remove();
  }

  // Shows the specified dropdown panel
  function show(input) {

    var minicolors = input.parent(),
        panel = minicolors.find('.minicolors-panel'),
        settings = input.data('minicolors-settings');

    // Do nothing if uninitialized, disabled, inline, or already open
    if (!input.data('minicolors-initialized') || input.prop('disabled') || minicolors.hasClass('minicolors-inline') || minicolors.hasClass('minicolors-focus')) return;

    hide();

    minicolors.addClass('minicolors-focus');
    panel.stop(true, true).fadeIn(settings.showSpeed, function () {
      if (settings.show) settings.show.call(input.get(0));
    });
  }

  // Hides all dropdown panels
  function hide() {

    $('.minicolors-focus').each(function () {

      var minicolors = $(this),
          input = minicolors.find('.minicolors-input'),
          panel = minicolors.find('.minicolors-panel'),
          settings = input.data('minicolors-settings');

      panel.fadeOut(settings.hideSpeed, function () {
        if (settings.hide) settings.hide.call(input.get(0));
        minicolors.removeClass('minicolors-focus');
      });
    });
  }

  // Moves the selected picker
  function move(target, event, animate) {

    var input = target.parents('.minicolors').find('.minicolors-input'),
        settings = input.data('minicolors-settings'),
        picker = target.find('[class$=-picker]'),
        offsetX = target.offset().left,
        offsetY = target.offset().top,
        x = Math.round(event.pageX - offsetX),
        y = Math.round(event.pageY - offsetY),
        duration = animate ? settings.animationSpeed : 0,
        wx,
        wy,
        r,
        phi;

    // Touch support
    if (event.originalEvent.changedTouches) {
      x = event.originalEvent.changedTouches[0].pageX - offsetX;
      y = event.originalEvent.changedTouches[0].pageY - offsetY;
    }

    // Constrain picker to its container
    if (x < 0) x = 0;
    if (y < 0) y = 0;
    if (x > target.width()) x = target.width();
    if (y > target.height()) y = target.height();

    // Constrain color wheel values to the wheel
    if (target.parent().is('.minicolors-slider-wheel') && picker.parent().is('.minicolors-grid')) {
      wx = 75 - x;
      wy = 75 - y;
      r = Math.sqrt(wx * wx + wy * wy);
      phi = Math.atan2(wy, wx);
      if (phi < 0) phi += Math.PI * 2;
      if (r > 75) {
        r = 75;
        x = 75 - 75 * Math.cos(phi);
        y = 75 - 75 * Math.sin(phi);
      }
      x = Math.round(x);
      y = Math.round(y);
    }

    // Move the picker
    if (target.is('.minicolors-grid')) {
      picker.stop(true).animate({
        top: y + 'px',
        left: x + 'px'
      }, duration, settings.animationEasing, function () {
        updateFromControl(input, target);
      });
    } else {
      picker.stop(true).animate({
        top: y + 'px'
      }, duration, settings.animationEasing, function () {
        updateFromControl(input, target);
      });
    }
  }

  // Sets the input based on the color picker values
  function updateFromControl(input, target) {

    function getCoords(picker, container) {

      var left, top;
      if (!picker.length || !container) return null;
      left = picker.offset().left;
      top = picker.offset().top;

      return {
        x: left - container.offset().left + picker.outerWidth() / 2,
        y: top - container.offset().top + picker.outerHeight() / 2
      };
    }

    var hue,
        saturation,
        brightness,
        x,
        y,
        r,
        phi,
        hex = input.val(),
        opacity = input.attr('data-opacity'),


    // Helpful references
    minicolors = input.parent(),
        settings = input.data('minicolors-settings'),
        swatch = minicolors.find('.minicolors-input-swatch'),


    // Panel objects
    grid = minicolors.find('.minicolors-grid'),
        slider = minicolors.find('.minicolors-slider'),
        opacitySlider = minicolors.find('.minicolors-opacity-slider'),


    // Picker objects
    gridPicker = grid.find('[class$=-picker]'),
        sliderPicker = slider.find('[class$=-picker]'),
        opacityPicker = opacitySlider.find('[class$=-picker]'),


    // Picker positions
    gridPos = getCoords(gridPicker, grid),
        sliderPos = getCoords(sliderPicker, slider),
        opacityPos = getCoords(opacityPicker, opacitySlider);

    // Handle colors
    if (target.is('.minicolors-grid, .minicolors-slider, .minicolors-opacity-slider')) {

      // Determine HSB values
      switch (settings.control) {

        case 'wheel':
          // Calculate hue, saturation, and brightness
          x = grid.width() / 2 - gridPos.x;
          y = grid.height() / 2 - gridPos.y;
          r = Math.sqrt(x * x + y * y);
          phi = Math.atan2(y, x);
          if (phi < 0) phi += Math.PI * 2;
          if (r > 75) {
            r = 75;
            gridPos.x = 69 - 75 * Math.cos(phi);
            gridPos.y = 69 - 75 * Math.sin(phi);
          }
          saturation = keepWithin(r / 0.75, 0, 100);
          hue = keepWithin(phi * 180 / Math.PI, 0, 360);
          brightness = keepWithin(100 - Math.floor(sliderPos.y * (100 / slider.height())), 0, 100);
          hex = hsb2hex({
            h: hue,
            s: saturation,
            b: brightness
          });

          // Update UI
          slider.css('backgroundColor', hsb2hex({ h: hue, s: saturation, b: 100 }));
          break;

        case 'saturation':
          // Calculate hue, saturation, and brightness
          hue = keepWithin(parseInt(gridPos.x * (360 / grid.width()), 10), 0, 360);
          saturation = keepWithin(100 - Math.floor(sliderPos.y * (100 / slider.height())), 0, 100);
          brightness = keepWithin(100 - Math.floor(gridPos.y * (100 / grid.height())), 0, 100);
          hex = hsb2hex({
            h: hue,
            s: saturation,
            b: brightness
          });

          // Update UI
          slider.css('backgroundColor', hsb2hex({ h: hue, s: 100, b: brightness }));
          minicolors.find('.minicolors-grid-inner').css('opacity', saturation / 100);
          break;

        case 'brightness':
          // Calculate hue, saturation, and brightness
          hue = keepWithin(parseInt(gridPos.x * (360 / grid.width()), 10), 0, 360);
          saturation = keepWithin(100 - Math.floor(gridPos.y * (100 / grid.height())), 0, 100);
          brightness = keepWithin(100 - Math.floor(sliderPos.y * (100 / slider.height())), 0, 100);
          hex = hsb2hex({
            h: hue,
            s: saturation,
            b: brightness
          });

          // Update UI
          slider.css('backgroundColor', hsb2hex({ h: hue, s: saturation, b: 100 }));
          minicolors.find('.minicolors-grid-inner').css('opacity', 1 - brightness / 100);
          break;

        default:
          // Calculate hue, saturation, and brightness
          hue = keepWithin(360 - parseInt(sliderPos.y * (360 / slider.height()), 10), 0, 360);
          saturation = keepWithin(Math.floor(gridPos.x * (100 / grid.width())), 0, 100);
          brightness = keepWithin(100 - Math.floor(gridPos.y * (100 / grid.height())), 0, 100);
          hex = hsb2hex({
            h: hue,
            s: saturation,
            b: brightness
          });

          // Update UI
          grid.css('backgroundColor', hsb2hex({ h: hue, s: 100, b: 100 }));
          break;

      }

      // Handle opacity
      if (settings.opacity) {
        opacity = parseFloat(1 - opacityPos.y / opacitySlider.height()).toFixed(2);
      } else {
        opacity = 1;
      }

      updateInput(input, hex, opacity);
    } else {
      // Set swatch color
      swatch.find('span').css({
        backgroundColor: hex,
        opacity: opacity
      });

      // Handle change event
      doChange(input, hex, opacity);
    }
  }

  // Sets the value of the input and does the appropriate conversions
  // to respect settings, also updates the swatch
  function updateInput(input, value, opacity) {
    var rgb,


    // Helpful references
    minicolors = input.parent(),
        settings = input.data('minicolors-settings'),
        swatch = minicolors.find('.minicolors-input-swatch');

    if (settings.opacity) input.attr('data-opacity', opacity);

    // Set color string
    if (settings.format === 'rgb') {
      // Returns RGB(A) string

      // Checks for input format and does the conversion
      if (isRgb(value)) {
        rgb = parseRgb(value, true);
      } else {
        rgb = hex2rgb(parseHex(value, true));
      }

      opacity = input.attr('data-opacity') === '' ? 1 : keepWithin(parseFloat(input.attr('data-opacity')).toFixed(2), 0, 1);
      if (isNaN(opacity) || !settings.opacity) opacity = 1;

      if (input.minicolors('rgbObject').a <= 1 && rgb && settings.opacity) {
        // Set RGBA string if alpha
        value = 'rgba(' + rgb.r + ', ' + rgb.g + ', ' + rgb.b + ', ' + parseFloat(opacity) + ')';
      } else {
        // Set RGB string (alpha = 1)
        value = 'rgb(' + rgb.r + ', ' + rgb.g + ', ' + rgb.b + ')';
      }
    } else {
      // Returns hex color

      // Checks for input format and does the conversion
      if (isRgb(value)) {
        value = rgbString2hex(value);
      }

      value = convertCase(value, settings.letterCase);
    }

    // Update value from picker
    //globalInput.val( value );
    input.val(value);

    if (inputText) {
      inputText.val(value);
    }

    // Set swatch color
    swatch.find('span').css({
      backgroundColor: value,
      opacity: opacity
    });

    // Handle change event
    doChange(input, value, opacity);
  }

  // Sets the color picker values from the input
  function updateFromInput(input, preserveInputValue) {
    var settings = globalSettings;
    var hex,
        hsb,
        opacity,
        keywords,
        alpha,
        value,
        x,
        y,
        r,
        phi,


    // Helpful references
    minicolors = input.parent(),

    //  settings = input.data('minicolors-settings'),
    swatch = minicolors.find('.minicolors-input-swatch'),


    // Panel objects
    grid = minicolors.find('.minicolors-grid'),
        slider = minicolors.find('.minicolors-slider'),
        opacitySlider = minicolors.find('.minicolors-opacity-slider'),


    // Picker objects
    gridPicker = grid.find('[class$=-picker]'),
        sliderPicker = slider.find('[class$=-picker]'),
        opacityPicker = opacitySlider.find('[class$=-picker]');

    // Determine hex/HSB values
    if (isRgb(input.val())) {
      // If input value is a rgb(a) string, convert it to hex color and update opacity
      hex = rgbString2hex(input.val());
      alpha = keepWithin(parseFloat(getAlpha(input.val())).toFixed(2), 0, 1);
      if (alpha) {
        input.attr('data-opacity', alpha);
      }
    } else {
      hex = convertCase(parseHex(input.val(), true), settings.letterCase);
    }

    if (!hex) {
      hex = convertCase(parseInput(settings.defaultValue, true), settings.letterCase);
    }
    hsb = hex2hsb(hex);

    // Get array of lowercase keywords
    keywords = !settings.keywords ? [] : $.map(settings.keywords.split(','), function (a) {
      return $.trim(a.toLowerCase());
    });

    // Set color string
    if (input.val() !== '' && $.inArray(input.val().toLowerCase(), keywords) > -1) {
      value = convertCase(input.val());
    } else {
      value = isRgb(input.val()) ? parseRgb(input.val()) : hex;
    }

    // Update input value
    if (!preserveInputValue) {
      globalInput.val(value);

      inputText && inputText.val(value);
    }
    globalSettings = settings;
    // Determine opacity value
    if (settings.opacity) {
      // Get from data-opacity attribute and keep within 0-1 range
      opacity = input.attr('data-opacity') === '' ? 1 : keepWithin(parseFloat(input.attr('data-opacity')).toFixed(2), 0, 1);
      if (isNaN(opacity)) opacity = 1;
      input.attr('data-opacity', opacity);
      swatch.find('span').css('opacity', opacity);

      // Set opacity picker position
      y = keepWithin(opacitySlider.height() - opacitySlider.height() * opacity, 0, opacitySlider.height());
      opacityPicker.css('top', y + 'px');
    }

    // Set opacity to zero if input value is transparent
    if (input.val().toLowerCase() === 'transparent') {
      swatch.find('span').css('opacity', 0);
    }

    // Update swatch
    swatch.find('span').css('backgroundColor', hex);

    // Determine picker locations
    switch (settings.control) {

      case 'wheel':
        // Set grid position
        r = keepWithin(Math.ceil(hsb.s * 0.75), 0, grid.height() / 2);
        phi = hsb.h * Math.PI / 180;
        x = keepWithin(75 - Math.cos(phi) * r, 0, grid.width());
        y = keepWithin(75 - Math.sin(phi) * r, 0, grid.height());
        gridPicker.css({
          top: y + 'px',
          left: x + 'px'
        });

        // Set slider position
        y = 150 - hsb.b / (100 / grid.height());
        if (hex === '') y = 0;
        sliderPicker.css('top', y + 'px');

        // Update panel color
        slider.css('backgroundColor', hsb2hex({ h: hsb.h, s: hsb.s, b: 100 }));
        break;

      case 'saturation':
        // Set grid position
        x = keepWithin(5 * hsb.h / 12, 0, 150);
        y = keepWithin(grid.height() - Math.ceil(hsb.b / (100 / grid.height())), 0, grid.height());
        gridPicker.css({
          top: y + 'px',
          left: x + 'px'
        });

        // Set slider position
        y = keepWithin(slider.height() - hsb.s * (slider.height() / 100), 0, slider.height());
        sliderPicker.css('top', y + 'px');

        // Update UI
        slider.css('backgroundColor', hsb2hex({ h: hsb.h, s: 100, b: hsb.b }));
        minicolors.find('.minicolors-grid-inner').css('opacity', hsb.s / 100);
        break;

      case 'brightness':
        // Set grid position
        x = keepWithin(5 * hsb.h / 12, 0, 150);
        y = keepWithin(grid.height() - Math.ceil(hsb.s / (100 / grid.height())), 0, grid.height());
        gridPicker.css({
          top: y + 'px',
          left: x + 'px'
        });

        // Set slider position
        y = keepWithin(slider.height() - hsb.b * (slider.height() / 100), 0, slider.height());
        sliderPicker.css('top', y + 'px');

        // Update UI
        slider.css('backgroundColor', hsb2hex({ h: hsb.h, s: hsb.s, b: 100 }));
        minicolors.find('.minicolors-grid-inner').css('opacity', 1 - hsb.b / 100);
        break;

      default:
        // Set grid position
        x = keepWithin(Math.ceil(hsb.s / (100 / grid.width())), 0, grid.width());
        y = keepWithin(grid.height() - Math.ceil(hsb.b / (100 / grid.height())), 0, grid.height());
        gridPicker.css({
          top: y + 'px',
          left: x + 'px'
        });

        // Set slider position
        y = keepWithin(slider.height() - hsb.h / (360 / slider.height()), 0, slider.height());
        sliderPicker.css('top', y + 'px');

        // Update panel color
        grid.css('backgroundColor', hsb2hex({ h: hsb.h, s: 100, b: 100 }));
        break;

    }

    // Fire change event, but only if minicolors is fully initialized
    if (input.data('minicolors-initialized')) {
      doChange(input, value, opacity);
    }
  }

  // Runs the change and changeDelay callbacks
  function doChange(input, value, opacity) {

    var settings = input.data('minicolors-settings'),
        lastChange = input.data('minicolors-lastChange'),
        obj,
        sel,
        i;

    // Only run if it actually changed
    if (!lastChange || lastChange.value !== value || lastChange.opacity !== opacity) {

      // Remember last-changed value
      input.data('minicolors-lastChange', {
        value: value,
        opacity: opacity
      });

      // Check and select applicable swatch
      if (settings.swatches && settings.swatches.length !== 0) {
        if (!isRgb(value)) {
          obj = hex2rgb(value);
        } else {
          obj = parseRgb(value, true);
        }
        sel = -1;
        for (i = 0; i < settings.swatches.length; ++i) {
          if (obj.r === settings.swatches[i].r && obj.g === settings.swatches[i].g && obj.b === settings.swatches[i].b && obj.a === settings.swatches[i].a) {
            sel = i;
            break;
          }
        }

        input.parent().find('.minicolors-swatches .minicolors-swatch').removeClass('selected');
        if (i !== -1) {
          input.parent().find('.minicolors-swatches .minicolors-swatch').eq(i).addClass('selected');
        }
      }

      // Fire change event
      if (settings.change) {
        if (settings.changeDelay) {
          // Call after a delay
          clearTimeout(input.data('minicolors-changeTimeout'));
          input.data('minicolors-changeTimeout', setTimeout(function () {
            settings.change.call(input.get(0), value, opacity);
          }, settings.changeDelay));
        } else {
          // Call immediately
          settings.change.call(input.get(0), value, opacity);
        }
      }
      input.trigger('change').trigger('input');
    }
  }

  // Generates an RGB(A) object based on the input's value
  function rgbObject(input) {
    var hex = parseHex($(input).val(), true),
        rgb = hex2rgb(hex),
        opacity = $(input).attr('data-opacity');
    if (!rgb) return null;
    if (opacity !== undefined) $.extend(rgb, { a: parseFloat(opacity) });
    return rgb;
  }

  // Generates an RGB(A) string based on the input's value
  function rgbString(input, alpha) {
    var hex = parseHex($(input).val(), true),
        rgb = hex2rgb(hex),
        opacity = $(input).attr('data-opacity');
    if (!rgb) return null;
    if (opacity === undefined) opacity = 1;
    if (alpha) {
      return 'rgba(' + rgb.r + ', ' + rgb.g + ', ' + rgb.b + ', ' + parseFloat(opacity) + ')';
    } else {
      return 'rgb(' + rgb.r + ', ' + rgb.g + ', ' + rgb.b + ')';
    }
  }

  // Converts to the letter case specified in settings
  function convertCase(string, letterCase) {
    return letterCase === 'uppercase' ? string.toUpperCase() : string.toLowerCase();
  }

  // Parses a string and returns a valid hex string when possible
  function parseHex(string, expand) {
    string = string.replace(/^#/g, '');
    if (!string.match(/^[A-F0-9]{3,6}/ig)) return '';
    if (string.length !== 3 && string.length !== 6) return '';
    if (string.length === 3 && expand) {
      string = string[0] + string[0] + string[1] + string[1] + string[2] + string[2];
    }
    return '#' + string;
  }

  // Parses a string and returns a valid RGB(A) string when possible
  function parseRgb(string, obj) {

    var values = string.replace(/[^\d,.]/g, ''),
        rgba = values.split(',');

    rgba[0] = keepWithin(parseInt(rgba[0], 10), 0, 255);
    rgba[1] = keepWithin(parseInt(rgba[1], 10), 0, 255);
    rgba[2] = keepWithin(parseInt(rgba[2], 10), 0, 255);
    if (rgba[3]) {
      rgba[3] = keepWithin(parseFloat(rgba[3], 10), 0, 1);
    }

    // Return RGBA object
    if (obj) {
      return {
        r: rgba[0],
        g: rgba[1],
        b: rgba[2],
        a: rgba[3] ? rgba[3] : null
      };
    }

    // Return RGBA string
    if (typeof rgba[3] !== 'undefined' && rgba[3] <= 1) {
      return 'rgba(' + rgba[0] + ', ' + rgba[1] + ', ' + rgba[2] + ', ' + rgba[3] + ')';
    } else {
      return 'rgb(' + rgba[0] + ', ' + rgba[1] + ', ' + rgba[2] + ')';
    }
  }

  // Parses a string and returns a valid color string when possible
  function parseInput(string, expand) {
    if (isRgb(string)) {
      // Returns a valid rgb(a) string
      return parseRgb(string);
    } else {
      return parseHex(string, expand);
    }
  }

  // Keeps value within min and max
  function keepWithin(value, min, max) {
    if (value < min) value = min;
    if (value > max) value = max;
    return value;
  }

  // Checks if a string is a valid RGB(A) string
  function isRgb(string) {
    var rgb = string.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);
    return rgb && rgb.length === 4 ? true : false;
  }

  // Function to get alpha from a RGB(A) string
  function getAlpha(rgba) {
    rgba = rgba.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+(\.\d{1,2})?|\.\d{1,2})[\s+]?/i);
    return rgba && rgba.length === 6 ? rgba[4] : '1';
  }

  // Converts an HSB object to an RGB object
  function hsb2rgb(hsb) {
    var rgb = {};
    var h = Math.round(hsb.h);
    var s = Math.round(hsb.s * 255 / 100);
    var v = Math.round(hsb.b * 255 / 100);
    if (s === 0) {
      rgb.r = rgb.g = rgb.b = v;
    } else {
      var t1 = v;
      var t2 = (255 - s) * v / 255;
      var t3 = (t1 - t2) * (h % 60) / 60;
      if (h === 360) h = 0;
      if (h < 60) {
        rgb.r = t1;rgb.b = t2;rgb.g = t2 + t3;
      } else if (h < 120) {
        rgb.g = t1;rgb.b = t2;rgb.r = t1 - t3;
      } else if (h < 180) {
        rgb.g = t1;rgb.r = t2;rgb.b = t2 + t3;
      } else if (h < 240) {
        rgb.b = t1;rgb.r = t2;rgb.g = t1 - t3;
      } else if (h < 300) {
        rgb.b = t1;rgb.g = t2;rgb.r = t2 + t3;
      } else if (h < 360) {
        rgb.r = t1;rgb.g = t2;rgb.b = t1 - t3;
      } else {
        rgb.r = 0;rgb.g = 0;rgb.b = 0;
      }
    }
    return {
      r: Math.round(rgb.r),
      g: Math.round(rgb.g),
      b: Math.round(rgb.b)
    };
  }

  // Converts an RGB string to a hex string
  function rgbString2hex(rgb) {
    rgb = rgb.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);
    return rgb && rgb.length === 4 ? '#' + ('0' + parseInt(rgb[1], 10).toString(16)).slice(-2) + ('0' + parseInt(rgb[2], 10).toString(16)).slice(-2) + ('0' + parseInt(rgb[3], 10).toString(16)).slice(-2) : '';
  }

  // Converts an RGB object to a hex string
  function rgb2hex(rgb) {
    var hex = [rgb.r.toString(16), rgb.g.toString(16), rgb.b.toString(16)];
    $.each(hex, function (nr, val) {
      if (val.length === 1) hex[nr] = '0' + val;
    });
    return '#' + hex.join('');
  }

  // Converts an HSB object to a hex string
  function hsb2hex(hsb) {
    return rgb2hex(hsb2rgb(hsb));
  }

  // Converts a hex string to an HSB object
  function hex2hsb(hex) {
    var hsb = rgb2hsb(hex2rgb(hex));
    if (hsb.s === 0) hsb.h = 360;
    return hsb;
  }

  // Converts an RGB object to an HSB object
  function rgb2hsb(rgb) {
    var hsb = { h: 0, s: 0, b: 0 };
    var min = Math.min(rgb.r, rgb.g, rgb.b);
    var max = Math.max(rgb.r, rgb.g, rgb.b);
    var delta = max - min;
    hsb.b = max;
    hsb.s = max !== 0 ? 255 * delta / max : 0;
    if (hsb.s !== 0) {
      if (rgb.r === max) {
        hsb.h = (rgb.g - rgb.b) / delta;
      } else if (rgb.g === max) {
        hsb.h = 2 + (rgb.b - rgb.r) / delta;
      } else {
        hsb.h = 4 + (rgb.r - rgb.g) / delta;
      }
    } else {
      hsb.h = -1;
    }
    hsb.h *= 60;
    if (hsb.h < 0) {
      hsb.h += 360;
    }
    hsb.s *= 100 / 255;
    hsb.b *= 100 / 255;
    return hsb;
  }

  // Converts a hex string to an RGB object
  function hex2rgb(hex) {
    hex = parseInt(hex.indexOf('#') > -1 ? hex.substring(1) : hex, 16);
    return {
      /* jshint ignore:start */
      r: hex >> 16,
      g: (hex & 0x00FF00) >> 8,
      b: hex & 0x0000FF
      /* jshint ignore:end */
    };
  }

  // Handle events
  $(document)
  // Hide on clicks outside of the control
  .on('mousedown.minicolors touchstart.minicolors', function (event) {
    if (!$(event.target).parents().add(event.target).hasClass('minicolors')) {
      hide();
    }
  })
  // Start moving
  .on('mousedown.minicolors touchstart.minicolors', '.minicolors-grid, .minicolors-slider, .minicolors-opacity-slider', function (event) {
    var target = $(this);
    event.preventDefault();
    $(document).data('minicolors-target', target);
    move(target, event, true);
  })
  // Move pickers
  .on('mousemove.minicolors touchmove.minicolors', function (event) {
    var target = $(document).data('minicolors-target');
    if (target) move(target, event);
  })
  // Stop moving
  .on('mouseup.minicolors touchend.minicolors', function () {
    $(this).removeData('minicolors-target');
  })
  // Selected a swatch
  .on('click.minicolors', '.minicolors-swatches li', function (event) {
    event.preventDefault();
    var target = $(this),
        input = target.parents('.minicolors').find('.minicolors-input'),
        color = target.data('swatch-color');
    updateInput(input, color, getAlpha(color));
    updateFromInput(input);
  })
  // Show panel when swatch is clicked
  .on('mousedown.minicolors touchstart.minicolors', '.minicolors-input-swatch', function (event) {
    var input = $(this).parent().find('.minicolors-input');
    event.preventDefault();
    if (input.parent().find('.minicolors-panel').css("display") !== "none") {
      //todo
      //hide();
    } else {
      show(input);
    }
  })
  // Show on focus
  .on('focus.minicolors', '.minicolors-input', function () {
    var input = $(this);
    if (!input.data('minicolors-initialized')) return;
    show(input);
  })
  // Update value on blur
  .on('blur.minicolors', '.minicolors-input', function () {
    var input = $(this),
        settings = input.data('minicolors-settings'),
        keywords,
        hex,
        rgba,
        swatchOpacity,
        value;

    if (!input.data('minicolors-initialized')) return;

    // Get array of lowercase keywords
    keywords = !settings.keywords ? [] : $.map(settings.keywords.split(','), function (a) {
      return $.trim(a.toLowerCase());
    });

    // Set color string
    if (input.val() !== '' && $.inArray(input.val().toLowerCase(), keywords) > -1) {
      value = input.val();
    } else {
      // Get RGBA values for easy conversion
      if (isRgb(input.val())) {
        rgba = parseRgb(input.val(), true);
      } else {
        hex = parseHex(input.val(), true);
        rgba = hex ? hex2rgb(hex) : null;
      }

      // Convert to format
      if (rgba === null) {
        value = settings.defaultValue;
      } else if (settings.format === 'rgb') {
        value = settings.opacity ? parseRgb('rgba(' + rgba.r + ',' + rgba.g + ',' + rgba.b + ',' + input.attr('data-opacity') + ')') : parseRgb('rgb(' + rgba.r + ',' + rgba.g + ',' + rgba.b + ')');
      } else {
        value = rgb2hex(rgba);
      }
    }

    // Update swatch opacity
    swatchOpacity = settings.opacity ? input.attr('data-opacity') : 1;
    if (value.toLowerCase() === 'transparent') swatchOpacity = 0;
    input.closest('.minicolors').find('.minicolors-input-swatch > span').css('opacity', swatchOpacity);

    // Set input value
    input.val(value);

    // Is it blank?
    if (input.val() === '') input.val(parseInput(settings.defaultValue, true));

    // Adjust case
    input.val(convertCase(input.val(), settings.letterCase));
  })
  // Handle keypresses
  .on('keydown.minicolors', '.minicolors-input', function (event) {
    var input = $(this);
    if (!input.data('minicolors-initialized')) return;
    switch (event.keyCode) {
      case 9:
        // tab
        hide();
        break;
      case 13: // enter
      case 27:
        // esc
        hide();
        input.blur();
        break;
    }
  })
  // Update on keyup
  .on('keyup.minicolors', '.minicolors-input', function () {
    var input = $(this);
    if (!input.data('minicolors-initialized')) return;
    updateFromInput(input, true);
  })
  // Update on paste
  .on('paste.minicolors', '.minicolors-input', function () {
    var input = $(this);
    if (!input.data('minicolors-initialized')) return;
    setTimeout(function () {
      updateFromInput(input, true);
    }, 1);
  });
});

/***/ }),
/* 34 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


if (!$.fontSelector) {
  __webpack_require__(35);
}

if (typeof Toolbar === "undefined") {
  var Toolbar = __webpack_require__(1);
}

Toolbar.prototype.fonts = ['Arial,Helvetica,sans-serif', 'Arial Black,Gadget,sans-serif', 'Comic Sans MS,cursive', 'Courier New,Courier,monospace', 'Georgia,serif', 'Impact,Charcoal,sans-serif', 'Lucida Console,Monaco,monospace', 'Lucida Sans Unicode,Lucida Grande,sans-serif', 'Palatino Linotype,Book Antiqua,Palatino,serif', 'Tahoma,Geneva,sans-serif', 'Times New Roman,Times,serif', 'Trebuchet MS,Helvetica,sans-serif', 'Verdana,Geneva,sans-serif', 'Gill Sans,Geneva,sans-serif'];

Toolbar.prototype.tools.fontFamily = {
  scope: function scope(data, options) {
    return {
      //currentValue: data.value.get(),
      onchange: function onchange(e) {
        data.value.set(parseFloat($(e.target).val()));
      }
    };
  },
  template: '<div class="object-menu-item object-menu-font-family" title="{title}">' + '<div class="fontSelect" transclude><div class="arrow-down">',
  post: function post($item, data, options, transclude) {

    transclude.fontSelector({
      'hide_fallbacks': true,
      'initial': data.value.get(), //'Courier New,Courier New,Courier,monospace',
      'selected': data.value.set.bind(data.target),
      'fonts': data.data
    });

    this.on("destroy", function () {
      transclude.fontSelector("destroy");
    });
  }
};

/***/ }),
/* 35 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

/**
 * Font Selector - jQuery plugin 0.1
 *
 * Copyright (c) 2012 Chris Dyer
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following
 * conditions are met:
 *
 * Redistributions of source code must retain the above copyright notice, this list of conditions and the following
 * disclaimer. Redistributions in binary form must reproduce the above copyright notice, this list of conditions
 * and the following disclaimer in the documentation and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING,
 * BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO
 * EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;
 * OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 */

(function (factory) {
  if (( false ? 'undefined' : _typeof(exports)) === 'object') {
    module.exports = factory(__webpack_require__(9));
  } else {
    factory(jQuery);
  }
})(function ($) {

  'use strict';
  //if(_ && _.styleSheetContains && !_.styleSheetContains('.fontSelect')){
  //  _.linkCSS(_.scriptURL() + "/../../css/jquery.fontSelector.css");
  //}

  var settings;

  var methods = {
    destroy: function destroy(options) {
      this.ul.remove();
    },
    close: function close(options) {
      this.closeUl();
    },
    init: function init(options) {

      settings = $.extend({
        'hide_fallbacks': false,
        'selected': function selected(style) {},
        'opened': function opened() {},
        'closed': function closed() {},
        'initial': '',
        'fonts': []
      }, options);

      var root = this;
      var $root = $(this);
      root.selectedCallback = settings['selected'];
      root.openedCallback = settings['opened'];
      root.closedCallback = settings['closed'];
      var visible = false;
      var selected = false;
      var openedClass = 'fontSelectOpen';

      var displayName = function displayName(font) {
        if (settings['hide_fallbacks']) {
          var index = font.indexOf(',');
          if (index == -1) return font;
          return font.substr(0, index);
        } else return font;
      };

      var select = function select(font, initial) {
        root.find('span').html(displayName(font).replace(/["']{1}/gi, ""));
        root.css('font-family', font);
        selected = font;

        if (!initial) root.selectedCallback(selected);
      };

      var positionUl = function positionUl() {
        var left, top;
        left = $(root).offset().left;
        top = $(root).offset().top + $(root).outerHeight();

        $(ul).css({
          'position': 'absolute',
          'left': left + 'px',
          'top': top + 'px',
          'width': $(root).outerWidth() + 'px'
        });
      };

      var closeUl = this.closeUl = function () {
        ul.slideUp('fast', function () {
          visible = false;
        });

        $root.removeClass(openedClass);

        root.closedCallback();
      };

      var openUi = function openUi() {
        ul.slideDown('fast', function () {
          visible = true;
        });

        $root.addClass(openedClass);

        root.openedCallback();
      };

      // Setup markup
      $root.prepend('<span>' + settings['initial'].replace(/'/g, '&#039;') + '</span>');
      var ul = this.ul = $('<ul class="fontSelectUl"></ul>').appendTo('body');
      ul.hide();
      positionUl();

      for (var i = 0; i < settings['fonts'].length; i++) {
        var item = $('<li>' + displayName(settings['fonts'][i]) + '</li>').appendTo(ul);
        item.css('font-family', settings['fonts'][i]);
        item[0].data = settings['fonts'][i];
      }

      if (settings['initial'] != '') select(settings['initial'], true);

      ul.find('li').click(function () {

        if (!visible) return;

        positionUl();
        closeUl();

        select(this.data);
      });

      $root.click(function (event) {

        if (visible) return;

        event.stopPropagation();

        positionUl();
        openUi();
      });

      $('html').click(function () {
        if (visible) {
          closeUl();
        }
      });
    },
    selected: function selected() {
      return this.data;
    },
    select: function select(font) {
      this.find('span').html(font.substr(0, font.indexOf(',')).replace(/["']{1}/gi, ""));
      this.css('font-family', font);
      var selected = false;
      selected = font;
    }
  };
  $.fontSelector = {};

  $.fn.fontSelector = function (method) {
    if (methods[method]) {
      return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
    } else if ((typeof method === 'undefined' ? 'undefined' : _typeof(method)) === 'object' || !method) {
      return methods.init.apply(this, arguments);
    } else {
      $.error('Method ' + method + ' does not exist on jQuery.fontSelector');
    }
  };
});

/***/ }),
/* 36 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


;
if (typeof Toolbar === "undefined") {
  var Toolbar = __webpack_require__(1);
}

Toolbar.prototype.updateSelectedOption = function (data) {
  var $checked = data.$item.find(":checked");
  var $checkedOptionEl = $($checked.parents()[0]);

  var selOption = data.$item.find('.btn-selected-option');
  selOption.html($checkedOptionEl.find("label")[0].outerHTML);
};

Toolbar.prototype.tools.option = {
  scope: function scope(data, options) {
    var _self = this;
    return {
      parentId: data.parent.id,
      valueCurrent: data.parent.value.get() === data.option,
      onchange: function onchange() {
        //оптимизировать

        var $checked = data.$item.find(":checked");
        var _value = $checked.val();
        if (_value == data.option) {
          data.parent.value.set(_value);
        }
        _self.updateSelectedOption(data.parent);
      }
    };
  },
  template: '<div class="object-menu-item object-menu-option " title="{title}" >' + '<input type="radio" id="tool-{id}" dp-checked="{valueCurrent}" name="{parentId}" value="{option}" onchange="onchange()">' + '<label class="btn button-{id} {className}" for="tool-{id}">' + '<img dp-if="icon" dp-src="icon">' + '<span dp-include="svg" dp-if="svg"></span>' + '<span dp-if="title" class="option-title">{title}</span>'
};

Toolbar.prototype.tools.options = {
  scope: function scope(data, options) {
    return {
      className: data.className || 'items-column',
      buttonsTitle: options.buttons && options.buttons.title || false,
      buttonsClassName: options.buttons.className || ''
    };
  },
  template: '<div class="object-menu-item object-menu-options {className}" title="{title}">' + '<div class="btn-selected-option"></div>' + '<div class="object-menu-options-container" transclude>',
  post: function post($item, data, options, transclude) {
    this.generateMenu(data.target, transclude, options, data.menu);
    this.updateSelectedOption(data);
  }
};

/***/ }),
/* 37 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


;
if (typeof Toolbar === "undefined") {
  var Toolbar = __webpack_require__(1);
}

Toolbar.prototype.tools.select = {
  scope: function scope(data, options) {
    return {
      getInputValue: function getInputValue() {
        return parseFloat(data.$item.find("input").val());
      },
      getValue: data.value.get,
      setValue: data.value.set,
      onchange: function onchange(e, model) {
        data.value.set(e.params.data.id, model);
      }
    };
  },
  template: '<div class="object-menu-item object-menu-select {itemClassName}" title="{title}" ><label for="xxx" class="btn button-{id} {className}"></label><select id="xxx">',
  post: function post($item, data, options, tool, val) {
    var model = data.value.options();
    var _val = data.value.get();
    var _select = $item.find("select");
    _select.dpSelect({
      minimumResultsForSearch: Infinity,
      dropdownParent: $("body"),
      data: model,
      templateSelection: function templateSelection(state, container) {
        return data.templateSelection(state, container, data);
      },
      templateResult: function templateResult(state, container) {
        return data.templateResult(state, container, data);
      }
    }).on("select2:select", function (e) {
      data.onchange(e, model);
    });
    _select.dpSelect("val", [_val]);

    this.on("destroy", function () {
      _select.dpSelect("destroy");
    });
  }
};

/***/ }),
/* 38 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


if (typeof Toolbar === "undefined") {
  var Toolbar = __webpack_require__(1);
}

Toolbar.prototype.colorpicker = function (el, options) {
  options.format = 'rgb';
  options.opacity = true;
  el.minicolors(options);
};

Toolbar.prototype.tools.effect = {
  scope: function scope(data, options) {
    return {
      buttonsTitle: options.buttons && options.buttons.title || false,
      isParameters: !!data.actionParameters,
      buttonscClassName: options.buttons && options.buttons.className || ''
    };
  },
  template: '<div class="object-menu-item" title="{title}">' + '<button class="btn button-{id} {className} {buttonscClassName}">' + '<span dp-if="buttonsTitle" class="button-title">{title}</span>' + '</button>' + '<div dp-if="isParameters" class="menu-action-parameters" style="display: none" transclude></div>' + '</div>',
  post: function post($item, data, options, transclude) {

    if (data.container) {
      transclude = $(document.getElementById(data.container));
    }

    var $tpl;
    var foo = function foo() {
      if (data.effectTpl) {
        $tpl = $(data.effectTpl);
        transclude.html($tpl);
      }
      if (data.actionParametersId) {
        $tpl = $("#" + data.actionParametersId).clone();
        transclude.html($tpl);
      }
      return data.actionParameters.call(data.target, transclude, data, options);
    };
    this.toggleByButton($item, transclude, foo, data);
  }
};

/***/ }),
/* 39 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

var _bindEvents2 = fabric.Canvas.prototype._bindEvents;
var _onMouseDown_overwritten = fabric.Canvas.prototype._onMouseDown;
var _onMouseUp_overwritten = fabric.Canvas.prototype._onMouseUp;
var _initEventListeners_overwritten = fabric.Canvas.prototype._initEventListeners;
var removeListeners_overwritten = fabric.Canvas.prototype.removeListeners;

fabric.util.object.extend(fabric.Canvas.prototype, {
  tapholdThreshold: 2000,
  _bindEvents: function _bindEvents() {
    _bindEvents2.call(this);
    this._onClick = this._onClick.bind(this);
    this._onDoubleClick = this._onDoubleClick.bind(this);
    this._onTapHold = this._onTapHold.bind(this);
  },

  _onDoubleClick: function _onDoubleClick(e) {
    var self = this;

    var target = self.findTarget(e);
    self.fire('mouse:dblclick', {
      target: target,
      e: e
    });

    if (target && !self.isDrawingMode) {
      // To unify the behavior, the object's double click event does not fire on drawing mode.
      target.fire('dblclick', {
        e: e
      });
    }
  },

  _onDrop: function _onDrop(e) {
    var _zoom = this.getZoom();
    e.x /= _zoom;
    e.y /= _zoom;
    e.offsetX /= _zoom;
    e.offsetY /= _zoom;
    e.width = e.helper.width() / _zoom;
    e.height = e.helper.height() / _zoom;
    var self = this;

    this.fire('mouse:drop', e);
  },

  _onDragMove: function _onDragMove(e) {
    var self = this;

    var target = self.findTarget(e.originalEvent);
    self.fire('mouse:dragmove', {
      target: target,
      e: e,
      data: e.data
    });
    if (target && !self.isDrawingMode) {
      // To unify the behavior, the object's double click event does not fire on drawing mode.
      target.fire('object:dragmove', {
        e: e,
        data: e.data
      });
    }
    if (this._last_target == target) return;
    if (this._last_target) {
      self.fire('mouse:dragleave', {
        target: this._last_target,
        e: e,
        data: e.data
      });
      this._last_target.fire('object:dragleave', {
        e: e,
        data: e.data
      });
      this._last_target = false;
    }
    if (target) {

      self.fire('mouse:dragenter', {
        target: target,
        e: e,
        data: e.data
      });
      target.fire('object:dragenter', {
        e: e,
        data: e.data
      });

      this._last_target = target;
    }
  },

  _onClick: function _onClick(e) {
    var self = this;

    var target = self.findTarget(e);
    self.fire('mouse:click', {
      target: target,
      e: e
    });

    if (target && !self.isDrawingMode) {
      if (target.originalState.left == target.left && target.originalState.top == target.top && target.originalState.scaleX == target.scaleX && target.originalState.scaleY == target.scaleY && target.originalState.angle == target.angle) {
        // To unify the behavior, the object's double click event does not fire on drawing mode.
        target.fire('object:click', {
          e: e
        });
      }
    }
  },

  _onTapHold: function _onTapHold(e) {
    var self = this;

    var target = self.findTarget(e);
    self.fire('touch:taphold', {
      target: target,
      e: e
    });

    if (target && !self.isDrawingMode) {
      // To unify the behavior, the object's tap hold event does not fire on drawing mode.
      target.fire('taphold', {
        e: e
      });
    }

    if (e.type === 'touchend' && self.touchStartTimer != null) {
      clearTimeout(self.touchStartTimer);
    }
  },

  _onMouseDown: function _onMouseDown(e) {
    _onMouseDown_overwritten.call(this, e);
    var self = this;
    if (e.type === 'touchstart') {
      var touchStartTimer = setTimeout(function () {
        self._onTapHold(e);
        self.isLongTap = true;
      }, self.tapholdThreshold);
      self.touchStartTimer = touchStartTimer;
      return;
    }

    // Add right click support
    if (e.which === 3) {
      var target = this.findTarget(e);
      self.fire('mouse:down', { target: target, e: e });
      if (target && !self.isDrawingMode) {
        // To unify the behavior, the object's mouse down event does not fire on drawing mode.
        target.fire('mousedown', {
          e: e
        });
      }
    }
  },

  _onMouseUp: function _onMouseUp(e) {

    _onMouseUp_overwritten.call(this, e);

    if (e.type === 'touchend') {
      // Process tap hold.
      if (this.touchStartTimer != null) {
        clearTimeout(this.touchStartTimer);
      }
      // Process long tap.
      if (this.isLongTap) {
        this._onLongTapEnd(e);
        this.isLongTap = false;
      }
      // Process double click
      var now = new Date().getTime();
      var lastTouch = this.lastTouch || now + 1;
      var delta = now - lastTouch;
      if (delta < 300 && delta > 0) {
        // After we detct a doubletap, start over
        this.lastTouch = null;

        this._onDoubleTap(e);
      } else {
        this.lastTouch = now;
      }
    }
  },

  _onDoubleTap: function _onDoubleTap(e) {
    var self = this;

    var target = self.findTarget(e);
    self.fire('touch:doubletap', {
      target: target,
      e: e
    });

    if (target && !self.isDrawingMode) {
      // To unify the behavior, the object's double tap event does not fire on drawing mode.
      target.fire('object:doubletap', {
        e: e
      });
    }
  },

  _onLongTapEnd: function _onLongTapEnd(e) {
    var self = this;

    var target = self.findTarget(e);
    self.fire('touch:longtapend', {
      target: target,
      e: e
    });

    if (target && !self.isDrawingMode) {
      // To unify the behavior, the object's long tap end event does not fire on drawing mode.
      target.fire('object:longtapend', {
        e: e
      });
    }
  },

  _initEventListeners: function _initEventListeners() {
    var self = this;
    _initEventListeners_overwritten.call(self);

    fabric.util.addListener(self.upperCanvasEl, 'click', self._onClick);
    fabric.util.addListener(self.upperCanvasEl, 'dblclick', self._onDoubleClick);

    self.on('object:scaling', function (e) {
      if (e.target && e.target._scaling_events_enabled) {
        e.target.fire("scaling", e.e);
      }
    });
    self.on('object:selected', function (e) {
      if (e.target) {
        e.target.fire("object:selected", e.e);
      }
    });
    self.on('mouse:over', function (e) {
      if (e.target) {
        e.target.fire("mouse:over", e.e);
      }
    });

    self.on('mouse:out', function (e) {
      if (e.target) {
        e.target.fire("mouse:out", e.e);
      }
    });
  },

  removeListeners: function removeListeners() {
    var self = this;
    removeListeners_overwritten.call(self);

    fabric.util.removeListener(self.upperCanvasEl, 'click', self._onClick);
    fabric.util.removeListener(self.upperCanvasEl, 'dblclick', self._onDoubleClick);
  }
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 40 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

{

  /*
   fabric.Image.filters.Redify = fabric.util.createClass(fabric.Image.filters.BaseFilter, {
   type: 'Redify',
   applyTo: function (canvasEl) {
   var context = canvasEl.getContext('2d'),
   imageData = context.getImageData(0, 0,
   canvasEl.width, canvasEl.height),
   data = imageData.data;
   for (var i = 0, len = data.length; i < len; i += 4) {
   data[i + 1] = 0;
   data[i + 2] = 0;
   }
   context.putImageData(imageData, 0, 0);
   }
   });
   fabric.Image.filters.Redify.fromObject = function (object) {
   return new fabric.Image.filters.Redify(object);
   };
   */

  fabric.Image.filters.Sharpen = fabric.util.createClass(fabric.Image.filters.Convolute, {
    type: 'Sharpen',
    initialize: function initialize(options) {
      options = options || {};

      this.opaque = options.opaque;
      this.matrix = options.matrix || [0, -1, 0, -1, 5, -1, 0, -1, 0];
    }
  });
  fabric.Image.filters.Sharpen.fromObject = function (object) {
    return new fabric.Image.filters.Sharpen(object);
  };

  fabric.Image.filters.Blur = fabric.util.createClass(fabric.Image.filters.Convolute, {
    type: 'Blur',
    initialize: function initialize(options) {
      options = options || {};

      var _v = 1 / 9;
      this.opaque = options.opaque;
      this.matrix = options.matrix || [_v, _v, _v, _v, _v, _v, _v, _v, _v];
    }
  });
  fabric.Image.filters.Blur.fromObject = function (object) {
    return new fabric.Image.filters.Blur(object);
  };

  fabric.Image.filters.Emboss = fabric.util.createClass(fabric.Image.filters.Convolute, {
    type: 'Emboss',
    initialize: function initialize(options) {
      options = options || {};

      this.opaque = options.opaque;
      this.matrix = options.matrix || [1, 1, 1, 1, 0.7, -1, -1, -1, -1];
    }
  });
  fabric.Image.filters.Emboss.fromObject = function (object) {
    return new fabric.Image.filters.Emboss(object);
  };

  fabric.Image.filters.Mask.prototype.maskFilter = true;

  var prototypeOptions = {
    Brightness: {
      "brightness": { value: 100, min: 0, max: 255 }
    },
    Noise: {
      "noise": { value: 100, min: 0, max: 1000 }
    },
    Convolute: {
      "opaque": { value: true, type: "boolean" },
      "matrix": { value: [1, 1, 1, 1, 1, 1, 1, 1, 1], type: "matrix" }
    },
    Blur: {},
    Sharpen: {},
    Emboss: {},
    Multiply: {
      "color": { type: 'color', value: "#F0F" }
    },
    Pixelate: {
      "blocksize": { value: 4, min: 2, max: 20 }
    },
    Tint: {
      "color": { type: 'color', value: "#3513B0" },
      "opacity": { value: 1, min: 0, max: 1, step: 0.1 }
    },
    Mask: {
      mask: {
        type: 'image',
        value: {
          src: "photos/explosion.png"
        }
      },
      channel: { value: 0 }
    },
    Blend: {
      "color": { type: 'color', value: "#3513B0" },
      "mode": {
        value: "add",
        options: [{ value: "add", title: "Add" }, { value: "diff", title: "Diff" }, { value: "subtract", title: "Subtract" }, { value: "multiply", title: "Multiply" }, { value: "screen", title: "Screen" }, { value: "lighten", title: "Lighten" }, { value: "darken", title: "Darken" }]
      }
    }
  };

  for (var i in prototypeOptions) {
    fabric.Image.filters[i].prototype.options = prototypeOptions[i];
  }
}

fabric.Image.getFiltersList = function (el) {

  el = el || fabric.Image.prototype;
  var filterList = [];
  for (var i in el.availableFilters) {
    var _f = fabric.Image.filters[el.availableFilters[i]];

    var _data = {
      type: el.availableFilters[i]
    };
    if (_f.prototype.custom) {
      if (!el.customFilters) {
        continue;
      }
    }
    if (_f.prototype.maskFilter) {
      if (!el.maskFilter) {
        continue;
      }
    }
    if (_f.prototype.caman) {
      if (!el.camanFilters) {
        continue;
      }
      _data.caman = true;
    } else {
      if (!el.fabricFilters) {
        continue;
      }
    }
    if (_f.prototype.options) {
      _data.options = fabric.util.object.clone(_f.prototype.options);
    }
    _data.text = _f.prototype.title || el.availableFilters[i];

    filterList.push(_data);
  }
  return filterList;
};

fabric.util.object.extend(fabric.Image.prototype, {
  camanFilters: false,
  fabricFilters: true,
  customFilters: false,
  maskFilter: false,
  getFiltersData: function getFiltersData() {
    var _filters = fabric.Image.getFiltersList(this);
    for (var i in this.filters) {
      var _f = fabric.util.object.findWhere(_filters, { type: fabric.util.string.capitalize(this.filters[i].type) });
      if (_f) {
        _f.enabled = true;
      }
    }
    return _filters;
  },
  availableFilters: [
  //fabricJS
  "Grayscale", "Sepia", "Sepia2", "Invert", "Blur", "Sharpen", "Emboss", "Blend", "Tint", "Multiply",
  //"Convolute",
  "Noise", "Brightness", "Pixelate", "GradientTransparency", "Mask"],
  getFilter: function getFilter(filterName) {
    filterName = fabric.util.string.uncapitalize(filterName);
    for (var i in this.filters) {
      if (fabric.util.string.uncapitalize(this.filters[i].type) === filterName) {
        return this.filters[i];
      }
    }
    return false;
  },
  setFilter: function setFilter(filter) {

    var _old_filter = false;
    if (filter.replace) {
      this.filters = [];
    } else {
      _old_filter = fabric.util.object.findWhere(this.filters, { type: filter.type });
      _old_filter = _old_filter && _old_filter.toObject() || false;
    }

    if (filter.type) {
      var _type = fabric.util.string.capitalize(filter.type, true);
      var _new_filter = filter.options && fabric.util.object.clone(filter.options);
    } else {
      _type = false;
      _new_filter = false;
    }

    /* this.project.history.add({
     data:   [$.extend(true, {}, this.data)],
     slide:  this.slide,
     object: this,
     redo:   filter,
     undo:   _old_filter ,
     type:   "filter",
     undoFn: function(action){
     action.object._set_filter(action.undo);
     },
     redoFn:  function(action){
     action.object._set_filter(action.redo);
     }
     });
     */
    this._set_filter(_type, _new_filter, _old_filter);
  },

  _set_filter: function _set_filter(_type, _new_filter) {

    if (_type) {
      var _old_filter = this.getFilter(_type);
    }

    if (_old_filter && _new_filter) {
      for (var i in _new_filter) {
        _old_filter[i] = _new_filter[i];
      }
    } else if (_old_filter && !_new_filter) {
      this.filters.splice(this.filters.indexOf(_old_filter), 1);
    }
    if (!_old_filter && _new_filter) {
      this.filters.push(new fabric.Image.filters[_type](_new_filter));
    }
    this.applyFilters(this.canvas.renderAll.bind(this.canvas));
  },

  insertImageFilters: false,
  actions: fabric.util.object.extend(fabric.Image.prototype.actions, {
    filters: {
      title: "фильтр",
      itemClassName: "filters-selector",
      className: "fa fa-filter",
      type: "select",
      templateSelection: function templateSelection(state, container) {
        if (state.any) {
          return state.text;
        }
        return $('<span><span class="color-span" style="background-color:' + state.text + '"></span>' + state.text + '</span>');
      },
      templateResult: function templateResult(state, container, data) {
        var $el = $('<span>' + state.text + '</span>');
        //  if (state.id != "none") {
        var $canvas = $('<canvas>');
        fabric.util.drawFilter($canvas[0], data.target._element, state.id, {
          height: 22
        });
        $el.prepend($canvas);
        // }
        return $el;
      },
      value: {
        set: function set(val, filtersData) {
          var options = false;
          if (val == "none") {
            val = false;
          } else {
            var _f = _.findWhere(filtersData, { id: val });
            _f.enabled = !_f.enabled;
            for (var i in _f.options) {
              if ($.isNumeric(_f.options[i])) {
                _f.options[i] = parseFloat(_f.options[i]);
              }
            }
            if (_f.enabled) {
              options = {};
              for (var i in _f.options) {
                options[i] = _f.options[i].value;
              }
            }
          }
          this.setFilter({
            type: val,
            options: options,
            replace: true
          });
        },
        get: function get() {
          return this.filters.length ? fabric.util.string.capitalize(this.filters[0].type, true) : "none";
        },
        options: function options() {

          var _filters = this.getFiltersData();
          for (var i in _filters) {
            _filters[i].id = _filters[i].type;
          }
          return [{
            id: 'none',
            text: 'original',
            enabled: !this.filters || !this.filters.length
          }].concat(_filters);
        }
      }
    }
  })
});

//
// fabric.Image.filterManager = {
//
//   //hide: function(object){
//   //
//   //},
//   show: function (object) {
//     this.activeObject = object;
//     this.fire('show', object);
//     this.on('target:changed', object)
//   }
// // };


// fabric.util.observable(fabric.Image.filterManager);

fabric.util.drawFilter = function (element, src, filterName, options) {
  if (src.constructor === String) {
    fabric.util.loadImage(src, function (el) {
      fabric.util._drawFilter(element, el, filterName, options);
    });
  } else {
    fabric.util._drawFilter(element, src, filterName, options);
  }
};

fabric.util._drawFilter = function (element, el, filterName, options) {

  var ctx = element.getContext("2d");
  if (options) {
    if (options.width && options.height) {
      element.width = options.width;
      element.height = options.height;
    } else if (options.width) {
      element.width = options.width;
      element.height = options.width * (el.height / el.width);
    } else if (options.height) {
      element.height = options.height;
      element.width = options.height * (el.width / el.height);
    }
  }

  ctx.drawImage(el, 0, 0, element.width, element.height);

  if (!filterName || filterName == "none") return;
  filterName = fabric.util.string.capitalize(filterName, true);

  if (fabric.Image.filters[filterName]) {
    var _filter = new fabric.Image.filters[filterName]();
  } else {
    var _filter = fabric.Image.filters[filterName].create({});
  }

  //var _filter = new fabric.Image.filters[filterName];
  if (_filter) {
    var _fo = fabric.Image.filters[filterName].prototype.options;
    var filterOptions = {};
    for (var i in _fo) {
      filterOptions[i] = _fo[i].value;
    }
    fabric.util.object.extend(_filter, filterOptions);
    _filter.imageData = ctx.getImageData(0, 0, element.width, element.height);
    _filter.applyTo(element);
  }
};
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 41 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

if (typeof WebFont == "undefined") {
  fabric.webFontsLoader = __webpack_require__(42);
} else {
  fabric.webFontsLoader = WebFont;
}

//интересная библиотека
// http://opentype.js.org/index.html
//todo add step
//
// fabric.Application.prototype.steps.splice(3,0,"loadWebfonts");

fabric.util.object.extend(fabric.Application.prototype, {
  // setWebfonts: function (callback) {
  //
  // },
  setFonts: function setFonts(fonts, callback) {
    this.fonts = fonts;
    if (fabric.isLikelyNode) {
      //todo шрифты не грузятся на сервере
      return callback();
    }
    // if(!fonts || !fonts.length){
    //   return callback();
    // }
    this.fire("loading", { type: "webfonts" });

    this._fonts = [];

    for (var i in this.fonts) {
      this._fonts = this._fonts.concat(this.fonts[i]);
    }
    this._fonts = fabric.util.object.sortBy(this._fonts, function (font) {
      return font;
    });

    if (fabric.webFontsLoader && (this.fonts.google && this.fonts.google.length || this.fonts.custom && this.fonts.custom.length)) {
      var fonts_options = {
        active: function active() {
          callback();
        }
      };
      if (this.fonts.google && this.fonts.google.length) {
        fonts_options.google = {
          families: this.fonts.google
        };
      }
      if (this.fonts.custom && this.fonts.custom.length) {
        fonts_options.custom = {
          families: this.fonts.custom
        };
      }

      fabric.webFontsLoader.load(fonts_options);
    } else {
      callback();
    }
    if (this.waitForWebfonts) {
      fabric.util.fonts.waitFor(this.waitForWebfonts, callback);
    }
  },
  fonts: {
    standart: ['Arial', 'Arial Black', 'Comic Sans MS', 'Courier New', 'Georgia', 'Impact', 'Lucida Console', 'Tahoma', 'Times New Roman', 'Geneva', 'sans-serif', 'serif', 'monospace', 'cursive'],
    google: [],
    custom: []
  }
});

fabric.util.fonts = {
  waitFor: function waitFor(fonts, callback) {
    var loadedFonts = 0;
    for (var i = 0, l = fonts.length; i < l; ++i) {
      (function (font) {
        var node = document.createElement('span');
        // Characters that vary significantly among different fonts
        node.innerHTML = 'giItT1WQy@!-/#';
        // Visible - so we can measure it - but not on the screen
        node.style.position = 'absolute';
        node.style.left = '-10000px';
        node.style.top = '-10000px';
        // Large font size makes even subtle changes obvious
        node.style.fontSize = '300px';
        // Reset any font properties
        node.style.fontFamily = 'sans-serif';
        node.style.fontVariant = 'normal';
        node.style.fontStyle = 'normal';
        node.style.fontWeight = 'normal';
        node.style.letterSpacing = '0';
        document.body.appendChild(node);

        // Remember width with no applied web font
        var width = node.offsetWidth;

        node.style.fontFamily = font;

        var interval;

        function checkFont() {
          // Compare current width with original width
          if (node && node.offsetWidth != width) {
            ++loadedFonts;
            node.parentNode.removeChild(node);
            node = null;
          }

          // If all fonts have been loaded
          if (loadedFonts >= fonts.length) {
            if (interval) {
              clearInterval(interval);
            }
            if (loadedFonts == fonts.length) {
              setTimeout(function () {
                callback();
              }, 50);
              return true;
            }
          }
        }

        if (!checkFont()) {
          interval = setInterval(checkFont, 50);
        }
      })(fonts[i]);
    }
  }
};
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 42 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
var __WEBPACK_AMD_DEFINE_RESULT__;

/* Web Font Loader v1.6.26 - (c) Adobe Systems, Google. License: Apache 2.0 */(function () {
  function aa(a, b, c) {
    return a.call.apply(a.bind, arguments);
  }function ba(a, b, c) {
    if (!a) throw Error();if (2 < arguments.length) {
      var d = Array.prototype.slice.call(arguments, 2);return function () {
        var c = Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c, d);return a.apply(b, c);
      };
    }return function () {
      return a.apply(b, arguments);
    };
  }function p(a, b, c) {
    p = Function.prototype.bind && -1 != Function.prototype.bind.toString().indexOf("native code") ? aa : ba;return p.apply(null, arguments);
  }var q = Date.now || function () {
    return +new Date();
  };function ca(a, b) {
    this.a = a;this.m = b || a;this.c = this.m.document;
  }var da = !!window.FontFace;function t(a, b, c, d) {
    b = a.c.createElement(b);if (c) for (var e in c) {
      c.hasOwnProperty(e) && ("style" == e ? b.style.cssText = c[e] : b.setAttribute(e, c[e]));
    }d && b.appendChild(a.c.createTextNode(d));return b;
  }function u(a, b, c) {
    a = a.c.getElementsByTagName(b)[0];a || (a = document.documentElement);a.insertBefore(c, a.lastChild);
  }function v(a) {
    a.parentNode && a.parentNode.removeChild(a);
  }
  function w(a, b, c) {
    b = b || [];c = c || [];for (var d = a.className.split(/\s+/), e = 0; e < b.length; e += 1) {
      for (var f = !1, g = 0; g < d.length; g += 1) {
        if (b[e] === d[g]) {
          f = !0;break;
        }
      }f || d.push(b[e]);
    }b = [];for (e = 0; e < d.length; e += 1) {
      f = !1;for (g = 0; g < c.length; g += 1) {
        if (d[e] === c[g]) {
          f = !0;break;
        }
      }f || b.push(d[e]);
    }a.className = b.join(" ").replace(/\s+/g, " ").replace(/^\s+|\s+$/, "");
  }function y(a, b) {
    for (var c = a.className.split(/\s+/), d = 0, e = c.length; d < e; d++) {
      if (c[d] == b) return !0;
    }return !1;
  }
  function z(a) {
    if ("string" === typeof a.f) return a.f;var b = a.m.location.protocol;"about:" == b && (b = a.a.location.protocol);return "https:" == b ? "https:" : "http:";
  }function ea(a) {
    return a.m.location.hostname || a.a.location.hostname;
  }
  function A(a, b, c) {
    function d() {
      k && e && f && (k(g), k = null);
    }b = t(a, "link", { rel: "stylesheet", href: b, media: "all" });var e = !1,
        f = !0,
        g = null,
        k = c || null;da ? (b.onload = function () {
      e = !0;d();
    }, b.onerror = function () {
      e = !0;g = Error("Stylesheet failed to load");d();
    }) : setTimeout(function () {
      e = !0;d();
    }, 0);u(a, "head", b);
  }
  function B(a, b, c, d) {
    var e = a.c.getElementsByTagName("head")[0];if (e) {
      var f = t(a, "script", { src: b }),
          g = !1;f.onload = f.onreadystatechange = function () {
        g || this.readyState && "loaded" != this.readyState && "complete" != this.readyState || (g = !0, c && c(null), f.onload = f.onreadystatechange = null, "HEAD" == f.parentNode.tagName && e.removeChild(f));
      };e.appendChild(f);setTimeout(function () {
        g || (g = !0, c && c(Error("Script load timeout")));
      }, d || 5E3);return f;
    }return null;
  };function C() {
    this.a = 0;this.c = null;
  }function D(a) {
    a.a++;return function () {
      a.a--;E(a);
    };
  }function F(a, b) {
    a.c = b;E(a);
  }function E(a) {
    0 == a.a && a.c && (a.c(), a.c = null);
  };function G(a) {
    this.a = a || "-";
  }G.prototype.c = function (a) {
    for (var b = [], c = 0; c < arguments.length; c++) {
      b.push(arguments[c].replace(/[\W_]+/g, "").toLowerCase());
    }return b.join(this.a);
  };function H(a, b) {
    this.c = a;this.f = 4;this.a = "n";var c = (b || "n4").match(/^([nio])([1-9])$/i);c && (this.a = c[1], this.f = parseInt(c[2], 10));
  }function fa(a) {
    return I(a) + " " + (a.f + "00") + " 300px " + J(a.c);
  }function J(a) {
    var b = [];a = a.split(/,\s*/);for (var c = 0; c < a.length; c++) {
      var d = a[c].replace(/['"]/g, "");-1 != d.indexOf(" ") || /^\d/.test(d) ? b.push("'" + d + "'") : b.push(d);
    }return b.join(",");
  }function K(a) {
    return a.a + a.f;
  }function I(a) {
    var b = "normal";"o" === a.a ? b = "oblique" : "i" === a.a && (b = "italic");return b;
  }
  function ga(a) {
    var b = 4,
        c = "n",
        d = null;a && ((d = a.match(/(normal|oblique|italic)/i)) && d[1] && (c = d[1].substr(0, 1).toLowerCase()), (d = a.match(/([1-9]00|normal|bold)/i)) && d[1] && (/bold/i.test(d[1]) ? b = 7 : /[1-9]00/.test(d[1]) && (b = parseInt(d[1].substr(0, 1), 10))));return c + b;
  };function ha(a, b) {
    this.c = a;this.f = a.m.document.documentElement;this.h = b;this.a = new G("-");this.j = !1 !== b.events;this.g = !1 !== b.classes;
  }function ia(a) {
    a.g && w(a.f, [a.a.c("wf", "loading")]);L(a, "loading");
  }function M(a) {
    if (a.g) {
      var b = y(a.f, a.a.c("wf", "active")),
          c = [],
          d = [a.a.c("wf", "loading")];b || c.push(a.a.c("wf", "inactive"));w(a.f, c, d);
    }L(a, "inactive");
  }function L(a, b, c) {
    if (a.j && a.h[b]) if (c) a.h[b](c.c, K(c));else a.h[b]();
  };function ja() {
    this.c = {};
  }function ka(a, b, c) {
    var d = [],
        e;for (e in b) {
      if (b.hasOwnProperty(e)) {
        var f = a.c[e];f && d.push(f(b[e], c));
      }
    }return d;
  };function N(a, b) {
    this.c = a;this.f = b;this.a = t(this.c, "span", { "aria-hidden": "true" }, this.f);
  }function O(a) {
    u(a.c, "body", a.a);
  }function P(a) {
    return "display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:" + J(a.c) + ";" + ("font-style:" + I(a) + ";font-weight:" + (a.f + "00") + ";");
  };function Q(a, b, c, d, e, f) {
    this.g = a;this.j = b;this.a = d;this.c = c;this.f = e || 3E3;this.h = f || void 0;
  }Q.prototype.start = function () {
    var a = this.c.m.document,
        b = this,
        c = q(),
        d = new Promise(function (d, e) {
      function k() {
        q() - c >= b.f ? e() : a.fonts.load(fa(b.a), b.h).then(function (a) {
          1 <= a.length ? d() : setTimeout(k, 25);
        }, function () {
          e();
        });
      }k();
    }),
        e = new Promise(function (a, d) {
      setTimeout(d, b.f);
    });Promise.race([e, d]).then(function () {
      b.g(b.a);
    }, function () {
      b.j(b.a);
    });
  };function R(a, b, c, d, e, f, g) {
    this.v = a;this.B = b;this.c = c;this.a = d;this.s = g || "BESbswy";this.f = {};this.w = e || 3E3;this.u = f || null;this.o = this.j = this.h = this.g = null;this.g = new N(this.c, this.s);this.h = new N(this.c, this.s);this.j = new N(this.c, this.s);this.o = new N(this.c, this.s);a = new H(this.a.c + ",serif", K(this.a));a = P(a);this.g.a.style.cssText = a;a = new H(this.a.c + ",sans-serif", K(this.a));a = P(a);this.h.a.style.cssText = a;a = new H("serif", K(this.a));a = P(a);this.j.a.style.cssText = a;a = new H("sans-serif", K(this.a));a = P(a);this.o.a.style.cssText = a;O(this.g);O(this.h);O(this.j);O(this.o);
  }var S = { D: "serif", C: "sans-serif" },
      T = null;function U() {
    if (null === T) {
      var a = /AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);T = !!a && (536 > parseInt(a[1], 10) || 536 === parseInt(a[1], 10) && 11 >= parseInt(a[2], 10));
    }return T;
  }R.prototype.start = function () {
    this.f.serif = this.j.a.offsetWidth;this.f["sans-serif"] = this.o.a.offsetWidth;this.A = q();la(this);
  };
  function ma(a, b, c) {
    for (var d in S) {
      if (S.hasOwnProperty(d) && b === a.f[S[d]] && c === a.f[S[d]]) return !0;
    }return !1;
  }function la(a) {
    var b = a.g.a.offsetWidth,
        c = a.h.a.offsetWidth,
        d;(d = b === a.f.serif && c === a.f["sans-serif"]) || (d = U() && ma(a, b, c));d ? q() - a.A >= a.w ? U() && ma(a, b, c) && (null === a.u || a.u.hasOwnProperty(a.a.c)) ? V(a, a.v) : V(a, a.B) : na(a) : V(a, a.v);
  }function na(a) {
    setTimeout(p(function () {
      la(this);
    }, a), 50);
  }function V(a, b) {
    setTimeout(p(function () {
      v(this.g.a);v(this.h.a);v(this.j.a);v(this.o.a);b(this.a);
    }, a), 0);
  };function W(a, b, c) {
    this.c = a;this.a = b;this.f = 0;this.o = this.j = !1;this.s = c;
  }var X = null;W.prototype.g = function (a) {
    var b = this.a;b.g && w(b.f, [b.a.c("wf", a.c, K(a).toString(), "active")], [b.a.c("wf", a.c, K(a).toString(), "loading"), b.a.c("wf", a.c, K(a).toString(), "inactive")]);L(b, "fontactive", a);this.o = !0;oa(this);
  };
  W.prototype.h = function (a) {
    var b = this.a;if (b.g) {
      var c = y(b.f, b.a.c("wf", a.c, K(a).toString(), "active")),
          d = [],
          e = [b.a.c("wf", a.c, K(a).toString(), "loading")];c || d.push(b.a.c("wf", a.c, K(a).toString(), "inactive"));w(b.f, d, e);
    }L(b, "fontinactive", a);oa(this);
  };function oa(a) {
    0 == --a.f && a.j && (a.o ? (a = a.a, a.g && w(a.f, [a.a.c("wf", "active")], [a.a.c("wf", "loading"), a.a.c("wf", "inactive")]), L(a, "active")) : M(a.a));
  };function pa(a) {
    this.j = a;this.a = new ja();this.h = 0;this.f = this.g = !0;
  }pa.prototype.load = function (a) {
    this.c = new ca(this.j, a.context || this.j);this.g = !1 !== a.events;this.f = !1 !== a.classes;qa(this, new ha(this.c, a), a);
  };
  function ra(a, b, c, d, e) {
    var f = 0 == --a.h;(a.f || a.g) && setTimeout(function () {
      var a = e || null,
          k = d || null || {};if (0 === c.length && f) M(b.a);else {
        b.f += c.length;f && (b.j = f);var h,
            m = [];for (h = 0; h < c.length; h++) {
          var l = c[h],
              n = k[l.c],
              r = b.a,
              x = l;r.g && w(r.f, [r.a.c("wf", x.c, K(x).toString(), "loading")]);L(r, "fontloading", x);r = null;null === X && (X = window.FontFace ? (x = /Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent)) ? 42 < parseInt(x[1], 10) : !0 : !1);X ? r = new Q(p(b.g, b), p(b.h, b), b.c, l, b.s, n) : r = new R(p(b.g, b), p(b.h, b), b.c, l, b.s, a, n);m.push(r);
        }for (h = 0; h < m.length; h++) {
          m[h].start();
        }
      }
    }, 0);
  }function qa(a, b, c) {
    var d = [],
        e = c.timeout;ia(b);var d = ka(a.a, c, a.c),
        f = new W(a.c, b, e);a.h = d.length;b = 0;for (c = d.length; b < c; b++) {
      d[b].load(function (b, d, c) {
        ra(a, f, b, d, c);
      });
    }
  };function sa(a, b) {
    this.c = a;this.a = b;
  }function ta(a, b, c) {
    var d = z(a.c);a = (a.a.api || "fast.fonts.net/jsapi").replace(/^.*http(s?):(\/\/)?/, "");return d + "//" + a + "/" + b + ".js" + (c ? "?v=" + c : "");
  }
  sa.prototype.load = function (a) {
    function b() {
      if (f["__mti_fntLst" + d]) {
        var c = f["__mti_fntLst" + d](),
            e = [],
            h;if (c) for (var m = 0; m < c.length; m++) {
          var l = c[m].fontfamily;void 0 != c[m].fontStyle && void 0 != c[m].fontWeight ? (h = c[m].fontStyle + c[m].fontWeight, e.push(new H(l, h))) : e.push(new H(l));
        }a(e);
      } else setTimeout(function () {
        b();
      }, 50);
    }var c = this,
        d = c.a.projectId,
        e = c.a.version;if (d) {
      var f = c.c.m;B(this.c, ta(c, d, e), function (e) {
        e ? a([]) : (f["__MonotypeConfiguration__" + d] = function () {
          return c.a;
        }, b());
      }).id = "__MonotypeAPIScript__" + d;
    } else a([]);
  };function ua(a, b) {
    this.c = a;this.a = b;
  }ua.prototype.load = function (a) {
    var b,
        c,
        d = this.a.urls || [],
        e = this.a.families || [],
        f = this.a.testStrings || {},
        g = new C();b = 0;for (c = d.length; b < c; b++) {
      A(this.c, d[b], D(g));
    }var k = [];b = 0;for (c = e.length; b < c; b++) {
      if (d = e[b].split(":"), d[1]) for (var h = d[1].split(","), m = 0; m < h.length; m += 1) {
        k.push(new H(d[0], h[m]));
      } else k.push(new H(d[0]));
    }F(g, function () {
      a(k, f);
    });
  };function va(a, b, c) {
    a ? this.c = a : this.c = b + wa;this.a = [];this.f = [];this.g = c || "";
  }var wa = "//fonts.googleapis.com/css";function xa(a, b) {
    for (var c = b.length, d = 0; d < c; d++) {
      var e = b[d].split(":");3 == e.length && a.f.push(e.pop());var f = "";2 == e.length && "" != e[1] && (f = ":");a.a.push(e.join(f));
    }
  }
  function ya(a) {
    if (0 == a.a.length) throw Error("No fonts to load!");if (-1 != a.c.indexOf("kit=")) return a.c;for (var b = a.a.length, c = [], d = 0; d < b; d++) {
      c.push(a.a[d].replace(/ /g, "+"));
    }b = a.c + "?family=" + c.join("%7C");0 < a.f.length && (b += "&subset=" + a.f.join(","));0 < a.g.length && (b += "&text=" + encodeURIComponent(a.g));return b;
  };function za(a) {
    this.f = a;this.a = [];this.c = {};
  }
  var Aa = { latin: "BESbswy", "latin-ext": "\xE7\xF6\xFC\u011F\u015F", cyrillic: "\u0439\u044F\u0416", greek: "\u03B1\u03B2\u03A3", khmer: "\u1780\u1781\u1782", Hanuman: "\u1780\u1781\u1782" },
      Ba = { thin: "1", extralight: "2", "extra-light": "2", ultralight: "2", "ultra-light": "2", light: "3", regular: "4", book: "4", medium: "5", "semi-bold": "6", semibold: "6", "demi-bold": "6", demibold: "6", bold: "7", "extra-bold": "8", extrabold: "8", "ultra-bold": "8", ultrabold: "8", black: "9", heavy: "9", l: "3", r: "4", b: "7" },
      Ca = { i: "i", italic: "i", n: "n", normal: "n" },
      Da = /^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/;
  function Ea(a) {
    for (var b = a.f.length, c = 0; c < b; c++) {
      var d = a.f[c].split(":"),
          e = d[0].replace(/\+/g, " "),
          f = ["n4"];if (2 <= d.length) {
        var g;var k = d[1];g = [];if (k) for (var k = k.split(","), h = k.length, m = 0; m < h; m++) {
          var l;l = k[m];if (l.match(/^[\w-]+$/)) {
            var n = Da.exec(l.toLowerCase());if (null == n) l = "";else {
              l = n[2];l = null == l || "" == l ? "n" : Ca[l];n = n[1];if (null == n || "" == n) n = "4";else var r = Ba[n],
                  n = r ? r : isNaN(n) ? "4" : n.substr(0, 1);l = [l, n].join("");
            }
          } else l = "";l && g.push(l);
        }0 < g.length && (f = g);3 == d.length && (d = d[2], g = [], d = d ? d.split(",") : g, 0 < d.length && (d = Aa[d[0]]) && (a.c[e] = d));
      }a.c[e] || (d = Aa[e]) && (a.c[e] = d);for (d = 0; d < f.length; d += 1) {
        a.a.push(new H(e, f[d]));
      }
    }
  };function Fa(a, b) {
    this.c = a;this.a = b;
  }var Ga = { Arimo: !0, Cousine: !0, Tinos: !0 };Fa.prototype.load = function (a) {
    var b = new C(),
        c = this.c,
        d = new va(this.a.api, z(c), this.a.text),
        e = this.a.families;xa(d, e);var f = new za(e);Ea(f);A(c, ya(d), D(b));F(b, function () {
      a(f.a, f.c, Ga);
    });
  };function Ha(a, b) {
    this.c = a;this.a = b;
  }Ha.prototype.load = function (a) {
    var b = this.a.id,
        c = this.c.m;b ? B(this.c, (this.a.api || "https://use.typekit.net") + "/" + b + ".js", function (b) {
      if (b) a([]);else if (c.Typekit && c.Typekit.config && c.Typekit.config.fn) {
        b = c.Typekit.config.fn;for (var e = [], f = 0; f < b.length; f += 2) {
          for (var g = b[f], k = b[f + 1], h = 0; h < k.length; h++) {
            e.push(new H(g, k[h]));
          }
        }try {
          c.Typekit.load({ events: !1, classes: !1, async: !0 });
        } catch (m) {}a(e);
      }
    }, 2E3) : a([]);
  };function Ia(a, b) {
    this.c = a;this.f = b;this.a = [];
  }Ia.prototype.load = function (a) {
    var b = this.f.id,
        c = this.c.m,
        d = this;b ? (c.__webfontfontdeckmodule__ || (c.__webfontfontdeckmodule__ = {}), c.__webfontfontdeckmodule__[b] = function (b, c) {
      for (var g = 0, k = c.fonts.length; g < k; ++g) {
        var h = c.fonts[g];d.a.push(new H(h.name, ga("font-weight:" + h.weight + ";font-style:" + h.style)));
      }a(d.a);
    }, B(this.c, z(this.c) + (this.f.api || "//f.fontdeck.com/s/css/js/") + ea(this.c) + "/" + b + ".js", function (b) {
      b && a([]);
    })) : a([]);
  };var Y = new pa(window);Y.a.c.custom = function (a, b) {
    return new ua(b, a);
  };Y.a.c.fontdeck = function (a, b) {
    return new Ia(b, a);
  };Y.a.c.monotype = function (a, b) {
    return new sa(b, a);
  };Y.a.c.typekit = function (a, b) {
    return new Ha(b, a);
  };Y.a.c.google = function (a, b) {
    return new Fa(b, a);
  };var Z = { load: p(Y.load, Y) }; true ? !(__WEBPACK_AMD_DEFINE_RESULT__ = function () {
    return Z;
  }.call(exports, __webpack_require__, exports, module),
				__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__)) : "undefined" !== typeof module && module.exports ? module.exports = Z : (window.WebFont = Z, window.WebFontConfig && Y.load(window.WebFontConfig));
})();

/***/ }),
/* 43 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

/*
export interface GalleryData : {
 target: fabricjs object
}
*/

fabric.Application.prototype.setElementFromMenu = function (selectedData) {
  this.canvas.createImageObject(selectedData.image, this.uploadClass);
};

fabric.util.object.extend(fabric.Application.prototype, {
  draggableArea: ".ff-container",
  /*createGallery: function (target, $el, options) {
    if ($el.constructor === String) {
      $el = $("#" + $el);
    }
    options = options || {};
     if (target.galleryCategory) {
      options.category = target.galleryCategory;
    }
     $el.empty();
    var library = this.getLibraryElements(options);
      this.createElementsList($el, library);
     _.each(library, function (libraryItem) {
      var img = new Image();
      img.src = fabric.util.mediaRoot + libraryItem.src;
       var $img = $(img).width(100).height(100)
        .click(function () {
           var selectedData = {
            image: img,
            data: libraryItem,
            options: options
          };
          target.setElementFromMenu(selectedData);
        });
       $el.append($img);
    });
  },*/
  getFontsLibrary: function getFontsLibrary() {
    return _.map(this._fonts, function (fontName) {
      return {
        fontFamily: fontName,
        fontSize: 25,
        category: "fontFamily",
        text: fontName,
        type: "text"
      };
    });
  },
  _addCanvasEl: function _addCanvasEl(el, element, innerEl) {

    // element = fabric.util.object.cloneDeep(element);

    var canvasEl = document.createElement("canvas");
    innerEl.width = canvasEl.width = this.gallery.imageWidth;
    innerEl.height = canvasEl.height = this.gallery.imageHeight;

    var _fake_canvas = new fabric.StaticCanvas(canvasEl, { application: this });
    _fake_canvas.clear();

    element.position = "center";

    _fake_canvas.createObject(element, function (_object) {
      var b = _object.getBoundingRect();
      /* _object.set({
         left : 80 - b.width/2 - _object.strokeWidth * 2,
         top : 45 - b.height/2 - _object.strokeWidth * 2
       });*/

      fabric.util.object.extend(element, {
        scaleX: _object.scaleX,
        scaleY: _object.scaleY,
        width: _object.width,
        height: _object.height,
        left: _object.left,
        top: _object.top,
        strokeWidth: _object.strokeWidth
      });

      delete element.position;

      _fake_canvas.add(_object);
      _fake_canvas.renderAll();

      innerEl.src = canvasEl.toDataURL();

      delete _object.canvas;
      el[0].data = element;
      el[0].element = _object;
    });
  },
  updateElementsList: function updateElementsList($el, library, options) {

    var app = this;
    for (var i in library) {
      var element = library[i];
      var el = $("<span>").addClass("list-item");

      el[0].data = element;

      if (options.element) {
        element = options.element(element);
      }

      if (element.title) {
        var $span = $("<span>").text(element.title).addClass("element-title");
        el.append($span);
      }
      var $innerEl = null;

      if (options.render) {
        $innerEl = options.render(element);
      } else {
        if (element.category == "fontFamily") {
          $innerEl = $("<span>").css({
            "color": element.fill || fabric.Text.prototype.fill,
            "font-family": element.fontFamily,
            "font-size": element.fontSize
          }).text(element.text);
        } else {
          switch (element.type) {
            case "image":
              $innerEl = $("<img>").attr({
                src: fabric.util.mediaRoot + element.src
              });
              el[0].element = $innerEl[0];
              break;
            case "video":
              $innerEl = $("<video>");
              for (var type in element.src) {
                $innerEl.append($("<source>").attr({
                  src: fabric.util.mediaRoot + element.src[type],
                  type: type
                }));
              }
              el[0].element = $innerEl[0];
              break;
            default:
              $innerEl = $("<img>");
              this._addCanvasEl(el, element, $innerEl[0]);
          }
        }
      }
      if ($innerEl.constructor == Array) {
        var _span = $("<span>");
        _span.append($innerEl);
        $innerEl = _span;
      }
      el.append($innerEl);

      if (options.draggable) {
        $innerEl.draggable({
          draggable: "helper",
          droppable: ".canvas-container",
          ngModel: element,
          onMove: function onMove(data) {
            app.canvas._onDragMove && app.canvas._onDragMove(data.$event);
          },
          onDrop: function onDrop(data) {
            app.canvas._onDrop(data.$event);
          },
          draggableArea: app.draggableArea
        });
      }
      $innerEl.click(options.activate.bind(this, el[0]));
      $el.append(el);
    }
  },
  createElementsList: function createElementsList($el, library, options) {
    options = fabric.util.object.defaults(options || {}, {
      draggable: true,
      activate: function activate(el) {
        var data = fabric.util.object.clone(el.data);
        delete data.left;
        delete data.top;

        if (this.canvas.target && this.canvas.target.setData) {
          this.canvas.target.setData(data);
        } else {
          this.canvas.setData(data);
        }
      }
    });
    this.updateElementsList($el, library, options);
  }
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 44 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.objectsLibrary = {
  text: {
    title: "Text",
    type: "i-text",
    text: "Текст"
  },
  line: {
    type: "line",
    strokeWidth: 5,
    stroke: "black",
    scaleX: 1,
    scaleY: 1,
    x1: 0,
    x2: 100,
    y1: 0,
    y2: 50
  },
  triangle: {
    type: "triangle",
    width: function width(w, h) {
      return Math.min(w, h) - 4;
    },
    height: function height(w, h) {
      return Math.min(w, h) - 4;
    }
  },
  rectangle: {
    type: "rect",
    width: function width(w, h) {
      return Math.min(w, h) - 4;
    },
    height: function height(w, h) {
      return Math.min(w, h) - 4;
    }
  },
  polygon: {
    scaleX: 1,
    scaleY: 1,
    type: "polygon",
    points: function points(w, h) {
      return [{ x: 25, y: 1 }, { x: 31, y: 18 }, { x: 49, y: 18 }, { x: 35, y: 29 }, { x: 40, y: 46 }, { x: 25, y: 36 }, { x: 10, y: 46 }, { x: 15, y: 29 }, { x: 1, y: 18 }, { x: 19, y: 18 }];
    }
  },
  path: {
    "type": "path",
    "path": "m581.077942,2.537359c-2.053223,0.047071 -4.04071,0.188348 -6.108093,0.352907c-33.05542,2.663918 -62.235901,19.640541 -77.057678,44.925953l-7.8573,19.135319c1.698822,-6.633144 4.302979,-13.065384 7.8573,-19.135319c-26.430695,-22.16293 -63.531677,-32.388445 -100.192383,-27.574373c-36.661469,4.788353 -68.503082,24.041758 -85.901978,51.935225c-49.116486,-24.490013 -110.34288,-22.999454 -157.711807,3.860092c-47.369164,26.86068 -72.61673,74.40551 -64.941162,122.38308l5.021355,19.49968c-2.263329,-6.38501 -3.960793,-12.887695 -5.021355,-19.49968l-0.761948,1.798569c-41.179165,3.625244 -74.945375,29.465134 -83.716398,64.059235c-8.771805,34.597748 9.46701,70.085876 45.185621,87.96701l55.776558,10.973114c-19.480217,1.291962 -38.915543,-2.534515 -55.776558,-10.973114c-27.5478,24.96817 -33.888516,61.935303 -15.71492,92.467834c18.173733,30.524719 56.988899,48.110687 97.030457,44.11734l24.339722,-5.21109c-7.827499,2.651611 -15.960983,4.379059 -24.339722,5.21109c22.730042,33.857269 60.428192,58.556244 104.66893,68.383514c44.2491,9.81366 91.240952,4.014771 130.425949,-16.094604c31.96701,40.793823 88.707642,62.217468 145.596313,54.99707c56.902466,-7.219666 103.833984,-41.81427 120.501343,-88.770996l5.781433,-26.239532c-0.863708,8.909546 -2.742249,17.681366 -5.781433,26.239532c39.133301,20.753662 88.353333,21.927307 128.785095,3.049316c40.439819,-18.874084 65.665771,-54.869049 66.036133,-94.078247l-14.495605,-58.580597l-57.105713,-39.630768c44.163452,22.374573 71.992615,56.467255 71.601318,98.211365c52.49707,0.448181 97.103394,-35.956573 117.112427,-77.726288c20.011597,-41.769836 12.443604,-89.396759 -19.864929,-125.164642c13.401184,-26.637695 12.609985,-56.937332 -2.183472,-83.034088c-14.786194,-26.097893 -42.065491,-45.476891 -74.873047,-53.098335c-7.341431,-34.580929 -37.602661,-62.404482 -77.600708,-71.526293c-39.998474,-9.121368 -82.584839,2.123992 -109.364807,28.926123l-16.258179,22.19817c4.157959,-8.018612 9.583923,-15.495213 16.258179,-22.19817c-18.876953,-21.060713 -48.486023,-32.954061 -79.348938,-32.155401l0,0z",
    "width": function width(w, h) {
      return w - 4;
    },
    "height": function height(w, h) {
      return h - 4;
    }
  },
  ellipse: {
    "type": "ellipse",
    "rx": function rx(w, h) {
      return w / 2 - 4;
    },
    "ry": function ry(w, h) {
      return h / 2 - 4;
    }
  },
  circle: {
    type: "circle",
    radius: function radius(w, h) {
      return Math.min(w, h) / 2 - 4;
    }
  }
};

fabric.util.object.extend(fabric.Application.prototype, {
  getLibraryElements: function getLibraryElements(options) {
    var category = fabric.util.object.findWhere(this.library, { id: options.category });
    return fabric.util.object.map(fabric.util.object.cloneDeep(category.items), function (el) {
      return fabric.util.object.extend(el, category.template);
    });
  },
  /**
   *
   * @param value
   * @param callback
   *
   * @example
   [{
    "id": 5,
    "title": "video",
    "template": {
      "type": "video"
    },
    "items": [
      {
        "src": "video.mpg"
        "height": 360,
        "width": 480
      }]
    }]
   */
  setLibrary: function setLibrary(value, callback) {
    var _this = this;

    fabric.util.data.loadJson(value, function (data) {
      data.forEach(function (category) {
        if (!category.id) {
          category.id = ++fabric.util._idCounter;
        }
      });
      _this.library = data;
      callback();
    });
  }
});
fabric.Application.prototype.configurationProperties.push("library");

fabric.getObjectsList = function (w, h) {
  var _lib = [];
  for (var i in this.objectsLibrary) {
    var o = _lib[i] = fabric.util.object.cloneDeep(this.objectsLibrary[i]);
    o.title = o.title || o.type;
    if (o.width === 0) o.width = w;
    if (o.height === 0) o.height = h;
    for (var j in o) {
      if (o[j].constructor === Function) {
        o[j] = o[j].call(o, w, h);
      }
    }
  }
  return _lib;
};
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 45 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.util.object.extend(fabric, {
  debugTimeout: 0
});

fabric.util.object.extend(fabric.Application.prototype, {
  setDebug: function setDebug() {
    this.on("ready", function () {
      this.enableDebugging();
    });
  },

  enableDebugging: function enableDebugging() {
    if (fabric.debug) {

      var _operand = "color: #2EC06C; font-style: italic;";
      console.info("debug enabled. (use %capp%c, %cproject%c, %ccanvas%c, %ctarget%c in console)", _operand, "color: #202020", _operand, "color: #202020", _operand, "color: #202020", _operand, "color: #202020");

      window.app = this;
      window.canvas = this.canvas;
      window.project = this.project;
      window.target = null;
      this.canvas && this.canvas.on("target:changed", function () {
        window.target = this.target;
      });
    }
  }
});

fabric.Object.prototype.debug = function (noBorders) {
  var canvas = document.createElement("canvas");
  canvas.width = noBorders ? this.width : this.width + 2;
  canvas.height = noBorders ? this.height : this.height + 2;

  var ctx = canvas.getContext('2d');
  if (!noBorders) {
    ctx.lineWidth = 1;
    ctx.strokeStyle = "yellow";
    ctx.strokeRect(0, 0, this.width + 2, this.height + 2);
    ctx.setLineDash([4, 4]);
    ctx.strokeStyle = "#000000";
    ctx.strokeRect(0, 0, this.width + 2, this.height + 2);
  }
  ctx.translate(this.width / 2 + 1, this.height / 2 + 1);
  var _clipTo = this.clipTo;
  delete this.clipTo;
  this.render(ctx, true);
  this.clipTo = _clipTo;
  window.open(canvas.toDataURL(), "_blank");
};

fabric.Application.prototype.logEvents = fabric.Object.prototype.logEvents = function eventsLogger(options) {
  var _counter = {};
  for (var i in options) {
    _counter[i] = 0;
    this.on(options[i], function (i, event) {
      console.log(i + " " + ++_counter[i], event);
    }.bind(this, i));
  }
};
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 46 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric, __dirname) {

fabric.util.mediaRoot = "";
fabric.util.addNoCache = false;

fabric.util._loadImage_overwritten = fabric.util.loadImage;

fabric.util.object.extend(fabric.Application.prototype, {
  optionsOrder: function () {
    var oo = fabric.Application.prototype.optionsOrder;
    oo.splice(oo.indexOf("canvasContainer"), 0, "mediaRoot");
    return oo;
  }(),
  setMediaRoot: function setMediaRoot(_mediaRoot) {
    if (_mediaRoot) {
      var _dirname;
      if (fabric.isLikelyNode) {
        _dirname = __dirname;
      } else {
        _dirname = fabric.util.path.getParentDirectoryUrl(window.location.href);
      }

      //  if ((_mediaRoot.indexOf("./") == 0)) {
      //  }
      var _last = _mediaRoot[_mediaRoot.length - 1];
      if (_last != "/" && _last != "\\") {
        _mediaRoot += "/";
      }
      _mediaRoot = fabric.util.path.resolve(_dirname + _mediaRoot);
      fabric.util.mediaRoot = _mediaRoot;
    }
  }
});

// if(!fabric.isLikelyNode){
//
//   var URL = require('url'),
//     HTTP = require('http'),
//     HTTPS = require('https'),
//     Image = require('canvas').Image;
//
//   /** @private */
//   var request = function (url, encoding, callback) {
//     var oURL = URL.parse(url);
//
//     // detect if http or https is used
//     if ( !oURL.port ) {
//       oURL.port = ( oURL.protocol.indexOf('https:') === 0 ) ? 443 : 80;
//     }
//
//     // assign request handler based on protocol
//     var reqHandler = (oURL.protocol.indexOf('https:') === 0 ) ? HTTPS : HTTP,
//       req = reqHandler.request({
//         hostname: oURL.hostname,
//         port: oURL.port,
//         path: oURL.path,
//         method: 'GET'
//       }, function(response) {
//         var body = '';
//         if (encoding) {
//           response.setEncoding(encoding);
//         }
//         response.on('end', function () {
//           callback(body);
//         });
//         response.on('data', function (chunk) {
//           if (response.statusCode === 200) {
//             body += chunk;
//           }
//         });
//       });
//
//     req.on('error', function(err) {
//       if (err.errno === process.ECONNREFUSED) {
//         fabric.log('ECONNREFUSED: connection refused to ' + oURL.hostname + ':' + oURL.port);
//       }
//       else {
//         fabric.log(err.message);
//       }
//       callback(null);
//     });
//
//     req.end();
//   }
//
//   /** @private */
//   var requestFs = function (path, callback) {
//     var fs = require('fs');
//     fs.readFile(path, function (err, data) {
//       if (err) {
//         fabric.log(err);
//         throw err;
//       }
//       else {
//         callback(data);
//       }
//     });
//   };
//
//   fabric.util.loadImage = function(url, callback, context) {
//
//
//     var img = new Image();
//     img.onerror = function(){
//       console.log("error");
//       callback && callback.call(context, null, true);
//     };
//     img.onload = function(){
//       console.log("success");
//       callback && callback.call(context, img);
//     };
//
//     function createImageAndCallBack(data) {
//       if (data) {
//         img.src = data;
//         // preserving original url, which seems to be lost in node-canvas
//         img._src = url;
//       }
//       else {
//         img = null;
//         callback && callback.call(context, null, true);
//       }
//     }
//
//     if (url && (url instanceof Buffer || url.indexOf('data') === 0)) {
//       img.src = img._src = url;
//     }
//     else if (url && url.indexOf('http') !== 0) {
//       var path = require("path");
//       url = fabric.util.getURL(url);
//       url =   path.resolve(fabric.util.mediaRoot, url);
//       img.src =  url;
//       // requestFs(url, createImageAndCallBack);
//     }
//     else if (url) {
//       request(url, 'binary', createImageAndCallBack);
//     }
//     else {
//       callback && callback.call(context, url);
//     }
//   };
// }else{
fabric.util.loadResources = function (resources, callback, context, crossOrigin) {

  var loadedResources = {};
  var loader = fabric.util.queueLoad(Object.keys(resources).length, function () {
    callback(loadedResources);
  });
  for (var i in resources) {
    (function (i) {
      fabric.util.loadImage(resources[i], function (image) {
        loadedResources[i] = image;
        loader();
      }, context, crossOrigin);
    })(i);
  }
};

fabric.util.loadImage = function (url, callback, context, crossOrigin) {
  url = fabric.util.getURL(url);
  function _check_errors(img) {
    //изображение не было загружено
    if (img) {
      callback.call(this, img);
    } else {
      fabric.errors.push({ type: "image", message: "Image was not loaded" });
      fabric.util._loadImage_overwritten(fabric.media.error, callback, context, crossOrigin || 'Anonymous');
    }
  }

  if (fabric.debugTimeout) {
    setTimeout(fabric.util._loadImage_overwritten.bind(this, url, _check_errors, context, crossOrigin || 'Anonymous'), fabric.debugTimeout);
  } else {
    fabric.util._loadImage_overwritten(url, _check_errors, context, crossOrigin || 'Anonymous');
  }
};

fabric.util.getURL = function (url) {
  if (url.indexOf('blob') !== 0 && url.indexOf('data') !== 0 && url.indexOf('://') == -1) {
    url = fabric.util.mediaRoot + url;
  }
  if (fabric.util.addNoCache && /^(http|https)\:\/\//.test(url)) {
    url += '?no-cache=' + new Date().getTime();
  }
  return url;
};

fabric.util.loadVideo = function (sources, callback, context, crossOrigin) {

  function loadIt(url) {
    video.src = fabric.util.getURL(url);
    video.addEventListener("loadeddata", function () {
      callback(video);
    }, true);
    video.load();
  }

  var video = document.createElement('video');

  //trying to find the most suitable source for current browser
  for (var type in sources) {
    if (video.canPlayType(type) == "yes") {
      this.mediaType = type;
      loadIt(sources[type]);
      return;
    }
  }
  for (var type in sources) {
    if (video.canPlayType(type) == "maybe") {
      this.mediaType = type;
      loadIt(sources[type]);
      return;
    }
  }
  console.warn("video sources formats is not supported");
};

fabric.util._loadSVGFromURL_overwritten = fabric.loadSVGFromURL;
fabric.loadSVGFromURL = function (url, callback, reviver) {
  if (url.indexOf('data') !== 0 && url.indexOf('://') == -1) {
    url = fabric.util.mediaRoot + url;
  }
  if (fabric.util.addNoCache && /^(http|https)\:\/\//.test(url)) {
    url += '?no-cache=' + moment().format('x');
  }
  fabric.util._loadSVGFromURL_overwritten(url, function (data) {
    if (data) {
      return callback(data);
    }

    var xml = jQuery.parseXML(atob(fabric.media.error.substr(26)));

    fabric.parseSVGDocument(xml.documentElement, function (results, options) {
      callback && callback(results, options);
    }, reviver);
  }, reviver);
};
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0), "/"))

/***/ }),
/* 47 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.util.uploadImageMaxSize = {
  width: 400,
  height: 400
};

fabric.util.uploadImageMinSize = {
  width: 100,
  height: 100
};

fabric.util.multiUpload = false;

fabric.util.readFile = function (file, callback) {

  var reader = new FileReader();
  reader.onload = function (e) {
    var result = e.target.result;
    var type = result.substr(11, result.indexOf(";") - 11);
    var img = new Image();
    img.type = type;
    img.name = file.name;
    img.onload = function () {

      if (!fabric.util.multiUpload) {
        if (fabric.util.uploadPreprocessor) {
          fabric.util.uploadPreprocessor([this], function (val) {
            callback(val);
          }, options);
        } else {
          callback(this);
        }
      } else {
        callback();
      }
    };
    img.src = result;
  };
  reader.readAsDataURL(file);
};

fabric.util.createUploadInput = function (options, complete, progress) {

  var input = document.createElement("input");
  input.setAttribute("type", "file");
  input.setAttribute("multiple", true);
  input.className = "hidden";

  $(input).change(function () {

    if (input.files && input.files.length) {

      var _loader = fabric.util.queueLoad(input.files.length, function (loaded) {

        if (fabric.util.multiUpload) {
          if (fabric.util.uploadPreprocessor) {
            fabric.util.uploadPreprocessor(loaded, function (val) {
              complete(val, options);
            }, options);
          } else {
            complete(loaded, options);
          }
        } else {
          complete(loaded[0], options);
        }
      }, function (total, current, image) {
        if (fabric.util.multiUpload) {
          if (progress) {
            progress(total, current, image);
          }
        }
      });

      for (var i = 0; i < input.files.length; i++) {
        fabric.util.readFile(input.files[i], _loader);
      }
    }
  });

  fabric.util.uploadInput = input;
};

//fabric.util.resizeImage(img, callback);
fabric.util.uploadPreprocessor = null;

fabric.util.uploadImage = function (cb, progress, options) {
  fabric.util.createUploadInput(options, cb, progress);
  $(fabric.util.uploadInput).trigger('click');
};

fabric.util.resizeUploadedImage = function (img, callback) {

  if (img.type === "svg+xml") {
    callback(img);
    return;
  }
  //Here we can put a restriction to upload a minim sized logo
  if (img.width < fabric.util.uploadImageMinSize.width || img.height < fabric.util.uploadImageMinSize.height) {
    alert("Logo is too small. MInimum size is " + fabric.util.uploadImageMinSize.width + "x" + fabric.util.uploadImageMinSize.height);
    callback(false);
    return;
  }

  if (img.width > fabric.util.uploadImageMaxSize.width || img.height > fabric.util.uploadImageMaxSize.height) {

    var size = fabric.util.getProportions(img, fabric.util.uploadImageMaxSize, "fit");

    var filter = new fabric.Image.filters.ResizeDP();

    var canvas = fabric.util.createCanvasElementWithSize(img);
    var ctx = canvas.getContext("2d");
    ctx.drawImage(img, 0, 0);
    filter.applyTo(canvas, size.width, size.height);
    callback(canvas);
  } else {
    callback(img);
  }
};

fabric.util.object.extend(fabric.Canvas.prototype, {
  uploadClass: 'Image',
  uploadImageTool: false,
  createImageObject: function createImageObject(img, objectType) {
    if (!img) return;
    this.createObject({
      position: "center",
      active: true,
      type: this.uploadClass,
      image: img,
      clipTo: this.activeArea,
      movementLimits: this.activeArea
    });
  },
  actions: fabric.util.object.extend(fabric.SlideCanvas.prototype.actions, {
    uploadImage: {
      className: 'fa fa-upload',
      key: 'U',
      title: 'upload image',
      action: function action() {
        fabric.util.uploadImage(function (img) {
          this.createImageObject(img, this.uploadClass);
        }.bind(this));
      }
    }
  })
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 48 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.util.object.extend(fabric.Application.prototype, {
  // loaderTemplate: "<span class='fa fa-pulse fa-spinner canvas-load-spinner'></span>",
  loaderIcon: 'data:image/svg+xml;base64,' + __webpack_require__(49),
  loaderContainer: null,
  _showMainLoaderIndicator: function _showMainLoaderIndicator() {
    this.loaderEl.show();
    this.loaderContainer.addClass("processing");
  },
  _hideMainLoaderIndicator: function _hideMainLoaderIndicator() {
    this.loaderEl.hide();
    this.loaderContainer.removeClass("processing");
  },
  setLoaderTemplate: function setLoaderTemplate(val) {
    if (this.virtual) return false;
    this.loaderTemplate = val.replace("{loaderIcon}", this.loaderIcon);
    if (val) {
      this.loaderContainer = $(this.loaderContainer);
      this.loaderEl = $(this.loaderTemplate).hide();
      this.loaderContainer.append(this.loaderEl);
      // this.on("loading:begin", this._showMainLoaderIndicator);
      // this.on("loading:end", this._hideMainLoaderIndicator);


      this.on("project:changed", function () {
        this.project.on("slide:change:begin", this._showMainLoaderIndicator.bind(this));
        this.project.on("slide:changed", this._hideMainLoaderIndicator.bind(this));
      });
    }
  }
});

// fabric.util.object.extend(fabric.SlideCanvas.prototype, {
//   // loaderTemplate: "<span class='fa fa-pulse fa-spinner canvas-load-spinner'></span>",
//   setLoaderTemplate: function (val) {
//     if(this.virtual) return false;
//     this.loaderTemplate = val;
//     if(val) {
//       this.loaderEl = $(this.loaderTemplate).hide();
//       $(this.wrapperEl).append(this.loaderEl);
//       this.on("loading:begin", function () {
//         this.loaderEl.show();
//         $(this.wrapperEl).addClass("processing");
//       });
//       this.on("loading:end", function () {
//         this.loaderEl.hide();
//         $(this.wrapperEl).removeClass("processing");
//       });
//     }
//   }
// });
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 49 */
/***/ (function(module, exports) {

module.exports = "PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48c3ZnIHdpZHRoPScxODhweCcgaGVpZ2h0PScxODhweCcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2aWV3Qm94PSIwIDAgMTAwIDEwMCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pZFlNaWQiIGNsYXNzPSJ1aWwtc3BpbiI+PHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjEwMCIgaGVpZ2h0PSIxMDAiIGZpbGw9Im5vbmUiIGNsYXNzPSJiayI+PC9yZWN0PjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDUwIDUwKSI+PGcgdHJhbnNmb3JtPSJyb3RhdGUoMCkgdHJhbnNsYXRlKDM0IDApIj48Y2lyY2xlIGN4PSIwIiBjeT0iMCIgcj0iOCIgZmlsbD0iI2NmZmZkZiI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0ib3BhY2l0eSIgZnJvbT0iMSIgdG89IjAuMSIgYmVnaW49IjBzIiBkdXI9IjFzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSI+PC9hbmltYXRlPjxhbmltYXRlVHJhbnNmb3JtIGF0dHJpYnV0ZU5hbWU9InRyYW5zZm9ybSIgdHlwZT0ic2NhbGUiIGZyb209IjEuNSIgdG89IjEiIGJlZ2luPSIwcyIgZHVyPSIxcyIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiPjwvYW5pbWF0ZVRyYW5zZm9ybT48L2NpcmNsZT48L2c+PGcgdHJhbnNmb3JtPSJyb3RhdGUoNDUpIHRyYW5zbGF0ZSgzNCAwKSI+PGNpcmNsZSBjeD0iMCIgY3k9IjAiIHI9IjgiIGZpbGw9IiNjZmZmZGYiPjxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9Im9wYWNpdHkiIGZyb209IjEiIHRvPSIwLjEiIGJlZ2luPSIwLjEycyIgZHVyPSIxcyIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiPjwvYW5pbWF0ZT48YW5pbWF0ZVRyYW5zZm9ybSBhdHRyaWJ1dGVOYW1lPSJ0cmFuc2Zvcm0iIHR5cGU9InNjYWxlIiBmcm9tPSIxLjUiIHRvPSIxIiBiZWdpbj0iMC4xMnMiIGR1cj0iMXMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIj48L2FuaW1hdGVUcmFuc2Zvcm0+PC9jaXJjbGU+PC9nPjxnIHRyYW5zZm9ybT0icm90YXRlKDkwKSB0cmFuc2xhdGUoMzQgMCkiPjxjaXJjbGUgY3g9IjAiIGN5PSIwIiByPSI4IiBmaWxsPSIjY2ZmZmRmIj48YW5pbWF0ZSBhdHRyaWJ1dGVOYW1lPSJvcGFjaXR5IiBmcm9tPSIxIiB0bz0iMC4xIiBiZWdpbj0iMC4yNXMiIGR1cj0iMXMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIj48L2FuaW1hdGU+PGFuaW1hdGVUcmFuc2Zvcm0gYXR0cmlidXRlTmFtZT0idHJhbnNmb3JtIiB0eXBlPSJzY2FsZSIgZnJvbT0iMS41IiB0bz0iMSIgYmVnaW49IjAuMjVzIiBkdXI9IjFzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSI+PC9hbmltYXRlVHJhbnNmb3JtPjwvY2lyY2xlPjwvZz48ZyB0cmFuc2Zvcm09InJvdGF0ZSgxMzUpIHRyYW5zbGF0ZSgzNCAwKSI+PGNpcmNsZSBjeD0iMCIgY3k9IjAiIHI9IjgiIGZpbGw9IiNjZmZmZGYiPjxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9Im9wYWNpdHkiIGZyb209IjEiIHRvPSIwLjEiIGJlZ2luPSIwLjM3cyIgZHVyPSIxcyIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiPjwvYW5pbWF0ZT48YW5pbWF0ZVRyYW5zZm9ybSBhdHRyaWJ1dGVOYW1lPSJ0cmFuc2Zvcm0iIHR5cGU9InNjYWxlIiBmcm9tPSIxLjUiIHRvPSIxIiBiZWdpbj0iMC4zN3MiIGR1cj0iMXMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIj48L2FuaW1hdGVUcmFuc2Zvcm0+PC9jaXJjbGU+PC9nPjxnIHRyYW5zZm9ybT0icm90YXRlKDE4MCkgdHJhbnNsYXRlKDM0IDApIj48Y2lyY2xlIGN4PSIwIiBjeT0iMCIgcj0iOCIgZmlsbD0iI2NmZmZkZiI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0ib3BhY2l0eSIgZnJvbT0iMSIgdG89IjAuMSIgYmVnaW49IjAuNXMiIGR1cj0iMXMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIj48L2FuaW1hdGU+PGFuaW1hdGVUcmFuc2Zvcm0gYXR0cmlidXRlTmFtZT0idHJhbnNmb3JtIiB0eXBlPSJzY2FsZSIgZnJvbT0iMS41IiB0bz0iMSIgYmVnaW49IjAuNXMiIGR1cj0iMXMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIj48L2FuaW1hdGVUcmFuc2Zvcm0+PC9jaXJjbGU+PC9nPjxnIHRyYW5zZm9ybT0icm90YXRlKDIyNSkgdHJhbnNsYXRlKDM0IDApIj48Y2lyY2xlIGN4PSIwIiBjeT0iMCIgcj0iOCIgZmlsbD0iI2NmZmZkZiI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0ib3BhY2l0eSIgZnJvbT0iMSIgdG89IjAuMSIgYmVnaW49IjAuNjJzIiBkdXI9IjFzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSI+PC9hbmltYXRlPjxhbmltYXRlVHJhbnNmb3JtIGF0dHJpYnV0ZU5hbWU9InRyYW5zZm9ybSIgdHlwZT0ic2NhbGUiIGZyb209IjEuNSIgdG89IjEiIGJlZ2luPSIwLjYycyIgZHVyPSIxcyIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiPjwvYW5pbWF0ZVRyYW5zZm9ybT48L2NpcmNsZT48L2c+PGcgdHJhbnNmb3JtPSJyb3RhdGUoMjcwKSB0cmFuc2xhdGUoMzQgMCkiPjxjaXJjbGUgY3g9IjAiIGN5PSIwIiByPSI4IiBmaWxsPSIjY2ZmZmRmIj48YW5pbWF0ZSBhdHRyaWJ1dGVOYW1lPSJvcGFjaXR5IiBmcm9tPSIxIiB0bz0iMC4xIiBiZWdpbj0iMC43NXMiIGR1cj0iMXMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIj48L2FuaW1hdGU+PGFuaW1hdGVUcmFuc2Zvcm0gYXR0cmlidXRlTmFtZT0idHJhbnNmb3JtIiB0eXBlPSJzY2FsZSIgZnJvbT0iMS41IiB0bz0iMSIgYmVnaW49IjAuNzVzIiBkdXI9IjFzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSI+PC9hbmltYXRlVHJhbnNmb3JtPjwvY2lyY2xlPjwvZz48ZyB0cmFuc2Zvcm09InJvdGF0ZSgzMTUpIHRyYW5zbGF0ZSgzNCAwKSI+PGNpcmNsZSBjeD0iMCIgY3k9IjAiIHI9IjgiIGZpbGw9IiNjZmZmZGYiPjxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9Im9wYWNpdHkiIGZyb209IjEiIHRvPSIwLjEiIGJlZ2luPSIwLjg3cyIgZHVyPSIxcyIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiPjwvYW5pbWF0ZT48YW5pbWF0ZVRyYW5zZm9ybSBhdHRyaWJ1dGVOYW1lPSJ0cmFuc2Zvcm0iIHR5cGU9InNjYWxlIiBmcm9tPSIxLjUiIHRvPSIxIiBiZWdpbj0iMC44N3MiIGR1cj0iMXMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIj48L2FuaW1hdGVUcmFuc2Zvcm0+PC9jaXJjbGU+PC9nPjwvZz48L3N2Zz4="

/***/ }),
/* 50 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.util.object.extend(fabric.SlideCanvas.prototype, {
  setDroppable: function setDroppable(val) {
    this.droppable = val;
    if (this.droppable) {
      this.initDragAndDrop();
    }
  },
  droppable: false, //{}
  isDropAvailable: function isDropAvailable(droppable, data) {

    for (var i in droppable) {
      if (droppable[i].constructor == Array) {
        if (droppable[i].indexOf(data[i]) == -1) return false;
      } else {
        if (droppable[i] == "*") continue;
        if (droppable[i] != data[i]) return false;
      }
    }
    return true;
    //return (this.supportedTypes == "*" || this.supportedTypes.indexOf(type)!= -1)
  },
  drop: function drop(data) {
    this.setData(data);
  },
  initDragAndDrop: function initDragAndDrop() {
    this.on("mouse:drop", function (e) {
      var _x = e.x - e.offsetX;
      var _y = e.y - e.offsetY;
      var _w = e.data.width || e.width;
      var _h = e.data.height || e.height;

      if (e.data.scaleX) {
        var _scaleX = e.data.scaleX / this.viewportTransform[0];
      } else {
        _scaleX = 1;
        _w /= this.viewportTransform[0];
      }

      if (e.data.scaleY) {
        var _scaleY = e.data.scaleY / this.viewportTransform[3];
      } else {
        _scaleY = 1;
        _h /= this.viewportTransform[3];
      }

      var _stroke = e.data.strokeWidth || 0;
      if (e.data.left) {
        _x += (e.data.left + _stroke) / this.viewportTransform[0];
      }
      if (e.data.top) {
        _y += (e.data.top + _stroke) / this.viewportTransform[3];
      }

      e.data = fabric.util.object.extend({}, e.data, {
        scaleX: _scaleX,
        scaleY: _scaleY,
        left: _x,
        top: _y,
        width: _w,
        height: _h,
        originalWidth: e.data.width,
        originalHeight: e.data.height
      });

      this.fire("before:drop", e);

      e.target = this.findTarget(e.originalEvent);
      if (e.target && !this.isDrawingMode) {
        // To unify the behavior, the object's double click event does not fire on drawing mode.
        e.target.fire('object:drop', e);
      }

      if (e.target && e.target.droppable) {
        if (this.isDropAvailable(e.target.droppable, e.data)) {
          e.target.deactivate();
          e.target.drop(e.data);
        }
      } else {
        if (this.droppable && this.isDropAvailable(this.droppable, e.data)) {
          this.drop(e.data);
        }
      }
    });
    this.on("mouse:dragenter", function (e) {
      if (e.target && e.target.droppable) {
        if (this.isDropAvailable(e.target.droppable, e.data)) {
          e.target.activate();
          e.e.helper.css("cursor", "alias");
          this.setCursor("alias");
        } else {
          e.e.helper.css("cursor", "not-allowed");
          this.setCursor("not-allowed");
        }
      }
    });
    this.on("mouse:dragleave", function (e) {
      if (e.target && e.target.droppable) {
        if (this.isDropAvailable(e.target.droppable, e.data)) {
          this._activated = false;
          e.target.deactivate();
        }
        e.e.helper.css("cursor", "pointer");
      }
    });
  }
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 51 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.Guidline = fabric.util.createClass(fabric.Object, {
  top: 0,
  left: 0,
  height: 1,
  width: 1,
  griddable: false,
  responsiveBorders: true,
  groupSelectable: false,
  hasControls: false,
  hasBorders: false,
  wholeCoordinates: true,
  stored: false,
  movementLimits: "#__0",
  initialize: function initialize(options) {
    this.x = Math.round(options.x);
    this.y = Math.round(options.y);

    if (this.x) {
      this.lockMovementY = true;
      this.hoverCursor = "ew-resize";
    }

    if (this.y) {
      this.lockMovementX = true;
      this.hoverCursor = "ns-resize";
    }

    this.on({
      "removed": function removed() {
        var i = this.canvas.guidlines.indexOf(this);
        this.canvas.guidlines.splice(i, 1);
      },
      "modified": function modified() {
        if (this.x) {
          this.x = this.left + this.width / 2;
        }
        if (this.y) {
          this.y = this.top + this.height / 2;
        }
      },
      "dblclick": function dblclick() {
        this.remove();
      },
      "added": function added() {
        if (this.x) {
          this.height = this.canvas.height;
          this.width = Math.ceil(10 / this.canvas.viewportTransform[0]);
          if (this.width % 2) {
            this.width++;
          }
          this.left = this.x - this.width / 2;
        }
        if (this.y) {
          this.width = this.canvas.width;
          this.height = Math.ceil(10 / this.canvas.viewportTransform[0]);
          if (this.height % 2) {
            this.height++;
          }
          this.top = this.y - this.height / 2;
        }
        this.setCoords();
        if (this.canvas.guidlines) {
          this.canvas.guidlines.push(this);
        } else {
          this.visible = false;
        }
      }
    });
  },
  render: function render(ctx) {
    ctx.save();

    ctx.beginPath();
    ctx.strokeStyle = "#000000";
    if (this.x) {
      ctx.translate(this.left + this.width / 2, 0);
      ctx.scale(1 / this.canvas.getZoom(), 1 / this.canvas.getZoom());
      ctx.moveTo(0, 0);
      ctx.lineTo(0, this.canvas.height);
    }
    if (this.y) {
      ctx.translate(0, this.top + this.height / 2);
      ctx.scale(1 / this.canvas.getZoom(), 1 / this.canvas.getZoom());
      ctx.moveTo(0, 0);
      ctx.lineTo(this.canvas.width, 0);
    }
    ctx.stroke();
    ctx.restore();
  }
});

fabric.Ruler = fabric.util.createClass({
  initialize: function initialize(options) {

    this.canvas = options.canvas;
    this.type = options.type;
    if (options.size) this.size = options.size;
    var size;
    if (options.type == "vertical") {
      size = {
        width: this.size,
        height: this.canvas.height
      };
    } else {
      size = {
        width: this.canvas.width,
        height: this.size
      };
    }

    this.canvasElement = fabric.util.createCanvasElementWithSize(size);
    this.canvas.wrapperEl.appendChild(this.canvasElement);
    this.rulerContext = this.canvasElement.getContext('2d');
    // this.rulerContext.translate(-0.5,-0.5);
    window.rulerContext = this.rulerContext;
    this.rulerContext.imageSmoothingEnabled = false;
    this.render();
    var _this = this;
    this.canvas.on({
      'viewport:scaled changed modified': function viewportScaledChangedModified() {
        _this.render();
      }
    });
  },
  size: 30,
  orientation: "revert",
  font: "10px Open Sans",
  delimeters: [50, 10, 5, 1],
  render: function render() {

    var v = this.type == "vertical";
    var scale = this.canvas.getZoom();
    var _ctx = this.rulerContext;

    _ctx.mozImageSmoothingEnabled = false;

    _ctx.clearRect(0, 0, this.canvasElement.width, this.canvasElement.height);
    if (v) {
      this.canvasElement.height = this.canvas.height;
      _ctx.textAlign = 'end';
    } else {
      this.canvasElement.width = this.canvas.width;
    }

    var _this = this;
    function push(h) {
      var _x = Math.round(l * scale);
      if (false) {
        var x1 = 0;
        var x2 = h;
      } else {
        var x1 = _this.size;
        var x2 = _this.size - h;
      }
      if (v) {
        _ctx.moveTo(x1, _x);
        _ctx.lineTo(x2, _x);
      } else {
        _ctx.moveTo(_x, x1);
        _ctx.lineTo(_x, x2);
      }
      _ctx.stroke();
    }
    var w = (v ? this.canvas.height : this.canvas.width) / scale;
    var _del = [],
        _labels = [];
    var i = 0,
        j = 0,
        k = 0,
        l = 0,
        d = this.delimeters,
        m;

    for (i = 0; i < w / d[0]; i++) {
      k = 0;
      j = 0;
      l = i * d[0] + j * d[1] + k * d[2];
      if (l >= w) break;
      push(10);

      _ctx.font = this.font;
      if (v) {
        _ctx.strokeText(l, _this.size - 6, l * scale + 12);
      } else {
        _ctx.strokeText(l, l * scale + 2, _this.size - 8);
      }

      if (scale > 1) {

        for (j = 0; j < d[0] / d[1]; j++) {
          k = 0;
          l = i * d[0] + j * d[1] + k * d[2];
          if (l >= w) break;
          push(7);

          if (scale > 2) {
            for (k = 0; k < d[1] / d[2]; k++) {
              l = i * d[0] + j * d[1] + k * d[2];
              if (l >= w) break;
              push(4);
            }

            if (scale > 5) {

              for (m = 0; m < d[2] / d[3]; m++) {
                for (k = 0; k < d[1] / d[2]; k++) {
                  l = i * d[0] + j * d[1] + k * d[2] + m * d[3];
                  if (l >= w) break;
                  push(2);
                }
              }
            }
          }
        }
      }
    }

    this._elements = _del;
    this._labels = _labels;
    _ctx.stroke();
  }
});

fabric.util.object.extend(fabric.StaticCanvas.prototype, {
  guidlinesEnabled: false,
  createGuidline: function createGuidline(data) {
    if (data.y !== undefined) {
      if (fabric.Guidline.prototype.wholeCoordinates) {
        data.y = data.y && Math.round(data.y);
      }
      if (!fabric.util.object.findWhere(this.guidlines, { y: data.y })) {
        var gl = new fabric.Guidline({ y: data.y });
        this.add(gl);
      }
    } else if (data.x !== undefined) {
      if (fabric.Guidline.prototype.wholeCoordinates) {
        data.x = data.x && Math.round(data.x);
      }
      if (!fabric.util.object.findWhere(this.guidlines, { x: data.x })) {
        var gl = new fabric.Guidline({ x: data.x });
        this.add(gl);
      }
    }
  },
  setGuidlines: function setGuidlines(guidlines) {
    this.guidlines = guidlines;
    if (guidlines && this.guidlinesEnabled) {
      // this.guidlines = [];
      for (var i in guidlines) {
        this.createGuidline(guidlines[i]);
      }
    }
  },
  setRulers: function setRulers(value) {
    if (!value) {
      return;
    }
    this.rulers = true;
    this.vRuler = new fabric.Ruler({
      canvas: this,
      type: "vertical"
    });
    this.hRuler = new fabric.Ruler({
      canvas: this,
      type: "horizontal"
    });

    this.hRuler.canvasElement.style.position = "absolute";
    this.hRuler.canvasElement.style.left = 0;
    this.hRuler.canvasElement.style.bottom = "100%";
    this.vRuler.canvasElement.style.position = "absolute";
    this.vRuler.canvasElement.style.top = 0;
    this.vRuler.canvasElement.style.right = "100%";

    this.guidlines = [];

    var _canvas = this;

    this.on('viewport:scaled', function () {

      this.guidlines.forEach(function (gl) {
        if (gl.x) {
          gl.width = Math.ceil(10 / gl.canvas.viewportTransform[0]);
          if (gl.width % 2) {
            gl.width++;
          }
          gl.left = gl.x - gl.width / 2;
        }
        if (gl.y) {
          gl.height = Math.ceil(10 / gl.canvas.viewportTransform[0]);
          if (gl.height % 2) {
            gl.height++;
          }
          gl.top = gl.y - gl.height / 2;
        }
      });
    });

    this.hRuler.canvasElement.onclick = function (e) {
      var pointer = _canvas.getPointer(e);
      _canvas.createGuidline({ x: pointer.x });
    };

    this.vRuler.canvasElement.onclick = function (e) {
      var pointer = _canvas.getPointer(e);

      _canvas.createGuidline({ y: pointer.y });
    };
  }
});

/*
fabric.SlideCanvas.addPlugin("savers",function(propertiesToInclude, _data){
  if(propertiesToInclude.indexOf('guidlines') !== -1 && this.guidlines) {
    _data.guidlines = [];
    this.guidlines.forEach(function(_gl){
      if(_gl.x){
        _data.guidlines.push({x : _gl.x })
      }
      if(_gl.y){
        _data.guidlines.push({y : _gl.y })
      }
    })
  }
});*/
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 52 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

//var _set_background_image_overwritten = fabric.Canvas.prototype.setBackgroundImage;

fabric.util.object.extend(fabric.StaticCanvas.prototype, {
  /**
   * backgroundPosition
   * @values manual | cover | fit
   */
  backgroundPosition: 'manual',
  setBackgroundPosition: function setBackgroundPosition(src) {
    this.backgroundPosition = src;
    this._update_background_image();
    return this;
  },
  offsets: {
    left: 0,
    right: 0,
    bottom: 0,
    top: 0
  },

  // setBackgroundImage: function (src, callback, options) {
  //
  //   _set_background_image_overwritten.call(this, src, function () {
  //     this._update_background_image();
  //     callback && callback(this.backgroundImage);
  //   }.bind(this), options);
  //   return this;
  // },
  fillBackgroundColorOverCanvas: false,
  _renderBackgroundOrOverlay: function _renderBackgroundOrOverlay(ctx, property) {
    var object = this[property + 'Color'];
    if (object) {
      ctx.fillStyle = object.toLive ? object.toLive(ctx) : object;

      if (!this.fillBackgroundColorOverCanvas) {
        //todo do!!!
        ctx.fillRect(object.offsetX || this.viewportTransform[4] * this.viewportTransform[0], object.offsetY || this.viewportTransform[5] * this.viewportTransform[0], this.width * this.viewportTransform[0], this.height * this.viewportTransform[0]);
      } else {
        ctx.fillRect(object.offsetX || 0, object.offsetY || 0, this.originalWidth, this.originalHeight);
      }
    }
    object = this[property + 'Image'];
    if (object && object.constructor !== String && object.constructor !== Object) {
      object.render(ctx);
    }
  },
  getImageData: function getImageData(options) {
    options = fabric.util.object.extend({
      clipped_area: false,
      clipped_area_only: false,
      draw_background: true,
      format: 'png',
      quality: 0.8
    }, options || {});

    var size;
    if (options.clipped_area) {
      size = options.clipped_area.getBoundingRect();
      var _zoom = this.getZoom();
      size.left /= _zoom;
      size.top /= _zoom;
      size.width /= _zoom;
      size.height /= _zoom;
      fabric.util.object.extend(options, size);
    } else {
      size = {
        width: options.width || this.originalWidth || this.width,
        height: options.height || this.originalHeight || this.height
      };

      if (options.clipped_area_only) {
        size.width -= this.offsets.left + this.offsets.right;
        size.height -= this.offsets.top + this.offsets.bottom;
      }
    }
    if (options.zoom) {
      size.width *= options.zoom;
      size.height *= options.zoom;
    }

    var canvas = fabric.util.createCanvasElement();
    canvas.width = size.width;
    canvas.height = size.height;

    options.left = Math.floor(options.left);
    options.top = Math.floor(options.top);
    options.height = Math.ceil(options.height);
    options.width = Math.ceil(options.width);

    this.renderThumb(canvas, options);

    var src = canvas.toDataURL(options);

    var blob = fabric.util.dataURItoBlob(src, 'image/' + options.format);
    var objectURL = URL.createObjectURL(blob);
    return {
      dataURL: src,
      blob: blob,
      url: objectURL,
      canvas: canvas
    };
  },
  getOriginalSize: function getOriginalSize() {
    return {
      width: this.originalWidth,
      height: this.originalHeight
    };
  },

  // setOffsets: function (_offsets) {
  //   this.offsets = _offsets || fabric.util.object.extend({}, fabric.SlideCanvas.prototype.offsets);
  //   //this._update_clip_rect();
  //   return this;
  // },
  getRect: function getRect(options) {
    var rect = {};

    var _w = this.originalWidth || this.width; //this.originalWidth
    var _flexArray = fabric.util.flex(_w, [{ value: options.left, flex: 0 }, { value: options.width, flex: 1 }, { value: options.right, flex: 0 }]);
    rect.left = _flexArray[0];
    rect.width = _flexArray[1];
    rect.right = _flexArray[2];

    var _h = this.originalHeight || this.height; //this.originalHeight
    var _flexArray = fabric.util.flex(_h, [{ value: options.top, flex: 0 }, { value: options.height, flex: 1 }, { value: options.bottom, flex: 0 }]);
    rect.top = _flexArray[0];
    rect.height = _flexArray[1];
    rect.bottom = _flexArray[2];

    return rect;
  }
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 53 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.util.createThumb = function (slide, $el) {

  var _canvas = slide.canvas,
      firstDraw = true,
      modified,
      _w = +$el.getAttribute("width"),
      _h = +$el.getAttribute("height");

  if (_h) {
    $el.style.height = $el.height;
  }

  function renderThumb() {
    if (_canvas.processing || !_canvas.loaded) {
      return false;
    }
    _canvas.renderThumb($el);
    modified = _canvas.modified;
  }

  function forceRenderThumb() {
    if (this.canvas) {
      if (this.canvas.loaded) {
        this.canvas.renderThumb($el);
      }
      return;
    }
    if (firstDraw && this.data.thumb) {
      var img = new Image();
      img.onload = function () {
        var ctx = $el.getContext("2d");
        ctx.clearRect(0, 0, $el.width, $el.height);
        ctx.drawImage(img, 0, 0, $el.width, $el.height);
        modified = this.modified;
      };
      img.src = this.data.thumb;
      return;
    }

    if (attrs.force !== "true") return;
    var canvas = new fabric.SlideCanvas(null, this.data, function () {
      canvas.renderThumb($el);
      //modified = slide.modified;
    });
  }

  function scaleThumb() {

    var _container = {
      width: _w,
      height: _h
    };

    var size = {
      width: slide.canvas.originalWidth || slide.canvas.width,
      height: slide.canvas.originalHeight || slide.canvas.height
    };

    var _fitSize = fabric.util.getProportions(size, _container, "fit");

    $el.width = _fitSize.width;
    $el.height = _fitSize.height;

    $el.style.width = _fitSize.width + 'px';
    $el.style.height = _fitSize.height + 'px';
    renderThumb();
  }

  function canvasChanged() {
    // _canvas && _canvas.off('after:render', renderThumb);
    // if (this.canvas) {
    // _canvas = scope.ffThumb.canvas;
    this.canvas.on('after:render', renderThumb);
    this.canvas.on("dimensions:modified", scaleThumb);
    this.canvas.on("loading:end", scaleThumb);
    // }
  }

  $el.setAttribute("title", slide.title);
  slide.on('canvas:changed', canvasChanged);
  slide.on('modified', forceRenderThumb);

  scaleThumb.call(slide);
  forceRenderThumb.call(slide);
  canvasChanged.call(slide);
};

fabric.util.object.extend(fabric.StaticCanvas.prototype, {
  renderThumb: function renderThumb(canvas, options) {
    options = options || {
      objects: true,
      clipped_area_only: false,
      draw_background: true
    };

    if (options.zoom) {
      var _zoom = options.zoom;
    } else {
      if (canvas.width) {
        var _zoom = canvas.width / (this.originalWidth || this.width);
      } else {
        var _zoom = 1;
      }
    }
    var _old_Scale = this.viewportTransform[0];
    var old_x = this.viewportTransform[4];
    var old_y = this.viewportTransform[5];
    this.viewportTransform[4] = this.viewportTransform[5] = 0;
    this.viewportTransform[0] = this.viewportTransform[3] = 1;

    this.viewportTransform[0] = this.viewportTransform[3] = _zoom;
    //this._update_clip_rect();

    if (this.clipRect) {
      this.clipRect.setOpacity(0);
    }

    var size = {
      width: this.originalWidth || this.width,
      height: this.originalHeight || this.height
    };
    size.width = Math.ceil(size.width * _zoom);
    size.height = Math.ceil(size.height * _zoom);

    var _canvas = fabric.util.createCanvasElement();
    _canvas.width = size.width;
    _canvas.height = size.height;

    var canvasToDrawOn = _canvas.getContext('2d'),
        objsToRender;

    this.clearContext(canvasToDrawOn);
    canvasToDrawOn.save();
    canvasToDrawOn.transform.apply(canvasToDrawOn, this.viewportTransform);

    if (options.draw_background) {
      this._renderBackground(canvasToDrawOn);
      //if (this._backgroundLayer) {
      //  this._renderObjects(canvasToDrawOn, this._backgroundLayer);
      //}
    }

    if (!options.clipped_area_only && this.clipTo) {
      fabric.util.clipContext(this, canvasToDrawOn);
    }

    var _objects;
    if (options.objects && options.objects.constructor === Array) {
      _objects = options.objects;
    } else {
      _objects = options.objects !== false ? this._objects : [];
    }
    if (options.clipped_area) {
      _objects = fabric.util.object.clone(_objects);
      for (var i = _objects.length; i--;) {
        if (_objects[i].clipTo !== options.clipped_area) {
          _objects.splice(i, 1);
        }
      }
    }
    // if (fabric.version >= 1.6) {
    this._renderObjects(canvasToDrawOn, _objects);
    // } else {
    //   for (var i = 0, length = _objects.length; i < length; ++i) {
    //     this._draw(canvasToDrawOn, _objects[i]);
    //   }
    // }


    canvasToDrawOn.restore();
    if (!options.clipped_area_only && this.clipTo) {
      canvasToDrawOn.restore();
    }
    this._renderOverlay(canvasToDrawOn);
    canvasToDrawOn.restore();
    if (this.clipRect) {
      this.clipRect.setOpacity(1);
    }
    var ctx = canvas.getContext('2d');
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    if (options.clipped_area_only && this.clipRect) {
      var _rect = {
        left: this.clipRect.left * _zoom,
        top: this.clipRect.top * _zoom,
        width: this.clipRect.width * _zoom,
        height: this.clipRect.height * _zoom
      };
    } else {
      var _rect = {
        left: options.left * _zoom || 0,
        top: options.top * _zoom || 0,
        width: options.width * _zoom || size.width,
        height: options.height * _zoom || size.height
      };
    }
    if (options.angle) {
      ctx.rotate(-options.angle * Math.PI / 180);
      ctx.drawImage(_canvas, 0, 0, _rect.width + _rect.left + _canvas.width, _rect.height + _rect.top + _canvas.height, -_rect.left, -_rect.top, canvas.width + _rect.left + _canvas.width, canvas.height + _rect.top + _canvas.height);
    } else {
      ctx.drawImage(_canvas, _rect.left, _rect.top, _rect.width, _rect.height, 0, 0, canvas.width, canvas.height);
    }

    this.viewportTransform[0] = this.viewportTransform[3] = _old_Scale;
    // this._update_background_image();
    //this._update_clip_rect();

    this.viewportTransform[4] = old_x;
    this.viewportTransform[5] = old_y;

    return canvas;
  }
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 54 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

__webpack_require__(8);
__webpack_require__(55);

// todo это убрать
//fabric.movementsLimitsEasy = false;
var _toObject_overwritten = fabric.Object.prototype.toObject;
//todo use event "before:object";

fabric.Object.prototype.toObject = function (propertiesToInclude) {
  var obj = _toObject_overwritten.call(this, propertiesToInclude);
  var _storeAll = this.storeProperties.indexOf("*") != -1;
  if (this.clipTo && this.clipTo.id && (_storeAll || this.storeProperties.indexOf("clipTo") != -1)) {
    obj.clipTo = '#' + this.clipTo.id;
  }
  if (this.movementLimits && (_storeAll || this.storeProperties.indexOf("movementLimits") != -1)) {
    obj.movementLimits = this.movementLimits.id ? '#' + this.movementLimits.id : this.movementLimits;
  }
  return obj;
};

var _scaleObject_overwritten = fabric.Canvas.prototype._scaleObject;

fabric.util.object.extend(fabric.Object.prototype, {
  setWholeCoordinates: function setWholeCoordinates(val) {
    this.wholeCoordinates = val;
    this.on("added modified", function () {
      if (this.wholeCoordinates) {
        this.set({
          left: Math.round(this.left),
          top: Math.round(this.top),
          width: Math.round(this.width),
          height: Math.round(this.height)
        });
      }
    }, true);
  },
  // setTop: function(val){
  //   if(this.wholeCoordinates){
  //     val = Math.round(val);
  //   }
  //   this.top = val;
  // },
  // setLeft: function(val){
  //   if(this.wholeCoordinates){
  //     val = Math.round(val);
  //   }
  //   this.left = val;
  // },
  // setWidth: function(w){
  //   if(this.wholeCoordinates){
  //     w = Math.round(w);
  //   }
  //   this.width = w;
  // },
  // setHeight: function(h){
  //   if(this.wholeCoordinates){
  //     h = Math.round(h);
  //   }
  //   this.height = h;
  // },
  // specialProperties: fabric.Object.prototype.specialProperties.concat(["movementLimits"]),

  setActive: function setActive(value) {
    if (!this.canvas) {
      this.on("added", function () {
        if (this.canvas.interactive) {
          this.canvas.setActiveObject(this);
        }
      });
    }

    this.active = value;
  },
  setPosition: function setPosition(_position) {
    if (_position === "center") {
      this.on("added", function () {
        this.canvas.fitObject(this);
      });
    }
  },

  setMovementLimits: function setMovementLimits(val) {

    if (!this.movementLimits) {
      this.on({
        added: function added() {
          if (this.canvas.interactive) {
            this.canvas._check_object_position(this);
          }
        },
        rotated: function rotated(event) {
          var target = this;

          if (target.resizable) {
            if (pos.left !== undefined) {
              if (target.left < pos.left) {
                target.width += target.left - pos.left;
                target.left = pos.left;
              } else {
                target.width -= target.left - pos.left;
              }
            }
            if (pos.top !== undefined) {
              if (target.top < pos.top) {
                target.height += target.top - pos.top;
                target.top = pos.top;
              } else {
                target.height -= target.top - pos.top;
              }
            }
          }
          this.canvas._check_object_position(this);
        },
        modified: function modified(event) {
          this.canvas._check_object_after_modified(this);
        }
      });
    }
    this.movementLimits = val;

    /* if(this.canvas){
       this._setMovementLimitsString();
     }*/
  }
});

fabric.util.object.extend(fabric.StaticCanvas.prototype, {
  fitObject: function fitObject(el) {
    var _rect,
        maxSize,
        o = this.offsets;

    if (!el.movementLimits || el.movementLimits == "canvas") {
      var _zoom = this.getZoom();
      var _w = this.originalWidth || this.width / _zoom;
      var _h = this.originalHeight || this.height / _zoom;
      _rect = {
        width: o ? _w - o.left - o.right : _w,
        height: o ? _h - o.top - o.bottom : _h
      };
      /* offsets = {
       left: o && o.top ||0 ,
       top:  o &&  o.left ||0
       }*/
    } else if (el.movementLimits.constructor !== Function) {
      var lim = el.movementLimits;
      _rect = {
        left: lim.left * lim.scaleX,
        width: lim.width * lim.scaleX,
        top: lim.top * lim.scaleY,
        height: lim.height * lim.scaleY
      };
      //maxSize = _rect;
      // offsets = lim;
    }
    maxSize = {
      width: _rect.width * this.fitIndex,
      height: _rect.height * this.fitIndex
    };
    var size = fabric.util.getProportions(el, maxSize, 'fit');

    if (el.resizable) {
      el.setOptions({
        width: el.width * size.scale,
        height: el.height * size.scale
      });
      el.updateElement();
    } else {
      el.setOptions({
        scaleX: size.scale,
        scaleY: size.scale
      });
    }
    this.centerObject(el);
    el.setCoords();
  },
  //fix getcenter function
  centerObject: function centerObject(object) {
    var center;
    if (object.movementLimits) {

      center = this._getMovementsLimitsCenter(object.movementLimits);
    } else {
      center = this.getCenter();
    }
    this._centerObject(object, new fabric.Point(center.left, center.top));
    this.renderAll();
    return this;
  },
  getCenter: function getCenter() {
    return {
      top: this.originalHeight || this.height / 2 / this.getZoom(),
      left: this.originalWidth || this.width / 2 / this.getZoom()
    };
  },

  movementLimits: {
    left: false,
    top: false,
    right: false,
    bottom: false
  },
  setMovementLimits: function setMovementLimits(_offsets) {
    this.movementLimits = _offsets;

    return this;
  },
  //content хотя бы  пиксель объекта должен быть внутри зоны
  //fit зона должно полностью находится внутри объекта
  movementLimitMode: "fit",
  _getMovementsLimitsCenter: function _getMovementsLimitsCenter(movementLimits) {

    if (movementLimits === 'canvas') {
      var o = this.offsets;
      var _w = this.originalWidth || this.width;
      var _h = this.originalHeight || this.height;
      return { top: o.top + (_h - o.top - o.bottom) / 2, left: o.left + (_w - o.left - o.right) / 2 };
    }

    if (typeof movementLimits == "string") {
      var obj = this.getObjectByID(movementLimits.substr(1));
    } else {
      obj = movementLimits;
    }

    var _xy = obj.getCenterPoint();
    return { top: _xy.y, left: _xy.x };
  },
  _getMovementsLimitsRect: function _getMovementsLimitsRect(movementLimits) {

    var o = this.offsets;
    var _w = this.originalWidth || this.width;
    var _h = this.originalHeight || this.height;

    if (movementLimits.constructor !== String) {
      return movementLimits;
    }

    var scale = this.viewportTransform[0];

    if (movementLimits === 'canvas') {

      var rect = {
        left: o.left,
        top: o.top,
        width: _w - o.left - o.right,
        height: _h - o.top - o.bottom,
        right: o.right,
        bottom: o.bottom
      };

      rect.width *= scale;
      rect.height *= scale;
      return rect;
    } else {
      var obj = this.getObjectByID(movementLimits.substr(1));
      var _stroke_width = obj.strokeWidth;
      obj.strokeWidth = 0;

      obj.setCoords();
      var rect = obj.getBoundingRect();

      obj.strokeWidth = _stroke_width;

      rect.left /= scale;
      rect.top /= scale;
      rect.width /= scale;
      rect.height /= scale;
      rect.left -= this.viewportTransform[4] / scale;
      rect.top -= this.viewportTransform[5] / scale;

      //rect.left   += sw /2;
      //rect.top    += sw /2;
      //rect.width  -= sw;
      //rect.height -= sw;

      rect.right = _w - (rect.left + rect.width);
      rect.bottom = _h - (rect.top + rect.height);

      return rect;
    }
  },
  contentOffsets: 5,
  getFixedPosition: function getFixedPosition(target, x, y) {

    var _w = this.originalWidth || this.width;
    var _h = this.originalHeight || this.height;

    if (x === undefined) {
      x = target.left;
    }
    if (y === undefined) {
      y = target.top;
    }
    var scale = this.viewportTransform[0];
    target.setCoords();
    var bounds = target.getBoundingRect();
    bounds.left /= scale;
    bounds.top /= scale;
    bounds.width /= scale;
    bounds.height /= scale;

    bounds.left -= this.viewportTransform[4] / scale;
    bounds.top -= this.viewportTransform[5] / scale;
    bounds.right = _w - (bounds.left + bounds.width);
    bounds.bottom = _h - (bounds.top + bounds.height);

    var limits = this._getMovementsLimitsRect(target.movementLimits || this.movementLimits);
    // var limits = rect || this.movementLimits;

    var newPos = {};
    var _l = limits.left,
        _r = limits.right;
    var _t = limits.top,
        _b = limits.bottom;

    if (target.movementLimitMode === "content") {
      _l -= bounds.width - this.contentOffsets;
      _r -= bounds.width - this.contentOffsets;
      _t -= bounds.height - this.contentOffsets;
      _b -= bounds.height - this.contentOffsets;
    }

    if (target.movementLimitMode === "fit" && !target.resizable) {
      if (_l !== false && _r !== false) {
        var _w = _w - _l - _r;
        if (bounds.width > _w) {
          var _asp = _w / bounds.width;
          newPos.scaleX = _asp;
          newPos.scaleY = _asp;
        }
      }

      if (_t !== false && _b !== false) {
        var _h = _h - _t - _b;
        if (bounds.height > _h) {
          var _asp = _h / bounds.height;
          target.scaleX *= _asp;
          target.scaleY *= _asp;
        }
      }
    }

    if (target.movementLimitMode === "fit" || target.movementLimitMode === "content") {

      if (_l !== false) {
        var _diff = _l - bounds.left;
        if (_diff > 0) {
          newPos.left = x + _diff;
        }
      }

      if (!newPos.left && _r !== false) {
        var _diff = _r - bounds.right;
        if (_diff > 0) {
          newPos.left = x - _diff;
        }
      }

      if (_t !== false) {
        var _diff = _t - bounds.top;
        if (_diff > 0) {
          newPos.top = y + _diff;
        }
      }

      if (!newPos.top && _b !== false) {
        var _diff = _b - bounds.bottom;
        if (_diff > 0) {
          newPos.top = y - _diff;
        }
      }
    }

    return newPos;
  },

  // _restoreOriginXYNative: _restoreOriginXYNative,
  // _restoreOriginXY: function (target) {
  //   this._restoreOriginXYNative(target);
  //
  //   // if (target.wholeCoordinates) {
  //   //   target.left = Math.round(target.left);
  //   //   target.top = Math.round(target.top);
  //   // }
  // },

  /**
   * Sets the position of the object taking into consideration the object's origin
   * @param {fabric.Point} pos The new position of the object
   * @param {String} originX Horizontal origin: 'left', 'center' or 'right'
   * @param {String} originY Vertical origin: 'top', 'center' or 'bottom'
   * @return {void}
   */
  setPositionByOrigin: function setPositionByOrigin(pos, originX, originY) {
    var center = this.translateToCenterPoint(pos, originX, originY),
        position = this.translateToOriginPoint(center, this.originX, this.originY);

    // if (this.wholeCoordinates) {
    //   position.x = Math.round(position.x);
    //   position.y = Math.round(position.y);
    // }
    this.set('left', position.x);
    this.set('top', position.y);
  }
});

var _translateObject_overwritten = fabric.Canvas.prototype._translateObject;
var _beforeScaleTransform_overwritten = fabric.Canvas.prototype._beforeScaleTransform;
var _beforeTransform_overwritten = fabric.Canvas.prototype._beforeTransform;
var _restoreOriginXYNative = fabric.Canvas.prototype._restoreOriginXY;
fabric.util.object.extend(fabric.SlideCanvas.prototype, {
  _beforeScaleTransform_overwritten: _beforeScaleTransform_overwritten,
  _beforeScaleTransform: function _beforeScaleTransform(e, transform) {
    this._beforeScaleTransform_overwritten(e, transform);
    if (!this._currentTransform.original.oCoords) {
      this._currentTransform.original.oCoords = fabric.util.object.cloneDeep(this._currentTransform.target.oCoords);
    }
  },
  getFixedPositionEasy: function getFixedPositionEasy(target, x, y) {
    var _w = this.originalWidth || this.width;
    var _h = this.originalHeight || this.height;

    if (x === undefined) {
      x = target.left;
    }
    if (y === undefined) {
      y = target.top;
    }
    var scale = this.viewportTransform[0];
    target.setCoords();
    target.right = _w - (target.left + target.width);
    target.bottom = _h - (target.top + target.height);

    var _diff, _asp, rect;
    var newPos = {
      left: x,
      top: y,
      width: target.width,
      height: target.height
    };

    if (target.width > _w) {
      newPos.width = _w;
    }
    if (target.height > _h) {
      newPos.height = _h;
    }
    if (target.left < 0) {
      newPos.width += target.left;
      newPos.left -= target.left;
    }
    if (target.right < 0) {
      newPos.width += target.right;
    }
    if (target.top < 0) {
      newPos.height += target.top;
    }
    if (target.bottom < 0) {
      newPos.height += target.bottom;
    }
    return newPos;
  },
  /**
   * функцию можно вызвать с евентом  'after:render'. Позволяет отображать вычисления пересечений изменяемого объекта с рамкой. выделяет красными лиинияи
   * @private
   * @example
   *  eventListeners : {
    Canvas: {
      'before:render': function(){
        this.clearContext(this.contextTop);
      },
      'after:render': function(){
        this._debug_intersections()
      }
    }
  }
   */
  drawInterestionLines: function drawInterestionLines() {
    var tr = this._currentTransform;
    if (tr && tr._intersections) {
      var ctx = this.contextTop;
      ctx.beginPath();
      ctx.strokeStyle = "red";
      for (var i in tr._intersections) {
        var _coord = tr._intersections[i];
        ctx.moveTo(_coord.x + 5, _coord.y);
        ctx.arc(_coord.x, _coord.y, 5, 0, 2 * Math.PI);
      }
      for (var i in tr.lines) {
        var _l = tr.lines[i];
        ctx.moveTo(_l[0].x, _l[0].y);
        ctx.lineTo(_l[1].x, _l[1].y);
      }
      for (var i in tr.mlLines) {
        var _l = tr.mlLines[i];
        ctx.moveTo(_l[0].x, _l[0].y);
        ctx.lineTo(_l[1].x, _l[1].y);
      }
      ctx.stroke();
    }
  },
  _scaleObjectEasy: function _scaleObjectEasy(x, y, by) {
    //_scaleObject_overwritten.call(this, x, y, by);
    var tr = this._currentTransform,
        target = tr.target,
        corner = tr.corner;
    if (!target.movementLimits) {
      return _scaleObject_overwritten.call(this, x, y, by);
    }

    if (target.movementLimitMode !== 'fit') return;
    x = Math.min(target.movementLimits.width, Math.max(0, x));
    y = Math.min(target.movementLimits.height, Math.max(0, y));
    _scaleObject_overwritten.call(this, x, y, by);
  },
  /**
   * Scales object by invoking its scaleX/scaleY methods
   * @private
   * @param {Number} x pointer's x coordinate
   * @param {Number} y pointer's y coordinate
   * @param {String} by Either 'x' or 'y' - specifies dimension constraint by which to scale an object.
   *                    When not provided, an object is scaled by both dimensions equally
   */
  _scaleObject: function _scaleObject(x, y, by) {
    var _scaled = _scaleObject_overwritten.call(this, x, y, by);

    var tr = this._currentTransform,
        target = tr.target,
        corner = tr.corner;
    var _v = this.viewportTransform;

    if (!target.movementLimits || target.movementLimitMode !== "fit") {
      return _scaled;
    }
    target.setCoords();

    var _scale = this.getZoom();

    if (target.movementLimits == this) {
      var _w = this.originalWidth || this.width;
      var _h = this.originalHeight || this.height;
      var _l = this.viewportTransform[4];
      var _t = this.viewportTransform[5];
      _w *= _scale;
      _h *= _scale;
      var _rc = {
        tl: { x: _l, y: _t },
        tr: { x: _l + _w, y: _t },
        bl: { x: _l, y: _t + _h },
        br: { x: _l + _w, y: _t + _h }
      };
    } else {
      target.movementLimits.setCoords();
      var _rc = target.movementLimits.oCoords;
    }

    if (!tr.pointerOffset) {
      tr.pointerOffset = {
        x: x * _v[0] - target.oCoords[corner].x,
        y: y * _v[3] - target.oCoords[corner].y
      };

      tr.pointCenter = target.getCenterPoint();
      tr.pointCenter.x *= _scale;
      tr.pointCenter.y *= _scale;
      tr.pointOriginal = tr.original.oCoords[corner];
    }

    tr.pointTranformed = target.oCoords[corner];

    tr.mlLines = [];
    tr.lines = [];
    function _intersection(corner, coordinate) {
      var _oc;
      if (coordinate == "x" && corner[0] != "m") {
        _oc = tr.original.oCoords["m" + corner[0]];
      } else if (coordinate == "y" && corner[0] != "m") {
        _oc = tr.original.oCoords["m" + corner[1]];
      } else {
        _oc = tr.pointCenter;
        _oc = {
          x: _oc.x + _v[4],
          y: _oc.y + _v[5]
        };
      }
      var _tc = target.oCoords[corner];

      tr.lines.push([_oc, _tc]);
      tr.mlLines.push([_rc.tl, _rc.tr]);
      tr.mlLines.push([_rc.tr, _rc.br]);
      tr.mlLines.push([_rc.br, _rc.bl]);
      tr.mlLines.push([_rc.bl, _rc.tl]);

      var inters = fabric.Intersection.intersectLinePolygon(_oc, _tc, [_rc.tl, _rc.tr, _rc.br, _rc.bl]);
      if (!inters.points.length) {
        return;
      }
      inters.points[0].coordinate = coordinate;
      tr._intersections.push(inters.points[0]);

      //         if (coordinate) {
      //           var p1 = inters.points[0];

      //           var corner2;
      //           if (coordinate == "x") {
      //             corner2 = (corner[0] == "t" ? "b" : "t") + corner[1];
      //           } else {
      //             corner2 = corner[0] + (corner[1] == "l" ? "r" : "l");
      //           }
      //           var _p2 = target.oCoords[corner2];
      //           var _diff = {x: _tc.x - p1.x, y: _tc.y - p1.y};

      //           var p2 = {
      //             x: _p2.x - _diff.x,
      //             y: _p2.y - _diff.y
      //           };

      //           var its = fabric.Intersection.intersectLineLine(tr.pointCenter, tr.pointTranformed, p1, p2);
      //           if (!its.points[0]) {
      //             return;
      //           }
      //           tr._intersections.push(its.points[0]);
      //         } else {
      //           tr._intersections.push(inters.points[0]);
      //         }


      //
      //if(inters.points.length){
      //  _scaleObject_overwritten.call(this, inters.points[0].x,  inters.points[0].y, by);
      //  target.setCoords();
      //}else{
      //  _scaleObject_overwritten.call(this, x, y, by);
      //}
    }

    tr._intersection = null;
    tr._intersections = [];
    switch (corner) {
      case "tl":
        _intersection("tl");
        _intersection("bl", "x");
        _intersection("tr", "y");
        break;
      case "tr":
        _intersection("tr");
        _intersection("tl", "y");
        _intersection("br", "x");
        break;
      case "br":
        _intersection("br");
        _intersection("tr", "x");
        _intersection("bl", "y");
        break;
      case "bl":
        _intersection("bl");
        _intersection("tl", "x");
        _intersection("br", "y");
        break;
      case "mt":
        _intersection("mt");
        _intersection("tl", "y");
        _intersection("tr", "y");
        break;
      case "mb":
        _intersection("mb");
        _intersection("bl", "y");
        _intersection("br", "y");
        break;
      case "mr":
        _intersection("mr");
        _intersection("tr", "x");
        _intersection("br", "x");
        break;
      case "ml":
        _intersection("ml");
        _intersection("tl", "x");
        _intersection("bl", "x");
    }

    if (!tr._intersections.length) {
      return _scaled;
    }

    var _newXY = tr._intersections[0];
    var _l = tr._intersections[0].distanceFrom(tr.pointOriginal);

    for (var i = 1; i < tr._intersections.length; i++) {
      var _l2 = tr._intersections[i].distanceFrom(tr.pointOriginal);
      if (_l2 < _l) {
        _newXY = tr._intersections[i];
        _l = _l2;
      }
    }
    tr._intersection = _newXY;

    if (by == "equally") {
      //by = false;

      var _diff2 = { x: _newXY.x - tr.pointCenter.x, y: _newXY.y - tr.pointCenter.y };
      var _l = Math.sqrt(_diff2.x * _diff2.x + _diff2.y * _diff2.y);

      _newXY.x -= _diff2.x / _l * target.strokeWidth;
      _newXY.y -= _diff2.y / _l * target.strokeWidth;
      // scrt(x*x + y*y) = atrokewidth
      var a = 1;
    }
    //return _scaleObject_overwritten.call(this, x, y, by);
    var __x = (_newXY.x + tr.pointerOffset.x) / _v[0];
    var __y = (_newXY.y + tr.pointerOffset.y) / _v[3];
    return _scaleObject_overwritten.call(this, __x, __y, by);

    //
    //if (corner == "br" || corner == "tr" || corner == "mr") {
    //  if (x < target.movementXMaxLimit) {
    //    x = target.movementXMaxLimit;
    //  }
    //}
    //if (corner == "bl" || corner == "tl" || corner == "ml") {
    //  if (x > target.movementXMinLimit) {
    //    x = target.movementXMinLimit;
    //  }
    //}
    //if (corner == "bl" || corner == "br" || corner == "mb") {
    //  if (y < target.movementYMaxLimit) {
    //    y = target.movementYMaxLimit;
    //  }
    //}
    //if (corner == "tl" || corner == "tr" || corner == "mt") {
    //  if (y > target.movementYMinLimit) {
    //    y = target.movementYMinLimit;
    //  }
    //}
    //
    //_scaleObject_overwritten.call(this, x, y, by);
  },
  movementLimitsOnAddAction: 'translate',
  _check_object_after_modified: function _check_object_after_modified(target) {
    if (!this._currentTransform) {
      return;
    }
    var pos = this.getFixedPosition(target, target.left, target.top);

    switch (this._currentTransform.corner) {
      case "mtr":
        if (pos.left !== undefined) {
          target.set('left', pos.left);
        }
        if (pos.top) {
          target.set('top', pos.top);
        }
        break;
      case "mr":
      case "br":
        if (pos.left !== undefined) {
          var _ldiff = target.left - pos.left;
        }
        if (pos.top !== undefined) {
          var _tdiff = target.top - pos.top;
        }

        if (_ldiff && (!_tdiff || Math.abs(_ldiff) > Math.abs(_tdiff))) {
          if (_ldiff < 0) {
            target.width += _ldiff;
          } else {
            target.width -= _ldiff;
          }
        } else if (_tdiff) {
          if (_tdiff < 0) {
            target.width += _tdiff;
          } else {
            target.width -= _tdiff;
          }
        }
      //console.log(pos,_ldiff,_tdiff)
    }
    // this._check_object_position(target)
  },
  _check_object_position: function _check_object_position(target) {

    var pos = this.getFixedPosition(target, target.left, target.top);
    if (this.movementLimitsOnAddAction == 'translate') {
      if (pos.left !== undefined) {
        target.set('left', pos.left);
      }
      if (pos.top !== undefined) {
        target.set('top', pos.top);
      }
    } else {

      if (pos.left !== undefined) {
        if (target.left < pos.left) {
          target.width += target.left - pos.left;
          target.left = pos.left;
        } else {
          target.width -= target.left - pos.left;
        }
      }
      if (pos.top !== undefined) {
        if (target.top < pos.top) {
          target.height += target.top - pos.top;
          target.top = pos.top;
        } else {
          target.height -= target.top - pos.top;
        }
      }
    }

    if (pos.scaleX) {
      target.scaleX = target.scaleX *= pos.scaleX;
    }
    if (pos.scaleY) {
      target.scaleY = target.scaleY *= pos.scaleY;
    }

    target.setCoords();

    this.renderAll();
    // if(target.wholeCoordinates){
    //   target.top = Math.round(target.top);
    //   target.left = Math.round(target.left);
    //   target.height = Math.round(target.height);
    //   target.width = Math.round(target.width);
    // }
  },
  _translateObject: function _translateObject(x, y, limits) {
    var target = this._currentTransform.target;
    if (target.beforeTranslate) {
      var _point = target.beforeTranslate(x, y);
      if (!_point) return false;
      x = _point.x;
      y = _point.y;
    }
    var _translated = _translateObject_overwritten.call(this, x, y, limits);

    if (this.movementLimits) {

      var pos = this.getFixedPosition(target, x, y);

      if (pos.scaleX) {
        target.scaleX = this._currentTransform.scaleX *= pos.scaleX;
      }
      if (pos.scaleY) {
        target.scaleY = this._currentTransform.scaleY *= pos.scaleY;
      }

      if (pos.top !== undefined || pos.left !== undefined) {
        _translated = _translateObject_overwritten.call(this, pos.left !== undefined ? pos.left : x, pos.top !== undefined ? pos.top : y);
      }
    }
    return _translated || pos.scaleX || pos.scaleY;

    /* if (!target.get('lockMovementX')) {
     var _val = x - this._currentTransform.offsetX;
      //left offset
     var lim = this.movementLimits.minX.constructor == Number ? this.movementLimits.minX : -bounds.width + 1;
     if(target.movementXMinLimit && target.movementXMinLimit.constructor == Number && target.movementXMinLimit > lim ){
     lim = target.movementXMinLimit ;
     }
      _val = Math.min(lim, _val);
      //right offset
     var lim = this.movementLimits.maxX.constructor == Number ? this.movementLimits.maxX : this.width + bounds.width - 1;
     if(target.movementXMaxLimit && target.movementXMaxLimit.constructor == Number && target.movementXMaxLimit > lim ){
     lim = target.movementXMaxLimit ;
     }
     _val = Math.max(lim  - target.width * target.scaleX, _val);
     target.set('left', _val);
     }
     if (!target.get('lockMovementY')) {
     var _val = y - this._currentTransform.offsetY;
     if(target.movementYMinLimit !== undefined)
     _val = Math.min(target.movementYMinLimit, _val);
     if(target.movementYMaxLimit !== undefined)
     _val = Math.max(target.movementYMaxLimit  - target.height, _val);
      target.set('top', _val);
     }
     */
    //movementLimits ={
    //    xmin: 0,
    //    xmax: 0,
    //    ymin: 0,
    //    ymax: 0
    //};
  },

  _beforeTransform: function _beforeTransform(e, target) {
    target && target._beforeTransform ? target._beforeTransform(e) : _beforeTransform_overwritten.call(this, e, target);
  },
  _beforeTransformNative: _beforeTransform_overwritten
  /**
   * Translates object by "setting" its left/top
   * @private
   * @param {Number} x pointer's x coordinate
   * @param {Number} y pointer's y coordinate
   * @return {Boolean} true if the translation occurred
   */
  /* _translateObject: function (x, y) {
     var transform = this._currentTransform,
       target = transform.target,
       newLeft = x - transform.offsetX,
       newTop = y - transform.offsetY,
       moveX = !target.get('lockMovementX') && target.left !== newLeft,
       moveY = !target.get('lockMovementY') && target.top !== newTop;
  
     //round coordinates
     // if (target.wholeCoordinates) {
     //   newLeft = Math.round(newLeft);
     //   newTop = Math.round(newTop);
     // }
      moveX && target.set('left', newLeft);
     moveY && target.set('top', newTop);
     return moveX || moveY;
   }*/
});

//fabric.SlideCanvas.addPlugin("loaders",function(){
//    this.initMovementLimits();
//});

//todo
fabric.Rect.prototype.stateProperties = fabric.Rect.prototype.stateProperties.concat(["movementLimits", "clipTo"]);
fabric.Object.prototype.stateProperties = fabric.Object.prototype.stateProperties.concat(["movementLimits", "clipTo"]);
fabric.IText.prototype.stateProperties = fabric.IText.prototype.stateProperties.concat(["movementLimits", "clipTo"]);
fabric.Image.prototype.stateProperties = fabric.Image.prototype.stateProperties.concat(["movementLimits", "clipTo"]);
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 55 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

var _OBJ = fabric.Object.prototype;
var _handleGrouping_overwritten = fabric.Canvas.prototype._handleGrouping;
fabric.Object.prototype.groupable = true;

fabric.util.object.extend(fabric.Canvas.prototype, {
  /**
   * Deactivates all objects and dispatches appropriate events
   * @return {fabric.Canvas} thisArg
   * @chainable
   */
  deactivateAllWithDispatch: function deactivateAllWithDispatch(e) {
    var activeGroup = this.getActiveGroup(),
        activeObject = this.getActiveObject();
    var _target = activeObject || activeGroup;
    if (_target) {
      this.fire('before:selection:cleared', { target: _target, e: e });
    }
    this.deactivateAll();
    if (_target) {
      this.fire('selection:cleared', { e: e, target: _target });
      _target.fire('deselected');
    }
    return this;
  },

  /**
   * Divides objects in two groups, one to render immediately
   * and one to render as activeGroup.
   * return objects to render immediately and pushes the other in the activeGroup.
   */
  _chooseObjectsToRender: function _chooseObjectsToRender() {
    var activeGroup = this.getActiveGroup(),
        activeObject = this.getActiveObject(),
        object,
        objsToRender = [],
        activeGroupObjects = [];

    if (activeGroup && !this.preserveObjectStacking) {
      for (var i = 0, length = this._objects.length; i < length; i++) {
        object = this._objects[i];
        if (!activeGroup.contains(object)) {
          if (!object.hiddenActive) {
            objsToRender.push(object);
          }
        } else {
          activeGroupObjects.push(object);
        }
      }
      if (activeGroup) {
        // activeGroup._set('_objects', activeGroupObjects);
        objsToRender.push(activeGroup);
      }
      activeObject && objsToRender.push(activeObject);
      // activeGroup._set('_objects', activeGroupObjects);
    } else {
      objsToRender = this._objects;
    }
    return objsToRender;
  },
  /**
   * adding before:selection:created event
   * @private
   * @param {Event} e Event object
   * @param {fabric.Object} target
   */
  _handleGrouping: function _handleGrouping(e, target) {
    this.fire("before:selection:created");
    _handleGrouping_overwritten.call(this, e, target);
  },
  /**
   * @private
   * @param {Event} e mouse event
   */
  _groupSelectedObjects: function _groupSelectedObjects(e) {

    var group = this._collectObjects();

    group = fabric.util.object.filter(group, { groupable: true });

    // do not create group for 1 element only
    if (group.length === 1) {
      this.setActiveObject(group[0], e);
    } else if (group.length > 1) {
      group = new fabric.Group(group.reverse(), {
        canvas: this
      });
      group.addWithUpdate();
      this.setActiveGroup(group, e);
      group.saveCoords();
      this.fire('selection:created', { target: group });
      this.renderAll();
    }
  }
});

_OBJ.cloneSync = function () {
  var _klass = fabric[fabric.util.string.camelize(fabric.util.string.capitalize(this.type))];
  if (_klass.async) {
    var _obj = new _klass.fromObject(this, function () {});
  } else {
    var _obj = this.clone();
  }
  _obj.canvas = this.canvas;
  return _obj;
};

fabric.util.object.extend(fabric.Group.prototype, {
  isPossibleTarget: function isPossibleTarget(e, object) {
    return this.searchPossibleTargets(e, [object]).target !== null;
  },
  /**
   * return inner target and group of targets under the cursor
   * @param e
   * @param objects
   * @returns {{target: null, group: Array}}
   */
  searchPossibleTargets: function searchPossibleTargets(e, objects) {

    if (!objects) objects = this._objects;
    var pointer = this.canvas.getPointer(e, true);
    var i = objects.length,
        normalizedPointer = this.canvas._normalizePointer(this, pointer);

    var targets = {
      target: null,
      group: []
    };
    while (i--) {
      if (this.canvas._checkTarget(normalizedPointer, objects[i])) {
        if (!targets.target) targets.target = objects[i];
        targets.group.push(objects[i]);
      }
    }
    return targets;
  },

  groupSelectable: true,
  cloneSync: function cloneSync() {
    var _clonedObjects = this._objects.map(function (object) {
      return object.cloneSync();
    });

    var object = this.toObject();
    delete object.objects;

    return new fabric.Group(_clonedObjects, object, true);

    // fabric.util.enlivenObjects(object.objects, function (enlivenedObjects) {
    //   delete object.objects;
    //   callback && callback(new fabric.Group(enlivenedObjects, object, true));
    // });
  },
  _calcBounds: function _calcBounds(onlyWidthHeight) {
    var aX = [],
        aY = [],
        o,
        prop,
        props = ['tr', 'br', 'bl', 'tl'];

    for (var i = 0, len = this._objects.length; i < len; ++i) {
      o = this._objects[i];
      if (o.notSelectableInTheGroup) {
        continue;
      }
      o.setCoords();
      for (var j = 0; j < props.length; j++) {
        prop = props[j];
        aX.push(o.oCoords[prop].x);
        aY.push(o.oCoords[prop].y);
      }
    }

    this.set(this._getBounds(aX, aY, onlyWidthHeight));
  },
  initialize_overwritten: fabric.Group.prototype.initialize,
  isSelectionGroup: function isSelectionGroup() {
    return this.canvas._objects.indexOf(this) === -1;
  },
  //clone: function(callback){
  //  if(callback === true || callback.constructor === Object){
  //    var _frame = new fabric.Group(this);
  //    if(callback.constructor === Object){
  //      _frame.set(callback);
  //      return _frame;
  //    }
  //  }
  //  return this.callSuper('clone',callback);
  //},
  initialize: function initialize(objects, options) {
    if (objects.constructor != Array) {
      var el = objects;
      options = el.toObject();
      objects = [];
      for (var i in el._objects) {
        objects.push(el._objects[i].cloneSync());
      }
    }

    this.initialize_overwritten(objects, options);
    if (this.type == 'group') {
      this.on("dblclick", function () {
        if (this.canvas._objects.indexOf(this) === -1) {
          this.groupSelectedElements();
        } else {
          this.ungroup();
        }
      });
    }
  },
  ungroup: function ungroup() {
    this.canvas.discardActiveGroup();
    this._restoreObjectsState();
    this.canvas.remove(this);
    for (var i in this._objects) {
      this.canvas.add(this._objects[i]);
      this._objects[i].clipTo = this.clipTo;
      //this._objects[i].active = true;
    }
    var group = new fabric.Group(this._objects, {
      canvas: this.canvas
    });
    group.addWithUpdate();
    this.canvas.setActiveGroup(group);
    group.saveCoords();
    this.canvas.fire('selection:created', { target: group });
    this.canvas.renderAll();

    //var _group = new fabric.Group(this._objects);
    //_group.canvas = this.canvas;
    //this.canvas.setActiveObject(_group);
  },

  groupSelectedElements: function groupSelectedElements() {

    var el = this.cloneSync();
    this.canvas.add(el);
    this.canvas.discardActiveGroup();
    this.canvas.setActiveObject(el);

    for (var i in this._objects) {
      this.canvas.remove(this._objects[i].originalObject);
    }
  },
  actions: {

    remove: {
      className: 'fa fa-trash',
      title: 'Delete',
      key: "Delete",
      action: function action() {
        if (this.isSelectionGroup()) {
          for (var i in this._objects) {
            var _obj = this._objects[i];
            this.canvas.remove(_obj.originalObject);
          }
          this.canvas.discardActiveGroup();
          this.canvas.discardActiveObject();
        } else {
          this.canvas.remove(this);
        }
        this.canvas.renderAll();
      }
    },
    duplicate: {
      className: 'fa fa-clone',
      title: 'Duplicate',
      action: function action() {
        if (this.isSelectionGroup()) {
          this.canvas.fire('before:selection:cleared', { target: this, e: null });
          this.canvas.discardActiveGroup();
          this.duplicate(function (el) {
            el.ungroup();
          });

          this.canvas.renderAll();
        } else {
          this.duplicate();
        }
      }
    },
    groupSelectedElements: {
      title: 'группа',
      className: 'fa fa-object-group',
      visible: function visible() {
        return this.isSelectionGroup();
      },
      action: function action() {
        this.groupSelectedElements();
        this.canvas.renderAll();
      }
      //visible: IDE.groupAvailable
    },
    ungroup: {
      title: 'группа',
      className: 'fa fa-object-ungroup',
      visible: function visible() {
        return this.canvas._objects.indexOf(this) !== -1;
      },
      action: function action() {
        this.ungroup();
        this.canvas.renderAll();
      }
    }
  }
});

fabric.util.object.extend(fabric.SlideCanvas.prototype, {
  eventListeners: fabric.util.object.extendArraysObject(fabric.SlideCanvas.prototype.eventListeners, {
    'selection:created': function selectionCreated(event) {
      this._onSelectionCreated(event);
    }
  }),
  _onSelectionModified: function _onSelectionModified() {
    for (var i in this._objects) {
      var copy = this._objects[i].cloneSync();
      copy.group = this;
      this._restoreObjectState(copy);
      this._objects[i].originalObject.set({
        clipTo: this.clipTo,
        movementLimits: this.movementLimits,
        left: copy.left,
        top: copy.top,
        angle: copy.angle,
        scaleX: copy.scaleX,
        scaleY: copy.scaleY,
        skewX: copy.skewX,
        skewY: copy.skewY,
        width: copy.width,
        height: copy.height
      });
    }
  },
  _onSelectionDeselected: function _onSelectionDeselected(data) {
    for (var i in this._objects) {
      var _obj = this._objects[i];
      _obj.originalObject.setCoords();
      _obj.originalObject.evented = true;
      delete _obj.originalObject.hiddenActive;
    }
  },
  _onSelectionCreated: function _onSelectionCreated(el) {

    var group = el.target;

    var originalObjects = [];
    for (var i in group._objects) {
      var _obj = group._objects[i];
      originalObjects.push(_obj.originalObject || _obj);
    }

    group.destroy();
    group._objects = [];

    var _clipTo = originalObjects[0].clipTo;

    for (var i in originalObjects) {
      var original = originalObjects[i];

      if (_clipTo != original.clipTo) {
        _clipTo = false;
      }

      var _obj = original.cloneSync();

      _obj.set({
        clipTo: null,
        originalObject: original
      });
      original.set({
        active: false,
        evented: false,
        hiddenActive: true
      });

      group.addWithUpdate(_obj);
      group.setCoords();
    }

    group.clipTo = _clipTo;

    group.on({
      "modified": this._onSelectionModified,
      'deselected': this._onSelectionDeselected
    });
  }
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 56 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

var History = __webpack_require__(57);

History.prototype.insertRecords = false;
History.prototype.actions = {
  undo: {
    keyCode: 'z',
    ctrlKey: true,
    observe: 'changed',
    className: 'fa fa-undo',
    title: 'undo',
    enabled: 'canUndo',
    action: function action() {
      this.undo();
    }
  },
  records: {
    title: "records",
    itemClassName: "filters-selector",
    className: "fa fa-history",
    type: "select",
    templateSelection: function templateSelection(state, container) {
      if (state.any) {
        return state.text;
      }
      return $('<span>' + state.id + ":" + state.type + '</span>');
    },
    templateResult: function templateResult(state, container, data) {
      if (!state.type) return;
      var _keys = state.originalState && Object.keys(state.originalState).join(',') || '';
      var type = state.object && state.object.type || '';
      return $("<span>{id}:{type}({otype} {keys})</span>".format(fabric.util.object.extend({ keys: _keys, otype: type }, state)));
      // if(state.id != "none"){
      //   var $canvas = $('<canvas>');
      //   $el.prepend($canvas);
      // }
      // return $el;
    },
    value: {
      observe: 'changed',
      set: function set(val, filtersData) {
        this.goto(val);
      },
      get: function get() {
        return this.records[this.current].id;
      },
      options: function options() {
        return this.records;
      }
    }
  },
  redo: {
    keyCode: 'y',
    ctrlKey: true,
    observe: 'changed',
    className: 'fa fa-repeat',
    title: 'redo',
    enabled: 'canRedo',
    action: function action() {
      this.redo();
    }
  }
};

fabric.util.object.extend(fabric.SlideCanvas.prototype.actions, {
  history: {
    title: 'history',
    type: 'menu',
    target: function target() {
      return this.history;
    },
    menu: function menu() {
      return this.actions;
    }
  }
});

fabric.util.object.extend(fabric.Canvas.prototype, {
  insertHistory: false,
  onObjectModified: function onObjectModified(e) {
    if (!this.history.enabled || this.processing || this.history.processing) {
      return false;
    }
    var _canvas = e.target.canvas || e.target.wrapperEl && e.target;

    this.history.add({
      canvas: e.target.canvas.originalSlide || e.target.canvas,
      originalState: e.states.original,
      modifiedState: e.states.modified,
      object: e.target,
      type: 'object:modified',
      undo: function undo(_action) {
        _action.object.set(_action.originalState);
        if (_action.canvas.mirrorSlide == this.canvas) {
          _action.object.setCoords();
          var _canvas = this.canvas || this;
          _canvas.renderAll();
        }
        _action.canvas.fire('object:modified', { target: _action.object });
        _action.object.fire('modified');
        _action.canvas.renderAll();
      },
      redo: function redo(_action) {
        _action.object.set(_action.modifiedState);
        _action.object.setCoords();
        if (_action.canvas.mirrorSlide == this.canvas) {
          _action.object.setCoords();
          var _canvas = this.canvas || this;
          _canvas.renderAll();
        }
        _action.canvas.fire('object:modified', { target: _action.object });
        _action.object.fire('modified');
        _action.canvas.renderAll();
      }
    });
  },
  clearHistory: function clearHistory() {
    this.history.clear();
  },
  disableHistory: function disableHistory() {
    this.history.enabled = false;
  },
  _add_object_history_action: function _add_object_history_action(_action) {
    var _canvas = this.canvas || this;
    if (this.canvas && _action.canvas.mirrorSlide == this.canvas) {
      _canvas.add(_action.object);
      _canvas.setActiveObject(_action.object);
      _canvas.renderAll();
    } else {
      _action.canvas.add(_action.object);
    }
    _action.canvas.renderAll();
  },

  _remove_object_history_action: function _remove_object_history_action(_action) {
    _action.canvas.remove(_action.object);
    _action.canvas.renderAll();
    if (this.canvas && _action.canvas.mirrorSlide == this.canvas) {
      this.canvas.renderAll();
    }
  },

  onObjectRemoved: function onObjectRemoved(e) {
    if (!this.history.enabled || this.processing || this.history.processing) {
      return false;
    }
    this.history.add({
      canvas: e.target.canvas.originalSlide || e.target.canvas,
      object: e.target,
      type: 'object:removed',
      redo: this._remove_object_history_action,
      undo: this._add_object_history_action
    });
  },
  onDrawAfter: function onDrawAfter(event) {
    if (!this.history.enabled || this.processing || this.history.processing) {
      return false;
    }
    this.history.add(this.freeDrawingBrush.getHistoryRecord(event));
  },
  onObjectAdded: function onObjectAdded(e) {
    if (!this.history.enabled || this.processing || this.history.processing) {
      return false;
    }
    this.history.add({
      canvas: e.target.canvas.originalSlide || e.target.canvas,
      object: e.target,
      type: 'object:added',
      undo: this._remove_object_history_action,
      redo: this._add_object_history_action
    });
  },
  initHistory: function initHistory(history) {
    if (!history) {
      history = new History(this);
      history.application = this.application;
    }

    this.history = history;
    this.on({
      'loading:begin': this.clearHistory,
      'draw:after': this.onDrawAfter,
      'object:modified': this.onObjectModified,
      'object:added': this.onObjectAdded,
      'object:removed': this.onObjectRemoved
    });

    var _this = this;
    this.history.on('changed', function (e) {
      if (this.activeAction.canvas) {
        this.activeAction.canvas.moment = e.action.moment;
      }
    });
    var proto = this.application.prototypes.History;
    if (proto) {
      if (proto.eventListeners) {
        history.on(proto.eventListeners);
      }
    }
  },
  enableHistory: function enableHistory() {
    this.history.enabled = true;
  }
});

fabric.HISTORY_OPTIONS = {
  INDIVIDUAL: 0,
  SHARED: 1
};

fabric.util.object.extend(fabric.Application.prototype, {
  history: true,
  setHistory: function setHistory(historyOption) {

    if (historyOption === fabric.HISTORY_OPTIONS.SHARED) {
      this.history = new History(this);
      this.enableHistory();

      this.on("ready", function () {
        if (this.canvas) {
          this.canvas.initHistory(this.history);
        }
      });
    }
    if (historyOption === fabric.HISTORY_OPTIONS.INDIVIDUAL) {
      //todo unsupported
    }
  },
  actions: fabric.util.object.extend(fabric.Application.prototype.actions, {
    history: {
      insert: 'historyTools',
      title: 'history',
      type: 'menu',
      target: function target() {
        return this.history;
      },
      menu: function menu() {
        return this.actions;
      }
    }
  }),
  _default_event_listeners: {
    "slide:change:begin": function slideChangeBegin() {
      this.processing = true;
      if (this.history) {
        this.history.processing = true;
      }
    },
    "slide:changed": function slideChanged() {
      this.processing = false;
      if (this.history) {
        this.history.processing = false;
      }
    }
  },
  historyTools: false,
  enableHistory: function enableHistory() {
    this.history.enabled = true;
  }
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 57 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var utils = __webpack_require__(3);
utils.object = __webpack_require__(2);

/***********************************************************************************************************************
 ** DPHistory
 ***********************************************************************************************************************/

var DPHistory = function DPHistory(parent, initAction) {
  this.parent = parent;
  this.clear(initAction);
};

DPHistory.prototype.setRecords = function (records, current) {
  this.canUndo = records.length;
  this.canRedo = false;

  if (!records.length) {
    records = [{
      type: 'initialized',
      id: 0,
      text: 'initialized'
    }];
  }
  this.records = records;
  this.length = this.records.length;
  this.current = current === undefined ? records.length - 1 : current;
  this.activeAction = this.records[this.current];
  this.fire("changed", { action: this.activeAction });
  return this;
};

DPHistory.prototype.restore = function () {
  this.setRecords(this.saved.records, this.saved.current);
  return this;
};

DPHistory.prototype.save = function () {
  this.saved = {
    current: this.current,
    records: utils.object.cloneDeep(this.records)
  };
  return this;
};

DPHistory.prototype.clear = function (initAction) {
  if (initAction) {
    initAction.id = 0;
  } else {
    initAction = {
      type: 'initialized',
      id: 0,
      text: 'initialized'
    };
  }
  this.records = [initAction];
  this.current = 0;
  this.canUndo = false;
  this.canRedo = false;
  this.activeAction = this.records[this.current];
  this.fire("changed", { action: this.activeAction });
  return this;
};

DPHistory.prototype.add = function (action) {

  if (!this.enabled || this.processing) {
    return false;
  }

  action.moment = new Date().getTime();
  this.canUndo = true;
  this.canRedo = false;
  this.records.splice(this.current + 1);
  this.records.push(action);
  this.length = this.records.length;
  action.id = this.length - 1;
  action.text = action.type || action.text;
  this.current = this.length - 1;

  this.activeAction = this.records[this.current];
  this.fire("changed", { action: action });
  return this;
};
DPHistory.prototype.disable = function () {
  this.enabled = false;
  return this;
};
DPHistory.prototype.enable = function () {
  this.enabled = true;
  return this;
};
DPHistory.prototype.undo = function (noFire) {
  this.canRedo = true;
  var _action = this.records[this.current];
  this.current--;
  this.processing = true;
  _action.undo.call(this.parent, _action);
  this.processing = false;
  if (this.current == 0) {
    this.canUndo = false;
  }
  if (!noFire) {
    this.activeAction = this.records[this.current];
    this.fire("changed", { action: _action });
  }
  return this;
};

DPHistory.prototype.goto = function (index) {
  if (index == this.current) return;
  if (index < this.current) {
    for (var i = this.current - index; i--;) {
      this.undo(true);
    }
  }if (index > this.current) {
    for (var i = index - this.current; i--;) {
      this.redo(true);
    }
  }
  this.activeAction = this.records[this.current];
  this.fire("changed", { action: this.activeAction });
  return this;
};

DPHistory.prototype.redo = function (noFire) {
  if (this.current == this.length - 1) {
    return;
  }
  this.processing = true;
  this.canUndo = true;
  this.current++;
  var _action = this.records[this.current];

  _action.redo.call(this.parent, _action);

  if (this.current == this.length - 1) {
    this.canRedo = false;
  }
  this.processing = false;
  if (!noFire) {
    this.activeAction = this.records[this.current];
    this.fire("changed", { action: _action });
  }
  return this;
};
utils.observable(DPHistory.prototype);
module.exports = DPHistory;

/***/ }),
/* 58 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

/////////////////module responsive borders//////////////////////////////////////////////////////////////////////////////////////////

fabric.util.object.extend(fabric.Object.prototype, {
  responsiveBorders: false
});

if (!fabric.SlideCanvas.prototype._default_event_listeners) {
  fabric.SlideCanvas.prototype._default_event_listeners = {};
};

fabric.Object.prototype.updateResponsiveBorder = function () {
  if (this.responsiveBorders) {
    if (!this.originalStrokeWidth) {
      this.originalStrokeWidth = this.strokeWidth;
    }
    this.strokeWidth = this.canvas ? this.originalStrokeWidth / this.canvas.viewportTransform[0] : 0;
  }
};

fabric.util.object.extend(fabric.SlideCanvas.prototype, {
  _default_event_listeners: {
    "dimensions:modified": function dimensionsModified() {
      this.centerAndZoomOut();
    },
    'viewport:scaled': function viewportScaled() {
      if (this.backgroundImage) {
        this.backgroundImage.updateResponsiveBorder();
      }
      for (var i in this._objects) {
        this._objects[i].updateResponsiveBorder();
      }
    },
    "background-image:loaded": function backgroundImageLoaded(event) {
      if (this.autoCenterAndZoomOutEnabled) {
        this.centerAndZoomOut();
      }
    },
    "loading:end": function loadingEnd(event) {
      if (this.autoCenterAndZoomOutEnabled && (this.originalHeight || this.originalWidth)) {
        this.centerAndZoomOut();
      }
    },
    "object:added": function objectAdded(event) {
      event.target.updateResponsiveBorder();
    }
  }
});

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


fabric.util.object.extend(fabric.SlideCanvas.prototype, {
  zoomCtrlKey: true,
  mouseWheelEnabled: false,
  _setZoomNative: fabric.Canvas.prototype.setZoom,
  _zoomToPointNative: fabric.Canvas.prototype.zoomToPoint,
  changeDimensionOnZoom: false,
  drawZoomArea: function drawZoomArea(_ctx, left, top, width, height) {
    _ctx.save();
    _ctx.translate(left || 0, top || 0);
    var _scale = this.getZoom();
    var _size = fabric.util.getProportions(this.backgroundImage, { width: width || 100, height: height || 100 });
    _ctx.globalAlpha = 0.5;
    _ctx.fillRect(0, 0, _size.width, _size.height);
    _ctx.strokeStyle = "red";

    var v = this.viewportTransform;

    var x1 = -v[4] * _size.scale / _scale;
    var y1 = -v[5] * _size.scale / _scale;
    var x2 = x1 + this.width * _size.scale / _scale;
    var y2 = y1 + this.height * _size.scale / _scale;

    x1 = Math.max(x1, 0);
    y1 = Math.max(y1, 0);
    x2 = Math.min(x2, _size.width);
    y2 = Math.min(y2, _size.height);

    _ctx.globalAlpha = 1;
    _ctx.beginPath();
    _ctx.moveTo(x1, y1);
    _ctx.lineTo(x2, y1);
    _ctx.lineTo(x2, y2);
    _ctx.lineTo(x1, y2);
    _ctx.lineTo(x1, y1);

    _ctx.fill();
    _ctx.clip();
    // _ctx.globalCompositeOperation = "source-in";
    _ctx.drawImage(this.backgroundImage._element, 0, 0, _size.width, _size.height);
    // _ctx.globalCompositeOperation = "source-over";
    // _ctx.drawImage(this.backgroundImage._element,0,0,_size.width, _size.height)
    _ctx.stroke();
    _ctx.strokeRect(0, 0, _size.width, _size.height);
    _ctx.restore();
  },
  setZoom: function setZoom(_scale) {
    if (this.changeDimensionOnZoom) {
      var _w = Math.round(this.originalWidth * _scale);
      var _h = Math.round(this.originalHeight * _scale);
      this.setDimensions({
        width: _w,
        height: _h
      });
    }
    this._zoomToPointNative(new fabric.Point(0, 0), _scale);
    //  this._setZoomNative(_scale);
    this.fire('viewport:scaled', { scale: _scale });
  },
  zoomToPoint: function zoomToPoint(point, newZoom) {
    var _max = this.getMaxZoom();
    var _min = this.getMinZoom().scale;
    if (newZoom > _max) {
      newZoom = _max;
    }
    if (newZoom < _min) {
      newZoom = _min;
    }
    this._zoomToPointNative(point, newZoom);
    for (var i in this._objects) {
      this._objects[i].setCoords();
    }
    this.fire('viewport:scaled', { scale: newZoom });
  },
  resetViewport: function resetViewport() {
    _canvas.viewportTransform[0] = 1;
    _canvas.viewportTransform[3] = 1;
    _canvas.viewportTransform[4] = 0;
    _canvas.viewportTransform[5] = 0;
    _canvas.renderAll();
    for (var i in this._objects) {
      this._objects[i].setCoords();
    }
  },
  zoomToPointEnabled: true,
  minZoomFactor: 1,
  maxZoom: 20,
  autoCenterAndZoomOutEnabled: false,
  getMaxZoom: function getMaxZoom() {
    return this.maxZoom;
  },
  getMinZoom: function getMinZoom() {
    var _containerSize = {
      width: $(this.wrapperEl).width(),
      height: $(this.wrapperEl).height()
    };
    var _bgSize = {
      width: this.originalWidth,
      height: this.originalHeight
    };
    var _maxSize = {
      width: _containerSize.width * this.minZoomFactor,
      height: _containerSize.height * this.minZoomFactor
    };

    return fabric.util.getProportions(_bgSize, _maxSize, 'fit');
  },
  centerAndZoomOut: function centerAndZoomOut() {

    if (this.virtual) {
      return;
    }
    var options = this.getMinZoom();

    var _containerSize = {
      width: $(this.wrapperEl).width(),
      height: $(this.wrapperEl).height()
    };

    var vpt = this.viewportTransform.slice(0);
    vpt[0] = options.scale;
    vpt[3] = options.scale;
    vpt[4] = (_containerSize.width - options.width) / 2;
    vpt[5] = (_containerSize.height - options.height) / 2;

    this.setViewportTransform(vpt);

    this._update_background_image();
    // this.fire("viewport:scaled",{scale: options.scale})
    //this.renderAll();
  },
  centerOnObject: function centerOnObject(tag) {
    var br = tag.getBoundingRect();
    var ct = this.viewportTransform;
    br.width /= ct[0];
    br.height /= ct[3];
    var size = {
      width: br.width * 1.1,
      height: br.height * 1.1
    };

    var prop = fabric.util.getProportions(size, this);
    var _w = (this.width / prop.scale - size.width) / 2;
    var _h = (this.height / prop.scale - size.height) / 2;
    var _l = (br.left - ct[4]) / ct[0];
    var _t = (br.top - ct[5]) / ct[3];

    var x1 = [prop.scale, 0, 0, prop.scale, -tag.left * prop.scale + (tag.width * 0.05 + _w) * prop.scale, -tag.top * prop.scale + (tag.height * 0.05 + _h) * prop.scale];
    var x2 = [prop.scale, 0, 0, prop.scale, -_l * prop.scale + (br.width * 0.05 + _w) * prop.scale, -_t * prop.scale + (br.height * 0.05 + _h) * prop.scale];

    this.setViewportTransform(x2);
    this.fire("viewport:scaled", { scale: prop.scale });
    this.renderAll();
  },

  __onMouseWheel: function __onMouseWheel(event) {

    if (!this.mouseWheelEnabled || this.zoomCtrlKey && !event.ctrlKey) {
      return;
    }
    //Find nearest point, that is inside image END
    var zoomStep; // = 0.1 * event.deltaY;
    if (event.deltaY < 0) {
      zoomStep = 1.1;
    } else {
      zoomStep = 0.9;
    }

    var newZoom = this.getZoom() * zoomStep;
    var minZoom = this.getMinZoom().scale;

    if (this.zoomToPointEnabled) {
      var point = new fabric.Point(event.offsetX, event.offsetY);
      var _x = this.viewportTransform[4];
      var _y = this.viewportTransform[5];

      // Find nearest point, that is inside image BEGIN
      // It is needed to prevent canvas to zoom outside image
      var _w = this.originalWidth * this.getZoom() + _x;
      var _h = this.originalHeight * this.getZoom() + _y;

      if (point.x < _x) {
        point.x = _x;
      }
      if (point.y < _y) {
        point.y = _y;
      }
      if (point.x > _w) {
        point.x = _w;
      }
      if (point.y > _h) {
        point.y = _h;
      }
      if (minZoom > newZoom) {
        if (this.autoCenterAndZoomOutEnabled) {
          this.centerAndZoomOut();
        }
      } else {
        this.zoomToPoint(point, newZoom);
      }
    } else {
      this.setZoom(newZoom);
    }

    for (var i in this._objects) {
      this._objects[i].setCoords();
    }
    this.renderAll();
    event.stopPropagation();
    event.preventDefault();
    return false; //preventing scroll page
  },
  scaleFactor: 1.1,
  getOrignalCenter: function getOrignalCenter() {
    var point = this.getCenter();
    point.left += this.viewportTransform[4];
    point.top += this.viewportTransform[5];
    return point;
  }
});

fabric.util.object.extend(fabric.SlideCanvas.prototype.actions, {
  zoomOut: {
    className: 'fa fa-search-minus',
    title: 'zoom-out',
    action: function action(m) {
      var point = this.getOrignalCenter();
      var scaleValue = this.getZoom() / this.scaleFactor;
      this.zoomToPoint({ x: point.left, y: point.top }, scaleValue);
    }
  },
  zoomNumber: {
    type: 'number',
    value: {
      min: function min() {
        return 0.01;
      },
      max: function max() {
        return 10;
      },
      set: function set(val) {
        this.setZoom(val);
      },
      get: function get() {
        return this.getZoom();
      },
      observe: "viewport:scaled"
    }
  },
  zoomIn: {
    className: 'fa fa-search-plus',
    title: 'zoom-in',
    action: function action(m) {
      var point = this.getOrignalCenter();
      var scaleValue = this.getZoom() * this.scaleFactor;
      this.zoomToPoint({ x: point.left, y: point.top }, scaleValue);
    }
    // zoom: {
    //   title: "zoom",
    //   menu: zoomOut
    // }
  } });
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 59 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {/**
* InteractiveMode mixin. Allow to switch between pan/edit/drawing canvas modes.
*/



var _mouse_down_overwritten = fabric.Canvas.prototype._onMouseDown;
var _mouse_up_overwritten = fabric.Canvas.prototype._onMouseUp;
var _mouse_move_overwritten = fabric.Canvas.prototype._onMouseMove;

fabric.util.object.extend(fabric.SlideCanvas.prototype, {
  _initEventListeners_overwritten: fabric.Canvas.prototype._initEventListeners,
  _initEventListeners: function _initEventListeners() {
    this._initEventListeners_overwritten();
    this.___onKeyDown = this._onKeyDown.bind(this);
    fabric.util.addListener(fabric.window, 'keydown', this.___onKeyDown);
  },
  _removeListeners_overwritten: fabric.Canvas.prototype.removeListeners,
  removeListeners: function removeListeners() {
    this._removeListeners_overwritten();
    fabric.util.removeListener(fabric.window, 'keydown', this.___onKeyDown);
  },
  _onKeyDown: function _onKeyDown(e) {
    return this._applyMixedMode(e);
  },
  getInteractiveMode: function getInteractiveMode() {
    return this.interactiveMode;
  },
  setInteractiveMode: function setInteractiveMode(tool) {
    //todo checkthis out
    // if (tool === 'hand') {
    //   this.setCursor('pointer');
    // }
    this.isDrawingMode = tool === 'draw';
    this.isHandMode = tool === 'hand';
    this.interactive = tool !== 'disabled';
    this.isMixedMode = tool === 'mixed';

    if (!this.interactive) {
      this.upperCanvasEl.style.cursor = 'default';
    }
    this.interactiveMode = tool;
  },

  /**
   *  current mode
   *  @values default | hand | selection
   *  @comment
   *      hand      - moving canvas
   *      draw - drawing reactangles
   *      selection - default behavior
   */
  interactiveMode: 'default',

  isHandMode: false,
  _handModeCursorMove: false,
  _handModeCursorDown: false,
  _handModeCursorPosition: { x: 0, y: 0 },
  _handModeMouseMove: function _handModeMouseMove(e) {
    if (this._handModeCursorDown === true) {

      if (e.pageY === this._handModeCursorPosition.y && e.pageX === this._handModeCursorPosition.x) {
        return;
      }

      this._handModeCursorMove = true;

      var scroll = { x: this.viewportTransform[4], y: this.viewportTransform[5] };

      var newScroll = {
        x: scroll.x - (this._handModeCursorPosition.x - e.pageX),
        y: scroll.y - (this._handModeCursorPosition.y - e.pageY)
      };

      var dims = {
        width: this.size.width * this.zoom - this.lowerCanvasEl.width,
        height: this.size.height * this.zoom - this.lowerCanvasEl.height
      };
      /*  todo need to add some restrictions later
       //Math.max(Math.min(0,newScroll.x),-dims.width);
       //Math.max(Math.min(0,newScroll.y),-dims.height);
       */
      this.viewportTransform[4] = newScroll.x;
      this.viewportTransform[5] = newScroll.y;

      this.fire('viewport:translate');

      this.renderAll();
      for (var i = 0, len = this._objects.length; i < len; i++) {
        this._objects[i].setCoords();
      }

      this._handModeCursorPosition.y = e.pageY;
      this._handModeCursorPosition.x = e.pageX;
    }
  },
  _handModeMouseUp: function _handModeMouseUp() {
    this._handModeCursorDown = false;
    if (!this._handModeCursorMove) {}
  },
  _handModeMouseDown: function _handModeMouseDown(e) {

    this._handModeCursorMove = false;
    this._handModeCursorDown = true;
    this._handModeCursorPosition = {
      y: e.pageY,
      x: e.pageX
    };
  },
  handModeEnabled: false,
  handModeKey: "Alt",
  _applyMixedMode: function _applyMixedMode(e) {
    this._current_target = this.findTarget(e);

    if (this.handModeEnabled && e.altKey || e.key === this.handModeKey) {
      //if shift use hand mode
      if (!this.isHandMode) {
        this.isHandMode = true;
        this.isDrawingMode = false;
        this.setCursor('pointer');
      }
    } else if (this.isMixedMode && !this._isCurrentlyDrawing && !this._currentTransform) {

      this.isHandMode = false;

      if (this._current_target) {
        if (this.freeDrawingBrush && this._current_target.allowDrawing) {
          var corner = this._current_target._findTargetCorner(this.getPointer(e, true));
          if (!corner) {
            this.isDrawingMode = true;
          } else {
            this.isDrawingMode = false;
          }
        } else if (this.isDrawingMode) {
          this.isDrawingMode = false;
        }
      } else {
        if (this.freeDrawingBrush && !this.isDrawingMode) {
          this.setCursor(this.freeDrawingCursor);
          this.isDrawingMode = true;
        }
      }
    } else {
      this.isHandMode = false;
    }
  },
  _onMouseMove: function _onMouseMove(e) {
    if (!this.interactive) {
      return;
    }

    this._applyMixedMode(e);

    if (this.isHandMode) {

      if (this._current_target && this._current_target.selectable_overwritten) {
        this._current_target.selectable = true;
      }

      if (this._handModeActive) {
        return this._handModeMouseMove(e);
      }
      this.fire('mouse:move', { target: this._current_target, e: e });
      this._current_target && this._current_target.fire('mousemove', { e: e });
      return true;
    } else {
      return _mouse_move_overwritten.call(this, e);
    }
  }, /**
     * @private
     */
  _onScale: function _onScale(e, transform, x, y) {

    var useUniScale = e.shiftKey ^ this.shiftInverted;
    // rotate object only if shift key is not pressed
    // and if it is not a group we are transforming
    if ((useUniScale || this.uniScaleTransform) && !transform.target.get('lockUniScaling')) {
      transform.currentAction = 'scale';
      return this._scaleObject(x, y);
    } else {
      // Switch from a normal resize to proportional
      if (!transform.reset && transform.currentAction === 'scale') {
        this._resetCurrentTransform(e);
      }

      transform.currentAction = 'scaleEqually';
      return this._scaleObject(x, y, 'equally');
    }
  },
  shiftInverted: false,
  _setCursorFromEvent_overwritten: fabric.Canvas.prototype._setCursorFromEvent,
  _setCursorFromEvent: function _setCursorFromEvent(e, target) {
    if (this.isHandMode) {
      this.setCursor('pointer');
    } else {
      this._setCursorFromEvent_overwritten(e, target);
    }
  },
  _onMouseDown: function _onMouseDown(e) {
    if (!this.interactive) {
      return;
    }

    e.preventDefault();
    e.stopPropagation();

    this._applyMixedMode(e);
    if (this.isHandMode && this._current_target) {
      this._current_target.selectable_overwritten = this._current_target.selectable;
      this._current_target.selectable = false;
    }

    _mouse_down_overwritten.call(this, e);

    if (this.isHandMode) {

      if (this._current_target && this._current_target.selectable_overwritten) {
        this._current_target.selectable = true;
      }
      this._handModeActive = true;
      this._handModeMouseDown(e);
    }
  },

  _onMouseUp: function _onMouseUp(e) {
    if (!this.interactive) {
      return;
    }
    e.preventDefault();
    e.stopPropagation();
    _mouse_up_overwritten.call(this, e);

    if (this.isHandMode) {
      this._handModeActive = false;
    }
  }
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 60 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

/**
   * Draw CSS3 border image on canvas.
   * @param canvas    {HTMLCanvasElement}
   * @param img       {HTMLImageElement} border-image-source image
   * @param options   {Object}
   *      slice {Array} border-image-slice values
   *      width {Array} border-image-width values
   *      outset {Array} border-image-outset values
   *      repeat {Array} border-image-repeat values
   * @param size      {Object}
   */

fabric.util.drawBorderImage = function (canvas, img, options) {

  var options = fabric.util.object.extend({
    "slice": [25, 25, 25, 25],
    "width": [25, 25, 25, 25],
    "fill": false,
    "repeat": ["round", "round"],
    "outset_values": [0, 0, 0, 0],
    "slice_units": [0, 0, 0, 0],
    "width_units": [0, 0, 0, 0],
    "outset_units": [0, 0, 0, 0],
    "size": [canvas.width, canvas.height]
  }, options);

  var w = img.width;
  var h = img.height;

  var ctx = canvas.getContext("2d");
  var slice = options.slice;
  var width = options.width;

  var w2 = options.size[0];
  var h2 = options.size[1];

  if (options.slice_units[0] == 1) slice[0] *= h / 100;
  if (options.slice_units[1] == 1) slice[1] *= w / 100;
  if (options.slice_units[2] == 1) slice[2] *= h / 100;
  if (options.slice_units[3] == 1) slice[3] *= w / 100;

  if (options.width_units[0] == 1) width[0] *= h2 / 100;
  if (options.width_units[1] == 1) width[1] *= w2 / 100;
  if (options.width_units[2] == 1) width[2] *= h2 / 100;
  if (options.width_units[3] == 1) width[3] *= w2 / 100;

  function drawSide(side, sliceOffset, sliceWidth, drawOffset, drawWidth) {
    var d;
    if (side == 0) {
      d = [slice[3] + sliceOffset, 0, sliceWidth, slice[0], width[3] + drawOffset, 0, drawWidth, width[0]];
    }
    if (side == 2) {
      d = [slice[3] + sliceOffset, h - slice[2], sliceWidth, slice[2], width[3] + drawOffset, h2 - width[2], drawWidth, width[2]];
    }
    if (side == 1) {
      d = [w - slice[1], slice[0] + sliceOffset, slice[1], sliceWidth, w2 - width[1], width[0] + drawOffset, width[1], drawWidth];
    }
    if (side == 3) {
      d = [0, slice[0] + sliceOffset, slice[3], sliceWidth, 0, width[0] + drawOffset, width[3], drawWidth];
    }
    ctx.drawImage(img, d[0], d[1], d[2], d[3], d[4], d[5], d[6], d[7]);
  }

  function _draw_border_side(side) {
    var _top_width, _top_slice, repeat;
    if (side == 0 || side == 2) {
      _top_width = w2 - width[1] - width[3];
      _top_slice = w - slice[1] - slice[3];
      repeat = options.repeat[0];
    } else {
      _top_width = h2 - width[0] - width[2];
      _top_slice = h - slice[0] - slice[2];
      repeat = options.repeat[1];
    }

    if (repeat == "stretch") {
      return drawSide(side, 0, _top_slice, 0, _top_width);
    }

    var _aspect = slice[side] / width[side];
    var _one_width = _top_slice * width[side] / slice[side];
    var count = 1;
    var _left = 0;

    if (repeat == "repeat") {

      var _rest = _one_width - _top_width % _one_width / 2;
      var _rest_aspect = _aspect * _rest;
      count = Math.floor(_top_width / _one_width);

      if (_rest > 0) {
        drawSide(side, _rest_aspect, _top_slice - _rest_aspect, 0, _one_width - _rest);
      }

      _left = _one_width - _rest;

      for (var i = 0; i < count; i++) {
        drawSide(side, 0, _top_slice, _left, _one_width);
        _left += _one_width;
      }

      if (_rest > 0) {
        drawSide(side, 0, _top_slice - _rest_aspect, _left, _one_width - _rest);
      }
    }
    if (repeat == "round") {

      _left = 0;
      count = Math.max(1, Math.round(_top_width / _one_width));
      _one_width = _top_width / count;

      while (_left < _top_width) {
        drawSide(side, 0, _top_slice, _left, _one_width);
        _left += _one_width;
      }
    }
  }

  _draw_border_side(0);
  _draw_border_side(2);
  _draw_border_side(1);
  _draw_border_side(3);

  //top left
  ctx.drawImage(img, 0, 0, slice[3], slice[0], 0, 0, width[3], width[0]);
  //top right
  ctx.drawImage(img, w - slice[1], 0, slice[1], slice[0], w2 - width[1], 0, width[1], width[0]);
  //bottom left
  ctx.drawImage(img, 0, h - slice[2], slice[3], slice[2], 0, h2 - width[2], width[3], width[2]);

  //bottom right
  ctx.drawImage(img, w - slice[1], h - slice[2], slice[1], slice[2], w2 - width[1], h2 - width[2], width[1], width[2]);
};

/*
 var Frame = function(project,data){
  if(data.border_image){
 data.border_image = mixin( {
 "slice":          [25,25,25,25],
 "width":          [25,25,25,25],
 "fill":           false,
 "repeat":         ["round","round"],
 "outset"	:     [0, 0, 0, 0],
 "slice_units"   : [0, 0, 0, 0],
 "width_units"	: [0, 0, 0, 0],
 "outset_units"	: [0, 0, 0, 0]
 }, data.border_image)
 }
   this.superclass.constructor.call(this,project,data);
 this._add_root("mask");
 this._add_root("image");
 this.example = this._get_example();
  };*/
fabric.util.getOffsetsClipPath = function (o) {

  return ['M', o[3], o[0], 'L', 100 - o[1], o[0], 'L', 100 - o[1], 100 - o[2], 'L', o[3], 100 - o[2], 'z'].join(" ");
};

fabric.util.getRadiusClipPath = function (radius, radius_units, width, height) {

  var br = radius;
  var bru = radius_units || [1, 1, 1, 1, 1, 1, 1, 1];

  var s = {
    "top-left-h": br[0] * (bru[0] ? height / 100 : 1),
    "top-left-w": br[1] * (bru[1] ? width / 100 : 1),
    "top-right-h": br[2] * (bru[2] ? height / 100 : 1),
    "top-right-w": br[3] * (bru[3] ? width / 100 : 1),
    "bottom-right-w": br[4] * (bru[4] ? width / 100 : 1),
    "bottom-right-h": br[5] * (bru[5] ? height / 100 : 1),
    "bottom-left-w": br[6] * (bru[6] ? width / 100 : 1),
    "bottom-left-h": br[7] * (bru[7] ? height / 100 : 1)
  };

  return ["M", 0, s["top-left-h"], "C", 0, s["top-left-h"], 0, 0, s["top-left-w"], 0, "H", width - s["top-right-w"], "C", width - s["top-right-w"], 0, width, 0, width, s["top-right-h"], "V", height - s["bottom-right-h"], "C", width, height - s["bottom-right-h"], width, height, width - s["bottom-right-w"], height, "H", s["bottom-left-w"], "C", s["bottom-left-w"], height, 0, height, 0, height - s["bottom-left-h"], "Z"].join(" ");
};
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 61 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

if (typeof saveAs == "undefined") {
  fabric.saveAs = __webpack_require__(62).saveAs;
} else {
  fabric.saveAs = saveAs;
}

fabric.util.object.extend(fabric.SlideCanvas.prototype, {
  insertRenderArea: false,
  insertRenderFull: false
});

fabric.util.object.extend(fabric.SlideCanvas.prototype.actions, {
  renderArea: {
    className: 'fa fa-download',
    title: 'download',
    action: function action() {
      fabric.saveAs(this.getImageData({
        clipped_area: this.activeArea,
        zoom: this.dotsPerUnit,
        clipped_area_only: true,
        draw_background: true
      }).blob, this.title);
    }
  },
  renderFull: {
    title: 'download with background',
    action: function action() {
      fabric.saveAs(this.getImageData({
        zoom: this.dotsPerUnit,
        clipped_area_only: false,
        draw_background: true
      }).blob, this.title);
    }
  }
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 62 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;

/* FileSaver.js
 * A saveAs() FileSaver implementation.
 * 1.1.20150716
 *
 * By Eli Grey, http://eligrey.com
 * License: X11/MIT
 *   See https://github.com/eligrey/FileSaver.js/blob/master/LICENSE.md
 */

/*global self */
/*jslint bitwise: true, indent: 4, laxbreak: true, laxcomma: true, smarttabs: true, plusplus: true */

/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */

var isLikelyNode = typeof Buffer !== 'undefined' && typeof window === 'undefined';

var saveAs = !isLikelyNode && function (view) {
    "use strict";
    // IE <10 is explicitly unsupported

    if (typeof navigator !== "undefined" && /MSIE [1-9]\./.test(navigator.userAgent)) {
        return;
    }
    var doc = view.document
    // only get URL when necessary in case Blob.js hasn't overridden it yet
    ,
        get_URL = function get_URL() {
        return view.URL || view.webkitURL || view;
    },
        save_link = doc.createElementNS("http://www.w3.org/1999/xhtml", "a"),
        can_use_save_link = "download" in save_link,
        click = function click(node) {
        var event = new MouseEvent("click");
        node.dispatchEvent(event);
    },
        webkit_req_fs = view.webkitRequestFileSystem,
        req_fs = view.requestFileSystem || webkit_req_fs || view.mozRequestFileSystem,
        throw_outside = function throw_outside(ex) {
        (view.setImmediate || view.setTimeout)(function () {
            throw ex;
        }, 0);
    },
        force_saveable_type = "application/octet-stream",
        fs_min_size = 0
    // See https://code.google.com/p/chromium/issues/detail?id=375297#c7 and
    // https://github.com/eligrey/FileSaver.js/commit/485930a#commitcomment-8768047
    // for the reasoning behind the timeout and revocation flow
    ,
        arbitrary_revoke_timeout = 500 // in ms
    ,
        revoke = function revoke(file) {
        var revoker = function revoker() {
            if (typeof file === "string") {
                // file is an object URL
                get_URL().revokeObjectURL(file);
            } else {
                // file is a File
                file.remove();
            }
        };
        if (view.chrome) {
            revoker();
        } else {
            setTimeout(revoker, arbitrary_revoke_timeout);
        }
    },
        dispatch = function dispatch(filesaver, event_types, event) {
        event_types = [].concat(event_types);
        var i = event_types.length;
        while (i--) {
            var listener = filesaver["on" + event_types[i]];
            if (typeof listener === "function") {
                try {
                    listener.call(filesaver, event || filesaver);
                } catch (ex) {
                    throw_outside(ex);
                }
            }
        }
    },
        auto_bom = function auto_bom(blob) {
        // prepend BOM for UTF-8 XML and text/* types (including HTML)
        if (/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(blob.type)) {
            return new Blob(['\uFEFF', blob], { type: blob.type });
        }
        return blob;
    },
        FileSaver = function FileSaver(blob, name, no_auto_bom) {
        if (!no_auto_bom) {
            blob = auto_bom(blob);
        }
        // First try a.download, then web filesystem, then object URLs
        var filesaver = this,
            type = blob.type,
            blob_changed = false,
            object_url,
            target_view,
            dispatch_all = function dispatch_all() {
            dispatch(filesaver, "writestart progress write writeend".split(" "));
        }
        // on any filesys errors revert to saving with object URLs
        ,
            fs_error = function fs_error() {
            // don't create more object URLs than needed
            if (blob_changed || !object_url) {
                object_url = get_URL().createObjectURL(blob);
            }
            if (target_view) {
                target_view.location.href = object_url;
            } else {
                var new_tab = view.open(object_url, "_blank");
                if (new_tab == undefined && typeof safari !== "undefined") {
                    //Apple do not allow window.open, see http://bit.ly/1kZffRI
                    view.location.href = object_url;
                }
            }
            filesaver.readyState = filesaver.DONE;
            dispatch_all();
            revoke(object_url);
        },
            abortable = function abortable(func) {
            return function () {
                if (filesaver.readyState !== filesaver.DONE) {
                    return func.apply(this, arguments);
                }
            };
        },
            create_if_not_found = { create: true, exclusive: false },
            slice;
        filesaver.readyState = filesaver.INIT;
        if (!name) {
            name = "download";
        }
        if (can_use_save_link) {
            object_url = get_URL().createObjectURL(blob);
            save_link.href = object_url;
            save_link.download = name;
            setTimeout(function () {
                click(save_link);
                dispatch_all();
                revoke(object_url);
                filesaver.readyState = filesaver.DONE;
            });
            return;
        }
        // Object and web filesystem URLs have a problem saving in Google Chrome when
        // viewed in a tab, so I force save with application/octet-stream
        // http://code.google.com/p/chromium/issues/detail?id=91158
        // Update: Google errantly closed 91158, I submitted it again:
        // https://code.google.com/p/chromium/issues/detail?id=389642
        if (view.chrome && type && type !== force_saveable_type) {
            slice = blob.slice || blob.webkitSlice;
            blob = slice.call(blob, 0, blob.size, force_saveable_type);
            blob_changed = true;
        }
        // Since I can't be sure that the guessed media type will trigger a download
        // in WebKit, I append .download to the filename.
        // https://bugs.webkit.org/show_bug.cgi?id=65440
        if (webkit_req_fs && name !== "download") {
            name += ".download";
        }
        if (type === force_saveable_type || webkit_req_fs) {
            target_view = view;
        }
        if (!req_fs) {
            fs_error();
            return;
        }
        fs_min_size += blob.size;
        req_fs(view.TEMPORARY, fs_min_size, abortable(function (fs) {
            fs.root.getDirectory("saved", create_if_not_found, abortable(function (dir) {
                var save = function save() {
                    dir.getFile(name, create_if_not_found, abortable(function (file) {
                        file.createWriter(abortable(function (writer) {
                            writer.onwriteend = function (event) {
                                target_view.location.href = file.toURL();
                                filesaver.readyState = filesaver.DONE;
                                dispatch(filesaver, "writeend", event);
                                revoke(file);
                            };
                            writer.onerror = function () {
                                var error = writer.error;
                                if (error.code !== error.ABORT_ERR) {
                                    fs_error();
                                }
                            };
                            "writestart progress write abort".split(" ").forEach(function (event) {
                                writer["on" + event] = filesaver["on" + event];
                            });
                            writer.write(blob);
                            filesaver.abort = function () {
                                writer.abort();
                                filesaver.readyState = filesaver.DONE;
                            };
                            filesaver.readyState = filesaver.WRITING;
                        }), fs_error);
                    }), fs_error);
                };
                dir.getFile(name, { create: false }, abortable(function (file) {
                    // delete file if it already exists
                    file.remove();
                    save();
                }), abortable(function (ex) {
                    if (ex.code === ex.NOT_FOUND_ERR) {
                        save();
                    } else {
                        fs_error();
                    }
                }));
            }), fs_error);
        }), fs_error);
    },
        FS_proto = FileSaver.prototype,
        saveAs = function saveAs(blob, name, no_auto_bom) {
        return new FileSaver(blob, name, no_auto_bom);
    };
    // IE 10+ (native saveAs)
    if (typeof navigator !== "undefined" && navigator.msSaveOrOpenBlob) {
        return function (blob, name, no_auto_bom) {
            if (!no_auto_bom) {
                blob = auto_bom(blob);
            }
            return navigator.msSaveOrOpenBlob(blob, name || "download");
        };
    }

    FS_proto.abort = function () {
        var filesaver = this;
        filesaver.readyState = filesaver.DONE;
        dispatch(filesaver, "abort");
    };
    FS_proto.readyState = FS_proto.INIT = 0;
    FS_proto.WRITING = 1;
    FS_proto.DONE = 2;

    FS_proto.error = FS_proto.onwritestart = FS_proto.onprogress = FS_proto.onwrite = FS_proto.onabort = FS_proto.onerror = FS_proto.onwriteend = null;

    return saveAs;
}(typeof self !== "undefined" && self || typeof window !== "undefined" && window || undefined.content);
// `self` is undefined in Firefox for Android content script context
// while `this` is nsIContentFrameMessageManager
// with an attribute `content` that corresponds to the window

if (typeof module !== "undefined" && module.exports) {
    module.exports.saveAs = saveAs;
} else if ("function" !== "undefined" && __webpack_require__(63) !== null && __webpack_require__(64) != null) {
    !(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_AMD_DEFINE_RESULT__ = function () {
        return saveAs;
    }.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),
				__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));
}

/***/ }),
/* 63 */
/***/ (function(module, exports) {

module.exports = function() {
	throw new Error("define cannot be used indirect");
};


/***/ }),
/* 64 */
/***/ (function(module, exports) {

/* WEBPACK VAR INJECTION */(function(__webpack_amd_options__) {/* globals __webpack_amd_options__ */
module.exports = __webpack_amd_options__;

/* WEBPACK VAR INJECTION */}.call(exports, {}))

/***/ }),
/* 65 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.util.object.extend(fabric.BaseBrush.prototype, {
  useDrawingColor: true,
  setOptions: function setOptions(options) {
    for (var prop in options) {
      this[prop] = options[prop];
    }
  },
  type: "base-brush",
  initialize: function initialize(canvas, options) {
    this.canvas = canvas;
    options = options || {};
    if (this.canvas.application) {
      this.canvas.application.fire("entity:created", { target: this, options: options });
    }
    this.setOptions(options);
  },
  convertColor: function convertColor(color, type) {
    type = type || "name";
    if (color instanceof Array) {
      if (type == "source") {
        return color;
      }
      color = "#" + fabric.Color.fromSource(color).toHex();
    }
    if (type == "hex" || type == "source") {
      if (fabric.Color.colorNameMap[color]) {
        color = fabric.Color.colorNameMap[color];
      }
      if (type == "source") {
        if (color == "transparent") {
          return [0, 0, 0, 0];
        }
        var _source = fabric.Color.fromHex(color).getSource();
        _source[3] *= 255;
        return _source;
      }
    }
    return color;
  },
  getColor: function getColor(type) {
    var color = this.useDrawingColor && this.canvas.drawingColor || this.color;
    return this.convertColor(color, type);
  }
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 66 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.PencilBrush.prototype.initialize = function (canvas) {
  this.callSuper('initialize', canvas);
  this._points = [];
};
fabric.PencilBrush.prototype.type = 'pencil-brush';

fabric.PencilBrush.prototype._render = function () {
  var ctx = this.canvas.contextTop,
      v = this.canvas.viewportTransform,
      p1 = this._points[0],
      p2 = this._points[1];
  ctx.save();
  ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);
  ctx.beginPath();
  ctx.lineWidth = 1 / this.canvas.viewportTransform[0];
  if (this._points.length === 2 && p1.x === p2.x && p1.y === p2.y) {
    p1.x -= 0.5 / this.canvas.viewportTransform[0];
    p2.x += 0.5 / this.canvas.viewportTransform[0];
  }
  ctx.moveTo(p1.x, p1.y);
  for (var i = 1, len = this._points.length; i < len; i++) {
    var midPoint = p1.midPointFrom(p2);
    ctx.quadraticCurveTo(p1.x, p1.y, midPoint.x, midPoint.y);
    p1 = this._points[i];
    p2 = this._points[i + 1];
  }
  ctx.lineTo(p1.x, p1.y);
  ctx.stroke();
  ctx.restore();
};

fabric.PencilBrush.prototype.createPath = function (pathData) {
  var path = new fabric.Path(pathData, {
    stroke: this.getColor(),
    strokeWidth: this.width,
    application: this.canvas.application
  });
  if (this.shadow) {
    this.shadow.affectStroke = true;
    path.setShadow(this.shadow);
  }
  return path;
};
fabric.PencilBrush.prototype.minLength = 3;

fabric.PencilBrush.prototype.accuracy = 0;
fabric.PencilBrush.prototype._finalizeAndAddPath = function () {
  if (this._points.length < 2) return;
  var ctx = this.canvas.contextTop;
  ctx.closePath();
  this.canvas.clearContext(this.canvas.contextTop);
  if (this.accuracy) {
    for (var i in this._points) {
      this._points[i].x = +this._points[i].x.toFixed(this.accuracy);
      this._points[i].y = +this._points[i].y.toFixed(this.accuracy);
    }
    for (i = this._points.length - 1; i--;) {
      if (this._points[i].x == this._points[i + 1].x && this._points[i].y == this._points[i + 1].y) {
        this._points.splice(i, 1);
      }
    }
  }
  if (this._points.length < 2) return;
  var pathData = this.convertPointsToSVGPath(this._points).join('');
  if (this._points.length < this.minLength || pathData === 'M 0 0 Q 0 0 0 0 L 0 0') {
    return this.canvas.renderAll();
  }
  var path = this.createPath(pathData);
  this.canvas.add(path);
  path.setCoords();
  this._resetShadow();
  this.canvas.renderAll();
  this.canvas.fire('path:created', { path: path });
};

fabric.SlideCanvas.prototype.drawingTools.PencilBrush = {
  className: 'fa fa-pencil',
  title: 'Pencil Brush'
};
fabric.SlideCanvas.prototype.activeDrawingTools.push("PencilBrush");
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 67 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

/**
 * PencilBrush class
 * @class fabric.RectangleBrush
 * @extends fabric.BaseBrush
 */

fabric.RectangleBrush = fabric.util.createClass(fabric.BaseBrush, /** @lends fabric.RectangleBrush.prototype */{
  resultObjectType: "Rect",
  type: "rectangle-brush",
  /**
   * Constructor
   * @param {fabric.Canvas} canvas
   * @return {fabric.RectangleBrush} Instance of a pencil brush
   */
  initialize: function initialize(canvas) {
    this.callSuper('initialize', canvas);
  },

  /**
   * Inovoked on mouse down
   * @param {Object} pointer
   */
  onMouseDown: function onMouseDown(pointer) {
    //prepare for drawing
    delete this.p2;

    this.p1 = new fabric.Point(pointer.x, pointer.y);
    this._setBrushStyles();
    this._setShadow();
    this.canvas.contextTop.moveTo(this.p1.x, this.p1.y);
    this._render();
  },

  /**
   * Inovoked on mouse move
   * @param {Object} pointer
   */
  onMouseMove: function onMouseMove(pointer) {

    this.p2 = new fabric.Point(pointer.x, pointer.y);

    if (this.drawingObject) {
      var _rect = this._getRect();
      this.drawingObject.set(_rect);
      this.drawingObject.fire("scaling");
    } else {

      if (this.p1.x === this.p2.x && this.p1.y === this.p2.y) {
        delete this.p2;
      } else {

        if (this.resultObjectType) {
          var _rect = this._getRect();
          this.drawingObject = this._createRectangle(_rect);
        }
      }
    }
    this.canvas.renderLayer("lower");
  },

  /**
   * Invoked on mouse up
   */
  onMouseUp: function onMouseUp() {
    if (this.drawingObject) {
      var _rect = this._getRect();
      var _rect2 = this._checkRectangle(_rect);

      this.canvas.layers.lower.objects.splice(this.canvas.layers.lower.objects.indexOf(this.drawingObject), 1);

      this.drawingObject.set(_rect2);
      this.canvas.add(this.drawingObject);
      this.canvas.setActiveObject(this.drawingObject);
      this.drawingObject.setCoords();
      delete this.drawingObject;
    }
    this.canvas.renderAll();
    // this._finalizeAndAddPath();
  },

  /**
   * Draw a smooth path on the topCanvas using quadraticCurveTo
   * @private
   */
  _render: function _render() {
    this.canvas.fire("before:brush:render", { target: this });
    if (!this.p2) {
      return;
    }
    var ctx = this.canvas.contextTop,
        v = this.canvas.viewportTransform,
        p1 = this.p1,
        p2 = this.p2;

    ctx.save();
    ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);
    ctx.beginPath();
    if (this.application) {
      var _klass_proto = this.application.getDefaultProperties(fabric[this.resultObjectType].prototype) || {};
      ctx.lineWidth = _klass_proto.strokeWidth;
      ctx.strokeStyle = _klass_proto.stroke;
      ctx.fillStyle = _klass_proto.fill;
    }

    var _rect = this._getRect();
    ctx.rect(_rect.left, _rect.top, _rect.width, _rect.height);

    ctx.fill();
    ctx.stroke();
    ctx.restore();
    this.canvas.fire("brush:render", { target: this });
  },
  _getRect: function _getRect() {

    var x1, x2, y1, y2;
    if (this.p1.x < this.p2.x) {
      x1 = this.p1.x, x2 = this.p2.x;
    } else {
      x2 = this.p1.x, x1 = this.p2.x;
    }
    if (this.p1.y < this.p2.y) {
      y1 = this.p1.y, y2 = this.p2.y;
    } else {
      y2 = this.p1.y, y1 = this.p2.y;
    }
    return {
      left: x1,
      top: y1,
      width: x2 - x1,
      height: y2 - y1
    };
  },
  drawingLimits: null, /*{
                       left: 0,
                       width: 0,
                       height: 0,
                       top: 0
                       },*/
  minHeight: 50,
  minWidth: 50,
  _checkRectangle: function _checkRectangle(_rect) {

    var dl = this.drawingLimits;
    if (dl && dl == "backgroundImage") {
      dl = this.canvas.backgroundImage;
    }

    _rect = {
      left: _rect.left,
      top: _rect.top,
      width: _rect.width,
      height: _rect.height
    };

    // _rect.left  -= fabric.Rect.prototype.strokeWidth / 2;
    // _rect.top   -= fabric.Rect.prototype.strokeWidth / 2;

    if (dl) {
      if (_rect.left + _rect.width < dl.left || _rect.top + _rect.height < dl.top || _rect.left > dl.width || _rect.top > dl.height) {
        return false;
      }

      if (_rect.top < dl.top) {
        _rect.height += _rect.top;
        _rect.top = dl.top;
      }
      if (_rect.left < dl.left) {
        _rect.width += _rect.left;
        _rect.left = dl.left;
      }
    }

    if (this.minWidth && _rect.width < this.minWidth) {
      _rect.width = this.minWidth;
    }
    if (this.minHeight && _rect.height < this.minHeight) {
      _rect.height = this.minHeight;
    }

    if (dl) {
      var _xdiff = _rect.left + _rect.width - dl.width;
      if (_xdiff > 0) {
        _rect.width -= _xdiff;
        if (this.minWidth && _rect.width < this.minWidth) {
          _rect.left -= this.minWidth - _rect.width;
          _rect.width = this.minWidth;
        }
      }
      var _ydiff = _rect.top + _rect.height - dl.height;
      if (_ydiff > 0) {
        _rect.height -= _ydiff;
        if (this.minHeight && _rect.height < this.minHeight) {
          _rect.top -= this.minHeight - _rect.height;
          _rect.height = this.minHeight;
        }
      }
    }
    return _rect;
  },
  _createRectangle: function _createRectangle(rect) {
    this.canvas.setActiveObject(false);
    rect.active = true;
    rect.application = this.application;
    rect.canvas = this.canvas;
    var _object = fabric.util.createObject(this.resultObjectType, rect);
    this.canvas.layers.lower.objects.push(_object);
    _object.updateResponsiveBorder();
    this.canvas.renderAll();
    return _object;
  }

  /**
   * On mouseup after drawing the path on contextTop canvas
   * we use the points captured to create an new fabric rect object
   * and add it to the fabric canvas.
   */
  // _finalizeAndAddPath: function () {
  //
  //   if (!this.p2) {
  //     return false;
  //   }
  //   var ctx = this.canvas.contextTop;
  //   ctx.closePath();
  //
  //
  //   this.canvas.clearContext(this.canvas.contextTop);
  //   this._resetShadow();
  //
  //   // var _rect = this._getRect();
  //   var _rect2 = this._checkRectangle(_rect);
  //   if(_rect2){
  //     // if(this.resultObjectType){
  //     //   this._createRectangle(_rect2);
  //     // }
  //     this.canvas.fire('rect:created', {rect: _rect2, original: _rect});
  //   }else{
  //     this.canvas.fire('rect:rejected', {rect: _rect});
  //   }
  //   this.canvas.renderLayer(this.layers.lower);
  // }
});

fabric.SlideCanvas.prototype.drawingTools.RectangleBrush = {
  className: 'fa fa-pencil-square',
  title: 'select-brush'
};
fabric.SlideCanvas.prototype.activeDrawingTools.push("RectangleBrush");
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 68 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

/**
 * PencilBrush class
 * @class fabric.RectangleBrush
 * @extends fabric.BaseBrush
 */

fabric.PolygonBrush = fabric.util.createClass(fabric.BaseBrush, /** @lends fabric.RectangleBrush.prototype */{
  resultObjectType: "Polyline",
  type: "polygon-brush",
  virtualObject: false,
  maximumPoints: 0,
  individualDrawing: true,
  /**
   * Constructor
   * @param {fabric.Canvas} canvas
   * @return {fabric.RectangleBrush} Instance of a pencil brush
   */
  initialize: function initialize(canvas) {
    this.callSuper('initialize', canvas);
    this.reset();
  },
  /**
   * Inovoked on mouse down
   * @param {Object} pointer
   */
  onMouseDown: function onMouseDown(pointer) {

    if (this.individualDrawing || !this.target) {
      var _point = { x: pointer.x, y: pointer.y };
      this.points.push(_point);
      if (!this.virtualObject) {
        this.target = this.canvas.createObject(fabric.util.object.extend({}, this.resultObjectProperties, {
          type: this.resultObjectType,
          points: [_point],
          active: true
        }));
      }
    } else {
      this._create_active_point(pointer);
    }

    if (this.virtualObject) {
      this._setBrushStyles();
      this._setShadow();
      this._render();
    } else {
      this.canvas.renderAll();
    }
  },

  _create_active_point: function _create_active_point(pointer) {
    var _point = { x: pointer.x, y: pointer.y };
    this.activePoint = _point;
    this.activeTargetPoint = { x: pointer.x - this.target.left, y: pointer.y - this.target.top };
    this.points.push(this.activePoint);
    this.target.addPoint(this.activeTargetPoint);
  },
  /**
   * Inovoked on mouse move
   * @param {Object} pointer
   */
  onMouseMove: function onMouseMove(pointer) {

    var _p = { x: pointer.x - this.target.left, y: pointer.y - this.target.top };

    if (this.activePoint) {
      this.activePoint.x = pointer.x;
      this.activePoint.y = pointer.y;
      var _order = this.target.points.length;

      this.target.setPoint("p" + _order, {
        x: pointer.x - this.target.left,
        y: pointer.y - this.target.top
      });
    } else {
      var _dist = fabric.Point.prototype.distanceFrom.call(this.points[0], _p);
      if (_dist > 10) {
        this._create_active_point(pointer);
      }
    }
    this.canvas.renderAll();
  },
  reset: function reset() {
    this.points = [];
    this.target = null;
    this.activePoint = null;
    this.activeTargetPoint = null;
  },
  /**
   * Invoked on mouse up
   */
  onMouseUp: function onMouseUp() {
    this.target.updateBbox();
    if (this.points.length == this.maximumPoints) {
      this.reset();
    }
    this.activePoint = null;
    this.canvas.renderAll();
  },

  /**
   * Draw a smooth path on the topCanvas using quadraticCurveTo
   * @private
   */
  _render: function _render() {
    this.canvas.fire("before:brush:render", { target: this });

    var ctx = this.canvas.contextTop,
        v = this.canvas.viewportTransform;

    ctx.save();
    ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);

    var _klass_proto = fabric[this.resultObjectType].prototype;

    ctx.lineWidth = _klass_proto.strokeWidth;
    ctx.strokeStyle = _klass_proto.stroke;
    ctx.fillStyle = _klass_proto.fill;

    ctx.beginPath();
    ctx.moveTo(this.points[0].x, this.points[0].y);
    for (var i = 1; i < this.points.length; i++) {
      ctx.lineTo(this.points[i].x, this.points[i].y);
    }
    ctx.closePath();
    ctx.fill();
    ctx.stroke();
    ctx.restore();
    this.canvas.fire("brush:render", { target: this });
  },
  drawingLimits: null, /*{
                       left: 0,
                       width: 0,
                       height: 0,
                       top: 0
                       },*/
  minHeight: 50,
  minWidth: 50,
  _checkRectangle: function _checkRectangle(_rect) {

    var dl = this.drawingLimits;
    if (dl && dl == "backgroundImage") {
      dl = this.canvas.backgroundImage;
    }

    _rect = {
      left: _rect.left,
      top: _rect.top,
      width: _rect.width,
      height: _rect.height
    };

    _rect.left -= fabric.Rect.prototype.strokeWidth / 2;
    _rect.top -= fabric.Rect.prototype.strokeWidth / 2;

    if (dl) {
      if (_rect.left + _rect.width < dl.left || _rect.top + _rect.height < dl.top || _rect.left > dl.width || _rect.top > dl.height) {
        return false;
      }

      if (_rect.top < dl.top) {
        _rect.height += _rect.top;
        _rect.top = dl.top;
      }
      if (_rect.left < dl.left) {
        _rect.width += _rect.left;
        _rect.left = dl.left;
      }
    }

    if (this.minWidth && _rect.width < this.minWidth) {
      _rect.width = this.minWidth;
    }
    if (this.minHeight && _rect.height < this.minHeight) {
      _rect.height = this.minHeight;
    }

    if (dl) {
      var _xdiff = _rect.left + _rect.width - dl.width;
      if (_xdiff > 0) {
        _rect.width -= _xdiff;
        if (this.minWidth && _rect.width < this.minWidth) {
          _rect.left -= this.minWidth - _rect.width;
          _rect.width = this.minWidth;
        }
      }
      var _ydiff = _rect.top + _rect.height - dl.height;
      if (_ydiff > 0) {
        _rect.height -= _ydiff;
        if (this.minHeight && _rect.height < this.minHeight) {
          _rect.top -= this.minHeight - _rect.height;
          _rect.height = this.minHeight;
        }
      }
    }
    return _rect;
  },
  resultObjectProperties: {}
});

fabric.SlideCanvas.prototype.drawingTools.PolygonBrush = {
  icon: 'data:image/png;base64,' + __webpack_require__(69),
  title: 'Polygon Brush'
};
fabric.SlideCanvas.prototype.activeDrawingTools.push("PolygonBrush");
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 69 */
/***/ (function(module, exports) {

module.exports = "iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAANlAAADZQBELD/fAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAXPSURBVHic5dt/yF5lGQfwz7U555aatpEopk6yLba16IegDCk0C0kD2woJDZr9IbUg0zYi+yMSQvtFhhG1aOI/Of/QLLEgcggzzcpBc1CT2oqsXNhqsznbrv647xffPXuf7Xmec57z7p1fuDmcc+4f1/W9r3Of+1zXdSIzvRoQEfPxucz8/GHXXw0ERMRC/ARzM/Otk+/Nmh6RukNEXIgtuHiq+yc0ARHxNkX5i/rVOWEJiIgrsRln4Yl+9U5IAiLievwYp+Jb+Fi/uiccARGxDhsxR1n11+JQv/ondSXYuBERs/ANrMX/cGNmbjxWuxOCgIiYi3uxCvuwKjMfGaTtjCcgIs7Ag7gMz+OqzHxq0PYzmoCIOBePYCmexfsyc8cwfRyxCEbE4oh4bTsijg8RsRSPK8r/GpcOqzxTW8DVuDMi/oxt+F0t2/BMZr44stQtISIuU8z+DPxUeeb3jtRZZh5WcBr+hZyiHMQOPIDbcR2W4+TefsZVlIVuf5XnHswZoM2SWv/pI+71afDl2uAp3IwNym7qP32IeRnP4D58AR/EYsxuWfm1dRKyyhgDthuagLPxEg7g3EnXA4vwfqxXXj2/nTQjvWU/nq711td2iwYVvGfciUk5iLVDth+OgNpoQ230lQEGmF1n/NpqAfcpa8bLfYjZWy3q+9XCrsQ5ffqeU019gtDVI1hOXwL6+gMi4s1Vib14Q2bumbLiURARJ1dilmJZLUtxoam34S94ZeHdpjxW6ypBe/CBzNw8ghxLsB1bs8cfcCzmfqQwt77lZ3ke3o4bcAcexk5TW0viL1jeYLzhLaAytxKP4TlckJkHhmV/GETE6YqFTLaYebguM3c16Hc0C6jkPK6wt6ZNK+iyOIoFDPI5fEc93hIRMeosHK8YhIAH8XuFxavHK073OCYBmXkIX62nt45XnO4xqEfoHvwdKyPikjHK0zkGIiAz9+OuevrZ8YnTPYbxCd6tbIquiYg3jUmezjEwAZn5Ar5X29wyNok6xrBe4a8rDscbIuKsMcjTOYYioO7Gfoi5+NRYJOoYo8QF7qzHmyLi1DaFmQ4MTUBmbsXPcCZubF2ijjFqZGhie/zpiJjRnuWRCMjMn+M3OA8fblWijtEkNjixFszo7XETAjbhT1hRQ9EzEiMTkJkH8bV6OmO3x03D4xvwT1xeszFmHBoRkCVKdHc9nZFrQRsJEnfhv1gdERe00F+naExAZj6PHyixgZub9jcmLOp7pyWn4xuViM0+LDgOnKBzcAW+iT96xb0+eGRohEE31UFumyalX4ePKB9rexweV/iD4ta7dJwEXFwH+wfmdaT0RfgMHlU+0ydHsR9TXs9LjtpHywI9WgW4aUwKz8ZK5Vtke88s/xv3K9GmhQP32bKAV00yuVkt9XmakhOwEbt7lN6p5AG+14g5Cm0TEEpgM5WsjVH7OQ+fUPJ/Xpqk8CE8iduwohWZ2ySgCv/RKuwTQxL3TnxRySeYPMsv4iF8HGe3Lm+Lii/GGsVxOiH87VjWp/48JWHiO/hrj9LP4bu4BvPbVrpVAqri91fz7Bfe/iXeoiQur1HCbft66mzFl+rbZKgMkial0Q8TNT6wBQuUbJBf4RdKbtFyvBuX4BTl1TSrmjsl/WazkoPwUGbuHFmQJmg4+xML3r14TZ86c5Uc3omZ3oTVOL2rWR7LI6DsrxO7DGCySk5Q4orpVnpyafIxNBEY2ZWDPUfP1uOZDcZsHw0s4CQlofKgY8wq3qHEFQ/h/Ome9VYegarYJxWzPqCkvF2v5hXi9fgQvl2VHyjlbkYRUBW91ZGJkn8z9WvxXdOtcG9p5b/BiDhHcYa8R/ENzFd8hU8qi9/Cai3bMnNZ4wFbROs/TtZEqgWZubvn2g4lQfL8bJDy1jZa/2kqC3b3XlN2g7Ci7TGbYDr+GjtlGsbsi04IqP/1XF5Pt3cx5qDoygLWKRunLUoS9HGDrgjYo4TRVmXbq25D/B9PLfo3EMEZiwAAAABJRU5ErkJggg=="

/***/ }),
/* 70 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

/**
 * PencilBrush class
 * @class fabric.PencilBrush
 * @extends fabric.BaseBrush
 */

fabric.PaintPenBrush = fabric.util.createClass(fabric.BaseBrush, /** @lends fabric.PencilBrush.prototype */{
  type: 'paint-pen-brush',

  /**
   * Constructor
   * @param {fabric.Canvas} canvas
   * @return {fabric.PencilBrush} Instance of a pencil brush
   */
  initialize: function initialize(canvas) {
    this.callSuper('initialize', canvas);
    this._points = [];
  },
  getTarget: function getTarget() {
    return this.canvas.drawingContext;
  },
  /**
   * Inovoked on mouse down
   * @param {Object} pointer
   */
  onMouseDown: function onMouseDown(pointer) {
    this._reset();
    this._fill(pointer);
  },

  /**
   * Inovoked on mouse move
   * @param {Object} pointer
   */
  onMouseMove: function onMouseMove(pointer) {
    this._fill(pointer);
  },
  /**
   * Invoked on mouse up
   */
  onMouseUp: function onMouseUp() {
    this.canvas.fire("draw:after", {
      target: this.getTarget(),
      points: this._points.slice(),
      color: this.getColor('source')
    });
  },
  _fill: function _fill(pointer) {
    pointer = {
      x: Math.floor(pointer.x),
      y: Math.floor(pointer.y)
    };

    if (_.findWhere(this._points, pointer)) {
      return;
    }

    // this.getTarget().fillRect(pointer.x , pointer.y  ,1,1);
    var _data = this.getTarget().getImageData(pointer.x, pointer.y, 1, 1);
    pointer.color = Array.prototype.slice.call(_data.data);
    this._points.push(pointer);
    var _color = this.getColor('source');

    _data.data[0] = _color[0];
    _data.data[1] = _color[1];
    _data.data[2] = _color[2];
    _data.data[3] = _color[3];

    this.getTarget().putImageData(_data, pointer.x, pointer.y);
    this.canvas.renderAll();
  },
  undoPaintAction: function undoPaintAction(_action) {
    var ctx = _action.object;
    for (var i in _action.points) {
      var _p = _action.points[i],
          _c = _action.brush.getActionColor(_p.color);
      if (_c[3] == 0) {
        ctx.clearRect(_p.x, _p.y, 1, 1);
      } else {
        ctx.fillStyle = "rgba(" + _c[0] + "," + _c[1] + "," + _c[2] + "," + _c[3] + ")";
        ctx.fillRect(_p.x, _p.y, 1, 1);
      }
    }
    _action.canvas.renderAll();
  },
  redoPaintAction: function redoPaintAction(_action) {

    var ctx = _action.object,
        _c = _action.brush.getActionColor(_action.color);
    var pts = _action.points;
    if (_c[3] == 0) {
      for (var i in pts) {
        ctx.clearRect(pts[i].x, pts[i].y, 1, 1);
      }
    } else {
      ctx.fillStyle = "rgba(" + _c[0] + "," + _c[1] + "," + _c[2] + "," + _c[3] + ")";
      for (var i in pts) {
        ctx.fillRect(pts[i].x, pts[i].y, 1, 1);
      }
    }
    _action.canvas.renderAll();
  },
  /**
   * Clear points array and set contextTop canvas style.
   * @private
   */
  _reset: function _reset() {
    this._points.length = 0;
    this.getTarget().fillStyle = this.color;
  },
  getHistoryRecord: function getHistoryRecord(event) {

    return {
      canvas: this.canvas,
      type: "draw:pen",
      object: event.target,
      points: event.points,
      brush: this,
      color: event.color,
      undo: this.undoPaintAction,
      redo: this.redoPaintAction
    };
  }
});

fabric.SlideCanvas.prototype.drawingTools.PaintPenBrush = {
  className: 'fa fa-paint-brush',
  title: 'Pen Brush'
};
fabric.SlideCanvas.prototype.activeDrawingTools.push("PaintPenBrush");
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 71 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.MagicWand = __webpack_require__(11);

/**
 * PencilBrush class
 * @class fabric.PencilBrush
 * @extends fabric.BaseBrush
 */
fabric.PaintBucketBrush = fabric.util.createClass(fabric.BaseBrush, /** @lends fabric.PencilBrush.prototype */{
  type: 'paint-bucket-brush',
  /**
   * Constructor
   * @param {fabric.Canvas} canvas
   * @return {fabric.PencilBrush} Instance of a pencil brush
   */
  initialize: function initialize(canvas) {
    this.callSuper('initialize', canvas);
    this._points = [];
  },
  getTarget: function getTarget() {
    return this.canvas.drawingContext;
  },
  onMouseUp: function onMouseUp() {},
  onMouseMove: function onMouseMove() {},
  onMouseDown: function onMouseDown(pointer) {
    this._fill(pointer);
  },
  _fill: function _fill(pointer) {
    pointer = {
      x: Math.floor(pointer.x),
      y: Math.floor(pointer.y)
    };

    var info = this.getTarget().getImageData(0, 0, this.getTarget().canvas.width, this.getTarget().canvas.height);

    fabric.MagicWand.floodFill(info, pointer.x, pointer.y, 1, {}, null, function (mask) {
      var _color = this.getColor('source');
      var _target = this.getTarget();
      var _w = mask.bounds.maxX - mask.bounds.minX + 1,
          _h = mask.bounds.maxY - mask.bounds.minY + 1;
      var oldImageData = _target.getImageData(mask.bounds.minX, mask.bounds.minY, _w, _h);

      mask.render(_target, {
        intersectionColor: _color,
        fill: _color,
        cache: false,
        left: mask.bounds.minX,
        top: mask.bounds.minY
      });

      this.canvas.fire("draw:after", {
        target: this.getTarget(),
        redo: _target.getImageData(mask.bounds.minX, mask.bounds.minY, _w, _h),
        undo: oldImageData,
        left: mask.bounds.minX,
        top: mask.bounds.minY,
        color: this.getColor().slice()
      });

      this.canvas.renderAll();
    }.bind(this));
  },
  getHistoryRecord: function getHistoryRecord(event) {

    return {
      canvas: this.canvas,
      object: event.target,
      type: "draw:bucket",
      left: event.left,
      top: event.top,
      undoData: event.undo,
      redoData: event.redo,
      color: this.convertColor(event.color, "source"),
      undo: function undo(_action) {
        _action.object.putImageData(_action.undoData, _action.left, _action.top);
        _action.canvas.renderAll();
      },
      redo: function redo(_action) {
        _action.object.putImageData(_action.redoData, _action.left, _action.top);
        _action.canvas.renderAll();
      }
    };
  }
});

fabric.SlideCanvas.prototype.drawingTools.PaintBucketBrush = {
  icon: 'data:image/svg+xml;base64,' + __webpack_require__(72),
  title: 'Bucket Brush'
};
fabric.SlideCanvas.prototype.activeDrawingTools.push("PaintBucketBrush");
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 72 */
/***/ (function(module, exports) {

module.exports = "PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNMjEuMTQzIDkuNjY3Yy0uNzMzLTEuMzkyLTEuOTE0LTMuMDUtMy42MTctNC43NTMtMi45NzctMi45NzgtNS40NzgtMy45MTQtNi43ODUtMy45MTQtLjQxNCAwLS43MDguMDk0LS44Ni4yNDZsLTEuMzYxIDEuMzZjLTEuODk5LS4yMzYtMy40Mi4xMDYtNC4yOTQuOTgzLS44NzYuODc1LTEuMTY0IDIuMTU5LS43OTIgMy41MjMuNDkyIDEuODA2IDIuMzA1IDQuMDQ5IDUuOTA1IDUuMzc1LjAzOC4zMjMuMTU3LjYzOC40MDUuODg1LjU4OC41ODggMS41MzUuNTg2IDIuMTIxIDBzLjU4OC0xLjUzMy4wMDItMi4xMTljLS41ODgtLjU4Ny0xLjUzNy0uNTg4LTIuMTIzLS4wMDFsLS4xNy4yNTZjLTIuMDMxLS43NjUtMy4zOTUtMS44MjgtNC4yMzItMi45bDMuODc5LTMuODc1Yy40OTYgMi43MyA2LjQzMiA4LjY3NiA5LjE3OCA5LjE3OGwtNy4xMTUgNy4xMDdjLS4yMzQuMTUzLTIuNzk4LS4zMTYtNi4xNTYtMy42NzUtMy4zOTMtMy4zOTMtMy4xNzUtNS4yNzEtMy4wMjctNS40OThsMS44NTktMS44NTZjLS40MzktLjM1OS0uOTI1LTEuMTAzLTEuMTQxLTEuNjg5bC0yLjEzNCAyLjEzMWMtLjQ0NS40NDYtLjY4NSAxLjA2NC0uNjg1IDEuODIgMCAxLjYzNCAxLjEyMSAzLjkxNSAzLjcxMyA2LjUwNiAyLjc2NCAyLjc2NCA1LjU4IDQuMjQzIDcuNDMyIDQuMjQzLjY0OCAwIDEuMTgtLjE5NSAxLjU0Ny0uNTYybDguMDg2LTguMDc4Yy45MS44NzQtLjc3OCAzLjUzOC0uNzc4IDQuNjQ4IDAgMS4xMDQuODk2IDEuOTk5IDIgMS45OTkgMS4xMDUgMCAyLS44OTYgMi0yIDAtMy4xODQtMS40MjUtNi44MS0yLjg1Ny05LjM0em0tMTYuMjA5LTUuMzcxYy41MjctLjUzIDEuNDcxLS43OTEgMi42NTYtLjc2MWwtMy4yMDkgMy4yMDZjLS4yMzYtLjk3OC0uMDQ5LTEuODQ1LjU1My0yLjQ0NXptOS4yOTIgNC4wNzlsLS4wMy0uMDI5Yy0xLjI5Mi0xLjI5Mi0zLjgwMy00LjM1Ni0zLjA5Ni01LjA2My43MTUtLjcxNSAzLjQ4OCAxLjUyMSA1LjA2MiAzLjA5Ni44NjIuODYyIDIuMDg4IDIuMjQ3IDIuOTM3IDMuNDU4LTEuNzE3LTEuMDc0LTMuNDkxLTEuNDY5LTQuODczLTEuNDYyeiIvPjwvc3ZnPg=="

/***/ }),
/* 73 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.PointsBrush = fabric.util.createClass(fabric.BaseBrush, {
  type: "points-brush",
  maximumPoints: 0,
  initialize: function initialize(canvas) {
    this.callSuper('initialize', canvas);
    this.reset();
  },
  currentPoint: 1,
  getPoints: function getPoints() {
    return fabric.util.object.where(this.canvas._objects, { type: "material-point" });
  },
  checkPosition: null,
  onMouseDown: function onMouseDown(pointer) {},
  onMouseMove: function onMouseMove(pointer) {},
  reset: function reset() {},
  onMouseUp: function onMouseUp(pointer) {
    var _points = this.getPoints();

    var pos = {
      left: pointer.x - 0.5,
      top: pointer.y - 0.5
    };

    var _correct = this.checkPosition ? this.checkPosition(pointer) : true;

    if (!_correct) {
      this.canvas.fire("point:rejected", { point: pointer });
      return;
    }

    if (this.maximumPoints && _points.length >= this.maximumPoints) {
      if (this.currentPoint > this.maximumPoints) {
        this.currentPoint = 1;
      }
      if (this.wholeCoordinates) {
        pointer.x = Math.round(pointer.x) + 0.5;
        pointer.y = Math.round(pointer.y) + 0.5;
      }

      var _obj = fabric.util.object.findWhere(_points, { number: this.currentPoint++ });

      var states = {
        original: {
          left: _obj.left,
          top: _obj.top
        },
        modified: {
          left: pointer.x - 0.5,
          top: pointer.y - 0.5
        }
      };

      _obj.set(states.modified).setCoords().fire("modified", { states: states });
      this.canvas.fire("object:modified", { target: _obj, states: states });
      this.canvas.setActiveObject(_obj);
      this.canvas.renderAll();
      return;
    } else {
      this.currentPoint = 1;
      while (fabric.util.object.findWhere(_points, { number: this.currentPoint })) {
        this.currentPoint++;
      }
    }

    var _obj = new fabric.MaterialPoint({
      number: this.currentPoint,
      application: this.canvas.application,
      left: pos.left,
      top: pos.top
    });

    this.currentPoint++;
    this.canvas.add(_obj);
    this.canvas.fire("point:created", { point: _obj });
    this.canvas.setActiveObject(_obj);
    this.canvas.renderAll();
  },
  _render: function _render() {}
});

fabric.SlideCanvas.prototype.drawingTools.PointsBrush = {
  className: 'fa fa-circle-o',
  title: 'Points Brush'
};
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 74 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

var path_initialize_overwritten = fabric.Path.prototype.initialize;

fabric.util.object.extend(fabric.Path.prototype, {
  accuracy: -1,
  initialize: function initialize(path, options) {
    this.callSuper('initialize', options);
    path_initialize_overwritten.call(this, path, options);

    if (this.accuracy != -1) {
      this._set_accuracy(this.accuracy, this.path);
    }
  },
  translate: function translate(path, translateX, translateY) {
    var current;
    //if(this.path[0][0] === "m"){
    //  return;
    //}
    for (var i = 0, len = path.length; i < len; ++i) {

      current = path[i];

      switch (current[0]) {// first letter
        case 'L':
          // lineto, absolute
          current[1] += translateX;
          current[2] += translateY;
          break;
        case 'H':
          current[1] += translateX;
          break;
        case 'V':
          // verical lineto, absolute
          current[1] += translateY;
          break;
        case 'M':
          current[1] += translateX;
          current[2] += translateY;
          break;
        case 'C':
          current[1] += translateX;
          current[2] += translateY;
          current[3] += translateX;
          current[4] += translateY;
          current[5] += translateX;
          current[6] += translateY;
          break;
        case 'S':
          current[1] += translateX;
          current[2] += translateY;
          current[3] += translateX;
          current[4] += translateY;
          break;
        case 'Q':
          // quadraticCurveTo, absolute
          current[1] += translateX;
          current[2] += translateY;
          current[3] += translateX;
          current[4] += translateY;
          break;
        case 'T':
          current[1] += translateX;
          current[2] += translateY;
          break;
        case 'A':
          current[1] += translateX; //todo??
          current[2] += translateY; //todo ??
          current[6] += translateX;
          current[7] += translateY;
      }
    }
  },
  _set_accuracy: function _set_accuracy(accuracy, path) {
    for (var i = 0; i < path.length; i++) {
      for (var j = 1; j < path[i].length; j++) {
        path[i][j] = +path[i][j].toFixed(this.accuracy);
      }
    }
  },
  setAccuracy: function setAccuracy(accuracy) {
    this.accuracy = accuracy;
    if (!this._points) return;
    this._set_accuracy(accuracy, this.path);
  },
  storePathAsString: false,
  _toObject_overwritten: fabric.Path.prototype.toObject,
  //todo use event "before:object";
  toObject: function toObject(propertiesToInclude) {

    if (this.accuracy !== -1) {
      this._set_accuracy(this.accuracy, this.path);
      this.left = +this.left.toFixed(this.accuracy);
      this.top = +this.top.toFixed(this.accuracy);
      this.pathOffset.x = +this.pathOffset.x.toFixed(this.accuracy);
      this.pathOffset.y = +this.pathOffset.y.toFixed(this.accuracy);
    }

    var _obj = this._toObject_overwritten(propertiesToInclude);

    if (this.storeProperties.indexOf("*") == -1) {

      if (_obj.pathOffset && this.storeProperties.indexOf("pathOffset") == -1) {
        this.translate(_obj.path, _obj.pathOffset.x, _obj.pathOffset.y);
        this._set_accuracy(this.accuracy, _obj.path);
      }

      for (var i in _obj) {
        if (this.storeProperties.indexOf(i) == -1) {
          delete _obj[i];
        }
      }
      console.log("!!!");
    }
    if (this.storePathAsString) {
      _obj.path = _obj.path.join('');
    }
    return _obj;
  }
});

/**
 * Creates an instance of fabric.Path from an object
 * @static
 * @memberOf fabric.Path
 * @param {Object} object
 * @param {Function} callback Callback to invoke when an fabric.Path instance is created
 */
fabric.Path.fromObject = function (object, callback) {
  /* if (typeof object.path === 'string') {
   fabric.loadSVGFromURL(object.path, function (elements) {
   var path = elements[0],
   pathUrl = object.path;
    delete object.path;
    fabric.util.object.extend(path, object);
   path.setSourcePath(pathUrl);
    callback(path);
   });
   }
   else {*/

  var _scaled = object.scaleX || object.scaleY;

  var path = new fabric.Path(object.path, object);

  if (!_scaled) {
    if (object.width) {
      path.scaleX = object.width / path.width;
    }
    if (object.height) {
      path.scaleY = object.height / path.height;
    }
  }

  callback && callback(path);
  return path;
  // }
};
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 75 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

__webpack_require__(12);
__webpack_require__(76);
__webpack_require__(77);
__webpack_require__(7);
__webpack_require__(78);

/**
 * @author Denis Ponomarev
 * @email den.ponomarev@gmail.com
 */
fabric.Clipart = fabric.util.createClass(fabric.Group, fabric.StrokeMixin, fabric.CacheMixin, fabric.ImageMixin, {
  type: 'clipart',
  colors: null,
  format: 'svg',
  resizable: true,
  processing: false,
  stateProperties: fabric.Group.prototype.stateProperties.concat(["colors"]),
  optionsOrder: ["*", "colors", "element", "actions", "tools"],
  getOriginalSize: function getOriginalSize() {
    return {
      width: this.element.width,
      height: this.element.height
    };
  },
  initialize: function initialize(options) {
    options || (options = {});

    if (options.constructor != Object) {

      var _obj = options.toObject();
      if (options.element) {
        _obj.element = options.element.cloneSync();
        _obj.element.clipTo = _obj._fabric_shape;
      }
      _obj.shape = options.shape;
      options = _obj;
    }

    this.on({
      "scaling": this.updateElement
    });

    this.initShape(options);
    this._fabric_shape.set({
      opacity: 0,
      originX: 'center',
      originY: 'center'
    });

    this.callSuper('initialize', [this._fabric_shape], options);
    this._setWidthHeight(options);
  },
  setShape: function setShape(el, cb) {

    el = fabric.util.object.extend({
      strokeWidthFull: this.shape.strokeWidthFull,
      strokeWidthEmpty: this.shape.strokeWidthEmpty,
      strokeWidthActive: this.shape.strokeWidthActive,
      dashArray: this.shape.dashArray,
      strokeEmpty: this.shape.strokeEmpty,
      strokeFull: this.shape.strokeFull,
      strokeActive: this.shape.strokeActive
    }, el);

    var _this = this;
    if (el && el.src && !el.paths) {
      fabric.loadSVGFromURL(el.src, function (paths, options) {
        el.paths = paths;
        fabric.util.object.extend(el, options);
        _this._set_shape(el);
        _this.add(_this._fabric_shape);
        _this._apply_shape();
        cb && cb();
      });
    } else {
      _this._set_shape(el);
      _this.add(_this._fabric_shape);
      _this._apply_shape();
      cb && cb();
    }
  },
  setElement: function setElement(element) {
    if (this.element) {
      this.remove(this.element);
    }
    if (!element) {
      return;
    }
    element.set({
      originX: 'center',
      originY: 'center'
    });
    this.add(element);
    this.element = element;
    if (this.format === 'png' || this.format === 'image/png' || this.format === 'jpeg' || this.format === 'image/jpeg') {
      this._cache = this.element._element;
    } else {
      this._init_color_array();
    }
    this.dirty = true;
    this.canvas && this.canvas.renderAll();
  },
  updateElement: function updateElement() {
    if (this.element) {
      this.element.scaleX = this.width / this.element.width;
      this.element.scaleY = this.height / this.element.height;
    }
    if (this._fabric_shape) {
      this._fabric_shape.set({
        width: this.width,
        height: this.height
      });
    }
    this.dirty = true;
  },
  _render: function _render(ctx) {
    ctx.save();
    ctx.scale(this.element.scaleX, this.element.scaleY);
    for (var i = 0, l = this.element.paths.length; i < l; ++i) {
      this.element.paths[i].render(ctx, true);
    }
    ctx.restore();
  },
  /**
   * кобъект готовится к замену фото
   */
  activate: function activate() {
    this._activated = true;
    this._fabric_shape.setOpacity(1);
    this.updateStroke();
    this.canvas.renderAll();
  },
  /**
   * кобъект не готовится к замену фото
   */
  deactivate: function deactivate() {
    this._activated = false;
    this.updateStroke();
    this.canvas.renderAll();
  },
  _init_color_array: function _init_color_array() {

    this.processing = true;
    this._colors = this.element.extractColors();

    this.colors = this.colors || {};

    for (var _color in this.colors) {
      this.setClipartColor(_color, this.colors[_color], true);
    }
  },
  setData: function setData(data) {
    this.setSrc(data.src);
  },
  setSrc: function setSrc(src) {
    var _this = this;
    fabric.PathGroup.fromURL(src, function (el) {
      _this.setElement(el);
      _this.makeActions();
      //  _this.canvas.createFloatedMenu(_this.application.objectsToolbarOptions);
    }, {
      width: this.width,
      height: this.height
    });
  },
  // render: function (ctx) {
  //   // var x = noTransform ? 0 : - this.width * this.scaleX / 2,
  //   //   y = noTransform ? 0 : - this.height * this.scaleY / 2;
  //   //
  //   // ctx.save();
  //   // ctx.translate(x,y);
  //   fabric.Group.prototype.render.apply(this,arguments)
  //   // ctx.restore();
  // },
  setClipartColor: function setClipartColor(key, value, preventCacheUpdate) {

    if (!value) {
      value = key;
      delete this.colors[key];
    } else {
      this.colors[key] = value;
    }
    var _colors = this._colors[key];
    for (var i in _colors) {
      if (_colors[i].color) {
        _colors[i].color.fill = value;
      }
      if (_colors[i].stop) {
        _colors[i].stop.color = value;
      }
    }

    this.dirty = true;
    this.canvas && this.canvas.renderAll();
  },
  getSrc: function getSrc() {
    return this.src || this.element && this.element.src;
  },
  toObject: function toObject(propertiesToInclude) {
    var obj = fabric.Object.prototype.toObject.call(this);
    fabric.util.object.extend(obj, {
      src: this.getSrc(),
      colors: this.colors
    });
    return obj;
  },
  actions: {
    source: {
      type: 'effect',
      className: 'fa fa-file-image-o',
      title: "source",
      actionParameters: function actionParameters($element, data) {
        this.application.createElementsList($element, this.application.getLibraryElements({ category: "clipart" }));
        //  data.target.application.createGallery(data.target, $el, data);
      }
    },
    colors: {
      type: 'menu',
      title: 'color menu',
      menu: function menu() {
        var _menu = [];
        for (var key in this._colors) {
          _menu.push({
            title: "Color (" + key + ")",
            value: {
              defaultValue: key,
              value: this.colors[key] || key,
              get: function (key) {
                return this.colors[key] || key;
              }.bind(this, key),
              set: this.setClipartColor.bind(this, key)
            },
            type: "color"
          });
        }
        return _menu;
      }
    }
  }
});

fabric.Clipart.async = true;

/**
 * Creates fabric.PathGroup instance from an object representation
 * @static
 * @memberOf fabric.PathGroup
 * @param {Object} object Object to create an instance from
 * @param {Function} callback Callback to invoke when an fabric.PathGroup instance is created
 */
fabric.Clipart.fromObject = function (object, callback) {
  if (typeof object.src === 'string') {
    if (object.format === 'png' || object.format === "image/png" || object.format === 'jpeg' || object.format === "image/jpeg") {
      fabric.Image.fromURL(object.src, function (el) {
        object.element = el;
        object.element.src = object.src;
        callback(new fabric.Clipart(object));
      }, {
        width: object.width || fabric.Clipart.prototype.width,
        height: object.height || fabric.Clipart.prototype.height
      });
    } else {
      fabric.PathGroup.fromURL(object.src, function (el) {
        object.element = el;
        object.element.src = object.src;
        delete object.src;
        callback(new fabric.Clipart(object));
      }, {
        width: object.width || fabric.Clipart.prototype.width,
        height: object.height || fabric.Clipart.prototype.height
      });
    }
  } else {
    return new fabric.Clipart(object);
  }
};

fabric.util.createAccessors(fabric.Clipart);

if (fabric.objectsLibrary) {
  fabric.util.object.extend(fabric.objectsLibrary, {
    clipart: {
      "width": function width(w, h) {
        var _asp = Math.min(285 / 365, w / h);
        return w;
      },
      "height": function height(w, h) {
        var _asp = Math.min(285 / 365, w / h);
        return h;
      },
      "type": "clipart",
      "src": "data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTkuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeD0iMHB4IiB5PSIwcHgiIHZpZXdCb3g9IjAgMCA1MTIgNTEyIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA1MTIgNTEyOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIgd2lkdGg9IjUxMnB4IiBoZWlnaHQ9IjUxMnB4Ij4KPGc+Cgk8cGF0aCBzdHlsZT0iZmlsbDojRkY4QzQ2OyIgZD0iTTE2My4xODksNjcuMTQ4QzEyOS42MTYsNjcuMTQ4LDEyMS4yMjIsMCw3OS4yNTUsMEM1Mi43MTMsMCwyOC44OTQsMTYuNzg3LDI4Ljg5NCw1MC4zNjEgICBzNTguNzU0LDUwLjM2MSw0MS45NjcsMTA5LjExNUwxNjMuMTg5LDY3LjE0OHoiLz4KCTxwYXRoIHN0eWxlPSJmaWxsOiNGRjhDNDY7IiBkPSJNMzQ3Ljg0NSw2Ny4xNDhDMzgxLjQxOSw2Ny4xNDgsMzg5LjgxMiwwLDQzMS43OCwwYzI2LjU0MiwwLDUwLjM2MSwxNi43ODcsNTAuMzYxLDUwLjM2MSAgIHMtNTguNzU0LDUwLjM2MS00MS45NjcsMTA5LjExNUwzNDcuODQ1LDY3LjE0OHoiLz4KPC9nPgo8Zz4KCTxwYXRoIHN0eWxlPSJmaWxsOiNGRkVCRDI7IiBkPSJNMzMxLjU0MSw0NjEuNjM5QzMzMS41NDEsNDg5LjQ1MywzMTEuNjI2LDUxMiwyNTYsNTEycy03NS41NDEtMjIuNTQ3LTc1LjU0MS01MC4zNjF2LTguMzkzaDE1MC41OTkgICBMMzMxLjU0MSw0NjEuNjM5eiIvPgoJPHBhdGggc3R5bGU9ImZpbGw6I0ZGRUJEMjsiIGQ9Ik00NTkuMzY4LDE4Mi45MWMzNC40NDYsNTYuMzAzLDQwLjA0MiwxMDIuNDY3LDQwLjA0MiwxMDIuNDY3aC0xNi43ODcgICBjMCwwLDE2Ljc4Nyw0MS40NDMsMTYuNzg3LDY3LjE0OGwtMjUuMTgtOC4zOTNjMCwwLDE2Ljc4NywzNy43NywxNi43ODcsNjcuMTQ4YzAsMC41MjUtMjUuMTgtOC4zOTMtMjUuMTgtOC4zOTMgICBzMTIuNTksMjguMzI4LDguMzkzLDQxLjk2N2MtMC4xNTQsMC41MDEtMjUuMTgtOC4zOTMtMjUuMTgtOC4zOTNzNy4zNDQsMTkuNTg1LDAsMzMuNTc0bC00MS45NjctMTYuNzg3ICAgYzAsMC03Ljg0NiwyNS42ODEtOC4zOTMsMjUuMThjLTE4LjM2MS0xNi43ODctNDEuOTY3LTI1LjE4LTQxLjk2Ny0yNS4xOEgxNTUuMjc5YzAsMC0yMy42MDcsOC4zOTMtNDEuOTY3LDI1LjE4ICAgYy0wLjU0OCwwLjUtOC4zOTMtMjUuMTgtOC4zOTMtMjUuMThsLTQxLjk2NywxNi43ODdjLTcuMzQ0LTEzLjk4OSwwLTMzLjU3NCwwLTMzLjU3NHMtMjUuMDI2LDguODk1LTI1LjE4LDguMzkzICAgYy00LjE5Ny0xMy42MzksOC4zOTMtNDEuOTY3LDguMzkzLTQxLjk2N3MtMjUuMTgsOC45MTgtMjUuMTgsOC4zOTNjMC0yOS4zNzcsMTYuNzg3LTY3LjE0OCwxNi43ODctNjcuMTQ4bC0yNS4xOCw4LjM5MyAgIGMwLTI1LjcwNSwxNi43ODctNjcuMTQ4LDE2Ljc4Ny02Ny4xNDhIMTIuNTljMCwwLDUuNTk1LTQ2LjE2NCw0MC4wNDItMTAyLjQ2N0g0NTkuMzY4eiIvPgo8L2c+CjxlbGxpcHNlIHN0eWxlPSJmaWxsOiNGRkE1NEI7IiBjeD0iMjU1LjUxNyIgY3k9IjIzMC44MiIgcng9IjIwOS44MzYiIHJ5PSIxOTcuMjQ2Ii8+CjxnPgoJCgkJPGVsbGlwc2UgdHJhbnNmb3JtPSJtYXRyaXgoLTAuNjA0MiAtMC43OTY4IDAuNzk2OCAtMC42MDQyIDYzLjk0NzUgNDk5Ljg5MjYpIiBzdHlsZT0iZmlsbDojRkZFQkQyOyIgY3g9IjE1Ni4xMjMiIGN5PSIyMzQuMDY1IiByeD0iMzcuNzY5IiByeT0iNDYuMTYzIi8+CgkKCQk8ZWxsaXBzZSB0cmFuc2Zvcm09Im1hdHJpeCgtMC42MDQyIDAuNzk2OCAtMC43OTY4IC0wLjYwNDIgNzU1LjkyMDQgOTIuNzAzMSkiIHN0eWxlPSJmaWxsOiNGRkVCRDI7IiBjeD0iMzU0LjkzNyIgY3k9IjIzNC4wODYiIHJ4PSIzNy43NjkiIHJ5PSI0Ni4xNjMiLz4KPC9nPgo8cGF0aCBzdHlsZT0iZmlsbDojRkY4QzQ2OyIgZD0iTTI1NS41MjQsMjYwLjE5N2gtMC4wMTNjLTI4LjcxMSwwLTU1LjA0NSwxOC4yNjgtNjguNTM2LDQ3LjUxMSAgYy0xOC4xNjMsMzkuMzc0LTQwLjU3Myw5MS45OTYtNDAuNTczLDExMS45NjRoMjE4LjIyOWMwLTE5Ljk2Ny0yMi40MDktNzIuNTktNDAuNTczLTExMS45NjQgIEMzMTAuNTY5LDI3OC40NjQsMjg0LjIzNCwyNjAuMTk3LDI1NS41MjQsMjYwLjE5N3oiLz4KPHBhdGggc3R5bGU9ImZpbGw6I0ZGREVCNzsiIGQ9Ik0zMDQuNzk1LDM2OS4zMTFjLTE5LjM5MywwLTM2Ljg1NSw2LTQ5LjI3OCwxNS41ODhjLTEyLjQyMi05LjU4OC0yOS44ODUtMTUuNTg4LTQ5LjI3OC0xNS41ODggIGMtMzcuNjgyLDAtNjguMjMsMjIuNTQ3LTY4LjIzLDUwLjM2MXMzMC41NDgsNTAuMzYxLDY4LjIzLDUwLjM2MWMxNS43MjgsMCwzMC4xODctMy45NDcsNDEuNzE2LTEwLjU1NCAgYzQuNzY0LTIuNzMsMTAuMzU3LTIuNzMsMTUuMTIyLDBjMTEuNTI5LDYuNjA3LDI1Ljk4OCwxMC41NTQsNDEuNzE2LDEwLjU1NGMzNy42ODIsMCw2OC4yMy0yMi41NDcsNjguMjMtNTAuMzYxICBTMzQyLjQ3OCwzNjkuMzExLDMwNC43OTUsMzY5LjMxMXoiLz4KPGc+Cgk8cGF0aCBzdHlsZT0iZmlsbDojNDY0NjU1OyIgZD0iTTIxNS4zNDQsMzc0Ljk5MWwzMy40OCw0NC4yMzJjMy4zNTgsNC40MzcsMTAuMDI2LDQuNDM3LDEzLjM4NCwwbDMzLjQ4LTQ0LjIzMiAgIGM0LjE4NC01LjUyOCwwLjI0MS0xMy40NTktNi42OTMtMTMuNDU5aC00LjVjLTIuNTIsMC01LjAyNiwwLjM3OC03LjQzMiwxLjEyMmwtMTQuMTE2LDQuMzYxYy00Ljg0MiwxLjQ5Ni0xMC4wMjMsMS40OTYtMTQuODY1LDAgICBsLTE0LjExNi00LjM2MWMtMi40MDgtMC43NDQtNC45MTMtMS4xMjItNy40MzItMS4xMjJoLTQuNDk5QzIxNS4xMDMsMzYxLjUzMiwyMTEuMTYsMzY5LjQ2MywyMTUuMzQ0LDM3NC45OTF6Ii8+Cgk8Y2lyY2xlIHN0eWxlPSJmaWxsOiM0NjQ2NTU7IiBjeD0iMTU0Ljc5NiIgY3k9IjIzNS4wMTYiIHI9IjE2Ljc4NyIvPgoJPGNpcmNsZSBzdHlsZT0iZmlsbDojNDY0NjU1OyIgY3g9IjM1Ni4yMzkiIGN5PSIyMzUuMDE2IiByPSIxNi43ODciLz4KCTxwYXRoIHN0eWxlPSJmaWxsOiM0NjQ2NTU7IiBkPSJNNzcuMzU4LDMzNS4wMDFsNDYuMjA2LTM3LjgwNWM0LjAxMi0zLjI4MywxLjEyMy05Ljc2MS00LjAwMS04Ljk2OWwtNjEuNDc4LDkuNSAgIEM2My4xMjMsMzEwLjg2LDY5LjYxOCwzMjMuMzMxLDc3LjM1OCwzMzUuMDAxeiIvPgoJPHBhdGggc3R5bGU9ImZpbGw6IzQ2NDY1NTsiIGQ9Ik0xMjEuNDkzLDM4Mi41NzdsMjUuMDUyLTY2LjgwN2MxLjkyMi01LjEyNS00LjQ5NC05LjI1Ni04LjM2NC01LjM4NWwtNDUuMTgzLDQ1LjE4MyAgIEMxMDEuNTU1LDM2NS40MDYsMTExLjA5OCwzNzQuNDU1LDEyMS40OTMsMzgyLjU3N3oiLz4KCTxwYXRoIHN0eWxlPSJmaWxsOiM0NjQ2NTU7IiBkPSJNMjI2LjQwNSwxMDkuMTQ5bC02LjYzMy03Mi42NjdjLTguMTA2LDEuMzA4LTE2LjA1MiwzLjA0NC0yMy44MTEsNS4yMDFsMjEuNTMyLDY5LjIzOSAgIEMyMTkuMTIsMTE2LjE1NywyMjYuOTAzLDExNC42MDksMjI2LjQwNSwxMDkuMTQ5eiIvPgoJPHBhdGggc3R5bGU9ImZpbGw6IzQ2NDY1NTsiIGQ9Ik0yOTEuMjYzLDM2LjQ4MmwtNi42MzMsNzIuNjY3Yy0wLjQ5OCw1LjQ2LDcuMjg0LDcuMDA3LDguOTEzLDEuNzcybDIxLjUzMi02OS4yMzkgICBDMzA3LjMxNSwzOS41MjcsMjk5LjM2OSwzNy43OSwyOTEuMjYzLDM2LjQ4MnoiLz4KCTxwYXRoIHN0eWxlPSJmaWxsOiM0NjQ2NTU7IiBkPSJNMzM3LjM4Nyw0OS4xNTZsLTIwLjUwOSw0Ny40NDljLTIuMTM3LDQuOTQ2LDQuNTQ5LDguODY4LDcuODIzLDQuNTg4bDMyLjczLTQyLjc5MSAgIEMzNTAuOTQ2LDU1LjAxLDM0NC4yNzEsNTEuOSwzMzcuMzg3LDQ5LjE1NnoiLz4KCTxwYXRoIHN0eWxlPSJmaWxsOiM0NjQ2NTU7IiBkPSJNMTk0LjE1Nyw5Ni42MDVsLTIwLjUwOS00Ny40NDljLTYuODg0LDIuNzQ1LTEzLjU1OSw1Ljg1My0yMC4wNDQsOS4yNDdsMzIuNzMsNDIuNzkgICBDMTg5LjYwOCwxMDUuNDczLDE5Ni4yOTUsMTAxLjU1MSwxOTQuMTU3LDk2LjYwNXoiLz4KCTxwYXRoIHN0eWxlPSJmaWxsOiM0NjQ2NTU7IiBkPSJNMjcyLjIyNCwzNC4yNTNjLTUuNTE4LTAuNDA4LTExLjA3Ny0wLjY3OS0xNi43MDctMC42NzljLTUuNjMsMC0xMS4xODksMC4yNzEtMTYuNzA3LDAuNjc5ICAgbDEyLjE2OSwxMDMuNDRjMC42MzMsNS4zOCw4LjQ0Miw1LjM4LDkuMDc1LDBMMjcyLjIyNCwzNC4yNTN6Ii8+Cgk8cGF0aCBzdHlsZT0iZmlsbDojNDY0NjU1OyIgZD0iTTQzNC44NjgsMzM1LjAwMWwtNDYuMjA2LTM3LjgwNWMtNC4wMTItMy4yODMtMS4xMjMtOS43NjEsNC4wMDEtOC45NjlsNjEuNDc4LDkuNSAgIEM0NDkuMTA0LDMxMC44Niw0NDIuNjA4LDMyMy4zMzEsNDM0Ljg2OCwzMzUuMDAxeiIvPgoJPHBhdGggc3R5bGU9ImZpbGw6IzQ2NDY1NTsiIGQ9Ik0zOTAuNzMzLDM4Mi41NzdsLTI1LjA1Mi02Ni44MDdjLTEuOTIyLTUuMTI1LDQuNDk0LTkuMjU2LDguMzY0LTUuMzg1bDQ1LjE4Myw0NS4xODMgICBDNDEwLjY3MSwzNjUuNDA2LDQwMS4xMjksMzc0LjQ1NSwzOTAuNzMzLDM4Mi41Nzd6Ii8+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPC9zdmc+Cg=="
    }
  });
}
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 76 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.CacheMixin = {
  caching: true,
  dirty: true,
  render: function render(ctx) {

    ctx.save();
    if (this.transformMatrix) {
      ctx.transform.apply(ctx, this.transformMatrix);
    }
    this.transform(ctx);

    this._setShadow(ctx);
    this.clipTo && fabric.util.clipContext(this, ctx);

    ctx.translate(-this.width / 2, -this.height / 2);

    if (this.caching) {
      if (this.dirty) {

        if (!this._cache) {
          this._cache = fabric.util.createCanvasElementWithSize(this);
        }

        if (this.element) {
          this._cache.width = this.width;
          this._cache.height = this.height;
          var cacheCtx = this._cache.getContext("2d");
          cacheCtx.clearRect(0, 0, this._cache.width, this._cache.height);
          this._render(cacheCtx);
          this.dirty = false;
        } else {
          this._cache = null;
          this.dirty = false;
        }
      }

      if (this._cache) {
        ctx.drawImage(this._cache, 0, 0, this.width, this.height, 0, 0, this.width, this.height);
      }
    } else {
      this._render(ctx);
    }

    this.clipTo && ctx.restore();
    ctx.restore();
  }

};
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 77 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.util.object.extend(fabric.PathGroup.prototype, {
  cloneSync: function cloneSync() {

    return new fabric.PathGroup.fromElements(this.paths, this);

    // fabric.util.enlivenObjects(object.objects, function (enlivenedObjects) {
    //   delete object.objects;
    //   callback && callback(new fabric.Group(enlivenedObjects, object, true));
    // });
  },
  initialize_overwritten: fabric.PathGroup.prototype.initialize,
  initialize: function initialize(paths, options) {

    if (paths.constructor != Array) {
      options = paths.toObject();
      delete options.paths;
      paths = paths.paths;
    }

    this.initialize_overwritten(paths, options);
  },
  extractColors: function extractColors() {
    var _colors = {};
    var _paths = this.paths;
    for (var i in _paths) {
      if (_paths[i].fill.type) {
        for (var j in _paths[i].fill.colorStops) {
          var _color = _paths[i].fill.colorStops[j].color;
          if (!_colors[_color]) _colors[_color] = [];
          _colors[_color].push({ object: _paths[i], stop: _paths[i].fill.colorStops[j] });
        }
      } else {
        var _color = _paths[i].fill;
        if (!_colors[_color]) _colors[_color] = [];
        _colors[_color].push({ object: _paths[i], color: _paths[i] });
      }
    }
    return _colors;
  }
});

fabric.PathGroup.fromElements = function (elements, object, url) {
  var _options = {
    toBeParsed: true
    //originX: "center",
    //originY: "center"
  };

  //смещаем элементы так, чтобы их кооринаты начинались от 0.0
  if (elements.length) {
    var minX = Infinity,
        minY = Infinity;
    for (var i in elements) {
      minX = Math.min(elements[i].left, minX);
      minY = Math.min(elements[i].top, minY);
    }
    minX = Math.max(minX, 0);
    minY = Math.max(minY, 0);
    /* for (var i in elements) {
     elements[i].translate(-minX, -minY);
     elements[i].left -= minX;
     elements[i].pathOffset.x -= minX;
     elements[i].top -= minY;
     elements[i].pathOffset.y -= minY;
     }*/
  }

  var el = fabric.util.groupSVGElements(elements, _options, url);

  if (!object.scaleX && !object.scaleY) {
    var scaleX = object.width ? object.width / el.width : null,
        scaleY = object.height ? object.height / el.height : null;
    if (scaleX && !scaleY) {
      scaleY = scaleX;
    }
    if (scaleY && !scaleX) {
      scaleX = scaleY;
    }
    if (!scaleY && !scaleX) {
      scaleX = scaleY = 1;
    }

    delete object.height;
    delete object.width;
    fabric.util.object.extend(object, {
      //left: 0, top: 0,
      scaleX: scaleX,
      scaleY: scaleY
    });
  }
  el.set(object);

  el.setLeft(object.left);
  el.setTop(object.top);

  return el;
};

// fabric.PathGroup.prototype.render = function(ctx,noTransform) {
//   if (!this.visible) {
//     return;
//   }
//   var x = noTransform ? 0 : - this.width * this.scaleX / 2,
//     y = noTransform ? 0 : - this.height * this.scaleY / 2;
//
//   ctx.save();
//   ctx.translate(x,y);
//
//   if (this.transformMatrix) {
//     ctx.transform.apply(ctx, this.transformMatrix);
//   }
//   this.transform(ctx);
//
//   this._setShadow(ctx);
//   this.clipTo && fabric.util.clipContext(this, ctx);
//   ctx.translate(-this.width/2, -this.height/2);
//   for (var i = 0, l = this.paths.length; i < l; ++i) {
//     this.paths[i].render(ctx, true);
//   }
//   this.clipTo && ctx.restore();
//   ctx.restore();
// }


fabric.PathGroup.fromURL = function (url, callback, object) {

  fabric.loadSVGFromURL(url, function (els) {

    var el = new fabric.PathGroup(els, { toBeParsed: true });

    // //смещаем элементы так, чтобы их кооринаты начинались от 0.0
    // if (el.paths.length) {
    //
    //   var minX = Infinity,
    //     minY = Infinity;
    //   var maxX = -Infinity,
    //     maxY = -Infinity;
    //
    //   for (var i in el.paths) {
    //     var _p = el.paths[i];
    //     minX = Math.min(_p.left, minX);
    //     minY = Math.min(_p.top, minY);
    //     maxX = Math.max(_p.left + _p.width, maxX);
    //     maxY = Math.max(_p.top + _p.height, maxY);
    //   }
    //
    //   var _W = maxX - minX;
    //   var _H = maxY - minY;
    //   //
    //   //
    //   // minX = Math.max(minX, 0);
    //   // minY = Math.max(minY, 0);
    //   /* for (var i in elements) {
    //    elements[i].translate(-minX, -minY);
    //    elements[i].left -= minX;
    //    elements[i].pathOffset.x -= minX;
    //    elements[i].top -= minY;
    //    elements[i].pathOffset.y -= minY;
    //    }*/
    // }else{
    //   _W = 1;
    //   _H = 1;
    // }

    var scaleX = object.width ? object.width / el.width : null,
        scaleY = object.height ? object.height / el.height : null;
    if (scaleX && !scaleY) {
      scaleY = scaleX;
    }
    if (scaleY && !scaleX) {
      scaleX = scaleY;
    }
    if (!scaleY && !scaleX) {
      scaleX = scaleY = 1;
    }
    // console.log(object.width,el.width,object.height,el.height)
    // console.log(el);
    el.set({
      scaleX: scaleX,
      scaleY: scaleY
    });

    callback(el);
  });

  // fabric.loadSVGFromURL(url,function(els){
  //   callback(fabric.PathGroup.fromElements(els, object));
  // });
};
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 78 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

var _set_object_scale_overwritten = fabric.Canvas.prototype._setObjectScale;
var _setup_current_transform = fabric.Canvas.prototype._setupCurrentTransform;

fabric.util.object.extend(fabric.Canvas.prototype, {
  _setupCurrentScaleTransform: _setup_current_transform,
  _setupCurrentTransform: function _setupCurrentTransform(e, target) {
    if (!target) return;
    if (target.setupCurrentTransform) {
      return target.setupCurrentTransform(e);
    } else {
      if (target.resizable) {
        return this._setupCurrentResizeTransform(e, target);
      } else {
        return this._setupCurrentScaleTransform.call(this, e, target);
      }
    }
  },
  _setObjectScale: function _setObjectScale(localMouse, transform, lockScalingX, lockScalingY, by, lockScalingFlip, _dim) {

    var t = transform.target;

    if (!_dim) {
      var strokeWidth = t.stroke ? t.strokeWidth : 0;
      _dim = {
        x: t.width + strokeWidth / 2,
        y: t.height + strokeWidth / 2
      };
    }

    if (t.setObjectScale) {
      return t.setObjectScale(localMouse, transform, lockScalingX, lockScalingY, by, lockScalingFlip, _dim);
    } else {
      if (t.resizable) {
        return this._setObjectSize(localMouse, transform, lockScalingX, lockScalingY, by, lockScalingFlip, _dim);
      } else {
        return _set_object_scale_overwritten.call(this, localMouse, transform, lockScalingX, lockScalingY, by, lockScalingFlip, _dim);
      }
    }
  },
  _setObjectSize: function _setObjectSize(localMouse, transform, lockScalingX, lockScalingY, by, lockScalingFlip, _dim) {

    var target = transform.target,
        forbidScalingX = false,
        forbidScalingY = false;
    var _stroke = transform.target.strokeWidth || 0;
    transform.newWidth = this.width * (localMouse.x / transform.scaleX / (this.width + _stroke));
    transform.newHeight = this.height * (localMouse.y / transform.scaleY / (this.height + _stroke));

    if (this.wholeCoordinates || target.wholeCoordinates) {
      transform.newWidth = Math.round(transform.newWidth);
      transform.newHeight = Math.round(transform.newHeight);
    }
    if (transform.newHeight < 0) {
      target.top = transform.top - transform.newHeight;
    }
    if (target.minWidth && transform.newWidth <= target.minWidth) {
      transform.newWidth = target.minWidth;
    }
    if (target.minHeight && transform.newHeight <= target.minHeight) {
      transform.newHeight = target.minHeight;
    }
    if (lockScalingFlip && transform.newWidth < target.width) {
      forbidScalingX = true;
    }
    if (lockScalingFlip && transform.newHeight < target.height) {
      forbidScalingY = true;
    }

    if (by === 'equally') {
      forbidScalingX || forbidScalingY || this._resizeObjectEqually(localMouse, target, transform, _dim);
    } else if (!by) {
      forbidScalingX || target.setWidth(transform.newWidth);
      forbidScalingY || target.setHeight(transform.newHeight);
    } else if (by === 'x' && !target.get('lockUniScaling')) {
      forbidScalingX || target.setWidth(transform.newWidth);
    } else if (by === 'y' && !target.get('lockUniScaling')) {
      forbidScalingY || target.setHeight(transform.newHeight);
    }
    return !forbidScalingX && !forbidScalingY;
    //transform.newWidth -= _stroke;
    //transform.newHeight -= _stroke;
  },
  _setupCurrentResizeTransform: function _setupCurrentResizeTransform(e, target) {
    this._setupCurrentScaleTransform(e, target);
    this._currentTransform.original.height = target.height;
    this._currentTransform.original.width = target.width;
  },
  _resizeObjectEqually: function _resizeObjectEqually(localMouse, target, transform, _dim) {

    var dist = localMouse.y + localMouse.x,
        lastDist = _dim.y * transform.original.height / target.height + _dim.x * transform.original.width / target.width;

    transform.newWidth = transform.original.width * dist / lastDist;
    transform.newHeight = transform.original.height * dist / lastDist;

    var ratio = transform.original.height / transform.original.width;
    if (ratio > 1) {
      if (target.minWidth && transform.newWidth <= target.minWidth) {
        transform.newWidth = target.minWidth;
        transform.newHeight = target.minHeight * ratio;
      }
    } else {
      if (target.minHeight && transform.newHeight <= target.minHeight) {
        transform.newHeight = target.minHeight;
        transform.newWidth = target.minWidth / ratio;
      }
    }

    target.setWidth(transform.newWidth);
    target.setHeight(transform.newHeight);
  }
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 79 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

if (!fabric.Frame) {
  __webpack_require__(80);
}
if (!fabric.Object.prototype._initClipping) {
  __webpack_require__(10);
}

//fabric.DPI todo why do not use it?
/**
* @author Denis Ponomarev
* @email den.ponomarev@gmail.com
*/

fabric.Photo = fabric.util.createClass(fabric.Frame, {
  type: 'photo',
  frameTool: false,
  imageTools: false,
  filterTool: false,
  stateProperties: fabric.Frame.prototype.stateProperties.concat(["frame"]),
  _scaling_events_enabled: true,

  cloneSync: function cloneSync(options) {
    var _frame = new fabric.Photo(this);
    options && _frame.set(options);
    return _frame;
  },
  initialize: function initialize(options) {

    options || (options = {});
    this.callSuper('initialize', options);

    this.dpi = 0;
    this._create_sign();
    this._set_border(options.border, "border");
    this._set_border(options.border2, "border2");
    this._set_frame(options.frame);

    this.on({
      "added": function added() {
        this._check_dpi();
      },
      "scaling": function scaling() {
        this._apply_frame();
        this._update_frame();
        this._check_dpi();
      },
      "clipping:entered": function clippingEntered() {
        if (this._fabric_frame) {
          if (this.frame.position !== "back") {
            this._restoreObjectState(this._fabric_frame);
            this.remove(this._fabric_frame);
            this.canvas.add(this._fabric_frame);
          }
        }
      },
      "clipping:exited": function clippingExited() {
        if (this._fabric_frame) {
          if (this.frame.position !== "back") {
            this.canvas.remove(this._fabric_frame);
            this.add(this._fabric_frame);
            this._apply_frame();
            this.canvas.renderAll();
          }
        }
      }
    });
  },

  _apply_frame: function _apply_frame() {
    this._fabric_frame && this._fabric_frame.set({
      left: 0,
      top: 0,
      width: this.width,
      height: this.height
    });
  },
  _create_sign: function _create_sign() {

    this._fabric_sign = new fabric.Text("", {
      fill: "yellow",
      stroke: "black",
      evented: false,
      visible: false,
      height: 20,
      fontSize: 24,
      fontFamily: "FontAwesome",
      left: this.width / 2 - 30,
      top: this.height / 2 - 35,
      textAlign: "center"
    });
    this._elements_to_update.push({
      element: this._fabric_sign,
      bottom: 35,
      right: 30
    });

    this._fabric_sign_text = new fabric.Text(Math.floor(this.dpi).toString(), {
      fill: "yellow",
      evented: false,
      visible: false,
      height: 5,
      fontSize: 10,
      left: this.width / 2 - 27,
      top: this.height / 2 - 12,
      textAlign: "center"
    });

    this._elements_to_update.push({
      element: this._fabric_sign_text,
      bottom: 12,
      right: 27
    });
    this.add(this._fabric_sign);
    this.add(this._fabric_sign_text);
  },
  _check_dpi: function _check_dpi() {
    //this.dpi_warning = true;
    this.dpi = this.getDPI();
    if (!this.canvas) return; //todo

    if (this.canvas.dpi && this.dpi < this.canvas.dpi) {
      this._fabric_sign.setVisible(true);
      this._fabric_sign_text.setVisible(true);
      this._fabric_sign_text.setText(Math.floor(this.dpi).toString());
      //this.slide.dpi_warning = true;
    } else {

      this._fabric_sign.setVisible(false);
      this._fabric_sign_text.setVisible(false);
      //if(!this._fabric_sign)return;
      //this.remove(this._fabric_sign);
      //delete this._fabric_sign;
      //this.slide.dpi_warning = this.slide.checkDPI();
    }
  },
  getDPI: function getDPI() {

    return;
    if (!this._original) return this.canvas.dpi;

    var INCH = 25.4; //mm

    var dims = [];

    dims.push(this._original.width / (this.width / INCH));
    dims.push(this._original.height / (this.height / INCH));

    var _dpi = dims[0];

    for (var i = 1; i < dims.length; i++) {
      if (dims[i] < _dpi) {
        _dpi = dims[i];
      }
    }
    this.dpi = _dpi * 1; ///this.canvas.scaleX;

    return _dpi;
  },
  supportedTypes: ["image"],

  _set_element: function _set_element(options, callback) {

    if (options.type == "image") {
      this._original = options.original;
      fabric.Image.fromURL((fabric.framesPath || "") + options.src, function (o) {
        o.on("rotating", fabric.util.stepRotating.bind(o));

        this._check_dpi();

        callback(o);
      }.bind(this));
    }
  },

  /**
   * ��������� �����
   * @param data - ����� �����
   */
  _set_border: function _set_border(border, name) {
    this[name] = border;
    if (!border) return;
    this["_fabric" + name] = new fabric.Path(this._fabric_shape.path, fabric.util.object.extend({
      fill: "transparent",
      selectable: false,
      originX: "center",
      originY: "center"
    }, border));

    this.add(this["_fabric" + name]);
    if (border.position == "before") {
      this._objects.unshift(this._objects.pop());
    }

    var options = {
      left: this._fabric_shape.left + this.width / 2,
      top: this._fabric_shape.top + this.height / 2,
      scaleX: this._fabric_shape.scaleX * (border.scaleX || 1),
      scaleY: this._fabric_shape.scaleY * (border.scaleY || 1)
    };

    this["_fabric" + name].set(options);
  },
  setFrame: function setFrame(frame, cb) {

    if (frame && frame.constructor == String) {
      frame = this.frames[frame];
    }

    var _this = this;
    if (frame && frame.src) {

      fabric.util.loadImage(frame.src, function (img) {
        frame.image = img;
        _this._set_frame(frame);
        _this.canvas && _this.canvas.renderAll();
        cb && cb();
      });
    } else {
      _this._set_frame(frame);
      _this.canvas && _this.canvas.renderAll();
      cb && cb();
    }
  },
  _update_frame: function _update_frame() {
    if (this.frame && this.frame.image && this.frame.slice) {
      var _canvas = this._fabric_frame._element;
      _canvas.width = this.width;
      _canvas.height = this.height;
      fabric.util.drawBorderImage(_canvas, this.frame.image, this.frame);
    }
  },
  _set_frame: function _set_frame(frame) {
    if (this._fabric_frame) {
      this.remove(this._fabric_frame);
      delete this._fabric_frame;
    }
    if (frame && frame.image) {

      //
      //if (!frame["border_image"]) {
      //    img.width = this.width;
      //    img.height = this.height;
      //}

      if (frame.width && frame.slice) {

        //Canvas for NodeJS
        var canvas = typeof Canvas !== 'undefined' && new Canvas() || document.createElement("canvas");

        canvas.width = this.width;
        canvas.height = this.height;
        fabric.util.drawBorderImage(canvas, frame.image, frame);
        //todo
        //var _src = canvas.toDataURL();
        //var image = new Image();
        //image.src = _src;
        this._fabric_frame = new fabric.Image(canvas);
        //
        //this._fabric_frame.width = this.width;
        //this._fabric_frame.height = this.height;

        //this.add(this._fabric_frame);
      } else {
        this._fabric_frame = new fabric.Image(frame.image);
      }

      this._fabric_frame.set({
        originX: "center",
        originY: "center",
        hasControls: false,
        evented: false
      });

      this.add(this._fabric_frame);
      if (this.frame && this.frame.position == "back") {
        this._fabric_frame.sendToBack();
      }
      this._apply_frame();
    }
    this.frame = frame;
  },

  /**
   * �������� �������� �����
   * @private
   */
  _create_frame: function _create_frame() {

    if (this.frame) {
      this.frame.width = this._fabric_image.width;
      this.frame.height = this._fabric_image.height;
    }

    this._fabric_frame = new fabric.Image(this.frame, {
      originX: "center",
      originY: "center",
      perPixelTargetFind: true,
      width: this.data.geometry.width,
      height: this.data.geometry.height
    });
  },
  toObject: function toObject(propertiesToInclude) {
    var object = this.callSuper('toObject', propertiesToInclude);
    delete object.element;

    if (this.element) {
      var _obj2 = this.element.toObject();
      object.src = _obj2.src;
      object.filters = _obj2.filters;
    }
    object.frame = fabric.util.object.extend({}, this.frame);

    delete object.frame.image;
    return object;
  },
  insertPhotoFrames: false,
  insertPhotoFilters: false
});

// fabric.Photo.framesManager = {
//   activeObject: null,
//   show: function(object){
//     this.activeObject = object;
//     this.fire('show',object);
//   }
// };
// fabric.util.observable(fabric.Photo.framesManager);
//
// var _OBJ_ACT = fabric.Object.prototype.actions;
// var _PHO = fabric.Photo.prototype;


fabric.util.object.extend(fabric.Photo.prototype, {
  getFramesData: function getFramesData() {
    var _filters = fabric.Photo.getFramesList(this);
    for (var i in this.frames) {
      var _f = fabric.util.object.findWhere(_filters, { type: fabric.util.string.capitalize(this.frames[i].type) });
      if (_f) {
        _f.enabled = true;
      }
    }
    return _filters;
  },
  availableFrames: ["clipPath"],
  insertPhotoFrames: false,
  actions: fabric.util.object.extend(fabric.Photo.prototype.actions || {}, {
    photoFilters: {
      title: "фильтр",
      className: "fa fa-filter",
      action: function action() {
        fabric.Image.filterManager.show(this.element);
      }
    },
    removeWhiteFromBorders: fabric.util.object.extend({}, fabric.Image.prototype.actions.removeWhiteFromBorders, {
      target: function target() {
        return this.element;
      }
    }),
    revertChanges: fabric.util.object.extend({}, fabric.Image.prototype.actions.revertChanges, {
      target: function target() {
        return this.element;
      }
    }),
    photoFrames: {
      title: "рамочки",
      className: "fa fa-heart-o",
      type: "select",
      templateSelection: function templateSelection(state, container) {
        if (state.any) {
          return state.text;
        }
        return $('<span><span class="color-span" style="background-color:' + state.text + '"></span>' + state.text + '</span>');
      },
      templateResult: function templateResult(state, container, data) {
        var $el = $('<span>' + state.text + '</span>');
        if (state.id != "none") {
          /* var $canvas = $('<canvas>');
          fabric.util.drawFilter($canvas[0], data.target.src, state.id, {
            height: 22
          });
          $el.prepend($canvas);*/
        }
        return $el;
      },
      value: {
        set: function set(val, framesData) {
          console.log(val, framesData);
          var options = false;
          if (val == "none") {
            val = false;
          } else {
            var _f = _.findWhere(framesData, { id: val });
            _f.enabled = !_f.enabled;
            for (var i in _f.options) {
              if ($.isNumeric(_f.options[i])) {
                _f.options[i] = parseFloat(_f.options[i]);
              }
            }
            if (_f.enabled) {
              options = {};
              for (var i in _f.options) {
                options[i] = _f.options[i].value;
              }
            }
          }
          this.setFrame(val);
        },
        get: function get() {
          return this.frame ? this.frame.id || "custom" : "none";
        },
        options: function options() {

          var _frames = this.getFramesData();
          return [{
            id: 'none',
            text: 'original',
            enabled: !this.frame
          }].concat(_frames);
        }
      }
    }
  })
});

fabric.Photo.fromObject = function (object, callback) {
  var _klass = this;
  var _app = object.application;
  delete object.application;
  object = fabric.util.object.cloneDeep(object);
  object.application = _app;

  if (object.src) {
    object.element = {
      type: "image",
      src: object.src,
      filters: object.filters
    };

    delete object.src;
    delete object.filters;
  }

  var cb = fabric.util.queueLoad(3, function () {
    callback && callback(new _klass(object));
  });

  if (object.element) {
    fabric.util.createObject(object.element, function (el) {
      object.element = el;
      cb();
    });
  } else {
    cb();
  }

  if (object.frame && object.frame.src) {

    fabric.util.loadImage(object.frame.src, function (img) {
      object.frame.image = img;
      cb();
    });
  } else {
    cb();
  }

  if (object.shape && object.shape.src) {
    fabric.loadSVGFromURL(object.shape.src, function (paths, options) {
      object.shape.paths = paths;
      fabric.util.object.extend(object.shape, options);
      cb();
    });
  } else {
    cb();
  }
};

fabric.Photo.getFramesList = function (el) {

  el = el || fabric.Photo.prototype;
  var framesList = [];
  _.forEach(el.availableFrames, function (frameId) {
    var _data = fabric.Photo.frames[frameId];
    framesList.push({
      text: _data.title || frameId,
      id: frameId,
      data: fabric.util.object.clone(_data)
    });
  });

  return framesList;
};

fabric.Photo.frames = {
  clipPath: {
    "title": "Сlip-path shape",
    "shape": {
      "path": "M 232.000 252.000 L 252.000 266.641 L 249.321 242.000 L 272.000 232.000 L 249.321 222.000 L 252.000 197.359 L 232.000 212.000 L 212.000 197.359 L 214.679 222.000 L 192.000 232.000 L 214.679 242.000 L 212.000 266.641 z"
    }
  }
};

/**
 * Indicates that instances of this type are async
 * @static
 * @type Boolean
 * @default
 */
fabric.Photo.async = true;

fabric.util.createAccessors(fabric.Photo);
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 80 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

if (!fabric.StrokeMixin) {
  __webpack_require__(12);
}

/**
 * @author Denis Ponomarev
 * @email den.ponomarev@gmail.com
 */
fabric.Frame = fabric.util.createClass(fabric.Group, fabric.StrokeMixin, {

  type: 'frame',
  //strokeActive:   "lightgreen",
  //stroke: "red",
  minWidth: 35,
  minHeight: 35,
  fill: "transparent",
  resizable: true,
  contentTools: false,
  //states : Empty / Full / Active
  stateProperties: fabric.Group.prototype.stateProperties.concat(["clip"]),
  optionsOrder: function () {
    var oo = fabric.Object.prototype.optionsOrder;
    oo.unshift("element", "clip");
    return oo;
  }(),
  clip: {
    left: 0,
    top: 0,
    scaleX: 1,
    scaleY: 1
  },
  clippingAvailable: function clippingAvailable() {
    return this.clipEnabled && this.element && !this._clipmode;
  },
  clipEnabled: true,
  /**
   * create clone with same image and shape as original (syncronous)
   * @param callback
   * @returns {*}
   */
  cloneSync: function cloneSync(options) {
    var _frame = new fabric.Frame(this);
    options && _frame.set(options);
    return _frame;
  },
  initialize: function initialize(options) {
    options || (options = {});

    if (options.constructor != Object) {

      var _obj = options.toObject();
      if (options.element) {
        _obj.element = options.element.cloneSync();
        _obj.element.clipTo = _obj._fabric_shape;
      }
      _obj.shape = options.shape;
      options = _obj;
    }

    this.on({
      "object:click": this._check_text_as_target_and_edit,
      "dblclick": this.toggleClipModeByClick,
      "scaling": this._apply_shape,
      "element:modified": function elementModified(event) {
        this.updateStroke();
        this._apply_shape();
      }
    });

    this.initShape(options);
    this.callSuper('initialize', [this._fabric_shape], options);
    this._elements_to_update = [];
  },
  toggleClipModeByClick: function toggleClipModeByClick(e) {
    if (this._is_clipping_available(e.e)) {
      if (!this._clipmode) {
        this.clipPhotoStart();
      } else {
        this.clipPhotoEnd();
      }
    }
  },
  _check_text_as_target_and_edit: function _check_text_as_target_and_edit(e) {
    if (this.isPossibleTarget(e.e, this.text)) {
      this.text.setOpacity(1);
      this._on_text_edit(e);
    }
  },
  clipPhotoEnd: function clipPhotoEnd() {
    this.canvas.editingObject = null;
    this.canvas.off("target:changed target:cleared", this._endFoo);

    if (this.canvas.grid) {
      this.canvas.grid.enabled = true;
    }

    //this.project.clipMode = false;


    this.canvas.remove(this.element);
    this.set({
      hasControls: false,
      evented: true,
      flipX: this.element.flipX,
      flipY: this.element.flipY
    });

    var to_radians = Math.PI / 180;
    var cosA = Math.cos(this.angle * to_radians);
    var sinA = Math.sin(this.angle * to_radians);
    var I = this.element,
        F = this;

    var _newGeometry = {
      angle: this.element.angle - this.angle,
      left: ((I.left - F.left) * cosA + (I.top - F.top) * sinA - F.width / 2) * (I.flipX ? -1 : 1),
      top: (-(I.left - F.left) * sinA + (I.top - F.top) * cosA - F.height / 2) * (I.flipY ? -1 : 1),
      flipX: false,
      flipY: false
    };

    if (this.element.originX === "center") {
      //   _newGeometry.left += this.element.width /2;
    }
    if (this.element.originY === "center") {
      //_newGeometry.top += this.element.height /2;
    }

    this.add(this.element);
    this.element.set(_newGeometry);
    //
    //
    this._clipmode = false;
    //рамку двигать нельзя
    this.set({
      hasControls: true,
      evented: true
    });
    this.canvas.remove(this._fabric_shape);
    this.add(this._fabric_shape);
    this.updateStroke();
    this._apply_shape();

    this.element.active = false;
    this.canvas.setActiveObject(this);
    this.canvas.renderAll();

    var w = this.width,
        h = this.height,
        el = this.element;

    this.clip = {
      left: el.left / w,
      top: el.top / h,
      scaleX: el.width / w,
      scaleY: el.height / h
    };

    this.fire("clipping:exited");
    this.canvas.fire('frame:clipping:exited', { target: this });
  },

  clipPhotoStart: function clipPhotoStart() {
    var _this = this;
    this._clipmode = true;
    this.updateStroke();
    this._apply_shape();
    this.canvas.discardActiveGroup();
    if (this.canvas.grid) {
      this.canvas.grid.enabled = false;
    }

    /* this.fabric.set({
     originX: "center",
     originY:  "center",
     left: this.fabric.left + this.fabric.width/2,
     top: this.fabric.top + this.fabric.height/2,
     });*/

    this.element.set({
      movementLimits: this,
      movementLimitMode: "content",
      //clipTo:         this,
      flipX: this.flipX,
      flipY: this.flipY
      //left: this.element.left* (this.flipX ? -1 : 1),
      //top:  this.element.top* (this.flipY ? -1 : 1)
    });

    this._restoreObjectState(this.element);
    this.element.set({
      hasControls: true,
      //selectable: false,
      //perPixelTargetFind: true,
      selectable: true,
      perPixelTargetFind: false
    });
    this.remove(this.element);
    this.canvas.add(this.element);

    this._restoreObjectState(this._fabric_shape);
    this.remove(this._fabric_shape);
    this.canvas.add(this._fabric_shape);

    //рамка должна рисоваться над картинкой, иначе  некрасиво
    //      this.slide.canvas.bringToFront(this.fabric);

    //рамку двигать нельзя
    this.set({
      hasControls: false,
      evented: false
    });

    this.canvas.setActiveObject(this.element);
    this.active = true;

    this._endFoo = function () {
      _this.clipPhotoEnd();
    };
    this.canvas.on("target:changed target:cleared", this._endFoo);

    this.fire("clipping:entered");
    this.canvas.fire('frame:clipping:entered', { target: this });

    this.canvas.editingObject = this;
    this.canvas.renderAll();
  },
  render: function render(ctx, noTransform) {
    if (this._clipmode) {
      var _zoom = this.canvas.getZoom();
      ctx.save();
      //  this.transform(ctx);
      ctx.globalAlpha = 0.5;
      var _clip_to = this.element.clipTo;
      this.element.clipTo = null;
      this.element.render(ctx);
      ctx.scale(_zoom, _zoom);
      this.element.clipTo = _clip_to;
      this.transform(ctx);
      ctx.strokeStyle = this.borderColor;
      ctx.lineWidth = 1 / this.borderScaleFactor;
      ctx.beginPath();
      ctx.closePath();
      ctx.stroke();
      ctx.restore();
    }
    this.callSuper('render', ctx, noTransform);
  },
  //supportedTypes: "*", // * or ["image","video",...]
  clippingSupportedTypes: "*", // * or ["image","video",...]
  _is_clipping_available: function _is_clipping_available(e) {
    if (!this.clipEnabled) return false;
    if (e && this.isPossibleTarget(e, this.button)) {
      return;
    }
    return this.element && (this.clippingSupportedTypes == "*" || this.clippingSupportedTypes.indexOf(this.element.type) != -1);
  },
  _remove_element: function _remove_element() {},
  drop: function drop(data) {
    if (data.type == "frame") {
      this.setFrame(data.frame);
      this.setShape(data.shape);
    } else {
      this.setElementObject(data);
    }
  },
  droppable: {
    type: ["image", "video", "frame"]
  },
  setElementObject: function setElementObject(options, callback) {
    this._set_pending(true);
    this.fire("element:loading");
    fabric.util.createObject(options, function (el) {
      this._set_pending(false);
      this.setElementKlass(el);
      callback && callback(el);
    }.bind(this));
  },
  setElement: function setElement(el, cb) {
    if (el) {
      if (el.constructor == Object) {
        this.setElementObject(el, cb);
      } else {
        this.setElementKlass(el);
        cb && cb();
      }
    } else {
      this.setElementKlass();
      cb && cb();
    }
  },
  dropElementMethod: "cover", //resize
  /**
   * Создание элемента фото
   * @private
   */
  setElementKlass: function setElementKlass(el) {
    if (this.element === el) return;

    if (this.element) {
      this._remove_element();
      this.element.destructor && this.element.destructor();
      this.remove(this.element);
      this.canvas && this.canvas.remove(this.element);
    }
    this.element = el;

    if (el) {
      el.on("dblclick", function (e) {
        this.parent.toggleClipModeByClick(e);
      });
      el.setupState();

      if (this.dropElementMethod == "resize") {
        this.clip = {
          left: 0,
          top: 0,
          scaleX: 1,
          scaleY: 1
        };
      }

      if (this.dropElementMethod == "cover") {
        var size = fabric.util.getProportions(el, this, 'cover');
        this.clip = {
          left: 0,
          top: 0,
          scaleX: size.width / this.width,
          scaleY: size.height / this.height
        };
      }

      el.set({
        tools: ["clipEnd"],
        actions: {
          clipEnd: {
            className: "fa fa-crop",
            title: "clip end",
            action: function action() {
              this.parent.clipPhotoEnd();
            }
          }
        },
        parent: this,
        notSelectableInTheGroup: true,
        originX: "center",
        originY: "center",
        transparentCorners: false,
        resizable: true,
        clipTo: this._fabric_shape
      });

      this.add(el);

      for (var i in this._elements_to_update) {
        this.remove(this._elements_to_update[i].element);
        this.add(this._elements_to_update[i].element);
      }
      this._update_element_size();
    }

    this.fire("element:modified", { element: el });
    this.canvas && this.canvas.renderAll();
  },

  /**
   * ограничиваем перемещение фотографии внутри рамки
   * @param el
   */
  _limit_moving: function _limit_moving(data) {

    var r = this.getBoundingRect();
    var i = this.element;
    i.on("moving", function () {
      var b = {
        l: r.left + i.width * i.scaleX / 2,
        r: r.left + r.width - i.width * i.scaleX / 2,
        t: r.top + i.height * i.scaleY / 2,
        b: r.top + r.height - i.height * i.scaleY / 2
      };
      // capping logic here
      i.setLeft(Math.max(Math.min(b.l, i.left), b.r));
      i.setTop(Math.max(Math.min(b.t, i.top), b.b));
    });

    i.on("scaling", function () {
      i.set({
        width: Math.max(r.width, i.width * i.scaleX),
        height: Math.max(r.height, i.height * i.scaleY),
        scaleX: 1,
        scaleY: 1
      });

      var b = {
        l: r.left + i.width * i.scaleX / 2,
        r: r.left + r.width - i.width * i.scaleX / 2,
        t: r.top + i.height * i.scaleY / 2,
        b: r.top + r.height - i.height * i.scaleY / 2
      };
      //// capping logic here
      //i.setLeft(Math.min(Math.max(b.l, i.left),b.r));
      //i.setTop(Math.min(Math.max(b.t, i.top),b.b));
    });
  },

  _set_pending: function _set_pending(val) {
    this._pending = val;
  },

  /**
   * Создание элемента фото
   * @private
   */
  _create_remove_button: function _create_remove_button(options) {

    this.button = this._create_button({
      text: "",
      options: {
        visible: false
      },
      position: {
        top: 0,
        right: 0
      }
    });

    this.button.on('click', function (e) {
      if (!this._pending) {
        this.setElement(false);
      }
    }.bind(this));
  },
  _add_element_to_update: function _add_element_to_update(data) {
    this._elements_to_update.push(data);

    if (data.right !== undefined) {
      data.element.setOriginX("right");
    }
    if (data.left !== undefined) {
      data.element.setOriginX("left");
    }
    if (data.bottom !== undefined) {
      data.element.setOriginY("bottom");
    }
    if (data.top !== undefined) {
      data.element.setOriginY("top");
    }

    this._update_interface_element_position(data.element, data);
  },
  setClip: function setClip(val) {
    this.clip = val;
    this._update_element_size();
  },
  _update_element_size: function _update_element_size() {
    this._update_element_width();
    this._update_element_height();
  },

  _update_element_width: function _update_element_width() {
    if (this.element) {
      if (this.element.type == "ellipse") {
        this.element.set({
          rx: this.width / 2 * this.clip.scaleX
        });
      } else if (this.element.type == "video" || this.element.type == "path") {

        this.element.set({
          left: 0,
          scaleX: this.width / this.element.width
        });
      } else {
        this.element.setWidth(this.width * this.clip.scaleX);
        this.element.setLeft(this.width * this.clip.left);
      }
    }
  },
  _update_element_height: function _update_element_height() {
    if (this.element) {

      if (this.element.type == "ellipse") {
        this.element.set({
          ry: this.height / 2 * this.clip.scaleY
        });
      } else if (this.element.type == "video" || this.element.type == "path") {

        this.element.set({
          top: 0,
          scaleY: this.height / this.element.height
        });
      } else {
        this.element.setHeight(this.height * this.clip.scaleY);
        this.element.setTop(this.height * this.clip.top);
      }
    }
  },
  _update_interface_element_position: function _update_interface_element_position(el, data, prop) {
    if (!prop || prop == "height") {
      if (data.top !== undefined && data.bottom !== undefined) {
        el.setTop(-this.height / 2 + data.top);
        el.setHeight(this.height - data.top - data.bottom);
      }if (data.top !== undefined) {
        el.setTop(-this.height / 2 + data.top);
      } else if (data.bottom !== undefined) {
        el.setTop(this.height / 2 - data.bottom);
      } else if (data.height !== undefined) {
        el.setHeight(data.height);
      }
    }
    if (!prop || prop == "width") {
      if (data.right !== undefined && data.left !== undefined) {
        el.setLeft(-this.width / 2 + data.left);
        el.setWidth(this.width - data.left - data.right);
      } else if (data.right !== undefined) {
        el.setLeft(this.width / 2 - data.right);
      } else if (data.left !== undefined) {
        el.setLeft(-this.width / 2 + data.left);
      } else if (data.width !== undefined) {
        el.setWidth(data.width);
      }
    }
    el.setCoords();
  },
  setHeight: function setHeight(h) {
    this.height = h;
    //this.set("height",w);
    for (var i in this._elements_to_update) {
      var data = this._elements_to_update[i];
      this._update_interface_element_position(data.element, data, "height");
    }
    this._update_element_height();
    this._apply_shape();
  },
  setWidth: function setWidth(w) {
    this.width = w;
    //this.set("width",w);
    for (var i in this._elements_to_update) {
      var data = this._elements_to_update[i];
      this._update_interface_element_position(data.element, data, "width");
    }
    this._update_element_width();
    this._apply_shape();
  },
  toObject: function toObject(propertiesToInclude) {
    propertiesToInclude = ["clip", "data"].concat(propertiesToInclude);

    var object = this.callSuper('toObject', propertiesToInclude);

    if (this.shape) {
      object.shape = _.clone(this.shape);
      if (object.shape.src) {
        delete object.shape.paths;
        delete object.shape.height;
        delete object.shape.width;
        delete object.shape.svgUid;
        delete object.shape.toBeParsed;
      }
    }

    delete object.objects;

    if (this.element) {
      var _obj2 = this.element.toObject();
      object.element = {
        type: _obj2.type,
        src: _obj2.src
      };
    }
    return object;
  },
  insertPhotoClip: false
});

var _FRA = fabric.Frame.prototype;
fabric.Frame.prototype.actions = fabric.util.object.extend({}, fabric.Object.prototype.actions, {
  clear: {
    title: "Remove content",
    className: "fa fa-times",
    action: _FRA.setElement,
    visible: "element",
    observe: "element:modified"
  },
  photoClip: {
    title: "обрезать",
    className: "fa fa-crop",
    action: _FRA.clipPhotoStart,
    visible: _FRA.clippingAvailable,
    observe: "clipping:entered clipping:exited element:modified"
  }
});

fabric.Frame.fromObject = function (object, callback) {
  object = fabric.util.object.cloneDeep(object);

  var cb = fabric.util.queueLoad(2, function () {
    callback && callback(new fabric.Frame(object));
  });

  if (object.element) {
    fabric.util.createObject(object.element, function (el) {
      object.element = el;
      cb();
    });
  } else {
    cb();
  }

  if (object.shape && object.shape.src) {
    fabric.loadSVGFromURL(object.shape.src, function (paths, options) {
      object.shape.paths = paths;
      fabric.util.object.extend(object.shape, options);
      cb();
    });
  } else {
    cb();
  }
};
fabric.Frame.async = true;

fabric.util.createAccessors(fabric.Frame);
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 81 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

var Bezier = __webpack_require__(13);
__webpack_require__(82);

fabric.Polyline = fabric.util.createClass(fabric.Object, fabric.BezierMixin, {
  type: 'polyline',
  hasRotatingPoint: false,
  stroke: "black",
  pointsLimits: false,
  hasBoundsControls: false,
  closed: false,
  cornerSize: 16,
  enderAreaSize: 4,
  extensionAreaEnabled: true,
  cornerStyle: "rect",
  maximumPoints: 4,
  points: [],
  _corner_cursors: {
    x: 'buttonCursor',
    p: 'defaultCursor',
    e: 'targetCursor'
  },
  _corner_actions: {
    x1: "add",
    x2: "remove",
    e1: "unshift",
    e2: "push"
  },
  stateProperties: ["top", "left", "width", "height", "angle", "points"],
  initialize: function initialize(options) {
    options || (options = {});
    options.points = fabric.util.object.cloneDeep(options.points);

    this.callSuper('initialize', options);

    this.on({
      "added": function added() {
        this.setCoords();
      },
      "mousedown": function mousedown(event) {
        if (this.__corner /* && this.__corner[0] == "e"*/) {
            this.canvas._transformObject(event.e);
          }
      },
      "mouseout": function mouseout(event) {
        if (this.__magnet_point || this.__magnet_coordinate) {
          delete this.__magnet_coordinate;
          delete this.__magnet_point;
          this.canvas.renderAll();
          this.setCoords();
        }
      },
      "mousemove": function mousemove(event) {
        var pointer = this.canvas.getPointer(event.e);
        if (this.__corner) {
          if (this.__corner[0] != "x") {
            this.__magnet_point = this._controls[this.__corner];
            this.setCoords();
          }
          if (this.__corner[0] == "e") {
            this.__magnet_coordinate = { x: pointer.x - this.left, y: pointer.y - this.top };
            // this.setControlPoints();
          } else if (this.__magnet_coordinate) {
            delete this.__magnet_coordinate;
          }
        } else {
          if (this.__magnet_coordinate) {
            delete this.__magnet_point;
            delete this.__magnet_coordinate;
            this.setCoords();
          }
        }
        this.canvas.renderAll();
      }
    });

    if (this.shadow) {
      this.setShadow(this.shadow);
    }
    this.setPoints(options.points);
    this.updateBbox();
  },
  _performPushAction: function _performPushAction(e, transform, pointer) {
    delete this.__magnet_coordinate;
    this.points.push({
      x: pointer.x - this.left,
      y: pointer.y - this.top
    });
    transform.action = "shape";
    transform.corner = "p" + this.points.length;
    this.canvas.setCursor(this.canvas.freeDrawingCursor);
    this.canvas.renderAll();
  },
  _performUnshiftAction: function _performUnshiftAction(e, transform, pointer) {
    delete this.__magnet_coordinate;
    this.points.unshift({
      x: pointer.x - this.left,
      y: pointer.y - this.top
    });
    transform.action = "shape";
    transform.corner = "p1";
    this.canvas.setCursor(this.canvas.freeDrawingCursor);
    this.canvas.renderAll();
  },

  drawControlsInterface: function drawControlsInterface(ctx) {
    this.drawBezierShapeControls(ctx);
    this._drawMagnetLine(ctx);
  },
  _drawMagnetLine: function _drawMagnetLine(ctx) {
    if (this.__magnet_point && this.__magnet_coordinate) {
      ctx.translate(-this.width / 2, -this.height / 2);
      ctx.beginPath();
      ctx.lineWidth = 3;
      ctx.strokeStyle = "red";
      ctx.moveTo(this.__magnet_point.x, this.__magnet_point.y);
      ctx.lineTo(this.__magnet_coordinate.x, this.__magnet_coordinate.y);
      ctx.stroke();
      ctx.beginPath();
      ctx.arc(this.__magnet_coordinate.x, this.__magnet_coordinate.y, this.cornerSize / 2, 0, Math.PI * 2, true);
      ctx.closePath();
      ctx.fill();
    }
  },
  _render: function _render(ctx, noTransform) {
    var x = noTransform ? this.left : -this.width / 2,
        y = noTransform ? this.top : -this.height / 2,
        _pc;

    ctx.save();
    ctx.translate(x, y);
    ctx.beginPath();
    ctx.moveTo(this.points[0].x, this.points[0].y);

    for (var i = 0; i < this.points.length - 1; i++) {

      if (this.points[i].curve) {
        if (!this.points[i].outline) {
          _pc = this.points[i].curve.points;
          ctx.quadraticCurveTo(_pc[1].x, _pc[1].y, _pc[2].x, _pc[2].y);
        }
      } else {
        ctx.lineTo(this.points[i + 1].x, this.points[i + 1].y);
      }
    }
    if (this.closed) {
      if (this.points[this.points.length - 1].curve) {
        _pc = this.points[i].curve.points;
        ctx.quadraticCurveTo(_pc[1].x, _pc[1].y, _pc[2].x, _pc[2].y);
      }
      ctx.closePath();
    }
    this.closed && this._renderFill(ctx);

    this._renderStroke(ctx);

    ctx.beginPath();
    for (i = 0; i < this.points.length - 1; i++) {
      if (this.points[i].outline) {
        var _ci = 0;
        while (!this.points[i].outline.curves[++_ci]._linear) {
          this.drawCurve(ctx, this.points[i].outline.curves[_ci]);
        }
        this.points[i].outline.__middle = _ci;
      }
    }
    for (i = this.points.length; i--;) {
      if (this.points[i].outline) {
        _ci = this.points[i].outline.__middle;
        while (this.points[i].outline.curves[++_ci]) {
          this.drawCurve(ctx, this.points[i].outline.curves[_ci]);
        }
      }
    }
    ctx.closePath();
    this._renderFill(ctx);
    this._renderStroke(ctx);

    ctx.restore();
  },
  merge: function merge(polyline, pIndex1, pIndex2) {
    var i,
        _x = polyline.left - this.left,
        _y = polyline.top - this.top,
        _points = this.points,
        _action,
        _PP = polyline.points;

    if (pIndex1) {
      _action = "push";
      _points.pop();
    } else {
      _action = "unshift";
      _points.shift();
    }
    var addPoint = function addPoint(main_point, reversePoint) {
      var curve_point = reversePoint && reversePoint.c;
      var new_point = {
        x: main_point.x + _x,
        y: main_point.y + _y
      };
      if (curve_point) {
        new_point.c = {
          x: curve_point.x + _x,
          y: curve_point.y + _y
        };
      }
      _points[_action](new_point);
    };
    if (pIndex2 == 0) {
      for (i = 0; i < _PP.length; i++) {
        addPoint(_PP[i], _PP[pIndex1 ? i : i - 1]);
      }
    } else {
      for (i = _PP.length; i--;) {
        addPoint(_PP[i], _PP[pIndex1 ? i - 1 : i]);
      }
    }
    polyline.remove();
    for (i = 0; i < _points.length; i++) {
      if (_points[i].c && !_points[i].curve) {
        this._makeCurve(_points[i], _points[i].c, _points[i + 1]);
      }
    }
    this.updateBbox();
    this.canvas.renderAll();
  },
  getControlPoint: function getControlPoint(id) {
    return fabric.util.object.findWhere(this._controls, { id: id });
  },
  setExtraControls: function setExtraControls(controls) {
    this.addPointsControls(controls);
    this.addExtensionAreaControls(controls);
  },
  addExtensionAreaControls: function addExtensionAreaControls(controls) {

    var pts = this.points;
    var _last = pts.length - 1;
    if (this.extensionAreaEnabled) {
      controls["e1"] = {
        action: "unshift",
        x: pts[0].x,
        y: pts[0].y,
        style: this.cornerStyle,
        area: this.enderAreaSize,
        visible: true
      };
      controls["e2"] = {
        action: "push",
        x: pts[_last].x,
        y: pts[_last].y,
        style: this.cornerStyle,
        area: this.enderAreaSize,
        visible: true
      };
    }
  },
  checkMerge: function checkMerge() {
    var target = this,
        _tlast = this.points.length - 1;
    var p1 = this.points[0],
        p2 = this.points[_tlast],
        _distance = fabric.Point.prototype.distanceFrom;
    p1 = {
      x: p1.x + this.left,
      y: p1.y + this.top
    };
    p2 = {
      x: p2.x + this.left,
      y: p2.y + this.top
    };

    var _dist = 10;

    this.canvas._objects.some(function (obj) {
      if (obj == target || obj.type !== "polyline") return false;
      var _olast = obj.points.length - 1;

      var p3 = obj.points[0];
      var p4 = obj.points[_olast];
      p3 = {
        x: p3.x + obj.left,
        y: p3.y + obj.top
      };
      p4 = {
        x: p4.x + obj.left,
        y: p4.y + obj.top
      };

      if (_distance.call(p1, p3) < _dist) {
        target.merge(obj, 0, 0);
      }
      if (_distance.call(p1, p4) < _dist) {
        target.merge(obj, 0, _olast);
      }
      if (_distance.call(p2, p3) < _dist) {
        target.merge(obj, _tlast, 0);
      }
      if (_distance.call(p2, p4) < _dist) {
        target.merge(obj, _tlast, _olast);
      }
    });
  }
});

fabric.Polyline.fromObject = function (object) {
  return new this(object);
};

fabric.util.createAccessors(fabric.Polyline);

__webpack_require__(84);

if (fabric.objectsLibrary) {
  fabric.util.object.extend(fabric.objectsLibrary, {
    shape: {
      type: "polyline",
      points: function points(w, h) {
        return [{ x: 25, y: 1 }, { x: 31, y: 18 }, { x: 49, y: 18 }, { x: 35, y: 29 }, { x: 40, y: 46 }, { x: 25, y: 36 }, { x: 10, y: 46 }, { x: 15, y: 29 }, { x: 1, y: 18 }, { x: 19, y: 18 }];
      },
      "stroke": "black",
      "fill": "blue"
    }
  });
}
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 82 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

var Bezier = __webpack_require__(13);
__webpack_require__(83);

fabric.BezierMixin = {
  curveCornerSize: 4,
  curveCornerStyle: "rect",
  outlineTop: 0,
  outlineBottom: 0,

  _renderBezier: function _renderBezier(ctx, _outline, x, y) {
    _outline = _outline || this.outline;
    ctx.beginPath();
    var _this = this;
    // ctx.save();
    // ctx.translate(this._transalate.x, this._transalate.y);
    var doc = function doc(c) {
      _this.drawCurve(ctx, c);
    };
    _outline.curves.forEach(doc);

    ctx.closePath();

    this._renderFill(ctx);
    this._renderStroke(ctx);
  },
  drawBezierControls: function drawBezierControls(ctx, p1, p2, p3, p4) {
    var pts = this.points;
    ctx.save();
    ctx.globalAlpha = this.isMoving ? this.borderOpacityWhenMoving : 1;
    ctx.strokeStyle = ctx.fillStyle = this.cornerColor;
    ctx.scale(this.canvas.viewportTransform[0], this.canvas.viewportTransform[3]);
    ctx.translate(-this.width / 2 * this.scaleX, -this.height / 2 * this.scaleY);
    ctx.beginPath();
    ctx.moveTo(p1.x * this.scaleX, p1.y * this.scaleY);
    ctx.lineTo(p2.x * this.scaleX, p2.y * this.scaleY);
    if (pts.length === 3) {
      ctx.moveTo(p2.x * this.scaleX, p2.y * this.scaleY);
      ctx.lineTo(p3.x * this.scaleX, p3.y * this.scaleY);
    } else {
      ctx.moveTo(p3.x * this.scaleX, p3.y * this.scaleY);
      ctx.lineTo(p4.x * this.scaleX, p4.y * this.scaleY);
    }
    ctx.closePath();
    ctx.stroke();
    ctx.scale(this.scaleX, this.scaleY);
    ctx.beginPath();
    this.drawCurve(ctx, p1.curve);
    ctx.stroke();
    ctx.restore();
  },
  drawCurve: function drawCurve(ctx, curve, offset) {
    offset = offset || { x: 0, y: 0 };
    var ox = offset.x;
    var oy = offset.y;
    var p = curve.points,
        i;
    //ctx.moveTo(p[0].x + ox, p[0].y + oy);
    ctx.lineTo(p[0].x + ox, p[0].y + oy);
    if (p.length === 3) {
      ctx.quadraticCurveTo(p[1].x + ox, p[1].y + oy, p[2].x + ox, p[2].y + oy);
    }
    if (p.length === 4) {
      ctx.bezierCurveTo(p[1].x + ox, p[1].y + oy, p[2].x + ox, p[2].y + oy, p[3].x + ox, p[3].y + oy);
    }
  },
  drawLine: function drawLine(ctx, p1, p2, offset) {
    offset = offset || { x: 0, y: 0 };
    var ox = offset.x;
    var oy = offset.y;
    ctx.beginPath();
    ctx.moveTo(p1.x + ox, p1.y + oy);
    ctx.lineTo(p2.x + ox, p2.y + oy);
    ctx.stroke();
  },
  drawPoint: function drawPoint(ctx, p, offset) {
    offset = offset || { x: 0, y: 0 };
    var ox = offset.x;
    var oy = offset.y;
    ctx.beginPath();
    ctx.arc(p.x + ox, p.y + oy, 5, 0, 2 * Math.PI);
    ctx.stroke();
  },
  drawPoints: function drawPoints(ctx, points, offset) {
    offset = offset || { x: 0, y: 0 };
    points.forEach(function (p) {
      this.drawCircle(ctx, p, 3, offset);
    }.bind(this));
  },
  drawArc: function drawArc(ctx, p, offset) {
    offset = offset || { x: 0, y: 0 };
    var ox = offset.x;
    var oy = offset.y;
    ctx.beginPath();
    ctx.moveTo(p.x + ox, p.y + oy);
    ctx.arc(p.x + ox, p.y + oy, p.r, p.s, p.e);
    ctx.lineTo(p.x + ox, p.y + oy);
    ctx.fill();
    ctx.stroke();
  },
  drawCircle: function drawCircle(ctx, p, r, offset) {
    offset = offset || { x: 0, y: 0 };
    var ox = offset.x;
    var oy = offset.y;
    ctx.beginPath();
    ctx.arc(p.x + ox, p.y + oy, r, 0, 2 * Math.PI);
    ctx.stroke();
  },
  drawbbox: function drawbbox(ctx, bbox, offset) {
    offset = offset || { x: 0, y: 0 };
    var ox = offset.x;
    var oy = offset.y;
    ctx.beginPath();
    ctx.moveTo(bbox.x.min + ox, bbox.y.min + oy);
    ctx.lineTo(bbox.x.min + ox, bbox.y.max + oy);
    ctx.lineTo(bbox.x.max + ox, bbox.y.max + oy);
    ctx.lineTo(bbox.x.max + ox, bbox.y.min + oy);
    ctx.closePath();
    ctx.stroke();
  },
  drawHull: function drawHull(ctx, hull, offset) {
    ctx.beginPath();
    if (hull.length === 6) {
      ctx.moveTo(hull[0].x, hull[0].y);
      ctx.lineTo(hull[1].x, hull[1].y);
      ctx.lineTo(hull[2].x, hull[2].y);
      ctx.moveTo(hull[3].x, hull[3].y);
      ctx.lineTo(hull[4].x, hull[4].y);
    } else {
      ctx.moveTo(hull[0].x, hull[0].y);
      ctx.lineTo(hull[1].x, hull[1].y);
      ctx.lineTo(hull[2].x, hull[2].y);
      ctx.lineTo(hull[3].x, hull[3].y);
      ctx.moveTo(hull[4].x, hull[4].y);
      ctx.lineTo(hull[5].x, hull[5].y);
      ctx.lineTo(hull[6].x, hull[6].y);
      ctx.moveTo(hull[7].x, hull[7].y);
      ctx.lineTo(hull[8].x, hull[8].y);
    }
    ctx.stroke();
  },
  drawShape: function drawShape(ctx, shape, offset) {
    offset = offset || { x: 0, y: 0 };
    var order = shape.forward.points.length - 1;
    ctx.beginPath();
    ctx.moveTo(offset.x + shape.startcap.points[0].x, offset.y + shape.startcap.points[0].y);
    ctx.lineTo(offset.x + shape.startcap.points[3].x, offset.y + shape.startcap.points[3].y);
    if (order === 3) {
      ctx.bezierCurveTo(offset.x + shape.forward.points[1].x, offset.y + shape.forward.points[1].y, offset.x + shape.forward.points[2].x, offset.y + shape.forward.points[2].y, offset.x + shape.forward.points[3].x, offset.y + shape.forward.points[3].y);
    } else {
      ctx.quadraticCurveTo(offset.x + shape.forward.points[1].x, offset.y + shape.forward.points[1].y, offset.x + shape.forward.points[2].x, offset.y + shape.forward.points[2].y);
    }
    ctx.lineTo(offset.x + shape.endcap.points[3].x, offset.y + shape.endcap.points[3].y);
    if (order === 3) {
      ctx.bezierCurveTo(offset.x + shape.back.points[1].x, offset.y + shape.back.points[1].y, offset.x + shape.back.points[2].x, offset.y + shape.back.points[2].y, offset.x + shape.back.points[3].x, offset.y + shape.back.points[3].y);
    } else {
      ctx.quadraticCurveTo(offset.x + shape.back.points[1].x, offset.y + shape.back.points[1].y, offset.x + shape.back.points[2].x, offset.y + shape.back.points[2].y);
    }
    ctx.closePath();
    ctx.fill();
    ctx.stroke();
  },
  // initBezier: function () {
  //   this.curve = new Bezier(0, 0, 0, 1, 1, 1, 0, 1);
  //   this.outline = this.curve.outline(this.bezierOutline[0], this.bezierOutline[1]);
  // },
  // bezierType: "quadraticByPoints",
  // defaultShape: "arc",//line
  setPoints: function setPoints(points) {

    if (points && points[0] !== undefined && points[0].x === undefined) {
      var _NEW_points = [];
      for (var i = 0; i < points.length; i += 2) {
        _NEW_points.push({ x: points[i], y: points[i + 1] });
      }
      points = _NEW_points;
    }

    // if(this.defaultShape == "curve"){
    //   points = [0, 0, this.width/2, -this.width/2, this.width/2, this.width/2, this.width, 0];
    // }else if(this.defaultShape == "arc"){
    //   points = [0, 0, this.width*0.16, -this.width*0.43, this.width *(1 - 0.16), -this.width*0.43, this.width, 0];
    // }else{
    //   points = [0, 0, this.width / 3, 1, this.width / 3 * 2, 1, this.width, 0];
    // }
    var _intervals = this.closed && points.length > 1 ? points.length : points.length - 1;
    this.points = [].concat(points);
    if (this.points.length > 1 && this.bezierControls) {
      for (var i = 0; i < _intervals; i++) {
        var p2 = this.points[i + 1] || this.points[0];
        var p1 = this.points[i];
        var _cp = p1.c;
        if (_cp) {
          if (p1.c2) {
            this._makeCubic(p1, p1.c, p1.c2, p2);
          } else {
            this._makeCurve(p1, p1.c, p2);
          }
        } else {
          _cp = {
            x: (p1.x + p2.x) / 2,
            y: (p1.y + p2.y) / 2
          };
        }
      }
    }
  },
  // setPoint: function (order, _point) {
  //   var _points = this.points;
  //   _points[order].x = _point.x;
  //   _points[order].y = _point.y;
  //
  //   if(order == 0 ){
  //     var _p1 = _points[1], _p2 =  _points[0];
  //   }
  //   if(order == 1 ){
  //     var _p1 = _points[0], _p2 =  _points[1];
  //   }
  //   if(_points.length == 3){
  //     if(order == 2 ){
  //       var _p1 = _points[1], _p2 =  _points[2];
  //     }
  //   }else{
  //     if(order == 2 ){
  //       var _p1 = _points[3], _p2 =  _points[2];
  //     }
  //     if(order == 3 ){
  //       var _p1 = _points[2], _p2 =  _points[3];
  //     }
  //   }
  //   if (_p1.x - _p2.x < 1) {
  //     if(_p1.x <  _p2.x){
  //       _p2.x++;
  //     }else{
  //       _p2.x--;
  //     }
  //   }
  //   if (_p1.y - _p2.y < 1) {
  //     if(_p1.y <  _p2.y){
  //       _p2.y++;
  //     }else{
  //       _p2.y--;
  //     }
  //   }
  //   this.curve.update();
  //   this.outline = this.curve.outline(this.bezierOutline[0], this.bezierOutline[1]);
  //   this.updateBbox();
  //   this.canvas.renderAll();
  // }

  setExtraControls: function setExtraControls(controls) {
    this.addPointsControls(controls);
  },

  addPointsControls: function addPointsControls(controls) {

    var pts = this.points,
        _last = pts.length - 1;
    for (var i in pts) {
      controls["p" + (+i + 1)] = {
        action: "shape",
        visible: true,
        x: pts[i].x,
        y: pts[i].y,
        area: this.extensionAreaEnabled && (i == 0 || i == _last) ? this.cornerSize : this.cornerAreaSize,
        size: this.cornerSize,
        style: this.cornerStyle
      };

      if (this.bezierControls) {
        if (pts[i].c2) {

          controls["d" + (+i + 1)] = {
            action: "shape",
            visible: true,
            x: pts[i].c2.x,
            y: pts[i].c2.y,
            size: this.curveCornerSize + 2,
            area: this.cornerAreaSize,
            style: "rect"
          };
        }

        if (pts[i].c) {
          controls["c" + (+i + 1)] = {
            action: "shape",
            visible: true,
            x: pts[i].c.x,
            y: pts[i].c.y,
            size: this.curveCornerSize + 2,
            area: this.cornerAreaSize,
            style: "rect"
          };
        } else {
          var p2 = pts[+i + 1] || this.closed && pts[0];
          if (p2) {
            controls["c" + (+i + 1)] = {
              action: "shape",
              visible: true,
              x: (pts[i].x + p2.x) / 2,
              y: (pts[i].y + p2.y) / 2,
              area: this.cornerAreaSize,
              size: this.curveCornerSize,
              style: "circle"
            };
          }
        }
      }
    }
  },
  drawBezierShapeControls: function drawBezierShapeControls(ctx) {
    for (var i = 0; i < this.points.length; i++) {
      if (this.points[i].c2) {
        this.drawBezierControls(ctx, this.points[i], this.points[i].c, this.points[i].c2, this.points[i + 1]);
      }
    }
  },
  bezierControls: false,
  _makeCurveByIndex: function _makeCurveByIndex(index) {
    this._makeCurve(this.points[index], this.points[index].c, this.points[index + 1] || this.points[0]);
  },
  _makeCubic: function _makeCubic(p1, c1, c2, p2) {
    p1.curve = new Bezier(p1.x, p1.y, c1.x, c1.y, c2.x, c2.y, p2.x, p2.y);
    if (this.outlineTop || this.outlineBottom) {
      p1.outline = p1.curve.outline(this.outlineBottom, this.outlineTop);
    }
  },
  _makeCurve: function _makeCurve(_curPoint, c1, _p2) {
    _curPoint.c = { x: c1.x, y: c1.y };
    _curPoint.curve = Bezier.quadraticFromPoints.apply(this, [_curPoint, c1, _p2]);
    if (this.outlineTop || this.outlineBottom) {
      _curPoint.outline = _curPoint.curve.outline(this.outlineTop, this.outlineBottom);
    }
  },
  _update_curve: function _update_curve(_pointIndex) {
    var _p1 = this.points[_pointIndex];
    if (!_p1.c) {
      return;
    }
    var _p2 = this.points[_pointIndex + 1] || this.points[0];

    if (_p1.c2) {
      _p1.curve.points[0].x = _p1.x;
      _p1.curve.points[0].y = _p1.y;
      _p1.curve.points[1].x = _p1.c.x;
      _p1.curve.points[1].y = _p1.c.y;
      _p1.curve.points[2].x = _p1.c2.x;
      _p1.curve.points[2].y = _p1.c2.y;
      _p1.curve.points[3].x = _p2.x;
      _p1.curve.points[3].y = _p2.y;
      _p1.curve.update();
      _p1.outline = _p1.curve.outline(this.outlineBottom, this.outlineTop);
    } else {
      var bezier_pointers = Bezier.getABC(2, _p1, _p1.c, _p2, 0.5);
      _p1.curve.points[0].x = _p1.x;
      _p1.curve.points[0].y = _p1.y;
      _p1.curve.points[1].x = bezier_pointers.A.x;
      _p1.curve.points[1].y = bezier_pointers.A.y;
      _p1.curve.points[2].x = _p2.x;
      _p1.curve.points[2].y = _p2.y;
      _p1.curve.update();
      if (this.outlineTop || this.outlineBottom) {
        _p1.outline = _p1.curve.outline(this.outlineBottom, this.outlineTop);
      }
    }
  },
  setPoint: function setPoint(order, _point) {

    var dragPointer,
        _curvepointer = order[0] == "c",
        pIndex1 = +order.substr(1) - 1,
        p1 = this.points[pIndex1],
        pIndex2 = this.points[pIndex1 + 1] ? pIndex1 + 1 : this.closed ? 0 : -1,
        p2 = pIndex2 !== -1 && this.points[pIndex2],
        pIndex0 = this.points[pIndex1 - 1] ? pIndex1 - 1 : this.closed ? this.points.length - 1 : -1,
        p0 = pIndex0 !== -1 && this.points[pIndex0];

    if (this.pointsLimits) {
      _point.x = Math.max(0, Math.min(_point.x, this.width));
      _point.y = Math.max(0, Math.min(_point.y, this.height));
    }
    var _curvepointer2 = order[0] == "d";
    if (_curvepointer2) {
      dragPointer = p1.c2;
    } else {
      if (_curvepointer) {

        if (!p1.c) {
          this._makeCurve(p1, _point, p2);
        }
        dragPointer = p1.c;
      } else {
        dragPointer = p1;
      }
    }
    if (dragPointer) {
      dragPointer.x = _point.x;
      dragPointer.y = _point.y;
    }
    for (var i in this.points) {
      this.points[i].c && this._update_curve(+i);
    }
    this.updateBbox();
    this.fire("shape:modified");
    this.canvas && this.canvas.renderAll();
  }
};

fabric.util.object.defaults(fabric.BezierMixin, fabric.ShapeMixin);
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 83 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.ShapeMixin = {
  storeProperties: fabric.Object.prototype.storeProperties.concat(["points"]),
  stateProperties: fabric.Object.prototype.stateProperties.concat(["points"]),
  getPoints: function getPoints() {
    return fabric.util.object.filterValues(this.points, ["x", "y", "c", "c2"]);
  },
  addPoint: function addPoint(_point) {
    this.points.push({
      x: _point.x,
      y: _point.y
    });
    if (this.closeOnFull && this.points.length == this.maximumPoints) {
      this.closed = true;
    }
    this.updateBbox();
  },
  getLength: function getLength() {
    var _l = 0;
    for (var i = 0; i < this.points.length - 1; i++) {
      if (this.points[i].curve) {
        _l += this.points[i].curve.length();
      }
    }
    return _l;
  },
  updateBbox: function updateBbox() {
    if (this.points.length == 0) {
      this.left = 0;
      this.top = 0;
      this.width = 1;
      this.height = 1;
      return;
    }
    var minX = Infinity,
        maxX = -Infinity,
        minY = Infinity,
        maxY = -Infinity,
        i;
    for (i in this.points) {
      var _p = this.points[i];
      if (_p.outline) {
        var bbox = _p.outline.bbox();
        minX = Math.min(minX, bbox.x.min);
        maxX = Math.max(maxX, bbox.x.max);
        minY = Math.min(minY, bbox.y.min);
        maxY = Math.max(maxY, bbox.y.max);
      } else if (_p.curve) {
        var bbox = _p.curve.bbox();
        minX = Math.min(minX, bbox.x.min);
        maxX = Math.max(maxX, bbox.x.max);
        minY = Math.min(minY, bbox.y.min);
        maxY = Math.max(maxY, bbox.y.max);
      } else {
        minX = Math.min(minX, _p.x);
        maxX = Math.max(maxX, _p.x);
        minY = Math.min(minY, _p.y);
        maxY = Math.max(maxY, _p.y);
      }
    }
    this.__translated = {
      x: minX,
      y: minY
    };
    this.left += minX;
    this.top += minY;
    this.width = maxX - minX + 1;
    this.height = maxY - minY + 1;

    for (i in this.points) {
      var _point = this.points[i];
      _point.x -= minX;
      _point.y -= minY;
      if (_point.c) {
        _point.c.x -= minX;
        _point.c.y -= minY;
      }
      if (_point.c2) {
        _point.c2.x -= minX;
        _point.c2.y -= minY;
      }
    }
    this.canvas && this.setCoords();

    //нужно оптимизировать(переисовывать только 1 или 2 кривых за раз
    //todo нужно перерисовывать при изменении размера
    if (this.__translated.x || this.__translated.y) {
      for (i in this.points) {
        this.points[i].c && this._update_curve(+i);
      }
    }
  },
  _performShapeAction: function _performShapeAction(e, transform, pointer) {
    transform.corner.substr(1);
    this.setPoint(transform.corner, transform.point);
    transform.actionPerformed = true;
    this.fire('shaping', e);
  },
  _initPoints: function _initPoints(points) {

    if (points) {
      this.set('points', points);
    }

    this._controlsVisibility = {};

    var _points = this.points || this._points;

    if (_points) {
      for (var i = 1; i <= _points.length; i++) {
        this._controlsVisibility["p" + i] = true;
      }
      this._controlsVisibility["p"] = true;
    }

    var _default_corners = {
      tl: true,
      tr: true,
      br: true,
      bl: true,
      ml: true,
      mt: true,
      mr: true,
      mb: true,
      mtr: true
    };
    for (var i in _default_corners) {
      this._controlsVisibility[i] = _default_corners[i];
    }
  },
  _default_corner_action: "shape",
  _corner_actions: {},

  drawBoundsControls: fabric.Object.prototype.drawControls,
  addPointsControls: function addPointsControls() {
    var controls = {};

    var pts = this.points;
    for (var i in pts) {
      controls["p" + +i] = {
        x: pts[i].x,
        y: pts[i].y,
        size: this.cornerSize,
        style: "circle"
      };
    }
    return controls;
  },
  drawShapeBorder: function drawShapeBorder(ctx) {
    var _points = this.points || this._points;

    var x, y;
    x = -this.width / 2;
    y = -this.height / 2;
    var zoom = this.canvas.viewportTransform[0];
    ctx.save();
    ctx.scale(this.scaleX * zoom, this.scaleY * zoom);
    ctx.translate(x, y);

    ctx.beginPath();

    var _p = _points[0]; // fabric.util.transformPoint(_points[0], transformMatrix);

    ctx.moveTo(_p.x, _p.y);

    for (var i = 1; i < _points.length; i++) {

      var _p = _points[i]; //fabric.util.transformPoint(_points[i], transformMatrix);
      ctx.lineTo(_p.x, _p.y);
    }
    ctx.closePath();
    ctx.stroke();
    ctx.restore();
  }
  // setCoords: function () {
  //   this.setBoundCoords();
  //   this.setExtraCoords();
  // }
};
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 84 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.util.object.extend(fabric.Polyline.prototype, {
  controlsButtonsEnabled: false,
  _create_buttons_controls: function _create_buttons_controls(controls) {

    if (!this.controlsButtonsEnabled) return;

    var pts = this.points,
        _last = pts.length - 1;
    if (this.__magnet_point && this.__magnet_point.id[0] != "x") {
      var _id = this.__magnet_point.id;
      var _ender_area = _id == "e1" || _id == "e2";
      var _ender_points = _ender_area || _id == "p1" || _id == "p" + pts.length;
      var _offset = _ender_points ? 15 : 10;
      this._xbuttons_point = _ender_area ? _id[1] == "1" ? 0 : _last : _id.substr(1) - 1;
      this._xbuttons_curve = _id[0] == "c";
      if (this._xbuttons_curve) {
        controls.push({
          x: this.__magnet_point.x + _offset,
          y: this.__magnet_point.y - _offset,
          size: 16,
          intransformable: true,
          styleFunction: this._drawInsertNodeButton,
          id: "x1"
        });
      }
      controls.push({
        x: this.__magnet_point.x + _offset,
        y: this.__magnet_point.y + _offset,
        size: 16,
        intransformable: true,
        styleFunction: this._drawRemoveNodeButton,
        id: "x2"
      });
    } else {
      delete this._xbuttons_point;
      delete this._xbuttons_curve;
    }
  },
  _drawInsertNodeButton: function _drawInsertNodeButton(control, ctx, methodName, left, top, size, stroke) {
    ctx.save();
    ctx.fillStyle = "green";
    ctx.beginPath();
    var _size = size / 4;
    ctx.arc(left + size / 2, top + size / 2, _size * 2, 0, 2 * Math.PI, false);
    ctx.fill();
    ctx.strokeStyle = "white";
    ctx.translate(Math.floor(size / 2), Math.floor(size / 2));
    ctx.translate(0.5, 0.5);
    ctx.moveTo(left - _size, top);
    ctx.lineTo(left + _size, top);
    ctx.strokeStyle = "white";
    ctx.moveTo(left, top + _size);
    ctx.lineTo(left, top - _size);
    ctx.stroke();
    ctx.restore();
  },
  _drawRemoveNodeButton: function _drawRemoveNodeButton(control, ctx, methodName, left, top, size, stroke) {
    ctx.save();
    ctx.fillStyle = "red";
    ctx.beginPath();
    var _size = size / 4;
    ctx.arc(left + size / 2, top + size / 2, _size * 2, 0, 2 * Math.PI, false);
    ctx.fill();
    ctx.strokeStyle = "white";
    ctx.translate(size / 2, size / 2);
    ctx.moveTo(left - _size, top - _size);
    ctx.lineTo(left + _size, top + _size);
    ctx.strokeStyle = "white";
    ctx.moveTo(left - _size, top + _size);
    ctx.lineTo(left + _size, top - _size);
    ctx.stroke();
    ctx.restore();
  },
  _performAddAction: function _performAddAction(e, transform, pointer) {
    this.isMoving = false;
    var p1 = this.points[this._xbuttons_point];
    var p2 = this.points[this._xbuttons_point + 1];
    if (p1.curve) {
      var new_point1 = p1.curve.get(0.25);
      var new_point2 = p1.curve.get(0.75);

      this.points.splice(this._xbuttons_point + 1, 0, {
        x: p1.c.x,
        y: p1.c.y,
        c: new_point2
      });
      p1.c = new_point1;
      this._makeCurveByIndex(this._xbuttons_point);
      this._makeCurveByIndex(this._xbuttons_point + 1);
    } else {
      var new_point1 = { x: (p2.x - p1.x) / 4, y: (p2.y - p1.y) / 4 };
      var new_point2 = { x: (p2.x - p1.x) / 4 * 3, y: (p2.y - p1.y) / 4 * 3 };
    }
    delete this.canvas._currentTransform;
    // delete transform.action;
    // delete transform.corner;
  },
  _performRemoveAction: function _performRemoveAction(e, transform, pointer) {
    if (this.points.length == 2) {
      return this.remove();
    }

    var _curvepointer = this._xbuttons_curve,
        pIndex1 = this._xbuttons_point;

    if (this.points[pIndex1 - 1] && this.points[pIndex1 + 1]) {
      this.points[pIndex1 - 1].c = this.points[pIndex1];
      this.points.splice(pIndex1, 1);
      this._makeCurveByIndex(pIndex1 - 1);
    } else {
      this.points.splice(pIndex1, 1);
    }
    this.isMoving = false;
    this.setSize();
    this.canvas.renderAll();
    delete this.canvas._currentTransform;
    // delete transform.action;
    // delete transform.corner;
  }
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 85 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

__webpack_require__(86);
//fabric.require("SlideImage",["SlideObject"/*,"Pathfinder"*/],function() {

fabric.util.object.extend(fabric.Image.prototype, {
  contentOffsets: null,
  /**
   * @private
   * @param {CanvasRenderingContext2D} ctx Context to render on
   * @param {Boolean} noTransform
   */
  _render: function _render(ctx, noTransform) {
    var x,
        y,
        imageMargins = this._findMargins(),
        elementToDraw;

    x = noTransform ? this.left : -this.width / 2;
    y = noTransform ? this.top : -this.height / 2;

    if (this.meetOrSlice === 'slice') {
      ctx.beginPath();
      ctx.rect(x, y, this.width, this.height);
      ctx.clip();
    }

    if (this.isMoving === false && this.resizeFilters.length && this._needsResize()) {
      this._lastScaleX = this.scaleX;
      this._lastScaleY = this.scaleY;
      elementToDraw = this.applyFilters(null, this.resizeFilters, this._filteredEl || this._originalElement, true);
    } else {
      elementToDraw = this._element;
    }
    //todo fill all background
    //  this._renderFill(ctx);
    elementToDraw && ctx.drawImage(elementToDraw, x + imageMargins.marginX, y + imageMargins.marginY, imageMargins.width, imageMargins.height);

    this._stroke(ctx);
    this._renderStroke(ctx);
  },
  imageTools: false,
  photoshopTools: false,
  cloneSync: function cloneSync() {
    var _object = this.toObject();
    delete _object.filters;
    var clone = new fabric.Image(this._element, _object);
    clone._filteredEl = this._filteredEl;
    clone.filters = this.filters;
    return clone;
  },
  revertChanges: function revertChanges() {
    var pathfinder = this.canvas.getPathfinder();
    if (pathfinder.target && pathfinder.target == this) {
      pathfinder.hide();
    }

    if (this._element == this._originalElement) {
      return;
    }

    this.filters.length = 0;
    if (this._filteredEl) {
      delete this._filteredEl;
    }
    delete this._edited;
    this._element = this._originalElement;

    this.fire("content:modified", {
      bounds: { minX: 0, minY: 0, maxX: this._element.width, maxY: this._element.height }
    });

    this.canvas.renderAll();
  },
  extractColors: function extractColors() {
    var _colors = fabric.MagicWand.extractColors(this._element);
    var colors = {};
    for (var i in _colors) {
      var _str = "rgb(" + _colors[i].join(",") + ")";
      colors[_str] = {};
    }
    return colors;
  },
  actions: fabric.util.object.extend(fabric.Image.prototype.actions, {
    photoshopTools: {
      type: 'effect',
      effectTpl: '<div id="editor-tools" class="inline-actions compact"></div>' + '<div class="checkboard" ><div id="pathfinder"></div></div>',
      className: 'fa fa-pencil-square-o',
      title: "advanced tools",
      action: function action() {
        var pathfinder = this.canvas.getPathfinder();
        pathfinder.target = this;
        pathfinder.setPicture(this._element);
        pathfinder.show();
      },
      actionParameters: function actionParameters(el, data) {

        var pathfinder = this.canvas.getPathfinder();
        pathfinder.canvas = this.canvas;

        new fabric.Toolbar(pathfinder, 'editor-tools');

        pathfinder.setContainer('pathfinder');

        // if (pathfinder.target)pathfinder.hide();
        pathfinder.target = this;
        pathfinder.setPicture(this._element);
        pathfinder.show();
      }
    },
    revertChanges: {
      className: 'fa fa-history',
      title: "revert to orignal image",
      action: "revertChanges",
      observe: "content:modified",
      visible: function visible() {
        return !!this._filteredEl || this._edited;
      }
    }
  })
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 86 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.MagicWand = __webpack_require__(11);

var MagicWand = fabric.MagicWand;

/**
 * Pathfinder (Pathfinder) Interface for MagicWand selection tool
 * @param options
 * @constructor
 */
function Pathfinder(options) {
  this.initialize(options);
}

Pathfinder.prototype = {
  type: 'pathfinder',
  keepOldSelection: true,
  alphaChannel: true,
  pathfinderMode: 'new',
  selectionTool: 'magic',
  adjacentPixels: true,
  async: false,
  pathfinderTools: false,
  blurRadius: 0,
  hatchLength: 4,
  colorThreshold: 15,
  simplifyTolerant: 0,
  simplifyCount: 30,
  hatchOffset: 0,
  imageInfo: null,
  mask: null,
  downPoint: null,
  allowDraw: false,
  shapeSelectionTools: false,
  initialize: function initialize(options) {

    options.application && options.application.fire('entity:created', { target: this, options: options });

    for (var i in options) {
      this[i] = options[i];
    }
  },
  asyncronous: function asyncronous(cb) {
    if (this.async) {
      setTimeout(cb);
    } else {
      cb();
    }
  },
  fillWithCurrentColor: function fillWithCurrentColor() {
    this.fill(this.color);
  },
  clearMemory: function clearMemory() {
    delete this.resultCanvas;
    delete this.editedImageCanvas;
    delete this.test_picture;
    delete this.mask;
  },
  hide: function hide() {
    if (this.editedImageCanvas) {
      this.editedImageCanvas.remove();
      this.resultCanvas.remove();
      clearInterval(this.interval);
      this.clearMemory();
      this.fire('hidden');
    }
  },
  setContainer: function setContainer(container) {
    if (container.constructor === String) {
      container = document.getElementById(container);
    }
    this.container = container;

    this.test_picture = new Image();
    this.test_picture.onload = this.initCanvas.bind(this);
    return this;
  },
  getSelectionTool: function getSelectionTool() {
    return this.selectionTool;
  },
  setSelectionTool: function setSelectionTool(tool) {
    this.selectionTool = tool;
    this.downPoint = false;
    this.fire('tool:changed', tool);
  },
  getThreshold: function getThreshold() {
    return this.colorThreshold;
  },
  setThreshold: function setThreshold(thres) {
    if (thres !== undefined) {
      this.colorThreshold = thres;
    }
    if (this.downPoint) {
      this.drawMask(this.downPoint.x, this.downPoint.y, this.adjacentPixels);
    }
    this.fire('threshold:changed', { threshold: this.colorThreshold });
  },
  setPicture: function setPicture(img) {
    this.setImage(img);
    var cvs = fabric.util.createCanvasElement();

    cvs.onmouseup = this.onMouseUp.bind(this);
    cvs.onmousedown = this.onMouseDown.bind(this);
    cvs.onmousemove = this.onMouseMove.bind(this);
    cvs.oncontextmenu = function () {
      return false;
    };
    this.initCanvas(cvs);
  },
  load: function load(file) {
    if (!file) return;

    if (file.constructor === String) {
      Pathfinder.test_picture.setAttribute('src', file);
    } else {
      var reader = new FileReader();
      reader.onload = function (e) {
        this.test_picture.setAttribute('src', e.target.result);
      }.bind(this);
      reader.readAsDataURL(file);
    }
  },
  initCanvas: function initCanvas(cvs) {
    var img = this.editedImageCanvas;
    if (this.resultCanvas) {
      $(this.resultCanvas).remove();
    }
    this.resultCanvas = cvs;
    this.createSelectionDrawCanvas();

    this.context = cvs.getContext('2d');
    cvs.width = img.width;
    cvs.height = img.height;
    //this.setImage(img);
  },
  setImage: function setImage(img) {
    this._test_todo_img = img;
    //this.mask = null;//MagicWand.createMask(img.width,img.height);
    this.editedImageCanvas = fabric.util.createCanvasElement();
    this.editedImageCanvas.width = img.width;
    this.editedImageCanvas.height = img.height;
    this.editedImageCanvas.getContext('2d').drawImage(img, 0, 0);
    this.initCanvas(fabric.util.createCanvasElement());
  },
  getInfo: function getInfo() {

    var ctx = this.editedImageCanvas.getContext('2d');
    var imageInfo = ctx.getImageData(0, 0, this.editedImageCanvas.width, this.editedImageCanvas.height);
    imageInfo.bytes = 4;
    return imageInfo;
  },
  getMousePosition: function getMousePosition(e) {
    var scale = this.resultCanvas.width / $(this.resultCanvas).width();
    var target = e.target || e.srcElement,
        rect = target.getBoundingClientRect(),
        offsetX = e.clientX - rect.left,
        offsetY = e.clientY - rect.top;
    return { x: Math.round(offsetX * scale), y: Math.round(offsetY * scale) };
  },
  radius: 20,
  resetSelectionDrawCanvas: function resetSelectionDrawCanvas() {
    this.selectionDrawContext.fillStyle = "black";
    //this.selectionDrawContext(0, 0, canvas.width, canvas.height);
    this.selectionDrawContext.fillRect(0, 0, this.selectionDrawCanvas.width, this.selectionDrawCanvas.height);
    this.selectionDrawContext.fillStyle = "white";
    this.selectionDrawContext.strokeStyle = "white";
  },
  createSelectionDrawCanvas: function createSelectionDrawCanvas() {

    if (this.selectionDrawCanvas) {
      $(this.selectionDrawCanvas).remove();
    }
    this.selectionDrawCanvas = fabric.util.createCanvasElement();
    this.selectionDrawCanvas.width = this.resultCanvas.width;
    this.selectionDrawCanvas.height = this.resultCanvas.height;
    this.selectionDrawContext = this.selectionDrawCanvas.getContext("2d");
    this.resetSelectionDrawCanvas();
  },
  _onMouseDown: function _onMouseDown(point) {
    point.x = Math.min(Math.max(0, parseInt(point.x)), this.resultCanvas.width - 1);
    point.y = Math.min(Math.max(0, parseInt(point.y)), this.resultCanvas.height - 1);
    this.allowDraw = true;
    this.drawingTools[this.selectionTool].mouseDown.call(this, point);
  },
  onMouseDown: function onMouseDown(e) {
    e.preventDefault();
    e.stopPropagation();
    this._onMouseDown(this.getMousePosition(e));
  },
  _onMouseMove: function _onMouseMove(p) {
    p.x = Math.min(Math.max(0, parseInt(p.x)), this.resultCanvas.width - 1);
    p.y = Math.min(Math.max(0, parseInt(p.y)), this.resultCanvas.height - 1);
    this.drawingTools[this.selectionTool].mouseMove.call(this, p);
  },
  onMouseMove: function onMouseMove(e) {
    var p = this.getMousePosition(e);
    this._onMouseMove(p);
  },
  color: [255, 0, 0, 255],
  onMouseUp: function onMouseUp(e) {
    this.allowDraw = false;
    this.drawingTools[this.selectionTool].mouseUp.call(this, e);
  },
  applyMask: function applyMask(canvas, left, top) {
    if (canvas.width === 0 || canvas.height === 0) {
      delete this.mask;
      this.render();
      return;
    }
    var info = this.getInfo(),
        mask = MagicWand.maskSelection(canvas, left, top);

    this.mask = mask;
    this.fire('selection:changed', { mask: mask, target: this.target });
  },
  setPathfinderMode: function setPathfinderMode(value) {
    this.pathfinderMode = value;
  },
  getPathfinderMode: function getPathfinderMode() {
    return this.pathfinderMode;
  },
  modifySelection: function modifySelection(mask, pathfinderMode, noEvents) {
    this.shouldModify = false;
    if (this.selectionObject) {
      this.selectionObject.remove();
    }
    this.downPoint = false;
    if (mask === undefined) {
      mask = this.mask;
    }
    if (pathfinderMode === undefined) {
      pathfinderMode = this.pathfinderMode;
    }
    if (pathfinderMode !== 'new' && this.oldMask) {
      mask = MagicWand[pathfinderMode](mask, this.oldMask);
    }
    if (this.blurRadius) {
      mask = MagicWand.gaussBlurOnlyBorder(mask, this.blurRadius);
    }
    //if (pathfinderMode !== 'new' && this.oldMask || this.blurRadius) {
    //  mask.cacheInd = MagicWand.getBorderIndices(mask);
    //}

    if (mask && mask.count && this.keepOldSelection) {
      mask.makeCache();
      this.oldMask = mask;
    } else {
      delete this.oldMask;
    }

    this.mask = MagicWand.createMask(this.editedImageCanvas.width, this.editedImageCanvas.height);
    if (!noEvents) {
      this.fire('selection:changed', { mask: mask, target: this.target });
    }
    this.render();
  },
  createSelection: function createSelection(mask) {
    if (this.shouldModify) {
      this.modifySelection();
    }

    this.mask = mask || MagicWand.createMask(this.editedImageCanvas.width, this.editedImageCanvas.height);
    this.render();
  },
  setSelection: function setSelection(mask) {
    this.mask = mask;
    this.render();
    this.fire('selection:changed', { mask: mask, target: this.target });
  },
  fill: function fill(color, callback) {
    this.asyncronous(function () {
      this._fill(color, false);
      callback && callback.call(this);
    }.bind(this), 0);
  },
  _fill: function _fill(color, invert, canvas) {

    if (!this.mask) return;

    canvas = canvas || this.editedImageCanvas;
    var ctx = canvas.getContext('2d'); //b.minX, b.minY, b.maxX - b.minX, b.maxY - b.minY);

    MagicWand.fillMask(ctx, this.mask, color);

    this.fire('image:changed', this.editedImageCanvas);
  },
  hatchTick: function hatchTick() {
    this.hatchOffset = (this.hatchOffset + 1) % (this.hatchLength * 2);
    this.render(true);
  },
  show: function show() {
    while (this.container.lastChild) {
      this.container.removeChild(this.container.lastChild);
    }
    this.container.appendChild(this.editedImageCanvas);
    this.container.appendChild(this.resultCanvas);
    this.interval = setInterval(this.hatchTick.bind(this), 300);

    this.fire('show');
  },
  clear: function clear(invert, canvas, callback) {
    this.asyncronous(function () {
      this._fill([0, 0, 0, 0], invert, canvas);
      callback && callback.call(this);
    }.bind(this), 0);
  },
  render: function render(noBorder) {
    if (!this.context || !this.mask) return;

    var ctx = this.context;
    if (!noBorder) {
      this.mask.cacheInd = MagicWand.getBorderIndices(this.mask);
    }
    ctx.clearRect(0, 0, this.mask.width, this.mask.height);

    var _new_color = !this.oldMask || this.pathfinderMode == "new" || this.pathfinderMode == "add" || this.pathfinderMode == "exclude" ? this.newMaskColor : this.removedMaskColor;

    var _intersection_color;
    if (this.pathfinderMode == "add" || this.pathfinderMode == "new" || this.pathfinderMode == "intersect") {
      _intersection_color = this.newMaskColor;
    } else {
      _intersection_color = this.removedMaskColor; //intersectionRemovedMaskColor;
    }
    var _old_color;
    if (this.pathfinderMode == "exclude" || this.pathfinderMode == "substract" || this.pathfinderMode == "add") {
      _old_color = this.newMaskColor;
    } else {
      _old_color = this.removedMaskColor;
    }

    this.oldMask && this.oldMask.render(ctx, {
      fill: _old_color
    });

    this.mask.render(ctx, {
      fill: _new_color,
      intersectionColor: _intersection_color,
      outerIntersectionColor: _old_color
      // outerFill : "rgba(0,0,0,0.5)"
    });

    if (this.renderBorder) {
      this.oldMask && this.oldMask.renderBorder(ctx, {});

      this.mask.renderBorder(ctx, {
        hatchOffset: this.hatchOffset
      });
    }
  },
  renderBorder: true,
  intersectionRemovedMaskColor: '#ffaaaa',
  removedMaskColor: '#aaaaff',
  newMaskColor: '#aaFFaa',
  renderMask: function renderMask(ctx, mask, color, left, top) {
    mask = mask || this.mask;
    mask && mask.render(ctx, {
      intersectionColor: '#fff',
      outerIntersectionColor: '#000',
      fill: color || '#fff',
      left: left,
      top: top
    });
  },
  getContours: function getContours() {
    if (!this.__cs) {
      this.__cs = MagicWand.traceContours(this.mask);
      this.__cs = MagicWand.simplifyContours(this.__cs, this.simplifyTolerant, this.simplifyCount);
    }
    return this.__cs;
  },
  traceInner: function traceInner(ctx) {

    var cs = this.getContours();
    var ctx = ctx || this.context;
    ctx.beginPath();
    for (var i = 0; i < cs.length; i++) {
      if (!cs[i].inner) continue;
      var ps = cs[i].points;
      ctx.moveTo(ps[0].x, ps[0].y);
      for (var j = 1; j < ps.length; j++) {
        ctx.lineTo(ps[j].x, ps[j].y);
      }
    }
    ctx.stroke();
  },
  getColor: function getColor() {
    return 'rgba(' + this.color.join(', ') + ')';
  },
  setColor: function setColor(color) {
    var _arr = color.substring(color.indexOf('(') + 1, color.length - 1).split(', ');
    for (var i in _arr) {
      _arr[i] = parseFloat(_arr[i]);
    }
    _arr[3] = Math.round(_arr[3] * 255);
    this.color = _arr;
  },
  trace: function trace(ctx) {
    var info = this.getInfo();
    var cs = MagicWand.traceContours(this.mask);
    cs = MagicWand.simplifyContours(cs, this.simplifyTolerant, this.simplifyCount);

    // draw contours
    var ctx = ctx || this.context;
    ctx.clearRect(0, 0, info.width, info.height);
    //inner
    ctx.beginPath();
    for (var i = 0; i < cs.length; i++) {
      if (!cs[i].inner) continue;
      var ps = cs[i].points;
      ctx.moveTo(ps[0].x, ps[0].y);
      for (var j = 1; j < ps.length; j++) {
        ctx.lineTo(ps[j].x, ps[j].y);
      }
    }
    ctx.strokeStyle = 'red';
    ctx.stroke();
    //outer
    ctx.beginPath();
    for (var i = 0; i < cs.length; i++) {
      if (cs[i].inner) continue;
      var ps = cs[i].points;
      ctx.moveTo(ps[0].x, ps[0].y);
      for (var j = 1; j < ps.length; j++) {
        ctx.lineTo(ps[j].x, ps[j].y);
      }
    }
    ctx.strokeStyle = 'blue';
    ctx.stroke();
  },
  removeNoise: function removeNoise(threshold) {

    if (!this.mask || !this.mask.count) return;
    this.createSelectionDrawCanvas();
    //this.renderMask(this.selectionDrawContext, this.mask);

    var cs = MagicWand.traceContours(this.mask);
    cs = MagicWand.simplifyContours(cs, this.simplifyTolerant, this.simplifyCount);

    var ctx = this.selectionDrawContext,
        v = this.canvas.viewportTransform;

    //  cs = MagicWand.simplifyContours(cs, this.simplifyTolerant, this.simplifyCount);

    ctx.save();
    ctx.translate(0.5, 0.5);
    ctx.fillStyle = "#fff";
    //ctx.fillStyle= "#0f0";
    ctx.strokeStyle = "#fff";
    for (var i = 0; i < cs.length; i++) {
      if (!cs[i].inner && cs[i].points.length > threshold) {
        var ps = cs[i].points;
        ctx.beginPath();
        ctx.moveTo(ps[0].x, ps[0].y);
        for (var j = 1; j < ps.length; j++) {
          ctx.lineTo(ps[j].x, ps[j].y);
        }
        ctx.closePath();
        ctx.fill();
      }
    }
    this.mask = MagicWand.maskSelection(this.selectionDrawCanvas);
    this.setSelection(this.mask);

    ctx.restore();
  },

  tools: ["adjacentPixels", "pathfinderRadius", "pathfinderThreshold", "selectionTool", "pathfinder", "fillWithCurrentColor", "clear", "pathfinderColor"],
  actions: {

    cancelSelection: {
      visible: false,
      key: 'Escape',
      action: function action() {
        delete this.shouldModify;
        this.mask = MagicWand.createMask(this.editedImageCanvas.width, this.editedImageCanvas.height);
      }
    },
    modifySelection: {
      visible: false,
      key: 'Enter',
      action: function action() {
        if (this.shouldModify) {
          this.modifySelection();
        }
      }
    },
    adjacentPixels: {
      className: 'button-adjacent',
      title: 'selet all',
      type: 'checkbox',
      value: 'adjacentPixels',
      visible: function visible() {
        return this.selectionTool === 'magic';
      },
      observe: 'tool:changed'
    },
    pathfinderRadius: {
      title: 'radius',
      type: 'range',
      value: {
        get: function get() {
          return this.radius;
        },
        set: function set(val) {
          this.radius = val;
        },
        min: 1,
        max: 255
      },
      visible: function visible() {
        return this.selectionTool === 'brush';
      },
      observe: 'tool:changed'
    },
    pathfinderThreshold: {
      title: 'Threshold',
      type: 'range',
      value: {
        observe: 'threshold:changed',
        get: function get() {
          return this.colorThreshold;
        },
        set: function set(val) {
          this.setThreshold(val);
        },
        min: 0,
        max: 255
      },
      visible: function visible() {
        return this.selectionTool === 'magic';
      },
      observe: 'tool:changed'
    },
    selectionTool: {
      title: 'selection-tool',
      type: 'options',
      value: 'selectionTool',
      menu: {
        selectionToolBrush: {
          className: 'fa fa-paint-brush',
          title: 'select-brush',
          option: 'brush'
        },
        selectionToolRectangle: {
          className: 'fa fa-square',
          title: 'select-rectangle',
          option: 'rectangle'
        },
        selectionElliptical: {
          className: 'fa fa-circle',
          title: 'select-circle',
          option: 'circle'
        },
        selectionToolMagic: {
          className: 'fa fa-magic',
          title: 'select-magic',
          option: 'magic'
        },
        selectionToolLasso: {
          use: 'shapeSelectionTools',
          title: 'select-lasso',
          option: 'lasso',
          icon: 'data:image/svg+xml;base64,' + __webpack_require__(87)
        }
      }
    },
    pathfinder: {
      title: 'pathfinder',
      type: 'options',
      value: 'pathfinderMode',
      menu: {
        pathfinderNew: {
          title: 'pathfinder-new',
          option: 'new'
        },
        pathfinderExclude: {
          title: 'pathfinder-exclude',
          option: 'exclude'
        },
        pathfinderSubstract: {
          title: 'pathfinder-substract',
          option: 'substract'
        },
        pathfinderAdd: {
          title: 'pathfinder-add',
          option: 'add'
        },
        pathfinderIntersect: {
          title: 'pathfinder-intersect',
          option: 'intersect'
        }
      }
    },
    fillWithCurrentColor: {
      title: 'fillWithCurrentColor',
      className: 'fa fa-paint-brush'
    },
    clear: {
      className: 'fa fa-eraser',
      id: 'Pathfinder-clear',
      title: 'clear'
    },
    pathfinderColor: {
      title: 'color',
      type: 'color',
      value: 'color'
    }
  }
};

fabric.util.observable(Pathfinder.prototype);

fabric.util.object.extend(Pathfinder.prototype, fabric.ToolsMixin, {
  selectBackground: function selectBackground(fromCorners) {
    var info = this.getInfo(),
        mask;

    if (fromCorners) {
      var mask1 = MagicWand.selectBackground(info, [255, 255, 255, false], this.colorThreshold);
      var mask2 = MagicWand.selectBackground(info, [false, false, false, 0], this.colorThreshold);
      mask = MagicWand.add(mask1, mask2);
    } else {
      mask = MagicWand.selectAllByColor(info, [255, 255, 255, 255], this.colorThreshold);
    }

    if (this.blurRadius) {
      mask = MagicWand.gaussBlurOnlyBorder(mask, this.blurRadius);
    }
    this.setSelection(mask);
  },
  colorSelection: function colorSelection(colors, threshold) {
    var info = this.getInfo(),
        mask2,
        mask = MagicWand.createMask(info.width, info.height);
    for (var i in colors) {
      var _color = new fabric.Color(colors[i])._source;
      _color[3] = Math.round(_color[3] * 255);
      mask2 = MagicWand.selectAllByColor(info, _color, threshold[i]);
      mask = MagicWand.add(mask, mask2);
    }
    delete this.oldMask;
    this.modifySelection(mask);
  },
  smartSelection: function smartSelection(threshold) {
    var info = this.getInfo(),
        mask;
    mask = MagicWand.selectBackground(info, null, threshold || this.colorThreshold);
    mask = MagicWand.invertMask(mask);
    delete this.oldMask;
    this.modifySelection(mask);
  }
});

Pathfinder.prototype.drawingTools = {
  brush: {
    mouseUp: function mouseUp() {
      this.modifySelection();
      this.resetSelectionDrawCanvas();
    },
    mouseMove: function mouseMove(p) {
      if (!this.allowDraw) return;
      this.drawCircle(p.x, p.y, this.radius);
    },
    mouseDown: function mouseDown(point) {
      this.createSelection();
      this.downPoint = point;
      this.createSelectionDrawCanvas();
      this.drawCircle(point.x, point.y, this.radius);
    },
    utils: {
      drawCircle: function drawCircle(x, y, r) {
        var ctx = this.selectionDrawContext,
            v = this.canvas.viewportTransform;
        ctx.save();
        //  ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);
        ctx.beginPath();
        ctx.arc(x, y, this.radius, 0, Math.PI * 2, false);
        ctx.closePath();
        ctx.fill();
        ctx.restore();
        MagicWand.maskSelection(this.selectionDrawCanvas, 0, 0, this.mask, 'add');
        this.setSelection(this.mask);
      }
    }
  },
  magic: {
    mouseUp: function mouseUp() {
      this.shouldModify = true;
    },
    mouseMove: function mouseMove(p) {
      if (!this.allowDraw) return;
      var dist = p.x - this.downPoint.x;

      var val = this._init_thres + dist;
      var thres = Math.min(Math.max(val, 1), 255);
      if (thres != this.colorThreshold) {
        this.setThreshold(thres);
      }
    },
    mouseDown: function mouseDown(point) {
      if (this.shouldModify) {
        this.modifySelection();
      }
      this.downPoint = point;
      this.colorThreshold = 15;
      this.fire('threshold:changed', { threshold: this.colorThreshold });
      this._init_thres = this.colorThreshold;
      this.drawMask(this.downPoint.x, this.downPoint.y, this.adjacentPixels);
      return false;
    },
    utils: {
      drawMask: function drawMask(x, y, adjacentPixels) {
        this.asyncronous(this._drawMask.bind(this, x, y, adjacentPixels), 0);
      },
      _drawMask: function _drawMask(x, y, adjacentPixels) {
        MagicWand.alphaChannel = this.alphaChannel;
        var info = this.getInfo(),
            mask;
        if (adjacentPixels) {
          MagicWand.floodFill(info, x, y, this.colorThreshold, {}, null, function (mask) {
            this.setSelection(mask);
          }.bind(this));
        } else {
          mask = MagicWand.selectAll(info, x, y, this.colorThreshold);
          this.setSelection(mask);
        }
      }
    }
  },
  rectangle: {
    mouseDown: function mouseDown(point) {
      if (this.shouldModify) {
        this.modifySelection();
      }
      this.downPoint = point;
      this.shouldModify = true;
    },
    mouseUp: function mouseUp() {
      //this.modifySelection();
      //this.resetSelectionDrawCanvas();
    },
    mouseMove: function mouseMove(p) {
      if (!this.allowDraw) return;
      this.drawRectangle(this.downPoint.x, this.downPoint.y, p.x, p.y);
    },
    utils: {
      drawRectangle: function drawRectangle(x, y, x2, y2) {
        var info = this.getInfo(),
            mask = MagicWand.selectRectangle(info, x, y, x2, y2);
        this.setSelection(mask);
      }
    }
  },
  circle: {
    mouseDown: function mouseDown(point) {
      if (this.shouldModify) {
        this.modifySelection();
      }
      this.downPoint = point;
      this.createSelectionDrawCanvas();
      this.selectionObject = new fabric.Ellipse({
        left: point.x + this.target.left,
        top: point.y + this.target.top,
        rx: 1,
        ry: 1,
        hasBorders: false,
        originX: 'center',
        originY: 'center',
        strokeWidth: 1,
        fill: 'transparent',
        stroke: 'transparent'
      });
      this.canvas.add(this.selectionObject);
      this.updateShape();
    },
    mouseUp: function mouseUp() {
      this.canvas.setInteractiveMode("mixed");
      this.selectionObject.setCoords();
      var _this = this;
      this.selectionObject.on('scaling moving rotating', function () {
        _this.updateShape();
      });
      this.canvas.setActiveObject(this.selectionObject);
      this.shouldModify = true;
      //  this.modifySelection();
      //  this.resetSelectionDrawCanvas();
    },
    mouseMove: function mouseMove(p) {
      if (!this.allowDraw) return;
      this.selectionObject.set({
        rx: Math.abs(p.x + this.target.left - this.selectionObject.get('left')),
        ry: Math.abs(p.y + this.target.top - this.selectionObject.get('top'))
      });

      this.updateShape();
    },
    utils: {
      updateShape: function updateShape() {
        this.resetSelectionDrawCanvas();
        this.selectionObject.fill = 'white';
        this.selectionDrawContext.save();
        this.selectionDrawContext.translate(-this.target.left, -this.target.top);
        this.selectionObject.render(this.selectionDrawContext);
        this.selectionDrawContext.restore();
        this.selectionObject.fill = 'transparent';
        this.mask = MagicWand.maskSelection(this.selectionDrawCanvas);
        this.setSelection(this.mask);
      }
    }
  },
  lasso: {
    mouseUp: function mouseUp() {
      if (this.readyToClosePath) {
        this._closePath();
      }
    },
    mouseMove: function mouseMove(p) {
      if (!this.allowDraw) return;
      this.drawLine(this._last_point, p);
      this._points.push(p);
      this._last_point = p;
    },
    mouseDown: function mouseDown(point) {
      if (!this.downPoint) {
        this.createSelection();
        this.createSelectionDrawCanvas();
        this._path_out = false;
        this.downPoint = point;
        this._points = [];
        this.selectionDrawContext.beginPath();
        this.canvas.on('mouse:move', this._changeCursorOverClosePoint);
      }
      if (this._last_point) {
        if (this.readyToClosePath) {
          this._closePath();
        } else {
          this.drawLine(this._last_point, point);
          this._last_point = point;
          this._points.push(point);
        }
      } else {

        this.drawLine({ x: point.x - 0.5, y: point.y }, { x: point.x + 0.5, y: point.y });
        this._last_point = { x: point.x + 0.5, y: point.y };
        this._points.push(point);
        this.shouldModify = true;
      }
    },
    utils: {
      drawLine: function drawLine(p1, p2) {
        var ctx = this.selectionDrawContext,
            v = this.canvas.viewportTransform;
        ctx.save();
        //ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);
        ctx.moveTo(p1.x, p1.y);
        ctx.lineTo(p2.x, p2.y);
        ctx.stroke();
        ctx.restore();
        MagicWand.maskSelection(this.selectionDrawCanvas, 0, 0, this.mask, 'add');
        this.setSelection(this.mask);
      },
      _closePath: function _closePath(e) {

        this.allowDraw = false;
        var ctx = this.selectionDrawContext;
        ctx.beginPath();
        ctx.moveTo(this._points[0].x, this._points[0].y);
        for (var i = 1; i < this._points.length; i++) {
          ctx.lineTo(this._points[i].x, this._points[i].y);
        }
        ctx.closePath();
        ctx.fill();
        MagicWand.maskSelection(this.selectionDrawCanvas, 0, 0, this.mask, 'add');
        this.setSelection(this.mask);
        this.resetSelectionDrawCanvas();
        this._points = [];
        delete this.downPoint;
        delete this.readyToClosePath;
        delete this._last_point;
        this.canvas.off('mouse:move', this._changeCursorOverClosePoint);
        this.canvas.freeDrawingCursor = 'crosshair';
        this.canvas.setCursor(this.canvas.freeDrawingCursor);
        // this.drawLine(this._last_point, this.downPoint);
      },
      _changeCursorOverClosePoint: function _changeCursorOverClosePoint(e) {
        var canvas = this,
            pathfinder = canvas.pathfinder;
        if (!pathfinder.target) return;
        var ivt = fabric.util.invertTransform(canvas.viewportTransform),
            p = fabric.util.transformPoint(canvas.getPointer(e.e, true), ivt);
        p.x -= pathfinder.target.left;
        p.y -= pathfinder.target.top;
        if (pathfinder.downPoint && pathfinder.downPoint.distanceFrom(p) < 10) {
          if (!pathfinder._path_out) {
            return;
          }
          pathfinder.readyToClosePath = true;
          canvas.freeDrawingCursor = canvas.targetCursor;
          canvas.setCursor(canvas.freeDrawingCursor);
          //console.log(canvas.freeDrawingCursor);
        } else {
          pathfinder._path_out = true;
          pathfinder.readyToClosePath = false;
          canvas.freeDrawingCursor = 'crosshair';
          canvas.setCursor(canvas.freeDrawingCursor);
          // console.log(canvas.freeDrawingCursor);
        }
      }
    }
  }
};
for (var i in Pathfinder.prototype.drawingTools) {
  fabric.util.object.extend(Pathfinder.prototype, Pathfinder.prototype.drawingTools[i].utils);
}
fabric.Pathfinder = Pathfinder;

fabric.util.object.extend(fabric.SlideCanvas.prototype, {
  pathfinder: false,
  setPathfinder: function setPathfinder(val) {
    if (val) {
      this.pathfinder = new fabric.Pathfinder('pathfinder');
      this.pathfinder.canvas = this;
    }
  },
  getPathfinder: function getPathfinder() {
    return this.pathfinder || this.application && this.application.pathfinder;
  }
});

fabric.util.object.extend(fabric.Application.prototype, {
  initPathfinder: function initPathfinder() {
    //if(this.pathfinder){

    this.pathfinder = new fabric.Pathfinder({
      application: this
    });

    this.pathfinder.on("image:changed", function (img) {
      var dataUrl = img.toDataURL();
      if (!this.target._originalElement) {
        this.target._originalElement = this.target._element;
      }
      this.target._element = new Image();

      this.target._element.onload = function () {
        this.target.fire("content:modified");
        this.target.canvas && this.target.canvas.renderAll();
      }.bind(this);

      this.target._element.src = dataUrl;
      this.target._edited = true;
      if (this.target.dirty !== "undefined") {
        this.target.dirty = true;
      }
    });
    //}
  }
});

fabric.util.object.extend(fabric.Application.prototype, {
  eventListeners: fabric.util.object.extendArraysObject(fabric.Application.prototype.eventListeners, {
    "ready": function ready() {
      this.initPathfinder();
    }
  })
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 87 */
/***/ (function(module, exports) {

module.exports = "PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMiAyMiI+PGcgdHJhbnNmb3JtPSJtYXRyaXgoLjAzOTY1IDAgMCAuMDM5NjUgMS4xNjMgMS4xNjMpIiBmaWxsPSIjNGQ0ZDRkIj48cGF0aCBkPSJtMjUwLjIgODEuNjFjOTcuNDMgMCAxNzkuNzUgNDMuNDMgMTc5Ljc1IDk0LjgzIDAgMTIuNDQ5LTQuOTM0IDI0LjQ0OS0xMy42NDUgMzUuNDY1bDM1LjQwMiAxMC40MDRjOC42MTMtMTQuMjI3IDEzLjUzMy0yOS42MjkgMTMuNTMzLTQ1Ljg2OSAwLTcyLjk2NS05NC40Ni0xMzAuMTItMjE1LjA0LTEzMC4xMi0xMjAuNTcgMC0yMTUuMDQgNTcuMTYtMjE1LjA0IDEzMC4xMiAwIDI2LjkxOCAxMi45MzYgNTEuNjQzIDM1LjE5IDcyLjE3LTYuOTUxIDQuNTAyLTEzLjc1NiAxMC41MDItMTguODM2IDE4Ljk4NC0xMC40NTMgMTcuNDQ5LTEwLjY2IDM5LjA5LS42NDUgNjQuMzUgOS40MzMgMjMuNzkxIDcuMTI1IDMyLjU4MiA1LjY5MyAzNS4yNC0zLjM1NCA2LjMyMi0xOC4xMyA5LjUxNC0zMi4zODUgMTIuNTk2LTMuNDg2Ljc1OC03LjA0IDEuNTMxLTEwLjU4MiAyLjM3MS05LjQ4NCAyLjI0LTE1LjM1MyAxMS43MjUtMTMuMTMgMjEuMjMgMS45MDIgOC4xMTEgOS4xNjQgMTMuNTk2IDE3LjE2IDEzLjU5NiAxLjM0IDAgMi43MDktLjE2IDQuMDY4LS40NjcgMy4zMi0uNzkxIDYuNjU2LTEuNTE4IDkuOTMyLTIuMjI3IDIxLjExLTQuNTY0IDQ1LjAyLTkuNzQyIDU2LjA4LTMwLjQ4MiA4LjQ4Ni0xNS45MDIgNy4xOTUtMzYuNTE2LTQuMDMtNjQuODUtNS43MjUtMTQuNDM1LTYuMzg1LTI1LjU2NC0xLjk0Ny0zMy4xIDQuOTY1LTguNDUxIDE2LjE0LTEyLjIwNyAyMi4xOS0xMy40NjcgMzUuNzA1IDE5LjkwMiA4Mi44NSAzMi4zNTQgMTM1LjU5IDMzLjg2OWwtMTAuNTA0LTM1Ljc0Yy04Ny44Ny01Ljc1OC0xNTguNTYtNDYuNDUtMTU4LjU2LTk0LjA3LjAwMDEtNTEuNCA4Mi4zMi05NC44MyAxNzkuNzUtOTQuODMiLz48cGF0aCBkPSJtNDg3LjU3IDI2OS42M2wtMjIyLjA1LTY1LjI3Yy0xLjExNS0uMzM4LTIuMjQ0LS40ODItMy4zNzMtLjQ4Mi0zLjExMyAwLTYuMTU4IDEuMjI3LTguNDM0IDMuNS0zLjA5NiAzLjA4LTQuMjU4IDcuNjEzLTMuMDIgMTEuNzg5bDY1LjI3IDIyMi4xYzEuMzQgNC42MTMgNS4zNTIgNy45ODIgMTAuMTQzIDguNS40NTMuMDQ3Ljg5MS4wNjQgMS4zMjIuMDY0IDQuMzA5IDAgOC4zMDctMi4zMzggMTAuNDM5LTYuMTYybDU0LjA4LTk4LjA0IDk4LjAzLTU0LjA5YzQuMjI1LTIuMzIyIDYuNjI5LTYuOTUxIDYuMS0xMS43MjctLjUxNC00Ljc4Ny0zLjg3NC04LjgwNS04LjUwMi0xMC4xNzYiLz48L2c+PC9zdmc+Cg=="

/***/ }),
/* 88 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

// require("../modules/pathfinder");
__webpack_require__(89);

fabric.util.object.extend(fabric.Image.prototype, {
  removeWhite: function removeWhite(threshold, removeAll, callback) {

    var rwf = _.findWhere(this.filters, { type: 'RemoveWhiteDP' });

    if (rwf) {
      rwf.options.colorThreshold = threshold;
      rwf.options.fromCorners = !removeAll;
    } else {
      rwf = new fabric.Image.filters.RemoveWhiteDP({
        fromCorners: !removeAll,
        blurRadius: 2,
        colorThreshold: threshold
      });
      this.filters.push(rwf);
    }

    var _this = this;
    this.applyFilters(function () {
      //_this.width = _this._element.width;
      //_this.height = _this._element.height;
      _this.canvas.renderAll();
      _this.fire("content:modified", { filter: rwf, bounds: rwf.bounds });
      callback && callback();
    });
  },
  removeWhiteAll: true,

  actions: fabric.util.object.extend(fabric.Image.prototype.actions, {
    removeWhiteFromBorders: {
      title: 'Remove Background',
      type: 'effect',
      className: "fa fa-dot-circle-o",
      effectTpl: '<button id="select-colors-action-button" class="fa fa-check"></button>' + '<input id="select-colors-checkbox" type="checkbox">' + '<input id="select-colors-threshold" type="range"   min="1" max="255">',
      actionParameters: function actionParameters(el, data) {
        var actionChk = el.find('#select-colors-checkbox'),
            actionBtn = el.find('#select-colors-action-button');
        data.thresholdEl = el.find('#select-colors-threshold');

        data.removeWhiteAll = actionChk.is(":checked");
        actionChk.change(function () {
          data.removeWhiteAll = actionChk.is(":checked");
        });
        actionBtn.click(function () {
          data.action();
        });
        if (!data.__action) {

          data.__action = data.action;
          data.action = function () {
            data.__action(parseInt(data.thresholdEl.val()), data.removeWhiteAll);
          };
        }
      },
      action: "removeWhite",
      insert: 'imageTools'
    }
  })
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 89 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.RemoveWhiteDP = fabric.Image.filters.RemoveWhiteDP = fabric.util.createClass(fabric.Image.filters.BaseFilter, {
    type: 'RemoveWhiteDP',
    initialize: function initialize(options) {
        if (options) delete options.type;
        this.options = fabric.util.object.defaults(options || {}, {
            fromCorners: true,
            blurRadius: 2,
            colorThreshold: 32
        });
        this.pathfinder = new fabric.Pathfinder(this.options);
    },
    applyTo: function applyTo(canvasEl) {

        var pathfinder = this.pathfinder;

        pathfinder.colorThreshold = this.options.colorThreshold;
        pathfinder.setPicture(canvasEl);
        pathfinder.selectBackground(this.options.fromCorners);
        if (pathfinder.mask.count) {
            pathfinder._fill([0, 0, 0, 0]);
            pathfinder.mask = fabric.MagicWand.invertMask(pathfinder.mask);
            //todo inverting mask

            if (pathfinder.mask.count) {
                var _width = pathfinder.mask.bounds.maxX - pathfinder.mask.bounds.minX + 1;
                var _height = pathfinder.mask.bounds.maxY - pathfinder.mask.bounds.minY + 1;
                var ctx = canvasEl.getContext('2d');
                var imageData = pathfinder.editedImageCanvas.getContext('2d').getImageData(pathfinder.mask.bounds.minX, pathfinder.mask.bounds.minY, _width, _height);
                canvasEl.width = _width;
                canvasEl.height = _height;
                ctx.putImageData(imageData, 0, 0);
                this.bounds = pathfinder.mask.bounds;
            } else {
                var ctx = canvasEl.getContext('2d');
                canvasEl.width = 1;
                canvasEl.height = 1;
                ctx.clearRect(0, 0, 1, 1);
                this.bounds = {
                    maxX: 0,
                    maxY: 0,
                    minX: 0,
                    minY: 0
                };
            }
        }

        //clip the image
        pathfinder.clearMemory();
    },
    toObject: function toObject() {
        return fabric.util.object.extend(this.callSuper('toObject'), this.options);
    }
});

fabric.Image.filters.RemoveWhiteDP.fromObject = function (object) {
    return new fabric.Image.filters.RemoveWhiteDP(object);
};
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 90 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

//----------------------------------------------------------------------------------------------------------------------
// ListStyle

fabric.util.object.extend(fabric.Textbox.prototype, {
  stateProperties: fabric.Textbox.prototype.stateProperties.concat(["listStyleType", "listStyleFormat", "listTextPadding", "textPadding"]),
  listStyleType: "none",
  listStyleFormat: "N.",
  listTextPadding: 40,
  textPadding: 0,
  setTextPadding: function setTextPadding(val) {
    this.textPadding = val;
    this._initDimensions();
  },
  setListStyleType: function setListStyleType(val) {
    this.listStyleType = val;
    this.setTextPadding(val === "none" ? 0 : this.listTextPadding);
  },
  /**
   * Wraps text using the 'width' property of Textbox. First this function
   * splits text on newlines, so we preserve newlines entered by the user.
   * Then it wraps each line using the width of the Textbox by calling
   * _wrapLine().
   * @param {CanvasRenderingContext2D} ctx Context to use for measurements
   * @param {String} text The string of text that is split into lines
   * @returns {Array} Array of lines
   */
  _wrapText: function _wrapText(ctx, text) {
    var lines = text.split(this._reNewline),
        wrapped = [],
        i;

    this._paragraphs = {};

    for (i = 0; i < lines.length; i++) {
      this._paragraphs[wrapped.length] = this.listStyleFormat.replace("N", i + 1);
      wrapped = wrapped.concat(this._wrapLine(ctx, lines[i], i));
    }

    return wrapped;
  },

  /**
   * Wraps a line of text using the width of the Textbox and a context.
   * @param {CanvasRenderingContext2D} ctx Context to use for measurements
   * @param {String} text The string of text to split into lines
   * @param {Number} lineIndex
   * @returns {Array} Array of line(s) into which the given text is wrapped
   * to.
   */
  _wrapLine: function _wrapLine(ctx, text, lineIndex) {
    var lineWidth = 0,
        lines = [],
        line = '',
        words = text.split(' '),
        word = '',
        offset = 0,
        infix = ' ',
        wordWidth = 0,
        infixWidth = 0,
        largestWordWidth = 0,
        lineJustStarted = true,
        additionalSpace = this._getWidthOfCharSpacing();

    var _textAreaWidth = this.width;
    if (this.textPadding) {
      _textAreaWidth -= this.textPadding;
    }
    for (var i = 0; i < words.length; i++) {
      word = words[i];
      wordWidth = this._measureText(ctx, word, lineIndex, offset);

      offset += word.length;

      lineWidth += infixWidth + wordWidth - additionalSpace;

      if (lineWidth >= _textAreaWidth && !lineJustStarted) {
        lines.push(line);
        line = '';
        lineWidth = wordWidth;
        lineJustStarted = true;
      } else {
        lineWidth += additionalSpace;
      }

      if (!lineJustStarted) {
        line += infix;
      }
      line += word;

      infixWidth = this._measureText(ctx, infix, lineIndex, offset);
      offset++;
      lineJustStarted = false;
      // keep track of largest word
      if (wordWidth > largestWordWidth) {
        largestWordWidth = wordWidth;
      }
    }

    i && lines.push(line);

    if (largestWordWidth > this.dynamicMinWidth) {
      this.dynamicMinWidth = largestWordWidth - additionalSpace;
    }

    return lines;
  },
  /**
   * @private
   * @param {Number} lineWidth Width of text line
   * @return {Number} Line left offset
   */
  _getLineLeftOffset: function _getLineLeftOffset(lineWidth) {
    if (this.textAlign === 'center') {
      return (this.width - lineWidth) / 2 + this.textPadding / 2;
    }
    if (this.textAlign === 'right') {
      return this.width - lineWidth;
    }
    return this.textPadding;
  },
  /**
   * @private
   * @param {CanvasRenderingContext2D} ctx Context to render on
   * @param {String} method Method name ("fillText" or "strokeText")
   */
  _renderTextCommon: function _renderTextCommon(ctx, method) {

    var lineHeights = 0,
        left = this._getLeftOffset(),
        top = this._getTopOffset();

    for (var i = 0, len = this._textLines.length; i < len; i++) {
      var heightOfLine = this._getHeightOfLine(ctx, i),
          maxHeight = heightOfLine / this.lineHeight,
          lineWidth = this._getLineWidth(ctx, i),
          leftOffset = this._getLineLeftOffset(lineWidth);

      this._renderTextLine(method, ctx, this._textLines[i], left + leftOffset, top + lineHeights + maxHeight, i);
      lineHeights += heightOfLine;
    }
  },

  /**
   * @private
   * @param {String} method Method name ("fillText" or "strokeText")
   * @param {CanvasRenderingContext2D} ctx Context to render on
   * @param {String} line Text to render
   * @param {Number} left Left position of text
   * @param {Number} top Top position of text
   * @param {Number} lineIndex Index of a line in a text
   */
  _renderTextLine: function _renderTextLine(method, ctx, line, left, top, lineIndex) {

    // lift the line by quarter of fontSize
    top -= this.fontSize * this._fontSizeFraction;

    switch (this.listStyleType) {
      case "decimal":
        if (this._paragraphs[lineIndex]) {
          // lift the line by quarter of fontSize
          this._renderChars(method, ctx, this._paragraphs[lineIndex], left - this.textPadding, top, lineIndex, 0);
        }
    }

    // short-circuit
    var lineWidth = this._getLineWidth(ctx, lineIndex);
    if (this.textAlign !== 'justify' || this.width < lineWidth) {

      this._renderChars(method, ctx, line, left, top, lineIndex);
      return;
    }

    // stretch the line
    var words = line.split(/\s+/),
        charOffset = 0,
        wordsWidth = this._getWidthOfWords(ctx, words.join(''), lineIndex, 0),
        widthDiff = this.width - wordsWidth - this.textPadding,
        numSpaces = words.length - 1,
        spaceWidth = numSpaces > 0 ? widthDiff / numSpaces : 0,
        leftOffset = 0,
        word;

    for (var i = 0, len = words.length; i < len; i++) {
      while (line[charOffset] === ' ' && charOffset < line.length) {
        charOffset++;
      }
      word = words[i];
      this._renderChars(method, ctx, word, left + leftOffset, top, lineIndex, charOffset);
      leftOffset += this._getWidthOfWords(ctx, word, lineIndex, charOffset) + spaceWidth;
      charOffset += word.length;
    }
  },
  toggleListStyleType: function toggleListStyleType() {
    this.setListStyleType(this.listStyleType == "none" ? "decimal" : "none");
    this.canvas.renderAll();
  },
  actions: {
    toggleListStyleType: {
      className: 'fa fa-list-ol',
      title: 'ordered list'
    }
  }

});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 91 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.TextFrame = fabric.util.createClass(fabric.Textbox, {
    type: 'TextFrame',
    initialize: function initialize(text, options) {
        this.ctx = fabric.util.createCanvasElement().getContext("2d");
        this.callSuper("initialize", text, options);
        this.set({
            lockUniScaling: options.lockScalingY || false,
            lockScalingFlip: options.lockScalingFlip || false,
            lockScalingY: options.lockScalingY || false,
            hasBorders: true
        });
        //this.setControlsVisibility(fabric.Textbox.getTextboxControlVisibility());
        this._dimensionAffectingProps.width = true;
        this.on("changed", this.fitText.bind(this));
        this.fitText();
    },
    setWidth: function setWidth(w) {
        this.width = w;
        this.fitText();
    },
    setHeight: function setHeight(h) {
        this.height = h;
        this.fitText();
    },
    _initDimensions: function _initDimensions(ctx) {
        if (this.__skipDimension) {
            return;
        }
        if (!ctx) {
            ctx = fabric.util.createCanvasElement().getContext("2d");
            this._setTextStyles(ctx);
        }
        this.dynamicMinWidth = 0;
        this._textLines = this._splitTextIntoLines();
        this._clearCache();
    },
    fitText: function fitText() {

        while (this._getTextHeight() < this.height) {
            this.fontSize++;
            this._initDimensions(this.ctx);
        }

        while (this._getTextHeight() > this.height || this.dynamicMinWidth > this.width) {
            this.fontSize--;
            this._initDimensions(this.ctx);
        }
        //this.lineHeight = (this.height / this._textLines.length) / this.fontSize / this._fontSizeMult;
    }
});
//
//Object.defineProperty(fabric.TextFrame, "width", {
//    get: function() {
//        return this._w;
//    },
//    set: function(slide) {
//        console.log(slide);
//        this._w = slide;
//    }
//});


fabric.TextFrame.fromObject = function (object, callback) {
    var _total = 0,
        loaded = 0;
    function create() {
        var f = new fabric.TextFrame(object.text, object);
        callback && callback(f);
    }
    fabric.util.data.recoursive(object, function (property, value, parent) {

        if (property == "pattern") {
            _total++;
            //  var _texture = _.findWhere(o.project.textures,{id: parent[property]});

            var _texture = fabric.texturesPath + parent[property];

            fabric.util.loadImage(_texture, function (img) {
                //this[property] = new fabric.Image(img);

                parent["fill"] = new fabric.Pattern({
                    source: img,
                    repeat: "repeat"
                });
                delete parent[property];
                loaded++;
                if (_total == loaded) create();
            });

            //
            //parent["fill"] = new fabric.Pattern({
            //    source: _texture,
            //    repeat: "repeat"
            //});
        }
    });
    if (_total == loaded) {
        return create();
    }
};
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 92 */
/***/ (function(module, exports) {

module.exports = "PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgICB4bWxuczppbmtzY2FwZT0iaHR0cDovL3d3dy5pbmtzY2FwZS5vcmcvbmFtZXNwYWNlcy9pbmtzY2FwZSIKICAgIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyIKICAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgIHhtbG5zOmNjPSJodHRwOi8vY3JlYXRpdmVjb21tb25zLm9yZy9ucyMiCiAgICB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIKICAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgICB4bWxuczpuczE9Imh0dHA6Ly9zb3ppLmJhaWVyb3VnZS5mciIKICAgIGlkPSJzdmc0ODg4IgogICAgc29kaXBvZGk6ZG9jbmFtZT0id2FybmluZ19idXR0b24uc3ZnIgogICAgdmlld0JveD0iMCAwIDQwMCA0MDAiCiAgICB2ZXJzaW9uPSIxLjEiCiAgICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ4LjAgcjk2NTQiCiAgPgogIDxkZWZzCiAgICAgIGlkPSJkZWZzNDg5MCIKICAgID4KICAgIDxsaW5lYXJHcmFkaWVudAogICAgICAgIGlkPSJsaW5lYXJHcmFkaWVudDg0MTEiCiAgICAgICAgeTI9IjM2Ny44OCIKICAgICAgICBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIKICAgICAgICB5MT0iMjg3LjQ5IgogICAgICAgIHgyPSIzMTUuNDciCiAgICAgICAgeDE9IjI0MS40MSIKICAgICAgICBpbmtzY2FwZTpjb2xsZWN0PSJhbHdheXMiCiAgICAgID4KICAgICAgPHN0b3AKICAgICAgICAgIGlkPSJzdG9wNDE1OCIKICAgICAgICAgIHN0eWxlPSJzdG9wLWNvbG9yOiNmZmZmZmYiCiAgICAgICAgICBvZmZzZXQ9IjAiCiAgICAgIC8+CiAgICAgIDxzdG9wCiAgICAgICAgICBpZD0ic3RvcDQxNjAiCiAgICAgICAgICBzdHlsZT0ic3RvcC1jb2xvcjojZmZmZmZmO3N0b3Atb3BhY2l0eTowIgogICAgICAgICAgb2Zmc2V0PSIxIgogICAgICAvPgogICAgPC9saW5lYXJHcmFkaWVudAogICAgPgogICAgPGZpbHRlcgogICAgICAgIGlkPSJmaWx0ZXI2MTI2IgogICAgICAgIGNvbG9yLWludGVycG9sYXRpb24tZmlsdGVycz0ic1JHQiIKICAgICAgICBpbmtzY2FwZTpjb2xsZWN0PSJhbHdheXMiCiAgICAgID4KICAgICAgPGZlR2F1c3NpYW5CbHVyCiAgICAgICAgICBpZD0iZmVHYXVzc2lhbkJsdXI2MTI4IgogICAgICAgICAgc3RkRGV2aWF0aW9uPSIwLjUzMDM1NzEzIgogICAgICAgICAgaW5rc2NhcGU6Y29sbGVjdD0iYWx3YXlzIgogICAgICAvPgogICAgPC9maWx0ZXIKICAgID4KICAgIDxsaW5lYXJHcmFkaWVudAogICAgICAgIGlkPSJsaW5lYXJHcmFkaWVudDg0MTMiCiAgICAgICAgeTI9IjM5MS40NSIKICAgICAgICBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIKICAgICAgICB5MT0iMzAwLjg2IgogICAgICAgIHgyPSIzNDIiCiAgICAgICAgeDE9IjI3NS42MSIKICAgICAgICBpbmtzY2FwZTpjb2xsZWN0PSJhbHdheXMiCiAgICAgID4KICAgICAgPHN0b3AKICAgICAgICAgIGlkPSJzdG9wNzIwMSIKICAgICAgICAgIHN0eWxlPSJzdG9wLWNvbG9yOiM1NTAwMDAiCiAgICAgICAgICBvZmZzZXQ9IjAiCiAgICAgIC8+CiAgICAgIDxzdG9wCiAgICAgICAgICBpZD0ic3RvcDcyMDMiCiAgICAgICAgICBzdHlsZT0ic3RvcC1jb2xvcjojZmYwMDAwIgogICAgICAgICAgb2Zmc2V0PSIxIgogICAgICAvPgogICAgPC9saW5lYXJHcmFkaWVudAogICAgPgogICAgPHJhZGlhbEdyYWRpZW50CiAgICAgICAgaWQ9InJhZGlhbEdyYWRpZW50ODQxNSIKICAgICAgICBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIKICAgICAgICBjeD0iMzEyLjc4IgogICAgICAgIGN5PSIzODYuNTciCiAgICAgICAgcj0iNTMuMDM2IgogICAgICAgIGdyYWRpZW50VHJhbnNmb3JtPSJtYXRyaXgoLS41OTMyNyAtLjU5MzI3IC43MTUwNSAtLjcxNTA1IDI0My4yNyA4NDkuMDMpIgogICAgICAgIGlua3NjYXBlOmNvbGxlY3Q9ImFsd2F5cyIKICAgICAgPgogICAgICA8c3RvcAogICAgICAgICAgaWQ9InN0b3A3MTEzLTciCiAgICAgICAgICBzdHlsZT0ic3RvcC1jb2xvcjojZmZmZmZmO3N0b3Atb3BhY2l0eTouNDA4MTYiCiAgICAgICAgICBvZmZzZXQ9IjAiCiAgICAgIC8+CiAgICAgIDxzdG9wCiAgICAgICAgICBpZD0ic3RvcDcxMTUtNyIKICAgICAgICAgIHN0eWxlPSJzdG9wLWNvbG9yOiNmZmZmZmY7c3RvcC1vcGFjaXR5OjAiCiAgICAgICAgICBvZmZzZXQ9IjEiCiAgICAgIC8+CiAgICA8L3JhZGlhbEdyYWRpZW50CiAgICA+CiAgICA8bGluZWFyR3JhZGllbnQKICAgICAgICBpZD0ibGluZWFyR3JhZGllbnQxMDQ0OSIKICAgICAgICB5Mj0iMzM4LjgyIgogICAgICAgIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIgogICAgICAgIHkxPSIyODYuNjciCiAgICAgICAgZ3JhZGllbnRUcmFuc2Zvcm09Im1hdHJpeCguOTU1MzQgMCAwIC45NTUzNCAxMzYuMTIgMTQuMDU1KSIKICAgICAgICB4Mj0iMzAwLjI3IgogICAgICAgIHgxPSIyNTUuMzIiCiAgICAgICAgaW5rc2NhcGU6Y29sbGVjdD0iYWx3YXlzIgogICAgICA+CiAgICAgIDxzdG9wCiAgICAgICAgICBpZD0ic3RvcDQxNTAiCiAgICAgICAgICBzdHlsZT0ic3RvcC1jb2xvcjojZmZmZmZmIgogICAgICAgICAgb2Zmc2V0PSIwIgogICAgICAvPgogICAgICA8c3RvcAogICAgICAgICAgaWQ9InN0b3A0MTUyIgogICAgICAgICAgc3R5bGU9InN0b3AtY29sb3I6I2ZmZmZmZjtzdG9wLW9wYWNpdHk6MCIKICAgICAgICAgIG9mZnNldD0iMSIKICAgICAgLz4KICAgIDwvbGluZWFyR3JhZGllbnQKICAgID4KICAgIDxmaWx0ZXIKICAgICAgICBpZD0iZmlsdGVyMTE0MjgiCiAgICAgICAgY29sb3ItaW50ZXJwb2xhdGlvbi1maWx0ZXJzPSJzUkdCIgogICAgICAgIGlua3NjYXBlOmNvbGxlY3Q9ImFsd2F5cyIKICAgICAgPgogICAgICA8ZmVHYXVzc2lhbkJsdXIKICAgICAgICAgIGlkPSJmZUdhdXNzaWFuQmx1cjExNDMwIgogICAgICAgICAgc3RkRGV2aWF0aW9uPSIxLjI0MzQ2NzgiCiAgICAgICAgICBpbmtzY2FwZTpjb2xsZWN0PSJhbHdheXMiCiAgICAgIC8+CiAgICA8L2ZpbHRlcgogICAgPgogIDwvZGVmcwogID4KICA8c29kaXBvZGk6bmFtZWR2aWV3CiAgICAgIGlkPSJiYXNlIgogICAgICBib3JkZXJjb2xvcj0iIzY2NjY2NiIKICAgICAgaW5rc2NhcGU6cGFnZXNoYWRvdz0iMiIKICAgICAgaW5rc2NhcGU6d2luZG93LXk9Ii04IgogICAgICBwYWdlY29sb3I9IiNmZmZmZmYiCiAgICAgIGlua3NjYXBlOndpbmRvdy1oZWlnaHQ9Ijk4OCIKICAgICAgaW5rc2NhcGU6d2luZG93LW1heGltaXplZD0iMSIKICAgICAgaW5rc2NhcGU6em9vbT0iMC43MDcxMDY3OCIKICAgICAgaW5rc2NhcGU6d2luZG93LXg9Ii04IgogICAgICBzaG93Z3JpZD0iZmFsc2UiCiAgICAgIGJvcmRlcm9wYWNpdHk9IjEuMCIKICAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ibGF5ZXIxIgogICAgICBpbmtzY2FwZTpjeD0iMzA0Ljg5NDA5IgogICAgICBpbmtzY2FwZTpjeT0iMzQxLjUyMTg2IgogICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9IjE2ODAiCiAgICAgIGlua3NjYXBlOnBhZ2VvcGFjaXR5PSIwLjAiCiAgICAgIGlua3NjYXBlOmRvY3VtZW50LXVuaXRzPSJweCIKICAvPgogIDxnCiAgICAgIGlkPSJsYXllcjEiCiAgICAgIGlua3NjYXBlOmxhYmVsPSJMYXllciAxIgogICAgICBpbmtzY2FwZTpncm91cG1vZGU9ImxheWVyIgogICAgICB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwIC02NTIuMzYpIgogICAgPgogICAgPGcKICAgICAgICBpZD0iZzExNDMyIgogICAgICAgIGlua3NjYXBlOmV4cG9ydC15ZHBpPSI5MCIKICAgICAgICBpbmtzY2FwZTpleHBvcnQteGRwaT0iOTAiCiAgICAgICAgdHJhbnNmb3JtPSJtYXRyaXgoMi45MDUxIDAgMCAyLjkwNTEgLTEwMDEuOSAtNzguOTYxKSIKICAgICAgPgogICAgICA8cGF0aAogICAgICAgICAgaWQ9InBhdGg3Mjc2IgogICAgICAgICAgc29kaXBvZGk6cng9IjUzLjAzNTcxMyIKICAgICAgICAgIHNvZGlwb2RpOnJ5PSI1My4wMzU3MTMiCiAgICAgICAgICBzdHlsZT0iZmlsbDojOTk5OTk5IgogICAgICAgICAgc29kaXBvZGk6dHlwZT0iYXJjIgogICAgICAgICAgZD0ibTM1Ni43OSAzNDYuMTFjMCAyOS4yOTEtMjMuNzQ1IDUzLjAzNi01My4wMzYgNTMuMDM2cy01My4wMzYtMjMuNzQ1LTUzLjAzNi01My4wMzYgMjMuNzQ1LTUzLjAzNiA1My4wMzYtNTMuMDM2IDUzLjAzNiAyMy43NDUgNTMuMDM2IDUzLjAzNnoiCiAgICAgICAgICB0cmFuc2Zvcm09Im1hdHJpeCguOTczNTQgMCAwIC45NzM1NCAxMjAuMDkgLTEyLjYyOCkiCiAgICAgICAgICBzb2RpcG9kaTpjeT0iMzQ2LjExMjE4IgogICAgICAgICAgc29kaXBvZGk6Y3g9IjMwMy43NSIKICAgICAgLz4KICAgICAgPHBhdGgKICAgICAgICAgIGlkPSJwYXRoNzI3OCIKICAgICAgICAgIHNvZGlwb2RpOnJ4PSI1My4wMzU3MTMiCiAgICAgICAgICBzb2RpcG9kaTpyeT0iNTMuMDM1NzEzIgogICAgICAgICAgc3R5bGU9ImZpbGw6dXJsKCNsaW5lYXJHcmFkaWVudDg0MTEpIgogICAgICAgICAgc29kaXBvZGk6dHlwZT0iYXJjIgogICAgICAgICAgZD0ibTM1Ni43OSAzNDYuMTFjMCAyOS4yOTEtMjMuNzQ1IDUzLjAzNi01My4wMzYgNTMuMDM2cy01My4wMzYtMjMuNzQ1LTUzLjAzNi01My4wMzYgMjMuNzQ1LTUzLjAzNiA1My4wMzYtNTMuMDM2IDUzLjAzNiAyMy43NDUgNTMuMDM2IDUzLjAzNnoiCiAgICAgICAgICB0cmFuc2Zvcm09Im1hdHJpeCguOTU5NjAgMCAwIC45NTk2MCAxMjQuMzMgLTcuODAxNCkiCiAgICAgICAgICBzb2RpcG9kaTpjeT0iMzQ2LjExMjE4IgogICAgICAgICAgc29kaXBvZGk6Y3g9IjMwMy43NSIKICAgICAgLz4KICAgICAgPHBhdGgKICAgICAgICAgIGlkPSJwYXRoNzI4MCIKICAgICAgICAgIHNvZGlwb2RpOnJ4PSI1My4wMzU3MTMiCiAgICAgICAgICBzb2RpcG9kaTpyeT0iNTMuMDM1NzEzIgogICAgICAgICAgc3R5bGU9ImZpbHRlcjp1cmwoI2ZpbHRlcjYxMjYpO2ZpbGw6I2VjZWNlYyIKICAgICAgICAgIHNvZGlwb2RpOnR5cGU9ImFyYyIKICAgICAgICAgIGQ9Im0zNTYuNzkgMzQ2LjExYzAgMjkuMjkxLTIzLjc0NSA1My4wMzYtNTMuMDM2IDUzLjAzNnMtNTMuMDM2LTIzLjc0NS01My4wMzYtNTMuMDM2IDIzLjc0NS01My4wMzYgNTMuMDM2LTUzLjAzNiA1My4wMzYgMjMuNzQ1IDUzLjAzNiA1My4wMzZ6IgogICAgICAgICAgdHJhbnNmb3JtPSJtYXRyaXgoLjg3MzU1IDAgMCAuODczNTUgMTUwLjQ3IDIxLjk4MSkiCiAgICAgICAgICBzb2RpcG9kaTpjeT0iMzQ2LjExMjE4IgogICAgICAgICAgc29kaXBvZGk6Y3g9IjMwMy43NSIKICAgICAgLz4KICAgICAgPHBhdGgKICAgICAgICAgIGlkPSJwYXRoNzI4MiIKICAgICAgICAgIHNvZGlwb2RpOnJ4PSI1My4wMzU3MTMiCiAgICAgICAgICBzb2RpcG9kaTpyeT0iNTMuMDM1NzEzIgogICAgICAgICAgc3R5bGU9ImZpbHRlcjp1cmwoI2ZpbHRlcjYxMjYpO2ZpbGw6Izk5OTk5OSIKICAgICAgICAgIHNvZGlwb2RpOnR5cGU9ImFyYyIKICAgICAgICAgIGQ9Im0zNTYuNzkgMzQ2LjExYzAgMjkuMjkxLTIzLjc0NSA1My4wMzYtNTMuMDM2IDUzLjAzNnMtNTMuMDM2LTIzLjc0NS01My4wMzYtNTMuMDM2IDIzLjc0NS01My4wMzYgNTMuMDM2LTUzLjAzNiA1My4wMzYgMjMuNzQ1IDUzLjAzNiA1My4wMzZ6IgogICAgICAgICAgdHJhbnNmb3JtPSJtYXRyaXgoLjgzODM4IDAgMCAuODM4MzggMTYxLjE1IDM0LjE1MikiCiAgICAgICAgICBzb2RpcG9kaTpjeT0iMzQ2LjExMjE4IgogICAgICAgICAgc29kaXBvZGk6Y3g9IjMwMy43NSIKICAgICAgLz4KICAgICAgPHBhdGgKICAgICAgICAgIGlkPSJwYXRoNzI4NCIKICAgICAgICAgIHNvZGlwb2RpOnJ4PSI1My4wMzU3MTMiCiAgICAgICAgICBzb2RpcG9kaTpyeT0iNTMuMDM1NzEzIgogICAgICAgICAgc3R5bGU9ImZpbGw6dXJsKCNsaW5lYXJHcmFkaWVudDg0MTMpIgogICAgICAgICAgc29kaXBvZGk6dHlwZT0iYXJjIgogICAgICAgICAgZD0ibTM1Ni43OSAzNDYuMTFjMCAyOS4yOTEtMjMuNzQ1IDUzLjAzNi01My4wMzYgNTMuMDM2cy01My4wMzYtMjMuNzQ1LTUzLjAzNi01My4wMzYgMjMuNzQ1LTUzLjAzNiA1My4wMzYtNTMuMDM2IDUzLjAzNiAyMy43NDUgNTMuMDM2IDUzLjAzNnoiCiAgICAgICAgICB0cmFuc2Zvcm09Im1hdHJpeCguODA1ODcgMCAwIC44MDU4NyAxNzEuMDMgNDUuNDA1KSIKICAgICAgICAgIHNvZGlwb2RpOmN5PSIzNDYuMTEyMTgiCiAgICAgICAgICBzb2RpcG9kaTpjeD0iMzAzLjc1IgogICAgICAvPgogICAgICA8cGF0aAogICAgICAgICAgaWQ9InBhdGg3Mjg2IgogICAgICAgICAgc29kaXBvZGk6cng9IjUzLjAzNTcxMyIKICAgICAgICAgIHNvZGlwb2RpOnJ5PSI1My4wMzU3MTMiCiAgICAgICAgICBzdHlsZT0iZmlsbDp1cmwoI3JhZGlhbEdyYWRpZW50ODQxNSkiCiAgICAgICAgICBzb2RpcG9kaTp0eXBlPSJhcmMiCiAgICAgICAgICBkPSJtMzU2Ljc5IDM0Ni4xMWMwIDI5LjI5MS0yMy43NDUgNTMuMDM2LTUzLjAzNiA1My4wMzZzLTUzLjAzNi0yMy43NDUtNTMuMDM2LTUzLjAzNiAyMy43NDUtNTMuMDM2IDUzLjAzNi01My4wMzYgNTMuMDM2IDIzLjc0NSA1My4wMzYgNTMuMDM2eiIKICAgICAgICAgIHRyYW5zZm9ybT0ibWF0cml4KC43NTgyNSAwIDAgLjc1ODI1IDE4Ni43NSA2My45MDYpIgogICAgICAgICAgc29kaXBvZGk6Y3k9IjM0Ni4xMTIxOCIKICAgICAgICAgIHNvZGlwb2RpOmN4PSIzMDMuNzUiCiAgICAgIC8+CiAgICAgIDxwYXRoCiAgICAgICAgICBpZD0icGF0aDcyODgiCiAgICAgICAgICBzdHlsZT0ib3BhY2l0eTouMzE3NzE7ZmlsbDp1cmwoI2xpbmVhckdyYWRpZW50MTA0NDkpIgogICAgICAgICAgaW5rc2NhcGU6Y29ubmVjdG9yLWN1cnZhdHVyZT0iMCIKICAgICAgICAgIGQ9Im00MTQuOCAyODQuMTVjLTEzLjMzMSAwLjMwMDY5LTI2LjE4NiA3LjM1OC0zMy4zMzYgMTkuNzQyLTcuNjkwMyAxMy4zMi02LjcxMzkgMjkuMjY2IDEuMTU0NSA0MS4zMzEgMC44NTMwNi0yNi41MzIgMjEuMTMyLTQ2LjUxNSA0Ni4zMjQtNDUuMDU0IDguMjU4OSAwLjQ3OTA3IDE2LjA1NCAzLjIwMDEgMjIuODU5IDcuNTkwOC0zLjI1NzgtNy40NDk4LTguODE3MS0xMy45NTMtMTYuMzk0LTE4LjMyNy02LjQ4NjctMy43NDUxLTEzLjYyNS01LjQzOTMtMjAuNjA4LTUuMjgxOHoiCiAgICAgIC8+CiAgICAgIDxwYXRoCiAgICAgICAgICBpZD0icmVjdDczNzAiCiAgICAgICAgICBkPSJtNDAyLjg4IDMwMC4wOS0xMS41ODEgMTEuNTgxIDEzLjI5NSAxMy4yOTUtMTMuMjk1IDEzLjI4MSAxMS41ODEgMTEuNTgxIDEzLjI4MS0xMy4yOTUgMTMuMjk1IDEzLjI5NSAxMS41ODEtMTEuNTgxLTEzLjI4MS0xMy4yODEgMTMuMjgxLTEzLjI5NS0xMS41ODEtMTEuNTgxLTEzLjI5NSAxMy4yODEtMTMuMjgxLTEzLjI4MXoiCiAgICAgICAgICBzdHlsZT0iZmlsdGVyOnVybCgjZmlsdGVyMTE0MjgpO2ZpbGw6IzFhMWExYSIKICAgICAgICAgIGlua3NjYXBlOmNvbm5lY3Rvci1jdXJ2YXR1cmU9IjAiCiAgICAgIC8+CiAgICAgIDxwYXRoCiAgICAgICAgICBpZD0icGF0aDEwNDU3IgogICAgICAgICAgc3R5bGU9ImZpbGw6I2ZmZmZmZiIKICAgICAgICAgIGlua3NjYXBlOmNvbm5lY3Rvci1jdXJ2YXR1cmU9IjAiCiAgICAgICAgICBkPSJtNDAzLjQ1IDMwMS4xNS0xMS4wODcgMTEuMDg3IDEyLjcyOCAxMi43MjgtMTIuNzI4IDEyLjcxNCAxMS4wODcgMTEuMDg3IDEyLjcxNC0xMi43MjggMTIuNzI4IDEyLjcyOCAxMS4wODctMTEuMDg3LTEyLjcxNC0xMi43MTQgMTIuNzE0LTEyLjcyOC0xMS4wODctMTEuMDg3LTEyLjcyOCAxMi43MTQtMTIuNzE0LTEyLjcxNHoiCiAgICAgIC8+CiAgICA8L2cKICAgID4KICA8L2cKICA+CiAgPG1ldGFkYXRhCiAgICA+CiAgICA8cmRmOlJERgogICAgICA+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgPgogICAgICAgIDxkYzpmb3JtYXQKICAgICAgICAgID5pbWFnZS9zdmcreG1sPC9kYzpmb3JtYXQKICAgICAgICA+CiAgICAgICAgPGRjOnR5cGUKICAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIKICAgICAgICAvPgogICAgICAgIDxjYzpsaWNlbnNlCiAgICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbGljZW5zZXMvcHVibGljZG9tYWluLyIKICAgICAgICAvPgogICAgICAgIDxkYzpwdWJsaXNoZXIKICAgICAgICAgID4KICAgICAgICAgIDxjYzpBZ2VudAogICAgICAgICAgICAgIHJkZjphYm91dD0iaHR0cDovL29wZW5jbGlwYXJ0Lm9yZy8iCiAgICAgICAgICAgID4KICAgICAgICAgICAgPGRjOnRpdGxlCiAgICAgICAgICAgICAgPk9wZW5jbGlwYXJ0PC9kYzp0aXRsZQogICAgICAgICAgICA+CiAgICAgICAgICA8L2NjOkFnZW50CiAgICAgICAgICA+CiAgICAgICAgPC9kYzpwdWJsaXNoZXIKICAgICAgICA+CiAgICAgICAgPGRjOnRpdGxlCiAgICAgICAgICA+ZXJyb3IgYnV0dG9uPC9kYzp0aXRsZQogICAgICAgID4KICAgICAgICA8ZGM6ZGF0ZQogICAgICAgICAgPjIwMTEtMDItMjRUMTc6NDU6NDU8L2RjOmRhdGUKICAgICAgICA+CiAgICAgICAgPGRjOmRlc2NyaXB0aW9uCiAgICAgICAgLz4KICAgICAgICA8ZGM6c291cmNlCiAgICAgICAgICA+aHR0cHM6Ly9vcGVuY2xpcGFydC5vcmcvZGV0YWlsLzEyMjQyNS9lcnJvci1idXR0b24tYnktcmljYXJkb21haWE8L2RjOnNvdXJjZQogICAgICAgID4KICAgICAgICA8ZGM6Y3JlYXRvcgogICAgICAgICAgPgogICAgICAgICAgPGNjOkFnZW50CiAgICAgICAgICAgID4KICAgICAgICAgICAgPGRjOnRpdGxlCiAgICAgICAgICAgICAgPnJpY2FyZG9tYWlhPC9kYzp0aXRsZQogICAgICAgICAgICA+CiAgICAgICAgICA8L2NjOkFnZW50CiAgICAgICAgICA+CiAgICAgICAgPC9kYzpjcmVhdG9yCiAgICAgICAgPgogICAgICAgIDxkYzpzdWJqZWN0CiAgICAgICAgICA+CiAgICAgICAgICA8cmRmOkJhZwogICAgICAgICAgICA+CiAgICAgICAgICAgIDxyZGY6bGkKICAgICAgICAgICAgICA+YnV0dG9uPC9yZGY6bGkKICAgICAgICAgICAgPgogICAgICAgICAgICA8cmRmOmxpCiAgICAgICAgICAgICAgPmNhbmNlbDwvcmRmOmxpCiAgICAgICAgICAgID4KICAgICAgICAgICAgPHJkZjpsaQogICAgICAgICAgICAgID5jaXJjbGU8L3JkZjpsaQogICAgICAgICAgICA+CiAgICAgICAgICAgIDxyZGY6bGkKICAgICAgICAgICAgICA+ZGVsZXRlPC9yZGY6bGkKICAgICAgICAgICAgPgogICAgICAgICAgICA8cmRmOmxpCiAgICAgICAgICAgICAgPnJlZDwvcmRmOmxpCiAgICAgICAgICAgID4KICAgICAgICAgICAgPHJkZjpsaQogICAgICAgICAgICAgID5yb3VuZDwvcmRmOmxpCiAgICAgICAgICAgID4KICAgICAgICAgIDwvcmRmOkJhZwogICAgICAgICAgPgogICAgICAgIDwvZGM6c3ViamVjdAogICAgICAgID4KICAgICAgPC9jYzpXb3JrCiAgICAgID4KICAgICAgPGNjOkxpY2Vuc2UKICAgICAgICAgIHJkZjphYm91dD0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbGljZW5zZXMvcHVibGljZG9tYWluLyIKICAgICAgICA+CiAgICAgICAgPGNjOnBlcm1pdHMKICAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vY3JlYXRpdmVjb21tb25zLm9yZy9ucyNSZXByb2R1Y3Rpb24iCiAgICAgICAgLz4KICAgICAgICA8Y2M6cGVybWl0cwogICAgICAgICAgICByZGY6cmVzb3VyY2U9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zI0Rpc3RyaWJ1dGlvbiIKICAgICAgICAvPgogICAgICAgIDxjYzpwZXJtaXRzCiAgICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjRGVyaXZhdGl2ZVdvcmtzIgogICAgICAgIC8+CiAgICAgIDwvY2M6TGljZW5zZQogICAgICA+CiAgICA8L3JkZjpSREYKICAgID4KICA8L21ldGFkYXRhCiAgPgo8L3N2Zwo+Cg=="

/***/ })
/******/ ]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmllcmEuZGV2LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3dlYnBhY2svYm9vdHN0cmFwIDdiZTQ2MjBlMDk0OTkzZDliNmY3Iiwid2VicGFjazovLy9leHRlcm5hbCBcImZhYnJpY1wiIiwid2VicGFjazovLy90b29sYmFyL3Rvb2xiYXIuanMiLCJ3ZWJwYWNrOi8vL3NyYy91dGlsL29iamVjdC5qcyIsIndlYnBhY2s6Ly8vc3JjL3V0aWwvdXRpbC5qcyIsIndlYnBhY2s6Ly8vc3JjL3V0aWwvcGF0aC5qcyIsIndlYnBhY2s6Ly8vc3JjL3V0aWwvY29tcGlsZS5qcyIsIndlYnBhY2s6Ly8vc3JjL2NvcmUvc3RhdGljLWNhbnZhcy5leHQuanMiLCJ3ZWJwYWNrOi8vL3NyYy9taXhpbnMvcHJvcG9ydGlhbmFsU2l6ZU1peGluLmpzIiwid2VicGFjazovLy9zcmMvbW9kdWxlcy9zbGlkZS5hcmVhcy5qcyIsIndlYnBhY2s6Ly8vZXh0ZXJuYWwgXCIkXCIiLCJ3ZWJwYWNrOi8vL3NyYy9tb2R1bGVzL2NsaXBUby5qcyIsIndlYnBhY2s6Ly8vc3JjL3BsdWdpbnMvbWFnaWN3YW5kLmpzIiwid2VicGFjazovLy9zcmMvbWl4aW5zL3N0cm9rZU1peGluLmpzIiwid2VicGFjazovLy9zcmMvcGx1Z2lucy9iZXppZXIuanMiLCJ3ZWJwYWNrOi8vL3NyYy9maWVyYS5qcyIsIndlYnBhY2s6Ly8vc3JjL3V0aWwvZGF0YS5qcyIsIndlYnBhY2s6Ly8vZXh0ZXJuYWwgXCJmc1wiIiwid2VicGFjazovLy9zcmMvdXRpbC9sb2FkZXIuanMiLCJ3ZWJwYWNrOi8vL3NyYy91dGlsL3N5bnRheC5qcyIsIndlYnBhY2s6Ly8vc3JjL2NvcmUvYmFzZS5qcyIsIndlYnBhY2s6Ly8vc3JjL2NvcmUvb2JzZXJ2ZS5qcyIsIndlYnBhY2s6Ly8vc3JjL2NvcmUvYXBwbGljYXRpb24uanMiLCJ3ZWJwYWNrOi8vL3NyYy9jb3JlL3NsaWRlLmpzIiwid2VicGFjazovLy9zcmMvY29yZS9hcHBsaWNhdGlvbi5zbGlkZXMuanMiLCJ3ZWJwYWNrOi8vL3NyYy9jb3JlL2FwcGxpY2F0aW9uLnByb3RvdHlwZXMuanMiLCJ3ZWJwYWNrOi8vL3NyYy9jb3JlL29iamVjdC5leHQuanMiLCJ3ZWJwYWNrOi8vL3NyYy9jb3JlL3RleHQuZXh0LmpzIiwid2VicGFjazovLy9zcmMvY29yZS9ncm91cC5leHQuanMiLCJ3ZWJwYWNrOi8vL3NyYy9jb3JlL2ltYWdlLmV4dC5qcyIsIndlYnBhY2s6Ly8vc3JjL21vZHVsZXMvc2xpZGUudGVtcGxhdGUuanMiLCJ3ZWJwYWNrOi8vL3NyYy9tb2R1bGVzL3NsaWRlLmRyYXdpbmctdG9vbHMuanMiLCJ3ZWJwYWNrOi8vL3NyYy9tb2R1bGVzL3Rvb2xiYXIuanMiLCJ3ZWJwYWNrOi8vL3Rvb2xiYXIvbW9kdWxlcy90b29sYmFyLmNvbG9ycy5qcyIsIndlYnBhY2s6Ly8vcGx1Z2lucy8kLm1pbmljb2xvcnMuanMiLCJ3ZWJwYWNrOi8vL3Rvb2xiYXIvbW9kdWxlcy90b29sYmFyLmZvbnRzLmpzIiwid2VicGFjazovLy9wbHVnaW5zLyQuZm9udFNlbGVjdG9yLmpzIiwid2VicGFjazovLy90b29sYmFyL21vZHVsZXMvdG9vbGJhci5vcHRpb25zLmpzIiwid2VicGFjazovLy90b29sYmFyL21vZHVsZXMvdG9vbGJhci5zZWxlY3QuanMiLCJ3ZWJwYWNrOi8vL3Rvb2xiYXIvbW9kdWxlcy90b29sYmFyLmVmZmVjdC5qcyIsIndlYnBhY2s6Ly8vc3JjL21vZHVsZXMvY2FudmFzLmV2ZW50cy5qcyIsIndlYnBhY2s6Ly8vc3JjL21vZHVsZXMvaW1hZ2UuZmlsdGVycy5qcyIsIndlYnBhY2s6Ly8vc3JjL21vZHVsZXMvZm9udHMuanMiLCJ3ZWJwYWNrOi8vL3BsdWdpbnMvd2ViZm9udC5qcyIsIndlYnBhY2s6Ly8vc3JjL21vZHVsZXMvZ2FsbGVyeS5qcyIsIndlYnBhY2s6Ly8vc3JjL21vZHVsZXMvbGlicmFyeS5qcyIsIndlYnBhY2s6Ly8vc3JjL21vZHVsZXMvZGVidWcuanMiLCJ3ZWJwYWNrOi8vL3NyYy9tb2R1bGVzL2Zyb21VUkwuanMiLCJ3ZWJwYWNrOi8vL3NyYy9tb2R1bGVzL3VwbG9hZC5qcyIsIndlYnBhY2s6Ly8vc3JjL21vZHVsZXMvbG9hZGVyLmpzIiwid2VicGFjazovLy8uL21lZGlhL2xvYWRlci5zdmciLCJ3ZWJwYWNrOi8vL3NyYy9tb2R1bGVzL2Ryb3BwYWJsZS5qcyIsIndlYnBhY2s6Ly8vc3JjL21vZHVsZXMvcnVsZXIuanMiLCJ3ZWJwYWNrOi8vL3NyYy9tb2R1bGVzL3JlbmRlci5qcyIsIndlYnBhY2s6Ly8vc3JjL21vZHVsZXMvdGh1bWIuanMiLCJ3ZWJwYWNrOi8vL3NyYy9tb2R1bGVzL21vdmVtZW50TGltaXRzLmpzIiwid2VicGFjazovLy9zcmMvbW9kdWxlcy9ncm91cHMuanMiLCJ3ZWJwYWNrOi8vL3NyYy9tb2R1bGVzL2hpc3RvcnkuanMiLCJ3ZWJwYWNrOi8vL3NyYy9wbHVnaW5zL2hpc3RvcnkuanMiLCJ3ZWJwYWNrOi8vL3NyYy9tb2R1bGVzL3pvb20uanMiLCJ3ZWJwYWNrOi8vL3NyYy9tb2R1bGVzL2ludGVyYWN0aXZlTW9kZS5qcyIsIndlYnBhY2s6Ly8vc3JjL21vZHVsZXMvYm9yZGVySW1hZ2UuanMiLCJ3ZWJwYWNrOi8vL3NyYy9tb2R1bGVzL3NhdmVBcy5qcyIsIndlYnBhY2s6Ly8vcGx1Z2lucy9zYXZlQXMuanMiLCJ3ZWJwYWNrOi8vLy4uL25vZGVfbW9kdWxlcy93ZWJwYWNrL2J1aWxkaW4vYW1kLWRlZmluZS5qcyIsIndlYnBhY2s6Ly8vLi4vbm9kZV9tb2R1bGVzL3dlYnBhY2svYnVpbGRpbi9hbWQtb3B0aW9ucy5qcyIsIndlYnBhY2s6Ly8vc3JjL2JydXNoZXMvQmFzZUJydXNoLmpzIiwid2VicGFjazovLy9zcmMvYnJ1c2hlcy9QZW5jaWxCcnVzaC5qcyIsIndlYnBhY2s6Ly8vc3JjL2JydXNoZXMvUmVjdGFuZ2xlQnJ1c2guanMiLCJ3ZWJwYWNrOi8vL3NyYy9icnVzaGVzL1BvbHlnb25CcnVzaC5qcyIsIndlYnBhY2s6Ly8vLi9tZWRpYS9wb2x5Z29uLnBuZyIsIndlYnBhY2s6Ly8vc3JjL2JydXNoZXMvUGFpbnRQZW5CcnVzaC5qcyIsIndlYnBhY2s6Ly8vc3JjL2JydXNoZXMvUGFpbnRCdWNrZXRCcnVzaC5qcyIsIndlYnBhY2s6Ly8vLi9tZWRpYS9wYWludC1idWNrZXQuc3ZnIiwid2VicGFjazovLy9zcmMvYnJ1c2hlcy9Qb2ludHNCcnVzaC5qcyIsIndlYnBhY2s6Ly8vc3JjL3NoYXBlcy9wYXRoLmpzIiwid2VicGFjazovLy9zcmMvc2hhcGVzL2NsaXBhcnQuanMiLCJ3ZWJwYWNrOi8vL3NyYy9taXhpbnMvY2FjaGVNaXhpbi5qcyIsIndlYnBhY2s6Ly8vc3JjL3NoYXBlcy9QYXRoR3JvdXAuanMiLCJ3ZWJwYWNrOi8vL3NyYy9tb2R1bGVzL3Jlc2l6YWJsZS5qcyIsIndlYnBhY2s6Ly8vc3JjL3NoYXBlcy9waG90by5qcyIsIndlYnBhY2s6Ly8vc3JjL3NoYXBlcy9mcmFtZS5qcyIsIndlYnBhY2s6Ly8vc3JjL3NoYXBlcy9wb2x5bGluZS5qcyIsIndlYnBhY2s6Ly8vc3JjL21peGlucy9iZXppZXJNaXhpbi5qcyIsIndlYnBhY2s6Ly8vc3JjL21peGlucy9zaGFwZU1peGluLmpzIiwid2VicGFjazovLy9zcmMvc2hhcGVzL3BvbHlsaW5lLmNvbnRyb2xzLmpzIiwid2VicGFjazovLy9zcmMvc2hhcGVzL2ltYWdlLnBob3Rvc2hvcC10b29scy5qcyIsIndlYnBhY2s6Ly8vc3JjL21vZHVsZXMvcGF0aGZpbmRlci5qcyIsIndlYnBhY2s6Ly8vLi9tZWRpYS9sYXNzby5zdmciLCJ3ZWJwYWNrOi8vL3NyYy9zaGFwZXMvaW1hZ2UucmVtb3ZlLXdoaXRlLmpzIiwid2VicGFjazovLy9zcmMvZmlsdGVycy9yZW1vdmVXaGl0ZS5qcyIsIndlYnBhY2s6Ly8vc3JjL3NoYXBlcy90ZXh0Ym94Lmxpc3QuanMiLCJ3ZWJwYWNrOi8vL3NyYy9zaGFwZXMvdGV4dEZyYW1lLmpzIiwid2VicGFjazovLy8uL21lZGlhL2Vycm9yLWJ1dHRvbi5zdmciXSwic291cmNlc0NvbnRlbnQiOlsiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7XG4gXHRcdFx0XHRjb25maWd1cmFibGU6IGZhbHNlLFxuIFx0XHRcdFx0ZW51bWVyYWJsZTogdHJ1ZSxcbiBcdFx0XHRcdGdldDogZ2V0dGVyXG4gXHRcdFx0fSk7XG4gXHRcdH1cbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gMTQpO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHdlYnBhY2svYm9vdHN0cmFwIDdiZTQ2MjBlMDk0OTkzZDliNmY3IiwibW9kdWxlLmV4cG9ydHMgPSBmYWJyaWM7XG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gZXh0ZXJuYWwgXCJmYWJyaWNcIlxuLy8gbW9kdWxlIGlkID0gMFxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCJcbnZhciB1dGlscyA9IHJlcXVpcmUoJy4vLi4vc3JjL3V0aWwvdXRpbC5qcycpO1xudXRpbHMub2JqZWN0ID0gcmVxdWlyZSgnLi8uLi9zcmMvdXRpbC9vYmplY3QuanMnKTtcbnV0aWxzLmNvbXBpbGUgPSByZXF1aXJlKCcuLy4uL3NyYy91dGlsL2NvbXBpbGUuanMnKTtcblxuZnVuY3Rpb24gY2FwaXRhbGl6ZShzdHJpbmcsIGZpcnN0TGV0dGVyT25seSkge1xuICByZXR1cm4gc3RyaW5nLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICtcbiAgICAoZmlyc3RMZXR0ZXJPbmx5ID8gc3RyaW5nLnNsaWNlKDEpIDogc3RyaW5nLnNsaWNlKDEpLnRvTG93ZXJDYXNlKCkpO1xufVxuXG5mdW5jdGlvbiB0b0Rhc2hlZCAoc3RyKSB7XG4gIHJldHVybiBzdHIucmVwbGFjZSgvKFthLXpdKShbQS1aXSkvZywgJyQxLSQyJykudG9Mb3dlckNhc2UoKTtcbn1cblxuXG52YXIgVG9vbGJhciA9IGZ1bmN0aW9uKFBBUkVOVCwgZWwsIG9wdGlvbnMsIG1lbnUpe1xuICB0aGlzLmluaXRpYWxpemUoUEFSRU5ULCBlbCwgb3B0aW9ucywgbWVudSlcbn07XG5cblxuVG9vbGJhci5fZ2V0S2V5U3RyaW5nID0gZnVuY3Rpb24gKGNvbmZpZykge1xuICB2YXIgc3RyaW5nID0gXCJcIjtcblxuICBpZiAoY29uZmlnLmN0cmxLZXkpc3RyaW5nICs9IFwiQ3RybCArIFwiO1xuICBpZiAoY29uZmlnLmFsdEtleSlzdHJpbmcgKz0gXCJBbHQgKyBcIjtcbiAgaWYgKGNvbmZpZy5zaGlmdEtleSlzdHJpbmcgKz0gXCJTaGlmdCArIFwiO1xuXG4gIHZhciBfY29kZSA9IGNvbmZpZy5rZXk7XG4gIGlmKF9jb2RlKXtcbiAgICBzdHJpbmcgKz0gY29uZmlnLmtleTtcbiAgfVxuICByZXR1cm4gc3RyaW5nO1xufTtcblxuVG9vbGJhci5tYWtlQWN0aW9ucyA9IGZ1bmN0aW9uIChhY3Rpb25zLCBQQVJFTlQpIHtcbiAgICB2YXIgcmVzdWx0ID0ge307XG4gICAgZm9yICh2YXIgaSBpbiBhY3Rpb25zKSB7XG4gICAgICBhY3Rpb25zW2ldLmlkID0gaTtcbiAgICAgIHZhciBfYWN0aW9uID0gdGhpcy5tYWtlQWN0aW9uKGFjdGlvbnNbaV0sIFBBUkVOVCk7XG4gICAgICBpZihfYWN0aW9uKXtcbiAgICAgICAgcmVzdWx0W2ldID0gX2FjdGlvbjtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbn07XG5cblRvb2xiYXIubWFrZUFjdGlvbiA9IGZ1bmN0aW9uIChfT1JJR0lOQUwsIHBhcmVudCkge1xuXG4gIGlmIChfT1JJR0lOQUwuY29uc3RydWN0b3IgPT09IEZ1bmN0aW9uKSB7XG4gICAgX09SSUdJTkFMID0gX09SSUdJTkFMLmNhbGwocGFyZW50KTtcbiAgfVxuXG4gIHZhciB0YXJnZXQ7XG5cbiAgaWYgKF9PUklHSU5BTC50YXJnZXQgJiYgX09SSUdJTkFMLnRhcmdldC5jb25zdHJ1Y3RvciA9PT0gRnVuY3Rpb24pIHtcbiAgICB0YXJnZXQgPSBfT1JJR0lOQUwudGFyZ2V0LmNhbGwocGFyZW50KTtcbiAgfSBlbHNlIHtcbiAgICB0YXJnZXQgPSBfT1JJR0lOQUwudGFyZ2V0IHx8IHBhcmVudDtcbiAgfVxuXG4gIHZhciBfX190YXJnZXQgPSBfT1JJR0lOQUwudGFyZ2V0O1xuICB2YXIgX19fcGFyZW50ID0gX09SSUdJTkFMLnBhcmVudDtcbiAgZGVsZXRlIF9PUklHSU5BTC5wYXJlbnQ7XG4gIGRlbGV0ZSBfT1JJR0lOQUwudGFyZ2V0O1xuICB2YXIgUkVTID0gdXRpbHMub2JqZWN0LmNsb25lRGVlcChfT1JJR0lOQUwpO1xuICBfT1JJR0lOQUwucGFyZW50ID0gX19fcGFyZW50O1xuICBfT1JJR0lOQUwudGFyZ2V0ID0gX19fdGFyZ2V0O1xuXG5cbiAgUkVTLnBhcmVudCA9IF9fX3BhcmVudDtcbiAgUkVTLnRhcmdldCA9IHRhcmdldDtcbiAgUkVTLmlkID0gdG9EYXNoZWQoX09SSUdJTkFMLmlkKTtcblxuXG4gIGZ1bmN0aW9uIGNyZWF0ZUdldHRlcihwcm9wZXJ0eSx1c2VQYXJlbnQpIHtcbiAgICBpZiAocHJvcGVydHkuY29uc3RydWN0b3IgPT09IEZ1bmN0aW9uKSB7XG4gICAgICByZXR1cm4gcHJvcGVydHk7XG4gICAgfVxuICAgIGlmIChwcm9wZXJ0eS5jb25zdHJ1Y3RvciA9PT0gU3RyaW5nKSB7XG4gICAgICB2YXIgbmVnYXRpdmUgPSBmYWxzZTtcbiAgICAgIGlmIChwcm9wZXJ0eVswXSA9PT0gXCIhXCIpIHtcbiAgICAgICAgcHJvcGVydHkgPSBwcm9wZXJ0eS5zdWJzdHIoMSk7XG4gICAgICAgIG5lZ2F0aXZlID0gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIGlmKHVzZVBhcmVudCl7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMgJiYgISF0aGlzW3Byb3BlcnR5XSBeIG5lZ2F0aXZlO1xuICAgICAgICB9XG4gICAgICB9ZWxzZXtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcyAmJiAhIXRoaXNbcHJvcGVydHldIF4gbmVnYXRpdmU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuXG4gIC8qdmFyIF9pbnNlcnQgPSBfT1JJR0lOQUwuaW5zZXJ0O1xuICBpZiAoIV9pbnNlcnQgfHwgX2luc2VydC5jb25zdHJ1Y3RvciA9PSBTdHJpbmcpIHtcblxuICAgIGlmKF9PUklHSU5BTC5wYXJlbnQpe1xuICAgICAgdmFyIGluc2VydHByb3BlcnR5ID0gZmFicmljLnV0aWwuc3RyaW5nLmNhcGl0YWxpemUoZmFicmljLnV0aWwuc3RyaW5nLmNhbWVsaXplKF9PUklHSU5BTC5wYXJlbnQuaWQpKVxuICAgIH1lbHNle1xuICAgICAgdmFyIGluc2VydHByb3BlcnR5ID0gX2luc2VydCB8fCBcImluc2VydFwiICsgZmFicmljLnV0aWwuc3RyaW5nLmNhcGl0YWxpemUoaWQsdHJ1ZSk7XG4gICAgfVxuXG4gICAgaWYodGFyZ2V0W2luc2VydHByb3BlcnR5XSAhPT0gdW5kZWZpbmVkKXtcbiAgICAgIF9pbnNlcnQgPSB0YXJnZXRbaW5zZXJ0cHJvcGVydHldLy8gY3JlYXRlR2V0dGVyKGluc2VydHByb3BlcnR5LHRydWUpKClcbiAgICB9ZWxzZXtcbiAgICAgIF9pbnNlcnQgPSB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIGlmKCFfaW5zZXJ0KXJldHVybjsqL1xuXG4gIGlmICghUkVTLnR5cGUpIHtcbiAgICBpZiAoUkVTLm1lbnUpIHtcbiAgICAgIFJFUy50eXBlID0gXCJtZW51XCI7XG4gICAgfWVsc2V7XG4gICAgICBSRVMudHlwZSA9IFwiYnV0dG9uXCI7XG4gICAgfVxuICB9XG4gIGlmICghUkVTLmFjdGlvbikge1xuICAgIGlmKFJFUy50eXBlID09PSBcImJ1dHRvblwiKXtcbiAgICAgIFJFUy5hY3Rpb24gPSBfT1JJR0lOQUwuaWQ7XG4gICAgfVxuICB9XG5cblxuICBpZiAoUkVTLmFjdGlvbikge1xuICAgIGlmIChSRVMuYWN0aW9uLmNvbnN0cnVjdG9yID09PSBTdHJpbmcpIHtcbiAgICAgIFJFUy5hY3Rpb24gPSB0YXJnZXRbUkVTLmFjdGlvbl07XG4gICAgfVxuICAgIC8vUkVTID0gUkVTLmFjdGlvbi5iaW5kKHRhcmdldCk7XG4gICAgLy9SRVMuYWN0aW9uID0gUkVTLmFjdGlvbi5iaW5kKHRhcmdldCk7XG4gICAgLy9fLmV4dGVuZChSRVMsIF9hY3QpO1xuICAgIC8vYXJndW1lbnRzIGZvciBhY3Rpb24gZnVuY3Rpb25cbiAgICBpZiAoX09SSUdJTkFMLmFyZ3MpIHtcbiAgICAgIFJFUy5fYWN0aW9uID0gUkVTLmFjdGlvbi5iaW5kKHRhcmdldCwgX09SSUdJTkFMLmFyZ3MpO1xuICAgIH0gZWxzZSB7XG4gICAgICBSRVMuX2FjdGlvbiA9IFJFUy5hY3Rpb24uYmluZCh0YXJnZXQpO1xuICAgIH1cbiAgICBSRVMuYWN0aW9uID0gZnVuY3Rpb24oKXtcbiAgICAgIGlmKFJFUy5kaXNhYmxlZClyZXR1cm47XG4gICAgICBSRVMuX2FjdGlvbi5hcHBseSh0aGlzLGFyZ3VtZW50cyk7XG4gICAgfVxuICB9XG5cblxuICBpZiAoX09SSUdJTkFMLm1lbnUgJiYgX09SSUdJTkFMLm1lbnUuY29uc3RydWN0b3IgPT09IEZ1bmN0aW9uKSB7XG4gICAgUkVTLm1lbnUgPSBfT1JJR0lOQUwubWVudS5iaW5kKHRhcmdldCk7XG4gIH1cbiAgaWYgKF9PUklHSU5BTC5hY3RpdmUpIHtcbiAgICBSRVMuYWN0aXZlID0gY3JlYXRlR2V0dGVyKF9PUklHSU5BTC5hY3RpdmUpLmJpbmQodGFyZ2V0KTtcbiAgfVxuICBpZiAoX09SSUdJTkFMLnZpc2libGUpIHtcbiAgICBSRVMudmlzaWJsZSA9IGNyZWF0ZUdldHRlcihfT1JJR0lOQUwudmlzaWJsZSkuYmluZCh0YXJnZXQpO1xuICB9XG4gIGlmIChfT1JJR0lOQUwuZW5hYmxlZCkge1xuICAgIFJFUy5lbmFibGVkID0gY3JlYXRlR2V0dGVyKF9PUklHSU5BTC5lbmFibGVkKS5iaW5kKHRhcmdldCk7XG4gIH1cbiAgaWYgKCFfT1JJR0lOQUwudmFsdWUpIHtcbiAgICBzd2l0Y2goX09SSUdJTkFMLnR5cGUpe1xuICAgICAgY2FzZSBcImNvbG9yXCI6XG4gICAgICBjYXNlIFwidGV4dFwiOlxuICAgICAgY2FzZSBcIm51bWJlclwiOlxuICAgICAgY2FzZSBcInJhbmdlXCI6XG4gICAgICBjYXNlIFwibGFiZWxcIjpcbiAgICAgIGNhc2UgXCJzZWxlY3RcIjpcbiAgICAgIGNhc2UgXCJjaGVja2JveFwiOlxuICAgICAgICBfT1JJR0lOQUwudmFsdWUgPSBfT1JJR0lOQUwuaWQ7XG4gICAgICAvLyBjb25zb2xlLmxvZyhpZCwgX09SSUdJTkFMKTtcbiAgICB9XG4gIH1cbiAgaWYgKF9PUklHSU5BTC52YWx1ZSkge1xuICAgIHZhciBfc2V0LCBfZ2V0LCBfb3B0aW9ucztcbiAgICBpZiAoX09SSUdJTkFMLnZhbHVlLmNvbnN0cnVjdG9yID09PSBTdHJpbmcpIHtcblxuICAgICAgdmFyIHNldEZ1bmN0aW9uTmFtZSA9IFwic2V0XCIgKyBjYXBpdGFsaXplKF9PUklHSU5BTC52YWx1ZSwgdHJ1ZSksXG4gICAgICAgIGdldEZ1bmN0aW9uTmFtZSA9IFwiZ2V0XCIgKyBjYXBpdGFsaXplKF9PUklHSU5BTC52YWx1ZSwgdHJ1ZSksXG4gICAgICAgIG1pbk5hbWUgPSBcIm1pblwiICsgY2FwaXRhbGl6ZShfT1JJR0lOQUwudmFsdWUsIHRydWUpLFxuICAgICAgICBtYXhOYW1lID0gXCJtYXhcIiArIGNhcGl0YWxpemUoX09SSUdJTkFMLnZhbHVlLCB0cnVlKSxcbiAgICAgICAgc2V0Rm9vID0gZnVuY3Rpb24odmFsKXtcbiAgICAgICAgICB0YXJnZXRbc2V0RnVuY3Rpb25OYW1lXSh2YWwpO1xuICAgICAgICAgIC8vIHRvZG8gc2VsZi5zZXRGdW5jdGlvbkNhbGxiYWNrKHRhcmdldCk7XG4gICAgICAgIH0sXG4gICAgICAgIGdldEZvbyA9IHRhcmdldFtnZXRGdW5jdGlvbk5hbWVdLFxuICAgICAgICBtaW5Gb28gPSB0YXJnZXRbbWluTmFtZV0sXG4gICAgICAgIG1heEZvbyA9IHRhcmdldFttYXhOYW1lXTtcblxuICAgICAgX3NldCA9IHNldEZvbyB8fCAoX09SSUdJTkFMLmFyZ3MgP1xuICAgICAgICAgIGZ1bmN0aW9uICh2YWwsIGFyZ3MpIHtcbiAgICAgICAgICAgIHRoaXNbX09SSUdJTkFMLnZhbHVlXVthcmdzXSA9IHZhbDtcbiAgICAgICAgICB9IDpcbiAgICAgICAgICBmdW5jdGlvbiAodmFsKSB7XG4gICAgICAgICAgICB0aGlzW19PUklHSU5BTC52YWx1ZV0gPSB2YWw7XG4gICAgICAgICAgfSk7XG5cbiAgICAgIF9nZXQgPSBnZXRGb28gfHwgKF9PUklHSU5BTC5hcmdzID9cbiAgICAgICAgICBmdW5jdGlvbiAoYXJncykge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXNbX09SSUdJTkFMLnZhbHVlXVthcmdzXTtcbiAgICAgICAgICB9IDpcbiAgICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpc1tfT1JJR0lOQUwudmFsdWVdO1xuICAgICAgICAgIH0pO1xuXG5cbiAgICAgIFJFUy52YWx1ZSA9IHtcbiAgICAgICAgbWluOiBtaW5Gb28sXG4gICAgICAgIG1heDogbWF4Rm9vXG4gICAgICB9XG5cbiAgICB9IGVsc2Uge1xuICAgICAgX3NldCA9IF9PUklHSU5BTC52YWx1ZS5zZXQ7XG4gICAgICBfZ2V0ID0gX09SSUdJTkFMLnZhbHVlLmdldDtcbiAgICAgIF9vcHRpb25zID0gX09SSUdJTkFMLnZhbHVlLm9wdGlvbnM7XG4gICAgfVxuXG4gICAgaWYoUkVTLnZhbHVlLm1pbiAhPT0gdW5kZWZpbmVkICYmIFJFUy52YWx1ZS5taW4uY29uc3RydWN0b3IgPT09IFN0cmluZyl7XG4gICAgICBSRVMudmFsdWUubWluID0gdGFyZ2V0W1JFUy52YWx1ZS5taW5dO1xuICAgIH1cbiAgICBpZihSRVMudmFsdWUubWF4ICE9PSB1bmRlZmluZWQgJiYgUkVTLnZhbHVlLm1heC5jb25zdHJ1Y3RvciA9PT0gU3RyaW5nKXtcbiAgICAgIFJFUy52YWx1ZS5tYXggPSB0YXJnZXRbUkVTLnZhbHVlLm1heF07XG4gICAgfVxuICAgIGlmKFJFUy52YWx1ZS5zdGVwICE9PSB1bmRlZmluZWQgJiYgUkVTLnZhbHVlLnN0ZXAuY29uc3RydWN0b3IgPT09IFN0cmluZyl7XG4gICAgICBSRVMudmFsdWUuc3RlcCA9IHRhcmdldFtSRVMudmFsdWUuc3RlcF07XG4gICAgfVxuICAgIHZhciBfbWluID0gUkVTLnZhbHVlLm1pbiwgX21heCA9IFJFUy52YWx1ZS5tYXgsIF9zdGVwID0gUkVTLnZhbHVlLnN0ZXA7XG5cbiAgICBpZiAoX3NldCkge1xuICAgICAgUkVTLnZhbHVlLnNldCA9ICggX09SSUdJTkFMLmFyZ3MgPyBfc2V0LmJpbmQodGFyZ2V0LCBfT1JJR0lOQUwuYXJncykgOiBfc2V0LmJpbmQodGFyZ2V0KSk7XG4gICAgfVxuICAgIGlmIChfZ2V0KSB7XG4gICAgICBSRVMudmFsdWUuZ2V0ID0gKCBfT1JJR0lOQUwuYXJncyA/IF9nZXQuYmluZCh0YXJnZXQsIF9PUklHSU5BTC5hcmdzKSA6IF9nZXQuYmluZCh0YXJnZXQpKTtcbiAgICB9XG4gICAgaWYgKF9taW4gJiYgX21pbi5jb25zdHJ1Y3RvciA9PT0gRnVuY3Rpb24pIHtcbiAgICAgIFJFUy52YWx1ZS5taW4gPSAoIF9PUklHSU5BTC5hcmdzID8gX21pbi5iaW5kKHRhcmdldCwgX09SSUdJTkFMLmFyZ3MpIDogX21pbi5iaW5kKHRhcmdldCkpO1xuICAgIH1cbiAgICBpZiAoX21heCAmJiBfbWF4LmNvbnN0cnVjdG9yID09PSBGdW5jdGlvbikge1xuICAgICAgUkVTLnZhbHVlLm1heCA9ICggX09SSUdJTkFMLmFyZ3MgPyBfbWF4LmJpbmQodGFyZ2V0LCBfT1JJR0lOQUwuYXJncykgOiBfbWF4LmJpbmQodGFyZ2V0KSk7XG4gICAgfVxuICAgIGlmIChfc3RlcCAmJiBfc3RlcC5jb25zdHJ1Y3RvciA9PT0gRnVuY3Rpb24pIHtcbiAgICAgIFJFUy52YWx1ZS5zdGVwID0gKCBfT1JJR0lOQUwuYXJncyA/IF9zdGVwLmJpbmQodGFyZ2V0LCBfT1JJR0lOQUwuYXJncykgOiBfc3RlcC5iaW5kKHRhcmdldCkpO1xuICAgIH1cbiAgICBpZiAoX29wdGlvbnMpIHtcbiAgICAgIFJFUy52YWx1ZS5vcHRpb25zID0gKCBfT1JJR0lOQUwuYXJncyA/IF9vcHRpb25zLmJpbmQodGFyZ2V0LCBfT1JJR0lOQUwuYXJncykgOiBfb3B0aW9ucy5iaW5kKHRhcmdldCkpO1xuICAgIH1cbiAgfVxuXG4gIGlmIChfT1JJR0lOQUwuZGF0YSkge1xuICAgIFJFUy5kYXRhID0gX09SSUdJTkFMLmRhdGEuY2FsbCh0YXJnZXQpO1xuICB9XG4gIGlmIChSRVMubWVudSkge1xuICAgIGlmIChfT1JJR0lOQUwubWVudS5jb25zdHJ1Y3RvciA9PT0gRnVuY3Rpb24pe1xuICAgICAgUkVTLm1lbnUgPSAgX09SSUdJTkFMLm1lbnUuY2FsbCh0YXJnZXQpO1xuICAgIH1cbiAgICBpZiAoUkVTLnR5cGUgPT09IFwib3B0aW9uc1wiKSB7XG4gICAgICBmb3IgKHZhciBpIGluIFJFUy5tZW51KSB7XG4gICAgICAgIFJFUy5tZW51W2ldLnBhcmVudCA9IFJFUztcbiAgICAgICAgUkVTLm1lbnVbaV0udHlwZSA9IFwib3B0aW9uXCI7XG4gICAgICAgIGlmKCFSRVMubWVudVtpXS50aXRsZSl7XG4gICAgICAgICAgUkVTLm1lbnVbaV0udGl0bGUgPSBpO1xuICAgICAgICB9XG4gICAgICAgIGlmKCFSRVMubWVudVtpXS5vcHRpb24pIHtcbiAgICAgICAgICBSRVMubWVudVtpXS5vcHRpb24gPSBpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIGZvciAodmFyIGkgaW4gUkVTLm1lbnUpIHtcbiAgICAgIGlmKFJFUy5tZW51W2ldLmNvbnN0cnVjdG9yID09PSBTdHJpbmcpe1xuICAgICAgICBSRVMubWVudVtpXSA9IGZhYnJpYy51dGlsLm9iamVjdC5jbG9uZShSRVMudGFyZ2V0LmFjdGlvbnNbUkVTLm1lbnVbaV1dKTtcbiAgICAgICAgUkVTLm1lbnVbaV0ucGFyZW50ID0gUkVTO1xuICAgICAgfVxuICAgICAgaWYoIVJFUy5tZW51W2ldLmlkKXtcbiAgICAgICAgUkVTLm1lbnVbaV0uaWQgPSBpO1xuICAgICAgfVxuICAgICAgUkVTLm1lbnVbaV0gPSBUb29sYmFyLm1ha2VBY3Rpb24oUkVTLm1lbnVbaV0sIHRhcmdldCk7XG4gICAgICBpZighUkVTLm1lbnVbaV0pe1xuICAgICAgICBkZWxldGUgUkVTLm1lbnVbaV07XG4gICAgICB9XG4gICAgfVxuICB9XG5cblxuXG4gIGlmIChfT1JJR0lOQUwua2V5Ym9hcmQgIT09IGZhbHNlICYmIChfT1JJR0lOQUwua2V5IHx8IF9PUklHSU5BTC5zaGlmdEtleSB8fCBfT1JJR0lOQUwuYWx0S2V5IHx8IF9PUklHSU5BTC5jdHJsS2V5IHx8IF9PUklHSU5BTC5tZXRhS2V5KSkge1xuICAgIGlmKF9PUklHSU5BTC5rZXlDb2RlICYmIF9PUklHSU5BTC5rZXlDb2RlLmNvbnN0cnVjdG9yID09PSBTdHJpbmcpe1xuICAgICAgUkVTLmtleUNvZGUgPSBfT1JJR0lOQUwua2V5Q29kZS50b1VwcGVyQ2FzZSgpLmNoYXJDb2RlQXQoMCk7XG4gICAgICBSRVMua2V5ID0gU3RyaW5nLmZyb21DaGFyQ29kZShSRVMua2V5Q29kZSk7XG4gICAgfVxuICAgIFJFUy5rZXlib2FyZCA9IHRydWVcbiAgfTtcblxuICByZXR1cm4gUkVTO1xufTtcblxuVG9vbGJhci5nZXRCdXR0b25zID0gZnVuY3Rpb24gKGFjdGlvbnMpIHtcbiAgdmFyIF9idXR0b25zID0gW107XG4gIGZvcih2YXIgaSBpbiBhY3Rpb25zKXtcbiAgICB2YXIgYWN0aW9uID0gYWN0aW9uc1tpXTtcbiAgICBpZihhY3Rpb24ua2V5Ym9hcmQpe1xuICAgICAgYWN0aW9uLnRpdGxlICs9IFwiIChcIiArIFRvb2xiYXIuX2dldEtleVN0cmluZyhhY3Rpb24pICsgXCIpXCI7XG4gICAgICBfYnV0dG9ucy5wdXNoKGFjdGlvbik7XG4gICAgfVxuICAgIGlmIChhY3Rpb25zLm1lbnUpIHtcbiAgICAgIF9idXR0b25zID0gX2J1dHRvbnMuY29uY2F0KFRvb2xiYXIuZ2V0QnV0dG9ucyhhY3Rpb25zLm1lbnUpKTtcbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIF9idXR0b25zO1xufTtcblRvb2xiYXIuaW5pdEtleXMgPSBmdW5jdGlvbiAoYWN0aW9ucykge1xuXG4gIHZhciBidXR0b25zID0gVG9vbGJhci5nZXRCdXR0b25zKGFjdGlvbnMpO1xuXG4gIHZhciBzZWxmID0gdGhpcztcbiAgJChcImJvZHlcIikub24oIFwia2V5ZG93blwiLGZ1bmN0aW9uIChlKSB7XG4gICAgZm9yICh2YXIgaSBpbiBidXR0b25zKSB7XG4gICAgICB2YXIgX2NvbmZpZyA9IGJ1dHRvbnNbaV07XG5cbiAgICAgIGlmKF9jb25maWcuZW5hYmxlZCAmJiAhX2NvbmZpZy5lbmFibGVkKCkpe1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIGlmKF9jb25maWcuZGlzYWJsZWQgfHwgX2NvbmZpZy5kaXNhYmxlZCl7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgaWYgKCghX2NvbmZpZy5kaXNhYmxlZCAmJiAhX2NvbmZpZy5oaWRkZW4pICYmXG4gICAgICAgIChfY29uZmlnLmtleUNvZGUgPT0gZS5rZXlDb2RlIHx8IF9jb25maWcua2V5ID09IGUua2V5KSAmJlxuICAgICAgICAoX2NvbmZpZy5jdHJsS2V5ID09PSB1bmRlZmluZWQgfHwgX2NvbmZpZy5jdHJsS2V5ID09IGUuY3RybEtleSApICYmXG4gICAgICAgIChfY29uZmlnLmFsdEtleSA9PT0gdW5kZWZpbmVkIHx8IF9jb25maWcuYWx0S2V5ID09IGUuYWx0S2V5ICkgJiZcbiAgICAgICAgKF9jb25maWcuc2hpZnRLZXkgPT09IHVuZGVmaW5lZCB8fCBfY29uZmlnLnNoaWZ0S2V5ID09IGUuc2hpZnRLZXkgKSAmJlxuICAgICAgICAoX2NvbmZpZy5tZXRhS2V5ID09PSB1bmRlZmluZWQgfHwgX2NvbmZpZy5tZXRhS2V5ID09IGUubWV0YUtleSApKSB7XG5cbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICBpZiAoX2NvbmZpZy5vcHRpb24gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIF9jb25maWcuYWN0aW9uLmNhbGwoX2NvbmZpZy50YXJnZXQsIF9jb25maWcub3B0aW9uLCBlKVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIF9jb25maWcuYWN0aW9uLmNhbGwoX2NvbmZpZy50YXJnZXQsIGUpXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuXG4gIC8vJCh3aW5kb3cpLm9uKFwibW91c2V3aGVlbFwiLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgLy8gIGZvciAodmFyIGkgaW4gc2VsZi5idXR0b25zKSB7XG4gIC8vICAgIHZhciBkYXRhID0gc2VsZi5idXR0b25zW2ldO1xuICAvLyAgICBpZiAoIWRhdGEubW91c2V3aGVlbCljb250aW51ZTtcbiAgLy8gICAgaWYgKCFkYXRhLmN0cmxLZXkgfHwgZGF0YS5jdHJsS2V5ICYmIGV2ZW50LmN0cmxLZXkpIHtcbiAgLy8gICAgICBpZiAoZXZlbnQuZGVsdGFZID4gMCAmJiBkYXRhLm1vdXNld2hlZWwgPT0gXCI+XCIpIHtcbiAgLy8gICAgICAgIGRhdGEuYWN0aW9uLmNhbGwodGFyZ2V0LCBkYXRhLm9wdGlvbiB8fCBldmVudCwgZXZlbnQpXG4gIC8vICAgICAgfVxuICAvLyAgICAgIGlmIChldmVudC5kZWx0YVkgPCAwICYmIGRhdGEubW91c2V3aGVlbCA9PSBcIjxcIikge1xuICAvLyAgICAgICAgZGF0YS5hY3Rpb24uY2FsbCh0YXJnZXQsIGRhdGEub3B0aW9uIHx8IGV2ZW50LCBldmVudClcbiAgLy8gICAgICB9XG4gIC8vICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgLy8gICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgLy8gICAgICByZXR1cm4gZmFsc2U7XG4gIC8vICAgIH1cbiAgLy8gIH1cbiAgLy99KTtcblxufTtcblxuVG9vbGJhci5wcm90b3R5cGUgPSB7XG5cbiAgLy8gc2V0RnVuY3Rpb25DYWxsYmFjazogZnVuY3Rpb24oKXt9LFxuICB0b29sczoge1xuXG4gICAgXCJsYWJlbFwiOiB7XG4gICAgICBzY29wZTogZnVuY3Rpb24gKGRhdGEsIG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBnZXRWYWx1ZTogZGF0YS52YWx1ZS5nZXQsXG4gICAgICAgICAgdmFsdWVDdXJyZW50OiBkYXRhLnZhbHVlLmdldCgpXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB0ZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJvYmplY3QtbWVudS1pdGVtIG9iamVjdC1tZW51LWxhYmVsXCIgdGl0bGU9XCJ7dGl0bGV9XCI+JyxcbiAgICAgIHJlbmRlcjogZnVuY3Rpb24gKCRpdGVtLCBkYXRhLCBvcHRpb25zLCB0b29sLCB2YWwpIHtcbiAgICAgICAgdmFyIHNjb3BlID0gZmFicmljLnV0aWwub2JqZWN0LmRlZmF1bHRzKHRvb2wuc2NvcGUuY2FsbCh0aGlzLCBkYXRhLCBvcHRpb25zKSxkYXRhKTtcbiAgICAgICAgJGl0ZW0uaHRtbChkYXRhLnRlbXBsYXRlLmZvcm1hdChkYXRhLnZhbHVlLmdldCgpKSk7XG4gICAgICAgIHV0aWxzLmNvbXBpbGUuY29tcGlsZUVsZW1lbnQoJGl0ZW0sc2NvcGUpO1xuICAgICAgfVxuICAgIH0sXG4gICAgXCJudW1iZXJcIjoge1xuICAgICAgc2NvcGU6IGZ1bmN0aW9uIChkYXRhLCBvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgZ2V0SW5wdXRWYWx1ZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHJldHVybiBwYXJzZUZsb2F0KGRhdGEuJGl0ZW0uZmluZChcImlucHV0XCIpLnZhbCgpKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGdldFZhbHVlOiBkYXRhLnZhbHVlLmdldCxcbiAgICAgICAgICBzZXRWYWx1ZTogZGF0YS52YWx1ZS5zZXQsXG4gICAgICAgICAgbWluVmFsdWU6IGRhdGEudmFsdWUubWluICYmIGRhdGEudmFsdWUubWluKCksXG4gICAgICAgICAgbWF4VmFsdWU6IGRhdGEudmFsdWUubWF4ICYmIGRhdGEudmFsdWUubWF4KCksXG4gICAgICAgICAgdmFsdWVDdXJyZW50OiBkYXRhLnZhbHVlLmdldCgpLFxuICAgICAgICAgIG9uY2hhbmdlOiBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgZGF0YS52YWx1ZS5zZXQocGFyc2VGbG9hdCgkKGUudGFyZ2V0KS52YWwoKSkpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cIm9iamVjdC1tZW51LWl0ZW0gb2JqZWN0LW1lbnUtbnVtYmVyXCIgdGl0bGU9XCJ7dGl0bGV9XCI+JyArXG4gICAgICAnPGlucHV0IHR5cGU9XCJudW1iZXJcIiBtaW49XCJ7bWluVmFsdWV9XCIgbWF4PVwie21heFZhbHVlfVwiIHZhbHVlPVwie3ZhbHVlQ3VycmVudH1cIiBvbmNoYW5nZT1cIm9uY2hhbmdlKGV2ZW50KVwiPicsXG4gICAgICByZW5kZXI6IGZ1bmN0aW9uICgkaXRlbSwgZGF0YSwgb3B0aW9ucywgdG9vbCwgdmFsKSB7XG4gICAgICAgICRpdGVtLmZpbmQoXCJpbnB1dFwiKS52YWwoZGF0YS52YWx1ZS5nZXQoKSk7XG4gICAgICB9XG4gICAgfSxcbiAgICBcInJhbmdlXCI6IHtcbiAgICAgIHNjb3BlOiBmdW5jdGlvbiAoZGF0YSwgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIG1pblZhbHVlOiBkYXRhLnZhbHVlLm1pbiA/IHR5cGVvZiBkYXRhLnZhbHVlLm1pbiA9PSBcImZ1bmN0aW9uXCIgPyBkYXRhLnZhbHVlLm1pbigpIDogZGF0YS52YWx1ZS5taW46IDAsXG4gICAgICAgICAgbWF4VmFsdWU6IGRhdGEudmFsdWUubWF4ID8gdHlwZW9mIGRhdGEudmFsdWUubWF4ID09IFwiZnVuY3Rpb25cIiA/IGRhdGEudmFsdWUubWF4KCkgOiBkYXRhLnZhbHVlLm1heDogMSxcbiAgICAgICAgICB2YWx1ZVN0ZXA6IGRhdGEudmFsdWUuc3RlcCA/IHR5cGVvZiBkYXRhLnZhbHVlLnN0ZXAgPT0gXCJmdW5jdGlvblwiID8gZGF0YS52YWx1ZS5zdGVwKCkgOiBkYXRhLnZhbHVlLnN0ZXA6IDAuMSxcbiAgICAgICAgICB2YWx1ZUN1cnJlbnQ6IGRhdGEudmFsdWUuZ2V0KCksXG4gICAgICAgICAgb25jaGFuZ2U6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBkYXRhLnZhbHVlLnNldChwYXJzZUZsb2F0KCQoZS50YXJnZXQpLnZhbCgpKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgdGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwib2JqZWN0LW1lbnUtaXRlbSBvYmplY3QtbWVudS1yYW5nZVwiIHRpdGxlPVwie3RpdGxlfVwiPicgK1xuICAgICAgJzxpbnB1dCB0eXBlPVwicmFuZ2VcIiBzdGVwPVwie3ZhbHVlU3RlcH1cIiBtaW49XCJ7bWluVmFsdWV9XCIgbWF4PVwie21heFZhbHVlfVwiIHZhbHVlPVwie3ZhbHVlQ3VycmVudH1cIiBvbmNoYW5nZT1cIm9uY2hhbmdlKGV2ZW50KVwiPicsXG4gICAgICByZW5kZXI6IGZ1bmN0aW9uICgkaXRlbSwgZGF0YSwgb3B0aW9ucywgdG9vbCwgdmFsKSB7XG4gICAgICAgICRpdGVtLmZpbmQoXCJpbnB1dFwiKS52YWwoZGF0YS52YWx1ZS5nZXQoKSk7XG4gICAgICB9XG4gICAgfSxcbiAgICBcImNoZWNrYm94XCI6IHtcbiAgICAgIHNjb3BlOiBmdW5jdGlvbiAoZGF0YSwgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIG9uY2hhbmdlOiBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgZGF0YS52YWx1ZS5zZXQoZS50YXJnZXQuY2hlY2tlZClcbiAgICAgICAgICB9LFxuICAgICAgICAgIHZhbHVlQ3VycmVudDogZGF0YS52YWx1ZS5nZXQoKVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgdGVtcGxhdGU6XG4gICAgICAnPGRpdiBjbGFzcz1cIm9iamVjdC1tZW51LWl0ZW0gb2JqZWN0LW1lbnUtY2hlY2tib3hcIiB0aXRsZT1cInt0aXRsZX1cIj4nICtcbiAgICAgICc8aW5wdXQgdHlwZT1cImNoZWNrYm94XCIgb25jaGFuZ2U9XCJvbmNoYW5nZShldmVudClcIiBkcC1jaGVja2VkPVwie3ZhbHVlQ3VycmVudH1cIiBpZD1cImNoZWNrYm94LXtpZH1cIj4nICtcbiAgICAgICc8bGFiZWwgZm9yPVwiY2hlY2tib3gte2lkfVwiICBjbGFzcz1cImJ0biBidXR0b24te2lkfSB7Y2xhc3NOYW1lfVwiPicsXG4gICAgICByZW5kZXI6IGZ1bmN0aW9uICgkaXRlbSwgZGF0YSwgb3B0aW9ucywgdG9vbCwgdmFsKSB7XG4gICAgICAgICRpdGVtLmZpbmQoXCJpbnB1dFwiKS52YWwodmFsKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIFwibWVudVwiOiB7XG4gICAgICB0ZW1wbGF0ZTpcbiAgICAgICAgJzxkaXYgY2xhc3M9XCJvYmplY3QtbWVudS1pdGVtIG9iamVjdC1tZW51LW1lbnVcIiB0aXRsZT1cInt0aXRsZX1cIj4nICtcbiAgICAgICAgJzxsYWJlbCBkcC1pZj1cInRpdGxlXCIgZm9yPVwiYnV0dG9uLXtpZH1cIj57dGl0bGV9PC9sYWJlbD4nICtcbiAgICAgICAgJzxidXR0b24gY2xhc3M9XCJidG4gYnV0dG9uLW1lbnUtdHJpZ2dlciBidXR0b24te2lkfSB7Y2xhc3NOYW1lfVwiIGlkPVwiYnV0dG9uLXtpZH1cIi8+JyArXG4gICAgICAgICc8ZGl2IGNsYXNzPVwib2JqZWN0LW1lbnUgc3VibWVudVwiIHRyYW5zY2x1ZGUvPicsXG4gICAgICBwb3N0OiBmdW5jdGlvbiAoJGl0ZW0sIGRhdGEsIG9wdGlvbnMsIHRyYW5zY2x1ZGUpIHtcbiAgICAgICAgLy8kaXRlbS5maW5kKFwiLmJ1dHRvbi1tZW51LXRyaWdnZXJcIikuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICAvLyAgJGl0ZW0uZmluZChcIi5vYmplY3QtbWVudVwiKS50b2dnbGUoKTtcbiAgICAgICAgLy99KVxuICAgICAgICBpZiAoZGF0YS5ob3ZlcmVkKSB7XG4gICAgICAgICAgJGl0ZW0uYWRkQ2xhc3MoXCJob3ZlcmVkXCIpO1xuICAgICAgICAgIHRoaXMudG9nZ2xlQnlIb3ZlcigkaXRlbSwgdHJhbnNjbHVkZSwgbnVsbCwgZGF0YSlcbiAgICAgICAgfVxuICAgICAgICBpZiAoZGF0YS50b2dnbGVkKSB7XG4gICAgICAgICAgJGl0ZW0uYWRkQ2xhc3MoXCJ0b2dnbGVkXCIpO1xuICAgICAgICAgIHRoaXMudG9nZ2xlQnlCdXR0b24oJGl0ZW0sIHRyYW5zY2x1ZGUpXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuZ2VuZXJhdGVNZW51KGRhdGEudGFyZ2V0LCB0cmFuc2NsdWRlLCBvcHRpb25zLCBkYXRhLm1lbnUpO1xuICAgICAgfVxuICAgIH0sXG4gICAgXCJidXR0b25cIjoge1xuICAgICAgc2NvcGU6IGZ1bmN0aW9uIChkYXRhLCBvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgYnV0dG9uc1RpdGxlOiBvcHRpb25zLmJ1dHRvbnMgJiYgb3B0aW9ucy5idXR0b25zLnRpdGxlIHx8IGZhbHNlLFxuICAgICAgICAgIGJ1dHRvbnNjQ2xhc3NOYW1lOiAob3B0aW9ucy5idXR0b25zICYmIG9wdGlvbnMuYnV0dG9ucy5jbGFzc05hbWUgfHwgJycpXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB0ZW1wbGF0ZTpcbiAgICAgICc8ZGl2IGNsYXNzPVwib2JqZWN0LW1lbnUtaXRlbVwiIHRpdGxlPVwie3RpdGxlfVwiPicgK1xuICAgICAgJzxidXR0b24gY2xhc3M9XCJidG4gYnV0dG9uLXtpZH0ge2NsYXNzTmFtZX0ge2J1dHRvbnNjQ2xhc3NOYW1lfVwiICBvbmNsaWNrPVwiIWRpc2FibGVkICYmIG9wdGlvbiA/IGFjdGlvbihvcHRpb24pIDogYWN0aW9uKClcIj4nICtcbiAgICAgICc8aW1nIGRwLWlmPVwiaWNvblwiIGRwLXNyYz1cImljb25cIj4nICtcbiAgICAgICc8c3BhbiBkcC1pbmNsdWRlPVwic3ZnXCIgZHAtaWY9XCJzdmdcIj48L3NwYW4+JyArXG4gICAgICAnPHNwYW4gZHAtaWY9XCJidXR0b25zVGl0bGVcIiBjbGFzcz1cImJ1dHRvbi10aXRsZVwiPnt0aXRsZX08L3NwYW4+J1xuICAgIH1cbiAgfSxcbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oUEFSRU5ULCBlbCwgb3B0aW9ucywgbWVudSl7XG4gICAgdGhpcy5idXR0b25zID0gW107XG4gICAgLy90b2RvINGN0YLQviDQvdC1INGB0L7QstGB0LXQvCDRhdC+0YDQvtGI0L4uINC90LXQu9GM0LfRjyDRgdC+0LfQtNCw0YLRjCDRg9C70LHRgNCw0Ysg0YEg0YDQsNC30L3Ri9C80Lgg0LrQvtC90YTQuNCz0LDQvNC4INC60L3QvtC/0L7QulxuICAgIC8vIHRoaXMudG9vbHMgPSB1dGlscy5vYmplY3QuY2xvbmVEZWVwKHRoaXMudG9vbHMpO1xuXG5cbiAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuICAgIC8vIGlmIChvcHRpb25zKSB7XG4gICAgLy8gICBpZiAob3B0aW9ucy5idXR0b24pIHtcbiAgICAvLyAgICAgdXRpbHMub2JqZWN0LmV4dGVuZCh0aGlzLnRvb2xzLmJ1dHRvbiwgb3B0aW9ucy5idXR0b24pO1xuICAgIC8vICAgfVxuICAgIC8vIH1cbiAgICAvLyBpZiAoIVBBUkVOVC5nZW5lcmF0ZWRBY3Rpb25zKSB7XG4gICAgLy8gICBQQVJFTlQubWFrZUFjdGlvbnMoIG1lbnUpO1xuICAgIC8vIH1cblxuICAgIGlmKGVsLmNvbnN0cnVjdG9yID09PSBTdHJpbmcpe1xuICAgICAgZWwgPSAkKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGVsKSk7XG4gICAgfVxuICAgIGlmKGVsLmxlbmd0aCl7XG4gICAgICB0aGlzLmdlbmVyYXRlTWVudShQQVJFTlQsIGVsLCBvcHRpb25zLCBtZW51KTtcbiAgICAgIHRoaXMub25DcmVhdGUoKTtcbiAgICAgIGVsLnNob3coKTtcbiAgICB9XG4gICAgVG9vbGJhci5pbml0S2V5cyhQQVJFTlQuZ2VuZXJhdGVkQWN0aW9ucyk7XG4gIH0sXG5vbkNyZWF0ZTogZnVuY3Rpb24gKCkge1xuXG4gIH0sXG4gIGRlc3Ryb3k6IGZ1bmN0aW9uICh0YXJnZXQpIHtcbiAgICBmb3IgKHZhciBpID0gdGhpcy5idXR0b25zLmxlbmd0aDtpLS07KSB7XG4gICAgICB2YXIgX2NvbmZpZyA9IHRoaXMuYnV0dG9uc1tpXTtcbiAgICAgIGlmKHRhcmdldCAmJiBfY29uZmlnLnRhcmdldCAhPSB0YXJnZXQgKXtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICB0aGlzLmJ1dHRvbnMuc3BsaWNlKGksMSk7XG4gICAgfVxuICAgIHRoaXMuZmlyZShcImRlc3Ryb3lcIik7XG4gIH0sXG4gIGNyZWF0ZUlucHV0OiBmdW5jdGlvbiAoJGl0ZW0sIGRhdGEsIHR5cGUpIHtcblxuICAgIHZhciB0YXJnZXQgPSBkYXRhLnRhcmdldDtcbiAgICB2YXIgJGlucHV0ID0gJChcIjxpbnB1dD5cIilcbiAgICAgIC5hdHRyKFwidHlwZVwiLCB0eXBlKVxuICAgICAgLmF0dHIoXCJtaW5cIiwgZGF0YS52YWx1ZS5taW4oKSlcbiAgICAgIC5hdHRyKFwibWF4XCIsIGRhdGEudmFsdWUubWF4KCkpO1xuXG4gICAgJGlucHV0LnZhbChkYXRhLnZhbHVlLmdldCgpKTtcbiAgICBpZiAoZGF0YS52YWx1ZS5vYnNlcnZlKSB7XG4gICAgICB0YXJnZXQub24oZGF0YS52YWx1ZS5vYnNlcnZlLCBmdW5jdGlvbiAodmFsKSB7XG4gICAgICAgICRpbnB1dC52YWwoZGF0YS52YWx1ZS5nZXQoKSk7XG4gICAgICB9KTtcbiAgICB9XG4gICAgJGlucHV0LmNoYW5nZShmdW5jdGlvbiAoZSkge1xuICAgICAgZGF0YS52YWx1ZS5zZXQocGFyc2VGbG9hdCgkaW5wdXQudmFsKCkpKVxuICAgIH0pO1xuICAgICRpdGVtLmFwcGVuZCgkaW5wdXQpO1xuICB9LFxuICBpbml0SXRlbTogZnVuY3Rpb24gKCRpdGVtLCBkYXRhKSB7XG5cbiAgICBpZiAoZGF0YS5hY3RpdmUpIHtcbiAgICAgIGlmIChkYXRhLmFjdGl2ZS5jYWxsKGRhdGEudGFyZ2V0LCBkYXRhLm9wdGlvbikpIHtcbiAgICAgICAgJGl0ZW0uYWRkQ2xhc3MoXCJhY3RpdmVcIik7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKGRhdGEudmlzaWJsZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBpZiAoZGF0YS52aXNpYmxlLmNvbnN0cnVjdG9yID09IEZ1bmN0aW9uKSB7XG4gICAgICAgIGlmICghZGF0YS52aXNpYmxlLmNhbGwoZGF0YS50YXJnZXQpKSB7XG4gICAgICAgICAgJGl0ZW0uaGlkZSgpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKCFkYXRhLnZpc2libGUpIHtcbiAgICAgICAgJGl0ZW0uaGlkZSgpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGRhdGEuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICBpZiAoZGF0YS5lbmFibGVkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGlmIChkYXRhLmVuYWJsZWQuY29uc3RydWN0b3IgPT0gRnVuY3Rpb24pIHtcbiAgICAgICAgaWYgKCFkYXRhLmVuYWJsZWQuY2FsbChkYXRhLnRhcmdldCkpIHtcbiAgICAgICAgICAkaXRlbS5hdHRyKFwiZGlzYWJsZWRcIiwgdHJ1ZSk7XG4gICAgICAgICAgZGF0YS5kaXNhYmxlZCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoZGF0YS5vYnNlcnZlKSB7XG4gICAgICAvL3RvZG9cbiAgICAgIGlmIChkYXRhLnZpc2libGUgJiYgZGF0YS52aXNpYmxlLmNvbnN0cnVjdG9yID09IEZ1bmN0aW9uKSB7XG4gICAgICAgIGRhdGEudGFyZ2V0ICYmIGRhdGEudGFyZ2V0Lm9uKGRhdGEub2JzZXJ2ZSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGlmICghZGF0YS52aXNpYmxlLmNhbGwoZGF0YS50YXJnZXQpKSB7XG4gICAgICAgICAgICAkaXRlbS5oaWRlKCk7XG4gICAgICAgICAgICBkYXRhLmhpZGRlbiA9IHRydWU7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICRpdGVtLnNob3coKTtcbiAgICAgICAgICAgIGRhdGEuaGlkZGVuID0gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgaWYgKGRhdGEudHlwZSA9PSBcIm9wdGlvbnNcIikge1xuICAgICAgICBkYXRhLnRhcmdldCAmJiBkYXRhLnRhcmdldC5vbihkYXRhLm9ic2VydmUsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICB2YXIgX3ZhbCA9IGRhdGEudmFsdWUuZ2V0KCk7XG4gICAgICAgICAgJChcIltuYW1lPVwiICsgZGF0YS5pZCArIFwiXVwiKS5wcm9wKFwiY2hlY2tlZFwiLGZhbHNlKTtcbiAgICAgICAgICAkKFwiW25hbWU9XCIgKyBkYXRhLmlkICsgXCJdW3ZhbHVlPVwiICsgX3ZhbCArXCJdXCIpLnByb3AoXCJjaGVja2VkXCIsdHJ1ZSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBpZiAoZGF0YS5lbmFibGVkICYmIGRhdGEuZW5hYmxlZC5jb25zdHJ1Y3RvciA9PSBGdW5jdGlvbikge1xuICAgICAgICBkYXRhLnRhcmdldCAmJiBkYXRhLnRhcmdldC5vbihkYXRhLm9ic2VydmUsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBpZiAoIWRhdGEuZW5hYmxlZC5jYWxsKGRhdGEudGFyZ2V0KSkge1xuICAgICAgICAgICAgJGl0ZW0uYXR0cihcImRpc2FibGVkXCIsIHRydWUpO1xuICAgICAgICAgICAgZGF0YS5kaXNhYmxlZCA9IHRydWU7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICRpdGVtLnJlbW92ZUF0dHIoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgICAgIGRhdGEuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgdG9nZ2xlQnlIb3ZlcjogZnVuY3Rpb24gKCRpdGVtLCAkdG9nZ2xlRWxlbWVudCwgZm9vLGRhdGEpIHtcblxuICAgIHZhciBvbkNsb3NlO1xuXG4gICAgJHRvZ2dsZUVsZW1lbnQuaGlkZSgpO1xuICAgICRpdGVtLm1vdXNlb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICR0b2dnbGVFbGVtZW50LmhpZGUoKTtcbiAgICAgIG9uQ2xvc2UgJiYgb25DbG9zZSgpO1xuICAgIH0pO1xuICAgICRpdGVtLm1vdXNlb3ZlcihmdW5jdGlvbiAoKSB7XG4gICAgICAkdG9nZ2xlRWxlbWVudC5zaG93KCk7XG4gICAgICBvbkNsb3NlID0gZm9vICYmIGZvbygpO1xuICAgIH0pO1xuXG4gICAgJGl0ZW0uY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKGRhdGEgJiYgZGF0YS5pbW1lZGlhdGVseSkge1xuICAgICAgICBkYXRhLmFjdGlvbigpO1xuICAgICAgfVxuICAgIH0pO1xuICB9LFxuICB0b2dnbGVCeUJ1dHRvbjogZnVuY3Rpb24gKCRpdGVtLCAkdG9nZ2xlRWxlbWVudCwgZm9vLGRhdGEpIHtcblxuICAgIHZhciBvbkNsb3NlO1xuICAgIHZhciBfdHJ5X2hpZGUgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgdmFyIF9wYXJlbnRzID0gJChlLnRhcmdldCkucGFyZW50cygpO1xuICAgICAgZm9yICh2YXIgaSBpbiBfcGFyZW50cykge1xuICAgICAgICBpZiAoX3BhcmVudHNbaV0gPT09ICRpdGVtWzBdKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoJHRvZ2dsZUVsZW1lbnQuY3NzKFwiZGlzcGxheVwiKSAhPT0gXCJub25lXCIpIHtcbiAgICAgICAgJHRvZ2dsZUVsZW1lbnQuaGlkZSgpO1xuICAgICAgICBvbkNsb3NlICYmIG9uQ2xvc2UoKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgJHRvZ2dsZUVsZW1lbnQuY2xpY2soZnVuY3Rpb24gKGUpIHtcbiAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgfSk7XG4gICAgJHRvZ2dsZUVsZW1lbnQuaGlkZSgpO1xuICAgICRpdGVtLmNsaWNrKGZ1bmN0aW9uICgpIHtcblxuICAgICAgaWYgKCR0b2dnbGVFbGVtZW50LmNzcyhcImRpc3BsYXlcIikgIT09IFwibm9uZVwiKSB7XG4gICAgICAgICR0b2dnbGVFbGVtZW50LmhpZGUoKTtcbiAgICAgICAgb25DbG9zZSAmJiBvbkNsb3NlKCk7XG4gICAgICAgICQod2luZG93KS5vZmYoXCJjbGlja1wiLCBfdHJ5X2hpZGUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgJHRvZ2dsZUVsZW1lbnQuc2hvdygpO1xuICAgICAgICAkKHdpbmRvdykub24oXCJjbGlja1wiLCBfdHJ5X2hpZGUpO1xuXG4gICAgICAgIG9uQ2xvc2UgPSBmb28gJiYgZm9vKCk7XG5cbiAgICAgICAgaWYoZGF0YSAmJiBkYXRhLmltbWVkaWF0ZWx5KXtcbiAgICAgICAgICBkYXRhLmFjdGlvbigpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSlcbiAgfSxcbiAgZ2VuZXJhdGVNZW51OiBmdW5jdGlvbiAodGFyZ2V0LCAkZWwsIG9wdGlvbnMsIG1lbnUpIHtcblxuICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHtcbiAgICAgICAgdGl0bGU6IGZhbHNlXG4gICAgICB9O1xuICAgIG9wdGlvbnMuYnV0dG9ucyA9IG9wdGlvbnMuYnV0dG9ucyB8fCB7XG4gICAgICAgIGNsYXNzTmFtZTogXCJcIixcbiAgICAgICAgdGl0bGU6IGZhbHNlXG4gICAgICB9O1xuXG4gICAgJGVsLmVtcHR5KCk7XG5cbiAgICB2YXIgX3RoaXMgPSAgdGhpcztcbiAgICBmb3IgKHZhciBpIGluIG1lbnUpIHtcbiAgICAgIHZhciBkYXRhID0gbWVudVtpXTtcbiAgICAgIGlmICghZGF0YSB8fCBkYXRhLmluc2VydCAhPT0gdW5kZWZpbmVkICYmICFkYXRhLmluc2VydCkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIGRhdGEudHlwZSA9IGRhdGEudHlwZSB8fCBcImJ1dHRvblwiO1xuXG4gICAgICAvL3RvZG8g0L3QtdC/0L7QvdGP0YLQvdC+INC30LDRh9C10Lwg0LDRgNCz0YPQvNC10L3RgiB0YXJnZXQg0LIg0L3QsNGH0LDQu9C1XG4gICAgICB2YXIgdGFyZ2V0ID0gZGF0YS50YXJnZXQ7XG5cbiAgICAgIHZhciB0b29sID0gdGhpcy50b29sc1tkYXRhLnR5cGVdO1xuXG4gICAgICBpZiAoIXRvb2wpIHtcbiAgICAgICAgY29uc29sZS53YXJuKFwidG9vbCAnXCIgKyBkYXRhLnR5cGUgKyBcIicgdW5kZWZpbmVkXCIpO1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIHZhciBzY29wZSA9IGRhdGE7XG4gICAgICBpZiAodG9vbC5zY29wZSkge1xuICAgICAgICBzY29wZSA9IGZhYnJpYy51dGlsLm9iamVjdC5kZWZhdWx0cyh0b29sLnNjb3BlLmNhbGwodGhpcywgZGF0YSwgb3B0aW9ucyksZGF0YSk7XG4gICAgICB9XG5cbiAgICAgIHZhciAkaXRlbSA9ICQodG9vbC50ZW1wbGF0ZS5mb3JtYXQoc2NvcGUpKTtcbiAgICAgIHZhciB0cmFuc2NsdWRlID0gJGl0ZW0uZmluZChcIlt0cmFuc2NsdWRlXVwiKTtcbiAgICAgIHNjb3BlLiRpdGVtID0gZGF0YS4kaXRlbSA9ICRpdGVtO1xuICAgICAgaWYoZGF0YS50ZW1wbGF0ZSl7XG4gICAgICAgICRpdGVtLmh0bWwoZGF0YS50ZW1wbGF0ZS5mb3JtYXQoZGF0YS52YWx1ZS5nZXQoKSkpO1xuICAgICAgfVxuXG4gICAgICB1dGlscy5jb21waWxlLmNvbXBpbGVFbGVtZW50KCRpdGVtLHNjb3BlKTtcblxuICAgICAgaWYgKGRhdGEudmFsdWUgJiYgZGF0YS52YWx1ZS5vYnNlcnZlKSB7XG5cbiAgICAgICAgdGFyZ2V0Lm9uKGRhdGEudmFsdWUub2JzZXJ2ZSwgZnVuY3Rpb24gKHZhbCkge1xuXG4gICAgICAgICAgaWYgKHRvb2wucG9zdCkge1xuICAgICAgICAgICAgdG9vbC5wb3N0LmNhbGwoX3RoaXMsJGl0ZW0sIHNjb3BlLCBvcHRpb25zLCB0cmFuc2NsdWRlLmxlbmd0aCA/IHRyYW5zY2x1ZGUgOiBudWxsKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYodG9vbC5yZW5kZXIpe1xuICAgICAgICAgICAgdG9vbC5yZW5kZXIuY2FsbChfdGhpcywgJGl0ZW0sIGRhdGEsIG9wdGlvbnMsIHRvb2wsIHZhbCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIC8vdGhpcy5maXJlKGRhdGEudHlwZSArIFwiOnJlbmRlclwiLHtpdGVtOiAkaXRlbSwgZGF0YTogZGF0YSwgb3B0aW9uczogb3B0aW9ucywgdG9vbDogdG9vbCwgdmFsOiB2YWx9KVxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5pbml0SXRlbSgkaXRlbSwgZGF0YSk7XG5cbiAgICAgIGlmICh0b29sLnBvc3QpIHtcbiAgICAgICAgdG9vbC5wb3N0LmNhbGwodGhpcywkaXRlbSwgc2NvcGUsIG9wdGlvbnMsIHRyYW5zY2x1ZGUubGVuZ3RoID8gdHJhbnNjbHVkZSA6IG51bGwpO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmZpcmUoZGF0YS50eXBlICsgXCI6Y3JlYXRlZFwiLHtpdGVtOiAkaXRlbSwgZGF0YTogZGF0YSwgb3B0aW9uczogb3B0aW9ucywgdG9vbDogdG9vbH0pO1xuXG4gICAgICAkZWwuYXBwZW5kKCRpdGVtKTtcbiAgICB9XG4gIH1cbn07XG51dGlscy5vYnNlcnZhYmxlKFRvb2xiYXIucHJvdG90eXBlKTtcblxuXG5Ub29sYmFyLnNpbmdsZSA9IGZ1bmN0aW9uKGRhdGEsZWxlbWVudCl7XG4gIGRhdGEuJGl0ZW0gPSBlbGVtZW50O1xuICBkYXRhLnR5cGUgPSBkYXRhLnR5cGUgfHwgXCJidXR0b25cIjtcblxuICB2YXIgdG9vbCA9IFRvb2xiYXIucHJvdG90eXBlLnRvb2xzW2RhdGEudHlwZV07XG5cbiAgVG9vbGJhci5wcm90b3R5cGUuaW5pdEl0ZW0oZWxlbWVudCxkYXRhKTtcblxuICBpZiAoZGF0YS52YWx1ZSAmJiBkYXRhLnZhbHVlLm9ic2VydmUpIHtcbiAgICBkYXRhLnRhcmdldC5vbihkYXRhLnZhbHVlLm9ic2VydmUsIGZ1bmN0aW9uICh2YWwpIHtcbiAgICAgIHRvb2wucmVuZGVyKCBlbGVtZW50LCBkYXRhLCB7fSwgdG9vbCwgdmFsKVxuICAgIH0pO1xuICB9XG5cbiAgaWYodG9vbC5wb3N0KXtcbiAgICB2YXIgdHJhbnNjbHVkZSA9IGVsZW1lbnQuZmluZChcIlt0cmFuc2NsdWRlXVwiKTtcblxuICAgIHRvb2wucG9zdC5jYWxsKFRvb2xiYXIucHJvdG90eXBlLCBlbGVtZW50LCBkYXRhLCB7fSwgdHJhbnNjbHVkZS5sZW5ndGggPyB0cmFuc2NsdWRlIDogbnVsbCk7XG4gIH1cblxuICB2YXIgc2NvcGUgPSBkYXRhO1xuICBpZih0b29sLnNjb3BlKXtcbiAgICBzY29wZSA9IF8uZGVmYXVsdHMoZGF0YSwgdG9vbC5zY29wZS5jYWxsKFRvb2xiYXIucHJvdG90eXBlLCBkYXRhLCB7fSkpO1xuICB9XG5cbiAgZWxlbWVudC5lYWNoU2VsZihcIipcIixmdW5jdGlvbigpe1xuICAgIHZhciBub2Rlcz1bXSwgdmFsdWVzPVtdO1xuICAgIGZvciAodmFyIGF0dCwgaSA9IDAsIGF0dHMgPSB0aGlzLmF0dHJpYnV0ZXMsIG4gPSBhdHRzLmxlbmd0aDsgaSA8IG47IGkrKyl7XG4gICAgICBhdHQgPSBhdHRzW2ldO1xuICAgICAgbm9kZXMucHVzaChhdHQubm9kZU5hbWUpO1xuICAgICAgdmFsdWVzLnB1c2goYXR0Lm5vZGVWYWx1ZSk7XG4gICAgICB0aGlzLnNldEF0dHJpYnV0ZShhdHQubm9kZU5hbWUsYXR0Lm5vZGVWYWx1ZS5mb3JtYXQoc2NvcGUpKTtcbiAgICB9XG4gIH0pO1xuICB1dGlscy5jb21waWxlLmNvbXBpbGVFbGVtZW50KGVsZW1lbnQsc2NvcGUpO1xufTtcblxuXG5tb2R1bGUuZXhwb3J0cyA9IFRvb2xiYXI7XG5cblxuXG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gdG9vbGJhci90b29sYmFyLmpzIiwidmFyIHV0aWxzID0ge1xuICAvKipcbiAgICpcbiAgICogQHBhcmFtIGFyclxuICAgKiBAcGFyYW0gYXJyMlxuICAgKiBAcmV0dXJucyB7e319XG4gICAqIEBleGFtcGxlXG4gICAqICAgIHggPSB7YTogMSAsYjogMSwgYzogWzEsMl19XG4gICAqICAgIHkgPSB7YTogMiAsICBjIDogMyAsIGQgOiAxfVxuICAgKlxuICAgKiAgICBleHRlbmRBcnJheXNPYmplY3QoeCx5KSA9IHthOiBbMSwyXSBiIDogWzFdIGMgOiBbMSwyLDNdLCBkIFsxXSB9XG4gICAqL1xuICBleHRlbmRBcnJheXNPYmplY3QgOiBmdW5jdGlvbihhcnIsYXJyMil7XG4gICAgdmFyIG5ld0FycmF5ID0ge307XG5cbiAgICBmb3IodmFyIGkgaW4gYXJyKXtcbiAgICAgIGlmKGFycltpXS5jb25zdHJ1Y3RvciA9PSBBcnJheSl7XG4gICAgICAgIG5ld0FycmF5W2ldICA9IFtdLmNvbmNhdChhcnJbaV0pO1xuICAgICAgfWVsc2V7XG4gICAgICAgIG5ld0FycmF5W2ldID0gW2FycltpXV07XG4gICAgICB9XG4gICAgfVxuXG4gICAgZm9yKHZhciBpIGluIGFycjIpe1xuICAgICAgaWYobmV3QXJyYXlbaV0pe1xuICAgICAgICBuZXdBcnJheVtpXS5wdXNoKGFycjJbaV0pO1xuICAgICAgfWVsc2V7XG4gICAgICAgIG5ld0FycmF5W2ldID0gW2FycjJbaV1dO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbmV3QXJyYXk7XG4gIH0sXG4gIGZpbHRlclZhbHVlczogZnVuY3Rpb24gKGFycmF5LCB2YWx1ZXMpIHtcbiAgICB2YXIgbmV3X2FycmF5ID0gW107XG4gICAgZm9yICh2YXIgaSBpbiBhcnJheSkge1xuICAgICAgdmFyIF9uZXdfb2JqZWN0ID0ge307XG4gICAgICBmb3IgKHZhciBqIGluIHZhbHVlcykge1xuICAgICAgICBfbmV3X29iamVjdFt2YWx1ZXNbal1dID0gYXJyYXlbaV1bdmFsdWVzW2pdXVxuICAgICAgfVxuICAgICAgbmV3X2FycmF5LnB1c2goX25ld19vYmplY3QpO1xuICAgIH1cbiAgICByZXR1cm4gbmV3X2FycmF5O1xuICB9LFxuXG4gIC8qKlxuICAgKiAg0KLQsNGB0L7QstCw0L3QuNC1INCk0LjRiNC10YDQsOKAk9CZ0LXRgtGB0LAs0YHQu9GD0YfQsNC50L3QvtC1INGC0LDRgdC+0LLQsNC90LjQtSDQvNC90L7QttC10YHRgtCy0LBcbiAgICogQHBhcmFtIG9iamVjdFxuICAgKiBAcmV0dXJucyB7Kn1cbiAgICovXG4gIHNodWZmbGU6IGZ1bmN0aW9uIChvYmplY3QpIHtcbiAgICBpZiAoIW9iamVjdC5sZW5ndGgpIHJldHVybjtcbiAgICB2YXIgaSA9IG9iamVjdC5sZW5ndGg7XG4gICAgd2hpbGUgKC0taSkge1xuICAgICAgdmFyIGogPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoaSArIDEpKTtcbiAgICAgIHZhciB0ZW1wID0gb2JqZWN0W2ldO1xuICAgICAgb2JqZWN0W2ldID0gb2JqZWN0W2pdO1xuICAgICAgb2JqZWN0W2pdID0gdGVtcDtcbiAgICB9XG5cbiAgICByZXR1cm4gb2JqZWN0OyAvLyBmb3IgY29udmVuaWVuY2UsIGluIGNhc2Ugd2Ugd2FudCBhIHJlZmVyZW5jZSB0byB0aGUgYXJyYXlcbiAgfSxcbiAgLyoqXG4gICAqIERlcGVuZGVuY3k6IHVuZGVyc2NvcmUuanMgKCBodHRwOi8vZG9jdW1lbnRjbG91ZC5naXRodWIuY29tL3VuZGVyc2NvcmUvIClcbiAgICpcbiAgICogTWl4IGl0IGluIHdpdGggdW5kZXJzY29yZS5qczpcbiAgICogXy5taXhpbih7ZGVlcEV4dGVuZDogZGVlcEV4dGVuZH0pO1xuICAgKlxuICAgKiBDYWxsIGl0IGxpa2UgdGhpczpcbiAgICogdmFyIG15T2JqID0gdXRpbHMuZGVlcEV4dGVuZChncmFuZHBhcmVudCwgY2hpbGQsIGdyYW5kY2hpbGQsIGdyZWF0Z3JhbmRjaGlsZClcbiAgICpcbiAgICogTm90ZXM6XG4gICAqIEtlZXAgaXQgRFJZLlxuICAgKiBUaGlzIGZ1bmN0aW9uIGlzIGVzcGVjaWFsbHkgdXNlZnVsIGlmIHlvdSdyZSB3b3JraW5nIHdpdGggSlNPTiBjb25maWcgZG9jdW1lbnRzLiBJdCBhbGxvd3MgeW91IHRvIGNyZWF0ZSBhIGRlZmF1bHRcbiAgICogY29uZmlnIGRvY3VtZW50IHdpdGggdGhlIG1vc3QgY29tbW9uIHNldHRpbmdzLCB0aGVuIG92ZXJyaWRlIHRob3NlIHNldHRpbmdzIGZvciBzcGVjaWZpYyBjYXNlcy4gSXQgYWNjZXB0cyBhbnlcbiAgICogbnVtYmVyIG9mIG9iamVjdHMgYXMgYXJndW1lbnRzLCBnaXZpbmcgeW91IGZpbmUtZ3JhaW5lZCBjb250cm9sIG92ZXIgeW91ciBjb25maWcgZG9jdW1lbnQgaGllcmFyY2h5LlxuICAgKlxuICAgKiBTcGVjaWFsIEZlYXR1cmVzIGFuZCBDb25zaWRlcmF0aW9uczpcbiAgICogLSBwYXJlbnRSRSBhbGxvd3MgeW91IHRvIGNvbmNhdGVuYXRlIHN0cmluZ3MuIGV4YW1wbGU6XG4gICAqICAgdmFyIG9iaiA9IHV0aWxzLmRlZXBFeHRlbmQoe3VybDogXCJ3d3cuZXhhbXBsZS5jb21cIn0sIHt1cmw6IFwiaHR0cDovLyN7X30vcGF0aC90by9maWxlLmh0bWxcIn0pO1xuICAgKiAgIGNvbnNvbGUubG9nKG9iai51cmwpO1xuICAgKiAgIG91dHB1dDogXCJodHRwOi8vd3d3LmV4YW1wbGUuY29tL3BhdGgvdG8vZmlsZS5odG1sXCJcbiAgICpcbiAgICogLSBwYXJlbnRSRSBhbHNvIGFjdHMgYXMgYSBwbGFjZWhvbGRlciwgd2hpY2ggY2FuIGJlIHVzZWZ1bCB3aGVuIHlvdSBuZWVkIHRvIGNoYW5nZSBvbmUgdmFsdWUgaW4gYW4gYXJyYXksIHdoaWxlXG4gICAqICAgbGVhdmluZyB0aGUgb3RoZXJzIHVudG91Y2hlZC4gZXhhbXBsZTpcbiAgICogICB2YXIgYXJyID0gdXRpbHMuZGVlcEV4dGVuZChbMTAwLCAgICB7aWQ6IDEyMzR9LCB0cnVlLCAgXCJmb29cIiwgIFsyNTAsIDUwMF1dLFxuICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgW1wiI3tffVwiLCBcIiN7X31cIiwgICAgIGZhbHNlLCBcIiN7X31cIiwgXCIje199XCJdKTtcbiAgICogICBjb25zb2xlLmxvZyhhcnIpO1xuICAgKiAgIG91dHB1dDogWzEwMCwge2lkOiAxMjM0fSwgZmFsc2UsIFwiZm9vXCIsIFsyNTAsIDUwMF1dXG4gICAqXG4gICAqIC0gVGhlIHByZXZpb3VzIGV4YW1wbGUgY2FuIGFsc28gYmUgd3JpdHRlbiBsaWtlIHRoaXM6XG4gICAqICAgdmFyIGFyciA9IHV0aWxzLmRlZXBFeHRlbmQoWzEwMCwgICAge2lkOjEyMzR9LCAgIHRydWUsICBcImZvb1wiLCAgWzI1MCwgNTAwXV0sXG4gICAqICAgICAgICAgICAgICAgICAgICAgICAgICBbXCIje199XCIsIHt9LCAgICAgICAgICBmYWxzZSwgXCIje199XCIsIFtdXSk7XG4gICAqICAgY29uc29sZS5sb2coYXJyKTtcbiAgICogICBvdXRwdXQ6IFsxMDAsIHtpZDogMTIzNH0sIGZhbHNlLCBcImZvb1wiLCBbMjUwLCA1MDBdXVxuICAgKlxuICAgKiAtIEFuZCBhbHNvIGxpa2UgdGhpczpcbiAgICogICB2YXIgYXJyID0gdXRpbHMuZGVlcEV4dGVuZChbMTAwLCAgICB7aWQ6MTIzNH0sICAgdHJ1ZSwgIFwiZm9vXCIsICBbMjUwLCA1MDBdXSxcbiAgICogICAgICAgICAgICAgICAgICAgICAgICAgIFtcIiN7X31cIiwge30sICAgICAgICAgIGZhbHNlXSk7XG4gICAqICAgY29uc29sZS5sb2coYXJyKTtcbiAgICogICBvdXRwdXQ6IFsxMDAsIHtpZDogMTIzNH0sIGZhbHNlLCBcImZvb1wiLCBbMjUwLCA1MDBdXVxuICAgKlxuICAgKiAtIEFycmF5IG9yZGVyIGlzIGltcG9ydGFudC4gZXhhbXBsZTpcbiAgICogICB2YXIgYXJyID0gdXRpbHMuZGVlcEV4dGVuZChbMSwgMiwgMywgNF0sIFsxLCA0LCAzLCAyXSk7XG4gICAqICAgY29uc29sZS5sb2coYXJyKTtcbiAgICogICBvdXRwdXQ6IFsxLCA0LCAzLCAyXVxuICAgKlxuICAgKiAtIFlvdSBjYW4gcmVtb3ZlIGFuIGFycmF5IGVsZW1lbnQgc2V0IGluIGEgcGFyZW50IG9iamVjdCBieSBzZXR0aW5nIHRoZSBzYW1lIGluZGV4IHZhbHVlIHRvIG51bGwgaW4gYSBjaGlsZCBvYmplY3QuXG4gICAqICAgZXhhbXBsZTpcbiAgICogICB2YXIgb2JqID0gdXRpbHMuZGVlcEV4dGVuZCh7YXJyOiBbMSwgMiwgMywgNF19LCB7YXJyOiBbXCIje199XCIsIG51bGxdfSk7XG4gICAqICAgY29uc29sZS5sb2cob2JqLmFycik7XG4gICAqICAgb3V0cHV0OiBbMSwgMywgNF1cbiAgICpcbiAgICoqL1xuICBkZWVwRXh0ZW5kOiBmdW5jdGlvbiAoLypvYmpfMSwgW29ial8yXSwgW29ial9OXSovKSB7XG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPCAxIHx8IHR5cGVvZiBhcmd1bWVudHNbMF0gIT09ICdvYmplY3QnKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPCAyKSByZXR1cm4gYXJndW1lbnRzWzBdO1xuXG4gICAgdmFyIHRhcmdldCA9IGFyZ3VtZW50c1swXTtcblxuICAgIC8vIGNvbnZlcnQgYXJndW1lbnRzIHRvIGFycmF5IGFuZCBjdXQgb2ZmIHRhcmdldCBvYmplY3RcbiAgICB2YXIgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSk7XG5cbiAgICB2YXIga2V5LCB2YWwsIHNyYywgY2xvbmUsIHRtcEJ1ZjtcblxuICAgIGFyZ3MuZm9yRWFjaChmdW5jdGlvbiAob2JqKSB7XG4gICAgICBpZiAodHlwZW9mIG9iaiAhPT0gJ29iamVjdCcpIHJldHVybjtcblxuICAgICAgZm9yIChrZXkgaW4gb2JqKSB7XG4gICAgICAgIGlmICghKGtleSBpbiBvYmopKSBjb250aW51ZTtcblxuICAgICAgICBzcmMgPSB0YXJnZXRba2V5XTtcbiAgICAgICAgdmFsID0gdXRpbHMuY2xvbmVEZWVwKG9ialtrZXldKTtcblxuXG4gICAgICAgIGlmICh0eXBlb2Ygc3JjICE9PSAnb2JqZWN0JyB8fCBzcmMgPT09IG51bGwpIHtcbiAgICAgICAgICB0YXJnZXRba2V5XSA9IHZhbDtcbiAgICAgICAgfWVsc2UgaWYgKEFycmF5LmlzQXJyYXkodmFsKSkge1xuICAgICAgICAgIGNsb25lID0gKEFycmF5LmlzQXJyYXkoc3JjKSkgPyBzcmMgOiBbXTtcblxuICAgICAgICAgIHZhbC5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pe1xuICAgICAgICAgICAgY2xvbmUucHVzaCh1dGlscy5jbG9uZURlZXAoaXRlbSkpO1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgdGFyZ2V0W2tleV0gPSBjbG9uZTtcbiAgICAgICAgICAvL3RvZG8gINC10YHQu9C4INC30LDQuNC80YHRgtCy0YPQtdC8INC80LDRgdGB0LjQsiAsINGC0L4g0YHRgdC+0YXRgNCw0L3Rj9C10Lwg0LfQvdCw0YfQtdC90LjRjyDQuNC3INC+0LHQvtC40YUg0LzQsNGB0YHQuNCy0L7QslxuICAgICAgICAgIC8vdGFyZ2V0W2tleV0gPSB1dGlscy5kZWVwRXh0ZW5kKGNsb25lLCB2YWwpO1xuXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY2xvbmUgPSAoIUFycmF5LmlzQXJyYXkoc3JjKSkgPyBzcmMgOiB7fTtcbiAgICAgICAgICB0YXJnZXRba2V5XSA9IHV0aWxzLmRlZXBFeHRlbmQoY2xvbmUsIHZhbCk7XG4gICAgICAgIH1cblxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIHRhcmdldDtcbiAgfSxcbiAgY2xvbmVEZWVwOiBmdW5jdGlvbiAodmFsKSB7XG5cbiAgICBpZiAodHlwZW9mIHZhbCA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgaWYgKHZhbCA9PT0gbnVsbCkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBEYXRlKSB7XG4gICAgICByZXR1cm4gbmV3IERhdGUodmFsLmdldFRpbWUoKSk7XG4gICAgfSBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBSZWdFeHApIHtcbiAgICAgIHJldHVybiBuZXcgUmVnRXhwKHZhbCk7XG4gICAgfVxuXG4gICAgaWYodmFsLmNsb25lU3luYyl7XG4gICAgICByZXR1cm4gdmFsLmNsb25lU3luYygpO1xuICAgIH1lbHNlIGlmKHZhbC5jb25zdHJ1Y3RvciA9PSBPYmplY3Qpe1xuICAgICAgcmV0dXJuIHV0aWxzLmRlZXBFeHRlbmQoe30sIHZhbCk7XG4gICAgfWVsc2UgaWYodmFsLmNvbnN0cnVjdG9yID09IEFycmF5KXtcbiAgICAgIHZhciBjbG9uZSA9IFtdO1xuICAgICAgZm9yKHZhciBpID0wIDtpIDwgdmFsLmxlbmd0aDsgaSsrKXtcbiAgICAgICAgY2xvbmUucHVzaCh1dGlscy5jbG9uZURlZXAodmFsW2ldKSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gY2xvbmU7XG4gICAgfWVsc2V7XG4gICAgICByZXR1cm4gdmFsO1xuICAgIH1cbiAgfSxcbiAgcmVhcnJhbmdlOiBmdW5jdGlvbiAob2JqZWN0LCBrZXlzKSB7XG4gICAgdmFyIF9uZXdPcmRlciA9IHt9O1xuICAgIGZvciAodmFyIGkgaW4ga2V5cykge1xuICAgICAgaWYob2JqZWN0W2tleXNbaV1dICE9PSB1bmRlZmluZWQpe1xuICAgICAgICBfbmV3T3JkZXJba2V5c1tpXV0gPSBvYmplY3Rba2V5c1tpXV1cbiAgICAgIH1cbiAgICB9XG4gICAgLy8gZm9yIChpIGluIG9iamVjdCkge1xuICAgIC8vICAgZGVsZXRlIG9iamVjdFtpXTtcbiAgICAvLyB9XG4gICAgLy8gZm9yIChpIGluIF9uZXdPcmRlcikge1xuICAgIC8vICAgb2JqZWN0W2ldID0gX25ld09yZGVyW2ldO1xuICAgIC8vIH1cbiAgICByZXR1cm4gX25ld09yZGVyO1xuICB9LFxuICBtYXA6IF8ubWFwLFxuICBzb3J0Qnk6IF8uc29ydEJ5LFxuICBkZWZhdWx0czogXy5kZWZhdWx0cyxcbiAgd2hlcmU6IF8ud2hlcmUsXG4gIGZpbmRXaGVyZTogXy5maW5kV2hlcmUsXG4gIGZpbHRlcjogXy5maWx0ZXIsXG4gIHBpY2s6IF8ucGljayxcbiAgcGx1Y2s6IF8ucGx1Y2ssXG4gIGV4dGVuZDogZnVuY3Rpb24gKGRlc3RpbmF0aW9uKSB7XG4gICAgLy8gSlNjcmlwdCBEb250RW51bSBidWcgaXMgbm90IHRha2VuIGNhcmUgb2ZcbiAgICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykge1xuICAgICAgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXTtcbiAgICAgIGZvciAodmFyIHByb3BlcnR5IGluIHNvdXJjZSkge1xuICAgICAgICBkZXN0aW5hdGlvbltwcm9wZXJ0eV0gPSBzb3VyY2VbcHJvcGVydHldO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZGVzdGluYXRpb247XG4gIH1cbn07XG5tb2R1bGUuZXhwb3J0cyA9ICB1dGlscztcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvdXRpbC9vYmplY3QuanMiLCJsZXQgb2JqZWN0VXRpbHMgPSByZXF1aXJlKFwiLi9vYmplY3RcIik7XG5cbmxldCB1dGlscyA9IHtcbiAgLyoqXG4gICAqIHdpbGwgZGl2aWRlIHRvdGFsIHdpZHRoIGZvciBldmVyeSBvYmplY3QgaW4gY29sdW1udHMgYXJyYXlcbiAgICpcbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogICAgIHZhciBfZmxleEFycmF5ID0gZmFicmljLnV0aWwuZmxleCgyMDAgLCBbe2ZsZXg6IDB9LHt2YWx1ZTogMTAwLCBmbGV4OiAxfSx7ZmxleDogMH1dICk7XG4gICAqIEBwYXJhbSB0b3RhbFxuICAgKiBAcGFyYW0gY29sdW1uc1xuICAgKiBAcmV0dXJucyB7QXJyYXl9XG4gICAqIEBleGFtcGxlIFs1MCwxMDAsNTBdXG4gICAqL1xuICBmbGV4OiBmdW5jdGlvbiAodG90YWwsY29sdW1ucyl7XG4gICAgdmFyIF9yZXR1cm4gPSBbXTtcbiAgICB2YXIgc3BsaXQgPSAwO1xuICAgIGNvbHVtbnMuZm9yRWFjaChmdW5jdGlvbihjb2x1bW4sIGluZGV4KXtcbiAgICAgIGlmKGNvbHVtbi52YWx1ZSA9PT0gdW5kZWZpbmVkKXtcbiAgICAgICAgc3BsaXQrKztcbiAgICAgIH1lbHNle1xuICAgICAgICB0b3RhbCAtPSBjb2x1bW4udmFsdWU7XG4gICAgICB9XG4gICAgfSk7XG4gICAgdmFyIF93ID0gdG90YWwgLyBzcGxpdDtcbiAgICBjb2x1bW5zLmZvckVhY2goZnVuY3Rpb24oY29sdW1uKXtcbiAgICAgIF9yZXR1cm4ucHVzaChjb2x1bW4udmFsdWUgPT09IHVuZGVmaW5lZCA/IF93IDogIGNvbHVtbi52YWx1ZSApO1xuICAgIH0pO1xuICAgIHJldHVybiBfcmV0dXJuO1xuICB9LFxuICB3b3JrZXI6IGZ1bmN0aW9uIChmb28pIHtcbiAgICBpZiAod2luZG93Lldvcmtlcikge1xuICAgICAgdmFyIHN0ciA9IGZvby50b1N0cmluZygpO1xuICAgICAgdmFyIGV2ZW50QXJnID0gc3RyLnN1YnN0cmluZyhzdHIuaW5kZXhPZihcIihcIikgKyAxLHN0ci5pbmRleE9mKFwiLFwiKSk7XG4gICAgICB2YXIgcG9zdE1lc3NhZ2VBcmcgPSBzdHIuc3Vic3RyaW5nKHN0ci5pbmRleE9mKFwiLFwiKSArIDEsc3RyLmluZGV4T2YoXCIpXCIpKTtcbiAgICAgIHZhciBfZnVuY3Rpb25Cb2R5ID0gc3RyLnN1YnN0cmluZyhzdHIuaW5kZXhPZihcIntcIikgKyAxKTtcbiAgICAgIHN0ciA9IFwib25tZXNzYWdlPWZ1bmN0aW9uKFwiICsgZXZlbnRBcmcgKyBcIil7XCIgKyBwb3N0TWVzc2FnZUFyZyArIFwiPSBwb3N0TWVzc2FnZTtcIiArIF9mdW5jdGlvbkJvZHk7XG4gICAgICB2YXIgYmxvYiA9IG5ldyBCbG9iKFtzdHJdKTtcbiAgICAgIC8vXCJvbm1lc3NhZ2UgPSBmdW5jdGlvbihlKSB7IHBvc3RNZXNzYWdlKCdtc2cgZnJvbSB3b3JrZXInKTsgfVwiXSk7XG4gICAgICB2YXIgYmxvYlVSTCA9IHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpO1xuICAgICAgcmV0dXJuIG5ldyBXb3JrZXIoYmxvYlVSTCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHZhciB3b3JrZXIgPSB7XG4gICAgICAgIHRlcm1pbmF0ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICB9LFxuICAgICAgICBwb3N0TWVzc2FnZTogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGZvbyh7ZGF0YTogZGF0YX0sIGZ1bmN0aW9uIChyZXNwb25zZURhdGEpIHtcbiAgICAgICAgICAgICAgd29ya2VyLm9ubWVzc2FnZSAmJiB3b3JrZXIub25tZXNzYWdlKHtkYXRhOiByZXNwb25zZURhdGF9KTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICByZXR1cm4gd29ya2VyO1xuICAgIH1cbiAgfSxcbiAgb2JzZXJ2YWJsZTogZnVuY3Rpb24gKG9iaikge1xuICAgIF8uZXh0ZW5kKG9iaiwge1xuXG4gICAgICBmaXJlOiBmdW5jdGlvbiBmaXJlKGV2ZW50TmFtZSwgb3B0aW9ucykge1xuICAgICAgICBpZiAoIXRoaXMuX19ldmVudExpc3RlbmVycykge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB2YXIgbGlzdGVuZXJzRm9yRXZlbnQgPSB0aGlzLl9fZXZlbnRMaXN0ZW5lcnNbZXZlbnROYW1lXTtcbiAgICAgICAgaWYgKCFsaXN0ZW5lcnNGb3JFdmVudCkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gbGlzdGVuZXJzRm9yRXZlbnQubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgICBsaXN0ZW5lcnNGb3JFdmVudFtpXS5jYWxsKHRoaXMsIG9wdGlvbnMgfHwge30pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgfSxcbiAgICAgIG9uOiBmdW5jdGlvbiAoZXZlbnROYW1lLCBoYW5kbGVyKSB7XG4gICAgICAgIGlmIChldmVudE5hbWUuY29uc3RydWN0b3IgPT0gT2JqZWN0KSB7XG4gICAgICAgICAgZm9yICh2YXIgaSBpbiBldmVudE5hbWUpIHtcbiAgICAgICAgICAgIHRoaXMub24oaSwgZXZlbnROYW1lW2ldKVxuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfVxuICAgICAgICB2YXIgZXZlbnRzID0gZXZlbnROYW1lLnNwbGl0KFwiIFwiKTtcbiAgICAgICAgZm9yICh2YXIgaSBpbiBldmVudHMpIHtcbiAgICAgICAgICB0aGlzLm9ic2VydmUoZXZlbnRzW2ldLCBoYW5kbGVyKVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgfSxcbiAgICAgIG9ic2VydmU6IGZ1bmN0aW9uIChldmVudE5hbWUsIGhhbmRsZXIpIHtcbiAgICAgICAgaWYgKCF0aGlzLl9fZXZlbnRMaXN0ZW5lcnMpIHtcbiAgICAgICAgICB0aGlzLl9fZXZlbnRMaXN0ZW5lcnMgPSB7fTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgIGZvciAodmFyIHByb3AgaW4gZXZlbnROYW1lKSB7XG4gICAgICAgICAgICB0aGlzLm9uKHByb3AsIGV2ZW50TmFtZVtwcm9wXSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIGlmICghdGhpcy5fX2V2ZW50TGlzdGVuZXJzW2V2ZW50TmFtZV0pIHtcbiAgICAgICAgICAgIHRoaXMuX19ldmVudExpc3RlbmVyc1tldmVudE5hbWVdID0gW107XG4gICAgICAgICAgfVxuICAgICAgICAgIHRoaXMuX19ldmVudExpc3RlbmVyc1tldmVudE5hbWVdLnB1c2goaGFuZGxlcik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICB9LFxuICAgICAgb2ZmOiBmdW5jdGlvbiBzdG9wT2JzZXJ2aW5nKGV2ZW50TmFtZSwgaGFuZGxlcikge1xuICAgICAgICBmdW5jdGlvbiBfcmVtb3ZlRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIGhhbmRsZXIpIHtcbiAgICAgICAgICBpZiAoIXRoaXMuX19ldmVudExpc3RlbmVyc1tldmVudE5hbWVdKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKGhhbmRsZXIpIHtcbiAgICAgICAgICAgIHZhciBpZHggPSB0aGlzLl9fZXZlbnRMaXN0ZW5lcnNbZXZlbnROYW1lXS5pbmRleE9mKGhhbmRsZXIpO1xuICAgICAgICAgICAgaWYgKGlkeCAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgdGhpcy5fX2V2ZW50TGlzdGVuZXJzW2V2ZW50TmFtZV0uc3BsaWNlKGlkeCwgMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5fX2V2ZW50TGlzdGVuZXJzW2V2ZW50TmFtZV0ubGVuZ3RoID0gMDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIXRoaXMuX19ldmVudExpc3RlbmVycykge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgIHRoaXMuX19ldmVudExpc3RlbmVycyA9IHt9O1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDEgJiYgdHlwZW9mIGFyZ3VtZW50c1swXSA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgICBmb3IgKHZhciBwcm9wIGluIGV2ZW50TmFtZSkge1xuICAgICAgICAgICAgX3JlbW92ZUV2ZW50TGlzdGVuZXIuY2FsbCh0aGlzLCBwcm9wLCBldmVudE5hbWVbcHJvcF0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICBfcmVtb3ZlRXZlbnRMaXN0ZW5lci5jYWxsKHRoaXMsIGV2ZW50TmFtZSwgaGFuZGxlcik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICB9XG4gICAgfSlcbiAgfSxcbiAgaW5PcmRlcjogZnVuY3Rpb24gKGFycmF5LCBmb28sIGNhbGxiYWNrKSB7XG4gICAgdmFyIF9pbmRleCA9IDA7XG4gICAgZnVuY3Rpb24gX2luT3JkZXJJbmRleCgpIHtcbiAgICAgIGlmICgrK19pbmRleCA8IGFycmF5Lmxlbmd0aCkge1xuICAgICAgICBmb28oYXJyYXlbX2luZGV4XSwgX2luZGV4LCBfaW5PcmRlckluZGV4KVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2soKTtcbiAgICAgIH1cbiAgICB9XG4gICAgZm9vKGFycmF5W19pbmRleF0sIF9pbmRleCwgX2luT3JkZXJJbmRleClcbiAgfSxcbiAgLyoqXG4gICAqINCy0L7Qt9Cy0YDQsNGJ0LDQtdGCINC+0LHRitC10LrRgiDRgSDQutC70Y7Rh9Cw0LzQuCDRgdGC0YDQvtC60LggdXJsXG4gICAqIEByZXR1cm5zIHt7fX1cbiAgICovXG4gIHF1ZXJ5U3RyaW5nOiBmdW5jdGlvbiAocXVlcnkpIHtcbiAgICBpZihxdWVyeSkge1xuICAgICAgcXVlcnkgPSBxdWVyeS5zdWJzdHIocXVlcnkuaW5kZXhPZihcIj9cIikgKyAxKSA7XG4gICAgfWVsc2V7XG4gICAgICBxdWVyeSA9IHdpbmRvdy5sb2NhdGlvbi5zZWFyY2guc3Vic3RyaW5nKDEpO1xuICAgIH1cbiAgICB2YXIgb2JqID0ge307XG4gICAgdmFyIF9sZW5ndGggPSAwO1xuICAgIGlmICghcXVlcnkpcmV0dXJuIG9iajtcbiAgICB2YXIgdmFycyA9IHF1ZXJ5LnNwbGl0KFwiJlwiKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZhcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciBwYWlyID0gdmFyc1tpXS5zcGxpdChcIj1cIik7XG4gICAgICB2YXIgX3ZuYW1lID0gcGFpclswXSwgdmFsID0gcGFpclsxXTtcbiAgICAgIGlmICh0eXBlb2Ygb2JqW192bmFtZV0gPT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgb2JqW192bmFtZV0gPSB2YWwgfHwgXCJcIjtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwgX2xlbmd0aCwge3ZhbHVlOiBfdm5hbWUsIGVudW1lcmFibGU6IGZhbHNlfSk7XG4gICAgICAgIF9sZW5ndGgrKztcbiAgICAgICAgLy8gSWYgc2Vjb25kIGVudHJ5IHdpdGggdGhpcyBuYW1lXG4gICAgICB9IGVsc2UgaWYgKHR5cGVvZiBvYmpbX3ZuYW1lXSA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICB2YXIgYXJyID0gW29ialtfdm5hbWVdLCB2YWxdO1xuICAgICAgICBvYmpbX3ZuYW1lXSA9IGFycjtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwgX2xlbmd0aCwge3ZhbHVlOiBfdm5hbWUsIGVudW1lcmFibGU6IGZhbHNlfSk7XG4gICAgICAgIF9sZW5ndGgrKztcbiAgICAgICAgLy8gSWYgdGhpcmQgb3IgbGF0ZXIgZW50cnkgd2l0aCB0aGlzIG5hbWVcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG9ialtfdm5hbWVdLnB1c2godmFsKTtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwgX2xlbmd0aCwge3ZhbHVlOiBfdm5hbWUsIGVudW1lcmFibGU6IGZhbHNlfSk7XG4gICAgICAgIF9sZW5ndGgrKztcbiAgICAgIH1cbiAgICB9XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwgXCJsZW5ndGhcIiwge3ZhbHVlOiBfbGVuZ3RoLCBlbnVtZXJhYmxlOiBmYWxzZX0pO1xuICAgIHJldHVybiBvYmo7XG4gIH0sXG4gIGNvcHlWYWx1ZTogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgaWYgKHZhbHVlID09IG51bGwpIHtcbiAgICAgIHJldHVybiBudWxsXG4gICAgfVxuICAgIGlmICh2YWx1ZSA9PSB1bmRlZmluZWQpIHtcbiAgICAgIHJldHVybiB1bmRlZmluZWRcbiAgICB9XG4gICAgc3dpdGNoICh2YWx1ZS5jb25zdHJ1Y3Rvcikge1xuICAgICAgY2FzZSBPYmplY3Q6XG4gICAgICAgIHJldHVybiBvYmplY3RVdGlscy5kZWVwRXh0ZW5kKHt9LCB2YWx1ZSk7XG4gICAgICBjYXNlIEFycmF5OlxuICAgICAgICByZXR1cm4gb2JqZWN0VXRpbHMuZGVlcEV4dGVuZChbXSwgdmFsdWUpO1xuICAgICAgY2FzZSBTdHJpbmc6XG4gICAgICBjYXNlIE51bWJlcjpcbiAgICAgIGNhc2UgQm9vbGVhbjpcbiAgICAgICAgcmV0dXJuIHZhbHVlO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgLy9jb25zb2xlLmxvZyh2YWx1ZS5jb25zdHJ1Y3Rvcik7XG4gICAgICAgIHJldHVybiBvYmplY3RVdGlscy5kZWVwRXh0ZW5kKHt9LCB2YWx1ZSk7XG4gICAgfVxuICB9LFxuICBjbGVhclZhbHVlOiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICBzd2l0Y2ggKHZhbHVlLmNvbnN0cnVjdG9yKSB7XG4gICAgICBjYXNlIE9iamVjdDpcbiAgICAgICAgZm9yICh2YXIgbWVtYmVyIGluIHZhbHVlKSBkZWxldGUgdmFsdWVbbWVtYmVyXTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIEFycmF5OlxuICAgICAgICB2YWx1ZS5sZW5ndGggPSAwO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIC8vZGVsZXRlIHZhbHVlO1xuICAgIH1cbiAgfSxcbiAgb2JqZWN0c0RpZmZlcmVuY2U6IGZ1bmN0aW9uIChwcmV2LCBub3cpIHtcbiAgICB2YXIgY2hhbmdlcyA9IHt9O1xuICAgIGZvciAodmFyIHByb3AgaW4gbm93KSB7XG4gICAgICBpZiAoIXByZXYgfHwgcHJldltwcm9wXSAhPT0gbm93W3Byb3BdKSB7XG4gICAgICAgIGlmICh0eXBlb2Ygbm93W3Byb3BdID09IFwib2JqZWN0XCIpIHtcbiAgICAgICAgICB2YXIgYyA9IHV0aWxzLm9iamVjdHNEaWZmZXJlbmNlKHByZXZbcHJvcF0sIG5vd1twcm9wXSk7XG4gICAgICAgICAgaWYgKCFfLmlzRW1wdHkoYykpIC8vIHVuZGVyc2NvcmVcbiAgICAgICAgICAgIGNoYW5nZXNbcHJvcF0gPSBjO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNoYW5nZXNbcHJvcF0gPSBub3dbcHJvcF07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGNoYW5nZXM7XG4gIH0sXG4gIHNwbGl0Qnk6IGZ1bmN0aW9uIChxdWVyeSwgZGVsaW1pdGVyKSB7XG4gICAgdmFyIHRyYWNlUXVlcmllcyA9IFtdO1xuICAgIHZhciByID0gMCxcbiAgICAgIGYgPSAwLFxuICAgICAgX3Bfc3RhcnQgPSAwO1xuICAgIGlmIChxdWVyeSA9PSBcIlwiKSByZXR1cm4gW107XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBxdWVyeS5sZW5ndGg7IGkrKykge1xuICAgICAgdmFyIGMgPSBxdWVyeVtpXTtcbiAgICAgIGlmIChjID09IFwiKFwiKSB7XG4gICAgICAgIHIrKztcbiAgICAgICAgZiA9IDE7XG4gICAgICB9IGVsc2UgaWYgKGMgPT0gXCIpXCIpIHtcbiAgICAgICAgci0tO1xuICAgICAgfVxuICAgICAgaWYgKHIgPT0gMCAmJiBmID09IDEpIGYgPSAwO1xuICAgICAgaWYgKGRlbGltaXRlci5pbmRleE9mKGMpICE9IC0xICYmIHIgPT0gMCAmJiBmID09IDApIHtcbiAgICAgICAgdHJhY2VRdWVyaWVzLnB1c2gocXVlcnkuc3Vic3RyaW5nKF9wX3N0YXJ0LCBpKSk7XG4gICAgICAgIF9wX3N0YXJ0ID0gaSArIDE7XG4gICAgICB9XG4gICAgfVxuICAgIHRyYWNlUXVlcmllcy5wdXNoKHF1ZXJ5LnN1YnN0cmluZyhfcF9zdGFydCkpO1xuICAgIHJldHVybiB0cmFjZVF1ZXJpZXM7XG4gIH0sXG4gIHF1ZXVlTG9hZDogZnVuY3Rpb24gKHRvdGFsLCBjb21wbGV0ZUNCLCBwcm9ncmVzc0NCKSB7XG4gICAgdmFyIGxvYWRlciA9IGZ1bmN0aW9uIChlbCkge1xuICAgICAgbG9hZGVyLmxvYWRlZC5wdXNoKGVsKTtcbiAgICAgIGxvYWRlci5wcm9ncmVzc0NCICYmIGxvYWRlci5wcm9ncmVzc0NCKGxvYWRlci5sb2FkZWQubGVuZ3RoLCBsb2FkZXIudG90YWwsIGVsLCBsb2FkZXIubG9hZGVkKTtcblxuICAgICAgaWYgKGxvYWRlci5sb2FkZWQubGVuZ3RoID09IGxvYWRlci50b3RhbCkge1xuICAgICAgICBsb2FkZXIuY29tcGxldGVDQiAmJiBsb2FkZXIuY29tcGxldGVDQihsb2FkZXIubG9hZGVkKTtcbiAgICAgICAgbG9hZGVyLmZpcmUoXCJsb2FkZWRcIik7XG4gICAgICB9XG4gICAgfTtcbiAgICBsb2FkZXIuY29tcGxldGVDQiA9IGNvbXBsZXRlQ0I7XG4gICAgbG9hZGVyLnByb2dyZXNzQ0IgPSBwcm9ncmVzc0NCO1xuICAgIGxvYWRlci50b3RhbCA9IHRvdGFsO1xuICAgIGxvYWRlci5sb2FkZWQgPSBbXTtcbiAgICB1dGlscy5vYnNlcnZhYmxlKGxvYWRlcik7XG5cbiAgICByZXR1cm4gbG9hZGVyO1xuICB9XG59O1xubW9kdWxlLmV4cG9ydHMgPSAgdXRpbHM7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL3V0aWwvdXRpbC5qcyIsIm1vZHVsZS5leHBvcnRzID0ge1xuICByZXNvbHZlOiBmdW5jdGlvbiAocGF0aCkge1xuICAgIHZhciBjaHVua3MgPSBwYXRoLnNwbGl0KFwiL1wiKTtcbiAgICB2YXIgcHJldiA9IDA7XG4gICAgZm9yICh2YXIgaSA9IGNodW5rcy5sZW5ndGg7IGktLSA+IDA7KSB7XG4gICAgICBpZiAoY2h1bmtzW2ldID09IFwiLi5cIikge1xuICAgICAgICBwcmV2Kys7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB3aGlsZSAocHJldiA+IDApIHtcbiAgICAgICAgICBjaHVua3Muc3BsaWNlKGksIDEpO1xuICAgICAgICAgIGNodW5rcy5zcGxpY2UoaS0tLCAxKTtcbiAgICAgICAgICBwcmV2LS07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGNodW5rcy5qb2luKFwiL1wiKTtcbiAgfSxcbiAgZ2V0UGFyZW50RGlyZWN0b3J5VXJsOiBmdW5jdGlvbiAodXJsKSB7XG4gICAgcmV0dXJuIHVybC5zdWJzdHIoMCwgdXJsLmxhc3RJbmRleE9mKFwiL1wiKSArIDEpO1xuICB9XG59XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL3V0aWwvcGF0aC5qcyIsIlxuU3RyaW5nLnByb3RvdHlwZS5mb3JtYXQgID0gZnVuY3Rpb24gKCkge1xuICB2YXIgc3RyID0gdGhpcy50b1N0cmluZygpO1xuICBpZiAoYXJndW1lbnRzLmxlbmd0aCkge1xuICAgIHZhciB0eXBlID0gdHlwZW9mIGFyZ3VtZW50c1swXVxuICAgICAgLCBhcmdzID0gdHlwZSA9PSAnc3RyaW5nJyB8fCB0eXBlID09ICdudW1iZXInID8gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKSA6IGFyZ3VtZW50c1swXVxuICAgIC8vXG4gICAgLy8gZm9yICh2YXIgYXJnIGluIGFyZ3MpIHN0ciA9IHN0ci5yZXBsYWNlKG5ldyBSZWdFeHAoJ1xcXFx7JyArIGFyZyArICdcXFxcfScsICdnaScpLCBhcmdzW2FyZ10pXG5cbiAgICBzdHIgPSBzdHIucmVwbGFjZSgvXFx7KFtefV0qKVxcfS9nLGZ1bmN0aW9uKGEsYil7XG4gICAgICByZXR1cm4gdXRpbHMuZXZhbEluQ29udGV4dChiLGFyZ3MpXG4gICAgfSlcbiAgfVxuXG4gIHJldHVybiBzdHJcbn07XG5cbnZhciB1dGlscyA9IHtcbiAgZXh0cmFjdFZhcmlhYmxlczogZnVuY3Rpb24gKHN0cikge1xuICAgIHJldHVybiBzdHIubWF0Y2goLyg/ISg/OmRvfGlmfGlufGZvcnxsZXR8bmV3fHRyeXx2YXJ8Y2FzZXxlbHNlfGVudW18ZXZhbHxmYWxzZXxudWxsfHRoaXN8dHJ1ZXx2b2lkfHdpdGh8YnJlYWt8Y2F0Y2h8Y2xhc3N8Y29uc3R8c3VwZXJ8dGhyb3d8d2hpbGV8eWllbGR8ZGVsZXRlfGV4cG9ydHxpbXBvcnR8cHVibGljfHJldHVybnxzdGF0aWN8c3dpdGNofHR5cGVvZnxkZWZhdWx0fGV4dGVuZHN8ZmluYWxseXxwYWNrYWdlfHByaXZhdGV8Y29udGludWV8ZGVidWdnZXJ8ZnVuY3Rpb258YXJndW1lbnRzfGludGVyZmFjZXxwcm90ZWN0ZWR8aW1wbGVtZW50c3xpbnN0YW5jZW9mKSQpWyRBLVpcXF9hLXpcXHhhYVxceGI1XFx4YmFcXHhjMC1cXHhkNlxceGQ4LVxceGY2XFx4ZjgtXFx1MDJjMVxcdTAyYzYtXFx1MDJkMVxcdTAyZTAtXFx1MDJlNFxcdTAyZWNcXHUwMmVlXFx1MDM3MC1cXHUwMzc0XFx1MDM3NlxcdTAzNzdcXHUwMzdhLVxcdTAzN2RcXHUwMzg2XFx1MDM4OC1cXHUwMzhhXFx1MDM4Y1xcdTAzOGUtXFx1MDNhMVxcdTAzYTMtXFx1MDNmNVxcdTAzZjctXFx1MDQ4MVxcdTA0OGEtXFx1MDUyN1xcdTA1MzEtXFx1MDU1NlxcdTA1NTlcXHUwNTYxLVxcdTA1ODdcXHUwNWQwLVxcdTA1ZWFcXHUwNWYwLVxcdTA1ZjJcXHUwNjIwLVxcdTA2NGFcXHUwNjZlXFx1MDY2ZlxcdTA2NzEtXFx1MDZkM1xcdTA2ZDVcXHUwNmU1XFx1MDZlNlxcdTA2ZWVcXHUwNmVmXFx1MDZmYS1cXHUwNmZjXFx1MDZmZlxcdTA3MTBcXHUwNzEyLVxcdTA3MmZcXHUwNzRkLVxcdTA3YTVcXHUwN2IxXFx1MDdjYS1cXHUwN2VhXFx1MDdmNFxcdTA3ZjVcXHUwN2ZhXFx1MDgwMC1cXHUwODE1XFx1MDgxYVxcdTA4MjRcXHUwODI4XFx1MDg0MC1cXHUwODU4XFx1MDhhMFxcdTA4YTItXFx1MDhhY1xcdTA5MDQtXFx1MDkzOVxcdTA5M2RcXHUwOTUwXFx1MDk1OC1cXHUwOTYxXFx1MDk3MS1cXHUwOTc3XFx1MDk3OS1cXHUwOTdmXFx1MDk4NS1cXHUwOThjXFx1MDk4ZlxcdTA5OTBcXHUwOTkzLVxcdTA5YThcXHUwOWFhLVxcdTA5YjBcXHUwOWIyXFx1MDliNi1cXHUwOWI5XFx1MDliZFxcdTA5Y2VcXHUwOWRjXFx1MDlkZFxcdTA5ZGYtXFx1MDllMVxcdTA5ZjBcXHUwOWYxXFx1MGEwNS1cXHUwYTBhXFx1MGEwZlxcdTBhMTBcXHUwYTEzLVxcdTBhMjhcXHUwYTJhLVxcdTBhMzBcXHUwYTMyXFx1MGEzM1xcdTBhMzVcXHUwYTM2XFx1MGEzOFxcdTBhMzlcXHUwYTU5LVxcdTBhNWNcXHUwYTVlXFx1MGE3Mi1cXHUwYTc0XFx1MGE4NS1cXHUwYThkXFx1MGE4Zi1cXHUwYTkxXFx1MGE5My1cXHUwYWE4XFx1MGFhYS1cXHUwYWIwXFx1MGFiMlxcdTBhYjNcXHUwYWI1LVxcdTBhYjlcXHUwYWJkXFx1MGFkMFxcdTBhZTBcXHUwYWUxXFx1MGIwNS1cXHUwYjBjXFx1MGIwZlxcdTBiMTBcXHUwYjEzLVxcdTBiMjhcXHUwYjJhLVxcdTBiMzBcXHUwYjMyXFx1MGIzM1xcdTBiMzUtXFx1MGIzOVxcdTBiM2RcXHUwYjVjXFx1MGI1ZFxcdTBiNWYtXFx1MGI2MVxcdTBiNzFcXHUwYjgzXFx1MGI4NS1cXHUwYjhhXFx1MGI4ZS1cXHUwYjkwXFx1MGI5Mi1cXHUwYjk1XFx1MGI5OVxcdTBiOWFcXHUwYjljXFx1MGI5ZVxcdTBiOWZcXHUwYmEzXFx1MGJhNFxcdTBiYTgtXFx1MGJhYVxcdTBiYWUtXFx1MGJiOVxcdTBiZDBcXHUwYzA1LVxcdTBjMGNcXHUwYzBlLVxcdTBjMTBcXHUwYzEyLVxcdTBjMjhcXHUwYzJhLVxcdTBjMzNcXHUwYzM1LVxcdTBjMzlcXHUwYzNkXFx1MGM1OFxcdTBjNTlcXHUwYzYwXFx1MGM2MVxcdTBjODUtXFx1MGM4Y1xcdTBjOGUtXFx1MGM5MFxcdTBjOTItXFx1MGNhOFxcdTBjYWEtXFx1MGNiM1xcdTBjYjUtXFx1MGNiOVxcdTBjYmRcXHUwY2RlXFx1MGNlMFxcdTBjZTFcXHUwY2YxXFx1MGNmMlxcdTBkMDUtXFx1MGQwY1xcdTBkMGUtXFx1MGQxMFxcdTBkMTItXFx1MGQzYVxcdTBkM2RcXHUwZDRlXFx1MGQ2MFxcdTBkNjFcXHUwZDdhLVxcdTBkN2ZcXHUwZDg1LVxcdTBkOTZcXHUwZDlhLVxcdTBkYjFcXHUwZGIzLVxcdTBkYmJcXHUwZGJkXFx1MGRjMC1cXHUwZGM2XFx1MGUwMS1cXHUwZTMwXFx1MGUzMlxcdTBlMzNcXHUwZTQwLVxcdTBlNDZcXHUwZTgxXFx1MGU4MlxcdTBlODRcXHUwZTg3XFx1MGU4OFxcdTBlOGFcXHUwZThkXFx1MGU5NC1cXHUwZTk3XFx1MGU5OS1cXHUwZTlmXFx1MGVhMS1cXHUwZWEzXFx1MGVhNVxcdTBlYTdcXHUwZWFhXFx1MGVhYlxcdTBlYWQtXFx1MGViMFxcdTBlYjJcXHUwZWIzXFx1MGViZFxcdTBlYzAtXFx1MGVjNFxcdTBlYzZcXHUwZWRjLVxcdTBlZGZcXHUwZjAwXFx1MGY0MC1cXHUwZjQ3XFx1MGY0OS1cXHUwZjZjXFx1MGY4OC1cXHUwZjhjXFx1MTAwMC1cXHUxMDJhXFx1MTAzZlxcdTEwNTAtXFx1MTA1NVxcdTEwNWEtXFx1MTA1ZFxcdTEwNjFcXHUxMDY1XFx1MTA2NlxcdTEwNmUtXFx1MTA3MFxcdTEwNzUtXFx1MTA4MVxcdTEwOGVcXHUxMGEwLVxcdTEwYzVcXHUxMGM3XFx1MTBjZFxcdTEwZDAtXFx1MTBmYVxcdTEwZmMtXFx1MTI0OFxcdTEyNGEtXFx1MTI0ZFxcdTEyNTAtXFx1MTI1NlxcdTEyNThcXHUxMjVhLVxcdTEyNWRcXHUxMjYwLVxcdTEyODhcXHUxMjhhLVxcdTEyOGRcXHUxMjkwLVxcdTEyYjBcXHUxMmIyLVxcdTEyYjVcXHUxMmI4LVxcdTEyYmVcXHUxMmMwXFx1MTJjMi1cXHUxMmM1XFx1MTJjOC1cXHUxMmQ2XFx1MTJkOC1cXHUxMzEwXFx1MTMxMi1cXHUxMzE1XFx1MTMxOC1cXHUxMzVhXFx1MTM4MC1cXHUxMzhmXFx1MTNhMC1cXHUxM2Y0XFx1MTQwMS1cXHUxNjZjXFx1MTY2Zi1cXHUxNjdmXFx1MTY4MS1cXHUxNjlhXFx1MTZhMC1cXHUxNmVhXFx1MTZlZS1cXHUxNmYwXFx1MTcwMC1cXHUxNzBjXFx1MTcwZS1cXHUxNzExXFx1MTcyMC1cXHUxNzMxXFx1MTc0MC1cXHUxNzUxXFx1MTc2MC1cXHUxNzZjXFx1MTc2ZS1cXHUxNzcwXFx1MTc4MC1cXHUxN2IzXFx1MTdkN1xcdTE3ZGNcXHUxODIwLVxcdTE4NzdcXHUxODgwLVxcdTE4YThcXHUxOGFhXFx1MThiMC1cXHUxOGY1XFx1MTkwMC1cXHUxOTFjXFx1MTk1MC1cXHUxOTZkXFx1MTk3MC1cXHUxOTc0XFx1MTk4MC1cXHUxOWFiXFx1MTljMS1cXHUxOWM3XFx1MWEwMC1cXHUxYTE2XFx1MWEyMC1cXHUxYTU0XFx1MWFhN1xcdTFiMDUtXFx1MWIzM1xcdTFiNDUtXFx1MWI0YlxcdTFiODMtXFx1MWJhMFxcdTFiYWVcXHUxYmFmXFx1MWJiYS1cXHUxYmU1XFx1MWMwMC1cXHUxYzIzXFx1MWM0ZC1cXHUxYzRmXFx1MWM1YS1cXHUxYzdkXFx1MWNlOS1cXHUxY2VjXFx1MWNlZS1cXHUxY2YxXFx1MWNmNVxcdTFjZjZcXHUxZDAwLVxcdTFkYmZcXHUxZTAwLVxcdTFmMTVcXHUxZjE4LVxcdTFmMWRcXHUxZjIwLVxcdTFmNDVcXHUxZjQ4LVxcdTFmNGRcXHUxZjUwLVxcdTFmNTdcXHUxZjU5XFx1MWY1YlxcdTFmNWRcXHUxZjVmLVxcdTFmN2RcXHUxZjgwLVxcdTFmYjRcXHUxZmI2LVxcdTFmYmNcXHUxZmJlXFx1MWZjMi1cXHUxZmM0XFx1MWZjNi1cXHUxZmNjXFx1MWZkMC1cXHUxZmQzXFx1MWZkNi1cXHUxZmRiXFx1MWZlMC1cXHUxZmVjXFx1MWZmMi1cXHUxZmY0XFx1MWZmNi1cXHUxZmZjXFx1MjA3MVxcdTIwN2ZcXHUyMDkwLVxcdTIwOWNcXHUyMTAyXFx1MjEwN1xcdTIxMGEtXFx1MjExM1xcdTIxMTVcXHUyMTE5LVxcdTIxMWRcXHUyMTI0XFx1MjEyNlxcdTIxMjhcXHUyMTJhLVxcdTIxMmRcXHUyMTJmLVxcdTIxMzlcXHUyMTNjLVxcdTIxM2ZcXHUyMTQ1LVxcdTIxNDlcXHUyMTRlXFx1MjE2MC1cXHUyMTg4XFx1MmMwMC1cXHUyYzJlXFx1MmMzMC1cXHUyYzVlXFx1MmM2MC1cXHUyY2U0XFx1MmNlYi1cXHUyY2VlXFx1MmNmMlxcdTJjZjNcXHUyZDAwLVxcdTJkMjVcXHUyZDI3XFx1MmQyZFxcdTJkMzAtXFx1MmQ2N1xcdTJkNmZcXHUyZDgwLVxcdTJkOTZcXHUyZGEwLVxcdTJkYTZcXHUyZGE4LVxcdTJkYWVcXHUyZGIwLVxcdTJkYjZcXHUyZGI4LVxcdTJkYmVcXHUyZGMwLVxcdTJkYzZcXHUyZGM4LVxcdTJkY2VcXHUyZGQwLVxcdTJkZDZcXHUyZGQ4LVxcdTJkZGVcXHUyZTJmXFx1MzAwNS1cXHUzMDA3XFx1MzAyMS1cXHUzMDI5XFx1MzAzMS1cXHUzMDM1XFx1MzAzOC1cXHUzMDNjXFx1MzA0MS1cXHUzMDk2XFx1MzA5ZC1cXHUzMDlmXFx1MzBhMS1cXHUzMGZhXFx1MzBmYy1cXHUzMGZmXFx1MzEwNS1cXHUzMTJkXFx1MzEzMS1cXHUzMThlXFx1MzFhMC1cXHUzMWJhXFx1MzFmMC1cXHUzMWZmXFx1MzQwMC1cXHU0ZGI1XFx1NGUwMC1cXHU5ZmNjXFx1YTAwMC1cXHVhNDhjXFx1YTRkMC1cXHVhNGZkXFx1YTUwMC1cXHVhNjBjXFx1YTYxMC1cXHVhNjFmXFx1YTYyYVxcdWE2MmJcXHVhNjQwLVxcdWE2NmVcXHVhNjdmLVxcdWE2OTdcXHVhNmEwLVxcdWE2ZWZcXHVhNzE3LVxcdWE3MWZcXHVhNzIyLVxcdWE3ODhcXHVhNzhiLVxcdWE3OGVcXHVhNzkwLVxcdWE3OTNcXHVhN2EwLVxcdWE3YWFcXHVhN2Y4LVxcdWE4MDFcXHVhODAzLVxcdWE4MDVcXHVhODA3LVxcdWE4MGFcXHVhODBjLVxcdWE4MjJcXHVhODQwLVxcdWE4NzNcXHVhODgyLVxcdWE4YjNcXHVhOGYyLVxcdWE4ZjdcXHVhOGZiXFx1YTkwYS1cXHVhOTI1XFx1YTkzMC1cXHVhOTQ2XFx1YTk2MC1cXHVhOTdjXFx1YTk4NC1cXHVhOWIyXFx1YTljZlxcdWFhMDAtXFx1YWEyOFxcdWFhNDAtXFx1YWE0MlxcdWFhNDQtXFx1YWE0YlxcdWFhNjAtXFx1YWE3NlxcdWFhN2FcXHVhYTgwLVxcdWFhYWZcXHVhYWIxXFx1YWFiNVxcdWFhYjZcXHVhYWI5LVxcdWFhYmRcXHVhYWMwXFx1YWFjMlxcdWFhZGItXFx1YWFkZFxcdWFhZTAtXFx1YWFlYVxcdWFhZjItXFx1YWFmNFxcdWFiMDEtXFx1YWIwNlxcdWFiMDktXFx1YWIwZVxcdWFiMTEtXFx1YWIxNlxcdWFiMjAtXFx1YWIyNlxcdWFiMjgtXFx1YWIyZVxcdWFiYzAtXFx1YWJlMlxcdWFjMDAtXFx1ZDdhM1xcdWQ3YjAtXFx1ZDdjNlxcdWQ3Y2ItXFx1ZDdmYlxcdWY5MDAtXFx1ZmE2ZFxcdWZhNzAtXFx1ZmFkOVxcdWZiMDAtXFx1ZmIwNlxcdWZiMTMtXFx1ZmIxN1xcdWZiMWRcXHVmYjFmLVxcdWZiMjhcXHVmYjJhLVxcdWZiMzZcXHVmYjM4LVxcdWZiM2NcXHVmYjNlXFx1ZmI0MFxcdWZiNDFcXHVmYjQzXFx1ZmI0NFxcdWZiNDYtXFx1ZmJiMVxcdWZiZDMtXFx1ZmQzZFxcdWZkNTAtXFx1ZmQ4ZlxcdWZkOTItXFx1ZmRjN1xcdWZkZjAtXFx1ZmRmYlxcdWZlNzAtXFx1ZmU3NFxcdWZlNzYtXFx1ZmVmY1xcdWZmMjEtXFx1ZmYzYVxcdWZmNDEtXFx1ZmY1YVxcdWZmNjYtXFx1ZmZiZVxcdWZmYzItXFx1ZmZjN1xcdWZmY2EtXFx1ZmZjZlxcdWZmZDItXFx1ZmZkN1xcdWZmZGEtXFx1ZmZkY11bJEEtWlxcX2EtelxceGFhXFx4YjVcXHhiYVxceGMwLVxceGQ2XFx4ZDgtXFx4ZjZcXHhmOC1cXHUwMmMxXFx1MDJjNi1cXHUwMmQxXFx1MDJlMC1cXHUwMmU0XFx1MDJlY1xcdTAyZWVcXHUwMzcwLVxcdTAzNzRcXHUwMzc2XFx1MDM3N1xcdTAzN2EtXFx1MDM3ZFxcdTAzODZcXHUwMzg4LVxcdTAzOGFcXHUwMzhjXFx1MDM4ZS1cXHUwM2ExXFx1MDNhMy1cXHUwM2Y1XFx1MDNmNy1cXHUwNDgxXFx1MDQ4YS1cXHUwNTI3XFx1MDUzMS1cXHUwNTU2XFx1MDU1OVxcdTA1NjEtXFx1MDU4N1xcdTA1ZDAtXFx1MDVlYVxcdTA1ZjAtXFx1MDVmMlxcdTA2MjAtXFx1MDY0YVxcdTA2NmVcXHUwNjZmXFx1MDY3MS1cXHUwNmQzXFx1MDZkNVxcdTA2ZTVcXHUwNmU2XFx1MDZlZVxcdTA2ZWZcXHUwNmZhLVxcdTA2ZmNcXHUwNmZmXFx1MDcxMFxcdTA3MTItXFx1MDcyZlxcdTA3NGQtXFx1MDdhNVxcdTA3YjFcXHUwN2NhLVxcdTA3ZWFcXHUwN2Y0XFx1MDdmNVxcdTA3ZmFcXHUwODAwLVxcdTA4MTVcXHUwODFhXFx1MDgyNFxcdTA4MjhcXHUwODQwLVxcdTA4NThcXHUwOGEwXFx1MDhhMi1cXHUwOGFjXFx1MDkwNC1cXHUwOTM5XFx1MDkzZFxcdTA5NTBcXHUwOTU4LVxcdTA5NjFcXHUwOTcxLVxcdTA5NzdcXHUwOTc5LVxcdTA5N2ZcXHUwOTg1LVxcdTA5OGNcXHUwOThmXFx1MDk5MFxcdTA5OTMtXFx1MDlhOFxcdTA5YWEtXFx1MDliMFxcdTA5YjJcXHUwOWI2LVxcdTA5YjlcXHUwOWJkXFx1MDljZVxcdTA5ZGNcXHUwOWRkXFx1MDlkZi1cXHUwOWUxXFx1MDlmMFxcdTA5ZjFcXHUwYTA1LVxcdTBhMGFcXHUwYTBmXFx1MGExMFxcdTBhMTMtXFx1MGEyOFxcdTBhMmEtXFx1MGEzMFxcdTBhMzJcXHUwYTMzXFx1MGEzNVxcdTBhMzZcXHUwYTM4XFx1MGEzOVxcdTBhNTktXFx1MGE1Y1xcdTBhNWVcXHUwYTcyLVxcdTBhNzRcXHUwYTg1LVxcdTBhOGRcXHUwYThmLVxcdTBhOTFcXHUwYTkzLVxcdTBhYThcXHUwYWFhLVxcdTBhYjBcXHUwYWIyXFx1MGFiM1xcdTBhYjUtXFx1MGFiOVxcdTBhYmRcXHUwYWQwXFx1MGFlMFxcdTBhZTFcXHUwYjA1LVxcdTBiMGNcXHUwYjBmXFx1MGIxMFxcdTBiMTMtXFx1MGIyOFxcdTBiMmEtXFx1MGIzMFxcdTBiMzJcXHUwYjMzXFx1MGIzNS1cXHUwYjM5XFx1MGIzZFxcdTBiNWNcXHUwYjVkXFx1MGI1Zi1cXHUwYjYxXFx1MGI3MVxcdTBiODNcXHUwYjg1LVxcdTBiOGFcXHUwYjhlLVxcdTBiOTBcXHUwYjkyLVxcdTBiOTVcXHUwYjk5XFx1MGI5YVxcdTBiOWNcXHUwYjllXFx1MGI5ZlxcdTBiYTNcXHUwYmE0XFx1MGJhOC1cXHUwYmFhXFx1MGJhZS1cXHUwYmI5XFx1MGJkMFxcdTBjMDUtXFx1MGMwY1xcdTBjMGUtXFx1MGMxMFxcdTBjMTItXFx1MGMyOFxcdTBjMmEtXFx1MGMzM1xcdTBjMzUtXFx1MGMzOVxcdTBjM2RcXHUwYzU4XFx1MGM1OVxcdTBjNjBcXHUwYzYxXFx1MGM4NS1cXHUwYzhjXFx1MGM4ZS1cXHUwYzkwXFx1MGM5Mi1cXHUwY2E4XFx1MGNhYS1cXHUwY2IzXFx1MGNiNS1cXHUwY2I5XFx1MGNiZFxcdTBjZGVcXHUwY2UwXFx1MGNlMVxcdTBjZjFcXHUwY2YyXFx1MGQwNS1cXHUwZDBjXFx1MGQwZS1cXHUwZDEwXFx1MGQxMi1cXHUwZDNhXFx1MGQzZFxcdTBkNGVcXHUwZDYwXFx1MGQ2MVxcdTBkN2EtXFx1MGQ3ZlxcdTBkODUtXFx1MGQ5NlxcdTBkOWEtXFx1MGRiMVxcdTBkYjMtXFx1MGRiYlxcdTBkYmRcXHUwZGMwLVxcdTBkYzZcXHUwZTAxLVxcdTBlMzBcXHUwZTMyXFx1MGUzM1xcdTBlNDAtXFx1MGU0NlxcdTBlODFcXHUwZTgyXFx1MGU4NFxcdTBlODdcXHUwZTg4XFx1MGU4YVxcdTBlOGRcXHUwZTk0LVxcdTBlOTdcXHUwZTk5LVxcdTBlOWZcXHUwZWExLVxcdTBlYTNcXHUwZWE1XFx1MGVhN1xcdTBlYWFcXHUwZWFiXFx1MGVhZC1cXHUwZWIwXFx1MGViMlxcdTBlYjNcXHUwZWJkXFx1MGVjMC1cXHUwZWM0XFx1MGVjNlxcdTBlZGMtXFx1MGVkZlxcdTBmMDBcXHUwZjQwLVxcdTBmNDdcXHUwZjQ5LVxcdTBmNmNcXHUwZjg4LVxcdTBmOGNcXHUxMDAwLVxcdTEwMmFcXHUxMDNmXFx1MTA1MC1cXHUxMDU1XFx1MTA1YS1cXHUxMDVkXFx1MTA2MVxcdTEwNjVcXHUxMDY2XFx1MTA2ZS1cXHUxMDcwXFx1MTA3NS1cXHUxMDgxXFx1MTA4ZVxcdTEwYTAtXFx1MTBjNVxcdTEwYzdcXHUxMGNkXFx1MTBkMC1cXHUxMGZhXFx1MTBmYy1cXHUxMjQ4XFx1MTI0YS1cXHUxMjRkXFx1MTI1MC1cXHUxMjU2XFx1MTI1OFxcdTEyNWEtXFx1MTI1ZFxcdTEyNjAtXFx1MTI4OFxcdTEyOGEtXFx1MTI4ZFxcdTEyOTAtXFx1MTJiMFxcdTEyYjItXFx1MTJiNVxcdTEyYjgtXFx1MTJiZVxcdTEyYzBcXHUxMmMyLVxcdTEyYzVcXHUxMmM4LVxcdTEyZDZcXHUxMmQ4LVxcdTEzMTBcXHUxMzEyLVxcdTEzMTVcXHUxMzE4LVxcdTEzNWFcXHUxMzgwLVxcdTEzOGZcXHUxM2EwLVxcdTEzZjRcXHUxNDAxLVxcdTE2NmNcXHUxNjZmLVxcdTE2N2ZcXHUxNjgxLVxcdTE2OWFcXHUxNmEwLVxcdTE2ZWFcXHUxNmVlLVxcdTE2ZjBcXHUxNzAwLVxcdTE3MGNcXHUxNzBlLVxcdTE3MTFcXHUxNzIwLVxcdTE3MzFcXHUxNzQwLVxcdTE3NTFcXHUxNzYwLVxcdTE3NmNcXHUxNzZlLVxcdTE3NzBcXHUxNzgwLVxcdTE3YjNcXHUxN2Q3XFx1MTdkY1xcdTE4MjAtXFx1MTg3N1xcdTE4ODAtXFx1MThhOFxcdTE4YWFcXHUxOGIwLVxcdTE4ZjVcXHUxOTAwLVxcdTE5MWNcXHUxOTUwLVxcdTE5NmRcXHUxOTcwLVxcdTE5NzRcXHUxOTgwLVxcdTE5YWJcXHUxOWMxLVxcdTE5YzdcXHUxYTAwLVxcdTFhMTZcXHUxYTIwLVxcdTFhNTRcXHUxYWE3XFx1MWIwNS1cXHUxYjMzXFx1MWI0NS1cXHUxYjRiXFx1MWI4My1cXHUxYmEwXFx1MWJhZVxcdTFiYWZcXHUxYmJhLVxcdTFiZTVcXHUxYzAwLVxcdTFjMjNcXHUxYzRkLVxcdTFjNGZcXHUxYzVhLVxcdTFjN2RcXHUxY2U5LVxcdTFjZWNcXHUxY2VlLVxcdTFjZjFcXHUxY2Y1XFx1MWNmNlxcdTFkMDAtXFx1MWRiZlxcdTFlMDAtXFx1MWYxNVxcdTFmMTgtXFx1MWYxZFxcdTFmMjAtXFx1MWY0NVxcdTFmNDgtXFx1MWY0ZFxcdTFmNTAtXFx1MWY1N1xcdTFmNTlcXHUxZjViXFx1MWY1ZFxcdTFmNWYtXFx1MWY3ZFxcdTFmODAtXFx1MWZiNFxcdTFmYjYtXFx1MWZiY1xcdTFmYmVcXHUxZmMyLVxcdTFmYzRcXHUxZmM2LVxcdTFmY2NcXHUxZmQwLVxcdTFmZDNcXHUxZmQ2LVxcdTFmZGJcXHUxZmUwLVxcdTFmZWNcXHUxZmYyLVxcdTFmZjRcXHUxZmY2LVxcdTFmZmNcXHUyMDcxXFx1MjA3ZlxcdTIwOTAtXFx1MjA5Y1xcdTIxMDJcXHUyMTA3XFx1MjEwYS1cXHUyMTEzXFx1MjExNVxcdTIxMTktXFx1MjExZFxcdTIxMjRcXHUyMTI2XFx1MjEyOFxcdTIxMmEtXFx1MjEyZFxcdTIxMmYtXFx1MjEzOVxcdTIxM2MtXFx1MjEzZlxcdTIxNDUtXFx1MjE0OVxcdTIxNGVcXHUyMTYwLVxcdTIxODhcXHUyYzAwLVxcdTJjMmVcXHUyYzMwLVxcdTJjNWVcXHUyYzYwLVxcdTJjZTRcXHUyY2ViLVxcdTJjZWVcXHUyY2YyXFx1MmNmM1xcdTJkMDAtXFx1MmQyNVxcdTJkMjdcXHUyZDJkXFx1MmQzMC1cXHUyZDY3XFx1MmQ2ZlxcdTJkODAtXFx1MmQ5NlxcdTJkYTAtXFx1MmRhNlxcdTJkYTgtXFx1MmRhZVxcdTJkYjAtXFx1MmRiNlxcdTJkYjgtXFx1MmRiZVxcdTJkYzAtXFx1MmRjNlxcdTJkYzgtXFx1MmRjZVxcdTJkZDAtXFx1MmRkNlxcdTJkZDgtXFx1MmRkZVxcdTJlMmZcXHUzMDA1LVxcdTMwMDdcXHUzMDIxLVxcdTMwMjlcXHUzMDMxLVxcdTMwMzVcXHUzMDM4LVxcdTMwM2NcXHUzMDQxLVxcdTMwOTZcXHUzMDlkLVxcdTMwOWZcXHUzMGExLVxcdTMwZmFcXHUzMGZjLVxcdTMwZmZcXHUzMTA1LVxcdTMxMmRcXHUzMTMxLVxcdTMxOGVcXHUzMWEwLVxcdTMxYmFcXHUzMWYwLVxcdTMxZmZcXHUzNDAwLVxcdTRkYjVcXHU0ZTAwLVxcdTlmY2NcXHVhMDAwLVxcdWE0OGNcXHVhNGQwLVxcdWE0ZmRcXHVhNTAwLVxcdWE2MGNcXHVhNjEwLVxcdWE2MWZcXHVhNjJhXFx1YTYyYlxcdWE2NDAtXFx1YTY2ZVxcdWE2N2YtXFx1YTY5N1xcdWE2YTAtXFx1YTZlZlxcdWE3MTctXFx1YTcxZlxcdWE3MjItXFx1YTc4OFxcdWE3OGItXFx1YTc4ZVxcdWE3OTAtXFx1YTc5M1xcdWE3YTAtXFx1YTdhYVxcdWE3ZjgtXFx1YTgwMVxcdWE4MDMtXFx1YTgwNVxcdWE4MDctXFx1YTgwYVxcdWE4MGMtXFx1YTgyMlxcdWE4NDAtXFx1YTg3M1xcdWE4ODItXFx1YThiM1xcdWE4ZjItXFx1YThmN1xcdWE4ZmJcXHVhOTBhLVxcdWE5MjVcXHVhOTMwLVxcdWE5NDZcXHVhOTYwLVxcdWE5N2NcXHVhOTg0LVxcdWE5YjJcXHVhOWNmXFx1YWEwMC1cXHVhYTI4XFx1YWE0MC1cXHVhYTQyXFx1YWE0NC1cXHVhYTRiXFx1YWE2MC1cXHVhYTc2XFx1YWE3YVxcdWFhODAtXFx1YWFhZlxcdWFhYjFcXHVhYWI1XFx1YWFiNlxcdWFhYjktXFx1YWFiZFxcdWFhYzBcXHVhYWMyXFx1YWFkYi1cXHVhYWRkXFx1YWFlMC1cXHVhYWVhXFx1YWFmMi1cXHVhYWY0XFx1YWIwMS1cXHVhYjA2XFx1YWIwOS1cXHVhYjBlXFx1YWIxMS1cXHVhYjE2XFx1YWIyMC1cXHVhYjI2XFx1YWIyOC1cXHVhYjJlXFx1YWJjMC1cXHVhYmUyXFx1YWMwMC1cXHVkN2EzXFx1ZDdiMC1cXHVkN2M2XFx1ZDdjYi1cXHVkN2ZiXFx1ZjkwMC1cXHVmYTZkXFx1ZmE3MC1cXHVmYWQ5XFx1ZmIwMC1cXHVmYjA2XFx1ZmIxMy1cXHVmYjE3XFx1ZmIxZFxcdWZiMWYtXFx1ZmIyOFxcdWZiMmEtXFx1ZmIzNlxcdWZiMzgtXFx1ZmIzY1xcdWZiM2VcXHVmYjQwXFx1ZmI0MVxcdWZiNDNcXHVmYjQ0XFx1ZmI0Ni1cXHVmYmIxXFx1ZmJkMy1cXHVmZDNkXFx1ZmQ1MC1cXHVmZDhmXFx1ZmQ5Mi1cXHVmZGM3XFx1ZmRmMC1cXHVmZGZiXFx1ZmU3MC1cXHVmZTc0XFx1ZmU3Ni1cXHVmZWZjXFx1ZmYyMS1cXHVmZjNhXFx1ZmY0MS1cXHVmZjVhXFx1ZmY2Ni1cXHVmZmJlXFx1ZmZjMi1cXHVmZmM3XFx1ZmZjYS1cXHVmZmNmXFx1ZmZkMi1cXHVmZmQ3XFx1ZmZkYS1cXHVmZmRjMC05XFx1MDMwMC1cXHUwMzZmXFx1MDQ4My1cXHUwNDg3XFx1MDU5MS1cXHUwNWJkXFx1MDViZlxcdTA1YzFcXHUwNWMyXFx1MDVjNFxcdTA1YzVcXHUwNWM3XFx1MDYxMC1cXHUwNjFhXFx1MDY0Yi1cXHUwNjY5XFx1MDY3MFxcdTA2ZDYtXFx1MDZkY1xcdTA2ZGYtXFx1MDZlNFxcdTA2ZTdcXHUwNmU4XFx1MDZlYS1cXHUwNmVkXFx1MDZmMC1cXHUwNmY5XFx1MDcxMVxcdTA3MzAtXFx1MDc0YVxcdTA3YTYtXFx1MDdiMFxcdTA3YzAtXFx1MDdjOVxcdTA3ZWItXFx1MDdmM1xcdTA4MTYtXFx1MDgxOVxcdTA4MWItXFx1MDgyM1xcdTA4MjUtXFx1MDgyN1xcdTA4MjktXFx1MDgyZFxcdTA4NTktXFx1MDg1YlxcdTA4ZTQtXFx1MDhmZVxcdTA5MDAtXFx1MDkwM1xcdTA5M2EtXFx1MDkzY1xcdTA5M2UtXFx1MDk0ZlxcdTA5NTEtXFx1MDk1N1xcdTA5NjJcXHUwOTYzXFx1MDk2Ni1cXHUwOTZmXFx1MDk4MS1cXHUwOTgzXFx1MDliY1xcdTA5YmUtXFx1MDljNFxcdTA5YzdcXHUwOWM4XFx1MDljYi1cXHUwOWNkXFx1MDlkN1xcdTA5ZTJcXHUwOWUzXFx1MDllNi1cXHUwOWVmXFx1MGEwMS1cXHUwYTAzXFx1MGEzY1xcdTBhM2UtXFx1MGE0MlxcdTBhNDdcXHUwYTQ4XFx1MGE0Yi1cXHUwYTRkXFx1MGE1MVxcdTBhNjYtXFx1MGE3MVxcdTBhNzVcXHUwYTgxLVxcdTBhODNcXHUwYWJjXFx1MGFiZS1cXHUwYWM1XFx1MGFjNy1cXHUwYWM5XFx1MGFjYi1cXHUwYWNkXFx1MGFlMlxcdTBhZTNcXHUwYWU2LVxcdTBhZWZcXHUwYjAxLVxcdTBiMDNcXHUwYjNjXFx1MGIzZS1cXHUwYjQ0XFx1MGI0N1xcdTBiNDhcXHUwYjRiLVxcdTBiNGRcXHUwYjU2XFx1MGI1N1xcdTBiNjJcXHUwYjYzXFx1MGI2Ni1cXHUwYjZmXFx1MGI4MlxcdTBiYmUtXFx1MGJjMlxcdTBiYzYtXFx1MGJjOFxcdTBiY2EtXFx1MGJjZFxcdTBiZDdcXHUwYmU2LVxcdTBiZWZcXHUwYzAxLVxcdTBjMDNcXHUwYzNlLVxcdTBjNDRcXHUwYzQ2LVxcdTBjNDhcXHUwYzRhLVxcdTBjNGRcXHUwYzU1XFx1MGM1NlxcdTBjNjJcXHUwYzYzXFx1MGM2Ni1cXHUwYzZmXFx1MGM4MlxcdTBjODNcXHUwY2JjXFx1MGNiZS1cXHUwY2M0XFx1MGNjNi1cXHUwY2M4XFx1MGNjYS1cXHUwY2NkXFx1MGNkNVxcdTBjZDZcXHUwY2UyXFx1MGNlM1xcdTBjZTYtXFx1MGNlZlxcdTBkMDJcXHUwZDAzXFx1MGQzZS1cXHUwZDQ0XFx1MGQ0Ni1cXHUwZDQ4XFx1MGQ0YS1cXHUwZDRkXFx1MGQ1N1xcdTBkNjJcXHUwZDYzXFx1MGQ2Ni1cXHUwZDZmXFx1MGQ4MlxcdTBkODNcXHUwZGNhXFx1MGRjZi1cXHUwZGQ0XFx1MGRkNlxcdTBkZDgtXFx1MGRkZlxcdTBkZjJcXHUwZGYzXFx1MGUzMVxcdTBlMzQtXFx1MGUzYVxcdTBlNDctXFx1MGU0ZVxcdTBlNTAtXFx1MGU1OVxcdTBlYjFcXHUwZWI0LVxcdTBlYjlcXHUwZWJiXFx1MGViY1xcdTBlYzgtXFx1MGVjZFxcdTBlZDAtXFx1MGVkOVxcdTBmMThcXHUwZjE5XFx1MGYyMC1cXHUwZjI5XFx1MGYzNVxcdTBmMzdcXHUwZjM5XFx1MGYzZVxcdTBmM2ZcXHUwZjcxLVxcdTBmODRcXHUwZjg2XFx1MGY4N1xcdTBmOGQtXFx1MGY5N1xcdTBmOTktXFx1MGZiY1xcdTBmYzZcXHUxMDJiLVxcdTEwM2VcXHUxMDQwLVxcdTEwNDlcXHUxMDU2LVxcdTEwNTlcXHUxMDVlLVxcdTEwNjBcXHUxMDYyLVxcdTEwNjRcXHUxMDY3LVxcdTEwNmRcXHUxMDcxLVxcdTEwNzRcXHUxMDgyLVxcdTEwOGRcXHUxMDhmLVxcdTEwOWRcXHUxMzVkLVxcdTEzNWZcXHUxNzEyLVxcdTE3MTRcXHUxNzMyLVxcdTE3MzRcXHUxNzUyXFx1MTc1M1xcdTE3NzJcXHUxNzczXFx1MTdiNC1cXHUxN2QzXFx1MTdkZFxcdTE3ZTAtXFx1MTdlOVxcdTE4MGItXFx1MTgwZFxcdTE4MTAtXFx1MTgxOVxcdTE4YTlcXHUxOTIwLVxcdTE5MmJcXHUxOTMwLVxcdTE5M2JcXHUxOTQ2LVxcdTE5NGZcXHUxOWIwLVxcdTE5YzBcXHUxOWM4XFx1MTljOVxcdTE5ZDAtXFx1MTlkOVxcdTFhMTctXFx1MWExYlxcdTFhNTUtXFx1MWE1ZVxcdTFhNjAtXFx1MWE3Y1xcdTFhN2YtXFx1MWE4OVxcdTFhOTAtXFx1MWE5OVxcdTFiMDAtXFx1MWIwNFxcdTFiMzQtXFx1MWI0NFxcdTFiNTAtXFx1MWI1OVxcdTFiNmItXFx1MWI3M1xcdTFiODAtXFx1MWI4MlxcdTFiYTEtXFx1MWJhZFxcdTFiYjAtXFx1MWJiOVxcdTFiZTYtXFx1MWJmM1xcdTFjMjQtXFx1MWMzN1xcdTFjNDAtXFx1MWM0OVxcdTFjNTAtXFx1MWM1OVxcdTFjZDAtXFx1MWNkMlxcdTFjZDQtXFx1MWNlOFxcdTFjZWRcXHUxY2YyLVxcdTFjZjRcXHUxZGMwLVxcdTFkZTZcXHUxZGZjLVxcdTFkZmZcXHUyMDBjXFx1MjAwZFxcdTIwM2ZcXHUyMDQwXFx1MjA1NFxcdTIwZDAtXFx1MjBkY1xcdTIwZTFcXHUyMGU1LVxcdTIwZjBcXHUyY2VmLVxcdTJjZjFcXHUyZDdmXFx1MmRlMC1cXHUyZGZmXFx1MzAyYS1cXHUzMDJmXFx1MzA5OVxcdTMwOWFcXHVhNjIwLVxcdWE2MjlcXHVhNjZmXFx1YTY3NC1cXHVhNjdkXFx1YTY5ZlxcdWE2ZjBcXHVhNmYxXFx1YTgwMlxcdWE4MDZcXHVhODBiXFx1YTgyMy1cXHVhODI3XFx1YTg4MFxcdWE4ODFcXHVhOGI0LVxcdWE4YzRcXHVhOGQwLVxcdWE4ZDlcXHVhOGUwLVxcdWE4ZjFcXHVhOTAwLVxcdWE5MDlcXHVhOTI2LVxcdWE5MmRcXHVhOTQ3LVxcdWE5NTNcXHVhOTgwLVxcdWE5ODNcXHVhOWIzLVxcdWE5YzBcXHVhOWQwLVxcdWE5ZDlcXHVhYTI5LVxcdWFhMzZcXHVhYTQzXFx1YWE0Y1xcdWFhNGRcXHVhYTUwLVxcdWFhNTlcXHVhYTdiXFx1YWFiMFxcdWFhYjItXFx1YWFiNFxcdWFhYjdcXHVhYWI4XFx1YWFiZVxcdWFhYmZcXHVhYWMxXFx1YWFlYi1cXHVhYWVmXFx1YWFmNVxcdWFhZjZcXHVhYmUzLVxcdWFiZWFcXHVhYmVjXFx1YWJlZFxcdWFiZjAtXFx1YWJmOVxcdWZiMWVcXHVmZTAwLVxcdWZlMGZcXHVmZTIwLVxcdWZlMjZcXHVmZTMzXFx1ZmUzNFxcdWZlNGQtXFx1ZmU0ZlxcdWZmMTAtXFx1ZmYxOVxcdWZmM2ZdKi9naSk7XG4gIH0sXG4gIGV2YWxJbkNvbnRleHQ6IGZ1bmN0aW9uIChqcykge1xuICAgIGpzID0ganMucmVwbGFjZSgvXFxzKy9nLCAnJyk7XG5cblxuICAgIHZhciBrZXlzID0gW10sIHZhbHVlcyA9IFtdO1xuXG4gICAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGtleXMgPSBrZXlzLmNvbmNhdChPYmplY3Qua2V5cyhhcmd1bWVudHNbaV0pKTtcbiAgICAgIGZvciAodmFyIGogaW4gYXJndW1lbnRzW2ldKSB7XG4gICAgICAgIHZhbHVlcy5wdXNoKGFyZ3VtZW50c1tpXVtqXSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy9cbiAgICAvL2lmKF8uaXNDb3JyZWN0VmFyaWFibGVOYW1lKGpzKSAmJiBrZXlzLmluZGV4T2YoanMpID09PSAtMSl7XG4gICAgLy8gIGtleXMucHVzaChqcyk7XG4gICAgLy8gIHZhbHVlcy5wdXNoKHVuZGVmaW5lZCk7XG4gICAgLy99XG5cbiAgICB2YXIgYXJyID0gdXRpbHMuZXh0cmFjdFZhcmlhYmxlcyhqcyk7XG4gICAgLy9jb25zb2xlLmxvZyhhcnIpO1xuICAgIGZvciAodmFyIGkgaW4gYXJyKSB7XG4gICAgICBpZiAoa2V5cy5pbmRleE9mKGFycltpXSkgPT09IC0xKSB7XG4gICAgICAgIGtleXMucHVzaChhcnJbaV0pO1xuICAgICAgICB2YWx1ZXMucHVzaCh1bmRlZmluZWQpO1xuICAgICAgfVxuICAgIH1cbiAgICBqcyA9IFwidmFyIGZvbyA9IGZ1bmN0aW9uKFwiICsga2V5cy5qb2luKFwiLFwiKSArIFwiKXsgdmFyIF9fcmV0dXJuX192YWx1ZSA9IFwiICsganMgKyBcIiA7cmV0dXJuIF9fcmV0dXJuX192YWx1ZTt9OyBmb287XCI7XG4gICAgdHJ5IHtcbiAgICAgIHZhciBmb28gPSBldmFsKGpzKTtcbiAgICAgIHJldHVybiBmb28uYXBwbHkodGhpcywgdmFsdWVzKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cblxuICB9LFxuICBjb21waWxlRWxlbWVudDogZnVuY3Rpb24gKCRpdGVtLCBzY29wZSkge1xuXG4gICAgZnVuY3Rpb24gX2VhY2hTZWxmKGVsLCBzZWxlY3RvciwgZm9vKSB7XG4gICAgICBlbC5maW5kKHNlbGVjdG9yKS5lYWNoKGZvbyk7XG4gICAgICBpZiAoZWwuaXMoc2VsZWN0b3IpKSB7XG4gICAgICAgIGZvby5jYWxsKGVsWzBdKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLy5hZGRCYWNrKCdzZWxlY3RvcicpXG4gICAgX2VhY2hTZWxmKCRpdGVtLCBcIltvbmNsaWNrXVwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgb25DbGljayA9ICQodGhpcykuYXR0cihcIm9uY2xpY2tcIik7XG4gICAgICAkKHRoaXMpLnJlbW92ZUF0dHIoXCJvbmNsaWNrXCIpO1xuICAgICAgJCh0aGlzKS5jbGljayhmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgdXRpbHMuZXZhbEluQ29udGV4dChvbkNsaWNrLCBzY29wZSwge2V2ZW50OiBldmVudH0pO1xuICAgICAgfSlcbiAgICB9KVxuXG5cbiAgICBfZWFjaFNlbGYoJGl0ZW0sIFwiW29uY2hhbmdlXVwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgb25DaGFuZ2UgPSAkKHRoaXMpLmF0dHIoXCJvbmNoYW5nZVwiKTtcbiAgICAgICQodGhpcykucmVtb3ZlQXR0cihcIm9uY2hhbmdlXCIpO1xuICAgICAgJCh0aGlzKS5jaGFuZ2UoZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIHV0aWxzLmV2YWxJbkNvbnRleHQob25DaGFuZ2UsIHNjb3BlLCB7ZXZlbnQ6IGV2ZW50fSk7XG4gICAgICB9KVxuICAgIH0pO1xuXG4gICAgX2VhY2hTZWxmKCRpdGVtLCBcIltkcC1jaGVja2VkXVwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgX3ZhbCA9ICQodGhpcykuYXR0cihcImRwLWNoZWNrZWRcIik7XG4gICAgICB2YXIgdmFsID0gdXRpbHMuZXZhbEluQ29udGV4dChfdmFsLCBzY29wZSk7XG4gICAgICBpZiAodmFsKSB7XG4gICAgICAgICQodGhpcykuYXR0cihcImNoZWNrZWRcIiwgXCJjaGVja2VkXCIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgJCh0aGlzKS5yZW1vdmVBdHRyKFwiY2hlY2tlZFwiKTtcbiAgICAgIH1cblxuICAgIH0pO1xuICAgIF9lYWNoU2VsZigkaXRlbSwgXCJbZHAtc3JjXVwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgX3ZhbCA9ICQodGhpcykuYXR0cihcImRwLXNyY1wiKTtcbiAgICAgIHZhciB2YWwgPSB1dGlscy5ldmFsSW5Db250ZXh0KF92YWwsIHNjb3BlKTtcbiAgICAgIGlmICh2YWwpIHtcbiAgICAgICAgJCh0aGlzKS5hdHRyKFwic3JjXCIsIHZhbCk7XG4gICAgICB9XG5cbiAgICB9KTtcbiAgICBfZWFjaFNlbGYoJGl0ZW0sIFwiW2RwLWlmXVwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgX3ZhbCA9ICQodGhpcykuYXR0cihcImRwLWlmXCIpO1xuICAgICAgaWYgKF92YWwgPT09IFwiZmFsc2VcIikge1xuICAgICAgICAkKHRoaXMpLnJlbW92ZSgpO1xuICAgICAgfVxuICAgICAgaWYgKF92YWwgPT09IFwidHJ1ZVwiKSB7XG5cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciB2YWwgPSB1dGlscy5ldmFsSW5Db250ZXh0KF92YWwsIHNjb3BlKTtcbiAgICAgICAgaWYgKCF2YWwpIHtcbiAgICAgICAgICAkKHRoaXMpLnJlbW92ZSgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gICAgX2VhY2hTZWxmKCRpdGVtLCBcIltkcC1pbmNsdWRlXVwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgX2VsID0gJCh0aGlzKTtcbiAgICAgIHZhciBfdmFsID0gX2VsLmF0dHIoXCJkcC1pbmNsdWRlXCIpO1xuICAgICAgdmFyIHZhbCA9IHV0aWxzLmV2YWxJbkNvbnRleHQoX3ZhbCwgc2NvcGUpO1xuICAgICAgX2VsLmxvYWQodmFsKTtcbiAgICB9KTtcbiAgfSxcbiAgcGFyc2VUZW1wbGF0ZTogZnVuY3Rpb24gKHRwbCwgc2NvcGUpIHtcbiAgICB2YXIgJGl0ZW0gPSAkKHRwbC5mb3JtYXQoc2NvcGUpKTtcbiAgICBfLmNvbXBpbGVFbGVtZW50KCRpdGVtLCBzY29wZSk7XG4gICAgcmV0dXJuICRpdGVtO1xuICB9XG59O1xuaWYodHlwZW9mIG1vZHVsZSAhPT0gXCJ1bmRlZmluZWRcIil7XG4gIG1vZHVsZS5leHBvcnRzID0gdXRpbHM7XG59XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL3V0aWwvY29tcGlsZS5qcyIsIlxudmFyIEV4dENhbnZhc01peGluID0ge1xuICBkZWZhdWx0T3B0aW9uczoge30sXG4gIGFuaW1hdGVkOiBmYWxzZSxcbiAgZml0SW5kZXg6IDAuOCxcbiAgLyoqXG4gICAqIHJlcXVpcmVkIHRvIHNob3cgdmlkZW9cbiAgICovXG4gIHNldEFuaW1hdGVkOiBmdW5jdGlvbiAodmFsKSB7XG4gICAgaWYoIXZhbCl7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgZmFicmljLnV0aWwucmVxdWVzdEFuaW1GcmFtZShmdW5jdGlvbiByZW5kZXIoKSB7XG4gICAgICB0aGlzLnJlbmRlckFsbCgpO1xuICAgICAgZmFicmljLnV0aWwucmVxdWVzdEFuaW1GcmFtZShyZW5kZXIpO1xuICAgIH0uYmluZCh0aGlzKSk7XG4gIH0sXG4gIGZpbmQ6IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgaWYgKHR5cGVvZiBvcHRpb25zID09PSBcInN0cmluZ1wiKXtcbiAgICAgIG9wdGlvbnMgPSB7XG4gICAgICAgIHR5cGU6IG9wdGlvbnNcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhYnJpYy51dGlsLm9iamVjdC53aGVyZSh0aGlzLl9vYmplY3RzLG9wdGlvbnMpO1xuICB9LFxuICBfdXBkYXRlX2JhY2tncm91bmRfaW1hZ2U6IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgcGhvdG8gPSB0aGlzLmJhY2tncm91bmRJbWFnZTtcbiAgICBpZiAoIXBob3RvIHx8IHBob3RvLmNvbnN0cnVjdG9yID09IE9iamVjdCB8fCBwaG90by5jb25zdHJ1Y3RvciA9PSBTdHJpbmcpIHJldHVybjtcblxuICAgIGlmICh0aGlzLmJhY2tncm91bmRQb3NpdGlvbiA9PT0gJ3Jlc2l6ZScpIHtcbiAgICAgIHRoaXMub3JpZ2luYWxXaWR0aCA9IHBob3RvLndpZHRoO1xuICAgICAgdGhpcy5vcmlnaW5hbEhlaWdodCA9IHBob3RvLmhlaWdodDtcblxuICAgIH1lbHNlIGlmICh0aGlzLmJhY2tncm91bmRQb3NpdGlvbiAhPT0gJ21hbnVhbCcpIHtcblxuICAgICAgdmFyIF93ICA9ICB0aGlzLm9yaWdpbmFsV2lkdGggfHwgdGhpcy53aWR0aCwgIF9oID0gdGhpcy5vcmlnaW5hbEhlaWdodCB8fCB0aGlzLmhlaWdodDtcblxuICAgICAgaWYocGhvdG8uX29yaWdpbmFsRWxlbWVudCl7XG4gICAgICAgIHZhciBzaXplID0gZmFicmljLnV0aWwuZ2V0UHJvcG9ydGlvbnMocGhvdG8uX29yaWdpbmFsRWxlbWVudCwge1xuICAgICAgICAgIHdpZHRoOiBfdyxcbiAgICAgICAgICBoZWlnaHQ6IF9oXG4gICAgICAgIH0sIHRoaXMuYmFja2dyb3VuZFBvc2l0aW9uKTtcbiAgICAgIH1lbHNle1xuICAgICAgICBzaXplID0ge1xuICAgICAgICAgIHdpZHRoOiBfdyxcbiAgICAgICAgICBoZWlnaHQ6IF9oXG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgdmFyIF9sIDtcbiAgICAgIGlmKHRoaXMuYmFja2dyb3VuZEltYWdlLm9yaWdpblggPT0gJ2NlbnRlcicpe1xuICAgICAgICBfbCA9IF93IC8gMjtcbiAgICAgIH1lbHNle1xuICAgICAgICBfbCA9IChfdyAtIHNpemUud2lkdGgpIC8gMiA7XG4gICAgICB9XG4gICAgICB2YXIgX3QgO1xuICAgICAgaWYodGhpcy5iYWNrZ3JvdW5kSW1hZ2Uub3JpZ2luWSA9PSAnY2VudGVyJyl7XG4gICAgICAgIF90ID0gX2ggLyAyO1xuICAgICAgfWVsc2V7XG4gICAgICAgIF90ID0gKF9oIC0gc2l6ZS5oZWlnaHQpIC8gMiA7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuYmFja2dyb3VuZEltYWdlLnNldCh7XG4gICAgICAgIGxlZnQ6IF9sICsgdGhpcy52aWV3cG9ydFRyYW5zZm9ybVs0XSxcbiAgICAgICAgdG9wOiAgX3QgKyB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzVdLFxuICAgICAgICB3aWR0aDogc2l6ZS53aWR0aCxcbiAgICAgICAgaGVpZ2h0OiBzaXplLmhlaWdodFxuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIHZhciBfb3JpZyA9IHRoaXMuYmFja2dyb3VuZEltYWdlLmdldE9yaWdpbmFsU2l6ZSgpO1xuICAgICAgLy8gdGhpcy5iYWNrZ3JvdW5kSW1hZ2Uuc2V0KHtcbiAgICAgIC8vICAgb3JpZ2luWDogJ2xlZnQnLFxuICAgICAgLy8gICBvcmlnaW5ZOiAndG9wJyxcbiAgICAgIC8vICAgbGVmdDogMCwgLy90aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzRdLFxuICAgICAgLy8gICB0b3A6IDAsIC8vdGhpcy52aWV3cG9ydFRyYW5zZm9ybVs1XSxcbiAgICAgIC8vICAgd2lkdGg6IF9vcmlnLndpZHRoLFxuICAgICAgLy8gICBoZWlnaHQ6IF9vcmlnLmhlaWdodFxuICAgICAgLy8gfSk7XG4gICAgfVxuICB9LFxuICBzZXRCYWNrZ3JvdW5kSW1hZ2U6IGZ1bmN0aW9uIChiZywgY2FsbGJhY2spIHtcbiAgICB2YXIgX2JnaW1hZ2VMb2FkZWQgPSBmdW5jdGlvbiAoZWwpe1xuXG4gICAgICBpZih0aGlzLmxvYWRlZCkge1xuICAgICAgICB2YXIgb3JpZ2luYWxTdGF0ZSA9IHtiYWNrZ3JvdW5kSW1hZ2U6IHRoaXMuYmFja2dyb3VuZEltYWdlfTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5iYWNrZ3JvdW5kSW1hZ2UgPSBlbDtcbiAgICAgIHRoaXMuYmFja2dyb3VuZEltYWdlLmNhbnZhcyA9IHRoaXM7XG4gICAgICB0aGlzLl91cGRhdGVfYmFja2dyb3VuZF9pbWFnZSgpO1xuICAgICAgaWYodGhpcy5iYWNrZ3JvdW5kUG9zaXRpb24gPT09IFwicmVzaXplXCIpe1xuICAgICAgICB0aGlzLm9yaWdpbmFsV2lkdGggPSBlbC53aWR0aDtcbiAgICAgICAgdGhpcy5vcmlnaW5hbEhlaWdodCA9IGVsLmhlaWdodDtcbiAgICAgIH1cblxuICAgICAgaWYodGhpcy5sb2FkZWQpe1xuICAgICAgICB0aGlzLmZpcmUoJ21vZGlmaWVkJyx7c3RhdGVzOiB7XG4gICAgICAgICAgb3JpZ2luYWw6IG9yaWdpbmFsU3RhdGUsXG4gICAgICAgICAgbW9kaWZpZWQ6IHtiYWNrZ3JvdW5kSW1hZ2U6IHRoaXMuYmFja2dyb3VuZEltYWdlfVxuICAgICAgICB9fSk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuZmlyZShcImJhY2tncm91bmQtaW1hZ2U6bG9hZGVkXCIse3RhcmdldDogZWx9KTtcbiAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKCk7XG4gICAgfVxuXG5cbiAgICBpZiAoIWJnKSB7XG4gICAgICB0aGlzLmJhY2tncm91bmRJbWFnZSA9IG51bGw7XG4gICAgICByZXR1cm4gY2FsbGJhY2soKTtcbiAgICB9XG4gICAgaWYgKGJnIGluc3RhbmNlb2YgSFRNTEltYWdlRWxlbWVudCB8fCBiZyBpbnN0YW5jZW9mIEltYWdlKXtcblxuICAgICAgdmFyIGVsID0gbmV3IGZhYnJpYy5JbWFnZShiZyx7XG4gICAgICAgIHdpZHRoOiBiZy5uYXR1cmFsV2lkdGgsXG4gICAgICAgIGhlaWdodDogYmcubmF0dXJhbEhlaWdodFxuICAgICAgfSk7XG5cbiAgICAgIF9iZ2ltYWdlTG9hZGVkLmNhbGwodGhpcyxlbCk7XG4gICAgfVxuICAgIGlmIChiZy5jb25zdHJ1Y3RvciA9PSBTdHJpbmcpIHtcbiAgICAgIGJnID0ge1xuICAgICAgICBzcmM6IGJnXG4gICAgICB9XG4gICAgfVxuXG4gICAgdmFyIF9wcm90byA9IHRoaXMuYXBwbGljYXRpb24ucHJvdG90eXBlcztcbiAgICBpZihfcHJvdG8gJiYgX3Byb3RvLkJhY2tncm91bmRJbWFnZSl7XG4gICAgICBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGJnLF9wcm90by5CYWNrZ3JvdW5kSW1hZ2UpO1xuICAgIH1cbiAgICBiZy5hcHBsaWNhdGlvbiA9IHRoaXMuYXBwbGljYXRpb247XG4gICAgYmcuZGlzYWJsZURlZmF1bHRQcm9wZXJ0aWVzID0gdHJ1ZTtcbiAgICBiZy50eXBlID0gYmcudHlwZSB8fCBcImltYWdlXCI7XG4gICAgLy8gYmcud2lkdGggPSBiZy5uYXR1cmFsV2lkdGg7XG4gICAgLy8gYmcuaGVpZ2h0ID0gYmcubmF0dXJhbEhlaWdodDtcbiAgICAvL1xuICAgIGZhYnJpYy51dGlsLmNyZWF0ZU9iamVjdChiZyxfYmdpbWFnZUxvYWRlZC5iaW5kKHRoaXMpKTtcbiAgfSxcbiAgY3JlYXRlT2JqZWN0czogZnVuY3Rpb24ob2JqZWN0cyxjYWxsYmFjayl7XG5cbiAgICBpZih0aGlzLmFwcGxpY2F0aW9uKXtcbiAgICAgIGZvcih2YXIgaSBpbiBvYmplY3RzKXtcbiAgICAgICAgaWYob2JqZWN0c1tpXS5jb25zdHJ1Y3RvciA9PSBTdHJpbmcpe1xuICAgICAgICAgIG9iamVjdHNbaV0gPSB0aGlzLmFwcGxpY2F0aW9uLm9iamVjdHNbb2JqZWN0c1tpXV07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICB2YXIgX2NhbnZhcyA9IHRoaXM7XG5cbiAgICBmdW5jdGlvbiBzdWNjZXNzKF9vYmplY3RzKSB7XG4gICAgICBfY2FudmFzLmZpcmUoXCJwcm9ncmVzczpjb21wbGV0ZVwiLCB7b2JqZWN0czogb2JqZWN0c30pO1xuICAgICAgZm9yICh2YXIgaSBpbiBfb2JqZWN0cykge1xuICAgICAgICBfY2FudmFzLmFkZChfb2JqZWN0c1tpXSk7XG4gICAgICB9XG4gICAgICBfY2FudmFzLnJlbmRlckFsbCgpO1xuICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2suY2FsbChfY2FudmFzKVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIHByb2dyZXNzKGwsIHQpIHtcbiAgICAgIF9jYW52YXMuZmlyZShcInByb2dyZXNzXCIsIHsgbG9hZGVkIDogbCwgdG90YWwgOiB0IH0pO1xuICAgICAgaWYgKGZhYnJpYy51dGlsLmxvYWRlckRlYnVnKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwibG9hZGVkIFwiICsgbCArIFwiIC8gXCIgKyB0KTtcbiAgICAgIH1cbiAgICB9XG5cblxuICAgIHZhciBfb2JqZWN0cyA9IFtdO1xuICAgIGlmICghb2JqZWN0cyB8fCAhb2JqZWN0cy5sZW5ndGgpIHtcbiAgICAgIHN1Y2Nlc3MoX29iamVjdHMpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmKG9iamVjdHNbMF0uY29uc3RydWN0b3IubmFtZSA9PT0gXCJrbGFzc1wiKXtcbiAgICAgIHN1Y2Nlc3Mob2JqZWN0cyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG5cbiAgICB2YXIgcXVldWVMb2FkQ2FsbGJhY2sgPSBmYWJyaWMudXRpbC5xdWV1ZUxvYWQob2JqZWN0cy5sZW5ndGgsIGZ1bmN0aW9uKCl7XG4gICAgICBzdWNjZXNzKGZhYnJpYy51dGlsLm9iamVjdC5wbHVjayhfb2JqZWN0cyxcIm9iamVjdFwiKSk7XG4gICAgfSwgcHJvZ3Jlc3MpO1xuXG4gICAgcXVldWVMb2FkQ2FsbGJhY2suZGF0YSA9ICh0aGlzLnRpdGxlIHx8IFwiXCIpICsgXCJvYmplY3RzXCI7XG5cblxuICAgIGZvciAodmFyIGkgaW4gb2JqZWN0cykge1xuICAgICAgKGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgIHZhciBfb2JqZWN0X3Nsb3QgPSB7b2JqZWN0OiBudWxsLCBvcHRpb25zOiBvcHRpb25zfTtcbiAgICAgICAgX29iamVjdHMucHVzaChfb2JqZWN0X3Nsb3QpO1xuXG4gICAgICAgIG9wdGlvbnMuYXBwbGljYXRpb24gPSBfY2FudmFzLmFwcGxpY2F0aW9uO1xuICAgICAgICBmYWJyaWMudXRpbC5jcmVhdGVPYmplY3Qob3B0aW9ucywgZnVuY3Rpb24gKGVsKSB7XG4gICAgICAgICAgX29iamVjdF9zbG90Lm9iamVjdCA9IGVsO1xuICAgICAgICAgIHF1ZXVlTG9hZENhbGxiYWNrKCk7XG4gICAgICAgIH0pO1xuICAgICAgfSkuY2FsbCh0aGlzLCBvYmplY3RzW2ldKTtcbiAgICB9XG4gIH0sXG4gIC8qKlxuICAgKiBhcHBseSBvcHRpb25zIGZvciBncm91cCBvZiBmaWx0ZXJlZCBvYmplY3RzXG4gICAqIEBwYXJhbSBmaWx0ZXJcbiAgICogQHBhcmFtIG9wdGlvbnNcbiAgICovXG4gIGFwcGx5T3B0aW9uczogZnVuY3Rpb24oZmlsdGVyLG9wdGlvbnMpe1xuICAgIHRoaXMuX29iamVjdHMuZm9yRWFjaChmdW5jdGlvbihfb2JqKXtcbiAgICAgIGZvcih2YXIgcHJvcCBpbiBmaWx0ZXIpe1xuICAgICAgICBpZihfb2JqW3Byb3BdICE9PSAgZmlsdGVyW3Byb3BdKXJldHVybjtcbiAgICAgIH1cbiAgICAgIF9vYmouc2V0T3B0aW9ucyhvcHRpb25zKTtcbiAgICB9KVxuICB9LFxuICAvKipcbiAgICogQ3JlYXRlIE9iamVjdCBieSB0eXBlIGFuZCBvcHRpb25zXG4gICAqIEBwYXJhbSB0eXBlXG4gICAqIEBwYXJhbSBvcHRpb25zXG4gICAqIEBwYXJhbSBjYWxsYmFja1xuICAgKi9cbiAgY3JlYXRlT2JqZWN0OiBmdW5jdGlvbiAodHlwZSwgb3B0aW9ucyxjYWxsYmFjaykge1xuICAgIGlmKHR5cGVvZiB0eXBlICE9PSBcInN0cmluZ1wiKXtcbiAgICAgIGNhbGxiYWNrID0gb3B0aW9ucztcbiAgICAgIG9wdGlvbnMgPSBmYWJyaWMudXRpbC5vYmplY3QuY2xvbmUodHlwZSk7XG4gICAgICB0eXBlID0gbnVsbDtcbiAgICB9ZWxzZXtcbiAgICAgIG9wdGlvbnMgPSBmYWJyaWMudXRpbC5vYmplY3QuY2xvbmUob3B0aW9ucyk7XG4gICAgICBvcHRpb25zLnR5cGUgPSB0eXBlO1xuICAgIH1cblxuICAgIHZhciBfc2VsZiA9IHRoaXM7XG4gICAgb3B0aW9ucy5hcHBsaWNhdGlvbiA9IHRoaXMuYXBwbGljYXRpb247XG4gICAvLyB2YXIgX2FjdGl2ZSA9IG9wdGlvbnMuYWN0aXZlO1xuICAgLy8gdmFyIF9wb3NpdGlvbiA9IG9wdGlvbnMucG9zaXRpb247XG4vLyAgICBkZWxldGUgb3B0aW9ucy5hY3RpdmU7XG4gIC8vICBkZWxldGUgb3B0aW9ucy5wb3NpdGlvbjtcblxuXG4gICAgZnVuY3Rpb24gX2FkZChlbCkge1xuICAgICAgaWYoZWwuY2FudmFzKXJldHVybjtcbiAgICAgIF9zZWxmLmFkZChlbCk7XG4vKlxuICAgICAgaWYoX2FjdGl2ZSl7XG4gICAgICBpZihfYWN0aXZlKXtcbiAgICAgICAgX3NlbGYuc2V0QWN0aXZlT2JqZWN0KGVsKTtcbiAgICAgIH0qL1xuICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2soZWwpO1xuICAgIH1cblxuICAgIHZhciBlbCA9IGZhYnJpYy51dGlsLmNyZWF0ZU9iamVjdChvcHRpb25zLCBfYWRkICk7XG4gICAgZWwgJiYgX2FkZChlbCk7XG4gICAgcmV0dXJuIGVsO1xuICB9LFxuICBvbkxvYWQ6IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgIHRoaXMucHJvY2Vzc2luZyA9ZmFsc2U7XG4gICAgdGhpcy5sb2FkZWQgPSB0cnVlO1xuICAgIHRoaXMuZmlyZShcImxvYWRpbmc6ZW5kXCIse3R5cGU6IFwic2xpZGVcIiwgdGFyZ2V0OiB0aGlzfSk7XG4gICAgdGhpcy5yZW5kZXJBbGwoKTtcbiAgICBjYWxsYmFjayAmJiBjYWxsYmFjay5jYWxsKHRoaXMpO1xuICB9LFxuICBsb2FkOiBmdW5jdGlvbiAob3B0aW9ucyxjYWxsYmFjaykge1xuICAgIHRoaXMub3JpZ2luYWxXaWR0aCA9IDA7XG4gICAgdGhpcy5vcmlnaW5hbEhlaWdodCA9IDA7XG5cblxuICAgIGlmKHRoaXMuYXBwbGljYXRpb24ucHJvdG90eXBlcy5TbGlkZSl7XG4gICAgICBmYWJyaWMudXRpbC5vYmplY3QuZGVmYXVsdHMob3B0aW9ucyx0aGlzLmFwcGxpY2F0aW9uLnByb3RvdHlwZXMuU2xpZGUpO1xuICAgIH1cblxuXG4gICAgaWYgKCFvcHRpb25zKXJldHVybjtcblxuICAgIGlmKCF0aGlzLnZpcnR1YWwpe1xuICAgICAgdGhpcy5jbGVhcigpO1xuICAgIH1cblxuICAgIGlmKG9wdGlvbnMud2lkdGgpe1xuICAgICAgb3B0aW9ucy5vcmlnaW5hbFdpZHRoID0gb3B0aW9ucy53aWR0aDtcbiAgICAgIG9wdGlvbnMub3JpZ2luYWxIZWlnaHQgPSBvcHRpb25zLmhlaWdodDtcbiAgICB9XG5cbiAgICB0aGlzLnByb2Nlc3NpbmcgPSB0cnVlO1xuICAgIHRoaXMuZmlyZShcImxvYWRpbmc6YmVnaW5cIix7dHlwZTogXCJzbGlkZVwiLCBvcHRpb25zOiBvcHRpb25zfSk7XG5cbiAgICB0aGlzLnNldChvcHRpb25zLHRoaXMub25Mb2FkLmJpbmQodGhpcyxjYWxsYmFjaykpO1xuXG5cbiAgICAvL3RvZG9cbiAgICBpZih0aGlzLnBsdWdpbnMpe1xuICAgICAgdGhpcy5wbHVnaW5zLnByZWxvYWRlcnMuZm9yRWFjaChmdW5jdGlvbihwcmVsb2FkZXIpe1xuICAgICAgICBwcmVsb2FkZXIuY2FsbCh0aGlzLCBvcHRpb25zKTtcbiAgICAgICAgdGhpcy5vblJlc2l6ZSgpO1xuICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICB9XG5cblxuICB9LFxuICBzZXRPYmplY3RzOiBmdW5jdGlvbihvYmplY3RzLGNhbGxiYWNrKXtcblxuICAgIHRoaXMuY2xlYXIoKTtcbiAgICB0aGlzLmNyZWF0ZU9iamVjdHMob2JqZWN0cyxmdW5jdGlvbigpe1xuICAgICAgZm9yKHZhciBpIGluIHRoaXMuX29iamVjdHMpe1xuICAgICAgICB0aGlzLl9vYmplY3RzW2ldLnNldENvb3JkcygpO1xuICAgICAgfVxuICAgICAgY2FsbGJhY2soKTtcbiAgICB9KTtcbiAgfSxcbiAgb25SZXNpemU6IGZ1bmN0aW9uKCl7XG4gICAgdmFyIF9zY2FsZSA9IE1hdGgubWluKDEsODAwIC90aGlzLndpZHRoICk7XG4gICAgLy8gdGhpcy5zZXRab29tKF9zY2FsZSk7XG4gICAgdGhpcy5zZXREaW1lbnNpb25zKHt3aWR0aDogdGhpcy53aWR0aCxoZWlnaHQ6IHRoaXMuaGVpZ2h0fSk7XG4gIH0sXG4gIGdldENlbnRlcjogZnVuY3Rpb24gKGVsKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHRvcDogKHRoaXMub3JpZ2luYWxIZWlnaHQgIHx8IHRoaXMuZ2V0SGVpZ2h0KCkpIC8gMixcbiAgICAgIGxlZnQ6ICh0aGlzLm9yaWdpbmFsV2lkdGggfHwgdGhpcy5nZXRXaWR0aCgpKSAvIDJcbiAgICB9O1xuICB9LFxuICBzZXRPcmlnaW5hbFNpemU6IGZ1bmN0aW9uICh3LCBoKSB7XG4gICAgdGhpcy5vcmlnaW5hbFdpZHRoID0gaCA/IHcgOiAody5uYXR1cmFsV2lkdGggfHwgdy53aWR0aCk7XG4gICAgdGhpcy5vcmlnaW5hbEhlaWdodCA9IGggPyBoIDogKHcubmF0dXJhbEhlaWdodCB8fCB3LmhlaWdodCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cbn07XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLlN0YXRpY0NhbnZhcy5wcm90b3R5cGUsRXh0Q2FudmFzTWl4aW4se1xuICB0eXBlOiBcInNsaWRlXCIsXG4gIG9wdGlvbnNPcmRlcjogKGZ1bmN0aW9uKCl7XG4gICAgdmFyIG9vID0gZmFicmljLlN0YXRpY0NhbnZhcy5wcm90b3R5cGUub3B0aW9uc09yZGVyO1xuICAgIG9vLnVuc2hpZnQoXCJvcmlnaW5hbFdpZHRoXCIsXCJvcmlnaW5hbEhlaWdodFwiLFwid2lkdGhcIixcImhlaWdodFwiLFwiKlwiKTtcbiAgICByZXR1cm4gb287XG4gIH0pKCksXG4gIF9pbml0RW50aXR5OiBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgIG9wdGlvbnMuYXBwbGljYXRpb24gJiYgb3B0aW9ucy5hcHBsaWNhdGlvbi5maXJlKFwiZW50aXR5OmNyZWF0ZWRcIiwge3RhcmdldDogdGhpcywgb3B0aW9uczogb3B0aW9uc30pO1xuICB9LFxuICBfbGF5ZXJzOiBbXCJfb2JqZWN0c1wiLFwiX2FyZWFzT2JqZWN0c1wiXSxcbiAgLyoqXG4gICAqIFJlbmRlcnMgYmFja2dyb3VuZCwgb2JqZWN0cywgb3ZlcmxheSBhbmQgY29udHJvbHMuXG4gICAqIEBwYXJhbSB7Q2FudmFzUmVuZGVyaW5nQ29udGV4dDJEfSBjdHhcbiAgICogQHBhcmFtIHtBcnJheX0gb2JqZWN0cyB0byByZW5kZXJcbiAgICogQHJldHVybiB7ZmFicmljLkNhbnZhc30gaW5zdGFuY2VcbiAgICogQGNoYWluYWJsZVxuICAgKi9cbiAgcmVuZGVyQ2FudmFzOiBmdW5jdGlvbihjdHgsIG9iamVjdHMpIHtcbiAgICB0aGlzLmNsZWFyQ29udGV4dChjdHgpO1xuICAgIHRoaXMuZmlyZSgnYmVmb3JlOnJlbmRlcicpO1xuICAgIGlmICh0aGlzLmNsaXBUbykge1xuICAgICAgZmFicmljLnV0aWwuY2xpcENvbnRleHQodGhpcywgY3R4KTtcbiAgICB9XG4gICAgdGhpcy5fcmVuZGVyQmFja2dyb3VuZChjdHgpO1xuXG4gICAgY3R4LnNhdmUoKTtcbiAgICAvL2FwcGx5IHZpZXdwb3J0IHRyYW5zZm9ybSBvbmNlIGZvciBhbGwgcmVuZGVyaW5nIHByb2Nlc3NcbiAgICBjdHgudHJhbnNmb3JtLmFwcGx5KGN0eCwgdGhpcy52aWV3cG9ydFRyYW5zZm9ybSk7XG4gICAgdGhpcy5fcmVuZGVyQmFja2dyb3VuZE9iamVjdHMoY3R4KTtcbiAgICB0aGlzLl9yZW5kZXJPYmplY3RzKGN0eCwgb2JqZWN0cyk7XG4gICAgdGhpcy5fcmVuZGVyT3ZlcmxheU9iamVjdHMoY3R4KTtcbiAgICBjdHgucmVzdG9yZSgpO1xuICAgIGlmICghdGhpcy5jb250cm9sc0Fib3ZlT3ZlcmxheSAmJiB0aGlzLmludGVyYWN0aXZlKSB7XG4gICAgICB0aGlzLmRyYXdDb250cm9scyhjdHgpO1xuICAgIH1cbiAgICBpZiAodGhpcy5jbGlwVG8pIHtcbiAgICAgIGN0eC5yZXN0b3JlKCk7XG4gICAgfVxuICAgIHRoaXMuX3JlbmRlck92ZXJsYXkoY3R4KTtcbiAgICBpZiAodGhpcy5jb250cm9sc0Fib3ZlT3ZlcmxheSAmJiB0aGlzLmludGVyYWN0aXZlKSB7XG4gICAgICB0aGlzLmRyYXdDb250cm9scyhjdHgpO1xuICAgIH1cbiAgICB0aGlzLmZpcmUoJ2FmdGVyOnJlbmRlcicpO1xuICB9LFxuICBfcmVuZGVyT3ZlcmxheU9iamVjdHM6IGZ1bmN0aW9uKCl7fSxcbiAgX3JlbmRlckJhY2tncm91bmRPYmplY3RzOiBmdW5jdGlvbigpe30sXG4gIC8qKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAcGFyYW0ge0hUTUxFbGVtZW50IHwgU3RyaW5nfSBlbCAmbHQ7Y2FudmFzPiBlbGVtZW50IHRvIGluaXRpYWxpemUgaW5zdGFuY2Ugb25cbiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXSBPcHRpb25zIG9iamVjdFxuICAgKi9cbiAgX2luaXRTdGF0aWM6IGZ1bmN0aW9uKGVsLCBvcHRpb25zKSB7XG4gICAgdGhpcy5fb2JqZWN0cyA9IFtdO1xuICAgIHRoaXMuX2NyZWF0ZUxvd2VyQ2FudmFzKGVsKTtcbiAgICB0aGlzLl9pbml0U2l6ZShvcHRpb25zKTtcbiAgICB0aGlzLnNldChvcHRpb25zKTtcbiAgICB0aGlzLl9zZXRJbWFnZVNtb290aGluZygpO1xuXG4gICAgLy8gb25seSBpbml0aWFsaXplIHJldGluYSBzY2FsaW5nIG9uY2VcbiAgICBpZiAoIXRoaXMuaW50ZXJhY3RpdmUpIHtcbiAgICAgIHRoaXMuX2luaXRSZXRpbmFTY2FsaW5nKCk7XG4gICAgfVxuICAgIHRoaXMuY2FsY09mZnNldCgpO1xuICB9LFxuICBfaW5pdFNpemU6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLndpZHRoID0gdGhpcy53aWR0aCB8fCBwYXJzZUludCh0aGlzLmxvd2VyQ2FudmFzRWwud2lkdGgsIDEwKSB8fCAwO1xuICAgIHRoaXMuaGVpZ2h0ID0gdGhpcy5oZWlnaHQgfHwgcGFyc2VJbnQodGhpcy5sb3dlckNhbnZhc0VsLmhlaWdodCwgMTApIHx8IDA7XG5cbiAgICBpZiAoIXRoaXMubG93ZXJDYW52YXNFbC5zdHlsZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMubG93ZXJDYW52YXNFbC53aWR0aCA9IHRoaXMud2lkdGg7XG4gICAgdGhpcy5sb3dlckNhbnZhc0VsLmhlaWdodCA9IHRoaXMuaGVpZ2h0O1xuXG4gICAgdGhpcy5sb3dlckNhbnZhc0VsLnN0eWxlLndpZHRoID0gdGhpcy53aWR0aCArICdweCc7XG4gICAgdGhpcy5sb3dlckNhbnZhc0VsLnN0eWxlLmhlaWdodCA9IHRoaXMuaGVpZ2h0ICsgJ3B4JztcblxuICAgIHRoaXMudmlld3BvcnRUcmFuc2Zvcm0gPSB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtLnNsaWNlKCk7XG4gIH0sXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKGVsLCBvcHRpb25zKSB7XG4gICAgb3B0aW9ucyA9ICBmYWJyaWMudXRpbC5vYmplY3QuZGVmYXVsdHMoZmFicmljLnV0aWwub2JqZWN0LmRlZXBFeHRlbmQob3B0aW9ucyB8fCB7fSksdGhpcy5kZWZhdWx0T3B0aW9ucyk7XG4gICAgdGhpcy5faW5pdEVudGl0eShvcHRpb25zKTtcbiAgICB0aGlzLl9pbml0U3RhdGljKGVsLCBvcHRpb25zKTtcbiAgfSxcbiAgc2V0RGF0YTogZnVuY3Rpb24gKGRhdGEpIHtcblxuICAgIGlmIChkYXRhLmNhdGVnb3J5ID09IFwiYmFja2dyb3VuZFwiKSB7XG4gICAgICB0aGlzLnNldEJhY2tncm91bmRJbWFnZShkYXRhLnNyYywgdGhpcy5yZW5kZXJBbGwuYmluZCh0aGlzKSlcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICB2YXIgaWQgPSB0aGlzLmFjdGl2ZUFyZWEgJiYgdGhpcy5hY3RpdmVBcmVhLmlkID8gXCIjXCIrdGhpcy5hY3RpdmVBcmVhLmlkIDogXCJjYW52YXNcIjtcbiAgICAgIHRoaXMuY3JlYXRlT2JqZWN0KGZhYnJpYy51dGlsLm9iamVjdC5kZWVwRXh0ZW5kKHtcbiAgICAgICAgbW92ZW1lbnRMaW1pdHM6IGlkLFxuICAgICAgICBjbGlwVG86IGlkLFxuICAgICAgICBwb3NpdGlvbjogZGF0YS5sZWZ0ID09PSB1bmRlZmluZWQgJiYgZGF0YS50b3AgPT09IHVuZGVmaW5lZCA/IFwiY2VudGVyXCIgOiBcIm1hbnVhbFwiLFxuICAgICAgICBhY3RpdmU6IHRydWVcbiAgICAgIH0sIGZhYnJpYy51dGlsLm9iamVjdC5jbG9uZShkYXRhKSkpO1xuICAgIH1cbiAgfSxcbiAgc2V0V2lkdGg6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgIHJldHVybiB0aGlzLnNldERpbWVuc2lvbnMoeyB3aWR0aDogdmFsdWUgfSwge30pO1xuICB9LFxuICBzZXRIZWlnaHQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgIHJldHVybiB0aGlzLnNldERpbWVuc2lvbnMoeyBoZWlnaHQ6IHZhbHVlIH0sIHt9KTtcbiAgfSxcbiAgLyoqXG4gICAqIEBwcml2YXRlXG4gICAqL1xuXG4gIGdldE9iamVjdEJ5SUQ6IGZ1bmN0aW9uKF9pZCl7XG4gICAgZm9yICh2YXIgbGF5ZXJOYW1lIG9mIHRoaXMuX2xheWVycykge1xuICAgICAgZm9yICh2YXIgbyBvZiB0aGlzW2xheWVyTmFtZV0pIHtcbiAgICAgICAgaWYgKG8uaWQgPT09IF9pZCkge1xuICAgICAgICAgIHJldHVybiBvO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9LFxuICAvKlxuICAgQWRkIEN1c3RvbSBPYmplY3QgVHJhbmZvcm1hdGlvbnNcbiAgICovXG4gIGdldFBvaW50ZXI6IGZ1bmN0aW9uIChlLCBpZ25vcmVab29tLCB1cHBlckNhbnZhc0VsKSB7XG4gICAgdmFyIHBvaW50ZXIgPSBfZ2V0X3BvaW50ZXJfb3ZlcndyaXR0ZW4uY2FsbCh0aGlzLCBlLCBpZ25vcmVab29tLCB1cHBlckNhbnZhc0VsKTtcbiAgICBpZiAoZS5fZ3JvdXApIHtcbiAgICAgIHJldHVybiB0aGlzLl9ub3JtYWxpemVQb2ludGVyKGUuX2dyb3VwLCBwb2ludGVyKTtcbiAgICB9XG4gICAgcmV0dXJuIHBvaW50ZXI7XG4gIH0sXG5cbiAgaGFzU3RhdGVDaGFuZ2VkOiBmYWJyaWMuT2JqZWN0LnByb3RvdHlwZS5oYXNTdGF0ZUNoYW5nZWQsXG4gIC8qKiBDcmVhdGVzIGEgYm90dG9tIGNhbnZhc1xuICAgKiBAcHJpdmF0ZVxuICAgKiBAcGFyYW0ge0hUTUxFbGVtZW50fSBbY2FudmFzRWxdXG4gICAqL1xuICBfY3JlYXRlTG93ZXJDYW52YXM6IGZ1bmN0aW9uIChjYW52YXNFbCkge1xuICAgIGlmICh0eXBlb2YgY2FudmFzRWwgPT0gXCJzdHJpbmdcIikge1xuICAgICAgdGhpcy5sb3dlckNhbnZhc0VsID0gZmFicmljLnV0aWwuZ2V0QnlJZChjYW52YXNFbCkgfHwgdGhpcy5fY3JlYXRlQ2FudmFzRWxlbWVudCgpO1xuICAgIH0gZWxzZSBpZiAoY2FudmFzRWwpIHtcbiAgICAgIHRoaXMubG93ZXJDYW52YXNFbCA9IGNhbnZhc0VsO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnZpcnR1YWwgPSB0cnVlO1xuICAgICAgdGhpcy5sb3dlckNhbnZhc0VsID0gZmFicmljLnV0aWwuY3JlYXRlQ2FudmFzRWxlbWVudCgpO1xuICAgIH1cblxuICAgIHRoaXMuX2luaXRDYW52YXNFbGVtZW50KHRoaXMubG93ZXJDYW52YXNFbCk7XG5cbiAgICBmYWJyaWMudXRpbC5hZGRDbGFzcyh0aGlzLmxvd2VyQ2FudmFzRWwsICdsb3dlci1jYW52YXMnKTtcblxuICAgIGlmICh0aGlzLmludGVyYWN0aXZlKSB7XG4gICAgICB0aGlzLl9hcHBseUNhbnZhc1N0eWxlKHRoaXMubG93ZXJDYW52YXNFbCk7XG4gICAgfVxuXG4gICAgdGhpcy5jb250ZXh0Q29udGFpbmVyID0gdGhpcy5sb3dlckNhbnZhc0VsLmdldENvbnRleHQoJzJkJyk7XG4gIH0sXG4gIGZpbmRUYXJnZXQ6IGZ1bmN0aW9uIChlLCBza2lwR3JvdXApIHtcbiAgICBpZiAodGhpcy5za2lwVGFyZ2V0RmluZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHZhciBpZ25vcmVab29tID0gdHJ1ZSxcbiAgICAgIHBvaW50ZXIgPSB0aGlzLmdldFBvaW50ZXIoZSwgaWdub3JlWm9vbSksXG4gICAgICBhY3RpdmVHcm91cCA9IHRoaXMuZ2V0QWN0aXZlR3JvdXAoKSxcbiAgICAgIGFjdGl2ZU9iamVjdCA9IHRoaXMuZ2V0QWN0aXZlT2JqZWN0KCk7XG4gICAgaWYgKGFjdGl2ZUdyb3VwICYmICFza2lwR3JvdXAgJiYgdGhpcy5fY2hlY2tUYXJnZXQocG9pbnRlciwgYWN0aXZlR3JvdXApKSB7XG4gICAgICByZXR1cm4gYWN0aXZlR3JvdXA7XG4gICAgfVxuXG4gICAgaWYgKGFjdGl2ZU9iamVjdCAmJiB0aGlzLl9jaGVja1RhcmdldChwb2ludGVyLCBhY3RpdmVPYmplY3QpKSB7XG4gICAgICAvL2FkZGVkIHZpc2Nlcm9pZFxuICAgICAgdGhpcy5fZmlyZU92ZXJPdXRFdmVudHMoYWN0aXZlT2JqZWN0LCBlKTtcbiAgICAgIHJldHVybiBhY3RpdmVPYmplY3Q7XG4gICAgfVxuXG4gICAgdGhpcy50YXJnZXRzID0gWyBdO1xuXG4gICAgdmFyIHRhcmdldCA9IHRoaXMuX3NlYXJjaFBvc3NpYmxlVGFyZ2V0cyh0aGlzLl9vYmplY3RzLCBwb2ludGVyKTtcbiAgICB0aGlzLl9maXJlT3Zlck91dEV2ZW50cyh0YXJnZXQsIGUpO1xuICAgIHJldHVybiB0YXJnZXQ7XG4gIH1cbn0pO1xuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuQ2FudmFzLnByb3RvdHlwZSxFeHRDYW52YXNNaXhpbik7XG5cblxuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9jb3JlL3N0YXRpYy1jYW52YXMuZXh0LmpzIiwiZmFicmljLkltYWdlTWl4aW4gPSB7XG4gIHNldEVsZW1lbnRGcm9tTWVudSA6IGZ1bmN0aW9uKGRhdGEpe1xuICAgIHRoaXMuc2V0RWxlbWVudChkYXRhLmltYWdlKVxuICB9LFxuICBpbml0UHJvcG9ydGluYWxTaXplIDogdHJ1ZSxcbiAgLyoqXG4gICAqIEBwcml2YXRlXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc10gT2JqZWN0IHdpdGggd2lkdGgvaGVpZ2h0IHByb3BlcnRpZXNcbiAgICovXG4gIF9zZXRXaWR0aEhlaWdodDogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgIGlmKHRoaXMuZWxlbWVudCl7XG4gICAgICB2YXIgX3NpemUgPSB0aGlzLmdldE9yaWdpbmFsU2l6ZSgpO1xuICAgIH1lbHNle1xuICAgICAgX3NpemUgPSB7fTtcbiAgICB9XG4gICAgaWYoJ3dpZHRoJyBpbiBvcHRpb25zKXtcbiAgICAgIHRoaXMud2lkdGggPSBvcHRpb25zLndpZHRoO1xuICAgIH1lbHNle1xuICAgICAgaWYoIV9zaXplLndpZHRoKXtcbiAgICAgICAgdGhpcy53aWR0aCA9IDEwMDtcbiAgICAgIH1lbHNle1xuICAgICAgICBpZih0aGlzLmluaXRQcm9wb3J0aW5hbFNpemUgJiYgJ2hlaWdodCcgaW4gb3B0aW9ucyl7XG4gICAgICAgICAgdGhpcy53aWR0aCA9IChvcHRpb25zLmhlaWdodCAgLyBfc2l6ZS5oZWlnaHQgKSAqIF9zaXplLndpZHRoO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMud2lkdGggPSBfc2l6ZS53aWR0aDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmKCdoZWlnaHQnIGluIG9wdGlvbnMpe1xuICAgICAgdGhpcy5oZWlnaHQgPSBvcHRpb25zLmhlaWdodDtcbiAgICB9ZWxzZXtcbiAgICAgIGlmKCFfc2l6ZS5oZWlnaHQpe1xuICAgICAgICB0aGlzLmhlaWdodCA9IDEwMDtcbiAgICAgIH1lbHNle1xuICAgICAgICBpZih0aGlzLmluaXRQcm9wb3J0aW5hbFNpemUgJiYgJ3dpZHRoJyBpbiBvcHRpb25zKXtcbiAgICAgICAgICB0aGlzLmhlaWdodCA9IChvcHRpb25zLndpZHRoICAvIF9zaXplLndpZHRoICkgKiBfc2l6ZS5oZWlnaHQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5oZWlnaHQgPSBfc2l6ZS5oZWlnaHQ7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbn07XG5cbmZhYnJpYy5BcHBsaWNhdGlvbi5wcm90b3R5cGUuZ2V0TGlicmFyeUVsZW1lbnRzID0gZnVuY3Rpb24ob3B0aW9ucyl7XG4gIHJldHVybiBbXTtcbn1cblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvbWl4aW5zL3Byb3BvcnRpYW5hbFNpemVNaXhpbi5qcyIsIid1c2Ugc3RyaWN0JztcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuU3RhdGljQ2FudmFzLnByb3RvdHlwZSwge1xuXG4gIG9wdGlvbnNPcmRlcjogKGZ1bmN0aW9uKCl7XG4gICAgdmFyIG9vID0gZmFicmljLlN0YXRpY0NhbnZhcy5wcm90b3R5cGUub3B0aW9uc09yZGVyO1xuICAgIG9vLnNwbGljZShvby5pbmRleE9mKFwiKlwiKSwwLFwiYXJlYXNcIixcIm9mZnNldHNcIixcImhlbHBlcnNcIik7XG4gICAgcmV0dXJuIG9vO1xuICB9KSgpLFxuICBfaGVscGVyc09iamVjdHM6IG51bGwsXG4gIF9hcmVhc09iamVjdHM6IG51bGwsXG4gIC8vb2Zmc2V0czoge2xlZnQ6IDAsIHRvcDogMCwgcmlnaHQ6IDAsIGJvdHRvbTogMH0sXG4gIF91cGRhdGVfY2xpcF9yZWN0OiBmdW5jdGlvbiAoKSB7XG4gICAgLy90b2RvXG4gICAgcmV0dXJuO1xuICAgIGlmICh0aGlzLmFyZWFzIHx8ICF0aGlzLl9hcmVhc09iamVjdHNbMF0pIHJldHVybjtcbiAgICB2YXIgZ2VvbWV0cnkgPSB0aGlzLmdldFJlY3QodGhpcy5vZmZzZXRzKTtcbiAgICB0aGlzLl9hcmVhc09iamVjdHNbMF0uc2V0KGdlb21ldHJ5KTtcbiAgfSxcbiAgLy9vZmZzZXRzOiB7bGVmdCA6IDAsdG9wIDogMCwgcmlnaHQ6IDAsIGJvdHRvbTowfSxcbiAgc2V0SGVscGVyczogZnVuY3Rpb24gKGhlbHBlcnMsIGNhbGxiYWNrKSB7XG4gICAgdGhpcy5oZWxwZXJzID0gaGVscGVycztcbiAgICB0aGlzLl9oZWxwZXJzT2JqZWN0cyA9IFtdO1xuICAgIGlmKGhlbHBlcnMpe1xuICAgICAgZm9yIChsZXQgaCBvZiBoZWxwZXJzKXtcbiAgICAgICAgZmFicmljLnV0aWwuY3JlYXRlT2JqZWN0KGgsaGVscGVyID0+IHtcbiAgICAgICAgICB0aGlzLl9oZWxwZXJzT2JqZWN0cy5wdXNoKGhlbHBlcik7XG4gICAgICAgICAgdGhpcy5yZW5kZXJBbGwoKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKCk7XG4gIH0sXG4gIHN0b3JlUHJvcGVydGllczogZmFicmljLlN0YXRpY0NhbnZhcy5wcm90b3R5cGUuc3RvcmVQcm9wZXJ0aWVzLmNvbmNhdChbXCJvZmZzZXRzXCIsXCJoZWxwZXJzXCIsXCJhcmVhc1wiXSksXG4gIGFyZWFBY3RpdmF0aW5nOiBmYWxzZSxcbiAgYWRkRWxlbWVudHNJbnNpZGVBY3RpdmVBcmVhOiBmYWxzZSxcbiAgYXJlYVByb3BlcnRpZXM6IHtcbiAgICBvcmlnaW5YOiAnbGVmdCcsXG4gICAgb3JpZ2luWTogJ3RvcCcsXG4gICAgZmlsbDogJ3RyYW5zcGFyZW50JyxcbiAgICBzdHJva2VEYXNoQXJyYXk6IFs1LCA1XSxcbiAgICBzdHJva2VXaWR0aDogMSxcbiAgICBzdHJva2U6ICdibGFjaycsXG4gICAgcmVzaXphYmxlOiB0cnVlXG4gICAgLy9zZWxlY3RhYmxlOiBmYWxzZVxuICB9LFxuICBzZXRBcmVhUHJvcGVydHk6IGZ1bmN0aW9uIChwcm9wZXJ0eSwgdmFsdWUpIHtcbiAgICB0aGlzW1wiYXJlYV9cIiArIHByb3BlcnR5XSA9IHZhbHVlO1xuICAgIGlmKHRoaXMuX29mZnNldHNPYmplY3Qpe1xuICAgICAgdGhpcy5fb2Zmc2V0c09iamVjdFtwcm9wZXJ0eV0gPSB2YWx1ZTtcbiAgICB9XG4gICAgZm9yIChsZXQgb2JqZWN0IG9mIHRoaXMuX2FyZWFzT2JqZWN0cykge1xuICAgICAgb2JqZWN0W3Byb3BlcnR5XSA9IHZhbHVlO1xuICAgIH1cbiAgICB0aGlzLnJlbmRlckFsbCgpO1xuICB9LFxuICBzZXRBY3RpdmVBcmVhOiBmdW5jdGlvbiAoYXJlYSkge1xuICAgIGlmICh0aGlzLmFjdGl2ZUFyZWEpIHtcbiAgICAgIHRoaXMuYWN0aXZlQXJlYS5zZXRTdHJva2UoXCIjMDAwXCIpO1xuICAgIH1cbiAgICB0aGlzLmFjdGl2ZUFyZWEgPSBhcmVhO1xuICAgIGlmIChhcmVhKSB7XG4gICAgICBhcmVhLnNldFN0cm9rZShcIiNCN0YxRURcIik7XG4gICAgfVxuICB9LFxuICBzZXRBcmVhQWN0aXZhdGluZzogZnVuY3Rpb24gKHZhbHVlLyosIGZvcmNlKi8pIHtcbiAgICAvL3RvZG8gZm9yY2VcbiAgICB2YXIgZm9yY2UgPSB0cnVlO1xuICAgIGlmIChmb3JjZSB8fCAodmFsdWUgJiYgIXRoaXMuYXJlYUFjdGl2YXRpbmcpKSB7XG4gICAgICB0aGlzLmFyZWFBY3RpdmF0aW5nID0gdHJ1ZTtcbiAgICAgIHRoaXMub24oXCJvYmplY3Q6bW9kaWZpZWRcIiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgaWYoIXRoaXMuX2FyZWFzT2JqZWN0cylyZXR1cm47XG4gICAgICAgIGlmKHRoaXMuZWRpdGluZ09iamVjdCl7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vdG9kbyBldmVudCEg0L3QtSDRitC+0YLQtdC7INCx0Ysg0Y3RgtC+INGC0YPRgiDQuNGB0L/QvtC70YzQvtCy0LDRgtGMLNC90L4g0YDQsNCx0L7RgtCw0LXRglxuICAgICAgICB2YXIgcG9pbnRlciA9IHRoaXMuZ2V0UG9pbnRlcihldmVudCwgdHJ1ZSk7XG4gICAgICAgIHZhciB0YXJnZXQgPSB0aGlzLl9zZWFyY2hQb3NzaWJsZVRhcmdldHModGhpcy5fYXJlYXNPYmplY3RzLCBwb2ludGVyKTtcbiAgICAgICAgaWYodGhpcy5fY3VycmVudFRyYW5zZm9ybSAmJiB0YXJnZXQgJiYgdGhpcy50YXJnZXQubW92ZW1lbnRMaW1pdHMgIT0gdGFyZ2V0KXtcbiAgICAgICAgICB0aGlzLnRhcmdldC5zZXQoe1xuICAgICAgICAgICAgbW92ZW1lbnRMaW1pdHM6IHRhcmdldCxcbiAgICAgICAgICAgIGNsaXBUbzogdGFyZ2V0XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgdGhpcy5zZXRBY3RpdmVBcmVhKHRhcmdldCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgdGhpcy5vbihcIm1vdXNlOmRvd25cIiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgaWYoIXRoaXMuX2FyZWFzT2JqZWN0cylyZXR1cm47XG4gICAgICAgIHZhciBwb2ludGVyID0gdGhpcy5nZXRQb2ludGVyKGUuZSwgdHJ1ZSk7XG4gICAgICAgIHZhciB0YXJnZXQgPSB0aGlzLl9zZWFyY2hQb3NzaWJsZVRhcmdldHModGhpcy5fYXJlYXNPYmplY3RzLCBwb2ludGVyKTtcbiAgICAgICAgaWYgKHRhcmdldCkge1xuICAgICAgICAgIHRoaXMuc2V0QWN0aXZlQXJlYSh0YXJnZXQpO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgIH1cbiAgfSxcbiAgX3VwZGF0ZV9hcmVhX2dlb21ldHJ5OiBmdW5jdGlvbihlbCxvcHRpb25zKXtcbiAgICBpZiAob3B0aW9ucy5wYXRoKSB7XG5cbiAgICAgIG9wdGlvbnMud2lkdGggPSBvcHRpb25zLndpZHRoIHx8IGVsLndpZHRoO1xuICAgICAgdmFyIGdlb21ldHJ5ID0gdGhpcy5nZXRSZWN0KG9wdGlvbnMpO1xuICAgICAgdmFyIF9zY2FsZSA9IGVsLndpZHRoIC8gZ2VvbWV0cnkud2lkdGg7XG4gICAgICBlbC5zZXQoe1xuICAgICAgICBsZWZ0OiBnZW9tZXRyeS5sZWZ0ICwvLy8qIGVsLmxlZnQgKiBfc2NhbGUqLyxcbiAgICAgICAgdG9wOiBnZW9tZXRyeS50b3AgLC8vKyBlbC50b3AgKiBfc2NhbGUsXG4gICAgICAgIHNjYWxlWDogX3NjYWxlLFxuICAgICAgICBzY2FsZVk6IF9zY2FsZVxuICAgICAgfSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHZhciBnZW9tZXRyeSA9IHRoaXMuZ2V0UmVjdChvcHRpb25zKTtcblxuICAgIGlmKG9wdGlvbnMuc3JjKXtcbiAgICAgIHZhciBfc2NhbGUgPSBnZW9tZXRyeS53aWR0aCAvIGltZy53aWR0aDtcbiAgICAgIGVsLnNldCh7XG4gICAgICAgIGxlZnQ6IGdlb21ldHJ5LmxlZnQsLy8gKyBlbC5sZWZ0ICogX3NjYWxlLFxuICAgICAgICB0b3A6IGdlb21ldHJ5LnRvcCAsLy8rIGVsLnRvcCAqIF9zY2FsZSxcbiAgICAgICAgc3Ryb2tlV2lkdGg6IHRoaXMuYXJlYVByb3BlcnRpZXMuc3Ryb2tlV2lkdGggLyBfc2NhbGUsXG4gICAgICAgIHNjYWxlWDogX3NjYWxlLFxuICAgICAgICBzY2FsZVk6IF9zY2FsZVxuICAgICAgfSk7XG4gICAgfWVsc2V7XG4gICAgICBlbC5zZXQoZ2VvbWV0cnkpO1xuICAgIH1cbiAgfSxcbiAgX3JlbmRlck92ZXJsYXlPYmplY3RzOiBmdW5jdGlvbihjdHgpe1xuICAgIGlmKHRoaXMuX29mZnNldHNPYmplY3Qpe1xuICAgICAgdGhpcy5fb2Zmc2V0c09iamVjdC5yZW5kZXIoY3R4KTtcbiAgICB9XG4gICAgaWYodGhpcy5fYXJlYXNPYmplY3RzKXtcbiAgICAgIHRoaXMuX3JlbmRlck9iamVjdHMoY3R4LCB0aGlzLl9hcmVhc09iamVjdHMpO1xuICAgIH1cbiAgICBpZih0aGlzLl9oZWxwZXJzT2JqZWN0cyl7XG4gICAgICB0aGlzLl9yZW5kZXJPYmplY3RzKGN0eCwgdGhpcy5faGVscGVyc09iamVjdHMpO1xuICAgIH1cbiAgfSxcbiAgY3JlYXRlQXJlYTogZnVuY3Rpb24gKGFyZWEsIGNhbGxiYWNrKSB7XG5cbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgdmFyIF9maW5hbGl6ZSA9IGZ1bmN0aW9uIChwYXRoLCBhcmVhKSB7XG4gICAgICBwYXRoLmlkID0gYXJlYS5pZDtcbiAgICAgIC8vXG4gICAgICAvLyBhcmVhLmluc3RhbmNlID0gcGF0aDtcbiAgICAgLy8gcGF0aC5sYXllciA9IFwiYmFja2dyb3VuZFwiO1xuICAgICAvLyB0aGlzLmFkZChwYXRoKTtcbiAgICAgIHRoaXMuX3VwZGF0ZV9hcmVhX2dlb21ldHJ5KHBhdGgsYXJlYSk7XG4gICAgICB0aGlzLl9hcmVhc09iamVjdHMucHVzaChwYXRoKTtcbiAgICAgIC8vIF90aGlzLl9iYWNrZ3JvdW5kTGF5ZXIucHVzaChwYXRoKTtcbiAgICAgIC8vIHBhdGguY2FudmFzID0gX3RoaXM7XG4gICAgICBjYWxsYmFjaygpO1xuICAgIH0uYmluZCh0aGlzKTtcblxuXG4gICAgdmFyIHBhdGgsIHJlY3RhcmVhO1xuICAgIGlmIChhcmVhLnBhdGgpIHtcbiAgICAgIHBhdGggPSBuZXcgZmFicmljLlBhdGgoYXJlYS5wYXRoLCB0aGlzLmFyZWFQcm9wZXJ0aWVzKTtcbiAgICAgIGFyZWEudG9wID0gcGF0aC50b3A7XG4gICAgICBhcmVhLmxlZnQgPSBwYXRoLmxlZnQ7XG4gICAgICBhcmVhLndpZHRoID0gcGF0aC53aWR0aDtcbiAgICAgIGFyZWEuaGVpZ2h0ID0gcGF0aC5oZWlnaHQ7XG4gICAgICBfZmluYWxpemUocGF0aCwgYXJlYSk7XG4gICAgfSBlbHNlIGlmIChhcmVhLnNyYykge1xuICAgICAgdmFyIGNsaXBGaWxsZXIgPSBuZXcgZmFicmljLlBhdGhmaW5kZXIoe30pO1xuICAgICAgZmFicmljLnV0aWwubG9hZEltYWdlKGFyZWEuc3JjLCBmdW5jdGlvbiAoaW1nKSB7XG4gICAgICAgIGNsaXBGaWxsZXIuc2V0SW1hZ2UoaW1nKTtcbiAgICAgICAgY2xpcEZpbGxlci5tYXNrID0gTWFnaWNXYW5kLnNlbGVjdEJhY2tncm91bmQoY2xpcEZpbGxlci5nZXRJbmZvKCksIG51bGwsIDE1KTtcblxuICAgICAgICB2YXIgY29udG91cnMgPSBjbGlwRmlsbGVyLmdldENvbnRvdXJzKCk7XG4gICAgICAgIHZhciBjbGlwUG9pbnRzID0gY29udG91cnNbMV0ucG9pbnRzO1xuICAgICAgICB2YXIgcGF0aERhdGEgPSBmYWJyaWMuUGVuY2lsQnJ1c2gucHJvdG90eXBlLmNvbnZlcnRQb2ludHNUb1NWR1BhdGgoY2xpcFBvaW50cykuam9pbignJyk7Ly90b2RvXG4gICAgICAgIHBhdGggPSBuZXcgZmFicmljLlBhdGgocGF0aERhdGEsIF90aGlzLmFyZWFQcm9wZXJ0aWVzKTtcblxuICAgICAgICBfZmluYWxpemUocGF0aCwgYXJlYSk7XG4gICAgICB9KTtcblxuICAgIH0gZWxzZSB7XG4gICAgICBwYXRoID0gbmV3IGZhYnJpYy5SZWN0KHRoaXMuYXJlYVByb3BlcnRpZXMpO1xuICAgICAgX2ZpbmFsaXplKHBhdGgsIGFyZWEpO1xuICAgIH1cblxuICAgIGlmKCggYXJlYS5yaWdodCB8fCBhcmVhLmJvdHRvbSB8fCBhcmVhLnBhdGggKSAmJiAoIXRoaXMub3JpZ2luYWxXaWR0aCAgfHwgIXRoaXMub3JpZ2luYWxIZWlnaHQpICl7XG4gICAgICB0aGlzLm9uKFwiYmFja2dyb3VuZC1pbWFnZTpsb2FkZWRcIixmdW5jdGlvbigpe1xuICAgICAgICB0aGlzLl91cGRhdGVfYXJlYV9nZW9tZXRyeShwYXRoLGFyZWEpO1xuICAgICAgICB0aGlzLnJlbmRlckFsbCgpO1xuICAgICAgfS5iaW5kKHRoaXMpKVxuICAgIH1cblxuICAgIC8qXG4gICAgIGFwcC5jYW52YXMuc2V0T2Zmc2V0cyh7XG4gICAgIHJpZ2h0OiAgMSxcbiAgICAgbGVmdDogICAxLFxuICAgICB0b3A6ICAgIDEsXG4gICAgIGJvdHRvbTogMVxuICAgICB9KTtcblxuXG4gICAgIGFwcC5jYW52YXMuY2xpcFRvID0gZnVuY3Rpb24gKGN0eCkge1xuICAgICB2YXIgem9vbSA9IGFwcC5jYW52YXNfY29uZmlnLndpZHRoIC8gYXBwLmNhbnZhcy5iYWNrZ3JvdW5kSW1hZ2UuZmlsdGVyc1swXS5wYXRoZmluZGVyLm1hc2sud2lkdGg7XG4gICAgIGN0eC5zYXZlKCk7XG4gICAgIGN0eC5zY2FsZSh6b29tLCB6b29tKTtcbiAgICAgYXBwLmNsaXBGaWxsZXIudHJhY2VJbm5lcihjdHgpO1xuICAgICBjdHgucmVzdG9yZSgpO1xuICAgICB9OyovXG4gIH0sXG4gIHJlbW92ZUFyZWE6IGZ1bmN0aW9uIChhcmVhKSB7XG4vKlxuICAgIHZhciBvYmpzID0gdGhpcy5nZXRPYmplY3RzKCk7XG4gICAgZm9yICh2YXIgaSBpbiBvYmpzKSB7XG4gICAgICBpZiAob2Jqc1tpXS5tb3ZlbWVudExpbWl0cyA9PT0gYXJlYSkge1xuICAgICAgICBkZWxldGUgb2Jqc1tpXS5tb3ZlbWVudExpbWl0cztcbiAgICAgIH1cbiAgICAgIGlmIChvYmpzW2ldLmNsaXBUbyA9PT0gYXJlYSkge1xuICAgICAgICAvL2lmKG9ianNbaV0ub2xjQ2xpcFRvSUQpe1xuICAgICAgICAvLyAgICBvYmpzW2ldLmNsaXBUb0lEID0gb2Jqc1tpXS5vbGRDbGlwVG9JRDtcbiAgICAgICAgLy99XG4gICAgICAgIGRlbGV0ZSBvYmpzW2ldLmNsaXBUbztcbiAgICAgICAgLy9vYmpzW2ldLm9sY0NsaXBUb0lEID0gYXJlYS5pZDtcbiAgICAgIH1cbiAgICB9XG4gICAgYXJlYS5yZW1vdmUoKTsqL1xuICB9LFxuICAvKipcbiAgICpcbiAgICogQHBhcmFtIG9mZnNldHMgOiB7dG9wOiBudW1iZXIsIHJpZ2h0OiBudW1iZXIsIGJvdHRvbTogbnVtYmVyLCBsZWZ0OiBudW1iZXJ9IHwgbnVtYmVyIHwgWz9udW1iZXIsP251bWJlciw/bnVtYmVyLD9udW1iZXJdXG4gICAqIEBwYXJhbSBjYWxsYmFja1xuICAgKi9cbiAgc2V0T2Zmc2V0czogZnVuY3Rpb24gKG9mZnNldHMpIHtcbiAgICBpZihvZmZzZXRzID09PSBudWxsICl7XG4gICAgICB0aGlzLm9mZnNldHMgPSB7dG9wOiAwLCByaWdodDogMCwgYm90dG9tOiAwLCBsZWZ0OiAwfTtcbiAgICB9ZWxzZSBpZiAob2Zmc2V0cy5jb25zdHJ1Y3RvciA9PT0gTnVtYmVyKSB7XG4gICAgICB0aGlzLm9mZnNldHMgPSB7dG9wOiBvZmZzZXRzLCByaWdodDogb2Zmc2V0cywgYm90dG9tOiBvZmZzZXRzLCBsZWZ0OiBvZmZzZXRzfTtcbiAgICB9ZWxzZSBpZiAob2Zmc2V0cy5jb25zdHJ1Y3RvciA9PT0gQXJyYXkpIHtcbiAgICAgIHN3aXRjaChvZmZzZXRzLmxlbmd0aCl7XG4gICAgICAgIGNhc2UgMDogdGhpcy5vZmZzZXRzID0ge3RvcDogMCwgcmlnaHQ6IDAsIGJvdHRvbTogMCwgbGVmdDogMH07IGJyZWFrO1xuICAgICAgICBjYXNlIDE6IHRoaXMub2Zmc2V0cyA9IHt0b3A6IG9mZnNldHNbMF0sIHJpZ2h0OiBvZmZzZXRzWzBdLCBib3R0b206IG9mZnNldHNbMF0sIGxlZnQ6IG9mZnNldHNbMF19OyBicmVhaztcbiAgICAgICAgY2FzZSAyOiB0aGlzLm9mZnNldHMgPSB7dG9wOiBvZmZzZXRzWzBdLCByaWdodDogb2Zmc2V0c1sxXSwgYm90dG9tOiBvZmZzZXRzWzBdLCBsZWZ0OiBvZmZzZXRzWzFdfTsgYnJlYWs7XG4gICAgICAgIGNhc2UgMzogdGhpcy5vZmZzZXRzID0ge3RvcDogb2Zmc2V0c1swXSwgcmlnaHQ6IG9mZnNldHNbMV0sIGJvdHRvbTogb2Zmc2V0c1syXSwgbGVmdDogb2Zmc2V0c1sxXX07IGJyZWFrO1xuICAgICAgICBjYXNlIDQ6IHRoaXMub2Zmc2V0cyA9IHt0b3A6IG9mZnNldHNbMF0sIHJpZ2h0OiBvZmZzZXRzWzFdLCBib3R0b206IG9mZnNldHNbMl0sIGxlZnQ6IG9mZnNldHNbM119OyBicmVhaztcbiAgICAgIH1cbiAgICB9ZWxzZXtcbiAgICAgIHRoaXMub2Zmc2V0cyA9IG9mZnNldHM7XG4gICAgfVxuXG5cbiAgICBpZih0aGlzLm9mZnNldHMudG9wIHx8IHRoaXMub2Zmc2V0cy5ib3R0b20gfHwgdGhpcy5vZmZzZXRzLmxlZnQgfHwgdGhpcy5vZmZzZXRzLnJpZ2h0KXtcblxuICAgICAgdGhpcy5fb2Zmc2V0c09iamVjdCA9IG5ldyBmYWJyaWMuUmVjdCh0aGlzLm9mZnNldHMpO1xuICAgICAgdGhpcy5fb2Zmc2V0c09iamVjdC5zZXQodGhpcy5hcmVhUHJvcGVydGllcyk7XG4gICAgICB0aGlzLl91cGRhdGVfYXJlYV9nZW9tZXRyeSh0aGlzLl9vZmZzZXRzT2JqZWN0LHRoaXMub2Zmc2V0cyk7XG4gICAgICBpZiAodGhpcy5hcmVhQWN0aXZhdGluZykge1xuICAgICAgICB0aGlzLnNldEFjdGl2ZUFyZWEodGhpcy5fb2Zmc2V0c09iamVjdCB8fCBudWxsKTtcbiAgICAgIH1cbiAgICB9ZWxzZXtcbiAgICAgIHRoaXMuX29mZnNldHNPYmplY3QgPSBudWxsO1xuICAgIH1cblxuXG5cbiAgICB0aGlzLnJlbmRlckFsbCgpO1xuICB9LFxuICBzZXRBcmVhczogZnVuY3Rpb24gKGFyZWFzLCBjYWxsYmFjaykge1xuICAgIHRoaXMuX2FyZWFzT2JqZWN0cyA9IFtdO1xuICAgIGFyZWFzID0gYXJlYXMgfHwgW107XG4gICAgaWYgKHRoaXMuYXJlYXMpIHtcbiAgICAgIGZvciAodmFyIGkgPSB0aGlzLmFyZWFzLmxlbmd0aDsgaS0tOykge1xuICAgICAgICB0aGlzLnJlbW92ZUFyZWEodGhpcy5hcmVhc1tpXS5pbnN0YW5jZSk7XG4gICAgICB9XG4gICAgfVxuICAgIHRoaXMuYXJlYXMgPSBhcmVhcztcblxuICAgIHZhciBjYiA9IGZhYnJpYy51dGlsLnF1ZXVlTG9hZChhcmVhcy5sZW5ndGggKyAxLCBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAodGhpcy5hcmVhQWN0aXZhdGluZykge1xuICAgICAgICB0aGlzLnNldEFjdGl2ZUFyZWEodGhpcy5fYXJlYXNPYmplY3RzWzBdIHx8IG51bGwpO1xuICAgICAgfVxuXG4gICAgIC8qIHZhciBvYmpzID0gdGhpcy5nZXRPYmplY3RzKCk7XG4vL3dvcmsgd2l0aCBvYmplY3RcbiAgICAgIGlmICghYXJlYXMubGVuZ3RoKSB7XG4gICAgICAgIG9ianMubGVuZ3RoICYmIHRoaXMuY2xlYXIoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8qIHRvZG8gOiDQv9GA0LjQvNC10L3QuNGC0Ywg0YLQtdC60YPRidGD0Y4g0LfQvtC90YMg0LrQviDQstGB0LXQvCDQvtCx0YrQtdC60YLQsNC8XG4gICAgICAgICB2YXIgX2FyZWEgPSB0aGlzLmFjdGl2ZUFyZWEgfHwgdGhpcy5sYXllcnMuYmFja2dyb3VuZC5vYmplY3RzWzBdO1xuICAgICAgICAgZm9yICh2YXIgaSBpbiBvYmpzKSB7XG4gICAgICAgICB2YXIgb2JqID0gb2Jqc1tpXTtcbiAgICAgICAgIG9iai5jbGlwVG8gPSBfYXJlYTtcbiAgICAgICAgIG9iai5zZXRNb3ZlbWVudExpbWl0cyhfYXJlYSk7XG4gICAgICAgICBvYmouc2V0Q29vcmRzKCk7XG4gICAgICAgICB9Ki9cbiAgICAgIC8vfSovXG4gICAgICBjYWxsYmFjayAmJiBjYWxsYmFjay5jYWxsKHRoaXMpO1xuICAgIH0uYmluZCh0aGlzKSk7XG5cbiAgICBmb3IgKHZhciBpIGluIGFyZWFzKSB7XG4gICAgICBpZiAoIWFyZWFzW2ldLmlkKSB7XG4gICAgICAgIGFyZWFzW2ldLmlkID0gXCJfX1wiICsgaTtcbiAgICAgIH1cbiAgICAgIHRoaXMuY3JlYXRlQXJlYShhcmVhc1tpXSwgY2IpO1xuICAgIH1cbiAgICBjYigpO1xuXG4gICAgdGhpcy5yZW5kZXJBbGwoKTtcbiAgfVxufSk7XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLlNsaWRlQ2FudmFzLnByb3RvdHlwZSwge1xuICBkZWZhdWx0T3B0aW9uczogZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuU2xpZGVDYW52YXMucHJvdG90eXBlLmRlZmF1bHRPcHRpb25zLHtcbiAgICAvL29mZnNldHM6IHtsZWZ0IDogMCx0b3AgOiAwLCByaWdodDogMCwgYm90dG9tOjB9XG4gIH0pLFxuICBldmVudExpc3RlbmVyczogZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZEFycmF5c09iamVjdChmYWJyaWMuU2xpZGVDYW52YXMucHJvdG90eXBlLmV2ZW50TGlzdGVuZXJzLCB7XG4gICAgXCJiZWZvcmU6ZHJvcFwiOiBmdW5jdGlvbihlKXtcbiAgICAgIC8vdG9kbztcbiAgICAgIGlmKCF0aGlzLl9iYWNrZ3JvdW5kTGF5ZXIpe1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB2YXIgcG9pbnRlciA9IHRoaXMuZ2V0UG9pbnRlcihlLm9yaWdpbmFsRXZlbnQsIHRydWUpO1xuICAgICAgdmFyIHRhcmdldCA9IHRoaXMuX3NlYXJjaFBvc3NpYmxlVGFyZ2V0cyh0aGlzLl9iYWNrZ3JvdW5kTGF5ZXIsIHBvaW50ZXIpO1xuICAgICAgaWYgKHRhcmdldCkge1xuICAgICAgICB0aGlzLnNldEFjdGl2ZUFyZWEodGFyZ2V0KTtcbiAgICAgICAgZS5kYXRhLmNsaXBUbyA9IFwiI1wiICsgdGFyZ2V0LmlkO1xuICAgICAgICBlLmRhdGEubW92ZW1lbnRMaW1pdHMgPSBcIiNcIiArIHRhcmdldC5pZDtcbiAgICAgIH1cbiAgICB9XG4gIH0pXG59KVxuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9tb2R1bGVzL3NsaWRlLmFyZWFzLmpzIiwibW9kdWxlLmV4cG9ydHMgPSAkO1xuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIGV4dGVybmFsIFwiJFwiXG4vLyBtb2R1bGUgaWQgPSA5XG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIid1c2Ugc3RyaWN0JztcblxuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5DYW52YXMucHJvdG90eXBlLCB7XG4gIC8vIGVuYWJsZUNsaXBBcmVhWm9vbWluZzogZnVuY3Rpb24oKXtcbiAgLy90b2RvXG4gIC8vIHRoaXMub24oJ3ZpZXdwb3J0OnNjYWxlZCcsIGZ1bmN0aW9uKCl7XG4gIC8vICAgaWYgKCF0aGlzLmxheWVyKFwiYmFja2dyb3VuZFwiKS5vYmplY3RzKSByZXR1cm47XG4gIC8vICAgdGhpcy5fYmFja2dyb3VuZExheWVyWzBdLnNldENvb3JkcygpO1xuICAvLyB9KTtcbiAgLy8gfSxcbiAgX2ZhYnJpY19jbGlwX2Z1bmN0aW9uOiBmdW5jdGlvbiAoY3R4Mikge1xuXG4gICAgdmFyIGNsaXBSZWN0ID0gdGhpcy5jbGlwUmVjdDtcbiAgICBjdHgyLnNhdmUoKTtcbiAgICBjbGlwUmVjdC5yZW5kZXIoY3R4Mik7XG4gICAgY3R4Mi5yZXN0b3JlKCk7XG5cbiAgfVxufSk7XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLk9iamVjdC5wcm90b3R5cGUsIHtcbiAgc2V0Q2xpcFRvOiBmdW5jdGlvbiAodmFsKSB7XG4gICAgdGhpcy5jbGlwVG8gPSB2YWw7XG5cblxuICAgIGlmICh0eXBlb2YgdmFsICE9PSAnc3RyaW5nJykge1xuICAgICAgdGhpcy5fY2xpcFRvID0gdmFsO1xuICAgIH1cblxuICAgIHZhciBmdW5jdGlvbkJvZHkgPSBmYWJyaWMudXRpbC5nZXRGdW5jdGlvbkJvZHkodmFsKTtcbiAgICBpZiAodHlwZW9mIGZ1bmN0aW9uQm9keSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIHRoaXMuX2NsaXBUbyA9IG5ldyBGdW5jdGlvbignY3R4JywgZnVuY3Rpb25Cb2R5KTtcbiAgICB9XG4gIH0sXG4gIF9pbml0Q2xpcHBpbmc6IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgaWYgKCFvcHRpb25zLl9jbGlwVG8pIHt4YGBcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB2YXIgZnVuY3Rpb25Cb2R5ID0gZmFicmljLnV0aWwuZ2V0RnVuY3Rpb25Cb2R5KG9wdGlvbnMuY2xpcFRvKTtcbiAgICBpZiAodHlwZW9mIGZ1bmN0aW9uQm9keSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIHRoaXMuX2NsaXBUbyA9IG5ldyBGdW5jdGlvbignY3R4JywgZnVuY3Rpb25Cb2R5KTtcbiAgICB9XG4gIH1cbn0pO1xuXG5mYWJyaWMudXRpbC5jbGlwQ29udGV4dCA9IGZ1bmN0aW9uIChyZWNlaXZlciwgY3R4KSB7XG4gIGlmICghcmVjZWl2ZXIuX2NsaXBUbykge1xuICAgIGlmIChyZWNlaXZlci5jbGlwVG8gPT09IFwiY2FudmFzXCIpIHtcbiAgICAgIHJlY2VpdmVyLl9jbGlwVG8gPSByZWNlaXZlci5jYW52YXM7XG4gICAgfVxuICAgIGVsc2V7XG5cbiAgICAgIHZhciBfaWQgPSByZWNlaXZlci5jbGlwVG8uc3Vic3RyaW5nKDEpO1xuXG4gICAgICB2YXIgX2NsaXBDdHggPSByZWNlaXZlci5jYW52YXMuZ2V0T2JqZWN0QnlJRChfaWQpO1xuICAgICAgaWYoX2NsaXBDdHgpe1xuICAgICAgICByZWNlaXZlci5jbGlwVG8gPSBfY2xpcEN0eDtcbiAgICAgIH1lbHNle1xuICAgICAgICBjb25zb2xlLndhcm4oXCJlcnJvcjogY2xpcFRvIG5vdCBmb3VuZFwiICsgcmVjZWl2ZXIuY2xpcFRvKTtcbiAgICAgICAgZGVsZXRlIHJlY2VpdmVyLmNsaXBUbztcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgIH1cblxuICB9XG5cbiAgY3R4LnNhdmUoKTtcbiAgY3R4LmJlZ2luUGF0aCgpO1xuXG4gIGlmIChyZWNlaXZlci5fY2xpcFRvLmNvbnN0cnVjdG9yID09PSBGdW5jdGlvbikge1xuICAgIHJlY2VpdmVyLl9jbGlwVG8oY3R4KTtcbiAgfSBlbHNlIHtcbiAgICBmYWJyaWMudXRpbC5fY2xpcFRvT2JqZWN0KHJlY2VpdmVyLCBjdHgpO1xuICAgIGN0eC5jbGlwKCk7XG4gIH1cblxufTtcblxuZmFicmljLnV0aWwuX2NsaXBUb09iamVjdCA9IGZ1bmN0aW9uIChyZWNlaXZlciwgY3R4KSB7XG4gIGN0eC5zYXZlKCk7XG4gIGN0eC5iZWdpblBhdGgoKTtcblxuICB2YXIgZnJvbUxlZnQgPSBmYWxzZTtcbiAgdmFyIGNlbnRlciA9IGZyb21MZWZ0ID8gcmVjZWl2ZXIuX2dldExlZnRUb3BDb29yZHMoKSA6IHJlY2VpdmVyLmdldENlbnRlclBvaW50KCk7XG4gIGN0eC50cmFuc2Zvcm0oMSwgTWF0aC50YW4oZmFicmljLnV0aWwuZGVncmVlc1RvUmFkaWFucygtcmVjZWl2ZXIuc2tld1kpKSwgMCwgMSwgMCwgMCk7XG4gIGN0eC50cmFuc2Zvcm0oMSwgMCwgTWF0aC50YW4oZmFicmljLnV0aWwuZGVncmVlc1RvUmFkaWFucygtcmVjZWl2ZXIuc2tld1gpKSwgMSwgMCwgMCk7XG4gIGN0eC5zY2FsZShcbiAgICAoMSAvIHJlY2VpdmVyLnNjYWxlWCkgKiAocmVjZWl2ZXIuZmxpcFggPyAtMSA6IDEpLFxuICAgICgxIC8gcmVjZWl2ZXIuc2NhbGVZKSAqIChyZWNlaXZlci5mbGlwWSA/IC0xIDogMSlcbiAgKTtcbiAgY3R4LnJvdGF0ZShmYWJyaWMudXRpbC5kZWdyZWVzVG9SYWRpYW5zKC1yZWNlaXZlci5hbmdsZSkpO1xuICBjdHgudHJhbnNsYXRlKC1jZW50ZXIueCwgLWNlbnRlci55KTtcblxuICB2YXIgY2xpcE9iamVjdCA9IHJlY2VpdmVyLl9jbGlwVG87XG5cbiAgaWYgKGNsaXBPYmplY3QucG9pbnRzKSB7XG4gICAgdmFyIHBzID0gY2xpcE9iamVjdC5wb2ludHM7XG4gICAgY3R4Lm1vdmVUbyhwc1swXS54LCBwc1swXS55KTtcbiAgICBmb3IgKHZhciBqID0gMTsgaiA8IHBzLmxlbmd0aDsgaisrKSB7XG4gICAgICBjdHgubGluZVRvKHBzW2pdLngsIHBzW2pdLnkpO1xuICAgIH1cbiAgICAvL2N0eC5zdHJva2UoKTtcbiAgfSBlbHNlIGlmIChjbGlwT2JqZWN0LnR5cGUgPT0gXCJwYXRoXCIpIHtcblxuICAgIGN0eC5nbG9iYWxBbHBoYSA9IDA7XG4gICAgY2xpcE9iamVjdC50cmFuc2Zvcm0oY3R4KTtcbiAgICBjbGlwT2JqZWN0Ll9yZW5kZXIoY3R4KTtcblxuICAgIC8vdG9kbyDQvtGH0LXQvdGMINC/0LvQvtGF0L4uINC40LfQvdCw0YfQsNC70YzQvdC+INC+0LHRitC10LrRgtGLINC40LzQtdGO0YIg0LrQu9C40L8g0Log0YHQu9Cw0LnQtNGDINGB0YLQsNGC0LjRh9C90L7QvNGDLiDQvdC+INC/0L7RgtC+0Lwg0Log0LrQsNC90LLQsNGB0YMg0LTQuNC90LDQvNC40YfQtdGB0LrQvtC80YMuINC90LXRhdC+0YDQvtGI0L5cbiAgfSBlbHNlIGlmIChjbGlwT2JqZWN0LnR5cGUgPT0gXCJzbGlkZVwiIHx8IGNsaXBPYmplY3QudHlwZSA9PSBcImNhbnZhc1wiKSB7XG4gICAgdmFyIG8gPSBjbGlwT2JqZWN0Lm9mZnNldHM7XG4gICAgY3R4LnJlY3Qoby5sZWZ0LG8udG9wLCBjbGlwT2JqZWN0LndpZHRoIC0gby5sZWZ0IC0gby5yaWdodCwgY2xpcE9iamVjdC5oZWlnaHQgLSBvLnRvcCAtIG8uYm90dG9tKTtcbiAgfWVsc2Uge1xuICAgIGN0eC50cmFuc2xhdGUoY2xpcE9iamVjdC5sZWZ0LCBjbGlwT2JqZWN0LnRvcCk7XG4gICAgY3R4LnJvdGF0ZSgtKGNsaXBPYmplY3QuYW5nbGUgKiAtMSkgKiBNYXRoLlBJIC8gMTgwKTtcbiAgICBjdHgucmVjdCgwLDAsIGNsaXBPYmplY3Qud2lkdGgsIGNsaXBPYmplY3QuaGVpZ2h0KTtcbiAgfVxuXG4gIGN0eC5jbG9zZVBhdGgoKTtcbiAgY3R4LnJlc3RvcmUoKTtcbn07XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL21vZHVsZXMvY2xpcFRvLmpzIiwiLy8gTWFnaWMgV2FuZCAoRnV6enkgU2VsZWN0aW9uIFRvb2wpIGZvciBKYXZhc2NyaXB0XG4vL1xuLy8gVGhlIE1JVCBMaWNlbnNlIChNSVQpXG4vL1xuLy8gQ29weXJpZ2h0IChjKSAyMDE0LCBSeWFzbm95IFBhdWwgKHJ5YXNub3lwYXVsQGdtYWlsLmNvbSlcbi8vXG4vLyBQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XG4vLyBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkIGRvY3VtZW50YXRpb24gZmlsZXMgKHRoZSBcIlNvZnR3YXJlXCIpLCB0byBkZWFsXG4vLyBpbiB0aGUgU29mdHdhcmUgd2l0aG91dCByZXN0cmljdGlvbiwgaW5jbHVkaW5nIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzXG4vLyB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsXG4vLyBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXNcbi8vIGZ1cm5pc2hlZCB0byBkbyBzbywgc3ViamVjdCB0byB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6XG4vL1xuLy8gVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW5cbi8vIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxuLy9cbi8vIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsIEVYUFJFU1MgT1Jcbi8vIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZLFxuLy8gRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFXG4vLyBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZIENMQUlNLCBEQU1BR0VTIE9SIE9USEVSXG4vLyBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLFxuLy8gT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTlxuLy8gVEhFIFNPRlRXQVJFLlxuXG52YXIgTWFnaWNXYW5kID0gKGZ1bmN0aW9uICgpIHtcbiAgdmFyIGxpYiA9IHt9O1xuICAvL3ZhciBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpO1xuICAvL3ZhciBjb250ZXh0ID0gY2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcblxuICBmdW5jdGlvbiBjcmVhdGVDYW52YXNFbGVtZW50KCl7XG4gICAgaWYodHlwZW9mIENhbnZhcyAhPT0gXCJ1bmRlZmluZWRcIil7XG4gICAgICByZXR1cm4gbmV3IENhbnZhcztcbiAgICB9XG4gICAgcmV0dXJuIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIik7XG4gIH1cblxuICBmdW5jdGlvbiBTZWxlY3Rpb25NYXNrKHcsaCxkYXRhKXtcbiAgICBpZihhcmd1bWVudHMubGVuZ3RoID09IDEpe1xuICAgICAgZm9yKHZhciBpIGluIGFyZ3VtZW50c1swXSApe1xuICAgICAgICB0aGlzW2ldID0gYXJndW1lbnRzWzBdW2ldO1xuICAgICAgfVxuICAgIH1lbHNle1xuICAgICAgdGhpcy5kYXRhID0gbmV3IFVpbnQ4QXJyYXkoZGF0YSB8fCB3ICogaCk7XG4gICAgICB0aGlzLndpZHRoICA9IHc7XG4gICAgICB0aGlzLmhlaWdodCA9IGg7XG4gICAgICB0aGlzLmNvdW50ICA9IDA7XG4gICAgICB0aGlzLmJvdW5kcyA9IHtcbiAgICAgICBtaW5YOiBJbmZpbml0eSxcbiAgICAgICBtaW5ZOiBJbmZpbml0eSxcbiAgICAgICBtYXhZOiAtMSxcbiAgICAgICBtYXhYOiAtMVxuICAgICAgfTtcbiAgICAgIC8vIHRoaXMuYm91bmRzID0ge1xuICAgICAgLy8gICBtaW5YOiAwLFxuICAgICAgLy8gICBtaW5ZOiAwLFxuICAgICAgLy8gICBtYXhZOiBoLFxuICAgICAgLy8gICBtYXhYOiB3XG4gICAgICAvLyB9O1xuICAgIH1cbiAgfVxuICBsaWIuU2VsZWN0aW9uTWFzayA9IFNlbGVjdGlvbk1hc2s7XG5cblxuICBTZWxlY3Rpb25NYXNrLnByb3RvdHlwZS5kZWJ1ZyA9IGZ1bmN0aW9uKCl7XG4gICAgdmFyIGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIik7XG4gICAgY2FudmFzLndpZHRoID0gdGhpcy53aWR0aDtcbiAgICBjYW52YXMuaGVpZ2h0ID0gdGhpcy5oZWlnaHQ7XG4gICAgdmFyIGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xuICAgIHRoaXMucmVuZGVyKGN0eCx7XG4gICAgICBmaWxsIDogXCIjZmZmXCIsXG4gICAgICBvdXRlckZpbGwgOiBcIiMwMDBcIlxuICAgIH0pO1xuICAgIGN0eC5kZWJ1ZygpO1xuICB9O1xuXG4gIFNlbGVjdGlvbk1hc2sucHJvdG90eXBlLm1ha2VDYWNoZSA9IGZ1bmN0aW9uKG9wdGlvbnMgKXtcbiAgICB0aGlzLmNhY2hlID0gY3JlYXRlQ2FudmFzRWxlbWVudCgpO1xuICAgIHRoaXMuY2FjaGUud2lkdGggPSB0aGlzLmJvdW5kcy5tYXhYLSB0aGlzLmJvdW5kcy5taW5YICsgMTtcbiAgICB0aGlzLmNhY2hlLmhlaWdodCA9IHRoaXMuYm91bmRzLm1heFktIHRoaXMuYm91bmRzLm1pblkgKyAxO1xuICAgIHRoaXMuY29udGV4dCA9IHRoaXMuY2FjaGUuZ2V0Q29udGV4dCgnMmQnKTtcblxuICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9XG4gICAgdGhpcy5yZW5kZXIodGhpcy5jb250ZXh0LHtcbiAgICAgIGZpbGwgOiBcIiNmZmZcIixcbiAgICAgIG91dGVyRmlsbCA6IFwiIzAwMFwiLFxuICAgICAgY2FjaGU6IGZhbHNlLFxuICAgICAgbGVmdCA6LXRoaXMuYm91bmRzLm1pblgsXG4gICAgICB0b3AgOi10aGlzLmJvdW5kcy5taW5ZXG4gICAgfSk7XG5cbiAgfTtcblxuICBTZWxlY3Rpb25NYXNrLnByb3RvdHlwZS5hZGQgPSBmdW5jdGlvbiAobWFzaykge1xuICAgIHZhciBpbmRleCwgeCwgeTtcbiAgICBmb3IgKHggPSBtYXNrLmJvdW5kcy5taW5YOyB4IDw9IG1hc2suYm91bmRzLm1heFg7IHgrKykge1xuICAgICAgZm9yICh5ID0gbWFzay5ib3VuZHMubWluWTsgeSA8PSBtYXNrLmJvdW5kcy5tYXhZOyB5KyspIHtcbiAgICAgICAgaW5kZXggPSBtYXNrLndpZHRoICogeSArIHg7XG4gICAgICAgIGlmICggbWFzay5kYXRhW2luZGV4XSAmJiAhdGhpcy5kYXRhW2luZGV4XSl7XG4gICAgICAgICAgdGhpcy5kYXRhW2luZGV4XSA9IDE7XG4gICAgICAgICAgdGhpcy5jb3VudCsrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5ib3VuZHMubWluWCA9IE1hdGgubWluKG1hc2suYm91bmRzLm1pblgsIHRoaXMuYm91bmRzLm1pblgpO1xuICAgIHRoaXMuYm91bmRzLm1heFggPSBNYXRoLm1heChtYXNrLmJvdW5kcy5tYXhYLCB0aGlzLmJvdW5kcy5tYXhYKTtcbiAgICB0aGlzLmJvdW5kcy5taW5ZID0gTWF0aC5taW4obWFzay5ib3VuZHMubWluWSwgdGhpcy5ib3VuZHMubWluWSk7XG4gICAgdGhpcy5ib3VuZHMubWF4WSA9IE1hdGgubWF4KG1hc2suYm91bmRzLm1heFksIHRoaXMuYm91bmRzLm1heFkpO1xuICB9O1xuICBmdW5jdGlvbiBoZXhUb1JnYihoZXgpIHtcbiAgICAvLyBFeHBhbmQgc2hvcnRoYW5kIGZvcm0gKGUuZy4gXCIwM0ZcIikgdG8gZnVsbCBmb3JtIChlLmcuIFwiMDAzM0ZGXCIpXG4gICAgdmFyIHNob3J0aGFuZFJlZ2V4ID0gL14jPyhbYS1mXFxkXSkoW2EtZlxcZF0pKFthLWZcXGRdKSQvaTtcbiAgICBoZXggPSBoZXgucmVwbGFjZShzaG9ydGhhbmRSZWdleCwgZnVuY3Rpb24obSwgciwgZywgYikge1xuICAgICAgcmV0dXJuIHIgKyByICsgZyArIGcgKyBiICsgYjtcbiAgICB9KTtcblxuICAgIHZhciByZXN1bHQgPSAvXiM/KFthLWZcXGRdezJ9KShbYS1mXFxkXXsyfSkoW2EtZlxcZF17Mn0pJC9pLmV4ZWMoaGV4KTtcbiAgICByZXR1cm4gcmVzdWx0ID8ge1xuICAgICAgcjogcGFyc2VJbnQocmVzdWx0WzFdLCAxNiksXG4gICAgICBnOiBwYXJzZUludChyZXN1bHRbMl0sIDE2KSxcbiAgICAgIGI6IHBhcnNlSW50KHJlc3VsdFszXSwgMTYpXG4gICAgfSA6IG51bGw7XG4gIH1cblxuICBTZWxlY3Rpb25NYXNrLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbihjdHgsb3B0aW9ucyApe1xuICAgIGlmKCF0aGlzLmNvdW50KXJldHVybjtcblxuICAgIG9wdGlvbnMgICAgICAgICAgICAgPSBvcHRpb25zICAgICAgICAgICAgIHx8IHt9O1xuICAgIG9wdGlvbnMubGVmdCAgICAgICAgPSBvcHRpb25zLmxlZnQgICAgICAgIHx8IDAgO1xuICAgIG9wdGlvbnMudG9wICAgICAgICAgPSBvcHRpb25zLnRvcCAgICAgICAgIHx8IDAgO1xuICAgIG9wdGlvbnMuZmlsbCAgICAgICAgPSBvcHRpb25zLmZpbGwgICAgICAgIHx8IGZhbHNlIDsvLyBbMCwwLDAsMF07XG4gICAgb3B0aW9ucy5pbnRlcnNlY3Rpb25Db2xvciA9IG9wdGlvbnMuaW50ZXJzZWN0aW9uQ29sb3IgfHxmYWxzZSA7Ly8gIFswLDAsMCwwXTtcblxuICAgIG9wdGlvbnMub3V0ZXJGaWxsICAgICAgICA9IG9wdGlvbnMub3V0ZXJGaWxsICAgICAgICB8fCBmYWxzZSA7Ly8gWzAsMCwwLDBdO1xuICAgIG9wdGlvbnMub3V0ZXJJbnRlcnNlY3Rpb25Db2xvciA9IG9wdGlvbnMub3V0ZXJJbnRlcnNlY3Rpb25Db2xvciB8fGZhbHNlIDsvLyAgWzAsMCwwLDBdO1xuXG4gICAgLy9pZih0aGlzLmNhY2hlICYmIG9wdGlvbnMuY2FjaGUgIT09IGZhbHNlKXtcbiAgICAvL1xuICAgIC8vICB2YXIgX2N0eCA9IHRoaXMuY29udGV4dDtcbiAgICAvLyAgX2N0eC5zYXZlKCk7XG4gICAgLy8gIF9jdHguZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uPVwic291cmNlLWluXCI7XG4gICAgLy8gIF9jdHguZmlsbFN0eWxlPSBvcHRpb25zLmZpbGw7XG4gICAgLy8gIF9jdHguZmlsbFJlY3QoMCwwLHRoaXMuY2FjaGUud2lkdGgsdGhpcy5jYWNoZS5oZWlnaHQpO1xuICAgIC8vICBfY3R4LnJlc3RvcmUoKTtcbiAgICAvL1xuICAgIC8vICBjdHguc2F2ZSgpO1xuICAgIC8vICBjdHguZ2xvYmFsQWxwaGEgPSBvcHRpb25zLm9wYWNpdHk7XG4gICAgLy8gIGN0eC5kcmF3SW1hZ2UodGhpcy5jYWNoZSx0aGlzLmJvdW5kcy5taW5YLHRoaXMuYm91bmRzLm1pblkpXG4gICAgLy8gIGN0eC5yZXN0b3JlKCk7XG4gICAgLy8gIHJldHVybjtcbiAgICAvL31cblxuICAgIC8vdG9kbyBkbyBub3QgdXNlIGZhYnJpYyBoZXJlIVxuICAgIGZ1bmN0aW9uIGNvbnZlcnRDb2xvcihjb2xvcil7XG4gICAgICBpZihjb2xvci5jb25zdHJ1Y3RvciAgPT0gU3RyaW5nICl7XG4gICAgICAgIGlmKGNvbG9yWzBdID09IFwiI1wiKXtcbiAgICAgICAgICB2YXIgX3JnYiA9IGhleFRvUmdiKGNvbG9yKTtcbiAgICAgICAgICByZXR1cm4gW19yZ2IucixfcmdiLmcsX3JnYi5iLDI1NV07XG4gICAgICAgIH1cbiAgICAgICAgY29sb3IgPSBuZXcgZmFicmljLkNvbG9yKGNvbG9yKS5fc291cmNlO1xuICAgICAgICBjb2xvclszXSAqPSAyNTU7XG4gICAgICB9XG4gICAgICByZXR1cm4gY29sb3I7XG4gICAgfVxuXG4gICAgdmFyIF93ID0gdGhpcy5ib3VuZHMubWF4WCAtIHRoaXMuYm91bmRzLm1pblggKyAxO1xuICAgIHZhciBfaCA9IHRoaXMuYm91bmRzLm1heFkgLSB0aGlzLmJvdW5kcy5taW5ZICsgMTtcblxuICAgIC8vdmFyIGltZ0RhdGEgPSBjdHguZ2V0SW1hZ2VEYXRhKG9wdGlvbnMubGVmdCxvcHRpb25zLnRvcCxfdyxfaCk7XG4gICAgdmFyIGltZ0RhdGEgPSBjdHguZ2V0SW1hZ2VEYXRhKHRoaXMuYm91bmRzLm1pblgsdGhpcy5ib3VuZHMubWluWSxfdyxfaCk7XG5cbiAgICB2YXIgY29sb3IgID0gY29udmVydENvbG9yKG9wdGlvbnMuZmlsbCk7XG4gICAgdmFyIGNvbG9yMiA9IGNvbnZlcnRDb2xvcihvcHRpb25zLmludGVyc2VjdGlvbkNvbG9yKTtcbiAgICB2YXIgY29sb3IzID0gY29udmVydENvbG9yKG9wdGlvbnMub3V0ZXJGaWxsKTtcbiAgICB2YXIgY29sb3I0ID0gY29udmVydENvbG9yKG9wdGlvbnMub3V0ZXJJbnRlcnNlY3Rpb25Db2xvcik7XG5cbiAgICBmb3IodmFyIHggPSB0aGlzLmJvdW5kcy5taW5YIDsgeCA8PSB0aGlzLmJvdW5kcy5tYXhYO3grKyApe1xuICAgICAgZm9yKHZhciB5ID0gdGhpcy5ib3VuZHMubWluWSA7IHkgPD0gdGhpcy5ib3VuZHMubWF4WTsgeSsrICl7XG4gICAgICAgIHZhciBpbmRleCA9IHRoaXMud2lkdGggKiB5ICsgeDtcbiAgICAgICAgdmFyIGluZGV4X3NtYWxsID0gX3cgKiAoeSAtICh0aGlzLmJvdW5kcy5taW5ZKSkgKyB4IC0gKHRoaXMuYm91bmRzLm1pblgpO1xuXG4gICAgICAgIGlmKHRoaXMuZGF0YVtpbmRleF0gKXtcbiAgICAgICAgICB2YXIgX2NvbG9yID0gaW1nRGF0YS5kYXRhW2luZGV4X3NtYWxsICogNCArIDNdPyBjb2xvcjIgOiBjb2xvciA7XG4gICAgICAgICAgaWYoIV9jb2xvciljb250aW51ZTtcblxuICAgICAgICAgIGltZ0RhdGEuZGF0YVtpbmRleF9zbWFsbCAqIDQgXSAgICA9IF9jb2xvclswXTtcbiAgICAgICAgICBpbWdEYXRhLmRhdGFbaW5kZXhfc21hbGwgKiA0ICsgMV0gPSBfY29sb3JbMV07XG4gICAgICAgICAgaW1nRGF0YS5kYXRhW2luZGV4X3NtYWxsICogNCArIDJdID0gX2NvbG9yWzJdO1xuICAgICAgICAgIGltZ0RhdGEuZGF0YVtpbmRleF9zbWFsbCAqIDQgKyAzXSA9IF9jb2xvclszXTtcbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgdmFyIF9jb2xvciA9IGltZ0RhdGEuZGF0YVtpbmRleF9zbWFsbCAqIDQgKyAzXT8gY29sb3I0IDogY29sb3IzIDtcbiAgICAgICAgICBpZighX2NvbG9yKWNvbnRpbnVlO1xuXG4gICAgICAgICAgaW1nRGF0YS5kYXRhW2luZGV4X3NtYWxsICogNCBdICAgID0gX2NvbG9yWzBdO1xuICAgICAgICAgIGltZ0RhdGEuZGF0YVtpbmRleF9zbWFsbCAqIDQgKyAxXSA9IF9jb2xvclsxXTtcbiAgICAgICAgICBpbWdEYXRhLmRhdGFbaW5kZXhfc21hbGwgKiA0ICsgMl0gPSBfY29sb3JbMl07XG4gICAgICAgICAgaW1nRGF0YS5kYXRhW2luZGV4X3NtYWxsICogNCArIDNdID0gX2NvbG9yWzNdO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gY3R4LnB1dEltYWdlRGF0YShpbWdEYXRhLCBvcHRpb25zLmxlZnQgICwgb3B0aW9ucy50b3AgICk7XG4gICAgY3R4LnB1dEltYWdlRGF0YShpbWdEYXRhLCB0aGlzLmJvdW5kcy5taW5YLHRoaXMuYm91bmRzLm1pblkgICk7XG4gIH07XG5cblxuICAvKipcbiAgICogZ2V0IGFycmF5IHdpdGggYmVnaW4gYW5kIGVuZCBpbmRpY2VzIG9mIGZpbGxlZCAxIGludGVydmFsc1xuICAgKiBAcGFyYW0gY3R4XG4gICAqIEBwYXJhbSBvcHRpb25zXG4gICAqIEByZXR1cm5zIHtBcnJheX1cbiAgICovXG4gIFNlbGVjdGlvbk1hc2sucHJvdG90eXBlLmdldEludGVydmFsc0FycmF5ID0gZnVuY3Rpb24gKGN0eCwgb3B0aW9ucykge1xuICAgIHZhciBfbmV3RGF0YSA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwLCBfdmFsID0gMDsgaSA8IGFycmF5Lmxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAoX3ZhbCAhPSBhcnJheVtpXSkge1xuICAgICAgICBfbmV3RGF0YS5wdXNoKGkpO1xuICAgICAgICBfdmFsID0gYXJyYXlbaV07XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBfbmV3RGF0YTtcbiAgfTtcblxuICBTZWxlY3Rpb25NYXNrLnByb3RvdHlwZS5yZW5kZXJCb3JkZXIgPSBmdW5jdGlvbiAoY3R4LCBvcHRpb25zKSB7XG5cbiAgICBvcHRpb25zICAgICAgICAgICAgID0gb3B0aW9ucyAgICAgICAgICAgICB8fCB7fTtcbiAgICBvcHRpb25zLmxlZnQgICAgICAgID0gb3B0aW9ucy5sZWZ0ICAgICAgICB8fCAwIDtcbiAgICBvcHRpb25zLnRvcCAgICAgICAgID0gb3B0aW9ucy50b3AgICAgICAgICB8fCAwIDtcbiAgICBvcHRpb25zLmhhdGNoT2Zmc2V0ID0gb3B0aW9ucy5oYXRjaE9mZnNldCB8fCAwIDtcbiAgICBvcHRpb25zLmhhdGNoTGVuZ3RoID0gb3B0aW9ucy5oYXRjaExlbmd0aCB8fCA0IDtcbiAgICBvcHRpb25zLm9wYWNpdHkgPSBvcHRpb25zLm9wYWNpdHkgfHwgMSA7XG5cbiAgICB2YXIgaW1nRGF0YSA9IGN0eC5nZXRJbWFnZURhdGEoMCwwLHRoaXMud2lkdGgsdGhpcy5oZWlnaHQpO1xuXG4gICAgaWYoIXRoaXMuY2FjaGVJbmQpe1xuICAgICAgdGhpcy5jYWNoZUluZCA9IE1hZ2ljV2FuZC5nZXRCb3JkZXJJbmRpY2VzKHRoaXMpO1xuICAgIH1cblxuICAgIHZhciB4LCB5LCBpLCBqLCBrLFxuICAgICAgdyA9IGltZ0RhdGEud2lkdGgsXG4gICAgICBoID0gaW1nRGF0YS5oZWlnaHQ7XG4gICAgdmFyIHJlcyA9IGltZ0RhdGEuZGF0YTtcblxuICAgIHZhciBsZW4gPSB0aGlzLmNhY2hlSW5kLmxlbmd0aDtcbiAgICBmb3IgKGogPSAwOyBqIDwgbGVuOyBqKyspIHtcbiAgICAgIGkgPSB0aGlzLmNhY2hlSW5kW2pdO1xuICAgICAgeCA9IGkgJSB3OyAvLyBjYWxjIHggYnkgaW5kZXhcbiAgICAgIHkgPSAoaSAtIHgpIC8gdzsgLy8gY2FsYyB5IGJ5IGluZGV4XG4gICAgICBrID0gKHkgKiB3ICsgeCkgKiA0O1xuXG4gICAgICBpZiAoKHggKyB5ICsgb3B0aW9ucy5oYXRjaE9mZnNldCkgJSAob3B0aW9ucy5oYXRjaExlbmd0aCAqIDIpIDwgb3B0aW9ucy5oYXRjaExlbmd0aCkgeyAvLyBkZXRlY3QgaGF0Y2ggY29sb3JcblxuICAgICAgICByZXNba10gPSAwO1xuICAgICAgICByZXNbayArIDFdID0gMDtcbiAgICAgICAgcmVzW2sgKyAyXSA9IDA7XG4gICAgICAgIHJlc1trICsgM10gPSAyNTU7IC8vIGJsYWNrLCBjaGFuZ2Ugb25seSBhbHBoYVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVzW2tdID0gMjU1OyAvLyB3aGl0ZVxuICAgICAgICByZXNbayArIDFdID0gMjU1O1xuICAgICAgICByZXNbayArIDJdID0gMjU1O1xuICAgICAgICByZXNbayArIDNdID0gMjU1O1xuICAgICAgfVxuICAgIH1cbiAgICBjdHguc2F2ZSgpO1xuICAgIGN0eC5nbG9iYWxBbHBoYSA9IG9wdGlvbnMub3BhY2l0eTtcbiAgICBjdHgucHV0SW1hZ2VEYXRhKGltZ0RhdGEsIG9wdGlvbnMubGVmdCB8fCAwICwgb3B0aW9ucy50b3AgfHwgMCApO1xuICAgIGN0eC5yZXN0b3JlKCk7XG4gIH07XG5cblxuICBsaWIuY3JlYXRlTWFzayA9IGZ1bmN0aW9uICh3LCBoLGRhdGEpIHtcbiAgICByZXR1cm4gbmV3IFNlbGVjdGlvbk1hc2sodyxoLGRhdGEpO1xuICB9O1xuXG4gIGxpYi5kaWZmZXJlbmNlID0gZnVuY3Rpb24gKGEsIGIpIHtcbiAgICByZXR1cm4gTWF0aC5tYXgoXG4gICAgICBiWzBdICE9PSBmYWxzZSA/IE1hdGguYWJzKGJbMF0gLSBhWzBdKTogMCxcbiAgICAgIGJbMV0gIT09IGZhbHNlID8gTWF0aC5hYnMoYlsxXSAtIGFbMV0pOiAwLFxuICAgICAgYlsyXSAhPT0gZmFsc2UgPyBNYXRoLmFicyhiWzJdIC0gYVsyXSk6IDAsXG4gICAgICBiWzNdICE9PSBmYWxzZSA/IE1hdGguYWJzKGJbM10gLSBhWzNdKTogMCk7XG4gIH07XG5cbiAgbGliLmFjY2VwdGFibGUgPSBmdW5jdGlvbiAoeCwgeSwgaW1hZ2UsIHZpc2l0ZWQsIHNhbXBsZUNvbG9yLCBjb2xvclRocmVzaG9sZCkge1xuLy8gY2hlY2sgd2hldGhlciB0aGUgcG9pbnQgaGFzIGJlZW4gdmlzaXRlZFxuICAgIGlmICh2aXNpdGVkW3kgKiBpbWFnZS53aWR0aCArIHhdID09PSAxKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHZhciBpID0gKHkgKiBpbWFnZS53aWR0aCArIHgpICogbGliLmJ5dGVzLFxuICAgICAgY29sb3IyID0gW2ltYWdlLmRhdGFbaV0sIGltYWdlLmRhdGFbaSArIDFdLCBpbWFnZS5kYXRhW2kgKyAyXSwgaW1hZ2UuZGF0YVtpICsgM11dO1xuXG5cbiAgICBpZiAoc2FtcGxlQ29sb3JbMF0gIT09IGZhbHNlICYmIE1hdGguYWJzKHNhbXBsZUNvbG9yWzBdIC0gY29sb3IyWzBdKSA+IGNvbG9yVGhyZXNob2xkKXJldHVybiBmYWxzZTtcbiAgICBpZiAoc2FtcGxlQ29sb3JbMV0gIT09IGZhbHNlICYmIE1hdGguYWJzKHNhbXBsZUNvbG9yWzFdIC0gY29sb3IyWzFdKSA+IGNvbG9yVGhyZXNob2xkKXJldHVybiBmYWxzZTtcbiAgICBpZiAoc2FtcGxlQ29sb3JbMl0gIT09IGZhbHNlICYmIE1hdGguYWJzKHNhbXBsZUNvbG9yWzJdIC0gY29sb3IyWzJdKSA+Y29sb3JUaHJlc2hvbGQpcmV0dXJuIGZhbHNlO1xuICAgIGlmIChzYW1wbGVDb2xvclszXSAhPT0gZmFsc2UgJiYgTWF0aC5hYnMoc2FtcGxlQ29sb3JbM10gLSBjb2xvcjJbM10pID4gY29sb3JUaHJlc2hvbGQpcmV0dXJuIGZhbHNlO1xuICAgIHJldHVybiB0cnVlO1xuICB9O1xuXG4gIGxpYi5zZWxlY3RBbGwgPSBmdW5jdGlvbiAoaW1hZ2UsIHB4LCBweSwgY29sb3JUaHJlc2hvbGQpIHtcbiAgICB2YXIgaSA9IChweSAqIGltYWdlLndpZHRoICsgcHgpICogbGliLmJ5dGVzLFxuICAgICAgZGF0YSA9IGltYWdlLmRhdGEsXG4gICAgICBzYW1wbGVDb2xvciA9IFtkYXRhW2ldLCBkYXRhW2kgKyAxXSwgZGF0YVtpICsgMl0sIGRhdGFbaSArIDNdXTsgLy8gc3RhcnQgcG9pbnQgY29sb3IgKHNhbXBsZSlcbiAgICByZXR1cm4gbGliLnNlbGVjdEFsbEJ5Q29sb3IoaW1hZ2UsIHNhbXBsZUNvbG9yLCBjb2xvclRocmVzaG9sZClcbiAgfTtcblxuXG4gIC8qKlxuICAgKiBDb252ZXJ0cyBhbiBSR0IgY29sb3IgdmFsdWUgdG8gSFNMLiBDb252ZXJzaW9uIGZvcm11bGFcbiAgICogYWRhcHRlZCBmcm9tIGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvSFNMX2NvbG9yX3NwYWNlLlxuICAgKiBBc3N1bWVzIHIsIGcsIGFuZCBiIGFyZSBjb250YWluZWQgaW4gdGhlIHNldCBbMCwgMjU1XSBhbmRcbiAgICogcmV0dXJucyBoLCBzLCBhbmQgbCBpbiB0aGUgc2V0IFswLCAxXS5cbiAgICpcbiAgICogQHBhcmFtICAgTnVtYmVyICByICAgICAgIFRoZSByZWQgY29sb3IgdmFsdWVcbiAgICogQHBhcmFtICAgTnVtYmVyICBnICAgICAgIFRoZSBncmVlbiBjb2xvciB2YWx1ZVxuICAgKiBAcGFyYW0gICBOdW1iZXIgIGIgICAgICAgVGhlIGJsdWUgY29sb3IgdmFsdWVcbiAgICogQHJldHVybiAgQXJyYXkgICAgICAgICAgIFRoZSBIU0wgcmVwcmVzZW50YXRpb25cbiAgICovXG4gIGxpYi5yZ2JUb0hzbCA9IGZ1bmN0aW9uKHIsIGcsIGIpe1xuICAgIHIgLz0gMjU1LCBnIC89IDI1NSwgYiAvPSAyNTU7XG4gICAgdmFyIG1heCA9IE1hdGgubWF4KHIsIGcsIGIpLCBtaW4gPSBNYXRoLm1pbihyLCBnLCBiKTtcbiAgICB2YXIgaCwgcywgbCA9IChtYXggKyBtaW4pIC8gMjtcblxuICAgIGlmKG1heCA9PSBtaW4pe1xuICAgICAgaCA9IHMgPSAwOyAvLyBhY2hyb21hdGljXG4gICAgfWVsc2V7XG4gICAgICB2YXIgZCA9IG1heCAtIG1pbjtcbiAgICAgIHMgPSBsID4gMC41ID8gZCAvICgyIC0gbWF4IC0gbWluKSA6IGQgLyAobWF4ICsgbWluKTtcbiAgICAgIHN3aXRjaChtYXgpe1xuICAgICAgICBjYXNlIHI6IGggPSAoZyAtIGIpIC8gZCArIChnIDwgYiA/IDYgOiAwKTsgYnJlYWs7XG4gICAgICAgIGNhc2UgZzogaCA9IChiIC0gcikgLyBkICsgMjsgYnJlYWs7XG4gICAgICAgIGNhc2UgYjogaCA9IChyIC0gZykgLyBkICsgNDsgYnJlYWs7XG4gICAgICB9XG4gICAgICBoIC89IDY7XG4gICAgfVxuXG4gICAgcmV0dXJuIFtoLCBzLCBsXTtcbiAgfVxuXG4gIGxpYi5zZWxlY3RDb2xvcmVkID0gZnVuY3Rpb24gKGltYWdlLCBvcHRpb25zKSB7XG5cbiAgICB2YXIgbWFzayA9IG5ldyBTZWxlY3Rpb25NYXNrKGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQpO1xuXG4gICAgbWFzay5ib3VuZHMgPSB7XG4gICAgICBtaW5YOiBpbWFnZS53aWR0aCxcbiAgICAgIG1pblk6IGltYWdlLmhlaWdodCxcbiAgICAgIG1heFk6IC0xLFxuICAgICAgbWF4WDogLTFcbiAgICB9O1xuXG4gICAgdmFyIHgsIHk7XG4gICAgZm9yICh5ID0gMDsgeSA8IGltYWdlLmhlaWdodDsgeSsrKSB7XG4gICAgICBmb3IgKHggPSAwOyB4IDwgaW1hZ2Uud2lkdGg7IHgrKykge1xuICAgICAgICB2YXIgaW5kZXggPSAoeSAqIGltYWdlLndpZHRoICsgeCk7XG4gICAgICAgIHZhciBpID0gaW5kZXggKiBsaWIuYnl0ZXM7XG4gICAgICAgIC8vaWYgKCFpbWFnZS5kYXRhW2kgKyAzXSkgY29udGludWU7XG5cblxuICAgICAgICBpZiAob3B0aW9ucy5hTWluICYmIGltYWdlLmRhdGFbaSArIDNdIDwgb3B0aW9ucy5hTWluKWNvbnRpbnVlO1xuXG4gICAgICAgIHZhciBoc2wgPSByZ2JUb0hzbChpbWFnZS5kYXRhW2ldLCBpbWFnZS5kYXRhW2kgKyAxXSwgaW1hZ2UuZGF0YVtpICsgMl0pO1xuXG5cbiAgICAgICAgaWYgKG9wdGlvbnMuc01pbiAmJiBoc2xbMV0gPCBvcHRpb25zLnNNaW4pY29udGludWU7XG4gICAgICAgIGlmIChvcHRpb25zLnNNYXggJiYgaHNsWzFdID4gb3B0aW9ucy5zTWF4KWNvbnRpbnVlO1xuICAgICAgICBpZiAob3B0aW9ucy5iTWluICYmIGhzbFsyXSA8IG9wdGlvbnMuYk1pbiljb250aW51ZTtcbiAgICAgICAgaWYgKG9wdGlvbnMuYk1heCAmJiBoc2xbMl0gPiBvcHRpb25zLmJNYXgpY29udGludWU7XG5cblxuICAgICAgICBtYXNrLmRhdGFbaW5kZXhdID0gMTtcbiAgICAgICAgbWFzay5jb3VudCsrO1xuICAgICAgICBtYXNrLmJvdW5kcy5taW5YID0gTWF0aC5taW4obWFzay5ib3VuZHMubWluWCwgeCk7XG4gICAgICAgIG1hc2suYm91bmRzLm1heFggPSBNYXRoLm1heChtYXNrLmJvdW5kcy5tYXhYLCB4KTtcbiAgICAgICAgbWFzay5ib3VuZHMubWluWSA9IE1hdGgubWluKG1hc2suYm91bmRzLm1pblksIHkpO1xuICAgICAgICBtYXNrLmJvdW5kcy5tYXhZID0gTWF0aC5tYXgobWFzay5ib3VuZHMubWF4WSwgeSk7XG5cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG1hc2s7XG4gIH07XG5cblxuXG5cbiAgbGliLnNlbGVjdEFsbEJ5Q29sb3IgPSBmdW5jdGlvbiAoY3R4LCBzYW1wbGVDb2xvciwgY29sb3JUaHJlc2hvbGQpIHtcbiAgICB2YXIgaW1hZ2UgPSBfZ2V0SW1hZ2VEYXRhKGN0eCk7XG5cbiAgICB2YXIgbWFzayA9IG5ldyBTZWxlY3Rpb25NYXNrKGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQpO1xuXG4gICAgbWFzay5ib3VuZHMgPSB7XG4gICAgICBtaW5YOiBJbmZpbml0eSxcbiAgICAgIG1pblk6IEluZmluaXR5LFxuICAgICAgbWF4WTogLTEsXG4gICAgICBtYXhYOiAtMVxuICAgIH07XG5cblxuICAgIHZhciB2aXNpdGVkID0gbmV3IFVpbnQ4QXJyYXkoIGltYWdlLndpZHRoICogaW1hZ2UuaGVpZ2h0KTtcbiAgICB2YXIgeCwgeTtcbiAgICBmb3IgKHkgPSAwOyB5IDwgaW1hZ2UuaGVpZ2h0OyB5KyspIHtcbiAgICAgIGZvciAoeCA9IDA7IHggPCBpbWFnZS53aWR0aDsgeCsrKSB7XG4gICAgICAgIGlmKGxpYi5hY2NlcHRhYmxlKHgsIHksIGltYWdlLCBtYXNrLmRhdGEsIHNhbXBsZUNvbG9yLCBjb2xvclRocmVzaG9sZCkpe1xuICAgICAgICAgIE1hZ2ljV2FuZC5mbG9vZEZpbGwoaW1hZ2UsIHgsIHksIGNvbG9yVGhyZXNob2xkLCB7XG4gICAgICAgICAgICBzYW1wbGVDb2xvcjogICAgc2FtcGxlQ29sb3IsXG4gICAgICAgICAgICBhY3RpdmVNYXNrIDogICAgbWFzayxcbiAgICAgICAgICAgIHZpc2l0ZWRQb2ludHMgOiB2aXNpdGVkXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG1hc2s7XG4gIH07XG5cblxuXG4gIGxpYi5kcmF3SW1hZ2UgPSBmdW5jdGlvbiAoY3R4LGNhbnZhcywgbWFzayAsbGVmdCwgdG9wKSB7XG5cbiAgICB2YXIgY3R4MiA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xuXG5cbiAgICB2YXIgaW1nRGF0YSA9IGN0eC5nZXRJbWFnZURhdGEoMCwgMCwgbWFzay53aWR0aCwgbWFzay5oZWlnaHQpO1xuICAgIHZhciBpbWdEYXRhT3JpZ2luYWwgPSBjdHgyLmdldEltYWdlRGF0YShsZWZ0LCB0b3AsIG1hc2sud2lkdGgsIG1hc2suaGVpZ2h0KTtcblxuXG4gICAgdmFyIGIgPSBtYXNrLmJvdW5kcztcbiAgICBmb3IgKHZhciB4ID0gYi5taW5YOyB4IDw9IGIubWF4WDsgeCsrKWZvciAodmFyIHkgPSBiLm1pblk7IHkgPD0gYi5tYXhZOyB5KyspIHtcbiAgICAgIHZhciBpID0gKHkgKiBtYXNrLndpZHRoICsgeCk7Ly8gKiBieXRlczsgLy8gcG9pbnQgaW5kZXggaW4gdGhlIGltYWdlIGRhdGFcbiAgICAgIGlmIChtYXNrLmRhdGFbaV0pIHtcbiAgICAgICAgaW1nRGF0YS5kYXRhW2kgKiA0XSAgICAgPSBpbWdEYXRhT3JpZ2luYWwuZGF0YVtpICogNF07XG4gICAgICAgIGltZ0RhdGEuZGF0YVtpICogNCArIDFdID0gaW1nRGF0YU9yaWdpbmFsLmRhdGFbaSAqIDQgKyAxXTtcbiAgICAgICAgaW1nRGF0YS5kYXRhW2kgKiA0ICsgMl0gPSBpbWdEYXRhT3JpZ2luYWwuZGF0YVtpICogNCArIDJdO1xuICAgICAgICBpbWdEYXRhLmRhdGFbaSAqIDQgKyAzXSA9IGltZ0RhdGFPcmlnaW5hbC5kYXRhW2kgKiA0ICsgM107XG4gICAgICB9XG4gICAgfVxuICAgIGN0eC5wdXRJbWFnZURhdGEoaW1nRGF0YSwwLCAwKTtcbiAgfTtcblxuICBmdW5jdGlvbiBfZ2V0SW1hZ2VEYXRhKGN0eCl7XG4gICAgaWYoY3R4LmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJJbWFnZURhdGFcIil7XG4gICAgICByZXR1cm4gY3R4O1xuICAgIH1lbHNle1xuICAgICAgcmV0dXJuIGN0eC5nZXRJbWFnZURhdGEoMCwgMCwgY3R4LmNhbnZhcy53aWR0aCwgY3R4LmNhbnZhcy5oZWlnaHQpO1xuICAgIH1cbiAgfVxuXG4gIGxpYi5maWxsTWFzayA9IGZ1bmN0aW9uIChjdHgsbWFzaywgY29sb3IpIHtcbiAgICB2YXIgaW1nRGF0YSA9IF9nZXRJbWFnZURhdGEoY3R4KTtcbiAgICB2YXIgYiA9IG1hc2suYm91bmRzO1xuICAgIHZhciB3ID0gaW1nRGF0YS53aWR0aCxcbiAgICAgIGggPSBpbWdEYXRhLmhlaWdodDtcblxuICAgIGZvciAodmFyIHggPSBiLm1pblg7IHggPD0gYi5tYXhYOyB4KyspZm9yICh2YXIgeSA9IGIubWluWTsgeSA8PSBiLm1heFk7IHkrKykge1xuICAgICAgdmFyIGkgPSAoeSAqIHcgKyB4KTsvLyAqIGJ5dGVzOyAvLyBwb2ludCBpbmRleCBpbiB0aGUgaW1hZ2UgZGF0YVxuICAgICAgaWYgKG1hc2suZGF0YVtpXSkge1xuICAgICAgICBpbWdEYXRhLmRhdGFbaSAqIDRdICAgICA9IGNvbG9yWzBdO1xuICAgICAgICBpbWdEYXRhLmRhdGFbaSAqIDQgKyAxXSA9IGNvbG9yWzFdO1xuICAgICAgICBpbWdEYXRhLmRhdGFbaSAqIDQgKyAyXSA9IGNvbG9yWzJdO1xuICAgICAgICBpbWdEYXRhLmRhdGFbaSAqIDQgKyAzXSA9IGNvbG9yWzNdO1xuICAgICAgfVxuICAgIH1cbiAgICBpZihjdHguY29uc3RydWN0b3IubmFtZSAhPSBcIkltYWdlRGF0YVwiKSB7XG4gICAgICBjdHguY2xlYXJSZWN0KDAsIDAsIHcsIGgpO1xuICAgICAgY3R4LnB1dEltYWdlRGF0YShpbWdEYXRhLCAwLCAwKTtcbiAgICB9XG4gIH07XG5cbiAgbGliLnNlbGVjdEJhY2tncm91bmQgPSBmdW5jdGlvbiAoY3R4LCBzYW1wbGVDb2xvciwgY29sb3JUaHJlc2hvbGQpIHtcbiAgICB2YXIgaW1hZ2UgPSBfZ2V0SW1hZ2VEYXRhKGN0eCk7XG5cbiAgICBjb2xvclRocmVzaG9sZCA9IGNvbG9yVGhyZXNob2xkIHx8IDE1O1xuXG4gICAgdmFyIG1hc2sgPSBuZXcgU2VsZWN0aW9uTWFzayhpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0KTtcbiAgICBtYXNrLmJvdW5kcyA9IHtcbiAgICAgIG1pblg6IEluZmluaXR5LFxuICAgICAgbWluWTogSW5maW5pdHksXG4gICAgICBtYXhZOiAtMSxcbiAgICAgIG1heFg6IC0xXG4gICAgfTtcblxuICAgIHZhciBkYXRhID0gaW1hZ2UuZGF0YTtcblxuICAgIHNhbXBsZUNvbG9yID0gc2FtcGxlQ29sb3IgfHxbZGF0YVswXSwgZGF0YVsxXSwgZGF0YVsyXSwgZGF0YVszXV07IC8vIHN0YXJ0IHBvaW50IGNvbG9yIChzYW1wbGUpXG5cbiAgICB2YXIgY29sb3IgPSBzYW1wbGVDb2xvcjtcblxuICAgIGZ1bmN0aW9uIGFkZCh4LCB5KSB7XG4gICAgICBpZiAoIWxpYi5hY2NlcHRhYmxlKHgsIHksIGltYWdlLCBtYXNrLmRhdGEsIHNhbXBsZUNvbG9yLCBjb2xvclRocmVzaG9sZCkpcmV0dXJuO1xuICAgICAgaWYgKCFzYW1wbGVDb2xvcikge1xuICAgICAgICB2YXIgaW5kZXggPSAoeSAqIGltYWdlLndpZHRoICsgeCkgKiA0O1xuICAgICAgICBjb2xvciA9IFtkYXRhW2luZGV4XSwgZGF0YVtpbmRleCArIDFdLCBkYXRhW2luZGV4ICsgMl0sIGRhdGFbaW5kZXggKyAzXV07XG4gICAgICB9XG4gICAgICB2YXIgbWFzazIgPSBNYWdpY1dhbmQuZmxvb2RGaWxsKGltYWdlLCB4LCB5LCBjb2xvclRocmVzaG9sZCwgbnVsbCwgY29sb3IpO1xuICAgICAgbWFzayA9IE1hZ2ljV2FuZC5hZGQobWFzaywgbWFzazIpO1xuICAgIH1cblxuICAgIHZhciB4LCB5O1xuXG4gICAgZm9yICh4ID0gMDsgeCA8IGltYWdlLndpZHRoOyB4KyspIHtcbiAgICAgIGFkZCh4LCAwKTtcbiAgICB9XG4gICAgZm9yICh4ID0gMDsgeCA8IGltYWdlLndpZHRoOyB4KyspIHtcbiAgICAgIGFkZCh4LCBpbWFnZS5oZWlnaHQgLSAxKTtcbiAgICB9XG4gICAgZm9yICh5ID0gMDsgeSA8IGltYWdlLmhlaWdodDsgeSsrKSB7XG4gICAgICBhZGQoaW1hZ2Uud2lkdGggLSAxLCB5KTtcbiAgICB9XG4gICAgZm9yICh5ID0gMDsgeSA8IGltYWdlLmhlaWdodDsgeSsrKSB7XG4gICAgICBhZGQoMCwgeSk7XG4gICAgfVxuICAgIHJldHVybiBtYXNrO1xuXG4gIH07XG5cbiAgbGliLmV4dHJhY3RDb2xvcnMgPSBmdW5jdGlvbihtaXhlZFR5cGUsdGhyZXNob2xkKSB7XG4gICAgdGhyZXNob2xkPSB0aHJlc2hvbGQgfHwgNjA7XG4gICAgdmFyIGltZ0RhdGEgPSBsaWIuZ2V0SW1hZ2VEYXRhKG1peGVkVHlwZSk7XG4gICAgdmFyIF9jb2xvcnMgPSBbXTtcbiAgICB2YXIgYzE7XG4gICAgZm9yKHZhciB4ID0gMTsgeCA8aW1nRGF0YS53aWR0aDt4Kz0zKXtcbiAgICAgIGZvcih2YXIgeSA9IDE7IHkgPGltZ0RhdGEuaGVpZ2h0O3krPTMpIHtcbiAgICAgICAgdmFyIGlpaSA9ICh4ICsgeSAqIGltZ0RhdGEud2lkdGgpICogNDtcbiAgICAgICAgdmFyIGlpQSA9ICh4IC0gMSArIHkgKiBpbWdEYXRhLndpZHRoKSAqIDQ7XG4gICAgICAgIHZhciBpaUIgPSAoeCArIDEgKyB5ICogaW1nRGF0YS53aWR0aCkgKiA0O1xuICAgICAgICB2YXIgaWlDID0gKHggLSAxICsgKHkgKyAxKSAqIGltZ0RhdGEud2lkdGgpICogNDtcbiAgICAgICAgdmFyIGlpRCA9ICh4ICsgMSArICh5ICsgMSkgKiBpbWdEYXRhLndpZHRoKSAqIDQ7XG4gICAgICAgIGlmKGltZ0RhdGEuZGF0YVtpaWkgKyAzXSA8IDI1NSljb250aW51ZTtcblxuICAgICAgICBjMSA9IFsgaW1nRGF0YS5kYXRhW2lpaV0sIGltZ0RhdGEuZGF0YVtpaWkgKyAxXSwgaW1nRGF0YS5kYXRhW2lpaSArIDJdXTtcbiAgICAgICAgdmFyIGNBID0gWyBpbWdEYXRhLmRhdGFbaWlBXSwgaW1nRGF0YS5kYXRhW2lpQSArIDFdLCBpbWdEYXRhLmRhdGFbaWlBICsgMl1dO1xuICAgICAgICB2YXIgY0IgPSBbIGltZ0RhdGEuZGF0YVtpaUJdLCBpbWdEYXRhLmRhdGFbaWlCICsgMV0sIGltZ0RhdGEuZGF0YVtpaUIgKyAyXV07XG4gICAgICAgIHZhciBjQyA9IFsgaW1nRGF0YS5kYXRhW2lpQ10sIGltZ0RhdGEuZGF0YVtpaUMgKyAxXSwgaW1nRGF0YS5kYXRhW2lpQyArIDJdXTtcbiAgICAgICAgdmFyIGNEID0gWyBpbWdEYXRhLmRhdGFbaWlEXSwgaW1nRGF0YS5kYXRhW2lpRCArIDFdLCBpbWdEYXRhLmRhdGFbaWlEICsgMl1dO1xuXG4gICAgICAgIGlmKFxuICAgICAgICAgIGMxWzBdICE9IGNBWzBdIHx8IGNBWzBdICE9IGNCWzBdIHx8IGNCWzBdICE9IGNDWzBdIHx8IGNDWzBdICE9IGNEWzBdIHx8XG4gICAgICAgICAgYzFbMV0gIT0gY0FbMV0gfHwgY0FbMV0gIT0gY0JbMV0gfHwgY0JbMV0gIT0gY0NbMV0gfHwgY0NbMV0gIT0gY0RbMV0gfHxcbiAgICAgICAgICBjMVsyXSAhPSBjQVsyXSB8fCBjQVsyXSAhPSBjQlsyXSB8fCBjQlsyXSAhPSBjQ1syXSB8fCBjQ1syXSAhPSBjRFsyXVxuICAgICAgICApe1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGlzTmV3Q29sb3IgPSB0cnVlO1xuXG4gICAgICAgIGZvcih2YXIgaSBpbiBfY29sb3JzKXtcbiAgICAgICAgICBpZihNYWdpY1dhbmQuZGlmZmVyZW5jZShfY29sb3JzW2ldLCBjMSkgPCB0aHJlc2hvbGQpe1xuICAgICAgICAgICAgaXNOZXdDb2xvciA9IGZhbHNlO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmKGlzTmV3Q29sb3Ipe1xuICAgICAgICAgIF9jb2xvcnMucHVzaChjMSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIF9jb2xvcnM7XG4gIH07XG5cbiAgLyoqXG4gICAqIGltYWdlXG4gICAqIGNhbnZhcyAtINGH0LXRgNC90L4g0LHQu9C+0LUg0LjQt9C+0LHRgNCw0LbQtdC90LjQtS5cbiAgICpcbiAgICogbWFzay0g0L/RgNC10LTRi9C00YPRidCw0Y8g0LzQsNGB0LrQsC4g0L3QsCDQvdC10LUg0LHRg9C00LXRgiDQvdCw0LrQu9Cw0LTRi9Cy0LDRgtGMINC90L7QstCw0Y9cbiAgICogbW9kZSAtINGB0L/QvtGB0L7QsSDQvdCw0LvQvtC20LXQvdC40Y8uXG4gICAqL1xuICBsaWIubWFza1NlbGVjdGlvbiA9IGZ1bmN0aW9uICggY2FudmFzLCBsZWZ0LCB0b3AsIG1hc2sgLG1vZGUpIHtcbiAgICBsZWZ0ID0gbGVmdCB8fCAwO1xuICAgIHRvcCA9IHRvcCB8fCAwO1xuICAgIGlmKGNhbnZhcy5jb25zdHJ1Y3Rvci5uYW1lID09IFwiSFRNTEltYWdlRWxlbWVudFwiKXtcblxuICAgICAgdmFyIF9fY2FudmFzID0gY3JlYXRlQ2FudmFzRWxlbWVudCgpO1xuICAgICAgX19jYW52YXMud2lkdGggPSBjYW52YXMud2lkdGg7XG4gICAgICBfX2NhbnZhcy5oZWlnaHQgPSBjYW52YXMuaGVpZ2h0O1xuICAgICAgdmFyIF9fY3R4ID0gX19jYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICAgIF9fY3R4LmRyYXdJbWFnZShjYW52YXMsIDAsIDApO1xuICAgICAgY2FudmFzID0gX19jYW52YXM7XG4gICAgfVxuXG5cbiAgICB2YXIgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyksXG4gICAgICBpbWdEYXRhID0gY3R4LmdldEltYWdlRGF0YSgwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpLFxuICAgICAgbWFzayA9IG1hc2sgfHwgTWFnaWNXYW5kLmNyZWF0ZU1hc2soY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTtcblxuICAgIHZhciBfeDEgPSBNYXRoLm1heCgwLCAtIGxlZnQpLFxuICAgICAgX3kxID0gTWF0aC5tYXgoMCwgLSB0b3ApLFxuICAgICAgX3gyID0gTWF0aC5taW4obWFzay53aWR0aCAtIGxlZnQsY2FudmFzLndpZHRoKTtcbiAgICBfeTIgPSBNYXRoLm1pbihtYXNrLmhlaWdodCAtIHRvcCxjYW52YXMuaGVpZ2h0KTtcblxuICAgIGZvciAodmFyIHggPSBfeDE7IHggPCBfeDI7IHgrKykge1xuICAgICAgZm9yICh2YXIgeSA9IF95MTsgeSA8IF95MjsgeSsrKSB7XG4gICAgICAgIHZhciBpbmRleCA9IChjYW52YXMud2lkdGggKiB5ICsgeCkgKiA0O1xuXG4gICAgICAgIGlmIChpbWdEYXRhLmRhdGFbaW5kZXhdID4gMjApIHtcbiAgICAgICAgICB2YXIgaW5kZXgyID0gbWFzay53aWR0aCAqICh5ICsgdG9wKSArIHggKyBsZWZ0O1xuICAgICAgICAgIG1hc2suZGF0YVtpbmRleDJdID0gMTtcbiAgICAgICAgICBtYXNrLmNvdW50Kys7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG1hc2s7XG4gIH0sXG4gIGxpYi5zZWxlY3RSZWN0YW5nbGUgPSBmdW5jdGlvbiAoaW1hZ2UsIHgxLCB5MSwgeDIsIHkyKSB7XG5cbiAgICAgIHZhciBtYXNrID0gbmV3IFNlbGVjdGlvbk1hc2soaW1hZ2Uud2lkdGgsIGltYWdlLmhlaWdodCk7XG4gICAgICB2YXIgbWluWCA9IE1hdGgubWluKHgxLCB4Mik7XG4gICAgICB2YXIgbWF4WCA9IE1hdGgubWF4KHgxLCB4Mik7XG4gICAgICB2YXIgbWluWSA9IE1hdGgubWluKHkxLCB5Mik7XG4gICAgICB2YXIgbWF4WSA9IE1hdGgubWF4KHkxLCB5Mik7XG5cbiAgICAgIHZhciB3ID0gaW1hZ2Uud2lkdGgsIGggPSBpbWFnZS5oZWlnaHQ7XG5cbiAgICAgIHZhciBkYXRhID0gaW1hZ2UuZGF0YTtcbiAgICAgIGZvciAodmFyIHkgPSBtaW5ZOyB5IDw9IG1heFk7IHkrKykge1xuICAgICAgICBmb3IgKHZhciB4ID0gbWluWDsgeCA8PSBtYXhYOyB4KyspIHtcbiAgICAgICAgICBpZiAoZGF0YVsoeSAqIHcgKyB4KSAqIDQgKyAzXSkge1xuICAgICAgICAgICAgbWFzay5kYXRhW3kgKiB3ICsgeF0gPSAxO1xuICAgICAgICAgICAgbWFzay5jb3VudCsrO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBtYXNrLmJvdW5kcyA9IHtcbiAgICAgICAgbWluWDogbWluWCxcbiAgICAgICAgbWluWTogbWluWSxcbiAgICAgICAgbWF4WDogbWF4WCxcbiAgICAgICAgbWF4WTogbWF4WVxuICAgICAgfTtcblxuICAgICAgcmV0dXJuIG1hc2s7XG4gICAgfTtcblxuICBsaWIuYnl0ZXMgPSA0O1xuXG5cblxuXG5cblxuICBsaWIuX19mbG9vZEZpbGwgPSBmdW5jdGlvbiAoZSxwb3N0TWVzc2FnZSkge1xuXG4gICAgZGF0YSA9IGUuZGF0YTtcbiAgICB2YXIgaW1hZ2UgPSBkYXRhWzBdLCBweCA9IGRhdGFbMV0sIHB5ID0gZGF0YVsyXSwgY29sb3JUaHJlc2hvbGQgPSBkYXRhWzNdLCBvcHRpb25zID0gZGF0YVs0XTtcblxuICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICAgIC8qe1xuICAgICB2aXNpdGVkUG9pbnRzQXJyYXksXG4gICAgIHNhbXBsZUNvbG9yLFxuICAgICByZXN1bHRNYXNrXG4gICAgIH0qL1xuXG4gICAgdmFyIGMsIHgsIG5ld1ksIGVsLCB4ciwgeGwsIGR5LCBkeWwsIGR5ciwgY2hlY2tZLFxuICAgICAgZGF0YSA9IGltYWdlLmRhdGEsIHcgPSBpbWFnZS53aWR0aCwgaCA9IGltYWdlLmhlaWdodCwgYnl0ZXMgPSBsaWIuYnl0ZXMsXG4gICAgICBpID0gcHkgKiB3ICsgcHg7IC8vIHN0YXJ0IHBvaW50IGluZGV4IGluIHRoZSBtYXNrIGRhdGFcbiAgICBpID0gaSAqIGJ5dGVzOyAvLyBzdGFydCBwb2ludCBpbmRleCBpbiB0aGUgaW1hZ2UgZGF0YVxuXG4gICAgdmFyIHZpc2l0ZWQgICAgID0gb3B0aW9ucy52aXNpdGVkUG9pbnRzIHx8IG5ldyBVaW50OEFycmF5KCB3ICogaCksIC8vIG1hc2sgb2YgdmlzaXRlZCBwb2ludHNcbiAgICAgIHNhbXBsZUNvbG9yID0gb3B0aW9ucy5zYW1wbGVDb2xvciAgIHx8IFtkYXRhW2ldLCBkYXRhW2kgKyAxXSwgZGF0YVtpICsgMl0sIGRhdGFbaSArIDNdXSwgLy8gc3RhcnQgcG9pbnQgY29sb3IgKHNhbXBsZSlcbiAgICAgIHJlc3VsdCAgICAgID0gb3B0aW9ucy5hY3RpdmVNYXNrO1xuXG4gICAgZnVuY3Rpb24gYWNjZXB0YWJsZSh4LCB5KSB7XG4vLyBjaGVjayB3aGV0aGVyIHRoZSBwb2ludCBoYXMgYmVlbiB2aXNpdGVkXG4gICAgICBpZiAodmlzaXRlZFt5ICogaW1hZ2Uud2lkdGggKyB4XSA9PT0gMSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICB2YXIgaSA9ICh5ICogaW1hZ2Uud2lkdGggKyB4KSAqIGxpYi5ieXRlcyxcbiAgICAgICAgY29sb3IyID0gW2ltYWdlLmRhdGFbaV0sIGltYWdlLmRhdGFbaSArIDFdLCBpbWFnZS5kYXRhW2kgKyAyXSwgaW1hZ2UuZGF0YVtpICsgM11dO1xuICAgICAgaWYgKHNhbXBsZUNvbG9yWzBdICE9PSBmYWxzZSAmJiBNYXRoLmFicyhzYW1wbGVDb2xvclswXSAtIGNvbG9yMlswXSkgPiBjb2xvclRocmVzaG9sZClyZXR1cm4gZmFsc2U7XG4gICAgICBpZiAoc2FtcGxlQ29sb3JbMV0gIT09IGZhbHNlICYmIE1hdGguYWJzKHNhbXBsZUNvbG9yWzFdIC0gY29sb3IyWzFdKSA+IGNvbG9yVGhyZXNob2xkKXJldHVybiBmYWxzZTtcbiAgICAgIGlmIChzYW1wbGVDb2xvclsyXSAhPT0gZmFsc2UgJiYgTWF0aC5hYnMoc2FtcGxlQ29sb3JbMl0gLSBjb2xvcjJbMl0pID4gY29sb3JUaHJlc2hvbGQpcmV0dXJuIGZhbHNlO1xuICAgICAgaWYgKHNhbXBsZUNvbG9yWzNdICE9PSBmYWxzZSAmJiBNYXRoLmFicyhzYW1wbGVDb2xvclszXSAtIGNvbG9yMlszXSkgPiBjb2xvclRocmVzaG9sZClyZXR1cm4gZmFsc2U7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9O1xuXG5cblxuICAgIGlmICh2aXNpdGVkW2ldID09PSAxKSByZXR1cm4gbnVsbDtcblxuXG4gICAgdmFyIGZpcnN0ID0gdHJ1ZTtcbiAgICB2YXIgc3RhY2sgPSBbe3k6IHB5LCBsZWZ0OiBweCAtIDEsIHJpZ2h0OiBweCArIDEsIGRpcjogMX1dOyAvLyBmaXJzdCBzY2FubmluZyBsaW5lXG5cbiAgICB2YXIgbW9kZSA9ICdzdHJpY3QnO1xuICAgIHZhciBfY2k7XG4gICAgZG8ge1xuICAgICAgZWwgPSBzdGFjay5zaGlmdCgpOyAvLyBnZXQgbGluZSBmb3Igc2Nhbm5pbmdcblxuICAgICAgY2hlY2tZID0gZmFsc2U7XG4gICAgICBmb3IgKHggPSBlbC5sZWZ0ICsgMTsgeCA8IGVsLnJpZ2h0OyB4KyspIHtcbiAgICAgICAgZHkgPSBlbC55ICogdztcblxuICAgICAgICBpZihtb2RlID09ICdncmFkaWVudCcgJiYgIWZpcnN0KSB7XG4gICAgICAgICAgX2NpID0gKGR5ICsgeCArIChlbC5kaXIgPT0gLTEgPyB3OiAtIHcpKSo0O1xuICAgICAgICAgIHNhbXBsZUNvbG9yID0gW2RhdGFbX2NpXSxkYXRhW19jaSsxXSxkYXRhW19jaSsyXSxkYXRhW19jaSszXV07XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFhY2NlcHRhYmxlKHgsIGVsLnksIGltYWdlLCB2aXNpdGVkLCBzYW1wbGVDb2xvciwgY29sb3JUaHJlc2hvbGQpKWNvbnRpbnVlO1xuXG4gICAgICAgIGZpcnN0ID0gZmFsc2U7XG5cbiAgICAgICAgY2hlY2tZID0gdHJ1ZTsgLy8gaWYgdGhlIGNvbG9yIG9mIHRoZSBuZXcgcG9pbnQoeCx5KSBpcyBzaW1pbGFyIHRvIHRoZSBzYW1wbGUgY29sb3IgbmVlZCB0byBjaGVjayBtaW5tYXggZm9yIFlcblxuICAgICAgICByZXN1bHQuY291bnQrKztcblxuICAgICAgICByZXN1bHQuZGF0YVtkeSArIHhdID0gMTsgLy8gbWFyayBhIG5ldyBwb2ludCBpbiBtYXNrXG4gICAgICAgIHZpc2l0ZWRbZHkgKyB4XSA9IDE7IC8vIG1hcmsgYSBuZXcgcG9pbnQgYXMgdmlzaXRlZFxuXG4gICAgICAgIHhsID0geCAtIDE7XG4gICAgICAgIC8vIHdhbGsgdG8gbGVmdCBzaWRlIHN0YXJ0aW5nIHdpdGggdGhlIGxlZnQgbmVpZ2hib3JcbiAgICAgICAgd2hpbGUgKHhsID4gLTEpIHtcbiAgICAgICAgICBkeWwgPSBkeSArIHhsO1xuXG4gICAgICAgICAgaWYobW9kZSA9PSAnZ3JhZGllbnQnKSB7XG4gICAgICAgICAgICBfY2kgPSAoZHlsICsgMSkqNDtcbiAgICAgICAgICAgIHNhbXBsZUNvbG9yID0gW2RhdGFbX2NpXSwgZGF0YVtfY2kgKyAxXSwgZGF0YVtfY2kgKyAyXSwgZGF0YVtfY2kgKyAzXV07XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICghYWNjZXB0YWJsZSh4bCwgZWwueSwgaW1hZ2UsIHZpc2l0ZWQsIHNhbXBsZUNvbG9yLCBjb2xvclRocmVzaG9sZCkpIGJyZWFrO1xuXG4gICAgICAgICAgcmVzdWx0LmNvdW50Kys7XG4gICAgICAgICAgcmVzdWx0LmRhdGFbZHlsXSA9IDE7XG4gICAgICAgICAgdmlzaXRlZFtkeWxdID0gMTtcblxuICAgICAgICAgIHhsLS07XG4gICAgICAgIH1cbiAgICAgICAgeHIgPSB4ICsgMTtcbiAgICAgICAgLy8gd2FsayB0byByaWdodCBzaWRlIHN0YXJ0aW5nIHdpdGggdGhlIHJpZ2h0IG5laWdoYm9yXG4gICAgICAgIHdoaWxlICh4ciA8IHcpIHtcbiAgICAgICAgICBkeXIgPSBkeSArIHhyO1xuXG4gICAgICAgICAgaWYobW9kZSA9PSAnZ3JhZGllbnQnKSB7XG4gICAgICAgICAgICBfY2kgPSAoZHlyIC0gMSkqNDtcbiAgICAgICAgICAgIHNhbXBsZUNvbG9yID0gW2RhdGFbX2NpXSwgZGF0YVtfY2kgKyAxXSwgZGF0YVtfY2kgKyAyXSwgZGF0YVtfY2kgKyAzXV07XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICghYWNjZXB0YWJsZSh4ciwgZWwueSwgaW1hZ2UsIHZpc2l0ZWQsIHNhbXBsZUNvbG9yLCBjb2xvclRocmVzaG9sZCkpe1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcmVzdWx0LmNvdW50Kys7XG4gICAgICAgICAgcmVzdWx0LmRhdGFbZHlyXSA9IDE7XG4gICAgICAgICAgdmlzaXRlZFtkeXJdID0gMTtcbiAgICAgICAgICB4cisrO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gY2hlY2sgbWlubWF4IGZvciBYXG4gICAgICAgIGlmICh4bCA8IHJlc3VsdC5ib3VuZHMubWluWCkgcmVzdWx0LmJvdW5kcy5taW5YID0geGwgKyAxO1xuICAgICAgICBpZiAoeHIgPiByZXN1bHQuYm91bmRzLm1heFgpIHJlc3VsdC5ib3VuZHMubWF4WCA9IHhyIC0gMTtcblxuICAgICAgICBuZXdZID0gZWwueSAtIGVsLmRpcjtcbiAgICAgICAgaWYgKG5ld1kgPj0gMCAmJiBuZXdZIDwgaCkge1xuICAgICAgICAgIGlmICh4bCA8IHhyKSBzdGFjay5wdXNoKHt5OiBuZXdZLCBsZWZ0OiB4bCwgcmlnaHQ6IHhyLCBkaXI6IC1lbC5kaXJ9KTsgLy8gZnJvbSBcIm5ldyBsZWZ0XCIgdG8gXCJuZXcgcmlnaHRcIlxuICAgICAgICAgIC8vIGFkZCB0d28gc2Nhbm5pbmcgbGluZXMgaW4gdGhlIG9wcG9zaXRlIGRpcmVjdGlvbiAoeSAtIGRpcikgaWYgbmVjZXNzYXJ5XG4gICAgICAgICAgLy8gaWYgKHhsIDw9IGVsLmxlZnQpIHN0YWNrLnB1c2goe3k6IG5ld1ksIGxlZnQ6IHhsLCByaWdodDogZWwubGVmdCwgZGlyOiAtZWwuZGlyfSk7IC8vIGZyb20gXCJuZXcgbGVmdFwiIHRvIFwiY3VycmVudCBsZWZ0XCJcbiAgICAgICAgICAvLyBpZiAoZWwucmlnaHQgPD0geHIpIHN0YWNrLnB1c2goe3k6IG5ld1ksIGxlZnQ6IGVsLnJpZ2h0LCByaWdodDogeHIsIGRpcjogLWVsLmRpcn0pOyAvLyBmcm9tIFwiY3VycmVudCByaWdodFwiIHRvIFwibmV3IHJpZ2h0XCJcbiAgICAgICAgfVxuICAgICAgICBuZXdZID0gZWwueSArIGVsLmRpcjtcbiAgICAgICAgaWYgKG5ld1kgPj0gMCAmJiBuZXdZIDwgaCkgeyAvLyBhZGQgdGhlIHNjYW5uaW5nIGxpbmUgaW4gdGhlIGRpcmVjdGlvbiAoeSArIGRpcikgaWYgbmVjZXNzYXJ5XG4gICAgICAgICAgaWYgKHhsIDwgeHIpIHN0YWNrLnB1c2goe3k6IG5ld1ksIGxlZnQ6IHhsLCByaWdodDogeHIsIGRpcjogZWwuZGlyfSk7IC8vIGZyb20gXCJuZXcgbGVmdFwiIHRvIFwibmV3IHJpZ2h0XCJcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgLy8gY2hlY2sgbWlubWF4IGZvciBZIGlmIG5lY2Vzc2FyeVxuICAgICAgaWYgKGNoZWNrWSkge1xuICAgICAgICBpZiAoZWwueSA8IHJlc3VsdC5ib3VuZHMubWluWSkgcmVzdWx0LmJvdW5kcy5taW5ZID0gZWwueTtcbiAgICAgICAgaWYgKGVsLnkgPiByZXN1bHQuYm91bmRzLm1heFkpIHJlc3VsdC5ib3VuZHMubWF4WSA9IGVsLnk7XG4gICAgICB9XG4gICAgfSB3aGlsZSAoc3RhY2subGVuZ3RoID4gMCk7XG5cbiAgICBwb3N0TWVzc2FnZSAmJiBwb3N0TWVzc2FnZShyZXN1bHQpO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG5cbiAgbGliLmV4dGVuZE1hc2sgPSBmdW5jdGlvbiAobWFzaywgdmFsdWUpIHtcblxuICAgIHZhciBtYXNrMiA9IG5ldyBTZWxlY3Rpb25NYXNrKG1hc2sud2lkdGggKyAyLCBtYXNrLmhlaWdodCArIDIpO1xuICAgIGlmKHZhbHVlKXtcbiAgICAgIG1hc2syLmRhdGEuZmlsbCh2YWx1ZSk7XG4gICAgfVxuXG4gICAgZm9yKHZhciB5ID0gMDt5IDwgbWFzay5oZWlnaHQgOyB5Kyspe1xuICAgICAgZm9yKHZhciB4ID0gMDt4IDwgbWFzay53aWR0aCA7IHgrKyl7XG4gICAgICAgIG1hc2syLmRhdGFbICh5ICsgMSkgKiBtYXNrMi53aWR0aCArIHggKyAxIF0gPSBtYXNrLmRhdGFbeSAqIG1hc2sud2lkdGggKyB4IF07XG4gICAgICB9XG4gICAgfVxuICAgIG1hc2syLmNvdW50ICA9IG1hc2suY291bnQ7XG5cbiAgICBpZighdmFsdWUpIHtcbiAgICAgIG1hc2syLmJvdW5kcyA9IHtcbiAgICAgICAgbWluWDogbWFzay5ib3VuZHMubWluWCArIDEsXG4gICAgICAgIG1heFg6IG1hc2suYm91bmRzLm1heFggKyAxLFxuICAgICAgICBtYXhZOiBtYXNrLmJvdW5kcy5tYXhZICsgMSxcbiAgICAgICAgbWluWTogbWFzay5ib3VuZHMubWluWSArIDFcbiAgICAgIH07XG4gICAgfWVsc2V7XG4gICAgICBtYXNrMi5ib3VuZHMgPSBtYXNrLmJvdW5kcztcbiAgICB9XG5cbiAgICByZXR1cm4gbWFzazI7XG4gIH07XG5cbiAgLyoqIENyZWF0ZSBhIGJpbmFyeSBtYXNrIG9uIHRoZSBpbWFnZSBieSBjb2xvciB0aHJlc2hvbGRcbiAgICogQWxnb3JpdGhtOiBTY2FubGluZSBmbG9vZCBmaWxsIChodHRwOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0Zsb29kX2ZpbGwpXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBpbWFnZToge1VpbnQ4QXJyYXl9IGRhdGEsIHtpbnR9IHdpZHRoLCB7aW50fSBoZWlnaHQsIHtpbnR9IGJ5dGVzXG4gICAqIEBwYXJhbSB7aW50fSB4IG9mIHN0YXJ0IHBpeGVsXG4gICAqIEBwYXJhbSB7aW50fSB5IG9mIHN0YXJ0IHBpeGVsXG4gICAqIEBwYXJhbSB7aW50fSBjb2xvciB0aHJlc2hvbGRcbiAgICogQHBhcmFtIHtVaW50OEFycmF5fSBtYXNrIG9mIHZpc2l0ZWQgcG9pbnRzIChvcHRpb25hbClcbiAgICogQHJldHVybiB7T2JqZWN0fSBtYXNrOiB7VWludDhBcnJheX0gZGF0YSwge2ludH0gd2lkdGgsIHtpbnR9IGhlaWdodCwge09iamVjdH0gYm91bmRzXG4gICAqL1xuICBsaWIuZmxvb2RGaWxsID0gZnVuY3Rpb24gKGltYWdlLCBweCwgcHksIGNvbG9yVGhyZXNob2xkLCBvcHRpb25zLGNvbG9yLGNhbGxiYWNrKSB7XG4gICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG4gICAgb3B0aW9ucy5hY3RpdmVNYXNrID0gb3B0aW9ucy5hY3RpdmVNYXNrICB8fCBuZXcgU2VsZWN0aW9uTWFzayhpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0KTtcblxuICAgIHJldHVybiBsaWIuX19mbG9vZEZpbGwoe2RhdGE6IFtpbWFnZSwgcHgsIHB5LCBjb2xvclRocmVzaG9sZCwgb3B0aW9ucywgY29sb3JdfSxjYWxsYmFjayk7XG5cbiAgICAvKlxuICAgIHZhciB3b3JrZXIgPSBfLndvcmtlcihsaWIuX19mbG9vZEZpbGwpO1xuICAgIHdvcmtlci5vbm1lc3NhZ2UgPSBmdW5jdGlvbihlKXtcbiAgICAgIHZhciBtYXNrID0gbmV3IFNlbGVjdGlvbk1hc2soZS5kYXRhKTtcbiAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKG1hc2spO1xuICAgIH07XG4gICAgd29ya2VyLnBvc3RNZXNzYWdlKFtpbWFnZSwgcHgsIHB5LCBjb2xvclRocmVzaG9sZCwgb3B0aW9uc10pO1xuKi9cblxuICB9O1xuXG4gIGxpYi5zdWJzdHJhY3QgPSBmdW5jdGlvbiAobWFzaywgbWFzazIpIHtcbiAgICB2YXIgbWluWCwgbWF4WCwgbWluWSwgbWF4WTtcblxuICAgIHZhciByZXN1bHQgPSBuZXcgU2VsZWN0aW9uTWFzayhtYXNrLndpZHRoLCBtYXNrLmhlaWdodCk7XG4gICAgdmFyIGJvdW5kcyA9IG1hc2syLmJvdW5kcztcblxuICAgIHZhciBtaW5YID0gZmFsc2UsIG1pblkgPSBtYXNrLmhlaWdodCwgbWF4WCA9IGZhbHNlLCBtYXhZID0gLTE7XG5cbiAgICBmb3IgKHZhciB4ID0gYm91bmRzLm1pblg7IHggPD0gYm91bmRzLm1heFg7IHgrKykge1xuICAgICAgZm9yICh2YXIgeSA9IGJvdW5kcy5taW5ZOyB5IDw9IGJvdW5kcy5tYXhZOyB5KyspIHtcbiAgICAgICAgdmFyIGluZGV4ID0gbWFzay53aWR0aCAqIHkgKyB4O1xuXG4gICAgICAgIGlmICghbWFzay5kYXRhW2luZGV4XSAmJiBtYXNrMi5kYXRhW2luZGV4XSkge1xuICAgICAgICAgIHJlc3VsdC5kYXRhW2luZGV4XSA9IDE7XG4gICAgICAgICAgcmVzdWx0LmNvdW50Kys7XG4gICAgICAgICAgaWYgKHJlc3VsdC5ib3VuZHMubWluWSA+IHkpcmVzdWx0LmJvdW5kcy5taW5ZID0geTtcbiAgICAgICAgICBpZiAocmVzdWx0LmJvdW5kcy5tYXhZIDwgeSlyZXN1bHQuYm91bmRzLm1heFkgPSB5O1xuICAgICAgICAgIGlmIChyZXN1bHQuYm91bmRzLm1pblggPiB4KXJlc3VsdC5ib3VuZHMubWluWCA9IHg7XG4gICAgICAgICAgaWYgKHJlc3VsdC5ib3VuZHMubWF4WCA8IHgpcmVzdWx0LmJvdW5kcy5tYXhYID0geDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICBsaWIuZ2V0SW1hZ2VEYXRhICA9IGZ1bmN0aW9uKG1peGVkVHlwZSl7XG4gICAgdmFyIGNhbnZhcztcbiAgICBpZiAobWl4ZWRUeXBlLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJJbWFnZVwiIHx8IG1peGVkVHlwZS5jb25zdHJ1Y3Rvci5uYW1lID09IFwiSFRNTEltYWdlRWxlbWVudFwiKSB7XG4gICAgICB2YXIgX2NhbnZhcyA9IGNyZWF0ZUNhbnZhc0VsZW1lbnQoKTtcbiAgICAgIF9jYW52YXMud2lkdGggPSBtaXhlZFR5cGUud2lkdGg7XG4gICAgICBfY2FudmFzLmhlaWdodCA9IG1peGVkVHlwZS5oZWlnaHQ7XG4gICAgICB2YXIgY3R4ID0gX2NhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7XG4gICAgICBjdHguZHJhd0ltYWdlKG1peGVkVHlwZSwgMCwgMCk7XG4gICAgICBjYW52YXMgPSBfY2FudmFzO1xuICAgIH1lbHNle1xuICAgICAgY2FudmFzID0gbWl4ZWRUeXBlO1xuICAgIH1cbiAgICBpZiAoY2FudmFzLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJIVE1MQ2FudmFzRWxlbWVudFwiIHx8IGNhbnZhcy5jb25zdHJ1Y3Rvci5uYW1lID09IFwiQ2FudmFzXCIpIHtcbiAgICAgIHZhciBpbWdEYXRhID0gY2FudmFzLmdldENvbnRleHQoXCIyZFwiKS5nZXRJbWFnZURhdGEoMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTtcbiAgICB9ZWxzZXtcbiAgICAgIGltZ0RhdGEgPSBtaXhlZFR5cGU7XG4gICAgfVxuICAgIHJldHVybiBpbWdEYXRhO1xuICB9O1xuXG4gIGxpYi5nZXRDb2xvcmVkUGl4ZWxzID0gZnVuY3Rpb24gKG1peGVkVHlwZSkge1xuICAgIHZhciBpbWdEYXRhID0gbGliLmdldEltYWdlRGF0YShtaXhlZFR5cGUpO1xuICAgIHZhciBkYXRhID0gaW1nRGF0YS5kYXRhO1xuICAgIHZhciBwaXhlbHMgPSAwO1xuICAgIGZvciAodmFyIGkgPSAzOyBpIDwgZGF0YS5sZW5ndGg7IGkgKz0gNCkge1xuICAgICAgaWYgKGRhdGFbaV0pIHtcbiAgICAgICAgcGl4ZWxzKz0gZGF0YVtpXSAvIDI1NTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHBpeGVscztcbiAgfTtcblxuICBsaWIuaW52ZXJ0TWFzayA9IGZ1bmN0aW9uIChtYXNrKSB7XG4gICAgdmFyIHJlc3VsdCA9IG5ldyBTZWxlY3Rpb25NYXNrKG1hc2sud2lkdGgsIG1hc2suaGVpZ2h0KTtcbiAgICByZXN1bHQuYm91bmRzID0ge1xuICAgICAgbWluWDogSW5maW5pdHksXG4gICAgICBtaW5ZOiBJbmZpbml0eSxcbiAgICAgIG1heFk6IC0xLFxuICAgICAgbWF4WDogLTFcbiAgICB9O1xuXG5cbiAgICBmb3IgKHZhciB4ID0gMDsgeCA8IG1hc2sud2lkdGg7IHgrKykge1xuICAgICAgZm9yICh2YXIgeSA9IDA7IHkgPCBtYXNrLmhlaWdodDsgeSsrKSB7XG4gICAgICAgIHZhciBpbmRleCA9IG1hc2sud2lkdGggKiB5ICsgeDtcbiAgICAgICAgaWYgKCFtYXNrLmRhdGFbaW5kZXhdKSB7XG4gICAgICAgICAgcmVzdWx0LmRhdGFbaW5kZXhdID0gMTtcbiAgICAgICAgICByZXN1bHQuY291bnQrKztcbiAgICAgICAgICBpZiAocmVzdWx0LmJvdW5kcy5taW5ZID4geSlyZXN1bHQuYm91bmRzLm1pblkgPSB5O1xuICAgICAgICAgIGlmIChyZXN1bHQuYm91bmRzLm1heFkgPCB5KXJlc3VsdC5ib3VuZHMubWF4WSA9IHk7XG4gICAgICAgICAgaWYgKHJlc3VsdC5ib3VuZHMubWluWCA+IHgpcmVzdWx0LmJvdW5kcy5taW5YID0geDtcbiAgICAgICAgICBpZiAocmVzdWx0LmJvdW5kcy5tYXhYIDwgeClyZXN1bHQuYm91bmRzLm1heFggPSB4O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG5cbiAgbGliLmV4Y2x1ZGUgPSBmdW5jdGlvbiAobWFzaywgbWFzazIpIHtcbiAgICB2YXIgcmVzdWx0ID0gbmV3IFNlbGVjdGlvbk1hc2sobWFzay53aWR0aCwgbWFzay5oZWlnaHQpO1xuICAgIHZhciBib3VuZHMgPSB7XG4gICAgICBtaW5YOiBNYXRoLm1pbihtYXNrLmJvdW5kcy5taW5YLCBtYXNrMi5ib3VuZHMubWluWCksXG4gICAgICBtYXhYOiBNYXRoLm1heChtYXNrLmJvdW5kcy5tYXhYLCBtYXNrMi5ib3VuZHMubWF4WCksXG4gICAgICBtaW5ZOiBNYXRoLm1pbihtYXNrLmJvdW5kcy5taW5ZLCBtYXNrMi5ib3VuZHMubWluWSksXG4gICAgICBtYXhZOiBNYXRoLm1heChtYXNrLmJvdW5kcy5tYXhZLCBtYXNrMi5ib3VuZHMubWF4WSlcbiAgICB9O1xuXG4gICAgdmFyIG1pblggPSBmYWxzZSwgbWluWSA9IG1hc2suaGVpZ2h0LCBtYXhYID0gZmFsc2UsIG1heFkgPSAtMTtcblxuICAgIGZvciAodmFyIHggPSBib3VuZHMubWluWDsgeCA8PSBib3VuZHMubWF4WDsgeCsrKSB7XG4gICAgICBmb3IgKHZhciB5ID0gYm91bmRzLm1pblk7IHkgPD0gYm91bmRzLm1heFk7IHkrKykge1xuICAgICAgICB2YXIgaW5kZXggPSBtYXNrMi53aWR0aCAqIHkgKyB4O1xuXG4gICAgICAgIGlmIChtYXNrLmRhdGFbaW5kZXhdIF4gbWFzazIuZGF0YVtpbmRleF0pIHtcbiAgICAgICAgICByZXN1bHQuZGF0YVtpbmRleF0gPSAxO1xuICAgICAgICAgIHJlc3VsdC5jb3VudCsrO1xuICAgICAgICAgIG1heFggPSB4O1xuICAgICAgICAgIGlmIChtaW5ZID4geSltaW5ZID0geTtcbiAgICAgICAgICBpZiAobWF4WSA8IHkpbWF4WSA9IHk7XG4gICAgICAgICAgaWYgKG1pblggPT09IGZhbHNlKSB7XG4gICAgICAgICAgICBtaW5YID0geDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXN1bHQuYm91bmRzID0ge1xuICAgICAgbWluWDogbWluWCxcbiAgICAgIG1heFg6IG1heFgsXG4gICAgICBtaW5ZOiBtaW5ZLFxuICAgICAgbWF4WTogbWF4WVxuICAgIH1cblxuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG5cbiAgbGliLmludGVyc2VjdCA9IGZ1bmN0aW9uIChtYXNrLCBtYXNrMikge1xuICAgIHZhciBtaW5YLCBtYXhYLCBtaW5ZLCBtYXhZO1xuXG4gICAgdmFyIHJlc3VsdCA9IG5ldyBTZWxlY3Rpb25NYXNrKG1hc2sud2lkdGgsIG1hc2suaGVpZ2h0KTtcbiAgICB2YXIgYm91bmRzID0ge1xuICAgICAgbWluWDogTWF0aC5tYXgobWFzay5ib3VuZHMubWluWCwgbWFzazIuYm91bmRzLm1pblgpLFxuICAgICAgbWF4WDogTWF0aC5taW4obWFzay5ib3VuZHMubWF4WCwgbWFzazIuYm91bmRzLm1heFgpLFxuICAgICAgbWluWTogTWF0aC5tYXgobWFzay5ib3VuZHMubWluWSwgbWFzazIuYm91bmRzLm1pblkpLFxuICAgICAgbWF4WTogTWF0aC5taW4obWFzay5ib3VuZHMubWF4WSwgbWFzazIuYm91bmRzLm1heFkpXG4gICAgfTtcblxuICAgIHZhciBtaW5YID0gZmFsc2UsIG1pblkgPSBtYXNrLmhlaWdodCwgbWF4WCA9IGZhbHNlLCBtYXhZID0gLTE7XG5cbiAgICBmb3IgKHZhciB4ID0gYm91bmRzLm1pblg7IHggPD0gYm91bmRzLm1heFg7IHgrKykge1xuICAgICAgZm9yICh2YXIgeSA9IGJvdW5kcy5taW5ZOyB5IDw9IGJvdW5kcy5tYXhZOyB5KyspIHtcbiAgICAgICAgdmFyIGluZGV4ID0gbWFzazIud2lkdGggKiB5ICsgeDtcblxuICAgICAgICBpZiAobWFzay5kYXRhW2luZGV4XSAmJiBtYXNrMi5kYXRhW2luZGV4XSkge1xuICAgICAgICAgIHJlc3VsdC5kYXRhW2luZGV4XSA9IDE7XG4gICAgICAgICAgcmVzdWx0LmNvdW50Kys7XG4gICAgICAgICAgbWF4WCA9IHg7XG4gICAgICAgICAgaWYgKG1pblkgPiB5KW1pblkgPSB5O1xuICAgICAgICAgIGlmIChtYXhZIDwgeSltYXhZID0geTtcbiAgICAgICAgICBpZiAobWluWCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgIG1pblggPSB4O1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJlc3VsdC5ib3VuZHMgPSB7XG4gICAgICBtaW5YOiBtaW5YLFxuICAgICAgbWF4WDogbWF4WCxcbiAgICAgIG1pblk6IG1pblksXG4gICAgICBtYXhZOiBtYXhZXG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcblxuICBsaWIuYWRkID0gZnVuY3Rpb24gKG1hc2ssIG1hc2syKSB7XG4gICAgdmFyIHJlc3VsdCA9IG5ldyBTZWxlY3Rpb25NYXNrKG1hc2sud2lkdGgsIG1hc2suaGVpZ2h0KTtcblxuICAgIHJlc3VsdC5ib3VuZHMgPSB7XG4gICAgICBtaW5YOiBNYXRoLm1pbihtYXNrLmJvdW5kcy5taW5YLCBtYXNrMi5ib3VuZHMubWluWCksXG4gICAgICBtYXhYOiBNYXRoLm1heChtYXNrLmJvdW5kcy5tYXhYLCBtYXNrMi5ib3VuZHMubWF4WCksXG4gICAgICBtaW5ZOiBNYXRoLm1pbihtYXNrLmJvdW5kcy5taW5ZLCBtYXNrMi5ib3VuZHMubWluWSksXG4gICAgICBtYXhZOiBNYXRoLm1heChtYXNrLmJvdW5kcy5tYXhZLCBtYXNrMi5ib3VuZHMubWF4WSlcbiAgICB9O1xuXG4gICAgZm9yICh2YXIgeCA9IHJlc3VsdC5ib3VuZHMubWluWDsgeCA8PSByZXN1bHQuYm91bmRzLm1heFg7IHgrKykge1xuICAgICAgZm9yICh2YXIgeSA9IHJlc3VsdC5ib3VuZHMubWluWTsgeSA8PSByZXN1bHQuYm91bmRzLm1heFk7IHkrKykge1xuICAgICAgICB2YXIgaW5kZXggPSBtYXNrMi53aWR0aCAqIHkgKyB4O1xuXG4gICAgICAgIGlmIChtYXNrLmRhdGFbaW5kZXhdIHx8IG1hc2syLmRhdGFbaW5kZXhdKSB7XG4gICAgICAgICAgcmVzdWx0LmRhdGFbaW5kZXhdID0gMTtcbiAgICAgICAgICByZXN1bHQuY291bnQrKztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG5cbiAgLyoqIEFwcGx5IHRoZSBnYXVzcy1ibHVyIGZpbHRlciB0byBiaW5hcnkgbWFza1xuICAgKiBBbGdvcml0aG1zOiBodHRwOi8vYmxvZy5pdmFuay5uZXQvZmFzdGVzdC1nYXVzc2lhbi1ibHVyLmh0bWxcbiAgICogaHR0cDovL3d3dy5saWJyb3cuY29tL2FydGljbGVzL2FydGljbGUtOVxuICAgKiBodHRwOi8vZWx5bnhzZGsuZnJlZS5mci9leHQtZG9jcy9CbHVyL0Zhc3RfYm94X2JsdXIucGRmXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBtYXNrOiB7VWludDhBcnJheX0gZGF0YSwge2ludH0gd2lkdGgsIHtpbnR9IGhlaWdodCwge09iamVjdH0gYm91bmRzXG4gICAqIEBwYXJhbSB7aW50fSBibHVyIHJhZGl1c1xuICAgKiBAcmV0dXJuIHtPYmplY3R9IG1hc2s6IHtVaW50OEFycmF5fSBkYXRhLCB7aW50fSB3aWR0aCwge2ludH0gaGVpZ2h0LCB7T2JqZWN0fSBib3VuZHNcbiAgICovXG4gIGxpYi5nYXVzc0JsdXIgPSBmdW5jdGlvbiAobWFzaywgcmFkaXVzKSB7XG5cbiAgICB2YXIgaSwgaywgazEsIHgsIHksIHZhbCwgc3RhcnQsIGVuZCxcbiAgICAgIG4gPSByYWRpdXMgKiAyICsgMSwgLy8gc2l6ZSBvZiB0aGUgcGF0dGVybiBmb3IgcmFkaXVzLW5laWdoYm9ycyAoZnJvbSAtciB0byArciB3aXRoIHRoZSBjZW50ZXIgcG9pbnQpXG4gICAgICBzMiA9IHJhZGl1cyAqIHJhZGl1cyxcbiAgICAgIHdnID0gbmV3IEZsb2F0MzJBcnJheShuKSwgLy8gd2VpZ2h0c1xuICAgICAgdG90YWwgPSAwLCAvLyBzdW0gb2Ygd2VpZ2h0cyh1c2VkIGZvciBub3JtYWxpemF0aW9uKVxuICAgICAgdyA9IG1hc2sud2lkdGgsXG4gICAgICBoID0gbWFzay5oZWlnaHQsXG4gICAgICBkYXRhID0gbWFzay5kYXRhLFxuICAgICAgbWluWCA9IG1hc2suYm91bmRzLm1pblgsXG4gICAgICBtYXhYID0gbWFzay5ib3VuZHMubWF4WCxcbiAgICAgIG1pblkgPSBtYXNrLmJvdW5kcy5taW5ZLFxuICAgICAgbWF4WSA9IG1hc2suYm91bmRzLm1heFksXG4gICAgICBjb3VudCA9IDA7XG5cbiAgICAvLyBjYWxjIGdhdXNzIHdlaWdodHNcbiAgICBmb3IgKGkgPSAwOyBpIDwgcmFkaXVzOyBpKyspIHtcbiAgICAgIHZhciBkc3EgPSAocmFkaXVzIC0gaSkgKiAocmFkaXVzIC0gaSk7XG4gICAgICB2YXIgd3cgPSBNYXRoLmV4cCgtZHNxIC8gKDIuMCAqIHMyKSkgLyAoMiAqIE1hdGguUEkgKiBzMik7XG4gICAgICB3Z1tyYWRpdXMgKyBpXSA9IHdnW3JhZGl1cyAtIGldID0gd3c7XG4gICAgICB0b3RhbCArPSAyICogd3c7XG4gICAgfVxuICAgIC8vIG5vcm1hbGl6YXRpb24gd2VpZ2h0c1xuICAgIGZvciAoaSA9IDA7IGkgPCBuOyBpKyspIHtcbiAgICAgIHdnW2ldIC89IHRvdGFsO1xuICAgIH1cblxuICAgIHZhciByZXN1bHQgPSBuZXcgVWludDhBcnJheSh3ICogaCksIC8vIHJlc3VsdCBtYXNrXG4gICAgICBlbmRYID0gcmFkaXVzICsgdyxcbiAgICAgIGVuZFkgPSByYWRpdXMgKyBoO1xuXG4gICAgLy93YWxrIHRocm91Z2ggYWxsIHNvdXJjZSBwb2ludHMgZm9yIGJsdXJcbiAgICBmb3IgKHkgPSBtaW5ZOyB5IDwgbWF4WSArIDE7IHkrKylcbiAgICAgIGZvciAoeCA9IG1pblg7IHggPCBtYXhYICsgMTsgeCsrKSB7XG4gICAgICAgIHZhbCA9IDA7XG4gICAgICAgIGsgPSB5ICogdyArIHg7IC8vIGluZGV4IG9mIHRoZSBwb2ludFxuICAgICAgICBzdGFydCA9IHJhZGl1cyAtIHggPiAwID8gcmFkaXVzIC0geCA6IDA7XG4gICAgICAgIGVuZCA9IGVuZFggLSB4IDwgbiA/IGVuZFggLSB4IDogbjsgLy8gTWF0aC5taW4oKCgodyAtIDEpIC0geCkgKyByYWRpdXMpICsgMSwgbik7XG4gICAgICAgIGsxID0gayAtIHJhZGl1cztcbiAgICAgICAgLy8gd2FsayB0aHJvdWdoIHgtbmVpZ2hib3JzXG4gICAgICAgIGZvciAoaSA9IHN0YXJ0OyBpIDwgZW5kOyBpKyspIHtcbiAgICAgICAgICB2YWwgKz0gZGF0YVtrMSArIGldICogd2dbaV07XG4gICAgICAgIH1cbiAgICAgICAgc3RhcnQgPSByYWRpdXMgLSB5ID4gMCA/IHJhZGl1cyAtIHkgOiAwO1xuICAgICAgICBlbmQgPSBlbmRZIC0geSA8IG4gPyBlbmRZIC0geSA6IG47IC8vIE1hdGgubWluKCgoKGggLSAxKSAtIHkpICsgcmFkaXVzKSArIDEsIG4pO1xuICAgICAgICBrMSA9IGsgLSByYWRpdXMgKiB3O1xuICAgICAgICAvLyB3YWxrIHRocm91Z2ggeS1uZWlnaGJvcnNcbiAgICAgICAgZm9yIChpID0gc3RhcnQ7IGkgPCBlbmQ7IGkrKykge1xuICAgICAgICAgIHZhbCArPSBkYXRhW2sxICsgaSAqIHddICogd2dbaV07XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHZhbCA+IDAuNSkge1xuICAgICAgICAgIHJlc3VsdFtrXSA9IDE7XG4gICAgICAgICAgY291bnQrKztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXN1bHRba10gPSAwO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgY291bnQ6IGNvdW50LFxuICAgICAgZGF0YTogcmVzdWx0LFxuICAgICAgd2lkdGg6IHcsXG4gICAgICBoZWlnaHQ6IGgsXG4gICAgICBib3VuZHM6IHtcbiAgICAgICAgbWluWDogbWluWCxcbiAgICAgICAgbWluWTogbWluWSxcbiAgICAgICAgbWF4WDogbWF4WCxcbiAgICAgICAgbWF4WTogbWF4WVxuICAgICAgfVxuICAgIH07XG4gIH07XG5cbiAgLyoqIENyZWF0ZSBhIGJvcmRlciBpbmRleCBhcnJheSBvZiBib3VuZGFyeSBwb2ludHMgb2YgdGhlIG1hc2sgd2l0aCByYWRpdXMtbmVpZ2hib3JzXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBtYXNrOiB7VWludDhBcnJheX0gZGF0YSwge2ludH0gd2lkdGgsIHtpbnR9IGhlaWdodCwge09iamVjdH0gYm91bmRzXG4gICAqIEBwYXJhbSB7aW50fSByYWRpdXM6IGJsdXIgcmFkaXVzXG4gICAqIEBwYXJhbSB7VWludDhBcnJheX0gdmlzaXRlZDogbWFzayBvZiB2aXNpdGVkIHBvaW50cyAob3B0aW9uYWwpXG4gICAqIEByZXR1cm4ge0FycmF5fSBib3JkZXIgaW5kZXggYXJyYXkgb2YgYm91bmRhcnkgcG9pbnRzIHdpdGggcmFkaXVzLW5laWdoYm9ycyAob25seSBwb2ludHMgbmVlZCBmb3IgYmx1cilcbiAgICovXG4gIGZ1bmN0aW9uIGNyZWF0ZUJvcmRlckZvckJsdXIobWFzaywgcmFkaXVzLCB2aXNpdGVkKSB7XG5cbiAgICB2YXIgeCwgaSwgaiwgeSwgaywgazEsIGsyLFxuICAgICAgdyA9IG1hc2sud2lkdGgsXG4gICAgICBoID0gbWFzay5oZWlnaHQsXG4gICAgICBkYXRhID0gbWFzay5kYXRhLFxuICAgICAgdmlzaXRlZERhdGEgPSBuZXcgVWludDhBcnJheShkYXRhKSxcbiAgICAgIG1pblggPSBtYXNrLmJvdW5kcy5taW5YLFxuICAgICAgbWF4WCA9IG1hc2suYm91bmRzLm1heFgsXG4gICAgICBtaW5ZID0gbWFzay5ib3VuZHMubWluWSxcbiAgICAgIG1heFkgPSBtYXNrLmJvdW5kcy5tYXhZLFxuICAgICAgbGVuID0gdyAqIGgsXG4gICAgICB0ZW1wID0gbmV3IFVpbnQ4QXJyYXkobGVuKSwgLy8gYXV4aWxpYXJ5IGFycmF5IHRvIGNoZWNrIHVuaXF1ZW5lc3NcbiAgICAgIGJvcmRlciA9IFtdLCAvLyBvbmx5IGJvcmRlciBwb2ludHNcbiAgICAgIHgwID0gTWF0aC5tYXgobWluWCwgMSksXG4gICAgICB4MSA9IE1hdGgubWluKG1heFgsIHcgLSAyKSxcbiAgICAgIHkwID0gTWF0aC5tYXgobWluWSwgMSksXG4gICAgICB5MSA9IE1hdGgubWluKG1heFksIGggLSAyKTtcblxuICAgIGlmICh2aXNpdGVkICYmIHZpc2l0ZWQubGVuZ3RoID4gMCkge1xuICAgICAgLy8gY29weSB2aXNpdGVkIHBvaW50cyAob25seSBcImJsYWNrXCIpXG4gICAgICBmb3IgKGsgPSAwOyBrIDwgbGVuOyBrKyspIHtcbiAgICAgICAgaWYgKHZpc2l0ZWRba10gPT09IDEpIHZpc2l0ZWREYXRhW2tdID0gMTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyB3YWxrIHRocm91Z2ggaW5uZXIgdmFsdWVzIGV4Y2VwdCBwb2ludHMgb24gdGhlIGJvdW5kYXJ5IG9mIHRoZSBpbWFnZVxuICAgIGZvciAoeSA9IHkwOyB5IDwgeTEgKyAxOyB5KyspXG4gICAgICBmb3IgKHggPSB4MDsgeCA8IHgxICsgMTsgeCsrKSB7XG4gICAgICAgIGsgPSB5ICogdyArIHg7XG4gICAgICAgIGlmIChkYXRhW2tdID09PSAwKSBjb250aW51ZTsgLy8gXCJ3aGl0ZVwiIHBvaW50IGlzbid0IHRoZSBib3JkZXJcbiAgICAgICAgazEgPSBrICsgdzsgLy8geSArIDFcbiAgICAgICAgazIgPSBrIC0gdzsgLy8geSAtIDFcbiAgICAgICAgLy8gY2hlY2sgaWYgYW55IG5laWdoYm9yIHdpdGggYSBcIndoaXRlXCIgY29sb3JcbiAgICAgICAgaWYgKHZpc2l0ZWREYXRhW2sgKyAxXSA9PT0gMCB8fCB2aXNpdGVkRGF0YVtrIC0gMV0gPT09IDAgfHxcbiAgICAgICAgICB2aXNpdGVkRGF0YVtrMV0gPT09IDAgfHwgdmlzaXRlZERhdGFbazEgKyAxXSA9PT0gMCB8fCB2aXNpdGVkRGF0YVtrMSAtIDFdID09PSAwIHx8XG4gICAgICAgICAgdmlzaXRlZERhdGFbazJdID09PSAwIHx8IHZpc2l0ZWREYXRhW2syICsgMV0gPT09IDAgfHwgdmlzaXRlZERhdGFbazIgLSAxXSA9PT0gMCkge1xuICAgICAgICAgIC8vaWYgKHZpc2l0ZWREYXRhW2sgKyAxXSArIHZpc2l0ZWREYXRhW2sgLSAxXSArXG4gICAgICAgICAgLy8gICAgdmlzaXRlZERhdGFbazFdICsgdmlzaXRlZERhdGFbazEgKyAxXSArIHZpc2l0ZWREYXRhW2sxIC0gMV0gK1xuICAgICAgICAgIC8vICAgIHZpc2l0ZWREYXRhW2syXSArIHZpc2l0ZWREYXRhW2syICsgMV0gKyB2aXNpdGVkRGF0YVtrMiAtIDFdID09IDgpIGNvbnRpbnVlO1xuICAgICAgICAgIGJvcmRlci5wdXNoKGspO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAvLyB3YWxrIHRocm91Z2ggcG9pbnRzIG9uIHRoZSBib3VuZGFyeSBvZiB0aGUgaW1hZ2UgaWYgbmVjZXNzYXJ5XG4gICAgLy8gaWYgdGhlIFwiYmxhY2tcIiBwb2ludCBpcyBhZGphY2VudCB0byB0aGUgYm91bmRhcnkgb2YgdGhlIGltYWdlLCBpdCBpcyBhIGJvcmRlciBwb2ludFxuICAgIGlmIChtaW5YID09IDApXG4gICAgICBmb3IgKHkgPSBtaW5ZOyB5IDwgbWF4WSArIDE7IHkrKylcbiAgICAgICAgaWYgKGRhdGFbeSAqIHddID09PSAxKVxuICAgICAgICAgIGJvcmRlci5wdXNoKHkgKiB3KTtcblxuICAgIGlmIChtYXhYID09IHcgLSAxKVxuICAgICAgZm9yICh5ID0gbWluWTsgeSA8IG1heFkgKyAxOyB5KyspXG4gICAgICAgIGlmIChkYXRhW3kgKiB3ICsgbWF4WF0gPT09IDEpXG4gICAgICAgICAgYm9yZGVyLnB1c2goeSAqIHcgKyBtYXhYKTtcblxuICAgIGlmIChtaW5ZID09IDApXG4gICAgICBmb3IgKHggPSBtaW5YOyB4IDwgbWF4WCArIDE7IHgrKylcbiAgICAgICAgaWYgKGRhdGFbeF0gPT09IDEpXG4gICAgICAgICAgYm9yZGVyLnB1c2goeCk7XG5cbiAgICBpZiAobWF4WSA9PSBoIC0gMSlcbiAgICAgIGZvciAoeCA9IG1pblg7IHggPCBtYXhYICsgMTsgeCsrKVxuICAgICAgICBpZiAoZGF0YVttYXhZICogdyArIHhdID09PSAxKVxuICAgICAgICAgIGJvcmRlci5wdXNoKG1heFkgKiB3ICsgeCk7XG5cbiAgICB2YXIgcmVzdWx0ID0gW10sIC8vIGJvcmRlciBwb2ludHMgd2l0aCByYWRpdXMtbmVpZ2hib3JzXG4gICAgICBzdGFydCwgZW5kLFxuICAgICAgZW5kWCA9IHJhZGl1cyArIHcsXG4gICAgICBlbmRZID0gcmFkaXVzICsgaCxcbiAgICAgIG4gPSByYWRpdXMgKiAyICsgMTsgLy8gc2l6ZSBvZiB0aGUgcGF0dGVybiBmb3IgcmFkaXVzLW5laWdoYm9ycyAoZnJvbSAtciB0byArciB3aXRoIHRoZSBjZW50ZXIgcG9pbnQpXG5cbiAgICBsZW4gPSBib3JkZXIubGVuZ3RoO1xuICAgIC8vIHdhbGsgdGhyb3VnaCByYWRpdXMtbmVpZ2hib3JzIG9mIGJvcmRlciBwb2ludHMgYW5kIGFkZCB0aGVtIHRvIHRoZSByZXN1bHQgYXJyYXlcbiAgICBmb3IgKGogPSAwOyBqIDwgbGVuOyBqKyspIHtcbiAgICAgIGsgPSBib3JkZXJbal07IC8vIGluZGV4IG9mIHRoZSBib3JkZXIgcG9pbnRcbiAgICAgIHRlbXBba10gPSAxOyAvLyBtYXJrIGJvcmRlciBwb2ludFxuICAgICAgcmVzdWx0LnB1c2goayk7IC8vIHNhdmUgdGhlIGJvcmRlciBwb2ludFxuICAgICAgeCA9IGsgJSB3OyAvLyBjYWxjIHggYnkgaW5kZXhcbiAgICAgIHkgPSAoayAtIHgpIC8gdzsgLy8gY2FsYyB5IGJ5IGluZGV4XG4gICAgICBzdGFydCA9IHJhZGl1cyAtIHggPiAwID8gcmFkaXVzIC0geCA6IDA7XG4gICAgICBlbmQgPSBlbmRYIC0geCA8IG4gPyBlbmRYIC0geCA6IG47IC8vIE1hdGgubWluKCgoKHcgLSAxKSAtIHgpICsgcmFkaXVzKSArIDEsIG4pO1xuICAgICAgazEgPSBrIC0gcmFkaXVzO1xuICAgICAgLy8gd2FsayB0aHJvdWdoIHgtbmVpZ2hib3JzXG4gICAgICBmb3IgKGkgPSBzdGFydDsgaSA8IGVuZDsgaSsrKSB7XG4gICAgICAgIGsyID0gazEgKyBpO1xuICAgICAgICBpZiAodGVtcFtrMl0gPT09IDApIHsgLy8gY2hlY2sgdGhlIHVuaXF1ZW5lc3NcbiAgICAgICAgICB0ZW1wW2syXSA9IDE7XG4gICAgICAgICAgcmVzdWx0LnB1c2goazIpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBzdGFydCA9IHJhZGl1cyAtIHkgPiAwID8gcmFkaXVzIC0geSA6IDA7XG4gICAgICBlbmQgPSBlbmRZIC0geSA8IG4gPyBlbmRZIC0geSA6IG47IC8vIE1hdGgubWluKCgoKGggLSAxKSAtIHkpICsgcmFkaXVzKSArIDEsIG4pO1xuICAgICAgazEgPSBrIC0gcmFkaXVzICogdztcbiAgICAgIC8vIHdhbGsgdGhyb3VnaCB5LW5laWdoYm9yc1xuICAgICAgZm9yIChpID0gc3RhcnQ7IGkgPCBlbmQ7IGkrKykge1xuICAgICAgICBrMiA9IGsxICsgaSAqIHc7XG4gICAgICAgIGlmICh0ZW1wW2syXSA9PT0gMCkgeyAvLyBjaGVjayB0aGUgdW5pcXVlbmVzc1xuICAgICAgICAgIHRlbXBbazJdID0gMTtcbiAgICAgICAgICByZXN1bHQucHVzaChrMik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuXG4gIC8qKiBBcHBseSB0aGUgZ2F1c3MtYmx1ciBmaWx0ZXIgT05MWSB0byBib3JkZXIgcG9pbnRzIHdpdGggcmFkaXVzLW5laWdoYm9yc1xuICAgKiBBbGdvcml0aG1zOiBodHRwOi8vYmxvZy5pdmFuay5uZXQvZmFzdGVzdC1nYXVzc2lhbi1ibHVyLmh0bWxcbiAgICogaHR0cDovL3d3dy5saWJyb3cuY29tL2FydGljbGVzL2FydGljbGUtOVxuICAgKiBodHRwOi8vZWx5bnhzZGsuZnJlZS5mci9leHQtZG9jcy9CbHVyL0Zhc3RfYm94X2JsdXIucGRmXG4gICAqIEBwYXJhbSAge09iamVjdH0gICAgIG1hc2s6ICAgICB7VWludDhBcnJheX0gZGF0YSwge2ludH0gd2lkdGgsIHtpbnR9IGhlaWdodCwge09iamVjdH0gYm91bmRzXG4gICAqIEBwYXJhbSAge2ludH0gICAgICAgIHJhZGl1czogICBibHVyIHJhZGl1c1xuICAgKiBAcGFyYW0gIHtVaW50OEFycmF5fSB2aXNpdGVkOiAgbWFzayBvZiB2aXNpdGVkIHBvaW50cyAob3B0aW9uYWwpXG4gICAqIEByZXR1cm4ge09iamVjdH0gICAgIG1hc2s6ICAgICB7VWludDhBcnJheX0gZGF0YSwge2ludH0gd2lkdGgsIHtpbnR9IGhlaWdodCwge09iamVjdH0gYm91bmRzXG4gICAqL1xuICBsaWIuZ2F1c3NCbHVyT25seUJvcmRlciA9IGZ1bmN0aW9uIChtYXNrLCByYWRpdXMsIHZpc2l0ZWQpIHtcblxuICAgIHZhciBib3JkZXIgPSBjcmVhdGVCb3JkZXJGb3JCbHVyKG1hc2ssIHJhZGl1cywgdmlzaXRlZCksIC8vIGdldCBib3JkZXIgcG9pbnRzIHdpdGggcmFkaXVzLW5laWdoYm9yc1xuICAgICAgd3csIGRzcSwgaSwgaiwgaywgazEsIHgsIHksIHZhbCwgc3RhcnQsIGVuZCxcbiAgICAgIG4gPSByYWRpdXMgKiAyICsgMSwgLy8gc2l6ZSBvZiB0aGUgcGF0dGVybiBmb3IgcmFkaXVzLW5laWdoYm9ycyAoZnJvbSAtciB0byArciB3aXRoIGNlbnRlciBwb2ludClcbiAgICAgIHMyID0gMiAqIHJhZGl1cyAqIHJhZGl1cyxcbiAgICAgIHdnID0gbmV3IEZsb2F0MzJBcnJheShuKSwgLy8gd2VpZ2h0c1xuICAgICAgdG90YWwgPSAwLCAvLyBzdW0gb2Ygd2VpZ2h0cyh1c2VkIGZvciBub3JtYWxpemF0aW9uKVxuICAgICAgdyA9IG1hc2sud2lkdGgsXG4gICAgICBoID0gbWFzay5oZWlnaHQsXG4gICAgICBkYXRhID0gbWFzay5kYXRhLFxuICAgICAgbWluWCA9IG1hc2suYm91bmRzLm1pblgsXG4gICAgICBtYXhYID0gbWFzay5ib3VuZHMubWF4WCxcbiAgICAgIG1pblkgPSBtYXNrLmJvdW5kcy5taW5ZLFxuICAgICAgbWF4WSA9IG1hc2suYm91bmRzLm1heFksXG4gICAgICBsZW4gPSBib3JkZXIubGVuZ3RoO1xuXG4gICAgLy8gY2FsYyBnYXVzcyB3ZWlnaHRzXG4gICAgZm9yIChpID0gMDsgaSA8IHJhZGl1czsgaSsrKSB7XG4gICAgICBkc3EgPSAocmFkaXVzIC0gaSkgKiAocmFkaXVzIC0gaSk7XG4gICAgICB3dyA9IE1hdGguZXhwKC1kc3EgLyBzMikgLyBNYXRoLlBJO1xuICAgICAgd2dbcmFkaXVzICsgaV0gPSB3Z1tyYWRpdXMgLSBpXSA9IHd3O1xuICAgICAgdG90YWwgKz0gMiAqIHd3O1xuICAgIH1cbiAgICAvLyBub3JtYWxpemF0aW9uIHdlaWdodHNcbiAgICBmb3IgKGkgPSAwOyBpIDwgbjsgaSsrKSB7XG4gICAgICB3Z1tpXSAvPSB0b3RhbDtcbiAgICB9XG5cbiAgICB2YXIgcmVzdWx0ID0gbmV3IFNlbGVjdGlvbk1hc2sodyxoLGRhdGEpLCAvLyBjb3B5IHRoZSBzb3VyY2UgbWFza1xuICAgICAgZW5kWCA9IHJhZGl1cyArIHcsXG4gICAgICBlbmRZID0gcmFkaXVzICsgaDtcblxuICAgIC8vd2FsayB0aHJvdWdoIGFsbCBib3JkZXIgcG9pbnRzIGZvciBibHVyXG4gICAgZm9yIChpID0gMDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICBrID0gYm9yZGVyW2ldOyAvLyBpbmRleCBvZiB0aGUgYm9yZGVyIHBvaW50XG4gICAgICB2YWwgPSAwO1xuICAgICAgeCA9IGsgJSB3OyAvLyBjYWxjIHggYnkgaW5kZXhcbiAgICAgIHkgPSAoayAtIHgpIC8gdzsgLy8gY2FsYyB5IGJ5IGluZGV4XG4gICAgICBzdGFydCA9IHJhZGl1cyAtIHggPiAwID8gcmFkaXVzIC0geCA6IDA7XG4gICAgICBlbmQgPSBlbmRYIC0geCA8IG4gPyBlbmRYIC0geCA6IG47IC8vIE1hdGgubWluKCgoKHcgLSAxKSAtIHgpICsgcmFkaXVzKSArIDEsIG4pO1xuICAgICAgazEgPSBrIC0gcmFkaXVzO1xuICAgICAgLy8gd2FsayB0aHJvdWdoIHgtbmVpZ2hib3JzXG4gICAgICBmb3IgKGogPSBzdGFydDsgaiA8IGVuZDsgaisrKSB7XG4gICAgICAgIHZhbCArPSBkYXRhW2sxICsgal0gKiB3Z1tqXTtcbiAgICAgIH1cbiAgICAgIGlmICh2YWwgPiAwLjUpIHtcbiAgICAgICAgcmVzdWx0LmRhdGFba10gPSAxO1xuICAgICAgICByZXN1bHQuY291bnQrKztcbiAgICAgICAgLy8gY2hlY2sgbWlubWF4XG4gICAgICAgIGlmICh4IDwgbWluWCkgbWluWCA9IHg7XG4gICAgICAgIGlmICh4ID4gbWF4WCkgbWF4WCA9IHg7XG4gICAgICAgIGlmICh5IDwgbWluWSkgbWluWSA9IHk7XG4gICAgICAgIGlmICh5ID4gbWF4WSkgbWF4WSA9IHk7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgc3RhcnQgPSByYWRpdXMgLSB5ID4gMCA/IHJhZGl1cyAtIHkgOiAwO1xuICAgICAgZW5kID0gZW5kWSAtIHkgPCBuID8gZW5kWSAtIHkgOiBuOyAvLyBNYXRoLm1pbigoKChoIC0gMSkgLSB5KSArIHJhZGl1cykgKyAxLCBuKTtcbiAgICAgIGsxID0gayAtIHJhZGl1cyAqIHc7XG4gICAgICAvLyB3YWxrIHRocm91Z2ggeS1uZWlnaGJvcnNcbiAgICAgIGZvciAoaiA9IHN0YXJ0OyBqIDwgZW5kOyBqKyspIHtcbiAgICAgICAgdmFsICs9IGRhdGFbazEgKyBqICogd10gKiB3Z1tqXTtcbiAgICAgIH1cbiAgICAgIGlmICh2YWwgPiAwLjUpIHtcbiAgICAgICAgcmVzdWx0LmRhdGFba10gPSAxO1xuICAgICAgICByZXN1bHQuY291bnQrKztcbiAgICAgICAgLy8gY2hlY2sgbWlubWF4XG4gICAgICAgIGlmICh4IDwgbWluWCkgbWluWCA9IHg7XG4gICAgICAgIGlmICh4ID4gbWF4WCkgbWF4WCA9IHg7XG4gICAgICAgIGlmICh5IDwgbWluWSkgbWluWSA9IHk7XG4gICAgICAgIGlmICh5ID4gbWF4WSkgbWF4WSA9IHk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXN1bHQuZGF0YVtrXSA9IDA7XG4gICAgICB9XG4gICAgfVxuICAgIHJlc3VsdC5ib3VuZHMgPSB7XG4gICAgICBtaW5YOiBtaW5YLFxuICAgICAgbWluWTogbWluWSxcbiAgICAgIG1heFg6IG1heFgsXG4gICAgICBtYXhZOiBtYXhZXG4gICAgfTtcblxuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG5cbiAgLyoqIENyZWF0ZSBhIGJvcmRlciBtYXNrIChvbmx5IGJvdW5kYXJ5IHBvaW50cylcbiAgICogQHBhcmFtIHtPYmplY3R9IG1hc2s6IHtVaW50OEFycmF5fSBkYXRhLCB7aW50fSB3aWR0aCwge2ludH0gaGVpZ2h0LCB7T2JqZWN0fSBib3VuZHNcbiAgICogQHJldHVybiB7T2JqZWN0fSBib3JkZXIgbWFzazoge1VpbnQ4QXJyYXl9IGRhdGEsIHtpbnR9IHdpZHRoLCB7aW50fSBoZWlnaHQsIHtPYmplY3R9IG9mZnNldFxuICAgKi9cbiAgbGliLmNyZWF0ZUJvcmRlck1hc2sgPSBmdW5jdGlvbiAobWFzaykge1xuXG4gICAgdmFyIHgsIHksIGssIGsxLCBrMixcbiAgICAgIHcgPSBtYXNrLndpZHRoLFxuICAgICAgaCA9IG1hc2suaGVpZ2h0LFxuICAgICAgZGF0YSA9IG1hc2suZGF0YSxcbiAgICAgIG1pblggPSBtYXNrLmJvdW5kcy5taW5YLFxuICAgICAgbWF4WCA9IG1hc2suYm91bmRzLm1heFgsXG4gICAgICBtaW5ZID0gbWFzay5ib3VuZHMubWluWSxcbiAgICAgIG1heFkgPSBtYXNrLmJvdW5kcy5tYXhZLFxuICAgICAgcncgPSBtYXhYIC0gbWluWCArIDEsIC8vIGJvdW5kcyBzaXplXG4gICAgICByaCA9IG1heFkgLSBtaW5ZICsgMSxcbiAgICAgIHJlc3VsdCA9IG5ldyBVaW50OEFycmF5KHJ3ICogcmgpLCAvLyByZWR1Y2VkIG1hc2sgKGJvdW5kcyBzaXplKVxuICAgICAgeDAgPSBNYXRoLm1heChtaW5YLCAxKSxcbiAgICAgIHgxID0gTWF0aC5taW4obWF4WCwgdyAtIDIpLFxuICAgICAgeTAgPSBNYXRoLm1heChtaW5ZLCAxKSxcbiAgICAgIHkxID0gTWF0aC5taW4obWF4WSwgaCAtIDIpLFxuICAgICAgY291bnQgPSAwO1xuXG4gICAgLy8gd2FsayB0aHJvdWdoIGlubmVyIHZhbHVlcyBleGNlcHQgcG9pbnRzIG9uIHRoZSBib3VuZGFyeSBvZiB0aGUgaW1hZ2VcbiAgICBmb3IgKHkgPSB5MDsgeSA8IHkxICsgMTsgeSsrKVxuICAgICAgZm9yICh4ID0geDA7IHggPCB4MSArIDE7IHgrKykge1xuICAgICAgICBrID0geSAqIHcgKyB4O1xuICAgICAgICBpZiAoZGF0YVtrXSA9PT0gMCkgY29udGludWU7IC8vIFwid2hpdGVcIiBwb2ludCBpc24ndCB0aGUgYm9yZGVyXG4gICAgICAgIGsxID0gayArIHc7IC8vIHkgKyAxXG4gICAgICAgIGsyID0gayAtIHc7IC8vIHkgLSAxXG4gICAgICAgIC8vIGNoZWNrIGlmIGFueSBuZWlnaGJvciB3aXRoIGEgXCJ3aGl0ZVwiIGNvbG9yXG4gICAgICAgIGlmIChkYXRhW2sgKyAxXSA9PT0gMCB8fCBkYXRhW2sgLSAxXSA9PT0gMCB8fFxuICAgICAgICAgIGRhdGFbazFdID09PSAwIHx8IGRhdGFbazEgKyAxXSA9PT0gMCB8fCBkYXRhW2sxIC0gMV0gPT09IDAgfHxcbiAgICAgICAgICBkYXRhW2syXSA9PT0gMCB8fCBkYXRhW2syICsgMV0gPT09IDAgfHwgZGF0YVtrMiAtIDFdID09PSAwKSB7XG4gICAgICAgICAgLy9pZiAoZGF0YVtrICsgMV0gKyBkYXRhW2sgLSAxXSArXG4gICAgICAgICAgLy8gICAgZGF0YVtrMV0gKyBkYXRhW2sxICsgMV0gKyBkYXRhW2sxIC0gMV0gK1xuICAgICAgICAgIC8vICAgIGRhdGFbazJdICsgZGF0YVtrMiArIDFdICsgZGF0YVtrMiAtIDFdID09IDgpIGNvbnRpbnVlO1xuICAgICAgICAgIHJlc3VsdFsoeSAtIG1pblkpICogcncgKyAoeCAtIG1pblgpXSA9IDE7XG4gICAgICAgICAgY291bnQrKztcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgLy8gd2FsayB0aHJvdWdoIHBvaW50cyBvbiB0aGUgYm91bmRhcnkgb2YgdGhlIGltYWdlIGlmIG5lY2Vzc2FyeVxuICAgIC8vIGlmIHRoZSBcImJsYWNrXCIgcG9pbnQgaXMgYWRqYWNlbnQgdG8gdGhlIGJvdW5kYXJ5IG9mIHRoZSBpbWFnZSwgaXQgaXMgYSBib3JkZXIgcG9pbnRcbiAgICBpZiAobWluWCA9PSAwKVxuICAgICAgZm9yICh5ID0gbWluWTsgeSA8IG1heFkgKyAxOyB5KyspXG4gICAgICAgIGlmIChkYXRhW3kgKiB3XSA9PT0gMSkge1xuICAgICAgICAgIHJlc3VsdFsoeSAtIG1pblkpICogcnddID0gMTtcbiAgICAgICAgICBjb3VudCsrO1xuICAgICAgICB9XG5cbiAgICBpZiAobWF4WCA9PSB3IC0gMSlcbiAgICAgIGZvciAoeSA9IG1pblk7IHkgPCBtYXhZICsgMTsgeSsrKVxuICAgICAgICBpZiAoZGF0YVt5ICogdyArIG1heFhdID09PSAxKSB7XG4gICAgICAgICAgcmVzdWx0Wyh5IC0gbWluWSkgKiBydyArIChtYXhYIC0gbWluWCldID0gMTtcbiAgICAgICAgICBjb3VudCsrO1xuICAgICAgICB9XG5cbiAgICBpZiAobWluWSA9PSAwKVxuICAgICAgZm9yICh4ID0gbWluWDsgeCA8IG1heFggKyAxOyB4KyspXG4gICAgICAgIGlmIChkYXRhW3hdID09PSAxKSB7XG4gICAgICAgICAgcmVzdWx0W3ggLSBtaW5YXSA9IDE7XG4gICAgICAgICAgY291bnQrKztcbiAgICAgICAgfVxuXG4gICAgaWYgKG1heFkgPT0gaCAtIDEpXG4gICAgICBmb3IgKHggPSBtaW5YOyB4IDwgbWF4WCArIDE7IHgrKylcbiAgICAgICAgaWYgKGRhdGFbbWF4WSAqIHcgKyB4XSA9PT0gMSkge1xuICAgICAgICAgIHJlc3VsdFsobWF4WSAtIG1pblkpICogcncgKyAoeCAtIG1pblgpXSA9IDE7XG4gICAgICAgICAgY291bnQrKztcbiAgICAgICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIGNvdW50OiBjb3VudCxcbiAgICAgIGRhdGE6IHJlc3VsdCxcbiAgICAgIHdpZHRoOiBydyxcbiAgICAgIGhlaWdodDogcmgsXG4gICAgICBvZmZzZXQ6IHt4OiBtaW5YLCB5OiBtaW5ZfVxuICAgIH07XG4gIH07XG5cbiAgLyoqIENyZWF0ZSBhIGJvcmRlciBpbmRleCBhcnJheSBvZiBib3VuZGFyeSBwb2ludHMgb2YgdGhlIG1hc2tcbiAgICogQHBhcmFtIHtPYmplY3R9IG1hc2s6IHtVaW50OEFycmF5fSBkYXRhLCB7aW50fSB3aWR0aCwge2ludH0gaGVpZ2h0XG4gICAqIEByZXR1cm4ge0FycmF5fSBib3JkZXIgaW5kZXggYXJyYXkgYm91bmRhcnkgcG9pbnRzIG9mIHRoZSBtYXNrXG4gICAqL1xuICBsaWIuZ2V0Qm9yZGVySW5kaWNlcyA9IGZ1bmN0aW9uIChtYXNrKSB7XG5cbiAgICB2YXIgeCwgeSwgaywgazEsIGsyLFxuICAgICAgdyA9IG1hc2sud2lkdGgsXG4gICAgICBoID0gbWFzay5oZWlnaHQsXG4gICAgICBkYXRhID0gbWFzay5kYXRhLFxuICAgICAgYm9yZGVyID0gW10sIC8vIG9ubHkgYm9yZGVyIHBvaW50c1xuICAgICAgeDEgPSB3IC0gMSxcbiAgICAgIHkxID0gaCAtIDE7XG5cbiAgICAvLyB3YWxrIHRocm91Z2ggaW5uZXIgdmFsdWVzIGV4Y2VwdCBwb2ludHMgb24gdGhlIGJvdW5kYXJ5IG9mIHRoZSBpbWFnZVxuICAgIGZvciAoeSA9IDE7IHkgPCB5MTsgeSsrKVxuICAgICAgZm9yICh4ID0gMTsgeCA8IHgxOyB4KyspIHtcbiAgICAgICAgayA9IHkgKiB3ICsgeDtcbiAgICAgICAgaWYgKGRhdGFba10gPT09IDApIGNvbnRpbnVlOyAvLyBcIndoaXRlXCIgcG9pbnQgaXNuJ3QgdGhlIGJvcmRlclxuICAgICAgICBrMSA9IGsgKyB3OyAvLyB5ICsgMVxuICAgICAgICBrMiA9IGsgLSB3OyAvLyB5IC0gMVxuICAgICAgICAvLyBjaGVjayBpZiBhbnkgbmVpZ2hib3Igd2l0aCBhIFwid2hpdGVcIiBjb2xvclxuICAgICAgICBpZiAoZGF0YVtrICsgMV0gPT09IDAgfHwgZGF0YVtrIC0gMV0gPT09IDAgfHxcbiAgICAgICAgICBkYXRhW2sxXSA9PT0gMCB8fCBkYXRhW2sxICsgMV0gPT09IDAgfHwgZGF0YVtrMSAtIDFdID09PSAwIHx8XG4gICAgICAgICAgZGF0YVtrMl0gPT09IDAgfHwgZGF0YVtrMiArIDFdID09PSAwIHx8IGRhdGFbazIgLSAxXSA9PT0gMCkge1xuICAgICAgICAgIC8vaWYgKGRhdGFbayArIDFdICsgZGF0YVtrIC0gMV0gK1xuICAgICAgICAgIC8vICAgIGRhdGFbazFdICsgZGF0YVtrMSArIDFdICsgZGF0YVtrMSAtIDFdICtcbiAgICAgICAgICAvLyAgICBkYXRhW2syXSArIGRhdGFbazIgKyAxXSArIGRhdGFbazIgLSAxXSA9PSA4KSBjb250aW51ZTtcbiAgICAgICAgICBib3JkZXIucHVzaChrKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgLy8gd2FsayB0aHJvdWdoIHBvaW50cyBvbiB0aGUgYm91bmRhcnkgb2YgdGhlIGltYWdlIGlmIG5lY2Vzc2FyeVxuICAgIC8vIGlmIHRoZSBcImJsYWNrXCIgcG9pbnQgaXMgYWRqYWNlbnQgdG8gdGhlIGJvdW5kYXJ5IG9mIHRoZSBpbWFnZSwgaXQgaXMgYSBib3JkZXIgcG9pbnRcbiAgICBmb3IgKHkgPSAwOyB5IDwgaDsgeSsrKVxuICAgICAgaWYgKGRhdGFbeSAqIHddID09PSAxKVxuICAgICAgICBib3JkZXIucHVzaCh5ICogdyk7XG5cbiAgICBmb3IgKHggPSAwOyB4IDwgdzsgeCsrKVxuICAgICAgaWYgKGRhdGFbeF0gPT09IDEpXG4gICAgICAgIGJvcmRlci5wdXNoKHgpO1xuXG4gICAgayA9IHcgLSAxO1xuICAgIGZvciAoeSA9IDA7IHkgPCBoOyB5KyspXG4gICAgICBpZiAoZGF0YVt5ICogdyArIGtdID09PSAxKVxuICAgICAgICBib3JkZXIucHVzaCh5ICogdyArIGspO1xuXG4gICAgayA9IChoIC0gMSkgKiB3O1xuICAgIGZvciAoeCA9IDA7IHggPCB3OyB4KyspXG4gICAgICBpZiAoZGF0YVtrICsgeF0gPT09IDEpXG4gICAgICAgIGJvcmRlci5wdXNoKGsgKyB4KTtcblxuICAgIHJldHVybiBib3JkZXI7XG4gIH07XG5cbiAgLyoqIENyZWF0ZSBhIGNvbXByZXNzZWQgbWFzayB3aXRoIGEgXCJ3aGl0ZVwiIGJvcmRlciAoMXB4IGJvcmRlciB3aXRoIHplcm8gdmFsdWVzKSBmb3IgdGhlIGNvbnRvdXIgdHJhY2luZ1xuICAgKiBAcGFyYW0ge09iamVjdH0gbWFzazoge1VpbnQ4QXJyYXl9IGRhdGEsIHtpbnR9IHdpZHRoLCB7aW50fSBoZWlnaHQsIHtPYmplY3R9IGJvdW5kc1xuICAgKiBAcmV0dXJuIHtPYmplY3R9IGJvcmRlciBtYXNrOiB7VWludDhBcnJheX0gZGF0YSwge2ludH0gd2lkdGgsIHtpbnR9IGhlaWdodCwge09iamVjdH0gb2Zmc2V0XG4gICAqL1xuICBmdW5jdGlvbiBwcmVwYXJlTWFzayhtYXNrKSB7XG4gICAgdmFyIHgsIHksXG4gICAgICB3ID0gbWFzay53aWR0aCxcbiAgICAgIGRhdGEgPSBtYXNrLmRhdGEsXG4gICAgICBtaW5YID0gbWFzay5ib3VuZHMubWluWCxcbiAgICAgIG1heFggPSBtYXNrLmJvdW5kcy5tYXhYLFxuICAgICAgbWluWSA9IG1hc2suYm91bmRzLm1pblksXG4gICAgICBtYXhZID0gbWFzay5ib3VuZHMubWF4WSxcbiAgICAgIHJ3ID0gbWF4WCAtIG1pblggKyAzLCAvLyBib3VuZHMgc2l6ZSArMSBweCBvbiBlYWNoIHNpZGUgKGEgXCJ3aGl0ZVwiIGJvcmRlcilcbiAgICAgIHJoID0gbWF4WSAtIG1pblkgKyAzLFxuICAgICAgcmVzdWx0ID0gbmV3IFVpbnQ4QXJyYXkocncgKiByaCk7IC8vIHJlZHVjZWQgbWFzayAoYm91bmRzIHNpemUpXG5cbiAgICAvLyB3YWxrIHRocm91Z2ggaW5uZXIgdmFsdWVzIGFuZCBjb3B5IG9ubHkgXCJibGFja1wiIHBvaW50cyB0byB0aGUgcmVzdWx0IG1hc2tcbiAgICBmb3IgKHkgPSBtaW5ZOyB5IDwgbWF4WSArIDE7IHkrKylcbiAgICAgIGZvciAoeCA9IG1pblg7IHggPCBtYXhYICsgMTsgeCsrKSB7XG4gICAgICAgIGlmIChkYXRhW3kgKiB3ICsgeF0gPT09IDEpXG4gICAgICAgICAgcmVzdWx0Wyh5IC0gbWluWSArIDEpICogcncgKyAoeCAtIG1pblggKyAxKV0gPSAxO1xuICAgICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIGRhdGE6IHJlc3VsdCxcbiAgICAgIHdpZHRoOiBydyxcbiAgICAgIGhlaWdodDogcmgsXG4gICAgICBvZmZzZXQ6IHt4OiBtaW5YIC0gMSwgeTogbWluWSAtIDF9XG4gICAgfTtcbiAgfTtcblxuICAvKiogQ3JlYXRlIGEgY29udG91ciBhcnJheSBmb3IgdGhlIGJpbmFyeSBtYXNrXG4gICAqIEFsZ29yaXRobTogaHR0cDovL3d3dy5zY2llbmNlZGlyZWN0LmNvbS9zY2llbmNlL2FydGljbGUvcGlpL1MxMDc3MzE0MjAzMDAxNDAxXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBtYXNrOiB7VWludDhBcnJheX0gZGF0YSwge2ludH0gd2lkdGgsIHtpbnR9IGhlaWdodCwge09iamVjdH0gYm91bmRzXG4gICAqIEByZXR1cm4ge0FycmF5fSBjb250b3Vyczoge0FycmF5fSBwb2ludHMsIHtib29sfSBpbm5lciwge2ludH0gbGFiZWxcbiAgICovXG4gIGxpYi50cmFjZUNvbnRvdXJzID0gZnVuY3Rpb24gKG1hc2spIHtcbiAgICB2YXIgbSA9IHByZXBhcmVNYXNrKG1hc2spLFxuICAgICAgY29udG91cnMgPSBbXSxcbiAgICAgIGxhYmVsID0gMCxcbiAgICAgIHcgPSBtLndpZHRoLFxuICAgICAgdzIgPSB3ICogMixcbiAgICAgIGggPSBtLmhlaWdodCxcbiAgICAgIHNyYyA9IG0uZGF0YSxcbiAgICAgIGR4ID0gbS5vZmZzZXQueCxcbiAgICAgIGR5ID0gbS5vZmZzZXQueSxcbiAgICAgIGJvdW5kcyxfcCxcbiAgICAgIGRlc3QgPSBuZXcgVWludDhBcnJheShzcmMpLCAvLyBsYWJlbCBtYXRyaXhcbiAgICAgIGksIGosIHgsIHksIGssIGsxLCBjLCBpbm5lciwgZGlyLCBmaXJzdCwgc2Vjb25kLCBjdXJyZW50LCBwcmV2aW91cywgbmV4dCwgZDtcblxuICAgIC8vIGFsbCBbZHgsZHldIHBhaXJzIChhcnJheSBpbmRleCBpcyB0aGUgZGlyZWN0aW9uKVxuICAgIC8vIDUgNiA3XG4gICAgLy8gNCBYIDBcbiAgICAvLyAzIDIgMVxuICAgIHZhciBkaXJlY3Rpb25zID0gW1sxLCAwXSwgWzEsIDFdLCBbMCwgMV0sIFstMSwgMV0sIFstMSwgMF0sIFstMSwgLTFdLCBbMCwgLTFdLCBbMSwgLTFdXTtcblxuICAgIGZvciAoeSA9IDE7IHkgPCBoIC0gMTsgeSsrKVxuICAgICAgZm9yICh4ID0gMTsgeCA8IHcgLSAxOyB4KyspIHtcbiAgICAgICAgayA9IHkgKiB3ICsgeDtcbiAgICAgICAgaWYgKHNyY1trXSA9PT0gMSkge1xuICAgICAgICAgIGZvciAoaSA9IC13OyBpIDwgdzI7IGkgKz0gdzIpIHsgLy8gayAtIHc6IG91dGVyIHRyYWNpbmcgKHkgLSAxKSwgayArIHc6IGlubmVyIHRyYWNpbmcgKHkgKyAxKVxuICAgICAgICAgICAgaWYgKHNyY1trICsgaV0gPT09IDAgJiYgZGVzdFtrICsgaV0gPT09IDApIHsgLy8gbmVlZCBjb250b3VyIHRyYWNpbmdcbiAgICAgICAgICAgICAgaW5uZXIgPSBpID09PSB3OyAvLyBpcyBpbm5lciBjb250b3VyIHRyYWNpbmcgP1xuICAgICAgICAgICAgICBsYWJlbCsrOyAvLyBsYWJlbCBmb3IgdGhlIG5leHQgY29udG91clxuXG4gICAgICAgICAgICAgIGMgPSBbXTtcbiAgICAgICAgICAgICAgYm91bmRzID0ge1xuICAgICAgICAgICAgICAgIG1pblggOiB3LFxuICAgICAgICAgICAgICAgIG1pblkgOiBoLFxuICAgICAgICAgICAgICAgIG1heFggOiAtMSxcbiAgICAgICAgICAgICAgICBtYXhZIDogLTEsXG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgIGRpciA9IGlubmVyID8gMiA6IDY7IC8vIHN0YXJ0IGRpcmVjdGlvblxuICAgICAgICAgICAgICBjdXJyZW50ID0gcHJldmlvdXMgPSBmaXJzdCA9IHt4OiB4LCB5OiB5fTtcbiAgICAgICAgICAgICAgc2Vjb25kID0gbnVsbDtcbiAgICAgICAgICAgICAgd2hpbGUgKHRydWUpIHtcbiAgICAgICAgICAgICAgICBkZXN0W2N1cnJlbnQueSAqIHcgKyBjdXJyZW50LnhdID0gbGFiZWw7IC8vIG1hcmsgbGFiZWwgZm9yIHRoZSBjdXJyZW50IHBvaW50XG4gICAgICAgICAgICAgICAgLy8gYnlwYXNzIGFsbCB0aGUgbmVpZ2hib3JzIGFyb3VuZCB0aGUgY3VycmVudCBwb2ludCBpbiBhIGNsb2Nrd2lzZVxuICAgICAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPCA4OyBqKyspIHtcbiAgICAgICAgICAgICAgICAgIGRpciA9IChkaXIgKyAxKSAlIDg7XG5cbiAgICAgICAgICAgICAgICAgIC8vIGdldCB0aGUgbmV4dCBwb2ludCBieSBuZXcgZGlyZWN0aW9uXG4gICAgICAgICAgICAgICAgICBkID0gZGlyZWN0aW9uc1tkaXJdOyAvLyBpbmRleCBhcyBkaXJlY3Rpb25cbiAgICAgICAgICAgICAgICAgIG5leHQgPSB7eDogY3VycmVudC54ICsgZFswXSwgeTogY3VycmVudC55ICsgZFsxXX07XG5cbiAgICAgICAgICAgICAgICAgIGsxID0gbmV4dC55ICogdyArIG5leHQueDtcbiAgICAgICAgICAgICAgICAgIGlmIChzcmNbazFdID09PSAxKSAvLyBibGFjayBib3VuZGFyeSBwaXhlbFxuICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBkZXN0W2sxXSA9IGxhYmVsOyAvLyBtYXJrIGEgbGFiZWxcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICBkZXN0W2sxXSA9IC0xOyAvLyBtYXJrIGEgd2hpdGUgYm91bmRhcnkgcGl4ZWxcbiAgICAgICAgICAgICAgICAgIG5leHQgPSBudWxsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAobmV4dCA9PT0gbnVsbCkgYnJlYWs7IC8vIG5vIG5laWdoYm91cnMgKG9uZS1wb2ludCBjb250b3VyKVxuICAgICAgICAgICAgICAgIGN1cnJlbnQgPSBuZXh0O1xuICAgICAgICAgICAgICAgIGlmIChzZWNvbmQpIHtcbiAgICAgICAgICAgICAgICAgIGlmIChwcmV2aW91cy54ID09PSBmaXJzdC54ICYmIHByZXZpb3VzLnkgPT09IGZpcnN0LnkgJiYgY3VycmVudC54ID09PSBzZWNvbmQueCAmJiBjdXJyZW50LnkgPT09IHNlY29uZC55KSB7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrOyAvLyBjcmVhdGluZyB0aGUgY29udG91ciBjb21wbGV0ZWQgd2hlbiByZXR1cm5lZCB0byBvcmlnaW5hbCBwb3NpdGlvblxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICBzZWNvbmQgPSBuZXh0O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBfcCA9IHt4OiBwcmV2aW91cy54ICsgZHgsIHk6IHByZXZpb3VzLnkgKyBkeX07XG4gICAgICAgICAgICAgICAgaWYoYm91bmRzLm1pblggPiBfcC54KWJvdW5kcy5taW5YID0gX3AueDtcbiAgICAgICAgICAgICAgICBpZihib3VuZHMubWF4WCA8IF9wLngpYm91bmRzLm1heFggPSBfcC54O1xuICAgICAgICAgICAgICAgIGlmKGJvdW5kcy5taW5ZID4gX3AueSlib3VuZHMubWluWSA9IF9wLnk7XG4gICAgICAgICAgICAgICAgaWYoYm91bmRzLm1heFkgPCBfcC55KWJvdW5kcy5tYXhZID0gX3AueTtcbiAgICAgICAgICAgICAgICBjLnB1c2goX3ApO1xuICAgICAgICAgICAgICAgIHByZXZpb3VzID0gY3VycmVudDtcbiAgICAgICAgICAgICAgICBkaXIgPSAoZGlyICsgNCkgJSA4OyAvLyBuZXh0IGRpciAoc3ltbWV0cmljYWxseSB0byB0aGUgY3VycmVudCBkaXJlY3Rpb24pXG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICBpZiAobmV4dCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgX3AgPSB7eDogZmlyc3QueCArIGR4LCB5OiBmaXJzdC55ICsgZHl9O1xuICAgICAgICAgICAgICAgIGlmKGJvdW5kcy5taW5YID4gIF9wLngpYm91bmRzLm1pblggPSAgX3AueDtcbiAgICAgICAgICAgICAgICBpZihib3VuZHMubWF4WCA8ICBfcC54KWJvdW5kcy5tYXhYID0gIF9wLng7XG4gICAgICAgICAgICAgICAgaWYoYm91bmRzLm1pblkgPiAgX3AueSlib3VuZHMubWluWSA9ICBfcC55O1xuICAgICAgICAgICAgICAgIGlmKGJvdW5kcy5tYXhZIDwgIF9wLnkpYm91bmRzLm1heFkgPSAgX3AueTtcbiAgICAgICAgICAgICAgICBjLnB1c2goX3ApOyAvLyBjbG9zZSB0aGUgY29udG91clxuICAgICAgICAgICAgICAgIGNvbnRvdXJzLnB1c2goe2lubmVyOiBpbm5lciwgbGFiZWw6IGxhYmVsLCBwb2ludHM6IGMsYm91bmRzIDogYm91bmRzfSk7IC8vIGFkZCBjb250b3VyIHRvIHRoZSBsaXN0XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgIHJldHVybiBjb250b3VycztcbiAgfTtcblxuICBmdW5jdGlvbiByZ2JUb0hzbChyLCBnLCBiKXtcbiAgICByIC89IDI1NSwgZyAvPSAyNTUsIGIgLz0gMjU1O1xuICAgIHZhciBtYXggPSBNYXRoLm1heChyLCBnLCBiKSwgbWluID0gTWF0aC5taW4ociwgZywgYik7XG4gICAgdmFyIGgsIHMsIGwgPSAobWF4ICsgbWluKSAvIDI7XG5cbiAgICBpZihtYXggPT0gbWluKXtcbiAgICAgIGggPSBzID0gMDsgLy8gYWNocm9tYXRpY1xuICAgIH1lbHNle1xuICAgICAgdmFyIGQgPSBtYXggLSBtaW47XG4gICAgICBzID0gbCA+IDAuNSA/IGQgLyAoMiAtIG1heCAtIG1pbikgOiBkIC8gKG1heCArIG1pbik7XG4gICAgICBzd2l0Y2gobWF4KXtcbiAgICAgICAgY2FzZSByOiBoID0gKGcgLSBiKSAvIGQgKyAoZyA8IGIgPyA2IDogMCk7IGJyZWFrO1xuICAgICAgICBjYXNlIGc6IGggPSAoYiAtIHIpIC8gZCArIDI7IGJyZWFrO1xuICAgICAgICBjYXNlIGI6IGggPSAociAtIGcpIC8gZCArIDQ7IGJyZWFrO1xuICAgICAgfVxuICAgICAgaCAvPSA2O1xuICAgIH1cblxuICAgIHJldHVybiBbaCAqIDI1NSwgcyogMjU1LCBsKiAyNTVdO1xuICB9XG5cbiAgbGliLnNpbXBsaWZ5Q29udG91ciA9IGZ1bmN0aW9uIChjLCBzaW1wbGlmeVRvbGVyYW50LCBzaW1wbGlmeUNvdW50KSB7XG4gICAgdmFyXG4gICAgICBpLCBqLCBrLCBjLCBwb2ludHMsIGxlbiwgcmVzUG9pbnRzLCBsc3QsIHN0YWNrLCBpZHMsXG4gICAgICBtYXhkLCBtYXhpLCBkaXN0LCByMSwgcjIsIHIxMiwgZHgsIGR5LCBwaSwgcGYsIHBsO1xuXG4gICAgcG9pbnRzID0gYy5wb2ludHM7XG4gICAgbGVuID0gYy5wb2ludHMubGVuZ3RoO1xuXG4gICAgaWYgKGxlbiA8IHNpbXBsaWZ5Q291bnQpIHsgLy8gY29udG91ciBpc24ndCBzaW1wbGlmaWVkXG4gICAgICByZXNQb2ludHMgPSBbXTtcbiAgICAgIGZvciAoayA9IDA7IGsgPCBsZW47IGsrKykge1xuICAgICAgICByZXNQb2ludHMucHVzaCh7eDogcG9pbnRzW2tdLngsIHk6IHBvaW50c1trXS55fSk7XG4gICAgICB9XG4gICAgICByZXR1cm4ge1xuICAgICAgICBib3VuZHM6IGMuYm91bmRzLCBpbm5lcjogYy5pbm5lciwgbGFiZWw6IGMubGFiZWwsIHBvaW50czogcmVzUG9pbnRzLCBpbml0aWFsQ291bnQ6IGxlbn07XG4gICAgfVxuXG4gICAgbHN0ID0gWzAsIGxlbiAtIDFdOyAvLyBhbHdheXMgYWRkIGZpcnN0IGFuZCBsYXN0IHBvaW50c1xuICAgIHN0YWNrID0gW3tmaXJzdDogMCwgbGFzdDogbGVuIC0gMX1dOyAvLyBmaXJzdCBwcm9jZXNzZWQgZWRnZVxuXG4gICAgZG8ge1xuICAgICAgaWRzID0gc3RhY2suc2hpZnQoKTtcbiAgICAgIGlmIChpZHMubGFzdCA8PSBpZHMuZmlyc3QgKyAxKSAvLyBubyBpbnRlcm1lZGlhdGUgcG9pbnRzXG4gICAgICB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuXG4gICAgICBtYXhkID0gLTEuMDsgLy8gbWF4IGRpc3RhbmNlIGZyb20gcG9pbnQgdG8gY3VycmVudCBlZGdlXG4gICAgICBtYXhpID0gaWRzLmZpcnN0OyAvLyBpbmRleCBvZiBtYXhpbWFsbHkgZGlzdGFudCBwb2ludFxuXG4gICAgICBmb3IgKGkgPSBpZHMuZmlyc3QgKyAxOyBpIDwgaWRzLmxhc3Q7IGkrKykgLy8gYnlwYXNzIGludGVybWVkaWF0ZSBwb2ludHMgaW4gZWRnZVxuICAgICAge1xuICAgICAgICAvLyBjYWxjIHRoZSBkaXN0YW5jZSBmcm9tIGN1cnJlbnQgcG9pbnQgdG8gZWRnZVxuICAgICAgICBwaSA9IHBvaW50c1tpXTtcbiAgICAgICAgcGYgPSBwb2ludHNbaWRzLmZpcnN0XTtcbiAgICAgICAgcGwgPSBwb2ludHNbaWRzLmxhc3RdO1xuICAgICAgICBkeCA9IHBpLnggLSBwZi54O1xuICAgICAgICBkeSA9IHBpLnkgLSBwZi55O1xuICAgICAgICByMSA9IE1hdGguc3FydChkeCAqIGR4ICsgZHkgKiBkeSk7XG4gICAgICAgIGR4ID0gcGkueCAtIHBsLng7XG4gICAgICAgIGR5ID0gcGkueSAtIHBsLnk7XG4gICAgICAgIHIyID0gTWF0aC5zcXJ0KGR4ICogZHggKyBkeSAqIGR5KTtcbiAgICAgICAgZHggPSBwZi54IC0gcGwueDtcbiAgICAgICAgZHkgPSBwZi55IC0gcGwueTtcbiAgICAgICAgcjEyID0gTWF0aC5zcXJ0KGR4ICogZHggKyBkeSAqIGR5KTtcbiAgICAgICAgaWYgKHIxID49IE1hdGguc3FydChyMiAqIHIyICsgcjEyICogcjEyKSkgZGlzdCA9IHIyO1xuICAgICAgICBlbHNlIGlmIChyMiA+PSBNYXRoLnNxcnQocjEgKiByMSArIHIxMiAqIHIxMikpIGRpc3QgPSByMTtcbiAgICAgICAgZWxzZSBkaXN0ID0gTWF0aC5hYnMoKGR5ICogcGkueCAtIGR4ICogcGkueSArIHBmLnggKiBwbC55IC0gcGwueCAqIHBmLnkpIC8gcjEyKTtcblxuICAgICAgICBpZiAoZGlzdCA+IG1heGQpIHtcbiAgICAgICAgICBtYXhpID0gaTsgLy8gc2F2ZSB0aGUgaW5kZXggb2YgbWF4aW1hbGx5IGRpc3RhbnQgcG9pbnRcbiAgICAgICAgICBtYXhkID0gZGlzdDtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAobWF4ZCA+IHNpbXBsaWZ5VG9sZXJhbnQpIC8vIGlmIHRoZSBtYXggXCJkZXZpYXRpb25cIiBpcyBsYXJnZXIgdGhhbiBhbGxvd2VkIHRoZW4uLi5cbiAgICAgIHtcbiAgICAgICAgbHN0LnB1c2gobWF4aSk7IC8vIGFkZCBpbmRleCB0byB0aGUgc2ltcGxpZmllZCBsaXN0XG4gICAgICAgIHN0YWNrLnB1c2goe2ZpcnN0OiBpZHMuZmlyc3QsIGxhc3Q6IG1heGl9KTsgLy8gYWRkIHRoZSBsZWZ0IHBhcnQgZm9yIHByb2Nlc3NpbmdcbiAgICAgICAgc3RhY2sucHVzaCh7Zmlyc3Q6IG1heGksIGxhc3Q6IGlkcy5sYXN0fSk7IC8vIGFkZCB0aGUgcmlnaHQgcGFydCBmb3IgcHJvY2Vzc2luZ1xuICAgICAgfVxuXG4gICAgfSB3aGlsZSAoc3RhY2subGVuZ3RoID4gMCk7XG5cbiAgICByZXNQb2ludHMgPSBbXTtcbiAgICBsZW4gPSBsc3QubGVuZ3RoO1xuICAgIGxzdC5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICByZXR1cm4gYSAtIGI7XG4gICAgfSk7IC8vIHJlc3RvcmUgaW5kZXggb3JkZXJcbiAgICBmb3IgKGsgPSAwOyBrIDwgbGVuOyBrKyspIHtcbiAgICAgIHJlc1BvaW50cy5wdXNoKHt4OiBwb2ludHNbbHN0W2tdXS54LCB5OiBwb2ludHNbbHN0W2tdXS55fSk7IC8vIGFkZCByZXN1bHQgcG9pbnRzIHRvIHRoZSBjb3JyZWN0IG9yZGVyXG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICBib3VuZHM6IGMuYm91bmRzLFxuICAgICAgaW5uZXI6IGMuaW5uZXIsIGxhYmVsOiBjLmxhYmVsLCBwb2ludHM6IHJlc1BvaW50cywgaW5pdGlhbENvdW50OiBjLnBvaW50cy5sZW5ndGhcbiAgICB9O1xuICB9O1xuXG4gIC8qKiBTaW1wbGlmeSBjb250b3Vyc1xuICAgKiBBbGdvcml0aG1zOiBodHRwOi8vcHNpbXBsLnNvdXJjZWZvcmdlLm5ldC9kb3VnbGFzLXBldWNrZXIuaHRtbFxuICAgKiBodHRwOi8vbmVlcmMuaWZtby5ydS93aWtpL2luZGV4LnBocD90aXRsZT0lRDAlQTMlRDAlQkYlRDElODAlRDAlQkUlRDElODklRDAlQjUlRDAlQkQlRDAlQjglRDAlQjVfJUQwJUJGJUQwJUJFJUQwJUJCJUQwJUI4JUQwJUIzJUQwJUJFJUQwJUJEJUQwJUIwJUQwJUJCJUQxJThDJUQwJUJEJUQwJUJFJUQwJUI5XyVEMSU4NiVEMCVCNSVEMCVCRiVEMCVCOFxuICAgKiBAcGFyYW0ge0FycmF5fSBjb250b3Vyczoge0FycmF5fSBwb2ludHMsIHtib29sfSBpbm5lciwge2ludH0gbGFiZWxcbiAgICogQHBhcmFtIHtmbG9hdH0gc2ltcGxpZnkgdG9sZXJhbnRcbiAgICogQHBhcmFtIHtpbnR9IHNpbXBsaWZ5IGNvdW50OiBtaW4gbnVtYmVyIG9mIHBvaW50cyB3aGVuIHRoZSBjb250b3VyIGlzIHNpbXBsaWZpZWRcbiAgICogQHJldHVybiB7QXJyYXl9IGNvbnRvdXJzOiB7QXJyYXl9IHBvaW50cywge2Jvb2x9IGlubmVyLCB7aW50fSBsYWJlbCwge2ludH0gaW5pdGlhbENvdW50XG4gICAqL1xuICBsaWIuc2ltcGxpZnlDb250b3VycyA9IGZ1bmN0aW9uIChjb250b3Vycywgc2ltcGxpZnlUb2xlcmFudCwgc2ltcGxpZnlDb3VudCkge1xuICAgIHZhciBsZW5Db250b3VycyA9IGNvbnRvdXJzLmxlbmd0aCxcbiAgICAgIHJlc3VsdCA9IFtdO1xuXG4gICAgLy8gd2FsayB0aHJvdWdoIGFsbCBjb250b3Vyc1xuICAgIGZvciAodmFyIGogPSAwOyBqIDwgbGVuQ29udG91cnM7IGorKykge1xuXG4gICAgICByZXN1bHQucHVzaChsaWIuc2ltcGxpZnlDb250b3VyKGNvbnRvdXJzW2pdLCBzaW1wbGlmeVRvbGVyYW50LCBzaW1wbGlmeUNvdW50KSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcblxuICByZXR1cm4gbGliO1xufSkoKTtcbmlmICh0eXBlb2YgZXhwb3J0cyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgbW9kdWxlLmV4cG9ydHMgPSBNYWdpY1dhbmQ7XG59XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL3BsdWdpbnMvbWFnaWN3YW5kLmpzIiwiZmFicmljLlN0cm9rZU1peGluID0ge1xuICBzaGFwZToge1xuICAgIHN0cm9rZVdpZHRoRnVsbDogMCxcbiAgICBzdHJva2VXaWR0aEVtcHR5OiAyLFxuICAgIHN0cm9rZVdpZHRoQWN0aXZlOiAyLFxuICAgIHN0cm9rZURhc2hBcnJheSA6IFs1LDVdLFxuICAgIGZpbGw6IFwidHJhbnNwYXJlbnRcIixcbiAgICBzdHJva2VFbXB0eTogIFwicmVkXCIsXG4gICAgc3Ryb2tlRnVsbDogICBcInJlZFwiLFxuICAgIHN0cm9rZUFjdGl2ZTogXCJncmVlblwiXG4gIH0sXG4gIHNldFNoYXBlOiBmdW5jdGlvbihlbCxjYil7XG5cbiAgICBlbCA9ICBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKHtcbiAgICAgIHN0cm9rZVdpZHRoRnVsbDogdGhpcy5zaGFwZS5zdHJva2VXaWR0aEZ1bGwsXG4gICAgICBzdHJva2VXaWR0aEVtcHR5OiB0aGlzLnNoYXBlLnN0cm9rZVdpZHRoRW1wdHksXG4gICAgICBzdHJva2VXaWR0aEFjdGl2ZTogdGhpcy5zaGFwZS5zdHJva2VXaWR0aEFjdGl2ZSxcbiAgICAgIGRhc2hBcnJheSA6IHRoaXMuc2hhcGUuZGFzaEFycmF5LFxuICAgICAgc3Ryb2tlRW1wdHk6ICB0aGlzLnNoYXBlLnN0cm9rZUVtcHR5LFxuICAgICAgc3Ryb2tlRnVsbDogIHRoaXMuc2hhcGUuc3Ryb2tlRnVsbCxcbiAgICAgIHN0cm9rZUFjdGl2ZTp0aGlzLnNoYXBlLnN0cm9rZUFjdGl2ZVxuICAgIH0sZWwpO1xuXG5cbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgIGlmKGVsICYmIGVsLnNyYyAmJiAhZWwucGF0aHMpe1xuICAgICAgZmFicmljLmxvYWRTVkdGcm9tVVJMKGVsLnNyYyxmdW5jdGlvbihwYXRocyxvcHRpb25zKSB7XG4gICAgICAgIGVsLnBhdGhzICA9IHBhdGhzO1xuICAgICAgICBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGVsLG9wdGlvbnMpO1xuICAgICAgICBfdGhpcy5fc2V0X3NoYXBlKGVsKTtcbiAgICAgICAgX3RoaXMuYWRkKF90aGlzLl9mYWJyaWNfc2hhcGUpXG4gICAgICAgIF90aGlzLl9hcHBseV9zaGFwZSgpO1xuICAgICAgICBjYiAmJiBjYigpO1xuICAgICAgfSlcbiAgICB9ZWxzZXtcbiAgICAgIF90aGlzLl9zZXRfc2hhcGUoZWwpO1xuICAgICAgX3RoaXMuYWRkKF90aGlzLl9mYWJyaWNfc2hhcGUpO1xuICAgICAgX3RoaXMuX2FwcGx5X3NoYXBlKCk7XG4gICAgICBjYiAmJiBjYigpO1xuICAgIH1cbiAgfSxcbiAgaW5pdFNoYXBlOiBmdW5jdGlvbihvcHRpb25zKXtcblxuICAgIHZhciBfc2hhcGVPcHRpb25zID0gZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChvcHRpb25zLnNoYXBlIHx8IHt9ICwgdGhpcy5zaGFwZSk7XG5cbiAgICB0aGlzLl9mYWJyaWNfc2hhcGUgPSAgbmV3IGZhYnJpYy5SZWN0KGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoe30sX3NoYXBlT3B0aW9ucyx7XG4gICAgICB3aWR0aDogICAgICAgICAgICBvcHRpb25zLndpZHRoLFxuICAgICAgaGVpZ2h0OiAgICAgICAgICAgb3B0aW9ucy5oZWlnaHQsXG4gICAgICBzdHJva2U6ICAgICAgICAgICBfc2hhcGVPcHRpb25zLnN0cm9rZUVtcHR5LFxuICAgICAgc3Ryb2tlV2lkdGg6ICAgICAgX3NoYXBlT3B0aW9ucy5zdHJva2VXaWR0aEVtcHR5XG4gICAgfSkpO1xuICB9LFxuXG4gIC8qKlxuICAgKiDvv73vv73vv73vv73vv73vv73vv73vv73vv73vv73vv73vv73vv73vv70g77+977+977+977+977+9IO+/ve+/vSDvv73vv73vv73vv73vv73vv73vv70g77+977+977+977+977+977+977+9IO+/ve+/ve+/ve+/vVxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgX2FwcGx5X3NoYXBlOiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHNoYXBlID0gdGhpcy5zaGFwZTtcblxuICAgIHZhciBfb2ZmID0gc2hhcGUgJiYgc2hhcGUub2Zmc2V0cztcblxuICAgIGlmICghX29mZikge1xuICAgICAgX29mZiA9IFswLCAwLCAwLCAwXTtcbiAgICB9XG5cbiAgICB2YXIgX29mZl91bml0cyA9IHNoYXBlICYmIHNoYXBlLm9mZnNldHNfdW5pdHM7XG5cbiAgICBpZiAoIV9vZmZfdW5pdHMpIHtcbiAgICAgIC8vaWYgKGZyYW1lLmJvcmRlcl9pbWFnZSkge3RvZG9cbiAgICAgIC8vICAgIF9vZmZfdW5pdHMgPSBmcmFtZS5ib3JkZXJfaW1hZ2Uud2lkdGhfdW5pdHMgfHwgWzAsIDAsIDAsIDBdO1xuICAgICAgLy99IGVsc2Uge1xuICAgICAgX29mZl91bml0cyA9IFsxLCAxLCAxLCAxXTtcbiAgICAgIC8vfVxuICAgIH1cblxuICAgIC8qZWxzZSBpZihzaGFwZS5vZmZzZXRzICYmIHNoYXBlLm9mZnNldHNfdW5pdHMpe1xuICAgICB2YXIgcyA9IHRoaXMuc2xpZGUuc2NhbGVWYWx1ZTtcbiAgICAgdGhpcy5fZmFicmljX3NoYXBlID0gbmV3IGZhYnJpYy5SZWN0KHtcbiAgICAgb3JpZ2luWDogJ2NlbnRlcicsXG4gICAgIG9yaWdpblk6ICdjZW50ZXInLFxuICAgICB3aWR0aDogICh0aGlzLmRhdGEuZ2VvbWV0cnkud2lkdGggLSBzaGFwZS5vZmZzZXRzWzNdIC0gc2hhcGUub2Zmc2V0c1sxXSkgKiBzLFxuICAgICBoZWlnaHQ6ICh0aGlzLmRhdGEuZ2VvbWV0cnkuaGVpZ2h0IC1zaGFwZS5vZmZzZXRzWzBdIC0gc2hhcGUub2Zmc2V0c1syXSkgKiBzXG4gICAgIH0pOyovXG5cbiAgICBfb2ZmID0ge1xuICAgICAgdG9wOiAgIF9vZmZbMF0gKiAoX29mZl91bml0c1swXSA/IHRoaXMuaGVpZ2h0IC8gMTAwIDogMSkgfHwgMCxcbiAgICAgIHJpZ2h0OiBfb2ZmWzFdICogKF9vZmZfdW5pdHNbMV0gPyB0aGlzLndpZHRoIC8gMTAwIDogMSkgfHwgMCxcbiAgICAgIGJvdHRvbTpfb2ZmWzJdICogKF9vZmZfdW5pdHNbMl0gPyB0aGlzLmhlaWdodCAvIDEwMCA6IDEpIHx8IDAsXG4gICAgICBsZWZ0OiAgX29mZlszXSAqIChfb2ZmX3VuaXRzWzNdID8gdGhpcy53aWR0aCAvIDEwMCA6IDEpIHx8IDBcbiAgICB9O1xuXG5cbiAgICB2YXIgX3cgPSAodGhpcy53aWR0aCAtIF9vZmYubGVmdCAtIF9vZmYucmlnaHQgKTsvLyAqdGhpcy5zbGlkZS5zY2FsZVZhbHVlO1xuICAgIHZhciBfaCA9ICh0aGlzLmhlaWdodCAtIF9vZmYudG9wIC0gX29mZi5ib3R0b20pOy8vICp0aGlzLnNsaWRlLnNjYWxlVmFsdWU7XG5cblxuICAgIC8vaWYodGhpcy5yZXNvdXJjZXMuZnJhbWUuZGF0YS5zaGFwZSAmJiB0aGlzLnJlc291cmNlcy5mcmFtZS5kYXRhLnNoYXBlLnJhZGl1cyl7XG4gICAgLy9cbiAgICAvLyAgICB0aGlzLl9mYWJyaWNfc2hhcGUuc2V0KHtcbiAgICAvLyAgICAgICAgbGVmdDogLXRoaXMud2lkdGgvMiAgKyBfb2ZmLmxlZnQgLFxuICAgIC8vICAgICAgICB0b3A6ICAtdGhpcy5oZWlnaHQvMiArIF9vZmYudG9wICxcbiAgICAvLyAgICAgICAgd2lkdGg6IF93IC0gX29mZi5sZWZ0IC1fb2ZmLnJpZ2h0LFxuICAgIC8vICAgICAgICBoZWlnaHQ6ICBfaCAtIF9vZmYudG9wIC1fb2ZmLmJvdHRvbSxcbiAgICAvLyAgICAgICAgc2NhbGVYOiAgMSxcbiAgICAvLyAgICAgICAgc2NhbGVZOiAgMVxuICAgIC8vICAgIH0pO1xuICAgIC8vfWVsc2V7XG5cblxuICAgIGlmKHRoaXMuc2hhcGUucGF0aCB8fCB0aGlzLnNoYXBlLnBhdGhzIHx8IHRoaXMuc2hhcGUub2Zmc2V0cyl7XG4gICAgICB2YXIgX3N3ID0gdGhpcy5zaGFwZS53aWR0aCB8fCB0aGlzLl9mYWJyaWNfc2hhcGUud2lkdGg7XG4gICAgICB2YXIgX3NoID0gdGhpcy5zaGFwZS5oZWlnaHQgfHwgdGhpcy5fZmFicmljX3NoYXBlLmhlaWdodDtcblxuICAgICAgaWYodGhpcy5fZmFicmljX3NoYXBlLnN0cm9rZVdpZHRoKXtcbiAgICAgICAgX3N3ICs9IHRoaXMuX2ZhYnJpY19zaGFwZS5zdHJva2VXaWR0aCA7XG4gICAgICAgIF9zaCArPSB0aGlzLl9mYWJyaWNfc2hhcGUuc3Ryb2tlV2lkdGggO1xuICAgICAgfVxuXG4gICAgICB2YXIgb3B0aW9ucyA9IHtcbiAgICAgICAgbGVmdDogICAtdGhpcy53aWR0aCAvIDIgKyBfb2ZmLmxlZnQsXG4gICAgICAgIHRvcDogICAgLXRoaXMuaGVpZ2h0IC8gMiArIF9vZmYudG9wLFxuICAgICAgICBzY2FsZVg6IF93IC8gMTAwIC8gKF9zdyAvIDEwMCksLy8gKiAoc2hhcGUuc2NhbGVYIHx8IDEpLFxuICAgICAgICBzY2FsZVk6IF9oIC8gMTAwIC8gKF9zaCAvIDEwMCksLy8gKiAoc2hhcGUuc2NhbGVZIHx8IDEpXG4gICAgICAgIGFuZ2xlOiAwXG4gICAgICB9O1xuICAgIH1lbHNle1xuICAgICAgdmFyIG9wdGlvbnMgPSB7XG4gICAgICAgIGxlZnQ6ICAgLXRoaXMud2lkdGggLyAyICsgX29mZi5sZWZ0LFxuICAgICAgICB0b3A6ICAgIC10aGlzLmhlaWdodCAvIDIgKyBfb2ZmLnRvcCxcbiAgICAgICAgd2lkdGg6ICAgIF93LC8vICogKHNoYXBlLnNjYWxlWCB8fCAxKSxcbiAgICAgICAgaGVpZ2h0OiAgIF9oLC8vICogKHNoYXBlLnNjYWxlWSB8fCAxKVxuICAgICAgICBhbmdsZTogMFxuICAgICAgfTtcbiAgICB9XG5cbiAgICB0aGlzLl9mYWJyaWNfc2hhcGUuc2V0KG9wdGlvbnMpO1xuXG4gICAgdGhpcy51cGRhdGVTdHJva2UoKTtcbiAgICB0aGlzLmNhbnZhcyAmJiB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgfSxcbiAgX3NldF9zaGFwZTogZnVuY3Rpb24gKHNoYXBlKSB7XG5cbiAgICBpZih0aGlzLl9mYWJyaWNfc2hhcGUpe1xuICAgICAgdGhpcy5yZW1vdmUodGhpcy5fZmFicmljX3NoYXBlKTtcbiAgICAgIGRlbGV0ZSB0aGlzLl9mYWJyaWNfc2hhcGU7XG4gICAgfVxuICAgIHZhciBfZmFicmljX3NoYXBlO1xuICAgIHZhciBfb3B0aW9ucyA9IHtcbiAgICAgIGZpbGw6ICAgICAgICAgICAgIFwidHJhbnNwYXJlbnRcIixcbiAgICAgIHN0cm9rZURhc2hBcnJheSA6IHRoaXMuc2hhcGUuZGFzaEFycmF5LFxuICAgIH07XG5cbiAgICB0aGlzLnNoYXBlID0gc2hhcGU7XG5cbiAgICBpZighc2hhcGUpe1xuICAgICAgX2ZhYnJpY19zaGFwZSA9IG5ldyBmYWJyaWMuUmVjdCh7XG4gICAgICAgIHdpZHRoOiB0aGlzLndpZHRoLFxuICAgICAgICBoZWlnaHQ6IHRoaXMuaGVpZ2h0XG4gICAgICB9KTtcbiAgICAgIF9mYWJyaWNfc2hhcGUuc2V0KF9vcHRpb25zKVxuICAgIH1lbHNlIGlmIChzaGFwZS5wYXRocykge1xuXG4gICAgICBmb3IodmFyIGkgaW4gc2hhcGUucGF0aHMpe1xuICAgICAgICBzaGFwZS5wYXRoc1tpXS5zZXQoX29wdGlvbnMpXG4gICAgICB9XG5cbiAgICAgIF9mYWJyaWNfc2hhcGUgPSBmYWJyaWMudXRpbC5ncm91cFNWR0VsZW1lbnRzKHNoYXBlLnBhdGhzLCBzaGFwZSk7XG4gICAgICAvL3RoaXMuX29iamVjdHMudW5zaGlmdCh0aGlzLl9vYmplY3RzLnBvcCgpKTtcbiAgICB9ZWxzZSB7XG4gICAgICB2YXIgcGF0aDtcblxuICAgICAgaWYgKHNoYXBlLnJhZGl1cykge1xuICAgICAgICBwYXRoID0gZmFicmljLnV0aWwuZ2V0UmFkaXVzQ2xpcFBhdGgoc2hhcGUucmFkaXVzLCBzaGFwZS5yYWRpdXNfdW5pdHMsIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KTtcbiAgICAgICAgX2ZhYnJpY19zaGFwZSA9IG5ldyBmYWJyaWMuUGF0aChwYXRoLCBfb3B0aW9ucyk7XG4gICAgICB9IGVsc2UgaWYgKHNoYXBlLnBhdGgpIHtcbiAgICAgICAgX2ZhYnJpY19zaGFwZSA9IG5ldyBmYWJyaWMuUGF0aChzaGFwZS5wYXRoLCBfb3B0aW9ucyk7XG4gICAgICAgIC8vfSBlbHNlIGlmKHNoYXBlLm9mZnNldHMpe1xuICAgICAgICAvLyAgcGF0aCA9IGZhYnJpYy51dGlsLmdldE9mZnNldHNDbGlwUGF0aChzaGFwZS5vZmZzZXRzLCBzaGFwZS5vZmZzZXRzX3VuaXRzKVxuICAgICAgfWVsc2V7XG4gICAgICAgIHBhdGggPSAgJ00gMCAwIEwge3dpZHRofSAwIEwge3dpZHRofSB7aGVpZ2h0fSBMIDAge2hlaWdodH0geicuZm9ybWF0KGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoe1xuICAgICAgICAgIHdpZHRoOiAgICAgICAgICAgIDEwMCxcbiAgICAgICAgICBoZWlnaHQ6ICAgICAgICAgICAxMDBcbiAgICAgICAgfSxzaGFwZSkpO1xuXG4gICAgICAgIF9mYWJyaWNfc2hhcGUgPSBuZXcgZmFicmljLlBhdGgocGF0aCwgX29wdGlvbnMpO1xuICAgICAgICAvL1xuICAgICAgICAvL19mYWJyaWNfc2hhcGUgPSAgbmV3IGZhYnJpYy5SZWN0KGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoe1xuICAgICAgICAvLyAgd2lkdGg6ICAgICAgICAgICAgMTAwLFxuICAgICAgICAvLyAgaGVpZ2h0OiAgICAgICAgICAgMTAwXG4gICAgICAgIC8vfSxzaGFwZSkpO1xuXG4gICAgICB9XG4gICAgfVxuXG5cbiAgICBfZmFicmljX3NoYXBlLnNldCh7XG4gICAgICBzY2FsZVg6IHRoaXMud2lkdGggIC8gX2ZhYnJpY19zaGFwZS53aWR0aCxcbiAgICAgIHNjYWxlWTogdGhpcy5oZWlnaHQgLyBfZmFicmljX3NoYXBlLmhlaWdodCxcbiAgICAgIHBlclBpeGVsVGFyZ2V0RmluZDogdHJ1ZSxcbiAgICAgIHNlbGVjdGFibGU6IGZhbHNlLFxuICAgICAgb3JpZ2luWDogXCJsZWZ0XCIsXG4gICAgICBvcmlnaW5ZOiBcInRvcFwiXG4gICAgfSk7XG5cblxuXG4gICAgdGhpcy5fZmFicmljX3NoYXBlID0gIF9mYWJyaWNfc2hhcGU7XG5cblxuICAgIGlmKHRoaXMuZWxlbWVudCl7XG4gICAgICB0aGlzLmVsZW1lbnQuY2xpcFRvID0gdGhpcy5fZmFicmljX3NoYXBlO1xuICAgIH1cblxuXG4gICAgdGhpcy51cGRhdGVTdHJva2UoKTtcblxuICB9LFxuXG4gIHVwZGF0ZVN0cm9rZTogZnVuY3Rpb24oKXtcblxuICAgIHZhciBfc3Ryb2tlID0gdGhpcy5zaGFwZS5zdHJva2U7XG4gICAgdmFyIF9zdyA9IDA7XG4gICAgaWYoKHRoaXMuX2FjdGl2YXRlZCB8fCB0aGlzLl9jbGlwbW9kZSApJiYgdGhpcy5zaGFwZS5zdHJva2VXaWR0aEFjdGl2ZSl7XG4gICAgICBfc3cgPSB0aGlzLnNoYXBlLnN0cm9rZVdpZHRoQWN0aXZlXG4gICAgfWVsc2UgaWYodGhpcy5lbGVtZW50ICYmIHRoaXMuc2hhcGUuc3Ryb2tlV2lkdGhGdWxsKXtcbiAgICAgIF9zdyA9IHRoaXMuc2hhcGUuc3Ryb2tlV2lkdGhGdWxsO1xuICAgIH1lbHNlIGlmKCF0aGlzLmVsZW1lbnQgJiYgdGhpcy5zaGFwZS5zdHJva2VXaWR0aEVtcHR5KXtcbiAgICAgIF9zdyA9IHRoaXMuc2hhcGUuc3Ryb2tlV2lkdGhFbXB0eTtcbiAgICB9XG4gICAgaWYoKHRoaXMuX2FjdGl2YXRlZCB8fCB0aGlzLl9jbGlwbW9kZSkgJiYgdGhpcy5zaGFwZS5zdHJva2VBY3RpdmUpe1xuICAgICAgX3N0cm9rZSA9IHRoaXMuc2hhcGUuc3Ryb2tlQWN0aXZlXG4gICAgfWVsc2UgaWYodGhpcy5lbGVtZW50ICYmIHRoaXMuc2hhcGUuc3Ryb2tlRnVsbCl7XG4gICAgICBfc3Ryb2tlID0gdGhpcy5zaGFwZS5zdHJva2VGdWxsO1xuICAgIH1lbHNlIGlmKCF0aGlzLmVsZW1lbnQgJiYgdGhpcy5zaGFwZS5zdHJva2VFbXB0eSl7XG4gICAgICBfc3Ryb2tlID0gdGhpcy5zaGFwZS5zdHJva2VFbXB0eTtcbiAgICB9XG5cblxuICAgIHZhciBfc3Ryb2tlV2lkdGggPSBfc3cgLyBNYXRoLm1heCh0aGlzLl9mYWJyaWNfc2hhcGUuc2NhbGVYLHRoaXMuX2ZhYnJpY19zaGFwZS5zY2FsZVkpO1xuXG4gICAgaWYodGhpcy5zaGFwZSl7XG4gICAgICBpZih0aGlzLnNoYXBlLnBhdGhzICl7XG4gICAgICAgIGZvcih2YXIgaSBpbiB0aGlzLl9mYWJyaWNfc2hhcGUucGF0aHMpe1xuICAgICAgICAgIHRoaXMuX2ZhYnJpY19zaGFwZS5wYXRoc1tpXS5zZXRTdHJva2VXaWR0aChfc3Ryb2tlV2lkdGgpXG4gICAgICAgICAgdGhpcy5fZmFicmljX3NoYXBlLnBhdGhzW2ldLnNldFN0cm9rZShfc3Ryb2tlKVxuICAgICAgICB9XG4gICAgICB9ZWxzZXtcbiAgICAgICAgdGhpcy5fZmFicmljX3NoYXBlLnNldFN0cm9rZVdpZHRoKF9zdHJva2VXaWR0aClcbiAgICAgICAgdGhpcy5fZmFicmljX3NoYXBlLnNldFN0cm9rZShfc3Ryb2tlKVxuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgLyoqXG4gICAqINC60L7QsdGK0LXQutGCINCz0L7RgtC+0LLQuNGC0YHRjyDQuiDQt9Cw0LzQtdC90YMg0YTQvtGC0L5cbiAgICovXG4gIGFjdGl2YXRlOiBmdW5jdGlvbigpe1xuICAgIHRoaXMuX2FjdGl2YXRlZCA9IHRydWU7XG4gICAgdGhpcy5fZmFicmljX3NoYXBlLnNldE9wYWNpdHkoMSk7XG4gICAgdGhpcy51cGRhdGVTdHJva2UoKTtcbiAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgfSxcbiAgLyoqXG4gICAqINC60L7QsdGK0LXQutGCINC90LUg0LPQvtGC0L7QstC40YLRgdGPINC6INC30LDQvNC10L3RgyDRhNC+0YLQvlxuICAgKi9cbiAgZGVhY3RpdmF0ZTogZnVuY3Rpb24oKXtcbiAgICB0aGlzLl9hY3RpdmF0ZWQgPSBmYWxzZTtcbiAgICB0aGlzLnVwZGF0ZVN0cm9rZSgpO1xuICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICB9LFxufVxuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9taXhpbnMvc3Ryb2tlTWl4aW4uanMiLCIvKipcbiAgQSBqYXZhc2NyaXB0IEJlemllciBjdXJ2ZSBsaWJyYXJ5IGJ5IFBvbWF4LlxuXG4gIEJhc2VkIG9uIGh0dHA6Ly9wb21heC5naXRodWIuaW8vYmV6aWVyaW5mb1xuXG4gIFRoaXMgY29kZSBpcyBNSVQgbGljZW5zZWQuXG4qKi9cbnZhciBCZXppZXIgPSAoZnVuY3Rpb24oKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIC8vIG1hdGgtaW5saW5pbmcuXG4gIHZhciBhYnMgPSBNYXRoLmFicyxcbiAgICAgIG1pbiA9IE1hdGgubWluLFxuICAgICAgbWF4ID0gTWF0aC5tYXgsXG4gICAgICBhY29zID0gTWF0aC5hY29zLFxuICAgICAgc3FydCA9IE1hdGguc3FydCxcbiAgICAgIHBpID0gTWF0aC5QSSxcbiAgICAgIC8vIGEgemVybyBjb29yZGluYXRlLCB3aGljaCBpcyBzdXJwcmlzaW5nbHkgdXNlZnVsXG4gICAgICBaRVJPID0ge3g6MCx5OjAsejowfTtcblxuXG5cblxuICAgICAgLy8gbWF0aC1pbmxpbmluZy5cbiAgICAgIHZhciBhYnMgPSBNYXRoLmFicyxcbiAgICAgICAgY29zID0gTWF0aC5jb3MsXG4gICAgICAgIHNpbiA9IE1hdGguc2luLFxuICAgICAgICBhY29zID0gTWF0aC5hY29zLFxuICAgICAgICBhdGFuMiA9IE1hdGguYXRhbjIsXG4gICAgICAgIHNxcnQgPSBNYXRoLnNxcnQsXG4gICAgICAgIHBvdyA9IE1hdGgucG93LFxuICAgICAgLy8gY3ViZSByb290IGZ1bmN0aW9uIHlpZWxkaW5nIHJlYWwgcm9vdHNcbiAgICAgICAgY3J0ID0gZnVuY3Rpb24odikgeyByZXR1cm4gKHY8MCkgPyAtcG93KC12LDEvMykgOiBwb3codiwxLzMpOyB9LFxuICAgICAgLy8gdHJpZyBjb25zdGFudHNcbiAgICAgICAgcGkgPSBNYXRoLlBJLFxuICAgICAgICB0YXUgPSAyKnBpLFxuICAgICAgICBxdWFydCA9IHBpLzIsXG4gICAgICAvLyBmbG9hdCBwcmVjaXNpb24gc2lnbmlmaWNhbnQgZGVjaW1hbFxuICAgICAgICBlcHNpbG9uID0gMC4wMDAwMDE7XG5cbiAgICAgIC8vIEJlemllciB1dGlsaXR5IGZ1bmN0aW9uc1xuICAgICAgdmFyIHV0aWxzID0ge1xuICAgICAgICAvLyBMZWdlbmRyZS1HYXVzcyBhYnNjaXNzYWUgd2l0aCBuPTI0ICh4X2kgdmFsdWVzLCBkZWZpbmVkIGF0IGk9biBhcyB0aGUgcm9vdHMgb2YgdGhlIG50aCBvcmRlciBMZWdlbmRyZSBwb2x5bm9taWFsIFBuKHgpKVxuICAgICAgICBUdmFsdWVzOiBbXG4gICAgICAgICAgLTAuMDY0MDU2ODkyODYyNjA1NjI2MDg1MDQzMDgyNjI0NzQ1MDM4NTkwOSxcbiAgICAgICAgICAgMC4wNjQwNTY4OTI4NjI2MDU2MjYwODUwNDMwODI2MjQ3NDUwMzg1OTA5LFxuICAgICAgICAgIC0wLjE5MTExODg2NzQ3MzYxNjMwOTE1ODYzOTgyMDc1NzA2OTYzMTg0MDQsXG4gICAgICAgICAgIDAuMTkxMTE4ODY3NDczNjE2MzA5MTU4NjM5ODIwNzU3MDY5NjMxODQwNCxcbiAgICAgICAgICAtMC4zMTUwNDI2Nzk2OTYxNjMzNzQzODY3OTMyOTEzMTk4MTAyNDA3ODY0LFxuICAgICAgICAgICAwLjMxNTA0MjY3OTY5NjE2MzM3NDM4Njc5MzI5MTMxOTgxMDI0MDc4NjQsXG4gICAgICAgICAgLTAuNDMzNzkzNTA3NjI2MDQ1MTM4NDg3MDg0MjMxOTEzMzQ5NzEyNDUyNCxcbiAgICAgICAgICAgMC40MzM3OTM1MDc2MjYwNDUxMzg0ODcwODQyMzE5MTMzNDk3MTI0NTI0LFxuICAgICAgICAgIC0wLjU0NTQyMTQ3MTM4ODgzOTUzNTY1ODM3NTYxNzIxODM3MjM3MDAxMDcsXG4gICAgICAgICAgIDAuNTQ1NDIxNDcxMzg4ODM5NTM1NjU4Mzc1NjE3MjE4MzcyMzcwMDEwNyxcbiAgICAgICAgICAtMC42NDgwOTM2NTE5MzY5NzU1NjkyNTI0OTU3ODY5MTA3NDc2MjY2Njk2LFxuICAgICAgICAgICAwLjY0ODA5MzY1MTkzNjk3NTU2OTI1MjQ5NTc4NjkxMDc0NzYyNjY2OTYsXG4gICAgICAgICAgLTAuNzQwMTI0MTkxNTc4NTU0MzY0MjQzODI4MTAzMDk5OTc4NDI1NTIzMixcbiAgICAgICAgICAgMC43NDAxMjQxOTE1Nzg1NTQzNjQyNDM4MjgxMDMwOTk5Nzg0MjU1MjMyLFxuICAgICAgICAgIC0wLjgyMDAwMTk4NTk3MzkwMjkyMTk1Mzk0OTg3MjY2OTc0NTIwODA3NjEsXG4gICAgICAgICAgIDAuODIwMDAxOTg1OTczOTAyOTIxOTUzOTQ5ODcyNjY5NzQ1MjA4MDc2MSxcbiAgICAgICAgICAtMC44ODY0MTU1MjcwMDQ0MDEwMzQyMTMxNTQzNDE5ODIxOTY3NTUwODczLFxuICAgICAgICAgICAwLjg4NjQxNTUyNzAwNDQwMTAzNDIxMzE1NDM0MTk4MjE5Njc1NTA4NzMsXG4gICAgICAgICAgLTAuOTM4Mjc0NTUyMDAyNzMyNzU4NTIzNjQ5MDAxNzA4NzIxNDQ5NjU0OCxcbiAgICAgICAgICAgMC45MzgyNzQ1NTIwMDI3MzI3NTg1MjM2NDkwMDE3MDg3MjE0NDk2NTQ4LFxuICAgICAgICAgIC0wLjk3NDcyODU1NTk3MTMwOTQ5ODE5ODM5MTk5MzAwODE2OTA2MTc0MTEsXG4gICAgICAgICAgIDAuOTc0NzI4NTU1OTcxMzA5NDk4MTk4MzkxOTkzMDA4MTY5MDYxNzQxMSxcbiAgICAgICAgICAtMC45OTUxODcyMTk5OTcwMjEzNjAxNzk5OTc0MDk3MDA3MzY4MTE4NzQ1LFxuICAgICAgICAgICAwLjk5NTE4NzIxOTk5NzAyMTM2MDE3OTk5NzQwOTcwMDczNjgxMTg3NDVcbiAgICAgICAgXSxcbiAgICAgICAgLy8gTGVnZW5kcmUtR2F1c3Mgd2VpZ2h0cyB3aXRoIG49MjQgKHdfaSB2YWx1ZXMsIGRlZmluZWQgYnkgYSBmdW5jdGlvbiBsaW5rZWQgdG8gaW4gdGhlIEJlemllciBwcmltZXIgYXJ0aWNsZSlcbiAgICAgICAgQ3ZhbHVlczogW1xuICAgICAgICAgIDAuMTI3OTM4MTk1MzQ2NzUyMTU2OTc0MDU2MTY1MjI0Njk1MzcxODUxNyxcbiAgICAgICAgICAwLjEyNzkzODE5NTM0Njc1MjE1Njk3NDA1NjE2NTIyNDY5NTM3MTg1MTcsXG4gICAgICAgICAgMC4xMjU4Mzc0NTYzNDY4MjgyOTYxMjEzNzUzODI1MTExODM2ODg3MjY0LFxuICAgICAgICAgIDAuMTI1ODM3NDU2MzQ2ODI4Mjk2MTIxMzc1MzgyNTExMTgzNjg4NzI2NCxcbiAgICAgICAgICAwLjEyMTY3MDQ3MjkyNzgwMzM5MTIwNDQ2MzE1MzQ3NjI2MjQyNTYwNzAsXG4gICAgICAgICAgMC4xMjE2NzA0NzI5Mjc4MDMzOTEyMDQ0NjMxNTM0NzYyNjI0MjU2MDcwLFxuICAgICAgICAgIDAuMTE1NTA1NjY4MDUzNzI1NjAxMzUzMzQ0NDgzOTA2NzgzNTU5ODYyMixcbiAgICAgICAgICAwLjExNTUwNTY2ODA1MzcyNTYwMTM1MzM0NDQ4MzkwNjc4MzU1OTg2MjIsXG4gICAgICAgICAgMC4xMDc0NDQyNzAxMTU5NjU2MzQ3ODI1NzczNDI0NDY2MDYyMjI3OTQ2LFxuICAgICAgICAgIDAuMTA3NDQ0MjcwMTE1OTY1NjM0NzgyNTc3MzQyNDQ2NjA2MjIyNzk0NixcbiAgICAgICAgICAwLjA5NzYxODY1MjEwNDExMzg4ODI2OTg4MDY2NDQ2NDI0NzE1NDQyNzksXG4gICAgICAgICAgMC4wOTc2MTg2NTIxMDQxMTM4ODgyNjk4ODA2NjQ0NjQyNDcxNTQ0Mjc5LFxuICAgICAgICAgIDAuMDg2MTkwMTYxNTMxOTUzMjc1OTE3MTg1MjAyOTgzNzQyNjY3MTg1MCxcbiAgICAgICAgICAwLjA4NjE5MDE2MTUzMTk1MzI3NTkxNzE4NTIwMjk4Mzc0MjY2NzE4NTAsXG4gICAgICAgICAgMC4wNzMzNDY0ODE0MTEwODAzMDU3MzQwMzM2MTUyNTMxMTY1MTgxMTkzLFxuICAgICAgICAgIDAuMDczMzQ2NDgxNDExMDgwMzA1NzM0MDMzNjE1MjUzMTE2NTE4MTE5MyxcbiAgICAgICAgICAwLjA1OTI5ODU4NDkxNTQzNjc4MDc0NjM2Nzc1ODUwMDEwODU4NDU0MTIsXG4gICAgICAgICAgMC4wNTkyOTg1ODQ5MTU0MzY3ODA3NDYzNjc3NTg1MDAxMDg1ODQ1NDEyLFxuICAgICAgICAgIDAuMDQ0Mjc3NDM4ODE3NDE5ODA2MTY4NjAyNzQ4MjExMzM4MjI4ODU5MyxcbiAgICAgICAgICAwLjA0NDI3NzQzODgxNzQxOTgwNjE2ODYwMjc0ODIxMTMzODIyODg1OTMsXG4gICAgICAgICAgMC4wMjg1MzEzODg2Mjg5MzM2NjMxODEzMDc4MTU5NTE4NzgyODY0NDkxLFxuICAgICAgICAgIDAuMDI4NTMxMzg4NjI4OTMzNjYzMTgxMzA3ODE1OTUxODc4Mjg2NDQ5MSxcbiAgICAgICAgICAwLjAxMjM0MTIyOTc5OTk4NzE5OTU0NjgwNTY2NzA3MDAzNzI5MTU3NTksXG4gICAgICAgICAgMC4wMTIzNDEyMjk3OTk5ODcxOTk1NDY4MDU2NjcwNzAwMzcyOTE1NzU5XG4gICAgICAgIF0sXG4gICAgICAgIGFyY2ZuOiBmdW5jdGlvbih0LCBkZXJpdmF0aXZlRm4pIHtcbiAgICAgICAgICB2YXIgZCA9IGRlcml2YXRpdmVGbih0KTtcbiAgICAgICAgICB2YXIgbCA9IGQueCpkLnggKyBkLnkqZC55O1xuICAgICAgICAgIGlmKHR5cGVvZiBkLnogIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgICAgIGwgKz0gZC56KmQuejtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHNxcnQobCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgYmV0d2VlbjogZnVuY3Rpb24odiwgbSwgTSkge1xuICAgICAgICAgIHJldHVybiAobSA8PSB2ICYmIHYgPD0gTSkgfHwgdXRpbHMuYXBwcm94aW1hdGVseSh2LCBtKSB8fCB1dGlscy5hcHByb3hpbWF0ZWx5KHYsIE0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIGFwcHJveGltYXRlbHk6IGZ1bmN0aW9uKGEsYixwcmVjaXNpb24pIHtcbiAgICAgICAgICByZXR1cm4gYWJzKGEtYikgPD0gKHByZWNpc2lvbiB8fCBlcHNpbG9uKTtcbiAgICAgICAgfSxcbiAgICAgICAgbGVuZ3RoOiBmdW5jdGlvbihkZXJpdmF0aXZlRm4pIHtcbiAgICAgICAgICB2YXIgej0wLjUsc3VtPTAsbGVuPXV0aWxzLlR2YWx1ZXMubGVuZ3RoLGksdDtcbiAgICAgICAgICBmb3IoaT0wOyBpPGxlbjsgaSsrKSB7XG4gICAgICAgICAgICB0ID0geiAqIHV0aWxzLlR2YWx1ZXNbaV0gKyB6O1xuICAgICAgICAgICAgc3VtICs9IHV0aWxzLkN2YWx1ZXNbaV0gKiB1dGlscy5hcmNmbih0LGRlcml2YXRpdmVGbik7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiB6ICogc3VtO1xuICAgICAgICB9LFxuXG4gICAgICAgIG1hcDogZnVuY3Rpb24odiwgZHMsZGUsIHRzLHRlKSB7XG4gICAgICAgICAgdmFyIGQxID0gZGUtZHMsIGQyID0gdGUtdHMsIHYyID0gIHYtZHMsIHIgPSB2Mi9kMTtcbiAgICAgICAgICByZXR1cm4gdHMgKyBkMipyO1xuICAgICAgICB9LFxuXG4gICAgICAgIGxlcnA6IGZ1bmN0aW9uKHIsIHYxLCB2Mikge1xuICAgICAgICAgIHZhciByZXQgPSB7XG4gICAgICAgICAgICB4OiB2MS54ICsgcioodjIueC12MS54KSxcbiAgICAgICAgICAgIHk6IHYxLnkgKyByKih2Mi55LXYxLnkpXG4gICAgICAgICAgfTtcbiAgICAgICAgICBpZighIXYxLnogJiYgISF2Mi56KSB7XG4gICAgICAgICAgICByZXQueiA9ICB2MS56ICsgcioodjIuei12MS56KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHJldDtcbiAgICAgICAgfSxcblxuICAgICAgICBwb2ludFRvU3RyaW5nOiBmdW5jdGlvbihwKSB7XG4gICAgICAgICAgdmFyIHMgPSBwLngrXCIvXCIrcC55O1xuICAgICAgICAgIGlmKHR5cGVvZiBwLnogIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgICAgIHMgKz0gXCIvXCIrcC56O1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gcztcbiAgICAgICAgfSxcblxuICAgICAgICBwb2ludHNUb1N0cmluZzogZnVuY3Rpb24ocG9pbnRzKSB7XG4gICAgICAgICAgcmV0dXJuIFwiW1wiICsgcG9pbnRzLm1hcCh1dGlscy5wb2ludFRvU3RyaW5nKS5qb2luKFwiLCBcIikgKyBcIl1cIjtcbiAgICAgICAgfSxcblxuICAgICAgICBjb3B5OiBmdW5jdGlvbihvYmopIHtcbiAgICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShvYmopKTtcbiAgICAgICAgfSxcblxuICAgICAgICBhbmdsZTogZnVuY3Rpb24obyx2MSx2Mikge1xuICAgICAgICAgIHZhciBkeDEgPSB2MS54IC0gby54LFxuICAgICAgICAgICAgZHkxID0gdjEueSAtIG8ueSxcbiAgICAgICAgICAgIGR4MiA9IHYyLnggLSBvLngsXG4gICAgICAgICAgICBkeTIgPSB2Mi55IC0gby55LFxuICAgICAgICAgICAgY3Jvc3MgPSBkeDEqZHkyIC0gZHkxKmR4MixcbiAgICAgICAgICAgIG0xID0gc3FydChkeDEqZHgxK2R5MSpkeTEpLFxuICAgICAgICAgICAgbTIgPSBzcXJ0KGR4MipkeDIrZHkyKmR5MiksXG4gICAgICAgICAgICBkb3Q7XG4gICAgICAgICAgZHgxLz1tMTsgZHkxLz1tMTsgZHgyLz1tMjsgZHkyLz1tMjtcbiAgICAgICAgICBkb3QgPSBkeDEqZHgyICsgZHkxKmR5MjtcbiAgICAgICAgICByZXR1cm4gYXRhbjIoY3Jvc3MsIGRvdCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLy8gcm91bmQgYXMgc3RyaW5nLCB0byBhdm9pZCByb3VuZGluZyBlcnJvcnNcbiAgICAgICAgcm91bmQ6IGZ1bmN0aW9uKHYsIGQpIHtcbiAgICAgICAgICB2YXIgcyA9ICcnICsgdjtcbiAgICAgICAgICB2YXIgcG9zID0gcy5pbmRleE9mKFwiLlwiKTtcbiAgICAgICAgICByZXR1cm4gcGFyc2VGbG9hdChzLnN1YnN0cmluZygwLHBvcysxK2QpKTtcbiAgICAgICAgfSxcblxuICAgICAgICBkaXN0OiBmdW5jdGlvbihwMSwgcDIpIHtcbiAgICAgICAgICB2YXIgZHggPSBwMS54IC0gcDIueCxcbiAgICAgICAgICAgIGR5ID0gcDEueSAtIHAyLnk7XG4gICAgICAgICAgcmV0dXJuIHNxcnQoZHgqZHgrZHkqZHkpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNsb3Nlc3Q6IGZ1bmN0aW9uKExVVCwgcG9pbnQpIHtcbiAgICAgICAgICB2YXIgbWRpc3QgPSBwb3coMiw2MyksIG1wb3MsIGQ7XG4gICAgICAgICAgTFVULmZvckVhY2goZnVuY3Rpb24ocCwgaWR4KSB7XG4gICAgICAgICAgICBkID0gdXRpbHMuZGlzdChwb2ludCwgcCk7XG4gICAgICAgICAgICBpZiAoZDxtZGlzdCkge1xuICAgICAgICAgICAgICBtZGlzdCA9IGQ7XG4gICAgICAgICAgICAgIG1wb3MgPSBpZHg7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmV0dXJuIHsgbWRpc3Q6bWRpc3QsIG1wb3M6bXBvcyB9O1xuICAgICAgICB9LFxuXG4gICAgICAgIGFiY3JhdGlvOiBmdW5jdGlvbih0LCBuKSB7XG4gICAgICAgICAgLy8gc2VlIHJhdGlvKHQpIG5vdGUgb24gaHR0cDovL3BvbWF4LmdpdGh1Yi5pby9iZXppZXJpbmZvLyNhYmNcbiAgICAgICAgICBpZiAobiE9PTIgJiYgbiE9PTMpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHR5cGVvZiB0ID09PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgICB0ID0gMC41O1xuICAgICAgICAgIH0gZWxzZSBpZiAodD09PTAgfHwgdD09PTEpIHtcbiAgICAgICAgICAgIHJldHVybiB0O1xuICAgICAgICAgIH1cbiAgICAgICAgICB2YXIgYm90dG9tID0gcG93KHQsbikgKyBwb3coMS10LG4pLCB0b3AgPSBib3R0b20gLSAxO1xuICAgICAgICAgIHJldHVybiBhYnModG9wL2JvdHRvbSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgcHJvamVjdGlvbnJhdGlvOiBmdW5jdGlvbih0LCBuKSB7XG4gICAgICAgICAgLy8gc2VlIHUodCkgbm90ZSBvbiBodHRwOi8vcG9tYXguZ2l0aHViLmlvL2JlemllcmluZm8vI2FiY1xuICAgICAgICAgIGlmIChuIT09MiAmJiBuIT09Mykge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAodHlwZW9mIHQgPT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgICAgIHQgPSAwLjU7XG4gICAgICAgICAgfSBlbHNlIGlmICh0PT09MCB8fCB0PT09MSkge1xuICAgICAgICAgICAgcmV0dXJuIHQ7XG4gICAgICAgICAgfVxuICAgICAgICAgIHZhciB0b3AgPSBwb3coMS10LCBuKSwgYm90dG9tID0gcG93KHQsbikgKyB0b3A7XG4gICAgICAgICAgcmV0dXJuIHRvcC9ib3R0b207XG4gICAgICAgIH0sXG5cbiAgICAgICAgbGxpODogZnVuY3Rpb24oeDEseTEseDIseTIseDMseTMseDQseTQpIHtcbiAgICAgICAgICB2YXIgbng9KHgxKnkyLXkxKngyKSooeDMteDQpLSh4MS14MikqKHgzKnk0LXkzKng0KSxcbiAgICAgICAgICAgIG55PSh4MSp5Mi15MSp4MikqKHkzLXk0KS0oeTEteTIpKih4Myp5NC15Myp4NCksXG4gICAgICAgICAgICBkPSh4MS14MikqKHkzLXk0KS0oeTEteTIpKih4My14NCk7XG4gICAgICAgICAgaWYoZD09MCkgeyByZXR1cm4gZmFsc2U7IH1cbiAgICAgICAgICByZXR1cm4geyB4OiBueC9kLCB5OiBueS9kIH07XG4gICAgICAgIH0sXG5cbiAgICAgICAgbGxpNDogZnVuY3Rpb24ocDEscDIscDMscDQpIHtcbiAgICAgICAgICB2YXIgeDEgPSBwMS54LCB5MSA9IHAxLnksXG4gICAgICAgICAgICB4MiA9IHAyLngsIHkyID0gcDIueSxcbiAgICAgICAgICAgIHgzID0gcDMueCwgeTMgPSBwMy55LFxuICAgICAgICAgICAgeDQgPSBwNC54LCB5NCA9IHA0Lnk7XG4gICAgICAgICAgcmV0dXJuIHV0aWxzLmxsaTgoeDEseTEseDIseTIseDMseTMseDQseTQpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGxsaTogZnVuY3Rpb24odjEsIHYyKSB7XG4gICAgICAgICAgcmV0dXJuIHV0aWxzLmxsaTQodjEsdjEuYyx2Mix2Mi5jKTtcbiAgICAgICAgfSxcblxuICAgICAgICBtYWtlbGluZTogZnVuY3Rpb24ocDEscDIpIHtcbiAgICAgICAgICB2YXIgeDEgPSBwMS54LCB5MSA9IHAxLnksIHgyID0gcDIueCwgeTIgPSBwMi55LCBkeCA9ICh4Mi14MSkvMywgZHkgPSAoeTIteTEpLzM7XG4gICAgICAgICAgcmV0dXJuIG5ldyBCZXppZXIoeDEsIHkxLCB4MStkeCwgeTErZHksIHgxKzIqZHgsIHkxKzIqZHksIHgyLCB5Mik7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZmluZGJib3g6IGZ1bmN0aW9uKHNlY3Rpb25zKSB7XG4gICAgICAgICAgdmFyIG14PTk5OTk5OTk5LG15PW14LE1YPS1teCxNWT1NWDtcbiAgICAgICAgICBzZWN0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uKHMpIHtcbiAgICAgICAgICAgIHZhciBiYm94ID0gcy5iYm94KCk7XG4gICAgICAgICAgICBpZihteCA+IGJib3gueC5taW4pIG14ID0gYmJveC54Lm1pbjtcbiAgICAgICAgICAgIGlmKG15ID4gYmJveC55Lm1pbikgbXkgPSBiYm94LnkubWluO1xuICAgICAgICAgICAgaWYoTVggPCBiYm94LngubWF4KSBNWCA9IGJib3gueC5tYXg7XG4gICAgICAgICAgICBpZihNWSA8IGJib3gueS5tYXgpIE1ZID0gYmJveC55Lm1heDtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgeDogeyBtaW46IG14LCBtaWQ6KG14K01YKS8yLCBtYXg6IE1YLCBzaXplOk1YLW14IH0sXG4gICAgICAgICAgICB5OiB7IG1pbjogbXksIG1pZDoobXkrTVkpLzIsIG1heDogTVksIHNpemU6TVktbXkgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBzaGFwZWludGVyc2VjdGlvbnM6IGZ1bmN0aW9uKHMxLCBiYm94MSwgczIsIGJib3gyKSB7XG4gICAgICAgICAgaWYoIXV0aWxzLmJib3hvdmVybGFwKGJib3gxLCBiYm94MikpIHJldHVybiBbXTtcbiAgICAgICAgICB2YXIgaW50ZXJzZWN0aW9ucyA9IFtdO1xuICAgICAgICAgIHZhciBhMSA9IFtzMS5zdGFydGNhcCwgczEuZm9yd2FyZCwgczEuYmFjaywgczEuZW5kY2FwXTtcbiAgICAgICAgICB2YXIgYTIgPSBbczIuc3RhcnRjYXAsIHMyLmZvcndhcmQsIHMyLmJhY2ssIHMyLmVuZGNhcF07XG4gICAgICAgICAgYTEuZm9yRWFjaChmdW5jdGlvbihsMSkge1xuICAgICAgICAgICAgaWYobDEudmlydHVhbCkgcmV0dXJuO1xuICAgICAgICAgICAgYTIuZm9yRWFjaChmdW5jdGlvbihsMikge1xuICAgICAgICAgICAgICBpZihsMi52aXJ0dWFsKSByZXR1cm47XG4gICAgICAgICAgICAgIHZhciBpc3MgPSBsMS5pbnRlcnNlY3RzKGwyKTtcbiAgICAgICAgICAgICAgaWYoaXNzLmxlbmd0aD4wKSB7XG4gICAgICAgICAgICAgICAgaXNzLmMxID0gbDE7XG4gICAgICAgICAgICAgICAgaXNzLmMyID0gbDI7XG4gICAgICAgICAgICAgICAgaXNzLnMxID0gczE7XG4gICAgICAgICAgICAgICAgaXNzLnMyID0gczI7XG4gICAgICAgICAgICAgICAgaW50ZXJzZWN0aW9ucy5wdXNoKGlzcyk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJldHVybiBpbnRlcnNlY3Rpb25zO1xuICAgICAgICB9LFxuXG4gICAgICAgIG1ha2VzaGFwZTogZnVuY3Rpb24oZm9yd2FyZCwgYmFjaykge1xuICAgICAgICAgIHZhciBicGwgPSBiYWNrLnBvaW50cy5sZW5ndGg7XG4gICAgICAgICAgdmFyIGZwbCA9IGZvcndhcmQucG9pbnRzLmxlbmd0aDtcbiAgICAgICAgICB2YXIgc3RhcnQgID0gdXRpbHMubWFrZWxpbmUoYmFjay5wb2ludHNbYnBsLTFdLCBmb3J3YXJkLnBvaW50c1swXSk7XG4gICAgICAgICAgdmFyIGVuZCAgICA9IHV0aWxzLm1ha2VsaW5lKGZvcndhcmQucG9pbnRzW2ZwbC0xXSwgYmFjay5wb2ludHNbMF0pO1xuICAgICAgICAgIHZhciBzaGFwZSAgPSB7XG4gICAgICAgICAgICBzdGFydGNhcDogc3RhcnQsXG4gICAgICAgICAgICBmb3J3YXJkOiBmb3J3YXJkLFxuICAgICAgICAgICAgYmFjazogYmFjayxcbiAgICAgICAgICAgIGVuZGNhcDogZW5kLFxuICAgICAgICAgICAgYmJveDogdXRpbHMuZmluZGJib3goW3N0YXJ0LCBmb3J3YXJkLCBiYWNrLCBlbmRdKVxuICAgICAgICAgIH07XG4gICAgICAgICAgdmFyIHNlbGYgPSB1dGlscztcbiAgICAgICAgICBzaGFwZS5pbnRlcnNlY3Rpb25zID0gZnVuY3Rpb24oczIpIHtcbiAgICAgICAgICAgIHJldHVybiBzZWxmLnNoYXBlaW50ZXJzZWN0aW9ucyhzaGFwZSxzaGFwZS5iYm94LHMyLHMyLmJib3gpO1xuICAgICAgICAgIH07XG4gICAgICAgICAgcmV0dXJuIHNoYXBlO1xuICAgICAgICB9LFxuXG4gICAgICAgIGdldG1pbm1heDogZnVuY3Rpb24oY3VydmUsIGQsIGxpc3QpIHtcbiAgICAgICAgICBpZighbGlzdCkgcmV0dXJuIHsgbWluOjAsIG1heDowIH07XG4gICAgICAgICAgdmFyIG1pbj0weEZGRkZGRkZGRkZGRkZGRkYsIG1heD0tbWluLHQsYztcbiAgICAgICAgICBpZihsaXN0LmluZGV4T2YoMCk9PT0tMSkgeyBsaXN0ID0gWzBdLmNvbmNhdChsaXN0KTsgfVxuICAgICAgICAgIGlmKGxpc3QuaW5kZXhPZigxKT09PS0xKSB7IGxpc3QucHVzaCgxKTsgfVxuICAgICAgICAgIGZvcih2YXIgaT0wLGxlbj1saXN0Lmxlbmd0aDsgaTxsZW47IGkrKykge1xuICAgICAgICAgICAgdCA9IGxpc3RbaV07XG4gICAgICAgICAgICBjID0gY3VydmUuZ2V0KHQpO1xuICAgICAgICAgICAgaWYoY1tkXSA8IG1pbikgeyBtaW4gPSBjW2RdOyB9XG4gICAgICAgICAgICBpZihjW2RdID4gbWF4KSB7IG1heCA9IGNbZF07IH1cbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHsgbWluOm1pbiwgbWlkOihtaW4rbWF4KS8yLCBtYXg6bWF4LCBzaXplOm1heC1taW4gfTtcbiAgICAgICAgfSxcblxuICAgICAgICBhbGlnbjogZnVuY3Rpb24ocG9pbnRzLCBsaW5lKSB7XG4gICAgICAgICAgdmFyIHR4ID0gbGluZS5wMS54LFxuICAgICAgICAgICAgdHkgPSBsaW5lLnAxLnksXG4gICAgICAgICAgICBhID0gLWF0YW4yKGxpbmUucDIueS10eSwgbGluZS5wMi54LXR4KSxcbiAgICAgICAgICAgIGQgPSBmdW5jdGlvbih2KSB7XG4gICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgeDogKHYueC10eCkqY29zKGEpIC0gKHYueS10eSkqc2luKGEpLFxuICAgICAgICAgICAgICAgIHk6ICh2LngtdHgpKnNpbihhKSArICh2LnktdHkpKmNvcyhhKVxuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICByZXR1cm4gcG9pbnRzLm1hcChkKTtcbiAgICAgICAgfSxcblxuICAgICAgICByb290czogZnVuY3Rpb24ocG9pbnRzLCBsaW5lKSB7XG4gICAgICAgICAgbGluZSA9IGxpbmUgfHwge3AxOnt4OjAseTowfSxwMjp7eDoxLHk6MH19O1xuICAgICAgICAgIHZhciBvcmRlciA9IHBvaW50cy5sZW5ndGggLSAxO1xuICAgICAgICAgIHZhciBwID0gdXRpbHMuYWxpZ24ocG9pbnRzLCBsaW5lKTtcbiAgICAgICAgICB2YXIgcmVkdWNlID0gZnVuY3Rpb24odCkgeyByZXR1cm4gMDw9dCAmJiB0IDw9MTsgfTtcblxuICAgICAgICAgIGlmIChvcmRlciA9PT0gMikge1xuICAgICAgICAgICAgdmFyIGEgPSBwWzBdLnksXG4gICAgICAgICAgICAgIGIgPSBwWzFdLnksXG4gICAgICAgICAgICAgIGMgPSBwWzJdLnksXG4gICAgICAgICAgICAgIGQgPSBhIC0gMipiICsgYztcbiAgICAgICAgICAgIGlmKGQhPT0wKSB7XG4gICAgICAgICAgICAgIHZhciBtMSA9IC1zcXJ0KGIqYi1hKmMpLFxuICAgICAgICAgICAgICAgIG0yID0gLWErYixcbiAgICAgICAgICAgICAgICB2MSA9IC0oIG0xK20yKS9kLFxuICAgICAgICAgICAgICAgIHYyID0gLSgtbTErbTIpL2Q7XG4gICAgICAgICAgICAgIHJldHVybiBbdjEsIHYyXS5maWx0ZXIocmVkdWNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYoYiE9PWMgJiYgZD09PTApIHtcbiAgICAgICAgICAgICAgcmV0dXJuIFsgKDIqYi1jKS8yKihiLWMpIF0uZmlsdGVyKHJlZHVjZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gc2VlIGh0dHA6Ly93d3cudHJhbnM0bWluZC5jb20vcGVyc29uYWxfZGV2ZWxvcG1lbnQvbWF0aGVtYXRpY3MvcG9seW5vbWlhbHMvY3ViaWNBbGdlYnJhLmh0bVxuICAgICAgICAgIHZhciBwYSA9IHBbMF0ueSxcbiAgICAgICAgICAgIHBiID0gcFsxXS55LFxuICAgICAgICAgICAgcGMgPSBwWzJdLnksXG4gICAgICAgICAgICBwZCA9IHBbM10ueSxcbiAgICAgICAgICAgIGQgPSAoLXBhICsgMypwYiAtIDMqcGMgKyBwZCksXG4gICAgICAgICAgICBhID0gKDMqcGEgLSA2KnBiICsgMypwYykgLyBkLFxuICAgICAgICAgICAgYiA9ICgtMypwYSArIDMqcGIpIC8gZCxcbiAgICAgICAgICAgIGMgPSBwYSAvIGQsXG4gICAgICAgICAgICBwID0gKDMqYiAtIGEqYSkvMyxcbiAgICAgICAgICAgIHAzID0gcC8zLFxuICAgICAgICAgICAgcSA9ICgyKmEqYSphIC0gOSphKmIgKyAyNypjKS8yNyxcbiAgICAgICAgICAgIHEyID0gcS8yLFxuICAgICAgICAgICAgZGlzY3JpbWluYW50ID0gcTIqcTIgKyBwMypwMypwMyxcbiAgICAgICAgICAgIHUxLHYxLHgxLHgyLHgzO1xuICAgICAgICAgIGlmIChkaXNjcmltaW5hbnQgPCAwKSB7XG4gICAgICAgICAgICB2YXIgbXAzID0gLXAvMyxcbiAgICAgICAgICAgICAgbXAzMyA9IG1wMyptcDMqbXAzLFxuICAgICAgICAgICAgICByID0gc3FydCggbXAzMyApLFxuICAgICAgICAgICAgICB0ID0gLXEvKDIqciksXG4gICAgICAgICAgICAgIGNvc3BoaSA9IHQ8LTEgPyAtMSA6IHQ+MSA/IDEgOiB0LFxuICAgICAgICAgICAgICBwaGkgPSBhY29zKGNvc3BoaSksXG4gICAgICAgICAgICAgIGNydHIgPSBjcnQociksXG4gICAgICAgICAgICAgIHQxID0gMipjcnRyO1xuICAgICAgICAgICAgeDEgPSB0MSAqIGNvcyhwaGkvMykgLSBhLzM7XG4gICAgICAgICAgICB4MiA9IHQxICogY29zKChwaGkrdGF1KS8zKSAtIGEvMztcbiAgICAgICAgICAgIHgzID0gdDEgKiBjb3MoKHBoaSsyKnRhdSkvMykgLSBhLzM7XG4gICAgICAgICAgICByZXR1cm4gW3gxLCB4MiwgeDNdLmZpbHRlcihyZWR1Y2UpO1xuICAgICAgICAgIH0gZWxzZSBpZihkaXNjcmltaW5hbnQgPT09IDApIHtcbiAgICAgICAgICAgIHUxID0gcTIgPCAwID8gY3J0KC1xMikgOiAtY3J0KHEyKTtcbiAgICAgICAgICAgIHgxID0gMip1MS1hLzM7XG4gICAgICAgICAgICB4MiA9IC11MSAtIGEvMztcbiAgICAgICAgICAgIHJldHVybiBbeDEseDJdLmZpbHRlcihyZWR1Y2UpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB2YXIgc2QgPSBzcXJ0KGRpc2NyaW1pbmFudCk7XG4gICAgICAgICAgICB1MSA9IGNydCgtcTIrc2QpO1xuICAgICAgICAgICAgdjEgPSBjcnQocTIrc2QpO1xuICAgICAgICAgICAgcmV0dXJuIFt1MS12MS1hLzNdLmZpbHRlcihyZWR1Y2UpOztcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgZHJvb3RzOiBmdW5jdGlvbihwKSB7XG4gICAgICAgICAgLy8gcXVhZHJhdGljIHJvb3RzIGFyZSBlYXN5XG4gICAgICAgICAgaWYocC5sZW5ndGggPT09IDMpIHtcbiAgICAgICAgICAgIHZhciBhID0gcFswXSxcbiAgICAgICAgICAgICAgYiA9IHBbMV0sXG4gICAgICAgICAgICAgIGMgPSBwWzJdLFxuICAgICAgICAgICAgICBkID0gYSAtIDIqYiArIGM7XG4gICAgICAgICAgICBpZihkIT09MCkge1xuICAgICAgICAgICAgICB2YXIgbTEgPSAtc3FydChiKmItYSpjKSxcbiAgICAgICAgICAgICAgICBtMiA9IC1hK2IsXG4gICAgICAgICAgICAgICAgdjEgPSAtKCBtMSttMikvZCxcbiAgICAgICAgICAgICAgICB2MiA9IC0oLW0xK20yKS9kO1xuICAgICAgICAgICAgICByZXR1cm4gW3YxLCB2Ml07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmKGIhPT1jICYmIGQ9PT0wKSB7XG4gICAgICAgICAgICAgIHJldHVybiBbICgyKmItYykvKDIqKGItYykpIF07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gbGluZWFyIHJvb3RzIGFyZSBldmVuIGVhc2llclxuICAgICAgICAgIGlmKHAubGVuZ3RoID09PSAyKSB7XG4gICAgICAgICAgICB2YXIgYSA9IHBbMF0sIGIgPSBwWzFdO1xuICAgICAgICAgICAgaWYoYSE9PWIpIHsgcmV0dXJuIFthLyhhLWIpXTsgfVxuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBpbmZsZWN0aW9uczogZnVuY3Rpb24ocG9pbnRzKSB7XG4gICAgICAgICAgdmFyIHAgPSB1dGlscy5hbGlnbihwb2ludHMsIHsgcDE6IHBvaW50c1swXSwgcDI6IHBvaW50c1szXSB9KSxcbiAgICAgICAgICAgIGEgPSBwWzJdLnggKiBwWzFdLnksXG4gICAgICAgICAgICBiID0gcFszXS54ICogcFsxXS55LFxuICAgICAgICAgICAgYyA9IHBbMV0ueCAqIHBbMl0ueSxcbiAgICAgICAgICAgIGQgPSBwWzNdLnggKiBwWzJdLnksXG4gICAgICAgICAgICB2MSA9IDE4ICogKC0zKmEgKyAyKmIgKyAzKmMgLSBkKSxcbiAgICAgICAgICAgIHYyID0gMTggKiAoMyphIC0gYiAtIDMqYyksXG4gICAgICAgICAgICB2MyA9IDE4ICogKGMgLSBhKTtcblxuICAgICAgICAgIGlmICh1dGlscy5hcHByb3hpbWF0ZWx5KHYxLDApKSByZXR1cm4gW107XG5cbiAgICAgICAgICB2YXIgdHJtID0gdjIqdjIgLSA0KnYxKnYzLFxuICAgICAgICAgICAgc3EgPSBNYXRoLnNxcnQodHJtKSxcbiAgICAgICAgICAgIGQgPSAyICogdjE7XG5cbiAgICAgICAgICBpZiAodXRpbHMuYXBwcm94aW1hdGVseShkLDApKSByZXR1cm4gW107XG5cbiAgICAgICAgICByZXR1cm4gWyhzcS12MikvZCwgLSh2MitzcSkvZF0uZmlsdGVyKGZ1bmN0aW9uKHIpIHtcbiAgICAgICAgICAgIHJldHVybiAoMCA8PSByICYmIHIgPD0gMSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgYmJveG92ZXJsYXA6IGZ1bmN0aW9uKGIxLGIyKSB7XG4gICAgICAgICAgdmFyIGRpbXM9Wyd4JywneSddLGxlbj1kaW1zLmxlbmd0aCxpLGRpbSxsLHQsZFxuICAgICAgICAgIGZvcihpPTA7IGk8bGVuOyBpKyspIHtcbiAgICAgICAgICAgIGRpbSA9IGRpbXNbaV07XG4gICAgICAgICAgICBsID0gYjFbZGltXS5taWQ7XG4gICAgICAgICAgICB0ID0gYjJbZGltXS5taWQ7XG4gICAgICAgICAgICBkID0gKGIxW2RpbV0uc2l6ZSArIGIyW2RpbV0uc2l6ZSkvMjtcbiAgICAgICAgICAgIGlmKGFicyhsLXQpID49IGQpIHJldHVybiBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZXhwYW5kYm94OiBmdW5jdGlvbihiYm94LCBfYmJveCkge1xuICAgICAgICAgIGlmKF9iYm94LngubWluIDwgYmJveC54Lm1pbikgeyBiYm94LngubWluID0gX2Jib3gueC5taW47IH1cbiAgICAgICAgICBpZihfYmJveC55Lm1pbiA8IGJib3gueS5taW4pIHsgYmJveC55Lm1pbiA9IF9iYm94LnkubWluOyB9XG4gICAgICAgICAgaWYoX2Jib3gueiAmJiBfYmJveC56Lm1pbiA8IGJib3guei5taW4pIHsgYmJveC56Lm1pbiA9IF9iYm94LnoubWluOyB9XG4gICAgICAgICAgaWYoX2Jib3gueC5tYXggPiBiYm94LngubWF4KSB7IGJib3gueC5tYXggPSBfYmJveC54Lm1heDsgfVxuICAgICAgICAgIGlmKF9iYm94LnkubWF4ID4gYmJveC55Lm1heCkgeyBiYm94LnkubWF4ID0gX2Jib3gueS5tYXg7IH1cbiAgICAgICAgICBpZihfYmJveC56ICYmIF9iYm94LnoubWF4ID4gYmJveC56Lm1heCkgeyBiYm94LnoubWF4ID0gX2Jib3guei5tYXg7IH1cbiAgICAgICAgICBiYm94LngubWlkID0gKGJib3gueC5taW4gKyBiYm94LngubWF4KS8yO1xuICAgICAgICAgIGJib3gueS5taWQgPSAoYmJveC55Lm1pbiArIGJib3gueS5tYXgpLzI7XG4gICAgICAgICAgaWYoYmJveC56KSB7IGJib3guei5taWQgPSAoYmJveC56Lm1pbiArIGJib3guei5tYXgpLzI7IH1cbiAgICAgICAgICBiYm94Lnguc2l6ZSA9IGJib3gueC5tYXggLSBiYm94LngubWluO1xuICAgICAgICAgIGJib3gueS5zaXplID0gYmJveC55Lm1heCAtIGJib3gueS5taW47XG4gICAgICAgICAgaWYoYmJveC56KSB7IGJib3guei5zaXplID0gYmJveC56Lm1heCAtIGJib3guei5taW47IH1cbiAgICAgICAgfSxcblxuICAgICAgICBwYWlyaXRlcmF0aW9uOiBmdW5jdGlvbihjMSxjMikge1xuICAgICAgICAgIHZhciBjMWIgPSBjMS5iYm94KCksXG4gICAgICAgICAgICBjMmIgPSBjMi5iYm94KCksXG4gICAgICAgICAgICByID0gMTAwMDAwLFxuICAgICAgICAgICAgdGhyZXNob2xkID0gMC41O1xuICAgICAgICAgIGlmKGMxYi54LnNpemUgKyBjMWIueS5zaXplIDwgdGhyZXNob2xkICYmIGMyYi54LnNpemUgKyBjMmIueS5zaXplIDwgdGhyZXNob2xkKSB7XG4gICAgICAgICAgICByZXR1cm4gWyAoKHIgKiAoYzEuX3QxK2MxLl90MikvMil8MCkvciArIFwiL1wiICsgKChyICogKGMyLl90MStjMi5fdDIpLzIpfDApL3IgXTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdmFyIGNjMSA9IGMxLnNwbGl0KDAuNSksXG4gICAgICAgICAgICBjYzIgPSBjMi5zcGxpdCgwLjUpLFxuICAgICAgICAgICAgcGFpcnMgPSBbXG4gICAgICAgICAgICAgIHtsZWZ0OiBjYzEubGVmdCwgcmlnaHQ6IGNjMi5sZWZ0IH0sXG4gICAgICAgICAgICAgIHtsZWZ0OiBjYzEubGVmdCwgcmlnaHQ6IGNjMi5yaWdodCB9LFxuICAgICAgICAgICAgICB7bGVmdDogY2MxLnJpZ2h0LCByaWdodDogY2MyLnJpZ2h0IH0sXG4gICAgICAgICAgICAgIHtsZWZ0OiBjYzEucmlnaHQsIHJpZ2h0OiBjYzIubGVmdCB9XTtcbiAgICAgICAgICBwYWlycyA9IHBhaXJzLmZpbHRlcihmdW5jdGlvbihwYWlyKSB7XG4gICAgICAgICAgICByZXR1cm4gdXRpbHMuYmJveG92ZXJsYXAocGFpci5sZWZ0LmJib3goKSxwYWlyLnJpZ2h0LmJib3goKSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgdmFyIHJlc3VsdHMgPSBbXTtcbiAgICAgICAgICBpZihwYWlycy5sZW5ndGggPT09IDApIHJldHVybiByZXN1bHRzO1xuICAgICAgICAgIHBhaXJzLmZvckVhY2goZnVuY3Rpb24ocGFpcikge1xuICAgICAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuY29uY2F0KFxuICAgICAgICAgICAgICB1dGlscy5wYWlyaXRlcmF0aW9uKHBhaXIubGVmdCwgcGFpci5yaWdodClcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSlcbiAgICAgICAgICByZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIoZnVuY3Rpb24odixpKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0cy5pbmRleE9mKHYpID09PSBpO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJldHVybiByZXN1bHRzO1xuICAgICAgICB9LFxuXG4gICAgICAgIGdldGNjZW50ZXI6IGZ1bmN0aW9uKHAxLHAyLHAzKSB7XG4gICAgICAgICAgdmFyIGR4MSA9IChwMi54IC0gcDEueCksXG4gICAgICAgICAgICBkeTEgPSAocDIueSAtIHAxLnkpLFxuICAgICAgICAgICAgZHgyID0gKHAzLnggLSBwMi54KSxcbiAgICAgICAgICAgIGR5MiA9IChwMy55IC0gcDIueSk7XG4gICAgICAgICAgdmFyIGR4MXAgPSBkeDEgKiBjb3MocXVhcnQpIC0gZHkxICogc2luKHF1YXJ0KSxcbiAgICAgICAgICAgIGR5MXAgPSBkeDEgKiBzaW4ocXVhcnQpICsgZHkxICogY29zKHF1YXJ0KSxcbiAgICAgICAgICAgIGR4MnAgPSBkeDIgKiBjb3MocXVhcnQpIC0gZHkyICogc2luKHF1YXJ0KSxcbiAgICAgICAgICAgIGR5MnAgPSBkeDIgKiBzaW4ocXVhcnQpICsgZHkyICogY29zKHF1YXJ0KTtcbiAgICAgICAgICAvLyBjaG9yZCBtaWRwb2ludHNcbiAgICAgICAgICB2YXIgbXgxID0gKHAxLnggKyBwMi54KS8yLFxuICAgICAgICAgICAgbXkxID0gKHAxLnkgKyBwMi55KS8yLFxuICAgICAgICAgICAgbXgyID0gKHAyLnggKyBwMy54KS8yLFxuICAgICAgICAgICAgbXkyID0gKHAyLnkgKyBwMy55KS8yO1xuICAgICAgICAgIC8vIG1pZHBvaW50IG9mZnNldHNcbiAgICAgICAgICB2YXIgbXgxbiA9IG14MSArIGR4MXAsXG4gICAgICAgICAgICBteTFuID0gbXkxICsgZHkxcCxcbiAgICAgICAgICAgIG14Mm4gPSBteDIgKyBkeDJwLFxuICAgICAgICAgICAgbXkybiA9IG15MiArIGR5MnA7XG4gICAgICAgICAgLy8gaW50ZXJzZWN0aW9uIG9mIHRoZXNlIGxpbmVzOlxuICAgICAgICAgIHZhciBhcmMgPSB1dGlscy5sbGk4KG14MSxteTEsbXgxbixteTFuLCBteDIsbXkyLG14Mm4sbXkybiksXG4gICAgICAgICAgICByID0gdXRpbHMuZGlzdChhcmMscDEpLFxuICAgICAgICAgIC8vIGFyYyBzdGFydC9lbmQgdmFsdWVzLCBvdmVyIG1pZCBwb2ludDpcbiAgICAgICAgICAgIHMgPSBhdGFuMihwMS55IC0gYXJjLnksIHAxLnggLSBhcmMueCksXG4gICAgICAgICAgICBtID0gYXRhbjIocDIueSAtIGFyYy55LCBwMi54IC0gYXJjLngpLFxuICAgICAgICAgICAgZSA9IGF0YW4yKHAzLnkgLSBhcmMueSwgcDMueCAtIGFyYy54KSxcbiAgICAgICAgICAgIF87XG4gICAgICAgICAgLy8gZGV0ZXJtaW5lIGFyYyBkaXJlY3Rpb24gKGN3L2NjdyBjb3JyZWN0aW9uKVxuICAgICAgICAgIGlmIChzPGUpIHtcbiAgICAgICAgICAgIC8vIGlmIHM8bTxlLCBhcmMocywgZSlcbiAgICAgICAgICAgIC8vIGlmIG08czxlLCBhcmMoZSwgcyArIHRhdSlcbiAgICAgICAgICAgIC8vIGlmIHM8ZTxtLCBhcmMoZSwgcyArIHRhdSlcbiAgICAgICAgICAgIGlmIChzPm0gfHwgbT5lKSB7IHMgKz0gdGF1OyB9XG4gICAgICAgICAgICBpZiAocz5lKSB7IF89ZTsgZT1zOyBzPV87IH1cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gaWYgZTxtPHMsIGFyYyhlLCBzKVxuICAgICAgICAgICAgLy8gaWYgbTxlPHMsIGFyYyhzLCBlICsgdGF1KVxuICAgICAgICAgICAgLy8gaWYgZTxzPG0sIGFyYyhzLCBlICsgdGF1KVxuICAgICAgICAgICAgaWYgKGU8bSAmJiBtPHMpIHsgXz1lOyBlPXM7IHM9XzsgfSBlbHNlIHsgZSArPSB0YXU7IH1cbiAgICAgICAgICB9XG4gICAgICAgICAgLy8gYXNzaWduIGFuZCBkb25lLlxuICAgICAgICAgIGFyYy5zID0gcztcbiAgICAgICAgICBhcmMuZSA9IGU7XG4gICAgICAgICAgYXJjLnIgPSByO1xuICAgICAgICAgIHJldHVybiBhcmM7XG4gICAgICAgIH1cbiAgICAgIH07XG5cblxuXG4gICAgLyoqXG4gICAgICogUG9seSBCZXppZXJcbiAgICAgKiBAcGFyYW0ge1t0eXBlXX0gY3VydmVzIFtkZXNjcmlwdGlvbl1cbiAgICAgKi9cbiAgICB2YXIgUG9seUJlemllciA9IGZ1bmN0aW9uKGN1cnZlcykge1xuICAgICAgdGhpcy5jdXJ2ZXMgPSBbXTtcbiAgICAgIHRoaXMuXzNkID0gZmFsc2U7XG4gICAgICBpZighIWN1cnZlcykge1xuICAgICAgICB0aGlzLmN1cnZlcyA9IGN1cnZlcztcbiAgICAgICAgdGhpcy5fM2QgPSB0aGlzLmN1cnZlc1swXS5fM2Q7XG4gICAgICB9XG4gICAgfVxuXG4gICAgUG9seUJlemllci5wcm90b3R5cGUgPSB7XG4gICAgICB2YWx1ZU9mOiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudG9TdHJpbmcoKTtcbiAgICAgIH0sXG4gICAgICB0b1N0cmluZzogZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB1dGlscy5wb2ludHNUb1N0cmluZyh0aGlzLnBvaW50cyk7XG4gICAgICB9LFxuICAgICAgYWRkQ3VydmU6IGZ1bmN0aW9uKGN1cnZlKSB7XG4gICAgICAgIHRoaXMuY3VydmVzLnB1c2goY3VydmUpO1xuICAgICAgICB0aGlzLl8zZCA9IHRoaXMuXzNkIHx8IGN1cnZlLl8zZDtcbiAgICAgIH0sXG4gICAgICBsZW5ndGg6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jdXJ2ZXMubWFwKGZ1bmN0aW9uKHYpIHsgcmV0dXJuIHYubGVuZ3RoKCk7IH0pLnJlZHVjZShmdW5jdGlvbihhLGIpIHsgcmV0dXJuIGErYjsgfSk7XG4gICAgICB9LFxuICAgICAgY3VydmU6IGZ1bmN0aW9uKGlkeCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jdXJ2ZXNbaWR4XTtcbiAgICAgIH0sXG4gICAgICBiYm94OiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGMgPSB0aGlzLmN1cnZlcztcbiAgICAgICAgdmFyIGJib3ggPSBjWzBdLmJib3goKTtcbiAgICAgICAgZm9yKHZhciBpPTE7IGk8Yy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIHV0aWxzLmV4cGFuZGJveChiYm94LCBjW2ldLmJib3goKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGJib3g7XG4gICAgICB9LFxuICAgICAgb2Zmc2V0OiBmdW5jdGlvbihkKSB7XG4gICAgICAgIHZhciBvZmZzZXQgPSBbXTtcbiAgICAgICAgdGhpcy5jdXJ2ZXMuZm9yRWFjaChmdW5jdGlvbih2KSB7XG4gICAgICAgICAgb2Zmc2V0ID0gb2Zmc2V0LmNvbmNhdCh2Lm9mZnNldChkKSk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gbmV3IFBvbHlCZXppZXIob2Zmc2V0KTtcbiAgICAgIH1cbiAgICB9O1xuXG5cblxuXG4gIC8qKlxuICAgKiBCZXppZXIgY3VydmUgY29uc3RydWN0b3IuIFRoZSBjb25zdHJ1Y3RvciBhcmd1bWVudCBjYW4gYmUgb25lIG9mIHRocmVlIHRoaW5nczpcbiAgICpcbiAgICogMS4gYXJyYXkvNCBvZiB7eDouLi4sIHk6Li4uLCB6Oi4uLn0sIHogb3B0aW9uYWxcbiAgICogMi4gbnVtZXJpY2FsIGFycmF5Lzggb3JkZXJlZCB4MSx5MSx4Mix5Mix4Myx5Myx4NCx5NFxuICAgKiAzLiBudW1lcmljYWwgYXJyYXkvMTIgb3JkZXJlZCB4MSx5MSx6MSx4Mix5Mix6Mix4Myx5Myx6Myx4NCx5NCx6NFxuICAgKlxuICAgKi9cbiAgdmFyIEJlemllciA9IGZ1bmN0aW9uKGNvb3Jkcykge1xuICAgIHZhciBhcmdzID0gKGNvb3JkcyAmJiBjb29yZHMuZm9yRWFjaCkgPyBjb29yZHMgOiBbXS5zbGljZS5jYWxsKGFyZ3VtZW50cyk7XG4gICAgdmFyIGNvb3JkbGVuID0gZmFsc2U7XG4gICAgaWYodHlwZW9mIGFyZ3NbMF0gPT09IFwib2JqZWN0XCIpIHtcbiAgICAgIGNvb3JkbGVuID0gYXJncy5sZW5ndGg7XG4gICAgICB2YXIgbmV3YXJncyA9IFtdO1xuICAgICAgYXJncy5mb3JFYWNoKGZ1bmN0aW9uKHBvaW50KSB7XG4gICAgICAgIFsneCcsJ3knLCd6J10uZm9yRWFjaChmdW5jdGlvbihkKSB7XG4gICAgICAgICAgaWYodHlwZW9mIHBvaW50W2RdICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgICBuZXdhcmdzLnB1c2gocG9pbnRbZF0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICAgIGFyZ3MgPSBuZXdhcmdzO1xuICAgIH1cbiAgICB2YXIgaGlnaGVyID0gZmFsc2U7XG4gICAgdmFyIGxlbiA9IGFyZ3MubGVuZ3RoO1xuICAgIGlmIChjb29yZGxlbikge1xuICAgICAgaWYoY29vcmRsZW4+NCkge1xuICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMSkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIk9ubHkgbmV3IEJlemllcihwb2ludFtdKSBpcyBhY2NlcHRlZCBmb3IgNHRoIGFuZCBoaWdoZXIgb3JkZXIgY3VydmVzXCIpO1xuICAgICAgICB9XG4gICAgICAgIGhpZ2hlciA9IHRydWU7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmKGxlbiE9PTYgJiYgbGVuIT09OCAmJiBsZW4hPT05ICYmIGxlbiE9PTEyKSB7XG4gICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoICE9PSAxKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiT25seSBuZXcgQmV6aWVyKHBvaW50W10pIGlzIGFjY2VwdGVkIGZvciA0dGggYW5kIGhpZ2hlciBvcmRlciBjdXJ2ZXNcIik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgdmFyIF8zZCA9ICghaGlnaGVyICYmIChsZW4gPT09IDkgfHwgbGVuID09PSAxMikpIHx8IChjb29yZHMgJiYgY29vcmRzWzBdICYmIHR5cGVvZiBjb29yZHNbMF0ueiAhPT0gXCJ1bmRlZmluZWRcIik7XG4gICAgdGhpcy5fM2QgPSBfM2Q7XG4gICAgdmFyIHBvaW50cyA9IFtdO1xuICAgIGZvcih2YXIgaWR4PTAsIHN0ZXA9KF8zZCA/IDMgOiAyKTsgaWR4PGxlbjsgaWR4Kz1zdGVwKSB7XG4gICAgICB2YXIgcG9pbnQgPSB7XG4gICAgICAgIHg6IGFyZ3NbaWR4XSxcbiAgICAgICAgeTogYXJnc1tpZHgrMV1cbiAgICAgIH07XG4gICAgICBpZihfM2QpIHsgcG9pbnQueiA9IGFyZ3NbaWR4KzJdIH07XG4gICAgICBwb2ludHMucHVzaChwb2ludCk7XG4gICAgfVxuICAgIHRoaXMub3JkZXIgPSBwb2ludHMubGVuZ3RoIC0gMTtcbiAgICB0aGlzLnBvaW50cyA9IHBvaW50cztcbiAgICB2YXIgZGltcyA9IFsneCcsJ3knXTtcbiAgICBpZihfM2QpIGRpbXMucHVzaCgneicpO1xuICAgIHRoaXMuZGltcyA9IGRpbXM7XG4gICAgdGhpcy5kaW1sZW4gPSBkaW1zLmxlbmd0aDtcbiAgICAoZnVuY3Rpb24oY3VydmUpIHtcbiAgICAgIHZhciBhID0gdXRpbHMuYWxpZ24ocG9pbnRzLCB7cDE6cG9pbnRzWzBdLCBwMjpwb2ludHNbY3VydmUub3JkZXJdfSk7XG4gICAgICBmb3IodmFyIGk9MDsgaTxhLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGlmKGFicyhhW2ldLnkpID4gMC4wMDAxKSB7XG4gICAgICAgICAgY3VydmUuX2xpbmVhciA9IGZhbHNlO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgY3VydmUuX2xpbmVhciA9IHRydWU7XG4gICAgfSh0aGlzKSk7XG4gICAgdGhpcy5fdDEgPSAwO1xuICAgIHRoaXMuX3QyID0gMTtcbiAgICB0aGlzLnVwZGF0ZSgpO1xuICB9O1xuXG4gIEJlemllci5mcm9tU1ZHID0gZnVuY3Rpb24oc3ZnU3RyaW5nKSB7XG4gICAgdmFyIGxpc3QgPSBzdmdTdHJpbmcubWF0Y2goL1stK10/XFxkKlxcLj9cXGQrKD86W2VFXVstK10/XFxkKyk/L2cpLm1hcChwYXJzZUZsb2F0KTtcbiAgICB2YXIgcmVsYXRpdmUgPSAvW2NxXS8udGVzdChzdmdTdHJpbmcpO1xuICAgIGlmKCFyZWxhdGl2ZSkgcmV0dXJuIG5ldyBCZXppZXIobGlzdCk7XG4gICAgbGlzdCA9IGxpc3QubWFwKGZ1bmN0aW9uKHYsaSkge1xuICAgICAgcmV0dXJuIGkgPCAyID8gdiA6IHYgKyBsaXN0W2kgJSAyXTtcbiAgICB9KTtcbiAgICByZXR1cm4gbmV3IEJlemllcihsaXN0KTtcbiAgfTtcblxuICBCZXppZXIuZ2V0QUJDID0gZnVuY3Rpb24gKG4sUyxCLEUsdCkge1xuICAgIGlmKHR5cGVvZiB0ID09PSBcInVuZGVmaW5lZFwiKSB7IHQgPSAwLjU7IH1cbiAgICB2YXIgdSA9IHV0aWxzLnByb2plY3Rpb25yYXRpbyh0LG4pLFxuICAgICAgICB1bSA9IDEtdSxcbiAgICAgICAgQyA9IHtcbiAgICAgICAgICB4OiB1KlMueCArIHVtKkUueCxcbiAgICAgICAgICB5OiB1KlMueSArIHVtKkUueVxuICAgICAgICB9LFxuICAgICAgICBzID0gdXRpbHMuYWJjcmF0aW8odCxuKSxcbiAgICAgICAgQSA9IHtcbiAgICAgICAgICB4OiBCLnggKyAoQi54LUMueCkvcyxcbiAgICAgICAgICB5OiBCLnkgKyAoQi55LUMueSkvc1xuICAgICAgICB9O1xuICAgIHJldHVybiB7IEE6QSwgQjpCLCBDOkMgfTtcbiAgfVxuXG4gIEJlemllci5xdWFkcmF0aWNGcm9tUG9pbnRzID0gZnVuY3Rpb24ocDEscDIscDMsIHQpIHtcbiAgICBpZih0eXBlb2YgdCA9PT0gXCJ1bmRlZmluZWRcIikgeyB0ID0gMC41OyB9XG4gICAgLy8gc2hvcnRjdXRzLCBhbHRob3VnaCB0aGV5J3JlIHJlYWxseSBkdW1iXG4gICAgaWYodD09PTApIHsgcmV0dXJuIG5ldyBCZXppZXIocDIscDIscDMpOyB9XG4gICAgaWYodD09PTEpIHsgcmV0dXJuIG5ldyBCZXppZXIocDEscDIscDIpOyB9XG4gICAgLy8gcmVhbCBmaXR0aW5nLlxuICAgIHZhciBhYmMgPSBCZXppZXIuZ2V0QUJDKDIscDEscDIscDMsdCk7XG4gICAgcmV0dXJuIG5ldyBCZXppZXIocDEsIGFiYy5BLCBwMyk7XG4gIH07XG5cbiAgQmV6aWVyLmN1YmljRnJvbVBvaW50cyA9IGZ1bmN0aW9uKFMsQixFLCB0LGQxKSB7XG4gICAgaWYodHlwZW9mIHQgPT09IFwidW5kZWZpbmVkXCIpIHsgdCA9IDAuNTsgfVxuICAgIHZhciBhYmMgPSBCZXppZXIuZ2V0QUJDKDMsUyxCLEUsdCk7XG4gICAgaWYodHlwZW9mIGQxID09PSBcInVuZGVmaW5lZFwiKSB7IGQxID0gdXRpbHMuZGlzdChCLGFiYy5DKTsgfVxuICAgIHZhciBkMiA9IGQxICogKDEtdCkvdDtcblxuICAgIHZhciBzZWxlbiA9IHV0aWxzLmRpc3QoUyxFKSxcbiAgICAgICAgbHggPSAoRS54LVMueCkvc2VsZW4sXG4gICAgICAgIGx5ID0gKEUueS1TLnkpL3NlbGVuLFxuICAgICAgICBieDEgPSBkMSAqIGx4LFxuICAgICAgICBieTEgPSBkMSAqIGx5LFxuICAgICAgICBieDIgPSBkMiAqIGx4LFxuICAgICAgICBieTIgPSBkMiAqIGx5O1xuICAgIC8vIGRlcml2YXRpb24gb2YgbmV3IGh1bGwgY29vcmRpbmF0ZXNcbiAgICB2YXIgZTEgID0geyB4OiBCLnggLSBieDEsIHk6IEIueSAtIGJ5MSB9LFxuICAgICAgICBlMiAgPSB7IHg6IEIueCArIGJ4MiwgeTogQi55ICsgYnkyIH0sXG4gICAgICAgIEEgPSBhYmMuQSxcbiAgICAgICAgdjEgID0geyB4OiBBLnggKyAoZTEueC1BLngpLygxLXQpLCB5OiBBLnkgKyAoZTEueS1BLnkpLygxLXQpIH0sXG4gICAgICAgIHYyICA9IHsgeDogQS54ICsgKGUyLngtQS54KS8odCksIHk6IEEueSArIChlMi55LUEueSkvKHQpIH0sXG4gICAgICAgIG5jMSA9IHsgeDogUy54ICsgKHYxLngtUy54KS8odCksIHk6IFMueSArICh2MS55LVMueSkvKHQpIH0sXG4gICAgICAgIG5jMiA9IHsgeDogRS54ICsgKHYyLngtRS54KS8oMS10KSwgeTogRS55ICsgKHYyLnktRS55KS8oMS10KSB9O1xuICAgIC8vIC4uLmRvbmVcbiAgICByZXR1cm4gbmV3IEJlemllcihTLG5jMSxuYzIsRSk7XG4gIH07XG5cbiAgdmFyIGdldFV0aWxzID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHV0aWxzO1xuICB9O1xuXG4gIEJlemllci5nZXRVdGlscyA9IGdldFV0aWxzO1xuXG4gIEJlemllci5wcm90b3R5cGUgPSB7XG4gICAgZ2V0VXRpbHM6IGdldFV0aWxzLFxuICAgIHZhbHVlT2Y6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHRoaXMudG9TdHJpbmcoKTtcbiAgICB9LFxuICAgIHRvU3RyaW5nOiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiB1dGlscy5wb2ludHNUb1N0cmluZyh0aGlzLnBvaW50cyk7XG4gICAgfSxcbiAgICB0b1NWRzogZnVuY3Rpb24ocmVsYXRpdmUpIHtcbiAgICAgIGlmKHRoaXMuXzNkKSByZXR1cm4gZmFsc2U7XG4gICAgICB2YXIgcCA9IHRoaXMucG9pbnRzLFxuICAgICAgICAgIHggPSBwWzBdLngsXG4gICAgICAgICAgeSA9IHBbMF0ueSxcbiAgICAgICAgICBzID0gW1wiTVwiLCB4LCB5LCAodGhpcy5vcmRlcj09PTIgPyBcIlFcIjpcIkNcIildO1xuICAgICAgZm9yKHZhciBpPTEsIGxhc3Q9cC5sZW5ndGg7IGk8bGFzdDsgaSsrKSB7XG4gICAgICAgIHMucHVzaChwW2ldLngpO1xuICAgICAgICBzLnB1c2gocFtpXS55KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBzLmpvaW4oXCIgXCIpO1xuICAgIH0sXG4gICAgdXBkYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgIC8vIG9uZS10aW1lIGNvbXB1dGUgZGVyaXZhdGl2ZSBjb29yZGluYXRlc1xuICAgICAgdGhpcy5kcG9pbnRzID0gW107XG4gICAgICBmb3IodmFyIHA9dGhpcy5wb2ludHMsIGQ9cC5sZW5ndGgsIGM9ZC0xOyBkPjE7IGQtLSwgYy0tKSB7XG4gICAgICAgIHZhciBsaXN0ID0gW107XG4gICAgICAgIGZvcih2YXIgaj0wLCBkcHQ7IGo8YzsgaisrKSB7XG4gICAgICAgICAgZHB0ID0ge1xuICAgICAgICAgICAgeDogYyAqIChwW2orMV0ueCAtIHBbal0ueCksXG4gICAgICAgICAgICB5OiBjICogKHBbaisxXS55IC0gcFtqXS55KVxuICAgICAgICAgIH07XG4gICAgICAgICAgaWYodGhpcy5fM2QpIHtcbiAgICAgICAgICAgIGRwdC56ID0gYyAqIChwW2orMV0ueiAtIHBbal0ueik7XG4gICAgICAgICAgfVxuICAgICAgICAgIGxpc3QucHVzaChkcHQpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZHBvaW50cy5wdXNoKGxpc3QpO1xuICAgICAgICBwID0gbGlzdDtcbiAgICAgIH07XG4gICAgICB0aGlzLmNvbXB1dGVkaXJlY3Rpb24oKTtcbiAgICB9LFxuICAgIGNvbXB1dGVkaXJlY3Rpb246IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIHBvaW50cyA9IHRoaXMucG9pbnRzO1xuICAgICAgdmFyIGFuZ2xlID0gdXRpbHMuYW5nbGUocG9pbnRzWzBdLCBwb2ludHNbdGhpcy5vcmRlcl0sIHBvaW50c1sxXSk7XG4gICAgICB0aGlzLmNsb2Nrd2lzZSA9IGFuZ2xlID4gMDtcbiAgICB9LFxuICAgIGxlbmd0aDogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gdXRpbHMubGVuZ3RoKHRoaXMuZGVyaXZhdGl2ZS5iaW5kKHRoaXMpKTtcbiAgICB9LFxuICAgIF9sdXQ6IFtdLFxuICAgIGdldExVVDogZnVuY3Rpb24oc3RlcHMpIHtcbiAgICAgIHN0ZXBzID0gc3RlcHMgfHwgMTAwO1xuICAgICAgaWYgKHRoaXMuX2x1dC5sZW5ndGggPT09IHN0ZXBzKSB7IHJldHVybiB0aGlzLl9sdXQ7IH1cbiAgICAgIHRoaXMuX2x1dCA9IFtdO1xuICAgICAgZm9yKHZhciB0PTA7IHQ8PXN0ZXBzOyB0KyspIHtcbiAgICAgICAgdGhpcy5fbHV0LnB1c2godGhpcy5jb21wdXRlKHQvc3RlcHMpKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzLl9sdXQ7XG4gICAgfSxcbiAgICBvbjogZnVuY3Rpb24ocG9pbnQsIGVycm9yKSB7XG4gICAgICBlcnJvciA9IGVycm9yIHx8IDU7XG4gICAgICB2YXIgbHV0ID0gdGhpcy5nZXRMVVQoKSwgaGl0cyA9IFtdLCBjLCB0PTA7XG4gICAgICBmb3IodmFyIGk9MDsgaTxsdXQubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgYyA9IGx1dFtpXTtcbiAgICAgICAgaWYgKHV0aWxzLmRpc3QoYyxwb2ludCkgPCBlcnJvcikge1xuICAgICAgICAgIGhpdHMucHVzaChjKVxuICAgICAgICAgIHQgKz0gaSAvIGx1dC5sZW5ndGg7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmKCFoaXRzLmxlbmd0aCkgcmV0dXJuIGZhbHNlO1xuICAgICAgcmV0dXJuIHQgLz0gaGl0cy5sZW5ndGg7XG4gICAgfSxcbiAgICBwcm9qZWN0OiBmdW5jdGlvbihwb2ludCkge1xuICAgICAgLy8gc3RlcCAxOiBjb2Fyc2UgY2hlY2tcbiAgICAgIHZhciBMVVQgPSB0aGlzLmdldExVVCgpLCBsID0gTFVULmxlbmd0aC0xLFxuICAgICAgICAgIGNsb3Nlc3QgPSB1dGlscy5jbG9zZXN0KExVVCwgcG9pbnQpLFxuICAgICAgICAgIG1kaXN0ID0gY2xvc2VzdC5tZGlzdCxcbiAgICAgICAgICBtcG9zID0gY2xvc2VzdC5tcG9zO1xuICAgICAgaWYgKG1wb3M9PT0wIHx8IG1wb3M9PT1sKSB7XG4gICAgICAgIHZhciB0ID0gbXBvcy9sLCBwdCA9IHRoaXMuY29tcHV0ZSh0KTtcbiAgICAgICAgcHQudCA9IHQ7XG4gICAgICAgIHB0LmQgPSBtZGlzdDtcbiAgICAgICAgcmV0dXJuIHB0O1xuICAgICAgfVxuXG4gICAgICAvLyBzdGVwIDI6IGZpbmUgY2hlY2tcbiAgICAgIHZhciBmdCwgdCwgcCwgZCxcbiAgICAgICAgICB0MSA9IChtcG9zLTEpL2wsXG4gICAgICAgICAgdDIgPSAobXBvcysxKS9sLFxuICAgICAgICAgIHN0ZXAgPSAwLjEvbDtcbiAgICAgIG1kaXN0ICs9IDE7XG4gICAgICBmb3IodD10MSxmdD10OyB0PHQyK3N0ZXA7IHQrPXN0ZXApIHtcbiAgICAgICAgcCA9IHRoaXMuY29tcHV0ZSh0KTtcbiAgICAgICAgZCA9IHV0aWxzLmRpc3QocG9pbnQsIHApO1xuICAgICAgICBpZiAoZDxtZGlzdCkge1xuICAgICAgICAgIG1kaXN0ID0gZDtcbiAgICAgICAgICBmdCA9IHQ7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHAgPSB0aGlzLmNvbXB1dGUoZnQpO1xuICAgICAgcC50ID0gZnQ7XG4gICAgICBwLmQgPSBtZGlzdDtcbiAgICAgIHJldHVybiBwO1xuICAgIH0sXG4gICAgZ2V0OiBmdW5jdGlvbih0KSB7XG4gICAgICByZXR1cm4gdGhpcy5jb21wdXRlKHQpO1xuICAgIH0sXG4gICAgcG9pbnQ6IGZ1bmN0aW9uKGlkeCkge1xuICAgICAgcmV0dXJuIHRoaXMucG9pbnRzW2lkeF07XG4gICAgfSxcbiAgICBjb21wdXRlOiBmdW5jdGlvbih0KSB7XG4gICAgICAvLyBzaG9ydGN1dHNcbiAgICAgIGlmKHQ9PT0wKSB7IHJldHVybiB0aGlzLnBvaW50c1swXTsgfVxuICAgICAgaWYodD09PTEpIHsgcmV0dXJuIHRoaXMucG9pbnRzW3RoaXMub3JkZXJdOyB9XG5cbiAgICAgIHZhciBwID0gdGhpcy5wb2ludHM7XG4gICAgICB2YXIgbXQgPSAxLXQ7XG5cbiAgICAgIC8vIGxpbmVhcj9cbiAgICAgIGlmKHRoaXMub3JkZXI9PT0xKSB7XG4gICAgICAgIHJldCA9IHtcbiAgICAgICAgICB4OiBtdCpwWzBdLnggKyB0KnBbMV0ueCxcbiAgICAgICAgICB5OiBtdCpwWzBdLnkgKyB0KnBbMV0ueVxuICAgICAgICB9O1xuICAgICAgICBpZiAodGhpcy5fM2QpIHsgcmV0LnogPSBtdCpwWzBdLnogKyB0KnBbMV0uejsgfVxuICAgICAgICByZXR1cm4gcmV0O1xuICAgICAgfVxuXG4gICAgICAvLyBxdWFkcmF0aWMvY3ViaWMgY3VydmU/XG4gICAgICBpZih0aGlzLm9yZGVyPDQpIHtcbiAgICAgICAgdmFyIG10MiA9IG10Km10LFxuICAgICAgICAgICAgdDIgPSB0KnQsXG4gICAgICAgICAgICBhLGIsYyxkID0gMDtcbiAgICAgICAgaWYodGhpcy5vcmRlcj09PTIpIHtcbiAgICAgICAgICBwID0gW3BbMF0sIHBbMV0sIHBbMl0sIFpFUk9dO1xuICAgICAgICAgIGEgPSBtdDI7XG4gICAgICAgICAgYiA9IG10KnQqMjtcbiAgICAgICAgICBjID0gdDI7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZih0aGlzLm9yZGVyPT09Mykge1xuICAgICAgICAgIGEgPSBtdDIqbXQ7XG4gICAgICAgICAgYiA9IG10Mip0KjM7XG4gICAgICAgICAgYyA9IG10KnQyKjM7XG4gICAgICAgICAgZCA9IHQqdDI7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHJldCA9IHtcbiAgICAgICAgICB4OiBhKnBbMF0ueCArIGIqcFsxXS54ICsgYypwWzJdLnggKyBkKnBbM10ueCxcbiAgICAgICAgICB5OiBhKnBbMF0ueSArIGIqcFsxXS55ICsgYypwWzJdLnkgKyBkKnBbM10ueVxuICAgICAgICB9O1xuICAgICAgICBpZih0aGlzLl8zZCkge1xuICAgICAgICAgIHJldC56ID0gYSpwWzBdLnogKyBiKnBbMV0ueiArIGMqcFsyXS56ICsgZCpwWzNdLno7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJldDtcbiAgICAgIH1cblxuICAgICAgLy8gaGlnaGVyIG9yZGVyIGN1cnZlczogdXNlIGRlIENhc3RlbGphdSdzIGNvbXB1dGF0aW9uXG4gICAgICB2YXIgZENwdHMgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMucG9pbnRzKSk7XG4gICAgICB3aGlsZShkQ3B0cy5sZW5ndGggPiAxKSB7XG4gICAgICAgIGZvciAodmFyIGk9MDsgaTxkQ3B0cy5sZW5ndGgtMTsgaSsrKSB7XG4gICAgICAgICAgZENwdHNbaV0gPSB7XG4gICAgICAgICAgICB4OiBkQ3B0c1tpXS54ICsgKGRDcHRzW2krMV0ueCAtIGRDcHRzW2ldLngpICogdCxcbiAgICAgICAgICAgIHk6IGRDcHRzW2ldLnkgKyAoZENwdHNbaSsxXS55IC0gZENwdHNbaV0ueSkgKiB0XG4gICAgICAgICAgfTtcbiAgICAgICAgICBpZiAodHlwZW9mIGRDcHRzW2ldLnogIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgICAgIGRDcHRzW2ldID0gZENwdHNbaV0ueiArIChkQ3B0c1tpKzFdLnogLSBkQ3B0c1tpXS56KSAqIHRcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZENwdHMuc3BsaWNlKGRDcHRzLmxlbmd0aC0xLCAxKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBkQ3B0c1swXTtcbiAgICB9LFxuICAgIHJhaXNlOiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBwID0gdGhpcy5wb2ludHMsIG5wID0gW3BbMF1dLCBpLCBrPXAubGVuZ3RoLCBwaSwgcGltO1xuICAgICAgZm9yICh2YXIgaT0xOyBpPGs7IGkrKykge1xuICAgICAgICBwaSA9IHBbaV07XG4gICAgICAgIHBpbSA9IHBbaS0xXTtcbiAgICAgICAgbnBbaV0gPSB7XG4gICAgICAgICAgeDogKGstaSkvayAqIHBpLnggKyBpL2sgKiBwaW0ueCxcbiAgICAgICAgICB5OiAoay1pKS9rICogcGkueSArIGkvayAqIHBpbS55XG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICBucFtrXSA9IHBbay0xXTtcbiAgICAgIHJldHVybiBuZXcgQmV6aWVyKG5wKTtcbiAgICB9LFxuICAgIGRlcml2YXRpdmU6IGZ1bmN0aW9uKHQpIHtcbiAgICAgIHZhciBtdCA9IDEtdCxcbiAgICAgICAgICBhLGIsYz0wLFxuICAgICAgICAgIHAgPSB0aGlzLmRwb2ludHNbMF07XG4gICAgICBpZih0aGlzLm9yZGVyPT09MikgeyBwID0gW3BbMF0sIHBbMV0sIFpFUk9dOyBhID0gbXQ7IGIgPSB0OyB9XG4gICAgICBpZih0aGlzLm9yZGVyPT09MykgeyBhID0gbXQqbXQ7IGIgPSBtdCp0KjI7IGMgPSB0KnQ7IH1cbiAgICAgIHZhciByZXQgPSB7XG4gICAgICAgIHg6IGEqcFswXS54ICsgYipwWzFdLnggKyBjKnBbMl0ueCxcbiAgICAgICAgeTogYSpwWzBdLnkgKyBiKnBbMV0ueSArIGMqcFsyXS55XG4gICAgICB9O1xuICAgICAgaWYodGhpcy5fM2QpIHtcbiAgICAgICAgcmV0LnogPSBhKnBbMF0ueiArIGIqcFsxXS56ICsgYypwWzJdLno7XG4gICAgICB9XG4gICAgICByZXR1cm4gcmV0O1xuICAgIH0sXG4gICAgaW5mbGVjdGlvbnM6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHV0aWxzLmluZmxlY3Rpb25zKHRoaXMucG9pbnRzKTtcbiAgICB9LFxuICAgIG5vcm1hbDogZnVuY3Rpb24odCkge1xuICAgICAgcmV0dXJuIHRoaXMuXzNkID8gdGhpcy5fX25vcm1hbDModCkgOiB0aGlzLl9fbm9ybWFsMih0KTtcbiAgICB9LFxuICAgIF9fbm9ybWFsMjogZnVuY3Rpb24odCkge1xuICAgICAgdmFyIGQgPSB0aGlzLmRlcml2YXRpdmUodCk7XG4gICAgICB2YXIgcSA9IHNxcnQoZC54KmQueCArIGQueSpkLnkpXG4gICAgICByZXR1cm4geyB4OiAtZC55L3EsIHk6IGQueC9xIH07XG4gICAgfSxcbiAgICBfX25vcm1hbDM6IGZ1bmN0aW9uKCkge1xuICAgICAgLy8gc2VlIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMjU0NTMxNTlcbiAgICAgIHZhciByMSA9IHRoaXMuZGVyaXZhdGl2ZSh0KSxcbiAgICAgICAgICByMiA9IHRoaXMuZGVyaXZhdGl2ZSh0KzAuMDEpLFxuICAgICAgICAgIHExID0gc3FydChyMS54KnIxLnggKyByMS55KnIxLnkgKyByMS56KnIxLnopLFxuICAgICAgICAgIHEyID0gc3FydChyMi54KnIyLnggKyByMi55KnIyLnkgKyByMi56KnIyLnopO1xuICAgICAgcjEueCAvPSBxMTsgcjEueSAvPSBxMTsgcjEueiAvPSBxMTtcbiAgICAgIHIyLnggLz0gcTI7IHIyLnkgLz0gcTI7IHIyLnogLz0gcTI7XG4gICAgICAvLyBjcm9zcyBwcm9kdWN0XG4gICAgICB2YXIgYyA9IHtcbiAgICAgICAgeDogcjIueSpyMS56IC0gcjIueipyMS55LFxuICAgICAgICB5OiByMi56KnIxLnggLSByMi54KnIxLnosXG4gICAgICAgIHo6IHIyLngqcjEueSAtIHIyLnkqcjEueFxuICAgICAgfTtcbiAgICAgIHZhciBtID0gc3FydChjLngqYy54ICsgYy55KmMueSArIGMueipjLnopO1xuICAgICAgYy54IC89IG07IGMueSAvPSBtOyBjLnogLz0gbTtcbiAgICAgIC8vIHJvdGF0aW9uIG1hdHJpeFxuICAgICAgdmFyIFIgPSBbICAgYy54KmMueCwgICBjLngqYy55LWMueiwgYy54KmMueitjLnksXG4gICAgICAgICAgICAgICAgYy54KmMueStjLnosICAgYy55KmMueSwgICBjLnkqYy56LWMueCxcbiAgICAgICAgICAgICAgICBjLngqYy56LWMueSwgYy55KmMueitjLngsICAgYy56KmMueiAgICBdO1xuICAgICAgLy8gbm9ybWFsIHZlY3RvcjpcbiAgICAgIHZhciBuID0ge1xuICAgICAgICB4OiBSWzBdICogcjEueCArIFJbMV0gKiByMS55ICsgUlsyXSAqIHIxLnosXG4gICAgICAgIHk6IFJbM10gKiByMS54ICsgUls0XSAqIHIxLnkgKyBSWzVdICogcjEueixcbiAgICAgICAgejogUls2XSAqIHIxLnggKyBSWzddICogcjEueSArIFJbOF0gKiByMS56XG4gICAgICB9O1xuICAgICAgcmV0dXJuIG47XG4gICAgfSxcbiAgICBodWxsOiBmdW5jdGlvbih0KSB7XG4gICAgICB2YXIgcCA9IHRoaXMucG9pbnRzLFxuICAgICAgICAgIF9wID0gW10sXG4gICAgICAgICAgcHQsXG4gICAgICAgICAgcSA9IFtdLFxuICAgICAgICAgIGlkeCA9IDAsXG4gICAgICAgICAgaT0wLFxuICAgICAgICAgIGw9MDtcbiAgICAgIHFbaWR4KytdID0gcFswXTtcbiAgICAgIHFbaWR4KytdID0gcFsxXTtcbiAgICAgIHFbaWR4KytdID0gcFsyXTtcbiAgICAgIGlmKHRoaXMub3JkZXIgPT09IDMpIHsgcVtpZHgrK10gPSBwWzNdOyB9XG4gICAgICAvLyB3ZSBsZXJwIGJldHdlZW4gYWxsIHBvaW50cyBhdCBlYWNoIGl0ZXJhdGlvbiwgdW50aWwgd2UgaGF2ZSAxIHBvaW50IGxlZnQuXG4gICAgICB3aGlsZShwLmxlbmd0aD4xKSB7XG4gICAgICAgIF9wID0gW107XG4gICAgICAgIGZvcihpPTAsIGw9cC5sZW5ndGgtMTsgaTxsOyBpKyspIHtcbiAgICAgICAgICBwdCA9IHV0aWxzLmxlcnAodCxwW2ldLHBbaSsxXSk7XG4gICAgICAgICAgcVtpZHgrK10gPSBwdDtcbiAgICAgICAgICBfcC5wdXNoKHB0KTtcbiAgICAgICAgfVxuICAgICAgICBwID0gX3A7XG4gICAgICB9XG4gICAgICByZXR1cm4gcTtcbiAgICB9LFxuICAgIHNwbGl0OiBmdW5jdGlvbih0MSwgdDIpIHtcbiAgICAgIC8vIHNob3J0Y3V0c1xuICAgICAgaWYodDE9PT0wICYmICEhdDIpIHsgcmV0dXJuIHRoaXMuc3BsaXQodDIpLmxlZnQ7IH1cbiAgICAgIGlmKHQyPT09MSkgeyByZXR1cm4gdGhpcy5zcGxpdCh0MSkucmlnaHQ7IH1cblxuICAgICAgLy8gbm8gc2hvcnRjdXQ6IHVzZSBcImRlIENhc3RlbGphdVwiIGl0ZXJhdGlvbi5cbiAgICAgIHZhciBxID0gdGhpcy5odWxsKHQxKTtcbiAgICAgIHZhciByZXN1bHQgPSB7XG4gICAgICAgIGxlZnQ6IHRoaXMub3JkZXIgPT09IDIgPyBuZXcgQmV6aWVyKFtxWzBdLHFbM10scVs1XV0pIDogbmV3IEJlemllcihbcVswXSxxWzRdLHFbN10scVs5XV0pLFxuICAgICAgICByaWdodDogdGhpcy5vcmRlciA9PT0gMiA/IG5ldyBCZXppZXIoW3FbNV0scVs0XSxxWzJdXSkgOiBuZXcgQmV6aWVyKFtxWzldLHFbOF0scVs2XSxxWzNdXSksXG4gICAgICAgIHNwYW46IHFcbiAgICAgIH07XG5cbiAgICAgIC8vIG1ha2Ugc3VyZSB3ZSBiaW5kIF90MS9fdDIgaW5mb3JtYXRpb24hXG4gICAgICByZXN1bHQubGVmdC5fdDEgID0gdXRpbHMubWFwKDAsICAwLDEsIHRoaXMuX3QxLHRoaXMuX3QyKTtcbiAgICAgIHJlc3VsdC5sZWZ0Ll90MiAgPSB1dGlscy5tYXAodDEsIDAsMSwgdGhpcy5fdDEsdGhpcy5fdDIpO1xuICAgICAgcmVzdWx0LnJpZ2h0Ll90MSA9IHV0aWxzLm1hcCh0MSwgMCwxLCB0aGlzLl90MSx0aGlzLl90Mik7XG4gICAgICByZXN1bHQucmlnaHQuX3QyID0gdXRpbHMubWFwKDEsICAwLDEsIHRoaXMuX3QxLHRoaXMuX3QyKTtcblxuICAgICAgLy8gaWYgd2UgaGF2ZSBubyB0Miwgd2UncmUgZG9uZVxuICAgICAgaWYoIXQyKSB7IHJldHVybiByZXN1bHQ7IH1cblxuICAgICAgLy8gaWYgd2UgaGF2ZSBhIHQyLCBzcGxpdCBhZ2FpbjpcbiAgICAgIHQyID0gdXRpbHMubWFwKHQyLHQxLDEsMCwxKTtcbiAgICAgIHZhciBzdWJzcGxpdCA9IHJlc3VsdC5yaWdodC5zcGxpdCh0Mik7XG4gICAgICByZXR1cm4gc3Vic3BsaXQubGVmdDtcbiAgICB9LFxuICAgIGV4dHJlbWE6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGRpbXMgPSB0aGlzLmRpbXMsXG4gICAgICAgICAgcmVzdWx0PXt9LFxuICAgICAgICAgIHJvb3RzPVtdLFxuICAgICAgICAgIHAsIG1mbjtcbiAgICAgIGRpbXMuZm9yRWFjaChmdW5jdGlvbihkaW0pIHtcbiAgICAgICAgbWZuID0gZnVuY3Rpb24odikgeyByZXR1cm4gdltkaW1dOyB9O1xuICAgICAgICBwID0gdGhpcy5kcG9pbnRzWzBdLm1hcChtZm4pO1xuICAgICAgICByZXN1bHRbZGltXSA9IHV0aWxzLmRyb290cyhwKTtcbiAgICAgICAgaWYodGhpcy5vcmRlciA9PT0gMykge1xuICAgICAgICAgIHAgPSB0aGlzLmRwb2ludHNbMV0ubWFwKG1mbik7XG4gICAgICAgICAgcmVzdWx0W2RpbV0gPSByZXN1bHRbZGltXS5jb25jYXQodXRpbHMuZHJvb3RzKHApKTtcbiAgICAgICAgfVxuICAgICAgICByZXN1bHRbZGltXSA9IHJlc3VsdFtkaW1dLmZpbHRlcihmdW5jdGlvbih0KSB7IHJldHVybiAodD49MCAmJiB0PD0xKTsgfSk7XG4gICAgICAgIHJvb3RzID0gcm9vdHMuY29uY2F0KHJlc3VsdFtkaW1dLnNvcnQoKSk7XG4gICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgcm9vdHMuc29ydCgpO1xuICAgICAgcmVzdWx0LnZhbHVlcyA9IHJvb3RzO1xuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9LFxuICAgIGJib3g6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGV4dHJlbWEgPSB0aGlzLmV4dHJlbWEoKSwgcmVzdWx0ID0ge307XG4gICAgICB0aGlzLmRpbXMuZm9yRWFjaChmdW5jdGlvbihkKSB7XG4gICAgICAgIHJlc3VsdFtkXSA9IHV0aWxzLmdldG1pbm1heCh0aGlzLCBkLCBleHRyZW1hW2RdKTtcbiAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0sXG4gICAgb3ZlcmxhcHM6IGZ1bmN0aW9uKGN1cnZlKSB7XG4gICAgICB2YXIgbGJib3ggPSB0aGlzLmJib3goKSxcbiAgICAgICAgICB0YmJveCA9IGN1cnZlLmJib3goKTtcbiAgICAgIHJldHVybiB1dGlscy5iYm94b3ZlcmxhcChsYmJveCx0YmJveCk7XG4gICAgfSxcbiAgICBvZmZzZXQ6IGZ1bmN0aW9uKHQsIGQpIHtcbiAgICAgIGlmKHR5cGVvZiBkICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgIHZhciBjID0gdGhpcy5nZXQodCk7XG4gICAgICAgIHZhciBuID0gdGhpcy5ub3JtYWwodCk7XG4gICAgICAgIHZhciByZXQgPSB7XG4gICAgICAgICAgYzogYyxcbiAgICAgICAgICBuOiBuLFxuICAgICAgICAgIHg6IGMueCArIG4ueCAqIGQsXG4gICAgICAgICAgeTogYy55ICsgbi55ICogZFxuICAgICAgICB9O1xuICAgICAgICBpZih0aGlzLl8zZCkge1xuICAgICAgICAgIHJldC56ID0gYy56ICsgbi56ICogZDtcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIHJldDtcbiAgICAgIH1cbiAgICAgIGlmKHRoaXMuX2xpbmVhcikge1xuICAgICAgICB2YXIgbnYgPSB0aGlzLm5vcm1hbCgwKTtcbiAgICAgICAgdmFyIGNvb3JkcyA9IHRoaXMucG9pbnRzLm1hcChmdW5jdGlvbihwKSB7XG4gICAgICAgICAgdmFyIHJldCA9IHtcbiAgICAgICAgICAgIHg6IHAueCArIHQgKiBudi54LFxuICAgICAgICAgICAgeTogcC55ICsgdCAqIG52LnlcbiAgICAgICAgICB9O1xuICAgICAgICAgIGlmKHAueiAmJiBuLnopIHsgcmV0LnogPSBwLnogKyB0ICogbnYuejsgfVxuICAgICAgICAgIHJldHVybiByZXQ7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gW25ldyBCZXppZXIoY29vcmRzKV07XG4gICAgICB9XG4gICAgICB2YXIgcmVkdWNlZCA9IHRoaXMucmVkdWNlKCk7XG4gICAgICByZXR1cm4gcmVkdWNlZC5tYXAoZnVuY3Rpb24ocykge1xuICAgICAgICByZXR1cm4gcy5zY2FsZSh0KTtcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgc2ltcGxlOiBmdW5jdGlvbigpIHtcbiAgICAgIGlmKHRoaXMub3JkZXI9PT0zKSB7XG4gICAgICAgIHZhciBhMSA9IHV0aWxzLmFuZ2xlKHRoaXMucG9pbnRzWzBdLCB0aGlzLnBvaW50c1szXSwgdGhpcy5wb2ludHNbMV0pO1xuICAgICAgICB2YXIgYTIgPSB1dGlscy5hbmdsZSh0aGlzLnBvaW50c1swXSwgdGhpcy5wb2ludHNbM10sIHRoaXMucG9pbnRzWzJdKTtcbiAgICAgICAgaWYoYTE+MCAmJiBhMjwwIHx8IGExPDAgJiYgYTI+MCkgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgdmFyIG4xID0gdGhpcy5ub3JtYWwoMCk7XG4gICAgICB2YXIgbjIgPSB0aGlzLm5vcm1hbCgxKTtcbiAgICAgIHZhciBzID0gbjEueCpuMi54ICsgbjEueSpuMi55O1xuICAgICAgaWYodGhpcy5fM2QpIHsgcyArPSBuMS56Km4yLno7IH1cbiAgICAgIHZhciBhbmdsZSA9IGFicyhhY29zKHMpKTtcbiAgICAgIHJldHVybiBhbmdsZSA8IHBpLzM7XG4gICAgfSxcbiAgICByZWR1Y2U6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGksIHQxPTAsIHQyPTAsIHN0ZXA9MC4wMSwgc2VnbWVudCwgcGFzczE9W10sIHBhc3MyPVtdO1xuICAgICAgLy8gZmlyc3QgcGFzczogc3BsaXQgb24gZXh0cmVtYVxuICAgICAgdmFyIGV4dHJlbWEgPSB0aGlzLmV4dHJlbWEoKS52YWx1ZXM7XG4gICAgICBpZihleHRyZW1hLmluZGV4T2YoMCk9PT0tMSkgeyBleHRyZW1hID0gWzBdLmNvbmNhdChleHRyZW1hKTsgfVxuICAgICAgaWYoZXh0cmVtYS5pbmRleE9mKDEpPT09LTEpIHsgZXh0cmVtYS5wdXNoKDEpOyB9XG4gICAgICBmb3IodDE9ZXh0cmVtYVswXSwgaT0xOyBpPGV4dHJlbWEubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdDIgPSBleHRyZW1hW2ldO1xuICAgICAgICBzZWdtZW50ID0gdGhpcy5zcGxpdCh0MSx0Mik7XG4gICAgICAgIHNlZ21lbnQuX3QxID0gdDE7XG4gICAgICAgIHNlZ21lbnQuX3QyID0gdDI7XG4gICAgICAgIHBhc3MxLnB1c2goc2VnbWVudCk7XG4gICAgICAgIHQxID0gdDI7XG4gICAgICB9XG4gICAgICAvLyBzZWNvbmQgcGFzczogZnVydGhlciByZWR1Y2UgdGhlc2Ugc2VnbWVudHMgdG8gc2ltcGxlIHNlZ21lbnRzXG4gICAgICBwYXNzMS5mb3JFYWNoKGZ1bmN0aW9uKHAxKSB7XG4gICAgICAgIHQxPTA7XG4gICAgICAgIHQyPTA7XG4gICAgICAgIHdoaWxlKHQyIDw9IDEpIHtcbiAgICAgICAgICBmb3IodDI9dDErc3RlcDsgdDI8PTErc3RlcDsgdDIrPXN0ZXApIHtcbiAgICAgICAgICAgIHNlZ21lbnQgPSBwMS5zcGxpdCh0MSx0Mik7XG4gICAgICAgICAgICBpZighc2VnbWVudC5zaW1wbGUoKSkge1xuICAgICAgICAgICAgICB0MiAtPSBzdGVwO1xuICAgICAgICAgICAgICBpZihhYnModDEtdDIpPHN0ZXApIHtcbiAgICAgICAgICAgICAgICAvLyB3ZSBjYW4gbmV2ZXIgZm9ybSBhIHJlZHVjdGlvblxuICAgICAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBzZWdtZW50ID0gcDEuc3BsaXQodDEsdDIpO1xuICAgICAgICAgICAgICBzZWdtZW50Ll90MSA9IHV0aWxzLm1hcCh0MSwwLDEscDEuX3QxLHAxLl90Mik7XG4gICAgICAgICAgICAgIHNlZ21lbnQuX3QyID0gdXRpbHMubWFwKHQyLDAsMSxwMS5fdDEscDEuX3QyKTtcbiAgICAgICAgICAgICAgcGFzczIucHVzaChzZWdtZW50KTtcbiAgICAgICAgICAgICAgdDEgPSB0MjtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmKHQxPDEpIHtcbiAgICAgICAgICBzZWdtZW50ID0gcDEuc3BsaXQodDEsMSk7XG4gICAgICAgICAgc2VnbWVudC5fdDEgPSB1dGlscy5tYXAodDEsMCwxLHAxLl90MSxwMS5fdDIpO1xuICAgICAgICAgIHNlZ21lbnQuX3QyID0gcDEuX3QyO1xuICAgICAgICAgIHBhc3MyLnB1c2goc2VnbWVudCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHBhc3MyO1xuICAgIH0sXG4gICAgc2NhbGU6IGZ1bmN0aW9uKGQpIHtcbiAgICAgIHZhciBvcmRlciA9IHRoaXMub3JkZXI7XG4gICAgICB2YXIgZGlzdGFuY2VGbiA9IGZhbHNlXG4gICAgICBpZih0eXBlb2YgZCA9PT0gXCJmdW5jdGlvblwiKSB7IGRpc3RhbmNlRm4gPSBkOyB9XG4gICAgICBpZihkaXN0YW5jZUZuICYmIG9yZGVyID09PSAyKSB7IHJldHVybiB0aGlzLnJhaXNlKCkuc2NhbGUoZGlzdGFuY2VGbik7IH1cblxuICAgICAgLy8gVE9ETzogYWRkIHNwZWNpYWwgaGFuZGxpbmcgZm9yIGRlZ2VuZXJhdGUgKD1saW5lYXIpIGN1cnZlcy5cbiAgICAgIHZhciBjbG9ja3dpc2UgPSB0aGlzLmNsb2Nrd2lzZTtcbiAgICAgIHZhciByMSA9IGRpc3RhbmNlRm4gPyBkaXN0YW5jZUZuKDApIDogZDtcbiAgICAgIHZhciByMiA9IGRpc3RhbmNlRm4gPyBkaXN0YW5jZUZuKDEpIDogZDtcbiAgICAgIHZhciB2ID0gWyB0aGlzLm9mZnNldCgwLDEwKSwgdGhpcy5vZmZzZXQoMSwxMCkgXTtcbiAgICAgIHZhciBvID0gdXRpbHMubGxpNCh2WzBdLCB2WzBdLmMsIHZbMV0sIHZbMV0uYyk7XG4gICAgICBpZighbykgeyBjb25zb2xlLmxvZyhcImNhbm5vdCBzY2FsZSB0aGlzIGN1cnZlLiBUcnkgcmVkdWNpbmcgaXQgZmlyc3QuXCIpOyByZXR1cm4gdGhpczt9XG4gICAgICAvLyBtb3ZlIGFsbCBwb2ludHMgYnkgZGlzdGFuY2UgJ2QnIHdydCB0aGUgb3JpZ2luICdvJ1xuICAgICAgdmFyIHBvaW50cz10aGlzLnBvaW50cywgbnA9W107XG5cbiAgICAgIC8vIG1vdmUgZW5kIHBvaW50cyBieSBmaXhlZCBkaXN0YW5jZSBhbG9uZyBub3JtYWwuXG4gICAgICBbMCwxXS5mb3JFYWNoKGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgdmFyIHAgPSBucFt0Km9yZGVyXSA9IHV0aWxzLmNvcHkocG9pbnRzW3Qqb3JkZXJdKTtcbiAgICAgICAgcC54ICs9ICh0P3IyOnIxKSAqIHZbdF0ubi54O1xuICAgICAgICBwLnkgKz0gKHQ/cjI6cjEpICogdlt0XS5uLnk7XG4gICAgICB9LmJpbmQodGhpcykpO1xuXG4gICAgICBpZiAoIWRpc3RhbmNlRm4pIHtcbiAgICAgICAgLy8gbW92ZSBjb250cm9sIHBvaW50cyB0byBsaWUgb24gdGhlIGludGVyc2VjdGlvbiBvZiB0aGUgb2Zmc2V0XG4gICAgICAgIC8vIGRlcml2YXRpdmUgdmVjdG9yLCBhbmQgdGhlIG9yaWdpbi10aHJvdWdoLWNvbnRyb2wgdmVjdG9yXG4gICAgICAgIFswLDFdLmZvckVhY2goZnVuY3Rpb24odCkge1xuICAgICAgICAgIGlmKHRoaXMub3JkZXI9PT0yICYmICEhdCkgcmV0dXJuO1xuICAgICAgICAgIHZhciBwID0gbnBbdCpvcmRlcl07XG4gICAgICAgICAgdmFyIGQgPSB0aGlzLmRlcml2YXRpdmUodCk7XG4gICAgICAgICAgdmFyIHAyID0geyB4OiBwLnggKyBkLngsIHk6IHAueSArIGQueSB9O1xuICAgICAgICAgIG5wW3QrMV0gPSB1dGlscy5sbGk0KHAsIHAyLCBvLCBwb2ludHNbdCsxXSk7XG4gICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgIHJldHVybiBuZXcgQmV6aWVyKG5wKTtcbiAgICAgIH1cblxuICAgICAgLy8gbW92ZSBjb250cm9sIHBvaW50cyBieSBcImhvd2V2ZXIgbXVjaCBuZWNlc3NhcnkgdG9cbiAgICAgIC8vIGVuc3VyZSB0aGUgY29ycmVjdCB0YW5nZW50IHRvIGVuZHBvaW50XCIuXG4gICAgICBbMCwxXS5mb3JFYWNoKGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgaWYodGhpcy5vcmRlcj09PTIgJiYgISF0KSByZXR1cm47XG4gICAgICAgIHZhciBwID0gcG9pbnRzW3QrMV07XG4gICAgICAgIHZhciBvdiA9IHtcbiAgICAgICAgICB4OiBwLnggLSBvLngsXG4gICAgICAgICAgeTogcC55IC0gby55XG4gICAgICAgIH07XG4gICAgICAgIHZhciByYyA9IGRpc3RhbmNlRm4gPyBkaXN0YW5jZUZuKCh0KzEpL29yZGVyKSA6IGQ7XG4gICAgICAgIGlmKGRpc3RhbmNlRm4gJiYgIWNsb2Nrd2lzZSkgcmMgPSAtcmM7XG4gICAgICAgIHZhciBtID0gc3FydChvdi54Km92LnggKyBvdi55Km92LnkpO1xuICAgICAgICBvdi54IC89IG07XG4gICAgICAgIG92LnkgLz0gbTtcbiAgICAgICAgbnBbdCsxXSA9IHtcbiAgICAgICAgICB4OiBwLnggKyByYypvdi54LFxuICAgICAgICAgIHk6IHAueSArIHJjKm92LnlcbiAgICAgICAgfVxuICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgIHJldHVybiBuZXcgQmV6aWVyKG5wKTtcbiAgICB9LFxuICAgIG91dGxpbmU6IGZ1bmN0aW9uKGQxLCBkMiwgZDMsIGQ0KSB7XG4gICAgICBkMiA9ICh0eXBlb2YgZDIgPT09IFwidW5kZWZpbmVkXCIpID8gZDEgOiBkMjtcbiAgICAgIHZhciByZWR1Y2VkID0gdGhpcy5yZWR1Y2UoKSxcbiAgICAgICAgICBsZW4gPSByZWR1Y2VkLmxlbmd0aCxcbiAgICAgICAgICBmY3VydmVzID0gW10sXG4gICAgICAgICAgYmN1cnZlcyA9IFtdLFxuICAgICAgICAgIHAsXG4gICAgICAgICAgYWxlbiA9IDAsXG4gICAgICAgICAgdGxlbiA9IHRoaXMubGVuZ3RoKCk7XG5cbiAgICAgIHZhciBncmFkdWF0ZWQgPSAodHlwZW9mIGQzICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZiBkNCAhPT0gXCJ1bmRlZmluZWRcIik7XG5cbiAgICAgIGZ1bmN0aW9uIGxpbmVhckRpc3RhbmNlRnVuY3Rpb24ocyxlLCB0bGVuLGFsZW4sc2xlbikge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgICB2YXIgZjEgPSBhbGVuL3RsZW4sIGYyID0gKGFsZW4rc2xlbikvdGxlbiwgZCA9IGUtcztcbiAgICAgICAgICByZXR1cm4gdXRpbHMubWFwKHYsIDAsMSwgcytmMSpkLCBzK2YyKmQpO1xuICAgICAgICB9O1xuICAgICAgfTtcblxuICAgICAgLy8gZm9ybSBjdXJ2ZSBvdWxpbmVzXG4gICAgICByZWR1Y2VkLmZvckVhY2goZnVuY3Rpb24oc2VnbWVudCkge1xuICAgICAgICBzbGVuID0gc2VnbWVudC5sZW5ndGgoKTtcbiAgICAgICAgaWYgKGdyYWR1YXRlZCkge1xuICAgICAgICAgIGZjdXJ2ZXMucHVzaChzZWdtZW50LnNjYWxlKCAgbGluZWFyRGlzdGFuY2VGdW5jdGlvbiggZDEsIGQzLCB0bGVuLGFsZW4sc2xlbikgICkpO1xuICAgICAgICAgIGJjdXJ2ZXMucHVzaChzZWdtZW50LnNjYWxlKCAgbGluZWFyRGlzdGFuY2VGdW5jdGlvbigtZDIsLWQ0LCB0bGVuLGFsZW4sc2xlbikgICkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGZjdXJ2ZXMucHVzaChzZWdtZW50LnNjYWxlKCBkMSkpO1xuICAgICAgICAgIGJjdXJ2ZXMucHVzaChzZWdtZW50LnNjYWxlKC1kMikpO1xuICAgICAgICB9XG4gICAgICAgIGFsZW4gKz0gc2xlbjtcbiAgICAgIH0pO1xuXG4gICAgICAvLyByZXZlcnNlIHRoZSBcInJldHVyblwiIG91dGxpbmVcbiAgICAgIGJjdXJ2ZXMgPSBiY3VydmVzLm1hcChmdW5jdGlvbihzKSB7XG4gICAgICAgIHAgPSBzLnBvaW50cztcbiAgICAgICAgaWYocFszXSkgeyBzLnBvaW50cyA9IFtwWzNdLHBbMl0scFsxXSxwWzBdXTsgfVxuICAgICAgICBlbHNlIHsgcy5wb2ludHMgPSBbcFsyXSxwWzFdLHBbMF1dOyB9XG4gICAgICAgIHJldHVybiBzO1xuICAgICAgfSkucmV2ZXJzZSgpO1xuXG4gICAgICAvLyBmb3JtIHRoZSBlbmRjYXBzIGFzIGxpbmVzXG4gICAgICB2YXIgZnMgPSBmY3VydmVzWzBdLnBvaW50c1swXSxcbiAgICAgICAgICBmZSA9IGZjdXJ2ZXNbbGVuLTFdLnBvaW50c1tmY3VydmVzW2xlbi0xXS5wb2ludHMubGVuZ3RoLTFdLFxuICAgICAgICAgIGJzID0gYmN1cnZlc1tsZW4tMV0ucG9pbnRzW2JjdXJ2ZXNbbGVuLTFdLnBvaW50cy5sZW5ndGgtMV0sXG4gICAgICAgICAgYmUgPSBiY3VydmVzWzBdLnBvaW50c1swXSxcbiAgICAgICAgICBscyA9IHV0aWxzLm1ha2VsaW5lKGJzLGZzKSxcbiAgICAgICAgICBsZSA9IHV0aWxzLm1ha2VsaW5lKGZlLGJlKSxcbiAgICAgICAgICBzZWdtZW50cyA9IFtsc10uY29uY2F0KGZjdXJ2ZXMpLmNvbmNhdChbbGVdKS5jb25jYXQoYmN1cnZlcyksXG4gICAgICAgICAgc2xlbiA9IHNlZ21lbnRzLmxlbmd0aDtcblxuICAgICAgcmV0dXJuIG5ldyBQb2x5QmV6aWVyKHNlZ21lbnRzKTtcbiAgICB9LFxuICAgIG91dGxpbmVzaGFwZXM6IGZ1bmN0aW9uKGQxLGQyKSB7XG4gICAgICBkMiA9IGQyIHx8IGQxO1xuICAgICAgdmFyIG91dGxpbmUgPSB0aGlzLm91dGxpbmUoZDEsZDIpLmN1cnZlcztcbiAgICAgIHZhciBzaGFwZXMgPSBbXTtcbiAgICAgIGZvcih2YXIgaT0xLCBsZW49b3V0bGluZS5sZW5ndGg7IGkgPCBsZW4vMjsgaSsrKSB7XG4gICAgICAgIHZhciBzaGFwZSA9IHV0aWxzLm1ha2VzaGFwZShvdXRsaW5lW2ldLCBvdXRsaW5lW2xlbi1pXSk7XG4gICAgICAgIHNoYXBlLnN0YXJ0Y2FwLnZpcnR1YWwgPSAoaSA+IDEpO1xuICAgICAgICBzaGFwZS5lbmRjYXAudmlydHVhbCA9IChpIDwgbGVuLzItMSk7XG4gICAgICAgIHNoYXBlcy5wdXNoKHNoYXBlKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBzaGFwZXM7XG4gICAgfSxcbiAgICBpbnRlcnNlY3RzOiBmdW5jdGlvbihjdXJ2ZSkge1xuICAgICAgaWYoIWN1cnZlKSByZXR1cm4gdGhpcy5zZWxmaW50ZXJzZWN0cygpO1xuICAgICAgaWYoY3VydmUucDEgJiYgY3VydmUucDIpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubGluZUludGVyc2VjdHMoY3VydmUpO1xuICAgICAgfVxuICAgICAgaWYoY3VydmUgaW5zdGFuY2VvZiBCZXppZXIpIHsgY3VydmUgPSBjdXJ2ZS5yZWR1Y2UoKTsgfVxuICAgICAgcmV0dXJuIHRoaXMuY3VydmVpbnRlcnNlY3RzKHRoaXMucmVkdWNlKCksIGN1cnZlKTtcbiAgICB9LFxuICAgIGxpbmVJbnRlcnNlY3RzOiBmdW5jdGlvbihsaW5lKSB7XG4gICAgICB2YXIgbXggPSBtaW4obGluZS5wMS54LCBsaW5lLnAyLngpLFxuICAgICAgICAgIG15ID0gbWluKGxpbmUucDEueSwgbGluZS5wMi55KSxcbiAgICAgICAgICBNWCA9IG1heChsaW5lLnAxLngsIGxpbmUucDIueCksXG4gICAgICAgICAgTVkgPSBtYXgobGluZS5wMS55LCBsaW5lLnAyLnkpLFxuICAgICAgICAgIHNlbGY9dGhpcztcbiAgICAgIHJldHVybiB1dGlscy5yb290cyh0aGlzLnBvaW50cywgbGluZSkuZmlsdGVyKGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgdmFyIHAgPSBzZWxmLmdldCh0KTtcbiAgICAgICAgcmV0dXJuIHV0aWxzLmJldHdlZW4ocC54LCBteCwgTVgpICYmIHV0aWxzLmJldHdlZW4ocC55LCBteSwgTVkpO1xuICAgICAgfSk7XG4gICAgfSxcbiAgICBzZWxmaW50ZXJzZWN0czogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgcmVkdWNlZCA9IHRoaXMucmVkdWNlKCk7XG4gICAgICAvLyBcInNpbXBsZVwiIGN1cnZlcyBjYW5ub3QgaW50ZXJzZWN0IHdpdGggdGhlaXIgZGlyZWN0XG4gICAgICAvLyBuZWlnaGJvdXIsIHNvIGZvciBlYWNoIHNlZ21lbnQgWCB3ZSBjaGVjayB3aGV0aGVyXG4gICAgICAvLyBpdCBpbnRlcnNlY3RzIFswOngtMl1beCsyOmxhc3RdLlxuICAgICAgdmFyIGksbGVuPXJlZHVjZWQubGVuZ3RoLTIscmVzdWx0cz1bXSxyZXN1bHQsbGVmdCxyaWdodDtcbiAgICAgIGZvcihpPTA7IGk8bGVuOyBpKyspIHtcbiAgICAgICAgbGVmdCA9IHJlZHVjZWQuc2xpY2UoaSxpKzEpO1xuICAgICAgICByaWdodCA9IHJlZHVjZWQuc2xpY2UoaSsyKTtcbiAgICAgICAgcmVzdWx0ID0gdGhpcy5jdXJ2ZWludGVyc2VjdHMobGVmdCwgcmlnaHQpO1xuICAgICAgICByZXN1bHRzID0gcmVzdWx0cy5jb25jYXQoIHJlc3VsdCApO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdHM7XG4gICAgfSxcbiAgICBjdXJ2ZWludGVyc2VjdHM6IGZ1bmN0aW9uKGMxLGMyKSB7XG4gICAgICB2YXIgcGFpcnMgPSBbXTtcbiAgICAgIC8vIHN0ZXAgMTogcGFpciBvZmYgYW55IG92ZXJsYXBwaW5nIHNlZ21lbnRzXG4gICAgICBjMS5mb3JFYWNoKGZ1bmN0aW9uKGwpIHtcbiAgICAgICAgYzIuZm9yRWFjaChmdW5jdGlvbihyKSB7XG4gICAgICAgICAgaWYobC5vdmVybGFwcyhyKSkge1xuICAgICAgICAgICAgcGFpcnMucHVzaCh7IGxlZnQ6IGwsIHJpZ2h0OiByIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICAgIC8vIHN0ZXAgMjogZm9yIGVhY2ggcGFpcmluZywgcnVuIHRocm91Z2ggdGhlIGNvbnZlcmdlbmNlIGFsZ29yaXRobS5cbiAgICAgIHZhciBpbnRlcnNlY3Rpb25zID0gW107XG4gICAgICBwYWlycy5mb3JFYWNoKGZ1bmN0aW9uKHBhaXIpIHtcbiAgICAgICAgdmFyIHJlc3VsdCA9IHV0aWxzLnBhaXJpdGVyYXRpb24ocGFpci5sZWZ0LCBwYWlyLnJpZ2h0KTtcbiAgICAgICAgaWYocmVzdWx0Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBpbnRlcnNlY3Rpb25zID0gaW50ZXJzZWN0aW9ucy5jb25jYXQocmVzdWx0KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICByZXR1cm4gaW50ZXJzZWN0aW9ucztcbiAgICB9LFxuICAgIGFyY3M6IGZ1bmN0aW9uKGVycm9yVGhyZXNob2xkKSB7XG4gICAgICBlcnJvclRocmVzaG9sZCA9IGVycm9yVGhyZXNob2xkIHx8IDAuNTtcbiAgICAgIHZhciBjaXJjbGVzID0gW107XG4gICAgICByZXR1cm4gdGhpcy5faXRlcmF0ZShlcnJvclRocmVzaG9sZCwgY2lyY2xlcyk7XG4gICAgfSxcbiAgICBfZXJyb3I6IGZ1bmN0aW9uKHBjLCBucDEsIHMsIGUpIHtcbiAgICAgIHZhciBxID0gKGUgLSBzKSAvIDQsXG4gICAgICAgICAgYzEgPSB0aGlzLmdldChzICsgcSksXG4gICAgICAgICAgYzIgPSB0aGlzLmdldChlIC0gcSksXG4gICAgICAgICAgcmVmID0gdXRpbHMuZGlzdChwYywgbnAxKSxcbiAgICAgICAgICBkMSAgPSB1dGlscy5kaXN0KHBjLCBjMSksXG4gICAgICAgICAgZDIgID0gdXRpbHMuZGlzdChwYywgYzIpO1xuICAgICAgcmV0dXJuIGFicyhkMS1yZWYpICsgYWJzKGQyLXJlZik7XG4gICAgfSxcbiAgICBfaXRlcmF0ZTogZnVuY3Rpb24oZXJyb3JUaHJlc2hvbGQsIGNpcmNsZXMpIHtcbiAgICAgIHZhciBzID0gMCwgZSA9IDEsIHNhZmV0eTtcbiAgICAgIC8vIHdlIGRvIGEgYmluYXJ5IHNlYXJjaCB0byBmaW5kIHRoZSBcImdvb2QgYHRgIGNsb3Nlc3QgdG8gbm8tbG9uZ2VyLWdvb2RcIlxuICAgICAgZG8ge1xuICAgICAgICBzYWZldHk9MDtcblxuICAgICAgICAvLyBzdGVwIDE6IHN0YXJ0IHdpdGggdGhlIG1heGltdW0gcG9zc2libGUgYXJjXG4gICAgICAgIGUgPSAxO1xuXG4gICAgICAgIC8vIHBvaW50czpcbiAgICAgICAgdmFyIG5wMSA9IHRoaXMuZ2V0KHMpLCBucDIsIG5wMywgYXJjLCBwcmV2X2FyYztcblxuICAgICAgICAvLyBib29sZWFuczpcbiAgICAgICAgdmFyIGN1cnJfZ29vZCA9IGZhbHNlLCBwcmV2X2dvb2QgPSBmYWxzZSwgZG9uZTtcblxuICAgICAgICAvLyBudW1iZXJzOlxuICAgICAgICB2YXIgbSA9IGUsIHByZXZfZSA9IDEsIHN0ZXAgPSAwO1xuXG4gICAgICAgIC8vIHN0ZXAgMjogZmluZCB0aGUgYmVzdCBwb3NzaWJsZSBhcmNcbiAgICAgICAgZG8ge1xuICAgICAgICAgIHByZXZfZ29vZCA9IGN1cnJfZ29vZDtcbiAgICAgICAgICBwcmV2X2FyYyA9IGFyYztcbiAgICAgICAgICBtID0gKHMgKyBlKS8yO1xuICAgICAgICAgIHN0ZXArKztcblxuICAgICAgICAgIG5wMiA9IHRoaXMuZ2V0KG0pO1xuICAgICAgICAgIG5wMyA9IHRoaXMuZ2V0KGUpO1xuXG4gICAgICAgICAgYXJjID0gdXRpbHMuZ2V0Y2NlbnRlcihucDEsIG5wMiwgbnAzKTtcbiAgICAgICAgICB2YXIgZXJyb3IgPSB0aGlzLl9lcnJvcihhcmMsIG5wMSwgcywgZSk7XG4gICAgICAgICAgY3Vycl9nb29kID0gKGVycm9yIDw9IGVycm9yVGhyZXNob2xkKTtcblxuICAgICAgICAgIGRvbmUgPSBwcmV2X2dvb2QgJiYgIWN1cnJfZ29vZDtcbiAgICAgICAgICBpZighZG9uZSkgcHJldl9lID0gZTtcblxuICAgICAgICAgIC8vIHRoaXMgYXJjIGlzIGZpbmU6IHdlIGNhbiBtb3ZlICdlJyB1cCB0byBzZWUgaWYgd2UgY2FuIGZpbmQgYSB3aWRlciBhcmNcbiAgICAgICAgICBpZihjdXJyX2dvb2QpIHtcbiAgICAgICAgICAgIC8vIGlmIGUgaXMgYWxyZWFkeSBhdCBtYXgsIHRoZW4gd2UncmUgZG9uZSBmb3IgdGhpcyBhcmMuXG4gICAgICAgICAgICBpZiAoZSA+PSAxKSB7XG4gICAgICAgICAgICAgIHByZXZfZSA9IDE7XG4gICAgICAgICAgICAgIHByZXZfYXJjID0gYXJjO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIGlmIG5vdCwgbW92ZSBpdCB1cCBieSBoYWxmIHRoZSBpdGVyYXRpb24gZGlzdGFuY2VcbiAgICAgICAgICAgIGUgPSBlICsgKGUtcykvMjtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyB0aGlzIGlzIGEgYmFkIGFyYzogd2UgbmVlZCB0byBtb3ZlICdlJyBkb3duIHRvIGZpbmQgYSBnb29kIGFyY1xuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZSA9IG07XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHdoaWxlKCFkb25lICYmIHNhZmV0eSsrPDEwMCk7XG5cbiAgICAgICAgaWYoc2FmZXR5Pj0xMDApIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKFwiYXJjIGFic3RyYWN0aW9uIHNvbWVob3cgZmFpbGVkLi4uXCIpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gY29uc29sZS5sb2coXCJbRl0gYXJjIGZvdW5kXCIsIHMsIHByZXZfZSwgcHJldl9hcmMueCwgcHJldl9hcmMueSwgcHJldl9hcmMucywgcHJldl9hcmMuZSk7XG5cbiAgICAgICAgcHJldl9hcmMgPSAocHJldl9hcmMgPyBwcmV2X2FyYyA6IGFyYyk7XG4gICAgICAgIGNpcmNsZXMucHVzaChwcmV2X2FyYyk7XG4gICAgICAgIHMgPSBwcmV2X2U7XG4gICAgICB9XG4gICAgICB3aGlsZShlIDwgMSk7XG4gICAgICByZXR1cm4gY2lyY2xlcztcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogZWRpdGVkIERlbmlzIFBvbm9tYXJldiB3d3cuaG9tZXRsdC5ydVxuICAgICAqL1xuICAgIGdldFRieUxlbmd0aDogZnVuY3Rpb24obGVuZ3RoLCBhY2N1cmFjeSAsIG9mZnNldFQgKXtcbiAgICAgIG9mZnNldFQgPSBvZmZzZXRUIHx8IDA7XG4gICAgICBhY2N1cmFjeSA9IGFjY3VyYWN5IHx8IDAuMDA1O1xuICAgICAgaWYobGVuZ3RoID09IDAgKXJldHVybiBvZmZzZXRUO1xuICAgICAgdmFyIHB0MSA9IHRoaXMuZ2V0KG9mZnNldFQpLCBwdDIsIHQ9IG9mZnNldFQsICBkeCAsIGR5O1xuICAgICAgdmFyIGRpc3QgPSAwO1xuICAgICAgZG97XG4gICAgICAgIHQrPSBhY2N1cmFjeTtcbiAgICAgICAgcHQyID0gdGhpcy5nZXQodCk7XG4gICAgICAgIGR4ID0gcHQyLnggLSBwdDEueDtcbiAgICAgICAgZHkgPSBwdDIueSAtIHB0MS55O1xuICAgICAgICBkaXN0ICs9IE1hdGguc3FydChkeCAqIGR4ICsgZHkgKiBkeSk7XG4gICAgICAgIHB0MSA9IHB0MjtcbiAgICAgICAgaWYodCA+PSAxKXtcbiAgICAgICAgICByZXR1cm4gdGhpcy5sZW5ndGgoKTtcbiAgICAgICAgfVxuICAgICAgfSB3aGlsZShkaXN0IDwgIGxlbmd0aCk7XG5cbiAgICAgIHJldHVybiB0O1xuICAgIH1cbiAgfTtcbiAgcmV0dXJuIEJlemllcjtcbn0oKSk7XG5cbmlmICh0eXBlb2YgZXhwb3J0cyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgbW9kdWxlLmV4cG9ydHMgPSBCZXppZXI7XG59XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL3BsdWdpbnMvYmV6aWVyLmpzIiwiZmFicmljLmRlYnVnID0gREVWRUxPUE1FTlQ7XG5cbmZhYnJpYy51dGlsLmRhdGEgPSByZXF1aXJlKCcuL3V0aWwvZGF0YScpO1xuZmFicmljLnV0aWwucGF0aCA9IHJlcXVpcmUoJy4vdXRpbC9wYXRoJyk7XG5mYWJyaWMudXRpbC5jb21waWxlID0gcmVxdWlyZSgnLi91dGlsL2NvbXBpbGUnKTtcbmZhYnJpYy51dGlsLmxvYWRlciA9IHJlcXVpcmUoJy4vdXRpbC9sb2FkZXInKTtcbmZhYnJpYy51dGlsLnN5bnRheCA9IHJlcXVpcmUoXCIuL3V0aWwvc3ludGF4XCIpO1xuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMudXRpbC5vYmplY3QscmVxdWlyZSgnLi91dGlsL29iamVjdC5qcycpKTtcbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLnV0aWwscmVxdWlyZSgnLi91dGlsL3V0aWwuanMnKSk7XG5cbi8vcmVxdWlyZSgnLi9tb2R1bGVzJyk7XG5cbnJlcXVpcmUoJy4vY29yZS9iYXNlJyk7XG5yZXF1aXJlKCcuL2NvcmUvb2JzZXJ2ZScpO1xucmVxdWlyZSgnLi9jb3JlL2FwcGxpY2F0aW9uJyk7XG5yZXF1aXJlKCcuL2NvcmUvc3RhdGljLWNhbnZhcy5leHQnKTtcbnJlcXVpcmUoJy4vY29yZS9zbGlkZScpO1xucmVxdWlyZSgnLi9jb3JlL2FwcGxpY2F0aW9uLnNsaWRlcycpO1xucmVxdWlyZSgnLi9jb3JlL2FwcGxpY2F0aW9uLnByb3RvdHlwZXMnKTtcbnJlcXVpcmUoJy4vY29yZS9vYmplY3QuZXh0Jyk7XG5yZXF1aXJlKCcuL2NvcmUvdGV4dC5leHQnKTtcbnJlcXVpcmUoJy4vY29yZS9ncm91cC5leHQnKTtcbnJlcXVpcmUoJy4vY29yZS9pbWFnZS5leHQnKTtcbi8vIHJlcXVpcmUoJy4vbW9kdWxlcy9zbGlkZS5zdHJldGNoYWJsZScpO1xucmVxdWlyZSgnLi9tb2R1bGVzL3NsaWRlLnRlbXBsYXRlJyk7XG5yZXF1aXJlKCcuL21vZHVsZXMvc2xpZGUuYXJlYXMnKTtcbnJlcXVpcmUoJy4vbW9kdWxlcy9zbGlkZS5kcmF3aW5nLXRvb2xzJyk7XG5yZXF1aXJlKCcuL21vZHVsZXMvdG9vbGJhcicpO1xucmVxdWlyZSgnLi9tb2R1bGVzL2NhbnZhcy5ldmVudHMnKTtcbnJlcXVpcmUoJy4vbW9kdWxlcy9pbWFnZS5maWx0ZXJzJyk7XG5yZXF1aXJlKCcuL21vZHVsZXMvZm9udHMnKTtcbnJlcXVpcmUoJy4vbW9kdWxlcy9nYWxsZXJ5Jyk7XG5yZXF1aXJlKCcuL21vZHVsZXMvbGlicmFyeScpO1xucmVxdWlyZSgnLi9tb2R1bGVzL2RlYnVnJyk7XG5yZXF1aXJlKCcuL21vZHVsZXMvZnJvbVVSTCcpO1xucmVxdWlyZSgnLi9tb2R1bGVzL3VwbG9hZCcpO1xucmVxdWlyZSgnLi9tb2R1bGVzL2xvYWRlcicpO1xucmVxdWlyZSgnLi9tb2R1bGVzL2Ryb3BwYWJsZScpO1xucmVxdWlyZSgnLi9tb2R1bGVzL3J1bGVyJyk7XG5yZXF1aXJlKCcuL21vZHVsZXMvcmVuZGVyJyk7XG5yZXF1aXJlKCcuL21vZHVsZXMvdGh1bWInKTtcbnJlcXVpcmUoJy4vbW9kdWxlcy9jbGlwVG8nKTtcbnJlcXVpcmUoJy4vbW9kdWxlcy9tb3ZlbWVudExpbWl0cycpO1xucmVxdWlyZSgnLi9tb2R1bGVzL2hpc3RvcnknKTtcbnJlcXVpcmUoJy4vbW9kdWxlcy96b29tJyk7XG5yZXF1aXJlKCcuL21vZHVsZXMvaW50ZXJhY3RpdmVNb2RlJyk7XG5yZXF1aXJlKCcuL21vZHVsZXMvYm9yZGVySW1hZ2UnKTtcbnJlcXVpcmUoJy4vbW9kdWxlcy9zYXZlQXMnKTtcbnJlcXVpcmUoJy4vYnJ1c2hlcy9CYXNlQnJ1c2gnKTtcbnJlcXVpcmUoJy4vYnJ1c2hlcy9QZW5jaWxCcnVzaCcpO1xucmVxdWlyZSgnLi9icnVzaGVzL1JlY3RhbmdsZUJydXNoJyk7XG5yZXF1aXJlKCcuL2JydXNoZXMvUG9seWdvbkJydXNoJyk7XG5yZXF1aXJlKCcuL2JydXNoZXMvUGFpbnRQZW5CcnVzaCcpO1xucmVxdWlyZSgnLi9icnVzaGVzL1BhaW50QnVja2V0QnJ1c2gnKTtcbnJlcXVpcmUoJy4vYnJ1c2hlcy9Qb2ludHNCcnVzaCcpO1xucmVxdWlyZSgnLi9zaGFwZXMvcGF0aCcpO1xucmVxdWlyZSgnLi9zaGFwZXMvY2xpcGFydCcpO1xucmVxdWlyZSgnLi9zaGFwZXMvcGhvdG8nKTtcbnJlcXVpcmUoJy4vc2hhcGVzL3BvbHlsaW5lJyk7XG5yZXF1aXJlKCcuL3NoYXBlcy9pbWFnZS5waG90b3Nob3AtdG9vbHMnKTtcbnJlcXVpcmUoJy4vc2hhcGVzL2ltYWdlLnJlbW92ZS13aGl0ZScpO1xuXG4vLyByZXF1aXJlKCcuL3NoYXBlcy9iZXppZXJUZXh0Jyk7XG5yZXF1aXJlKCcuL3NoYXBlcy90ZXh0Ym94Lmxpc3QnKTtcbnJlcXVpcmUoJy4vc2hhcGVzL3RleHRGcmFtZScpO1xuXG5cbmlmKCFmYWJyaWMuaXNMaWtlbHlOb2RlKXtcbiAgLyoqXG4gICAqIGlubGluZSBzY3JpcHQgaW1hZ2VzXG4gICAqIEB0eXBlIHt7ZXJyb3I6IHN0cmluZ319XG4gICAqL1xuICBmYWJyaWMubWVkaWEgPSB7XG4gICAgLyoqXG4gICAgICogcmVwbGFjZSBpbWFnZXMgbG9hZGVkIHdpdGggZXJyb3JzXG4gICAgICovXG4gICAgZXJyb3I6ICdkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LCcgKyByZXF1aXJlKCdiYXNlNjQtbG9hZGVyIS4vbWVkaWEvZXJyb3ItYnV0dG9uLnN2ZycpXG4gIH07XG59XG5cbm1vZHVsZS5leHBvcnRzICA9IGZhYnJpYztcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmllcmEuanMiLCJcbnZhciBwYXRoID0gcmVxdWlyZShcIi4vcGF0aFwiKTtcbnZhciB1dGlsID0gcmVxdWlyZShcIi4vdXRpbFwiKTtcbnZhciBvYmplY3QgPSByZXF1aXJlKFwiLi9vYmplY3RcIik7XG5cbmZ1bmN0aW9uIGlzU2VydmVyKCkge1xuICByZXR1cm4gISAodHlwZW9mIHdpbmRvdyAhPSAndW5kZWZpbmVkJyAmJiB3aW5kb3cuZG9jdW1lbnQpO1xufVxuXG5cbmlmIChpc1NlcnZlcigpKSB7XG4gIHZhciBmcyA9IHJlcXVpcmUoJ2ZzJyk7XG59XG5cblxuZnVuY3Rpb24gX2xvYWRfanNvbiAodmFsdWUsIGNhbGxiYWNrX3N1Y2Nlc3MsIGNhbGxiYWNrX2Vycm9yKXtcblxuICB2YXIgb3V0cHV0ID0gbnVsbDtcbiAgdmFyIGVycm9ycyA9IFtdO1xuXG4gIGlmICh2YWx1ZS5jb25zdHJ1Y3RvciA9PSBTdHJpbmcpIHtcblxuICAgIHZhciBmaWxlbmFtZSwgcmVnZXhfZGF0YSwgaW5pdF9wcm9wZXJ0eTtcbiAgICByZWdleF9kYXRhID0gL14oW14jXSopIz8oLiopJC8uZXhlYyh2YWx1ZSk7XG5cbiAgICBmaWxlbmFtZSA9IHJlZ2V4X2RhdGFbMV07XG4gICAgaW5pdF9wcm9wZXJ0eSA9IHJlZ2V4X2RhdGFbMl07XG4gICAgdXRpbHMuZ2V0SW5saW5lSnNvbihmaWxlbmFtZSwgXCJqc29uXCIsIF9sb2FkSnNvbl9kYXRhLCBmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgIGVycm9ycy5wdXNoKGVycm9yKTtcbiAgICAgIGlmIChjYWxsYmFja19lcnJvcikge1xuICAgICAgICBjYWxsYmFja19lcnJvcihlcnJvcilcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJmaWxlOiBcXFwiXCIgKyBmaWxlbmFtZSArIFwiXFxcIi4gXCIgKyBlcnJvci5tZXNzYWdlKVxuICAgICAgfVxuICAgIH0pO1xuICB9IGVsc2Uge1xuICAgIF9sb2FkSnNvbl9kYXRhKHZhbHVlKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9sb2FkSnNvbl9kYXRhKGRhdGEpIHtcbiAgICAvKlxuICAgICDQt9Cw0LzQtdC90LAg0LfQsNC/0LjRgdC10LkgXCJ1cmwoLi9wYXRoL3RvL2ZpbGUpICDQvdCwIFwiLi4vLi4vcGF0aC90by9maWxlXCJcbiAgICAgdXJsINC90LDRh9C40L3QsNGO0YnQuNC10YHRjyDRgSAuLyDQvtGC0L3QvtGB0LjRgtC10LvRjNC90L4g0YDQvtC00LjRgtC10LvRjNC60L7Qs9C+IGpzb24g0YTQsNC50LvQsFxuXG4gICAgIHVybCDRgSBcIi9cIiDQtNC+0LHQsNCy0LvRj9C10YLRgdGPIEFQUF9TVEFUSUNfUEFUSFxuICAgICAqL1xuICAgIHV0aWxzLnJlY291cnNpdmUoZGF0YSxcbiAgICAgIGZ1bmN0aW9uIChwcm9wZXJ0eSwgdmFsdWUsIHBhcmVudCkge1xuICAgICAgICBpZiAoL151cmxcXCguKlxcKSQvLnRlc3QodmFsdWUpKSB7XG4gICAgICAgICAgdmFyIHJlZ2V4X2RhdGEgPSAvXnVybFxcKChcXC4/XFwvKT8oLiopXFwpJC8uZXhlYyh2YWx1ZSk7XG4gICAgICAgICAgdmFyIHVybCA9IHJlZ2V4X2RhdGFbMl07XG5cbiAgICAgICAgICBpZiAocmVnZXhfZGF0YVsxXSA9PSBcIi9cIikge1xuICAgICAgICAgICAgdXJsID0gd2luZG93LkFQUF9TVEFUSUNfUEFUSCArIHVybDtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHJlZ2V4X2RhdGFbMV0gPT0gXCIuL1wiKSB7XG4gICAgICAgICAgICB1cmwgPSBwYXRoLmdldFBhcmVudERpcmVjdG9yeVVybChmaWxlbmFtZSkgKyB1cmw7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcGFyZW50W3Byb3BlcnR5XSA9IHBhdGgucmVzb2x2ZSh1cmwpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgKTtcblxuXG4gICAgdmFyIGxvYWRlciA9IHV0aWwucXVldWVMb2FkKDEsIGZ1bmN0aW9uIGZpbmFsaXplKCkge1xuXG4gICAgICBpZiAoaW5pdF9wcm9wZXJ0eSkge1xuICAgICAgICB2YXIgcHJvcF9hcnIgPSBpbml0X3Byb3BlcnR5LnNwbGl0KFwiL1wiKTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wX2Fyci5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIGRhdGEgPSBkYXRhW3Byb3BfYXJyW2ldXTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAoZXJyb3JzLmxlbmd0aCkge1xuICAgICAgICBpZiAoY2FsbGJhY2tfZXJyb3IpIGNhbGxiYWNrX2Vycm9yKGVycm9ycyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoY2FsbGJhY2tfc3VjY2VzcykgY2FsbGJhY2tfc3VjY2VzcyhkYXRhKTtcbiAgICAgICAgb3V0cHV0ID0gZGF0YTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8qKlxuICAgICAqIHJlbW92ZSBjb21tZW50c1xuICAgICAqL1xuICAgIHV0aWxzLnJlY291cnNpdmUoZGF0YSwgZnVuY3Rpb24gKHByb3BlcnR5LCB2YWx1ZSwgcGFyZW50KSB7XG4gICAgICAvKlxuICAgICAgIHJlbW92ZSBjb21tZW50cyBsaWtlXG4gICAgICAgW1wiQGNvbW1lbnQoKVwiXVxuICAgICAgIFwiQGNvbW1lbnRcIjoge31cbiAgICAgICAqL1xuICAgICAgaWYgKC9eXFwvXFwvLiokLy50ZXN0KHZhbHVlKSB8fCAvXkBjb21tZW50XFwoLipcXCkkLy50ZXN0KHZhbHVlKSB8fCBwcm9wZXJ0eSA9PSBcIkBjb21tZW50XCIpIHtcbiAgICAgICAgaWYgKHBhcmVudC5jb25zdHJ1Y3RvciA9PSBBcnJheSkge1xuICAgICAgICAgIHBhcmVudC5zcGxpY2UocHJvcGVydHksIDEpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGRlbGV0ZSBwYXJlbnRbcHJvcGVydHldO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKC9eQGV4dGVuZC4qJC8udGVzdChwcm9wZXJ0eSkpIHtcblxuICAgICAgICBsb2FkZXIudG90YWwrKztcbiAgICAgICAgX2xvYWRfanNvbih2YWx1ZSwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICB2YXIgZXh0X2RhdGEgPSBvYmplY3QuZGVlcEV4dGVuZChkYXRhLCBwYXJlbnQpO1xuICAgICAgICAgIG9iamVjdC5kZWVwRXh0ZW5kKHBhcmVudCwgZXh0X2RhdGEpO1xuICAgICAgICAgIGRlbGV0ZSBwYXJlbnRbXCJAZXh0ZW5kXCJdO1xuICAgICAgICAgIGxvYWRlcigpO1xuICAgICAgICB9LCBmdW5jdGlvbiAoZGF0YSwgZXJyb3IpIHtcbiAgICAgICAgICBlcnJvcnMucHVzaChlcnJvcik7XG4gICAgICAgICAgbG9hZGVyKCk7XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIGlmICgvXkBleHRlbmRcXCguKlxcKSQvLnRlc3QodmFsdWUpKSB7XG4gICAgICAgIHZhciBfcmVnX2RhdGEgPSAvXkBleHRlbmRcXCgoXFwuXFwvKT8oLiopXFwpJC8uZXhlYyh2YWx1ZSk7XG4gICAgICAgIHZhciB1cmwgPSBfcmVnX2RhdGFbMl07XG4gICAgICAgIGlmIChfcmVnX2RhdGFbMV0pIHtcbiAgICAgICAgICB1cmwgPSBwYXRoLmdldFBhcmVudERpcmVjdG9yeVVybChmaWxlbmFtZSkgKyB1cmw7XG4gICAgICAgIH1cbiAgICAgICAgbG9hZGVyLnRvdGFsKys7XG4gICAgICAgIF9sb2FkX2pzb24odXJsLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgIHBhcmVudFtwcm9wZXJ0eV0gPSBkYXRhO1xuICAgICAgICAgIGxvYWRlcigpO1xuICAgICAgICB9LCBmdW5jdGlvbiAoZGF0YSwgZXJyb3IpIHtcbiAgICAgICAgICBlcnJvcnMucHVzaChlcnJvcik7XG4gICAgICAgICAgbG9hZGVyKCk7XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIGlmICgvXkBtaXhpblxcKC4qXFwpJC8udGVzdCh2YWx1ZSkpIHtcbiAgICAgICAgdmFyIF9yZWdfZGF0YSA9IC9eQG1peGluXFwoKFxcLlxcLyk/KC4qKVxcKSQvLmV4ZWModmFsdWUpO1xuICAgICAgICB2YXIgdXJsID0gX3JlZ19kYXRhWzJdO1xuICAgICAgICBpZiAoX3JlZ19kYXRhWzFdKSB7XG4gICAgICAgICAgdXJsID0gcGF0aC5nZXRQYXJlbnREaXJlY3RvcnlVcmwoZmlsZW5hbWUpICsgdXJsO1xuICAgICAgICB9XG4gICAgICAgIGxvYWRlci50b3RhbCsrO1xuICAgICAgICBfbG9hZF9qc29uKHVybCwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICBpZiAocGFyZW50LmNvbnN0cnVjdG9yID09IEFycmF5KSB7XG4gICAgICAgICAgICBwYXJlbnQuc3BsaWNlKHByb3BlcnR5LCAxKTtcbiAgICAgICAgICAgIGZvciAodmFyIGkgaW4gZGF0YSkge1xuICAgICAgICAgICAgICBwYXJlbnQucHVzaChkYXRhW2ldKVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBkZWxldGUgcGFyZW50W3Byb3BlcnR5XTtcbiAgICAgICAgICAgIGZvciAodmFyIGkgaW4gZGF0YSkge1xuICAgICAgICAgICAgICBwYXJlbnRbaV0gPSBkYXRhW2ldO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBsb2FkZXIoKTtcbiAgICAgICAgfSwgZnVuY3Rpb24gKGRhdGEsIGVycm9yKSB7XG4gICAgICAgICAgZXJyb3JzLnB1c2goZXJyb3IpO1xuICAgICAgICAgIGxvYWRlcigpO1xuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSBpZiAoL15AbG9hZFxcKCguKilcXCkkLy50ZXN0KHZhbHVlKSkge1xuICAgICAgICB2YXIgX3JlZ19kYXRhID0gL15AbG9hZFxcKChcXC4/XFwvKT8oLiopXFwpJC8uZXhlYyh2YWx1ZSk7XG4gICAgICAgIHZhciB1cmwgPSBfcmVnX2RhdGFbMl07XG4gICAgICAgIGlmIChfcmVnX2RhdGFbMV0gPT0gXCIvXCIpIHtcbiAgICAgICAgICB1cmwgPSB3aW5kb3cuQVBQX1NUQVRJQ19QQVRIICsgdXJsO1xuICAgICAgICB9XG4gICAgICAgIGlmIChfcmVnX2RhdGFbMV0gPT0gXCIuL1wiKSB7XG4gICAgICAgICAgdXJsID0gcGF0aC5nZXRQYXJlbnREaXJlY3RvcnlVcmwoZmlsZW5hbWUpICsgdXJsO1xuICAgICAgICB9XG5cbiAgICAgICAgbG9hZGVyLnRvdGFsKys7XG4gICAgICAgIHV0aWxzLmdldElubGluZUpzb24odXJsLCBcImh0bWxcIiwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICBwYXJlbnRbcHJvcGVydHldID0gZGF0YTtcbiAgICAgICAgICBsb2FkZXIoKTtcbiAgICAgICAgfSwgZnVuY3Rpb24gKGRhdGEsIGVycm9yKSB7XG4gICAgICAgICAgZXJyb3JzLnB1c2goZXJyb3IpO1xuICAgICAgICAgIGxvYWRlcigpO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgIH0pO1xuICAgIGxvYWRlcigpO1xuXG4gIH1cblxuICByZXR1cm4gb3V0cHV0O1xufVxuXG52YXIgdXRpbHMgPSB7XG4gIENBQ0hFRF9KU09OIDoge30sXG4gIGxvYWRKc29uU3luYzogZnVuY3Rpb24oc3JjKXtcbiAgICB2YXIgZGF0YTtcbiAgICBfbG9hZF9qc29uKHNyYyxmdW5jdGlvbihfZGF0YSl7XG4gICAgICBkYXRhID0gX2RhdGE7XG4gICAgfSk7XG4gICAgcmV0dXJuIGRhdGE7XG4gIH0sXG5cbiAgLyoqXG4gICDQv9C+0LfQstC+0LvRj9C10YIg0LjRgdC/0L7Qu9GM0LfQvtCy0LDRgtGMINC60L7QvdGB0YLRgNGD0LrRhtC40Lgg0LLQuNC00LBcbiAgINGA0LDRgdGI0LjRgNC40YLRjCDQtNCw0L3QvdGL0LUg0LjQtyDRhNCw0LnQu9CwIHRlbXBsYXRlLmpzb25cbiAgIFwiQGV4dGVuZFwiIDogXCJ1cmwoZGF0YS90ZW1wbGF0ZS5qc29uKVwiLFxuICAgXCJAZXh0ZW5kXCIgOiBcInVybChkYXRhL3RlbXBsYXRlLmpzb24jc2V0dGluZ3Mvc3RhZ2VzKVwiLFxuXG4gICAvL9C30LDQvNC10L3QuNGC0Ywg0YHRgtGA0L7QutGDINC90LDQtNCw0L3QvdGL0LUg0LjQtyDRhNCw0LnQu9CwXG4gICBcInN0YWdlc1wiOiAgICAgICBcInVybChkYXRhL3RlbXBsYXRlLmpzb24jc2V0dGluZ3Mvc3RhZ2VzKVwiLFxuXG4gICAqIEBwYXJhbSBmaWxlbmFtZVxuICAgKiBAcGFyYW0gY2FsbGJhY2tfc3VjY2Vzc1xuICAgKiBAcGFyYW0gY2FsbGJhY2tfZXJyb3JcbiAgICovXG4gIGxvYWRKc29uOiBmdW5jdGlvbiAodmFsdWUscmVzb2x2ZV9jYixmYWlsX2NiKSB7XG4gICAgICByZXR1cm4gX2xvYWRfanNvbih2YWx1ZSxmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgcmVzb2x2ZV9jYiAmJiByZXNvbHZlX2NiKGRhdGEpO1xuICAgICAgfSxmdW5jdGlvbihlcnIpe1xuICAgICAgICBmYWlsX2NiICYmIGZhaWxfY2IoZXJyKTtcbiAgICAgIH0pO1xuICB9LFxuXG4gIHJlbW92ZUNvbW1lbnRzOiBmdW5jdGlvbiAoc3RyKSB7XG4gICAgc3RyID0gc3RyLnJlcGxhY2UoL15cXHMqKFxcL1xcLy4qfCg/OlxcL1xcKltcXHNcXFNdKj8pXFwqXFwvXFxzKikkL2dtLFwiXCIpO1xuICAgIHJldHVybiBzdHI7XG4gIH0sXG4gIC8qKlxuICAgKlxuICAgKiBAcGFyYW0gb2JqZWN0XG4gICAqIEBwYXJhbSBjcml0ZXJpYSAtINCy0YvQv9C+0LvQvdGP0YLRjCDRhNGD0L3QutGG0LjRjiDRgdC+INCy0YHQtdC80Lgg0L7QsdGK0LXQutGC0LDQvNC4XG4gICAqL1xuICByZWNvdXJzaXZlOiBmdW5jdGlvbiAob2JqZWN0LCBjcml0ZXJpYSkge1xuICAgIHZhciByZWFkZWQgPSBbXTtcbiAgICBpZiAoIW9iamVjdCkgcmV0dXJuO1xuICAgIHJldHVybiAoZnVuY3Rpb24gc3ViX3JlY291cnNpdmUob2JqZWN0KSB7XG4gICAgICBpZiAocmVhZGVkLmluZGV4T2Yob2JqZWN0KSAhPSAtMSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICByZWFkZWQucHVzaChvYmplY3QpO1xuXG5cbiAgICAgIGlmIChvYmplY3QgaW5zdGFuY2VvZiBBcnJheSkge1xuICAgICAgICBmb3IgKHZhciBwcm9wID0gb2JqZWN0Lmxlbmd0aDsgcHJvcC0tOykge1xuICAgICAgICAgIGlmIChvYmplY3RbcHJvcF0gJiYgKG9iamVjdFtwcm9wXS5jb25zdHJ1Y3RvciA9PSBPYmplY3QgfHwgb2JqZWN0W3Byb3BdLmNvbnN0cnVjdG9yID09IEFycmF5KSkge1xuICAgICAgICAgICAgc3ViX3JlY291cnNpdmUob2JqZWN0W3Byb3BdKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmFyIGJyZWFrXyA9IGNyaXRlcmlhKHByb3AsIG9iamVjdFtwcm9wXSwgb2JqZWN0KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGZvciAodmFyIHByb3AgaW4gb2JqZWN0KSB7XG4gICAgICAgICAgaWYgKG9iamVjdFtwcm9wXSAmJiAob2JqZWN0W3Byb3BdLmNvbnN0cnVjdG9yID09IE9iamVjdCB8fCBvYmplY3RbcHJvcF0uY29uc3RydWN0b3IgPT0gQXJyYXkpKSB7XG4gICAgICAgICAgICBzdWJfcmVjb3Vyc2l2ZShvYmplY3RbcHJvcF0pO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB2YXIgYnJlYWtfID0gY3JpdGVyaWEocHJvcCwgb2JqZWN0W3Byb3BdLCBvYmplY3QpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pKG9iamVjdCk7XG4gIH0sXG5cbiAgcGFyc2VDU1Y6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgdmFyIHJvd3MgPSBkYXRhLnNwbGl0KC9cXG4vKTtcbiAgICB2YXIgY29sdW1ucyA9IHJvd3NbMF0uc3BsaXQoJywnKTtcbiAgICByb3dzLnNwbGljZSgwLCAxKTtcblxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcm93cy5sZW5ndGg7IGkrKykge1xuICAgICAgdmFyIG91dHB1dF9yb3dfZGF0YSA9IHt9O1xuICAgICAgdmFyIHJvd19kYXRhID0gW107XG5cblxuICAgICAgdmFyIF9xdW90ZSA9IGZhbHNlLCBsYXN0ID0gLTE7XG4gICAgICB2YXIgaiA9IC0xO1xuICAgICAgdmFyIHN0ciA9IHJvd3NbaV07XG4gICAgICB3aGlsZSAoKytqIDwgc3RyLmxlbmd0aCkge1xuICAgICAgICBpZiAoIV9xdW90ZSkge1xuICAgICAgICAgIGlmIChzdHJbal0gPT0gJ1xcJycgfHwgc3RyW2pdID09ICdcXFwiJykge1xuICAgICAgICAgICAgX3F1b3RlID0gc3RyW2pdO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoc3RyW2pdID09IFwiLFwiKSB7XG4gICAgICAgICAgICB2YXIgX3ZhbCA9IHN0ci5zdWJzdHJpbmcobGFzdCwgaik7XG4gICAgICAgICAgICBpZiAoX3ZhbFswXSA9PSAnXFxcIicgJiYgX3ZhbFtfdmFsLmxlbmd0aCAtIDFdID09ICdcXFwiJykge1xuICAgICAgICAgICAgICBfdmFsID0gX3ZhbC5zdWJzdHJpbmcoMSwgX3ZhbC5sZW5ndGggLSAxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJvd19kYXRhLnB1c2goX3ZhbCk7XG4gICAgICAgICAgICBsYXN0ID0gaiArIDE7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmIChzdHJbal0gPT0gX3F1b3RlKSB7XG4gICAgICAgICAgICBfcXVvdGUgPSBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgZm9yICh2YXIgaiBpbiByb3dfZGF0YSkge1xuICAgICAgICBvdXRwdXRfcm93X2RhdGFbY29sdW1uc1tqXV0gPSByb3dfZGF0YVtqXTtcbiAgICAgIH1cbiAgICAgIHJvd3NbaV0gPSBvdXRwdXRfcm93X2RhdGE7XG4gICAgfVxuICAgIHJldHVybiByb3dzO1xuICB9LFxuICAvKipcbiAgICpcbiAgICogaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvNDg0Mzc0Ni9yZWd1bGFyLWV4cHJlc3Npb24tdG8tYWRkLWRvdWJsZS1xdW90ZXMtYXJvdW5kLWtleXMtaW4tamF2YXNjcmlwdFxuICAgKi9cbiAgZG91YmxlUXVvdGU6IGZ1bmN0aW9uKGpzb25TdHJpbmcpe1xuICAgIHZhciBvYmpLZXlzUmVnZXggPSAvKHt8LCkoPzpcXHMqKSg/OicpPyhbQS1aYS16XyRcXC5dW0EtWmEtejAtOV8gXFwtXFwuJF0qKSg/OicpPyg/OlxccyopOi9nOy8vIGxvb2sgZm9yIG9iamVjdCBuYW1lc1xuICAgIHJldHVybiBqc29uU3RyaW5nLnJlcGxhY2Uob2JqS2V5c1JlZ2V4LCBcIiQxXFxcIiQyXFxcIjpcIik7Ly8gYWxsIG9iamVjdCBuYW1lcyBzaG91bGQgYmUgZG91YmxlIHF1b3RlZFxuICB9LFxuICBwYXJzZURhdGE6IGZ1bmN0aW9uIChkYXRhLCBkYXRhVHlwZSkge1xuICAgIHZhciBfcGFyc2VkO1xuICAgIGlmIChkYXRhVHlwZSA9PSBcImNzdlwiKSB7XG4gICAgICBfcGFyc2VkID0gdXRpbHMucGFyc2VDU1YoZGF0YSk7XG4gICAgfSBlbHNlIGlmIChkYXRhVHlwZSA9PSBcImpzb25cIikge1xuICAgICAgX3BhcnNlZCA9IGRhdGEudHJpbSgpO1xuICAgICAgLy9pZiAoZGF0YVswXSAhPSBcIntcIiAmJiBkYXRhWzBdICE9IFwiW1wiKSB7XG4gICAgICAvLyAgcmV0dXJuIGZhbHNlO1xuICAgICAgLy99XG5cbiAgICAgIF9wYXJzZWQgPSB1dGlscy5yZW1vdmVDb21tZW50cyhfcGFyc2VkKTtcbiAgICAgIC8vZGF0YSAgPSBkYXRhLnJlcGxhY2UoL1xcbi9nLFwiXCIpXG5cblxuICAgICAgX3BhcnNlZCA9IHV0aWxzLmRvdWJsZVF1b3RlKF9wYXJzZWQpO1xuXG4gICAgICB0cnl7XG4gICAgICAgIHZhciBfcGFyc2VkID0gSlNPTi5wYXJzZShfcGFyc2VkKTsvLz0gSlNPTi5wYXJzZShkYXRhLnJlcGxhY2UoL1xcL1xcKltcXHNcXFNdKj9cXCpcXC98XFwvXFwvLiovZyxcIlwiKSk7XG4gICAgICB9Y2F0Y2goZSl7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgc3RhdHVzOiBcImVycm9yXCIsXG4gICAgICAgICAgbWVzc2FnZTogZS50b1N0cmluZygpLFxuICAgICAgICAgIGRhdGE6ICBkYXRhXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICAvL3ZhciBzY3JpcHQgPSAkKFwiPHNjcmlwdCB0eXBlPSd0ZXh0L2pzb24nIGlkPSdcIiArIHVybCArIFwiJz5cIiArIEpTT04uc3RyaW5naWZ5KGRhdGEpICsgXCI8L3NjcmlwdD5cIik7XG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICBzdGF0dXM6IFwic3VjY2Vzc1wiLFxuICAgICAgZGF0YTogX3BhcnNlZFxuICAgIH07XG4gIH0sXG4gIGxvYWQ6IGZ1bmN0aW9uICh1cmwsIGRhdGFUeXBlLCBjYWxsYmFja19zdWNjZXNzLCBjYWxsYmFja19lcnJvcikge1xuICAgIC8vdG9kb1xuICAgIGlmIChpc1NlcnZlcigpKSB7XG4gICAgICB0cnkge1xuICAgICAgICB2YXIgZGF0YSA9IGZzLnJlYWRGaWxlU3luYyh1cmwsICd1dGY4Jyk7XG4gICAgICAgIGRhdGEgPSBkYXRhLnJlcGxhY2UoL15cXHVGRUZGLywgJycpO1xuICAgICAgICB2YXIgX3BhcnNlZCA9IHV0aWxzLnBhcnNlRGF0YShkYXRhLCBkYXRhVHlwZSk7XG4gICAgICAgIGlmKF9wYXJzZWQuc3RhdHVzID09IFwiZXJyb3JcIil7XG4gICAgICAgICAgY2FsbGJhY2tfZXJyb3Ioe1xuICAgICAgICAgICAgc3RhdHVzOiAgIFwiZXJyb3JcIixcbiAgICAgICAgICAgIG1lc3NhZ2U6ICBfcGFyc2VkLm1lc3NhZ2UsXG4gICAgICAgICAgICBkYXRhOiAgICAgX3BhcnNlZC5kYXRhXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNhbGxiYWNrX3N1Y2Nlc3MoX3BhcnNlZC5kYXRhKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcblxuICAgICAgICBpZiAoZS5jb2RlID09PSAnRU5PRU5UJykge1xuICAgICAgICAgIGNvbnNvbGUubG9nKCdGaWxlIG5vdCBmb3VuZCEnKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aHJvdyBlO1xuICAgICAgICB9XG4gICAgICAgIGNhbGxiYWNrX2Vycm9yKGRhdGEpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG5cbiAgICAgIHZhciBodHRwUmVxdWVzdCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuXG4gICAgICBodHRwUmVxdWVzdC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChodHRwUmVxdWVzdC5yZWFkeVN0YXRlID09PSA0KSB7XG4gICAgICAgICAgaWYgKGh0dHBSZXF1ZXN0LnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICAgICAgICB2YXIgZGF0YSA9IGh0dHBSZXF1ZXN0LnJlc3BvbnNlVGV4dDtcbiAgICAgICAgICAgIHZhciBfcGFyc2VkID0gdXRpbHMucGFyc2VEYXRhKGRhdGEsIGRhdGFUeXBlKTtcbiAgICAgICAgICAgIGlmKF9wYXJzZWQuc3RhdHVzID09IFwiZXJyb3JcIil7XG4gICAgICAgICAgICAgIGNhbGxiYWNrX2Vycm9yKHtcbiAgICAgICAgICAgICAgICBzdGF0dXM6IGh0dHBSZXF1ZXN0LnN0YXR1cyxcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiAgX3BhcnNlZC5tZXNzYWdlLFxuICAgICAgICAgICAgICAgIHJlc3BvbnNlOiBodHRwUmVxdWVzdC5yZXNwb25zZVRleHRcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhbGxiYWNrX3N1Y2Nlc3MoX3BhcnNlZC5kYXRhKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY2FsbGJhY2tfZXJyb3IodXJsLCBodHRwUmVxdWVzdClcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICBodHRwUmVxdWVzdC5vcGVuKCdHRVQnLCB1cmwpO1xuICAgICAgaHR0cFJlcXVlc3Quc2VuZCgpO1xuICAgIH1cbiAgfSxcbiAgLyoqXG4gICAqINCf0L7Qt9Cy0L7Qu9GP0LXRgtC30LDQs9GA0YPQttCw0YLRjCBqc29uINGE0LDQudC70YsgLCDRgdC+0LTQtdGA0LbQsNGJ0LjQtSDRgdGB0YvQu9C60Lgg0L3QsCDQtNGA0YPQs9C40LUganNvbiDRhNCw0LnQu9GLLlxuICAgKiDQstC80LXRgdGC0L4g0YHRgdGL0LvQvtC6INGC0LjQv9CwXG4gICAqICBcInByb3BlcnR5XCIgOiBcInVybChjaHVuay5qc29uKVwiXG4gICAqICDQsdGD0LTQtdGCINC30LDQs9GA0YPQttC10L3QviDRgdC+0LTQtdGA0LbQuNC80L7QtSDRhNCw0LnQu9CwXG4gICAqICBcInByb3BlcnR5XCIgOiB7Li4ufVxuICAgKlxuICAgKiAg0LXRgdC70Lgg0YPQutCw0LfQsNGC0Ywg0Y/QutC+0YDRjFxuICAgKiAgXCJwcm9wZXJ0eVwiIDogXCJ1cmwoY2h1bmsuanNvbiNzZXR0aW5ncy9jaHVuay8wL3RleHQpXCJcbiAgICpcbiAgICog0YLQviDQsdGD0LTQtdGCINC30LDQs9GA0YPQttC10L3QviDRgdC+0LTQtdGA0LbQuNC80L7QtSDQv9C+0LvRjyBzZXR0aW5ncy5jaHVua1swXS50ZXh0INC40Lcg0YTQsNC50LvQsCBjaHVuay5qc29uXG4gICAqXG4gICAqXG4gICAqIEBwYXJhbSBmaWxlbmFtZSAg0L/Rg9GC0Ywg0Log0L7RgdC90L7QstC90L7QvNGDIGpzb24g0YTQsNC50LvRg1xuICAgKiBAcGFyYW0gY2FsbGJhY2sgINCx0YPQtNC10YIg0LLRi9C30LLQsNC9INC/0L7RgdC70LUg0L7QutC+0L3Rh9Cw0L3QuNGPINC30LDQs9GA0YPQt9C60Lgg0LLRgdC10YUg0YTQsNC50LvQvtCyXG4gICAqL1xuICBnZXRJbmxpbmVKc29uOiBmdW5jdGlvbiAodXJsLCBkYXRhVHlwZSwgY2FsbGJhY2tfc3VjY2VzcywgY2FsbGJhY2tfZXJyb3IpIHtcblxuICAgIGlmIChkYXRhVHlwZS5jb25zdHJ1Y3RvciAhPSBTdHJpbmcpIHtcbiAgICAgIGNhbGxiYWNrX2Vycm9yID0gY2FsbGJhY2tfc3VjY2VzcztcbiAgICAgIGNhbGxiYWNrX3N1Y2Nlc3MgPSBkYXRhVHlwZTtcbiAgICAgIGRhdGFUeXBlID0gXCJqc29uXCI7XG4gICAgfVxuXG5cbiAgICBpZiAodHlwZW9mIHV0aWxzLkNBQ0hFRF9KU09OICE9PSBcInVuZGVmaW5lZFwiICYmIHV0aWxzLkNBQ0hFRF9KU09OICYmIHV0aWxzLkNBQ0hFRF9KU09OW3VybF0pIHtcbiAgICAgIGNhbGxiYWNrX3N1Y2Nlc3ModXRpbHMuQ0FDSEVEX0pTT05bdXJsXSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICh0eXBlb2YgJCAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgaWYgKHR5cGVvZiBkb2N1bWVudCAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICB2YXIgaW5saW5lID0gJChcInNjcmlwdFtpZD0nXCIgKyB1cmwgKyBcIiddXCIpO1xuICAgICAgICBpZiAoaW5saW5lLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICB2YXIgX2RhdGEgPVxuICAgICAgICAgICAgaW5saW5lWzBdLmlubmVyVGV4dCB8fCAvL2FsbFxuICAgICAgICAgICAgaW5saW5lWzBdLnRleHRDb250ZW50IHx8IC8vZmlyZWZveFxuICAgICAgICAgICAgaW5saW5lWzBdLnRleHQ7IC8vaWU4XG4gICAgICAgICAgaWYgKGRhdGFUeXBlID09IFwianNvblwiKSB7XG5cbiAgICAgICAgICAgIHZhciBfZGF0YSA9IHV0aWxzLnJlbW92ZUNvbW1lbnRzKF9kYXRhKTtcbiAgICAgICAgICAgIGNhbGxiYWNrX3N1Y2Nlc3MoSlNPTi5wYXJzZShfZGF0YSkpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjYWxsYmFja19zdWNjZXNzKF9kYXRhKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHV0aWxzLmxvYWQodXJsLCBkYXRhVHlwZSwgY2FsbGJhY2tfc3VjY2VzcywgY2FsbGJhY2tfZXJyb3IpO1xuICB9XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IHV0aWxzO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy91dGlsL2RhdGEuanMiLCJtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoXCJmc1wiKTtcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyBleHRlcm5hbCBcImZzXCJcbi8vIG1vZHVsZSBpZCA9IDE2XG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIlxuXG5tb2R1bGUuZXhwb3J0cyA9IHtcblxuICBsb2FkU2NyaXB0OiBmdW5jdGlvbiAocmVxdWlyZW1lbnQsIGhlbHBlciwgZXJyb3IpIHtcbiAgICB2YXIgaGVhZCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdoZWFkJylbMF07XG4gICAgdmFyIHNjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpO1xuICAgIHNjcmlwdC50eXBlID0gJ3RleHQvamF2YXNjcmlwdCc7XG4gICAgc2NyaXB0Lm9uZXJyb3IgPSBlcnJvcjtcbiAgICBzY3JpcHQub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKHRoaXMucmVhZHlTdGF0ZSA9PSAnY29tcGxldGUnKSB7XG4gICAgICAgIGhlbHBlcihzY3JpcHQsIF9fc3JjKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHNjcmlwdC5hZGRFdmVudExpc3RlbmVyKFwibG9hZFwiLCBoZWxwZXIsIHRydWUpO1xuICAgIHNjcmlwdC5zcmMgPSByZXF1aXJlbWVudDtcbiAgICBoZWFkLmFwcGVuZENoaWxkKHNjcmlwdCk7XG4gIH0sXG4gIHNjcmlwdFVSTDogZnVuY3Rpb24gKCkge1xuXG4gICAgaWYgKGRvY3VtZW50LmN1cnJlbnRTY3JpcHQpIHtcbiAgICAgIHJldHVybiBkb2N1bWVudC5jdXJyZW50U2NyaXB0LnNyYztcbiAgICB9XG4gICAgdmFyIHNjcmlwdHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc2NyaXB0Jyk7XG4gICAgZm9yICh2YXIgaSA9IHNjcmlwdHMubGVuZ3RoIC0gMTsgaS0tOykge1xuICAgICAgaWYgKHNjcmlwdHNbaV0uc3JjKSB7XG4gICAgICAgIHJldHVybiBzY3JpcHRzW2ldLnNyYztcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59O1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy91dGlsL2xvYWRlci5qcyIsIlxudmFyIGRlZXBEaWZmTWFwcGVyID0ge1xuICBWQUxVRV9DUkVBVEVEOiAnY3JlYXRlZCcsXG4gIFZBTFVFX1VQREFURUQ6ICd1cGRhdGVkJyxcbiAgVkFMVUVfREVMRVRFRDogJ2RlbGV0ZWQnLFxuICBWQUxVRV9VTkNIQU5HRUQ6ICd1bmNoYW5nZWQnLFxuICBtYXA6IGZ1bmN0aW9uKG9iajEsIG9iajIpIHtcbiAgICBpZiAodGhpcy5pc0Z1bmN0aW9uKG9iajEpIHx8IHRoaXMuaXNGdW5jdGlvbihvYmoyKSkge1xuICAgICAgdGhyb3cgJ0ludmFsaWQgYXJndW1lbnQuIEZ1bmN0aW9uIGdpdmVuLCBvYmplY3QgZXhwZWN0ZWQuJztcbiAgICB9XG4gICAgaWYgKHRoaXMuaXNWYWx1ZShvYmoxKSB8fCB0aGlzLmlzVmFsdWUob2JqMikpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgICdfbWFwX3R5cGUnOiB0aGlzLmNvbXBhcmVWYWx1ZXMob2JqMSwgb2JqMiksXG4gICAgICAgICdfbWFwX2RhdGEnOiAob2JqMiA9PT0gdW5kZWZpbmVkKSA/IG9iajEgOiBvYmoyXG4gICAgICB9O1xuICAgIH1cblxuXG4gICAgaWYoXy5pc0FycmF5KG9iajIpKXtcbiAgICAgIHZhciBfYXJyYXkgPSB0cnVlO1xuICAgICAgdmFyIGRpZmYgPSBbXTtcbiAgICB9ZWxzZXtcbiAgICAgIHZhciBkaWZmID0ge307XG4gICAgfVxuXG5cbiAgICBmb3IgKHZhciBrZXkgaW4gb2JqMSkge1xuICAgICAgaWYgKHRoaXMuaXNGdW5jdGlvbihvYmoxW2tleV0pKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuXG4gICAgICB2YXIgdmFsdWUyID0gdW5kZWZpbmVkO1xuICAgICAgaWYgKCd1bmRlZmluZWQnICE9IHR5cGVvZihvYmoyW2tleV0pKSB7XG4gICAgICAgIHZhbHVlMiA9IG9iajJba2V5XTtcbiAgICAgIH1cblxuICAgICAgZGlmZltrZXldID0gdGhpcy5tYXAob2JqMVtrZXldLCB2YWx1ZTIpO1xuICAgIH1cbiAgICBmb3IgKHZhciBrZXkgaW4gb2JqMikge1xuICAgICAgaWYgKHRoaXMuaXNGdW5jdGlvbihvYmoyW2tleV0pIHx8ICgndW5kZWZpbmVkJyAhPSB0eXBlb2YoZGlmZltrZXldKSkpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG5cbiAgICAgIHZhciBfdmFsID0gdGhpcy5tYXAodW5kZWZpbmVkLCBvYmoyW2tleV0pO1xuICAgICAgaWYoX2FycmF5KXtcbiAgICAgICAgZGlmZi5wdXNoKF92YWwpO1xuICAgICAgfWVsc2V7XG4gICAgICAgIGRpZmZba2V5XSA9IF92YWxcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgJ19tYXBfdHlwZSc6ICcnLFxuICAgICAgJ19tYXBfZGF0YSc6IGRpZmZcbiAgICB9O1xuXG4gIH0sXG4gIGNvbXBhcmVWYWx1ZXM6IGZ1bmN0aW9uKHZhbHVlMSwgdmFsdWUyKSB7XG4gICAgaWYgKHZhbHVlMSA9PT0gdmFsdWUyKSB7XG4gICAgICByZXR1cm4gdGhpcy5WQUxVRV9VTkNIQU5HRUQ7XG4gICAgfVxuICAgIGlmICgndW5kZWZpbmVkJyA9PSB0eXBlb2YodmFsdWUxKSkge1xuICAgICAgcmV0dXJuIHRoaXMuVkFMVUVfQ1JFQVRFRDtcbiAgICB9XG4gICAgaWYgKCd1bmRlZmluZWQnID09IHR5cGVvZih2YWx1ZTIpKSB7XG4gICAgICByZXR1cm4gdGhpcy5WQUxVRV9ERUxFVEVEO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLlZBTFVFX1VQREFURUQ7XG4gIH0sXG4gIGlzRnVuY3Rpb246IGZ1bmN0aW9uKG9iaikge1xuICAgIHJldHVybiB7fS50b1N0cmluZy5hcHBseShvYmopID09PSAnW29iamVjdCBGdW5jdGlvbl0nO1xuICB9LFxuICBpc0FycmF5OiBmdW5jdGlvbihvYmopIHtcbiAgICByZXR1cm4ge30udG9TdHJpbmcuYXBwbHkob2JqKSA9PT0gJ1tvYmplY3QgQXJyYXldJztcbiAgfSxcbiAgaXNPYmplY3Q6IGZ1bmN0aW9uKG9iaikge1xuICAgIHJldHVybiB7fS50b1N0cmluZy5hcHBseShvYmopID09PSAnW29iamVjdCBPYmplY3RdJztcbiAgfSxcbiAgaXNWYWx1ZTogZnVuY3Rpb24ob2JqKSB7XG4gICAgcmV0dXJuICF0aGlzLmlzT2JqZWN0KG9iaikgJiYgIXRoaXMuaXNBcnJheShvYmopO1xuICB9XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgZGlmZmVyZW5jZU1hcDogZGVlcERpZmZNYXBwZXIubWFwLmJpbmQoZGVlcERpZmZNYXBwZXIpLFxuICBzeW50YXhIaWdobGlnaHQ6IGZ1bmN0aW9uIChqc29uKSB7XG4gICAgaWYgKHR5cGVvZiBqc29uICE9ICdzdHJpbmcnKSB7XG4gICAgICBqc29uID0gSlNPTi5zdHJpbmdpZnkoanNvbiwgbnVsbCwgMik7XG4gICAgfVxuICAgIGpzb24gPSBqc29uLnJlcGxhY2UoLyYvZywgJyZhbXA7JykucmVwbGFjZSgvPC9nLCAnJmx0OycpLnJlcGxhY2UoLz4vZywgJyZndDsnKTtcblxuICAgIGpzb24gPSBqc29uLnJlcGxhY2UoLyhcIihcXFxcdVthLXpBLVowLTldezR9fFxcXFxbXnVdfFteXFxcXFwiXSkqXCIoXFxzKjopP3xcXGIodHJ1ZXxmYWxzZXxudWxsKVxcYnwtP1xcZCsoPzpcXC5cXGQqKT8oPzpbZUVdWytcXC1dP1xcZCspPykvZywgZnVuY3Rpb24gKG1hdGNoKSB7XG4gICAgICB2YXIgY2xzID0gJ251bWJlcic7XG4gICAgICBpZiAoL15cIi8udGVzdChtYXRjaCkpIHtcbiAgICAgICAgaWYgKC86JC8udGVzdChtYXRjaCkpIHtcbiAgICAgICAgICBjbHMgPSAna2V5JztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjbHMgPSAnc3RyaW5nJztcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmICgvdHJ1ZXxmYWxzZS8udGVzdChtYXRjaCkpIHtcbiAgICAgICAgY2xzID0gJ2Jvb2xlYW4nO1xuICAgICAgfSBlbHNlIGlmICgvbnVsbC8udGVzdChtYXRjaCkpIHtcbiAgICAgICAgY2xzID0gJ251bGwnO1xuICAgICAgfVxuICAgICAgcmV0dXJuICc8c3BhbiBjbGFzcz1cIicgKyBjbHMgKyAnXCI+JyArIG1hdGNoICsgJzwvc3Bhbj4nO1xuICAgIH0pO1xuICAgIHJldHVybiBqc29uID0ganNvbi5yZXBsYWNlKC9bXixcXG5dW15cXG5dKi9nLCBmdW5jdGlvbiAobWF0Y2gpIHtcbiAgICAgIHJldHVybiAnPHNwYW4+JyArIG1hdGNoICsgJzwvc3Bhbj4nO1xuICAgIH0pO1xuICB9LFxuICBkaWZmZXJlbmNlSGlnaGxpZ2h0OiBmdW5jdGlvbiAgKGpzb24sb3V0cHV0KXtcblxuICAgIGlmKG91dHB1dCl7XG4gICAgICBvdXRwdXQuZW1wdHkoKTtcbiAgICB9ZWxzZXtcbiAgICAgIG91dHB1dCA9ICQoXCI8cHJlPlwiKTtcbiAgICB9XG5cblxuICAgIGZ1bmN0aW9uIHByaW50T2JqZWN0KGpzb24sbGV2ZWwsb3V0cHV0LGNvbW1hLG9iamVjdEluZGV4KXtcbiAgICAgIHZhciBfZWwgPSAkKFwiPHA+XCIpO1xuXG4gICAgICBfZWwuYXBwZW5kKCQoXCI8c3Bhbj5cIikuYWRkQ2xhc3MoXCJvYmplY3Qta2V5XCIpLmFwcGVuZChcbiAgICAgICAgJChcIjxzcGFuPlwiKS50ZXh0KG5ldyBBcnJheShsZXZlbCkuam9pbignICcpIClcbiAgICAgICkpO1xuICAgICAgaWYob2JqZWN0SW5kZXgpe1xuICAgICAgICBfZWwuYXBwZW5kKFxuICAgICAgICAgICQoXCI8c3Bhbj5cIikudGV4dCgnXCInKS5hZGRDbGFzcyhcImludmlzaWJsZVwiKSxcbiAgICAgICAgICAkKFwiPHNwYW4+XCIpLmFkZENsYXNzKFwia2V5XCIpLnRleHQob2JqZWN0SW5kZXgpLFxuICAgICAgICAgICQoXCI8c3Bhbj5cIikudGV4dCgnXCInKS5hZGRDbGFzcyhcImludmlzaWJsZVwiKSxcbiAgICAgICAgICAkKFwiPHNwYW4+XCIpLnRleHQoJzogJylcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgaWYoanNvbiAmJiBqc29uLl9tYXBfdHlwZSAhPT0gdW5kZWZpbmVkKXtcbiAgICAgICAgX2VsLmFkZENsYXNzKGpzb24uX21hcF90eXBlKTtcblxuICAgICAgICBpZihfLmlzQXJyYXkoanNvbi5fbWFwX2RhdGEpKXtcbiAgICAgICAgICBfZWwuYXBwZW5kKCQoXCI8c3Bhbj5cIikudGV4dChcIltcIikpO1xuICAgICAgICAgIHZhciBfbGFzdF9rZXkgPSBqc29uLl9tYXBfZGF0YS5sZW5ndGggLSAxO1xuICAgICAgICAgIGZvcih2YXIgaSBpbiBqc29uLl9tYXBfZGF0YSl7XG4gICAgICAgICAgICBwcmludE9iamVjdChqc29uLl9tYXBfZGF0YVtpXSxsZXZlbCArIDEsX2VsLGkgIT0gX2xhc3Rfa2V5KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgX2VsLmFwcGVuZCgkKFwiPHA+XCIpLnRleHQobmV3IEFycmF5KGxldmVsICkuam9pbignICcpICsgXCJdXCIgKyAoY29tbWEgPyBcIixcIiA6IFwiXCIpKSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZihfLmlzT2JqZWN0KGpzb24uX21hcF9kYXRhKSl7XG4gICAgICAgICAgX2VsLmFwcGVuZCgkKFwiPHNwYW4+XCIpLnRleHQoXCJ7XCIpKTtcbiAgICAgICAgICB2YXIgX2xhc3Rfa2V5ID0gT2JqZWN0LmtleXMoanNvbi5fbWFwX2RhdGEpLnBvcCgpO1xuICAgICAgICAgIGZvcih2YXIgaSBpbiBqc29uLl9tYXBfZGF0YSl7XG4gICAgICAgICAgICBwcmludE9iamVjdChqc29uLl9tYXBfZGF0YVtpXSxsZXZlbCArIDEsX2VsLGkgIT0gX2xhc3Rfa2V5LGkpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBfZWwuYXBwZW5kKCQoXCI8cD5cIikudGV4dChuZXcgQXJyYXkobGV2ZWwgKS5qb2luKCcgJykgKyBcIn1cIiArIChjb21tYSA/IFwiLFwiIDogXCJcIikpKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNle1xuXG4gICAgICAgICAgaWYoXy5pc051bGwoanNvbi5fbWFwX2RhdGEpKXtcbiAgICAgICAgICAgIF9lbC5hcHBlbmQoXG4gICAgICAgICAgICAgICQoXCI8c3Bhbj5cIikudGV4dChKU09OLnN0cmluZ2lmeShqc29uLl9tYXBfZGF0YSwgbnVsbCwgMikpXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmKGpzb24uX21hcF9kYXRhLmNvbnN0cnVjdG9yID09PSBTdHJpbmcgKXtcbiAgICAgICAgICAgIF9lbC5hcHBlbmQoXG4gICAgICAgICAgICAgICQoXCI8c3Bhbj5cIikudGV4dCgnXCInKSxcbiAgICAgICAgICAgICAgJChcIjxzcGFuPlwiKS5hZGRDbGFzcygnc3RyaW5nJykudGV4dChqc29uLl9tYXBfZGF0YSksXG4gICAgICAgICAgICAgICQoXCI8c3Bhbj5cIikudGV4dCgnXCInKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSBpZihqc29uLl9tYXBfZGF0YS5jb25zdHJ1Y3RvciA9PT0gTnVtYmVyIHx8IGpzb24uX21hcF9kYXRhLmNvbnN0cnVjdG9yID09PSBCb29sZWFuKXtcbiAgICAgICAgICAgIF9lbC5hcHBlbmQoXG4gICAgICAgICAgICAgICQoXCI8c3Bhbj5cIikuYWRkQ2xhc3MoJ251bWJlcicpLnRleHQoanNvbi5fbWFwX2RhdGEpXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNle1xuICAgICAgICAgICAgX2VsLmFwcGVuZChcbiAgICAgICAgICAgICAgJChcIjxzcGFuPlwiKS50ZXh0KEpTT04uc3RyaW5naWZ5KGpzb24uX21hcF9kYXRhLCBudWxsLCAyKSlcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmKGNvbW1hKXtcbiAgICAgICAgICAgIF9lbC5hcHBlbmQoXG4gICAgICAgICAgICAgICQoXCI8c3Bhbj5cIikudGV4dChcIixcIilcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuXG5cbiAgICAgICAgfVxuICAgICAgfWVsc2V7XG4gICAgICAgIF9lbC5hcHBlbmQoXG4gICAgICAgICAgJChcIjxzcGFuPlwiKS50ZXh0KEpTT04uc3RyaW5naWZ5KGpzb24sIG51bGwsIDIpKVxuICAgICAgICApXG5cbiAgICAgICAgaWYoY29tbWEpe1xuICAgICAgICAgIF9lbC5hcHBlbmQoXG4gICAgICAgICAgICAkKFwiPHNwYW4+XCIpLnRleHQoXCIsXCIpXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICB9XG5cbiAgICAgIG91dHB1dC5hcHBlbmQoX2VsKTtcblxuICAgIH1cbiAgICBwcmludE9iamVjdChqc29uLDEsb3V0cHV0KTtcbiAgICByZXR1cm4gb3V0cHV0O1xuICB9XG59O1xuXG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL3V0aWwvc3ludGF4LmpzIiwiXG5cblxuaWYoIU9iamVjdC52YWx1ZXMpe1xuICBPYmplY3QuZGVmaW5lUHJvcGVydHkoT2JqZWN0LCAndmFsdWVzJywge1xuICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgIGNvbmZpZ3VyYWJsZTogZmFsc2UsXG4gICAgd3JpdGFibGU6IGZhbHNlLFxuICAgIHZhbHVlOiBmdW5jdGlvbihfb2JqZWN0KSB7XG4gICAgICB2YXIgX3ZhbHVlcyA9IFtdO1xuICAgICAgT2JqZWN0LmtleXMoX29iamVjdCkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgIF92YWx1ZXMucHVzaChfb2JqZWN0W2tleV0pO1xuICAgICAgICAvLyB1c2UgdmFsXG4gICAgICB9KTtcbiAgICAgIHJldHVybiBfdmFsdWVzO1xuICAgIH1cbiAgfSk7XG59XG5cblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMse1xuICBlcnJvcnM6IFtdXG59KTtcblxuZmFicmljLnV0aWwub3JkZXIgPSBmdW5jdGlvbihfYXJyYXksY29udGV4dCApe1xuICAoZnVuY3Rpb24gX2NhbGwoKXtcbiAgICBpZighX2FycmF5Lmxlbmd0aClyZXR1cm47XG4gICAgdmFyIGZvbyA9IF9hcnJheS5zaGlmdCgpO1xuICAgIGlmKGZvbyl7XG4gICAgICBpZihmb28ubGVuZ3RoKXtcbiAgICAgICAgZm9vLmNhbGwoY29udGV4dCxfY2FsbCk7XG4gICAgICB9ZWxzZXtcbiAgICAgICAgZm9vLmNhbGwoY29udGV4dCk7XG4gICAgICAgIF9jYWxsKCk7XG4gICAgICB9XG4gICAgfWVsc2V7XG4gICAgICBfY2FsbCgpO1xuICAgIH1cbiAgfSkoKVxufTtcblxuZmFicmljLnV0aWwucHJvbWlzZSA9IHtcbiAgbWFwOiBmdW5jdGlvbiAoZGF0YSwgZm9vKSB7XG5cbiAgICBpZihkYXRhLmNvbnN0cnVjdG9yID09IEFycmF5KXtcbiAgICAgIHJldHVybiBQcm9taXNlLmFsbChkYXRhLm1hcChmb28pKVxuICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzdWx0cywgZXJyb3IpIHtcbiAgICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUocmVzdWx0cyk7XG4gICAgICAgIH0pXG4gICAgfVxuXG4gICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhkYXRhKTtcbiAgICB2YXIgdXJscyA9IE9iamVjdC52YWx1ZXMoZGF0YSk7XG4gICAgcmV0dXJuIFByb21pc2UuYWxsKHVybHMubWFwKGZvbykpXG4gICAgICAudGhlbihmdW5jdGlvbiAocmVzdWx0cywgZXJyb3IpIHtcbiAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgX21hcCA9IHt9O1xuXG4gICAgICAgIGZvcih2YXIgaSA9IDAgOyBpIDwgcmVzdWx0cy5sZW5ndGg7IGkrKyl7XG4gICAgICAgICAgX21hcFtrZXlzW2ldXSA9IHJlc3VsdHNbaV07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShfbWFwKTtcbiAgICAgIH0pXG4gIH0sXG4gIHdyYXA6IGZ1bmN0aW9uIChjb250ZXh0KSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIHdyYXAoZm9vKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgb3B0aW9ucyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywxKTtcbiAgICAgICAgaWYgKCFmb28ubGVuZ3RoKSB7XG4gICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCBmYWlsKSB7XG4gICAgICAgICAgICB2YXIgX3Jlc3VsdCA9IGZvby5jYWxsKGNvbnRleHQpO1xuICAgICAgICAgICAgKF9yZXN1bHQgfHwgX3Jlc3VsdCA9PT0gdW5kZWZpbmVkKSA/IHJlc29sdmUoKSA6IGZhaWwoKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZm9vLmJpbmQoY29udGV4dCkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG59O1xuXG5mYWJyaWMuT2JqZWN0LnByb3RvdHlwZS5zZXQgPSBmdW5jdGlvbihrZXksIHZhbHVlKSB7XG4gIGlmICh0eXBlb2Yga2V5ID09PSAnb2JqZWN0Jykge1xuICAgIHRoaXMuX3NldE9iamVjdChrZXksIHZhbHVlKTtcbiAgfVxuICBlbHNlIHtcbiAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nICYmIGtleSAhPT0gJ2NsaXBUbycpIHtcbiAgICAgIHRoaXMuX3NldChrZXksIHZhbHVlKHRoaXMuZ2V0KGtleSkpKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICB0aGlzLl9zZXQoa2V5LCB2YWx1ZSk7XG4gICAgfVxuICB9XG4gIHJldHVybiB0aGlzO1xufTtcblxuZmFicmljLk9iamVjdC5wcm90b3R5cGUuX3NldE9iamVjdCA9IGZ1bmN0aW9uKG9wdGlvbnMsY2FsbGJhY2spIHtcbiAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhvcHRpb25zKTtcbiAgaWYodGhpcy5vcHRpb25zT3JkZXIpe1xuICAgIHZhciBtaWRkbGVJbmRleCA9IHRoaXMub3B0aW9uc09yZGVyLmluZGV4T2YoXCIqXCIpIHx8IC0xO1xuXG4gICAgdmFyIGkgPSBtaWRkbGVJbmRleCwgcHJvcCAsIGtleUluZGV4O1xuXG4gICAgd2hpbGUoKHByb3AgPSB0aGlzLm9wdGlvbnNPcmRlclstLWldKSl7XG4gICAgICBpZigoa2V5SW5kZXggPSBrZXlzLmluZGV4T2YocHJvcCkpICE9PSAtMSl7XG4gICAgICAgIGtleXMuc3BsaWNlKGtleUluZGV4LCAxKTtcbiAgICAgICAga2V5cy51bnNoaWZ0KHByb3ApO1xuICAgICAgfVxuICAgIH1cbiAgICBpID0gbWlkZGxlSW5kZXg7XG4gICAgd2hpbGUocHJvcCA9IHRoaXMub3B0aW9uc09yZGVyWysraV0pe1xuICAgICAgaWYoKGtleUluZGV4ID0ga2V5cy5pbmRleE9mKHByb3ApKSAhPT0gLTEpe1xuICAgICAgICBrZXlzLnNwbGljZShrZXlJbmRleCwgMSk7XG4gICAgICAgIGtleXMucHVzaChwcm9wKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgfVxuICBmb3IgKHZhciBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIgcHJvcCA9IGtleXNbaV07XG4gICAgaWYodHlwZW9mIG9wdGlvbnNbcHJvcF0gPT0gXCJmdW5jdGlvblwiKXtcbiAgICAgIGtleXMuc3BsaWNlKGksIDEpO1xuICAgICAga2V5cy51bnNoaWZ0KHByb3ApO1xuICAgIH1cbiAgfVxuICB2YXIgcXVldWU7XG4gIGZvciAodmFyIGkgaW4ga2V5cykge1xuICAgIHZhciBfa2V5ID0ga2V5c1tpXTtcbiAgICBpZihvcHRpb25zW19rZXldID09PSB1bmRlZmluZWQgKWNvbnRpbnVlO1xuICAgIHZhciBfZm9vTmFtZSA9IFwic2V0XCIgKyBmYWJyaWMudXRpbC5zdHJpbmcuY2FwaXRhbGl6ZShfa2V5LCB0cnVlKTtcbiAgICBpZih0aGlzW19mb29OYW1lXSAmJiB0aGlzW19mb29OYW1lXS5uYW1lICYmIHRoaXNbX2Zvb05hbWVdLm5hbWUgIT0gXCJhbm9ueW1vdXNcIil7XG4gICAgICBpZih0aGlzW19mb29OYW1lXS5sZW5ndGggPT0gMil7XG4gICAgICAgIGlmKCFxdWV1ZSl7XG4gICAgICAgICAgcXVldWUgPSBmYWJyaWMudXRpbC5xdWV1ZUxvYWQoMixjYWxsYmFjayk7XG4gICAgICAgIH1lbHNle1xuICAgICAgICAgIHF1ZXVlLnRvdGFsICsrO1xuICAgICAgICB9XG4gICAgICAgIHRoaXNbX2Zvb05hbWVdKG9wdGlvbnNbX2tleV0sZnVuY3Rpb24oX2tleSl7XG4gICAgICAgICAgcXVldWUoKTtcbiAgICAgICAgfS5iaW5kKHRoaXMsX2tleSkpO1xuICAgICAgfWVsc2V7XG4gICAgICAgIHRoaXNbX2Zvb05hbWVdKG9wdGlvbnNbX2tleV0pXG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX19zZXQoX2tleSwgb3B0aW9uc1tfa2V5XSk7XG4gICAgfVxuICB9XG4gIGlmKHF1ZXVlKXtcbiAgICBxdWV1ZSgpXG4gIH1lbHNlIGlmKGNhbGxiYWNrICl7XG4gICAgY2FsbGJhY2soKTtcbiAgfVxufTtcblxudmFyIF9nZXRfcG9pbnRlcl9vdmVyd3JpdHRlbiA9IGZhYnJpYy5DYW52YXMucHJvdG90eXBlLmdldFBvaW50ZXI7XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLlN0YXRpY0NhbnZhcy5wcm90b3R5cGUsIHtcbiAgb3B0aW9uc09yZGVyOiBbXSxcbiAgX19zZXQgOiBmYWJyaWMuT2JqZWN0LnByb3RvdHlwZS5fc2V0LFxuICBfc2V0T2JqZWN0OiBmYWJyaWMuT2JqZWN0LnByb3RvdHlwZS5fc2V0T2JqZWN0LFxuICBnZXQ6IGZhYnJpYy5PYmplY3QucHJvdG90eXBlLmdldCxcbiAgc2V0OiBmYWJyaWMuT2JqZWN0LnByb3RvdHlwZS5zZXRcbn0pO1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5DYW52YXMucHJvdG90eXBlLCB7XG4vLyAgb3B0aW9uc09yZGVyOiBbXCIqXCJdLFxuICBvcmlnaW5hbFN0YXRlOiB7fSxcbiAgc3RhdGVQcm9wZXJ0aWVzOiBbXSxcbiAgZWRpdGluZ09iamVjdDogbnVsbCxcblxuICBnZXRNb2RpZmllZFN0YXRlczogZnVuY3Rpb24gKHRhcmdldCkge1xuICAgIHZhciBzdGF0ZXMgPSB7XG4gICAgICBvcmlnaW5hbDoge30sXG4gICAgICBtb2RpZmllZDoge31cbiAgICB9O1xuICAgIGZvciAodmFyIHByb3AgaW4gdGFyZ2V0Lm9yaWdpbmFsU3RhdGUpIHtcbiAgICAgIGlmICh0YXJnZXQub3JpZ2luYWxTdGF0ZVtwcm9wXSAhPT0gdGFyZ2V0W3Byb3BdKSB7XG4gICAgICAgIGlmKHRhcmdldC5vcmlnaW5hbFN0YXRlW3Byb3BdIGluc3RhbmNlb2YgT2JqZWN0KXtcbiAgICAgICAgICBpZihKU09OLnN0cmluZ2lmeSh0YXJnZXQub3JpZ2luYWxTdGF0ZVtwcm9wXSkgPT0gSlNPTi5zdHJpbmdpZnkodGFyZ2V0W3Byb3BdKSl7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgc3RhdGVzLm9yaWdpbmFsW3Byb3BdID0gdGFyZ2V0Lm9yaWdpbmFsU3RhdGVbcHJvcF07XG4gICAgICAgIHN0YXRlcy5tb2RpZmllZFtwcm9wXSA9IHRhcmdldFtwcm9wXTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHN0YXRlcztcbiAgfSxcbiAgX2ZpbmFsaXplQ3VycmVudFRyYW5zZm9ybTogZnVuY3Rpb24gKCkge1xuXG4gICAgdmFyIHRyYW5zZm9ybSA9IHRoaXMuX2N1cnJlbnRUcmFuc2Zvcm0sXG4gICAgICB0YXJnZXQgPSB0cmFuc2Zvcm0udGFyZ2V0O1xuXG4gICAgaWYgKHRhcmdldC5fc2NhbGluZykge1xuICAgICAgdGFyZ2V0Ll9zY2FsaW5nID0gZmFsc2U7XG4gICAgfVxuXG4gICAgdGFyZ2V0LnNldENvb3JkcygpO1xuXG4gICAgdGhpcy5fcmVzdG9yZU9yaWdpblhZKHRhcmdldCk7XG4gICAgLy8gb25seSBmaXJlIDptb2RpZmllZCBldmVudCBpZiB0YXJnZXQgY29vcmRpbmF0ZXMgd2VyZSBjaGFuZ2VkIGR1cmluZyBtb3VzZWRvd24tbW91c2V1cFxuICAgIHRoaXMuZmlyZU1vZGlmaWVkSWZDaGFuZ2VkKHRhcmdldCk7XG4gIH0sXG4gIGZpcmVNb2RpZmllZElmQ2hhbmdlZDogZnVuY3Rpb24gKHRhcmdldCkge1xuICAgIGlmICh0aGlzLnN0YXRlZnVsKSB7XG4gICAgICB2YXIgX3N0YXRlcyA9IHRhcmdldC5oYXNTdGF0ZUNoYW5nZWQoKTtcbiAgICAgIGlmKF9zdGF0ZXMpe1xuICAgICAgICB0aGlzLmZpcmUoJ29iamVjdDptb2RpZmllZCcsIHt0YXJnZXQ6IHRhcmdldCAsIHN0YXRlczogX3N0YXRlc30pO1xuICAgICAgICB0YXJnZXQuZmlyZSgnbW9kaWZpZWQnLHtzdGF0ZXM6IF9zdGF0ZXN9KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn0pO1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5PYmplY3QucHJvdG90eXBlLCB7XG4gIG9wdGlvbnNPcmRlcjogW10sXG4gIHNldEFuZ2xlOiBmdW5jdGlvbihhbmdsZSkge1xuICAgIHRoaXMuYW5nbGUgPSBhbmdsZTtcbiAgfSxcblxuICBzZXRTaGFkb3c6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICByZXR1cm4gdGhpcy5zaGFkb3cgPSBvcHRpb25zID8gbmV3IGZhYnJpYy5TaGFkb3cob3B0aW9ucykgOiBudWxsO1xuICB9LFxuICBfX3NldCA6IGZhYnJpYy5PYmplY3QucHJvdG90eXBlLl9zZXQsXG5cbiAgX3NldDogZnVuY3Rpb24gKGtleSwgdmFsdWUgLGNhbGxiYWNrKSB7XG4gICAgdmFyIF9mb29OYW1lID0gXCJzZXRcIiArIGZhYnJpYy51dGlsLnN0cmluZy5jYXBpdGFsaXplKGtleSwgdHJ1ZSk7XG4gICAgaWYodGhpc1tfZm9vTmFtZV0gICYmIHRoaXNbX2Zvb05hbWVdLm5hbWUgJiYgdGhpc1tfZm9vTmFtZV0ubmFtZSAhPSBcImFub255bW91c1wiKXtcbiAgICAgIC8vIGlmICh0aGlzLnNwZWNpYWxQcm9wZXJ0aWVzLmluZGV4T2Yoa2V5KSAhPT0gLTEpIHtcbiAgICAgIC8vIGlmKHRoaXNbX2Zvb05hbWVdKXtcbiAgICAgIHRoaXNbX2Zvb05hbWVdKHZhbHVlLGNhbGxiYWNrKTtcbiAgICB9ZWxzZXtcbiAgICAgIHRoaXMuX19zZXQoa2V5LCB2YWx1ZSk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9LFxuICBkaXNhYmxlOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5zZXQoe1xuICAgICAgc2VsZWN0YWJsZTogZmFsc2UsXG4gICAgICBldmVudGVkOiBmYWxzZSxcbiAgICAgIGhhc0NvbnRyb2xzOiBmYWxzZSxcbiAgICAgIGxvY2tNb3ZlbWVudFg6IHRydWUsXG4gICAgICBsb2NrTW92ZW1lbnRZOiB0cnVlXG4gICAgfSk7XG4gIH0sXG4gIHN0b3JlZDogdHJ1ZSxcbiAgLyoqXG4gICAqIFNhdmVzIHN0YXRlIG9mIGFuIG9iamVjdFxuICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdIE9iamVjdCB3aXRoIGFkZGl0aW9uYWwgYHN0YXRlUHJvcGVydGllc2AgYXJyYXkgdG8gaW5jbHVkZSB3aGVuIHNhdmluZyBzdGF0ZVxuICAgKiBAcmV0dXJuIHtmYWJyaWMuT2JqZWN0fSB0aGlzQXJnXG4gICAqL1xuICBzYXZlU3RhdGU6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAvL1N0YXRlOiBmdW5jdGlvbihvcHRpb25zKSB7XG5cbiAgICB0aGlzLm9yaWdpbmFsU3RhdGUgPSB0aGlzLnRvT2JqZWN0KCk7XG4gICAgLypcbiAgICAvLyB0aGlzLnN0YXRlUHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKHByb3ApIHtcbiAgICAvLyAgIHZhciBfdmFsID0gdGhpcy5nZXQocHJvcCk7XG4gICAgLy8gICBpZihfdmFsIGluc3RhbmNlb2YgT2JqZWN0KXtcbiAgICAvLyAgICAgdGhpcy5vcmlnaW5hbFN0YXRlW3Byb3BdID0gZmFicmljLnV0aWwub2JqZWN0LmNsb25lRGVlcChfdmFsKTtcbiAgICAvLyAgIH1lbHNle1xuICAgIC8vICAgICB0aGlzLm9yaWdpbmFsU3RhdGVbcHJvcF0gPSBfdmFsO1xuICAgIC8vICAgfVxuICAgIC8vIH0sIHRoaXMpO1xuXG4gICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5zdGF0ZVByb3BlcnRpZXMpIHtcbiAgICAgIG9wdGlvbnMuc3RhdGVQcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24ocHJvcCkge1xuICAgICAgICB0aGlzLm9yaWdpbmFsU3RhdGVbcHJvcF0gPSB0aGlzLmdldChwcm9wKTtcbiAgICAgIH0sIHRoaXMpO1xuICAgIH0qL1xuICAgIHJldHVybiB0aGlzO1xuICB9LFxuICBoYXNTdGF0ZUNoYW5nZWQ6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBtb2RpZmllZCA9IDA7XG4gICAgdmFyIHN0YXRlcyA9IHtcbiAgICAgIG9yaWdpbmFsOiB7fSxcbiAgICAgIG1vZGlmaWVkOiB7fVxuICAgIH07XG5cbiAgICB2YXIgc3RhdGUgPSB0aGlzLnRvT2JqZWN0KCk7XG5cbiAgICBmb3IgKHZhciBwcm9wIGluIHRoaXMub3JpZ2luYWxTdGF0ZSkge1xuICAgICAgaWYgKHRoaXMub3JpZ2luYWxTdGF0ZVtwcm9wXSAhPT0gc3RhdGVbcHJvcF0pIHtcbiAgICAgICAgaWYodGhpcy5vcmlnaW5hbFN0YXRlW3Byb3BdIGluc3RhbmNlb2YgT2JqZWN0KXtcbiAgICAgICAgICBpZihKU09OLnN0cmluZ2lmeSh0aGlzLm9yaWdpbmFsU3RhdGVbcHJvcF0pID09IEpTT04uc3RyaW5naWZ5KHN0YXRlW3Byb3BdKSl7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgc3RhdGVzLm9yaWdpbmFsW3Byb3BdID0gdGhpcy5vcmlnaW5hbFN0YXRlW3Byb3BdO1xuICAgICAgICBzdGF0ZXMubW9kaWZpZWRbcHJvcF0gPSBzdGF0ZVtwcm9wXTtcbiAgICAgICAgbW9kaWZpZWQrKztcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG1vZGlmaWVkICYmIHN0YXRlcztcbiAgfVxufSk7XG5cbmZhYnJpYy51dGlsLmdldFByb3BvcnRpb25zID0gZnVuY3Rpb24gKHBob3RvLCBjb250YWluZXIsIG1vZGUpIHtcbiAgbW9kZSA9IG1vZGUgfHwgJ2ZpdCc7XG4gIHZhciBfdyA9IHBob3RvLm5hdHVyYWxXaWR0aCB8fCBwaG90by53aWR0aDtcbiAgdmFyIF9oID0gcGhvdG8ubmF0dXJhbEhlaWdodCB8fCBwaG90by5oZWlnaHQ7XG4gIGlmICghY29udGFpbmVyLmhlaWdodCAmJiAhY29udGFpbmVyLndpZHRoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHNjYWxlOiAxLFxuICAgICAgd2lkdGg6IF93LFxuICAgICAgaGVpZ2h0OiBfaFxuICAgIH07XG4gIH1cbiAgaWYgKCFwaG90by5oZWlnaHQgJiYgIXBob3RvLndpZHRoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHNjYWxlOiAwLjAwMSxcbiAgICAgIHdpZHRoOiBjb250YWluZXIud2lkdGgsXG4gICAgICBoZWlnaHQ6IGNvbnRhaW5lci5oZWlnaHRcbiAgICB9O1xuICB9XG5cbiAgLy8gdmFyIF9hc3AgPSBfdyAvIF9oLCBfY19hc3AgPSBjb250YWluZXIud2lkdGggLyBjb250YWluZXIuaGVpZ2h0O1xuXG4gIC8vIGlmIChfYXNwID4gX2NfYXNwKSB7XG4gIC8vICAgX2ggPSBjb250YWluZXIuaGVpZ2h0O1xuICAvLyAgIF93ID0gX2ggKiBfYXNwO1xuICAvL1xuICAvLyB9IGVsc2Uge1xuICAvLyAgIF93ID0gY29udGFpbmVyLndpZHRoO1xuICAvLyAgIF9oID0gX3cgLyBfYXNwO1xuICAvLyB9XG4gIC8vIHZhciBzY2FsZVggPSBjb250YWluZXIud2lkdGggLyBfdztcbiAgLy8gdmFyIHNjYWxlWSA9IGNvbnRhaW5lci5oZWlnaHQgLyBfaDtcbiAgdmFyIHNjYWxlWCA9IGNvbnRhaW5lci53aWR0aCAmJiBjb250YWluZXIud2lkdGggLyBfdyB8fCA5OTk7XG4gIHZhciBzY2FsZVkgPSBjb250YWluZXIuaGVpZ2h0ICYmIGNvbnRhaW5lci5oZWlnaHQgLyBfaCB8fCA5OTk7XG5cbiAgdmFyIHNjYWxlO1xuICBpZiAobW9kZSA9PT0gJ2NvdmVyJykge1xuICAgIHNjYWxlID0gTWF0aC5tYXgoc2NhbGVYLCBzY2FsZVkpO1xuICB9XG4gIGlmIChtb2RlID09PSAnZml0Jykge1xuICAgIHNjYWxlID0gTWF0aC5taW4oc2NhbGVYLCBzY2FsZVkpO1xuICB9XG4gIGlmIChtb2RlID09PSAnY2VudGVyJykge1xuICAgIHNjYWxlID0gMTtcbiAgfVxuICByZXR1cm4ge1xuICAgIHNjYWxlOiBzY2FsZSxcbiAgICB3aWR0aDogTWF0aC5mbG9vcihfdyAqIHNjYWxlKSxcbiAgICBoZWlnaHQ6IE1hdGguZmxvb3IoX2ggKiBzY2FsZSlcbiAgfTtcbn07XG5cbmZhYnJpYy51dGlsLlV0ZjhBcnJheVRvU3RyID0gZnVuY3Rpb24oYXJyYXkpIHtcbiAgdmFyIG91dCwgaSwgbGVuLCBjO1xuICB2YXIgY2hhcjIsIGNoYXIzO1xuXG4gIG91dCA9IFwiXCI7XG4gIGxlbiA9IGFycmF5Lmxlbmd0aDtcbiAgaSA9IDA7XG4gIHdoaWxlKGkgPCBsZW4pIHtcbiAgICBjID0gYXJyYXlbaSsrXTtcbiAgICBzd2l0Y2goYyA+PiA0KVxuICAgIHtcbiAgICAgIGNhc2UgMDogY2FzZSAxOiBjYXNlIDI6IGNhc2UgMzogY2FzZSA0OiBjYXNlIDU6IGNhc2UgNjogY2FzZSA3OlxuICAgICAgLy8gMHh4eHh4eHhcbiAgICAgIG91dCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGMpO1xuICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDEyOiBjYXNlIDEzOlxuICAgICAgLy8gMTEweCB4eHh4ICAgMTB4eCB4eHh4XG4gICAgICBjaGFyMiA9IGFycmF5W2krK107XG4gICAgICBvdXQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoKGMgJiAweDFGKSA8PCA2KSB8IChjaGFyMiAmIDB4M0YpKTtcbiAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAxNDpcbiAgICAgICAgLy8gMTExMCB4eHh4ICAxMHh4IHh4eHggIDEweHggeHh4eFxuICAgICAgICBjaGFyMiA9IGFycmF5W2krK107XG4gICAgICAgIGNoYXIzID0gYXJyYXlbaSsrXTtcbiAgICAgICAgb3V0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoKChjICYgMHgwRikgPDwgMTIpIHxcbiAgICAgICAgICAoKGNoYXIyICYgMHgzRikgPDwgNikgfFxuICAgICAgICAgICgoY2hhcjMgJiAweDNGKSA8PCAwKSk7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBvdXQ7XG59O1xuXG5mYWJyaWMudXRpbC5faWRDb3VudGVyID0gMTtcblxuZmFicmljLnV0aWwuY3JlYXRlT2JqZWN0ID0gZnVuY3Rpb24gKHR5cGUsIG9wdGlvbnMsIGNhbGxiYWNrKSB7XG4gIGlmKHR5cGVvZiB0eXBlICE9PSBcInN0cmluZ1wiKXtcbiAgICBjYWxsYmFjayA9IG9wdGlvbnM7XG4gICAgb3B0aW9ucyA9IHR5cGU7XG4gICAgdHlwZSA9IG51bGw7XG4gIH1lbHNle1xuICAgIG9wdGlvbnMudHlwZSA9IHR5cGU7XG4gIH1cbiAgdmFyIGFwcCA9IG9wdGlvbnMuYXBwbGljYXRpb247XG4gIGFwcCAmJiBhcHAuZmlyZShcImVudGl0eTpsb2FkXCIse29wdGlvbnM6IG9wdGlvbnN9KTtcblxuICB2YXIgX2tsYXNzTmFtZSA9IGZhYnJpYy51dGlsLnN0cmluZy5jYW1lbGl6ZShmYWJyaWMudXRpbC5zdHJpbmcuY2FwaXRhbGl6ZSh0eXBlIHx8IG9wdGlvbnMudHlwZSB8fCBhcHAucHJvdG90eXBlcy5PYmplY3QudHlwZSx0cnVlKSk7XG4gIHZhciBfa2xhc3MgPSBmYWJyaWNbX2tsYXNzTmFtZV07XG5cblxuICBpZighX2tsYXNzKXtcbiAgICBjb25zb2xlLmVycm9yKF9rbGFzc05hbWUgKyBcIiBpcyB1bmRlZmluZWRcIik7XG5cbiAgICB2YXIgX3RleHQgPSBvcHRpb25zLnRleHQgJiYgb3B0aW9ucy50ZXh0LmNvbnN0cnVjdG9yID09IFN0cmluZyA/IG9wdGlvbnMudGV4dCA6IF9rbGFzc05hbWU7XG4gICAgZGVsZXRlIG9wdGlvbnMudGV4dDtcbiAgICByZXR1cm4gY2FsbGJhY2sobmV3IGZhYnJpYy5UZXh0KF90ZXh0LG9wdGlvbnMpKVxuICB9XG5cbiAgdmFyIGVsID0gX2tsYXNzLmZyb21PYmplY3Qob3B0aW9ucywgZnVuY3Rpb24gKGVsKSB7XG4gICAgY2FsbGJhY2sgJiYgY2FsbGJhY2soZWwpO1xuICAgIGNhbGxiYWNrID0gbnVsbDtcbiAgfSk7XG4gIGlmIChlbCkge1xuICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKGVsKTtcbiAgICBjYWxsYmFjayA9IG51bGw7XG4gIH1cbiAgcmV0dXJuIGVsO1xufTtcblxuZmFicmljLnV0aWwuZGF0YVVSSXRvQmxvYiA9IGZ1bmN0aW9uIChkYXRhVVJJLCBkYXRhVFlQRSkge1xuICB2YXIgYmluYXJ5ID0gYXRvYihkYXRhVVJJLnNwbGl0KCcsJylbMV0pLCBhcnJheSA9IFtdO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IGJpbmFyeS5sZW5ndGg7IGkrKykge1xuICAgIGFycmF5LnB1c2goYmluYXJ5LmNoYXJDb2RlQXQoaSkpO1xuICB9XG4gIHJldHVybiBuZXcgQmxvYihbbmV3IFVpbnQ4QXJyYXkoYXJyYXkpXSwge3R5cGU6IGRhdGFUWVBFfSk7XG59O1xuXG5mYWJyaWMudXRpbC5ibG9iVG9EYXRhVVJMID0gZnVuY3Rpb24gKGJsb2IsIGNhbGxiYWNrKSB7XG4gIHZhciBhID0gbmV3IEZpbGVSZWFkZXIoKTtcbiAgYS5vbmxvYWQgPSBmdW5jdGlvbiAoZSkge1xuICAgIGNhbGxiYWNrKGUudGFyZ2V0LnJlc3VsdCk7XG4gIH07XG4gIGEucmVhZEFzRGF0YVVSTChibG9iKTtcbn07XG5cbmZhYnJpYy51dGlsLmNyZWF0ZUNhbnZhc0VsZW1lbnRXaXRoU2l6ZSA9IGZ1bmN0aW9uIChzaXplKSB7XG4gIHZhciBjYW52YXMgPSBmYWJyaWMudXRpbC5jcmVhdGVDYW52YXNFbGVtZW50KCk7XG4gIGNhbnZhcy53aWR0aCA9IHNpemUud2lkdGg7XG4gIGNhbnZhcy5oZWlnaHQgPSBzaXplLmhlaWdodDtcbiAgcmV0dXJuIGNhbnZhcztcbn07XG5cbmZhYnJpYy51dGlsLnN0cmluZy50b0Rhc2hlZCA9IGZ1bmN0aW9uIChzdHIpIHtcbiAgcmV0dXJuIHN0ci5yZXBsYWNlKC8oW2Etel0pKFtBLVpdKS9nLCAnJDEtJDInKS50b0xvd2VyQ2FzZSgpO1xufTtcblxuZmFicmljLnV0aWwuc3RyaW5nLnVuY2FwaXRhbGl6ZSA9IGZ1bmN0aW9uKHN0cmluZyl7XG4gIHJldHVybiBzdHJpbmcuY2hhckF0KDApLnRvTG93ZXJDYXNlKCkgK1xuICAgIChzdHJpbmcuc2xpY2UoMSkpO1xufTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvY29yZS9iYXNlLmpzIiwiJ3VzZSBzdHJpY3QnO1xuXG5cbi8qKlxuICogQHByaXZhdGVcbiAqIEBwYXJhbSB7U3RyaW5nfSBldmVudE5hbWVcbiAqIEBwYXJhbSB7RnVuY3Rpb259IGhhbmRsZXJcbiAqL1xuZnVuY3Rpb24gX3JlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBoYW5kbGVyKSB7XG4gIGlmICghdGhpcy5fX2V2ZW50TGlzdGVuZXJzW2V2ZW50TmFtZV0pIHtcbiAgICByZXR1cm47XG4gIH1cbiAgdmFyIGV2ZW50TGlzdGVuZXIgPSB0aGlzLl9fZXZlbnRMaXN0ZW5lcnNbZXZlbnROYW1lXTtcbiAgaWYgKGhhbmRsZXIpIHtcbiAgICBldmVudExpc3RlbmVyLnNwbGljZShldmVudExpc3RlbmVyLmluZGV4T2YoaGFuZGxlciksIDEpXG4gIH1cbiAgZWxzZSB7XG4gICAgZXZlbnRMaXN0ZW5lci5sZW5ndGggPSAwO1xuICB9XG59XG5cbmZhYnJpYy5DYW52YXMucHJvdG90eXBlLnN0b3BPYnNlcnZpbmcgPSBmYWJyaWMuT2JqZWN0LnByb3RvdHlwZS5zdG9wT2JzZXJ2aW5nID0gZnVuY3Rpb24gc3RvcE9ic2VydmluZyhldmVudE5hbWUsIGhhbmRsZXIpIHtcbiAgaWYgKCF0aGlzLl9fZXZlbnRMaXN0ZW5lcnMpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyByZW1vdmUgYWxsIGtleS92YWx1ZSBwYWlycyAoZXZlbnQgbmFtZSAtPiBldmVudCBoYW5kbGVyKVxuICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMCkge1xuICAgIGZvciAoZXZlbnROYW1lIGluIHRoaXMuX19ldmVudExpc3RlbmVycykge1xuICAgICAgX3JlbW92ZUV2ZW50TGlzdGVuZXIuY2FsbCh0aGlzLCBldmVudE5hbWUpO1xuICAgIH1cbiAgfVxuICAvLyBvbmUgb2JqZWN0IHdpdGgga2V5L3ZhbHVlIHBhaXJzIHdhcyBwYXNzZWRcbiAgZWxzZSBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMSAmJiB0eXBlb2YgYXJndW1lbnRzWzBdID09PSAnb2JqZWN0Jykge1xuICAgIGZvciAodmFyIHByb3AgaW4gZXZlbnROYW1lKSB7XG4gICAgICBfcmVtb3ZlRXZlbnRMaXN0ZW5lci5jYWxsKHRoaXMsIHByb3AsIGV2ZW50TmFtZVtwcm9wXSk7XG4gICAgfVxuICB9XG4gIGVsc2Uge1xuICAgIF9yZW1vdmVFdmVudExpc3RlbmVyLmNhbGwodGhpcywgZXZlbnROYW1lLCBoYW5kbGVyKTtcbiAgfVxuICByZXR1cm4gdGhpcztcbn1cblxuXG5mYWJyaWMuT2JzZXJ2YWJsZS5vbiA9IGZhYnJpYy5DYW52YXMucHJvdG90eXBlLm9uID0gZmFicmljLk9iamVjdC5wcm90b3R5cGUub24gPSBmdW5jdGlvbiAoZXZlbnROYW1lLCBoYW5kbGVyLHByaW9yaXR5KSB7XG4gIGlmIChldmVudE5hbWUuY29uc3RydWN0b3IgPT0gT2JqZWN0KSB7XG4gICAgZm9yICh2YXIgaSBpbiBldmVudE5hbWUpIHtcbiAgICAgIHRoaXMub24oaSwgZXZlbnROYW1lW2ldLHByaW9yaXR5KVxuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuICB2YXIgZXZlbnRzID0gZXZlbnROYW1lLnNwbGl0KFwiIFwiKTtcbiAgZm9yICh2YXIgaSBpbiBldmVudHMpIHtcbiAgICBldmVudE5hbWUgPSBldmVudHNbaV07XG4gICAgdGhpcy5vYnNlcnZlKGV2ZW50TmFtZSwgaGFuZGxlcik7XG4gICAgaWYocHJpb3JpdHkpe1xuICAgICAgdGhpcy5fX2V2ZW50TGlzdGVuZXJzW2V2ZW50TmFtZV0udW5zaGlmdCh0aGlzLl9fZXZlbnRMaXN0ZW5lcnNbZXZlbnROYW1lXS5wb3AoKSk7XG4gICAgfVxuICB9XG4gIHJldHVybiB0aGlzO1xufTtcbmZhYnJpYy5DYW52YXMucHJvdG90eXBlLm9mZiA9IGZhYnJpYy5PYmplY3QucHJvdG90eXBlLm9mZiA9IGZ1bmN0aW9uIChldmVudE5hbWUsIGhhbmRsZXIpIHtcbiAgdmFyIGV2ZW50cyA9IGV2ZW50TmFtZS5zcGxpdChcIiBcIik7XG4gIGZvciAodmFyIGkgaW4gZXZlbnRzKSB7XG4gICAgdGhpcy5zdG9wT2JzZXJ2aW5nKGV2ZW50c1tpXSwgaGFuZGxlcilcbiAgfVxuICByZXR1cm4gdGhpcztcbn07XG5cblxuZmFicmljLkNhbnZhcy5wcm90b3R5cGUuZmlyZSA9IGZhYnJpYy5PYmplY3QucHJvdG90eXBlLmZpcmUgPSBmdW5jdGlvbiBmaXJlKGV2ZW50TmFtZSwgb3B0aW9ucykge1xuICBpZiAoIXRoaXMuX19ldmVudExpc3RlbmVycykge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBsaXN0ZW5lcnNGb3JFdmVudCA9IHRoaXMuX19ldmVudExpc3RlbmVyc1tldmVudE5hbWVdO1xuICBpZiAobGlzdGVuZXJzRm9yRXZlbnQpIHtcbiAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gbGlzdGVuZXJzRm9yRXZlbnQubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgIGxpc3RlbmVyc0ZvckV2ZW50W2ldLmNhbGwodGhpcywgb3B0aW9ucyB8fCB7fSk7XG4gICAgfVxuICB9XG5cbiAgdmFyIGxpc3RlbmVyc0ZvckV2ZW50QWxsID0gdGhpcy5fX2V2ZW50TGlzdGVuZXJzWycqJ107XG4gIGlmIChsaXN0ZW5lcnNGb3JFdmVudEFsbCkge1xuICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICAgIG9wdGlvbnMuZXZlbnROYW1lID0gZXZlbnROYW1lO1xuICAgIG9wdGlvbnMubGlzdGVuZXJzID0gbGlzdGVuZXJzRm9yRXZlbnQ7XG4gICAgZm9yIChpID0gMCwgbGVuID0gbGlzdGVuZXJzRm9yRXZlbnRBbGwubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgIGxpc3RlbmVyc0ZvckV2ZW50QWxsW2ldLmNhbGwodGhpcywgb3B0aW9ucyk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHRoaXM7XG59O1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9jb3JlL29ic2VydmUuanMiLCIndXNlIHN0cmljdCc7XG5cbi8qKlxuICogIyBBcHBsaWNhdGlvblxuICpcbiAqIGZhcmJpYy5hcHAgZnVuY3Rpb24gaXMgdGhlIGVudHJ5IHBvaW50IG9mIEZhYnJpY0pTIGFwcGxpY2F0aW9uLlxuICogQXBwbGljYXRpb24gY291bGQgYmUgaW5pdGlhbGlzZWQgd2l0aCBjb25maWd1cmF0aW9uIG9iamVjdC4gRGlmZmVyZW50IGV4dGVuc2lvbnMgYWxsb3dzIHRvIGluaXRpYWxpemUgc3BlY2lhbCBhcHBsaWNhdGlvbiBhdHRyaWJ1dGVzIHN1Y2ggYXMgKm9iamVjdCBwcm90b3R5cGVzKiwgKnJlc2l6YWJsZSBjYW52YXMqLCAqYXZhaWxhYmxlIGZvbnRzKiwgZXRjLlxuICpcbiAqICMjIyBvcHRpb246IHV0aWxcbiAqIG1lZGlhUm9vdCAtIHJvb3QgZGlyZWN0b3J5IGZvciBhbGwgbWVkaWEgZmlsZXMgaW4gZmFicmljIGFwcGxpY2F0aW9uXG4gKlxuICogIyMjIG9wdGlvbjogcmVzaXphYmxlXG4gKiBtYWtlcyBjYW52YXMgcmVzcG9uc2libGUuIENhbnZhcyB3aWxsIGJlIHNjYWxlZCB0byAxMDAlIG9mIGl0cyBjb250YWluZXIgc2l6ZVxuICpcbiAqICMjIyBvcHRpb246IG9uUmVzaXplXG4gKiBmdW5jdGlvbiB3aGljaCBvdmVycmlkZSBkZWFmdWx0IGNhbnZhcyByZXNpemUgYmVoYXZpb3IuXG4gKlxuICogIyMjIG9wdGlvbjogY2FsbGJhY2tcbiAqIGZ1bmN0aW9uIGNhbGxzIGFmdGVyIGNhbnZhcyBpbml0aWFsaXplZFxuICpcbiAqICMjIyBvcHRpb246IGluaXRpYWxpemVcbiAqIGZ1bmN0aW9uIGNhbGxzIGJlZm9yZSBjYW52YXMgaW5pdGlhbGl6ZVxuICpcbiAqIEBleGFtcGxlXG4gKlxuICogbmV3IGZhYnJpYy5BcHBsaWNhdGlvbih7XG4gKiAgICAgIHJlc2l6YWJsZTogdHJ1ZSxcbiAqICAgICAgb25SZXNpemU6IGZ1bmN0aW9uKCl7fSxcbiAqICAgICAgdXRpbDoge1xuICogICAgICAgIG1lZGlhUm9vdDogJy4uLy4uL21lZGlhLydcbiAqICAgICAgfSxcbiAqICAgICAgY2FudmFzQ29udGFpbmVyOiBcImZpZXJhLWNhbnZhc1wiLFxuICogICAgICBwcm90b3R5cGVzOiB7fSxcbiAqICAgICAgb2JqZWN0czoge30sXG4gKiAgICAgIGV2ZW50TGlzdGVuZXJzOiB7fSxcbiAqICAgICAgY2FsbGJhY2s6IGZ1bmN0aW9uKCl7fSxcbiAqICAgICAgaW5pdGlhbGl6ZTogIGZ1bmN0aW9uKCl7fVxuICogICAgICBjdXN0b21QdWJsaWNBcHBsaWNhdGlvbkZ1bmN0aW9uOiBmdW5jdGlvbigpe30sXG4gKiAgICAgIGN1c3RvbVB1YmxpY0FwcGxpY2F0aW9uQXR0cmlidXRlOiB2YWx1ZVxuICogIH0pXG4gKlxuICovXG5cbmZhYnJpYy5BcHBsaWNhdGlvbiA9IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgdGhpcy5pbml0KG9wdGlvbnMpO1xufTtcblxuZmFicmljLkFwcGxpY2F0aW9uLnByb3RvdHlwZSA9IGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoe30sZmFicmljLk9ic2VydmFibGUse1xuICBkZWZhdWx0T3B0aW9uczoge1xuICAgIC8qKlxuICAgICAqIGlkIG9mIHRhcmdldCBjYW52YXMgZWxlbWVudFxuICAgICAqL1xuICAgIGNhbnZhc0NvbnRhaW5lcjogbnVsbFxuICB9LFxuICBjcmVkZW50aWFsczogZmFsc2UsXG4gIHJlYWR5IDogZmFsc2UsXG4gIGNhbnZhc0NsYXNzOiAnQ2FudmFzJyxcbiAgb3B0aW9uc09yZGVyOiBbXG4gICAgXCJjYW52YXNDb250YWluZXJcIixcbiAgICBcIipcIixcbiAgICBcIm9iamVjdHNcIixcbiAgICBcInNsaWRlXCJcbiAgXSxcbiAgcGx1Z2luczoge1xuICAgIHByZWxvYWRlcnM6IFtdLFxuICAgIGNvbmZpZ3VyYXRpb246IFtdLFxuICAgIGNhbnZhczogW11cbiAgfSxcbiAgLyoqXG4gICAqIEFkZGl0aW9uYWwgRXZlbnQgTGlzdGVuZXJzIGNvdWxkYmUgdXNlZCB0byBkZXRlY3QgYWN0aXZlb2JqZWN0IGNoYW5nZXNcbiAgICogIC0gY2FudmFzOmNyZWF0ZWRcbiAgICogIC0gZW50aXR5OmxvYWQgLSBFdmVudCBmaXJlZCBvbiBjcmVhdGlvbiBvZiBldmVyeSBuZXcgZmFicmljIGluc3RhbmNlKGNhbnZhcyxicnVzaCxvYmplY3QpXG4gICAqXG4gICAqICBAZXhhbXBsZVxuICAgKiAgJ2VudGl0eTpsb2FkJyA6IGZ1bmN0aW9uKGUpe1xuICAgKiAgICAgaWYoZS5vcHRpb25zLmJveFR5cGUgPT0gJ21hY2hpbmUnKSB7XG4gICAqICAgICAgIGUub3B0aW9ucy50eXBlID0gXCJtYWNoaW5lLW1hc2stcmVjdGFuZ2xlXCI7XG4gICAqICAgICB9XG4gICAqICAgfVxuICAgKi9cbiAgZXZlbnRMaXN0ZW5lcnM6IHtcbiAgICBcImNhbnZhczpjcmVhdGVkXCI6IFtdLFxuICAgIFwiZW50aXR5OmNyZWF0ZWRcIjogW1xuICAgICAgZnVuY3Rpb24oZSl7XG4gICAgICAgIGlmKGUudGFyZ2V0LmV2ZW50TGlzdGVuZXJzKXtcbiAgICAgICAgICBmb3IodmFyIGkgaW4gZS50YXJnZXQuZXZlbnRMaXN0ZW5lcnMpIHtcbiAgICAgICAgICAgIHZhciBfbGlzdGVuZXJzID0gZS50YXJnZXQuZXZlbnRMaXN0ZW5lcnNbaV07XG4gICAgICAgICAgICBpZihfbGlzdGVuZXJzLmNvbnN0cnVjdG9yID09IEFycmF5KXtcbiAgICAgICAgICAgICAgZm9yICh2YXIgaiBpbiBfbGlzdGVuZXJzKSB7XG4gICAgICAgICAgICAgICAgZS50YXJnZXQub24oaSwgX2xpc3RlbmVyc1tqXSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICBlLnRhcmdldC5vbihpLCBfbGlzdGVuZXJzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZihlLm9wdGlvbnMuZXZlbnRMaXN0ZW5lcnMpe1xuICAgICAgICAgIGZvcih2YXIgaSBpbiBlLm9wdGlvbnMuZXZlbnRMaXN0ZW5lcnMpe1xuICAgICAgICAgICAgZS50YXJnZXQub24oaSxlLm9wdGlvbnMuZXZlbnRMaXN0ZW5lcnNbaV0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBkZWxldGUgZS5vcHRpb25zLmV2ZW50TGlzdGVuZXJzO1xuXG4gICAgICAgIGlmKGUudGFyZ2V0Ll9kZWZhdWx0X2V2ZW50X2xpc3RlbmVycyl7XG4gICAgICAgICAgZm9yKHZhciBpIGluIGUudGFyZ2V0Ll9kZWZhdWx0X2V2ZW50X2xpc3RlbmVycyl7XG4gICAgICAgICAgICBlLnRhcmdldC5vbihpLGUudGFyZ2V0Ll9kZWZhdWx0X2V2ZW50X2xpc3RlbmVyc1tpXSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgXVxuICB9LFxuICBvblNsaWRlTG9hZGVkOiBmdW5jdGlvbiAoKSB7fSxcbiAgb25DYW52YXNDcmVhdGVkOiBmdW5jdGlvbiAoKSB7fSxcbiAgY2FsbGJhY2s6IGZ1bmN0aW9uICgpIHt9LFxuXG4gIGluaXQ6IGZ1bmN0aW9uKG9wdGlvbnMpe1xuICAgIHRoaXMuaW5pdEV2ZW50TGlzdGVuZXJzKCk7XG4gICAgb3B0aW9ucyA9ICBmYWJyaWMudXRpbC5vYmplY3QuZGVlcEV4dGVuZCh7fSx0aGlzLmRlZmF1bHRPcHRpb25zICxvcHRpb25zIHx8IHt9KTtcblxuICAgIHRoaXMuZmlyZShcImxvYWRpbmc6YmVnaW5cIix7b3B0aW9ucyA6IG9wdGlvbnN9KTtcblxuICAgIHRoaXMuX29wdGlvbnMgPSBvcHRpb25zO1xuXG5cbiAgICAkKCBkb2N1bWVudCApLnJlYWR5KGZ1bmN0aW9uKCl7XG4gICAgICBmYWJyaWMudXRpbC5vcmRlcihbXG4gICAgICAgIHRoaXMucHJlbG9hZGVyLFxuICAgICAgICB0aGlzLmxvYWRDb25maWd1cmF0aW9uLFxuICAgIC8vICAgIHRoaXMuY3JlYXRlQXBwLFxuICAgICAgICB0aGlzLmluaXRPcHRpb25zLFxuICAgICAgICB0aGlzLmluaXRpYWxpemUsXG4gICAgICAgIHRoaXMub25BcHBsaWNhdGlvbkNyZWF0ZWQsXG4gICAgICAgIHRoaXMucG9zdGxvYWRlcixcbiAgICAgICAgdGhpcy5jYWxsYmFjayAmJiBmdW5jdGlvbigpe1xuICAgICAgICAgIHNldFRpbWVvdXQodGhpcy5jYWxsYmFjay5iaW5kKHRoaXMpLDApO1xuICAgICAgICB9LFxuICAgICAgICBmdW5jdGlvbigpe1xuICAgICAgICAgIHRoaXMuZmlyZShcInJlYWR5XCIpO1xuICAgICAgICB9LmJpbmQodGhpcylcbiAgICAgIF0sdGhpcylcbiAgICB9LmJpbmQodGhpcykpXG4gIH0sXG4gIG9uQXBwbGljYXRpb25DcmVhdGVkOiBmdW5jdGlvbigpe1xuICAgIHRoaXMucmVhZHkgPSB0cnVlO1xuICAgIHRoaXMuZmlyZShcImxvYWRpbmc6ZW5kXCIse30pO1xuICB9LFxuICBzZXRDcmVkZW50aWFsczogZnVuY3Rpb24oY3JlZGVudGlhbHMpe1xuICAgIGlmKGNyZWRlbnRpYWxzKXtcbiAgICAgIGNvbnNvbGUuaW5mbyhcIiVjRmllcmEgQ2FudmFzIEVkaXRvciVjIGJ5ICVjRGVuaXMgUG9ub21hcmV2JWMgJWMlNiRzJWMgLyAlYyU5JHMlY1wiLCBcImNvbG9yOiAjZmZhNTAwXCIsIFwiY29sb3I6ICMyMDIwMjBcIiwgXCJjb2xvcjogIzJFQzA2Q1wiLCBcImNvbG9yOiAjMjAyMDIwXCIsIFwiY29sb3I6ICMzMzdhYjdcIiwgXCJ3d3cuaG9tZXRsdC5ydVwiLCBcImNvbG9yOiAjMjAyMDIwXCIsIFwiY29sb3I6ICMzMzdhYjdcIiwgXCJwb25vbWFyZXZ0bHRAZ21haWwuY29tXCIsIFwiY29sb3I6ICMyMDIwMjBcIik7XG4gICAgfVxuICB9LFxuICBpbml0T3B0aW9uczogZnVuY3Rpb24gKHJlc29sdmUsZXJyb3IpIHtcbiAgICB0aGlzLnNldCh0aGlzLl9vcHRpb25zLHJlc29sdmUpO1xuICB9LFxuICBjb25maWd1cmF0aW9uUHJvcGVydGllczogW10sXG4gIGxvYWRDb25maWd1cmF0aW9uOiBmdW5jdGlvbiAocmVzb2x2ZSxlcnJvcikge1xuXG4gICAgaWYodGhpcy5jb25maWd1cmF0aW9uUHJvcGVydGllcyl7XG4gICAgICBmb3IobGV0IHByb3Agb2YgdGhpcy5jb25maWd1cmF0aW9uUHJvcGVydGllcyl7XG5cbiAgICAgICAgaWYodGhpcy5fb3B0aW9uc1twcm9wXSl7XG4gICAgICAgICAgaWYoIXRoaXMuX29wdGlvbnMuY29uZmlndXJhdGlvbil7XG4gICAgICAgICAgICB0aGlzLl9vcHRpb25zLmNvbmZpZ3VyYXRpb24gPSB7fTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy5fb3B0aW9ucy5jb25maWd1cmF0aW9uW3Byb3BdID0gdGhpcy5fb3B0aW9uc1twcm9wXTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmKCF0aGlzLl9vcHRpb25zLmNvbmZpZ3VyYXRpb24pe1xuICAgICAgcmV0dXJuIHJlc29sdmUoKTtcbiAgICB9XG4gICAgdmFyIF9hcHAgPSB0aGlzO1xuICAgIGZhYnJpYy51dGlsLnByb21pc2VcbiAgICAgIC5tYXAoXG4gICAgICAgIHRoaXMuX29wdGlvbnMuY29uZmlndXJhdGlvbixcbiAgICAgICAgZnVuY3Rpb24odmFsdWUpe1xuICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLGZhaWwpIHtcbiAgICAgICAgICAgIGZhYnJpYy51dGlsLmRhdGEubG9hZEpzb24odmFsdWUscmVzb2x2ZSxmYWlsKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgKVxuICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzdWx0cyl7XG4gICAgICAgIGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoX2FwcC5fb3B0aW9ucyxyZXN1bHRzKVxuICAgICAgfSlcbiAgICAgIC50aGVuKHJlc29sdmUsZXJyb3IpO1xuICB9LFxuICBzZXRDYW52YXNDb250YWluZXI6IGZ1bmN0aW9uIChjYW52YXNDb250YWluZXIpIHtcbiAgICB0aGlzLmNhbnZhc0NvbnRhaW5lciA9IGNhbnZhc0NvbnRhaW5lcjtcblxuICAgIGlmIChjYW52YXNDb250YWluZXIuY29uc3RydWN0b3IgPT0gU3RyaW5nKSB7XG4gICAgICB2YXIgZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjYW52YXNDb250YWluZXIpO1xuICAgIH0gZWxzZSB7XG4gICAgICBlbCA9IGNhbnZhc0NvbnRhaW5lcjtcbiAgICB9XG4gICAgdGhpcy5jYW52YXMgPSBuZXcgZmFicmljW3RoaXMuY2FudmFzQ2xhc3NdKGVsLCB7YXBwbGljYXRpb246IHRoaXN9KTtcbiAgICAvLyB9ZWxzZXtcbiAgICAvLyAgIHRoaXMuY2FudmFzID0gbmV3IGZhYnJpY1t0aGlzLmNhbnZhc0NsYXNzXSh7YXBwbGljYXRpb246IHRoaXN9KTtcbiAgICAvLyB9XG5cbiAgICB0aGlzLmZpcmUoXCJjYW52YXM6Y3JlYXRlZFwiKTtcbiAgICB0aGlzLm9uQ2FudmFzQ3JlYXRlZCgpO1xuICB9LFxuICBkaXNwb3NlOiBmdW5jdGlvbigpe1xuICAgIHRoaXMuY2FudmFzLmRpc3Bvc2UoKTtcbiAgfSxcblxuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIEV2ZW50IExpc3RlbmVyc1xuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgc2V0RXZlbnRMaXN0ZW5lcnM6IGZ1bmN0aW9uKHZhbCl7XG4gICAgdGhpcy5vbih2YWwpO1xuICB9LFxuICBpbml0RXZlbnRMaXN0ZW5lcnM6IGZ1bmN0aW9uKCl7XG4gICAgaWYoIXRoaXMuX19ldmVudExpc3RlbmVycyl7XG4gICAgICB0aGlzLl9fZXZlbnRMaXN0ZW5lcnMgPSB7fTtcbiAgICB9XG4gICAgZm9yICh2YXIgZXZlbnQgaW4gdGhpcy5ldmVudExpc3RlbmVycykge1xuICAgICAgaWYoIXRoaXMuX19ldmVudExpc3RlbmVyc1tldmVudF0pe1xuICAgICAgICB0aGlzLl9fZXZlbnRMaXN0ZW5lcnNbZXZlbnRdID0gW11cbiAgICAgIH1cbiAgICAgIHRoaXMuX19ldmVudExpc3RlbmVyc1tldmVudF0gPSB0aGlzLl9fZXZlbnRMaXN0ZW5lcnNbZXZlbnRdLmNvbmNhdCAodGhpcy5ldmVudExpc3RlbmVyc1tldmVudF0pO1xuICAgIH1cbiAgfSxcblxuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vXG4gIF9fc2V0IDogZmFicmljLk9iamVjdC5wcm90b3R5cGUuX19zZXQsXG4gIF9zZXRPYmplY3Q6IGZhYnJpYy5PYmplY3QucHJvdG90eXBlLl9zZXRPYmplY3QsXG4gIHNldDogZmFicmljLk9iamVjdC5wcm90b3R5cGUuc2V0LFxuICBzZXRPcHRpb25zOiBmYWJyaWMuT2JqZWN0LnByb3RvdHlwZS5zZXRPcHRpb25zLFxuICBhY3Rpb25zOiB7XG4gICAgc2F2ZToge1xuICAgICAgdGl0bGU6IFwic2F2ZSBwcm9qZWN0XCIsXG4gICAgICBjbGFzc05hbWU6ICdmYSBmYS1mbG9wcHktbycsXG4gICAgICBhY3Rpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGRhdGEgPSB0aGlzLnRvT2JqZWN0KCk7XG4gICAgICAgIHRoaXMuYXBwbGljYXRpb24uYXBpLnNhdmUoZGF0YSk7XG4gICAgICB9XG4gICAgfVxuICB9XG59KTtcblxuLy8gZmFicmljLkFwcGxpY2F0aW9uLmFkZFBsdWdpbiA9IGZhYnJpYy5QbHVnaW5zTWl4aW4uYWRkUGx1Z2luLmJpbmQoZmFicmljLkFwcGxpY2F0aW9uKTtcblxuZmFicmljLmFwcCA9IGZ1bmN0aW9uKG9wdGlvbnMpe1xuICByZXR1cm4gbmV3IGZhYnJpYy5BcHBsaWNhdGlvbihvcHRpb25zKTtcbn07XG5cblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvY29yZS9hcHBsaWNhdGlvbi5qcyIsIid1c2Ugc3RyaWN0JztcblxucmVxdWlyZShcIi4vc3RhdGljLWNhbnZhcy5leHRcIik7XG5cbi8qKlxuICogIyBTbGlkZUNhbnZhc1xuICogSW5oZXJpdGVkIGZyb20gZmFicmljLkNhbnZhc1xuICpcbiAqXG5cbiAjIyBtZXRob2Q6IGxvYWRcblxuTWF0aG9kIGFsbG93cyB0byBhZGQgbmV3IG9iamVjdHMgYW5kIHNldCBuZXcgYXR0cmlidXRlcyBvZiBjYW52YXMuXG5cbiBgYGBqYXZhc2NyaXB0XG4gbG9hZCA6ICh7XG4gICAgYmFja2dyb3VuZEltYWdlOiBzdHJpbmcsXG4gICAgb2JqZWN0czogW0ZhYnJpY1NoYXBlT3B0aW9uc10sXG4gICAgY3VzdG9tU3luY09wdGlvbjogYW55LFxuICAgIGN1c3RvbUFzeW5jT3B0aW9uOiBhbnlcbiAgfSxjYWxsYmFjaykgOiB2b2lkXG4gYGBgXG5cbiBUbyBleHRlbmQgbG9hZGluZyBiZWhhdmlvciBhbmQgdXNlIGN1c3RvbSBvcHRpb25zIGl0IGlzIHBvc3NpYmxlIHRvIGRlZmluZSAqKnNldCBmdWNudGlvbnMqKiBpbiBDYW52YXMgcHJvdG90eXBlLlxuXG4gYGBgamF2YXNjcmlwdFxuIC8vIENhbnZhcyBQcm90b3R5cGVcbiBzZXRDdXN0b21Bc3luY09wdGlvbjogZnVuY3Rpb24odmFsLGNhbGxiYWNrKXtcbiAgdGhpcy5kb0FzeW5jTWV0aG9kKHZhbCxjYWxsYmFjaylcbn1cbiBzZXRDdXN0b21TeW5jT3B0aW9uOiBmdW5jdGlvbih2YWwpe1xuICB0aGlzLmN1c3RvbVN5bmNPdGlvbiA9IHZhbDtcbn1cbiBgYGBcblxuICMjIyBhdHRyaWJ1dGU6IGJhY2tncm91bmRJbWFnZVByb3BlcnRpZXNcblxuIGRlZmF1bHQgYXR0cmlidXRlcyBmb3IgYmFja2dyb3VuZCBpbWFnZVxuXG4gIyMjIGZyZWVEcmF3aW5nQnJ1c2hcblxuIGRlZmF1bHQgYWN0aXZlIGRyYXdpbmcgYnJ1c2hcblxuIGBgYFxuIGZyZWVEcmF3aW5nQnJ1c2g6IFwiUGFpbnRCdWNrZXRCcnVzaFwiIHwgXCJQYWludFBlbkJydXNoXCIgfCBcIlBlbmNpbEJydXNoXCJcbiBgYGBcblxuICMjIyBhdHRyaWJ1dGU6IG9uU2xpZGVMb2FkZWRcblxuIG9uU2xpZGVMb2FkZWQgY2FsbHMgYXMgYSBjYWxsYmFjayBmb3IgbG9hZCBmdWNudGlvblxuXG4gIyMjIGF0dHJpYnV0ZTogYmFja2dyb3VuZFBvc2l0aW9uXG5cbiBvblNsaWRlTG9hZGVkIGNhbGxzIGFzIGEgY2FsbGJhY2sgZm9yIGxvYWQgZnVjbnRpb25cblxuIGBgYFxuIGJhY2tncm91bmRQb3NpdGlvbjogJ21hbnVhbCcgfCAncmVzaXplJyB8ICdmaXQnIHwgJ2NvdmVyJyB8ICdjZW50ZXInXG4gYGBgXG5cbiAtIG1hbnVhbCAtIGJhY2tncm91bmQgd2lsbCBuZSBub3Qgc2NhbGVkIGFuZCBwdXQgYXQgbGVmdCB0b3AgY29ybmVyXG4gLSByZXNpemUgLSBjYW52YXMgd2lsbCBiZSByZXNpemVkIGFjY29yZGluZyB0byBpbWFnZSBzaXplXG4gLSBmaXQgLSB3aWxsIGJlIHNjYWxlZCB0byBmaXQgY2FudmFzIHNpemVcbiAtIGNvdmVyIC0gd2lsbCBiZSBzY2FsZWQgdG8gY292ZXIgYWxsIGNhbnZhcyBzaXplXG4gLSBjZW50ZXIgLSBiYWNrb2dydW5kIHdpbGwgYmUgbm90IHNjYWxlZCBidXQgcHV0IGluIHRoZSBtaWRkbGVcblxuICMjIyBtZXRob2Q6IHNldEludGVyYWN0aXZlTW9kZVxuXG4gc3dpdGNoIGJldHdlZW4gZHJhd2luZyBhbmQgaGFuZCggbW92aW5nIGN1bnZhcyBieSBtb3VzZSkgbW9kZXNcblxuIGBgYGphdmFzY3JpcHRcbiBjYW52YXMuc2V0SW50ZXJhY3RpdmVNb2RlKCBtb2RlIDogXCJoYW5kXCIgfCBcIm1peGVkXCIpIDogdm9pZFxuIGBgYFxuXG4gIyMjIGRyYXdpbmdDb2xvclxuXG4gZHJhd2luZyBjb2xvciB1c2luZyBieSBicnVzaGVzXG5cbiAqL1xuXG5cblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuU3RhdGljQ2FudmFzLnByb3RvdHlwZSwge1xuXG4gIHNldEJhY2tncm91bmRDb2xvcjogZnVuY3Rpb24oYmFja2dyb3VuZENvbG9yLCBjYWxsYmFjaykge1xuXG4gICAgaWYodGhpcy5sb2FkZWQpIHtcbiAgICAgIHZhciBvcmlnaW5hbFN0YXRlID0ge2JhY2tncm91bmRDb2xvcjogdGhpcy5iYWNrZ3JvdW5kQ29sb3J9O1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLl9fc2V0QmdPdmVybGF5Q29sb3IoJ2JhY2tncm91bmRDb2xvcicsIGJhY2tncm91bmRDb2xvciwgZnVuY3Rpb24oKXtcbiAgICAgIHRoaXMucmVuZGVyQWxsKCk7XG5cbiAgICAgIGlmKHRoaXMubG9hZGVkKXtcbiAgICAgICAgdGhpcy5maXJlKCdtb2RpZmllZCcse3N0YXRlczoge1xuICAgICAgICAgIG9yaWdpbmFsOiBvcmlnaW5hbFN0YXRlLFxuICAgICAgICAgIG1vZGlmaWVkOiB7YmFja2dyb3VuZENvbG9yOiBiYWNrZ3JvdW5kQ29sb3J9XG4gICAgICAgIH19KTtcbiAgICAgIH1cbiAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKClcbiAgICB9LmJpbmQodGhpcykpO1xuICB9LFxuICBzdG9yZVByb3BlcnRpZXM6IFsnKicsJ2JhY2tncm91bmRDb2xvcicsJ2JhY2tncm91bmRJbWFnZScsJ3dpZHRoJywnaGVpZ2h0J10sXG5cbiAgdG9PYmplY3RTeW5jOiBmdW5jdGlvbiAocHJvcGVydGllc1RvSW5jbHVkZSkge1xuICAgIHByb3BlcnRpZXNUb0luY2x1ZGUgPSAocHJvcGVydGllc1RvSW5jbHVkZSB8fCBbXSkuY29uY2F0KHRoaXMuc3RvcmVQcm9wZXJ0aWVzKTtcblxuICAgIGxldCBfZGF0YSA9IHtcbiAgICAgIG9iamVjdHM6IHRoaXMuZ2V0T2JqZWN0cygpLFxuICAgICAgd2lkdGg6IHRoaXMub3JpZ2luYWxXaWR0aCB8fCB0aGlzLndpZHRoLFxuICAgICAgaGVpZ2h0OiB0aGlzLm9yaWdpbmFsSGVpZ2h0IHx8IHRoaXMuaGVpZ2h0LFxuICAgIH07XG4gICAgZmFicmljLnV0aWwucG9wdWxhdGVXaXRoUHJvcGVydGllcyh0aGlzLCBfZGF0YSwgcHJvcGVydGllc1RvSW5jbHVkZSk7XG5cblxuICAgIHRoaXMuZmlyZShcImJlZm9yZTpvYmplY3RcIix7b2JqZWN0OiBfZGF0YX0pO1xuXG4gICAgcmV0dXJuIF9kYXRhO1xuICB9LFxuICB0b09iamVjdDogZnVuY3Rpb24gKHByb3BlcnRpZXNUb0luY2x1ZGUpIHtcblxuICAgIHByb3BlcnRpZXNUb0luY2x1ZGUgPSAocHJvcGVydGllc1RvSW5jbHVkZSB8fCBbXSkuY29uY2F0KHRoaXMuc3RvcmVQcm9wZXJ0aWVzKTtcblxuICAgIGxldCBfb2JqcyA9IHRoaXMuZ2V0T2JqZWN0cygpO1xuXG4gICAgX29ianMgPSBmYWJyaWMudXRpbC5vYmplY3QuZmlsdGVyKF9vYmpzLHtzdG9yZWQ6IHRydWV9KTtcbiAgICBfb2JqcyA9IF9vYmpzLm1hcChpbnN0YW5jZSA9PiB7XG4gICAgICByZXR1cm4gaW5zdGFuY2UudG9PYmplY3QodGhpcy5vYmplY3RzUHJvcGVydGllc1RvSW5jbHVkZSk7XG4gICAgfSk7XG5cbiAgICBsZXQgX2RhdGEgPSB7XG4gICAgICBvYmplY3RzOiBfb2Jqc1xuICAgIH07XG5cbiAgICBmYWJyaWMudXRpbC5wb3B1bGF0ZVdpdGhQcm9wZXJ0aWVzKHRoaXMsIF9kYXRhLCBwcm9wZXJ0aWVzVG9JbmNsdWRlKTtcblxuICAgIGlmKHByb3BlcnRpZXNUb0luY2x1ZGUuaW5kZXhPZignYmFja2dyb3VuZEltYWdlJykgIT09IC0xKXtcbiAgICAgIGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoX2RhdGEsIHRoaXMuX19zZXJpYWxpemVCZ092ZXJsYXkoKSk7XG4gICAgfVxuXG4gICAgaWYocHJvcGVydGllc1RvSW5jbHVkZS5pbmRleE9mKCd3aWR0aCcpICE9PSAtMSAmJiB0aGlzLm9yaWdpbmFsV2lkdGgpe1xuICAgICAgX2RhdGEud2lkdGggPSB0aGlzLm9yaWdpbmFsV2lkdGg7XG4gICAgfVxuICAgIGlmKHByb3BlcnRpZXNUb0luY2x1ZGUuaW5kZXhPZignaGVpZ2h0JykgIT09IC0xICYmIHRoaXMub3JpZ2luYWxIZWlnaHQpe1xuICAgICAgX2RhdGEuaGVpZ2h0ID0gdGhpcy5vcmlnaW5hbEhlaWdodDtcbiAgICB9XG5cblxuICAgIC8qXG4gICAgIGZ1bmN0aW9uIHNlcmlhbGl6ZVRodW1iKHByb3BlcnRpZXNUb0luY2x1ZGUsIF9kYXRhKXtcbiAgICAgaWYocHJvcGVydGllc1RvSW5jbHVkZS5pbmRleE9mKCd0aHVtYicpICE9PSAtMSl7XG4gICAgIHZhciBzaXplID0gZmFicmljLnV0aWwuZ2V0UHJvcG9ydGlvbnModGhpcy5nZXRPcmlnaW5hbFNpemUoKSwgdGhpcy50aHVtYlNpemUsICdmaXQnKTtcbiAgICAgdmFyIGNhbnZhcyA9IGZhYnJpYy51dGlsLmNyZWF0ZUNhbnZhc0VsZW1lbnQoKTtcbiAgICAgY2FudmFzLndpZHRoID0gc2l6ZS53aWR0aDtcbiAgICAgY2FudmFzLmhlaWdodCA9IHNpemUuaGVpZ2h0O1xuICAgICB0aGlzLnJlbmRlclRodW1iKGNhbnZhcyk7XG4gICAgIF9kYXRhLnRodW1iID0gY2FudmFzLnRvRGF0YVVSTCgpO1xuICAgICB9XG4gICAgIH0sXG4gICAgIGZ1bmN0aW9uIHNlcmlhbGl6ZVRlbXBsYXRlKHByb3BlcnRpZXNUb0luY2x1ZGUsIF9kYXRhKSB7XG4gICAgIGlmIChwcm9wZXJ0aWVzVG9JbmNsdWRlLmluZGV4T2YoJ3RlbXBsYXRlJykgIT09IC0xKSB7XG4gICAgIGlmICh0aGlzLnRlbXBsYXRlKSB7XG4gICAgIGZvciAodmFyIGkgaW4gX2RhdGEudGVtcGxhdGUpIHtcbiAgICAgaWYgKEpTT04uc3RyaW5naWZ5KF9kYXRhW2ldKSA9PSBKU09OLnN0cmluZ2lmeShfZGF0YS50ZW1wbGF0ZVtpXSkpIHtcbiAgICAgZGVsZXRlIF9kYXRhW2ldO1xuICAgICB9XG4gICAgIH1cbiAgICAgX2RhdGEudGVtcGxhdGUgPSB0aGlzLnRlbXBsYXRlLmlkO1xuICAgICB9XG4gICAgIH1cbiAgICAgfSovXG5cblxuICAgIHRoaXMuZmlyZShcImJlZm9yZTpvYmplY3RcIix7b2JqZWN0OiBfZGF0YX0pO1xuXG4gICAgcmV0dXJuIF9kYXRhO1xuICB9LFxuICBzZXRUZW1wbGF0ZTogZnVuY3Rpb24odGVtcGxhdGUpe1xuXG4gICAgdGhpcy50ZW1wbGF0ZSA9IHRlbXBsYXRlO1xuICAgIGlmKCF0ZW1wbGF0ZSlyZXR1cm47XG5cbiAgICB0aGlzLnNldFdpZHRoKHRoaXMuc2xpZGVXaWR0aCB8fCB0ZW1wbGF0ZS53aWR0aCk7XG4gICAgdGhpcy5zZXRIZWlnaHQodGhpcy5zbGlkZUhlaWdodCB8fCB0ZW1wbGF0ZS5oZWlnaHQpO1xuICAgIHRoaXMub3JpZ2luYWxIZWlnaHQgPSB0aGlzLmhlaWdodDtcbiAgICB0aGlzLm9yaWdpbmFsV2lkdGggPSB0aGlzLndpZHRoO1xuXG4gICAgdGhpcy5zZXQoZmFicmljLnV0aWwub2JqZWN0LnJlYXJyYW5nZSh0ZW1wbGF0ZSxbXCJhcmVhc1wiLFwiaGVscGVyc1wiLFwib2Zmc2V0c1wiXSkpO1xuXG4gICAgdGhpcy5fdXBkYXRlX2NsaXBfcmVjdCgpO1xuICAgIHRoaXMuX3VwZGF0ZV9iYWNrZ3JvdW5kX2ltYWdlKCk7XG4gICAgdGhpcy5maXJlKFwibW9kaWZpZWRcIix7dHlwZTogXCJ0ZW1wbGF0ZVwifSk7XG4gICAgdGhpcy5yZW5kZXJBbGwoKTtcbiAgfSxcbiAgYWRkVGV4dDogZnVuY3Rpb24gKHRleHQsIG9wdGlvbnMpIHtcbiAgICB0aGlzLmNyZWF0ZU9iamVjdCh7XG4gICAgICBwb3NpdGlvbjogXCJjZW50ZXJcIixcbiAgICAgIHRleHQ6IHRleHQsXG4gICAgICB0eXBlOiAgIHRoaXMuZGVmYXVsdFRleHRUeXBlLFxuICAgICAgY2xpcFRvOiB0aGlzLmFjdGl2ZUFyZWEsXG4gICAgICBtb3ZlbWVudExpbWl0cyA6IHRoaXMuYWN0aXZlQXJlYVxuICAgIH0pO1xuICB9XG59KTtcblxuXG5cbmZhYnJpYy5TbGlkZUNhbnZhcyA9IGZhYnJpYy51dGlsLmNyZWF0ZUNsYXNzKGZhYnJpYy5DYW52YXMsZmFicmljLlBsdWdpbnNNaXhpbiwge1xuICB0eXBlOiAnY2FudmFzJyxcbiAgLyoqXG4gICAqIGluaXRpYWxpemVkIHdpZHRoIG9mIHRoZSBjYW52YXNcbiAgICovXG4gIHdpZHRoOiAxNjAgLFxuICAvKipcbiAgICogaW5pdGlhbGl6ZWQgaGVpZ2h0IG9mIHRoZSBjYW52YXNcbiAgICovXG4gIGhlaWdodDogOTAsXG4gIC8qKlxuICAgKiBvdXRwdXQgcXVhbGl0eVxuICAgKi9cbiAgZG90c1BlclVuaXQ6IDEsXG4gIHNjYWxlOiAxLFxuICBsb2FkZWQ6IGZhbHNlLFxuICAvKipcbiAgICogYWxsb3cgdXNlciB0byBpbnRlcmFjdCB3aXRoIGNhbnZhc1xuICAgKi9cbiAgaW50ZXJhY3RpdmU6IHRydWUsXG4gIC8qKlxuICAgKiBmaWxsIG5vdCB0aGUgc2xpZGUgYXJlYSwgYnV0IHdob2xlIGNhbnZhcyB3aXRoIGJhY2tncm91bmQgY29sb3JcbiAgICovXG4gIGRlZmF1bHRUZXh0OiBcInRleHRcIixcbiAgZGVmYXVsdFRleHRUeXBlOiBcInRleHRcIixcbiAgdGh1bWJTaXplOiB7XG4gICAgd2lkdGg6IDUwLFxuICAgIGhlaWdodDogMTAwXG4gIH0sXG5cbiAgY29udGV4dFRvcEltYWdlU21vb3RoaW5nRW5hYmxlZDogdHJ1ZSxcbiAgcGx1Z2luczoge1xuICAgIGluaXRpYWxpemU6IFtcbiAgICBdLFxuICAgIHByZWxvYWRlcnM6IFtcbiAgICBdLFxuICAgIGxvYWRlcnM6IFtdXG4gIH0sXG4gIHNldEludGVyYWN0aXZlOiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICB0aGlzLmludGVyYWN0aXZlID0gdmFsdWU7XG4gIH0sXG5cbiAgX2NyZWF0ZVVwcGVyQ2FudmFzOiBmdW5jdGlvbiAoKSB7XG4gICAgZmFicmljLkNhbnZhcy5wcm90b3R5cGUuX2NyZWF0ZVVwcGVyQ2FudmFzLmNhbGwodGhpcyk7XG4gICAgdmFyIGN0eCA9IHRoaXMuY29udGV4dFRvcDtcblxuICAgIGlmKGN0eC5pbWFnZVNtb290aGluZ0VuYWJsZWQpe1xuICAgICAgY3R4LmltYWdlU21vb3RoaW5nRW5hYmxlZCA9IHRoaXMuY29udGV4dFRvcEltYWdlU21vb3RoaW5nRW5hYmxlZDtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY3R4LndlYmtpdEltYWdlU21vb3RoaW5nRW5hYmxlZCA9IHRoaXMuY29udGV4dFRvcEltYWdlU21vb3RoaW5nRW5hYmxlZDtcbiAgICBjdHgubW96SW1hZ2VTbW9vdGhpbmdFbmFibGVkICAgID0gdGhpcy5jb250ZXh0VG9wSW1hZ2VTbW9vdGhpbmdFbmFibGVkO1xuICAgIGN0eC5tc0ltYWdlU21vb3RoaW5nRW5hYmxlZCAgICAgPSB0aGlzLmNvbnRleHRUb3BJbWFnZVNtb290aGluZ0VuYWJsZWQ7XG4gICAgY3R4Lm9JbWFnZVNtb290aGluZ0VuYWJsZWQgICAgICA9IHRoaXMuY29udGV4dFRvcEltYWdlU21vb3RoaW5nRW5hYmxlZDtcbiAgfSxcbiAgX29uTW91c2VVcEluRHJhd2luZ01vZGU6IGZ1bmN0aW9uKGUpIHtcbiAgICB0aGlzLl9pc0N1cnJlbnRseURyYXdpbmcgPSBmYWxzZTtcbiAgICBpZiAodGhpcy5jbGlwVG8pIHtcbiAgICAgIHRoaXMuY29udGV4dFRvcC5yZXN0b3JlKCk7XG4gICAgfVxuICAgIHZhciBwb2ludGVyID0gdGhpcy5nZXRQb2ludGVyKGUpO1xuICAgIHRoaXMuZnJlZURyYXdpbmdCcnVzaC5vbk1vdXNlVXAocG9pbnRlcik7XG4gICAgdGhpcy5faGFuZGxlRXZlbnQoZSwgJ3VwJyk7XG4gIH0sXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uIChlbCwgb3B0aW9ucyxjYWxsYmFjaykge1xuICAgIGlmKGVsICYmIGVsLmNvbnN0cnVjdG9yID09IE9iamVjdCl7XG4gICAgICBjYWxsYmFjayA9IG9wdGlvbnM7XG4gICAgICBvcHRpb25zID0gZWw7XG4gICAgICBlbCA9IG51bGw7XG4gICAgfVxuICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuXG4gICAgaWYob3B0aW9ucy5hcHBsaWNhdGlvbil7XG4gICAgICBvcHRpb25zLmFwcGxpY2F0aW9uLmZpcmUoXCJlbnRpdHk6Y3JlYXRlZFwiLHt0YXJnZXQgOiB0aGlzICwgb3B0aW9ucyA6IG9wdGlvbnN9KTtcbiAgICB9XG5cbiAgICB0aGlzLmlkID0gZmFicmljLlNsaWRlQ2FudmFzLl9faWRjb3VudGVyKys7XG5cbiAgICB0aGlzLl9vYmplY3RzID0gW107XG4gICAgdGhpcy5fY3JlYXRlTG93ZXJDYW52YXMoZWwpO1xuXG4gICAgdGhpcy5jcmVhdGVkID0gdHJ1ZTtcbiAgICB0aGlzLl9jdXJyZW50VHJhbnNmb3JtID0gbnVsbDtcbiAgICB0aGlzLl9ncm91cFNlbGVjdG9yID0gbnVsbDtcbiAgICB0aGlzLl9pbml0V3JhcHBlckVsZW1lbnQoKTtcbiAgICB0aGlzLl9jcmVhdGVVcHBlckNhbnZhcygpO1xuICAgIHRoaXMuX2luaXRFdmVudExpc3RlbmVycygpO1xuICAgIHRoaXMuX2luaXRSZXRpbmFTY2FsaW5nKCk7XG4gICAgdGhpcy5jYWxjT2Zmc2V0KCk7XG5cbiAgICB0aGlzLndyYXBwZXJFbC5hcHBlbmRDaGlsZCh0aGlzLnVwcGVyQ2FudmFzRWwpO1xuXG4gICAgdGhpcy5fY3JlYXRlQ2FjaGVDYW52YXMoKTtcbiAgICB0aGlzLl9zZXRJbWFnZVNtb290aGluZygpO1xuICAgIHRoaXMuX2luaXRSZXRpbmFTY2FsaW5nKCk7XG5cbiAgICB0aGlzLnNldChvcHRpb25zKTtcbiAgICB0aGlzLl9pbml0U2l6ZSgpO1xuXG4gICAgdGhpcy5jYWxjT2Zmc2V0KCk7XG5cbiAgICB0aGlzLmZpcmUoXCJjcmVhdGVkXCIpO1xuICAgIC8vIGlmKHRoaXMuYXBwbGljYXRpb24pe1xuICAgIC8vICAgdGhpcy5hcHBsaWNhdGlvbi5maXJlKFwiY2FudmFzOmNyZWF0ZWRcIix7dGFyZ2V0IDogdGhpc30pO1xuICAgIC8vIH1cbiAgfSxcbiAgYW5pbWF0ZWQ6IGZhbHNlLFxuICBzZXRBbmltYXRlZDogZnVuY3Rpb24odmFsKXtcbiAgICB0aGlzLmFuaW1hdGVkID0gdmFsO1xuICAgIGlmKHZhbCl7XG4gICAgICBmYWJyaWMudXRpbC5yZXF1ZXN0QW5pbUZyYW1lKGZ1bmN0aW9uIHJlbmRlcigpIHtcbiAgICAgICAgdGhpcy5yZW5kZXJBbGwoKTtcbiAgICAgICAgZmFicmljLnV0aWwucmVxdWVzdEFuaW1GcmFtZShyZW5kZXIpO1xuICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICB9XG4gIH0sXG4gIGNyZWF0ZTogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuY3JlYXRlZCA9IHRydWU7XG4gICAgdGhpcy5faW5pdEludGVyYWN0aXZlKCk7XG4gICAgdGhpcy5fY3JlYXRlQ2FjaGVDYW52YXMoKTtcbiAgfSxcbiAgLyoqXG4gICAqIEFkZGl0aW9uYWwgRXZlbnQgTGlzdGVuZXJzXG4gICAqICAtIGxvYWRpbmc6ZW5kXG4gICAqICAtIHRhcmdldDptb2RpZmllZCAtIGNvdWxkYmUgdXNlZCB0byBkZXRlY3QgYWN0aXZlIG9iamVjdCBjaGFuZ2VzXG4gICAqICAtIHRhcmdldDpjaGFuZ2VkXG4gICAqICAtIHRhcmdldDpjbGVhcmVkXG4gICAqL1xuICBldmVudExpc3RlbmVyczoge1xuICAgICdvYmplY3Q6bW92aW5nJzogZnVuY3Rpb24gKG9iaikge1xuICAgICAgdGhpcy5maXJlKCd0YXJnZXQ6bW9kaWZpZWQnLCB0aGlzLCBvYmopXG4gICAgfSxcbiAgICAnc2VsZWN0aW9uOmNsZWFyZWQnOiBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgIGlmKCF0aGlzLnRhcmdldClyZXR1cm47XG4gICAgICB0aGlzLnRhcmdldC5maXJlKCdkZXNlbGVjdGVkJywgZXZlbnQpO1xuICAgICAgdGhpcy50YXJnZXQgPSBudWxsO1xuICAgICAgdGhpcy5maXJlKCd0YXJnZXQ6Y2xlYXJlZCcsIGV2ZW50KTtcbiAgICB9LFxuICAgICdvYmplY3Q6c2VsZWN0ZWQnOiBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgIGV2ZW50LnByZXZpb3VzID0gdGhpcy50YXJnZXQ7XG4gICAgICB0aGlzLnRhcmdldCA9IGV2ZW50LnRhcmdldDtcbiAgICAgIGlmKGV2ZW50LnByZXZpb3VzKXtcbiAgICAgICAgZXZlbnQucHJldmlvdXMuZmlyZSgnZGVzZWxlY3RlZCcsIGV2ZW50KTtcbiAgICAgIH1cbiAgICAgIHRoaXMuZmlyZSgndGFyZ2V0OmNoYW5nZWQnLCBldmVudCk7XG4gICAgfSxcbiAgICAnZ3JvdXA6c2VsZWN0ZWQnOiBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgIHRoaXMudGFyZ2V0ID0gZXZlbnQudGFyZ2V0O1xuICAgICAgdGhpcy5maXJlKCd0YXJnZXQ6Y2hhbmdlZCcsIGV2ZW50KTtcbiAgICB9XG4gIH1cbn0pO1xuZmFicmljLlNsaWRlQ2FudmFzLl9faWRjb3VudGVyID0gMDtcbmZhYnJpYy5TbGlkZUNhbnZhcy5mcm9tSnNvbiA9IGZ1bmN0aW9uKHVybCxjYWxsYmFjayAsIGVsZW1lbnQpe1xuICBmYWJyaWMudXRpbC5kYXRhLmxvYWRKc29uKHVybCxmdW5jdGlvbihkYXRhKXtcbiAgICBuZXcgZmFicmljLlNsaWRlQ2FudmFzKGVsZW1lbnQsZGF0YSxjYWxsYmFjaylcbiAgfSlcbn07XG5cbmZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUuYWN0aW9ucyA9IGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoe30sIHtcbiAgc2VsZWN0QWxsOiB7XG4gICB0aXRsZTogJ3NlbGVjdEFsbCcsXG4gICB0eXBlOiAna2V5J1xuICB9LFxuICBiYWNrZ3JvdW5kQ29sb3IgOiB7XG4gICAgdHlwZTogXCJjb2xvclwiXG4gIH0sXG4gIGFkZFRleHQ6IHtcbiAgICBjbGFzc05hbWU6ICAnZmEgZmEtZm9udCcsXG4gICAgdGl0bGU6ICd0ZXh0JyxcbiAgICBhY3Rpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuYWRkVGV4dCh0aGlzLmRlZmF1bHRUZXh0LHt9KTtcbiAgICB9XG4gIH1cbn0pO1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5BcHBsaWNhdGlvbi5wcm90b3R5cGUsIHtcbiAgc2V0U2xpZGU6IGZ1bmN0aW9uICh2YWx1ZSwgY2FsbGJhY2spIHtcbiAgICB2YXIgX2NhbnZhcyA9IHRoaXMuY2FudmFzO1xuICAgIGlmIChfY2FudmFzLmxvYWQpIHtcbiAgICAgIF9jYW52YXMubG9hZCh2YWx1ZSwgY2FsbGJhY2spO1xuICAgIH0gZWxzZSB7XG4gICAgICBfY2FudmFzLmNyZWF0ZU9iamVjdHModmFsdWUsIGNhbGxiYWNrKTtcbiAgICB9XG4gIH1cbn0pO1xuXG5mYWJyaWMuQXBwbGljYXRpb24ucHJvdG90eXBlLmNhbnZhc0NsYXNzID0gJ1NsaWRlQ2FudmFzJztcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvY29yZS9zbGlkZS5qcyIsIlxuZmFicmljLlNsaWRlID0gZnVuY3Rpb24oYXBwbGljYXRpb24sIHNsaWRlKXtcblxuXG4gIGlmKGZhYnJpYy5pc0xpa2VseU5vZGUpe1xuICAgIC8vIGZhYnJpYy5DYW52YXMgPSBmYWJyaWMuU2xpZGVDYW52YXM7XG4gICAgdmFyIHcgPSBzbGlkZS5zbGlkZVdpZHRoOyAvL3RvZG98fCBzbGlkZS50ZW1wbGF0ZS53aWR0aDtcbiAgICB2YXIgaCA9IHNsaWRlLnNsaWRlSGVpZ2h0Oy8vdG9kbyB8fCBzbGlkZS50ZW1wbGF0ZS5oZWlnaHQ7XG4gICAgdmFyIHpvb20gPSBmYWJyaWMuU2xpZGVDYW52YXMucHJvdG90eXBlLnpvb20gfHwgMTtcbiAgICB0aGlzLmNhbnZhcyA9IGZhYnJpYy5jcmVhdGVDYW52YXNGb3JOb2RlKHcgKiB6b29tLGggKiB6b29tKTtcbiAgfWVsc2V7XG4gICAgdmFyICRjYW52YXMgPSBmYWJyaWMudXRpbC5jcmVhdGVDYW52YXNFbGVtZW50KCk7XG4gICAgdGhpcy5jYW52YXMgPSAgbmV3IGZhYnJpYy5TdGF0aWNDYW52YXMoJGNhbnZhcywge2FwcGxpY2F0aW9uOiBhcHBsaWNhdGlvbiwgaW50ZXJhY3RpdmU6IGZhbHNlfSk7XG4gIH1cblxuICB0aGlzLm9iamVjdCA9IHNsaWRlO1xuIC8vIHRoaXMuZGF0YSA9IHNsaWRlLmRhdGE7XG4gIHRoaXMuYXBwbGljYXRpb24gPSBhcHBsaWNhdGlvbjtcbiAgdGhpcy5pZCA9ICsrIGZhYnJpYy5TbGlkZS5fc2xpZGVzX2lkX2NvdW50ZXI7XG5cbn07XG5cbmZhYnJpYy5TbGlkZS5wcm90b3R5cGUgPSBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKHt9LGZhYnJpYy5PYnNlcnZhYmxlKTtcblxuZmFicmljLlNsaWRlLl9zbGlkZXNfaWRfY291bnRlciA9IDE7XG5cblxuXG5mYWJyaWMuQXBwbGljYXRpb24ucHJvdG90eXBlLmNvbmZpZ3VyYXRpb25Qcm9wZXJ0aWVzLnB1c2goXCJzbGlkZXNcIik7XG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5BcHBsaWNhdGlvbi5wcm90b3R5cGUsIHtcbiAgZGVmYXVsdE9wdGlvbnM6IGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLkFwcGxpY2F0aW9uLnByb3RvdHlwZS5kZWZhdWx0T3B0aW9ucyx7XG4gICAgYWN0aXZlU2xpZGU6IDBcbiAgfSksXG4gIG9wdGlvbnNPcmRlcjogKGZ1bmN0aW9uKCl7XG4gICAgdmFyIG9vID0gZmFicmljLkFwcGxpY2F0aW9uLnByb3RvdHlwZS5vcHRpb25zT3JkZXI7XG4gICAgb28ucHVzaChcInNsaWRlc1wiLFwiYWN0aXZlU2xpZGVcIik7XG4gICAgcmV0dXJuIG9vO1xuICB9KSgpLFxuICAvKmluaXRpYWxpemU6IGZ1bmN0aW9uIChvcHRpb25zKSB7XG5cbiAgIGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQodGhpcywge1xuICAgbGFzdF9pZDogMSxcbiAgIHNjYWxlVmFsdWU6IDEsXG4gICBhY3RpdmVTbGlkZTogbnVsbCxcbiAgIGhpc3Rvcnk6IG51bGwsXG4gICBzbGlkZXM6IFtdLFxuICAgY2FudmFzOiBudWxsXG4gICB9KTtcblxuICAgdGhpcy5hbGlnbWVudExpbmVYID0gZmFsc2U7XG4gICB0aGlzLmFsaWdtZW50TGluZVkgPSBmYWxzZTtcblxuICAgZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCh0aGlzLG9wdGlvbnMpO1xuICAgZmFicmljLnV0aWwub2JqZWN0LmRlZmF1bHRzKG9wdGlvbnMsdGhpcy5kZWZ1bHRPcHRpb25zKTtcblxuICAgLy8gdGhpcy5zZXRBY2Nlc3ModGhpcy5hY2Nlc3MpO1xuXG4gICBpZihvcHRpb25zLmdyaWRzbmFwcGVyICE9PSB1bmRlZmluZWQpIHtcbiAgIHRoaXMuZ3JpZHNuYXBwZXIgPSBvcHRpb25zLmdyaWRzbmFwcGVyXG4gICB9XG4gICBpZihvcHRpb25zLmhpc3RvcnkgIT09IHVuZGVmaW5lZCkge1xuICAgdGhpcy5oaXN0b3J5ID0gb3B0aW9ucy5oaXN0b3J5O1xuICAgfVxuICAgaWYob3B0aW9ucy5kYXRhKXtcbiAgIHRoaXMuZGF0YSA9IG9wdGlvbnMuZGF0YTtcbiAgIH1cbiAgIGlmKHRoaXMuaGlzdG9yeSkge1xuICAgdGhpcy5oaXN0b3J5ID0gbmV3IEhpc3RvcnkodGhpcyk7XG4gICB0aGlzLmhpc3RvcnkuYXBwbGljYXRpb24gPSB0aGlzLmFwcGxpY2F0aW9uO1xuICAgfVxuXG5cbiAgIGlmKG9wdGlvbnMuY2FudmFzKXtcbiAgIHZhciBfY2FudmFzID0gbmV3IGZhYnJpYy5TbGlkZUNhbnZhcyhkb2N1bWVudC5nZXRFbGVtZW50QnlJZChvcHRpb25zLmNhbnZhcykpO1xuICAgX2NhbnZhcy5hcHBsaWNhdGlvbiA9IHRoaXMuYXBwbGljYXRpb247XG4gICBfY2FudmFzLnByb2plY3QgPSB0aGlzO1xuICAgdGhpcy5zZXRDYW52YXMoX2NhbnZhcyk7XG4gICB9XG5cbiAgIHJldHVybiB0aGlzO1xuICAgfSwqL1xuICBzZXRTbGlkZXM6IGZ1bmN0aW9uICh2YWx1ZSwgY2FsbGJhY2spIHtcblxuICAgIGZhYnJpYy51dGlsLmRhdGEubG9hZEpzb24odmFsdWUsIHNsaWRlcyA9PiB7XG5cbiAgICAgIHRoaXMuc2xpZGVzID0gW107XG5cbiAgICAgIGlmICh0aGlzLmNhbnZhcykge1xuICAgICAgICB0aGlzLmNhbnZhcy5fb2JqZWN0cy5sZW5ndGggPSAwO1xuICAgICAgfVxuXG4gICAgICBzbGlkZXMuZm9yRWFjaChzbGlkZSA9PiB0aGlzLmFkZFNsaWRlKHNsaWRlKSk7XG5cbiAgICAgIHRoaXMucHJlbG9hZCgpO1xuICAgICAgdGhpcy5sYXp5TG9hZCgpO1xuICAgICAgY2FsbGJhY2soKTtcbiAgICB9LCgpID0+IHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJzbGlkZXMgbG9hZGluZyBmYWlsZWRcIilcbiAgICB9KTtcblxuXG4gIH0sXG4gIF9zZXRBY3RpdmVTbGlkZShzbGlkZSl7XG5cbiAgICB0aGlzLmZpcmUoXCJzbGlkZTpjaGFuZ2U6YmVnaW5cIiwge2NhbnZhczogdGhpcy5jYW52YXN9KTtcbiAgICBpZih0aGlzLmFjdGl2ZVNsaWRlKSB7XG4gICAgICBkZWxldGUgdGhpcy5hY3RpdmVTbGlkZS5jYW52YXMubWlycm9yU2xpZGU7XG4gICAgfVxuXG4gICAgdGhpcy5wcm9jZXNzaW5nID10cnVlO1xuICAgIGlmICh0aGlzLnVubG9hZFVuYWN0aXZlU2xpZGVzICYmIHRoaXMuY2FudmFzICYmIHRoaXMuYWN0aXZlU2xpZGUpIHtcbiAgICAgIGRlbGV0ZSB0aGlzLmFjdGl2ZVNsaWRlLmNhbnZhcztcbiAgICAgIHRoaXMuYWN0aXZlU2xpZGUuZmlyZShcImNhbnZhczpjaGFuZ2VkXCIse2NhbnZhczogbnVsbH0pO1xuICAgICAgdGhpcy5hY3RpdmVTbGlkZS5kYXRhID0gdGhpcy5jYW52YXMudG9PYmplY3QoKTtcbiAgICAgIHRoaXMuY2FudmFzLmNsZWFyKCk7XG4gICAgfVxuICAgIHRoaXMuYWN0aXZlU2xpZGUgPSBzbGlkZTtcbiAgICB0aGlzLmFjdGl2ZVNsaWRlLmNhbnZhcy5taXJyb3JTbGlkZSA9IHRoaXMuY2FudmFzO1xuXG5cblxuICAgIHRoaXMuY2FudmFzLnByb2Nlc3NpbmcgPSB0cnVlO1xuICAgIHRoaXMuY2FudmFzLnNldFNsaWRlKHRoaXMuYWN0aXZlU2xpZGUpO1xuICAgIHRoaXMuZmlyZShcInNsaWRlOmNoYW5nZWRcIiwge2NhbnZhczogdGhpcy5jYW52YXN9KTtcbiAgICB0aGlzLmNhbnZhcy5wcm9jZXNzaW5nID0gZmFsc2U7XG4gICAgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gIH0sXG4gIHNldEFjdGl2ZVNsaWRlOiBmdW5jdGlvbihzbGlkZUlkKXtcblxuICAgIGxldCBzbGlkZTtcblxuICAgIGlmKCF0aGlzLnNsaWRlcyl7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGlmKHNsaWRlSWQuY29uc3RydWN0b3IgPT09IE51bWJlcil7XG4gICAgICBzbGlkZSA9IHRoaXMuc2xpZGVzW3NsaWRlSWRdO1xuICAgIH1cbiAgICBlbHNlIGlmKHNsaWRlSWQuY29uc3RydWN0b3IgPT09IFN0cmluZyl7XG5cbiAgICB9ZWxzZXtcbiAgICAgIHNsaWRlID0gc2xpZGVJZDtcbiAgICB9XG5cbiAgICBpZih0aGlzLmFjdGl2ZVNsaWRlID09PSBzbGlkZSlyZXR1cm47XG5cblxuICAgIGlmKHNsaWRlLmNhbnZhcy5sb2FkZWQpe1xuICAgICAgdGhpcy5fc2V0QWN0aXZlU2xpZGUoc2xpZGUpO1xuICAgIH1lbHNle1xuICAgICAgc2xpZGUuY2FudmFzLm9uKFwibG9hZGluZzplbmRcIiwoKSA9PiB7XG4gICAgICAgIHRoaXMuX3NldEFjdGl2ZVNsaWRlKHNsaWRlKTtcbiAgICAgIH0pXG4gICAgfVxuXG5cbiAgfSxcbiAgdW5sb2FkVW5hY3RpdmVTbGlkZXM6IGZhbHNlLFxuICBsYXp5TG9hZEVuYWJsZWQ6IHRydWUsXG4gIGxhenlMb2FkOiBmdW5jdGlvbigpe1xuXG4gICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgaWYodGhpcy5sYXp5TG9hZEVuYWJsZWQpe1xuICAgICAgdGhpcy5zbGlkZXMuZm9yRWFjaChmdW5jdGlvbihzbGlkZSl7XG4gICAgICAgIGlmKCFzbGlkZS5jYW52YXMubG9hZGVkICYmICFzbGlkZS5jYW52YXMucHJvY2Vzc2luZyl7XG4gICAgICAgICAgc2xpZGUuY2FudmFzLmxvYWQoc2xpZGUub2JqZWN0LGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBzbGlkZS5maXJlKFwibG9hZGVkXCIpO1xuICAgICAgICAgICAgLy8gaWYoYXBwLmFjdGl2ZVNsaWRlID09PSBzbGlkZS5pZCl7XG4gICAgICAgICAgICAvLyAgIHRoaXMuc2V0QWN0aXZlU2xpZGUoc2xpZGUpO1xuICAgICAgICAgICAgLy8gfVxuXG4gICAgICAgICAgICBhcHAuZmlyZShcInNsaWRlOmxvYWRpbmc6ZW5kXCIsIHt0YXJnZXQ6IHRoaXN9KTtcblxuICAgICAgICAgICAgZm9yKHZhciBfcyBpbiBhcHAuc2xpZGVzKXtcbiAgICAgICAgICAgICAgaWYoIWFwcC5zbGlkZXNbX3NdLmNhbnZhcy5sb2FkZWQpe1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYXBwLmZpcmUoXCJsb2FkaW5nOmVuZFwiLCB7fSk7XG4gICAgICAgICAgfS5iaW5kKHNsaWRlKSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1lbHNle1xuICAgICAgYXBwLmZpcmUoXCJsb2FkaW5nOmVuZFwiLHt9KTtcbiAgICB9XG4gIH0sXG4gIGFkZFNsaWRlOiBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgIHZhciBzbGlkZSA9IG5ldyBmYWJyaWMuU2xpZGUodGhpcywgb3B0aW9ucyk7XG4gICAgdGhpcy5zbGlkZXMucHVzaChzbGlkZSk7XG4gICAgcmV0dXJuIHNsaWRlO1xuICB9LFxuICByZW1vdmVTbGlkZTogZnVuY3Rpb24gKHNsaWRlKSB7XG4gICAgdmFyIF9zID0gdGhpcy5zbGlkZXM7XG4gICAgdmFyIF9jdXJQb3MgPSBfcy5pbmRleE9mKHNsaWRlKTtcbiAgICBfcy5zcGxpY2UoX2N1clBvcywgMSk7XG5cbiAgICBpZiggc2xpZGUgPT09IHRoaXMuYWN0aXZlU2xpZGUgKXtcbiAgICAgIGRlbGV0ZSB0aGlzLmFjdGl2ZVNsaWRlIDtcbiAgICB9XG4gIH0sXG4gIC8qKlxuICAgKiBtb3ZlIHNsaWRlIHRvIGFub3RoZXIgcG9zaXRpb25cbiAgICogQHBhcmFtIHNsaWRlXG4gICAqIEBwYXJhbSBuZXdQb3NpdGlvblxuICAgKi9cbiAgbW92ZVNsaWRlOiBmdW5jdGlvbiAoc2xpZGUsbmV3UG9zaXRpb24pIHtcbiAgICB2YXIgX3MgPSB0aGlzLnNsaWRlcztcblxuICAgIHZhciBfY3VyUG9zID0gX3MuaW5kZXhPZihzbGlkZSk7XG4gICAgbmV3UG9zaXRpb24gPSBwYXJzZUludChuZXdQb3NpdGlvbik7XG5cbiAgICBpZiAoX2N1clBvcyA8IG5ld1Bvc2l0aW9uKSB7XG4gICAgICBfcy5zcGxpY2UoX2N1clBvcywgMSk7XG4gICAgICBfcy5zcGxpY2UobmV3UG9zaXRpb24sMCwgc2xpZGUpO1xuICAgIH0gZWxzZSB7XG4gICAgICBfcy5zcGxpY2UoX2N1clBvcywgMSk7XG4gICAgICBfcy5zcGxpY2UobmV3UG9zaXRpb24sIDAsIHNsaWRlKTtcbiAgICB9XG4gIH0sXG4gIC8qKlxuICAgKiByZXBsYWNlIHNsaWRlXG4gICAqIEBwYXJhbSBzbGlkZVxuICAgKiBAcGFyYW0gbmV3UG9zaXRpb24gLSBwb3NpdGlvbiBvZiB0aGUgc2Vjb25kIHNsaWRlXG4gICAqL1xuICByZXBsYWNlU2xpZGU6IGZ1bmN0aW9uIChzbGlkZSxuZXdQb3NpdGlvbikge1xuICAgIHZhciBfcyA9IHRoaXMuc2xpZGVzO1xuICAgIHZhciBfcmVwbGFjZWRTbGlkZSA9IF9zW25ld1Bvc2l0aW9uXTtcbiAgICB2YXIgX2N1clBvcyA9IF9zLmluZGV4T2Yoc2xpZGUpO1xuICAgIGlmIChfY3VyUG9zIDwgbmV3UG9zaXRpb24pIHtcbiAgICAgIF9zLnNwbGljZShuZXdQb3NpdGlvbiwgMSwgc2xpZGUpO1xuICAgICAgX3Muc3BsaWNlKF9jdXJQb3MsIDEsIF9yZXBsYWNlZFNsaWRlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgX3Muc3BsaWNlKF9jdXJQb3MsIDEsIF9yZXBsYWNlZFNsaWRlKTtcbiAgICAgIF9zLnNwbGljZShuZXdQb3NpdGlvbiwgMSwgc2xpZGUpO1xuICAgIH1cbiAgfSxcblxuICBwcmVsb2FkOiBmdW5jdGlvbigpe1xuICAgIGZvcih2YXIgaSBpbiB0aGlzLnNsaWRlcykge1xuICAgICAgdmFyIF9zbGlkZSA9IHRoaXMuc2xpZGVzW2ldO1xuICAgICAgLy8gX3NsaWRlLmNhbnZhcy5wcmVsb2FkKF9zbGlkZS5vYmplY3QsIGZ1bmN0aW9uICgpIHtcbiAgICAgIC8vICAgX3NsaWRlLmZpcmUoXCJtb2RpZmllZFwiKTtcbiAgICAgIC8vIH0pO1xuICAgIH1cbiAgfSxcblxuICBzZXRBY3RpdmVTbGlkZUJ5SW5kZXg6IGZ1bmN0aW9uKGluZGV4KXtcbiAgICB0aGlzLnNldEFjdGl2ZVNsaWRlKHRoaXMuc2xpZGVzW2luZGV4XSlcbiAgfSxcbiAgc2V0QWN0aXZlU2xpZGVCeUlkOiBmdW5jdGlvbihpZCl7XG4gICAgdGhpcy5zZXRBY3RpdmVTbGlkZSggIGZhYnJpYy51dGlsLm9iamVjdC5maW5kV2hlcmUodGhpcy5zbGlkZXMse2lkOiBpZH0pKTtcbiAgfSxcbiAgZHVwbGljYXRlU2xpZGU6IGZ1bmN0aW9uIChzbGlkZURhdGEpIHtcbiAgICBzbGlkZURhdGEgPSBzbGlkZURhdGEuY2FudmFzLnRvT2JqZWN0KCk7XG4gICAgdmFyIF9zbGlkZSA9IHRoaXMuYWRkU2xpZGUoc2xpZGVEYXRhKTtcbiAgICBfc2xpZGUuY2FudmFzLmxvYWQoX3NsaWRlLm9iamVjdCk7XG4gIH0sXG5cbiAgbmV4dFNsaWRlOiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGkgPSB0aGlzLnNsaWRlcy5pbmRleE9mKHRoaXMuYWN0aXZlU2xpZGUpO1xuICAgIGlmIChpIDwgdGhpcy5zbGlkZXMubGVuZ3RoIC0gMSkge1xuICAgICAgdGhpcy5zZXRBY3RpdmVTbGlkZShpICsgMSk7XG4gICAgfVxuICB9LFxuICBwcmV2U2xpZGU6IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgaSA9IHRoaXMuc2xpZGVzLmluZGV4T2YodGhpcy5hY3RpdmVTbGlkZSk7XG4gICAgaWYgKGkgPiAwKSB7XG4gICAgICB0aGlzLnNldEFjdGl2ZVNsaWRlKGkgLSAxKTtcbiAgICB9XG4gIH0sXG4gIGdvdG9TbGlkZTogZnVuY3Rpb24gKHNsaWRlKSB7XG4gICAgdGhpcy5zZXRBY3RpdmVTbGlkZShzbGlkZSAtIDEpO1xuICB9LFxuICBuZXh0U2xpZGVBdmFpbGFibGU6IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgaSA9IHRoaXMuc2xpZGVzLmluZGV4T2YodGhpcy5hY3RpdmVTbGlkZSk7XG4gICAgcmV0dXJuIGkgPCB0aGlzLnNsaWRlcy5sZW5ndGggLSAxXG4gIH0sXG4gIHByZXZTbGlkZUF2YWlsYWJsZTogZnVuY3Rpb24gKCkge1xuICAgIHZhciBpID0gdGhpcy5zbGlkZXMuaW5kZXhPZih0aGlzLmFjdGl2ZVNsaWRlKTtcbiAgICByZXR1cm4gaSA+IDBcbiAgfSxcbiAgY3JlYXRlU2xpZGVzTGlzdDogZnVuY3Rpb24gKCRjb250YWluZXIpIHtcbiAgICBsZXQgJHNsaWRlTGlzdCA9IHRoaXMuJHNsaWRlc0xpc3QgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJzbGlkZXMtbGlzdFwiKTtcbiAgICBsZXQgJHNsaWRlTGlzdElubmVyID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwic2xpZGVzLWxpc3QtaW5uZXJcIik7XG4gICAgJHNsaWRlTGlzdC5hcHBlbmQoJHNsaWRlTGlzdElubmVyKTtcblxuICAgICRjb250YWluZXIuYXBwZW5kKHRoaXMuJHNsaWRlc0xpc3QpO1xuXG5cbiAgICB0aGlzLnNsaWRlcy5mb3JFYWNoKHNsaWRlID0+IHtcbiAgICAgIGxldCAkZWxlbWVudCA9IHNsaWRlLmNhbnZhcy5sb3dlckNhbnZhc0VsO1xuICAgICAgJGVsZW1lbnQuc2V0QXR0cmlidXRlKFwiaGVpZ2h0XCIsMTQwKTtcbiAgICAgIGZhYnJpYy51dGlsLmNyZWF0ZVRodW1iKHNsaWRlLCRlbGVtZW50KTtcblxuICAgICAgbGV0ICRzbGlkZSA9ICQoXCI8ZGl2PlwiKVxuICAgICAgICAuYWRkQ2xhc3MoXCJzbGlkZVwiKVxuICAgICAgICAuY2xpY2soKCkgPT4gdGhpcy5zZXRBY3RpdmVTbGlkZShzbGlkZSkpXG4gICAgICAgIC5hcHBlbmQoJGVsZW1lbnQpXG4gICAgICAgIC5hcHBlbmQoJChcIjxzcGFuPlwiKS5odG1sKHNsaWRlLmNhbnZhcy50aXRsZSkpO1xuXG5cbiAgICAgIGlmKHNsaWRlLmNhbnZhcy5kZXNjcmlwdGlvbil7XG4gICAgICAgICRzbGlkZS5hdHRyKFwidGl0bGVcIixzbGlkZS5jYW52YXMuZGVzY3JpcHRpb24pXG4gICAgICB9XG5cbiAgICAgIHNsaWRlLm9uKFwibW9kaWZpZWRcIixmdW5jdGlvbigpe1xuICAgICAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICAgIH0pO1xuICAgICAgJHNsaWRlTGlzdElubmVyLmFwcGVuZCgkc2xpZGUpO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGxpc3Q6ICRzbGlkZUxpc3RcbiAgICB9XG5cbiAgICAvL3RoaXMuY2FudmFzLm9uKCBcImRpbWVuc2lvbnM6bW9kaWZpZWRcIiAsdGhpcy51cGRhdGVUaHVtYnMuYmluZCh0aGlzKSlcbiAgICAvL3RoaXMudXBkYXRlVGh1bWJzKCk7XG4gIH0sXG5cbiAgdXBkYXRlVGh1bWJzOiBmdW5jdGlvbigpe1xuICAgIHRoaXMuc2xpZGVzLmZvckVhY2goc2xpZGUgPT4ge1xuICAgICAgc2xpZGUuY2FudmFzLnNldERpbWVuc2lvbnMoe3dpZHRoOiB0aGlzLmNhbnZhcy53aWR0aCwgaGVpZ2h0OiB0aGlzLmNhbnZhcy5oZWlnaHR9KVxuICAgIH0pXG4gIH0sXG59KTtcblxuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUsIHtcbiAgdGl0bGU6IFwiTmV3IFNsaWRlXCIsXG4gIC8qKlxuICAgKiBDb3B5IHRoZSBjb250ZW50IG9mIGFjdGl2ZSBzbGlkZSB0byBtYWluIGNhbnZhcy5cbiAgICogQHBhcmFtIHNsaWRlXG4gICAqL1xuICBzZXRTbGlkZTogZnVuY3Rpb24gKHNsaWRlKSB7XG5cbiAgICB0aGlzLmxvYWRlZCA9IGZhbHNlO1xuICAgIHRoaXMuX29iamVjdHMgPSBbXTtcblxuICAgIHRoaXMuc2V0KHNsaWRlLmNhbnZhcy50b09iamVjdFN5bmMoKSk7XG4gICAgdGhpcy5zbGlkZSA9IHNsaWRlO1xuICAgIHZhciBzYyA9IHNsaWRlLmNhbnZhcztcblxuICAgIHNjLl9vYmplY3RzID0gdGhpcy5fb2JqZWN0cztcblxuICAgIHRoaXMuZGlzY2FyZEFjdGl2ZUdyb3VwKCk7XG4gICAgdGhpcy5kaXNjYXJkQWN0aXZlT2JqZWN0KCk7XG4gICAgLypcbiAgICAvLyB0aGlzLnNsaWRlV2lkdGggPSBzYy5zbGlkZVdpZHRoO1xuICAgIC8vIHRoaXMuc2xpZGVIZWlnaHQgPSBzYy5zbGlkZUhlaWdodDtcbiAgICB0aGlzLnNldE9yaWdpbmFsU2l6ZSh7d2lkdGg6IHNjLm9yaWdpbmFsV2lkdGggfHwgc2Mud2lkdGgsIGhlaWdodDogc2Mub3JpZ2luYWxIZWlnaHQgfHwgc2MuaGVpZ2h0fSlcbiAgICB0aGlzLmJhY2tncm91bmRJbWFnZSA9IHNjLmJhY2tncm91bmRJbWFnZTtcbiAgICB0aGlzLmJhY2tncm91bmRDb2xvciA9IHNjLmJhY2tncm91bmRDb2xvcjtcblxuICAgIGlmKHRoaXMucmVzaXphYmxlKSB7XG4gICAgICB0aGlzLm9yaWdpbmFsV2lkdGggID0gc2Mub3JpZ2luYWxXaWR0aDtcbiAgICAgIHRoaXMub3JpZ2luYWxIZWlnaHQgID0gc2Mub3JpZ2luYWxIZWlnaHQgO1xuICAgIH1lbHNle1xuICAgICAgdGhpcy5zZXRXaWR0aCgoc2Mub3JpZ2luYWxXaWR0aCB8fCBzYy53aWR0aCkqIHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bMF0pO1xuICAgICAgdGhpcy5zZXRIZWlnaHQoKHNjLm9yaWdpbmFsSGVpZ2h0IHx8IHNjLmhlaWdodCkgICogdGhpcy52aWV3cG9ydFRyYW5zZm9ybVswXSk7XG4gICAgfSovXG4gICAgdGhpcy5fb25SZXNpemUoKTtcbiAgIC8vIHRoaXMuYWN0aXZlQXJlYSA9IHNjLmFjdGl2ZUFyZWE7XG4gICAgLy90aGlzLm9yaWdpbmFsU2xpZGUgPSBzYztcblxuICAgLy8gdGhpcy50ZW1wbGF0ZSA9IHNjLnRlbXBsYXRlO1xuICAvLyAgdGhpcy5vZmZzZXRzID0gc2Mub2Zmc2V0cztcbiAgICAvLyB0aGlzLl9vYmplY3RzID0gW107XG4gICAgLy8gdGhpcy5sYXllcnMgPSBzYy5sYXllcnM7XG5cbiAgIC8qIGlmKHRoaXMuYmFja2dyb3VuZEltYWdlKXtcbiAgICAgIHRoaXMuYmFja2dyb3VuZEltYWdlLmNhbnZhcyA9IHRoaXM7XG4gICAgfSovXG4gICAgLy90b2RvXG4gICAgLy8gaWYodGhpcy5fYmFja2dyb3VuZExheWVyKSB7XG4gICAgLy8gICBmb3IgKHZhciBpIGluIHRoaXMuX2JhY2tncm91bmRMYXllcikge1xuICAgIC8vICAgICB0aGlzLl9iYWNrZ3JvdW5kTGF5ZXJbaV0uY2FudmFzID0gdGhpcztcbiAgICAvLyAgICAgdGhpcy5fYmFja2dyb3VuZExheWVyW2ldLnNldENvb3JkcygpO1xuICAgIC8vICAgfVxuICAgIC8vICAgdGhpcy5zZXRBY3RpdmVBcmVhKHRydWUpO1xuICAgIC8vIH1jZCBmaWVyXG5cbiAgICAvKmZvcih2YXIgbGF5ZXJOYW1lIGluIHNjLmxheWVycykge1xuICAgICAgdGhpcy5sYXllcnNbbGF5ZXJOYW1lXS5vYmplY3RzID0gW107XG4gICAgfSovXG4gICAvLyB0aGlzLl9vYmplY3RzID0gdGhpcy5fb2JqZWN0cztcblxuICAgIC8qaWYoc2MubGF5ZXJzKSB7XG4gICAgICBmb3IodmFyIGxheWVyTmFtZSBpbiBzYy5sYXllcnMpe1xuICAgICAgICBmb3IgKHZhciBpIGluIHNjLmxheWVyc1tsYXllck5hbWVdLm9iamVjdHMpIHtcbiAgICAgICAgICB0aGlzLmFkZChzYy5sYXllcnNbbGF5ZXJOYW1lXS5vYmplY3RzW2ldKTtcbiAgICAgICAgfVxuICAgICAgICBzYy5sYXllcnNbbGF5ZXJOYW1lXS5vYmplY3RzID0gdGhpcy5sYXllcnNbbGF5ZXJOYW1lXS5vYmplY3RzO1xuICAgICAgfVxuICAgICAgc2MuX29iamVjdHMgPSB0aGlzLl9vYmplY3RzO1xuICAgIH1lbHNleyovXG5cbiAgICAvKnRoaXMuX29iamVjdHMgPSBbXTtcbiAgICBmb3IgKGxldCBpIGluIHNjLl9vYmplY3RzKSB7XG4gICAgICB0aGlzLmFkZChzYy5fb2JqZWN0c1tpXSk7XG4gICAgfSovXG4gICAvLyB9XG5cbiAgICB0aGlzLmxvYWRlZCA9IHRydWU7XG4gICAgdGhpcy5maXJlKCdjaGFuZ2VkJywge3RhcmdldDogc2N9KVxuXG5cbiAgfSxcbiAgdW5pcXVlOiBmYWxzZSxcbiAgcmVxdWlyZWQ6IGZhbHNlLFxuICBzdGF0ZVByb3BlcnRpZXM6IFtcInVuaXF1ZVwiLFwicmVxdWlyZWRcIl0sXG4gIHJlbW92ZVNsaWRlOiBmdW5jdGlvbigpe1xuICAgIHRoaXMucHJvamVjdC5yZW1vdmVTbGlkZSh0aGlzKVxuICB9LFxuICBkdXBsaWNhdGVTbGlkZTogZnVuY3Rpb24oKXtcbiAgICB0aGlzLnByb2plY3QuZHVwbGljYXRlU2xpZGUodGhpcylcbiAgfSxcblxuICBldmVudExpc3RlbmVyczogZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZEFycmF5c09iamVjdChmYWJyaWMuU2xpZGVDYW52YXMucHJvdG90eXBlLmV2ZW50TGlzdGVuZXJzLCB7XG4gICAgXCJtb2RpZmllZFwiIDogZnVuY3Rpb24oZSl7XG4gICAgICBpZih0aGlzLnNsaWRlKXtcbiAgICAgICAgdGhpcy5zbGlkZS5jYW52YXMuc2V0KGUuc3RhdGVzLm1vZGlmaWVkKTtcbiAgICAgICAgdGhpcy5zbGlkZS5maXJlKFwibW9kaWZpZWRcIik7XG4gICAgICB9XG4gICAgfSxcbiAgICBcIm9iamVjdDptb2RpZmllZFwiIDogZnVuY3Rpb24oKXtcbiAgICAgIGlmKHRoaXMuc2xpZGUpe1xuICAgICAgICB0aGlzLnNsaWRlLmZpcmUoXCJtb2RpZmllZFwiKTtcbiAgICAgIH1cbiAgICB9XG4gIH0pXG59KTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvY29yZS9hcHBsaWNhdGlvbi5zbGlkZXMuanMiLCIvKipcbiAqICMgUHJvdG90eXBlc1xuXG4gUHJvdG90eXBlcyBhbGxvd3MgdG8gZGVmaW5lICoqcHJvdG90eXBlcyoqIHByb3BlcnR5IGluIEFwcGxpY2F0aW9uIGNvbmZpZ3VyYXRpb24uXG5cbiBgYGBqYXZhc2NyaXB0XG4gQXBwbGljYXRpb24gKHtcbiAgcHJvdG90eXBlczoge1xuICAgIENsYXNzTmFtZTogb3B0aW9uc1xuICB9XG4gfSlcbiBgYGBcblxuIElmIHByb3RvdHlwZSBpcyBkZWZpbmVkIGV2ZXJ5IG5ldyBPYmplY3QgY3JlYXRlZCBieSBhcHBsaWNhdGlvbiB3aWxsIGhhdmUgdGhpcyBwcm9wZXJ0aWVzIGJ5IGRlZmF1bHQuXG5cbiBgYGBqYXZhc2NyaXB0XG4gICBOZXdDbGFzczoge1xuICAgICRzdXBlcjogXCJQYXJlbnRDbGFzc1wiLFxuICAgIHR5cGU6IFwibmV3LWNsYXNzXCIsXG4gICAgXFwvKm90aGVyIHByb3BlcnRpZXMgYW5kIG1ldGhvZHMqXFwvXG4gICB9XG4gIGBgYFxuXG4gaWYgcHJvcGVydHkgKip0eXBlKiogb2YgT2JqZWN0IGNsYXNzIGlzIGRlZmluZWQgdGhlbiBldmVyeSBvYmplY3QgYmUgZGVmYXVsdCB3aWxsIGhhdmUgdGhpcyB0eXBlLlxuXG4gYGBgamF2YXNjcmlwdFxuICAgT2JqZWN0OiB7XG4gICAgdHlwZTogXCJyZWN0YW5nbGVcIlxuICAgfVxuIC4uLlxuIC8vcmVjdGFuZ2xlIHdpbGwgYmUgY3JlYXRlZFxuIGZhYnJpYy5jcmVhdGVPYmplY3Qoe3dpZHRoOjEwMCwgaGVpZ2h0OiAxMDB9KVxuIGBgYFxuKi9cblxuXG5cblxuXG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLkFwcGxpY2F0aW9uLnByb3RvdHlwZSwge1xuICBvcHRpb25zT3JkZXI6IChmdW5jdGlvbigpe1xuICAgIHZhciBvbyA9IGZhYnJpYy5BcHBsaWNhdGlvbi5wcm90b3R5cGUub3B0aW9uc09yZGVyO1xuICAgIG9vLnNwbGljZShvby5pbmRleE9mKFwiY2FudmFzQ29udGFpbmVyXCIpLDAsXCJwcm90b3R5cGVzXCIpO1xuICAgIHJldHVybiBvbztcbiAgfSkoKSxcbiAgZ2V0RGVmYXVsdFByb3BlcnRpZXM6IGZ1bmN0aW9uKHByb3RvKXtcbiAgICBpZighdGhpcy5wcm90b3R5cGVzKXJldHVybjtcblxuICAgIHZhciBrbGFzc25hbWUgPSBmYWJyaWMudXRpbC5zdHJpbmcuY2FwaXRhbGl6ZShmYWJyaWMudXRpbC5zdHJpbmcuY2FtZWxpemUocHJvdG8udHlwZSksdHJ1ZSk7XG5cbiAgICB2YXIgX3Byb3RvUHJvcGVydGllcyA9IHByb3RvLl9fcHJvdG9fXyAmJiBwcm90by5fX3Byb3RvX18udHlwZSAmJiB0aGlzLmdldERlZmF1bHRQcm9wZXJ0aWVzKHByb3RvLl9fcHJvdG9fXykgfHwge307XG4gICAgdmFyIF9kZWZhdWx0UHJvcGVydGllcyA9IGZhYnJpYy51dGlsLm9iamVjdC5jbG9uZSh0aGlzLnByb3RvdHlwZXNba2xhc3NuYW1lXSk7XG5cbiAgICBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKF9wcm90b1Byb3BlcnRpZXMsX2RlZmF1bHRQcm9wZXJ0aWVzKTtcblxuICAgIHJldHVybiBfcHJvdG9Qcm9wZXJ0aWVzO1xuICB9LFxuICAvKipcbiAgICogZGVmYXVsdCBwcm90b3R5cGVzIHByb3BlcnRlcyBmb3Igb2JqZWN0c1xuICAgKi9cbiAgcHJvdG90eXBlczoge1xuICAgIE9iamVjdDoge1xuICAgICAgaW5jbHVkZURlZmF1bHRWYWx1ZXM6IGZhbHNlXG4gICAgfSxcbiAgICBDYW52YXM6IHtcbiAgICAgIGluY2x1ZGVEZWZhdWx0VmFsdWVzOiBmYWxzZVxuICAgIH1cbiAgfSxcbiAgc2V0VXRpbHM6IGZ1bmN0aW9uICh1dGlsc09wdGlvbnMpIHtcblxuICAgIGlmKCF1dGlsc09wdGlvbnMpe1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKHRoaXMudXRpbCB8fCB7fSx1dGlsc09wdGlvbnMpO1xuXG4gICAgaWYgKHRoaXMub3B0aW9uc1sndXRpbCddKSB7XG4gICAgICBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy51dGlsLCB0aGlzLm9wdGlvbnNbJ3V0aWwnXSk7XG4gICAgfVxuICAgIGlmICh0aGlzLm9wdGlvbnNbJ2ZhYnJpYyddKSB7XG4gICAgICBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYywgdGhpcy5vcHRpb25zWydmYWJyaWMnXSk7XG4gICAgfVxuICAgIGRlbGV0ZSB0aGlzLm9wdGlvbnNbJ2ZhYnJpYyddO1xuICAgIGRlbGV0ZSB0aGlzLm9wdGlvbnNbJ3V0aWwnXTtcbiAgfSxcbiAgc2V0UHJvdG90eXBlczogZnVuY3Rpb24gKHByb3RvdHlwZXMpIHtcblxuICAgIHZhciBfcHJvdG90eXBlcyA9IGZhYnJpYy51dGlsLm9iamVjdC5kZWVwRXh0ZW5kKHt9LCB0aGlzLnByb3RvdHlwZXMgLHByb3RvdHlwZXMpO1xuXG4gICAgdGhpcy5wcm90b3R5cGVzID0gX3Byb3RvdHlwZXM7XG5cbiAgICBpZihfcHJvdG90eXBlcy5ldmVudExpc3RlbmVycyl7XG4gICAgICBfcHJvdG90eXBlcy5ldmVudExpc3RlbmVycy4kZXh0ZW5kID0gJ2FycmF5JztcbiAgICB9XG5cbiAgICBmb3IgKHZhciBrbGFzc05hbWUgaW4gX3Byb3RvdHlwZXMpIHtcbiAgICAgIHZhciBfcHJvdG8gPSBfcHJvdG90eXBlc1trbGFzc05hbWVdO1xuXG4gICAgICBmb3IgKHZhciBqIGluIF9wcm90bykge1xuICAgICAgICBpZiAoX3Byb3RvW2pdICYmIF9wcm90b1tqXVtcIiRleHRlbmRcIl0pIHtcbiAgICAgICAgICB2YXIgX2V4dGVuZCA9IF9wcm90b1tqXVtcIiRleHRlbmRcIl07XG4gICAgICAgICAgaWYoIF9leHRlbmQgPT0gXCJhcnJheVwiKXtcbiAgICAgICAgICAgIF9wcm90b1tqXSA9IGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmRBcnJheXNPYmplY3QoZmFicmljW2tsYXNzTmFtZV0ucHJvdG90eXBlW2pdLF9wcm90b1tqXSk7XG4gICAgICAgICAgfSBlbHNlIGlmKCBfZXh0ZW5kID09IFwiZGVlcFwiKXtcbiAgICAgICAgICAgIF9wcm90b1tqXSA9IGZhYnJpYy51dGlsLm9iamVjdC5kZWVwRXh0ZW5kKGZhYnJpY1trbGFzc05hbWVdLnByb3RvdHlwZVtqXSxfcHJvdG9bal0pO1xuICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgX3Byb3RvW2pdID0gZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWNba2xhc3NOYW1lXS5wcm90b3R5cGVbal0sX3Byb3RvW2pdKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZGVsZXRlIF9wcm90b1tqXVtcIiRleHRlbmRcIl07XG4gICAgICAgIH1cbiAgICAgIH1cblxuXG4gICAgICBpZihfcHJvdG9bXCIkc3VwZXJcIl0pe1xuICAgICAgICB2YXIgX3N1cGVya2xhc3MgPSBmYWJyaWNbX3Byb3RvW1wiJHN1cGVyXCJdIHx8IGtsYXNzTmFtZV0gO1xuICAgICAgICBkZWxldGUgX3Byb3RvW1wiJHN1cGVyXCJdO1xuXG4gICAgICAgIHZhciBfZnJvbU9iamVjdCA9IF9wcm90by5mcm9tT2JqZWN0IHx8IF9zdXBlcmtsYXNzLmZyb21PYmplY3QgO1xuICAgICAgICBkZWxldGUgX3Byb3RvLmZyb21PYmplY3Q7XG4gICAgICAgIHZhciBfa2xhc3MgPSBmYWJyaWNba2xhc3NOYW1lXSA9IGZhYnJpYy51dGlsLmNyZWF0ZUNsYXNzKF9zdXBlcmtsYXNzLCBfcHJvdG8pO1xuICAgICAgICBfa2xhc3MuZnJvbU9iamVjdCA9IF9mcm9tT2JqZWN0LmJpbmQoX2tsYXNzKTtcbiAgICAgIH1cblxuICAgIC8vICAgaWYgKGtsYXNzTmFtZS5hY3Rpb25zICYmIF9wcm90by5hY3Rpb25zLmNvbnN0cnVjdG9yID09IEZ1bmN0aW9uKSB7XG4gICAgLy8gICAgIGZhYnJpY1trbGFzc05hbWVdLnByb3RvdHlwZS5hY3Rpb25zID0gX3Byb3RvLmFjdGlvbnMuY2FsbChmYWJyaWNba2xhc3NOYW1lXS5wcm90b3R5cGUpXG4gICAgLy8gICB9XG4gICAgfVxuXG4gICAgaWYgKF9wcm90b3R5cGVzLkFwcGxpY2F0aW9uKSB7XG4gICAgICBmYWJyaWMudXRpbC5vYmplY3QuZGVlcEV4dGVuZCh0aGlzLCBfcHJvdG90eXBlcy5BcHBsaWNhdGlvbik7XG4gICAgfVxuXG4gICAgLy8gZGVsZXRlIHRoaXMub3B0aW9uc1sncHJvdG90eXBlcyddO1xuXG4gICAgaWYgKHRoaXMuYWN0aW9ucyAmJiB0aGlzLmFjdGlvbnMuY29uc3RydWN0b3IgPT0gRnVuY3Rpb24pIHtcbiAgICAgIHRoaXMuYWN0aW9ucyA9IHRoaXMuYWN0aW9ucy5jYWxsKHRoaXMpXG4gICAgfVxuICB9LFxuICBldmVudExpc3RlbmVyczogZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZEFycmF5c09iamVjdChmYWJyaWMuQXBwbGljYXRpb24ucHJvdG90eXBlLmV2ZW50TGlzdGVuZXJzLCB7XG4gICAgXCJlbnRpdHk6Y3JlYXRlZFwiOiBmdW5jdGlvbiAoZSkge1xuICAgICAgdmFyIHRhcmdldCA9IGUudGFyZ2V0O1xuICAgICAgdGFyZ2V0LmFwcGxpY2F0aW9uID0gdGhpcztcblxuXG4gICAgICBpZighdGFyZ2V0LmRpc2FibGVEZWZhdWx0UHJvcGVydGllcyl7XG5cbiAgICAgICAgZmFicmljLnV0aWwub2JqZWN0LmRlZmF1bHRzKGUub3B0aW9ucywgdGhpcy5nZXREZWZhdWx0UHJvcGVydGllcyh0YXJnZXQsIGUub3B0aW9ucykpO1xuXG4gICAgICAgIGZvciAodmFyIGtleSBpbiBlLm9wdGlvbnMpIHtcbiAgICAgICAgICB2YXIgdmFsdWUgPSBlLm9wdGlvbnNba2V5XTtcbiAgICAgICAgICBpZiAoa2V5WzBdID09IFwiK1wiKSB7XG4gICAgICAgICAgICB2YXIgX2tleSA9IGtleS5zdWJzdHIoMSk7XG4gICAgICAgICAgICB2YXIgX2FyciA9IHRhcmdldC5nZXQoX2tleSk7XG4gICAgICAgICAgICBpZiAoX2FyciBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICAgICAgICAgIF9hcnIgPSBfYXJyLnNsaWNlKCkuY29uY2F0KHZhbHVlKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIF9hcnIgPSBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKHt9LCBfYXJyLCB2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlLm9wdGlvbnNbX2tleV0gPSBfYXJyO1xuICAgICAgICAgICAgZGVsZXRlIGUub3B0aW9uc1trZXldO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBkZWxldGUgZS5vcHRpb25zLnR5cGU7XG4gICAgICBkZWxldGUgZS5vcHRpb25zLmFwcGxpY2F0aW9uO1xuICAgIH1cbiAgfSlcbn0pO1xuXG5cblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvY29yZS9hcHBsaWNhdGlvbi5wcm90b3R5cGVzLmpzIiwiJ3VzZSBzdHJpY3QnO1xuXG52YXIgaXNWTUwgPSBmdW5jdGlvbigpIHsgcmV0dXJuIHR5cGVvZiBHX3ZtbENhbnZhc01hbmFnZXIgIT09ICd1bmRlZmluZWQnOyB9XG5cbi8vd2VpcmQgc3R1ZmZcbi8vIGRlbGV0ZSBmYWJyaWMuUmVjdC5wcm90b3R5cGUudG9PYmplY3Q7XG4vLyBmYWJyaWMuUmVjdC5wcm90b3R5cGUuc3RvcmVQcm9wZXJ0aWVzID0gW1wiKlwiLFwicnhcIixcInJ5XCJdO1xuXG5mYWJyaWMuSU5DTFVERV9BTEwgPSBcIipcIjtcblxudmFyIF90b09iamVjdF9vdmVyd3JpdHRlbiA9IGZhYnJpYy5PYmplY3QucHJvdG90eXBlLnRvT2JqZWN0O1xuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuT2JqZWN0LnByb3RvdHlwZSwge1xuICBzdG9yZVByb3BlcnRpZXM6IFsnKiddLFxuICBldmVudExpc3RlbmVyczoge30sXG4gIHRvT2JqZWN0OiBmdW5jdGlvbiAocHJvcGVydGllc1RvSW5jbHVkZSkge1xuICAgIGlmIChwcm9wZXJ0aWVzVG9JbmNsdWRlID09IGZhYnJpYy5JTkNMVURFX0FMTCkge1xuICAgICAgcHJvcGVydGllc1RvSW5jbHVkZSA9IFtmYWJyaWMuSU5DTFVERV9BTExdO1xuICAgIH1cblxuICAgIHByb3BlcnRpZXNUb0luY2x1ZGUgPSBwcm9wZXJ0aWVzVG9JbmNsdWRlIHx8IFtdO1xuICAgIHByb3BlcnRpZXNUb0luY2x1ZGUgPSBwcm9wZXJ0aWVzVG9JbmNsdWRlLmNvbmNhdCh0aGlzLnN0b3JlUHJvcGVydGllcyk7XG5cblxuICAgIHZhciBvYmogPSBfdG9PYmplY3Rfb3ZlcndyaXR0ZW4uY2FsbCh0aGlzLCBwcm9wZXJ0aWVzVG9JbmNsdWRlKTtcbiAgICBpZiAocHJvcGVydGllc1RvSW5jbHVkZVswXSAhPT0gZmFicmljLklOQ0xVREVfQUxMKSB7XG4gICAgICBpZiAoIXRoaXMuaW5jbHVkZURlZmF1bHRWYWx1ZXMpIHtcbiAgICAgICAgdGhpcy5fcmVtb3ZlRGVmYXVsdFZhbHVlcyhvYmopO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICh0aGlzLnN0b3JlUHJvcGVydGllcy5pbmRleE9mKFwiKlwiKSA9PSAtMSkge1xuICAgICAgZm9yICh2YXIgaSBpbiBvYmopIHtcbiAgICAgICAgaWYgKHRoaXMuc3RvcmVQcm9wZXJ0aWVzLmluZGV4T2YoaSkgPT0gLTEpIHtcbiAgICAgICAgICBkZWxldGUgb2JqW2ldO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5maXJlKFwiYmVmb3JlOm9iamVjdFwiLCB7b2JqZWN0OiBvYmp9KTtcbiAgICByZXR1cm4gb2JqO1xuICB9LFxuICAvKipcbiAgICogU2V0cyBvYmplY3QncyBwcm9wZXJ0aWVzIGZyb20gb3B0aW9uc1xuICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdIE9wdGlvbnMgb2JqZWN0XG4gICAqL1xuICBzZXRPcHRpb25zOiBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgIHRoaXMuX3NldE9iamVjdChvcHRpb25zKTtcbiAgICAvLyB0aGlzLl9pbml0R3JhZGllbnQob3B0aW9ucyk7XG4gICAgLy8gdGhpcy5faW5pdFBhdHRlcm4ob3B0aW9ucyk7XG4gICAgLy8gdGhpcy5faW5pdENsaXBwaW5nKG9wdGlvbnMpO1xuICB9LFxuICBfaW5pdEVudGl0eTogZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICBpZihvcHRpb25zLmNhbnZhcyAmJiAhb3B0aW9ucy5hcHBsaWNhdGlvbil7XG4gICAgICBvcHRpb25zLmFwcGxpY2F0aW9uID0gb3B0aW9ucy5jYW52YXMuYXBwbGljYXRpb247XG4gICAgfVxuICAgIG9wdGlvbnMuYXBwbGljYXRpb24gJiYgb3B0aW9ucy5hcHBsaWNhdGlvbi5maXJlKFwiZW50aXR5OmNyZWF0ZWRcIiwge3RhcmdldDogdGhpcywgb3B0aW9uczogb3B0aW9uc30pO1xuICB9LFxuICBpbml0aWFsaXplOiBmdW5jdGlvbiAob3B0aW9ucywgY2FsbGJhY2spIHtcbiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgICB0aGlzLl9pbml0RW50aXR5KG9wdGlvbnMpO1xuICAgIC8vIGlmKG9wdGlvbnMud2hvbGVDb29yZGluYXRlcyl7XG4gICAgLy8gICB2YXIgY29vcmRpbmF0ZXMgPSBbXCJsZWZ0XCIsXCJ0b3BcIixcIndpZHRoXCIsXCJoZWlnaHRcIl07XG4gICAgLy8gICBmb3IodmFyIGkgaW4gY29vcmRpbmF0ZXMpe1xuICAgIC8vICAgICBpZihvcHRpb25zW2Nvb3JkaW5hdGVzW2ldXSl7XG4gICAgLy8gICAgICAgb3B0aW9uc1tjb29yZGluYXRlc1tpXV0gPSBNYXRoLnJvdW5kKG9wdGlvbnNbY29vcmRpbmF0ZXNbaV1dKTtcbiAgICAvLyAgICAgfVxuICAgIC8vICAgfVxuICAgIC8vIH1cbiAgICB2YXIgX3NlbGYgPSB0aGlzO1xuICAgIHRoaXMuX3NldE9iamVjdChvcHRpb25zLCBmdW5jdGlvbiAoKSB7XG4gICAgICBfc2VsZi5sb2FkZWQgPSB0cnVlO1xuICAgICAgX3NlbGYuZmlyZShcImxvYWRlZFwiKTtcbiAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKF9zZWxmKTtcbiAgICB9KTtcbiAgfSxcbiAgYWRkOiBmdW5jdGlvbiAoY2FudmFzKSB7XG4gICAgY2FudmFzLmFkZCh0aGlzKTtcbiAgfSxcbiAgc2V0OiBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkge1xuICAgIGlmICh0eXBlb2Yga2V5ID09PSAnb2JqZWN0Jykge1xuICAgICAgdGhpcy5fc2V0T2JqZWN0KGtleSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgaWYgKGtleVswXSA9PSBcIiZcIikge1xuICAgICAgICBrZXkgPSBrZXkuc3Vic3RyKDEpO1xuICAgICAgICB0aGlzLl9zZXQoa2V5LCB2YWx1ZSh0aGlzLmdldChrZXkpKSk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgdGhpcy5fc2V0KGtleSwgdmFsdWUpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfVxufSk7XG5cblxuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5PYmplY3QucHJvdG90eXBlLCB7XG4gIGhhc0JvdW5kc0NvbnRyb2xzOiB0cnVlLFxuICBzdHJva2U6IFwidHJhbnNwYXJlbnRcIixcbiAgb25Ub3A6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5jYW52YXMuX29iamVjdHMuaW5kZXhPZih0aGlzKSA9PSB0aGlzLmNhbnZhcy5fb2JqZWN0cy5sZW5ndGggLSAxO1xuICB9LFxuICBmbG9wOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5mbGlwWSA9ICF0aGlzLmZsaXBZO1xuICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICB9LFxuICBmbGlwOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5mbGlwWCA9ICF0aGlzLmZsaXBYO1xuICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICB9LFxuICBvbkJvdHRvbTogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLmNhbnZhcy5fb2JqZWN0cy5pbmRleE9mKHRoaXMpID09IDA7XG4gIH0sXG4gIGR1cGxpY2F0ZTogZnVuY3Rpb24oKSB7XG4gICAgdmFyIF9vYmplY3QgPSB0aGlzLnRvT2JqZWN0KGZhYnJpYy5JTkNMVURFX0FMTCk7XG4gICAgX29iamVjdC5hY3RpdmUgPSB0cnVlO1xuICAgIF9vYmplY3QubGVmdCs9MTA7XG4gICAgX29iamVjdC50b3ArPTEwO1xuICAgIHZhciBfY2xvbmUgPSAvKnRoaXMuY2xvbmVTeW5jICYmIHRoaXMuY2xvbmVTeW5jKCkgfHwgKi90aGlzLmNhbnZhcy5jcmVhdGVPYmplY3QoX29iamVjdCk7XG4gICAgcmV0dXJuIF9jbG9uZTtcbiAgfSxcbiAgbWluU3Ryb2tlV2lkdGg6IDAsXG4gIG1heFN0cm9rZVdpZHRoOiBmdW5jdGlvbigpe1xuICAgIHJldHVybiBNYXRoLm1pbih0aGlzLndpZHRoLHRoaXMuaGVpZ2h0KSAvIDI7XG4gIH0sXG4gIGFjdGlvbnM6IHtcbiAgICBib3VuZGluZ1JlY3Q6IHtcbiAgICAgIHR5cGU6ICdsYWJlbCcsXG4gICAgICB0ZW1wbGF0ZTogJzxkdD5MOjwvZHQ+PGRkIGNsYXNzPVwie2xlZnRDbGFzc31cIiB0aXRsZT1cIntsZWZ0fVwiPntyb3VuZExlZnR9PC9kZD48ZHQ+VDo8L2R0PjxkZCBjbGFzcz1cInt0b3BDbGFzc31cIiAgdGl0bGU9XCJ7dG9wfVwiPntyb3VuZFRvcH08L2RkPjxkdD5SOjwvZHQ+PGRkIGNsYXNzPVwie3JpZ2h0Q2xhc3N9XCIgdGl0bGU9XCJ7cmlnaHR9XCI+e3JvdW5kUmlnaHR9PC9kZD48ZHQ+Qjo8L2R0PjxkZCBjbGFzcz1cIntib3R0b21DbGFzc31cIiAgdGl0bGU9XCJ7Ym90dG9tfVwiPntyb3VuZEJvdHRvbX08L2RkPicsXG4gICAgICB2YWx1ZToge1xuICAgICAgICBvYnNlcnZlOiBcIm1vZGlmaWVkIHNjYWxpbmcgbW92aW5nIHJvdGF0aW5nXCIsXG4gICAgICAgIGdldDogZnVuY3Rpb24oKXtcbiAgICAgICAgICB2YXIgX3JlY3QgPSB0aGlzLmdldEJvdW5kaW5nUmVjdCgpO1xuXG4gICAgICAgICAgaWYodGhpcy5tb3ZlbWVudExpbWl0cykge1xuXG4gICAgICAgICAgICBpZiAodGhpcy5tb3ZlbWVudExpbWl0cyA9PSB0aGlzLmNhbnZhcykge1xuICAgICAgICAgICAgICB2YXIgX3YgPSB0aGlzLmNhbnZhcy52aWV3cG9ydFRyYW5zZm9ybTtcbiAgICAgICAgICAgICAgdmFyIF9tbHIgPSB7XG4gICAgICAgICAgICAgICAgbGVmdDogX3ZbNF0sXG4gICAgICAgICAgICAgICAgdG9wOiBfdls1XSxcbiAgICAgICAgICAgICAgICB3aWR0aDogKHRoaXMuY2FudmFzLm9yaWdpbmFsV2lkdGggfHwgdGhpcy5jYW52YXMud2lkdGgpICogX3ZbMF0sXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiAodGhpcy5jYW52YXMub3JpZ2luYWxIZWlnaHQgfHwgdGhpcy5jYW52YXMuaGVpZ2h0KSAgKiBfdlszXSxcbiAgICAgICAgICAgICAgICByaWdodDogMCxcbiAgICAgICAgICAgICAgICBib3R0b206IDBcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgIF9tbHIgPSB0aGlzLm1vdmVtZW50TGltaXRzLmdldEJvdW5kaW5nUmVjdCgpO1xuICAgICAgICAgICAgfVxuXG5cbiAgICAgICAgICAgIF9yZWN0LmJvdHRvbSA9IHRoaXMubW92ZW1lbnRMaW1pdHMuaGVpZ2h0IC0gX3JlY3QuaGVpZ2h0O1xuICAgICAgICAgICAgdmFyIF90ID0gX3JlY3QudG9wIC0gX21sci50b3A7XG4gICAgICAgICAgICB2YXIgX2wgPSBfcmVjdC5sZWZ0IC0gX21sci5sZWZ0O1xuICAgICAgICAgICAgdmFyIF9yID0gX21sci53aWR0aCAtIF9yZWN0LndpZHRoIC0gX2w7XG4gICAgICAgICAgICB2YXIgX2IgPSBfbWxyLmhlaWdodCAtIF9yZWN0LmhlaWdodCAtIF90O1xuICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgX3QgPSBfcmVjdC50b3A7XG4gICAgICAgICAgICBfbCA9IF9yZWN0LmxlZnQ7XG4gICAgICAgICAgICBfYiA9IHRoaXMuY2FudmFzLmhlaWdodCAtIF9yZWN0LmhlaWdodCAtIF9yZWN0LnRvcDtcbiAgICAgICAgICAgIF9yICA9IHRoaXMuY2FudmFzLndpZHRoIC0gX3JlY3Qud2lkdGggLSBfcmVjdC5sZWZ0O1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0b3BDbGFzczogX3QgPiAwID8gXCJwb3NpdGl2ZVwiIDogX3QgPCAwID8gXCJuZWdhdGl2ZVwiIDogXCJ6ZXJvXCIsXG4gICAgICAgICAgICBib3R0b21DbGFzczogX2IgPiAwID8gXCJwb3NpdGl2ZVwiIDogX2IgPCAwID8gXCJuZWdhdGl2ZVwiIDogXCJ6ZXJvXCIsXG4gICAgICAgICAgICBsZWZ0Q2xhc3M6IF9sID4gMCA/IFwicG9zaXRpdmVcIiA6IF9sIDwgMCA/IFwibmVnYXRpdmVcIiA6IFwiemVyb1wiLFxuICAgICAgICAgICAgcmlnaHRDbGFzczogX3IgPiAwID8gXCJwb3NpdGl2ZVwiIDogX3IgPCAwID8gXCJuZWdhdGl2ZVwiIDogXCJ6ZXJvXCIsXG4gICAgICAgICAgICB0b3A6ICAgIF90LFxuICAgICAgICAgICAgbGVmdDogICBfbCxcbiAgICAgICAgICAgIGJvdHRvbTogX2IsXG4gICAgICAgICAgICByaWdodDogIF9yLFxuICAgICAgICAgICAgcm91bmRUb3A6ICAgIE1hdGgucm91bmQoX3QpLFxuICAgICAgICAgICAgcm91bmRMZWZ0OiAgIE1hdGgucm91bmQoX2wpLFxuICAgICAgICAgICAgcm91bmRCb3R0b206IE1hdGgucm91bmQoX2IpLFxuICAgICAgICAgICAgcm91bmRSaWdodDogIE1hdGgucm91bmQoX3IpXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcbiAgICBwb3NpdGlvbjoge1xuICAgICAgdGl0bGU6ICdwb3NpdGlvbicsXG4gICAgICB0eXBlOiAnbWVudScsXG4gICAgICBtZW51OiB7XG4gICAgICAgIG9iamVjdExlZnQ6IHtcbiAgICAgICAgICB0eXBlOiAgICdudW1iZXInLFxuICAgICAgICAgIHRpdGxlOiAgJ2xlZnQnLFxuICAgICAgICAgIHZhbHVlOiB7XG4gICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2YWwpIHtcbiAgICAgICAgICAgICAgdGhpcy5sZWZ0ID0gdmFsO1xuICAgICAgICAgICAgICB0aGlzLmZpcmUoXCJtb2RpZmllZFwiKTtcbiAgICAgICAgICAgICAgdGhpcy5jYW52YXMuZmlyZShcIm9iamVjdDptb2RpZmllZFwiLCB7dGFyZ2V0OiB0aGlzfSk7XG4gICAgICAgICAgICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICByZXR1cm4gdGhpcy5sZWZ0O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9ic2VydmU6IFwibW9kaWZpZWRcIlxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgb2JqZWN0VG9wOiB7XG4gICAgICAgICAgdHlwZTogICAnbnVtYmVyJyxcbiAgICAgICAgICB0aXRsZTogICd0b3AnLFxuICAgICAgICAgIHZhbHVlOiB7XG4gICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2YWwpIHtcbiAgICAgICAgICAgICAgdGhpcy50b3AgPSB2YWw7XG4gICAgICAgICAgICAgIHRoaXMuZmlyZShcIm1vZGlmaWVkXCIpO1xuICAgICAgICAgICAgICB0aGlzLmNhbnZhcy5maXJlKFwib2JqZWN0Om1vZGlmaWVkXCIsIHt0YXJnZXQ6IHRoaXN9KTtcbiAgICAgICAgICAgICAgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIHJldHVybiB0aGlzLnRvcDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvYnNlcnZlOiBcIm1vZGlmaWVkXCJcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuICAgIGRpbWVuc2lvbnM6IHtcbiAgICAgIHRpdGxlOiAnZGltZW5zaW9ucycsXG4gICAgICB0eXBlOiAnbWVudScsXG4gICAgICBtZW51OntcbiAgICAgICAgb2JqZWN0V2lkdGg6IHtcbiAgICAgICAgICB0eXBlOiAgICdudW1iZXInLFxuICAgICAgICAgIHRpdGxlOiAgJ3dpZHRoJyxcbiAgICAgICAgICB2YWx1ZToge1xuICAgICAgICAgICAgc2V0OiBmdW5jdGlvbih2YWwpe1xuICAgICAgICAgICAgICB0aGlzLnNhdmVTdGF0ZSgpO1xuICAgICAgICAgICAgICB0aGlzLmRpbWVuc2lvbnNXaWR0aFZhbHVlID0gdmFsO1xuICAgICAgICAgICAgICB0aGlzLnNjYWxlVG9XaWR0aCh2YWwgKiAgdGhpcy5jYW52YXMuZ2V0Wm9vbSgpKTtcbiAgICAgICAgICAgICAgdGhpcy5jYW52YXMuZmlyZU1vZGlmaWVkSWZDaGFuZ2VkKHRoaXMpO1xuICAgICAgICAgICAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuZGltZW5zaW9uc1dpZHRoVmFsdWU7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICBpZih0aGlzLmRpbWVuc2lvbnNXaWR0aFZhbHVlKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5kaW1lbnNpb25zV2lkdGhWYWx1ZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICByZXR1cm4gTWF0aC5yb3VuZCh0aGlzLmdldEJvdW5kaW5nUmVjdCgpLndpZHRoIC8gdGhpcy5jYW52YXMuZ2V0Wm9vbSgpKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvYnNlcnZlOiBcIm1vZGlmaWVkXCJcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIG9iamVjdEhlaWdodDoge1xuICAgICAgICAgIHR5cGU6ICAgJ251bWJlcicsXG4gICAgICAgICAgdGl0bGU6ICAnaGVpZ2h0JyxcbiAgICAgICAgICB2YWx1ZToge1xuICAgICAgICAgICAgc2V0OiBmdW5jdGlvbih2YWwpe1xuICAgICAgICAgICAgICB0aGlzLnNhdmVTdGF0ZSgpO1xuICAgICAgICAgICAgICB0aGlzLnNjYWxlVG9IZWlnaHQodmFsICogIHRoaXMuY2FudmFzLmdldFpvb20oKSk7XG4gICAgICAgICAgICAgIHRoaXMuZGltZW5zaW9uc0hlaWdodFZhbHVlID0gdmFsO1xuICAgICAgICAgICAgICB0aGlzLmNhbnZhcy5maXJlTW9kaWZpZWRJZkNoYW5nZWQodGhpcyk7XG4gICAgICAgICAgICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgICAgICAgICAgICBkZWxldGUgdGhpcy5kaW1lbnNpb25zSGVpZ2h0VmFsdWU7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICBpZih0aGlzLmRpbWVuc2lvbnNIZWlnaHRWYWx1ZSl7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGltZW5zaW9uc0hlaWdodFZhbHVlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHJldHVybiBNYXRoLnJvdW5kKHRoaXMuZ2V0Qm91bmRpbmdSZWN0KCkuaGVpZ2h0IC8gdGhpcy5jYW52YXMuZ2V0Wm9vbSgpKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvYnNlcnZlOiBcIm1vZGlmaWVkXCJcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuICAgIGNlbnRlcjoge1xuICAgICAgY2xhc3NOYW1lOiAgJ2ZhIGZhLWJ1bGxzZXllJyxcbiAgICAgIHRpdGxlOiAnQ2VudGVyJyxcbiAgICAgIGFjdGlvbjogZnVuY3Rpb24oKXtcbiAgICAgICAgdGhpcy5jZW50ZXIoKTtcbiAgICAgICAgdGhpcy5zZXRDb29yZHMoKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIGZsaXA6IHtcbiAgICAgIGNsYXNzTmFtZTogICdmYSBmYS1hcnJvd3MtaCcsXG4gICAgICB0aXRsZTogICAgICAnZmxpcCcsXG4gICAgICBhY3Rpb246ICAgICAnZmxpcCdcbiAgICB9LFxuICAgIGZsb3A6IHtcbiAgICAgIGNsYXNzTmFtZTogICdmYSBmYS1hcnJvd3MtdicsXG4gICAgICB0aXRsZTogICAgICAnZmxvcCdcbiAgICB9LFxuICAgIGJyaW5nRm9yd2FyZDoge1xuICAgICAgdGl0bGU6ICAgICAgJ2JyaW5nIGZvcndhcmQnLFxuICAgICAgY2xhc3NOYW1lOiAgJ2ZhIGZhLWxldmVsLXVwJyxcbiAgICAgIGRpc2FibGVkOiAgICdvblRvcCdcbiAgICB9LFxuICAgIHNlbmRCYWNrd2FyZHM6IHtcbiAgICAgIHRpdGxlOiAgICAgICdzZW5kIGJhY2t3YXJkcycsXG4gICAgICBjbGFzc05hbWU6ICAnZmEgZmEtbGV2ZWwtZG93bicsXG4gICAgICBkaXNhYmxlZDogICAnb25Cb3R0b20nXG4gICAgfSxcbiAgICByZW1vdmU6IHtcbiAgICAgIGNsYXNzTmFtZTogICdmYSBmYS10cmFzaCcsXG4gICAgICB0aXRsZTogICAgICAncmVtb3ZlJyxcbiAgICAgIGtleTogICAgICAgIFwiRGVsZXRlXCJcbiAgICB9LFxuICAgIGR1cGxpY2F0ZToge1xuICAgICAgY2xhc3NOYW1lOiAgJ2ZhIGZhLWNsb25lJyxcbiAgICAgIHRpdGxlOiAgICAgICdkdXBsaWNhdGUnXG4gICAgfSxcbiAgICBmaWxsOiB7XG4gICAgICB0eXBlOiAnY29sb3InLFxuICAgICAgdGl0bGU6ICdmaWxsJyxcbiAgICAgIHZhbHVlOiAnZmlsbCdcbiAgICB9XG4gIH1cbn0pO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9jb3JlL29iamVjdC5leHQuanMiLCJ2YXIgdGV4dEluaXRpYWxpemUgPSBmYWJyaWMuVGV4dC5wcm90b3R5cGUuaW5pdGlhbGl6ZTtcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuVGV4dC5wcm90b3R5cGUsIHtcbiAgdGV4dEluaXRpYWxpemU6IHRleHRJbml0aWFsaXplLFxuICBlZGl0VG9vbDogZmFsc2UsXG4gIGFkdmFuY2VkQ29sb3JzVG9vbHM6IGZhbHNlLFxuICB0ZXh0Rm9udFNpemVUb29sczogZmFsc2UsXG4gIHRleHRBbGlnbWVudFRvb2xzOiBmYWxzZSxcbiAgYWR2YW5jZWRUZXh0U3R5bGVUb29sczogZmFsc2UsXG4gIHJhc3Rlcml6ZVRvb2w6IGZhbHNlLFxuICByYXN0ZXJpemVLbGFzczogZmFicmljLkltYWdlLFxuICBpbml0aWFsaXplOiBmdW5jdGlvbiAodGV4dCwgb3B0aW9ucykge1xuICAgIHRoaXMuX2luaXRFbnRpdHkob3B0aW9ucyk7XG4gICAgdGhpcy50ZXh0SW5pdGlhbGl6ZSh0ZXh0LCBvcHRpb25zKTtcbiAgICAvLyB0aGlzLnVwZGF0ZUNhY2hlKCk7XG4gIH0sXG4gICAgX3JlbmRlcl9jYWNoZTogZnVuY3Rpb24gKGN0eCkge1xuICBjdHguc2F2ZSgpO1xuICBjdHguc2NhbGUoXG4gICAgdGhpcy5zY2FsZVggKiAodGhpcy5mbGlwWCA/IC0xIDogMSksXG4gICAgdGhpcy5zY2FsZVkgKiAodGhpcy5mbGlwWSA/IC0xIDogMSlcbiAgKTtcbiAgdGhpcy50cmFuc2Zvcm0oY3R4KTtcbiAgdGhpcy5fc2V0U2hhZG93KGN0eCk7XG4gIGN0eC50cmFuc2xhdGUoLXRoaXMud2lkdGggLyAyLCAtdGhpcy5oZWlnaHQgLyAyKTtcbiAgY3R4LmRyYXdJbWFnZSh0aGlzLl9jYWNoZSwgMCwgMCwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpO1xuICBjdHgucmVzdG9yZSgpO1xufSxcbiAgdXBkYXRlQ2FjaGU6IGZ1bmN0aW9uICgpIHtcblxuICAgIHZhciBzaXplID0ge1xuICAgICAgd2lkdGg6IHRoaXMud2lkdGggKiB0aGlzLmNhbnZhcy5kb3RzUGVyVW5pdCxcbiAgICAgIGhlaWdodDogdGhpcy5oZWlnaHQgKiB0aGlzLmNhbnZhcy5kb3RzUGVyVW5pdFxuICAgIH07XG5cbiAgICB2YXIgX2NsaXBUbyA9IHRoaXMuY2xpcFRvO1xuICAgIGRlbGV0ZSB0aGlzLmNsaXBUbztcbiAgICB0aGlzLl9jYWNoZSA9IGZhYnJpYy51dGlsLmNyZWF0ZUNhbnZhc0VsZW1lbnRXaXRoU2l6ZShzaXplKTtcbiAgICB2YXIgY3R4ID0gdGhpcy5fY2FjaGUuZ2V0Q29udGV4dChcIjJkXCIpO1xuICAgIGN0eC5zY2FsZShcbiAgICAgIHRoaXMuY2FudmFzLmRvdHNQZXJVbml0LFxuICAgICAgdGhpcy5jYW52YXMuZG90c1BlclVuaXQpO1xuICAgIGN0eC50cmFuc2xhdGUodGhpcy53aWR0aCAvIDIsIHRoaXMuaGVpZ2h0IC8gMik7XG5cbiAgICB0aGlzLnJlbmRlcihjdHgsIHRydWUpO1xuICAgIHRoaXMucmVuZGVyID0gdGhpcy5fcmVuZGVyX2NhY2hlO1xuICAgIHRoaXMuY2xpcFRvID0gX2NsaXBUbztcblxuICB9LFxuICByYXN0ZXJpemVUZXh0OiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy51cGRhdGVDYWNoZSgpO1xuICAgIHZhciBpbWcgPSBmYWJyaWMudXRpbC5jcmVhdGVJbWFnZSgpO1xuXG4gICAgaW1nLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBvYmogPSB0aGlzLnRvT2JqZWN0KCk7XG4gICAgICBvYmoud2lkdGggPSBpbWcud2lkdGg7XG4gICAgICBvYmouaGVpZ2h0ID0gaW1nLmhlaWdodDtcbiAgICAgIG9iai5zY2FsZVggPSB0aGlzLnNjYWxlWCAqICh0aGlzLmhlaWdodCAvIGltZy5oZWlnaHQpO1xuICAgICAgb2JqLnNjYWxlWSA9IHRoaXMuc2NhbGVZICogKHRoaXMud2lkdGggLyBpbWcud2lkdGggKTtcbiAgICAgIG9iai5yYXN0ZXJpemVkVHlwZSA9IG9iai50eXBlO1xuICAgICAgZGVsZXRlIG9iai50eXBlO1xuXG4gICAgICB2YXIgZWwgPSBuZXcgdGhpcy5yYXN0ZXJpemVLbGFzcyhpbWcsIG9iaik7XG4gICAgICB0aGlzLmNhbnZhcy5hZGQoZWwpO1xuICAgICAgdGhpcy5jYW52YXMucmVtb3ZlKHRoaXMpO1xuICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuY2FudmFzLnNldEFjdGl2ZU9iamVjdChlbCk7XG4gICAgICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgICAgfS5iaW5kKHRoaXMpKVxuICAgIH0uYmluZCh0aGlzKTtcbiAgICBpbWcuc3JjID0gdGhpcy5fY2FjaGUudG9EYXRhVVJMKCk7XG4gICAgLy90aGlzLm9uKCdtb2RpZmllZCcsdGhpcy51cGRhdGVDYWNoZS5iaW5kKHRoaXMpKTtcbiAgfSxcbiAgZ2V0U3R5bGU6IGZ1bmN0aW9uIChzdHlsZU5hbWUpIHtcbiAgICB2YXIgb2JqZWN0ID0gdGhpcztcbiAgICByZXR1cm4gKG9iamVjdC5nZXRTZWxlY3Rpb25TdHlsZXMgJiYgb2JqZWN0LmlzRWRpdGluZylcbiAgICAgID8gKG9iamVjdC5nZXRTZWxlY3Rpb25TdHlsZXMoKVtzdHlsZU5hbWVdIHx8IG9iamVjdFtzdHlsZU5hbWVdKVxuICAgICAgOiAob2JqZWN0W3N0eWxlTmFtZV0gfHwgb2JqZWN0WydfXycgKyBzdHlsZU5hbWVdIHx8ICcnKTtcbiAgfSxcbiAgZ2V0UGF0dGVybjogZnVuY3Rpb24gKHVybCkge1xuICAgIHZhciBfZmlsbCA9IHRoaXMuZ2V0U3R5bGUoJ2ZpbGwgJyk7XG4gICAgcmV0dXJuIF9maWxsICYmIF9maWxsLnNvdXJjZTtcbiAgfSxcbiAgc2V0UGF0dGVybjogZnVuY3Rpb24gKHVybCkge1xuICAgIGlmICghdXJsKSB7XG4gICAgICB0aGlzLnNldFN0eWxlKCdmaWxsJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIHZhciBfdGV4dHVyZSA9IF8uZmluZFdoZXJlKHRoaXMucHJvamVjdC50ZXh0dXJlcywge2lkOiB1cmx9KTtcbiAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICBmYWJyaWMudXRpbC5sb2FkSW1hZ2UodXJsLCBmdW5jdGlvbihpbWcpIHtcbiAgICAgICAgX3RoaXMuc2V0U3R5bGUoJ2ZpbGwnLCBuZXcgZmFicmljLlBhdHRlcm4oe1xuICAgICAgICAgIHNvdXJjZTogaW1nLFxuICAgICAgICAgIHJlcGVhdDogJ3JlcGVhdCdcbiAgICAgICAgfSkpO1xuICAgICAgfSk7XG4gICAgfVxuICB9LFxuICAvKiBnZXRPcGFjaXR5OiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0U3R5bGUoJ29wYWNpdHknKSAqIDEwMDtcbiAgfSxcbiAgc2V0T3BhY2l0eTogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgdGhpcy5zZXRTdHlsZSgnb3BhY2l0eScsIHBhcnNlSW50KHZhbHVlLCAxMCkgLyAxMDApO1xuICB9LCovXG4gIGdldFJhZGl1czogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLmdldCgncmFkaXVzJyk7XG4gIH0sXG4gIHNldFNoYWRvdzogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgIHJldHVybiB0aGlzLnNldFByb3BlcnR5KCdzaGFkb3cnLCBvcHRpb25zID8gbmV3IGZhYnJpYy5TaGFkb3cob3B0aW9ucykgOiBudWxsKTtcbiAgfSxcbiAgc2V0UHJvcGVydHk6IGZ1bmN0aW9uIChwcm9wLCB2YWx1ZSkge1xuICAgIHRoaXNbcHJvcF0gPSB2YWx1ZTtcbiAgICB0aGlzLmNhbnZhcyAmJiB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgfSxcbiAgc2V0UmFkaXVzOiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICB0aGlzLnNldFByb3BlcnR5KCdyYWRpdXMnLCB2YWx1ZSk7XG4gIH0sXG4gIGdldFNwYWNpbmc6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5nZXQoJ3NwYWNpbmcnKTtcbiAgfSxcbiAgc2V0U3BhY2luZzogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgdGhpcy5zZXRQcm9wZXJ0eSgnc3BhY2luZycsIHZhbHVlKTtcbiAgfSxcbiAgZ2V0UmV2ZXJ0ZWQ6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5nZXQoJ3JldmVydGVkJyk7XG4gIH0sXG4gIHNldFJldmVydGVkOiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICB0aGlzLnNldFByb3BlcnR5KCdyZXZlcnRlZCcsIHZhbHVlKTtcbiAgfSxcbiAgZ2V0RmlsbDogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLmdldFN0eWxlKCdmaWxsJyk7XG4gIH0sXG4gIHNldEZpbGw6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgIHRoaXMuc2V0U3R5bGUoJ2ZpbGwnLCB2YWx1ZSk7XG4gIH0sXG4gIGdldFRleHQ6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5nZXQoJ3RleHQnKTtcbiAgfSxcbiAgc2V0VGV4dDogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgdGhpcy5zZXRQcm9wZXJ0eSgndGV4dCcsIHZhbHVlKTtcbiAgfSxcbiAgZ2V0VGV4dEFsaWduOiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0KCd0ZXh0QWxpZ24nKTtcbiAgfSxcbiAgc2V0VGV4dEFsaWduOiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICB0aGlzLnNldFByb3BlcnR5KCd0ZXh0QWxpZ24nLCB2YWx1ZS50b0xvd2VyQ2FzZSgpKTtcbiAgfSxcbiAgZ2V0Rm9udEZhbWlseTogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLmdldCgnZm9udEZhbWlseScpO1xuICB9LFxuICBzZXRGb250RmFtaWx5OiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICB0aGlzLnNldFN0eWxlKCdmb250RmFtaWx5JywgdmFsdWUpO1xuICB9LFxuICBnZXRTdHlsZXM6IGZ1bmN0aW9uKCl7XG4gICAgcmV0dXJuIHRoaXMuc3R5bGVzIHx8IHtcbiAgICAgICAgZmlsbCA6ICAgICAgICAgICAgICAgIHRoaXMuZmlsbCxcbiAgICAgICAgZm9udFNpemUgOiAgICAgICAgICAgIHRoaXMuZm9udFNpemUsXG4gICAgICAgIHRleHRCYWNrZ3JvdW5kQ29sb3IgOiB0aGlzLnRleHRCYWNrZ3JvdW5kQ29sb3IsXG4gICAgICAgIHRleHREZWNvcmF0aW9uIDogICAgICB0aGlzLnRleHREZWNvcmF0aW9uLFxuICAgICAgICBmb250RmFtaWx5IDogICAgICAgICAgdGhpcy5mb250RmFtaWx5LFxuICAgICAgICBmb250V2VpZ2h0IDogICAgICAgICAgdGhpcy5mb250V2VpZ2h0LFxuICAgICAgICBmb250U3R5bGUgOiAgICAgICAgICAgdGhpcy5mb250U3R5bGUsXG4gICAgICAgIHN0cm9rZSA6ICAgICAgICAgICAgICB0aGlzLnN0cm9rZSxcbiAgICAgICAgc3Ryb2tlV2lkdGggOiAgICAgICAgIHRoaXMuc3Ryb2tlV2lkdGhcbiAgICAgIH07XG4gIH0sXG4gIGdldEJnQ29sb3I6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5nZXQoJ2JhY2tncm91bmRDb2xvcicpO1xuICB9LFxuICBzZXRCZ0NvbG9yOiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICB0aGlzLnNldFByb3BlcnR5KCdiYWNrZ3JvdW5kQ29sb3InLCB2YWx1ZSk7XG4gIH0sXG4gIGdldFRleHRCZ0NvbG9yOiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0KCd0ZXh0QmFja2dyb3VuZENvbG9yJyk7XG4gIH0sXG4gIHNldFRleHRCZ0NvbG9yOiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICB0aGlzLnNldFByb3BlcnR5KCd0ZXh0QmFja2dyb3VuZENvbG9yJywgdmFsdWUpO1xuICB9LFxuICBnZXRTdHJva2U6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5nZXRTdHlsZSgnc3Ryb2tlJyk7XG4gIH0sXG4gIHNldFN0cm9rZTogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgdGhpcy5zZXRTdHlsZSgnc3Ryb2tlJywgdmFsdWUpO1xuICB9LFxuICBnZXRTdHJva2VXaWR0aDogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLmdldFN0eWxlKCdzdHJva2VXaWR0aCcpO1xuICB9LFxuICBzZXRTdHJva2VXaWR0aDogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgdGhpcy5zZXRTdHlsZSgnc3Ryb2tlV2lkdGgnLCBwYXJzZUludCh2YWx1ZSwgMTApKTtcbiAgfSxcbiAgZGVjcmVhc2VGb250U2l6ZTogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuc2V0U3R5bGUoJ2ZvbnRTaXplJywgcGFyc2VJbnQodGhpcy5nZXRTdHlsZSgnZm9udFNpemUnKSkgLSAxKTtcbiAgfSxcbiAgaW5jcmVhc2VGb250U2l6ZTogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuc2V0U3R5bGUoJ2ZvbnRTaXplJywgcGFyc2VJbnQodGhpcy5nZXRTdHlsZSgnZm9udFNpemUnKSkgKyAxKTtcbiAgfSxcbiAgZ2V0Rm9udFNpemU6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5nZXRTdHlsZSgnZm9udFNpemUnKTtcbiAgfSxcbiAgc2V0Rm9udFNpemU6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgIHRoaXMuc2V0U3R5bGUoJ2ZvbnRTaXplJywgcGFyc2VJbnQodmFsdWUsIDEwKSk7XG4gIH0sXG4gIGdldExpbmVIZWlnaHQ6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5nZXRTdHlsZSgnbGluZUhlaWdodCcpO1xuICB9LFxuICBzZXRMaW5lSGVpZ2h0OiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICB0aGlzLnNldFN0eWxlKCdsaW5lSGVpZ2h0JywgcGFyc2VGbG9hdCh2YWx1ZSwgMTApKTtcbiAgfSxcbiAgYWRkVGV4dDogZnVuY3Rpb24gKHRleHQsb3B0aW9ucykge1xuXG4gICAgdmFyIF9tYXRjaCA9IHRoaXMudGV4dC5tYXRjaCgvXFxuL2cpO1xuICAgIHZhciBfbGluZUluZGV4ID0gX21hdGNoICYmIF9tYXRjaC5sZW5ndGggfHwgMDtcbiAgICB2YXIgY2hhckluZGV4ID0gdGhpcy50ZXh0Lmxlbmd0aCAtIHRoaXMudGV4dC5sYXN0SW5kZXhPZihcIlxcblwiKSAtIDE7XG5cbiAgICBpZighdGhpcy5zdHlsZXNbX2xpbmVJbmRleF0pe1xuICAgICAgdGhpcy5zdHlsZXNbX2xpbmVJbmRleF0gPSB7fVxuICAgIH1cblxuICAgIGlmKCF0aGlzLnN0eWxlc1tfbGluZUluZGV4XVtjaGFySW5kZXhdKXtcbiAgICAgIHRoaXMuc3R5bGVzW19saW5lSW5kZXhdW2NoYXJJbmRleF0gPSB7fVxuICAgIH1cbiAgICBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKHRoaXMuc3R5bGVzW19saW5lSW5kZXhdW2NoYXJJbmRleF0sb3B0aW9ucyk7XG4gICAgdGhpcy50ZXh0ICs9dGV4dDtcbiAgICAvLyB0aGlzLnN0eWxlcztcbiAgfSxcbiAgZ2V0Qm9sZDogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLmdldFN0eWxlKCdmb250V2VpZ2h0JykgPT09IFwiYm9sZFwiO1xuICB9LFxuICBzZXRCb2xkOiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICB0aGlzLnNldFN0eWxlKCdmb250V2VpZ2h0JywgdmFsdWUgPyAnYm9sZCcgOiAnJyk7XG4gIH0sXG4gIGdldEl0YWxpYzogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLmdldFN0eWxlKCdmb250U3R5bGUnKSA9PT0gJ2l0YWxpYyc7XG4gIH0sXG4gIHNldEl0YWxpYzogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgdGhpcy5zZXRTdHlsZSgnZm9udFN0eWxlJywgdmFsdWUgPyAnaXRhbGljJyA6ICcnICk7XG4gIH0sXG4gIGdldFVuZGVybGluZTogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLmdldFN0eWxlKCd0ZXh0RGVjb3JhdGlvbicpLmluZGV4T2YoJ3VuZGVybGluZScpID4gLTE7XG4gIH0sXG4gIHNldFVuZGVybGluZTogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgdmFsdWUgPSB2YWx1ZSA/ICh0aGlzLmdldFN0eWxlKCd0ZXh0RGVjb3JhdGlvbicpICsgJyB1bmRlcmxpbmUnKVxuICAgICAgOiB0aGlzLmdldFN0eWxlKCd0ZXh0RGVjb3JhdGlvbicpLnJlcGxhY2UoJ3VuZGVybGluZScsICcnKTtcblxuICAgIHRoaXMuc2V0U3R5bGUoJ3RleHREZWNvcmF0aW9uJywgdmFsdWUpO1xuICB9LFxuICBnZXRMaW5ldGhyb3VnaDogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLmdldFN0eWxlKCd0ZXh0RGVjb3JhdGlvbicpLmluZGV4T2YoJ2xpbmUtdGhyb3VnaCcpID4gLTE7XG4gIH0sXG4gIHNldExpbmV0aHJvdWdoOiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICB2YWx1ZSA9IHZhbHVlID8gKHRoaXMuZ2V0U3R5bGUoJ3RleHREZWNvcmF0aW9uJykgKyAnIGxpbmUtdGhyb3VnaCcpXG4gICAgICA6IHRoaXMuZ2V0U3R5bGUoJ3RleHREZWNvcmF0aW9uJykucmVwbGFjZSgnbGluZS10aHJvdWdoJywgJycpO1xuXG4gICAgdGhpcy5zZXRTdHlsZSgndGV4dERlY29yYXRpb24nLCB2YWx1ZSk7XG4gIH0sXG4gIGdldE92ZXJsaW5lOiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0U3R5bGUoJ3RleHREZWNvcmF0aW9uJykuaW5kZXhPZignb3ZlcmxpbmUnKSA+IC0xO1xuICB9LFxuICBzZXRPdmVybGluZTogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgdmFsdWUgPSB2YWx1ZSA/ICh0aGlzLmdldFN0eWxlKCd0ZXh0RGVjb3JhdGlvbicpICsgJyBvdmVybGluZScpXG4gICAgICA6IHRoaXMuZ2V0U3R5bGUoJ3RleHREZWNvcmF0aW9uJykucmVwbGFjZSgnb3ZlcmxpbicsICcnKTtcblxuICAgIHRoaXMuc2V0U3R5bGUoJ3RleHREZWNvcmF0aW9uJywgdmFsdWUpO1xuICB9LFxuICBzZXRTdHlsZTogZnVuY3Rpb24gKHN0eWxlTmFtZSwgdmFsdWUpIHtcbiAgICB2YXIgb2JqZWN0ID0gdGhpcztcbiAgICB2YXIgX29sZCA9IGZhYnJpYy51dGlsLm9iamVjdC5jbG9uZURlZXAob2JqZWN0LmdldFN0eWxlcygpKTtcbiAgICAvL3ZhciBfb2xkID0gZmFicmljLnV0aWwub2JqZWN0LmRlZXBFeHRlbmQoe30sIG9iamVjdC5nZXRTdHlsZXMpOy8vZ2V0U2VsZWN0aW9uU3R5bGVzKCk7XG4gICAgaWYgKG9iamVjdC5zZXRTZWxlY3Rpb25TdHlsZXMgJiYgb2JqZWN0LmlzRWRpdGluZykge1xuICAgICAgdmFyIHN0eWxlID0ge307XG4gICAgICBpZiAodmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBzdHlsZVtzdHlsZU5hbWVdID0gdmFsdWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBkZWxldGUgc3R5bGVbc3R5bGVOYW1lXTtcbiAgICAgIH1cbiAgICAgIG9iamVjdC5zZXRTZWxlY3Rpb25TdHlsZXMoc3R5bGUpO1xuICAgICAgb2JqZWN0LnNldENvb3JkcygpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIGlmICh2YWx1ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIG9iamVjdFtzdHlsZU5hbWVdID0gdmFsdWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBkZWxldGUgb2JqZWN0W3N0eWxlTmFtZV07XG4gICAgICB9XG4gICAgICBmb3IgKHZhciBpIGluIG9iamVjdC5zdHlsZXMpIHtcbiAgICAgICAgZm9yICh2YXIgaiBpbiBvYmplY3Quc3R5bGVzW2ldKSB7XG4gICAgICAgICAgaWYgKG9iamVjdC5zdHlsZXNbaV1bal1bc3R5bGVOYW1lXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBkZWxldGUgb2JqZWN0LnN0eWxlc1tpXVtqXVtzdHlsZU5hbWVdO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHZhciBzdHlsZXNfZGF0YSA9IG9iamVjdC5nZXRTdHlsZXMoKTtcblxuICAgIGlmKHRoaXMudHlwZSAhPSBcInRleHRcIil7XG4gICAgICB0aGlzLnN0eWxlcyA9IGZhYnJpYy51dGlsLm9iamVjdC5jbG9uZURlZXAoc3R5bGVzX2RhdGEpO1xuICAgIH1cblxuICAgIHRoaXMuc2V0Q29vcmRzKCk7XG5cbiAgICB0aGlzLmZpcmUoXCJzdHlsZXM6bW9kaWZpZWRcIiwge1xuICAgICAgb3JpZ2luYWw6IF9vbGQsXG4gICAgICBtb2RpZmllZDogc3R5bGVzX2RhdGFcbiAgICB9KTtcbiAgICB0aGlzLmNhbnZhcyAmJiB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICAvKlxuICAgICB0aGlzLnByb2plY3QuaGlzdG9yeS5hZGQoe1xuICAgICBzbGlkZTogdGhpcy5zbGlkZSxcbiAgICAgb2JqZWN0OiB0aGlzLFxuICAgICB1bmRvOiBfb2xkLFxuICAgICByZWRvOiBzdHlsZXNfZGF0YSxcbiAgICAgdHlwZTogJ3N0eWxlZCcsXG4gICAgIHVuZG9GbjogZnVuY3Rpb24oKXtcbiAgICAgdGhpcy5vYmplY3QuZGF0YS5zdHlsZXMgPSB0aGlzLnVuZG87XG4gICAgIHRoaXMub2JqZWN0LmZhYnJpYy5zZXQoJ3N0eWxlcycsdGhpcy51bmRvKTtcbiAgICAgdGhpcy5vYmplY3QuZmFicmljLnNldENvb3JkcygpO1xuICAgICB0aGlzLm9iamVjdC5zbGlkZS5yZW5kZXIoKTtcbiAgICAgfSxcbiAgICAgcmVkb0ZuOiAgZnVuY3Rpb24oKXtcbiAgICAgdGhpcy5vYmplY3QuZGF0YS5zdHlsZXMgPSB0aGlzLnJlZG87XG4gICAgIHRoaXMub2JqZWN0LmZhYnJpYy5zZXQoJ3N0eWxlcycsdGhpcy5yZWRvKTtcbiAgICAgdGhpcy5vYmplY3QuZmFicmljLnNldENvb3JkcygpO1xuICAgICB0aGlzLm9iamVjdC5zbGlkZS5yZW5kZXIoKTtcbiAgICAgfVxuICAgICB9KTsqL1xuICB9LFxuXG4gIGdlbmVyYXRlVGV4dFN0eWxlOiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICdmb250LXN0eWxlJzogdGhpcy5pc0l0YWxpYygpID8gJ2l0YWxpYycgOiAnbm9ybWFsJyxcbiAgICAgICdmb250LXdlaWdodCc6IHRoaXMuaXNCb2xkKCkgPyA3MDAgOiA0MDAsXG4gICAgICAndGV4dC1kZWNvcmF0aW9uJzogKHRoaXMuaXNMaW5ldGhyb3VnaCgpID8gJ2xpbmUtdGhyb3VnaCAnIDogJycgKSArXG4gICAgICAodGhpcy5pc092ZXJsaW5lKCkgPyAnb3ZlcmxpbmUgJyA6ICcnICkgK1xuICAgICAgKHRoaXMuaXNVbmRlcmxpbmUoKSA/ICd1bmRlcmxpbmUgJyA6ICcnKVxuICAgIH1cbiAgfSxcbiAgYWN0aW9uczoge1xuICAgIGZpbGw6IHtcbiAgICAgIHR5cGU6ICdjb2xvcicsXG4gICAgICB0aXRsZTogJ2ZpbGwnLFxuICAgICAgdmFsdWU6IHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbigpe1xuICAgICAgICAgIC8vdGV4dHVyZSBwYXR0ZXJuIGZpbGwgZml4XG4gICAgICAgICAgcmV0dXJuIHR5cGVvZiB0aGlzLmZpbGwgPT0gXCJzdHJpbmdcIiA/IHRoaXMuZmlsbCA6IFwidHJhbnNwYXJlbnRcIjtcbiAgICAgICAgfSxcbiAgICAgICAgc2V0OiBmdW5jdGlvbih2YWx1ZSl7XG4gICAgICAgICAgdGhpcy5zZXRGaWxsKHZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG4gICAgcmFzdGVyaXplVGV4dDoge1xuICAgICAgaW5zZXJ0OiAncmFzdGVyaXplVG9vbCcsXG4gICAgICBjbGFzc05hbWU6ICdidXR0b24tZWFzZWwnLFxuICAgICAgdGl0bGU6ICdyYXN0ZXJpemVUZXh0JyxcbiAgIC8vICAgYWN0aW9uOiBfVEVYLnJhc3Rlcml6ZVRleHRcbiAgICB9LFxuICAgIHRleHRCZ2NvbG9yOiB7XG4gICAgICB0eXBlOiAnY29sb3InLFxuICAgICAgdGl0bGU6ICdiZ0NvbG9yJyxcbiAgICAgIHZhbHVlOiAnYmdDb2xvcidcbiAgICB9LFxuICAgIHRleHRUZXh0Ymdjb2xvcjoge1xuICAgICAgdHlwZTogJ2NvbG9yJyxcbiAgICAgIHRpdGxlOiAndGV4dEJnQ29sb3InLFxuICAgICAgdmFsdWU6ICd0ZXh0QmdDb2xvcidcbiAgICB9LFxuICAgIHRleHRCb2xkOiB7XG4gICAgICB0eXBlOiBcImNoZWNrYm94XCIsXG4gICAgICB0aXRsZTogJ2JvbGQnLFxuICAgICAgdmFsdWU6ICdib2xkJyxcbiAgICAgIGNsYXNzTmFtZTogJ2ZhIGZhLWJvbGQnXG4gICAgfSxcbiAgICB0ZXh0SXRhbGljOiB7XG4gICAgICB0eXBlOiBcImNoZWNrYm94XCIsXG4gICAgICB0aXRsZTogJ2l0YWxpYycsXG4gICAgICB2YWx1ZTogJ2l0YWxpYycsXG4gICAgICBjbGFzc05hbWU6ICdmYSBmYS1pdGFsaWMnXG4gICAgfSxcbiAgICB0ZXh0VW5kZXJsaW5lOiB7XG4gICAgICB0eXBlOiBcImNoZWNrYm94XCIsXG4gICAgICB0aXRsZTogJ1VuZGVybGluZScsXG4gICAgICB2YWx1ZTogJ3VuZGVybGluZScsXG4gICAgICBjbGFzc05hbWU6ICdmYSBmYS11bmRlcmxpbmUnXG4gICAgfSxcbiAgICB0ZXh0TGluZXRocm91Z2g6IHtcbiAgICAgIHR5cGU6IFwiY2hlY2tib3hcIixcbiAgICAgIGluc2VydDogJ2FkdmFuY2VkVGV4dFN0eWxlVG9vbHMnLFxuICAgICAgdGl0bGU6ICdMaW5ldGhyb3VnaCcsXG4gICAgICB2YWx1ZTogJ2xpbmV0aHJvdWdoJyxcbiAgICAgIGNsYXNzTmFtZTogJ3RleHQtbGluZXRocm91Z2ggZmEgZmEtc3RyaWtldGhyb3VnaCdcbiAgICB9LFxuICAgIHRleHRPdmVybGluZToge1xuICAgICAgdHlwZTogXCJjaGVja2JveFwiLFxuICAgICAgaW5zZXJ0OiAnYWR2YW5jZWRUZXh0U3R5bGVUb29scycsXG4gICAgICB0aXRsZTogJ292ZXJsaW5lJyxcbiAgICAgIHZhbHVlOiAnb3ZlcmxpbmUnLFxuICAgICAgY2xhc3NOYW1lOiAndGV4dC1vdmVybGluZSBmYSBmYS1vdmVybGluZSdcbiAgICB9LFxuICAgIHRleHRBbGlnbjoge1xuICAgICAgdHlwZTogJ29wdGlvbnMnLFxuICAgICAgdGl0bGU6ICd0ZXh0IGFsaWduJyxcbiAgICAgIGluc2VydDogJ3RleHRBbGlnbWVudFRvb2xzJyxcbiAgICAgIHZhbHVlOiBcInRleHRBbGlnblwiLFxuICAgICAgbWVudToge1xuICAgICAgICB0ZXh0QWxpZ25DZW50ZXI6IHtcbiAgICAgICAgICB0aXRsZTogJ2FsaWduIGNlbnRlcicsXG4gICAgICAgICAgb3B0aW9uOiAnY2VudGVyJyxcbiAgICAgICAgICBjbGFzc05hbWU6ICdmYSBmYS1hbGlnbi1jZW50ZXInXG4gICAgICAgIH0sXG4gICAgICAgIHRleHRBbGlnbkxlZnQ6IHtcbiAgICAgICAgICB0aXRsZTogJ2FsaWduIGxlZnQnLFxuICAgICAgICAgIG9wdGlvbjogJ2xlZnQnLFxuICAgICAgICAgIGNsYXNzTmFtZTogJ2ZhIGZhLWFsaWduLWxlZnQnXG4gICAgICAgIH0sXG4gICAgICAgIHRleHRBbGlnblJpZ2h0OiB7XG4gICAgICAgICAgdGl0bGU6ICdhbGlnbiByaWdodCcsXG4gICAgICAgICAgb3B0aW9uOiAncmlnaHQnLFxuICAgICAgICAgIGNsYXNzTmFtZTogJ2ZhIGZhLWFsaWduLXJpZ2h0J1xuICAgICAgICB9LFxuICAgICAgICB0ZXh0QWxpZ25KdXN0aWZ5OiB7XG4gICAgICAgICAgdGl0bGU6ICdhbGlnbiBqdXN0aWZ5JyxcbiAgICAgICAgICBvcHRpb246ICdqdXN0aWZ5JyxcbiAgICAgICAgICBjbGFzc05hbWU6ICdmYSBmYS1hbGlnbi1qdXN0aWZ5J1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcbiAgICBmb250RmFtaWx5OiB7XG4gICAgICB0eXBlOiAnZm9udEZhbWlseScsXG4gICAgICB0aXRsZTogJ2ZvbnQgZmFtaWx5JyxcbiAgICAgIGNsYXNzTmFtZTogJ2ZhIGZhLXRleHQnLFxuICAgICAgdmFsdWU6ICdmb250RmFtaWx5JyxcbiAgICAgIGRhdGE6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiB0aGlzLmFwcGxpY2F0aW9uLl9mb250c1xuICAgICAgfVxuICAgIH0sXG4gICAgdGV4dEZvbnRTaXplOiB7XG4gICAgICBpbnNlcnQ6ICd0ZXh0Rm9udFNpemVUb29scycsXG4gICAgICB0eXBlOiAnbnVtYmVyJyxcbiAgICAgIHRpdGxlOiAnZm9udFNpemUnLFxuICAgICAgdmFsdWU6ICdmb250U2l6ZSdcbiAgICB9LFxuICAgIC8qdGV4dEZvbnQ6IHtcbiAgICAgaW5zZXJ0OiAndGV4dEZvbnRTaXplVG9vbHMnLFxuICAgICB0eXBlOiAnbWVudScsXG4gICAgIHRpdGxlOiAnZm9udCcsXG4gICAgIGNsYXNzTmFtZTogJ2ZhIGZhLWZvbnQnLFxuICAgICBtZW51OiB7XG4gICAgIHRleHRGb250U2l6ZURlY3JlYXNlOiB7XG4gICAgIHRpdGxlOiAnZGVjcmVhc2VGb250U2l6ZScsXG4gICAgIGFjdGlvbjogX1RFWC5kZWNyZWFzZUZvbnRTaXplLFxuICAgICBjbGFzc05hbWU6ICdmYSBmYS1mb250IGZvbnQtc2l6ZS1kZWNyZWFzZSdcbiAgICAgfSxcbiAgICAgdGV4dEZvbnRTaXplSW5jcmVhc2U6IHtcbiAgICAgdGl0bGU6ICdpbmNyZWFzZUZvbnRTaXplJyxcbiAgICAgYWN0aW9uOiBfVEVYLmluY3JlYXNlRm9udFNpemUsXG4gICAgIGNsYXNzTmFtZTogJ2ZhIGZhLWZvbnQgZm9udC1zaXplLWluY3JlYXNlJ1xuICAgICB9XG4gICAgIH1cbiAgICAgfSovXG4gICAgYWR2YW5jZWRDb2xvcnNUb29sczoge1xuICAgICAgY2xhc3NOYW1lOiAnY29sb3JzJyxcbiAgICAgIHR5cGU6ICdtZW51JyxcbiAgICAgIHRpdGxlOiAnY29sb3JzJyxcbiAgICAgIHRvZ2dsZWQ6IHRydWUsXG4gICAgICBtZW51OiBbXCJmaWxsXCIsXCJ0ZXh0Qmdjb2xvclwiLFwidGV4dFRleHRiZ2NvbG9yXCIsXCJ0ZXh0RmlsbFwiXVxuICAgIH0sXG4gICAgdGV4dFN0eWxlOiB7XG4gICAgICB0eXBlOiAnbWVudScsXG4gICAgICB0aXRsZTogJ3RleHQgc3R5bGUnLFxuICAgICAgdG9nZ2xlZDogdHJ1ZSxcbiAgICAgIGNsYXNzTmFtZTogJ2ZhIGZhLWZvbnQnLFxuICAgICAgc3R5bGU6ICdnZW5lcmF0ZVRleHRTdHlsZScsXG4gICAgICBtZW51OiBbXG4gICAgICAgIFwidGV4dEJvbGRcIixcInRleHRJdGFsaWNcIixcInRleHRVbmRlcmxpbmVcIixcInRleHRMaW5ldGhyb3VnaFwiLFxuICAgICAgICBcInRleHRPdmVybGluZVwiLFwidGV4dEFsaWduXCIsXCJmb250RmFtaWx5XCIsXCJ0ZXh0Rm9udFNpemVcIlxuICAgICAgXVxuICAgIH1cbiAgfVxufSk7XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLklUZXh0LnByb3RvdHlwZSwge1xuICBpbml0SGlkZGVuVGV4dGFyZWFfbmF0aXZlOiBmYWJyaWMuSVRleHQucHJvdG90eXBlLmluaXRIaWRkZW5UZXh0YXJlYSxcbiAgaW5pdEhpZGRlblRleHRhcmVhOiBmdW5jdGlvbigpe1xuICAgIHRoaXMuaW5pdEhpZGRlblRleHRhcmVhX25hdGl2ZSgpO1xuICAgIHRoaXMuaGlkZGVuVGV4dGFyZWEuc3R5bGUud2lkdGggPSBcIjk5OTlweFwiO1xuICAgIHRoaXMuaGlkZGVuVGV4dGFyZWEuc3R5bGVbXCJtYXJnaW4tbGVmdFwiXSA9IFwiLTk5OTlweFwiO1xuICB9LFxuICAvKipcbiAgICogRXhpdHMgZnJvbSBlZGl0aW5nIHN0YXRlXG4gICAqIEByZXR1cm4ge2ZhYnJpYy5JVGV4dH0gdGhpc0FyZ1xuICAgKiBAY2hhaW5hYmxlXG4gICAqL1xuICBleGl0RWRpdGluZzogZnVuY3Rpb24oKSB7XG4gICAgLy8gdmFyIGlzVGV4dENoYW5nZWQgPSAodGhpcy5fdGV4dEJlZm9yZUVkaXQgIT09IHRoaXMudGV4dCk7XG4gICAgdGhpcy5zZWxlY3RlZCA9IGZhbHNlO1xuICAgIHRoaXMuaXNFZGl0aW5nID0gZmFsc2U7XG4gICAgdGhpcy5zZWxlY3RhYmxlID0gdHJ1ZTtcblxuICAgIHRoaXMuc2VsZWN0aW9uRW5kID0gdGhpcy5zZWxlY3Rpb25TdGFydDtcbiAgICB0aGlzLmhpZGRlblRleHRhcmVhICYmIHRoaXMuY2FudmFzICYmIHRoaXMuaGlkZGVuVGV4dGFyZWEucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLmhpZGRlblRleHRhcmVhKTtcbiAgICB0aGlzLmhpZGRlblRleHRhcmVhID0gbnVsbDtcblxuICAgIHRoaXMuYWJvcnRDdXJzb3JBbmltYXRpb24oKTtcbiAgICB0aGlzLl9yZXN0b3JlRWRpdGluZ1Byb3BzKCk7XG4gICAgdGhpcy5fY3VycmVudEN1cnNvck9wYWNpdHkgPSAwO1xuXG4gICAgdGhpcy5maXJlKCdlZGl0aW5nOmV4aXRlZCcpO1xuICAgIC8vIGlzVGV4dENoYW5nZWQgJiYgdGhpcy5maXJlKCdtb2RpZmllZCcpO1xuICAgIGlmICh0aGlzLmNhbnZhcykge1xuICAgICAgdGhpcy5jYW52YXMub2ZmKCdtb3VzZTptb3ZlJywgdGhpcy5tb3VzZU1vdmVIYW5kbGVyKTtcbiAgICAgIHRoaXMuY2FudmFzLmZpcmUoJ3RleHQ6ZWRpdGluZzpleGl0ZWQnLCB7IHRhcmdldDogdGhpcyB9KTtcbiAgICAgIHRoaXMuY2FudmFzLmZpcmVNb2RpZmllZElmQ2hhbmdlZCh0aGlzKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG4gIG1heFN0cm9rZVdpZHRoOiBmdW5jdGlvbigpe1xuICAgIHJldHVybiBNYXRoLmNlaWwoIHRoaXMuZ2V0Rm9udFNpemUoKSAvIDEwKTtcbiAgfSxcbiAgYWN0aW9uczoge1xuICAgIGVudGVyRWRpdGluZzoge1xuICAgICAgaW5zZXJ0OiAgICAgJ2VkaXRUb29sJyxcbiAgICAgIGNsYXNzTmFtZTogICdmYSBmYS1wZW5jaWwtc3F1YXJlLW8nLFxuICAgICAgdGl0bGU6ICAgICAgJ2VkaXQnXG4gICAgICAvL2FjdGlvbjogICAgIF9URVguZW50ZXJFZGl0aW5nXG4gICAgfVxuICB9XG59KTtcblxuXG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2NvcmUvdGV4dC5leHQuanMiLCJ2YXIgX0dyb3VwUmVtb3ZlTmV0aXZlID0gZmFicmljLkdyb3VwLnByb3RvdHlwZS5yZW1vdmU7XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLkdyb3VwLnByb3RvdHlwZSwge1xuICAvKipcbiAgICogUmVtb3ZlcyBvYmplY3QgZnJvbSBjYW52YXMgdG8gd2hpY2ggaXQgd2FzIGFkZGVkIGxhc3RcbiAgICogQHJldHVybiB7ZmFicmljLk9iamVjdH0gdGhpc0FyZ1xuICAgKiBAY2hhaW5hYmxlXG4gICAqL1xuICByZW1vdmU6IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgdGhpcy5jYW52YXMgJiYgdGhpcy5jYW52YXMucmVtb3ZlKHRoaXMpO1xuICAgIH0gZWxzZSB7XG4gICAgICBfR3JvdXBSZW1vdmVOZXRpdmUuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfVxufSk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2NvcmUvZ3JvdXAuZXh0LmpzIiwiXG5yZXF1aXJlKFwiLi8uLi9taXhpbnMvcHJvcG9ydGlhbmFsU2l6ZU1peGluXCIpO1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5JbWFnZS5wcm90b3R5cGUsZmFicmljLkltYWdlTWl4aW4sIHtcbiAgYXN5bmM6IHRydWUsXG4gIHRvT2JqZWN0TmF0aXZlOiBmYWJyaWMuSW1hZ2UucHJvdG90eXBlLnRvT2JqZWN0LFxuICB0b09iamVjdDogICAgIGZ1bmN0aW9uKCl7XG4gICAgdmFyIG9iaiA9IGZhYnJpYy5JbWFnZS5wcm90b3R5cGUudG9PYmplY3ROYXRpdmUuYXBwbHkodGhpcyxhcmd1bWVudHMpO1xuICAgIGlmKG9iai5zcmMuaW5kZXhPZihmYWJyaWMudXRpbC5tZWRpYVJvb3QpID09IDApe1xuICAgICAgb2JqLnNyYyA9IG9iai5zcmMucmVwbGFjZShmYWJyaWMudXRpbC5tZWRpYVJvb3QsXCJcIik7XG4gICAgfVxuICAgIHJldHVybiBvYmo7XG4gIH0sXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uIChlbGVtZW50LCBvcHRpb25zLCBjYWxsYmFjaykge1xuICAgIG9wdGlvbnMgfHwgKG9wdGlvbnMgPSB7fSk7XG4gICAgdGhpcy5maWx0ZXJzID0gW107XG4gICAgdGhpcy5yZXNpemVGaWx0ZXJzID0gW107XG5cblxuICAgIGlmIChvcHRpb25zLm9yaWdpbmFsU3JjKSB7XG4gICAgICB0aGlzLl9lZGl0ZWQgPSB0cnVlO1xuICAgICAgZmFicmljLnV0aWwubG9hZEltYWdlKG9wdGlvbnMub3JpZ2luYWxTcmMsIGZ1bmN0aW9uIChpbWcpIHtcbiAgICAgICAgdGhpcy5fb3JpZ2luYWxFbGVtZW50ID0gaW1nO1xuICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICB9XG5cbiAgICB0aGlzLl9pbml0RWxlbWVudChlbGVtZW50LCBvcHRpb25zLCBjYWxsYmFjayAmJiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGZhYnJpYy5PYmplY3QucHJvdG90eXBlLmluaXRpYWxpemUuY2FsbCh0aGlzLCBvcHRpb25zLCBjYWxsYmFjayk7XG4gICAgICB9LmJpbmQodGhpcykpOy8vYWRkaW5nIGNhbGxiYWNrXG4gIH0sXG5cbiAgX2luaXRFbGVtZW50OiBmdW5jdGlvbiAoZWxlbWVudCwgb3B0aW9ucywgY2FsbGJhY2spIHtcbiAgICB0aGlzLnNldEVsZW1lbnQoZmFicmljLnV0aWwuZ2V0QnlJZChlbGVtZW50KSwgY2FsbGJhY2ssIG9wdGlvbnMpO1xuICAgIGZhYnJpYy51dGlsLmFkZENsYXNzKHRoaXMuZ2V0RWxlbWVudCgpLCBmYWJyaWMuSW1hZ2UuQ1NTX0NBTlZBUyk7XG4gIH0sXG4gIC8qKlxuICAgKiBTZXRzIGNyb3NzT3JpZ2luIHZhbHVlIChvbiBhbiBpbnN0YW5jZSBhbmQgY29ycmVzcG9uZGluZyBpbWFnZSBlbGVtZW50KVxuICAgKiBAcmV0dXJuIHtmYWJyaWMuSW1hZ2V9IHRoaXNBcmdcbiAgICogQGNoYWluYWJsZVxuICAgKi9cbiAgc2V0Q3Jvc3NPcmlnaW46IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgIHRoaXMuY3Jvc3NPcmlnaW4gPSB2YWx1ZTtcbiAgICBpZiAodGhpcy5fZWxlbWVudCkge1xuICAgICAgdGhpcy5fZWxlbWVudC5jcm9zc09yaWdpbiA9IHZhbHVlO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfSxcbiAgc2V0RWxlbWVudDogZnVuY3Rpb24gKGVsZW1lbnQsIGNhbGxiYWNrLCBvcHRpb25zKSB7XG5cbiAgICB2YXIgX2NhbGxiYWNrLCBfdGhpcztcblxuICAgIHRoaXMuX2VsZW1lbnQgPSBlbGVtZW50O1xuICAgIHRoaXMuX29yaWdpbmFsRWxlbWVudCA9IGVsZW1lbnQ7XG4gICAgdGhpcy5faW5pdENvbmZpZyhvcHRpb25zKTtcbiAgICAvLyB0aGlzLnNldE9wdGlvbnMob3B0aW9ucyApO1xuICAgIC8vIHRoaXMuX3NldFdpZHRoSGVpZ2h0KHRoaXMpO1xuICAgIC8vIGlmICh0aGlzLl9lbGVtZW50ICYmIHRoaXMuY3Jvc3NPcmlnaW4pIHtcbiAgICAvLyAgIHRoaXMuX2VsZW1lbnQuY3Jvc3NPcmlnaW4gPSB0aGlzLmNyb3NzT3JpZ2luO1xuICAgIC8vIH1cblxuXG4gICAgaWYgKHRoaXMucmVzaXplRmlsdGVycy5sZW5ndGggPT09IDApIHtcbiAgICAgIF9jYWxsYmFjayA9IGNhbGxiYWNrO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIF90aGlzID0gdGhpcztcbiAgICAgIF9jYWxsYmFjayA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgX3RoaXMuYXBwbHlGaWx0ZXJzKGNhbGxiYWNrLCBfdGhpcy5yZXNpemVGaWx0ZXJzLCBfdGhpcy5fZmlsdGVyZWRFbCB8fCBfdGhpcy5fb3JpZ2luYWxFbGVtZW50LCB0cnVlKTtcbiAgICAgIH07XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuZmlsdGVycy5sZW5ndGggIT09IDApIHtcbiAgICAgIHRoaXMuYXBwbHlGaWx0ZXJzKF9jYWxsYmFjayk7XG4gICAgfVxuICAgIGVsc2UgaWYgKF9jYWxsYmFjaykge1xuICAgICAgX2NhbGxiYWNrKHRoaXMpO1xuICAgIH1cbiAgICBpZih0aGlzLmNhbnZhcyl7XG4gICAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG4gIGFjdGlvbnMgOiB7XG4gICAgc291cmNlOiB7XG4gICAgICB0eXBlOiAnZWZmZWN0JyxcbiAgICAgIGNsYXNzTmFtZTogJ2ZhIGZhLWZpbGUtaW1hZ2UtbycsXG4gICAgICB0aXRsZTogXCJzb3VyY2VcIixcbiAgICAgIGFjdGlvblBhcmFtZXRlcnM6IGZ1bmN0aW9uICgkZWwsIGRhdGEpIHtcbiAgICAgICAgZGF0YS50YXJnZXQuYXBwbGljYXRpb24uY3JlYXRlR2FsbGVyeShkYXRhLnRhcmdldCwgJGVsKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn0pO1xuXG5mYWJyaWMudXRpbC5pbml0RmlsdGVycyA9IGZ1bmN0aW9uIChpbWcsIG9iamVjdCwgY2FsbGJhY2spIHtcblxuICAvLyBpZiAoZmFicmljLnZlcnNpb24gPj0gMS42KSB7XG4gIGZhYnJpYy5JbWFnZS5wcm90b3R5cGUuX2luaXRGaWx0ZXJzLmNhbGwob2JqZWN0LCBvYmplY3QuZmlsdGVycywgZnVuY3Rpb24gKGZpbHRlcnMpIHtcbiAgICBvYmplY3QuZmlsdGVycyA9IGZpbHRlcnMgfHwgW107XG4gICAgZmFicmljLkltYWdlLnByb3RvdHlwZS5faW5pdEZpbHRlcnMuY2FsbChvYmplY3QsIG9iamVjdC5yZXNpemVGaWx0ZXJzLCBmdW5jdGlvbiAocmVzaXplRmlsdGVycykge1xuICAgICAgb2JqZWN0LnJlc2l6ZUZpbHRlcnMgPSByZXNpemVGaWx0ZXJzIHx8IFtdO1xuICAgICAgY2FsbGJhY2soaW1nLCBvYmplY3QpO1xuICAgIH0pO1xuICB9KTtcbiAgLy8gfSBlbHNlIHtcbiAgLy8gICBmYWJyaWMuSW1hZ2UucHJvdG90eXBlLl9pbml0RmlsdGVycy5jYWxsKG9iamVjdCwgb2JqZWN0LCBmdW5jdGlvbiAoZmlsdGVycykge1xuICAvLyAgICAgb2JqZWN0LmZpbHRlcnMgPSBmaWx0ZXJzIHx8IFtdO1xuICAvLyAgICAgY2FsbGJhY2soaW1nLCBvYmplY3QpO1xuICAvLyAgIH0pO1xuICAvLyB9XG59O1xuXG5mYWJyaWMudXRpbC5pbml0SW1hZ2VBbmRGaWx0ZXJzID0gZnVuY3Rpb24gKG9iamVjdCwgY2FsbGJhY2spIHtcbiAgaWYgKG9iamVjdC5pbWFnZSkge1xuICAgIHZhciBpbWcgPSBvYmplY3QuaW1hZ2U7XG4gICAgZGVsZXRlIG9iamVjdC5zcmM7XG4gICAgZGVsZXRlIG9iamVjdC5pbWFnZTtcbiAgICBmYWJyaWMudXRpbC5pbml0RmlsdGVycyhpbWcsIG9iamVjdCwgY2FsbGJhY2spO1xuICB9ZWxzZSBpZiAob2JqZWN0LnNyYykge1xuICAgIGZhYnJpYy51dGlsLmxvYWRJbWFnZShvYmplY3Quc3JjLCBmdW5jdGlvbiAoaW1nKSB7XG4gICAgICAvL2RlbGV0ZSBvYmplY3Quc3JjO1xuICAgICAgZmFicmljLnV0aWwuaW5pdEZpbHRlcnMoaW1nLCBvYmplY3QsIGNhbGxiYWNrKTtcbiAgICB9LCBudWxsLCBvYmplY3QuY3Jvc3NPcmlnaW4pO1xuICB9IGVsc2Uge1xuICAgIGZhYnJpYy51dGlsLmluaXRGaWx0ZXJzKG51bGwsIG9iamVjdCwgY2FsbGJhY2spO1xuICB9XG59O1xuXG5mYWJyaWMuSW1hZ2UuZnJvbU9iamVjdCA9IGZ1bmN0aW9uIChvYmplY3QsIGNhbGxiYWNrKSB7XG4gIGZhYnJpYy51dGlsLmluaXRJbWFnZUFuZEZpbHRlcnMob2JqZWN0LCBmdW5jdGlvbiAoaW1nLCBvYmplY3QpIHtcbiAgICB2YXIgaW5zdGFuY2UgPSBuZXcgZmFicmljLkltYWdlKGltZywgb2JqZWN0LCBjYWxsYmFjayk7XG4gIH0pXG59O1xuXG5cbmZhYnJpYy5JbWFnZS5wcm90b3R5cGUuX3RvX29iamVjdF9vdmVyd3JpdHRlbiA9IGZhYnJpYy5JbWFnZS5wcm90b3R5cGUudG9PYmplY3Q7XG5mYWJyaWMuSW1hZ2UucHJvdG90eXBlLnNldFNyYyA9IGZ1bmN0aW9uIChvcHQpIHtcbiAgY29uc29sZS5sb2cob3B0KTtcbn07XG5cbmZhYnJpYy5JbWFnZS5wcm90b3R5cGUudG9PYmplY3QgPSBmdW5jdGlvbiAob3B0KSB7XG4gIHZhciBvYmogPSBmYWJyaWMuSW1hZ2UucHJvdG90eXBlLl90b19vYmplY3Rfb3ZlcndyaXR0ZW4uY2FsbCh0aGlzLCBvcHQpO1xuXG5cbiAgaWYgKHRoaXMuX2VkaXRlZCkge1xuICAgIG9iai5vcmlnaW5hbFNyYyA9IHRoaXMuX29yaWdpbmFsX3NyYyB8fCB0aGlzLl9vcmlnaW5hbEVsZW1lbnQuc3JjIHx8IHRoaXMuX2VsZW1lbnQuc3JjO1xuICAgIG9iai5zcmMgPSB0aGlzLl9lbGVtZW50LnNyYztcbiAgfSBlbHNlIHtcbiAgICBvYmouc3JjID0gdGhpcy5fb3JpZ2luYWxfc3JjIHx8IHRoaXMuX29yaWdpbmFsRWxlbWVudC5zcmMgfHwgdGhpcy5fZWxlbWVudC5zcmM7XG4gIH1cbiAgaWYgKHRoaXMuY29udGVudE9mZnNldHMpIHtcbiAgICBvYmouY29udGVudE9mZnNldHMgPSB0aGlzLmNvbnRlbnRPZmZzZXRzO1xuICB9XG5cblxuICBpZiAoIXRoaXMuaW5jbHVkZURlZmF1bHRWYWx1ZXMpIHtcbiAgICBpZiAoIW9iai5maWx0ZXJzLmxlbmd0aClkZWxldGUgb2JqLmZpbHRlcnM7XG4gIH1cbiAgLy9pZih0aGlzLl9vcmlnaW5hbEVsZW1lbnQpe1xuICAvLyAgICBvYmoudGh1bWIgPSB0aGlzLl9lbGVtZW50LnNyYztcbiAgLy99XG5cbiAgcmV0dXJuIG9iajtcbn07XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2NvcmUvaW1hZ2UuZXh0LmpzIiwiXG5cbmZhYnJpYy5BcHBsaWNhdGlvbi5wcm90b3R5cGUuY29uZmlndXJhdGlvblByb3BlcnRpZXMucHVzaChcInRlbXBsYXRlc1wiKTtcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuQXBwbGljYXRpb24ucHJvdG90eXBlLCB7XG4gIHNldFRlbXBsYXRlczogZnVuY3Rpb24odmFsdWUpe1xuICAgICAgdGhpcy50ZW1wbGF0ZXMgPSB2YWx1ZTtcbiAgfVxufSk7XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLlN0YXRpY0NhbnZhcy5wcm90b3R5cGUsIHtcbiAgZXZlbnRMaXN0ZW5lcnM6IGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmRBcnJheXNPYmplY3QoZmFicmljLlN0YXRpY0NhbnZhcy5wcm90b3R5cGUuZXZlbnRMaXN0ZW5lcnMsIHtcbiAgICBcImxvYWRpbmc6YmVnaW5cIjogZnVuY3Rpb24gKGUpIHtcbiAgICAgIGxldCB2YWwgPSBlLm9wdGlvbnMudGVtcGxhdGU7XG4gICAgICBpZih2YWwpe1xuICAgICAgICBsZXQgdHBsID0gdGhpcy5nZXRUZW1wbGF0ZSh2YWwpO1xuICAgICAgICBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGUub3B0aW9ucyx0cGwuZGF0YSk7XG4gICAgICB9XG4gICAgfVxuICB9KSxcbiAgc2V0VGVtcGxhdGU6IGZ1bmN0aW9uKHZhbHVlKXtcbiAgICB0aGlzLnRlbXBsYXRlID0gdmFsdWU7XG4gIH0sXG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICBnZXRUZW1wbGF0ZTogZnVuY3Rpb24oaWQpe1xuICAgIHJldHVybiBmYWJyaWMudXRpbC5vYmplY3QuZmluZFdoZXJlKHRoaXMuYXBwbGljYXRpb24udGVtcGxhdGVzLHtpZDogaWR9KVxuICB9LFxuICB1cGRhdGVTbGlkZVRlbXBsYXRlOiBmdW5jdGlvbihzbGlkZSkge1xuICAgIHNsaWRlLmNhbnZhcy5zZXRUZW1wbGF0ZShzbGlkZS5jYW52YXMudGVtcGxhdGUpO1xuICAgIHRoaXMuY2FudmFzLnRlbXBsYXRlID0gc2xpZGUuY2FudmFzLnRlbXBsYXRlO1xuICAgIGlmKHRoaXMuYWN0aXZlU2xpZGUgID09IHNsaWRlKXtcbiAgICAgIHRoaXMuY2FudmFzLnNldFRlbXBsYXRlKHNsaWRlLmNhbnZhcy50ZW1wbGF0ZSk7XG4gICAgfVxuICB9LFxuICB1cGRhdGVUZW1wbGF0ZTogZnVuY3Rpb24odGVtcGxhdGUpIHtcbiAgICBmb3IodmFyIGkgaW4gdGhpcy5zbGlkZXMpe1xuICAgICAgaWYodGhpcy5zbGlkZXNbaV0uY2FudmFzLnRlbXBsYXRlID09IHRlbXBsYXRlKXtcbiAgICAgICAgdGhpcy51cGRhdGVTbGlkZVRlbXBsYXRlKHRoaXMuc2xpZGVzW2ldKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn0pO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9tb2R1bGVzL3NsaWRlLnRlbXBsYXRlLmpzIiwiLyp0b2RvXG5mYWJyaWMuU2xpZGVDYW52YXMuYWRkUGx1Z2luKFwiaW5pdGlhbGl6ZVwiLGZ1bmN0aW9uKCl7XG4gIGlmKHR5cGVvZiB0aGlzLmZyZWVEcmF3aW5nQnJ1c2ggPT0gXCJzdHJpbmdcIiApe1xuICAgIHRoaXMuc2V0RnJlZURyYXdpbmdCcnVzaCh0aGlzLmZyZWVEcmF3aW5nQnJ1c2gpO1xuICB9XG59KTsqL1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUse1xuICAvKipcbiAgICogWydQZW5jaWxCcnVzaCcsJ1JlY3RhbmdsZUJydXNoJ11cbiAgICovXG4gIGFjdGl2ZURyYXdpbmdUb29sczogW10sXG4gIC8qKlxuICAgKlxuICAgICB7XG4gICAgICBCcnVzaENsYXNzTmFtZToge1xuICAgICAgICBjbGFzc05hbWU6ICdicnVzaCBjbGFzc05hbWUnLFxuICAgICAgICB0aXRsZTogJ2JydXNoIHRpdGxlJ1xuICAgICAgfVxuICAgIH1cbiAgICovXG4gIGRyYXdpbmdUb29sczoge30sXG4gIGluc2VydERyYXdpbmdUb29sOiBmYWxzZSxcbiAgYWN0aW9uczogZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuU2xpZGVDYW52YXMucHJvdG90eXBlLmFjdGlvbnMse1xuICAgIGRyYXdpbmdUb29sOiB7XG4gICAgICB0aXRsZTogJ2RyYXdpbmctdG9vbCcsXG4gICAgICB0eXBlOiAnb3B0aW9ucycsXG4gICAgICB2YWx1ZTogJ2ZyZWVEcmF3aW5nQnJ1c2gnLFxuICAgICAgbWVudTogZnVuY3Rpb24oKXtcbiAgICAgICAgdmFyIF90b29scyA9IHt9O1xuICAgICAgICBmb3IodmFyIGkgaW4gdGhpcy5hY3RpdmVEcmF3aW5nVG9vbHMpe1xuICAgICAgICAgIHZhciBfdG9vbCA9IHRoaXMuYWN0aXZlRHJhd2luZ1Rvb2xzW2ldO1xuICAgICAgICAgIF90b29sc1tfdG9vbF0gPSBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKHtvcHRpb246IF90b29sfSx0aGlzLmRyYXdpbmdUb29sc1tfdG9vbF0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBfdG9vbHM7XG4gICAgICB9XG4gICAgfVxuICB9KSxcbiAgZnJlZURyYXdpbmdCcnVzaDogJ1BlbmNpbEJydXNoJyxcbiAgZHJhd2luZ0NvbG9yOiBbMCwwLDAsMjU1XSxcbiAgX29uTW91c2VEb3duSW5EcmF3aW5nTW9kZTogZnVuY3Rpb24oZSkge1xuICAgIHRoaXMuX2lzQ3VycmVudGx5RHJhd2luZyA9IHRydWU7XG4gICAgaWYoIXRoaXMuZnJlZURyYXdpbmdCcnVzaC50YXJnZXQpe1xuICAgICAgdGhpcy5kaXNjYXJkQWN0aXZlT2JqZWN0KGUpLnJlbmRlckFsbCgpO1xuICAgIH1cbiAgICBpZiAodGhpcy5jbGlwVG8pIHtcbiAgICAgIGZhYnJpYy51dGlsLmNsaXBDb250ZXh0KHRoaXMsIHRoaXMuY29udGV4dFRvcCk7XG4gICAgfVxuICAgIHZhciBwb2ludGVyID0gdGhpcy5nZXRQb2ludGVyKGUpO1xuICAgIHRoaXMuZnJlZURyYXdpbmdCcnVzaC5vbk1vdXNlRG93bihwb2ludGVyKTtcbiAgICB0aGlzLl9oYW5kbGVFdmVudChlLCAnZG93bicpO1xuICB9LFxuICBnZXRGcmVlRHJhd2luZ0JydXNoOiBmdW5jdGlvbigpIHtcbiAgICBpZighdGhpcy5mcmVlRHJhd2luZ0JydXNoKXtcbiAgICAgIHJldHVybiBcIlNlbGVjdGlvblwiO1xuICAgIH1cbiAgICByZXR1cm4gIGZhYnJpYy51dGlsLnN0cmluZy5jYXBpdGFsaXplKGZhYnJpYy51dGlsLnN0cmluZy5jYW1lbGl6ZSh0aGlzLmZyZWVEcmF3aW5nQnJ1c2gudHlwZSksdHJ1ZSk7XG4gIH0sXG4gIHNldEZyZWVEcmF3aW5nQnJ1c2g6IGZ1bmN0aW9uKGJydXNoKSB7XG5cbiAgICBpZihicnVzaCA9PSAnU2VsZWN0aW9uJyl7XG4gICAgICB0aGlzLmlzRHJhd2luZ01vZGUgPSBmYWxzZTtcbiAgICAgIHRoaXMuZnJlZURyYXdpbmdCcnVzaCA9IFwiXCI7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHZhciBjbGFzc05hbWUgPSBmYWJyaWMudXRpbC5zdHJpbmcuY2FwaXRhbGl6ZShmYWJyaWMudXRpbC5zdHJpbmcuY2FtZWxpemUoYnJ1c2gpLHRydWUpO1xuICAgIGlmKHRoaXNbXCJfX1wiICsgY2xhc3NOYW1lXSl7XG4gICAgICB0aGlzLmZyZWVEcmF3aW5nQnJ1c2ggPSB0aGlzW1wiX19cIiArIGNsYXNzTmFtZV0gO1xuICAgIH1lbHNle1xuICAgICAgdGhpcy5mcmVlRHJhd2luZ0JydXNoID0gdGhpc1tcIl9fXCIgKyBjbGFzc05hbWVdID0gbmV3ICBmYWJyaWNbY2xhc3NOYW1lXSh0aGlzKTtcbiAgICB9XG4gICAgdGhpcy5maXJlKFwiYnJ1c2g6Y2hhbmdlZFwiLHticnVzaDogdGhpcy5mcmVlRHJhd2luZ0JydXNofSk7XG4gIH0sXG4gIGRyYXdab29tZWRBcmVhIDogZnVuY3Rpb24oY3R4LGxlZnQsIHRvcCAsd2lkdGgsIGhlaWdodCAsIHBvaW50ZXIgKSB7XG5cbiAgICB3aWR0aCA9IHdpZHRoIHx8IDkwO1xuICAgIGhlaWdodCA9IGhlaWdodCB8fCA5MDtcblxuICAgIGN0eC5zYXZlKCk7XG4gICAgY3R4LnRyYW5zbGF0ZShsZWZ0IHx8IDAsIHRvcCB8fCAwKTtcblxuICAgIGN0eC5maWxsU3R5bGUgPSAnYmxhY2snO1xuICAgIGN0eC5zdHJva2VTdHlsZSA9IFwiI2ZmZlwiO1xuICAgIGN0eC5zdHJva2VXaWR0aCA9IDE7XG4gICAgY3R4LnNldExpbmVEYXNoKFsyLCAyXSk7XG4gICAgY3R4LmRyYXdJbWFnZSh0aGlzLmJhY2tncm91bmRJbWFnZS5fZWxlbWVudCxNYXRoLmZsb29yKHBvaW50ZXIueCkgLSA0LCBNYXRoLmZsb29yKHBvaW50ZXIueSkgLSA0ICwgOSAsIDksIDAsMCAsIHdpZHRoLCB3aWR0aCApO1xuICAgIGN0eC5zdHJva2VSZWN0KDAsMCAsIHdpZHRoLCB3aWR0aCk7XG4gICAgY3R4LnN0cm9rZVJlY3QoNDAgLCA0MCAsIDEwLCAxMCk7XG4gICAgY3R4LnJlc3RvcmUoKTtcbiAgfVxufSk7XG5cbmZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUuZHJhd2luZ1Rvb2xzLlNlbGVjdGlvbiA9IHtcbiAgY2xhc3NOYW1lOiAnZmEgZmEtbW91c2UtcG9pbnRlcicsXG4gIHRpdGxlOiAnU2VsZWN0aW9uJ1xufTtcbmZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUuYWN0aXZlRHJhd2luZ1Rvb2xzLnB1c2goXCJTZWxlY3Rpb25cIik7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL21vZHVsZXMvc2xpZGUuZHJhd2luZy10b29scy5qcyIsIid1c2Ugc3RyaWN0JztcbmlmKCFUb29sYmFyKXtcbiAgdmFyIFRvb2xiYXIgPSByZXF1aXJlKCcuLy4uLy4uL3Rvb2xiYXIvdG9vbGJhcicpO1xuICByZXF1aXJlKCcuLy4uLy4uL3Rvb2xiYXIvbW9kdWxlcy90b29sYmFyLmNvbG9ycycpO1xuICByZXF1aXJlKCcuLy4uLy4uL3Rvb2xiYXIvbW9kdWxlcy90b29sYmFyLmZvbnRzJyk7XG4gIHJlcXVpcmUoJy4vLi4vLi4vdG9vbGJhci9tb2R1bGVzL3Rvb2xiYXIub3B0aW9ucycpO1xuICByZXF1aXJlKCcuLy4uLy4uL3Rvb2xiYXIvbW9kdWxlcy90b29sYmFyLnNlbGVjdCcpO1xuICByZXF1aXJlKCcuLy4uLy4uL3Rvb2xiYXIvbW9kdWxlcy90b29sYmFyLmVmZmVjdCcpO1xufVxuXG5Ub29sYmFyLnByb3RvdHlwZS5zZXRGdW5jdGlvbkNhbGxiYWNrID0gZnVuY3Rpb24odGFyZ2V0KXtcbiAgaWYodGFyZ2V0LmNhbnZhcyl7XG4gICAgcmV0dXJuIHRhcmdldC5jYW52YXMucmVuZGVyQWxsKCk7XG4gIH1cbiAgaWYodGFyZ2V0LnJlbmRlckFsbCl7XG4gICAgcmV0dXJuIHRhcmdldC5yZW5kZXJBbGwoKVxuICB9XG59O1xuXG5mYWJyaWMuVG9vbHNNaXhpbiA9IHtcbiAgLyoqXG4gICAqXG4gICAqIEBwYXJhbSB0b29scyBbXCJ4XCIsIFwiKlwiLCBcInlcIl1cbiAgICogQHBhcmFtIHByb3RvXG4gICAqIEByZXR1cm5zIFtcInhcIiwgXCJhXCIsIFwiYlwiLCBcImNcIiwgXCJ5XCJdXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBfZ2V0VG9vbHM6IGZ1bmN0aW9uKHRvb2xzLHByb3RvKXtcbiAgICB2YXIgaW5kZXhPZlN0YXIgPSAtMTtcbiAgICBpZigoaW5kZXhPZlN0YXIgPSB0b29scy5pbmRleE9mKFwiKlwiKSkgPT0gLTEpe1xuICAgICAgcmV0dXJuIHRvb2xzO1xuICAgIH1cblxuICAgIHZhciBrbGFzc25hbWUgPSBmYWJyaWMudXRpbC5zdHJpbmcuY2FwaXRhbGl6ZShmYWJyaWMudXRpbC5zdHJpbmcuY2FtZWxpemUocHJvdG8udHlwZSksdHJ1ZSk7XG4gICAgdmFyIHByb3RvRmFicmljID0gZmFicmljW2tsYXNzbmFtZV0ucHJvdG90eXBlO1xuICAgIHZhciBwcm90b0FwcCA9IHRoaXMuYXBwbGljYXRpb24ucHJvdG90eXBlc1trbGFzc25hbWVdO1xuXG4gICAgdmFyIHRvb2xzMiA9IHByb3RvQXBwICYmIHByb3RvQXBwLnRvb2xzIHx8IHByb3RvRmFicmljLnRvb2xzO1xuICAgIGlmKHRvb2xzMil7XG4gICAgICB0b29scy5zcGxpY2UuYXBwbHkodG9vbHMsIFtpbmRleE9mU3RhciwgMV0uY29uY2F0KHRvb2xzMikpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5fZ2V0VG9vbHModG9vbHMsIHByb3RvRmFicmljLl9fcHJvdG9fXyApO1xuICB9LFxuICBzZXRUb29sczogZnVuY3Rpb24odG9vbHMpe1xuICAgIHRoaXMudG9vbHMgPSB0aGlzLl9nZXRUb29scyh0b29scyAsIHRoaXMuX19wcm90b19fLl9fcHJvdG9fXyk7XG4gICAgdGhpcy5tYWtlQWN0aW9ucygpO1xuICB9LFxuICBfZ2V0QWN0aW9uVmFsdWU6IGZ1bmN0aW9uIChwcm9wZXJ0eSkge1xuICAgIHZhciBvYmplY3QgPSB0aGlzO1xuICAgIGRve1xuICAgICAgaWYob2JqZWN0LmFjdGlvbnMgJiYgb2JqZWN0LmFjdGlvbnNbcHJvcGVydHldKXtcbiAgICAgICAgcmV0dXJuIG9iamVjdC5hY3Rpb25zW3Byb3BlcnR5XTtcbiAgICAgIH1cbiAgICB9d2hpbGUob2JqZWN0ID0gb2JqZWN0Ll9fcHJvdG9fXyk7XG4gICAgcmV0dXJuIG51bGw7XG4gIH0sXG4gIG1ha2VBY3Rpb25zOiBmdW5jdGlvbigpe1xuICAgIHZhciBhY3Rpb25zID0ge307XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIF8uZWFjaCh0aGlzLnRvb2xzLCBmdW5jdGlvbih0b29sKXtcbiAgICAgIHZhciBfdmFsID0gc2VsZi5fZ2V0QWN0aW9uVmFsdWUodG9vbCk7XG4gICAgICBpZihfdmFsKXtcbiAgICAgICAgYWN0aW9uc1t0b29sXSA9IF92YWw7XG4gICAgICB9ZWxzZXtcbiAgICAgICAgY29uc29sZS53YXJuKFwidG9vbCBcIiArIHRvb2wgKyBcIiBpcyB1bmRlZmluZWRcIik7XG4gICAgICB9XG4gICAgfSk7XG4gICAgdGhpcy5nZW5lcmF0ZWRBY3Rpb25zID0gVG9vbGJhci5tYWtlQWN0aW9ucyhhY3Rpb25zLHRoaXMpO1xuICB9XG59O1xuXG5mYWJyaWMuVG9vbGJhciA9IFRvb2xiYXI7XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLk9iamVjdC5wcm90b3R5cGUsZmFicmljLlRvb2xzTWl4aW4se1xuICBvcHRpb25zT3JkZXI6IChmdW5jdGlvbigpe1xuICAgIHZhciBvbyA9IGZhYnJpYy5PYmplY3QucHJvdG90eXBlLm9wdGlvbnNPcmRlcjtcbiAgICBvby5wdXNoKFwiYWN0aW9uc1wiLFwidG9vbHNcIik7XG4gICAgcmV0dXJuIG9vO1xuICB9KSgpXG59KTtcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuQXBwbGljYXRpb24ucHJvdG90eXBlLCBmYWJyaWMuVG9vbHNNaXhpbiAse1xuICBvcHRpb25zT3JkZXI6IChmdW5jdGlvbigpe1xuICAgIHZhciBvbyA9IGZhYnJpYy5BcHBsaWNhdGlvbi5wcm90b3R5cGUub3B0aW9uc09yZGVyO1xuICAgIG9vLnB1c2goXCJhY3Rpb25zXCIsXCJ0b29sc1wiKTtcbiAgICByZXR1cm4gb287XG4gIH0pKCksXG4gIG9iamVjdHNUb29sYmFyQ29udGFpbmVyOiBudWxsLFxuICBzZXRUb29sYmFyczogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgIGlmKG9wdGlvbnMuYXBwbGljYXRpb24pe1xuICAgICAgbmV3IGZhYnJpYy5Ub29sYmFyKHRoaXMsIG9wdGlvbnMuYXBwbGljYXRpb24uY29udGFpbmVyLCBvcHRpb25zLmFwcGxpY2F0aW9uLCB0aGlzLmdlbmVyYXRlZEFjdGlvbnMpO1xuICAgIH1cbiAgICBpZihvcHRpb25zLmNhbnZhcyl7XG4gICAgICBuZXcgZmFicmljLlRvb2xiYXIodGhpcy5jYW52YXMsIG9wdGlvbnMuY2FudmFzLmNvbnRhaW5lciwgb3B0aW9ucy5jYW52YXMsIHRoaXMuY2FudmFzLmdlbmVyYXRlZEFjdGlvbnMpO1xuICAgIH1cbiAgICBpZihvcHRpb25zLm9iamVjdHMpe1xuICAgICAgdmFyIGNhbnZhcyA9IHRoaXMuY2FudmFzO1xuXG4gICAgICBpZiAob3B0aW9ucy5vYmplY3RzLmNvbnRhaW5lcikge1xuICAgICAgICB0aGlzLm9iamVjdHNUb29sYmFyQ29udGFpbmVyID0gJChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChvcHRpb25zLm9iamVjdHMuY29udGFpbmVyKSkuaGlkZSgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5vYmplY3RzVG9vbGJhckNvbnRhaW5lciA9ICQoJzxkaXY+Jyk7XG4gICAgICAgICQodGhpcy53cmFwcGVyRWwpLnByZXBlbmQodGhpcy5vYmplY3RzVG9vbGJhckNvbnRhaW5lcik7XG4gICAgICB9XG4gICAgICB2YXIgJG1lbnUgPSB0aGlzLm9iamVjdHNUb29sYmFyQ29udGFpbmVyO1xuICAgICAgJG1lbnUuaGlkZSgpO1xuICAgICAgaWYob3B0aW9ucy5vYmplY3RzLnBvc2l0aW9uKXtcbiAgICAgICAgZmFicmljLnV0aWwub2JqZWN0cy5kZWZhdWx0cyhvcHRpb25zLm9iamVjdHMucG9zaXRpb24sIHtcbiAgICAgICAgICBvcmlnaW5YOiBcImxlZnRcIixcbiAgICAgICAgICBvcmlnaW5ZOiBcInRvcFwiLFxuICAgICAgICAgIG1hcmdpblg6IDAsXG4gICAgICAgICAgbWFyZ2luWTogMFxuICAgICAgICB9KTtcbiAgICAgICAgJG1lbnUuYWRkQ2xhc3MoXCJmbG9hdGVkLW1lbnVcIik7XG4gICAgICAgICRtZW51LmNzcyh7XG4gICAgICAgICAgXCJwb3NpdGlvblwiOiBcImFic29sdXRlXCIsXG4gICAgICAgICAgXCJ6LWluZGV4XCI6IDk5OVxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgdmFyIF9sYXN0X3RhcmdldCA9IGNhbnZhcy50YXJnZXQ7XG4gICAgICBjYW52YXMub24oe1xuICAgICAgICAndGFyZ2V0OmNsZWFyZWQnOiBldmVudCA9PiB7XG4gICAgICAgICAgaWYgKF9sYXN0X3RhcmdldCkge1xuICAgICAgICAgICAgJG1lbnUuaGlkZSgpO1xuICAgICAgICAgICAgY2FudmFzLm9iamVjdFRvb2xiYXIuZGVzdHJveSgpO1xuICAgICAgICAgICAgZGVsZXRlIGNhbnZhcy5vYmplY3RUb29sYmFyO1xuICAgICAgICAgICAgX2xhc3RfdGFyZ2V0ID0gbnVsbDtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgICd0YXJnZXQ6Y2hhbmdlZCc6IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgIGlmIChfbGFzdF90YXJnZXQpIHtcbiAgICAgICAgICAgIGNhbnZhcy5vYmplY3RUb29sYmFyLmRlc3Ryb3koKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgJG1lbnUuc2hvdygpO1xuICAgICAgICAgIGlmICh0aGlzLnRhcmdldC5hY3Rpb25zKSB7XG4gICAgICAgICAgICB0aGlzLm9iamVjdFRvb2xiYXIgPSBuZXcgZmFicmljLlRvb2xiYXIodGhpcy50YXJnZXQsICRtZW51LCBvcHRpb25zLm9iamVjdHMsIHRoaXMudGFyZ2V0LmdlbmVyYXRlZEFjdGlvbnMpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAob3B0aW9ucy5vYmplY3RzLnBvc2l0aW9uKSB7XG4gICAgICAgICAgICB0aGlzLnNldFRvb2xiYXJDb29yZHMoJG1lbnUsIHRoaXMudGFyZ2V0LCBvcHRpb25zLm9iamVjdHMucG9zaXRpb24pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBfbGFzdF90YXJnZXQgPSBldmVudC50YXJnZXQ7XG4gICAgICAgIH0sXG4gICAgICAgICdvYmplY3Q6bW92aW5nJzogZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgaWYob3B0aW9ucy5vYmplY3RzLnBvc2l0aW9uKXtcbiAgICAgICAgICAgIGNhbnZhcy5zZXRUb29sYmFyQ29vcmRzKCRtZW51LCBjYW52YXMudGFyZ2V0LCBvcHRpb25zLm9iamVjdHMucG9zaXRpb24pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICB9XG4gIH0sXG4gIC8qc2V0VG9vbGJhck9wdGlvbnM6IGZ1bmN0aW9uKHRvb2xiYXJPcHRpb25zKXtcblxuICAgIGZhYnJpYy51dGlsLm9iamVjdC5kZWVwRXh0ZW5kKFRvb2xiYXIudG9vbHMsIHRvb2xiYXJPcHRpb25zLnRvb2xzKTtcbiAgICBmb3IgKHZhciBrbGFzc05hbWUgaW4gdG9vbGJhck9wdGlvbnMuYWN0aW9ucykge1xuICAgICAgdmFyIGFjdGlvbnMgPSB0b29sYmFyT3B0aW9ucy5hY3Rpb25zW2tsYXNzTmFtZV07XG4gICAgICBpZighZmFicmljW2tsYXNzTmFtZV0ucHJvdG90eXBlLmFjdGlvbnMpe1xuICAgICAgICBmYWJyaWNba2xhc3NOYW1lXS5wcm90b3R5cGUuYWN0aW9ucyA9IHt9XG4gICAgICB9XG4gICAgICB2YXIgcHJvdG9BY3Rpb25zID0gZmFicmljW2tsYXNzTmFtZV0ucHJvdG90eXBlLmFjdGlvbnM7XG5cbiAgICAgIGlmIChhY3Rpb25zLmNvbnN0cnVjdG9yID09IEZ1bmN0aW9uKSB7XG4gICAgICAgIGFjdGlvbnMgPSBhY3Rpb25zLmNhbGwoZmFicmljW2tsYXNzTmFtZV0ucHJvdG90eXBlKVxuICAgICAgfWVsc2V7XG4gICAgICAgIGFjdGlvbnMgPSBmYWJyaWMudXRpbC5vYmplY3QuY2xvbmVEZWVwKGFjdGlvbnMpO1xuICAgICAgfVxuICAgICAvLyB2YXIgJG9yZGVyID0gYWN0aW9uc1tcIiRvcmRlclwiXTtcbiAgICAgLy8gZGVsZXRlIGFjdGlvbnNbXCIkb3JkZXJcIl07XG5cbiAgICAgIGZvciAodmFyIGogaW4gYWN0aW9ucykge1xuICAgICAgICBpZihwcm90b0FjdGlvbnNbal0pe1xuICAgICAgICAgIGlmIChhY3Rpb25zW2pdW1wiJGNsb25lXCJdKSB7XG4gICAgICAgICAgICBwcm90b0FjdGlvbnNbal0gPSBmYWJyaWMudXRpbC5vYmplY3QuZGVlcEV4dGVuZCh7fSwgcHJvdG9BY3Rpb25zW2pdKTtcbiAgICAgICAgICAgIGRlbGV0ZSBhY3Rpb25zW2pdW1wiJGNsb25lXCJdO1xuICAgICAgICAgIH1cbiAgICAgICAgICBmYWJyaWMudXRpbC5vYmplY3QuZGVlcEV4dGVuZChwcm90b0FjdGlvbnNbal0sIGFjdGlvbnNbal0pO1xuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICBwcm90b0FjdGlvbnNbal0gPSBhY3Rpb25zW2pdO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9LCovXG4gIGV2ZW50TGlzdGVuZXJzOiBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kQXJyYXlzT2JqZWN0KGZhYnJpYy5BcHBsaWNhdGlvbi5wcm90b3R5cGUuZXZlbnRMaXN0ZW5lcnMsIHtcbiAgIC8vIFwiY2FudmFzOmNyZWF0ZWRcIiA6IGZ1bmN0aW9uKCl7XG4gICAgLy8gIHRoaXMuaW5pdFRvb2xzKCk7XG4gICAvLyB9LFxuICAgLy8gIFwiY2FudmFzOmNyZWF0ZWRcIjogZnVuY3Rpb24oKXtcbiAgIC8vICAgIHRoaXMuY3JlYXRlVG9vbGJhcnMoKTtcbiAgIC8vICB9XG4gIH0pXG59KTtcblxuLy90b2RvINC90YPQttC90L4g0YHQtNC10LvQsNGC0Ywg0L/QvtGA0Y/QtNC+0Log0YHQstC+0LnRgdGCINGD0L3QsNGB0LvQtdC00YPQtdC80YvQvFxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuU3RhdGljQ2FudmFzLnByb3RvdHlwZSwgZmFicmljLlRvb2xzTWl4aW4sIHtcbiAgb3B0aW9uc09yZGVyOiAoZnVuY3Rpb24gKCkge1xuICAgIHZhciBvbyA9IGZhYnJpYy5TdGF0aWNDYW52YXMucHJvdG90eXBlLm9wdGlvbnNPcmRlcjtcbiAgICBvby5wdXNoKFwiYWN0aW9uc1wiLCBcInRvb2xzXCIpO1xuICAgIHJldHVybiBvbztcbiAgfSkoKVxufSk7XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLkNhbnZhcy5wcm90b3R5cGUsIGZhYnJpYy5Ub29sc01peGluLCB7XG4gIC8vIG9wdGlvbnNPcmRlcjogKGZ1bmN0aW9uKCl7XG4gIC8vICAgdmFyIG9vID0gZmFicmljLkNhbnZhcy5wcm90b3R5cGUub3B0aW9uc09yZGVyO1xuICAvLyAgIG9vLnB1c2goXCJhY3Rpb25zXCIsXCJ0b29sc1wiKTtcbiAgLy8gICByZXR1cm4gb287XG4gIC8vIH0pKCksXG4gIHNldFRvb2xiYXJDb29yZHM6IGZ1bmN0aW9uICgkbWVudSwgdGFyZ2V0LCBvcHRpb25zKSB7XG5cbiAgICBvcHRpb25zID0gZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCh7XG4gICAgICBvcmlnaW5YOiBcImxlZnRcIixcbiAgICAgIG9yaWdpblk6IFwidG9wXCIsXG4gICAgICBtYXJnaW5YOiAwLFxuICAgICAgbWFyZ2luWTogMFxuICAgIH0sIG9wdGlvbnMpO1xuXG4gICAgdGFyZ2V0LnNldENvb3JkcygpO1xuICAgIHZhciByID0gdGFyZ2V0LmdldEJvdW5kaW5nUmVjdCgpO1xuXG4gICAgdmFyIF9sZWZ0O1xuICAgIHN3aXRjaCAob3B0aW9ucy5vcmlnaW5YKSB7XG4gICAgICBjYXNlIFwibGVmdFwiOlxuICAgICAgICBfbGVmdCA9IHIubGVmdDtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwicmlnaHRcIjpcbiAgICAgICAgX2xlZnQgPSByLmxlZnQgKyByLndpZHRoO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJjZW50ZXJcIjpcbiAgICAgICAgX2xlZnQgPSByLmxlZnQgKyByLndpZHRoIC8gMjtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICAgIDtcbiAgICB2YXIgX3RvcDtcbiAgICBzd2l0Y2ggKG9wdGlvbnMub3JpZ2luWSkge1xuICAgICAgY2FzZSBcInRvcFwiOlxuICAgICAgICBfdG9wID0gci50b3AgLSAkbWVudS5oZWlnaHQoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwiYm90dG9tXCI6XG4gICAgICAgIF90b3AgPSByLnRvcCArIHIuaGVpZ2h0O1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJjZW50ZXJcIjpcbiAgICAgICAgX3RvcCA9IHIudG9wICsgci5oZWlnaHQgLyAyIC0gJG1lbnUuaGVpZ2h0KCkgLyAyO1xuICAgICAgICBicmVhaztcbiAgICB9XG4gICAgO1xuXG5cbiAgICBfdG9wICs9IG9wdGlvbnMubWFyZ2luWTtcbiAgICBfbGVmdCArPSBvcHRpb25zLm1hcmdpblhcblxuICAgIHZhciBfbWVudUNvbnRhaW5lck9mZnNldCA9ICQoJG1lbnUucGFyZW50cygpWzBdKS5vZmZzZXQoKTtcbiAgICB2YXIgX2NhbnZhc09mZnNldCA9ICQodGhpcy53cmFwcGVyRWwpLm9mZnNldCgpO1xuXG4gICAgX3RvcCArPSBfY2FudmFzT2Zmc2V0LnRvcCAtIF9tZW51Q29udGFpbmVyT2Zmc2V0LnRvcDtcbiAgICBfbGVmdCArPSBfY2FudmFzT2Zmc2V0LmxlZnQgLSBfbWVudUNvbnRhaW5lck9mZnNldC5sZWZ0O1xuXG4gICAgdmFyIGNvb3JkcyA9IHtcbiAgICAgIHRvcDogTWF0aC5tYXgoMywgX3RvcCksXG4gICAgICBsZWZ0OiBNYXRoLm1pbihNYXRoLm1heCgzLCBfbGVmdCksICQodGhpcy53cmFwcGVyRWwpLndpZHRoKCkgLSAkbWVudS53aWR0aCgpIC0gNSlcbiAgICB9O1xuXG5cbiAgICAkKHRoaXMud3JhcHBlckVsKS5vZmZzZXQoKTtcblxuICAgICRtZW51LmNzcyhjb29yZHMpO1xuICAgIHJldHVybiBjb29yZHM7XG4gIH1cbn0pO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9tb2R1bGVzL3Rvb2xiYXIuanMiLCJpZighJC5taW5pY29sb3JzKXtcbiAgICByZXF1aXJlKFwiLi4vLi4vcGx1Z2lucy8kLm1pbmljb2xvcnNcIik7XG59XG5cbmlmKHR5cGVvZiBUb29sYmFyID09PSBcInVuZGVmaW5lZFwiKXtcbiAgdmFyIFRvb2xiYXIgPSByZXF1aXJlKFwiLi4vdG9vbGJhclwiKTtcbn1cblxuVG9vbGJhci5wcm90b3R5cGUuY29sb3JwaWNrZXIgPSBmdW5jdGlvbiAoZWwsIG9wdGlvbnMpIHtcbiAgb3B0aW9ucy5mb3JtYXQgPSAncmdiJztcbiAgb3B0aW9ucy5vcGFjaXR5ID0gdHJ1ZTtcbiAgZWwubWluaWNvbG9ycyhvcHRpb25zKTtcbn07XG5cblRvb2xiYXIucHJvdG90eXBlLmNvbG9ycGlja2VyT3B0aW9ucyA9IHtcbiAgcG9zaXRpb246IFwicmlnaHQgYm90dG9tXCJcbn07XG5cblRvb2xiYXIucHJvdG90eXBlLnRvb2xzLmNvbG9yID0ge1xuICB0ZW1wbGF0ZTpcbiAgICAnPGRpdiBjbGFzcz1cIm9iamVjdC1tZW51LWl0ZW1cIiB0aXRsZT1cInt0aXRsZX1cIj4nICtcbiAgICAnPGRpdiBjbGFzcz1cImJ0biBidXR0b24te2lkfSB7Y2xhc3NOYW1lfVwiPicgK1xuICAgICc8aW5wdXQgdHlwZT1cInRleHRcIiBkYXRhLWZvcm1hdD1cInJnYmFcIiBkYXRhLW9wYWNpdHk9XCJ0cnVlXCIgZGF0YS10ZXh0PVwidHJ1ZVwiIGRhdGEtY29udHJvbD1cInNhdHVyYXRpb25cIiBkYXRhLXN3YXRjaGVzPVwiI2ZmZnwjMDAwfCNmMDB8IzBmMHwjMDBmfCNmZjB8IzBmZlwiICB2YWx1ZT1cInt2YWx1ZUN1cnJlbnR9XCIgdHJhbnNjbHVkZT4nLFxuICBwb3N0OiBmdW5jdGlvbiAoJGl0ZW0sIGRhdGEsIG9wdGlvbnMsIHRyYW5zY2x1ZGUpIHtcbiAgICAvL3ZhciB0YXJnZXQgPSBkYXRhLnRhcmdldDtcblxuICAgIHZhciBfdmlzaWJsZSA9IGZhbHNlO1xuICAgIHRoaXMuY29sb3JwaWNrZXIodHJhbnNjbHVkZSwgZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCh7XG4gICAgICAvLyB2YWx1ZTogICAgICAgIGRhdGEudmFsdWUuZ2V0KCkgLC8vfHwgZGF0YS52YWx1ZS5nZXQoKSxcbiAgICAgIGRlZmF1bHRWYWx1ZTogLypkYXRhLnZhbHVlLmRlZmF1bHRWYWx1ZSB8fCovIGRhdGEudmFsdWUuZ2V0KCksXG4gICAgICBjb250cm9sOiAgICAgICdodWUnLFxuICAgICAgZm9ybWF0OiAgICAgICAnaGV4JyxcbiAgICAgIGtleXdvcmRzOiAgICAgJycsXG4gICAgICBpbmxpbmU6ICAgICAgIGZhbHNlLFxuICAgICAgbGV0dGVyQ2FzZTogICAnbG93ZXJjYXNlJyxcbiAgICAgIG9wYWNpdHk6ICAgICAgdHJ1ZSxcbiAgICAgIHBvc2l0aW9uOiAgICAgXCJyaWdodCBib3R0b21cIixcbiAgICAgIHN3YXRjaGVzOiAgICAgXCIjZmZmfCMwMDB8I2YwMHwjMGYwfCMwMGZ8I2ZmMHwjMGZmXCIuc3BsaXQoJ3wnKSxcbiAgICAgIHRleHQ6ICAgICAgICAgdHJ1ZSxcbiAgICAgIGhpZGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgX3Zpc2libGUgPSBmYWxzZVxuICAgICAgfSxcbiAgICAgIHNob3c6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgX3Zpc2libGUgPSB0cnVlO1xuICAgICAgfSxcbiAgICAgIGNoYW5nZTogZnVuY3Rpb24gKHZhbHVlLCBvcGFjaXR5KSB7XG4gICAgICAgIGRhdGEudmFsdWUuc2V0KHZhbHVlKTtcbiAgICAgIH1cbiAgICB9LG9wdGlvbnMuY29sb3JwaWNrZXIpKTtcblxuICAgIHZhciBfZWwgPSAkKHRyYW5zY2x1ZGUucGFyZW50cygpWzBdKS5maW5kKFwiLm1pbmljb2xvcnMtcGFuZWxcIik7XG5cbiAgICB2YXIgX0hJREUgPSBmdW5jdGlvbihlKXtcbiAgICAgIGlmKF92aXNpYmxlICYmICQoZS50YXJnZXQpLnBhcmVudHMoKS5pbmRleChfZWwpID09IC0xKXtcbiAgICAgICAgdHJhbnNjbHVkZS5taW5pY29sb3JzKFwiaGlkZVwiKTtcbiAgICAgICAgJChcImJvZHlcIikub2ZmKFwibW91c2Vkb3duXCIsX0hJREUpO1xuICAgICAgfVxuICAgIH07XG4gICAgJChcImJvZHlcIikub24oXCJtb3VzZWRvd25cIixfSElERSlcbiAgfVxufTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyB0b29sYmFyL21vZHVsZXMvdG9vbGJhci5jb2xvcnMuanMiLCIvKlxuICogalF1ZXJ5IE1pbmlDb2xvcnM6IEEgdGlueSBjb2xvciBwaWNrZXIgYnVpbHQgb24galF1ZXJ5XG4gKlxuICogQ29weXJpZ2h0OiBDb3J5IExhVmlza2EgZm9yIEEgQmVhdXRpZnVsIFNpdGUsIExMQzogaHR0cDovL3d3dy5hYmVhdXRpZnVsc2l0ZS5uZXQvXG4gKlxuICogQ29udHJpYnV0ZTogaHR0cHM6Ly9naXRodWIuY29tL2NsYXZpc2thL2pxdWVyeS1taW5pY29sb3JzXG4gKlxuICogQGxpY2Vuc2U6IGh0dHA6Ly9vcGVuc291cmNlLm9yZy9saWNlbnNlcy9NSVRcbiAqXG4gKi9cblxuXG5cbihmdW5jdGlvbiAoZmFjdG9yeSkge1xuICBpZiAodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KHJlcXVpcmUoJ2pxdWVyeScpKTtcbiAgfSBlbHNlIHtcbiAgICBmYWN0b3J5KGpRdWVyeSk7XG4gIH1cbn0oXG4gIGZ1bmN0aW9uICgkKSB7XG5cbiAgICAndXNlIHN0cmljdCc7XG4gICAgLy9pZihfICYmIF8uc3R5bGVTaGVldENvbnRhaW5zICYmICFfLnN0eWxlU2hlZXRDb250YWlucygnLm1pbmljb2xvcnMnKSl7XG4gICAgLy8gIF8ubGlua0NTUyhfLnNjcmlwdFVSTCgpICsgXCIvLi4vLi4vY3NzL2pxdWVyeS5taW5pY29sb3JzLmNzc1wiKTtcbiAgICAvL31cblxuICAgIC8vIERlZmF1bHRzXG4gICAgJC5taW5pY29sb3JzID0ge1xuICAgICAgZGVmYXVsdHM6IHtcbiAgICAgICAgYW5pbWF0aW9uU3BlZWQ6IDUwLFxuICAgICAgICBhbmltYXRpb25FYXNpbmc6ICdzd2luZycsXG4gICAgICAgIGNoYW5nZTogbnVsbCxcbiAgICAgICAgY2hhbmdlRGVsYXk6IDAsXG4gICAgICAgIGNvbnRyb2w6ICdodWUnLFxuICAgICAgICBkYXRhVXJpczogdHJ1ZSxcbiAgICAgICAgZGVmYXVsdFZhbHVlOiAnJyxcbiAgICAgICAgZm9ybWF0OiAnaGV4JyxcbiAgICAgICAgaGlkZTogbnVsbCxcbiAgICAgICAgaGlkZVNwZWVkOiAxMDAsXG4gICAgICAgIGlubGluZTogZmFsc2UsXG4gICAgICAgIGtleXdvcmRzOiAnJyxcbiAgICAgICAgbGV0dGVyQ2FzZTogJ2xvd2VyY2FzZScsXG4gICAgICAgIG9wYWNpdHk6IGZhbHNlLFxuICAgICAgICBwb3NpdGlvbjogJ2JvdHRvbSBsZWZ0JyxcbiAgICAgICAgc2hvdzogbnVsbCxcbiAgICAgICAgc2hvd1NwZWVkOiAxMDAsXG4gICAgICAgIHRoZW1lOiAnZGVmYXVsdCcsXG4gICAgICAgIHN3YXRjaGVzOiBbXVxuICAgICAgfVxuICAgIH07XG5cbiAgICAvLyBQdWJsaWMgbWV0aG9kc1xuICAgICQuZXh0ZW5kKCQuZm4sIHtcbiAgICAgIG1pbmljb2xvcnM6IGZ1bmN0aW9uKG1ldGhvZCwgZGF0YSkge1xuXG4gICAgICAgIHN3aXRjaChtZXRob2QpIHtcblxuICAgICAgICAgIC8vIERlc3Ryb3kgdGhlIGNvbnRyb2xcbiAgICAgICAgICBjYXNlICdkZXN0cm95JzpcbiAgICAgICAgICAgICQodGhpcykuZWFjaCggZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgIGRlc3Ryb3koJCh0aGlzKSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiAkKHRoaXMpO1xuXG4gICAgICAgICAgLy8gSGlkZSB0aGUgY29sb3IgcGlja2VyXG4gICAgICAgICAgY2FzZSAnaGlkZSc6XG4gICAgICAgICAgICBoaWRlKCk7XG4gICAgICAgICAgICByZXR1cm4gJCh0aGlzKTtcblxuICAgICAgICAgIC8vIEdldC9zZXQgb3BhY2l0eVxuICAgICAgICAgIGNhc2UgJ29wYWNpdHknOlxuICAgICAgICAgICAgLy8gR2V0dGVyXG4gICAgICAgICAgICBpZiggZGF0YSA9PT0gdW5kZWZpbmVkICkge1xuICAgICAgICAgICAgICAvLyBHZXR0ZXJcbiAgICAgICAgICAgICAgcmV0dXJuICQodGhpcykuYXR0cignZGF0YS1vcGFjaXR5Jyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAvLyBTZXR0ZXJcbiAgICAgICAgICAgICAgJCh0aGlzKS5lYWNoKCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB1cGRhdGVGcm9tSW5wdXQoJCh0aGlzKS5hdHRyKCdkYXRhLW9wYWNpdHknLCBkYXRhKSk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuICQodGhpcyk7XG5cbiAgICAgICAgICAvLyBHZXQgYW4gUkdCKEEpIG9iamVjdCBiYXNlZCBvbiB0aGUgY3VycmVudCBjb2xvci9vcGFjaXR5XG4gICAgICAgICAgY2FzZSAncmdiT2JqZWN0JzpcbiAgICAgICAgICAgIHJldHVybiByZ2JPYmplY3QoJCh0aGlzKSwgbWV0aG9kID09PSAncmdiYU9iamVjdCcpO1xuXG4gICAgICAgICAgLy8gR2V0IGFuIFJHQihBKSBzdHJpbmcgYmFzZWQgb24gdGhlIGN1cnJlbnQgY29sb3Ivb3BhY2l0eVxuICAgICAgICAgIGNhc2UgJ3JnYlN0cmluZyc6XG4gICAgICAgICAgY2FzZSAncmdiYVN0cmluZyc6XG4gICAgICAgICAgICByZXR1cm4gcmdiU3RyaW5nKCQodGhpcyksIG1ldGhvZCA9PT0gJ3JnYmFTdHJpbmcnKTtcblxuICAgICAgICAgIC8vIEdldC9zZXQgc2V0dGluZ3Mgb24gdGhlIGZseVxuICAgICAgICAgIGNhc2UgJ3NldHRpbmdzJzpcbiAgICAgICAgICAgIGlmKCBkYXRhID09PSB1bmRlZmluZWQgKSB7XG4gICAgICAgICAgICAgIHJldHVybiAkKHRoaXMpLmRhdGEoJ21pbmljb2xvcnMtc2V0dGluZ3MnKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIC8vIFNldHRlclxuICAgICAgICAgICAgICAkKHRoaXMpLmVhY2goIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9ICQodGhpcykuZGF0YSgnbWluaWNvbG9ycy1zZXR0aW5ncycpIHx8IHt9O1xuICAgICAgICAgICAgICAgIGRlc3Ryb3koJCh0aGlzKSk7XG4gICAgICAgICAgICAgICAgJCh0aGlzKS5taW5pY29sb3JzKCQuZXh0ZW5kKHRydWUsIHNldHRpbmdzLCBkYXRhKSk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuICQodGhpcyk7XG5cbiAgICAgICAgICAvLyBTaG93IHRoZSBjb2xvciBwaWNrZXJcbiAgICAgICAgICBjYXNlICdzaG93JzpcbiAgICAgICAgICAgIHNob3coICQodGhpcykuZXEoMCkgKTtcbiAgICAgICAgICAgIHJldHVybiAkKHRoaXMpO1xuXG4gICAgICAgICAgLy8gR2V0L3NldCB0aGUgaGV4IGNvbG9yIHZhbHVlXG4gICAgICAgICAgY2FzZSAndmFsdWUnOlxuICAgICAgICAgICAgaWYoIGRhdGEgPT09IHVuZGVmaW5lZCApIHtcbiAgICAgICAgICAgICAgLy8gR2V0dGVyXG4gICAgICAgICAgICAgIHJldHVybiAkKHRoaXMpLnZhbCgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgLy8gU2V0dGVyXG4gICAgICAgICAgICAgICQodGhpcykuZWFjaCggZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYoIHR5cGVvZihkYXRhKSA9PT0gJ29iamVjdCcgKSB7XG4gICAgICAgICAgICAgICAgICBpZiggZGF0YS5vcGFjaXR5ICkge1xuICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmF0dHIoJ2RhdGEtb3BhY2l0eScsIGtlZXBXaXRoaW4oZGF0YS5vcGFjaXR5LCAwLCAxKSk7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICBpZiggZGF0YS5jb2xvciApIHtcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS52YWwoZGF0YS5jb2xvcik7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICQodGhpcykudmFsKGRhdGEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB1cGRhdGVGcm9tSW5wdXQoJCh0aGlzKSk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuICQodGhpcyk7XG5cbiAgICAgICAgICAvLyBJbml0aWFsaXplcyB0aGUgY29udHJvbFxuICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICBpZiggbWV0aG9kICE9PSAnY3JlYXRlJyApIGRhdGEgPSBtZXRob2Q7XG4gICAgICAgICAgICAkKHRoaXMpLmVhY2goIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICBpbml0KCQodGhpcyksIGRhdGEpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gJCh0aGlzKTtcblxuICAgICAgICB9XG5cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHZhciBpbnB1dFRleHQsIGdsb2JhbFNldHRpbmdzLCBnbG9iYWxUYXJnZXQgLCBnbG9iYWxJbnB1dCA7XG4gICAgLy8gSW5pdGlhbGl6ZSBpbnB1dCBlbGVtZW50c1xuICAgIGZ1bmN0aW9uIGluaXQoaW5wdXQsIHNldHRpbmdzKSB7XG5cbiAgICAgIHZhciBtaW5pY29sb3JzID0gJCgnPGRpdiBjbGFzcz1cIm1pbmljb2xvcnNcIiAvPicpLFxuICAgICAgICBkZWZhdWx0cyA9ICQubWluaWNvbG9ycy5kZWZhdWx0cyxcbiAgICAgICAgc2l6ZSxcbiAgICAgICAgc3dhdGNoZXMsXG4gICAgICAgIHRleHRQYW5lbCxcbiAgICAgICAgc3dhdGNoLFxuICAgICAgICBwYW5lbCxcbiAgICAgICAgZ2xvYmFsVGFyZ2V0ID0gaW5wdXQsXG4gICAgICAgIGk7XG5cbiAgICAgIC8vIERvIG5vdGhpbmcgaWYgYWxyZWFkeSBpbml0aWFsaXplZFxuICAgICAgaWYoIGlucHV0LmRhdGEoJ21pbmljb2xvcnMtaW5pdGlhbGl6ZWQnKSApIHJldHVybjtcblxuICAgICAgLy8gSGFuZGxlIHNldHRpbmdzXG4gICAgICBnbG9iYWxTZXR0aW5ncyA9IHNldHRpbmdzID0gJC5leHRlbmQodHJ1ZSwge30sIGRlZmF1bHRzLCBzZXR0aW5ncyk7XG5cbiAgICAgIC8vIFRoZSB3cmFwcGVyXG4gICAgICBtaW5pY29sb3JzXG4gICAgICAgIC5hZGRDbGFzcygnbWluaWNvbG9ycy10aGVtZS0nICsgc2V0dGluZ3MudGhlbWUpXG4gICAgICAgIC50b2dnbGVDbGFzcygnbWluaWNvbG9ycy13aXRoLW9wYWNpdHknLCBzZXR0aW5ncy5vcGFjaXR5KVxuICAgICAgICAudG9nZ2xlQ2xhc3MoJ21pbmljb2xvcnMtbm8tZGF0YS11cmlzJywgc2V0dGluZ3MuZGF0YVVyaXMgIT09IHRydWUpO1xuXG4gICAgICAvLyBDdXN0b20gcG9zaXRpb25pbmdcbiAgICAgIGlmKCBzZXR0aW5ncy5wb3NpdGlvbiAhPT0gdW5kZWZpbmVkICkge1xuICAgICAgICAkLmVhY2goc2V0dGluZ3MucG9zaXRpb24uc3BsaXQoJyAnKSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgbWluaWNvbG9ycy5hZGRDbGFzcygnbWluaWNvbG9ycy1wb3NpdGlvbi0nICsgdGhpcyk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBJbnB1dCBzaXplXG4gICAgICBpZiggc2V0dGluZ3MuZm9ybWF0ID09PSAncmdiJyApIHtcbiAgICAgICAgc2l6ZSA9IHNldHRpbmdzLm9wYWNpdHkgPyAnMjUnIDogJzIwJztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHNpemUgPSBzZXR0aW5ncy5rZXl3b3JkcyA/ICcxMScgOiAnNyc7XG4gICAgICB9XG4gICAgICAgZ2xvYmFsSW5wdXQgPSBpbnB1dDtcbiAgICAgIC8vIFRoZSBpbnB1dFxuICAgICAgaW5wdXRcbiAgICAgICAgLmFkZENsYXNzKCdtaW5pY29sb3JzLWlucHV0JylcbiAgICAgICAgLmRhdGEoJ21pbmljb2xvcnMtaW5pdGlhbGl6ZWQnLCBmYWxzZSlcbiAgICAgICAgLmRhdGEoJ21pbmljb2xvcnMtc2V0dGluZ3MnLCBzZXR0aW5ncylcbiAgICAgICAgLnByb3AoJ3NpemUnLCBzaXplKVxuICAgICAgICAud3JhcChtaW5pY29sb3JzKVxuICAgICAgICAuYWZ0ZXIoXG4gICAgICAgICc8ZGl2IGNsYXNzPVwibWluaWNvbG9ycy1wYW5lbCBtaW5pY29sb3JzLXNsaWRlci0nICsgc2V0dGluZ3MuY29udHJvbCArICdcIj4nICtcbiAgICAgICAgJzxkaXYgY2xhc3M9XCJtaW5pY29sb3JzLXNsaWRlciBtaW5pY29sb3JzLXNwcml0ZVwiPicgK1xuICAgICAgICAnPGRpdiBjbGFzcz1cIm1pbmljb2xvcnMtcGlja2VyXCI+PC9kaXY+JyArXG4gICAgICAgICc8L2Rpdj4nICtcbiAgICAgICAgJzxkaXYgY2xhc3M9XCJtaW5pY29sb3JzLW9wYWNpdHktc2xpZGVyIG1pbmljb2xvcnMtc3ByaXRlXCI+JyArXG4gICAgICAgICc8ZGl2IGNsYXNzPVwibWluaWNvbG9ycy1waWNrZXJcIj48L2Rpdj4nICtcbiAgICAgICAgJzwvZGl2PicgK1xuICAgICAgICAnPGRpdiBjbGFzcz1cIm1pbmljb2xvcnMtZ3JpZCBtaW5pY29sb3JzLXNwcml0ZVwiPicgK1xuICAgICAgICAnPGRpdiBjbGFzcz1cIm1pbmljb2xvcnMtZ3JpZC1pbm5lclwiPjwvZGl2PicgK1xuICAgICAgICAnPGRpdiBjbGFzcz1cIm1pbmljb2xvcnMtcGlja2VyXCI+PGRpdj48L2Rpdj48L2Rpdj4nICtcbiAgICAgICAgJzwvZGl2PicgK1xuICAgICAgICAnPC9kaXY+J1xuICAgICAgKTtcblxuICAgICAgLy8gVGhlIHN3YXRjaFxuICAgICAgaWYoICFzZXR0aW5ncy5pbmxpbmUgKSB7XG4gICAgICAgIGlucHV0LmFmdGVyKCc8c3BhbiBjbGFzcz1cIm1pbmljb2xvcnMtc3dhdGNoIG1pbmljb2xvcnMtc3ByaXRlIG1pbmljb2xvcnMtaW5wdXQtc3dhdGNoXCI+PHNwYW4gY2xhc3M9XCJtaW5pY29sb3JzLXN3YXRjaC1jb2xvclwiPjwvc3Bhbj48L3NwYW4+Jyk7XG4gICAgICAgIGlucHV0Lm5leHQoJy5taW5pY29sb3JzLWlucHV0LXN3YXRjaCcpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICBpbnB1dC5mb2N1cygpO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gUHJldmVudCB0ZXh0IHNlbGVjdGlvbiBpbiBJRVxuICAgICAgcGFuZWwgPSBpbnB1dC5wYXJlbnQoKS5maW5kKCcubWluaWNvbG9ycy1wYW5lbCcpO1xuICAgICAgcGFuZWwub24oJ3NlbGVjdHN0YXJ0JywgZnVuY3Rpb24oKSB7IHJldHVybiBmYWxzZTsgfSkuZW5kKCk7XG5cbiAgICAgIC8vIFN3YXRjaGVzXG4gICAgICBpZiAoc2V0dGluZ3Muc3dhdGNoZXMgJiYgc2V0dGluZ3Muc3dhdGNoZXMubGVuZ3RoICE9PSAwKSB7XG4gICAgICAgIGlmIChzZXR0aW5ncy5zd2F0Y2hlcy5sZW5ndGggPiA3KSB7XG4gICAgICAgICAgc2V0dGluZ3Muc3dhdGNoZXMubGVuZ3RoID0gNztcbiAgICAgICAgfVxuICAgICAgICBwYW5lbC5hZGRDbGFzcygnbWluaWNvbG9ycy13aXRoLXN3YXRjaGVzJyk7XG4gICAgICAgIHN3YXRjaGVzID0gJCgnPHVsIGNsYXNzPVwibWluaWNvbG9ycy1zd2F0Y2hlc1wiPjwvdWw+JylcbiAgICAgICAgICAuYXBwZW5kVG8ocGFuZWwpO1xuICAgICAgICBmb3IoaSA9IDA7IGkgPCBzZXR0aW5ncy5zd2F0Y2hlcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgIHN3YXRjaCA9IHNldHRpbmdzLnN3YXRjaGVzW2ldO1xuICAgICAgICAgIHN3YXRjaCA9IGlzUmdiKHN3YXRjaCkgPyBwYXJzZVJnYihzd2F0Y2gsIHRydWUpIDogaGV4MnJnYihwYXJzZUhleChzd2F0Y2gsIHRydWUpKTtcbiAgICAgICAgICAkKCc8bGkgY2xhc3M9XCJtaW5pY29sb3JzLXN3YXRjaCBtaW5pY29sb3JzLXNwcml0ZVwiPjxzcGFuIGNsYXNzPVwibWluaWNvbG9ycy1zd2F0Y2gtY29sb3JcIj48L3NwYW4+PC9saT4nKVxuICAgICAgICAgICAgLmFwcGVuZFRvKHN3YXRjaGVzKVxuICAgICAgICAgICAgLmRhdGEoJ3N3YXRjaC1jb2xvcicsIHNldHRpbmdzLnN3YXRjaGVzW2ldKVxuICAgICAgICAgICAgLmZpbmQoJy5taW5pY29sb3JzLXN3YXRjaC1jb2xvcicpXG4gICAgICAgICAgICAuY3NzKHtcbiAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiByZ2IyaGV4KHN3YXRjaCksXG4gICAgICAgICAgICAgIG9wYWNpdHk6IHN3YXRjaC5hXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICBzZXR0aW5ncy5zd2F0Y2hlc1tpXSA9IHN3YXRjaDtcbiAgICAgICAgfVxuXG4gICAgICB9XG5cblxuICAgICAgLy8gU3dhdGNoZXNcbiAgICAgIGlmIChzZXR0aW5ncy50ZXh0KSB7XG4gICAgICAgIHBhbmVsLmFkZENsYXNzKCdtaW5pY29sb3JzLXdpdGgtdGV4dCcpO1xuICAgICAgICB0ZXh0UGFuZWwgPSAkKCc8ZGl2IGNsYXNzPVwibWluaWNvbG9ycy10ZXh0XCI+PC9kaXY+JylcbiAgICAgICAgICAuYXBwZW5kVG8ocGFuZWwpO1xuICAgICAgICBpbnB1dFRleHQgPSAkKCc8aW5wdXQgdHlwZT1cInRleHRcIj4nKVxuICAgICAgICAgIC5hcHBlbmRUbyh0ZXh0UGFuZWwpO1xuXG4gICAgICAgICQoaW5wdXRUZXh0KS5jaGFuZ2UoZnVuY3Rpb24oKXtcbiAgICAgICAgICBpbnB1dC52YWwoaW5wdXRUZXh0LnZhbCgpKTtcbiAgICAgICAgICB1cGRhdGVGcm9tSW5wdXQoaW5wdXQsIHRydWUpO1xuICAgICAgICB9KVxuXG4gICAgICB9XG5cbiAgICAgIC8vIElubGluZSBjb250cm9sc1xuICAgICAgaWYoIHNldHRpbmdzLmlubGluZSApIGlucHV0LnBhcmVudCgpLmFkZENsYXNzKCdtaW5pY29sb3JzLWlubGluZScpO1xuXG4gICAgICB1cGRhdGVGcm9tSW5wdXQoaW5wdXQsIGZhbHNlKTtcblxuICAgICAgaW5wdXQuZGF0YSgnbWluaWNvbG9ycy1pbml0aWFsaXplZCcsIHRydWUpO1xuXG4gICAgfVxuXG4gICAgLy8gUmV0dXJucyB0aGUgaW5wdXQgYmFjayB0byBpdHMgb3JpZ2luYWwgc3RhdGVcbiAgICBmdW5jdGlvbiBkZXN0cm95KGlucHV0KSB7XG5cbiAgICAgIHZhciBtaW5pY29sb3JzID0gaW5wdXQucGFyZW50KCk7XG5cbiAgICAgIC8vIFJldmVydCB0aGUgaW5wdXQgZWxlbWVudFxuICAgICAgaW5wdXRcbiAgICAgICAgLnJlbW92ZURhdGEoJ21pbmljb2xvcnMtaW5pdGlhbGl6ZWQnKVxuICAgICAgICAucmVtb3ZlRGF0YSgnbWluaWNvbG9ycy1zZXR0aW5ncycpXG4gICAgICAgIC5yZW1vdmVQcm9wKCdzaXplJylcbiAgICAgICAgLnJlbW92ZUNsYXNzKCdtaW5pY29sb3JzLWlucHV0Jyk7XG5cbiAgICAgIC8vIFJlbW92ZSB0aGUgd3JhcCBhbmQgZGVzdHJveSB3aGF0ZXZlciByZW1haW5zXG4gICAgICBtaW5pY29sb3JzLmJlZm9yZShpbnB1dCkucmVtb3ZlKCk7XG5cbiAgICB9XG5cbiAgICAvLyBTaG93cyB0aGUgc3BlY2lmaWVkIGRyb3Bkb3duIHBhbmVsXG4gICAgZnVuY3Rpb24gc2hvdyhpbnB1dCkge1xuXG4gICAgICB2YXIgbWluaWNvbG9ycyA9IGlucHV0LnBhcmVudCgpLFxuICAgICAgICBwYW5lbCA9IG1pbmljb2xvcnMuZmluZCgnLm1pbmljb2xvcnMtcGFuZWwnKSxcbiAgICAgICAgc2V0dGluZ3MgPSBpbnB1dC5kYXRhKCdtaW5pY29sb3JzLXNldHRpbmdzJyk7XG5cbiAgICAgIC8vIERvIG5vdGhpbmcgaWYgdW5pbml0aWFsaXplZCwgZGlzYWJsZWQsIGlubGluZSwgb3IgYWxyZWFkeSBvcGVuXG4gICAgICBpZiggIWlucHV0LmRhdGEoJ21pbmljb2xvcnMtaW5pdGlhbGl6ZWQnKSB8fFxuICAgICAgICBpbnB1dC5wcm9wKCdkaXNhYmxlZCcpIHx8XG4gICAgICAgIG1pbmljb2xvcnMuaGFzQ2xhc3MoJ21pbmljb2xvcnMtaW5saW5lJykgfHxcbiAgICAgICAgbWluaWNvbG9ycy5oYXNDbGFzcygnbWluaWNvbG9ycy1mb2N1cycpXG4gICAgICApIHJldHVybjtcblxuICAgICAgaGlkZSgpO1xuXG4gICAgICBtaW5pY29sb3JzLmFkZENsYXNzKCdtaW5pY29sb3JzLWZvY3VzJyk7XG4gICAgICBwYW5lbFxuICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAuZmFkZUluKHNldHRpbmdzLnNob3dTcGVlZCwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaWYoIHNldHRpbmdzLnNob3cgKSBzZXR0aW5ncy5zaG93LmNhbGwoaW5wdXQuZ2V0KDApKTtcbiAgICAgICAgfSk7XG5cbiAgICB9XG5cbiAgICAvLyBIaWRlcyBhbGwgZHJvcGRvd24gcGFuZWxzXG4gICAgZnVuY3Rpb24gaGlkZSgpIHtcblxuICAgICAgJCgnLm1pbmljb2xvcnMtZm9jdXMnKS5lYWNoKCBmdW5jdGlvbigpIHtcblxuICAgICAgICB2YXIgbWluaWNvbG9ycyA9ICQodGhpcyksXG4gICAgICAgICAgaW5wdXQgPSBtaW5pY29sb3JzLmZpbmQoJy5taW5pY29sb3JzLWlucHV0JyksXG4gICAgICAgICAgcGFuZWwgPSBtaW5pY29sb3JzLmZpbmQoJy5taW5pY29sb3JzLXBhbmVsJyksXG4gICAgICAgICAgc2V0dGluZ3MgPSBpbnB1dC5kYXRhKCdtaW5pY29sb3JzLXNldHRpbmdzJyk7XG5cbiAgICAgICAgcGFuZWwuZmFkZU91dChzZXR0aW5ncy5oaWRlU3BlZWQsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGlmKCBzZXR0aW5ncy5oaWRlICkgc2V0dGluZ3MuaGlkZS5jYWxsKGlucHV0LmdldCgwKSk7XG4gICAgICAgICAgbWluaWNvbG9ycy5yZW1vdmVDbGFzcygnbWluaWNvbG9ycy1mb2N1cycpO1xuICAgICAgICB9KTtcblxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gTW92ZXMgdGhlIHNlbGVjdGVkIHBpY2tlclxuICAgIGZ1bmN0aW9uIG1vdmUodGFyZ2V0LCBldmVudCwgYW5pbWF0ZSkge1xuXG4gICAgICB2YXIgaW5wdXQgPSAgdGFyZ2V0LnBhcmVudHMoJy5taW5pY29sb3JzJykuZmluZCgnLm1pbmljb2xvcnMtaW5wdXQnKSxcbiAgICAgICAgc2V0dGluZ3MgPSBpbnB1dC5kYXRhKCdtaW5pY29sb3JzLXNldHRpbmdzJyksXG4gICAgICAgIHBpY2tlciA9IHRhcmdldC5maW5kKCdbY2xhc3MkPS1waWNrZXJdJyksXG4gICAgICAgIG9mZnNldFggPSB0YXJnZXQub2Zmc2V0KCkubGVmdCxcbiAgICAgICAgb2Zmc2V0WSA9IHRhcmdldC5vZmZzZXQoKS50b3AsXG4gICAgICAgIHggPSBNYXRoLnJvdW5kKGV2ZW50LnBhZ2VYIC0gb2Zmc2V0WCksXG4gICAgICAgIHkgPSBNYXRoLnJvdW5kKGV2ZW50LnBhZ2VZIC0gb2Zmc2V0WSksXG4gICAgICAgIGR1cmF0aW9uID0gYW5pbWF0ZSA/IHNldHRpbmdzLmFuaW1hdGlvblNwZWVkIDogMCxcbiAgICAgICAgd3gsIHd5LCByLCBwaGk7XG5cbiAgICAgIC8vIFRvdWNoIHN1cHBvcnRcbiAgICAgIGlmKCBldmVudC5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzICkge1xuICAgICAgICB4ID0gZXZlbnQub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWCAtIG9mZnNldFg7XG4gICAgICAgIHkgPSBldmVudC5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VZIC0gb2Zmc2V0WTtcbiAgICAgIH1cblxuICAgICAgLy8gQ29uc3RyYWluIHBpY2tlciB0byBpdHMgY29udGFpbmVyXG4gICAgICBpZiggeCA8IDAgKSB4ID0gMDtcbiAgICAgIGlmKCB5IDwgMCApIHkgPSAwO1xuICAgICAgaWYoIHggPiB0YXJnZXQud2lkdGgoKSApIHggPSB0YXJnZXQud2lkdGgoKTtcbiAgICAgIGlmKCB5ID4gdGFyZ2V0LmhlaWdodCgpICkgeSA9IHRhcmdldC5oZWlnaHQoKTtcblxuICAgICAgLy8gQ29uc3RyYWluIGNvbG9yIHdoZWVsIHZhbHVlcyB0byB0aGUgd2hlZWxcbiAgICAgIGlmKCB0YXJnZXQucGFyZW50KCkuaXMoJy5taW5pY29sb3JzLXNsaWRlci13aGVlbCcpICYmIHBpY2tlci5wYXJlbnQoKS5pcygnLm1pbmljb2xvcnMtZ3JpZCcpICkge1xuICAgICAgICB3eCA9IDc1IC0geDtcbiAgICAgICAgd3kgPSA3NSAtIHk7XG4gICAgICAgIHIgPSBNYXRoLnNxcnQod3ggKiB3eCArIHd5ICogd3kpO1xuICAgICAgICBwaGkgPSBNYXRoLmF0YW4yKHd5LCB3eCk7XG4gICAgICAgIGlmKCBwaGkgPCAwICkgcGhpICs9IE1hdGguUEkgKiAyO1xuICAgICAgICBpZiggciA+IDc1ICkge1xuICAgICAgICAgIHIgPSA3NTtcbiAgICAgICAgICB4ID0gNzUgLSAoNzUgKiBNYXRoLmNvcyhwaGkpKTtcbiAgICAgICAgICB5ID0gNzUgLSAoNzUgKiBNYXRoLnNpbihwaGkpKTtcbiAgICAgICAgfVxuICAgICAgICB4ID0gTWF0aC5yb3VuZCh4KTtcbiAgICAgICAgeSA9IE1hdGgucm91bmQoeSk7XG4gICAgICB9XG5cbiAgICAgIC8vIE1vdmUgdGhlIHBpY2tlclxuICAgICAgaWYoIHRhcmdldC5pcygnLm1pbmljb2xvcnMtZ3JpZCcpICkge1xuICAgICAgICBwaWNrZXJcbiAgICAgICAgICAuc3RvcCh0cnVlKVxuICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgIHRvcDogeSArICdweCcsXG4gICAgICAgICAgICBsZWZ0OiB4ICsgJ3B4J1xuICAgICAgICAgIH0sIGR1cmF0aW9uLCBzZXR0aW5ncy5hbmltYXRpb25FYXNpbmcsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdXBkYXRlRnJvbUNvbnRyb2woaW5wdXQsIHRhcmdldCk7XG4gICAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBwaWNrZXJcbiAgICAgICAgICAuc3RvcCh0cnVlKVxuICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgIHRvcDogeSArICdweCdcbiAgICAgICAgICB9LCBkdXJhdGlvbiwgc2V0dGluZ3MuYW5pbWF0aW9uRWFzaW5nLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHVwZGF0ZUZyb21Db250cm9sKGlucHV0LCB0YXJnZXQpO1xuICAgICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgfVxuXG4gICAgLy8gU2V0cyB0aGUgaW5wdXQgYmFzZWQgb24gdGhlIGNvbG9yIHBpY2tlciB2YWx1ZXNcbiAgICBmdW5jdGlvbiB1cGRhdGVGcm9tQ29udHJvbChpbnB1dCwgdGFyZ2V0KSB7XG5cbiAgICAgIGZ1bmN0aW9uIGdldENvb3JkcyhwaWNrZXIsIGNvbnRhaW5lcikge1xuXG4gICAgICAgIHZhciBsZWZ0LCB0b3A7XG4gICAgICAgIGlmKCAhcGlja2VyLmxlbmd0aCB8fCAhY29udGFpbmVyICkgcmV0dXJuIG51bGw7XG4gICAgICAgIGxlZnQgPSBwaWNrZXIub2Zmc2V0KCkubGVmdDtcbiAgICAgICAgdG9wID0gcGlja2VyLm9mZnNldCgpLnRvcDtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHg6IGxlZnQgLSBjb250YWluZXIub2Zmc2V0KCkubGVmdCArIChwaWNrZXIub3V0ZXJXaWR0aCgpIC8gMiksXG4gICAgICAgICAgeTogdG9wIC0gY29udGFpbmVyLm9mZnNldCgpLnRvcCArIChwaWNrZXIub3V0ZXJIZWlnaHQoKSAvIDIpXG4gICAgICAgIH07XG5cbiAgICAgIH1cblxuICAgICAgdmFyIGh1ZSwgc2F0dXJhdGlvbiwgYnJpZ2h0bmVzcywgeCwgeSwgciwgcGhpLFxuXG4gICAgICAgIGhleCA9IGlucHV0LnZhbCgpLFxuICAgICAgICBvcGFjaXR5ID0gaW5wdXQuYXR0cignZGF0YS1vcGFjaXR5JyksXG5cbiAgICAgIC8vIEhlbHBmdWwgcmVmZXJlbmNlc1xuICAgICAgICBtaW5pY29sb3JzID0gaW5wdXQucGFyZW50KCksXG4gICAgICAgIHNldHRpbmdzID0gaW5wdXQuZGF0YSgnbWluaWNvbG9ycy1zZXR0aW5ncycpLFxuICAgICAgICBzd2F0Y2ggPSBtaW5pY29sb3JzLmZpbmQoJy5taW5pY29sb3JzLWlucHV0LXN3YXRjaCcpLFxuXG4gICAgICAvLyBQYW5lbCBvYmplY3RzXG4gICAgICAgIGdyaWQgPSBtaW5pY29sb3JzLmZpbmQoJy5taW5pY29sb3JzLWdyaWQnKSxcbiAgICAgICAgc2xpZGVyID0gbWluaWNvbG9ycy5maW5kKCcubWluaWNvbG9ycy1zbGlkZXInKSxcbiAgICAgICAgb3BhY2l0eVNsaWRlciA9IG1pbmljb2xvcnMuZmluZCgnLm1pbmljb2xvcnMtb3BhY2l0eS1zbGlkZXInKSxcblxuICAgICAgLy8gUGlja2VyIG9iamVjdHNcbiAgICAgICAgZ3JpZFBpY2tlciA9IGdyaWQuZmluZCgnW2NsYXNzJD0tcGlja2VyXScpLFxuICAgICAgICBzbGlkZXJQaWNrZXIgPSBzbGlkZXIuZmluZCgnW2NsYXNzJD0tcGlja2VyXScpLFxuICAgICAgICBvcGFjaXR5UGlja2VyID0gb3BhY2l0eVNsaWRlci5maW5kKCdbY2xhc3MkPS1waWNrZXJdJyksXG5cbiAgICAgIC8vIFBpY2tlciBwb3NpdGlvbnNcbiAgICAgICAgZ3JpZFBvcyA9IGdldENvb3JkcyhncmlkUGlja2VyLCBncmlkKSxcbiAgICAgICAgc2xpZGVyUG9zID0gZ2V0Q29vcmRzKHNsaWRlclBpY2tlciwgc2xpZGVyKSxcbiAgICAgICAgb3BhY2l0eVBvcyA9IGdldENvb3JkcyhvcGFjaXR5UGlja2VyLCBvcGFjaXR5U2xpZGVyKTtcblxuICAgICAgLy8gSGFuZGxlIGNvbG9yc1xuICAgICAgaWYoIHRhcmdldC5pcygnLm1pbmljb2xvcnMtZ3JpZCwgLm1pbmljb2xvcnMtc2xpZGVyLCAubWluaWNvbG9ycy1vcGFjaXR5LXNsaWRlcicpICkge1xuXG4gICAgICAgIC8vIERldGVybWluZSBIU0IgdmFsdWVzXG4gICAgICAgIHN3aXRjaChzZXR0aW5ncy5jb250cm9sKSB7XG5cbiAgICAgICAgICBjYXNlICd3aGVlbCc6XG4gICAgICAgICAgICAvLyBDYWxjdWxhdGUgaHVlLCBzYXR1cmF0aW9uLCBhbmQgYnJpZ2h0bmVzc1xuICAgICAgICAgICAgeCA9IChncmlkLndpZHRoKCkgLyAyKSAtIGdyaWRQb3MueDtcbiAgICAgICAgICAgIHkgPSAoZ3JpZC5oZWlnaHQoKSAvIDIpIC0gZ3JpZFBvcy55O1xuICAgICAgICAgICAgciA9IE1hdGguc3FydCh4ICogeCArIHkgKiB5KTtcbiAgICAgICAgICAgIHBoaSA9IE1hdGguYXRhbjIoeSwgeCk7XG4gICAgICAgICAgICBpZiggcGhpIDwgMCApIHBoaSArPSBNYXRoLlBJICogMjtcbiAgICAgICAgICAgIGlmKCByID4gNzUgKSB7XG4gICAgICAgICAgICAgIHIgPSA3NTtcbiAgICAgICAgICAgICAgZ3JpZFBvcy54ID0gNjkgLSAoNzUgKiBNYXRoLmNvcyhwaGkpKTtcbiAgICAgICAgICAgICAgZ3JpZFBvcy55ID0gNjkgLSAoNzUgKiBNYXRoLnNpbihwaGkpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHNhdHVyYXRpb24gPSBrZWVwV2l0aGluKHIgLyAwLjc1LCAwLCAxMDApO1xuICAgICAgICAgICAgaHVlID0ga2VlcFdpdGhpbihwaGkgKiAxODAgLyBNYXRoLlBJLCAwLCAzNjApO1xuICAgICAgICAgICAgYnJpZ2h0bmVzcyA9IGtlZXBXaXRoaW4oMTAwIC0gTWF0aC5mbG9vcihzbGlkZXJQb3MueSAqICgxMDAgLyBzbGlkZXIuaGVpZ2h0KCkpKSwgMCwgMTAwKTtcbiAgICAgICAgICAgIGhleCA9IGhzYjJoZXgoe1xuICAgICAgICAgICAgICBoOiBodWUsXG4gICAgICAgICAgICAgIHM6IHNhdHVyYXRpb24sXG4gICAgICAgICAgICAgIGI6IGJyaWdodG5lc3NcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBVcGRhdGUgVUlcbiAgICAgICAgICAgIHNsaWRlci5jc3MoJ2JhY2tncm91bmRDb2xvcicsIGhzYjJoZXgoeyBoOiBodWUsIHM6IHNhdHVyYXRpb24sIGI6IDEwMCB9KSk7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGNhc2UgJ3NhdHVyYXRpb24nOlxuICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIGh1ZSwgc2F0dXJhdGlvbiwgYW5kIGJyaWdodG5lc3NcbiAgICAgICAgICAgIGh1ZSA9IGtlZXBXaXRoaW4ocGFyc2VJbnQoZ3JpZFBvcy54ICogKDM2MCAvIGdyaWQud2lkdGgoKSksIDEwKSwgMCwgMzYwKTtcbiAgICAgICAgICAgIHNhdHVyYXRpb24gPSBrZWVwV2l0aGluKDEwMCAtIE1hdGguZmxvb3Ioc2xpZGVyUG9zLnkgKiAoMTAwIC8gc2xpZGVyLmhlaWdodCgpKSksIDAsIDEwMCk7XG4gICAgICAgICAgICBicmlnaHRuZXNzID0ga2VlcFdpdGhpbigxMDAgLSBNYXRoLmZsb29yKGdyaWRQb3MueSAqICgxMDAgLyBncmlkLmhlaWdodCgpKSksIDAsIDEwMCk7XG4gICAgICAgICAgICBoZXggPSBoc2IyaGV4KHtcbiAgICAgICAgICAgICAgaDogaHVlLFxuICAgICAgICAgICAgICBzOiBzYXR1cmF0aW9uLFxuICAgICAgICAgICAgICBiOiBicmlnaHRuZXNzXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gVXBkYXRlIFVJXG4gICAgICAgICAgICBzbGlkZXIuY3NzKCdiYWNrZ3JvdW5kQ29sb3InLCBoc2IyaGV4KHsgaDogaHVlLCBzOiAxMDAsIGI6IGJyaWdodG5lc3MgfSkpO1xuICAgICAgICAgICAgbWluaWNvbG9ycy5maW5kKCcubWluaWNvbG9ycy1ncmlkLWlubmVyJykuY3NzKCdvcGFjaXR5Jywgc2F0dXJhdGlvbiAvIDEwMCk7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGNhc2UgJ2JyaWdodG5lc3MnOlxuICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIGh1ZSwgc2F0dXJhdGlvbiwgYW5kIGJyaWdodG5lc3NcbiAgICAgICAgICAgIGh1ZSA9IGtlZXBXaXRoaW4ocGFyc2VJbnQoZ3JpZFBvcy54ICogKDM2MCAvIGdyaWQud2lkdGgoKSksIDEwKSwgMCwgMzYwKTtcbiAgICAgICAgICAgIHNhdHVyYXRpb24gPSBrZWVwV2l0aGluKDEwMCAtIE1hdGguZmxvb3IoZ3JpZFBvcy55ICogKDEwMCAvIGdyaWQuaGVpZ2h0KCkpKSwgMCwgMTAwKTtcbiAgICAgICAgICAgIGJyaWdodG5lc3MgPSBrZWVwV2l0aGluKDEwMCAtIE1hdGguZmxvb3Ioc2xpZGVyUG9zLnkgKiAoMTAwIC8gc2xpZGVyLmhlaWdodCgpKSksIDAsIDEwMCk7XG4gICAgICAgICAgICBoZXggPSBoc2IyaGV4KHtcbiAgICAgICAgICAgICAgaDogaHVlLFxuICAgICAgICAgICAgICBzOiBzYXR1cmF0aW9uLFxuICAgICAgICAgICAgICBiOiBicmlnaHRuZXNzXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gVXBkYXRlIFVJXG4gICAgICAgICAgICBzbGlkZXIuY3NzKCdiYWNrZ3JvdW5kQ29sb3InLCBoc2IyaGV4KHsgaDogaHVlLCBzOiBzYXR1cmF0aW9uLCBiOiAxMDAgfSkpO1xuICAgICAgICAgICAgbWluaWNvbG9ycy5maW5kKCcubWluaWNvbG9ycy1ncmlkLWlubmVyJykuY3NzKCdvcGFjaXR5JywgMSAtIChicmlnaHRuZXNzIC8gMTAwKSk7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAvLyBDYWxjdWxhdGUgaHVlLCBzYXR1cmF0aW9uLCBhbmQgYnJpZ2h0bmVzc1xuICAgICAgICAgICAgaHVlID0ga2VlcFdpdGhpbigzNjAgLSBwYXJzZUludChzbGlkZXJQb3MueSAqICgzNjAgLyBzbGlkZXIuaGVpZ2h0KCkpLCAxMCksIDAsIDM2MCk7XG4gICAgICAgICAgICBzYXR1cmF0aW9uID0ga2VlcFdpdGhpbihNYXRoLmZsb29yKGdyaWRQb3MueCAqICgxMDAgLyBncmlkLndpZHRoKCkpKSwgMCwgMTAwKTtcbiAgICAgICAgICAgIGJyaWdodG5lc3MgPSBrZWVwV2l0aGluKDEwMCAtIE1hdGguZmxvb3IoZ3JpZFBvcy55ICogKDEwMCAvIGdyaWQuaGVpZ2h0KCkpKSwgMCwgMTAwKTtcbiAgICAgICAgICAgIGhleCA9IGhzYjJoZXgoe1xuICAgICAgICAgICAgICBoOiBodWUsXG4gICAgICAgICAgICAgIHM6IHNhdHVyYXRpb24sXG4gICAgICAgICAgICAgIGI6IGJyaWdodG5lc3NcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBVcGRhdGUgVUlcbiAgICAgICAgICAgIGdyaWQuY3NzKCdiYWNrZ3JvdW5kQ29sb3InLCBoc2IyaGV4KHsgaDogaHVlLCBzOiAxMDAsIGI6IDEwMCB9KSk7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICB9XG5cbiAgICAgICAgLy8gSGFuZGxlIG9wYWNpdHlcbiAgICAgICAgaWYoIHNldHRpbmdzLm9wYWNpdHkgKSB7XG4gICAgICAgICAgb3BhY2l0eSA9IHBhcnNlRmxvYXQoMSAtIChvcGFjaXR5UG9zLnkgLyBvcGFjaXR5U2xpZGVyLmhlaWdodCgpKSkudG9GaXhlZCgyKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBvcGFjaXR5ID0gMTtcbiAgICAgICAgfVxuXG4gICAgICAgIHVwZGF0ZUlucHV0KGlucHV0LCBoZXgsIG9wYWNpdHkpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIC8vIFNldCBzd2F0Y2ggY29sb3JcbiAgICAgICAgc3dhdGNoLmZpbmQoJ3NwYW4nKS5jc3Moe1xuICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogaGV4LFxuICAgICAgICAgIG9wYWNpdHk6IG9wYWNpdHlcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gSGFuZGxlIGNoYW5nZSBldmVudFxuICAgICAgICBkb0NoYW5nZShpbnB1dCwgaGV4LCBvcGFjaXR5KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBTZXRzIHRoZSB2YWx1ZSBvZiB0aGUgaW5wdXQgYW5kIGRvZXMgdGhlIGFwcHJvcHJpYXRlIGNvbnZlcnNpb25zXG4gICAgLy8gdG8gcmVzcGVjdCBzZXR0aW5ncywgYWxzbyB1cGRhdGVzIHRoZSBzd2F0Y2hcbiAgICBmdW5jdGlvbiB1cGRhdGVJbnB1dChpbnB1dCwgdmFsdWUsIG9wYWNpdHkpIHtcbiAgICAgIHZhciByZ2IsXG5cbiAgICAgIC8vIEhlbHBmdWwgcmVmZXJlbmNlc1xuICAgICAgICBtaW5pY29sb3JzID0gaW5wdXQucGFyZW50KCksXG4gICAgICAgIHNldHRpbmdzID0gaW5wdXQuZGF0YSgnbWluaWNvbG9ycy1zZXR0aW5ncycpLFxuICAgICAgICBzd2F0Y2ggPSBtaW5pY29sb3JzLmZpbmQoJy5taW5pY29sb3JzLWlucHV0LXN3YXRjaCcpO1xuXG4gICAgICBpZiggc2V0dGluZ3Mub3BhY2l0eSApIGlucHV0LmF0dHIoJ2RhdGEtb3BhY2l0eScsIG9wYWNpdHkpO1xuXG4gICAgICAvLyBTZXQgY29sb3Igc3RyaW5nXG4gICAgICBpZiggc2V0dGluZ3MuZm9ybWF0ID09PSAncmdiJyApIHtcbiAgICAgICAgLy8gUmV0dXJucyBSR0IoQSkgc3RyaW5nXG5cbiAgICAgICAgLy8gQ2hlY2tzIGZvciBpbnB1dCBmb3JtYXQgYW5kIGRvZXMgdGhlIGNvbnZlcnNpb25cbiAgICAgICAgaWYgKCBpc1JnYih2YWx1ZSkgKSB7XG4gICAgICAgICAgcmdiID0gcGFyc2VSZ2IodmFsdWUsIHRydWUpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIHJnYiA9IGhleDJyZ2IocGFyc2VIZXgodmFsdWUsIHRydWUpKTtcbiAgICAgICAgfVxuXG5cbiAgICAgICAgb3BhY2l0eSA9IGlucHV0LmF0dHIoJ2RhdGEtb3BhY2l0eScpID09PSAnJyA/IDEgOiBrZWVwV2l0aGluKCBwYXJzZUZsb2F0KCBpbnB1dC5hdHRyKCdkYXRhLW9wYWNpdHknKSApLnRvRml4ZWQoMiksIDAsIDEgKTtcbiAgICAgICAgaWYoIGlzTmFOKCBvcGFjaXR5ICkgfHwgIXNldHRpbmdzLm9wYWNpdHkgKSBvcGFjaXR5ID0gMTtcblxuICAgICAgICBpZiggaW5wdXQubWluaWNvbG9ycygncmdiT2JqZWN0JykuYSA8PSAxICYmIHJnYiAmJiBzZXR0aW5ncy5vcGFjaXR5KSB7XG4gICAgICAgICAgLy8gU2V0IFJHQkEgc3RyaW5nIGlmIGFscGhhXG4gICAgICAgICAgdmFsdWUgPSAncmdiYSgnICsgcmdiLnIgKyAnLCAnICsgcmdiLmcgKyAnLCAnICsgcmdiLmIgKyAnLCAnICsgcGFyc2VGbG9hdCggb3BhY2l0eSApICsgJyknO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIFNldCBSR0Igc3RyaW5nIChhbHBoYSA9IDEpXG4gICAgICAgICAgdmFsdWUgPSAncmdiKCcgKyByZ2IuciArICcsICcgKyByZ2IuZyArICcsICcgKyByZ2IuYiArICcpJztcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gUmV0dXJucyBoZXggY29sb3JcblxuICAgICAgICAvLyBDaGVja3MgZm9yIGlucHV0IGZvcm1hdCBhbmQgZG9lcyB0aGUgY29udmVyc2lvblxuICAgICAgICBpZiAoIGlzUmdiKHZhbHVlKSApIHtcbiAgICAgICAgICB2YWx1ZSA9IHJnYlN0cmluZzJoZXgodmFsdWUpO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFsdWUgPSBjb252ZXJ0Q2FzZSggdmFsdWUsIHNldHRpbmdzLmxldHRlckNhc2UgKTtcbiAgICAgIH1cblxuXG5cblxuICAgICAgLy8gVXBkYXRlIHZhbHVlIGZyb20gcGlja2VyXG4gICAgICAvL2dsb2JhbElucHV0LnZhbCggdmFsdWUgKTtcbiAgICAgIGlucHV0LnZhbCggdmFsdWUgKTtcblxuICAgICAgaWYoaW5wdXRUZXh0KXtcbiAgICAgICAgaW5wdXRUZXh0LnZhbCh2YWx1ZSk7XG4gICAgICB9XG5cblxuICAgICAgLy8gU2V0IHN3YXRjaCBjb2xvclxuICAgICAgc3dhdGNoLmZpbmQoJ3NwYW4nKS5jc3Moe1xuICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IHZhbHVlLFxuICAgICAgICBvcGFjaXR5OiBvcGFjaXR5XG4gICAgICB9KTtcblxuICAgICAgLy8gSGFuZGxlIGNoYW5nZSBldmVudFxuICAgICAgZG9DaGFuZ2UoaW5wdXQsIHZhbHVlLCBvcGFjaXR5KTtcbiAgICB9XG5cbiAgICAvLyBTZXRzIHRoZSBjb2xvciBwaWNrZXIgdmFsdWVzIGZyb20gdGhlIGlucHV0XG4gICAgZnVuY3Rpb24gdXBkYXRlRnJvbUlucHV0KGlucHV0LCBwcmVzZXJ2ZUlucHV0VmFsdWUpIHtcbiAgICAgdmFyICBzZXR0aW5ncyA9IGdsb2JhbFNldHRpbmdzO1xuICAgICAgdmFyIGhleCxcbiAgICAgICAgaHNiLFxuICAgICAgICBvcGFjaXR5LFxuICAgICAgICBrZXl3b3JkcyxcbiAgICAgICAgYWxwaGEsXG4gICAgICAgIHZhbHVlLFxuICAgICAgICB4LCB5LCByLCBwaGksXG5cbiAgICAgIC8vIEhlbHBmdWwgcmVmZXJlbmNlc1xuICAgICAgICBtaW5pY29sb3JzID0gaW5wdXQucGFyZW50KCksXG4gICAgICAvLyAgc2V0dGluZ3MgPSBpbnB1dC5kYXRhKCdtaW5pY29sb3JzLXNldHRpbmdzJyksXG4gICAgICAgIHN3YXRjaCA9IG1pbmljb2xvcnMuZmluZCgnLm1pbmljb2xvcnMtaW5wdXQtc3dhdGNoJyksXG5cbiAgICAgIC8vIFBhbmVsIG9iamVjdHNcbiAgICAgICAgZ3JpZCA9IG1pbmljb2xvcnMuZmluZCgnLm1pbmljb2xvcnMtZ3JpZCcpLFxuICAgICAgICBzbGlkZXIgPSBtaW5pY29sb3JzLmZpbmQoJy5taW5pY29sb3JzLXNsaWRlcicpLFxuICAgICAgICBvcGFjaXR5U2xpZGVyID0gbWluaWNvbG9ycy5maW5kKCcubWluaWNvbG9ycy1vcGFjaXR5LXNsaWRlcicpLFxuXG4gICAgICAvLyBQaWNrZXIgb2JqZWN0c1xuICAgICAgICBncmlkUGlja2VyID0gZ3JpZC5maW5kKCdbY2xhc3MkPS1waWNrZXJdJyksXG4gICAgICAgIHNsaWRlclBpY2tlciA9IHNsaWRlci5maW5kKCdbY2xhc3MkPS1waWNrZXJdJyksXG4gICAgICAgIG9wYWNpdHlQaWNrZXIgPSBvcGFjaXR5U2xpZGVyLmZpbmQoJ1tjbGFzcyQ9LXBpY2tlcl0nKTtcblxuICAgICAgLy8gRGV0ZXJtaW5lIGhleC9IU0IgdmFsdWVzXG4gICAgICBpZiggaXNSZ2IoaW5wdXQudmFsKCkpICkge1xuICAgICAgICAvLyBJZiBpbnB1dCB2YWx1ZSBpcyBhIHJnYihhKSBzdHJpbmcsIGNvbnZlcnQgaXQgdG8gaGV4IGNvbG9yIGFuZCB1cGRhdGUgb3BhY2l0eVxuICAgICAgICBoZXggPSByZ2JTdHJpbmcyaGV4KGlucHV0LnZhbCgpKTtcbiAgICAgICAgYWxwaGEgPSBrZWVwV2l0aGluKHBhcnNlRmxvYXQoZ2V0QWxwaGEoaW5wdXQudmFsKCkpKS50b0ZpeGVkKDIpLCAwLCAxKTtcbiAgICAgICAgaWYoIGFscGhhICkge1xuICAgICAgICAgIGlucHV0LmF0dHIoJ2RhdGEtb3BhY2l0eScsIGFscGhhKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaGV4ID0gY29udmVydENhc2UocGFyc2VIZXgoaW5wdXQudmFsKCksIHRydWUpLCBzZXR0aW5ncy5sZXR0ZXJDYXNlKTtcbiAgICAgIH1cblxuICAgICAgaWYoICFoZXggKXtcbiAgICAgICAgaGV4ID0gY29udmVydENhc2UocGFyc2VJbnB1dChzZXR0aW5ncy5kZWZhdWx0VmFsdWUsIHRydWUpLCBzZXR0aW5ncy5sZXR0ZXJDYXNlKTtcbiAgICAgIH1cbiAgICAgIGhzYiA9IGhleDJoc2IoaGV4KTtcblxuICAgICAgLy8gR2V0IGFycmF5IG9mIGxvd2VyY2FzZSBrZXl3b3Jkc1xuICAgICAga2V5d29yZHMgPSAhc2V0dGluZ3Mua2V5d29yZHMgPyBbXSA6ICQubWFwKHNldHRpbmdzLmtleXdvcmRzLnNwbGl0KCcsJyksIGZ1bmN0aW9uKGEpIHtcbiAgICAgICAgcmV0dXJuICQudHJpbShhLnRvTG93ZXJDYXNlKCkpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIFNldCBjb2xvciBzdHJpbmdcbiAgICAgIGlmKCBpbnB1dC52YWwoKSAhPT0gJycgJiYgJC5pbkFycmF5KGlucHV0LnZhbCgpLnRvTG93ZXJDYXNlKCksIGtleXdvcmRzKSA+IC0xICkge1xuICAgICAgICB2YWx1ZSA9IGNvbnZlcnRDYXNlKGlucHV0LnZhbCgpKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhbHVlID0gaXNSZ2IoaW5wdXQudmFsKCkpID8gcGFyc2VSZ2IoaW5wdXQudmFsKCkpIDogaGV4O1xuICAgICAgfVxuXG4gICAgICAvLyBVcGRhdGUgaW5wdXQgdmFsdWVcbiAgICAgIGlmKCAhcHJlc2VydmVJbnB1dFZhbHVlICl7XG4gICAgICAgIGdsb2JhbElucHV0LnZhbCh2YWx1ZSk7XG5cbiAgICAgICAgaW5wdXRUZXh0ICYmIGlucHV0VGV4dC52YWwodmFsdWUpO1xuICAgICAgfVxuICAgICAgZ2xvYmFsU2V0dGluZ3MgPSBzZXR0aW5nc1xuICAgICAgLy8gRGV0ZXJtaW5lIG9wYWNpdHkgdmFsdWVcbiAgICAgIGlmKCBzZXR0aW5ncy5vcGFjaXR5ICkge1xuICAgICAgICAvLyBHZXQgZnJvbSBkYXRhLW9wYWNpdHkgYXR0cmlidXRlIGFuZCBrZWVwIHdpdGhpbiAwLTEgcmFuZ2VcbiAgICAgICAgb3BhY2l0eSA9IGlucHV0LmF0dHIoJ2RhdGEtb3BhY2l0eScpID09PSAnJyA/IDEgOiBrZWVwV2l0aGluKHBhcnNlRmxvYXQoaW5wdXQuYXR0cignZGF0YS1vcGFjaXR5JykpLnRvRml4ZWQoMiksIDAsIDEpO1xuICAgICAgICBpZiggaXNOYU4ob3BhY2l0eSkgKSBvcGFjaXR5ID0gMTtcbiAgICAgICAgaW5wdXQuYXR0cignZGF0YS1vcGFjaXR5Jywgb3BhY2l0eSk7XG4gICAgICAgIHN3YXRjaC5maW5kKCdzcGFuJykuY3NzKCdvcGFjaXR5Jywgb3BhY2l0eSk7XG5cbiAgICAgICAgLy8gU2V0IG9wYWNpdHkgcGlja2VyIHBvc2l0aW9uXG4gICAgICAgIHkgPSBrZWVwV2l0aGluKG9wYWNpdHlTbGlkZXIuaGVpZ2h0KCkgLSAob3BhY2l0eVNsaWRlci5oZWlnaHQoKSAqIG9wYWNpdHkpLCAwLCBvcGFjaXR5U2xpZGVyLmhlaWdodCgpKTtcbiAgICAgICAgb3BhY2l0eVBpY2tlci5jc3MoJ3RvcCcsIHkgKyAncHgnKTtcbiAgICAgIH1cblxuICAgICAgLy8gU2V0IG9wYWNpdHkgdG8gemVybyBpZiBpbnB1dCB2YWx1ZSBpcyB0cmFuc3BhcmVudFxuICAgICAgaWYoIGlucHV0LnZhbCgpLnRvTG93ZXJDYXNlKCkgPT09ICd0cmFuc3BhcmVudCcgKSB7XG4gICAgICAgIHN3YXRjaC5maW5kKCdzcGFuJykuY3NzKCdvcGFjaXR5JywgMCk7XG4gICAgICB9XG5cbiAgICAgIC8vIFVwZGF0ZSBzd2F0Y2hcbiAgICAgIHN3YXRjaC5maW5kKCdzcGFuJykuY3NzKCdiYWNrZ3JvdW5kQ29sb3InLCBoZXgpO1xuXG4gICAgICAvLyBEZXRlcm1pbmUgcGlja2VyIGxvY2F0aW9uc1xuICAgICAgc3dpdGNoKHNldHRpbmdzLmNvbnRyb2wpIHtcblxuICAgICAgICBjYXNlICd3aGVlbCc6XG4gICAgICAgICAgLy8gU2V0IGdyaWQgcG9zaXRpb25cbiAgICAgICAgICByID0ga2VlcFdpdGhpbihNYXRoLmNlaWwoaHNiLnMgKiAwLjc1KSwgMCwgZ3JpZC5oZWlnaHQoKSAvIDIpO1xuICAgICAgICAgIHBoaSA9IGhzYi5oICogTWF0aC5QSSAvIDE4MDtcbiAgICAgICAgICB4ID0ga2VlcFdpdGhpbig3NSAtIE1hdGguY29zKHBoaSkgKiByLCAwLCBncmlkLndpZHRoKCkpO1xuICAgICAgICAgIHkgPSBrZWVwV2l0aGluKDc1IC0gTWF0aC5zaW4ocGhpKSAqIHIsIDAsIGdyaWQuaGVpZ2h0KCkpO1xuICAgICAgICAgIGdyaWRQaWNrZXIuY3NzKHtcbiAgICAgICAgICAgIHRvcDogeSArICdweCcsXG4gICAgICAgICAgICBsZWZ0OiB4ICsgJ3B4J1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgLy8gU2V0IHNsaWRlciBwb3NpdGlvblxuICAgICAgICAgIHkgPSAxNTAgLSAoaHNiLmIgLyAoMTAwIC8gZ3JpZC5oZWlnaHQoKSkpO1xuICAgICAgICAgIGlmKCBoZXggPT09ICcnICkgeSA9IDA7XG4gICAgICAgICAgc2xpZGVyUGlja2VyLmNzcygndG9wJywgeSArICdweCcpO1xuXG4gICAgICAgICAgLy8gVXBkYXRlIHBhbmVsIGNvbG9yXG4gICAgICAgICAgc2xpZGVyLmNzcygnYmFja2dyb3VuZENvbG9yJywgaHNiMmhleCh7IGg6IGhzYi5oLCBzOiBoc2IucywgYjogMTAwIH0pKTtcbiAgICAgICAgICBicmVhaztcblxuICAgICAgICBjYXNlICdzYXR1cmF0aW9uJzpcbiAgICAgICAgICAvLyBTZXQgZ3JpZCBwb3NpdGlvblxuICAgICAgICAgIHggPSBrZWVwV2l0aGluKCg1ICogaHNiLmgpIC8gMTIsIDAsIDE1MCk7XG4gICAgICAgICAgeSA9IGtlZXBXaXRoaW4oZ3JpZC5oZWlnaHQoKSAtIE1hdGguY2VpbChoc2IuYiAvICgxMDAgLyBncmlkLmhlaWdodCgpKSksIDAsIGdyaWQuaGVpZ2h0KCkpO1xuICAgICAgICAgIGdyaWRQaWNrZXIuY3NzKHtcbiAgICAgICAgICAgIHRvcDogeSArICdweCcsXG4gICAgICAgICAgICBsZWZ0OiB4ICsgJ3B4J1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgLy8gU2V0IHNsaWRlciBwb3NpdGlvblxuICAgICAgICAgIHkgPSBrZWVwV2l0aGluKHNsaWRlci5oZWlnaHQoKSAtIChoc2IucyAqIChzbGlkZXIuaGVpZ2h0KCkgLyAxMDApKSwgMCwgc2xpZGVyLmhlaWdodCgpKTtcbiAgICAgICAgICBzbGlkZXJQaWNrZXIuY3NzKCd0b3AnLCB5ICsgJ3B4Jyk7XG5cbiAgICAgICAgICAvLyBVcGRhdGUgVUlcbiAgICAgICAgICBzbGlkZXIuY3NzKCdiYWNrZ3JvdW5kQ29sb3InLCBoc2IyaGV4KHsgaDogaHNiLmgsIHM6IDEwMCwgYjogaHNiLmIgfSkpO1xuICAgICAgICAgIG1pbmljb2xvcnMuZmluZCgnLm1pbmljb2xvcnMtZ3JpZC1pbm5lcicpLmNzcygnb3BhY2l0eScsIGhzYi5zIC8gMTAwKTtcbiAgICAgICAgICBicmVhaztcblxuICAgICAgICBjYXNlICdicmlnaHRuZXNzJzpcbiAgICAgICAgICAvLyBTZXQgZ3JpZCBwb3NpdGlvblxuICAgICAgICAgIHggPSBrZWVwV2l0aGluKCg1ICogaHNiLmgpIC8gMTIsIDAsIDE1MCk7XG4gICAgICAgICAgeSA9IGtlZXBXaXRoaW4oZ3JpZC5oZWlnaHQoKSAtIE1hdGguY2VpbChoc2IucyAvICgxMDAgLyBncmlkLmhlaWdodCgpKSksIDAsIGdyaWQuaGVpZ2h0KCkpO1xuICAgICAgICAgIGdyaWRQaWNrZXIuY3NzKHtcbiAgICAgICAgICAgIHRvcDogeSArICdweCcsXG4gICAgICAgICAgICBsZWZ0OiB4ICsgJ3B4J1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgLy8gU2V0IHNsaWRlciBwb3NpdGlvblxuICAgICAgICAgIHkgPSBrZWVwV2l0aGluKHNsaWRlci5oZWlnaHQoKSAtIChoc2IuYiAqIChzbGlkZXIuaGVpZ2h0KCkgLyAxMDApKSwgMCwgc2xpZGVyLmhlaWdodCgpKTtcbiAgICAgICAgICBzbGlkZXJQaWNrZXIuY3NzKCd0b3AnLCB5ICsgJ3B4Jyk7XG5cbiAgICAgICAgICAvLyBVcGRhdGUgVUlcbiAgICAgICAgICBzbGlkZXIuY3NzKCdiYWNrZ3JvdW5kQ29sb3InLCBoc2IyaGV4KHsgaDogaHNiLmgsIHM6IGhzYi5zLCBiOiAxMDAgfSkpO1xuICAgICAgICAgIG1pbmljb2xvcnMuZmluZCgnLm1pbmljb2xvcnMtZ3JpZC1pbm5lcicpLmNzcygnb3BhY2l0eScsIDEgLSAoaHNiLmIgLyAxMDApKTtcbiAgICAgICAgICBicmVhaztcblxuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIC8vIFNldCBncmlkIHBvc2l0aW9uXG4gICAgICAgICAgeCA9IGtlZXBXaXRoaW4oTWF0aC5jZWlsKGhzYi5zIC8gKDEwMCAvIGdyaWQud2lkdGgoKSkpLCAwLCBncmlkLndpZHRoKCkpO1xuICAgICAgICAgIHkgPSBrZWVwV2l0aGluKGdyaWQuaGVpZ2h0KCkgLSBNYXRoLmNlaWwoaHNiLmIgLyAoMTAwIC8gZ3JpZC5oZWlnaHQoKSkpLCAwLCBncmlkLmhlaWdodCgpKTtcbiAgICAgICAgICBncmlkUGlja2VyLmNzcyh7XG4gICAgICAgICAgICB0b3A6IHkgKyAncHgnLFxuICAgICAgICAgICAgbGVmdDogeCArICdweCdcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIC8vIFNldCBzbGlkZXIgcG9zaXRpb25cbiAgICAgICAgICB5ID0ga2VlcFdpdGhpbihzbGlkZXIuaGVpZ2h0KCkgLSAoaHNiLmggLyAoMzYwIC8gc2xpZGVyLmhlaWdodCgpKSksIDAsIHNsaWRlci5oZWlnaHQoKSk7XG4gICAgICAgICAgc2xpZGVyUGlja2VyLmNzcygndG9wJywgeSArICdweCcpO1xuXG4gICAgICAgICAgLy8gVXBkYXRlIHBhbmVsIGNvbG9yXG4gICAgICAgICAgZ3JpZC5jc3MoJ2JhY2tncm91bmRDb2xvcicsIGhzYjJoZXgoeyBoOiBoc2IuaCwgczogMTAwLCBiOiAxMDAgfSkpO1xuICAgICAgICAgIGJyZWFrO1xuXG4gICAgICB9XG5cbiAgICAgIC8vIEZpcmUgY2hhbmdlIGV2ZW50LCBidXQgb25seSBpZiBtaW5pY29sb3JzIGlzIGZ1bGx5IGluaXRpYWxpemVkXG4gICAgICBpZiggaW5wdXQuZGF0YSgnbWluaWNvbG9ycy1pbml0aWFsaXplZCcpICkge1xuICAgICAgICBkb0NoYW5nZShpbnB1dCwgdmFsdWUsIG9wYWNpdHkpO1xuICAgICAgfVxuXG4gICAgfVxuXG4gICAgLy8gUnVucyB0aGUgY2hhbmdlIGFuZCBjaGFuZ2VEZWxheSBjYWxsYmFja3NcbiAgICBmdW5jdGlvbiBkb0NoYW5nZShpbnB1dCwgdmFsdWUsIG9wYWNpdHkpIHtcblxuICAgICAgdmFyIHNldHRpbmdzID0gaW5wdXQuZGF0YSgnbWluaWNvbG9ycy1zZXR0aW5ncycpLFxuICAgICAgICBsYXN0Q2hhbmdlID0gaW5wdXQuZGF0YSgnbWluaWNvbG9ycy1sYXN0Q2hhbmdlJyksXG4gICAgICAgIG9iaixcbiAgICAgICAgc2VsLFxuICAgICAgICBpO1xuXG4gICAgICAvLyBPbmx5IHJ1biBpZiBpdCBhY3R1YWxseSBjaGFuZ2VkXG4gICAgICBpZiggIWxhc3RDaGFuZ2UgfHwgbGFzdENoYW5nZS52YWx1ZSAhPT0gdmFsdWUgfHwgbGFzdENoYW5nZS5vcGFjaXR5ICE9PSBvcGFjaXR5ICkge1xuXG4gICAgICAgIC8vIFJlbWVtYmVyIGxhc3QtY2hhbmdlZCB2YWx1ZVxuICAgICAgICBpbnB1dC5kYXRhKCdtaW5pY29sb3JzLWxhc3RDaGFuZ2UnLCB7XG4gICAgICAgICAgdmFsdWU6IHZhbHVlLFxuICAgICAgICAgIG9wYWNpdHk6IG9wYWNpdHlcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gQ2hlY2sgYW5kIHNlbGVjdCBhcHBsaWNhYmxlIHN3YXRjaFxuICAgICAgICBpZiAoc2V0dGluZ3Muc3dhdGNoZXMgJiYgc2V0dGluZ3Muc3dhdGNoZXMubGVuZ3RoICE9PSAwKSB7XG4gICAgICAgICAgaWYoIWlzUmdiKHZhbHVlKSkge1xuICAgICAgICAgICAgb2JqID0gaGV4MnJnYih2YWx1ZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgb2JqID0gcGFyc2VSZ2IodmFsdWUsIHRydWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBzZWwgPSAtMTtcbiAgICAgICAgICBmb3IoaSA9IDA7IGkgPCBzZXR0aW5ncy5zd2F0Y2hlcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgaWYgKG9iai5yID09PSBzZXR0aW5ncy5zd2F0Y2hlc1tpXS5yICYmIG9iai5nID09PSBzZXR0aW5ncy5zd2F0Y2hlc1tpXS5nICYmIG9iai5iID09PSBzZXR0aW5ncy5zd2F0Y2hlc1tpXS5iICYmIG9iai5hID09PSBzZXR0aW5ncy5zd2F0Y2hlc1tpXS5hKSB7XG4gICAgICAgICAgICAgIHNlbCA9IGk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuICAgICAgICAgIGlucHV0LnBhcmVudCgpLmZpbmQoJy5taW5pY29sb3JzLXN3YXRjaGVzIC5taW5pY29sb3JzLXN3YXRjaCcpLnJlbW92ZUNsYXNzKCdzZWxlY3RlZCcpO1xuICAgICAgICAgIGlmIChpICE9PSAtMSkge1xuICAgICAgICAgICAgaW5wdXQucGFyZW50KCkuZmluZCgnLm1pbmljb2xvcnMtc3dhdGNoZXMgLm1pbmljb2xvcnMtc3dhdGNoJykuZXEoaSkuYWRkQ2xhc3MoJ3NlbGVjdGVkJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gRmlyZSBjaGFuZ2UgZXZlbnRcbiAgICAgICAgaWYoIHNldHRpbmdzLmNoYW5nZSApIHtcbiAgICAgICAgICBpZiggc2V0dGluZ3MuY2hhbmdlRGVsYXkgKSB7XG4gICAgICAgICAgICAvLyBDYWxsIGFmdGVyIGEgZGVsYXlcbiAgICAgICAgICAgIGNsZWFyVGltZW91dChpbnB1dC5kYXRhKCdtaW5pY29sb3JzLWNoYW5nZVRpbWVvdXQnKSk7XG4gICAgICAgICAgICBpbnB1dC5kYXRhKCdtaW5pY29sb3JzLWNoYW5nZVRpbWVvdXQnLCBzZXRUaW1lb3V0KCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgc2V0dGluZ3MuY2hhbmdlLmNhbGwoaW5wdXQuZ2V0KDApLCB2YWx1ZSwgb3BhY2l0eSk7XG4gICAgICAgICAgICB9LCBzZXR0aW5ncy5jaGFuZ2VEZWxheSkpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBDYWxsIGltbWVkaWF0ZWx5XG4gICAgICAgICAgICBzZXR0aW5ncy5jaGFuZ2UuY2FsbChpbnB1dC5nZXQoMCksIHZhbHVlLCBvcGFjaXR5KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaW5wdXQudHJpZ2dlcignY2hhbmdlJykudHJpZ2dlcignaW5wdXQnKTtcbiAgICAgIH1cblxuICAgIH1cblxuICAgIC8vIEdlbmVyYXRlcyBhbiBSR0IoQSkgb2JqZWN0IGJhc2VkIG9uIHRoZSBpbnB1dCdzIHZhbHVlXG4gICAgZnVuY3Rpb24gcmdiT2JqZWN0KGlucHV0KSB7XG4gICAgICB2YXIgaGV4ID0gcGFyc2VIZXgoJChpbnB1dCkudmFsKCksIHRydWUpLFxuICAgICAgICByZ2IgPSBoZXgycmdiKGhleCksXG4gICAgICAgIG9wYWNpdHkgPSAkKGlucHV0KS5hdHRyKCdkYXRhLW9wYWNpdHknKTtcbiAgICAgIGlmKCAhcmdiICkgcmV0dXJuIG51bGw7XG4gICAgICBpZiggb3BhY2l0eSAhPT0gdW5kZWZpbmVkICkgJC5leHRlbmQocmdiLCB7IGE6IHBhcnNlRmxvYXQob3BhY2l0eSkgfSk7XG4gICAgICByZXR1cm4gcmdiO1xuICAgIH1cblxuICAgIC8vIEdlbmVyYXRlcyBhbiBSR0IoQSkgc3RyaW5nIGJhc2VkIG9uIHRoZSBpbnB1dCdzIHZhbHVlXG4gICAgZnVuY3Rpb24gcmdiU3RyaW5nKGlucHV0LCBhbHBoYSkge1xuICAgICAgdmFyIGhleCA9IHBhcnNlSGV4KCQoaW5wdXQpLnZhbCgpLCB0cnVlKSxcbiAgICAgICAgcmdiID0gaGV4MnJnYihoZXgpLFxuICAgICAgICBvcGFjaXR5ID0gJChpbnB1dCkuYXR0cignZGF0YS1vcGFjaXR5Jyk7XG4gICAgICBpZiggIXJnYiApIHJldHVybiBudWxsO1xuICAgICAgaWYoIG9wYWNpdHkgPT09IHVuZGVmaW5lZCApIG9wYWNpdHkgPSAxO1xuICAgICAgaWYoIGFscGhhICkge1xuICAgICAgICByZXR1cm4gJ3JnYmEoJyArIHJnYi5yICsgJywgJyArIHJnYi5nICsgJywgJyArIHJnYi5iICsgJywgJyArIHBhcnNlRmxvYXQob3BhY2l0eSkgKyAnKSc7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gJ3JnYignICsgcmdiLnIgKyAnLCAnICsgcmdiLmcgKyAnLCAnICsgcmdiLmIgKyAnKSc7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQ29udmVydHMgdG8gdGhlIGxldHRlciBjYXNlIHNwZWNpZmllZCBpbiBzZXR0aW5nc1xuICAgIGZ1bmN0aW9uIGNvbnZlcnRDYXNlKHN0cmluZywgbGV0dGVyQ2FzZSkge1xuICAgICAgcmV0dXJuIGxldHRlckNhc2UgPT09ICd1cHBlcmNhc2UnID8gc3RyaW5nLnRvVXBwZXJDYXNlKCkgOiBzdHJpbmcudG9Mb3dlckNhc2UoKTtcbiAgICB9XG5cbiAgICAvLyBQYXJzZXMgYSBzdHJpbmcgYW5kIHJldHVybnMgYSB2YWxpZCBoZXggc3RyaW5nIHdoZW4gcG9zc2libGVcbiAgICBmdW5jdGlvbiBwYXJzZUhleChzdHJpbmcsIGV4cGFuZCkge1xuICAgICAgc3RyaW5nID0gc3RyaW5nLnJlcGxhY2UoL14jL2csICcnKTtcbiAgICAgIGlmKCAhc3RyaW5nLm1hdGNoKC9eW0EtRjAtOV17Myw2fS9pZykgKSByZXR1cm4gJyc7XG4gICAgICBpZiggc3RyaW5nLmxlbmd0aCAhPT0gMyAmJiBzdHJpbmcubGVuZ3RoICE9PSA2ICkgcmV0dXJuICcnO1xuICAgICAgaWYoIHN0cmluZy5sZW5ndGggPT09IDMgJiYgZXhwYW5kICkge1xuICAgICAgICBzdHJpbmcgPSBzdHJpbmdbMF0gKyBzdHJpbmdbMF0gKyBzdHJpbmdbMV0gKyBzdHJpbmdbMV0gKyBzdHJpbmdbMl0gKyBzdHJpbmdbMl07XG4gICAgICB9XG4gICAgICByZXR1cm4gJyMnICsgc3RyaW5nO1xuICAgIH1cblxuICAgIC8vIFBhcnNlcyBhIHN0cmluZyBhbmQgcmV0dXJucyBhIHZhbGlkIFJHQihBKSBzdHJpbmcgd2hlbiBwb3NzaWJsZVxuICAgIGZ1bmN0aW9uIHBhcnNlUmdiKHN0cmluZywgb2JqKSB7XG5cbiAgICAgIHZhciB2YWx1ZXMgPSBzdHJpbmcucmVwbGFjZSgvW15cXGQsLl0vZywgJycpLFxuICAgICAgICByZ2JhID0gdmFsdWVzLnNwbGl0KCcsJyk7XG5cbiAgICAgIHJnYmFbMF0gPSBrZWVwV2l0aGluKHBhcnNlSW50KHJnYmFbMF0sIDEwKSwgMCwgMjU1KTtcbiAgICAgIHJnYmFbMV0gPSBrZWVwV2l0aGluKHBhcnNlSW50KHJnYmFbMV0sIDEwKSwgMCwgMjU1KTtcbiAgICAgIHJnYmFbMl0gPSBrZWVwV2l0aGluKHBhcnNlSW50KHJnYmFbMl0sIDEwKSwgMCwgMjU1KTtcbiAgICAgIGlmKCByZ2JhWzNdICkge1xuICAgICAgICByZ2JhWzNdID0ga2VlcFdpdGhpbihwYXJzZUZsb2F0KHJnYmFbM10sIDEwKSwgMCwgMSk7XG4gICAgICB9XG5cbiAgICAgIC8vIFJldHVybiBSR0JBIG9iamVjdFxuICAgICAgaWYoIG9iaiApIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICByOiByZ2JhWzBdLFxuICAgICAgICAgIGc6IHJnYmFbMV0sXG4gICAgICAgICAgYjogcmdiYVsyXSxcbiAgICAgICAgICBhOiByZ2JhWzNdID8gcmdiYVszXSA6IG51bGxcbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgLy8gUmV0dXJuIFJHQkEgc3RyaW5nXG4gICAgICBpZiggdHlwZW9mKHJnYmFbM10pICE9PSAndW5kZWZpbmVkJyAmJiByZ2JhWzNdIDw9IDEgKSB7XG4gICAgICAgIHJldHVybiAncmdiYSgnICsgcmdiYVswXSArICcsICcgKyByZ2JhWzFdICsgJywgJyArIHJnYmFbMl0gKyAnLCAnICsgcmdiYVszXSArICcpJztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiAncmdiKCcgKyByZ2JhWzBdICsgJywgJyArIHJnYmFbMV0gKyAnLCAnICsgcmdiYVsyXSArICcpJztcbiAgICAgIH1cblxuICAgIH1cblxuICAgIC8vIFBhcnNlcyBhIHN0cmluZyBhbmQgcmV0dXJucyBhIHZhbGlkIGNvbG9yIHN0cmluZyB3aGVuIHBvc3NpYmxlXG4gICAgZnVuY3Rpb24gcGFyc2VJbnB1dChzdHJpbmcsIGV4cGFuZCkge1xuICAgICAgaWYoIGlzUmdiKHN0cmluZykgKSB7XG4gICAgICAgIC8vIFJldHVybnMgYSB2YWxpZCByZ2IoYSkgc3RyaW5nXG4gICAgICAgIHJldHVybiBwYXJzZVJnYihzdHJpbmcpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHBhcnNlSGV4KHN0cmluZywgZXhwYW5kKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBLZWVwcyB2YWx1ZSB3aXRoaW4gbWluIGFuZCBtYXhcbiAgICBmdW5jdGlvbiBrZWVwV2l0aGluKHZhbHVlLCBtaW4sIG1heCkge1xuICAgICAgaWYoIHZhbHVlIDwgbWluICkgdmFsdWUgPSBtaW47XG4gICAgICBpZiggdmFsdWUgPiBtYXggKSB2YWx1ZSA9IG1heDtcbiAgICAgIHJldHVybiB2YWx1ZTtcbiAgICB9XG5cbiAgICAvLyBDaGVja3MgaWYgYSBzdHJpbmcgaXMgYSB2YWxpZCBSR0IoQSkgc3RyaW5nXG4gICAgZnVuY3Rpb24gaXNSZ2Ioc3RyaW5nKSB7XG4gICAgICB2YXIgcmdiID0gc3RyaW5nLm1hdGNoKC9ecmdiYT9bXFxzK10/XFwoW1xccytdPyhcXGQrKVtcXHMrXT8sW1xccytdPyhcXGQrKVtcXHMrXT8sW1xccytdPyhcXGQrKVtcXHMrXT8vaSk7XG4gICAgICByZXR1cm4gKHJnYiAmJiByZ2IubGVuZ3RoID09PSA0KSA/IHRydWUgOiBmYWxzZTtcbiAgICB9XG5cbiAgICAvLyBGdW5jdGlvbiB0byBnZXQgYWxwaGEgZnJvbSBhIFJHQihBKSBzdHJpbmdcbiAgICBmdW5jdGlvbiBnZXRBbHBoYShyZ2JhKSB7XG4gICAgICByZ2JhID0gcmdiYS5tYXRjaCgvXnJnYmE/W1xccytdP1xcKFtcXHMrXT8oXFxkKylbXFxzK10/LFtcXHMrXT8oXFxkKylbXFxzK10/LFtcXHMrXT8oXFxkKylbXFxzK10/LFtcXHMrXT8oXFxkKyhcXC5cXGR7MSwyfSk/fFxcLlxcZHsxLDJ9KVtcXHMrXT8vaSk7XG4gICAgICByZXR1cm4gKHJnYmEgJiYgcmdiYS5sZW5ndGggPT09IDYpID8gcmdiYVs0XSA6ICcxJztcbiAgICB9XG5cbiAgICAvLyBDb252ZXJ0cyBhbiBIU0Igb2JqZWN0IHRvIGFuIFJHQiBvYmplY3RcbiAgICBmdW5jdGlvbiBoc2IycmdiKGhzYikge1xuICAgICAgdmFyIHJnYiA9IHt9O1xuICAgICAgdmFyIGggPSBNYXRoLnJvdW5kKGhzYi5oKTtcbiAgICAgIHZhciBzID0gTWF0aC5yb3VuZChoc2IucyAqIDI1NSAvIDEwMCk7XG4gICAgICB2YXIgdiA9IE1hdGgucm91bmQoaHNiLmIgKiAyNTUgLyAxMDApO1xuICAgICAgaWYocyA9PT0gMCkge1xuICAgICAgICByZ2IuciA9IHJnYi5nID0gcmdiLmIgPSB2O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIHQxID0gdjtcbiAgICAgICAgdmFyIHQyID0gKDI1NSAtIHMpICogdiAvIDI1NTtcbiAgICAgICAgdmFyIHQzID0gKHQxIC0gdDIpICogKGggJSA2MCkgLyA2MDtcbiAgICAgICAgaWYoIGggPT09IDM2MCApIGggPSAwO1xuICAgICAgICBpZiggaCA8IDYwICkgeyByZ2IuciA9IHQxOyByZ2IuYiA9IHQyOyByZ2IuZyA9IHQyICsgdDM7IH1cbiAgICAgICAgZWxzZSBpZiggaCA8IDEyMCApIHtyZ2IuZyA9IHQxOyByZ2IuYiA9IHQyOyByZ2IuciA9IHQxIC0gdDM7IH1cbiAgICAgICAgZWxzZSBpZiggaCA8IDE4MCApIHtyZ2IuZyA9IHQxOyByZ2IuciA9IHQyOyByZ2IuYiA9IHQyICsgdDM7IH1cbiAgICAgICAgZWxzZSBpZiggaCA8IDI0MCApIHtyZ2IuYiA9IHQxOyByZ2IuciA9IHQyOyByZ2IuZyA9IHQxIC0gdDM7IH1cbiAgICAgICAgZWxzZSBpZiggaCA8IDMwMCApIHtyZ2IuYiA9IHQxOyByZ2IuZyA9IHQyOyByZ2IuciA9IHQyICsgdDM7IH1cbiAgICAgICAgZWxzZSBpZiggaCA8IDM2MCApIHtyZ2IuciA9IHQxOyByZ2IuZyA9IHQyOyByZ2IuYiA9IHQxIC0gdDM7IH1cbiAgICAgICAgZWxzZSB7IHJnYi5yID0gMDsgcmdiLmcgPSAwOyByZ2IuYiA9IDA7IH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHI6IE1hdGgucm91bmQocmdiLnIpLFxuICAgICAgICBnOiBNYXRoLnJvdW5kKHJnYi5nKSxcbiAgICAgICAgYjogTWF0aC5yb3VuZChyZ2IuYilcbiAgICAgIH07XG4gICAgfVxuXG4gICAgLy8gQ29udmVydHMgYW4gUkdCIHN0cmluZyB0byBhIGhleCBzdHJpbmdcbiAgICBmdW5jdGlvbiByZ2JTdHJpbmcyaGV4KHJnYil7XG4gICAgICByZ2IgPSByZ2IubWF0Y2goL15yZ2JhP1tcXHMrXT9cXChbXFxzK10/KFxcZCspW1xccytdPyxbXFxzK10/KFxcZCspW1xccytdPyxbXFxzK10/KFxcZCspW1xccytdPy9pKTtcbiAgICAgIHJldHVybiAocmdiICYmIHJnYi5sZW5ndGggPT09IDQpID8gJyMnICtcbiAgICAgICgnMCcgKyBwYXJzZUludChyZ2JbMV0sMTApLnRvU3RyaW5nKDE2KSkuc2xpY2UoLTIpICtcbiAgICAgICgnMCcgKyBwYXJzZUludChyZ2JbMl0sMTApLnRvU3RyaW5nKDE2KSkuc2xpY2UoLTIpICtcbiAgICAgICgnMCcgKyBwYXJzZUludChyZ2JbM10sMTApLnRvU3RyaW5nKDE2KSkuc2xpY2UoLTIpIDogJyc7XG4gICAgfVxuXG4gICAgLy8gQ29udmVydHMgYW4gUkdCIG9iamVjdCB0byBhIGhleCBzdHJpbmdcbiAgICBmdW5jdGlvbiByZ2IyaGV4KHJnYikge1xuICAgICAgdmFyIGhleCA9IFtcbiAgICAgICAgcmdiLnIudG9TdHJpbmcoMTYpLFxuICAgICAgICByZ2IuZy50b1N0cmluZygxNiksXG4gICAgICAgIHJnYi5iLnRvU3RyaW5nKDE2KVxuICAgICAgXTtcbiAgICAgICQuZWFjaChoZXgsIGZ1bmN0aW9uKG5yLCB2YWwpIHtcbiAgICAgICAgaWYgKHZhbC5sZW5ndGggPT09IDEpIGhleFtucl0gPSAnMCcgKyB2YWw7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiAnIycgKyBoZXguam9pbignJyk7XG4gICAgfVxuXG4gICAgLy8gQ29udmVydHMgYW4gSFNCIG9iamVjdCB0byBhIGhleCBzdHJpbmdcbiAgICBmdW5jdGlvbiBoc2IyaGV4KGhzYikge1xuICAgICAgcmV0dXJuIHJnYjJoZXgoaHNiMnJnYihoc2IpKTtcbiAgICB9XG5cbiAgICAvLyBDb252ZXJ0cyBhIGhleCBzdHJpbmcgdG8gYW4gSFNCIG9iamVjdFxuICAgIGZ1bmN0aW9uIGhleDJoc2IoaGV4KSB7XG4gICAgICB2YXIgaHNiID0gcmdiMmhzYihoZXgycmdiKGhleCkpO1xuICAgICAgaWYoIGhzYi5zID09PSAwICkgaHNiLmggPSAzNjA7XG4gICAgICByZXR1cm4gaHNiO1xuICAgIH1cblxuICAgIC8vIENvbnZlcnRzIGFuIFJHQiBvYmplY3QgdG8gYW4gSFNCIG9iamVjdFxuICAgIGZ1bmN0aW9uIHJnYjJoc2IocmdiKSB7XG4gICAgICB2YXIgaHNiID0geyBoOiAwLCBzOiAwLCBiOiAwIH07XG4gICAgICB2YXIgbWluID0gTWF0aC5taW4ocmdiLnIsIHJnYi5nLCByZ2IuYik7XG4gICAgICB2YXIgbWF4ID0gTWF0aC5tYXgocmdiLnIsIHJnYi5nLCByZ2IuYik7XG4gICAgICB2YXIgZGVsdGEgPSBtYXggLSBtaW47XG4gICAgICBoc2IuYiA9IG1heDtcbiAgICAgIGhzYi5zID0gbWF4ICE9PSAwID8gMjU1ICogZGVsdGEgLyBtYXggOiAwO1xuICAgICAgaWYoIGhzYi5zICE9PSAwICkge1xuICAgICAgICBpZiggcmdiLnIgPT09IG1heCApIHtcbiAgICAgICAgICBoc2IuaCA9IChyZ2IuZyAtIHJnYi5iKSAvIGRlbHRhO1xuICAgICAgICB9IGVsc2UgaWYoIHJnYi5nID09PSBtYXggKSB7XG4gICAgICAgICAgaHNiLmggPSAyICsgKHJnYi5iIC0gcmdiLnIpIC8gZGVsdGE7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaHNiLmggPSA0ICsgKHJnYi5yIC0gcmdiLmcpIC8gZGVsdGE7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGhzYi5oID0gLTE7XG4gICAgICB9XG4gICAgICBoc2IuaCAqPSA2MDtcbiAgICAgIGlmKCBoc2IuaCA8IDAgKSB7XG4gICAgICAgIGhzYi5oICs9IDM2MDtcbiAgICAgIH1cbiAgICAgIGhzYi5zICo9IDEwMC8yNTU7XG4gICAgICBoc2IuYiAqPSAxMDAvMjU1O1xuICAgICAgcmV0dXJuIGhzYjtcbiAgICB9XG5cbiAgICAvLyBDb252ZXJ0cyBhIGhleCBzdHJpbmcgdG8gYW4gUkdCIG9iamVjdFxuICAgIGZ1bmN0aW9uIGhleDJyZ2IoaGV4KSB7XG4gICAgICBoZXggPSBwYXJzZUludCgoKGhleC5pbmRleE9mKCcjJykgPiAtMSkgPyBoZXguc3Vic3RyaW5nKDEpIDogaGV4KSwgMTYpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgLyoganNoaW50IGlnbm9yZTpzdGFydCAqL1xuICAgICAgICByOiBoZXggPj4gMTYsXG4gICAgICAgIGc6IChoZXggJiAweDAwRkYwMCkgPj4gOCxcbiAgICAgICAgYjogKGhleCAmIDB4MDAwMEZGKVxuICAgICAgICAvKiBqc2hpbnQgaWdub3JlOmVuZCAqL1xuICAgICAgfTtcbiAgICB9XG5cbiAgICAvLyBIYW5kbGUgZXZlbnRzXG4gICAgJChkb2N1bWVudClcbiAgICAgIC8vIEhpZGUgb24gY2xpY2tzIG91dHNpZGUgb2YgdGhlIGNvbnRyb2xcbiAgICAgIC5vbignbW91c2Vkb3duLm1pbmljb2xvcnMgdG91Y2hzdGFydC5taW5pY29sb3JzJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgaWYoICEkKGV2ZW50LnRhcmdldCkucGFyZW50cygpLmFkZChldmVudC50YXJnZXQpLmhhc0NsYXNzKCdtaW5pY29sb3JzJykgKSB7XG4gICAgICAgICAgaGlkZSgpO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgICAgLy8gU3RhcnQgbW92aW5nXG4gICAgICAub24oJ21vdXNlZG93bi5taW5pY29sb3JzIHRvdWNoc3RhcnQubWluaWNvbG9ycycsICcubWluaWNvbG9ycy1ncmlkLCAubWluaWNvbG9ycy1zbGlkZXIsIC5taW5pY29sb3JzLW9wYWNpdHktc2xpZGVyJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgdmFyIHRhcmdldCA9ICQodGhpcyk7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICQoZG9jdW1lbnQpLmRhdGEoJ21pbmljb2xvcnMtdGFyZ2V0JywgdGFyZ2V0KTtcbiAgICAgICAgbW92ZSh0YXJnZXQsIGV2ZW50LCB0cnVlKTtcbiAgICAgIH0pXG4gICAgICAvLyBNb3ZlIHBpY2tlcnNcbiAgICAgIC5vbignbW91c2Vtb3ZlLm1pbmljb2xvcnMgdG91Y2htb3ZlLm1pbmljb2xvcnMnLCBmdW5jdGlvbihldmVudCkge1xuICAgICAgICB2YXIgdGFyZ2V0ID0gJChkb2N1bWVudCkuZGF0YSgnbWluaWNvbG9ycy10YXJnZXQnKTtcbiAgICAgICAgaWYoIHRhcmdldCApIG1vdmUodGFyZ2V0LCBldmVudCk7XG4gICAgICB9KVxuICAgICAgLy8gU3RvcCBtb3ZpbmdcbiAgICAgIC5vbignbW91c2V1cC5taW5pY29sb3JzIHRvdWNoZW5kLm1pbmljb2xvcnMnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgJCh0aGlzKS5yZW1vdmVEYXRhKCdtaW5pY29sb3JzLXRhcmdldCcpO1xuICAgICAgfSlcbiAgICAgIC8vIFNlbGVjdGVkIGEgc3dhdGNoXG4gICAgICAub24oJ2NsaWNrLm1pbmljb2xvcnMnLCAnLm1pbmljb2xvcnMtc3dhdGNoZXMgbGknLCBmdW5jdGlvbihldmVudCkge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB2YXIgdGFyZ2V0ID0gJCh0aGlzKSwgaW5wdXQgPSB0YXJnZXQucGFyZW50cygnLm1pbmljb2xvcnMnKS5maW5kKCcubWluaWNvbG9ycy1pbnB1dCcpLCBjb2xvciA9IHRhcmdldC5kYXRhKCdzd2F0Y2gtY29sb3InKTtcbiAgICAgICAgdXBkYXRlSW5wdXQoaW5wdXQsIGNvbG9yLCBnZXRBbHBoYShjb2xvcikpO1xuICAgICAgICB1cGRhdGVGcm9tSW5wdXQoaW5wdXQpO1xuICAgICAgfSlcbiAgICAgIC8vIFNob3cgcGFuZWwgd2hlbiBzd2F0Y2ggaXMgY2xpY2tlZFxuICAgICAgLm9uKCdtb3VzZWRvd24ubWluaWNvbG9ycyB0b3VjaHN0YXJ0Lm1pbmljb2xvcnMnLCAnLm1pbmljb2xvcnMtaW5wdXQtc3dhdGNoJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgdmFyIGlucHV0ID0gJCh0aGlzKS5wYXJlbnQoKS5maW5kKCcubWluaWNvbG9ycy1pbnB1dCcpO1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBpZiggaW5wdXQucGFyZW50KCkuZmluZCgnLm1pbmljb2xvcnMtcGFuZWwnKS5jc3MoXCJkaXNwbGF5XCIpICE9PSBcIm5vbmVcIil7XG4gICAgICAgICAgLy90b2RvXG4gICAgICAgICAgLy9oaWRlKCk7XG4gICAgICAgIH1lbHNle1xuICAgICAgICAgIHNob3coaW5wdXQpO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgICAgLy8gU2hvdyBvbiBmb2N1c1xuICAgICAgLm9uKCdmb2N1cy5taW5pY29sb3JzJywgJy5taW5pY29sb3JzLWlucHV0JywgZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBpbnB1dCA9ICQodGhpcyk7XG4gICAgICAgIGlmKCAhaW5wdXQuZGF0YSgnbWluaWNvbG9ycy1pbml0aWFsaXplZCcpICkgcmV0dXJuO1xuICAgICAgICBzaG93KGlucHV0KTtcbiAgICAgIH0pXG4gICAgICAvLyBVcGRhdGUgdmFsdWUgb24gYmx1clxuICAgICAgLm9uKCdibHVyLm1pbmljb2xvcnMnLCAnLm1pbmljb2xvcnMtaW5wdXQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGlucHV0ID0gJCh0aGlzKSxcbiAgICAgICAgICBzZXR0aW5ncyA9IGlucHV0LmRhdGEoJ21pbmljb2xvcnMtc2V0dGluZ3MnKSxcbiAgICAgICAgICBrZXl3b3JkcyxcbiAgICAgICAgICBoZXgsXG4gICAgICAgICAgcmdiYSxcbiAgICAgICAgICBzd2F0Y2hPcGFjaXR5LFxuICAgICAgICAgIHZhbHVlO1xuXG4gICAgICAgIGlmKCAhaW5wdXQuZGF0YSgnbWluaWNvbG9ycy1pbml0aWFsaXplZCcpICkgcmV0dXJuO1xuXG4gICAgICAgIC8vIEdldCBhcnJheSBvZiBsb3dlcmNhc2Uga2V5d29yZHNcbiAgICAgICAga2V5d29yZHMgPSAhc2V0dGluZ3Mua2V5d29yZHMgPyBbXSA6ICQubWFwKHNldHRpbmdzLmtleXdvcmRzLnNwbGl0KCcsJyksIGZ1bmN0aW9uKGEpIHtcbiAgICAgICAgICByZXR1cm4gJC50cmltKGEudG9Mb3dlckNhc2UoKSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFNldCBjb2xvciBzdHJpbmdcbiAgICAgICAgaWYoIGlucHV0LnZhbCgpICE9PSAnJyAmJiAkLmluQXJyYXkoaW5wdXQudmFsKCkudG9Mb3dlckNhc2UoKSwga2V5d29yZHMpID4gLTEgKSB7XG4gICAgICAgICAgdmFsdWUgPSBpbnB1dC52YWwoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBHZXQgUkdCQSB2YWx1ZXMgZm9yIGVhc3kgY29udmVyc2lvblxuICAgICAgICAgIGlmKCBpc1JnYihpbnB1dC52YWwoKSkgKSB7XG4gICAgICAgICAgICByZ2JhID0gcGFyc2VSZ2IoaW5wdXQudmFsKCksIHRydWUpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBoZXggPSBwYXJzZUhleChpbnB1dC52YWwoKSwgdHJ1ZSk7XG4gICAgICAgICAgICByZ2JhID0gaGV4ID8gaGV4MnJnYihoZXgpIDogbnVsbDtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBDb252ZXJ0IHRvIGZvcm1hdFxuICAgICAgICAgIGlmKCByZ2JhID09PSBudWxsICkge1xuICAgICAgICAgICAgdmFsdWUgPSBzZXR0aW5ncy5kZWZhdWx0VmFsdWU7XG4gICAgICAgICAgfSBlbHNlIGlmKCBzZXR0aW5ncy5mb3JtYXQgPT09ICdyZ2InICkge1xuICAgICAgICAgICAgdmFsdWUgPSBzZXR0aW5ncy5vcGFjaXR5ID9cbiAgICAgICAgICAgICAgcGFyc2VSZ2IoJ3JnYmEoJyArIHJnYmEuciArICcsJyArIHJnYmEuZyArICcsJyArIHJnYmEuYiArICcsJyArIGlucHV0LmF0dHIoJ2RhdGEtb3BhY2l0eScpICsgJyknKSA6XG4gICAgICAgICAgICAgIHBhcnNlUmdiKCdyZ2IoJyArIHJnYmEuciArICcsJyArIHJnYmEuZyArICcsJyArIHJnYmEuYiArICcpJyk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhbHVlID0gcmdiMmhleChyZ2JhKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBVcGRhdGUgc3dhdGNoIG9wYWNpdHlcbiAgICAgICAgc3dhdGNoT3BhY2l0eSA9IHNldHRpbmdzLm9wYWNpdHkgPyBpbnB1dC5hdHRyKCdkYXRhLW9wYWNpdHknKSA6IDE7XG4gICAgICAgIGlmKCB2YWx1ZS50b0xvd2VyQ2FzZSgpID09PSAndHJhbnNwYXJlbnQnICkgc3dhdGNoT3BhY2l0eSA9IDA7XG4gICAgICAgIGlucHV0XG4gICAgICAgICAgLmNsb3Nlc3QoJy5taW5pY29sb3JzJylcbiAgICAgICAgICAuZmluZCgnLm1pbmljb2xvcnMtaW5wdXQtc3dhdGNoID4gc3BhbicpXG4gICAgICAgICAgLmNzcygnb3BhY2l0eScsIHN3YXRjaE9wYWNpdHkpO1xuXG4gICAgICAgIC8vIFNldCBpbnB1dCB2YWx1ZVxuICAgICAgICBpbnB1dC52YWwodmFsdWUpO1xuXG4gICAgICAgIC8vIElzIGl0IGJsYW5rP1xuICAgICAgICBpZiggaW5wdXQudmFsKCkgPT09ICcnICkgaW5wdXQudmFsKHBhcnNlSW5wdXQoc2V0dGluZ3MuZGVmYXVsdFZhbHVlLCB0cnVlKSk7XG5cbiAgICAgICAgLy8gQWRqdXN0IGNhc2VcbiAgICAgICAgaW5wdXQudmFsKCBjb252ZXJ0Q2FzZShpbnB1dC52YWwoKSwgc2V0dGluZ3MubGV0dGVyQ2FzZSkgKTtcblxuICAgICAgfSlcbiAgICAgIC8vIEhhbmRsZSBrZXlwcmVzc2VzXG4gICAgICAub24oJ2tleWRvd24ubWluaWNvbG9ycycsICcubWluaWNvbG9ycy1pbnB1dCcsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgIHZhciBpbnB1dCA9ICQodGhpcyk7XG4gICAgICAgIGlmKCAhaW5wdXQuZGF0YSgnbWluaWNvbG9ycy1pbml0aWFsaXplZCcpICkgcmV0dXJuO1xuICAgICAgICBzd2l0Y2goZXZlbnQua2V5Q29kZSkge1xuICAgICAgICAgIGNhc2UgOTogLy8gdGFiXG4gICAgICAgICAgICBoaWRlKCk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIDEzOiAvLyBlbnRlclxuICAgICAgICAgIGNhc2UgMjc6IC8vIGVzY1xuICAgICAgICAgICAgaGlkZSgpO1xuICAgICAgICAgICAgaW5wdXQuYmx1cigpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgICAvLyBVcGRhdGUgb24ga2V5dXBcbiAgICAgIC5vbigna2V5dXAubWluaWNvbG9ycycsICcubWluaWNvbG9ycy1pbnB1dCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgaW5wdXQgPSAkKHRoaXMpO1xuICAgICAgICBpZiggIWlucHV0LmRhdGEoJ21pbmljb2xvcnMtaW5pdGlhbGl6ZWQnKSApIHJldHVybjtcbiAgICAgICAgdXBkYXRlRnJvbUlucHV0KGlucHV0LCB0cnVlKTtcbiAgICAgIH0pXG4gICAgICAvLyBVcGRhdGUgb24gcGFzdGVcbiAgICAgIC5vbigncGFzdGUubWluaWNvbG9ycycsICcubWluaWNvbG9ycy1pbnB1dCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgaW5wdXQgPSAkKHRoaXMpO1xuICAgICAgICBpZiggIWlucHV0LmRhdGEoJ21pbmljb2xvcnMtaW5pdGlhbGl6ZWQnKSApIHJldHVybjtcbiAgICAgICAgc2V0VGltZW91dCggZnVuY3Rpb24oKSB7XG4gICAgICAgICAgdXBkYXRlRnJvbUlucHV0KGlucHV0LCB0cnVlKTtcbiAgICAgICAgfSwgMSk7XG4gICAgICB9KTtcblxuICB9KSk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gcGx1Z2lucy8kLm1pbmljb2xvcnMuanMiLCJcbmlmKCEkLmZvbnRTZWxlY3Rvcil7XG4gIHJlcXVpcmUoXCIuLi8uLi9wbHVnaW5zLyQuZm9udFNlbGVjdG9yXCIpO1xufVxuXG5pZih0eXBlb2YgVG9vbGJhciA9PT0gXCJ1bmRlZmluZWRcIil7XG4gIHZhciBUb29sYmFyID0gcmVxdWlyZShcIi4uL3Rvb2xiYXJcIik7XG59XG5cblRvb2xiYXIucHJvdG90eXBlLmZvbnRzID0gW1xuICAnQXJpYWwsSGVsdmV0aWNhLHNhbnMtc2VyaWYnLFxuICAnQXJpYWwgQmxhY2ssR2FkZ2V0LHNhbnMtc2VyaWYnLFxuICAnQ29taWMgU2FucyBNUyxjdXJzaXZlJyxcbiAgJ0NvdXJpZXIgTmV3LENvdXJpZXIsbW9ub3NwYWNlJyxcbiAgJ0dlb3JnaWEsc2VyaWYnLFxuICAnSW1wYWN0LENoYXJjb2FsLHNhbnMtc2VyaWYnLFxuICAnTHVjaWRhIENvbnNvbGUsTW9uYWNvLG1vbm9zcGFjZScsXG4gICdMdWNpZGEgU2FucyBVbmljb2RlLEx1Y2lkYSBHcmFuZGUsc2Fucy1zZXJpZicsXG4gICdQYWxhdGlubyBMaW5vdHlwZSxCb29rIEFudGlxdWEsUGFsYXRpbm8sc2VyaWYnLFxuICAnVGFob21hLEdlbmV2YSxzYW5zLXNlcmlmJyxcbiAgJ1RpbWVzIE5ldyBSb21hbixUaW1lcyxzZXJpZicsXG4gICdUcmVidWNoZXQgTVMsSGVsdmV0aWNhLHNhbnMtc2VyaWYnLFxuICAnVmVyZGFuYSxHZW5ldmEsc2Fucy1zZXJpZicsXG4gICdHaWxsIFNhbnMsR2VuZXZhLHNhbnMtc2VyaWYnXG5dO1xuXG5cblRvb2xiYXIucHJvdG90eXBlLnRvb2xzLmZvbnRGYW1pbHkgPSB7XG4gIHNjb3BlOiBmdW5jdGlvbiAoZGF0YSwgb3B0aW9ucykge1xuICAgIHJldHVybiB7XG4gICAgICAvL2N1cnJlbnRWYWx1ZTogZGF0YS52YWx1ZS5nZXQoKSxcbiAgICAgIG9uY2hhbmdlOiBmdW5jdGlvbiAoZSkge1xuICAgICAgICBkYXRhLnZhbHVlLnNldChwYXJzZUZsb2F0KCQoZS50YXJnZXQpLnZhbCgpKSk7XG4gICAgICB9XG4gICAgfVxuICB9LFxuICB0ZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJvYmplY3QtbWVudS1pdGVtIG9iamVjdC1tZW51LWZvbnQtZmFtaWx5XCIgdGl0bGU9XCJ7dGl0bGV9XCI+JyArXG4gICc8ZGl2IGNsYXNzPVwiZm9udFNlbGVjdFwiIHRyYW5zY2x1ZGU+PGRpdiBjbGFzcz1cImFycm93LWRvd25cIj4nLFxuICAgIHBvc3Q6IGZ1bmN0aW9uICgkaXRlbSwgZGF0YSwgb3B0aW9ucywgdHJhbnNjbHVkZSkge1xuXG4gICAgdHJhbnNjbHVkZS5mb250U2VsZWN0b3Ioe1xuICAgICAgJ2hpZGVfZmFsbGJhY2tzJzogdHJ1ZSxcbiAgICAgICdpbml0aWFsJzogZGF0YS52YWx1ZS5nZXQoKSwvLydDb3VyaWVyIE5ldyxDb3VyaWVyIE5ldyxDb3VyaWVyLG1vbm9zcGFjZScsXG4gICAgICAnc2VsZWN0ZWQnOiBkYXRhLnZhbHVlLnNldC5iaW5kKGRhdGEudGFyZ2V0KSxcbiAgICAgICdmb250cyc6IGRhdGEuZGF0YVxuICAgIH0pO1xuXG4gICAgdGhpcy5vbihcImRlc3Ryb3lcIiwoKSA9PiB7XG4gICAgICB0cmFuc2NsdWRlLmZvbnRTZWxlY3RvcihcImRlc3Ryb3lcIik7XG4gICAgfSlcbiAgfVxufTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyB0b29sYmFyL21vZHVsZXMvdG9vbGJhci5mb250cy5qcyIsIi8qKlxuICogRm9udCBTZWxlY3RvciAtIGpRdWVyeSBwbHVnaW4gMC4xXG4gKlxuICogQ29weXJpZ2h0IChjKSAyMDEyIENocmlzIER5ZXJcbiAqXG4gKiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICpcbiAqIFJlZGlzdHJpYnV0aW9uIGFuZCB1c2UgaW4gc291cmNlIGFuZCBiaW5hcnkgZm9ybXMsIHdpdGggb3Igd2l0aG91dCBtb2RpZmljYXRpb24sIGFyZSBwZXJtaXR0ZWQgcHJvdmlkZWQgdGhhdCB0aGUgZm9sbG93aW5nXG4gKiBjb25kaXRpb25zIGFyZSBtZXQ6XG4gKlxuICogUmVkaXN0cmlidXRpb25zIG9mIHNvdXJjZSBjb2RlIG11c3QgcmV0YWluIHRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlLCB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZ1xuICogZGlzY2xhaW1lci4gUmVkaXN0cmlidXRpb25zIGluIGJpbmFyeSBmb3JtIG11c3QgcmVwcm9kdWNlIHRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlLCB0aGlzIGxpc3Qgb2YgY29uZGl0aW9uc1xuICogYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lciBpbiB0aGUgZG9jdW1lbnRhdGlvbiBhbmQvb3Igb3RoZXIgbWF0ZXJpYWxzIHByb3ZpZGVkIHdpdGggdGhlIGRpc3RyaWJ1dGlvbi5cbiAqXG4gKiBUSElTIFNPRlRXQVJFIElTIFBST1ZJREVEIEJZIFRIRSBDT1BZUklHSFQgSE9MREVSUyBBTkQgQ09OVFJJQlVUT1JTIFwiQVMgSVNcIiBBTkQgQU5ZIEVYUFJFU1MgT1IgSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsXG4gKiBCVVQgTk9UIExJTUlURUQgVE8sIFRIRSBJTVBMSUVEIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZIEFORCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBUkUgRElTQ0xBSU1FRC4gSU4gTk9cbiAqIEVWRU5UIFNIQUxMIFRIRSBDT1BZUklHSFQgSE9MREVSIE9SIENPTlRSSUJVVE9SUyBCRSBMSUFCTEUgRk9SIEFOWSBESVJFQ1QsIElORElSRUNULCBJTkNJREVOVEFMLCBTUEVDSUFMLCBFWEVNUExBUlksIE9SXG4gKiBDT05TRVFVRU5USUFMIERBTUFHRVMgKElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBQUk9DVVJFTUVOVCBPRiBTVUJTVElUVVRFIEdPT0RTIE9SIFNFUlZJQ0VTOyBMT1NTIE9GIFVTRSwgREFUQSwgT1IgUFJPRklUUztcbiAqIE9SIEJVU0lORVNTIElOVEVSUlVQVElPTikgSE9XRVZFUiBDQVVTRUQgQU5EIE9OIEFOWSBUSEVPUlkgT0YgTElBQklMSVRZLCBXSEVUSEVSIElOIENPTlRSQUNULCBTVFJJQ1QgTElBQklMSVRZLCBPUiBUT1JUXG4gKiAoSU5DTFVESU5HIE5FR0xJR0VOQ0UgT1IgT1RIRVJXSVNFKSBBUklTSU5HIElOIEFOWSBXQVkgT1VUIE9GIFRIRSBVU0UgT0YgVEhJUyBTT0ZUV0FSRSwgRVZFTiBJRiBBRFZJU0VEIE9GIFRIRSBQT1NTSUJJTElUWSBPRlxuICogU1VDSCBEQU1BR0UuXG4gKlxuICovXG5cblxuXG4oZnVuY3Rpb24gKGZhY3RvcnkpIHtcbiAgaWYgKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0Jykge1xuICAgIG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeShyZXF1aXJlKCdqcXVlcnknKSk7XG4gIH0gZWxzZSB7XG4gICAgZmFjdG9yeShqUXVlcnkpO1xuICB9XG59KFxuICAgIGZ1bmN0aW9uKCAkICkge1xuXG4gICd1c2Ugc3RyaWN0JztcbiAgLy9pZihfICYmIF8uc3R5bGVTaGVldENvbnRhaW5zICYmICFfLnN0eWxlU2hlZXRDb250YWlucygnLmZvbnRTZWxlY3QnKSl7XG4gIC8vICBfLmxpbmtDU1MoXy5zY3JpcHRVUkwoKSArIFwiLy4uLy4uL2Nzcy9qcXVlcnkuZm9udFNlbGVjdG9yLmNzc1wiKTtcbiAgLy99XG5cbiAgdmFyIHNldHRpbmdzO1xuXG4gIHZhciBtZXRob2RzID0ge1xuICAgIGRlc3Ryb3kgOiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICB0aGlzLnVsLnJlbW92ZSgpO1xuICAgIH0sXG4gICAgY2xvc2UgOiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICB0aGlzLmNsb3NlVWwoKTtcbiAgICB9LFxuICAgIGluaXQgOiBmdW5jdGlvbihvcHRpb25zKSB7XG5cbiAgICAgIHNldHRpbmdzID0gJC5leHRlbmQoIHtcbiAgICAgICAgJ2hpZGVfZmFsbGJhY2tzJyA6IGZhbHNlLFxuICAgICAgICAnc2VsZWN0ZWQnIDogZnVuY3Rpb24oc3R5bGUpIHt9LFxuICAgICAgICAnb3BlbmVkJyA6IGZ1bmN0aW9uKCkge30sXG4gICAgICAgICdjbG9zZWQnIDogZnVuY3Rpb24oKSB7fSxcbiAgICAgICAgJ2luaXRpYWwnIDogJycsXG4gICAgICAgICdmb250cycgOiBbXVxuICAgICAgfSwgb3B0aW9ucyk7XG5cbiAgICAgIHZhciByb290ID0gdGhpcztcbiAgICAgIHZhciAkcm9vdCA9ICQodGhpcyk7XG4gICAgICByb290LnNlbGVjdGVkQ2FsbGJhY2sgPSBzZXR0aW5nc1snc2VsZWN0ZWQnXTtcbiAgICAgIHJvb3Qub3BlbmVkQ2FsbGJhY2sgPSBzZXR0aW5nc1snb3BlbmVkJ107XG4gICAgICByb290LmNsb3NlZENhbGxiYWNrID0gc2V0dGluZ3NbJ2Nsb3NlZCddO1xuICAgICAgdmFyIHZpc2libGUgPSBmYWxzZTtcbiAgICAgIHZhciBzZWxlY3RlZCA9IGZhbHNlO1xuICAgICAgdmFyIG9wZW5lZENsYXNzID0gJ2ZvbnRTZWxlY3RPcGVuJztcblxuICAgICAgdmFyIGRpc3BsYXlOYW1lID0gZnVuY3Rpb24oZm9udCkge1xuICAgICAgICBpZiAoc2V0dGluZ3NbJ2hpZGVfZmFsbGJhY2tzJ10pe1xuICAgICAgICAgIHZhciBpbmRleCA9IGZvbnQuaW5kZXhPZignLCcpO1xuICAgICAgICAgIGlmKGluZGV4ID09IC0xIClyZXR1cm4gZm9udDtcbiAgICAgICAgICByZXR1cm4gZm9udC5zdWJzdHIoMCwgaW5kZXgpO1xuICAgICAgICB9ZWxzZVxuICAgICAgICAgIHJldHVybiBmb250O1xuICAgICAgfVxuXG5cbiAgICAgIHZhciBzZWxlY3QgPSBmdW5jdGlvbihmb250LGluaXRpYWwpIHtcbiAgICAgICAgcm9vdC5maW5kKCdzcGFuJykuaHRtbChkaXNwbGF5TmFtZShmb250KS5yZXBsYWNlKC9bXCInXXsxfS9naSxcIlwiKSk7XG4gICAgICAgIHJvb3QuY3NzKCdmb250LWZhbWlseScsIGZvbnQpO1xuICAgICAgICBzZWxlY3RlZCA9IGZvbnQ7XG5cbiAgICAgICAgaWYoIWluaXRpYWwpcm9vdC5zZWxlY3RlZENhbGxiYWNrKHNlbGVjdGVkKTtcbiAgICAgIH1cblxuICAgICAgdmFyIHBvc2l0aW9uVWwgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGxlZnQsIHRvcDtcbiAgICAgICAgbGVmdCA9ICQocm9vdCkub2Zmc2V0KCkubGVmdDtcbiAgICAgICAgdG9wID0gJChyb290KS5vZmZzZXQoKS50b3AgKyAkKHJvb3QpLm91dGVySGVpZ2h0KCk7XG5cbiAgICAgICAgJCh1bCkuY3NzKHtcbiAgICAgICAgICAncG9zaXRpb24nOiAnYWJzb2x1dGUnLFxuICAgICAgICAgICdsZWZ0JzogbGVmdCArICdweCcsXG4gICAgICAgICAgJ3RvcCc6IHRvcCArICdweCcsXG4gICAgICAgICAgJ3dpZHRoJzogJChyb290KS5vdXRlcldpZHRoKCkgKyAncHgnXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICB2YXIgY2xvc2VVbCA9IHRoaXMuY2xvc2VVbCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB1bC5zbGlkZVVwKCdmYXN0JywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgdmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICB9KTtcblxuICAgICAgICAkcm9vdC5yZW1vdmVDbGFzcyhvcGVuZWRDbGFzcyk7XG5cbiAgICAgICAgcm9vdC5jbG9zZWRDYWxsYmFjaygpO1xuICAgICAgfVxuXG4gICAgICB2YXIgb3BlblVpID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHVsLnNsaWRlRG93bignZmFzdCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHZpc2libGUgPSB0cnVlO1xuICAgICAgICB9KTtcblxuICAgICAgICAkcm9vdC5hZGRDbGFzcyhvcGVuZWRDbGFzcyk7XG5cbiAgICAgICAgcm9vdC5vcGVuZWRDYWxsYmFjaygpO1xuICAgICAgfVxuXG4gICAgICAvLyBTZXR1cCBtYXJrdXBcbiAgICAgICRyb290LnByZXBlbmQoJzxzcGFuPicgKyBzZXR0aW5nc1snaW5pdGlhbCddLnJlcGxhY2UoLycvZywnJiMwMzk7JykgKyAnPC9zcGFuPicpO1xuICAgICAgdmFyIHVsID0gdGhpcy51bCA9ICQoJzx1bCBjbGFzcz1cImZvbnRTZWxlY3RVbFwiPjwvdWw+JykuYXBwZW5kVG8oJ2JvZHknKTtcbiAgICAgIHVsLmhpZGUoKTtcbiAgICAgIHBvc2l0aW9uVWwoKTtcblxuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzZXR0aW5nc1snZm9udHMnXS5sZW5ndGg7IGkrKykge1xuICAgICAgICB2YXIgaXRlbSA9ICQoJzxsaT4nICsgZGlzcGxheU5hbWUoc2V0dGluZ3NbJ2ZvbnRzJ11baV0pICsgJzwvbGk+JykuYXBwZW5kVG8odWwpO1xuICAgICAgICBpdGVtLmNzcygnZm9udC1mYW1pbHknLCBzZXR0aW5nc1snZm9udHMnXVtpXSk7XG4gICAgICAgIGl0ZW1bMF0uZGF0YSA9IHNldHRpbmdzWydmb250cyddW2ldO1xuICAgICAgfVxuXG4gICAgICBpZiAoc2V0dGluZ3NbJ2luaXRpYWwnXSAhPSAnJylcbiAgICAgICAgc2VsZWN0KHNldHRpbmdzWydpbml0aWFsJ10sdHJ1ZSk7XG5cbiAgICAgIHVsLmZpbmQoJ2xpJykuY2xpY2soZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgaWYgKCF2aXNpYmxlKVxuICAgICAgICAgIHJldHVybjtcblxuICAgICAgICBwb3NpdGlvblVsKCk7XG4gICAgICAgIGNsb3NlVWwoKTtcblxuICAgICAgICBzZWxlY3QodGhpcy5kYXRhKTtcbiAgICAgIH0pO1xuXG4gICAgICAkcm9vdC5jbGljayhmdW5jdGlvbihldmVudCkge1xuXG4gICAgICAgIGlmICh2aXNpYmxlKVxuICAgICAgICAgIHJldHVybjtcblxuICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcblxuICAgICAgICBwb3NpdGlvblVsKCk7XG4gICAgICAgIG9wZW5VaSgpO1xuICAgICAgfSk7XG5cbiAgICAgICQoJ2h0bWwnKS5jbGljayhmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKHZpc2libGUpXG4gICAgICAgIHtcbiAgICAgICAgICBjbG9zZVVsKCk7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfSxcbiAgICBzZWxlY3RlZCA6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHRoaXMuZGF0YTtcbiAgICB9LFxuICAgIHNlbGVjdCA6IGZ1bmN0aW9uKGZvbnQpIHtcbiAgICAgIHRoaXMuZmluZCgnc3BhbicpLmh0bWwoZm9udC5zdWJzdHIoMCwgZm9udC5pbmRleE9mKCcsJykpLnJlcGxhY2UoL1tcIiddezF9L2dpLFwiXCIpKTtcbiAgICAgIHRoaXMuY3NzKCdmb250LWZhbWlseScsIGZvbnQpO1xuICAgICAgdmFyIHNlbGVjdGVkID0gZmFsc2U7XG4gICAgICBzZWxlY3RlZCA9IGZvbnQ7XG4gICAgfVxuICB9O1xuICAkLmZvbnRTZWxlY3RvciA9IHtcblxuICB9O1xuXG4gICQuZm4uZm9udFNlbGVjdG9yID0gZnVuY3Rpb24obWV0aG9kKSB7XG4gICAgaWYgKCBtZXRob2RzW21ldGhvZF0gKSB7XG4gICAgICByZXR1cm4gbWV0aG9kc1sgbWV0aG9kIF0uYXBwbHkoIHRoaXMsIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKCBhcmd1bWVudHMsIDEgKSk7XG4gICAgfSBlbHNlIGlmICggdHlwZW9mIG1ldGhvZCA9PT0gJ29iamVjdCcgfHwgISBtZXRob2QgKSB7XG4gICAgICByZXR1cm4gbWV0aG9kcy5pbml0LmFwcGx5KCB0aGlzLCBhcmd1bWVudHMgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgJC5lcnJvciggJ01ldGhvZCAnICsgIG1ldGhvZCArICcgZG9lcyBub3QgZXhpc3Qgb24galF1ZXJ5LmZvbnRTZWxlY3RvcicgKTtcbiAgICB9XG4gIH1cbn0pKTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBwbHVnaW5zLyQuZm9udFNlbGVjdG9yLmpzIiwiO1xuaWYodHlwZW9mIFRvb2xiYXIgPT09IFwidW5kZWZpbmVkXCIpe1xuICB2YXIgVG9vbGJhciA9IHJlcXVpcmUoXCIuLi90b29sYmFyXCIpO1xufVxuXG5Ub29sYmFyLnByb3RvdHlwZS51cGRhdGVTZWxlY3RlZE9wdGlvbiA9IGZ1bmN0aW9uKGRhdGEpe1xuICB2YXIgJGNoZWNrZWQgPSBkYXRhLiRpdGVtLmZpbmQoXCI6Y2hlY2tlZFwiKTtcbiAgdmFyICRjaGVja2VkT3B0aW9uRWwgPSAkKCRjaGVja2VkLnBhcmVudHMoKVswXSk7XG5cblxuICB2YXIgc2VsT3B0aW9uID0gZGF0YS4kaXRlbS5maW5kKCcuYnRuLXNlbGVjdGVkLW9wdGlvbicpO1xuICBzZWxPcHRpb24uaHRtbCggJGNoZWNrZWRPcHRpb25FbC5maW5kKFwibGFiZWxcIilbMF0ub3V0ZXJIVE1MICk7XG59O1xuXG5Ub29sYmFyLnByb3RvdHlwZS50b29scy5vcHRpb24gPSB7XG4gIHNjb3BlOiBmdW5jdGlvbiAoZGF0YSwgb3B0aW9ucykge1xuICAgIHZhciBfc2VsZiA9IHRoaXM7XG4gICAgcmV0dXJuIHtcbiAgICAgIHBhcmVudElkOiBkYXRhLnBhcmVudC5pZCxcbiAgICAgIHZhbHVlQ3VycmVudDogZGF0YS5wYXJlbnQudmFsdWUuZ2V0KCkgPT09IGRhdGEub3B0aW9uLFxuICAgICAgb25jaGFuZ2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy/QvtC/0YLQuNC80LjQt9C40YDQvtCy0LDRgtGMXG5cbiAgICAgICAgdmFyICRjaGVja2VkID0gZGF0YS4kaXRlbS5maW5kKFwiOmNoZWNrZWRcIik7XG4gICAgICAgIHZhciBfdmFsdWUgPSAkY2hlY2tlZC52YWwoKTtcbiAgICAgICAgaWYgKF92YWx1ZSA9PSBkYXRhLm9wdGlvbikge1xuICAgICAgICAgIGRhdGEucGFyZW50LnZhbHVlLnNldChfdmFsdWUpO1xuICAgICAgICB9XG4gICAgICAgIF9zZWxmLnVwZGF0ZVNlbGVjdGVkT3B0aW9uKGRhdGEucGFyZW50KTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIHRlbXBsYXRlOlxuICAgICc8ZGl2IGNsYXNzPVwib2JqZWN0LW1lbnUtaXRlbSBvYmplY3QtbWVudS1vcHRpb24gXCIgdGl0bGU9XCJ7dGl0bGV9XCIgPicgK1xuICAgICc8aW5wdXQgdHlwZT1cInJhZGlvXCIgaWQ9XCJ0b29sLXtpZH1cIiBkcC1jaGVja2VkPVwie3ZhbHVlQ3VycmVudH1cIiBuYW1lPVwie3BhcmVudElkfVwiIHZhbHVlPVwie29wdGlvbn1cIiBvbmNoYW5nZT1cIm9uY2hhbmdlKClcIj4nICtcbiAgICAnPGxhYmVsIGNsYXNzPVwiYnRuIGJ1dHRvbi17aWR9IHtjbGFzc05hbWV9XCIgZm9yPVwidG9vbC17aWR9XCI+JyArXG4gICAgICAnPGltZyBkcC1pZj1cImljb25cIiBkcC1zcmM9XCJpY29uXCI+JyArXG4gICAgICAnPHNwYW4gZHAtaW5jbHVkZT1cInN2Z1wiIGRwLWlmPVwic3ZnXCI+PC9zcGFuPicgK1xuICAgICAgJzxzcGFuIGRwLWlmPVwidGl0bGVcIiBjbGFzcz1cIm9wdGlvbi10aXRsZVwiPnt0aXRsZX08L3NwYW4+J1xufTtcblxuVG9vbGJhci5wcm90b3R5cGUudG9vbHMub3B0aW9ucyA9IHtcbiAgc2NvcGU6IGZ1bmN0aW9uIChkYXRhLCBvcHRpb25zKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGNsYXNzTmFtZTogZGF0YS5jbGFzc05hbWUgfHwgJ2l0ZW1zLWNvbHVtbicsXG4gICAgICBidXR0b25zVGl0bGU6IG9wdGlvbnMuYnV0dG9ucyAmJiBvcHRpb25zLmJ1dHRvbnMudGl0bGUgfHwgZmFsc2UsXG4gICAgICBidXR0b25zQ2xhc3NOYW1lOiAob3B0aW9ucy5idXR0b25zLmNsYXNzTmFtZSB8fCAnJylcbiAgICB9XG4gIH0sXG4gIHRlbXBsYXRlOlxuICAnPGRpdiBjbGFzcz1cIm9iamVjdC1tZW51LWl0ZW0gb2JqZWN0LW1lbnUtb3B0aW9ucyB7Y2xhc3NOYW1lfVwiIHRpdGxlPVwie3RpdGxlfVwiPicgK1xuICAnPGRpdiBjbGFzcz1cImJ0bi1zZWxlY3RlZC1vcHRpb25cIj48L2Rpdj4nICtcbiAgJzxkaXYgY2xhc3M9XCJvYmplY3QtbWVudS1vcHRpb25zLWNvbnRhaW5lclwiIHRyYW5zY2x1ZGU+JyxcbiAgcG9zdDogZnVuY3Rpb24gKCRpdGVtLCBkYXRhLCBvcHRpb25zLCB0cmFuc2NsdWRlKSB7XG4gICAgdGhpcy5nZW5lcmF0ZU1lbnUoZGF0YS50YXJnZXQsIHRyYW5zY2x1ZGUsIG9wdGlvbnMsIGRhdGEubWVudSk7XG4gICAgdGhpcy51cGRhdGVTZWxlY3RlZE9wdGlvbihkYXRhKTtcbiAgfVxufTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyB0b29sYmFyL21vZHVsZXMvdG9vbGJhci5vcHRpb25zLmpzIiwiO1xuaWYodHlwZW9mIFRvb2xiYXIgPT09IFwidW5kZWZpbmVkXCIpe1xuICB2YXIgVG9vbGJhciA9IHJlcXVpcmUoXCIuLi90b29sYmFyXCIpO1xufVxuXG5Ub29sYmFyLnByb3RvdHlwZS50b29scy5zZWxlY3QgPSAge1xuICBzY29wZTogZnVuY3Rpb24gKGRhdGEsIG9wdGlvbnMpIHtcbiAgICByZXR1cm4ge1xuICAgICAgZ2V0SW5wdXRWYWx1ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gcGFyc2VGbG9hdChkYXRhLiRpdGVtLmZpbmQoXCJpbnB1dFwiKS52YWwoKSk7XG4gICAgICB9LFxuICAgICAgZ2V0VmFsdWU6IGRhdGEudmFsdWUuZ2V0LFxuICAgICAgc2V0VmFsdWU6IGRhdGEudmFsdWUuc2V0LFxuICAgICAgb25jaGFuZ2U6IGZ1bmN0aW9uIChlLG1vZGVsKSB7XG4gICAgICAgIGRhdGEudmFsdWUuc2V0KGUucGFyYW1zLmRhdGEuaWQsbW9kZWwpO1xuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgdGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwib2JqZWN0LW1lbnUtaXRlbSBvYmplY3QtbWVudS1zZWxlY3Qge2l0ZW1DbGFzc05hbWV9XCIgdGl0bGU9XCJ7dGl0bGV9XCIgPjxsYWJlbCBmb3I9XCJ4eHhcIiBjbGFzcz1cImJ0biBidXR0b24te2lkfSB7Y2xhc3NOYW1lfVwiPjwvbGFiZWw+PHNlbGVjdCBpZD1cInh4eFwiPicsXG4gIHBvc3Q6IGZ1bmN0aW9uICgkaXRlbSwgZGF0YSwgb3B0aW9ucywgdG9vbCwgdmFsKSB7XG4gICAgdmFyIG1vZGVsID0gIGRhdGEudmFsdWUub3B0aW9ucygpO1xuICAgIHZhciBfdmFsID0gZGF0YS52YWx1ZS5nZXQoKTtcbiAgICB2YXIgX3NlbGVjdCA9ICRpdGVtLmZpbmQoXCJzZWxlY3RcIik7XG4gICAgX3NlbGVjdC5kcFNlbGVjdCh7XG4gICAgICBtaW5pbXVtUmVzdWx0c0ZvclNlYXJjaDogSW5maW5pdHksXG4gICAgICBkcm9wZG93blBhcmVudDogJChcImJvZHlcIiksXG4gICAgICBkYXRhOiAgbW9kZWwsXG4gICAgICB0ZW1wbGF0ZVNlbGVjdGlvbjogZnVuY3Rpb24oc3RhdGUsIGNvbnRhaW5lcikge1xuICAgICAgICByZXR1cm4gZGF0YS50ZW1wbGF0ZVNlbGVjdGlvbihzdGF0ZSwgY29udGFpbmVyLGRhdGEpO1xuICAgICAgfSxcbiAgICAgIHRlbXBsYXRlUmVzdWx0OiBmdW5jdGlvbihzdGF0ZSwgY29udGFpbmVyKXtcbiAgICAgICAgcmV0dXJuIGRhdGEudGVtcGxhdGVSZXN1bHQoc3RhdGUsIGNvbnRhaW5lcixkYXRhKTtcbiAgICAgIH0sXG4gICAgfSkub24oXCJzZWxlY3QyOnNlbGVjdFwiLCBmdW5jdGlvbihlKSB7XG4gICAgICBkYXRhLm9uY2hhbmdlKGUsIG1vZGVsKTtcbiAgICB9KTtcbiAgICBfc2VsZWN0LmRwU2VsZWN0KFwidmFsXCIsW192YWxdKTtcblxuXG4gICAgdGhpcy5vbihcImRlc3Ryb3lcIiwoKSA9PiB7XG4gICAgICBfc2VsZWN0LmRwU2VsZWN0KFwiZGVzdHJveVwiKTtcbiAgICB9KVxuICB9XG59XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gdG9vbGJhci9tb2R1bGVzL3Rvb2xiYXIuc2VsZWN0LmpzIiwiXG5pZih0eXBlb2YgVG9vbGJhciA9PT0gXCJ1bmRlZmluZWRcIil7XG4gIHZhciBUb29sYmFyID0gcmVxdWlyZShcIi4uL3Rvb2xiYXJcIik7XG59XG5cblRvb2xiYXIucHJvdG90eXBlLmNvbG9ycGlja2VyID0gZnVuY3Rpb24gKGVsLCBvcHRpb25zKSB7XG4gIG9wdGlvbnMuZm9ybWF0ID0gJ3JnYic7XG4gIG9wdGlvbnMub3BhY2l0eSA9IHRydWU7XG4gIGVsLm1pbmljb2xvcnMob3B0aW9ucyk7XG59O1xuXG5Ub29sYmFyLnByb3RvdHlwZS50b29scy5lZmZlY3QgPSB7XG4gIHNjb3BlOiBmdW5jdGlvbiAoZGF0YSwgb3B0aW9ucykge1xuICAgIHJldHVybiB7XG4gICAgICBidXR0b25zVGl0bGU6IG9wdGlvbnMuYnV0dG9ucyAmJiBvcHRpb25zLmJ1dHRvbnMudGl0bGUgfHwgZmFsc2UsXG4gICAgICBpc1BhcmFtZXRlcnM6ICEhZGF0YS5hY3Rpb25QYXJhbWV0ZXJzLFxuICAgICAgYnV0dG9uc2NDbGFzc05hbWU6IChvcHRpb25zLmJ1dHRvbnMgJiYgb3B0aW9ucy5idXR0b25zLmNsYXNzTmFtZSB8fCAnJylcbiAgICB9XG4gIH0sXG4gIHRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cIm9iamVjdC1tZW51LWl0ZW1cIiB0aXRsZT1cInt0aXRsZX1cIj4nICtcbiAgICAgICc8YnV0dG9uIGNsYXNzPVwiYnRuIGJ1dHRvbi17aWR9IHtjbGFzc05hbWV9IHtidXR0b25zY0NsYXNzTmFtZX1cIj4nICtcbiAgICAgICc8c3BhbiBkcC1pZj1cImJ1dHRvbnNUaXRsZVwiIGNsYXNzPVwiYnV0dG9uLXRpdGxlXCI+e3RpdGxlfTwvc3Bhbj4nICtcbiAgICAgICc8L2J1dHRvbj4nICtcbiAgICAgICc8ZGl2IGRwLWlmPVwiaXNQYXJhbWV0ZXJzXCIgY2xhc3M9XCJtZW51LWFjdGlvbi1wYXJhbWV0ZXJzXCIgc3R5bGU9XCJkaXNwbGF5OiBub25lXCIgdHJhbnNjbHVkZT48L2Rpdj4nICtcbiAgICAnPC9kaXY+JyxcbiAgICBwb3N0OiBmdW5jdGlvbiAoJGl0ZW0sIGRhdGEsIG9wdGlvbnMsIHRyYW5zY2x1ZGUpIHtcblxuICAgIGlmKGRhdGEuY29udGFpbmVyKXtcbiAgICAgIHRyYW5zY2x1ZGUgPSAkKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGRhdGEuY29udGFpbmVyKSk7XG4gICAgfVxuXG4gICAgdmFyICR0cGw7XG4gICAgdmFyIGZvbyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmIChkYXRhLmVmZmVjdFRwbCkge1xuICAgICAgICAkdHBsID0gJChkYXRhLmVmZmVjdFRwbCk7XG4gICAgICAgIHRyYW5zY2x1ZGUuaHRtbCgkdHBsKTtcbiAgICAgIH1cbiAgICAgIGlmIChkYXRhLmFjdGlvblBhcmFtZXRlcnNJZCkge1xuICAgICAgICAkdHBsID0gJChcIiNcIiArIGRhdGEuYWN0aW9uUGFyYW1ldGVyc0lkKS5jbG9uZSgpO1xuICAgICAgICB0cmFuc2NsdWRlLmh0bWwoJHRwbCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gZGF0YS5hY3Rpb25QYXJhbWV0ZXJzLmNhbGwoZGF0YS50YXJnZXQsIHRyYW5zY2x1ZGUsIGRhdGEsIG9wdGlvbnMpO1xuICAgIH07XG4gICAgdGhpcy50b2dnbGVCeUJ1dHRvbigkaXRlbSwgdHJhbnNjbHVkZSwgZm9vICxkYXRhKTtcbiAgfVxufTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyB0b29sYmFyL21vZHVsZXMvdG9vbGJhci5lZmZlY3QuanMiLCIndXNlIHN0cmljdCc7XG5cblxudmFyIF9iaW5kRXZlbnRzID0gZmFicmljLkNhbnZhcy5wcm90b3R5cGUuX2JpbmRFdmVudHM7XG52YXIgX29uTW91c2VEb3duX292ZXJ3cml0dGVuID0gZmFicmljLkNhbnZhcy5wcm90b3R5cGUuX29uTW91c2VEb3duO1xudmFyIF9vbk1vdXNlVXBfb3ZlcndyaXR0ZW4gPSBmYWJyaWMuQ2FudmFzLnByb3RvdHlwZS5fb25Nb3VzZVVwO1xudmFyIF9pbml0RXZlbnRMaXN0ZW5lcnNfb3ZlcndyaXR0ZW4gPSBmYWJyaWMuQ2FudmFzLnByb3RvdHlwZS5faW5pdEV2ZW50TGlzdGVuZXJzO1xudmFyIHJlbW92ZUxpc3RlbmVyc19vdmVyd3JpdHRlbiA9IGZhYnJpYy5DYW52YXMucHJvdG90eXBlLnJlbW92ZUxpc3RlbmVycztcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuQ2FudmFzLnByb3RvdHlwZSwge1xuICB0YXBob2xkVGhyZXNob2xkOiAyMDAwLFxuICBfYmluZEV2ZW50czogZnVuY3Rpb24gKCkge1xuICAgIF9iaW5kRXZlbnRzLmNhbGwodGhpcyk7XG4gICAgdGhpcy5fb25DbGljayA9IHRoaXMuX29uQ2xpY2suYmluZCh0aGlzKTtcbiAgICB0aGlzLl9vbkRvdWJsZUNsaWNrID0gdGhpcy5fb25Eb3VibGVDbGljay5iaW5kKHRoaXMpO1xuICAgIHRoaXMuX29uVGFwSG9sZCA9IHRoaXMuX29uVGFwSG9sZC5iaW5kKHRoaXMpO1xuICB9LFxuXG4gIF9vbkRvdWJsZUNsaWNrOiBmdW5jdGlvbiAoZSkge1xuICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgIHZhciB0YXJnZXQgPSBzZWxmLmZpbmRUYXJnZXQoZSk7XG4gICAgc2VsZi5maXJlKCdtb3VzZTpkYmxjbGljaycsIHtcbiAgICAgIHRhcmdldDogdGFyZ2V0LFxuICAgICAgZTogZVxuICAgIH0pO1xuXG4gICAgaWYgKHRhcmdldCAmJiAhc2VsZi5pc0RyYXdpbmdNb2RlKSB7XG4gICAgICAvLyBUbyB1bmlmeSB0aGUgYmVoYXZpb3IsIHRoZSBvYmplY3QncyBkb3VibGUgY2xpY2sgZXZlbnQgZG9lcyBub3QgZmlyZSBvbiBkcmF3aW5nIG1vZGUuXG4gICAgICB0YXJnZXQuZmlyZSgnZGJsY2xpY2snLCB7XG4gICAgICAgIGU6IGVcbiAgICAgIH0pO1xuICAgIH1cbiAgfSxcblxuICBfb25Ecm9wOiBmdW5jdGlvbiAoZSkge1xuICAgIHZhciBfem9vbSA9IHRoaXMuZ2V0Wm9vbSgpO1xuICAgIGUueCAvPSBfem9vbTtcbiAgICBlLnkgLz0gX3pvb207XG4gICAgZS5vZmZzZXRYIC89IF96b29tO1xuICAgIGUub2Zmc2V0WSAvPSBfem9vbTtcbiAgICBlLndpZHRoID0gZS5oZWxwZXIud2lkdGgoKSAvIF96b29tO1xuICAgIGUuaGVpZ2h0ID0gZS5oZWxwZXIuaGVpZ2h0KCkgLyBfem9vbTtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICB0aGlzLmZpcmUoJ21vdXNlOmRyb3AnLCBlKTtcblxuICB9LFxuXG4gIF9vbkRyYWdNb3ZlOiBmdW5jdGlvbiAoZSkge1xuICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgIHZhciB0YXJnZXQgPSBzZWxmLmZpbmRUYXJnZXQoZS5vcmlnaW5hbEV2ZW50KTtcbiAgICBzZWxmLmZpcmUoJ21vdXNlOmRyYWdtb3ZlJywge1xuICAgICAgdGFyZ2V0OiB0YXJnZXQsXG4gICAgICBlOiBlLFxuICAgICAgZGF0YTogZS5kYXRhXG4gICAgfSk7XG4gICAgaWYgKHRhcmdldCAmJiAhc2VsZi5pc0RyYXdpbmdNb2RlKSB7XG4gICAgICAvLyBUbyB1bmlmeSB0aGUgYmVoYXZpb3IsIHRoZSBvYmplY3QncyBkb3VibGUgY2xpY2sgZXZlbnQgZG9lcyBub3QgZmlyZSBvbiBkcmF3aW5nIG1vZGUuXG4gICAgICB0YXJnZXQuZmlyZSgnb2JqZWN0OmRyYWdtb3ZlJywge1xuICAgICAgICBlOiBlLFxuICAgICAgICBkYXRhOiBlLmRhdGFcbiAgICAgIH0pO1xuICAgIH1cbiAgICBpZiAodGhpcy5fbGFzdF90YXJnZXQgPT0gdGFyZ2V0KXJldHVybjtcbiAgICBpZiAodGhpcy5fbGFzdF90YXJnZXQpIHtcbiAgICAgIHNlbGYuZmlyZSgnbW91c2U6ZHJhZ2xlYXZlJywge1xuICAgICAgICB0YXJnZXQ6IHRoaXMuX2xhc3RfdGFyZ2V0LFxuICAgICAgICBlOiBlLFxuICAgICAgICBkYXRhOiBlLmRhdGFcbiAgICAgIH0pO1xuICAgICAgdGhpcy5fbGFzdF90YXJnZXQuZmlyZSgnb2JqZWN0OmRyYWdsZWF2ZScsIHtcbiAgICAgICAgZTogZSxcbiAgICAgICAgZGF0YTogZS5kYXRhXG4gICAgICB9KTtcbiAgICAgIHRoaXMuX2xhc3RfdGFyZ2V0ID0gZmFsc2U7XG4gICAgfVxuICAgIGlmICh0YXJnZXQpIHtcblxuICAgICAgc2VsZi5maXJlKCdtb3VzZTpkcmFnZW50ZXInLCB7XG4gICAgICAgIHRhcmdldDogdGFyZ2V0LFxuICAgICAgICBlOiBlLFxuICAgICAgICBkYXRhOiBlLmRhdGFcbiAgICAgIH0pO1xuICAgICAgdGFyZ2V0LmZpcmUoJ29iamVjdDpkcmFnZW50ZXInLCB7XG4gICAgICAgIGU6IGUsXG4gICAgICAgIGRhdGE6IGUuZGF0YVxuICAgICAgfSk7XG5cbiAgICAgIHRoaXMuX2xhc3RfdGFyZ2V0ID0gdGFyZ2V0O1xuICAgIH1cblxuICB9LFxuXG4gIF9vbkNsaWNrOiBmdW5jdGlvbiAoZSkge1xuICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgIHZhciB0YXJnZXQgPSBzZWxmLmZpbmRUYXJnZXQoZSk7XG4gICAgc2VsZi5maXJlKCdtb3VzZTpjbGljaycsIHtcbiAgICAgIHRhcmdldDogdGFyZ2V0LFxuICAgICAgZTogZVxuICAgIH0pO1xuXG4gICAgaWYgKHRhcmdldCAmJiAhc2VsZi5pc0RyYXdpbmdNb2RlKSB7XG4gICAgICBpZiAoXG4gICAgICAgIHRhcmdldC5vcmlnaW5hbFN0YXRlLmxlZnQgPT0gdGFyZ2V0LmxlZnQgJiZcbiAgICAgICAgdGFyZ2V0Lm9yaWdpbmFsU3RhdGUudG9wID09IHRhcmdldC50b3AgJiZcbiAgICAgICAgdGFyZ2V0Lm9yaWdpbmFsU3RhdGUuc2NhbGVYID09IHRhcmdldC5zY2FsZVggJiZcbiAgICAgICAgdGFyZ2V0Lm9yaWdpbmFsU3RhdGUuc2NhbGVZID09IHRhcmdldC5zY2FsZVkgJiZcbiAgICAgICAgdGFyZ2V0Lm9yaWdpbmFsU3RhdGUuYW5nbGUgPT0gdGFyZ2V0LmFuZ2xlXG4gICAgICApIHtcbiAgICAgICAgLy8gVG8gdW5pZnkgdGhlIGJlaGF2aW9yLCB0aGUgb2JqZWN0J3MgZG91YmxlIGNsaWNrIGV2ZW50IGRvZXMgbm90IGZpcmUgb24gZHJhd2luZyBtb2RlLlxuICAgICAgICB0YXJnZXQuZmlyZSgnb2JqZWN0OmNsaWNrJywge1xuICAgICAgICAgIGU6IGVcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICB9LFxuXG4gIF9vblRhcEhvbGQ6IGZ1bmN0aW9uIChlKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgdmFyIHRhcmdldCA9IHNlbGYuZmluZFRhcmdldChlKTtcbiAgICBzZWxmLmZpcmUoJ3RvdWNoOnRhcGhvbGQnLCB7XG4gICAgICB0YXJnZXQ6IHRhcmdldCxcbiAgICAgIGU6IGVcbiAgICB9KTtcblxuICAgIGlmICh0YXJnZXQgJiYgIXNlbGYuaXNEcmF3aW5nTW9kZSkge1xuICAgICAgLy8gVG8gdW5pZnkgdGhlIGJlaGF2aW9yLCB0aGUgb2JqZWN0J3MgdGFwIGhvbGQgZXZlbnQgZG9lcyBub3QgZmlyZSBvbiBkcmF3aW5nIG1vZGUuXG4gICAgICB0YXJnZXQuZmlyZSgndGFwaG9sZCcsIHtcbiAgICAgICAgZTogZVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgaWYgKGUudHlwZSA9PT0gJ3RvdWNoZW5kJyAmJiBzZWxmLnRvdWNoU3RhcnRUaW1lciAhPSBudWxsKSB7XG4gICAgICBjbGVhclRpbWVvdXQoc2VsZi50b3VjaFN0YXJ0VGltZXIpO1xuICAgIH1cbiAgfSxcblxuICBfb25Nb3VzZURvd246IGZ1bmN0aW9uIChlKSB7XG4gICAgX29uTW91c2VEb3duX292ZXJ3cml0dGVuLmNhbGwodGhpcywgZSk7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIGlmIChlLnR5cGUgPT09ICd0b3VjaHN0YXJ0Jykge1xuICAgICAgdmFyIHRvdWNoU3RhcnRUaW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICBzZWxmLl9vblRhcEhvbGQoZSk7XG4gICAgICAgIHNlbGYuaXNMb25nVGFwID0gdHJ1ZTtcbiAgICAgIH0sIHNlbGYudGFwaG9sZFRocmVzaG9sZCk7XG4gICAgICBzZWxmLnRvdWNoU3RhcnRUaW1lciA9IHRvdWNoU3RhcnRUaW1lcjtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBBZGQgcmlnaHQgY2xpY2sgc3VwcG9ydFxuICAgIGlmIChlLndoaWNoID09PSAzKSB7XG4gICAgICB2YXIgdGFyZ2V0ID0gdGhpcy5maW5kVGFyZ2V0KGUpO1xuICAgICAgc2VsZi5maXJlKCdtb3VzZTpkb3duJywge3RhcmdldDogdGFyZ2V0LCBlOiBlfSk7XG4gICAgICBpZiAodGFyZ2V0ICYmICFzZWxmLmlzRHJhd2luZ01vZGUpIHtcbiAgICAgICAgLy8gVG8gdW5pZnkgdGhlIGJlaGF2aW9yLCB0aGUgb2JqZWN0J3MgbW91c2UgZG93biBldmVudCBkb2VzIG5vdCBmaXJlIG9uIGRyYXdpbmcgbW9kZS5cbiAgICAgICAgdGFyZ2V0LmZpcmUoJ21vdXNlZG93bicsIHtcbiAgICAgICAgICBlOiBlXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgfSxcblxuICBfb25Nb3VzZVVwOiBmdW5jdGlvbiAoZSkge1xuXG4gICAgX29uTW91c2VVcF9vdmVyd3JpdHRlbi5jYWxsKHRoaXMsIGUpO1xuXG4gICAgaWYgKGUudHlwZSA9PT0gJ3RvdWNoZW5kJykge1xuICAgICAgLy8gUHJvY2VzcyB0YXAgaG9sZC5cbiAgICAgIGlmICh0aGlzLnRvdWNoU3RhcnRUaW1lciAhPSBudWxsKSB7XG4gICAgICAgIGNsZWFyVGltZW91dCh0aGlzLnRvdWNoU3RhcnRUaW1lcik7XG4gICAgICB9XG4gICAgICAvLyBQcm9jZXNzIGxvbmcgdGFwLlxuICAgICAgaWYgKHRoaXMuaXNMb25nVGFwKSB7XG4gICAgICAgIHRoaXMuX29uTG9uZ1RhcEVuZChlKTtcbiAgICAgICAgdGhpcy5pc0xvbmdUYXAgPSBmYWxzZTtcbiAgICAgIH1cbiAgICAgIC8vIFByb2Nlc3MgZG91YmxlIGNsaWNrXG4gICAgICB2YXIgbm93ID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gICAgICB2YXIgbGFzdFRvdWNoID0gdGhpcy5sYXN0VG91Y2ggfHwgbm93ICsgMTtcbiAgICAgIHZhciBkZWx0YSA9IG5vdyAtIGxhc3RUb3VjaDtcbiAgICAgIGlmIChkZWx0YSA8IDMwMCAmJiBkZWx0YSA+IDApIHtcbiAgICAgICAgLy8gQWZ0ZXIgd2UgZGV0Y3QgYSBkb3VibGV0YXAsIHN0YXJ0IG92ZXJcbiAgICAgICAgdGhpcy5sYXN0VG91Y2ggPSBudWxsO1xuXG4gICAgICAgIHRoaXMuX29uRG91YmxlVGFwKGUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5sYXN0VG91Y2ggPSBub3c7XG4gICAgICB9XG4gICAgfVxuICB9LFxuXG4gIF9vbkRvdWJsZVRhcDogZnVuY3Rpb24gKGUpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICB2YXIgdGFyZ2V0ID0gc2VsZi5maW5kVGFyZ2V0KGUpO1xuICAgIHNlbGYuZmlyZSgndG91Y2g6ZG91YmxldGFwJywge1xuICAgICAgdGFyZ2V0OiB0YXJnZXQsXG4gICAgICBlOiBlXG4gICAgfSk7XG5cbiAgICBpZiAodGFyZ2V0ICYmICFzZWxmLmlzRHJhd2luZ01vZGUpIHtcbiAgICAgIC8vIFRvIHVuaWZ5IHRoZSBiZWhhdmlvciwgdGhlIG9iamVjdCdzIGRvdWJsZSB0YXAgZXZlbnQgZG9lcyBub3QgZmlyZSBvbiBkcmF3aW5nIG1vZGUuXG4gICAgICB0YXJnZXQuZmlyZSgnb2JqZWN0OmRvdWJsZXRhcCcsIHtcbiAgICAgICAgZTogZVxuICAgICAgfSk7XG4gICAgfVxuICB9LFxuXG4gIF9vbkxvbmdUYXBFbmQ6IGZ1bmN0aW9uIChlKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgdmFyIHRhcmdldCA9IHNlbGYuZmluZFRhcmdldChlKTtcbiAgICBzZWxmLmZpcmUoJ3RvdWNoOmxvbmd0YXBlbmQnLCB7XG4gICAgICB0YXJnZXQ6IHRhcmdldCxcbiAgICAgIGU6IGVcbiAgICB9KTtcblxuICAgIGlmICh0YXJnZXQgJiYgIXNlbGYuaXNEcmF3aW5nTW9kZSkge1xuICAgICAgLy8gVG8gdW5pZnkgdGhlIGJlaGF2aW9yLCB0aGUgb2JqZWN0J3MgbG9uZyB0YXAgZW5kIGV2ZW50IGRvZXMgbm90IGZpcmUgb24gZHJhd2luZyBtb2RlLlxuICAgICAgdGFyZ2V0LmZpcmUoJ29iamVjdDpsb25ndGFwZW5kJywge1xuICAgICAgICBlOiBlXG4gICAgICB9KTtcbiAgICB9XG4gIH0sXG5cbiAgX2luaXRFdmVudExpc3RlbmVyczogZnVuY3Rpb24gKCkge1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICBfaW5pdEV2ZW50TGlzdGVuZXJzX292ZXJ3cml0dGVuLmNhbGwoc2VsZik7XG5cbiAgICBmYWJyaWMudXRpbC5hZGRMaXN0ZW5lcihzZWxmLnVwcGVyQ2FudmFzRWwsICdjbGljaycsIHNlbGYuX29uQ2xpY2spO1xuICAgIGZhYnJpYy51dGlsLmFkZExpc3RlbmVyKHNlbGYudXBwZXJDYW52YXNFbCwgJ2RibGNsaWNrJywgc2VsZi5fb25Eb3VibGVDbGljayk7XG5cbiAgICBzZWxmLm9uKCdvYmplY3Q6c2NhbGluZycsIGZ1bmN0aW9uIChlKSB7XG4gICAgICBpZiAoZS50YXJnZXQgJiYgZS50YXJnZXQuX3NjYWxpbmdfZXZlbnRzX2VuYWJsZWQpIHtcbiAgICAgICAgZS50YXJnZXQuZmlyZShcInNjYWxpbmdcIiwgZS5lKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBzZWxmLm9uKCdvYmplY3Q6c2VsZWN0ZWQnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgaWYgKGUudGFyZ2V0KSB7XG4gICAgICAgIGUudGFyZ2V0LmZpcmUoXCJvYmplY3Q6c2VsZWN0ZWRcIiwgZS5lKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBzZWxmLm9uKCdtb3VzZTpvdmVyJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgIGlmIChlLnRhcmdldCkge1xuICAgICAgICBlLnRhcmdldC5maXJlKFwibW91c2U6b3ZlclwiLCBlLmUpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgc2VsZi5vbignbW91c2U6b3V0JywgZnVuY3Rpb24gKGUpIHtcbiAgICAgIGlmIChlLnRhcmdldCkge1xuICAgICAgICBlLnRhcmdldC5maXJlKFwibW91c2U6b3V0XCIsIGUuZSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgfSxcblxuICByZW1vdmVMaXN0ZW5lcnM6IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgcmVtb3ZlTGlzdGVuZXJzX292ZXJ3cml0dGVuLmNhbGwoc2VsZik7XG5cblxuICAgIGZhYnJpYy51dGlsLnJlbW92ZUxpc3RlbmVyKHNlbGYudXBwZXJDYW52YXNFbCwgJ2NsaWNrJywgc2VsZi5fb25DbGljayk7XG4gICAgZmFicmljLnV0aWwucmVtb3ZlTGlzdGVuZXIoc2VsZi51cHBlckNhbnZhc0VsLCAnZGJsY2xpY2snLCBzZWxmLl9vbkRvdWJsZUNsaWNrKTtcbiAgfVxufSk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL21vZHVsZXMvY2FudmFzLmV2ZW50cy5qcyIsIid1c2Ugc3RyaWN0Jztcblxue1xuXG4gIC8qXG4gICBmYWJyaWMuSW1hZ2UuZmlsdGVycy5SZWRpZnkgPSBmYWJyaWMudXRpbC5jcmVhdGVDbGFzcyhmYWJyaWMuSW1hZ2UuZmlsdGVycy5CYXNlRmlsdGVyLCB7XG4gICB0eXBlOiAnUmVkaWZ5JyxcbiAgIGFwcGx5VG86IGZ1bmN0aW9uIChjYW52YXNFbCkge1xuICAgdmFyIGNvbnRleHQgPSBjYW52YXNFbC5nZXRDb250ZXh0KCcyZCcpLFxuICAgaW1hZ2VEYXRhID0gY29udGV4dC5nZXRJbWFnZURhdGEoMCwgMCxcbiAgIGNhbnZhc0VsLndpZHRoLCBjYW52YXNFbC5oZWlnaHQpLFxuICAgZGF0YSA9IGltYWdlRGF0YS5kYXRhO1xuICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IGRhdGEubGVuZ3RoOyBpIDwgbGVuOyBpICs9IDQpIHtcbiAgIGRhdGFbaSArIDFdID0gMDtcbiAgIGRhdGFbaSArIDJdID0gMDtcbiAgIH1cbiAgIGNvbnRleHQucHV0SW1hZ2VEYXRhKGltYWdlRGF0YSwgMCwgMCk7XG4gICB9XG4gICB9KTtcbiAgIGZhYnJpYy5JbWFnZS5maWx0ZXJzLlJlZGlmeS5mcm9tT2JqZWN0ID0gZnVuY3Rpb24gKG9iamVjdCkge1xuICAgcmV0dXJuIG5ldyBmYWJyaWMuSW1hZ2UuZmlsdGVycy5SZWRpZnkob2JqZWN0KTtcbiAgIH07XG4gICAqL1xuXG4gIGZhYnJpYy5JbWFnZS5maWx0ZXJzLlNoYXJwZW4gPSBmYWJyaWMudXRpbC5jcmVhdGVDbGFzcyhmYWJyaWMuSW1hZ2UuZmlsdGVycy5Db252b2x1dGUsIHtcbiAgICB0eXBlOiAnU2hhcnBlbicsXG4gICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwgeyB9O1xuXG4gICAgICB0aGlzLm9wYXF1ZSA9IG9wdGlvbnMub3BhcXVlO1xuICAgICAgdGhpcy5tYXRyaXggPSBvcHRpb25zLm1hdHJpeCB8fCBbXG4gICAgICAgICAgMCwgLTEsIDAsXG4gICAgICAgICAgLTEsIDUsIC0xLFxuICAgICAgICAgIDAsIC0xLCAwXG4gICAgICAgIF07XG4gICAgfVxuICB9KTtcbiAgZmFicmljLkltYWdlLmZpbHRlcnMuU2hhcnBlbi5mcm9tT2JqZWN0ID0gZnVuY3Rpb24gKG9iamVjdCkge1xuICAgIHJldHVybiBuZXcgZmFicmljLkltYWdlLmZpbHRlcnMuU2hhcnBlbihvYmplY3QpO1xuICB9O1xuXG4gIGZhYnJpYy5JbWFnZS5maWx0ZXJzLkJsdXIgPSBmYWJyaWMudXRpbC5jcmVhdGVDbGFzcyhmYWJyaWMuSW1hZ2UuZmlsdGVycy5Db252b2x1dGUsIHtcbiAgICB0eXBlOiAnQmx1cicsXG4gICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwgeyB9O1xuXG4gICAgICB2YXIgX3YgPSAxIC8gOTtcbiAgICAgIHRoaXMub3BhcXVlID0gb3B0aW9ucy5vcGFxdWU7XG4gICAgICB0aGlzLm1hdHJpeCA9IG9wdGlvbnMubWF0cml4IHx8IFtcbiAgICAgICAgICBfdiwgX3YsIF92LFxuICAgICAgICAgIF92LCBfdiwgX3YsXG4gICAgICAgICAgX3YsIF92LCBfdlxuICAgICAgICBdO1xuICAgIH1cbiAgfSk7XG4gIGZhYnJpYy5JbWFnZS5maWx0ZXJzLkJsdXIuZnJvbU9iamVjdCA9IGZ1bmN0aW9uIChvYmplY3QpIHtcbiAgICByZXR1cm4gbmV3IGZhYnJpYy5JbWFnZS5maWx0ZXJzLkJsdXIob2JqZWN0KTtcbiAgfTtcblxuICBmYWJyaWMuSW1hZ2UuZmlsdGVycy5FbWJvc3MgPSBmYWJyaWMudXRpbC5jcmVhdGVDbGFzcyhmYWJyaWMuSW1hZ2UuZmlsdGVycy5Db252b2x1dGUsIHtcbiAgICB0eXBlOiAnRW1ib3NzJyxcbiAgICBpbml0aWFsaXplOiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7IH07XG5cbiAgICAgIHRoaXMub3BhcXVlID0gb3B0aW9ucy5vcGFxdWU7XG4gICAgICB0aGlzLm1hdHJpeCA9IG9wdGlvbnMubWF0cml4IHx8IFtcbiAgICAgICAgICAxLCAgIDEsICAgMSxcbiAgICAgICAgICAxLCAwLjcsICAtMSxcbiAgICAgICAgICAtMSwgIC0xLCAgLTFcbiAgICAgICAgXTtcbiAgICB9XG4gIH0pO1xuICBmYWJyaWMuSW1hZ2UuZmlsdGVycy5FbWJvc3MuZnJvbU9iamVjdCA9IGZ1bmN0aW9uIChvYmplY3QpIHtcbiAgICByZXR1cm4gbmV3IGZhYnJpYy5JbWFnZS5maWx0ZXJzLkVtYm9zcyhvYmplY3QpO1xuICB9O1xuXG5cbiAgZmFicmljLkltYWdlLmZpbHRlcnMuTWFzay5wcm90b3R5cGUubWFza0ZpbHRlciA9IHRydWU7XG5cbiAgdmFyIHByb3RvdHlwZU9wdGlvbnMgPSB7XG4gICAgQnJpZ2h0bmVzczoge1xuICAgICAgXCJicmlnaHRuZXNzXCI6IHt2YWx1ZTogMTAwLCBtaW46IDAsIG1heDogMjU1fVxuICAgIH0sXG4gICAgTm9pc2U6IHtcbiAgICAgIFwibm9pc2VcIjoge3ZhbHVlOiAxMDAsIG1pbjogMCwgbWF4OiAxMDAwfVxuICAgIH0sXG4gICAgQ29udm9sdXRlOiB7XG4gICAgICBcIm9wYXF1ZVwiOiB7dmFsdWU6IHRydWUsIHR5cGU6IFwiYm9vbGVhblwiIH0sXG4gICAgICBcIm1hdHJpeFwiOiB7dmFsdWU6IFsxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxXSwgdHlwZTogXCJtYXRyaXhcIiB9XG4gICAgfSxcbiAgICBCbHVyOiB7fSxcbiAgICBTaGFycGVuOiB7fSxcbiAgICBFbWJvc3M6IHt9LFxuICAgIE11bHRpcGx5OiB7XG4gICAgICBcImNvbG9yXCI6IHt0eXBlOiAnY29sb3InLCB2YWx1ZTogXCIjRjBGXCJ9XG4gICAgfSxcbiAgICBQaXhlbGF0ZToge1xuICAgICAgXCJibG9ja3NpemVcIjoge3ZhbHVlOiA0LCBtaW46IDIsIG1heDogMjB9XG4gICAgfSxcbiAgICBUaW50OiB7XG4gICAgICBcImNvbG9yXCI6ICB7dHlwZTogJ2NvbG9yJywgdmFsdWU6IFwiIzM1MTNCMFwifSxcbiAgICAgIFwib3BhY2l0eVwiOiB7dmFsdWU6IDEsIG1pbjogMCwgbWF4OiAxLCBzdGVwOiAwLjF9XG4gICAgfSxcbiAgICBNYXNrOiB7XG4gICAgICBtYXNrOiB7XG4gICAgICAgIHR5cGU6ICdpbWFnZScsXG4gICAgICAgIHZhbHVlOiB7XG4gICAgICAgICAgc3JjOiAgXCJwaG90b3MvZXhwbG9zaW9uLnBuZ1wiXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBjaGFubmVsOiB7IHZhbHVlOiAwfVxuICAgIH0sXG4gICAgQmxlbmQ6IHtcbiAgICAgIFwiY29sb3JcIjoge3R5cGU6ICdjb2xvcicsIHZhbHVlOiBcIiMzNTEzQjBcIn0sXG4gICAgICBcIm1vZGVcIjoge1xuICAgICAgICB2YWx1ZTogXCJhZGRcIixcbiAgICAgICAgb3B0aW9uczogW1xuICAgICAgICAgIHt2YWx1ZTogXCJhZGRcIiwgdGl0bGU6IFwiQWRkXCJ9LFxuICAgICAgICAgIHt2YWx1ZTogXCJkaWZmXCIsIHRpdGxlOiBcIkRpZmZcIn0sXG4gICAgICAgICAge3ZhbHVlOiBcInN1YnRyYWN0XCIsIHRpdGxlOiBcIlN1YnRyYWN0XCJ9LFxuICAgICAgICAgIHt2YWx1ZTogXCJtdWx0aXBseVwiLCB0aXRsZTogXCJNdWx0aXBseVwifSxcbiAgICAgICAgICB7dmFsdWU6IFwic2NyZWVuXCIsIHRpdGxlOiBcIlNjcmVlblwifSxcbiAgICAgICAgICB7dmFsdWU6IFwibGlnaHRlblwiLCB0aXRsZTogXCJMaWdodGVuXCJ9LFxuICAgICAgICAgIHt2YWx1ZTogXCJkYXJrZW5cIiwgdGl0bGU6IFwiRGFya2VuXCJ9XG4gICAgICAgIF1cbiAgICAgIH1cbiAgICB9XG4gIH07XG5cblxuICBmb3IodmFyIGkgaW4gcHJvdG90eXBlT3B0aW9ucyl7XG4gICAgZmFicmljLkltYWdlLmZpbHRlcnNbaV0ucHJvdG90eXBlLm9wdGlvbnMgPSBwcm90b3R5cGVPcHRpb25zW2ldO1xuICB9XG5cblxuXG59XG5cblxuXG5cbmZhYnJpYy5JbWFnZS5nZXRGaWx0ZXJzTGlzdCA9IGZ1bmN0aW9uKGVsKXtcblxuICBlbCA9IGVsIHx8IGZhYnJpYy5JbWFnZS5wcm90b3R5cGU7XG4gIHZhciBmaWx0ZXJMaXN0ID0gW107XG4gIGZvcih2YXIgaSBpbiBlbC5hdmFpbGFibGVGaWx0ZXJzKXtcbiAgICB2YXIgX2YgPSBmYWJyaWMuSW1hZ2UuZmlsdGVyc1tlbC5hdmFpbGFibGVGaWx0ZXJzW2ldXTtcblxuICAgIHZhciBfZGF0YSA9IHtcbiAgICAgIHR5cGU6ICAgICBlbC5hdmFpbGFibGVGaWx0ZXJzW2ldXG4gICAgfTtcbiAgICBpZihfZi5wcm90b3R5cGUuY3VzdG9tKXtcbiAgICAgIGlmKCFlbC5jdXN0b21GaWx0ZXJzKXtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgfVxuICAgIGlmKF9mLnByb3RvdHlwZS5tYXNrRmlsdGVyKXtcbiAgICAgIGlmKCFlbC5tYXNrRmlsdGVyKXtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgfVxuICAgIGlmKF9mLnByb3RvdHlwZS5jYW1hbil7XG4gICAgICBpZighZWwuY2FtYW5GaWx0ZXJzKXtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBfZGF0YS5jYW1hbiA9IHRydWU7XG4gICAgfWVsc2V7XG4gICAgICBpZighZWwuZmFicmljRmlsdGVycyl7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgIH1cbiAgICBpZihfZi5wcm90b3R5cGUub3B0aW9ucyl7XG4gICAgICBfZGF0YS5vcHRpb25zID0gZmFicmljLnV0aWwub2JqZWN0LmNsb25lKF9mLnByb3RvdHlwZS5vcHRpb25zKTtcbiAgICB9XG4gICAgX2RhdGEudGV4dCA9IF9mLnByb3RvdHlwZS50aXRsZSB8fCBlbC5hdmFpbGFibGVGaWx0ZXJzW2ldO1xuXG4gICAgZmlsdGVyTGlzdC5wdXNoKF9kYXRhKVxuICB9XG4gIHJldHVybiBmaWx0ZXJMaXN0O1xufTtcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuSW1hZ2UucHJvdG90eXBlLCB7XG4gIGNhbWFuRmlsdGVyczogZmFsc2UsXG4gIGZhYnJpY0ZpbHRlcnM6IHRydWUsXG4gIGN1c3RvbUZpbHRlcnM6IGZhbHNlLFxuICBtYXNrRmlsdGVyOiBmYWxzZSxcbiAgZ2V0RmlsdGVyc0RhdGEgOiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIF9maWx0ZXJzID0gZmFicmljLkltYWdlLmdldEZpbHRlcnNMaXN0KHRoaXMpO1xuICAgIGZvciAodmFyIGkgaW4gdGhpcy5maWx0ZXJzKSB7XG4gICAgICB2YXIgX2YgPSBmYWJyaWMudXRpbC5vYmplY3QuZmluZFdoZXJlKF9maWx0ZXJzLHt0eXBlOiBmYWJyaWMudXRpbC5zdHJpbmcuY2FwaXRhbGl6ZSh0aGlzLmZpbHRlcnNbaV0udHlwZSl9KVxuICAgICAgaWYoX2Ype1xuICAgICAgICBfZi5lbmFibGVkID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIF9maWx0ZXJzO1xuICB9LFxuICBhdmFpbGFibGVGaWx0ZXJzOiBbXG4gICAgLy9mYWJyaWNKU1xuICAgIFwiR3JheXNjYWxlXCIsXG4gICAgXCJTZXBpYVwiLFxuICAgIFwiU2VwaWEyXCIsXG4gICAgXCJJbnZlcnRcIixcbiAgICBcIkJsdXJcIixcbiAgICBcIlNoYXJwZW5cIixcbiAgICBcIkVtYm9zc1wiLFxuICAgIFwiQmxlbmRcIixcbiAgICBcIlRpbnRcIixcbiAgICBcIk11bHRpcGx5XCIsXG4gICAgLy9cIkNvbnZvbHV0ZVwiLFxuICAgIFwiTm9pc2VcIixcbiAgICBcIkJyaWdodG5lc3NcIixcbiAgICBcIlBpeGVsYXRlXCIsXG4gICAgXCJHcmFkaWVudFRyYW5zcGFyZW5jeVwiLFxuICAgIFwiTWFza1wiXG4gIF0sXG4gIGdldEZpbHRlcjogZnVuY3Rpb24gKGZpbHRlck5hbWUpIHtcbiAgICBmaWx0ZXJOYW1lID0gZmFicmljLnV0aWwuc3RyaW5nLnVuY2FwaXRhbGl6ZShmaWx0ZXJOYW1lKTtcbiAgICBmb3IodmFyIGkgaW4gdGhpcy5maWx0ZXJzKXtcbiAgICAgIGlmKGZhYnJpYy51dGlsLnN0cmluZy51bmNhcGl0YWxpemUodGhpcy5maWx0ZXJzW2ldLnR5cGUpID09PSBmaWx0ZXJOYW1lKXtcbiAgICAgICAgcmV0dXJuIHRoaXMuZmlsdGVyc1tpXTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9LFxuICBzZXRGaWx0ZXI6IGZ1bmN0aW9uIChmaWx0ZXIpIHtcblxuICAgIHZhciBfb2xkX2ZpbHRlciA9IGZhbHNlO1xuICAgIGlmKGZpbHRlci5yZXBsYWNlKXtcbiAgICAgIHRoaXMuZmlsdGVycyA9IFtdO1xuICAgIH1lbHNle1xuICAgICAgX29sZF9maWx0ZXIgPSBmYWJyaWMudXRpbC5vYmplY3QuZmluZFdoZXJlKHRoaXMuZmlsdGVycywge3R5cGU6IGZpbHRlci50eXBlfSk7XG4gICAgICBfb2xkX2ZpbHRlciA9IF9vbGRfZmlsdGVyICYmIF9vbGRfZmlsdGVyLnRvT2JqZWN0KCkgfHwgZmFsc2U7XG4gICAgfVxuXG5cbiAgICBpZihmaWx0ZXIudHlwZSl7XG4gICAgICB2YXIgX3R5cGUgPSBmYWJyaWMudXRpbC5zdHJpbmcuY2FwaXRhbGl6ZShmaWx0ZXIudHlwZSx0cnVlKTtcbiAgICAgIHZhciBfbmV3X2ZpbHRlciA9IGZpbHRlci5vcHRpb25zICYmIGZhYnJpYy51dGlsLm9iamVjdC5jbG9uZShmaWx0ZXIub3B0aW9ucyk7XG5cblxuICAgIH1lbHNle1xuICAgICAgX3R5cGUgPSBmYWxzZTtcbiAgICAgIF9uZXdfZmlsdGVyID0gZmFsc2U7XG4gICAgfVxuXG4gICAgLyogdGhpcy5wcm9qZWN0Lmhpc3RvcnkuYWRkKHtcbiAgICAgZGF0YTogICBbJC5leHRlbmQodHJ1ZSwge30sIHRoaXMuZGF0YSldLFxuICAgICBzbGlkZTogIHRoaXMuc2xpZGUsXG4gICAgIG9iamVjdDogdGhpcyxcbiAgICAgcmVkbzogICBmaWx0ZXIsXG4gICAgIHVuZG86ICAgX29sZF9maWx0ZXIgLFxuICAgICB0eXBlOiAgIFwiZmlsdGVyXCIsXG4gICAgIHVuZG9GbjogZnVuY3Rpb24oYWN0aW9uKXtcbiAgICAgYWN0aW9uLm9iamVjdC5fc2V0X2ZpbHRlcihhY3Rpb24udW5kbyk7XG4gICAgIH0sXG4gICAgIHJlZG9GbjogIGZ1bmN0aW9uKGFjdGlvbil7XG4gICAgIGFjdGlvbi5vYmplY3QuX3NldF9maWx0ZXIoYWN0aW9uLnJlZG8pO1xuICAgICB9XG4gICAgIH0pO1xuICAgICAqL1xuICAgIHRoaXMuX3NldF9maWx0ZXIoX3R5cGUsIF9uZXdfZmlsdGVyLCBfb2xkX2ZpbHRlcik7XG5cbiAgfSxcblxuICBfc2V0X2ZpbHRlcjogZnVuY3Rpb24gKF90eXBlLCBfbmV3X2ZpbHRlcikge1xuXG4gICAgaWYoX3R5cGUpe1xuICAgICAgdmFyIF9vbGRfZmlsdGVyID0gdGhpcy5nZXRGaWx0ZXIoX3R5cGUpO1xuICAgIH1cblxuICAgIGlmIChfb2xkX2ZpbHRlciAmJiBfbmV3X2ZpbHRlcikge1xuICAgICAgZm9yICh2YXIgaSBpbiBfbmV3X2ZpbHRlcikge1xuICAgICAgICBfb2xkX2ZpbHRlcltpXSA9IF9uZXdfZmlsdGVyW2ldO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoX29sZF9maWx0ZXIgJiYgIV9uZXdfZmlsdGVyKSB7XG4gICAgICB0aGlzLmZpbHRlcnMuc3BsaWNlKHRoaXMuZmlsdGVycy5pbmRleE9mKF9vbGRfZmlsdGVyKSwgMSk7XG4gICAgfVxuICAgIGlmICghX29sZF9maWx0ZXIgJiYgX25ld19maWx0ZXIpIHtcbiAgICAgIHRoaXMuZmlsdGVycy5wdXNoKG5ldyBmYWJyaWMuSW1hZ2UuZmlsdGVyc1tfdHlwZV0oX25ld19maWx0ZXIpKTtcbiAgICB9XG4gICAgdGhpcy5hcHBseUZpbHRlcnModGhpcy5jYW52YXMucmVuZGVyQWxsLmJpbmQodGhpcy5jYW52YXMpKTtcbiAgfSxcblxuICBpbnNlcnRJbWFnZUZpbHRlcnM6IGZhbHNlLFxuICBhY3Rpb25zIDogZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuSW1hZ2UucHJvdG90eXBlLmFjdGlvbnMsIHtcbiAgICBmaWx0ZXJzOiB7XG4gICAgICB0aXRsZTogXCLRhNC40LvRjNGC0YBcIixcbiAgICAgIGl0ZW1DbGFzc05hbWU6IFwiZmlsdGVycy1zZWxlY3RvclwiLFxuICAgICAgY2xhc3NOYW1lOiBcImZhIGZhLWZpbHRlclwiLFxuICAgICAgdHlwZTogXCJzZWxlY3RcIixcbiAgICAgIHRlbXBsYXRlU2VsZWN0aW9uOiBmdW5jdGlvbiAoc3RhdGUsIGNvbnRhaW5lcikge1xuICAgICAgICBpZiAoc3RhdGUuYW55KSB7XG4gICAgICAgICAgcmV0dXJuIHN0YXRlLnRleHQ7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuICQoJzxzcGFuPjxzcGFuIGNsYXNzPVwiY29sb3Itc3BhblwiIHN0eWxlPVwiYmFja2dyb3VuZC1jb2xvcjonICsgc3RhdGUudGV4dCArICdcIj48L3NwYW4+JyArIHN0YXRlLnRleHQgKyAnPC9zcGFuPicpO1xuICAgICAgfSxcbiAgICAgIHRlbXBsYXRlUmVzdWx0OiBmdW5jdGlvbiAoc3RhdGUsIGNvbnRhaW5lciwgZGF0YSkge1xuICAgICAgICB2YXIgJGVsID0gJCgnPHNwYW4+JyArIHN0YXRlLnRleHQgKyAnPC9zcGFuPicpO1xuICAgICAgLy8gIGlmIChzdGF0ZS5pZCAhPSBcIm5vbmVcIikge1xuICAgICAgICAgIHZhciAkY2FudmFzID0gJCgnPGNhbnZhcz4nKTtcbiAgICAgICAgICBmYWJyaWMudXRpbC5kcmF3RmlsdGVyKCRjYW52YXNbMF0sIGRhdGEudGFyZ2V0Ll9lbGVtZW50LCBzdGF0ZS5pZCwge1xuICAgICAgICAgICAgaGVpZ2h0OiAyMlxuICAgICAgICAgIH0pO1xuICAgICAgICAgICRlbC5wcmVwZW5kKCRjYW52YXMpO1xuICAgICAgIC8vIH1cbiAgICAgICAgcmV0dXJuICRlbDtcbiAgICAgIH0sXG4gICAgICB2YWx1ZToge1xuICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2YWwsIGZpbHRlcnNEYXRhKSB7XG4gICAgICAgICAgdmFyIG9wdGlvbnMgPSBmYWxzZTtcbiAgICAgICAgICBpZiAodmFsID09IFwibm9uZVwiKSB7XG4gICAgICAgICAgICB2YWwgPSBmYWxzZTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmFyIF9mID0gXy5maW5kV2hlcmUoZmlsdGVyc0RhdGEsIHtpZDogdmFsfSk7XG4gICAgICAgICAgICBfZi5lbmFibGVkID0gIV9mLmVuYWJsZWQ7XG4gICAgICAgICAgICBmb3IgKHZhciBpIGluIF9mLm9wdGlvbnMpIHtcbiAgICAgICAgICAgICAgaWYgKCQuaXNOdW1lcmljKF9mLm9wdGlvbnNbaV0pKSB7XG4gICAgICAgICAgICAgICAgX2Yub3B0aW9uc1tpXSA9IHBhcnNlRmxvYXQoX2Yub3B0aW9uc1tpXSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChfZi5lbmFibGVkKSB7XG4gICAgICAgICAgICAgIG9wdGlvbnMgPSB7fTtcbiAgICAgICAgICAgICAgZm9yICh2YXIgaSBpbiBfZi5vcHRpb25zKSB7XG4gICAgICAgICAgICAgICAgb3B0aW9uc1tpXSA9IF9mLm9wdGlvbnNbaV0udmFsdWU7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy5zZXRGaWx0ZXIoe1xuICAgICAgICAgICAgdHlwZTogdmFsLFxuICAgICAgICAgICAgb3B0aW9uczogb3B0aW9ucyxcbiAgICAgICAgICAgIHJlcGxhY2U6IHRydWVcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuZmlsdGVycy5sZW5ndGggPyBmYWJyaWMudXRpbC5zdHJpbmcuY2FwaXRhbGl6ZSh0aGlzLmZpbHRlcnNbMF0udHlwZSwgdHJ1ZSkgOiBcIm5vbmVcIlxuICAgICAgICB9LFxuICAgICAgICBvcHRpb25zOiBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICB2YXIgX2ZpbHRlcnMgPSB0aGlzLmdldEZpbHRlcnNEYXRhKCk7XG4gICAgICAgICAgZm9yICh2YXIgaSBpbiBfZmlsdGVycykge1xuICAgICAgICAgICAgX2ZpbHRlcnNbaV0uaWQgPSBfZmlsdGVyc1tpXS50eXBlO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gW3tcbiAgICAgICAgICAgIGlkOiAnbm9uZScsXG4gICAgICAgICAgICB0ZXh0OiAnb3JpZ2luYWwnLFxuICAgICAgICAgICAgZW5hYmxlZDogIXRoaXMuZmlsdGVycyB8fCAhdGhpcy5maWx0ZXJzLmxlbmd0aFxuICAgICAgICAgIH1dLmNvbmNhdChfZmlsdGVycyk7XG5cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSlcbn0pO1xuXG4vL1xuLy8gZmFicmljLkltYWdlLmZpbHRlck1hbmFnZXIgPSB7XG4vL1xuLy8gICAvL2hpZGU6IGZ1bmN0aW9uKG9iamVjdCl7XG4vLyAgIC8vXG4vLyAgIC8vfSxcbi8vICAgc2hvdzogZnVuY3Rpb24gKG9iamVjdCkge1xuLy8gICAgIHRoaXMuYWN0aXZlT2JqZWN0ID0gb2JqZWN0O1xuLy8gICAgIHRoaXMuZmlyZSgnc2hvdycsIG9iamVjdCk7XG4vLyAgICAgdGhpcy5vbigndGFyZ2V0OmNoYW5nZWQnLCBvYmplY3QpXG4vLyAgIH1cbi8vIC8vIH07XG5cblxuXG4vLyBmYWJyaWMudXRpbC5vYnNlcnZhYmxlKGZhYnJpYy5JbWFnZS5maWx0ZXJNYW5hZ2VyKTtcblxuZmFicmljLnV0aWwuZHJhd0ZpbHRlciA9IGZ1bmN0aW9uKGVsZW1lbnQsc3JjLCBmaWx0ZXJOYW1lICxvcHRpb25zKXtcbiAgaWYoc3JjLmNvbnN0cnVjdG9yID09PSBTdHJpbmcpe1xuICAgIGZhYnJpYy51dGlsLmxvYWRJbWFnZShzcmMsZnVuY3Rpb24oZWwpe1xuICAgICAgZmFicmljLnV0aWwuX2RyYXdGaWx0ZXIoZWxlbWVudCwgZWwsIGZpbHRlck5hbWUgLG9wdGlvbnMpO1xuICAgIH0pXG4gIH1lbHNle1xuICAgIGZhYnJpYy51dGlsLl9kcmF3RmlsdGVyKGVsZW1lbnQsc3JjLCBmaWx0ZXJOYW1lICxvcHRpb25zKTtcbiAgfVxufTtcblxuZmFicmljLnV0aWwuX2RyYXdGaWx0ZXIgPSBmdW5jdGlvbihlbGVtZW50LCBlbCwgZmlsdGVyTmFtZSAsb3B0aW9ucyl7XG5cbiAgdmFyIGN0eCA9ZWxlbWVudC5nZXRDb250ZXh0KFwiMmRcIik7XG4gIGlmKG9wdGlvbnMpe1xuICAgIGlmKG9wdGlvbnMud2lkdGggJiYgb3B0aW9ucy5oZWlnaHQpe1xuICAgICAgZWxlbWVudC53aWR0aCA9IG9wdGlvbnMud2lkdGg7XG4gICAgICBlbGVtZW50LmhlaWdodCA9IG9wdGlvbnMuaGVpZ2h0O1xuICAgIH1lbHNlIGlmKG9wdGlvbnMud2lkdGgpe1xuICAgICAgZWxlbWVudC53aWR0aCA9IG9wdGlvbnMud2lkdGg7XG4gICAgICBlbGVtZW50LmhlaWdodCA9IG9wdGlvbnMud2lkdGggKiAoZWwuaGVpZ2h0IC8gZWwud2lkdGgpO1xuICAgIH1lbHNlIGlmKG9wdGlvbnMuaGVpZ2h0KXtcbiAgICAgIGVsZW1lbnQuaGVpZ2h0ID0gb3B0aW9ucy5oZWlnaHQ7XG4gICAgICBlbGVtZW50LndpZHRoID0gb3B0aW9ucy5oZWlnaHQgKiAoZWwud2lkdGggLyBlbC5oZWlnaHQpO1xuICAgIH1cbiAgfVxuXG4gIGN0eC5kcmF3SW1hZ2UoZWwsMCwwLGVsZW1lbnQud2lkdGgsZWxlbWVudC5oZWlnaHQpO1xuXG4gIGlmKCFmaWx0ZXJOYW1lIHx8IGZpbHRlck5hbWUgPT0gXCJub25lXCIpcmV0dXJuO1xuICBmaWx0ZXJOYW1lID0gZmFicmljLnV0aWwuc3RyaW5nLmNhcGl0YWxpemUoZmlsdGVyTmFtZSx0cnVlKTtcblxuICBpZihmYWJyaWMuSW1hZ2UuZmlsdGVyc1tmaWx0ZXJOYW1lXSl7XG4gICAgdmFyIF9maWx0ZXIgPSBuZXcgZmFicmljLkltYWdlLmZpbHRlcnNbZmlsdGVyTmFtZV0oKVxuICB9ZWxzZXtcbiAgICB2YXIgX2ZpbHRlciA9ZmFicmljLkltYWdlLmZpbHRlcnNbZmlsdGVyTmFtZV0uY3JlYXRlKHt9KTtcbiAgfVxuXG4gIC8vdmFyIF9maWx0ZXIgPSBuZXcgZmFicmljLkltYWdlLmZpbHRlcnNbZmlsdGVyTmFtZV07XG4gIGlmKF9maWx0ZXIpe1xuICAgIHZhciBfZm8gPSBmYWJyaWMuSW1hZ2UuZmlsdGVyc1tmaWx0ZXJOYW1lXS5wcm90b3R5cGUub3B0aW9ucztcbiAgICB2YXIgZmlsdGVyT3B0aW9ucyA9IHt9O1xuICAgIGZvcih2YXIgaSBpbiBfZm8pe1xuICAgICAgZmlsdGVyT3B0aW9uc1tpXSA9IF9mb1tpXS52YWx1ZTtcblxuICAgIH1cbiAgICBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKF9maWx0ZXIsZmlsdGVyT3B0aW9ucyk7XG4gICAgX2ZpbHRlci5pbWFnZURhdGEgPSBjdHguZ2V0SW1hZ2VEYXRhKDAsMCxlbGVtZW50LndpZHRoLGVsZW1lbnQuaGVpZ2h0KTtcbiAgICBfZmlsdGVyLmFwcGx5VG8oZWxlbWVudCk7XG4gIH1cbn07XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL21vZHVsZXMvaW1hZ2UuZmlsdGVycy5qcyIsImlmKHR5cGVvZiBXZWJGb250ID09IFwidW5kZWZpbmVkXCIpe1xuICBmYWJyaWMud2ViRm9udHNMb2FkZXIgPSByZXF1aXJlKFwiLi8uLi8uLi9wbHVnaW5zL3dlYmZvbnQuanNcIik7XG59ZWxzZXtcbiAgZmFicmljLndlYkZvbnRzTG9hZGVyID0gV2ViRm9udDtcbn1cblxuLy/QuNC90YLQtdGA0LXRgdC90LDRjyDQsdC40LHQu9C40L7RgtC10LrQsFxuLy8gaHR0cDovL29wZW50eXBlLmpzLm9yZy9pbmRleC5odG1sXG4vL3RvZG8gYWRkIHN0ZXBcbi8vXG4vLyBmYWJyaWMuQXBwbGljYXRpb24ucHJvdG90eXBlLnN0ZXBzLnNwbGljZSgzLDAsXCJsb2FkV2ViZm9udHNcIik7XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLkFwcGxpY2F0aW9uLnByb3RvdHlwZSwge1xuICAvLyBzZXRXZWJmb250czogZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gIC8vXG4gIC8vIH0sXG4gIHNldEZvbnRzOiBmdW5jdGlvbiAoZm9udHMsIGNhbGxiYWNrKSB7XG4gICAgdGhpcy5mb250cyA9IGZvbnRzO1xuICAgIGlmKGZhYnJpYy5pc0xpa2VseU5vZGUpe1xuICAgICAgLy90b2RvINGI0YDQuNGE0YLRiyDQvdC1INCz0YDRg9C30Y/RgtGB0Y8g0L3QsCDRgdC10YDQstC10YDQtVxuICAgICAgcmV0dXJuIGNhbGxiYWNrKCk7XG4gICAgfVxuICAgIC8vIGlmKCFmb250cyB8fCAhZm9udHMubGVuZ3RoKXtcbiAgICAvLyAgIHJldHVybiBjYWxsYmFjaygpO1xuICAgIC8vIH1cbiAgICB0aGlzLmZpcmUoXCJsb2FkaW5nXCIse3R5cGU6IFwid2ViZm9udHNcIn0pO1xuXG4gICAgdGhpcy5fZm9udHMgPSBbXTtcblxuICAgIGZvcih2YXIgaSBpbiB0aGlzLmZvbnRzKXtcbiAgICAgIHRoaXMuX2ZvbnRzID0gdGhpcy5fZm9udHMuY29uY2F0KHRoaXMuZm9udHNbaV0pO1xuICAgIH1cbiAgICB0aGlzLl9mb250cyA9IGZhYnJpYy51dGlsLm9iamVjdC5zb3J0QnkodGhpcy5fZm9udHMsIGZ1bmN0aW9uKGZvbnQpeyByZXR1cm4gZm9udDsgfSk7XG5cbiAgICBpZihmYWJyaWMud2ViRm9udHNMb2FkZXIgJiYgKHRoaXMuZm9udHMuZ29vZ2xlICYmIHRoaXMuZm9udHMuZ29vZ2xlLmxlbmd0aCB8fCB0aGlzLmZvbnRzLmN1c3RvbSAmJiB0aGlzLmZvbnRzLmN1c3RvbS5sZW5ndGgpICl7XG4gICAgICB2YXIgZm9udHNfb3B0aW9ucyA9IHtcbiAgICAgICAgYWN0aXZlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIGlmKHRoaXMuZm9udHMuZ29vZ2xlICYmIHRoaXMuZm9udHMuZ29vZ2xlLmxlbmd0aCl7XG4gICAgICAgIGZvbnRzX29wdGlvbnMuZ29vZ2xlID0gIHtcbiAgICAgICAgICBmYW1pbGllczogdGhpcy5mb250cy5nb29nbGVcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIGlmKHRoaXMuZm9udHMuY3VzdG9tICYmIHRoaXMuZm9udHMuY3VzdG9tLmxlbmd0aCl7XG4gICAgICAgIGZvbnRzX29wdGlvbnMuY3VzdG9tID0gIHtcbiAgICAgICAgICBmYW1pbGllczogdGhpcy5mb250cy5jdXN0b21cbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgZmFicmljLndlYkZvbnRzTG9hZGVyLmxvYWQoZm9udHNfb3B0aW9ucyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNhbGxiYWNrKCk7XG4gICAgfVxuICAgIGlmICh0aGlzLndhaXRGb3JXZWJmb250cykge1xuICAgICAgZmFicmljLnV0aWwuZm9udHMud2FpdEZvcih0aGlzLndhaXRGb3JXZWJmb250cywgY2FsbGJhY2spXG4gICAgfVxuICB9LFxuICBmb250czoge1xuICAgIHN0YW5kYXJ0OiBbXG4gICAgICAnQXJpYWwnLFxuICAgICAgJ0FyaWFsIEJsYWNrJyxcbiAgICAgICdDb21pYyBTYW5zIE1TJyxcbiAgICAgICdDb3VyaWVyIE5ldycsXG4gICAgICAnR2VvcmdpYScsXG4gICAgICAnSW1wYWN0JyxcbiAgICAgICdMdWNpZGEgQ29uc29sZScsXG4gICAgICAnVGFob21hJyxcbiAgICAgICdUaW1lcyBOZXcgUm9tYW4nLFxuICAgICAgJ0dlbmV2YScsXG4gICAgICAnc2Fucy1zZXJpZicsXG4gICAgICAnc2VyaWYnLFxuICAgICAgJ21vbm9zcGFjZScsXG4gICAgICAnY3Vyc2l2ZSdcbiAgICBdLFxuICAgIGdvb2dsZTogW10sXG4gICAgY3VzdG9tOiBbXVxuICB9XG59KTtcblxuXG5mYWJyaWMudXRpbC5mb250cyA9IHtcbiAgd2FpdEZvcjogZnVuY3Rpb24gKGZvbnRzLCBjYWxsYmFjaykge1xuICAgIHZhciBsb2FkZWRGb250cyA9IDA7XG4gICAgZm9yICh2YXIgaSA9IDAsIGwgPSBmb250cy5sZW5ndGg7IGkgPCBsOyArK2kpIHtcbiAgICAgIChmdW5jdGlvbiAoZm9udCkge1xuICAgICAgICB2YXIgbm9kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcbiAgICAgICAgLy8gQ2hhcmFjdGVycyB0aGF0IHZhcnkgc2lnbmlmaWNhbnRseSBhbW9uZyBkaWZmZXJlbnQgZm9udHNcbiAgICAgICAgbm9kZS5pbm5lckhUTUwgPSAnZ2lJdFQxV1F5QCEtLyMnO1xuICAgICAgICAvLyBWaXNpYmxlIC0gc28gd2UgY2FuIG1lYXN1cmUgaXQgLSBidXQgbm90IG9uIHRoZSBzY3JlZW5cbiAgICAgICAgbm9kZS5zdHlsZS5wb3NpdGlvbiA9ICdhYnNvbHV0ZSc7XG4gICAgICAgIG5vZGUuc3R5bGUubGVmdCA9ICctMTAwMDBweCc7XG4gICAgICAgIG5vZGUuc3R5bGUudG9wID0gJy0xMDAwMHB4JztcbiAgICAgICAgLy8gTGFyZ2UgZm9udCBzaXplIG1ha2VzIGV2ZW4gc3VidGxlIGNoYW5nZXMgb2J2aW91c1xuICAgICAgICBub2RlLnN0eWxlLmZvbnRTaXplID0gJzMwMHB4JztcbiAgICAgICAgLy8gUmVzZXQgYW55IGZvbnQgcHJvcGVydGllc1xuICAgICAgICBub2RlLnN0eWxlLmZvbnRGYW1pbHkgPSAnc2Fucy1zZXJpZic7XG4gICAgICAgIG5vZGUuc3R5bGUuZm9udFZhcmlhbnQgPSAnbm9ybWFsJztcbiAgICAgICAgbm9kZS5zdHlsZS5mb250U3R5bGUgPSAnbm9ybWFsJztcbiAgICAgICAgbm9kZS5zdHlsZS5mb250V2VpZ2h0ID0gJ25vcm1hbCc7XG4gICAgICAgIG5vZGUuc3R5bGUubGV0dGVyU3BhY2luZyA9ICcwJztcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChub2RlKTtcblxuICAgICAgICAvLyBSZW1lbWJlciB3aWR0aCB3aXRoIG5vIGFwcGxpZWQgd2ViIGZvbnRcbiAgICAgICAgdmFyIHdpZHRoID0gbm9kZS5vZmZzZXRXaWR0aDtcblxuICAgICAgICBub2RlLnN0eWxlLmZvbnRGYW1pbHkgPSBmb250O1xuXG4gICAgICAgIHZhciBpbnRlcnZhbDtcblxuICAgICAgICBmdW5jdGlvbiBjaGVja0ZvbnQoKSB7XG4gICAgICAgICAgLy8gQ29tcGFyZSBjdXJyZW50IHdpZHRoIHdpdGggb3JpZ2luYWwgd2lkdGhcbiAgICAgICAgICBpZiAobm9kZSAmJiBub2RlLm9mZnNldFdpZHRoICE9IHdpZHRoKSB7XG4gICAgICAgICAgICArK2xvYWRlZEZvbnRzO1xuICAgICAgICAgICAgbm9kZS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKG5vZGUpO1xuICAgICAgICAgICAgbm9kZSA9IG51bGw7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gSWYgYWxsIGZvbnRzIGhhdmUgYmVlbiBsb2FkZWRcbiAgICAgICAgICBpZiAobG9hZGVkRm9udHMgPj0gZm9udHMubGVuZ3RoKSB7XG4gICAgICAgICAgICBpZiAoaW50ZXJ2YWwpIHtcbiAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChpbnRlcnZhbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAobG9hZGVkRm9udHMgPT0gZm9udHMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICAgIH0sIDUwKVxuICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIWNoZWNrRm9udCgpKSB7XG4gICAgICAgICAgaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChjaGVja0ZvbnQsIDUwKTtcbiAgICAgICAgfVxuICAgICAgfSkoZm9udHNbaV0pO1xuICAgIH1cbiAgfVxufTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvbW9kdWxlcy9mb250cy5qcyIsIi8qIFdlYiBGb250IExvYWRlciB2MS42LjI2IC0gKGMpIEFkb2JlIFN5c3RlbXMsIEdvb2dsZS4gTGljZW5zZTogQXBhY2hlIDIuMCAqLyhmdW5jdGlvbigpe2Z1bmN0aW9uIGFhKGEsYixjKXtyZXR1cm4gYS5jYWxsLmFwcGx5KGEuYmluZCxhcmd1bWVudHMpfWZ1bmN0aW9uIGJhKGEsYixjKXtpZighYSl0aHJvdyBFcnJvcigpO2lmKDI8YXJndW1lbnRzLmxlbmd0aCl7dmFyIGQ9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLDIpO3JldHVybiBmdW5jdGlvbigpe3ZhciBjPUFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cyk7QXJyYXkucHJvdG90eXBlLnVuc2hpZnQuYXBwbHkoYyxkKTtyZXR1cm4gYS5hcHBseShiLGMpfX1yZXR1cm4gZnVuY3Rpb24oKXtyZXR1cm4gYS5hcHBseShiLGFyZ3VtZW50cyl9fWZ1bmN0aW9uIHAoYSxiLGMpe3A9RnVuY3Rpb24ucHJvdG90eXBlLmJpbmQmJi0xIT1GdW5jdGlvbi5wcm90b3R5cGUuYmluZC50b1N0cmluZygpLmluZGV4T2YoXCJuYXRpdmUgY29kZVwiKT9hYTpiYTtyZXR1cm4gcC5hcHBseShudWxsLGFyZ3VtZW50cyl9dmFyIHE9RGF0ZS5ub3d8fGZ1bmN0aW9uKCl7cmV0dXJuK25ldyBEYXRlfTtmdW5jdGlvbiBjYShhLGIpe3RoaXMuYT1hO3RoaXMubT1ifHxhO3RoaXMuYz10aGlzLm0uZG9jdW1lbnR9dmFyIGRhPSEhd2luZG93LkZvbnRGYWNlO2Z1bmN0aW9uIHQoYSxiLGMsZCl7Yj1hLmMuY3JlYXRlRWxlbWVudChiKTtpZihjKWZvcih2YXIgZSBpbiBjKWMuaGFzT3duUHJvcGVydHkoZSkmJihcInN0eWxlXCI9PWU/Yi5zdHlsZS5jc3NUZXh0PWNbZV06Yi5zZXRBdHRyaWJ1dGUoZSxjW2VdKSk7ZCYmYi5hcHBlbmRDaGlsZChhLmMuY3JlYXRlVGV4dE5vZGUoZCkpO3JldHVybiBifWZ1bmN0aW9uIHUoYSxiLGMpe2E9YS5jLmdldEVsZW1lbnRzQnlUYWdOYW1lKGIpWzBdO2F8fChhPWRvY3VtZW50LmRvY3VtZW50RWxlbWVudCk7YS5pbnNlcnRCZWZvcmUoYyxhLmxhc3RDaGlsZCl9ZnVuY3Rpb24gdihhKXthLnBhcmVudE5vZGUmJmEucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChhKX1cbiAgZnVuY3Rpb24gdyhhLGIsYyl7Yj1ifHxbXTtjPWN8fFtdO2Zvcih2YXIgZD1hLmNsYXNzTmFtZS5zcGxpdCgvXFxzKy8pLGU9MDtlPGIubGVuZ3RoO2UrPTEpe2Zvcih2YXIgZj0hMSxnPTA7ZzxkLmxlbmd0aDtnKz0xKWlmKGJbZV09PT1kW2ddKXtmPSEwO2JyZWFrfWZ8fGQucHVzaChiW2VdKX1iPVtdO2ZvcihlPTA7ZTxkLmxlbmd0aDtlKz0xKXtmPSExO2ZvcihnPTA7ZzxjLmxlbmd0aDtnKz0xKWlmKGRbZV09PT1jW2ddKXtmPSEwO2JyZWFrfWZ8fGIucHVzaChkW2VdKX1hLmNsYXNzTmFtZT1iLmpvaW4oXCIgXCIpLnJlcGxhY2UoL1xccysvZyxcIiBcIikucmVwbGFjZSgvXlxccyt8XFxzKyQvLFwiXCIpfWZ1bmN0aW9uIHkoYSxiKXtmb3IodmFyIGM9YS5jbGFzc05hbWUuc3BsaXQoL1xccysvKSxkPTAsZT1jLmxlbmd0aDtkPGU7ZCsrKWlmKGNbZF09PWIpcmV0dXJuITA7cmV0dXJuITF9XG4gIGZ1bmN0aW9uIHooYSl7aWYoXCJzdHJpbmdcIj09PXR5cGVvZiBhLmYpcmV0dXJuIGEuZjt2YXIgYj1hLm0ubG9jYXRpb24ucHJvdG9jb2w7XCJhYm91dDpcIj09YiYmKGI9YS5hLmxvY2F0aW9uLnByb3RvY29sKTtyZXR1cm5cImh0dHBzOlwiPT1iP1wiaHR0cHM6XCI6XCJodHRwOlwifWZ1bmN0aW9uIGVhKGEpe3JldHVybiBhLm0ubG9jYXRpb24uaG9zdG5hbWV8fGEuYS5sb2NhdGlvbi5ob3N0bmFtZX1cbiAgZnVuY3Rpb24gQShhLGIsYyl7ZnVuY3Rpb24gZCgpe2smJmUmJmYmJihrKGcpLGs9bnVsbCl9Yj10KGEsXCJsaW5rXCIse3JlbDpcInN0eWxlc2hlZXRcIixocmVmOmIsbWVkaWE6XCJhbGxcIn0pO3ZhciBlPSExLGY9ITAsZz1udWxsLGs9Y3x8bnVsbDtkYT8oYi5vbmxvYWQ9ZnVuY3Rpb24oKXtlPSEwO2QoKX0sYi5vbmVycm9yPWZ1bmN0aW9uKCl7ZT0hMDtnPUVycm9yKFwiU3R5bGVzaGVldCBmYWlsZWQgdG8gbG9hZFwiKTtkKCl9KTpzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7ZT0hMDtkKCl9LDApO3UoYSxcImhlYWRcIixiKX1cbiAgZnVuY3Rpb24gQihhLGIsYyxkKXt2YXIgZT1hLmMuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJoZWFkXCIpWzBdO2lmKGUpe3ZhciBmPXQoYSxcInNjcmlwdFwiLHtzcmM6Yn0pLGc9ITE7Zi5vbmxvYWQ9Zi5vbnJlYWR5c3RhdGVjaGFuZ2U9ZnVuY3Rpb24oKXtnfHx0aGlzLnJlYWR5U3RhdGUmJlwibG9hZGVkXCIhPXRoaXMucmVhZHlTdGF0ZSYmXCJjb21wbGV0ZVwiIT10aGlzLnJlYWR5U3RhdGV8fChnPSEwLGMmJmMobnVsbCksZi5vbmxvYWQ9Zi5vbnJlYWR5c3RhdGVjaGFuZ2U9bnVsbCxcIkhFQURcIj09Zi5wYXJlbnROb2RlLnRhZ05hbWUmJmUucmVtb3ZlQ2hpbGQoZikpfTtlLmFwcGVuZENoaWxkKGYpO3NldFRpbWVvdXQoZnVuY3Rpb24oKXtnfHwoZz0hMCxjJiZjKEVycm9yKFwiU2NyaXB0IGxvYWQgdGltZW91dFwiKSkpfSxkfHw1RTMpO3JldHVybiBmfXJldHVybiBudWxsfTtmdW5jdGlvbiBDKCl7dGhpcy5hPTA7dGhpcy5jPW51bGx9ZnVuY3Rpb24gRChhKXthLmErKztyZXR1cm4gZnVuY3Rpb24oKXthLmEtLTtFKGEpfX1mdW5jdGlvbiBGKGEsYil7YS5jPWI7RShhKX1mdW5jdGlvbiBFKGEpezA9PWEuYSYmYS5jJiYoYS5jKCksYS5jPW51bGwpfTtmdW5jdGlvbiBHKGEpe3RoaXMuYT1hfHxcIi1cIn1HLnByb3RvdHlwZS5jPWZ1bmN0aW9uKGEpe2Zvcih2YXIgYj1bXSxjPTA7Yzxhcmd1bWVudHMubGVuZ3RoO2MrKyliLnB1c2goYXJndW1lbnRzW2NdLnJlcGxhY2UoL1tcXFdfXSsvZyxcIlwiKS50b0xvd2VyQ2FzZSgpKTtyZXR1cm4gYi5qb2luKHRoaXMuYSl9O2Z1bmN0aW9uIEgoYSxiKXt0aGlzLmM9YTt0aGlzLmY9NDt0aGlzLmE9XCJuXCI7dmFyIGM9KGJ8fFwibjRcIikubWF0Y2goL14oW25pb10pKFsxLTldKSQvaSk7YyYmKHRoaXMuYT1jWzFdLHRoaXMuZj1wYXJzZUludChjWzJdLDEwKSl9ZnVuY3Rpb24gZmEoYSl7cmV0dXJuIEkoYSkrXCIgXCIrKGEuZitcIjAwXCIpK1wiIDMwMHB4IFwiK0ooYS5jKX1mdW5jdGlvbiBKKGEpe3ZhciBiPVtdO2E9YS5zcGxpdCgvLFxccyovKTtmb3IodmFyIGM9MDtjPGEubGVuZ3RoO2MrKyl7dmFyIGQ9YVtjXS5yZXBsYWNlKC9bJ1wiXS9nLFwiXCIpOy0xIT1kLmluZGV4T2YoXCIgXCIpfHwvXlxcZC8udGVzdChkKT9iLnB1c2goXCInXCIrZCtcIidcIik6Yi5wdXNoKGQpfXJldHVybiBiLmpvaW4oXCIsXCIpfWZ1bmN0aW9uIEsoYSl7cmV0dXJuIGEuYSthLmZ9ZnVuY3Rpb24gSShhKXt2YXIgYj1cIm5vcm1hbFwiO1wib1wiPT09YS5hP2I9XCJvYmxpcXVlXCI6XCJpXCI9PT1hLmEmJihiPVwiaXRhbGljXCIpO3JldHVybiBifVxuICBmdW5jdGlvbiBnYShhKXt2YXIgYj00LGM9XCJuXCIsZD1udWxsO2EmJigoZD1hLm1hdGNoKC8obm9ybWFsfG9ibGlxdWV8aXRhbGljKS9pKSkmJmRbMV0mJihjPWRbMV0uc3Vic3RyKDAsMSkudG9Mb3dlckNhc2UoKSksKGQ9YS5tYXRjaCgvKFsxLTldMDB8bm9ybWFsfGJvbGQpL2kpKSYmZFsxXSYmKC9ib2xkL2kudGVzdChkWzFdKT9iPTc6L1sxLTldMDAvLnRlc3QoZFsxXSkmJihiPXBhcnNlSW50KGRbMV0uc3Vic3RyKDAsMSksMTApKSkpO3JldHVybiBjK2J9O2Z1bmN0aW9uIGhhKGEsYil7dGhpcy5jPWE7dGhpcy5mPWEubS5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7dGhpcy5oPWI7dGhpcy5hPW5ldyBHKFwiLVwiKTt0aGlzLmo9ITEhPT1iLmV2ZW50czt0aGlzLmc9ITEhPT1iLmNsYXNzZXN9ZnVuY3Rpb24gaWEoYSl7YS5nJiZ3KGEuZixbYS5hLmMoXCJ3ZlwiLFwibG9hZGluZ1wiKV0pO0woYSxcImxvYWRpbmdcIil9ZnVuY3Rpb24gTShhKXtpZihhLmcpe3ZhciBiPXkoYS5mLGEuYS5jKFwid2ZcIixcImFjdGl2ZVwiKSksYz1bXSxkPVthLmEuYyhcIndmXCIsXCJsb2FkaW5nXCIpXTtifHxjLnB1c2goYS5hLmMoXCJ3ZlwiLFwiaW5hY3RpdmVcIikpO3coYS5mLGMsZCl9TChhLFwiaW5hY3RpdmVcIil9ZnVuY3Rpb24gTChhLGIsYyl7aWYoYS5qJiZhLmhbYl0paWYoYylhLmhbYl0oYy5jLEsoYykpO2Vsc2UgYS5oW2JdKCl9O2Z1bmN0aW9uIGphKCl7dGhpcy5jPXt9fWZ1bmN0aW9uIGthKGEsYixjKXt2YXIgZD1bXSxlO2ZvcihlIGluIGIpaWYoYi5oYXNPd25Qcm9wZXJ0eShlKSl7dmFyIGY9YS5jW2VdO2YmJmQucHVzaChmKGJbZV0sYykpfXJldHVybiBkfTtmdW5jdGlvbiBOKGEsYil7dGhpcy5jPWE7dGhpcy5mPWI7dGhpcy5hPXQodGhpcy5jLFwic3BhblwiLHtcImFyaWEtaGlkZGVuXCI6XCJ0cnVlXCJ9LHRoaXMuZil9ZnVuY3Rpb24gTyhhKXt1KGEuYyxcImJvZHlcIixhLmEpfWZ1bmN0aW9uIFAoYSl7cmV0dXJuXCJkaXNwbGF5OmJsb2NrO3Bvc2l0aW9uOmFic29sdXRlO3RvcDotOTk5OXB4O2xlZnQ6LTk5OTlweDtmb250LXNpemU6MzAwcHg7d2lkdGg6YXV0bztoZWlnaHQ6YXV0bztsaW5lLWhlaWdodDpub3JtYWw7bWFyZ2luOjA7cGFkZGluZzowO2ZvbnQtdmFyaWFudDpub3JtYWw7d2hpdGUtc3BhY2U6bm93cmFwO2ZvbnQtZmFtaWx5OlwiK0ooYS5jKStcIjtcIisoXCJmb250LXN0eWxlOlwiK0koYSkrXCI7Zm9udC13ZWlnaHQ6XCIrKGEuZitcIjAwXCIpK1wiO1wiKX07ZnVuY3Rpb24gUShhLGIsYyxkLGUsZil7dGhpcy5nPWE7dGhpcy5qPWI7dGhpcy5hPWQ7dGhpcy5jPWM7dGhpcy5mPWV8fDNFMzt0aGlzLmg9Znx8dm9pZCAwfVEucHJvdG90eXBlLnN0YXJ0PWZ1bmN0aW9uKCl7dmFyIGE9dGhpcy5jLm0uZG9jdW1lbnQsYj10aGlzLGM9cSgpLGQ9bmV3IFByb21pc2UoZnVuY3Rpb24oZCxlKXtmdW5jdGlvbiBrKCl7cSgpLWM+PWIuZj9lKCk6YS5mb250cy5sb2FkKGZhKGIuYSksYi5oKS50aGVuKGZ1bmN0aW9uKGEpezE8PWEubGVuZ3RoP2QoKTpzZXRUaW1lb3V0KGssMjUpfSxmdW5jdGlvbigpe2UoKX0pfWsoKX0pLGU9bmV3IFByb21pc2UoZnVuY3Rpb24oYSxkKXtzZXRUaW1lb3V0KGQsYi5mKX0pO1Byb21pc2UucmFjZShbZSxkXSkudGhlbihmdW5jdGlvbigpe2IuZyhiLmEpfSxmdW5jdGlvbigpe2IuaihiLmEpfSl9O2Z1bmN0aW9uIFIoYSxiLGMsZCxlLGYsZyl7dGhpcy52PWE7dGhpcy5CPWI7dGhpcy5jPWM7dGhpcy5hPWQ7dGhpcy5zPWd8fFwiQkVTYnN3eVwiO3RoaXMuZj17fTt0aGlzLnc9ZXx8M0UzO3RoaXMudT1mfHxudWxsO3RoaXMubz10aGlzLmo9dGhpcy5oPXRoaXMuZz1udWxsO3RoaXMuZz1uZXcgTih0aGlzLmMsdGhpcy5zKTt0aGlzLmg9bmV3IE4odGhpcy5jLHRoaXMucyk7dGhpcy5qPW5ldyBOKHRoaXMuYyx0aGlzLnMpO3RoaXMubz1uZXcgTih0aGlzLmMsdGhpcy5zKTthPW5ldyBIKHRoaXMuYS5jK1wiLHNlcmlmXCIsSyh0aGlzLmEpKTthPVAoYSk7dGhpcy5nLmEuc3R5bGUuY3NzVGV4dD1hO2E9bmV3IEgodGhpcy5hLmMrXCIsc2Fucy1zZXJpZlwiLEsodGhpcy5hKSk7YT1QKGEpO3RoaXMuaC5hLnN0eWxlLmNzc1RleHQ9YTthPW5ldyBIKFwic2VyaWZcIixLKHRoaXMuYSkpO2E9UChhKTt0aGlzLmouYS5zdHlsZS5jc3NUZXh0PWE7YT1uZXcgSChcInNhbnMtc2VyaWZcIixLKHRoaXMuYSkpO2E9XG4gICAgUChhKTt0aGlzLm8uYS5zdHlsZS5jc3NUZXh0PWE7Tyh0aGlzLmcpO08odGhpcy5oKTtPKHRoaXMuaik7Tyh0aGlzLm8pfXZhciBTPXtEOlwic2VyaWZcIixDOlwic2Fucy1zZXJpZlwifSxUPW51bGw7ZnVuY3Rpb24gVSgpe2lmKG51bGw9PT1UKXt2YXIgYT0vQXBwbGVXZWJLaXRcXC8oWzAtOV0rKSg/OlxcLihbMC05XSspKS8uZXhlYyh3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudCk7VD0hIWEmJig1MzY+cGFyc2VJbnQoYVsxXSwxMCl8fDUzNj09PXBhcnNlSW50KGFbMV0sMTApJiYxMT49cGFyc2VJbnQoYVsyXSwxMCkpfXJldHVybiBUfVIucHJvdG90eXBlLnN0YXJ0PWZ1bmN0aW9uKCl7dGhpcy5mLnNlcmlmPXRoaXMuai5hLm9mZnNldFdpZHRoO3RoaXMuZltcInNhbnMtc2VyaWZcIl09dGhpcy5vLmEub2Zmc2V0V2lkdGg7dGhpcy5BPXEoKTtsYSh0aGlzKX07XG4gIGZ1bmN0aW9uIG1hKGEsYixjKXtmb3IodmFyIGQgaW4gUylpZihTLmhhc093blByb3BlcnR5KGQpJiZiPT09YS5mW1NbZF1dJiZjPT09YS5mW1NbZF1dKXJldHVybiEwO3JldHVybiExfWZ1bmN0aW9uIGxhKGEpe3ZhciBiPWEuZy5hLm9mZnNldFdpZHRoLGM9YS5oLmEub2Zmc2V0V2lkdGgsZDsoZD1iPT09YS5mLnNlcmlmJiZjPT09YS5mW1wic2Fucy1zZXJpZlwiXSl8fChkPVUoKSYmbWEoYSxiLGMpKTtkP3EoKS1hLkE+PWEudz9VKCkmJm1hKGEsYixjKSYmKG51bGw9PT1hLnV8fGEudS5oYXNPd25Qcm9wZXJ0eShhLmEuYykpP1YoYSxhLnYpOlYoYSxhLkIpOm5hKGEpOlYoYSxhLnYpfWZ1bmN0aW9uIG5hKGEpe3NldFRpbWVvdXQocChmdW5jdGlvbigpe2xhKHRoaXMpfSxhKSw1MCl9ZnVuY3Rpb24gVihhLGIpe3NldFRpbWVvdXQocChmdW5jdGlvbigpe3YodGhpcy5nLmEpO3YodGhpcy5oLmEpO3YodGhpcy5qLmEpO3YodGhpcy5vLmEpO2IodGhpcy5hKX0sYSksMCl9O2Z1bmN0aW9uIFcoYSxiLGMpe3RoaXMuYz1hO3RoaXMuYT1iO3RoaXMuZj0wO3RoaXMubz10aGlzLmo9ITE7dGhpcy5zPWN9dmFyIFg9bnVsbDtXLnByb3RvdHlwZS5nPWZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMuYTtiLmcmJncoYi5mLFtiLmEuYyhcIndmXCIsYS5jLEsoYSkudG9TdHJpbmcoKSxcImFjdGl2ZVwiKV0sW2IuYS5jKFwid2ZcIixhLmMsSyhhKS50b1N0cmluZygpLFwibG9hZGluZ1wiKSxiLmEuYyhcIndmXCIsYS5jLEsoYSkudG9TdHJpbmcoKSxcImluYWN0aXZlXCIpXSk7TChiLFwiZm9udGFjdGl2ZVwiLGEpO3RoaXMubz0hMDtvYSh0aGlzKX07XG4gIFcucHJvdG90eXBlLmg9ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5hO2lmKGIuZyl7dmFyIGM9eShiLmYsYi5hLmMoXCJ3ZlwiLGEuYyxLKGEpLnRvU3RyaW5nKCksXCJhY3RpdmVcIikpLGQ9W10sZT1bYi5hLmMoXCJ3ZlwiLGEuYyxLKGEpLnRvU3RyaW5nKCksXCJsb2FkaW5nXCIpXTtjfHxkLnB1c2goYi5hLmMoXCJ3ZlwiLGEuYyxLKGEpLnRvU3RyaW5nKCksXCJpbmFjdGl2ZVwiKSk7dyhiLmYsZCxlKX1MKGIsXCJmb250aW5hY3RpdmVcIixhKTtvYSh0aGlzKX07ZnVuY3Rpb24gb2EoYSl7MD09LS1hLmYmJmEuaiYmKGEubz8oYT1hLmEsYS5nJiZ3KGEuZixbYS5hLmMoXCJ3ZlwiLFwiYWN0aXZlXCIpXSxbYS5hLmMoXCJ3ZlwiLFwibG9hZGluZ1wiKSxhLmEuYyhcIndmXCIsXCJpbmFjdGl2ZVwiKV0pLEwoYSxcImFjdGl2ZVwiKSk6TShhLmEpKX07ZnVuY3Rpb24gcGEoYSl7dGhpcy5qPWE7dGhpcy5hPW5ldyBqYTt0aGlzLmg9MDt0aGlzLmY9dGhpcy5nPSEwfXBhLnByb3RvdHlwZS5sb2FkPWZ1bmN0aW9uKGEpe3RoaXMuYz1uZXcgY2EodGhpcy5qLGEuY29udGV4dHx8dGhpcy5qKTt0aGlzLmc9ITEhPT1hLmV2ZW50czt0aGlzLmY9ITEhPT1hLmNsYXNzZXM7cWEodGhpcyxuZXcgaGEodGhpcy5jLGEpLGEpfTtcbiAgZnVuY3Rpb24gcmEoYSxiLGMsZCxlKXt2YXIgZj0wPT0tLWEuaDsoYS5mfHxhLmcpJiZzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7dmFyIGE9ZXx8bnVsbCxrPWR8fG51bGx8fHt9O2lmKDA9PT1jLmxlbmd0aCYmZilNKGIuYSk7ZWxzZXtiLmYrPWMubGVuZ3RoO2YmJihiLmo9Zik7dmFyIGgsbT1bXTtmb3IoaD0wO2g8Yy5sZW5ndGg7aCsrKXt2YXIgbD1jW2hdLG49a1tsLmNdLHI9Yi5hLHg9bDtyLmcmJncoci5mLFtyLmEuYyhcIndmXCIseC5jLEsoeCkudG9TdHJpbmcoKSxcImxvYWRpbmdcIildKTtMKHIsXCJmb250bG9hZGluZ1wiLHgpO3I9bnVsbDtudWxsPT09WCYmKFg9d2luZG93LkZvbnRGYWNlPyh4PS9HZWNrby4qRmlyZWZveFxcLyhcXGQrKS8uZXhlYyh3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudCkpPzQyPHBhcnNlSW50KHhbMV0sMTApOiEwOiExKTtYP3I9bmV3IFEocChiLmcsYikscChiLmgsYiksYi5jLGwsYi5zLG4pOnI9bmV3IFIocChiLmcsYikscChiLmgsYiksYi5jLGwsYi5zLGEsXG4gICAgbik7bS5wdXNoKHIpfWZvcihoPTA7aDxtLmxlbmd0aDtoKyspbVtoXS5zdGFydCgpfX0sMCl9ZnVuY3Rpb24gcWEoYSxiLGMpe3ZhciBkPVtdLGU9Yy50aW1lb3V0O2lhKGIpO3ZhciBkPWthKGEuYSxjLGEuYyksZj1uZXcgVyhhLmMsYixlKTthLmg9ZC5sZW5ndGg7Yj0wO2ZvcihjPWQubGVuZ3RoO2I8YztiKyspZFtiXS5sb2FkKGZ1bmN0aW9uKGIsZCxjKXtyYShhLGYsYixkLGMpfSl9O2Z1bmN0aW9uIHNhKGEsYil7dGhpcy5jPWE7dGhpcy5hPWJ9ZnVuY3Rpb24gdGEoYSxiLGMpe3ZhciBkPXooYS5jKTthPShhLmEuYXBpfHxcImZhc3QuZm9udHMubmV0L2pzYXBpXCIpLnJlcGxhY2UoL14uKmh0dHAocz8pOihcXC9cXC8pPy8sXCJcIik7cmV0dXJuIGQrXCIvL1wiK2ErXCIvXCIrYitcIi5qc1wiKyhjP1wiP3Y9XCIrYzpcIlwiKX1cbiAgc2EucHJvdG90eXBlLmxvYWQ9ZnVuY3Rpb24oYSl7ZnVuY3Rpb24gYigpe2lmKGZbXCJfX210aV9mbnRMc3RcIitkXSl7dmFyIGM9ZltcIl9fbXRpX2ZudExzdFwiK2RdKCksZT1bXSxoO2lmKGMpZm9yKHZhciBtPTA7bTxjLmxlbmd0aDttKyspe3ZhciBsPWNbbV0uZm9udGZhbWlseTt2b2lkIDAhPWNbbV0uZm9udFN0eWxlJiZ2b2lkIDAhPWNbbV0uZm9udFdlaWdodD8oaD1jW21dLmZvbnRTdHlsZStjW21dLmZvbnRXZWlnaHQsZS5wdXNoKG5ldyBIKGwsaCkpKTplLnB1c2gobmV3IEgobCkpfWEoZSl9ZWxzZSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7YigpfSw1MCl9dmFyIGM9dGhpcyxkPWMuYS5wcm9qZWN0SWQsZT1jLmEudmVyc2lvbjtpZihkKXt2YXIgZj1jLmMubTtCKHRoaXMuYyx0YShjLGQsZSksZnVuY3Rpb24oZSl7ZT9hKFtdKTooZltcIl9fTW9ub3R5cGVDb25maWd1cmF0aW9uX19cIitkXT1mdW5jdGlvbigpe3JldHVybiBjLmF9LGIoKSl9KS5pZD1cIl9fTW9ub3R5cGVBUElTY3JpcHRfX1wiK1xuICAgIGR9ZWxzZSBhKFtdKX07ZnVuY3Rpb24gdWEoYSxiKXt0aGlzLmM9YTt0aGlzLmE9Yn11YS5wcm90b3R5cGUubG9hZD1mdW5jdGlvbihhKXt2YXIgYixjLGQ9dGhpcy5hLnVybHN8fFtdLGU9dGhpcy5hLmZhbWlsaWVzfHxbXSxmPXRoaXMuYS50ZXN0U3RyaW5nc3x8e30sZz1uZXcgQztiPTA7Zm9yKGM9ZC5sZW5ndGg7YjxjO2IrKylBKHRoaXMuYyxkW2JdLEQoZykpO3ZhciBrPVtdO2I9MDtmb3IoYz1lLmxlbmd0aDtiPGM7YisrKWlmKGQ9ZVtiXS5zcGxpdChcIjpcIiksZFsxXSlmb3IodmFyIGg9ZFsxXS5zcGxpdChcIixcIiksbT0wO208aC5sZW5ndGg7bSs9MSlrLnB1c2gobmV3IEgoZFswXSxoW21dKSk7ZWxzZSBrLnB1c2gobmV3IEgoZFswXSkpO0YoZyxmdW5jdGlvbigpe2EoayxmKX0pfTtmdW5jdGlvbiB2YShhLGIsYyl7YT90aGlzLmM9YTp0aGlzLmM9Yit3YTt0aGlzLmE9W107dGhpcy5mPVtdO3RoaXMuZz1jfHxcIlwifXZhciB3YT1cIi8vZm9udHMuZ29vZ2xlYXBpcy5jb20vY3NzXCI7ZnVuY3Rpb24geGEoYSxiKXtmb3IodmFyIGM9Yi5sZW5ndGgsZD0wO2Q8YztkKyspe3ZhciBlPWJbZF0uc3BsaXQoXCI6XCIpOzM9PWUubGVuZ3RoJiZhLmYucHVzaChlLnBvcCgpKTt2YXIgZj1cIlwiOzI9PWUubGVuZ3RoJiZcIlwiIT1lWzFdJiYoZj1cIjpcIik7YS5hLnB1c2goZS5qb2luKGYpKX19XG4gIGZ1bmN0aW9uIHlhKGEpe2lmKDA9PWEuYS5sZW5ndGgpdGhyb3cgRXJyb3IoXCJObyBmb250cyB0byBsb2FkIVwiKTtpZigtMSE9YS5jLmluZGV4T2YoXCJraXQ9XCIpKXJldHVybiBhLmM7Zm9yKHZhciBiPWEuYS5sZW5ndGgsYz1bXSxkPTA7ZDxiO2QrKyljLnB1c2goYS5hW2RdLnJlcGxhY2UoLyAvZyxcIitcIikpO2I9YS5jK1wiP2ZhbWlseT1cIitjLmpvaW4oXCIlN0NcIik7MDxhLmYubGVuZ3RoJiYoYis9XCImc3Vic2V0PVwiK2EuZi5qb2luKFwiLFwiKSk7MDxhLmcubGVuZ3RoJiYoYis9XCImdGV4dD1cIitlbmNvZGVVUklDb21wb25lbnQoYS5nKSk7cmV0dXJuIGJ9O2Z1bmN0aW9uIHphKGEpe3RoaXMuZj1hO3RoaXMuYT1bXTt0aGlzLmM9e319XG4gIHZhciBBYT17bGF0aW46XCJCRVNic3d5XCIsXCJsYXRpbi1leHRcIjpcIlxcdTAwZTdcXHUwMGY2XFx1MDBmY1xcdTAxMWZcXHUwMTVmXCIsY3lyaWxsaWM6XCJcXHUwNDM5XFx1MDQ0ZlxcdTA0MTZcIixncmVlazpcIlxcdTAzYjFcXHUwM2IyXFx1MDNhM1wiLGtobWVyOlwiXFx1MTc4MFxcdTE3ODFcXHUxNzgyXCIsSGFudW1hbjpcIlxcdTE3ODBcXHUxNzgxXFx1MTc4MlwifSxCYT17dGhpbjpcIjFcIixleHRyYWxpZ2h0OlwiMlwiLFwiZXh0cmEtbGlnaHRcIjpcIjJcIix1bHRyYWxpZ2h0OlwiMlwiLFwidWx0cmEtbGlnaHRcIjpcIjJcIixsaWdodDpcIjNcIixyZWd1bGFyOlwiNFwiLGJvb2s6XCI0XCIsbWVkaXVtOlwiNVwiLFwic2VtaS1ib2xkXCI6XCI2XCIsc2VtaWJvbGQ6XCI2XCIsXCJkZW1pLWJvbGRcIjpcIjZcIixkZW1pYm9sZDpcIjZcIixib2xkOlwiN1wiLFwiZXh0cmEtYm9sZFwiOlwiOFwiLGV4dHJhYm9sZDpcIjhcIixcInVsdHJhLWJvbGRcIjpcIjhcIix1bHRyYWJvbGQ6XCI4XCIsYmxhY2s6XCI5XCIsaGVhdnk6XCI5XCIsbDpcIjNcIixyOlwiNFwiLGI6XCI3XCJ9LENhPXtpOlwiaVwiLGl0YWxpYzpcImlcIixuOlwiblwiLG5vcm1hbDpcIm5cIn0sXG4gICAgRGE9L14odGhpbnwoPzooPzpleHRyYXx1bHRyYSktPyk/bGlnaHR8cmVndWxhcnxib29rfG1lZGl1bXwoPzooPzpzZW1pfGRlbWl8ZXh0cmF8dWx0cmEpLT8pP2JvbGR8YmxhY2t8aGVhdnl8bHxyfGJ8WzEtOV0wMCk/KG58aXxub3JtYWx8aXRhbGljKT8kLztcbiAgZnVuY3Rpb24gRWEoYSl7Zm9yKHZhciBiPWEuZi5sZW5ndGgsYz0wO2M8YjtjKyspe3ZhciBkPWEuZltjXS5zcGxpdChcIjpcIiksZT1kWzBdLnJlcGxhY2UoL1xcKy9nLFwiIFwiKSxmPVtcIm40XCJdO2lmKDI8PWQubGVuZ3RoKXt2YXIgZzt2YXIgaz1kWzFdO2c9W107aWYoaylmb3IodmFyIGs9ay5zcGxpdChcIixcIiksaD1rLmxlbmd0aCxtPTA7bTxoO20rKyl7dmFyIGw7bD1rW21dO2lmKGwubWF0Y2goL15bXFx3LV0rJC8pKXt2YXIgbj1EYS5leGVjKGwudG9Mb3dlckNhc2UoKSk7aWYobnVsbD09bilsPVwiXCI7ZWxzZXtsPW5bMl07bD1udWxsPT1sfHxcIlwiPT1sP1wiblwiOkNhW2xdO249blsxXTtpZihudWxsPT1ufHxcIlwiPT1uKW49XCI0XCI7ZWxzZSB2YXIgcj1CYVtuXSxuPXI/cjppc05hTihuKT9cIjRcIjpuLnN1YnN0cigwLDEpO2w9W2wsbl0uam9pbihcIlwiKX19ZWxzZSBsPVwiXCI7bCYmZy5wdXNoKGwpfTA8Zy5sZW5ndGgmJihmPWcpOzM9PWQubGVuZ3RoJiYoZD1kWzJdLGc9W10sZD1kP2Quc3BsaXQoXCIsXCIpOlxuICAgIGcsMDxkLmxlbmd0aCYmKGQ9QWFbZFswXV0pJiYoYS5jW2VdPWQpKX1hLmNbZV18fChkPUFhW2VdKSYmKGEuY1tlXT1kKTtmb3IoZD0wO2Q8Zi5sZW5ndGg7ZCs9MSlhLmEucHVzaChuZXcgSChlLGZbZF0pKX19O2Z1bmN0aW9uIEZhKGEsYil7dGhpcy5jPWE7dGhpcy5hPWJ9dmFyIEdhPXtBcmltbzohMCxDb3VzaW5lOiEwLFRpbm9zOiEwfTtGYS5wcm90b3R5cGUubG9hZD1mdW5jdGlvbihhKXt2YXIgYj1uZXcgQyxjPXRoaXMuYyxkPW5ldyB2YSh0aGlzLmEuYXBpLHooYyksdGhpcy5hLnRleHQpLGU9dGhpcy5hLmZhbWlsaWVzO3hhKGQsZSk7dmFyIGY9bmV3IHphKGUpO0VhKGYpO0EoYyx5YShkKSxEKGIpKTtGKGIsZnVuY3Rpb24oKXthKGYuYSxmLmMsR2EpfSl9O2Z1bmN0aW9uIEhhKGEsYil7dGhpcy5jPWE7dGhpcy5hPWJ9SGEucHJvdG90eXBlLmxvYWQ9ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5hLmlkLGM9dGhpcy5jLm07Yj9CKHRoaXMuYywodGhpcy5hLmFwaXx8XCJodHRwczovL3VzZS50eXBla2l0Lm5ldFwiKStcIi9cIitiK1wiLmpzXCIsZnVuY3Rpb24oYil7aWYoYilhKFtdKTtlbHNlIGlmKGMuVHlwZWtpdCYmYy5UeXBla2l0LmNvbmZpZyYmYy5UeXBla2l0LmNvbmZpZy5mbil7Yj1jLlR5cGVraXQuY29uZmlnLmZuO2Zvcih2YXIgZT1bXSxmPTA7ZjxiLmxlbmd0aDtmKz0yKWZvcih2YXIgZz1iW2ZdLGs9YltmKzFdLGg9MDtoPGsubGVuZ3RoO2grKyllLnB1c2gobmV3IEgoZyxrW2hdKSk7dHJ5e2MuVHlwZWtpdC5sb2FkKHtldmVudHM6ITEsY2xhc3NlczohMSxhc3luYzohMH0pfWNhdGNoKG0pe31hKGUpfX0sMkUzKTphKFtdKX07ZnVuY3Rpb24gSWEoYSxiKXt0aGlzLmM9YTt0aGlzLmY9Yjt0aGlzLmE9W119SWEucHJvdG90eXBlLmxvYWQ9ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5mLmlkLGM9dGhpcy5jLm0sZD10aGlzO2I/KGMuX193ZWJmb250Zm9udGRlY2ttb2R1bGVfX3x8KGMuX193ZWJmb250Zm9udGRlY2ttb2R1bGVfXz17fSksYy5fX3dlYmZvbnRmb250ZGVja21vZHVsZV9fW2JdPWZ1bmN0aW9uKGIsYyl7Zm9yKHZhciBnPTAsaz1jLmZvbnRzLmxlbmd0aDtnPGs7KytnKXt2YXIgaD1jLmZvbnRzW2ddO2QuYS5wdXNoKG5ldyBIKGgubmFtZSxnYShcImZvbnQtd2VpZ2h0OlwiK2gud2VpZ2h0K1wiO2ZvbnQtc3R5bGU6XCIraC5zdHlsZSkpKX1hKGQuYSl9LEIodGhpcy5jLHoodGhpcy5jKSsodGhpcy5mLmFwaXx8XCIvL2YuZm9udGRlY2suY29tL3MvY3NzL2pzL1wiKStlYSh0aGlzLmMpK1wiL1wiK2IrXCIuanNcIixmdW5jdGlvbihiKXtiJiZhKFtdKX0pKTphKFtdKX07dmFyIFk9bmV3IHBhKHdpbmRvdyk7WS5hLmMuY3VzdG9tPWZ1bmN0aW9uKGEsYil7cmV0dXJuIG5ldyB1YShiLGEpfTtZLmEuYy5mb250ZGVjaz1mdW5jdGlvbihhLGIpe3JldHVybiBuZXcgSWEoYixhKX07WS5hLmMubW9ub3R5cGU9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gbmV3IHNhKGIsYSl9O1kuYS5jLnR5cGVraXQ9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gbmV3IEhhKGIsYSl9O1kuYS5jLmdvb2dsZT1mdW5jdGlvbihhLGIpe3JldHVybiBuZXcgRmEoYixhKX07dmFyIFo9e2xvYWQ6cChZLmxvYWQsWSl9O1wiZnVuY3Rpb25cIj09PXR5cGVvZiBkZWZpbmUmJmRlZmluZS5hbWQ/ZGVmaW5lKGZ1bmN0aW9uKCl7cmV0dXJuIFp9KTpcInVuZGVmaW5lZFwiIT09dHlwZW9mIG1vZHVsZSYmbW9kdWxlLmV4cG9ydHM/bW9kdWxlLmV4cG9ydHM9Wjood2luZG93LldlYkZvbnQ9Wix3aW5kb3cuV2ViRm9udENvbmZpZyYmWS5sb2FkKHdpbmRvdy5XZWJGb250Q29uZmlnKSk7fSgpKTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBwbHVnaW5zL3dlYmZvbnQuanMiLCJcbi8qXG5leHBvcnQgaW50ZXJmYWNlIEdhbGxlcnlEYXRhIDoge1xuIHRhcmdldDogZmFicmljanMgb2JqZWN0XG59XG4qL1xuXG5cbmZhYnJpYy5BcHBsaWNhdGlvbi5wcm90b3R5cGUuc2V0RWxlbWVudEZyb21NZW51ID0gZnVuY3Rpb24gKHNlbGVjdGVkRGF0YSkge1xuICB0aGlzLmNhbnZhcy5jcmVhdGVJbWFnZU9iamVjdChzZWxlY3RlZERhdGEuaW1hZ2UsIHRoaXMudXBsb2FkQ2xhc3MpO1xufTtcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuQXBwbGljYXRpb24ucHJvdG90eXBlLCB7XG4gIGRyYWdnYWJsZUFyZWE6IFwiLmZmLWNvbnRhaW5lclwiLFxuICAvKmNyZWF0ZUdhbGxlcnk6IGZ1bmN0aW9uICh0YXJnZXQsICRlbCwgb3B0aW9ucykge1xuICAgIGlmICgkZWwuY29uc3RydWN0b3IgPT09IFN0cmluZykge1xuICAgICAgJGVsID0gJChcIiNcIiArICRlbCk7XG4gICAgfVxuICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuXG4gICAgaWYgKHRhcmdldC5nYWxsZXJ5Q2F0ZWdvcnkpIHtcbiAgICAgIG9wdGlvbnMuY2F0ZWdvcnkgPSB0YXJnZXQuZ2FsbGVyeUNhdGVnb3J5O1xuICAgIH1cblxuICAgICRlbC5lbXB0eSgpO1xuICAgIHZhciBsaWJyYXJ5ID0gdGhpcy5nZXRMaWJyYXJ5RWxlbWVudHMob3B0aW9ucyk7XG5cblxuICAgIHRoaXMuY3JlYXRlRWxlbWVudHNMaXN0KCRlbCwgbGlicmFyeSk7XG5cbiAgICBfLmVhY2gobGlicmFyeSwgZnVuY3Rpb24gKGxpYnJhcnlJdGVtKSB7XG4gICAgICB2YXIgaW1nID0gbmV3IEltYWdlKCk7XG4gICAgICBpbWcuc3JjID0gZmFicmljLnV0aWwubWVkaWFSb290ICsgbGlicmFyeUl0ZW0uc3JjO1xuXG4gICAgICB2YXIgJGltZyA9ICQoaW1nKS53aWR0aCgxMDApLmhlaWdodCgxMDApXG4gICAgICAgIC5jbGljayhmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICB2YXIgc2VsZWN0ZWREYXRhID0ge1xuICAgICAgICAgICAgaW1hZ2U6IGltZyxcbiAgICAgICAgICAgIGRhdGE6IGxpYnJhcnlJdGVtLFxuICAgICAgICAgICAgb3B0aW9uczogb3B0aW9uc1xuICAgICAgICAgIH07XG4gICAgICAgICAgdGFyZ2V0LnNldEVsZW1lbnRGcm9tTWVudShzZWxlY3RlZERhdGEpO1xuICAgICAgICB9KTtcblxuICAgICAgJGVsLmFwcGVuZCgkaW1nKTtcbiAgICB9KTtcbiAgfSwqL1xuICBnZXRGb250c0xpYnJhcnk6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gXy5tYXAodGhpcy5fZm9udHMsZnVuY3Rpb24oZm9udE5hbWUpe1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZm9udEZhbWlseTogZm9udE5hbWUsXG4gICAgICAgIGZvbnRTaXplOiAyNSxcbiAgICAgICAgY2F0ZWdvcnk6IFwiZm9udEZhbWlseVwiLFxuICAgICAgICB0ZXh0OiBmb250TmFtZSxcbiAgICAgICAgdHlwZTogXCJ0ZXh0XCJcbiAgICAgIH1cbiAgICB9KVxuICB9LFxuICBfYWRkQ2FudmFzRWw6IGZ1bmN0aW9uIChlbCwgZWxlbWVudCwgaW5uZXJFbCl7XG5cbiAgICAvLyBlbGVtZW50ID0gZmFicmljLnV0aWwub2JqZWN0LmNsb25lRGVlcChlbGVtZW50KTtcblxuICAgIHZhciBjYW52YXNFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIik7XG4gICAgaW5uZXJFbC53aWR0aCA9IGNhbnZhc0VsLndpZHRoID0gdGhpcy5nYWxsZXJ5LmltYWdlV2lkdGg7XG4gICAgaW5uZXJFbC5oZWlnaHQgPSBjYW52YXNFbC5oZWlnaHQgPSB0aGlzLmdhbGxlcnkuaW1hZ2VIZWlnaHQ7XG5cblxuXG4gICAgdmFyIF9mYWtlX2NhbnZhcyA9IG5ldyBmYWJyaWMuU3RhdGljQ2FudmFzKGNhbnZhc0VsLHthcHBsaWNhdGlvbjogdGhpc30pO1xuICAgIF9mYWtlX2NhbnZhcy5jbGVhcigpO1xuXG4gICAgZWxlbWVudC5wb3NpdGlvbiA9IFwiY2VudGVyXCI7XG5cbiAgICBfZmFrZV9jYW52YXMuY3JlYXRlT2JqZWN0KGVsZW1lbnQsZnVuY3Rpb24oX29iamVjdCl7XG4gICAgICB2YXIgYiA9IF9vYmplY3QuZ2V0Qm91bmRpbmdSZWN0KCk7XG4gICAgIC8qIF9vYmplY3Quc2V0KHtcbiAgICAgICAgbGVmdCA6IDgwIC0gYi53aWR0aC8yIC0gX29iamVjdC5zdHJva2VXaWR0aCAqIDIsXG4gICAgICAgIHRvcCA6IDQ1IC0gYi5oZWlnaHQvMiAtIF9vYmplY3Quc3Ryb2tlV2lkdGggKiAyXG4gICAgICB9KTsqL1xuXG4gICAgICBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGVsZW1lbnQse1xuICAgICAgICBzY2FsZVg6IF9vYmplY3Quc2NhbGVYLFxuICAgICAgICBzY2FsZVk6IF9vYmplY3Quc2NhbGVZLFxuICAgICAgICB3aWR0aDogX29iamVjdC53aWR0aCxcbiAgICAgICAgaGVpZ2h0OiBfb2JqZWN0LmhlaWdodCxcbiAgICAgICAgbGVmdDogX29iamVjdC5sZWZ0LFxuICAgICAgICB0b3A6IF9vYmplY3QudG9wLFxuICAgICAgICBzdHJva2VXaWR0aDogX29iamVjdC5zdHJva2VXaWR0aFxuICAgICAgfSk7XG5cbiAgICAgIGRlbGV0ZSBlbGVtZW50LnBvc2l0aW9uO1xuXG4gICAgICBfZmFrZV9jYW52YXMuYWRkKF9vYmplY3QpO1xuICAgICAgX2Zha2VfY2FudmFzLnJlbmRlckFsbCgpO1xuXG4gICAgICBpbm5lckVsLnNyYyA9IGNhbnZhc0VsLnRvRGF0YVVSTCgpO1xuXG4gICAgICBkZWxldGUgX29iamVjdC5jYW52YXM7XG4gICAgICBlbFswXS5kYXRhID0gZWxlbWVudDtcbiAgICAgIGVsWzBdLmVsZW1lbnQgPSBfb2JqZWN0O1xuXG4gICAgfSk7XG4gIH0sXG4gIHVwZGF0ZUVsZW1lbnRzTGlzdDogZnVuY3Rpb24gKCRlbCwgbGlicmFyeSwgb3B0aW9ucykge1xuXG4gICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgZm9yICh2YXIgaSBpbiBsaWJyYXJ5KSB7XG4gICAgICB2YXIgZWxlbWVudCA9IGxpYnJhcnlbaV07XG4gICAgICB2YXIgZWwgPSAkKFwiPHNwYW4+XCIpXG4gICAgICAgIC5hZGRDbGFzcyhcImxpc3QtaXRlbVwiKTtcblxuICAgICAgZWxbMF0uZGF0YSA9IGVsZW1lbnQ7XG5cbiAgICAgIGlmIChvcHRpb25zLmVsZW1lbnQpIHtcbiAgICAgICAgZWxlbWVudCA9IG9wdGlvbnMuZWxlbWVudChlbGVtZW50KTtcbiAgICAgIH1cblxuICAgICAgaWYgKGVsZW1lbnQudGl0bGUpIHtcbiAgICAgICAgdmFyICRzcGFuID0gJChcIjxzcGFuPlwiKS50ZXh0KGVsZW1lbnQudGl0bGUpLmFkZENsYXNzKFwiZWxlbWVudC10aXRsZVwiKTtcbiAgICAgICAgZWwuYXBwZW5kKCRzcGFuKTtcbiAgICAgIH1cbiAgICAgIHZhciAkaW5uZXJFbCA9IG51bGw7XG5cbiAgICAgIGlmIChvcHRpb25zLnJlbmRlcikge1xuICAgICAgICAkaW5uZXJFbCA9IG9wdGlvbnMucmVuZGVyKGVsZW1lbnQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKGVsZW1lbnQuY2F0ZWdvcnkgPT0gXCJmb250RmFtaWx5XCIpIHtcbiAgICAgICAgICAkaW5uZXJFbCA9ICQoXCI8c3Bhbj5cIikuY3NzKHtcbiAgICAgICAgICAgIFwiY29sb3JcIjogZWxlbWVudC5maWxsIHx8IGZhYnJpYy5UZXh0LnByb3RvdHlwZS5maWxsLFxuICAgICAgICAgICAgXCJmb250LWZhbWlseVwiOiBlbGVtZW50LmZvbnRGYW1pbHksXG4gICAgICAgICAgICBcImZvbnQtc2l6ZVwiOiBlbGVtZW50LmZvbnRTaXplXG4gICAgICAgICAgfSkudGV4dChlbGVtZW50LnRleHQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHN3aXRjaCAoZWxlbWVudC50eXBlKSB7XG4gICAgICAgICAgICBjYXNlIFwiaW1hZ2VcIjpcbiAgICAgICAgICAgICAgJGlubmVyRWwgPSAkKFwiPGltZz5cIikuYXR0cih7XG4gICAgICAgICAgICAgICAgc3JjOiBmYWJyaWMudXRpbC5tZWRpYVJvb3QgKyBlbGVtZW50LnNyY1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgZWxbMF0uZWxlbWVudCA9ICRpbm5lckVsWzBdO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJ2aWRlb1wiOlxuICAgICAgICAgICAgICAkaW5uZXJFbCA9ICQoXCI8dmlkZW8+XCIpO1xuICAgICAgICAgICAgICBmb3IgKHZhciB0eXBlIGluIGVsZW1lbnQuc3JjKSB7XG4gICAgICAgICAgICAgICAgJGlubmVyRWwuYXBwZW5kKCQoXCI8c291cmNlPlwiKS5hdHRyKHtcbiAgICAgICAgICAgICAgICAgIHNyYzogZmFicmljLnV0aWwubWVkaWFSb290ICsgZWxlbWVudC5zcmNbdHlwZV0sXG4gICAgICAgICAgICAgICAgICB0eXBlOiB0eXBlXG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGVsWzBdLmVsZW1lbnQgPSAkaW5uZXJFbFswXTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAkaW5uZXJFbCA9ICQoXCI8aW1nPlwiKTtcbiAgICAgICAgICAgICAgdGhpcy5fYWRkQ2FudmFzRWwoZWwsIGVsZW1lbnQsICRpbm5lckVsWzBdKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmICgkaW5uZXJFbC5jb25zdHJ1Y3RvciA9PSBBcnJheSkge1xuICAgICAgICB2YXIgX3NwYW4gPSAkKFwiPHNwYW4+XCIpO1xuICAgICAgICBfc3Bhbi5hcHBlbmQoJGlubmVyRWwpO1xuICAgICAgICAkaW5uZXJFbCA9IF9zcGFuO1xuICAgICAgfVxuICAgICAgZWwuYXBwZW5kKCRpbm5lckVsKTtcblxuXG4gICAgICBpZiAob3B0aW9ucy5kcmFnZ2FibGUpIHtcbiAgICAgICAgJGlubmVyRWwuZHJhZ2dhYmxlKHtcbiAgICAgICAgICBkcmFnZ2FibGU6IFwiaGVscGVyXCIsXG4gICAgICAgICAgZHJvcHBhYmxlOiBcIi5jYW52YXMtY29udGFpbmVyXCIsXG4gICAgICAgICAgbmdNb2RlbDogZWxlbWVudCxcbiAgICAgICAgICBvbk1vdmU6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBhcHAuY2FudmFzLl9vbkRyYWdNb3ZlICYmIGFwcC5jYW52YXMuX29uRHJhZ01vdmUoZGF0YS4kZXZlbnQpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgb25Ecm9wOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgYXBwLmNhbnZhcy5fb25Ecm9wKGRhdGEuJGV2ZW50KTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGRyYWdnYWJsZUFyZWE6IGFwcC5kcmFnZ2FibGVBcmVhXG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgICAkaW5uZXJFbC5jbGljayhvcHRpb25zLmFjdGl2YXRlLmJpbmQodGhpcywgZWxbMF0pKTtcbiAgICAgICRlbC5hcHBlbmQoZWwpO1xuICAgIH1cbiAgfSxcbiAgY3JlYXRlRWxlbWVudHNMaXN0OiBmdW5jdGlvbiAoJGVsLCBsaWJyYXJ5LCBvcHRpb25zKSB7XG4gICAgb3B0aW9ucyA9IGZhYnJpYy51dGlsLm9iamVjdC5kZWZhdWx0cyhvcHRpb25zIHx8IHt9LCB7XG4gICAgICBkcmFnZ2FibGU6IHRydWUsXG4gICAgICBhY3RpdmF0ZTogZnVuY3Rpb24gKGVsKSB7XG4gICAgICAgIHZhciBkYXRhID0gZmFicmljLnV0aWwub2JqZWN0LmNsb25lKGVsLmRhdGEpO1xuICAgICAgICBkZWxldGUgZGF0YS5sZWZ0O1xuICAgICAgICBkZWxldGUgZGF0YS50b3A7XG5cbiAgICAgICAgaWYgKHRoaXMuY2FudmFzLnRhcmdldCAmJiB0aGlzLmNhbnZhcy50YXJnZXQuc2V0RGF0YSkge1xuICAgICAgICAgIHRoaXMuY2FudmFzLnRhcmdldC5zZXREYXRhKGRhdGEpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMuY2FudmFzLnNldERhdGEoZGF0YSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgICB0aGlzLnVwZGF0ZUVsZW1lbnRzTGlzdCgkZWwsIGxpYnJhcnksIG9wdGlvbnMpO1xuICB9XG59KTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvbW9kdWxlcy9nYWxsZXJ5LmpzIiwiJ3VzZSBzdHJpY3QnO1xuXG5mYWJyaWMub2JqZWN0c0xpYnJhcnkgPSB7XG4gIHRleHQ6IHtcbiAgICB0aXRsZTogXCJUZXh0XCIsXG4gICAgdHlwZTogXCJpLXRleHRcIixcbiAgICB0ZXh0OiBcItCi0LXQutGB0YJcIlxuICB9LFxuICBsaW5lOiB7XG4gICAgdHlwZTogXCJsaW5lXCIsXG4gICAgc3Ryb2tlV2lkdGg6IDUsXG4gICAgc3Ryb2tlOiBcImJsYWNrXCIsXG4gICAgc2NhbGVYOiAxLFxuICAgIHNjYWxlWTogMSxcbiAgICB4MTogMCxcbiAgICB4MjogMTAwLFxuICAgIHkxOiAwLFxuICAgIHkyOiA1MFxuICB9LFxuICB0cmlhbmdsZToge1xuICAgIHR5cGU6IFwidHJpYW5nbGVcIixcbiAgICB3aWR0aDogZnVuY3Rpb24odyxoKXsgcmV0dXJuIE1hdGgubWluKHcsaCkgLSA0fSxcbiAgICBoZWlnaHQ6IGZ1bmN0aW9uKHcsaCl7IHJldHVybiBNYXRoLm1pbih3LGgpIC0gNH1cbiAgfSxcbiAgcmVjdGFuZ2xlOiB7XG4gICAgdHlwZTogXCJyZWN0XCIsXG4gICAgd2lkdGg6IGZ1bmN0aW9uKHcsaCl7IHJldHVybiBNYXRoLm1pbih3LGgpIC0gNH0sXG4gICAgaGVpZ2h0OiBmdW5jdGlvbih3LGgpeyByZXR1cm4gTWF0aC5taW4odyxoKSAtIDR9XG4gIH0sXG4gIHBvbHlnb246IHtcbiAgICBzY2FsZVg6IDEsXG4gICAgc2NhbGVZOiAxLFxuICAgIHR5cGU6IFwicG9seWdvblwiLFxuICAgIHBvaW50czogZnVuY3Rpb24odyxoKSB7XG4gICAgICByZXR1cm4gW1xuICAgICAgICB7eDogMjUsIHk6IDF9LFxuICAgICAgICB7eDogMzEsIHk6IDE4fSxcbiAgICAgICAge3g6IDQ5LCB5OiAxOH0sXG4gICAgICAgIHt4OiAzNSwgeTogMjl9LFxuICAgICAgICB7eDogNDAsIHk6IDQ2fSxcbiAgICAgICAge3g6IDI1LCB5OiAzNn0sXG4gICAgICAgIHt4OiAxMCwgeTogNDZ9LFxuICAgICAgICB7eDogMTUsIHk6IDI5fSxcbiAgICAgICAge3g6ICAxLCB5OiAxOH0sXG4gICAgICAgIHt4OiAxOSwgeTogMTh9XG4gICAgICBdO1xuICAgIH1cbiAgfSxcbiAgcGF0aDoge1xuICAgIFwidHlwZVwiOiBcInBhdGhcIixcbiAgICBcInBhdGhcIjogIFwibTU4MS4wNzc5NDIsMi41MzczNTljLTIuMDUzMjIzLDAuMDQ3MDcxIC00LjA0MDcxLDAuMTg4MzQ4IC02LjEwODA5MywwLjM1MjkwN2MtMzMuMDU1NDIsMi42NjM5MTggLTYyLjIzNTkwMSwxOS42NDA1NDEgLTc3LjA1NzY3OCw0NC45MjU5NTNsLTcuODU3MywxOS4xMzUzMTljMS42OTg4MjIsLTYuNjMzMTQ0IDQuMzAyOTc5LC0xMy4wNjUzODQgNy44NTczLC0xOS4xMzUzMTljLTI2LjQzMDY5NSwtMjIuMTYyOTMgLTYzLjUzMTY3NywtMzIuMzg4NDQ1IC0xMDAuMTkyMzgzLC0yNy41NzQzNzNjLTM2LjY2MTQ2OSw0Ljc4ODM1MyAtNjguNTAzMDgyLDI0LjA0MTc1OCAtODUuOTAxOTc4LDUxLjkzNTIyNWMtNDkuMTE2NDg2LC0yNC40OTAwMTMgLTExMC4zNDI4OCwtMjIuOTk5NDU0IC0xNTcuNzExODA3LDMuODYwMDkyYy00Ny4zNjkxNjQsMjYuODYwNjggLTcyLjYxNjczLDc0LjQwNTUxIC02NC45NDExNjIsMTIyLjM4MzA4bDUuMDIxMzU1LDE5LjQ5OTY4Yy0yLjI2MzMyOSwtNi4zODUwMSAtMy45NjA3OTMsLTEyLjg4NzY5NSAtNS4wMjEzNTUsLTE5LjQ5OTY4bC0wLjc2MTk0OCwxLjc5ODU2OWMtNDEuMTc5MTY1LDMuNjI1MjQ0IC03NC45NDUzNzUsMjkuNDY1MTM0IC04My43MTYzOTgsNjQuMDU5MjM1Yy04Ljc3MTgwNSwzNC41OTc3NDggOS40NjcwMSw3MC4wODU4NzYgNDUuMTg1NjIxLDg3Ljk2NzAxbDU1Ljc3NjU1OCwxMC45NzMxMTRjLTE5LjQ4MDIxNywxLjI5MTk2MiAtMzguOTE1NTQzLC0yLjUzNDUxNSAtNTUuNzc2NTU4LC0xMC45NzMxMTRjLTI3LjU0NzgsMjQuOTY4MTcgLTMzLjg4ODUxNiw2MS45MzUzMDMgLTE1LjcxNDkyLDkyLjQ2NzgzNGMxOC4xNzM3MzMsMzAuNTI0NzE5IDU2Ljk4ODg5OSw0OC4xMTA2ODcgOTcuMDMwNDU3LDQ0LjExNzM0bDI0LjMzOTcyMiwtNS4yMTEwOWMtNy44Mjc0OTksMi42NTE2MTEgLTE1Ljk2MDk4Myw0LjM3OTA1OSAtMjQuMzM5NzIyLDUuMjExMDljMjIuNzMwMDQyLDMzLjg1NzI2OSA2MC40MjgxOTIsNTguNTU2MjQ0IDEwNC42Njg5Myw2OC4zODM1MTRjNDQuMjQ5MSw5LjgxMzY2IDkxLjI0MDk1Miw0LjAxNDc3MSAxMzAuNDI1OTQ5LC0xNi4wOTQ2MDRjMzEuOTY3MDEsNDAuNzkzODIzIDg4LjcwNzY0Miw2Mi4yMTc0NjggMTQ1LjU5NjMxMyw1NC45OTcwN2M1Ni45MDI0NjYsLTcuMjE5NjY2IDEwMy44MzM5ODQsLTQxLjgxNDI3IDEyMC41MDEzNDMsLTg4Ljc3MDk5Nmw1Ljc4MTQzMywtMjYuMjM5NTMyYy0wLjg2MzcwOCw4LjkwOTU0NiAtMi43NDIyNDksMTcuNjgxMzY2IC01Ljc4MTQzMywyNi4yMzk1MzJjMzkuMTMzMzAxLDIwLjc1MzY2MiA4OC4zNTMzMzMsMjEuOTI3MzA3IDEyOC43ODUwOTUsMy4wNDkzMTZjNDAuNDM5ODE5LC0xOC44NzQwODQgNjUuNjY1NzcxLC01NC44NjkwNDkgNjYuMDM2MTMzLC05NC4wNzgyNDdsLTE0LjQ5NTYwNSwtNTguNTgwNTk3bC01Ny4xMDU3MTMsLTM5LjYzMDc2OGM0NC4xNjM0NTIsMjIuMzc0NTczIDcxLjk5MjYxNSw1Ni40NjcyNTUgNzEuNjAxMzE4LDk4LjIxMTM2NWM1Mi40OTcwNywwLjQ0ODE4MSA5Ny4xMDMzOTQsLTM1Ljk1NjU3MyAxMTcuMTEyNDI3LC03Ny43MjYyODhjMjAuMDExNTk3LC00MS43Njk4MzYgMTIuNDQzNjA0LC04OS4zOTY3NTkgLTE5Ljg2NDkyOSwtMTI1LjE2NDY0MmMxMy40MDExODQsLTI2LjYzNzY5NSAxMi42MDk5ODUsLTU2LjkzNzMzMiAtMi4xODM0NzIsLTgzLjAzNDA4OGMtMTQuNzg2MTk0LC0yNi4wOTc4OTMgLTQyLjA2NTQ5MSwtNDUuNDc2ODkxIC03NC44NzMwNDcsLTUzLjA5ODMzNWMtNy4zNDE0MzEsLTM0LjU4MDkyOSAtMzcuNjAyNjYxLC02Mi40MDQ0ODIgLTc3LjYwMDcwOCwtNzEuNTI2MjkzYy0zOS45OTg0NzQsLTkuMTIxMzY4IC04Mi41ODQ4MzksMi4xMjM5OTIgLTEwOS4zNjQ4MDcsMjguOTI2MTIzbC0xNi4yNTgxNzksMjIuMTk4MTdjNC4xNTc5NTksLTguMDE4NjEyIDkuNTgzOTIzLC0xNS40OTUyMTMgMTYuMjU4MTc5LC0yMi4xOTgxN2MtMTguODc2OTUzLC0yMS4wNjA3MTMgLTQ4LjQ4NjAyMywtMzIuOTU0MDYxIC03OS4zNDg5MzgsLTMyLjE1NTQwMWwwLDB6XCIsXG4gICAgXCJ3aWR0aFwiOiBmdW5jdGlvbih3LGgpe3JldHVybiB3IC0gNCB9LFxuICAgIFwiaGVpZ2h0XCI6IGZ1bmN0aW9uKHcsaCl7cmV0dXJuIGggLSA0fVxuICB9LFxuICBlbGxpcHNlOiB7XG4gICAgXCJ0eXBlXCI6IFwiZWxsaXBzZVwiLFxuICAgIFwicnhcIjogZnVuY3Rpb24odyxoKXtyZXR1cm4gdyAvMiAtIDR9LFxuICAgIFwicnlcIjogZnVuY3Rpb24odyxoKXtyZXR1cm4gaC8gMiAtIDR9XG4gIH0sXG4gIGNpcmNsZToge1xuICAgIHR5cGU6IFwiY2lyY2xlXCIsXG4gICAgcmFkaXVzOiBmdW5jdGlvbih3LGgpeyByZXR1cm4gTWF0aC5taW4odyxoKS8yIC0gNH1cbiAgfVxufTtcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuQXBwbGljYXRpb24ucHJvdG90eXBlLCB7XG4gIGdldExpYnJhcnlFbGVtZW50czogZnVuY3Rpb24ob3B0aW9ucyl7XG4gICAgY29uc3QgY2F0ZWdvcnkgPSBmYWJyaWMudXRpbC5vYmplY3QuZmluZFdoZXJlKHRoaXMubGlicmFyeSx7aWQ6IG9wdGlvbnMuY2F0ZWdvcnl9KTtcbiAgICByZXR1cm4gZmFicmljLnV0aWwub2JqZWN0Lm1hcChmYWJyaWMudXRpbC5vYmplY3QuY2xvbmVEZWVwKGNhdGVnb3J5Lml0ZW1zKSxlbCA9PiBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGVsLGNhdGVnb3J5LnRlbXBsYXRlKSlcbiAgfSxcbiAgLyoqXG4gICAqXG4gICAqIEBwYXJhbSB2YWx1ZVxuICAgKiBAcGFyYW0gY2FsbGJhY2tcbiAgICpcbiAgICogQGV4YW1wbGVcbiAgIFt7XG4gICAgXCJpZFwiOiA1LFxuICAgIFwidGl0bGVcIjogXCJ2aWRlb1wiLFxuICAgIFwidGVtcGxhdGVcIjoge1xuICAgICAgXCJ0eXBlXCI6IFwidmlkZW9cIlxuICAgIH0sXG4gICAgXCJpdGVtc1wiOiBbXG4gICAgICB7XG4gICAgICAgIFwic3JjXCI6IFwidmlkZW8ubXBnXCJcbiAgICAgICAgXCJoZWlnaHRcIjogMzYwLFxuICAgICAgICBcIndpZHRoXCI6IDQ4MFxuICAgICAgfV1cbiAgICB9XVxuICAgKi9cbiAgc2V0TGlicmFyeTogZnVuY3Rpb24gKHZhbHVlLCBjYWxsYmFjaykge1xuICAgIGZhYnJpYy51dGlsLmRhdGEubG9hZEpzb24odmFsdWUsIGRhdGEgPT4ge1xuICAgICAgZGF0YS5mb3JFYWNoKGNhdGVnb3J5ID0+IHtcbiAgICAgICAgaWYoIWNhdGVnb3J5LmlkKXtcbiAgICAgICAgICBjYXRlZ29yeS5pZCA9ICsrZmFicmljLnV0aWwuX2lkQ291bnRlclxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHRoaXMubGlicmFyeSA9IGRhdGE7XG4gICAgICBjYWxsYmFjaygpO1xuICAgIH0pO1xuICB9XG59KTtcbmZhYnJpYy5BcHBsaWNhdGlvbi5wcm90b3R5cGUuY29uZmlndXJhdGlvblByb3BlcnRpZXMucHVzaChcImxpYnJhcnlcIik7XG5cbmZhYnJpYy5nZXRPYmplY3RzTGlzdCA9IGZ1bmN0aW9uKHcsaCl7XG4gIHZhciBfbGliID0gW107XG4gIGZvcih2YXIgaSBpbiB0aGlzLm9iamVjdHNMaWJyYXJ5KXtcbiAgICB2YXIgbyA9IF9saWJbaV0gPSBmYWJyaWMudXRpbC5vYmplY3QuY2xvbmVEZWVwKHRoaXMub2JqZWN0c0xpYnJhcnlbaV0pO1xuICAgIG8udGl0bGUgPSBvLnRpdGxlIHx8IG8udHlwZTtcbiAgICBpZihvLndpZHRoID09PSAwICkgby53aWR0aCA9IHc7XG4gICAgaWYoby5oZWlnaHQgPT09IDAgKSBvLmhlaWdodCA9IGg7XG4gICAgZm9yKHZhciBqIGluIG8pe1xuICAgICAgaWYob1tqXS5jb25zdHJ1Y3RvciA9PT0gRnVuY3Rpb24pe1xuICAgICAgICBvW2pdID0gb1tqXS5jYWxsKG8sdyxoKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIF9saWI7XG59O1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9tb2R1bGVzL2xpYnJhcnkuanMiLCIndXNlIHN0cmljdCc7XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLHtcbiAgZGVidWdUaW1lb3V0OiAwXG59KTtcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuQXBwbGljYXRpb24ucHJvdG90eXBlLCB7XG4gIHNldERlYnVnOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5vbihcInJlYWR5XCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuZW5hYmxlRGVidWdnaW5nKCk7XG4gICAgfSlcbiAgfSxcblxuICBlbmFibGVEZWJ1Z2dpbmc6IGZ1bmN0aW9uKCl7XG4gICAgaWYoZmFicmljLmRlYnVnKXtcblxuICAgICAgdmFyIF9vcGVyYW5kID0gXCJjb2xvcjogIzJFQzA2QzsgZm9udC1zdHlsZTogaXRhbGljO1wiO1xuICAgICAgY29uc29sZS5pbmZvKFwiZGVidWcgZW5hYmxlZC4gKHVzZSAlY2FwcCVjLCAlY3Byb2plY3QlYywgJWNjYW52YXMlYywgJWN0YXJnZXQlYyBpbiBjb25zb2xlKVwiLFxuICAgICAgICBfb3BlcmFuZCwgXCJjb2xvcjogIzIwMjAyMFwiLFxuICAgICAgICBfb3BlcmFuZCwgXCJjb2xvcjogIzIwMjAyMFwiLFxuICAgICAgICBfb3BlcmFuZCwgXCJjb2xvcjogIzIwMjAyMFwiLFxuICAgICAgICBfb3BlcmFuZCwgXCJjb2xvcjogIzIwMjAyMFwiKTtcblxuICAgICAgd2luZG93LmFwcCA9IHRoaXM7XG4gICAgICB3aW5kb3cuY2FudmFzID0gdGhpcy5jYW52YXM7XG4gICAgICB3aW5kb3cucHJvamVjdCA9IHRoaXMucHJvamVjdDtcbiAgICAgIHdpbmRvdy50YXJnZXQgPSBudWxsO1xuICAgICAgdGhpcy5jYW52YXMgJiYgdGhpcy5jYW52YXMub24oXCJ0YXJnZXQ6Y2hhbmdlZFwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHdpbmRvdy50YXJnZXQgPSB0aGlzLnRhcmdldDtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxufSk7XG5cbmZhYnJpYy5PYmplY3QucHJvdG90eXBlLmRlYnVnID0gZnVuY3Rpb24obm9Cb3JkZXJzKXtcbiAgdmFyIGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIik7XG4gIGNhbnZhcy53aWR0aCA9IG5vQm9yZGVycyA/dGhpcy53aWR0aDogdGhpcy53aWR0aCArIDI7XG4gIGNhbnZhcy5oZWlnaHQgPSBub0JvcmRlcnMgP3RoaXMuaGVpZ2h0IDogdGhpcy5oZWlnaHQgKyAyO1xuXG4gIHZhciBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgaWYoIW5vQm9yZGVycyl7XG4gICAgY3R4LmxpbmVXaWR0aD0xO1xuICAgIGN0eC5zdHJva2VTdHlsZT1cInllbGxvd1wiO1xuICAgIGN0eC5zdHJva2VSZWN0KDAsMCx0aGlzLndpZHRoICsgMix0aGlzLmhlaWdodCsgMik7XG4gICAgY3R4LnNldExpbmVEYXNoKFs0LDRdKTtcbiAgICBjdHguc3Ryb2tlU3R5bGU9XCIjMDAwMDAwXCI7XG4gICAgY3R4LnN0cm9rZVJlY3QoMCwwLHRoaXMud2lkdGggKyAyLHRoaXMuaGVpZ2h0KyAyKTtcbiAgfVxuICBjdHgudHJhbnNsYXRlKHRoaXMud2lkdGgvMiAgKyAxLHRoaXMuaGVpZ2h0LzIgKyAxKTtcbiAgdmFyIF9jbGlwVG8gPSB0aGlzLmNsaXBUbztcbiAgZGVsZXRlIHRoaXMuY2xpcFRvO1xuICB0aGlzLnJlbmRlcihjdHgsdHJ1ZSk7XG4gIHRoaXMuY2xpcFRvID0gX2NsaXBUbztcbiAgd2luZG93Lm9wZW4oY2FudmFzLnRvRGF0YVVSTCgpLFwiX2JsYW5rXCIpO1xufTtcblxuXG5mYWJyaWMuQXBwbGljYXRpb24ucHJvdG90eXBlLmxvZ0V2ZW50cyA9IGZhYnJpYy5PYmplY3QucHJvdG90eXBlLmxvZ0V2ZW50cyA9IGZ1bmN0aW9uIGV2ZW50c0xvZ2dlcihvcHRpb25zKXtcbiAgdmFyIF9jb3VudGVyID0ge307XG4gIGZvcih2YXIgaSBpbiBvcHRpb25zKXtcbiAgICBfY291bnRlcltpXSA9IDA7XG4gICAgdGhpcy5vbihvcHRpb25zW2ldLGZ1bmN0aW9uKGksIGV2ZW50KSB7XG4gICAgICBjb25zb2xlLmxvZyhpICsgXCIgXCIgKyArK19jb3VudGVyW2ldLGV2ZW50KTtcbiAgICB9LmJpbmQodGhpcyxpKSk7XG4gIH1cbn07XG5cblxuXG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL21vZHVsZXMvZGVidWcuanMiLCIndXNlIHN0cmljdCc7XG5cblxuZmFicmljLnV0aWwubWVkaWFSb290ID0gXCJcIjtcbmZhYnJpYy51dGlsLmFkZE5vQ2FjaGUgPSBmYWxzZTtcblxuZmFicmljLnV0aWwuX2xvYWRJbWFnZV9vdmVyd3JpdHRlbiA9IGZhYnJpYy51dGlsLmxvYWRJbWFnZTtcblxuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5BcHBsaWNhdGlvbi5wcm90b3R5cGUsIHtcbiAgb3B0aW9uc09yZGVyOiAoZnVuY3Rpb24oKXtcbiAgICB2YXIgb28gPSBmYWJyaWMuQXBwbGljYXRpb24ucHJvdG90eXBlLm9wdGlvbnNPcmRlcjtcbiAgICBvby5zcGxpY2Uob28uaW5kZXhPZihcImNhbnZhc0NvbnRhaW5lclwiKSwwLFwibWVkaWFSb290XCIpO1xuICAgIHJldHVybiBvbztcbiAgfSkoKSxcbiAgc2V0TWVkaWFSb290OiBmdW5jdGlvbiAoX21lZGlhUm9vdCkge1xuICAgIGlmIChfbWVkaWFSb290KSB7XG4gICAgICB2YXIgX2Rpcm5hbWU7XG4gICAgICBpZiAoZmFicmljLmlzTGlrZWx5Tm9kZSkge1xuICAgICAgICBfZGlybmFtZSA9IF9fZGlybmFtZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIF9kaXJuYW1lID0gZmFicmljLnV0aWwucGF0aC5nZXRQYXJlbnREaXJlY3RvcnlVcmwod2luZG93LmxvY2F0aW9uLmhyZWYpO1xuICAgICAgfVxuXG4gICAgLy8gIGlmICgoX21lZGlhUm9vdC5pbmRleE9mKFwiLi9cIikgPT0gMCkpIHtcbiAgICAvLyAgfVxuICAgICAgdmFyIF9sYXN0ID0gX21lZGlhUm9vdFtfbWVkaWFSb290Lmxlbmd0aCAtIDFdO1xuICAgICAgaWYgKF9sYXN0ICE9IFwiL1wiICYmIF9sYXN0ICE9IFwiXFxcXFwiKSB7XG4gICAgICAgIF9tZWRpYVJvb3QgKz0gXCIvXCJcbiAgICAgIH1cbiAgICAgIF9tZWRpYVJvb3QgPSBmYWJyaWMudXRpbC5wYXRoLnJlc29sdmUoX2Rpcm5hbWUgKyBfbWVkaWFSb290KTtcbiAgICAgIGZhYnJpYy51dGlsLm1lZGlhUm9vdCA9IF9tZWRpYVJvb3Q7XG4gICAgfVxuICB9XG59KTtcblxuXG5cblxuLy8gaWYoIWZhYnJpYy5pc0xpa2VseU5vZGUpe1xuLy9cbi8vICAgdmFyIFVSTCA9IHJlcXVpcmUoJ3VybCcpLFxuLy8gICAgIEhUVFAgPSByZXF1aXJlKCdodHRwJyksXG4vLyAgICAgSFRUUFMgPSByZXF1aXJlKCdodHRwcycpLFxuLy8gICAgIEltYWdlID0gcmVxdWlyZSgnY2FudmFzJykuSW1hZ2U7XG4vL1xuLy8gICAvKiogQHByaXZhdGUgKi9cbi8vICAgdmFyIHJlcXVlc3QgPSBmdW5jdGlvbiAodXJsLCBlbmNvZGluZywgY2FsbGJhY2spIHtcbi8vICAgICB2YXIgb1VSTCA9IFVSTC5wYXJzZSh1cmwpO1xuLy9cbi8vICAgICAvLyBkZXRlY3QgaWYgaHR0cCBvciBodHRwcyBpcyB1c2VkXG4vLyAgICAgaWYgKCAhb1VSTC5wb3J0ICkge1xuLy8gICAgICAgb1VSTC5wb3J0ID0gKCBvVVJMLnByb3RvY29sLmluZGV4T2YoJ2h0dHBzOicpID09PSAwICkgPyA0NDMgOiA4MDtcbi8vICAgICB9XG4vL1xuLy8gICAgIC8vIGFzc2lnbiByZXF1ZXN0IGhhbmRsZXIgYmFzZWQgb24gcHJvdG9jb2xcbi8vICAgICB2YXIgcmVxSGFuZGxlciA9IChvVVJMLnByb3RvY29sLmluZGV4T2YoJ2h0dHBzOicpID09PSAwICkgPyBIVFRQUyA6IEhUVFAsXG4vLyAgICAgICByZXEgPSByZXFIYW5kbGVyLnJlcXVlc3Qoe1xuLy8gICAgICAgICBob3N0bmFtZTogb1VSTC5ob3N0bmFtZSxcbi8vICAgICAgICAgcG9ydDogb1VSTC5wb3J0LFxuLy8gICAgICAgICBwYXRoOiBvVVJMLnBhdGgsXG4vLyAgICAgICAgIG1ldGhvZDogJ0dFVCdcbi8vICAgICAgIH0sIGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4vLyAgICAgICAgIHZhciBib2R5ID0gJyc7XG4vLyAgICAgICAgIGlmIChlbmNvZGluZykge1xuLy8gICAgICAgICAgIHJlc3BvbnNlLnNldEVuY29kaW5nKGVuY29kaW5nKTtcbi8vICAgICAgICAgfVxuLy8gICAgICAgICByZXNwb25zZS5vbignZW5kJywgZnVuY3Rpb24gKCkge1xuLy8gICAgICAgICAgIGNhbGxiYWNrKGJvZHkpO1xuLy8gICAgICAgICB9KTtcbi8vICAgICAgICAgcmVzcG9uc2Uub24oJ2RhdGEnLCBmdW5jdGlvbiAoY2h1bmspIHtcbi8vICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzQ29kZSA9PT0gMjAwKSB7XG4vLyAgICAgICAgICAgICBib2R5ICs9IGNodW5rO1xuLy8gICAgICAgICAgIH1cbi8vICAgICAgICAgfSk7XG4vLyAgICAgICB9KTtcbi8vXG4vLyAgICAgcmVxLm9uKCdlcnJvcicsIGZ1bmN0aW9uKGVycikge1xuLy8gICAgICAgaWYgKGVyci5lcnJubyA9PT0gcHJvY2Vzcy5FQ09OTlJFRlVTRUQpIHtcbi8vICAgICAgICAgZmFicmljLmxvZygnRUNPTk5SRUZVU0VEOiBjb25uZWN0aW9uIHJlZnVzZWQgdG8gJyArIG9VUkwuaG9zdG5hbWUgKyAnOicgKyBvVVJMLnBvcnQpO1xuLy8gICAgICAgfVxuLy8gICAgICAgZWxzZSB7XG4vLyAgICAgICAgIGZhYnJpYy5sb2coZXJyLm1lc3NhZ2UpO1xuLy8gICAgICAgfVxuLy8gICAgICAgY2FsbGJhY2sobnVsbCk7XG4vLyAgICAgfSk7XG4vL1xuLy8gICAgIHJlcS5lbmQoKTtcbi8vICAgfVxuLy9cbi8vICAgLyoqIEBwcml2YXRlICovXG4vLyAgIHZhciByZXF1ZXN0RnMgPSBmdW5jdGlvbiAocGF0aCwgY2FsbGJhY2spIHtcbi8vICAgICB2YXIgZnMgPSByZXF1aXJlKCdmcycpO1xuLy8gICAgIGZzLnJlYWRGaWxlKHBhdGgsIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbi8vICAgICAgIGlmIChlcnIpIHtcbi8vICAgICAgICAgZmFicmljLmxvZyhlcnIpO1xuLy8gICAgICAgICB0aHJvdyBlcnI7XG4vLyAgICAgICB9XG4vLyAgICAgICBlbHNlIHtcbi8vICAgICAgICAgY2FsbGJhY2soZGF0YSk7XG4vLyAgICAgICB9XG4vLyAgICAgfSk7XG4vLyAgIH07XG4vL1xuLy8gICBmYWJyaWMudXRpbC5sb2FkSW1hZ2UgPSBmdW5jdGlvbih1cmwsIGNhbGxiYWNrLCBjb250ZXh0KSB7XG4vL1xuLy9cbi8vICAgICB2YXIgaW1nID0gbmV3IEltYWdlKCk7XG4vLyAgICAgaW1nLm9uZXJyb3IgPSBmdW5jdGlvbigpe1xuLy8gICAgICAgY29uc29sZS5sb2coXCJlcnJvclwiKTtcbi8vICAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrLmNhbGwoY29udGV4dCwgbnVsbCwgdHJ1ZSk7XG4vLyAgICAgfTtcbi8vICAgICBpbWcub25sb2FkID0gZnVuY3Rpb24oKXtcbi8vICAgICAgIGNvbnNvbGUubG9nKFwic3VjY2Vzc1wiKTtcbi8vICAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrLmNhbGwoY29udGV4dCwgaW1nKTtcbi8vICAgICB9O1xuLy9cbi8vICAgICBmdW5jdGlvbiBjcmVhdGVJbWFnZUFuZENhbGxCYWNrKGRhdGEpIHtcbi8vICAgICAgIGlmIChkYXRhKSB7XG4vLyAgICAgICAgIGltZy5zcmMgPSBkYXRhO1xuLy8gICAgICAgICAvLyBwcmVzZXJ2aW5nIG9yaWdpbmFsIHVybCwgd2hpY2ggc2VlbXMgdG8gYmUgbG9zdCBpbiBub2RlLWNhbnZhc1xuLy8gICAgICAgICBpbWcuX3NyYyA9IHVybDtcbi8vICAgICAgIH1cbi8vICAgICAgIGVsc2Uge1xuLy8gICAgICAgICBpbWcgPSBudWxsO1xuLy8gICAgICAgICBjYWxsYmFjayAmJiBjYWxsYmFjay5jYWxsKGNvbnRleHQsIG51bGwsIHRydWUpO1xuLy8gICAgICAgfVxuLy8gICAgIH1cbi8vXG4vLyAgICAgaWYgKHVybCAmJiAodXJsIGluc3RhbmNlb2YgQnVmZmVyIHx8IHVybC5pbmRleE9mKCdkYXRhJykgPT09IDApKSB7XG4vLyAgICAgICBpbWcuc3JjID0gaW1nLl9zcmMgPSB1cmw7XG4vLyAgICAgfVxuLy8gICAgIGVsc2UgaWYgKHVybCAmJiB1cmwuaW5kZXhPZignaHR0cCcpICE9PSAwKSB7XG4vLyAgICAgICB2YXIgcGF0aCA9IHJlcXVpcmUoXCJwYXRoXCIpO1xuLy8gICAgICAgdXJsID0gZmFicmljLnV0aWwuZ2V0VVJMKHVybCk7XG4vLyAgICAgICB1cmwgPSAgIHBhdGgucmVzb2x2ZShmYWJyaWMudXRpbC5tZWRpYVJvb3QsIHVybCk7XG4vLyAgICAgICBpbWcuc3JjID0gIHVybDtcbi8vICAgICAgIC8vIHJlcXVlc3RGcyh1cmwsIGNyZWF0ZUltYWdlQW5kQ2FsbEJhY2spO1xuLy8gICAgIH1cbi8vICAgICBlbHNlIGlmICh1cmwpIHtcbi8vICAgICAgIHJlcXVlc3QodXJsLCAnYmluYXJ5JywgY3JlYXRlSW1hZ2VBbmRDYWxsQmFjayk7XG4vLyAgICAgfVxuLy8gICAgIGVsc2Uge1xuLy8gICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2suY2FsbChjb250ZXh0LCB1cmwpO1xuLy8gICAgIH1cbi8vICAgfTtcbi8vIH1lbHNle1xuICBmYWJyaWMudXRpbC5sb2FkUmVzb3VyY2VzID0gZnVuY3Rpb24gKHJlc291cmNlcywgY2FsbGJhY2ssIGNvbnRleHQsIGNyb3NzT3JpZ2luKSB7XG5cbiAgICB2YXIgbG9hZGVkUmVzb3VyY2VzID0ge307XG4gICAgdmFyIGxvYWRlciA9IGZhYnJpYy51dGlsLnF1ZXVlTG9hZChPYmplY3Qua2V5cyhyZXNvdXJjZXMpLmxlbmd0aCxmdW5jdGlvbigpe1xuICAgICAgY2FsbGJhY2sobG9hZGVkUmVzb3VyY2VzKTtcbiAgICB9KTtcbiAgICBmb3IodmFyIGkgaW4gcmVzb3VyY2VzKXtcbiAgICAgIChmdW5jdGlvbihpKXtcbiAgICAgICAgZmFicmljLnV0aWwubG9hZEltYWdlKHJlc291cmNlc1tpXSwgZnVuY3Rpb24oaW1hZ2Upe1xuICAgICAgICAgIGxvYWRlZFJlc291cmNlc1tpXSA9IGltYWdlO1xuICAgICAgICAgIGxvYWRlcigpO1xuICAgICAgICB9LCBjb250ZXh0LCBjcm9zc09yaWdpbik7XG4gICAgICB9KGkpKTtcbiAgICB9XG4gIH07XG5cbiAgZmFicmljLnV0aWwubG9hZEltYWdlID0gZnVuY3Rpb24gKHVybCwgY2FsbGJhY2ssIGNvbnRleHQsIGNyb3NzT3JpZ2luKSB7XG4gICAgdXJsID0gZmFicmljLnV0aWwuZ2V0VVJMKHVybCk7XG4gICAgZnVuY3Rpb24gX2NoZWNrX2Vycm9ycyhpbWcpe1xuICAgICAgLy/QuNC30L7QsdGA0LDQttC10L3QuNC1INC90LUg0LHRi9C70L4g0LfQsNCz0YDRg9C20LXQvdC+XG4gICAgICBpZiAoaW1nKSB7XG4gICAgICAgIGNhbGxiYWNrLmNhbGwodGhpcyxpbWcpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZmFicmljLmVycm9ycy5wdXNoKHt0eXBlOiBcImltYWdlXCIsIG1lc3NhZ2U6IFwiSW1hZ2Ugd2FzIG5vdCBsb2FkZWRcIn0pO1xuICAgICAgICBmYWJyaWMudXRpbC5fbG9hZEltYWdlX292ZXJ3cml0dGVuKGZhYnJpYy5tZWRpYS5lcnJvciwgY2FsbGJhY2ssIGNvbnRleHQsIGNyb3NzT3JpZ2luIHx8ICdBbm9ueW1vdXMnKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZihmYWJyaWMuZGVidWdUaW1lb3V0KXtcbiAgICAgIHNldFRpbWVvdXQoZmFicmljLnV0aWwuX2xvYWRJbWFnZV9vdmVyd3JpdHRlbi5iaW5kKHRoaXMsdXJsLCBfY2hlY2tfZXJyb3JzICwgY29udGV4dCwgY3Jvc3NPcmlnaW4gfHwgJ0Fub255bW91cycpLGZhYnJpYy5kZWJ1Z1RpbWVvdXQpXG4gICAgfWVsc2V7XG4gICAgICBmYWJyaWMudXRpbC5fbG9hZEltYWdlX292ZXJ3cml0dGVuKHVybCwgX2NoZWNrX2Vycm9ycyAsIGNvbnRleHQsIGNyb3NzT3JpZ2luIHx8ICdBbm9ueW1vdXMnKTtcbiAgICB9XG4gIH07XG5cblxuZmFicmljLnV0aWwuZ2V0VVJMID0gZnVuY3Rpb24odXJsKXtcbiAgaWYgKHVybC5pbmRleE9mKCdibG9iJykgIT09IDAgJiYgdXJsLmluZGV4T2YoJ2RhdGEnKSAhPT0gMCAmJiB1cmwuaW5kZXhPZignOi8vJykgPT0gLTEpIHtcbiAgICB1cmwgPSBmYWJyaWMudXRpbC5tZWRpYVJvb3QgKyB1cmw7XG4gIH1cbiAgaWYgKGZhYnJpYy51dGlsLmFkZE5vQ2FjaGUgJiYgL14oaHR0cHxodHRwcylcXDpcXC9cXC8vLnRlc3QodXJsKSkge1xuICAgIHVybCArPSAnP25vLWNhY2hlPScgKyBuZXcgRGF0ZSgpLmdldFRpbWUoKVxuICB9XG4gIHJldHVybiB1cmw7XG59O1xuXG5cbmZhYnJpYy51dGlsLmxvYWRWaWRlbyA9IGZ1bmN0aW9uIChzb3VyY2VzLCBjYWxsYmFjaywgY29udGV4dCwgY3Jvc3NPcmlnaW4pIHtcblxuICBmdW5jdGlvbiBsb2FkSXQodXJsKXtcbiAgICB2aWRlby5zcmMgPSBmYWJyaWMudXRpbC5nZXRVUkwodXJsKTtcbiAgICB2aWRlby5hZGRFdmVudExpc3RlbmVyKFwibG9hZGVkZGF0YVwiLCBmdW5jdGlvbigpe1xuICAgICAgY2FsbGJhY2sodmlkZW8pO1xuICAgIH0sIHRydWUpO1xuICAgIHZpZGVvLmxvYWQoKTtcbiAgfVxuXG5cblxuXG4gIHZhciB2aWRlbyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3ZpZGVvJyk7XG5cblxuICAvL3RyeWluZyB0byBmaW5kIHRoZSBtb3N0IHN1aXRhYmxlIHNvdXJjZSBmb3IgY3VycmVudCBicm93c2VyXG4gIGZvciAodmFyIHR5cGUgaW4gc291cmNlcykge1xuICAgIGlmKHZpZGVvLmNhblBsYXlUeXBlKHR5cGUpID09IFwieWVzXCIpe1xuICAgICAgdGhpcy5tZWRpYVR5cGUgPSB0eXBlO1xuICAgICAgbG9hZEl0KHNvdXJjZXNbdHlwZV0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgfVxuICBmb3IgKHZhciB0eXBlIGluIHNvdXJjZXMpIHtcbiAgICBpZih2aWRlby5jYW5QbGF5VHlwZSh0eXBlKSA9PSBcIm1heWJlXCIpe1xuICAgICAgdGhpcy5tZWRpYVR5cGUgPSB0eXBlO1xuICAgICAgbG9hZEl0KHNvdXJjZXNbdHlwZV0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgfVxuICBjb25zb2xlLndhcm4oXCJ2aWRlbyBzb3VyY2VzIGZvcm1hdHMgaXMgbm90IHN1cHBvcnRlZFwiKVxuXG5cbn07XG5cbmZhYnJpYy51dGlsLl9sb2FkU1ZHRnJvbVVSTF9vdmVyd3JpdHRlbiA9IGZhYnJpYy5sb2FkU1ZHRnJvbVVSTDtcbmZhYnJpYy5sb2FkU1ZHRnJvbVVSTCA9IGZ1bmN0aW9uICh1cmwsIGNhbGxiYWNrLCByZXZpdmVyKSB7XG4gIGlmICh1cmwuaW5kZXhPZignZGF0YScpICE9PSAwICYmIHVybC5pbmRleE9mKCc6Ly8nKSA9PSAtMSkge1xuICAgIHVybCA9IGZhYnJpYy51dGlsLm1lZGlhUm9vdCArIHVybDtcbiAgfVxuICBpZiAoZmFicmljLnV0aWwuYWRkTm9DYWNoZSAmJiAvXihodHRwfGh0dHBzKVxcOlxcL1xcLy8udGVzdCh1cmwpKSB7XG4gICAgdXJsICs9ICc/bm8tY2FjaGU9JyArIG1vbWVudCgpLmZvcm1hdCgneCcpO1xuICB9XG4gIGZhYnJpYy51dGlsLl9sb2FkU1ZHRnJvbVVSTF9vdmVyd3JpdHRlbih1cmwsIGZ1bmN0aW9uKGRhdGEpe1xuICAgICBpZihkYXRhKXtcbiAgICAgICByZXR1cm4gY2FsbGJhY2soZGF0YSk7XG4gICAgIH1cblxuICAgIHZhciB4bWwgPSBqUXVlcnkucGFyc2VYTUwoYXRvYihmYWJyaWMubWVkaWEuZXJyb3Iuc3Vic3RyKDI2KSkpO1xuXG4gICAgZmFicmljLnBhcnNlU1ZHRG9jdW1lbnQoeG1sLmRvY3VtZW50RWxlbWVudCwgZnVuY3Rpb24gKHJlc3VsdHMsIG9wdGlvbnMpIHtcbiAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKHJlc3VsdHMsIG9wdGlvbnMpO1xuICAgIH0sIHJldml2ZXIpO1xuXG4gIH0sIHJldml2ZXIpO1xufTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvbW9kdWxlcy9mcm9tVVJMLmpzIiwiJ3VzZSBzdHJpY3QnO1xuXG5cbmZhYnJpYy51dGlsLnVwbG9hZEltYWdlTWF4U2l6ZSA9IHtcbiAgd2lkdGg6IDQwMCxcbiAgaGVpZ2h0OiA0MDBcbn07XG5cbmZhYnJpYy51dGlsLnVwbG9hZEltYWdlTWluU2l6ZSA9IHtcbiAgd2lkdGg6IDEwMCxcbiAgaGVpZ2h0OiAxMDBcbn07XG5cbmZhYnJpYy51dGlsLm11bHRpVXBsb2FkID0gZmFsc2U7XG5cbmZhYnJpYy51dGlsLnJlYWRGaWxlID0gZnVuY3Rpb24oZmlsZSxjYWxsYmFjayl7XG5cbiAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XG4gIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbiAoZSkge1xuICAgIHZhciByZXN1bHQgPSBlLnRhcmdldC5yZXN1bHQ7XG4gICAgdmFyIHR5cGUgPSByZXN1bHQuc3Vic3RyKDExLCByZXN1bHQuaW5kZXhPZihcIjtcIikgLSAxMSk7XG4gICAgdmFyIGltZyA9IG5ldyBJbWFnZSgpO1xuICAgIGltZy50eXBlID0gdHlwZTtcbiAgICBpbWcubmFtZSA9IGZpbGUubmFtZTtcbiAgICBpbWcub25sb2FkID0gZnVuY3Rpb24gKCkge1xuXG4gICAgICBpZighZmFicmljLnV0aWwubXVsdGlVcGxvYWQpe1xuICAgICAgICBpZiAoZmFicmljLnV0aWwudXBsb2FkUHJlcHJvY2Vzc29yKSB7XG4gICAgICAgICAgZmFicmljLnV0aWwudXBsb2FkUHJlcHJvY2Vzc29yKFt0aGlzXSwgZnVuY3Rpb24gKHZhbCkge1xuICAgICAgICAgICAgY2FsbGJhY2sodmFsKTtcbiAgICAgICAgICB9LG9wdGlvbnMpXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY2FsbGJhY2sodGhpcyk7XG4gICAgICAgIH1cbiAgICAgIH1lbHNle1xuICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgfVxuICAgIH07XG4gICAgaW1nLnNyYyA9IHJlc3VsdDtcbiAgfTtcbiAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSApO1xufTtcblxuXG5mYWJyaWMudXRpbC5jcmVhdGVVcGxvYWRJbnB1dCA9IGZ1bmN0aW9uIChvcHRpb25zLCBjb21wbGV0ZSwgcHJvZ3Jlc3MpIHtcblxuICB2YXIgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaW5wdXRcIik7XG4gIGlucHV0LnNldEF0dHJpYnV0ZShcInR5cGVcIiwgXCJmaWxlXCIpO1xuICBpbnB1dC5zZXRBdHRyaWJ1dGUoXCJtdWx0aXBsZVwiLCB0cnVlKTtcbiAgaW5wdXQuY2xhc3NOYW1lID0gXCJoaWRkZW5cIjtcblxuICAkKGlucHV0KS5jaGFuZ2UoZnVuY3Rpb24gKCkge1xuXG4gICAgaWYoaW5wdXQuZmlsZXMgJiYgaW5wdXQuZmlsZXMubGVuZ3RoKXtcblxuICAgICAgdmFyIF9sb2FkZXIgPSBmYWJyaWMudXRpbC5xdWV1ZUxvYWQoaW5wdXQuZmlsZXMubGVuZ3RoLGZ1bmN0aW9uKGxvYWRlZCl7XG5cbiAgICAgICAgaWYoZmFicmljLnV0aWwubXVsdGlVcGxvYWQpe1xuICAgICAgICAgIGlmIChmYWJyaWMudXRpbC51cGxvYWRQcmVwcm9jZXNzb3IpIHtcbiAgICAgICAgICAgIGZhYnJpYy51dGlsLnVwbG9hZFByZXByb2Nlc3Nvcihsb2FkZWQsIGZ1bmN0aW9uICh2YWwpIHtcbiAgICAgICAgICAgICAgY29tcGxldGUodmFsLG9wdGlvbnMpO1xuICAgICAgICAgICAgfSxvcHRpb25zKVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb21wbGV0ZShsb2FkZWQsb3B0aW9ucyk7XG4gICAgICAgICAgfVxuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICBjb21wbGV0ZShsb2FkZWRbMF0sb3B0aW9ucyk7XG5cbiAgICAgICAgfVxuICAgICAgfSxmdW5jdGlvbih0b3RhbCwgY3VycmVudCwgaW1hZ2Upe1xuICAgICAgICBpZihmYWJyaWMudXRpbC5tdWx0aVVwbG9hZCkge1xuICAgICAgICAgIGlmIChwcm9ncmVzcykge1xuICAgICAgICAgICAgcHJvZ3Jlc3ModG90YWwsIGN1cnJlbnQsIGltYWdlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG5cblxuICAgICAgZm9yKHZhciBpID0wOyBpPCBpbnB1dC5maWxlcy5sZW5ndGg7IGkrKyl7XG4gICAgICAgIGZhYnJpYy51dGlsLnJlYWRGaWxlKGlucHV0LmZpbGVzW2ldLF9sb2FkZXIpO1xuICAgICAgfVxuXG5cblxuICAgIH1cblxuICB9KTtcblxuICBmYWJyaWMudXRpbC51cGxvYWRJbnB1dCA9IGlucHV0O1xufTtcblxuXG4vL2ZhYnJpYy51dGlsLnJlc2l6ZUltYWdlKGltZywgY2FsbGJhY2spO1xuZmFicmljLnV0aWwudXBsb2FkUHJlcHJvY2Vzc29yID0gbnVsbDtcblxuXG5mYWJyaWMudXRpbC51cGxvYWRJbWFnZSA9IGZ1bmN0aW9uIChjYixwcm9ncmVzcyxvcHRpb25zKSB7XG4gIGZhYnJpYy51dGlsLmNyZWF0ZVVwbG9hZElucHV0KG9wdGlvbnMsY2IscHJvZ3Jlc3MpO1xuICAkKGZhYnJpYy51dGlsLnVwbG9hZElucHV0KS50cmlnZ2VyKCdjbGljaycpO1xufTtcblxuXG5mYWJyaWMudXRpbC5yZXNpemVVcGxvYWRlZEltYWdlID0gZnVuY3Rpb24gKGltZywgY2FsbGJhY2spIHtcblxuICBpZiAoaW1nLnR5cGUgPT09IFwic3ZnK3htbFwiKSB7XG4gICAgY2FsbGJhY2soaW1nKTtcbiAgICByZXR1cm47XG4gIH1cbiAgLy9IZXJlIHdlIGNhbiBwdXQgYSByZXN0cmljdGlvbiB0byB1cGxvYWQgYSBtaW5pbSBzaXplZCBsb2dvXG4gIGlmIChpbWcud2lkdGggPCBmYWJyaWMudXRpbC51cGxvYWRJbWFnZU1pblNpemUud2lkdGggfHwgaW1nLmhlaWdodCA8IGZhYnJpYy51dGlsLnVwbG9hZEltYWdlTWluU2l6ZS5oZWlnaHQpIHtcbiAgICBhbGVydChcIkxvZ28gaXMgdG9vIHNtYWxsLiBNSW5pbXVtIHNpemUgaXMgXCIgKyBmYWJyaWMudXRpbC51cGxvYWRJbWFnZU1pblNpemUud2lkdGggKyBcInhcIiArIGZhYnJpYy51dGlsLnVwbG9hZEltYWdlTWluU2l6ZS5oZWlnaHQpO1xuICAgIGNhbGxiYWNrKGZhbHNlKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBpZiAoaW1nLndpZHRoID4gZmFicmljLnV0aWwudXBsb2FkSW1hZ2VNYXhTaXplLndpZHRoIHx8IGltZy5oZWlnaHQgPiBmYWJyaWMudXRpbC51cGxvYWRJbWFnZU1heFNpemUuaGVpZ2h0KSB7XG5cbiAgICB2YXIgc2l6ZSA9IGZhYnJpYy51dGlsLmdldFByb3BvcnRpb25zKGltZywgZmFicmljLnV0aWwudXBsb2FkSW1hZ2VNYXhTaXplLCBcImZpdFwiKTtcblxuICAgIHZhciBmaWx0ZXIgPSBuZXcgZmFicmljLkltYWdlLmZpbHRlcnMuUmVzaXplRFAoKTtcblxuICAgIHZhciBjYW52YXMgPSBmYWJyaWMudXRpbC5jcmVhdGVDYW52YXNFbGVtZW50V2l0aFNpemUoaW1nKTtcbiAgICB2YXIgY3R4ID0gY2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcbiAgICBjdHguZHJhd0ltYWdlKGltZywgMCwgMCk7XG4gICAgZmlsdGVyLmFwcGx5VG8oY2FudmFzLCBzaXplLndpZHRoLCBzaXplLmhlaWdodCk7XG4gICAgY2FsbGJhY2soY2FudmFzKTtcbiAgfSBlbHNlIHtcbiAgICBjYWxsYmFjayhpbWcpO1xuICB9XG59O1xuXG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLkNhbnZhcy5wcm90b3R5cGUse1xuICB1cGxvYWRDbGFzczogJ0ltYWdlJyxcbiAgdXBsb2FkSW1hZ2VUb29sOiBmYWxzZSxcbiAgY3JlYXRlSW1hZ2VPYmplY3Q6IGZ1bmN0aW9uIChpbWcsIG9iamVjdFR5cGUpIHtcbiAgICBpZiAoIWltZylyZXR1cm47XG4gICAgdGhpcy5jcmVhdGVPYmplY3Qoe1xuICAgICAgcG9zaXRpb246IFwiY2VudGVyXCIsXG4gICAgICBhY3RpdmU6IHRydWUsXG4gICAgICB0eXBlOiB0aGlzLnVwbG9hZENsYXNzLFxuICAgICAgaW1hZ2U6IGltZyxcbiAgICAgIGNsaXBUbzogdGhpcy5hY3RpdmVBcmVhLFxuICAgICAgbW92ZW1lbnRMaW1pdHM6IHRoaXMuYWN0aXZlQXJlYVxuICAgIH0pO1xuICB9LFxuICBhY3Rpb25zOiBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUuYWN0aW9ucyx7XG4gICAgdXBsb2FkSW1hZ2U6IHtcbiAgICAgIGNsYXNzTmFtZTogICdmYSBmYS11cGxvYWQnLFxuICAgICAga2V5OiAnVScsXG4gICAgICB0aXRsZTogJ3VwbG9hZCBpbWFnZScsXG4gICAgICBhY3Rpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZmFicmljLnV0aWwudXBsb2FkSW1hZ2UoZnVuY3Rpb24oaW1nKXtcbiAgICAgICAgICB0aGlzLmNyZWF0ZUltYWdlT2JqZWN0KGltZyx0aGlzLnVwbG9hZENsYXNzKVxuICAgICAgICB9LmJpbmQodGhpcykpXG4gICAgICB9XG4gICAgfVxuICB9KVxufSk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL21vZHVsZXMvdXBsb2FkLmpzIiwiXG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLkFwcGxpY2F0aW9uLnByb3RvdHlwZSwge1xuICAvLyBsb2FkZXJUZW1wbGF0ZTogXCI8c3BhbiBjbGFzcz0nZmEgZmEtcHVsc2UgZmEtc3Bpbm5lciBjYW52YXMtbG9hZC1zcGlubmVyJz48L3NwYW4+XCIsXG4gIGxvYWRlckljb246ICAgJ2RhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsJyArIHJlcXVpcmUoJ2Jhc2U2NC1sb2FkZXIhLi8uLi9tZWRpYS9sb2FkZXIuc3ZnJyksXG4gIGxvYWRlckNvbnRhaW5lcjogbnVsbCxcbiAgX3Nob3dNYWluTG9hZGVySW5kaWNhdG9yOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5sb2FkZXJFbC5zaG93KCk7XG4gICAgdGhpcy5sb2FkZXJDb250YWluZXIuYWRkQ2xhc3MoXCJwcm9jZXNzaW5nXCIpO1xuICB9LFxuICBfaGlkZU1haW5Mb2FkZXJJbmRpY2F0b3I6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmxvYWRlckVsLmhpZGUoKTtcbiAgICB0aGlzLmxvYWRlckNvbnRhaW5lci5yZW1vdmVDbGFzcyhcInByb2Nlc3NpbmdcIik7XG4gIH0sXG4gIHNldExvYWRlclRlbXBsYXRlOiBmdW5jdGlvbiAodmFsKSB7XG4gICAgaWYodGhpcy52aXJ0dWFsKSByZXR1cm4gZmFsc2U7XG4gICAgdGhpcy5sb2FkZXJUZW1wbGF0ZSA9IHZhbC5yZXBsYWNlKFwie2xvYWRlckljb259XCIsdGhpcy5sb2FkZXJJY29uKTtcbiAgICBpZih2YWwpIHtcbiAgICAgIHRoaXMubG9hZGVyQ29udGFpbmVyID0gJCh0aGlzLmxvYWRlckNvbnRhaW5lcik7XG4gICAgICB0aGlzLmxvYWRlckVsID0gJCh0aGlzLmxvYWRlclRlbXBsYXRlKS5oaWRlKCk7XG4gICAgICB0aGlzLmxvYWRlckNvbnRhaW5lci5hcHBlbmQodGhpcy5sb2FkZXJFbCk7XG4gICAgICAvLyB0aGlzLm9uKFwibG9hZGluZzpiZWdpblwiLCB0aGlzLl9zaG93TWFpbkxvYWRlckluZGljYXRvcik7XG4gICAgICAvLyB0aGlzLm9uKFwibG9hZGluZzplbmRcIiwgdGhpcy5faGlkZU1haW5Mb2FkZXJJbmRpY2F0b3IpO1xuXG5cbiAgICAgIHRoaXMub24oXCJwcm9qZWN0OmNoYW5nZWRcIixmdW5jdGlvbigpe1xuICAgICAgICB0aGlzLnByb2plY3Qub24oXCJzbGlkZTpjaGFuZ2U6YmVnaW5cIiwgdGhpcy5fc2hvd01haW5Mb2FkZXJJbmRpY2F0b3IuYmluZCh0aGlzKSk7XG4gICAgICAgIHRoaXMucHJvamVjdC5vbihcInNsaWRlOmNoYW5nZWRcIiwgdGhpcy5faGlkZU1haW5Mb2FkZXJJbmRpY2F0b3IuYmluZCh0aGlzKSk7XG4gICAgICB9KVxuXG4gICAgfVxuICB9XG59KTtcblxuXG4vLyBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUsIHtcbi8vICAgLy8gbG9hZGVyVGVtcGxhdGU6IFwiPHNwYW4gY2xhc3M9J2ZhIGZhLXB1bHNlIGZhLXNwaW5uZXIgY2FudmFzLWxvYWQtc3Bpbm5lcic+PC9zcGFuPlwiLFxuLy8gICBzZXRMb2FkZXJUZW1wbGF0ZTogZnVuY3Rpb24gKHZhbCkge1xuLy8gICAgIGlmKHRoaXMudmlydHVhbCkgcmV0dXJuIGZhbHNlO1xuLy8gICAgIHRoaXMubG9hZGVyVGVtcGxhdGUgPSB2YWw7XG4vLyAgICAgaWYodmFsKSB7XG4vLyAgICAgICB0aGlzLmxvYWRlckVsID0gJCh0aGlzLmxvYWRlclRlbXBsYXRlKS5oaWRlKCk7XG4vLyAgICAgICAkKHRoaXMud3JhcHBlckVsKS5hcHBlbmQodGhpcy5sb2FkZXJFbCk7XG4vLyAgICAgICB0aGlzLm9uKFwibG9hZGluZzpiZWdpblwiLCBmdW5jdGlvbiAoKSB7XG4vLyAgICAgICAgIHRoaXMubG9hZGVyRWwuc2hvdygpO1xuLy8gICAgICAgICAkKHRoaXMud3JhcHBlckVsKS5hZGRDbGFzcyhcInByb2Nlc3NpbmdcIik7XG4vLyAgICAgICB9KTtcbi8vICAgICAgIHRoaXMub24oXCJsb2FkaW5nOmVuZFwiLCBmdW5jdGlvbiAoKSB7XG4vLyAgICAgICAgIHRoaXMubG9hZGVyRWwuaGlkZSgpO1xuLy8gICAgICAgICAkKHRoaXMud3JhcHBlckVsKS5yZW1vdmVDbGFzcyhcInByb2Nlc3NpbmdcIik7XG4vLyAgICAgICB9KTtcbi8vICAgICB9XG4vLyAgIH1cbi8vIH0pO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9tb2R1bGVzL2xvYWRlci5qcyIsIm1vZHVsZS5leHBvcnRzID0gXCJQRDk0Yld3Z2RtVnljMmx2YmowaU1TNHdJaUJsYm1OdlpHbHVaejBpZFhSbUxUZ2lQejQ4YzNabklIZHBaSFJvUFNjeE9EaHdlQ2NnYUdWcFoyaDBQU2N4T0Rod2VDY2dlRzFzYm5NOUltaDBkSEE2THk5M2QzY3Vkek11YjNKbkx6SXdNREF2YzNabklpQjJhV1YzUW05NFBTSXdJREFnTVRBd0lERXdNQ0lnY0hKbGMyVnlkbVZCYzNCbFkzUlNZWFJwYnowaWVFMXBaRmxOYVdRaUlHTnNZWE56UFNKMWFXd3RjM0JwYmlJK1BISmxZM1FnZUQwaU1DSWdlVDBpTUNJZ2QybGtkR2c5SWpFd01DSWdhR1ZwWjJoMFBTSXhNREFpSUdacGJHdzlJbTV2Ym1VaUlHTnNZWE56UFNKaWF5SStQQzl5WldOMFBqeG5JSFJ5WVc1elptOXliVDBpZEhKaGJuTnNZWFJsS0RVd0lEVXdLU0krUEdjZ2RISmhibk5tYjNKdFBTSnliM1JoZEdVb01Da2dkSEpoYm5Oc1lYUmxLRE0wSURBcElqNDhZMmx5WTJ4bElHTjRQU0l3SWlCamVUMGlNQ0lnY2owaU9DSWdabWxzYkQwaUkyTm1abVprWmlJK1BHRnVhVzFoZEdVZ1lYUjBjbWxpZFhSbFRtRnRaVDBpYjNCaFkybDBlU0lnWm5KdmJUMGlNU0lnZEc4OUlqQXVNU0lnWW1WbmFXNDlJakJ6SWlCa2RYSTlJakZ6SWlCeVpYQmxZWFJEYjNWdWREMGlhVzVrWldacGJtbDBaU0krUEM5aGJtbHRZWFJsUGp4aGJtbHRZWFJsVkhKaGJuTm1iM0p0SUdGMGRISnBZblYwWlU1aGJXVTlJblJ5WVc1elptOXliU0lnZEhsd1pUMGljMk5oYkdVaUlHWnliMjA5SWpFdU5TSWdkRzg5SWpFaUlHSmxaMmx1UFNJd2N5SWdaSFZ5UFNJeGN5SWdjbVZ3WldGMFEyOTFiblE5SW1sdVpHVm1hVzVwZEdVaVBqd3ZZVzVwYldGMFpWUnlZVzV6Wm05eWJUNDhMMk5wY21Oc1pUNDhMMmMrUEdjZ2RISmhibk5tYjNKdFBTSnliM1JoZEdVb05EVXBJSFJ5WVc1emJHRjBaU2d6TkNBd0tTSStQR05wY21Oc1pTQmplRDBpTUNJZ1kzazlJakFpSUhJOUlqZ2lJR1pwYkd3OUlpTmpabVptWkdZaVBqeGhibWx0WVhSbElHRjBkSEpwWW5WMFpVNWhiV1U5SW05d1lXTnBkSGtpSUdaeWIyMDlJakVpSUhSdlBTSXdMakVpSUdKbFoybHVQU0l3TGpFeWN5SWdaSFZ5UFNJeGN5SWdjbVZ3WldGMFEyOTFiblE5SW1sdVpHVm1hVzVwZEdVaVBqd3ZZVzVwYldGMFpUNDhZVzVwYldGMFpWUnlZVzV6Wm05eWJTQmhkSFJ5YVdKMWRHVk9ZVzFsUFNKMGNtRnVjMlp2Y20waUlIUjVjR1U5SW5OallXeGxJaUJtY205dFBTSXhMalVpSUhSdlBTSXhJaUJpWldkcGJqMGlNQzR4TW5NaUlHUjFjajBpTVhNaUlISmxjR1ZoZEVOdmRXNTBQU0pwYm1SbFptbHVhWFJsSWo0OEwyRnVhVzFoZEdWVWNtRnVjMlp2Y20wK1BDOWphWEpqYkdVK1BDOW5QanhuSUhSeVlXNXpabTl5YlQwaWNtOTBZWFJsS0Rrd0tTQjBjbUZ1YzJ4aGRHVW9NelFnTUNraVBqeGphWEpqYkdVZ1kzZzlJakFpSUdONVBTSXdJaUJ5UFNJNElpQm1hV3hzUFNJalkyWm1abVJtSWo0OFlXNXBiV0YwWlNCaGRIUnlhV0oxZEdWT1lXMWxQU0p2Y0dGamFYUjVJaUJtY205dFBTSXhJaUIwYnowaU1DNHhJaUJpWldkcGJqMGlNQzR5TlhNaUlHUjFjajBpTVhNaUlISmxjR1ZoZEVOdmRXNTBQU0pwYm1SbFptbHVhWFJsSWo0OEwyRnVhVzFoZEdVK1BHRnVhVzFoZEdWVWNtRnVjMlp2Y20wZ1lYUjBjbWxpZFhSbFRtRnRaVDBpZEhKaGJuTm1iM0p0SWlCMGVYQmxQU0p6WTJGc1pTSWdabkp2YlQwaU1TNDFJaUIwYnowaU1TSWdZbVZuYVc0OUlqQXVNalZ6SWlCa2RYSTlJakZ6SWlCeVpYQmxZWFJEYjNWdWREMGlhVzVrWldacGJtbDBaU0krUEM5aGJtbHRZWFJsVkhKaGJuTm1iM0p0UGp3dlkybHlZMnhsUGp3dlp6NDhaeUIwY21GdWMyWnZjbTA5SW5KdmRHRjBaU2d4TXpVcElIUnlZVzV6YkdGMFpTZ3pOQ0F3S1NJK1BHTnBjbU5zWlNCamVEMGlNQ0lnWTNrOUlqQWlJSEk5SWpnaUlHWnBiR3c5SWlOalptWm1aR1lpUGp4aGJtbHRZWFJsSUdGMGRISnBZblYwWlU1aGJXVTlJbTl3WVdOcGRIa2lJR1p5YjIwOUlqRWlJSFJ2UFNJd0xqRWlJR0psWjJsdVBTSXdMak0zY3lJZ1pIVnlQU0l4Y3lJZ2NtVndaV0YwUTI5MWJuUTlJbWx1WkdWbWFXNXBkR1VpUGp3dllXNXBiV0YwWlQ0OFlXNXBiV0YwWlZSeVlXNXpabTl5YlNCaGRIUnlhV0oxZEdWT1lXMWxQU0owY21GdWMyWnZjbTBpSUhSNWNHVTlJbk5qWVd4bElpQm1jbTl0UFNJeExqVWlJSFJ2UFNJeElpQmlaV2RwYmowaU1DNHpOM01pSUdSMWNqMGlNWE1pSUhKbGNHVmhkRU52ZFc1MFBTSnBibVJsWm1sdWFYUmxJajQ4TDJGdWFXMWhkR1ZVY21GdWMyWnZjbTArUEM5amFYSmpiR1UrUEM5blBqeG5JSFJ5WVc1elptOXliVDBpY205MFlYUmxLREU0TUNrZ2RISmhibk5zWVhSbEtETTBJREFwSWo0OFkybHlZMnhsSUdONFBTSXdJaUJqZVQwaU1DSWdjajBpT0NJZ1ptbHNiRDBpSTJObVptWmtaaUkrUEdGdWFXMWhkR1VnWVhSMGNtbGlkWFJsVG1GdFpUMGliM0JoWTJsMGVTSWdabkp2YlQwaU1TSWdkRzg5SWpBdU1TSWdZbVZuYVc0OUlqQXVOWE1pSUdSMWNqMGlNWE1pSUhKbGNHVmhkRU52ZFc1MFBTSnBibVJsWm1sdWFYUmxJajQ4TDJGdWFXMWhkR1UrUEdGdWFXMWhkR1ZVY21GdWMyWnZjbTBnWVhSMGNtbGlkWFJsVG1GdFpUMGlkSEpoYm5ObWIzSnRJaUIwZVhCbFBTSnpZMkZzWlNJZ1puSnZiVDBpTVM0MUlpQjBiejBpTVNJZ1ltVm5hVzQ5SWpBdU5YTWlJR1IxY2owaU1YTWlJSEpsY0dWaGRFTnZkVzUwUFNKcGJtUmxabWx1YVhSbElqNDhMMkZ1YVcxaGRHVlVjbUZ1YzJadmNtMCtQQzlqYVhKamJHVStQQzluUGp4bklIUnlZVzV6Wm05eWJUMGljbTkwWVhSbEtESXlOU2tnZEhKaGJuTnNZWFJsS0RNMElEQXBJajQ4WTJseVkyeGxJR040UFNJd0lpQmplVDBpTUNJZ2NqMGlPQ0lnWm1sc2JEMGlJMk5tWm1aa1ppSStQR0Z1YVcxaGRHVWdZWFIwY21saWRYUmxUbUZ0WlQwaWIzQmhZMmwwZVNJZ1puSnZiVDBpTVNJZ2RHODlJakF1TVNJZ1ltVm5hVzQ5SWpBdU5qSnpJaUJrZFhJOUlqRnpJaUJ5WlhCbFlYUkRiM1Z1ZEQwaWFXNWtaV1pwYm1sMFpTSStQQzloYm1sdFlYUmxQanhoYm1sdFlYUmxWSEpoYm5ObWIzSnRJR0YwZEhKcFluVjBaVTVoYldVOUluUnlZVzV6Wm05eWJTSWdkSGx3WlQwaWMyTmhiR1VpSUdaeWIyMDlJakV1TlNJZ2RHODlJakVpSUdKbFoybHVQU0l3TGpZeWN5SWdaSFZ5UFNJeGN5SWdjbVZ3WldGMFEyOTFiblE5SW1sdVpHVm1hVzVwZEdVaVBqd3ZZVzVwYldGMFpWUnlZVzV6Wm05eWJUNDhMMk5wY21Oc1pUNDhMMmMrUEdjZ2RISmhibk5tYjNKdFBTSnliM1JoZEdVb01qY3dLU0IwY21GdWMyeGhkR1VvTXpRZ01Da2lQanhqYVhKamJHVWdZM2c5SWpBaUlHTjVQU0l3SWlCeVBTSTRJaUJtYVd4c1BTSWpZMlptWm1SbUlqNDhZVzVwYldGMFpTQmhkSFJ5YVdKMWRHVk9ZVzFsUFNKdmNHRmphWFI1SWlCbWNtOXRQU0l4SWlCMGJ6MGlNQzR4SWlCaVpXZHBiajBpTUM0M05YTWlJR1IxY2owaU1YTWlJSEpsY0dWaGRFTnZkVzUwUFNKcGJtUmxabWx1YVhSbElqNDhMMkZ1YVcxaGRHVStQR0Z1YVcxaGRHVlVjbUZ1YzJadmNtMGdZWFIwY21saWRYUmxUbUZ0WlQwaWRISmhibk5tYjNKdElpQjBlWEJsUFNKelkyRnNaU0lnWm5KdmJUMGlNUzQxSWlCMGJ6MGlNU0lnWW1WbmFXNDlJakF1TnpWeklpQmtkWEk5SWpGeklpQnlaWEJsWVhSRGIzVnVkRDBpYVc1a1pXWnBibWwwWlNJK1BDOWhibWx0WVhSbFZISmhibk5tYjNKdFBqd3ZZMmx5WTJ4bFBqd3ZaejQ4WnlCMGNtRnVjMlp2Y20wOUluSnZkR0YwWlNnek1UVXBJSFJ5WVc1emJHRjBaU2d6TkNBd0tTSStQR05wY21Oc1pTQmplRDBpTUNJZ1kzazlJakFpSUhJOUlqZ2lJR1pwYkd3OUlpTmpabVptWkdZaVBqeGhibWx0WVhSbElHRjBkSEpwWW5WMFpVNWhiV1U5SW05d1lXTnBkSGtpSUdaeWIyMDlJakVpSUhSdlBTSXdMakVpSUdKbFoybHVQU0l3TGpnM2N5SWdaSFZ5UFNJeGN5SWdjbVZ3WldGMFEyOTFiblE5SW1sdVpHVm1hVzVwZEdVaVBqd3ZZVzVwYldGMFpUNDhZVzVwYldGMFpWUnlZVzV6Wm05eWJTQmhkSFJ5YVdKMWRHVk9ZVzFsUFNKMGNtRnVjMlp2Y20waUlIUjVjR1U5SW5OallXeGxJaUJtY205dFBTSXhMalVpSUhSdlBTSXhJaUJpWldkcGJqMGlNQzQ0TjNNaUlHUjFjajBpTVhNaUlISmxjR1ZoZEVOdmRXNTBQU0pwYm1SbFptbHVhWFJsSWo0OEwyRnVhVzFoZEdWVWNtRnVjMlp2Y20wK1BDOWphWEpqYkdVK1BDOW5Qand2Wno0OEwzTjJaejQ9XCJcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuLi9ub2RlX21vZHVsZXMvYmFzZTY0LWxvYWRlciEuL21lZGlhL2xvYWRlci5zdmdcbi8vIG1vZHVsZSBpZCA9IDQ5XG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIid1c2Ugc3RyaWN0JztcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuU2xpZGVDYW52YXMucHJvdG90eXBlLCB7XG4gIHNldERyb3BwYWJsZTogZnVuY3Rpb24odmFsKXtcbiAgICB0aGlzLmRyb3BwYWJsZSA9IHZhbDtcbiAgICBpZih0aGlzLmRyb3BwYWJsZSl7XG4gICAgICB0aGlzLmluaXREcmFnQW5kRHJvcCgpO1xuICAgIH1cbiAgfSxcbiAgZHJvcHBhYmxlOiBmYWxzZSwgLy97fVxuICBpc0Ryb3BBdmFpbGFibGU6IGZ1bmN0aW9uIChkcm9wcGFibGUsIGRhdGEpIHtcblxuICAgIGZvciAodmFyIGkgaW4gZHJvcHBhYmxlKSB7XG4gICAgICBpZiAoZHJvcHBhYmxlW2ldLmNvbnN0cnVjdG9yID09IEFycmF5KSB7XG4gICAgICAgIGlmIChkcm9wcGFibGVbaV0uaW5kZXhPZihkYXRhW2ldKSA9PSAtMSlyZXR1cm4gZmFsc2U7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZihkcm9wcGFibGVbaV0gPT0gXCIqXCIpY29udGludWU7XG4gICAgICAgIGlmIChkcm9wcGFibGVbaV0gIT0gZGF0YVtpXSkgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgICAvL3JldHVybiAodGhpcy5zdXBwb3J0ZWRUeXBlcyA9PSBcIipcIiB8fCB0aGlzLnN1cHBvcnRlZFR5cGVzLmluZGV4T2YodHlwZSkhPSAtMSlcbiAgfSxcbiAgZHJvcDogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICB0aGlzLnNldERhdGEoZGF0YSk7XG5cbiAgfSxcbiAgaW5pdERyYWdBbmREcm9wOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5vbihcIm1vdXNlOmRyb3BcIiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgIHZhciBfeCA9IChlLnggLSBlLm9mZnNldFgpO1xuICAgICAgdmFyIF95ID0gKGUueSAtIGUub2Zmc2V0WSlcbiAgICAgIHZhciBfdyA9IChlLmRhdGEud2lkdGggfHwgZS53aWR0aCAgKTtcbiAgICAgIHZhciBfaCA9IChlLmRhdGEuaGVpZ2h0IHx8IGUuaGVpZ2h0ICk7XG5cbiAgICAgIGlmIChlLmRhdGEuc2NhbGVYKSB7XG4gICAgICAgIHZhciBfc2NhbGVYID0gZS5kYXRhLnNjYWxlWCAvIHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bMF1cblxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgX3NjYWxlWCA9IDE7XG4gICAgICAgIF93IC89IHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bMF1cbiAgICAgIH1cblxuICAgICAgaWYgKGUuZGF0YS5zY2FsZVkpIHtcbiAgICAgICAgdmFyIF9zY2FsZVkgPSBlLmRhdGEuc2NhbGVZIC8gdGhpcy52aWV3cG9ydFRyYW5zZm9ybVszXTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIF9zY2FsZVkgPSAxO1xuICAgICAgICBfaCAvPSB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzNdXG4gICAgICB9XG5cbiAgICAgIHZhciBfc3Ryb2tlID0gZS5kYXRhLnN0cm9rZVdpZHRoIHx8IDA7XG4gICAgICBpZiAoZS5kYXRhLmxlZnQpIHtcbiAgICAgICAgX3ggKz0gKGUuZGF0YS5sZWZ0ICsgX3N0cm9rZSkgLyB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzBdO1xuICAgICAgfVxuICAgICAgaWYgKGUuZGF0YS50b3ApIHtcbiAgICAgICAgX3kgKz0gKGUuZGF0YS50b3AgKyBfc3Ryb2tlKSAvIHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bM107XG4gICAgICB9XG5cblxuICAgICAgZS5kYXRhID0gZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCh7fSwgZS5kYXRhLCB7XG4gICAgICAgIHNjYWxlWDogX3NjYWxlWCxcbiAgICAgICAgc2NhbGVZOiBfc2NhbGVZLFxuICAgICAgICBsZWZ0OiBfeCxcbiAgICAgICAgdG9wOiBfeSxcbiAgICAgICAgd2lkdGg6IF93LFxuICAgICAgICBoZWlnaHQ6IF9oLFxuICAgICAgICBvcmlnaW5hbFdpZHRoOiBlLmRhdGEud2lkdGgsXG4gICAgICAgIG9yaWdpbmFsSGVpZ2h0OiBlLmRhdGEuaGVpZ2h0XG4gICAgICB9KTtcblxuICAgICAgdGhpcy5maXJlKFwiYmVmb3JlOmRyb3BcIixlKTtcblxuICAgICAgZS50YXJnZXQgPSB0aGlzLmZpbmRUYXJnZXQoZS5vcmlnaW5hbEV2ZW50KTtcbiAgICAgIGlmIChlLnRhcmdldCAmJiAhdGhpcy5pc0RyYXdpbmdNb2RlKSB7XG4gICAgICAgIC8vIFRvIHVuaWZ5IHRoZSBiZWhhdmlvciwgdGhlIG9iamVjdCdzIGRvdWJsZSBjbGljayBldmVudCBkb2VzIG5vdCBmaXJlIG9uIGRyYXdpbmcgbW9kZS5cbiAgICAgICAgZS50YXJnZXQuZmlyZSgnb2JqZWN0OmRyb3AnLCBlKTtcbiAgICAgIH1cblxuXG4gICAgICBpZiAoZS50YXJnZXQgJiYgZS50YXJnZXQuZHJvcHBhYmxlKSB7XG4gICAgICAgIGlmICh0aGlzLmlzRHJvcEF2YWlsYWJsZShlLnRhcmdldC5kcm9wcGFibGUsIGUuZGF0YSkpIHtcbiAgICAgICAgICBlLnRhcmdldC5kZWFjdGl2YXRlKCk7XG4gICAgICAgICAgZS50YXJnZXQuZHJvcChlLmRhdGEpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAodGhpcy5kcm9wcGFibGUgJiYgdGhpcy5pc0Ryb3BBdmFpbGFibGUodGhpcy5kcm9wcGFibGUsIGUuZGF0YSkpIHtcbiAgICAgICAgICB0aGlzLmRyb3AoZS5kYXRhKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICAgIHRoaXMub24oXCJtb3VzZTpkcmFnZW50ZXJcIiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgIGlmIChlLnRhcmdldCAmJiBlLnRhcmdldC5kcm9wcGFibGUpIHtcbiAgICAgICAgaWYgKHRoaXMuaXNEcm9wQXZhaWxhYmxlKGUudGFyZ2V0LmRyb3BwYWJsZSwgZS5kYXRhKSkge1xuICAgICAgICAgIGUudGFyZ2V0LmFjdGl2YXRlKCk7XG4gICAgICAgICAgZS5lLmhlbHBlci5jc3MoXCJjdXJzb3JcIiwgXCJhbGlhc1wiKTtcbiAgICAgICAgICB0aGlzLnNldEN1cnNvcihcImFsaWFzXCIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGUuZS5oZWxwZXIuY3NzKFwiY3Vyc29yXCIsIFwibm90LWFsbG93ZWRcIik7XG4gICAgICAgICAgdGhpcy5zZXRDdXJzb3IoXCJub3QtYWxsb3dlZFwiKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICAgIHRoaXMub24oXCJtb3VzZTpkcmFnbGVhdmVcIiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgIGlmIChlLnRhcmdldCAmJiBlLnRhcmdldC5kcm9wcGFibGUpIHtcbiAgICAgICAgaWYgKHRoaXMuaXNEcm9wQXZhaWxhYmxlKGUudGFyZ2V0LmRyb3BwYWJsZSwgZS5kYXRhKSkge1xuICAgICAgICAgIHRoaXMuX2FjdGl2YXRlZCA9IGZhbHNlO1xuICAgICAgICAgIGUudGFyZ2V0LmRlYWN0aXZhdGUoKVxuICAgICAgICB9XG4gICAgICAgIGUuZS5oZWxwZXIuY3NzKFwiY3Vyc29yXCIsIFwicG9pbnRlclwiKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxufSk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL21vZHVsZXMvZHJvcHBhYmxlLmpzIiwiJ3VzZSBzdHJpY3QnO1xuXG5cbmZhYnJpYy5HdWlkbGluZSA9IGZhYnJpYy51dGlsLmNyZWF0ZUNsYXNzKGZhYnJpYy5PYmplY3Qse1xuICB0b3AgOiAwLFxuICBsZWZ0IDogMCxcbiAgaGVpZ2h0IDogMSxcbiAgd2lkdGggOiAxLFxuICBncmlkZGFibGU6IGZhbHNlLFxuICByZXNwb25zaXZlQm9yZGVycyA6IHRydWUsXG4gIGdyb3VwU2VsZWN0YWJsZSA6IGZhbHNlLFxuICBoYXNDb250cm9scyA6IGZhbHNlLFxuICBoYXNCb3JkZXJzIDogZmFsc2UsXG4gIHdob2xlQ29vcmRpbmF0ZXMgOiB0cnVlLFxuICBzdG9yZWQ6IGZhbHNlLFxuICBtb3ZlbWVudExpbWl0czogXCIjX18wXCIsXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKG9wdGlvbnMpe1xuICAgIHRoaXMueCA9IE1hdGgucm91bmQob3B0aW9ucy54KTtcbiAgICB0aGlzLnkgPSBNYXRoLnJvdW5kKG9wdGlvbnMueSk7XG5cbiAgICBpZih0aGlzLngpe1xuICAgICAgdGhpcy5sb2NrTW92ZW1lbnRZID0gdHJ1ZTtcbiAgICAgIHRoaXMuaG92ZXJDdXJzb3IgPSBcImV3LXJlc2l6ZVwiO1xuICAgIH1cblxuICAgIGlmKHRoaXMueSl7XG4gICAgICB0aGlzLmxvY2tNb3ZlbWVudFggPSB0cnVlO1xuICAgICAgdGhpcy5ob3ZlckN1cnNvciA9IFwibnMtcmVzaXplXCI7XG4gICAgfVxuXG4gICAgdGhpcy5vbih7XG4gICAgICBcInJlbW92ZWRcIjogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgaSA9IHRoaXMuY2FudmFzLmd1aWRsaW5lcy5pbmRleE9mKHRoaXMpO1xuICAgICAgICB0aGlzLmNhbnZhcy5ndWlkbGluZXMuc3BsaWNlKGksMSlcbiAgICAgIH0sXG4gICAgICBcIm1vZGlmaWVkXCI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYodGhpcy54KXtcbiAgICAgICAgICB0aGlzLnggPSB0aGlzLmxlZnQgKyB0aGlzLndpZHRoIC8gMjtcbiAgICAgICAgfVxuICAgICAgICBpZih0aGlzLnkpe1xuICAgICAgICAgIHRoaXMueSA9IHRoaXMudG9wICsgdGhpcy5oZWlnaHQgLyAyO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgXCJkYmxjbGlja1wiOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMucmVtb3ZlKCk7XG4gICAgICB9LFxuICAgICAgXCJhZGRlZFwiOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLngpIHtcbiAgICAgICAgICB0aGlzLmhlaWdodCA9IHRoaXMuY2FudmFzLmhlaWdodDtcbiAgICAgICAgICB0aGlzLndpZHRoID0gTWF0aC5jZWlsKDEwIC8gdGhpcy5jYW52YXMudmlld3BvcnRUcmFuc2Zvcm1bMF0pO1xuICAgICAgICAgIGlmKHRoaXMud2lkdGggJSAyKXtcbiAgICAgICAgICAgIHRoaXMud2lkdGgrKztcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy5sZWZ0ID0gdGhpcy54IC0gdGhpcy53aWR0aCAvMjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy55KSB7XG4gICAgICAgICAgdGhpcy53aWR0aCA9IHRoaXMuY2FudmFzLndpZHRoO1xuICAgICAgICAgIHRoaXMuaGVpZ2h0ID0gTWF0aC5jZWlsKDEwIC8gdGhpcy5jYW52YXMudmlld3BvcnRUcmFuc2Zvcm1bMF0pO1xuICAgICAgICAgIGlmKHRoaXMuaGVpZ2h0ICUgMil7XG4gICAgICAgICAgICB0aGlzLmhlaWdodCsrO1xuICAgICAgICAgIH1cbiAgICAgICAgICB0aGlzLnRvcCA9IHRoaXMueSAtIHRoaXMuaGVpZ2h0IC8yO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2V0Q29vcmRzKCk7XG4gICAgICAgIGlmKHRoaXMuY2FudmFzLmd1aWRsaW5lcyl7XG4gICAgICAgICAgdGhpcy5jYW52YXMuZ3VpZGxpbmVzLnB1c2godGhpcyk7XG4gICAgICAgIH1lbHNle1xuICAgICAgICAgIHRoaXMudmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbiAgfSxcbiAgcmVuZGVyOiBmdW5jdGlvbihjdHgpe1xuICAgIGN0eC5zYXZlKCk7XG5cbiAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgY3R4LnN0cm9rZVN0eWxlID0gXCIjMDAwMDAwXCI7XG4gICAgaWYodGhpcy54KXtcbiAgICAgIGN0eC50cmFuc2xhdGUodGhpcy5sZWZ0ICsgdGhpcy53aWR0aCAvIDIsMCk7XG4gICAgICBjdHguc2NhbGUoMSAvIHRoaXMuY2FudmFzLmdldFpvb20oKSwgMSAvIHRoaXMuY2FudmFzLmdldFpvb20oKSk7XG4gICAgICBjdHgubW92ZVRvKDAsMCk7XG4gICAgICBjdHgubGluZVRvKDAsdGhpcy5jYW52YXMuaGVpZ2h0KTtcbiAgICB9XG4gICAgaWYodGhpcy55KSB7XG4gICAgICBjdHgudHJhbnNsYXRlKDAsIHRoaXMudG9wICsgdGhpcy5oZWlnaHQgLyAyKTtcbiAgICAgIGN0eC5zY2FsZSgxIC8gdGhpcy5jYW52YXMuZ2V0Wm9vbSgpLCAxIC8gdGhpcy5jYW52YXMuZ2V0Wm9vbSgpKTtcbiAgICAgIGN0eC5tb3ZlVG8oMCwgMCk7XG4gICAgICBjdHgubGluZVRvKHRoaXMuY2FudmFzLndpZHRoLCAwKTtcbiAgICB9XG4gICAgY3R4LnN0cm9rZSgpO1xuICAgIGN0eC5yZXN0b3JlKCk7XG4gIH1cbn0pO1xuXG5mYWJyaWMuUnVsZXIgPSBmYWJyaWMudXRpbC5jcmVhdGVDbGFzcyh7XG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uIChvcHRpb25zKSB7XG5cbiAgICB0aGlzLmNhbnZhcyA9b3B0aW9ucy5jYW52YXM7XG4gICAgdGhpcy50eXBlID0gb3B0aW9ucy50eXBlO1xuICAgIGlmKG9wdGlvbnMuc2l6ZSl0aGlzLnNpemUgPSBvcHRpb25zLnNpemU7XG4gICAgdmFyIHNpemU7XG4gICAgaWYgKG9wdGlvbnMudHlwZSA9PSBcInZlcnRpY2FsXCIpIHtcbiAgICAgIHNpemUgPSB7XG4gICAgICAgIHdpZHRoOiB0aGlzLnNpemUsXG4gICAgICAgIGhlaWdodDogdGhpcy5jYW52YXMuaGVpZ2h0XG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICBzaXplID0ge1xuICAgICAgICB3aWR0aDogdGhpcy5jYW52YXMud2lkdGgsXG4gICAgICAgIGhlaWdodDogdGhpcy5zaXplXG4gICAgICB9O1xuICAgIH1cblxuICAgIHRoaXMuY2FudmFzRWxlbWVudCA9IGZhYnJpYy51dGlsLmNyZWF0ZUNhbnZhc0VsZW1lbnRXaXRoU2l6ZShzaXplKTtcbiAgICB0aGlzLmNhbnZhcy53cmFwcGVyRWwuYXBwZW5kQ2hpbGQodGhpcy5jYW52YXNFbGVtZW50KTtcbiAgICB0aGlzLnJ1bGVyQ29udGV4dCA9IHRoaXMuY2FudmFzRWxlbWVudC5nZXRDb250ZXh0KCcyZCcpO1xuICAgIC8vIHRoaXMucnVsZXJDb250ZXh0LnRyYW5zbGF0ZSgtMC41LC0wLjUpO1xuICAgIHdpbmRvdy5ydWxlckNvbnRleHQgPSB0aGlzLnJ1bGVyQ29udGV4dDtcbiAgICB0aGlzLnJ1bGVyQ29udGV4dC5pbWFnZVNtb290aGluZ0VuYWJsZWQgPSBmYWxzZTtcbiAgICB0aGlzLnJlbmRlcigpO1xuICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgdGhpcy5jYW52YXMub24oe1xuICAgICAgJ3ZpZXdwb3J0OnNjYWxlZCBjaGFuZ2VkIG1vZGlmaWVkJyA6IGZ1bmN0aW9uKCl7XG4gICAgICAgIF90aGlzLnJlbmRlcigpO1xuICAgICAgfVxuICAgIH0pXG5cbiAgfSxcbiAgc2l6ZTogMzAsXG4gIG9yaWVudGF0aW9uOiBcInJldmVydFwiLFxuICBmb250OiBcIjEwcHggT3BlbiBTYW5zXCIsXG4gIGRlbGltZXRlcnM6IFs1MCwgMTAsIDUsIDFdLFxuICByZW5kZXI6IGZ1bmN0aW9uICgpIHtcblxuXG4gICAgdmFyIHYgPSB0aGlzLnR5cGUgPT0gXCJ2ZXJ0aWNhbFwiO1xuICAgIHZhciBzY2FsZSA9IHRoaXMuY2FudmFzLmdldFpvb20oKTtcbiAgICB2YXIgX2N0eCA9IHRoaXMucnVsZXJDb250ZXh0O1xuXG4gICAgX2N0eC5tb3pJbWFnZVNtb290aGluZ0VuYWJsZWQgPSBmYWxzZTtcblxuICAgIF9jdHguY2xlYXJSZWN0KDAsIDAsIHRoaXMuY2FudmFzRWxlbWVudC53aWR0aCwgdGhpcy5jYW52YXNFbGVtZW50LmhlaWdodCk7XG4gICAgaWYodikge1xuICAgICAgdGhpcy5jYW52YXNFbGVtZW50LmhlaWdodCA9IHRoaXMuY2FudmFzLmhlaWdodDtcbiAgICAgIF9jdHgudGV4dEFsaWduID0gJ2VuZCc7XG4gICAgfWVsc2V7XG4gICAgICB0aGlzLmNhbnZhc0VsZW1lbnQud2lkdGggPSB0aGlzLmNhbnZhcy53aWR0aDtcbiAgICB9XG5cbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgIGZ1bmN0aW9uIHB1c2goaCl7XG4gICAgICB2YXIgX3ggPSBNYXRoLnJvdW5kKCBsICogc2NhbGUpO1xuICAgICAgaWYoZmFsc2Upe1xuICAgICAgICB2YXIgeDEgPSAwO1xuICAgICAgICB2YXIgeDIgPSBoO1xuICAgICAgfWVsc2V7XG4gICAgICAgIHZhciB4MSA9IF90aGlzLnNpemU7XG4gICAgICAgIHZhciB4MiA9IF90aGlzLnNpemUgLSBoO1xuICAgICAgfVxuICAgICAgaWYodil7XG4gICAgICAgIF9jdHgubW92ZVRvKHgxLF94KTtcbiAgICAgICAgX2N0eC5saW5lVG8oeDIsIF94KTtcbiAgICAgIH0gZWxzZXtcbiAgICAgICAgX2N0eC5tb3ZlVG8oX3gseDEpO1xuICAgICAgICBfY3R4LmxpbmVUbyhfeCx4Mik7XG4gICAgICB9XG4gICAgICBfY3R4LnN0cm9rZSgpO1xuICAgIH1cbiAgICB2YXIgdyA9ICggdiA/IHRoaXMuY2FudmFzLmhlaWdodCA6IHRoaXMuY2FudmFzLndpZHRoKSAvIHNjYWxlO1xuICAgIHZhciBfZGVsID0gW10sIF9sYWJlbHMgPSBbXTtcbiAgICB2YXIgaSA9IDAsIGogPSAwLCBrID0gMCwgbCA9IDAsIGQgPSB0aGlzLmRlbGltZXRlcnMsIG07XG5cbiAgICBmb3IgKGkgPSAwOyBpIDwgdyAvIGRbMF07IGkrKykge1xuICAgICAgayA9IDA7XG4gICAgICBqID0gMDtcbiAgICAgIGwgPSBpICogZFswXSArIGogKiBkWzFdICsgayAqIGRbMl07XG4gICAgICBpZiAobCA+PSB3KWJyZWFrO1xuICAgICAgcHVzaCgxMCk7XG5cbiAgICAgIF9jdHguZm9udCA9IHRoaXMuZm9udDtcbiAgICAgIGlmICh2KSB7XG4gICAgICAgIF9jdHguc3Ryb2tlVGV4dChsLF90aGlzLnNpemUgLSA2LGwgKiBzY2FsZSArIDEyKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIF9jdHguc3Ryb2tlVGV4dChsLGwgKiBzY2FsZSArIDIsX3RoaXMuc2l6ZSAtIDggKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHNjYWxlID4gMSkge1xuXG4gICAgICAgIGZvciAoaiA9IDA7IGogPCBkWzBdIC8gZFsxXTsgaisrKSB7XG4gICAgICAgICAgayA9IDA7XG4gICAgICAgICAgbCA9IGkgKiBkWzBdICsgaiAqIGRbMV0gKyBrICogZFsyXTtcbiAgICAgICAgICBpZiAobCA+PSB3KWJyZWFrO1xuICAgICAgICAgIHB1c2goNyk7XG5cblxuICAgICAgICAgIGlmIChzY2FsZSA+IDIpIHtcbiAgICAgICAgICAgIGZvciAoayA9IDA7IGsgPCBkWzFdIC8gZFsyXTsgaysrKSB7XG4gICAgICAgICAgICAgIGwgPSBpICogZFswXSArIGogKiBkWzFdICsgayAqIGRbMl07XG4gICAgICAgICAgICAgIGlmIChsID49IHcpYnJlYWs7XG4gICAgICAgICAgICAgIHB1c2goNCk7XG4gICAgICAgICAgICB9XG5cblxuICAgICAgICAgICAgaWYgKHNjYWxlID4gNSkge1xuXG4gICAgICAgICAgICAgIGZvciAobSA9IDA7IG0gPCBkWzJdIC8gZFszXTsgbSsrKSB7XG4gICAgICAgICAgICAgICAgZm9yIChrID0gMDsgayA8IGRbMV0gLyBkWzJdOyBrKyspIHtcbiAgICAgICAgICAgICAgICAgIGwgPSBpICogZFswXSArIGogKiBkWzFdICsgayAqIGRbMl0gKyBtICogZFszXTtcbiAgICAgICAgICAgICAgICAgIGlmIChsID49IHcpYnJlYWs7XG4gICAgICAgICAgICAgICAgICBwdXNoKDIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLl9lbGVtZW50cyA9IF9kZWw7XG4gICAgdGhpcy5fbGFiZWxzID0gX2xhYmVscztcbiAgICBfY3R4LnN0cm9rZSgpO1xuICB9XG59KTtcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuU3RhdGljQ2FudmFzLnByb3RvdHlwZSx7XG4gIGd1aWRsaW5lc0VuYWJsZWQ6IGZhbHNlLFxuICBjcmVhdGVHdWlkbGluZTogZnVuY3Rpb24oZGF0YSl7XG4gICAgaWYoZGF0YS55ICE9PSB1bmRlZmluZWQpe1xuICAgICAgaWYoZmFicmljLkd1aWRsaW5lLnByb3RvdHlwZS53aG9sZUNvb3JkaW5hdGVzKXtcbiAgICAgICAgZGF0YS55ID0gZGF0YS55ICYmIE1hdGgucm91bmQoZGF0YS55KTtcbiAgICAgIH1cbiAgICAgIGlmKCFmYWJyaWMudXRpbC5vYmplY3QuZmluZFdoZXJlKHRoaXMuZ3VpZGxpbmVzLHt5OiBkYXRhLnl9KSl7XG4gICAgICAgIHZhciBnbCA9IG5ldyBmYWJyaWMuR3VpZGxpbmUoe3k6IGRhdGEueX0pO1xuICAgICAgICB0aGlzLmFkZChnbCk7XG4gICAgICB9XG4gICAgfWVsc2UgaWYoZGF0YS54ICE9PSB1bmRlZmluZWQpe1xuICAgICAgaWYoZmFicmljLkd1aWRsaW5lLnByb3RvdHlwZS53aG9sZUNvb3JkaW5hdGVzKXtcbiAgICAgICAgZGF0YS54ID0gZGF0YS54ICYmIE1hdGgucm91bmQoZGF0YS54KTtcbiAgICAgIH1cbiAgICAgIGlmKCFmYWJyaWMudXRpbC5vYmplY3QuZmluZFdoZXJlKHRoaXMuZ3VpZGxpbmVzLHt4OiBkYXRhLnh9KSl7XG4gICAgICAgIHZhciBnbCA9IG5ldyBmYWJyaWMuR3VpZGxpbmUoe3g6IGRhdGEueH0pO1xuICAgICAgICB0aGlzLmFkZChnbCk7XG4gICAgICB9XG4gICAgfVxuICB9LFxuICBzZXRHdWlkbGluZXM6IGZ1bmN0aW9uKGd1aWRsaW5lcyl7XG4gICAgdGhpcy5ndWlkbGluZXMgPSBndWlkbGluZXM7XG4gICAgaWYoZ3VpZGxpbmVzICYmIHRoaXMuZ3VpZGxpbmVzRW5hYmxlZCl7XG4gICAgICAvLyB0aGlzLmd1aWRsaW5lcyA9IFtdO1xuICAgICAgZm9yKHZhciBpIGluIGd1aWRsaW5lcyl7XG4gICAgICAgIHRoaXMuY3JlYXRlR3VpZGxpbmUoZ3VpZGxpbmVzW2ldKVxuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgc2V0UnVsZXJzOiBmdW5jdGlvbih2YWx1ZSl7XG4gICAgaWYoIXZhbHVlKXtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5ydWxlcnMgPSB0cnVlO1xuICAgIHRoaXMudlJ1bGVyID0gbmV3IGZhYnJpYy5SdWxlcih7XG4gICAgICBjYW52YXM6IHRoaXMsXG4gICAgICB0eXBlOiBcInZlcnRpY2FsXCJcbiAgICB9KTtcbiAgICB0aGlzLmhSdWxlciA9IG5ldyBmYWJyaWMuUnVsZXIoe1xuICAgICAgY2FudmFzOiB0aGlzLFxuICAgICAgdHlwZTogXCJob3Jpem9udGFsXCJcbiAgICB9KTtcblxuICAgIHRoaXMuaFJ1bGVyLmNhbnZhc0VsZW1lbnQuc3R5bGUucG9zaXRpb24gPSBcImFic29sdXRlXCI7XG4gICAgdGhpcy5oUnVsZXIuY2FudmFzRWxlbWVudC5zdHlsZS5sZWZ0ID0gMDtcbiAgICB0aGlzLmhSdWxlci5jYW52YXNFbGVtZW50LnN0eWxlLmJvdHRvbSA9IFwiMTAwJVwiO1xuICAgIHRoaXMudlJ1bGVyLmNhbnZhc0VsZW1lbnQuc3R5bGUucG9zaXRpb24gPSBcImFic29sdXRlXCI7XG4gICAgdGhpcy52UnVsZXIuY2FudmFzRWxlbWVudC5zdHlsZS50b3AgPSAwO1xuICAgIHRoaXMudlJ1bGVyLmNhbnZhc0VsZW1lbnQuc3R5bGUucmlnaHQgPSBcIjEwMCVcIjtcblxuXG4gICAgdGhpcy5ndWlkbGluZXMgPSBbXTtcblxuXG4gICAgdmFyIF9jYW52YXMgPSB0aGlzO1xuXG4gICAgdGhpcy5vbigndmlld3BvcnQ6c2NhbGVkJywgZnVuY3Rpb24oKXtcblxuICAgICAgdGhpcy5ndWlkbGluZXMuZm9yRWFjaChmdW5jdGlvbihnbCl7XG4gICAgICAgIGlmKGdsLngpe1xuICAgICAgICAgIGdsLndpZHRoID0gTWF0aC5jZWlsKDEwIC8gZ2wuY2FudmFzLnZpZXdwb3J0VHJhbnNmb3JtWzBdKTtcbiAgICAgICAgICBpZihnbC53aWR0aCAlIDIpe1xuICAgICAgICAgICAgZ2wud2lkdGgrKztcbiAgICAgICAgICB9XG4gICAgICAgICAgZ2wubGVmdCA9IGdsLnggLSBnbC53aWR0aC8yO1xuICAgICAgICB9XG4gICAgICAgIGlmKGdsLnkpe1xuICAgICAgICAgIGdsLmhlaWdodCA9IE1hdGguY2VpbCgxMCAvIGdsLmNhbnZhcy52aWV3cG9ydFRyYW5zZm9ybVswXSk7XG4gICAgICAgICAgaWYoZ2wuaGVpZ2h0ICUgMil7XG4gICAgICAgICAgICBnbC5oZWlnaHQrKztcbiAgICAgICAgICB9XG4gICAgICAgICAgZ2wudG9wID0gZ2wueSAtIGdsLmhlaWdodC8yO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgIH0pO1xuXG5cbiAgICB0aGlzLmhSdWxlci5jYW52YXNFbGVtZW50Lm9uY2xpY2sgID0gZnVuY3Rpb24oZSl7XG4gICAgICB2YXIgcG9pbnRlciA9IF9jYW52YXMuZ2V0UG9pbnRlcihlKTtcbiAgICAgIF9jYW52YXMuY3JlYXRlR3VpZGxpbmUoe3ggOiBwb2ludGVyLnggfSlcbiAgICB9O1xuXG5cbiAgICB0aGlzLnZSdWxlci5jYW52YXNFbGVtZW50Lm9uY2xpY2sgID0gZnVuY3Rpb24oZSl7XG4gICAgICB2YXIgcG9pbnRlciA9IF9jYW52YXMuZ2V0UG9pbnRlcihlKTtcblxuICAgICAgX2NhbnZhcy5jcmVhdGVHdWlkbGluZSh7eSA6IHBvaW50ZXIueSB9KVxuICAgIH07XG4gIH1cbn0pO1xuXG4vKlxuZmFicmljLlNsaWRlQ2FudmFzLmFkZFBsdWdpbihcInNhdmVyc1wiLGZ1bmN0aW9uKHByb3BlcnRpZXNUb0luY2x1ZGUsIF9kYXRhKXtcbiAgaWYocHJvcGVydGllc1RvSW5jbHVkZS5pbmRleE9mKCdndWlkbGluZXMnKSAhPT0gLTEgJiYgdGhpcy5ndWlkbGluZXMpIHtcbiAgICBfZGF0YS5ndWlkbGluZXMgPSBbXTtcbiAgICB0aGlzLmd1aWRsaW5lcy5mb3JFYWNoKGZ1bmN0aW9uKF9nbCl7XG4gICAgICBpZihfZ2wueCl7XG4gICAgICAgIF9kYXRhLmd1aWRsaW5lcy5wdXNoKHt4IDogX2dsLnggfSlcbiAgICAgIH1cbiAgICAgIGlmKF9nbC55KXtcbiAgICAgICAgX2RhdGEuZ3VpZGxpbmVzLnB1c2goe3kgOiBfZ2wueSB9KVxuICAgICAgfVxuICAgIH0pXG4gIH1cbn0pOyovXG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL21vZHVsZXMvcnVsZXIuanMiLCIndXNlIHN0cmljdCc7XG5cblxuLy92YXIgX3NldF9iYWNrZ3JvdW5kX2ltYWdlX292ZXJ3cml0dGVuID0gZmFicmljLkNhbnZhcy5wcm90b3R5cGUuc2V0QmFja2dyb3VuZEltYWdlO1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5TdGF0aWNDYW52YXMucHJvdG90eXBlLCB7XG4gIC8qKlxuICAgKiBiYWNrZ3JvdW5kUG9zaXRpb25cbiAgICogQHZhbHVlcyBtYW51YWwgfCBjb3ZlciB8IGZpdFxuICAgKi9cbiAgYmFja2dyb3VuZFBvc2l0aW9uOiAnbWFudWFsJyxcbiAgc2V0QmFja2dyb3VuZFBvc2l0aW9uOiBmdW5jdGlvbiAoc3JjKSB7XG4gICAgdGhpcy5iYWNrZ3JvdW5kUG9zaXRpb24gPSBzcmM7XG4gICAgdGhpcy5fdXBkYXRlX2JhY2tncm91bmRfaW1hZ2UoKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfSxcbiAgb2Zmc2V0czoge1xuICAgIGxlZnQ6IDAsXG4gICAgcmlnaHQ6IDAsXG4gICAgYm90dG9tOiAwLFxuICAgIHRvcDogMFxuICB9LFxuXG4gIC8vIHNldEJhY2tncm91bmRJbWFnZTogZnVuY3Rpb24gKHNyYywgY2FsbGJhY2ssIG9wdGlvbnMpIHtcbiAgLy9cbiAgLy8gICBfc2V0X2JhY2tncm91bmRfaW1hZ2Vfb3ZlcndyaXR0ZW4uY2FsbCh0aGlzLCBzcmMsIGZ1bmN0aW9uICgpIHtcbiAgLy8gICAgIHRoaXMuX3VwZGF0ZV9iYWNrZ3JvdW5kX2ltYWdlKCk7XG4gIC8vICAgICBjYWxsYmFjayAmJiBjYWxsYmFjayh0aGlzLmJhY2tncm91bmRJbWFnZSk7XG4gIC8vICAgfS5iaW5kKHRoaXMpLCBvcHRpb25zKTtcbiAgLy8gICByZXR1cm4gdGhpcztcbiAgLy8gfSxcbiAgZmlsbEJhY2tncm91bmRDb2xvck92ZXJDYW52YXM6IGZhbHNlLFxuICBfcmVuZGVyQmFja2dyb3VuZE9yT3ZlcmxheTogZnVuY3Rpb24oY3R4LCBwcm9wZXJ0eSkge1xuICAgIHZhciBvYmplY3QgPSB0aGlzW3Byb3BlcnR5ICsgJ0NvbG9yJ107XG4gICAgaWYgKG9iamVjdCkge1xuICAgICAgY3R4LmZpbGxTdHlsZSA9IG9iamVjdC50b0xpdmVcbiAgICAgICAgPyBvYmplY3QudG9MaXZlKGN0eClcbiAgICAgICAgOiBvYmplY3Q7XG5cbiAgICAgIGlmKCF0aGlzLmZpbGxCYWNrZ3JvdW5kQ29sb3JPdmVyQ2FudmFzKXtcbiAgICAgICAgLy90b2RvIGRvISEhXG4gICAgICAgIGN0eC5maWxsUmVjdChcbiAgICAgICAgICBvYmplY3Qub2Zmc2V0WHx8ICB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzRdICogdGhpcy52aWV3cG9ydFRyYW5zZm9ybVswXSxcbiAgICAgICAgICBvYmplY3Qub2Zmc2V0WXx8ICB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzVdICogdGhpcy52aWV3cG9ydFRyYW5zZm9ybVswXSxcbiAgICAgICAgICB0aGlzLndpZHRoICp0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzBdLFxuICAgICAgICAgIHRoaXMuaGVpZ2h0ICogdGhpcy52aWV3cG9ydFRyYW5zZm9ybVswXSk7XG4gICAgICB9ZWxzZXtcbiAgICAgICAgY3R4LmZpbGxSZWN0KFxuXG4gICAgICAgICAgb2JqZWN0Lm9mZnNldFggfHwgMCxcbiAgICAgICAgICBvYmplY3Qub2Zmc2V0WSB8fCAwLFxuICAgICAgICAgIHRoaXMub3JpZ2luYWxXaWR0aCAsXG4gICAgICAgICAgdGhpcy5vcmlnaW5hbEhlaWdodCk7XG4gICAgICB9XG4gICAgfVxuICAgIG9iamVjdCA9IHRoaXNbcHJvcGVydHkgKyAnSW1hZ2UnXTtcbiAgICBpZihvYmplY3QgJiYgb2JqZWN0LmNvbnN0cnVjdG9yICE9PSBTdHJpbmcgJiYgIG9iamVjdC5jb25zdHJ1Y3RvciAhPT0gT2JqZWN0KXtcbiAgICAgICAgb2JqZWN0LnJlbmRlcihjdHgpO1xuICAgIH1cbiAgfSxcbiAgZ2V0SW1hZ2VEYXRhOiBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgIG9wdGlvbnMgPSBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKHtcbiAgICAgIGNsaXBwZWRfYXJlYTogZmFsc2UsXG4gICAgICBjbGlwcGVkX2FyZWFfb25seTogZmFsc2UsXG4gICAgICBkcmF3X2JhY2tncm91bmQ6IHRydWUsXG4gICAgICBmb3JtYXQ6ICdwbmcnLFxuICAgICAgcXVhbGl0eTogMC44XG4gICAgfSwgb3B0aW9ucyB8fCB7fSk7XG5cbiAgICB2YXIgc2l6ZTtcbiAgICBpZiAob3B0aW9ucy5jbGlwcGVkX2FyZWEpIHtcbiAgICAgIHNpemUgPSBvcHRpb25zLmNsaXBwZWRfYXJlYS5nZXRCb3VuZGluZ1JlY3QoKTtcbiAgICAgIHZhciBfem9vbSA9IHRoaXMuZ2V0Wm9vbSgpO1xuICAgICAgc2l6ZS5sZWZ0ICAgLz0gX3pvb207XG4gICAgICBzaXplLnRvcCAgICAvPSBfem9vbTtcbiAgICAgIHNpemUud2lkdGggIC89IF96b29tO1xuICAgICAgc2l6ZS5oZWlnaHQgLz0gX3pvb207XG4gICAgICBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKG9wdGlvbnMsIHNpemUpO1xuICAgIH0gZWxzZSB7XG4gICAgICBzaXplID0ge1xuICAgICAgICB3aWR0aDogb3B0aW9ucy53aWR0aCB8fCB0aGlzLm9yaWdpbmFsV2lkdGggfHwgdGhpcy53aWR0aCxcbiAgICAgICAgaGVpZ2h0OiBvcHRpb25zLmhlaWdodCB8fCB0aGlzLm9yaWdpbmFsSGVpZ2h0IHx8IHRoaXMuaGVpZ2h0LFxuICAgICAgfTtcblxuICAgICAgaWYgKG9wdGlvbnMuY2xpcHBlZF9hcmVhX29ubHkpIHtcbiAgICAgICAgc2l6ZS53aWR0aCAtPSB0aGlzLm9mZnNldHMubGVmdCArIHRoaXMub2Zmc2V0cy5yaWdodDtcbiAgICAgICAgc2l6ZS5oZWlnaHQgLT0gdGhpcy5vZmZzZXRzLnRvcCArIHRoaXMub2Zmc2V0cy5ib3R0b207XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChvcHRpb25zLnpvb20pIHtcbiAgICAgIHNpemUud2lkdGggKj0gb3B0aW9ucy56b29tO1xuICAgICAgc2l6ZS5oZWlnaHQgKj0gb3B0aW9ucy56b29tO1xuICAgIH1cblxuICAgIHZhciBjYW52YXMgPSBmYWJyaWMudXRpbC5jcmVhdGVDYW52YXNFbGVtZW50KCk7XG4gICAgY2FudmFzLndpZHRoID0gc2l6ZS53aWR0aDtcbiAgICBjYW52YXMuaGVpZ2h0ID0gc2l6ZS5oZWlnaHQ7XG5cbiAgICBvcHRpb25zLmxlZnQgPSBNYXRoLmZsb29yKG9wdGlvbnMubGVmdCk7XG4gICAgb3B0aW9ucy50b3AgPSBNYXRoLmZsb29yKG9wdGlvbnMudG9wKTtcbiAgICBvcHRpb25zLmhlaWdodCA9IE1hdGguY2VpbChvcHRpb25zLmhlaWdodCk7XG4gICAgb3B0aW9ucy53aWR0aCA9IE1hdGguY2VpbChvcHRpb25zLndpZHRoKTtcblxuICAgIHRoaXMucmVuZGVyVGh1bWIoY2FudmFzLCBvcHRpb25zKTtcblxuICAgIHZhciBzcmMgPSBjYW52YXMudG9EYXRhVVJMKG9wdGlvbnMpO1xuXG4gICAgdmFyIGJsb2IgPSBmYWJyaWMudXRpbC5kYXRhVVJJdG9CbG9iKHNyYywgJ2ltYWdlLycgKyBvcHRpb25zLmZvcm1hdCk7XG4gICAgdmFyIG9iamVjdFVSTCA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7XG4gICAgcmV0dXJuIHtcbiAgICAgIGRhdGFVUkw6IHNyYyxcbiAgICAgIGJsb2I6IGJsb2IsXG4gICAgICB1cmw6IG9iamVjdFVSTCxcbiAgICAgIGNhbnZhczogY2FudmFzXG4gICAgfTtcbiAgfSxcbiAgZ2V0T3JpZ2luYWxTaXplOiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHdpZHRoOiB0aGlzLm9yaWdpbmFsV2lkdGgsXG4gICAgICBoZWlnaHQ6IHRoaXMub3JpZ2luYWxIZWlnaHRcbiAgICB9XG4gIH0sXG5cblxuICAvLyBzZXRPZmZzZXRzOiBmdW5jdGlvbiAoX29mZnNldHMpIHtcbiAgLy8gICB0aGlzLm9mZnNldHMgPSBfb2Zmc2V0cyB8fCBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKHt9LCBmYWJyaWMuU2xpZGVDYW52YXMucHJvdG90eXBlLm9mZnNldHMpO1xuICAvLyAgIC8vdGhpcy5fdXBkYXRlX2NsaXBfcmVjdCgpO1xuICAvLyAgIHJldHVybiB0aGlzO1xuICAvLyB9LFxuICBnZXRSZWN0OiBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgIHZhciByZWN0ID0ge307XG5cbiAgICB2YXIgX3cgPSB0aGlzLm9yaWdpbmFsV2lkdGggfHwgdGhpcy53aWR0aDsgLy90aGlzLm9yaWdpbmFsV2lkdGhcbiAgICB2YXIgX2ZsZXhBcnJheSA9IGZhYnJpYy51dGlsLmZsZXgoX3cgLCBbe3ZhbHVlOiBvcHRpb25zLmxlZnQsIGZsZXg6IDB9LHt2YWx1ZTogb3B0aW9ucy53aWR0aCwgZmxleDogMX0se3ZhbHVlOiBvcHRpb25zLnJpZ2h0LCBmbGV4OiAwfV0gKTtcbiAgICByZWN0LmxlZnQgPSBfZmxleEFycmF5WzBdO1xuICAgIHJlY3Qud2lkdGggPSBfZmxleEFycmF5WzFdO1xuICAgIHJlY3QucmlnaHQgPSBfZmxleEFycmF5WzJdO1xuXG4gICAgdmFyIF9oID0gdGhpcy5vcmlnaW5hbEhlaWdodHx8IHRoaXMuaGVpZ2h0OyAgIC8vdGhpcy5vcmlnaW5hbEhlaWdodFxuICAgIHZhciBfZmxleEFycmF5ID0gZmFicmljLnV0aWwuZmxleChfaCAsIFt7dmFsdWU6IG9wdGlvbnMudG9wLCBmbGV4OiAwfSx7dmFsdWU6IG9wdGlvbnMuaGVpZ2h0LCBmbGV4OiAxfSx7dmFsdWU6IG9wdGlvbnMuYm90dG9tLCBmbGV4OiAwfV0gKTtcbiAgICByZWN0LnRvcCA9IF9mbGV4QXJyYXlbMF07XG4gICAgcmVjdC5oZWlnaHQgPSBfZmxleEFycmF5WzFdO1xuICAgIHJlY3QuYm90dG9tID0gX2ZsZXhBcnJheVsyXTtcblxuICAgIHJldHVybiByZWN0O1xuICB9LFxufSk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL21vZHVsZXMvcmVuZGVyLmpzIiwiZmFicmljLnV0aWwuY3JlYXRlVGh1bWIgPSBmdW5jdGlvbihzbGlkZSwgJGVsKXtcblxuICB2YXIgX2NhbnZhcyA9IHNsaWRlLmNhbnZhcyxcbiAgICAgIGZpcnN0RHJhdyA9IHRydWUsXG4gICAgICBtb2RpZmllZCxcbiAgICAgIF93ID0gKyRlbC5nZXRBdHRyaWJ1dGUoXCJ3aWR0aFwiKSxcbiAgICAgIF9oID0gKyRlbC5nZXRBdHRyaWJ1dGUoXCJoZWlnaHRcIik7XG5cbiAgaWYgKF9oKSB7XG4gICAgJGVsLnN0eWxlLmhlaWdodCA9ICRlbC5oZWlnaHQ7XG4gIH1cblxuICBmdW5jdGlvbiByZW5kZXJUaHVtYigpIHtcbiAgICBpZiAoX2NhbnZhcy5wcm9jZXNzaW5nIHx8ICFfY2FudmFzLmxvYWRlZCkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBfY2FudmFzLnJlbmRlclRodW1iKCRlbCk7XG4gICAgbW9kaWZpZWQgPSBfY2FudmFzLm1vZGlmaWVkO1xuICB9XG5cbiAgZnVuY3Rpb24gZm9yY2VSZW5kZXJUaHVtYigpIHtcbiAgICBpZiAodGhpcy5jYW52YXMpIHtcbiAgICAgIGlmICh0aGlzLmNhbnZhcy5sb2FkZWQpIHtcbiAgICAgICAgdGhpcy5jYW52YXMucmVuZGVyVGh1bWIoJGVsKTtcbiAgICAgIH1cbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGZpcnN0RHJhdyAmJiB0aGlzLmRhdGEudGh1bWIpIHtcbiAgICAgIHZhciBpbWcgPSBuZXcgSW1hZ2UoKTtcbiAgICAgIGltZy5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBjdHggPSAkZWwuZ2V0Q29udGV4dChcIjJkXCIpO1xuICAgICAgICBjdHguY2xlYXJSZWN0KDAsIDAsICRlbC53aWR0aCwgJGVsLmhlaWdodCk7XG4gICAgICAgIGN0eC5kcmF3SW1hZ2UoaW1nLCAwLCAwLCAkZWwud2lkdGgsICRlbC5oZWlnaHQpO1xuICAgICAgICBtb2RpZmllZCA9IHRoaXMubW9kaWZpZWQ7XG4gICAgICB9O1xuICAgICAgaW1nLnNyYyA9IHRoaXMuZGF0YS50aHVtYjtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoYXR0cnMuZm9yY2UgIT09IFwidHJ1ZVwiKSByZXR1cm47XG4gICAgdmFyIGNhbnZhcyA9IG5ldyBmYWJyaWMuU2xpZGVDYW52YXMobnVsbCwgdGhpcy5kYXRhLCBmdW5jdGlvbiAoKSB7XG4gICAgICBjYW52YXMucmVuZGVyVGh1bWIoJGVsKTtcbiAgICAgIC8vbW9kaWZpZWQgPSBzbGlkZS5tb2RpZmllZDtcbiAgICB9KTtcbiAgfVxuXG5cbiAgZnVuY3Rpb24gc2NhbGVUaHVtYigpIHtcblxuICAgIHZhciBfY29udGFpbmVyID0ge1xuICAgICAgd2lkdGg6IF93LFxuICAgICAgaGVpZ2h0OiBfaCxcbiAgICB9O1xuXG4gICAgdmFyIHNpemUgPSB7XG4gICAgICB3aWR0aDogc2xpZGUuY2FudmFzLm9yaWdpbmFsV2lkdGggfHwgc2xpZGUuY2FudmFzLndpZHRoLFxuICAgICAgaGVpZ2h0OiBzbGlkZS5jYW52YXMub3JpZ2luYWxIZWlnaHQgfHwgc2xpZGUuY2FudmFzLmhlaWdodFxuICAgIH07XG5cbiAgICB2YXIgX2ZpdFNpemUgPSBmYWJyaWMudXRpbC5nZXRQcm9wb3J0aW9ucyggc2l6ZSxfY29udGFpbmVyLFwiZml0XCIpO1xuXG4gICAgJGVsLndpZHRoID0gX2ZpdFNpemUud2lkdGg7XG4gICAgJGVsLmhlaWdodCA9IF9maXRTaXplLmhlaWdodDtcblxuXG4gICAgJGVsLnN0eWxlLndpZHRoID0gX2ZpdFNpemUud2lkdGggKyAncHgnO1xuICAgICRlbC5zdHlsZS5oZWlnaHQgPSBfZml0U2l6ZS5oZWlnaHQgICsgJ3B4JztcbiAgICByZW5kZXJUaHVtYigpO1xuICB9XG5cbiAgZnVuY3Rpb24gY2FudmFzQ2hhbmdlZCgpIHtcbiAgICAvLyBfY2FudmFzICYmIF9jYW52YXMub2ZmKCdhZnRlcjpyZW5kZXInLCByZW5kZXJUaHVtYik7XG4gICAgLy8gaWYgKHRoaXMuY2FudmFzKSB7XG4gICAgICAvLyBfY2FudmFzID0gc2NvcGUuZmZUaHVtYi5jYW52YXM7XG4gICAgICB0aGlzLmNhbnZhcy5vbignYWZ0ZXI6cmVuZGVyJywgcmVuZGVyVGh1bWIpO1xuICAgICAgdGhpcy5jYW52YXMub24oXCJkaW1lbnNpb25zOm1vZGlmaWVkXCIsIHNjYWxlVGh1bWIpO1xuICAgICAgdGhpcy5jYW52YXMub24oXCJsb2FkaW5nOmVuZFwiLCBzY2FsZVRodW1iKTtcbiAgICAvLyB9XG4gIH1cblxuXG4gICRlbC5zZXRBdHRyaWJ1dGUoXCJ0aXRsZVwiLCBzbGlkZS50aXRsZSk7XG4gIHNsaWRlLm9uKCdjYW52YXM6Y2hhbmdlZCcsIGNhbnZhc0NoYW5nZWQpO1xuICBzbGlkZS5vbignbW9kaWZpZWQnLCBmb3JjZVJlbmRlclRodW1iKTtcblxuICBzY2FsZVRodW1iLmNhbGwoc2xpZGUpO1xuICBmb3JjZVJlbmRlclRodW1iLmNhbGwoc2xpZGUpO1xuICBjYW52YXNDaGFuZ2VkLmNhbGwoc2xpZGUpO1xuXG59O1xuXG5cblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuU3RhdGljQ2FudmFzLnByb3RvdHlwZSwge1xuICByZW5kZXJUaHVtYjogZnVuY3Rpb24gKGNhbnZhcywgb3B0aW9ucykge1xuICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHtcbiAgICAgICAgb2JqZWN0czogdHJ1ZSxcbiAgICAgICAgY2xpcHBlZF9hcmVhX29ubHk6IGZhbHNlLFxuICAgICAgICBkcmF3X2JhY2tncm91bmQ6IHRydWVcbiAgICAgIH07XG5cbiAgICBpZiAob3B0aW9ucy56b29tKSB7XG4gICAgICB2YXIgX3pvb20gPSBvcHRpb25zLnpvb207XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChjYW52YXMud2lkdGgpIHtcbiAgICAgICAgdmFyIF96b29tID0gY2FudmFzLndpZHRoIC8gKHRoaXMub3JpZ2luYWxXaWR0aCB8fCB0aGlzLndpZHRoKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIF96b29tID0gMTtcbiAgICAgIH1cbiAgICB9XG4gICAgdmFyIF9vbGRfU2NhbGUgPSB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzBdO1xuICAgIHZhciBvbGRfeCA9IHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bNF07XG4gICAgdmFyIG9sZF95ID0gdGhpcy52aWV3cG9ydFRyYW5zZm9ybVs1XTtcbiAgICB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzRdID0gdGhpcy52aWV3cG9ydFRyYW5zZm9ybVs1XSA9IDA7XG4gICAgdGhpcy52aWV3cG9ydFRyYW5zZm9ybVswXSA9IHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bM10gPSAxO1xuXG4gICAgdGhpcy52aWV3cG9ydFRyYW5zZm9ybVswXSA9IHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bM10gPSBfem9vbTtcbiAgICAvL3RoaXMuX3VwZGF0ZV9jbGlwX3JlY3QoKTtcblxuICAgIGlmICh0aGlzLmNsaXBSZWN0KSB7XG4gICAgICB0aGlzLmNsaXBSZWN0LnNldE9wYWNpdHkoMCk7XG4gICAgfVxuXG4gICAgdmFyIHNpemUgPSB7XG4gICAgICB3aWR0aDogdGhpcy5vcmlnaW5hbFdpZHRoIHx8IHRoaXMud2lkdGgsXG4gICAgICBoZWlnaHQ6IHRoaXMub3JpZ2luYWxIZWlnaHQgfHwgdGhpcy5oZWlnaHRcbiAgICB9O1xuICAgIHNpemUud2lkdGggPSBNYXRoLmNlaWwoc2l6ZS53aWR0aCAqIF96b29tKTtcbiAgICBzaXplLmhlaWdodCA9IE1hdGguY2VpbChzaXplLmhlaWdodCAqIF96b29tKTtcblxuICAgIHZhciBfY2FudmFzID0gZmFicmljLnV0aWwuY3JlYXRlQ2FudmFzRWxlbWVudCgpO1xuICAgIF9jYW52YXMud2lkdGggPSBzaXplLndpZHRoO1xuICAgIF9jYW52YXMuaGVpZ2h0ID0gc2l6ZS5oZWlnaHQ7XG5cbiAgICB2YXIgY2FudmFzVG9EcmF3T24gPSBfY2FudmFzLmdldENvbnRleHQoJzJkJyksIG9ianNUb1JlbmRlcjtcblxuICAgIHRoaXMuY2xlYXJDb250ZXh0KGNhbnZhc1RvRHJhd09uKTtcbiAgICBjYW52YXNUb0RyYXdPbi5zYXZlKCk7XG4gICAgY2FudmFzVG9EcmF3T24udHJhbnNmb3JtLmFwcGx5KGNhbnZhc1RvRHJhd09uLCB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtKTtcblxuICAgIGlmIChvcHRpb25zLmRyYXdfYmFja2dyb3VuZCkge1xuICAgICAgdGhpcy5fcmVuZGVyQmFja2dyb3VuZChjYW52YXNUb0RyYXdPbik7XG4gICAgICAvL2lmICh0aGlzLl9iYWNrZ3JvdW5kTGF5ZXIpIHtcbiAgICAgIC8vICB0aGlzLl9yZW5kZXJPYmplY3RzKGNhbnZhc1RvRHJhd09uLCB0aGlzLl9iYWNrZ3JvdW5kTGF5ZXIpO1xuICAgICAgLy99XG4gICAgfVxuXG4gICAgaWYgKCFvcHRpb25zLmNsaXBwZWRfYXJlYV9vbmx5ICYmIHRoaXMuY2xpcFRvKSB7XG4gICAgICBmYWJyaWMudXRpbC5jbGlwQ29udGV4dCh0aGlzLCBjYW52YXNUb0RyYXdPbik7XG4gICAgfVxuXG4gICAgdmFyIF9vYmplY3RzO1xuICAgIGlmIChvcHRpb25zLm9iamVjdHMgJiYgb3B0aW9ucy5vYmplY3RzLmNvbnN0cnVjdG9yID09PSBBcnJheSkge1xuICAgICAgX29iamVjdHMgPSBvcHRpb25zLm9iamVjdHM7XG4gICAgfSBlbHNlIHtcbiAgICAgIF9vYmplY3RzID0gb3B0aW9ucy5vYmplY3RzICE9PSBmYWxzZSA/IHRoaXMuX29iamVjdHMgOiBbXTtcbiAgICB9XG4gICAgaWYgKG9wdGlvbnMuY2xpcHBlZF9hcmVhKSB7XG4gICAgICBfb2JqZWN0cyA9IGZhYnJpYy51dGlsLm9iamVjdC5jbG9uZShfb2JqZWN0cyk7XG4gICAgICBmb3IgKHZhciBpID0gX29iamVjdHMubGVuZ3RoOyBpLS07KSB7XG4gICAgICAgIGlmIChfb2JqZWN0c1tpXS5jbGlwVG8gIT09IG9wdGlvbnMuY2xpcHBlZF9hcmVhKSB7XG4gICAgICAgICAgX29iamVjdHMuc3BsaWNlKGksIDEpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIC8vIGlmIChmYWJyaWMudmVyc2lvbiA+PSAxLjYpIHtcbiAgICB0aGlzLl9yZW5kZXJPYmplY3RzKGNhbnZhc1RvRHJhd09uLCBfb2JqZWN0cyk7XG4gICAgLy8gfSBlbHNlIHtcbiAgICAvLyAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBfb2JqZWN0cy5sZW5ndGg7IGkgPCBsZW5ndGg7ICsraSkge1xuICAgIC8vICAgICB0aGlzLl9kcmF3KGNhbnZhc1RvRHJhd09uLCBfb2JqZWN0c1tpXSk7XG4gICAgLy8gICB9XG4gICAgLy8gfVxuXG5cbiAgICBjYW52YXNUb0RyYXdPbi5yZXN0b3JlKCk7XG4gICAgaWYgKCFvcHRpb25zLmNsaXBwZWRfYXJlYV9vbmx5ICYmIHRoaXMuY2xpcFRvKSB7XG4gICAgICBjYW52YXNUb0RyYXdPbi5yZXN0b3JlKCk7XG4gICAgfVxuICAgIHRoaXMuX3JlbmRlck92ZXJsYXkoY2FudmFzVG9EcmF3T24pO1xuICAgIGNhbnZhc1RvRHJhd09uLnJlc3RvcmUoKTtcbiAgICBpZiAodGhpcy5jbGlwUmVjdCkge1xuICAgICAgdGhpcy5jbGlwUmVjdC5zZXRPcGFjaXR5KDEpO1xuICAgIH1cbiAgICB2YXIgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpO1xuICAgIGlmIChvcHRpb25zLmNsaXBwZWRfYXJlYV9vbmx5ICYmIHRoaXMuY2xpcFJlY3QpIHtcbiAgICAgIHZhciBfcmVjdCA9IHtcbiAgICAgICAgbGVmdDogdGhpcy5jbGlwUmVjdC5sZWZ0ICogX3pvb20sXG4gICAgICAgIHRvcDogdGhpcy5jbGlwUmVjdC50b3AgKiBfem9vbSxcbiAgICAgICAgd2lkdGg6IHRoaXMuY2xpcFJlY3Qud2lkdGggKiBfem9vbSxcbiAgICAgICAgaGVpZ2h0OiB0aGlzLmNsaXBSZWN0LmhlaWdodCAqIF96b29tXG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgX3JlY3QgPSB7XG4gICAgICAgIGxlZnQ6IG9wdGlvbnMubGVmdCAqIF96b29tIHx8IDAsXG4gICAgICAgIHRvcDogb3B0aW9ucy50b3AgKiBfem9vbSB8fCAwLFxuICAgICAgICB3aWR0aDogb3B0aW9ucy53aWR0aCAqIF96b29tIHx8IHNpemUud2lkdGgsXG4gICAgICAgIGhlaWdodDogb3B0aW9ucy5oZWlnaHQgKiBfem9vbSB8fCBzaXplLmhlaWdodFxuICAgICAgfTtcbiAgICB9XG4gICAgaWYgKG9wdGlvbnMuYW5nbGUpIHtcbiAgICAgIGN0eC5yb3RhdGUoLW9wdGlvbnMuYW5nbGUgKiBNYXRoLlBJIC8gMTgwKTtcbiAgICAgIGN0eC5kcmF3SW1hZ2UoX2NhbnZhcyxcbiAgICAgICAgMCwgMCwgX3JlY3Qud2lkdGggKyBfcmVjdC5sZWZ0ICsgX2NhbnZhcy53aWR0aCwgX3JlY3QuaGVpZ2h0ICsgX3JlY3QudG9wICsgX2NhbnZhcy5oZWlnaHQsXG4gICAgICAgIC1fcmVjdC5sZWZ0LCAtX3JlY3QudG9wLCBjYW52YXMud2lkdGggKyBfcmVjdC5sZWZ0ICsgX2NhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCArIF9yZWN0LnRvcCArIF9jYW52YXMuaGVpZ2h0KTtcbiAgICB9IGVsc2Uge1xuICAgICAgY3R4LmRyYXdJbWFnZShfY2FudmFzLCBfcmVjdC5sZWZ0LCBfcmVjdC50b3AsIF9yZWN0LndpZHRoLCBfcmVjdC5oZWlnaHQsIDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7XG4gICAgfVxuXG4gICAgdGhpcy52aWV3cG9ydFRyYW5zZm9ybVswXSA9IHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bM10gPSBfb2xkX1NjYWxlO1xuICAgIC8vIHRoaXMuX3VwZGF0ZV9iYWNrZ3JvdW5kX2ltYWdlKCk7XG4gICAgLy90aGlzLl91cGRhdGVfY2xpcF9yZWN0KCk7XG5cbiAgICB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzRdID0gb2xkX3g7XG4gICAgdGhpcy52aWV3cG9ydFRyYW5zZm9ybVs1XSA9IG9sZF95O1xuXG5cbiAgICByZXR1cm4gY2FudmFzO1xuICB9XG59KTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvbW9kdWxlcy90aHVtYi5qcyIsInJlcXVpcmUoXCIuL3NsaWRlLmFyZWFzXCIpO1xucmVxdWlyZShcIi4vZ3JvdXBzXCIpO1xuXG4vLyB0b2RvINGN0YLQviDRg9Cx0YDQsNGC0Yxcbi8vZmFicmljLm1vdmVtZW50c0xpbWl0c0Vhc3kgPSBmYWxzZTtcbnZhciBfdG9PYmplY3Rfb3ZlcndyaXR0ZW4gPSBmYWJyaWMuT2JqZWN0LnByb3RvdHlwZS50b09iamVjdDtcbi8vdG9kbyB1c2UgZXZlbnQgXCJiZWZvcmU6b2JqZWN0XCI7XG5cbmZhYnJpYy5PYmplY3QucHJvdG90eXBlLnRvT2JqZWN0ID0gZnVuY3Rpb24gKHByb3BlcnRpZXNUb0luY2x1ZGUpIHtcbiAgdmFyIG9iaiA9IF90b09iamVjdF9vdmVyd3JpdHRlbi5jYWxsKHRoaXMscHJvcGVydGllc1RvSW5jbHVkZSk7XG4gIHZhciBfc3RvcmVBbGwgPSB0aGlzLnN0b3JlUHJvcGVydGllcy5pbmRleE9mKFwiKlwiKSAhPSAtMTtcbiAgaWYgKHRoaXMuY2xpcFRvICYmIHRoaXMuY2xpcFRvLmlkICYmIChfc3RvcmVBbGwgfHwgdGhpcy5zdG9yZVByb3BlcnRpZXMuaW5kZXhPZihcImNsaXBUb1wiKSAhPSAtMSkpIHtcbiAgICBvYmouY2xpcFRvID0gJyMnICsgdGhpcy5jbGlwVG8uaWRcbiAgfVxuICBpZiAoIHRoaXMubW92ZW1lbnRMaW1pdHMgJiYgIChfc3RvcmVBbGwgfHwgdGhpcy5zdG9yZVByb3BlcnRpZXMuaW5kZXhPZihcIm1vdmVtZW50TGltaXRzXCIpICE9IC0xKSkge1xuICAgIG9iai5tb3ZlbWVudExpbWl0cyA9IHRoaXMubW92ZW1lbnRMaW1pdHMuaWQgPyAnIycgKyB0aGlzLm1vdmVtZW50TGltaXRzLmlkIDogdGhpcy5tb3ZlbWVudExpbWl0cztcbiAgfVxuICByZXR1cm4gb2JqO1xufTtcblxudmFyIF9zY2FsZU9iamVjdF9vdmVyd3JpdHRlbiA9IGZhYnJpYy5DYW52YXMucHJvdG90eXBlLl9zY2FsZU9iamVjdDtcblxuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5PYmplY3QucHJvdG90eXBlLCB7XG4gIHNldFdob2xlQ29vcmRpbmF0ZXM6IGZ1bmN0aW9uKHZhbCl7XG4gICAgdGhpcy53aG9sZUNvb3JkaW5hdGVzID0gdmFsO1xuICAgIHRoaXMub24oXCJhZGRlZCBtb2RpZmllZFwiLGZ1bmN0aW9uKCl7XG4gICAgICBpZih0aGlzLndob2xlQ29vcmRpbmF0ZXMpe1xuICAgICAgICB0aGlzLnNldCh7XG4gICAgICAgICAgbGVmdDogTWF0aC5yb3VuZCh0aGlzLmxlZnQpLFxuICAgICAgICAgIHRvcDogTWF0aC5yb3VuZCh0aGlzLnRvcCksXG4gICAgICAgICAgd2lkdGg6IE1hdGgucm91bmQodGhpcy53aWR0aCksXG4gICAgICAgICAgaGVpZ2h0OiBNYXRoLnJvdW5kKHRoaXMuaGVpZ2h0KVxuICAgICAgICB9KVxuICAgICAgfVxuICAgIH0sdHJ1ZSlcbiAgfSxcbiAgLy8gc2V0VG9wOiBmdW5jdGlvbih2YWwpe1xuICAvLyAgIGlmKHRoaXMud2hvbGVDb29yZGluYXRlcyl7XG4gIC8vICAgICB2YWwgPSBNYXRoLnJvdW5kKHZhbCk7XG4gIC8vICAgfVxuICAvLyAgIHRoaXMudG9wID0gdmFsO1xuICAvLyB9LFxuICAvLyBzZXRMZWZ0OiBmdW5jdGlvbih2YWwpe1xuICAvLyAgIGlmKHRoaXMud2hvbGVDb29yZGluYXRlcyl7XG4gIC8vICAgICB2YWwgPSBNYXRoLnJvdW5kKHZhbCk7XG4gIC8vICAgfVxuICAvLyAgIHRoaXMubGVmdCA9IHZhbDtcbiAgLy8gfSxcbiAgLy8gc2V0V2lkdGg6IGZ1bmN0aW9uKHcpe1xuICAvLyAgIGlmKHRoaXMud2hvbGVDb29yZGluYXRlcyl7XG4gIC8vICAgICB3ID0gTWF0aC5yb3VuZCh3KTtcbiAgLy8gICB9XG4gIC8vICAgdGhpcy53aWR0aCA9IHc7XG4gIC8vIH0sXG4gIC8vIHNldEhlaWdodDogZnVuY3Rpb24oaCl7XG4gIC8vICAgaWYodGhpcy53aG9sZUNvb3JkaW5hdGVzKXtcbiAgLy8gICAgIGggPSBNYXRoLnJvdW5kKGgpO1xuICAvLyAgIH1cbiAgLy8gICB0aGlzLmhlaWdodCA9IGg7XG4gIC8vIH0sXG4gIC8vIHNwZWNpYWxQcm9wZXJ0aWVzOiBmYWJyaWMuT2JqZWN0LnByb3RvdHlwZS5zcGVjaWFsUHJvcGVydGllcy5jb25jYXQoW1wibW92ZW1lbnRMaW1pdHNcIl0pLFxuXG4gIHNldEFjdGl2ZTogZnVuY3Rpb24odmFsdWUpe1xuICAgIGlmKCF0aGlzLmNhbnZhcyl7XG4gICAgICB0aGlzLm9uKFwiYWRkZWRcIixmdW5jdGlvbigpe1xuICAgICAgICBpZih0aGlzLmNhbnZhcy5pbnRlcmFjdGl2ZSl7XG4gICAgICAgICAgdGhpcy5jYW52YXMuc2V0QWN0aXZlT2JqZWN0KHRoaXMpO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgIH1cblxuICAgIHRoaXMuYWN0aXZlID0gdmFsdWU7XG5cbiAgfSxcbiAgc2V0UG9zaXRpb246IGZ1bmN0aW9uKF9wb3NpdGlvbil7XG4gICAgaWYoX3Bvc2l0aW9uID09PSBcImNlbnRlclwiKSB7XG4gICAgICB0aGlzLm9uKFwiYWRkZWRcIixmdW5jdGlvbigpe1xuICAgICAgICB0aGlzLmNhbnZhcy5maXRPYmplY3QodGhpcyk7XG4gICAgICB9KVxuICAgIH1cbiAgfSxcblxuICBzZXRNb3ZlbWVudExpbWl0czogZnVuY3Rpb24gKHZhbCkge1xuXG5cbiAgICBpZighdGhpcy5tb3ZlbWVudExpbWl0cyl7XG4gICAgICB0aGlzLm9uKHtcbiAgICAgICAgYWRkZWQ6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgaWYoIHRoaXMuY2FudmFzLmludGVyYWN0aXZlKXtcbiAgICAgICAgICAgIHRoaXMuY2FudmFzLl9jaGVja19vYmplY3RfcG9zaXRpb24odGhpcyk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICByb3RhdGVkOiBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICB2YXIgdGFyZ2V0ID0gdGhpcztcblxuICAgICAgICAgIGlmICh0YXJnZXQucmVzaXphYmxlKSB7XG4gICAgICAgICAgICBpZiAocG9zLmxlZnQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICBpZiAodGFyZ2V0LmxlZnQgPCBwb3MubGVmdCkge1xuICAgICAgICAgICAgICAgIHRhcmdldC53aWR0aCArPSB0YXJnZXQubGVmdCAtIHBvcy5sZWZ0O1xuICAgICAgICAgICAgICAgIHRhcmdldC5sZWZ0ID0gcG9zLmxlZnQ7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGFyZ2V0LndpZHRoIC09IHRhcmdldC5sZWZ0IC0gcG9zLmxlZnQ7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChwb3MudG9wICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgaWYgKHRhcmdldC50b3AgPCBwb3MudG9wKSB7XG4gICAgICAgICAgICAgICAgdGFyZ2V0LmhlaWdodCArPSB0YXJnZXQudG9wIC0gcG9zLnRvcDtcbiAgICAgICAgICAgICAgICB0YXJnZXQudG9wID0gcG9zLnRvcDtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0YXJnZXQuaGVpZ2h0IC09IHRhcmdldC50b3AgLSBwb3MudG9wO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIHRoaXMuY2FudmFzLl9jaGVja19vYmplY3RfcG9zaXRpb24odGhpcylcbiAgICAgICAgfSxcbiAgICAgICAgbW9kaWZpZWQ6IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgIHRoaXMuY2FudmFzLl9jaGVja19vYmplY3RfYWZ0ZXJfbW9kaWZpZWQodGhpcylcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICAgIHRoaXMubW92ZW1lbnRMaW1pdHMgPSB2YWw7XG5cbiAgIC8qIGlmKHRoaXMuY2FudmFzKXtcbiAgICAgIHRoaXMuX3NldE1vdmVtZW50TGltaXRzU3RyaW5nKCk7XG4gICAgfSovXG5cbiAgfVxufSk7XG5cblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuU3RhdGljQ2FudmFzLnByb3RvdHlwZSwge1xuICBmaXRPYmplY3Q6IGZ1bmN0aW9uIChlbCkge1xuICAgIHZhciBfcmVjdCwgbWF4U2l6ZSwgbyA9IHRoaXMub2Zmc2V0cztcblxuICAgIGlmKCFlbC5tb3ZlbWVudExpbWl0cyB8fCBlbC5tb3ZlbWVudExpbWl0cyA9PSBcImNhbnZhc1wiKXtcbiAgICAgIHZhciBfem9vbSA9IHRoaXMuZ2V0Wm9vbSgpO1xuICAgICAgdmFyIF93ID0gdGhpcy5vcmlnaW5hbFdpZHRoIHx8IHRoaXMud2lkdGggLyBfem9vbTtcbiAgICAgIHZhciBfaCA9IHRoaXMub3JpZ2luYWxIZWlnaHQgfHwgdGhpcy5oZWlnaHQgLyBfem9vbTtcbiAgICAgIF9yZWN0ID0ge1xuICAgICAgICB3aWR0aDogbyA/IChfdyAtIG8ubGVmdCAtIG8ucmlnaHQpIDogX3csXG4gICAgICAgIGhlaWdodDogbyA/KF9oIC0gby50b3AgLSBvLmJvdHRvbSkgOiBfaFxuICAgICAgfTtcbiAgICAgIC8qIG9mZnNldHMgPSB7XG4gICAgICAgbGVmdDogbyAmJiBvLnRvcCB8fDAgLFxuICAgICAgIHRvcDogIG8gJiYgIG8ubGVmdCB8fDBcbiAgICAgICB9Ki9cbiAgICB9ZWxzZSBpZihlbC5tb3ZlbWVudExpbWl0cy5jb25zdHJ1Y3RvciAhPT0gRnVuY3Rpb24pe1xuICAgICAgdmFyIGxpbSA9IGVsLm1vdmVtZW50TGltaXRzO1xuICAgICAgX3JlY3QgPSB7XG4gICAgICAgIGxlZnQ6ICAgbGltLmxlZnQgKiBsaW0uc2NhbGVYLFxuICAgICAgICB3aWR0aDogIGxpbS53aWR0aCAqIGxpbS5zY2FsZVggLFxuICAgICAgICB0b3A6ICAgIGxpbS50b3AgKiBsaW0uc2NhbGVZLFxuICAgICAgICBoZWlnaHQ6IGxpbS5oZWlnaHQgKiBsaW0uc2NhbGVZXG4gICAgICB9O1xuICAgICAgLy9tYXhTaXplID0gX3JlY3Q7XG4gICAgICAvLyBvZmZzZXRzID0gbGltO1xuICAgIH1cbiAgICBtYXhTaXplID0ge1xuICAgICAgd2lkdGg6IF9yZWN0LndpZHRoICogdGhpcy5maXRJbmRleCxcbiAgICAgIGhlaWdodDogX3JlY3QuaGVpZ2h0ICogdGhpcy5maXRJbmRleFxuICAgIH07XG4gICAgdmFyIHNpemUgPSBmYWJyaWMudXRpbC5nZXRQcm9wb3J0aW9ucyhlbCwgbWF4U2l6ZSwgJ2ZpdCcpO1xuXG4gICAgaWYoZWwucmVzaXphYmxlKXtcbiAgICAgIGVsLnNldE9wdGlvbnMoe1xuICAgICAgICB3aWR0aDogZWwud2lkdGggKiBzaXplLnNjYWxlLFxuICAgICAgICBoZWlnaHQ6IGVsLmhlaWdodCAqIHNpemUuc2NhbGVcbiAgICAgIH0pO1xuICAgICAgZWwudXBkYXRlRWxlbWVudCgpO1xuICAgIH1lbHNle1xuICAgICAgZWwuc2V0T3B0aW9ucyh7XG4gICAgICAgIHNjYWxlWDogc2l6ZS5zY2FsZSxcbiAgICAgICAgc2NhbGVZOiBzaXplLnNjYWxlXG4gICAgICB9KTtcbiAgICB9XG4gICAgdGhpcy5jZW50ZXJPYmplY3QoZWwpO1xuICAgIGVsLnNldENvb3JkcygpO1xuICB9LFxuICAvL2ZpeCBnZXRjZW50ZXIgZnVuY3Rpb25cbiAgY2VudGVyT2JqZWN0OiBmdW5jdGlvbiAob2JqZWN0KSB7XG4gICAgdmFyIGNlbnRlcjtcbiAgICBpZiAob2JqZWN0Lm1vdmVtZW50TGltaXRzKSB7XG5cbiAgICAgIGNlbnRlciA9IHRoaXMuX2dldE1vdmVtZW50c0xpbWl0c0NlbnRlcihvYmplY3QubW92ZW1lbnRMaW1pdHMpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjZW50ZXIgPSB0aGlzLmdldENlbnRlcigpO1xuICAgIH1cbiAgICB0aGlzLl9jZW50ZXJPYmplY3Qob2JqZWN0LCBuZXcgZmFicmljLlBvaW50KGNlbnRlci5sZWZ0LCBjZW50ZXIudG9wKSk7XG4gICAgdGhpcy5yZW5kZXJBbGwoKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfSxcbiAgZ2V0Q2VudGVyOiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHRvcDogdGhpcy5vcmlnaW5hbEhlaWdodCB8fCB0aGlzLmhlaWdodCAvIDIgLyB0aGlzLmdldFpvb20oKSxcbiAgICAgIGxlZnQ6IHRoaXMub3JpZ2luYWxXaWR0aCB8fCB0aGlzLndpZHRoIC8gMiAvIHRoaXMuZ2V0Wm9vbSgpXG4gICAgfTtcbiAgfSxcblxuICBtb3ZlbWVudExpbWl0czoge1xuICAgIGxlZnQ6IGZhbHNlLFxuICAgIHRvcDogZmFsc2UsXG4gICAgcmlnaHQ6IGZhbHNlLFxuICAgIGJvdHRvbTogZmFsc2VcbiAgfSxcbiAgc2V0TW92ZW1lbnRMaW1pdHM6IGZ1bmN0aW9uIChfb2Zmc2V0cykge1xuICAgIHRoaXMubW92ZW1lbnRMaW1pdHMgPSBfb2Zmc2V0cztcblxuICAgIHJldHVybiB0aGlzO1xuICB9LFxuICAvL2NvbnRlbnQg0YXQvtGC0Y8g0LHRiyAg0L/QuNC60YHQtdC70Ywg0L7QsdGK0LXQutGC0LAg0LTQvtC70LbQtdC9INCx0YvRgtGMINCy0L3Rg9GC0YDQuCDQt9C+0L3Ri1xuICAvL2ZpdCDQt9C+0L3QsCDQtNC+0LvQttC90L4g0L/QvtC70L3QvtGB0YLRjNGOINC90LDRhdC+0LTQuNGC0YHRjyDQstC90YPRgtGA0Lgg0L7QsdGK0LXQutGC0LBcbiAgbW92ZW1lbnRMaW1pdE1vZGU6IFwiZml0XCIsXG4gIF9nZXRNb3ZlbWVudHNMaW1pdHNDZW50ZXI6IGZ1bmN0aW9uKG1vdmVtZW50TGltaXRzKXtcblxuICAgIGlmIChtb3ZlbWVudExpbWl0cyA9PT0gJ2NhbnZhcycpIHtcbiAgICAgIHZhciBvID0gdGhpcy5vZmZzZXRzO1xuICAgICAgdmFyIF93ID0gdGhpcy5vcmlnaW5hbFdpZHRoIHx8IHRoaXMud2lkdGg7XG4gICAgICB2YXIgX2ggPSB0aGlzLm9yaWdpbmFsSGVpZ2h0IHx8IHRoaXMuaGVpZ2h0O1xuICAgICAgcmV0dXJuIHt0b3A6IG8udG9wICsgKF9oIC0gby50b3AgLSBvLmJvdHRvbSkgLzIgICwgbGVmdDogIG8ubGVmdCArIChfdyAtIG8ubGVmdCAtIG8ucmlnaHQpIC8yfTtcbiAgICB9XG5cbiAgICBpZih0eXBlb2YgbW92ZW1lbnRMaW1pdHMgPT0gXCJzdHJpbmdcIil7XG4gICAgICB2YXIgb2JqID0gdGhpcy5nZXRPYmplY3RCeUlEKG1vdmVtZW50TGltaXRzLnN1YnN0cigxKSk7XG4gICAgfWVsc2V7XG4gICAgICBvYmogPSBtb3ZlbWVudExpbWl0cztcbiAgICB9XG5cbiAgICB2YXIgX3h5ID0gb2JqLmdldENlbnRlclBvaW50KCk7XG4gICAgcmV0dXJuIHt0b3A6IF94eS55LCBsZWZ0OiBfeHkueH07XG4gIH0sXG4gIF9nZXRNb3ZlbWVudHNMaW1pdHNSZWN0OiBmdW5jdGlvbihtb3ZlbWVudExpbWl0cyl7XG5cbiAgICB2YXIgbyA9IHRoaXMub2Zmc2V0cztcbiAgICB2YXIgX3cgPSB0aGlzLm9yaWdpbmFsV2lkdGggfHwgdGhpcy53aWR0aDtcbiAgICB2YXIgX2ggPSB0aGlzLm9yaWdpbmFsSGVpZ2h0IHx8IHRoaXMuaGVpZ2h0O1xuXG4gICAgaWYobW92ZW1lbnRMaW1pdHMuY29uc3RydWN0b3IgIT09IFN0cmluZyl7XG4gICAgICByZXR1cm4gbW92ZW1lbnRMaW1pdHM7XG4gICAgfVxuXG4gICAgdmFyIHNjYWxlID0gdGhpcy52aWV3cG9ydFRyYW5zZm9ybVswXTtcblxuICAgIGlmIChtb3ZlbWVudExpbWl0cyA9PT0gJ2NhbnZhcycpIHtcblxuICAgICAgdmFyIHJlY3QgPSB7XG4gICAgICAgIGxlZnQ6IG8ubGVmdCxcbiAgICAgICAgdG9wOiBvLnRvcCxcbiAgICAgICAgd2lkdGg6IF93IC0gby5sZWZ0IC0gby5yaWdodCxcbiAgICAgICAgaGVpZ2h0OiBfaCAtIG8udG9wIC0gby5ib3R0b20sXG4gICAgICAgIHJpZ2h0OiBvLnJpZ2h0LFxuICAgICAgICBib3R0b206IG8uYm90dG9tXG4gICAgICB9XG5cbiAgICAgIHJlY3Qud2lkdGggKj0gc2NhbGU7XG4gICAgICByZWN0LmhlaWdodCAqPSBzY2FsZTtcbiAgICAgIHJldHVybiByZWN0O1xuICAgIH1lbHNle1xuICAgICAgdmFyIG9iaiA9IHRoaXMuZ2V0T2JqZWN0QnlJRChtb3ZlbWVudExpbWl0cy5zdWJzdHIoMSkpO1xuICAgICAgdmFyIF9zdHJva2Vfd2lkdGggPSBvYmouc3Ryb2tlV2lkdGg7XG4gICAgICBvYmouc3Ryb2tlV2lkdGggPSAwO1xuXG4gICAgICBvYmouc2V0Q29vcmRzKCk7XG4gICAgICB2YXIgcmVjdCA9IG9iai5nZXRCb3VuZGluZ1JlY3QoKTtcblxuICAgICAgb2JqLnN0cm9rZVdpZHRoID0gX3N0cm9rZV93aWR0aDtcblxuXG4gICAgICByZWN0LmxlZnQgLz0gc2NhbGU7XG4gICAgICByZWN0LnRvcCAvPSBzY2FsZTtcbiAgICAgIHJlY3Qud2lkdGggLz0gc2NhbGU7XG4gICAgICByZWN0LmhlaWdodCAvPSBzY2FsZTtcbiAgICAgIHJlY3QubGVmdCAtPSB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzRdIC8gc2NhbGU7XG4gICAgICByZWN0LnRvcCAtPSB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzVdIC8gc2NhbGU7XG5cbiAgICAgIC8vcmVjdC5sZWZ0ICAgKz0gc3cgLzI7XG4gICAgICAvL3JlY3QudG9wICAgICs9IHN3IC8yO1xuICAgICAgLy9yZWN0LndpZHRoICAtPSBzdztcbiAgICAgIC8vcmVjdC5oZWlnaHQgLT0gc3c7XG5cbiAgICAgIHJlY3QucmlnaHQgPSBfdyAtIChyZWN0LmxlZnQgKyByZWN0LndpZHRoKTtcbiAgICAgIHJlY3QuYm90dG9tID0gX2ggLSAocmVjdC50b3AgKyByZWN0LmhlaWdodCk7XG5cbiAgICAgIHJldHVybiByZWN0O1xuICAgIH1cbiAgfSxcbiAgY29udGVudE9mZnNldHMgOiA1LFxuICBnZXRGaXhlZFBvc2l0aW9uOiBmdW5jdGlvbiAodGFyZ2V0LCB4LCB5KSB7XG5cbiAgICB2YXIgX3cgPSB0aGlzLm9yaWdpbmFsV2lkdGggfHwgdGhpcy53aWR0aDtcbiAgICB2YXIgX2ggPSB0aGlzLm9yaWdpbmFsSGVpZ2h0IHx8IHRoaXMuaGVpZ2h0O1xuXG5cbiAgICBpZiAoeCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICB4ID0gdGFyZ2V0LmxlZnQ7XG4gICAgfVxuICAgIGlmICh5ID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHkgPSB0YXJnZXQudG9wO1xuICAgIH1cbiAgICB2YXIgc2NhbGUgPSB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzBdO1xuICAgIHRhcmdldC5zZXRDb29yZHMoKTtcbiAgICB2YXIgYm91bmRzID0gdGFyZ2V0LmdldEJvdW5kaW5nUmVjdCgpO1xuICAgIGJvdW5kcy5sZWZ0IC89IHNjYWxlO1xuICAgIGJvdW5kcy50b3AgLz0gc2NhbGU7XG4gICAgYm91bmRzLndpZHRoIC89IHNjYWxlO1xuICAgIGJvdW5kcy5oZWlnaHQgLz0gc2NhbGU7XG5cbiAgICBib3VuZHMubGVmdCAtPSB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzRdIC8gc2NhbGU7XG4gICAgYm91bmRzLnRvcCAtPSB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzVdIC8gc2NhbGU7XG4gICAgYm91bmRzLnJpZ2h0ID0gX3cgLSAoYm91bmRzLmxlZnQgKyBib3VuZHMud2lkdGgpO1xuICAgIGJvdW5kcy5ib3R0b20gPSBfaCAtIChib3VuZHMudG9wICsgYm91bmRzLmhlaWdodCk7XG5cblxuICAgIHZhciBsaW1pdHMgPSB0aGlzLl9nZXRNb3ZlbWVudHNMaW1pdHNSZWN0KHRhcmdldC5tb3ZlbWVudExpbWl0cyB8fCB0aGlzLm1vdmVtZW50TGltaXRzKTtcbiAgICAvLyB2YXIgbGltaXRzID0gcmVjdCB8fCB0aGlzLm1vdmVtZW50TGltaXRzO1xuXG4gICAgdmFyIG5ld1BvcyA9IHt9O1xuICAgIHZhciBfbCA9IGxpbWl0cy5sZWZ0LCBfciA9IGxpbWl0cy5yaWdodDtcbiAgICB2YXIgX3QgPSBsaW1pdHMudG9wLCBfYiA9IGxpbWl0cy5ib3R0b207XG5cbiAgICBpZiAodGFyZ2V0Lm1vdmVtZW50TGltaXRNb2RlID09PSBcImNvbnRlbnRcIikge1xuICAgICAgX2wgLT0gYm91bmRzLndpZHRoIC0gdGhpcy5jb250ZW50T2Zmc2V0c1xuICAgICAgX3IgLT0gYm91bmRzLndpZHRoIC0gdGhpcy5jb250ZW50T2Zmc2V0c1xuICAgICAgX3QgLT0gYm91bmRzLmhlaWdodCAtIHRoaXMuY29udGVudE9mZnNldHNcbiAgICAgIF9iIC09IGJvdW5kcy5oZWlnaHQgLSB0aGlzLmNvbnRlbnRPZmZzZXRzXG4gICAgfVxuXG4gICAgaWYgKHRhcmdldC5tb3ZlbWVudExpbWl0TW9kZSA9PT0gXCJmaXRcIiAmJiAhdGFyZ2V0LnJlc2l6YWJsZSkge1xuICAgICAgaWYgKF9sICE9PSBmYWxzZSAmJiBfciAhPT0gZmFsc2UpIHtcbiAgICAgICAgdmFyIF93ID0gX3cgLSBfbCAtIF9yO1xuICAgICAgICBpZiAoYm91bmRzLndpZHRoID4gX3cpIHtcbiAgICAgICAgICB2YXIgX2FzcCA9IF93IC8gYm91bmRzLndpZHRoO1xuICAgICAgICAgIG5ld1Bvcy5zY2FsZVggPSBfYXNwO1xuICAgICAgICAgIG5ld1Bvcy5zY2FsZVkgPSBfYXNwO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmIChfdCAhPT0gZmFsc2UgJiYgX2IgIT09IGZhbHNlKSB7XG4gICAgICAgIHZhciBfaCA9IF9oIC0gX3QgLSBfYjtcbiAgICAgICAgaWYgKGJvdW5kcy5oZWlnaHQgPiBfaCkge1xuICAgICAgICAgIHZhciBfYXNwID0gX2ggLyBib3VuZHMuaGVpZ2h0O1xuICAgICAgICAgIHRhcmdldC5zY2FsZVggKj0gX2FzcDtcbiAgICAgICAgICB0YXJnZXQuc2NhbGVZICo9IF9hc3A7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAodGFyZ2V0Lm1vdmVtZW50TGltaXRNb2RlID09PSBcImZpdFwiIHx8IHRhcmdldC5tb3ZlbWVudExpbWl0TW9kZSA9PT0gXCJjb250ZW50XCIpIHtcblxuICAgICAgaWYgKF9sICE9PSBmYWxzZSkge1xuICAgICAgICB2YXIgX2RpZmYgPSBfbCAtIGJvdW5kcy5sZWZ0O1xuICAgICAgICBpZiAoX2RpZmYgPiAwKSB7XG4gICAgICAgICAgbmV3UG9zLmxlZnQgPSB4ICsgX2RpZmY7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKCFuZXdQb3MubGVmdCAmJiBfciAhPT0gZmFsc2UpIHtcbiAgICAgICAgdmFyIF9kaWZmID0gX3IgLSBib3VuZHMucmlnaHQ7XG4gICAgICAgIGlmIChfZGlmZiA+IDApIHtcbiAgICAgICAgICBuZXdQb3MubGVmdCA9IHggLSBfZGlmZjtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAoX3QgIT09IGZhbHNlKSB7XG4gICAgICAgIHZhciBfZGlmZiA9IF90IC0gYm91bmRzLnRvcDtcbiAgICAgICAgaWYgKF9kaWZmID4gMCkge1xuICAgICAgICAgIG5ld1Bvcy50b3AgPSB5ICsgX2RpZmY7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKCFuZXdQb3MudG9wICYmIF9iICE9PSBmYWxzZSkge1xuICAgICAgICB2YXIgX2RpZmYgPSBfYiAtIGJvdW5kcy5ib3R0b207XG4gICAgICAgIGlmIChfZGlmZiA+IDApIHtcbiAgICAgICAgICBuZXdQb3MudG9wID0geSAtIF9kaWZmO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICB9XG5cbiAgICByZXR1cm4gbmV3UG9zO1xuICB9LFxuXG5cbiAgLy8gX3Jlc3RvcmVPcmlnaW5YWU5hdGl2ZTogX3Jlc3RvcmVPcmlnaW5YWU5hdGl2ZSxcbiAgLy8gX3Jlc3RvcmVPcmlnaW5YWTogZnVuY3Rpb24gKHRhcmdldCkge1xuICAvLyAgIHRoaXMuX3Jlc3RvcmVPcmlnaW5YWU5hdGl2ZSh0YXJnZXQpO1xuICAvL1xuICAvLyAgIC8vIGlmICh0YXJnZXQud2hvbGVDb29yZGluYXRlcykge1xuICAvLyAgIC8vICAgdGFyZ2V0LmxlZnQgPSBNYXRoLnJvdW5kKHRhcmdldC5sZWZ0KTtcbiAgLy8gICAvLyAgIHRhcmdldC50b3AgPSBNYXRoLnJvdW5kKHRhcmdldC50b3ApO1xuICAvLyAgIC8vIH1cbiAgLy8gfSxcblxuICAvKipcbiAgICogU2V0cyB0aGUgcG9zaXRpb24gb2YgdGhlIG9iamVjdCB0YWtpbmcgaW50byBjb25zaWRlcmF0aW9uIHRoZSBvYmplY3QncyBvcmlnaW5cbiAgICogQHBhcmFtIHtmYWJyaWMuUG9pbnR9IHBvcyBUaGUgbmV3IHBvc2l0aW9uIG9mIHRoZSBvYmplY3RcbiAgICogQHBhcmFtIHtTdHJpbmd9IG9yaWdpblggSG9yaXpvbnRhbCBvcmlnaW46ICdsZWZ0JywgJ2NlbnRlcicgb3IgJ3JpZ2h0J1xuICAgKiBAcGFyYW0ge1N0cmluZ30gb3JpZ2luWSBWZXJ0aWNhbCBvcmlnaW46ICd0b3AnLCAnY2VudGVyJyBvciAnYm90dG9tJ1xuICAgKiBAcmV0dXJuIHt2b2lkfVxuICAgKi9cbiAgc2V0UG9zaXRpb25CeU9yaWdpbjogZnVuY3Rpb24gKHBvcywgb3JpZ2luWCwgb3JpZ2luWSkge1xuICAgIHZhciBjZW50ZXIgPSB0aGlzLnRyYW5zbGF0ZVRvQ2VudGVyUG9pbnQocG9zLCBvcmlnaW5YLCBvcmlnaW5ZKSxcbiAgICAgIHBvc2l0aW9uID0gdGhpcy50cmFuc2xhdGVUb09yaWdpblBvaW50KGNlbnRlciwgdGhpcy5vcmlnaW5YLCB0aGlzLm9yaWdpblkpO1xuXG4gICAgLy8gaWYgKHRoaXMud2hvbGVDb29yZGluYXRlcykge1xuICAgIC8vICAgcG9zaXRpb24ueCA9IE1hdGgucm91bmQocG9zaXRpb24ueCk7XG4gICAgLy8gICBwb3NpdGlvbi55ID0gTWF0aC5yb3VuZChwb3NpdGlvbi55KTtcbiAgICAvLyB9XG4gICAgdGhpcy5zZXQoJ2xlZnQnLCBwb3NpdGlvbi54KTtcbiAgICB0aGlzLnNldCgndG9wJywgcG9zaXRpb24ueSk7XG4gIH1cbn0pO1xuXG52YXIgX3RyYW5zbGF0ZU9iamVjdF9vdmVyd3JpdHRlbiA9IGZhYnJpYy5DYW52YXMucHJvdG90eXBlLl90cmFuc2xhdGVPYmplY3Q7XG52YXIgX2JlZm9yZVNjYWxlVHJhbnNmb3JtX292ZXJ3cml0dGVuID0gZmFicmljLkNhbnZhcy5wcm90b3R5cGUuX2JlZm9yZVNjYWxlVHJhbnNmb3JtO1xudmFyIF9iZWZvcmVUcmFuc2Zvcm1fb3ZlcndyaXR0ZW4gPSBmYWJyaWMuQ2FudmFzLnByb3RvdHlwZS5fYmVmb3JlVHJhbnNmb3JtO1xudmFyIF9yZXN0b3JlT3JpZ2luWFlOYXRpdmUgPSBmYWJyaWMuQ2FudmFzLnByb3RvdHlwZS5fcmVzdG9yZU9yaWdpblhZO1xuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuU2xpZGVDYW52YXMucHJvdG90eXBlLCB7XG4gIF9iZWZvcmVTY2FsZVRyYW5zZm9ybV9vdmVyd3JpdHRlbjogX2JlZm9yZVNjYWxlVHJhbnNmb3JtX292ZXJ3cml0dGVuLFxuICBfYmVmb3JlU2NhbGVUcmFuc2Zvcm06IGZ1bmN0aW9uIChlLCB0cmFuc2Zvcm0pIHtcbiAgICB0aGlzLl9iZWZvcmVTY2FsZVRyYW5zZm9ybV9vdmVyd3JpdHRlbihlLCB0cmFuc2Zvcm0pO1xuICAgIGlmICghdGhpcy5fY3VycmVudFRyYW5zZm9ybS5vcmlnaW5hbC5vQ29vcmRzKSB7XG4gICAgICB0aGlzLl9jdXJyZW50VHJhbnNmb3JtLm9yaWdpbmFsLm9Db29yZHMgPSBmYWJyaWMudXRpbC5vYmplY3QuY2xvbmVEZWVwKHRoaXMuX2N1cnJlbnRUcmFuc2Zvcm0udGFyZ2V0Lm9Db29yZHMpO1xuICAgIH1cbiAgfSxcbiAgZ2V0Rml4ZWRQb3NpdGlvbkVhc3k6IGZ1bmN0aW9uICh0YXJnZXQsIHgsIHkpIHtcbiAgICB2YXIgX3cgPSB0aGlzLm9yaWdpbmFsV2lkdGggfHwgdGhpcy53aWR0aDtcbiAgICB2YXIgX2ggPSB0aGlzLm9yaWdpbmFsSGVpZ2h0IHx8IHRoaXMuaGVpZ2h0O1xuXG4gICAgaWYgKHggPT09IHVuZGVmaW5lZCkge1xuICAgICAgeCA9IHRhcmdldC5sZWZ0O1xuICAgIH1cbiAgICBpZiAoeSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICB5ID0gdGFyZ2V0LnRvcDtcbiAgICB9XG4gICAgdmFyIHNjYWxlID0gdGhpcy52aWV3cG9ydFRyYW5zZm9ybVswXTtcbiAgICB0YXJnZXQuc2V0Q29vcmRzKCk7XG4gICAgdGFyZ2V0LnJpZ2h0ID0gX3cgLSAodGFyZ2V0LmxlZnQgKyB0YXJnZXQud2lkdGgpO1xuICAgIHRhcmdldC5ib3R0b20gPSBfaCAtICh0YXJnZXQudG9wICsgdGFyZ2V0LmhlaWdodCk7XG5cbiAgICB2YXIgX2RpZmYsIF9hc3AsIHJlY3Q7XG4gICAgdmFyIG5ld1BvcyA9IHtcbiAgICAgIGxlZnQ6IHgsXG4gICAgICB0b3A6IHksXG4gICAgICB3aWR0aDogdGFyZ2V0LndpZHRoLFxuICAgICAgaGVpZ2h0OiB0YXJnZXQuaGVpZ2h0XG4gICAgfTtcblxuICAgIGlmICh0YXJnZXQud2lkdGggPiBfdykge1xuICAgICAgbmV3UG9zLndpZHRoID0gX3c7XG4gICAgfVxuICAgIGlmICh0YXJnZXQuaGVpZ2h0ID4gX2gpIHtcbiAgICAgIG5ld1Bvcy5oZWlnaHQgPSBfaDtcbiAgICB9XG4gICAgaWYgKHRhcmdldC5sZWZ0IDwgMCkge1xuICAgICAgbmV3UG9zLndpZHRoICs9IHRhcmdldC5sZWZ0O1xuICAgICAgbmV3UG9zLmxlZnQgLT0gdGFyZ2V0LmxlZnQ7XG4gICAgfVxuICAgIGlmICh0YXJnZXQucmlnaHQgPCAwKSB7XG4gICAgICBuZXdQb3Mud2lkdGggKz0gdGFyZ2V0LnJpZ2h0O1xuICAgIH1cbiAgICBpZiAodGFyZ2V0LnRvcCA8IDApIHtcbiAgICAgIG5ld1Bvcy5oZWlnaHQgKz0gdGFyZ2V0LnRvcDtcbiAgICB9XG4gICAgaWYgKHRhcmdldC5ib3R0b20gPCAwKSB7XG4gICAgICBuZXdQb3MuaGVpZ2h0ICs9IHRhcmdldC5ib3R0b207XG4gICAgfVxuICAgIHJldHVybiBuZXdQb3M7XG4gIH0sXG4gIC8qKlxuICAgKiDRhNGD0L3QutGG0LjRjiDQvNC+0LbQvdC+INCy0YvQt9Cy0LDRgtGMINGBINC10LLQtdC90YLQvtC8ICAnYWZ0ZXI6cmVuZGVyJy4g0J/QvtC30LLQvtC70Y/QtdGCINC+0YLQvtCx0YDQsNC20LDRgtGMINCy0YvRh9C40YHQu9C10L3QuNGPINC/0LXRgNC10YHQtdGH0LXQvdC40Lkg0LjQt9C80LXQvdGP0LXQvNC+0LPQviDQvtCx0YrQtdC60YLQsCDRgSDRgNCw0LzQutC+0LkuINCy0YvQtNC10LvRj9C10YIg0LrRgNCw0YHQvdGL0LzQuCDQu9C40LjQvdC40Y/QuFxuICAgKiBAcHJpdmF0ZVxuICAgKiBAZXhhbXBsZVxuICAgKiAgZXZlbnRMaXN0ZW5lcnMgOiB7XG4gICAgQ2FudmFzOiB7XG4gICAgICAnYmVmb3JlOnJlbmRlcic6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHRoaXMuY2xlYXJDb250ZXh0KHRoaXMuY29udGV4dFRvcCk7XG4gICAgICB9LFxuICAgICAgJ2FmdGVyOnJlbmRlcic6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHRoaXMuX2RlYnVnX2ludGVyc2VjdGlvbnMoKVxuICAgICAgfVxuICAgIH1cbiAgfVxuICAgKi9cbiAgZHJhd0ludGVyZXN0aW9uTGluZXM6IGZ1bmN0aW9uKCl7XG4gICAgdmFyIHRyID0gdGhpcy5fY3VycmVudFRyYW5zZm9ybTtcbiAgICBpZiAodHIgJiYgdHIuX2ludGVyc2VjdGlvbnMpIHtcbiAgICAgIHZhciBjdHggPSB0aGlzLmNvbnRleHRUb3A7XG4gICAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgICBjdHguc3Ryb2tlU3R5bGUgPSBcInJlZFwiO1xuICAgICAgZm9yKHZhciBpIGluIHRyLl9pbnRlcnNlY3Rpb25zKXtcbiAgICAgICAgdmFyIF9jb29yZCA9IHRyLl9pbnRlcnNlY3Rpb25zW2ldO1xuICAgICAgICBjdHgubW92ZVRvKF9jb29yZC54ICsgNSwgX2Nvb3JkLnkpO1xuICAgICAgICBjdHguYXJjKF9jb29yZC54LCBfY29vcmQueSwgNSwgMCwgMiAqIE1hdGguUEkpO1xuICAgICAgfVxuICAgICAgZm9yKHZhciBpIGluIHRyLmxpbmVzKXtcbiAgICAgICAgdmFyIF9sID0gdHIubGluZXNbaV07XG4gICAgICAgIGN0eC5tb3ZlVG8oX2xbMF0ueCxfbFswXS55KTtcbiAgICAgICAgY3R4LmxpbmVUbyhfbFsxXS54LF9sWzFdLnkpO1xuICAgICAgfVxuICAgICAgZm9yKHZhciBpIGluIHRyLm1sTGluZXMpe1xuICAgICAgICB2YXIgX2wgPSB0ci5tbExpbmVzW2ldO1xuICAgICAgICBjdHgubW92ZVRvKF9sWzBdLngsX2xbMF0ueSk7XG4gICAgICAgIGN0eC5saW5lVG8oX2xbMV0ueCxfbFsxXS55KTtcbiAgICAgIH1cbiAgICAgIGN0eC5zdHJva2UoKTtcbiAgICB9XG4gIH0sXG4gIF9zY2FsZU9iamVjdEVhc3k6IGZ1bmN0aW9uICh4LCB5LCBieSkge1xuICAgIC8vX3NjYWxlT2JqZWN0X292ZXJ3cml0dGVuLmNhbGwodGhpcywgeCwgeSwgYnkpO1xuICAgIHZhciB0ciA9IHRoaXMuX2N1cnJlbnRUcmFuc2Zvcm0sXG4gICAgICB0YXJnZXQgPSB0ci50YXJnZXQsXG4gICAgICBjb3JuZXIgPSB0ci5jb3JuZXI7XG4gICAgaWYoIXRhcmdldC5tb3ZlbWVudExpbWl0cyl7XG4gICAgICByZXR1cm4gX3NjYWxlT2JqZWN0X292ZXJ3cml0dGVuLmNhbGwodGhpcywgeCx5LCBieSk7XG4gICAgfVxuXG5cbiAgICBpZiAodGFyZ2V0Lm1vdmVtZW50TGltaXRNb2RlICE9PSAnZml0JylyZXR1cm47XG4gICAgeCA9IE1hdGgubWluKHRhcmdldC5tb3ZlbWVudExpbWl0cy53aWR0aCwgTWF0aC5tYXgoMCx4KSk7XG4gICAgeSA9IE1hdGgubWluKHRhcmdldC5tb3ZlbWVudExpbWl0cy5oZWlnaHQsIE1hdGgubWF4KDAseSkpO1xuICAgIF9zY2FsZU9iamVjdF9vdmVyd3JpdHRlbi5jYWxsKHRoaXMsIHgseSwgYnkpO1xuICB9LFxuICAvKipcbiAgICogU2NhbGVzIG9iamVjdCBieSBpbnZva2luZyBpdHMgc2NhbGVYL3NjYWxlWSBtZXRob2RzXG4gICAqIEBwcml2YXRlXG4gICAqIEBwYXJhbSB7TnVtYmVyfSB4IHBvaW50ZXIncyB4IGNvb3JkaW5hdGVcbiAgICogQHBhcmFtIHtOdW1iZXJ9IHkgcG9pbnRlcidzIHkgY29vcmRpbmF0ZVxuICAgKiBAcGFyYW0ge1N0cmluZ30gYnkgRWl0aGVyICd4JyBvciAneScgLSBzcGVjaWZpZXMgZGltZW5zaW9uIGNvbnN0cmFpbnQgYnkgd2hpY2ggdG8gc2NhbGUgYW4gb2JqZWN0LlxuICAgKiAgICAgICAgICAgICAgICAgICAgV2hlbiBub3QgcHJvdmlkZWQsIGFuIG9iamVjdCBpcyBzY2FsZWQgYnkgYm90aCBkaW1lbnNpb25zIGVxdWFsbHlcbiAgICovXG4gIF9zY2FsZU9iamVjdDogZnVuY3Rpb24gKHgsIHksIGJ5KSB7XG4gICAgdmFyIF9zY2FsZWQgPSBfc2NhbGVPYmplY3Rfb3ZlcndyaXR0ZW4uY2FsbCh0aGlzLCB4LCB5LCBieSk7XG5cbiAgICB2YXIgdHIgPSB0aGlzLl9jdXJyZW50VHJhbnNmb3JtLFxuICAgICAgdGFyZ2V0ID0gdHIudGFyZ2V0LFxuICAgICAgY29ybmVyID0gdHIuY29ybmVyO1xuICAgIHZhciBfdiA9IHRoaXMudmlld3BvcnRUcmFuc2Zvcm07XG5cbiAgICBpZiAoIXRhcmdldC5tb3ZlbWVudExpbWl0cyB8fCB0YXJnZXQubW92ZW1lbnRMaW1pdE1vZGUgIT09IFwiZml0XCIpe1xuICAgICAgcmV0dXJuIF9zY2FsZWQ7XG4gICAgfVxuICAgIHRhcmdldC5zZXRDb29yZHMoKTtcblxuICAgIHZhciBfc2NhbGUgPSB0aGlzLmdldFpvb20oKTtcblxuICAgIGlmKHRhcmdldC5tb3ZlbWVudExpbWl0cyA9PSB0aGlzKXtcbiAgICAgIHZhciBfdyA9IHRoaXMub3JpZ2luYWxXaWR0aCB8fCB0aGlzLndpZHRoO1xuICAgICAgdmFyIF9oID0gdGhpcy5vcmlnaW5hbEhlaWdodCB8fCB0aGlzLmhlaWdodDtcbiAgICAgIHZhciBfbCA9IHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bNF0gO1xuICAgICAgdmFyIF90ID0gdGhpcy52aWV3cG9ydFRyYW5zZm9ybVs1XSA7XG4gICAgICBfdyAqPSBfc2NhbGU7XG4gICAgICBfaCAqPSBfc2NhbGU7XG4gICAgICB2YXIgX3JjID0ge1xuICAgICAgICB0bDoge3g6IF9sLCB5OiBfdH0sXG4gICAgICAgIHRyOiB7eDogX2wgKyBfdywgeTogX3R9LFxuICAgICAgICBibDoge3g6IF9sLCB5OiBfdCArIF9ofSxcbiAgICAgICAgYnI6IHt4OiBfbCArIF93LCB5OiBfdCArIF9ofVxuICAgICAgfVxuICAgIH1lbHNle1xuICAgICAgdGFyZ2V0Lm1vdmVtZW50TGltaXRzLnNldENvb3JkcygpO1xuICAgICAgdmFyIF9yYyA9IHRhcmdldC5tb3ZlbWVudExpbWl0cy5vQ29vcmRzO1xuICAgIH1cblxuXG4gICAgaWYgKCF0ci5wb2ludGVyT2Zmc2V0KSB7XG4gICAgICB0ci5wb2ludGVyT2Zmc2V0ID0ge1xuICAgICAgICB4OiB4ICogX3ZbMF0gLSB0YXJnZXQub0Nvb3Jkc1tjb3JuZXJdLngsXG4gICAgICAgIHk6IHkgKiBfdlszXSAtIHRhcmdldC5vQ29vcmRzW2Nvcm5lcl0ueVxuICAgICAgfVxuXG4gICAgICB0ci5wb2ludENlbnRlciA9IHRhcmdldC5nZXRDZW50ZXJQb2ludCgpO1xuICAgICAgdHIucG9pbnRDZW50ZXIueCAqPSBfc2NhbGU7XG4gICAgICB0ci5wb2ludENlbnRlci55ICo9IF9zY2FsZTtcbiAgICAgIHRyLnBvaW50T3JpZ2luYWwgPSB0ci5vcmlnaW5hbC5vQ29vcmRzW2Nvcm5lcl07XG4gICAgfVxuXG4gICAgdHIucG9pbnRUcmFuZm9ybWVkID0gdGFyZ2V0Lm9Db29yZHNbY29ybmVyXTtcblxuICAgIHRyLm1sTGluZXMgPSBbXTtcbiAgICB0ci5saW5lcyA9IFtdO1xuICAgIGZ1bmN0aW9uIF9pbnRlcnNlY3Rpb24oY29ybmVyLCBjb29yZGluYXRlKSB7XG4gICAgICB2YXIgX29jO1xuICAgICAgaWYgKGNvb3JkaW5hdGUgPT0gXCJ4XCIgJiYgY29ybmVyWzBdICE9IFwibVwiKSB7XG4gICAgICAgIF9vYyA9IHRyLm9yaWdpbmFsLm9Db29yZHNbXCJtXCIgKyBjb3JuZXJbMF1dO1xuICAgICAgfSBlbHNlIGlmIChjb29yZGluYXRlID09IFwieVwiICYmIGNvcm5lclswXSAhPSBcIm1cIikge1xuICAgICAgICBfb2MgPSB0ci5vcmlnaW5hbC5vQ29vcmRzW1wibVwiICsgY29ybmVyWzFdXTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIF9vYyA9IHRyLnBvaW50Q2VudGVyO1xuICAgICAgICBfb2MgPSB7XG4gICAgICAgICAgeDogX29jLnggKyBfdls0XSxcbiAgICAgICAgICB5OiBfb2MueSArIF92WzVdXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICB2YXIgX3RjID0gdGFyZ2V0Lm9Db29yZHNbY29ybmVyXTtcblxuICAgICAgdHIubGluZXMucHVzaChbX29jLCBfdGNdKTtcbiAgICAgIHRyLm1sTGluZXMucHVzaChbX3JjLnRsLCBfcmMudHJdKTtcbiAgICAgIHRyLm1sTGluZXMucHVzaChbX3JjLnRyLCBfcmMuYnJdKTtcbiAgICAgIHRyLm1sTGluZXMucHVzaChbX3JjLmJyLCBfcmMuYmxdKTtcbiAgICAgIHRyLm1sTGluZXMucHVzaChbX3JjLmJsLCBfcmMudGxdKTtcblxuICAgICAgdmFyIGludGVycyA9IGZhYnJpYy5JbnRlcnNlY3Rpb24uaW50ZXJzZWN0TGluZVBvbHlnb24oX29jLCBfdGMsIFtfcmMudGwsIF9yYy50ciwgX3JjLmJyLCBfcmMuYmxdKTtcbiAgICAgIGlmICghaW50ZXJzLnBvaW50cy5sZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaW50ZXJzLnBvaW50c1swXS5jb29yZGluYXRlID0gY29vcmRpbmF0ZTtcbiAgICAgIHRyLl9pbnRlcnNlY3Rpb25zLnB1c2goaW50ZXJzLnBvaW50c1swXSlcblxuLy8gICAgICAgICBpZiAoY29vcmRpbmF0ZSkge1xuLy8gICAgICAgICAgIHZhciBwMSA9IGludGVycy5wb2ludHNbMF07XG5cbi8vICAgICAgICAgICB2YXIgY29ybmVyMjtcbi8vICAgICAgICAgICBpZiAoY29vcmRpbmF0ZSA9PSBcInhcIikge1xuLy8gICAgICAgICAgICAgY29ybmVyMiA9IChjb3JuZXJbMF0gPT0gXCJ0XCIgPyBcImJcIiA6IFwidFwiKSArIGNvcm5lclsxXTtcbi8vICAgICAgICAgICB9IGVsc2Uge1xuLy8gICAgICAgICAgICAgY29ybmVyMiA9IGNvcm5lclswXSArIChjb3JuZXJbMV0gPT0gXCJsXCIgPyBcInJcIiA6IFwibFwiKTtcbi8vICAgICAgICAgICB9XG4vLyAgICAgICAgICAgdmFyIF9wMiA9IHRhcmdldC5vQ29vcmRzW2Nvcm5lcjJdO1xuLy8gICAgICAgICAgIHZhciBfZGlmZiA9IHt4OiBfdGMueCAtIHAxLngsIHk6IF90Yy55IC0gcDEueX07XG5cbi8vICAgICAgICAgICB2YXIgcDIgPSB7XG4vLyAgICAgICAgICAgICB4OiBfcDIueCAtIF9kaWZmLngsXG4vLyAgICAgICAgICAgICB5OiBfcDIueSAtIF9kaWZmLnlcbi8vICAgICAgICAgICB9O1xuXG4vLyAgICAgICAgICAgdmFyIGl0cyA9IGZhYnJpYy5JbnRlcnNlY3Rpb24uaW50ZXJzZWN0TGluZUxpbmUodHIucG9pbnRDZW50ZXIsIHRyLnBvaW50VHJhbmZvcm1lZCwgcDEsIHAyKTtcbi8vICAgICAgICAgICBpZiAoIWl0cy5wb2ludHNbMF0pIHtcbi8vICAgICAgICAgICAgIHJldHVybjtcbi8vICAgICAgICAgICB9XG4vLyAgICAgICAgICAgdHIuX2ludGVyc2VjdGlvbnMucHVzaChpdHMucG9pbnRzWzBdKTtcbi8vICAgICAgICAgfSBlbHNlIHtcbi8vICAgICAgICAgICB0ci5faW50ZXJzZWN0aW9ucy5wdXNoKGludGVycy5wb2ludHNbMF0pO1xuLy8gICAgICAgICB9XG5cblxuICAgICAgLy9cbiAgICAgIC8vaWYoaW50ZXJzLnBvaW50cy5sZW5ndGgpe1xuICAgICAgLy8gIF9zY2FsZU9iamVjdF9vdmVyd3JpdHRlbi5jYWxsKHRoaXMsIGludGVycy5wb2ludHNbMF0ueCwgIGludGVycy5wb2ludHNbMF0ueSwgYnkpO1xuICAgICAgLy8gIHRhcmdldC5zZXRDb29yZHMoKTtcbiAgICAgIC8vfWVsc2V7XG4gICAgICAvLyAgX3NjYWxlT2JqZWN0X292ZXJ3cml0dGVuLmNhbGwodGhpcywgeCwgeSwgYnkpO1xuICAgICAgLy99XG4gICAgfVxuXG5cbiAgICB0ci5faW50ZXJzZWN0aW9uID0gbnVsbDtcbiAgICB0ci5faW50ZXJzZWN0aW9ucyA9IFtdO1xuICAgIHN3aXRjaCAoY29ybmVyKSB7XG4gICAgICBjYXNlIFwidGxcIjpcbiAgICAgICAgX2ludGVyc2VjdGlvbihcInRsXCIpO1xuICAgICAgICBfaW50ZXJzZWN0aW9uKFwiYmxcIiwgXCJ4XCIpO1xuICAgICAgICBfaW50ZXJzZWN0aW9uKFwidHJcIiwgXCJ5XCIpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJ0clwiOlxuICAgICAgICBfaW50ZXJzZWN0aW9uKFwidHJcIik7XG4gICAgICAgIF9pbnRlcnNlY3Rpb24oXCJ0bFwiLCBcInlcIik7XG4gICAgICAgIF9pbnRlcnNlY3Rpb24oXCJiclwiLCBcInhcIik7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcImJyXCI6XG4gICAgICAgIF9pbnRlcnNlY3Rpb24oXCJiclwiKTtcbiAgICAgICAgX2ludGVyc2VjdGlvbihcInRyXCIsIFwieFwiKTtcbiAgICAgICAgX2ludGVyc2VjdGlvbihcImJsXCIsIFwieVwiKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwiYmxcIjpcbiAgICAgICAgX2ludGVyc2VjdGlvbihcImJsXCIpO1xuICAgICAgICBfaW50ZXJzZWN0aW9uKFwidGxcIiwgXCJ4XCIpO1xuICAgICAgICBfaW50ZXJzZWN0aW9uKFwiYnJcIiwgXCJ5XCIpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJtdFwiOlxuICAgICAgICBfaW50ZXJzZWN0aW9uKFwibXRcIik7XG4gICAgICAgIF9pbnRlcnNlY3Rpb24oXCJ0bFwiLCBcInlcIik7XG4gICAgICAgIF9pbnRlcnNlY3Rpb24oXCJ0clwiLCBcInlcIik7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcIm1iXCI6XG4gICAgICAgIF9pbnRlcnNlY3Rpb24oXCJtYlwiKTtcbiAgICAgICAgX2ludGVyc2VjdGlvbihcImJsXCIsIFwieVwiKTtcbiAgICAgICAgX2ludGVyc2VjdGlvbihcImJyXCIsIFwieVwiKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwibXJcIjpcbiAgICAgICAgX2ludGVyc2VjdGlvbihcIm1yXCIpO1xuICAgICAgICBfaW50ZXJzZWN0aW9uKFwidHJcIiwgXCJ4XCIpO1xuICAgICAgICBfaW50ZXJzZWN0aW9uKFwiYnJcIiwgXCJ4XCIpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJtbFwiOlxuICAgICAgICBfaW50ZXJzZWN0aW9uKFwibWxcIik7XG4gICAgICAgIF9pbnRlcnNlY3Rpb24oXCJ0bFwiLCBcInhcIik7XG4gICAgICAgIF9pbnRlcnNlY3Rpb24oXCJibFwiLCBcInhcIik7XG4gICAgfVxuXG4gICAgaWYgKCF0ci5faW50ZXJzZWN0aW9ucy5sZW5ndGgpIHtcbiAgICAgIHJldHVybiBfc2NhbGVkO1xuICAgIH1cblxuXG4gICAgdmFyIF9uZXdYWSA9IHRyLl9pbnRlcnNlY3Rpb25zWzBdO1xuICAgIHZhciBfbCA9IHRyLl9pbnRlcnNlY3Rpb25zWzBdLmRpc3RhbmNlRnJvbSh0ci5wb2ludE9yaWdpbmFsKTtcblxuICAgIGZvciAodmFyIGkgPSAxOyBpIDwgdHIuX2ludGVyc2VjdGlvbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciBfbDIgPSB0ci5faW50ZXJzZWN0aW9uc1tpXS5kaXN0YW5jZUZyb20odHIucG9pbnRPcmlnaW5hbCk7XG4gICAgICBpZiAoX2wyIDwgX2wpIHtcbiAgICAgICAgX25ld1hZID0gdHIuX2ludGVyc2VjdGlvbnNbaV07XG4gICAgICAgIF9sID0gX2wyO1xuICAgICAgfVxuICAgIH1cbiAgICB0ci5faW50ZXJzZWN0aW9uID0gX25ld1hZO1xuXG5cbiAgICBpZiAoYnkgPT0gXCJlcXVhbGx5XCIpIHtcbiAgICAgIC8vYnkgPSBmYWxzZTtcblxuICAgICAgdmFyIF9kaWZmMiA9IHt4OiBfbmV3WFkueCAtIHRyLnBvaW50Q2VudGVyLngsIHk6IF9uZXdYWS55IC0gdHIucG9pbnRDZW50ZXIueX07XG4gICAgICB2YXIgX2wgPSBNYXRoLnNxcnQoX2RpZmYyLnggKiBfZGlmZjIueCArIF9kaWZmMi55ICogX2RpZmYyLnkpO1xuXG4gICAgICBfbmV3WFkueCAtPSBfZGlmZjIueCAvIF9sICogdGFyZ2V0LnN0cm9rZVdpZHRoO1xuICAgICAgX25ld1hZLnkgLT0gX2RpZmYyLnkgLyBfbCAqIHRhcmdldC5zdHJva2VXaWR0aDtcbiAgICAgIC8vIHNjcnQoeCp4ICsgeSp5KSA9IGF0cm9rZXdpZHRoXG4gICAgICB2YXIgYSA9IDE7XG4gICAgfVxuICAgIC8vcmV0dXJuIF9zY2FsZU9iamVjdF9vdmVyd3JpdHRlbi5jYWxsKHRoaXMsIHgsIHksIGJ5KTtcbiAgICB2YXIgX194ID0gKF9uZXdYWS54ICsgdHIucG9pbnRlck9mZnNldC54ICkgLyBfdlswXTtcbiAgICB2YXIgX195ID0gKF9uZXdYWS55ICsgdHIucG9pbnRlck9mZnNldC55ICkgLyBfdlszXTtcbiAgICByZXR1cm4gX3NjYWxlT2JqZWN0X292ZXJ3cml0dGVuLmNhbGwodGhpcywgX194LCBfX3ksIGJ5KTtcblxuICAgIC8vXG4gICAgLy9pZiAoY29ybmVyID09IFwiYnJcIiB8fCBjb3JuZXIgPT0gXCJ0clwiIHx8IGNvcm5lciA9PSBcIm1yXCIpIHtcbiAgICAvLyAgaWYgKHggPCB0YXJnZXQubW92ZW1lbnRYTWF4TGltaXQpIHtcbiAgICAvLyAgICB4ID0gdGFyZ2V0Lm1vdmVtZW50WE1heExpbWl0O1xuICAgIC8vICB9XG4gICAgLy99XG4gICAgLy9pZiAoY29ybmVyID09IFwiYmxcIiB8fCBjb3JuZXIgPT0gXCJ0bFwiIHx8IGNvcm5lciA9PSBcIm1sXCIpIHtcbiAgICAvLyAgaWYgKHggPiB0YXJnZXQubW92ZW1lbnRYTWluTGltaXQpIHtcbiAgICAvLyAgICB4ID0gdGFyZ2V0Lm1vdmVtZW50WE1pbkxpbWl0O1xuICAgIC8vICB9XG4gICAgLy99XG4gICAgLy9pZiAoY29ybmVyID09IFwiYmxcIiB8fCBjb3JuZXIgPT0gXCJiclwiIHx8IGNvcm5lciA9PSBcIm1iXCIpIHtcbiAgICAvLyAgaWYgKHkgPCB0YXJnZXQubW92ZW1lbnRZTWF4TGltaXQpIHtcbiAgICAvLyAgICB5ID0gdGFyZ2V0Lm1vdmVtZW50WU1heExpbWl0O1xuICAgIC8vICB9XG4gICAgLy99XG4gICAgLy9pZiAoY29ybmVyID09IFwidGxcIiB8fCBjb3JuZXIgPT0gXCJ0clwiIHx8IGNvcm5lciA9PSBcIm10XCIpIHtcbiAgICAvLyAgaWYgKHkgPiB0YXJnZXQubW92ZW1lbnRZTWluTGltaXQpIHtcbiAgICAvLyAgICB5ID0gdGFyZ2V0Lm1vdmVtZW50WU1pbkxpbWl0O1xuICAgIC8vICB9XG4gICAgLy99XG4gICAgLy9cbiAgICAvL19zY2FsZU9iamVjdF9vdmVyd3JpdHRlbi5jYWxsKHRoaXMsIHgsIHksIGJ5KTtcbiAgfSxcbiAgbW92ZW1lbnRMaW1pdHNPbkFkZEFjdGlvbjogJ3RyYW5zbGF0ZScsXG4gIF9jaGVja19vYmplY3RfYWZ0ZXJfbW9kaWZpZWQ6IGZ1bmN0aW9uICh0YXJnZXQpIHtcbiAgICBpZiAoIXRoaXMuX2N1cnJlbnRUcmFuc2Zvcm0pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdmFyIHBvcyA9IHRoaXMuZ2V0Rml4ZWRQb3NpdGlvbih0YXJnZXQsIHRhcmdldC5sZWZ0LCB0YXJnZXQudG9wKTtcblxuICAgIHN3aXRjaCAodGhpcy5fY3VycmVudFRyYW5zZm9ybS5jb3JuZXIpIHtcbiAgICAgIGNhc2UgXCJtdHJcIjpcbiAgICAgICAgaWYgKHBvcy5sZWZ0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICB0YXJnZXQuc2V0KCdsZWZ0JywgcG9zLmxlZnQpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChwb3MudG9wKSB7XG4gICAgICAgICAgdGFyZ2V0LnNldCgndG9wJywgcG9zLnRvcCk7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwibXJcIjpcbiAgICAgIGNhc2UgXCJiclwiOlxuICAgICAgICBpZiAocG9zLmxlZnQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIHZhciBfbGRpZmYgPSB0YXJnZXQubGVmdCAtIHBvcy5sZWZ0O1xuXG4gICAgICAgIH1cbiAgICAgICAgaWYgKHBvcy50b3AgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIHZhciBfdGRpZmYgPSB0YXJnZXQudG9wIC0gcG9zLnRvcDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChfbGRpZmYgJiYgKCFfdGRpZmYgfHwgTWF0aC5hYnMoX2xkaWZmKSA+IE1hdGguYWJzKF90ZGlmZikpKSB7XG4gICAgICAgICAgaWYgKF9sZGlmZiA8IDApIHtcbiAgICAgICAgICAgIHRhcmdldC53aWR0aCArPSBfbGRpZmY7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRhcmdldC53aWR0aCAtPSBfbGRpZmY7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKF90ZGlmZikge1xuICAgICAgICAgIGlmIChfdGRpZmYgPCAwKSB7XG4gICAgICAgICAgICB0YXJnZXQud2lkdGggKz0gX3RkaWZmO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0YXJnZXQud2lkdGggLT0gX3RkaWZmO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgLy9jb25zb2xlLmxvZyhwb3MsX2xkaWZmLF90ZGlmZilcbiAgICB9XG4gICAgLy8gdGhpcy5fY2hlY2tfb2JqZWN0X3Bvc2l0aW9uKHRhcmdldClcbiAgfSxcbiAgX2NoZWNrX29iamVjdF9wb3NpdGlvbjogZnVuY3Rpb24gKHRhcmdldCkge1xuXG4gICAgdmFyIHBvcyA9IHRoaXMuZ2V0Rml4ZWRQb3NpdGlvbih0YXJnZXQsIHRhcmdldC5sZWZ0LCB0YXJnZXQudG9wKTtcbiAgICBpZiAodGhpcy5tb3ZlbWVudExpbWl0c09uQWRkQWN0aW9uID09ICd0cmFuc2xhdGUnKSB7XG4gICAgICBpZiAocG9zLmxlZnQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0YXJnZXQuc2V0KCdsZWZ0JywgcG9zLmxlZnQpO1xuICAgICAgfVxuICAgICAgaWYgKHBvcy50b3AgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0YXJnZXQuc2V0KCd0b3AnLCBwb3MudG9wKTtcbiAgICAgIH1cbiAgICB9ZWxzZXtcblxuICAgICAgaWYgKHBvcy5sZWZ0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgaWYgKHRhcmdldC5sZWZ0IDwgcG9zLmxlZnQpIHtcbiAgICAgICAgICB0YXJnZXQud2lkdGggKz0gdGFyZ2V0LmxlZnQgLSBwb3MubGVmdDtcbiAgICAgICAgICB0YXJnZXQubGVmdCA9IHBvcy5sZWZ0O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRhcmdldC53aWR0aCAtPSB0YXJnZXQubGVmdCAtIHBvcy5sZWZ0O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAocG9zLnRvcCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGlmICh0YXJnZXQudG9wIDwgcG9zLnRvcCkge1xuICAgICAgICAgIHRhcmdldC5oZWlnaHQgKz0gdGFyZ2V0LnRvcCAtIHBvcy50b3A7XG4gICAgICAgICAgdGFyZ2V0LnRvcCA9IHBvcy50b3A7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGFyZ2V0LmhlaWdodCAtPSB0YXJnZXQudG9wIC0gcG9zLnRvcDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuXG4gICAgaWYgKHBvcy5zY2FsZVgpIHtcbiAgICAgIHRhcmdldC5zY2FsZVggPSB0YXJnZXQuc2NhbGVYICo9IHBvcy5zY2FsZVg7XG4gICAgfVxuICAgIGlmIChwb3Muc2NhbGVZKSB7XG4gICAgICB0YXJnZXQuc2NhbGVZID0gdGFyZ2V0LnNjYWxlWSAqPSBwb3Muc2NhbGVZO1xuICAgIH1cblxuICAgIHRhcmdldC5zZXRDb29yZHMoKTtcblxuICAgIHRoaXMucmVuZGVyQWxsKCk7XG4gICAgLy8gaWYodGFyZ2V0Lndob2xlQ29vcmRpbmF0ZXMpe1xuICAgIC8vICAgdGFyZ2V0LnRvcCA9IE1hdGgucm91bmQodGFyZ2V0LnRvcCk7XG4gICAgLy8gICB0YXJnZXQubGVmdCA9IE1hdGgucm91bmQodGFyZ2V0LmxlZnQpO1xuICAgIC8vICAgdGFyZ2V0LmhlaWdodCA9IE1hdGgucm91bmQodGFyZ2V0LmhlaWdodCk7XG4gICAgLy8gICB0YXJnZXQud2lkdGggPSBNYXRoLnJvdW5kKHRhcmdldC53aWR0aCk7XG4gICAgLy8gfVxuICB9LFxuICBfdHJhbnNsYXRlT2JqZWN0OiBmdW5jdGlvbiAoeCwgeSwgbGltaXRzKSB7XG4gICAgdmFyIHRhcmdldCA9IHRoaXMuX2N1cnJlbnRUcmFuc2Zvcm0udGFyZ2V0O1xuICAgIGlmKHRhcmdldC5iZWZvcmVUcmFuc2xhdGUpe1xuICAgICAgdmFyIF9wb2ludCA9IHRhcmdldC5iZWZvcmVUcmFuc2xhdGUoeCwgeSk7XG4gICAgICBpZighX3BvaW50KXJldHVybiBmYWxzZTtcbiAgICAgIHggPSBfcG9pbnQueDtcbiAgICAgIHkgPSBfcG9pbnQueTtcbiAgICB9XG4gICAgdmFyIF90cmFuc2xhdGVkID0gX3RyYW5zbGF0ZU9iamVjdF9vdmVyd3JpdHRlbi5jYWxsKHRoaXMsIHgsIHksIGxpbWl0cyk7XG5cbiAgICBpZih0aGlzLm1vdmVtZW50TGltaXRzKXtcblxuICAgICAgdmFyIHBvcyA9IHRoaXMuZ2V0Rml4ZWRQb3NpdGlvbih0YXJnZXQsIHgsIHkpO1xuXG4gICAgICBpZiAocG9zLnNjYWxlWCkge1xuICAgICAgICB0YXJnZXQuc2NhbGVYID0gdGhpcy5fY3VycmVudFRyYW5zZm9ybS5zY2FsZVggKj0gcG9zLnNjYWxlWDtcbiAgICAgIH1cbiAgICAgIGlmIChwb3Muc2NhbGVZKSB7XG4gICAgICAgIHRhcmdldC5zY2FsZVkgPSB0aGlzLl9jdXJyZW50VHJhbnNmb3JtLnNjYWxlWSAqPSBwb3Muc2NhbGVZO1xuICAgICAgfVxuXG4gICAgICBpZiAocG9zLnRvcCAhPT0gdW5kZWZpbmVkIHx8IHBvcy5sZWZ0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgX3RyYW5zbGF0ZWQgPSBfdHJhbnNsYXRlT2JqZWN0X292ZXJ3cml0dGVuLmNhbGwodGhpcyxcbiAgICAgICAgICBwb3MubGVmdCAhPT0gdW5kZWZpbmVkID8gcG9zLmxlZnQgOiB4LFxuICAgICAgICAgIHBvcy50b3AgIT09IHVuZGVmaW5lZCA/IHBvcy50b3AgOiB5KTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIF90cmFuc2xhdGVkIHx8IHBvcy5zY2FsZVggfHwgcG9zLnNjYWxlWTtcblxuXG5cbiAgICAvKiBpZiAoIXRhcmdldC5nZXQoJ2xvY2tNb3ZlbWVudFgnKSkge1xuICAgICB2YXIgX3ZhbCA9IHggLSB0aGlzLl9jdXJyZW50VHJhbnNmb3JtLm9mZnNldFg7XG5cbiAgICAgLy9sZWZ0IG9mZnNldFxuICAgICB2YXIgbGltID0gdGhpcy5tb3ZlbWVudExpbWl0cy5taW5YLmNvbnN0cnVjdG9yID09IE51bWJlciA/IHRoaXMubW92ZW1lbnRMaW1pdHMubWluWCA6IC1ib3VuZHMud2lkdGggKyAxO1xuICAgICBpZih0YXJnZXQubW92ZW1lbnRYTWluTGltaXQgJiYgdGFyZ2V0Lm1vdmVtZW50WE1pbkxpbWl0LmNvbnN0cnVjdG9yID09IE51bWJlciAmJiB0YXJnZXQubW92ZW1lbnRYTWluTGltaXQgPiBsaW0gKXtcbiAgICAgbGltID0gdGFyZ2V0Lm1vdmVtZW50WE1pbkxpbWl0IDtcbiAgICAgfVxuXG4gICAgIF92YWwgPSBNYXRoLm1pbihsaW0sIF92YWwpO1xuXG4gICAgIC8vcmlnaHQgb2Zmc2V0XG4gICAgIHZhciBsaW0gPSB0aGlzLm1vdmVtZW50TGltaXRzLm1heFguY29uc3RydWN0b3IgPT0gTnVtYmVyID8gdGhpcy5tb3ZlbWVudExpbWl0cy5tYXhYIDogdGhpcy53aWR0aCArIGJvdW5kcy53aWR0aCAtIDE7XG4gICAgIGlmKHRhcmdldC5tb3ZlbWVudFhNYXhMaW1pdCAmJiB0YXJnZXQubW92ZW1lbnRYTWF4TGltaXQuY29uc3RydWN0b3IgPT0gTnVtYmVyICYmIHRhcmdldC5tb3ZlbWVudFhNYXhMaW1pdCA+IGxpbSApe1xuICAgICBsaW0gPSB0YXJnZXQubW92ZW1lbnRYTWF4TGltaXQgO1xuICAgICB9XG4gICAgIF92YWwgPSBNYXRoLm1heChsaW0gIC0gdGFyZ2V0LndpZHRoICogdGFyZ2V0LnNjYWxlWCwgX3ZhbCk7XG4gICAgIHRhcmdldC5zZXQoJ2xlZnQnLCBfdmFsKTtcbiAgICAgfVxuICAgICBpZiAoIXRhcmdldC5nZXQoJ2xvY2tNb3ZlbWVudFknKSkge1xuICAgICB2YXIgX3ZhbCA9IHkgLSB0aGlzLl9jdXJyZW50VHJhbnNmb3JtLm9mZnNldFk7XG4gICAgIGlmKHRhcmdldC5tb3ZlbWVudFlNaW5MaW1pdCAhPT0gdW5kZWZpbmVkKVxuICAgICBfdmFsID0gTWF0aC5taW4odGFyZ2V0Lm1vdmVtZW50WU1pbkxpbWl0LCBfdmFsKTtcbiAgICAgaWYodGFyZ2V0Lm1vdmVtZW50WU1heExpbWl0ICE9PSB1bmRlZmluZWQpXG4gICAgIF92YWwgPSBNYXRoLm1heCh0YXJnZXQubW92ZW1lbnRZTWF4TGltaXQgIC0gdGFyZ2V0LmhlaWdodCwgX3ZhbCk7XG5cbiAgICAgdGFyZ2V0LnNldCgndG9wJywgX3ZhbCk7XG4gICAgIH1cbiAgICAgKi9cbiAgICAvL21vdmVtZW50TGltaXRzID17XG4gICAgLy8gICAgeG1pbjogMCxcbiAgICAvLyAgICB4bWF4OiAwLFxuICAgIC8vICAgIHltaW46IDAsXG4gICAgLy8gICAgeW1heDogMFxuICAgIC8vfTtcblxuICB9LFxuXG4gIF9iZWZvcmVUcmFuc2Zvcm06IGZ1bmN0aW9uIChlLCB0YXJnZXQpIHtcbiAgICB0YXJnZXQgJiYgdGFyZ2V0Ll9iZWZvcmVUcmFuc2Zvcm0gP1xuICAgICAgdGFyZ2V0Ll9iZWZvcmVUcmFuc2Zvcm0oZSkgOlxuICAgICAgX2JlZm9yZVRyYW5zZm9ybV9vdmVyd3JpdHRlbi5jYWxsKHRoaXMsIGUsIHRhcmdldCk7XG4gIH0sXG4gIF9iZWZvcmVUcmFuc2Zvcm1OYXRpdmU6IF9iZWZvcmVUcmFuc2Zvcm1fb3ZlcndyaXR0ZW4sXG4gIC8qKlxuICAgKiBUcmFuc2xhdGVzIG9iamVjdCBieSBcInNldHRpbmdcIiBpdHMgbGVmdC90b3BcbiAgICogQHByaXZhdGVcbiAgICogQHBhcmFtIHtOdW1iZXJ9IHggcG9pbnRlcidzIHggY29vcmRpbmF0ZVxuICAgKiBAcGFyYW0ge051bWJlcn0geSBwb2ludGVyJ3MgeSBjb29yZGluYXRlXG4gICAqIEByZXR1cm4ge0Jvb2xlYW59IHRydWUgaWYgdGhlIHRyYW5zbGF0aW9uIG9jY3VycmVkXG4gICAqL1xuIC8qIF90cmFuc2xhdGVPYmplY3Q6IGZ1bmN0aW9uICh4LCB5KSB7XG4gICAgdmFyIHRyYW5zZm9ybSA9IHRoaXMuX2N1cnJlbnRUcmFuc2Zvcm0sXG4gICAgICB0YXJnZXQgPSB0cmFuc2Zvcm0udGFyZ2V0LFxuICAgICAgbmV3TGVmdCA9IHggLSB0cmFuc2Zvcm0ub2Zmc2V0WCxcbiAgICAgIG5ld1RvcCA9IHkgLSB0cmFuc2Zvcm0ub2Zmc2V0WSxcbiAgICAgIG1vdmVYID0gIXRhcmdldC5nZXQoJ2xvY2tNb3ZlbWVudFgnKSAmJiB0YXJnZXQubGVmdCAhPT0gbmV3TGVmdCxcbiAgICAgIG1vdmVZID0gIXRhcmdldC5nZXQoJ2xvY2tNb3ZlbWVudFknKSAmJiB0YXJnZXQudG9wICE9PSBuZXdUb3A7XG5cblxuICAgIC8vcm91bmQgY29vcmRpbmF0ZXNcbiAgICAvLyBpZiAodGFyZ2V0Lndob2xlQ29vcmRpbmF0ZXMpIHtcbiAgICAvLyAgIG5ld0xlZnQgPSBNYXRoLnJvdW5kKG5ld0xlZnQpO1xuICAgIC8vICAgbmV3VG9wID0gTWF0aC5yb3VuZChuZXdUb3ApO1xuICAgIC8vIH1cblxuICAgIG1vdmVYICYmIHRhcmdldC5zZXQoJ2xlZnQnLCBuZXdMZWZ0KTtcbiAgICBtb3ZlWSAmJiB0YXJnZXQuc2V0KCd0b3AnLCBuZXdUb3ApO1xuICAgIHJldHVybiBtb3ZlWCB8fCBtb3ZlWTtcbiAgfSovXG59KTtcblxuLy9mYWJyaWMuU2xpZGVDYW52YXMuYWRkUGx1Z2luKFwibG9hZGVyc1wiLGZ1bmN0aW9uKCl7XG4vLyAgICB0aGlzLmluaXRNb3ZlbWVudExpbWl0cygpO1xuLy99KTtcblxuLy90b2RvXG5mYWJyaWMuUmVjdC5wcm90b3R5cGUuc3RhdGVQcm9wZXJ0aWVzICAgPSBmYWJyaWMuUmVjdC5wcm90b3R5cGUuc3RhdGVQcm9wZXJ0aWVzLmNvbmNhdChbXCJtb3ZlbWVudExpbWl0c1wiLFwiY2xpcFRvXCJdKTtcbmZhYnJpYy5PYmplY3QucHJvdG90eXBlLnN0YXRlUHJvcGVydGllcyA9IGZhYnJpYy5PYmplY3QucHJvdG90eXBlLnN0YXRlUHJvcGVydGllcy5jb25jYXQoW1wibW92ZW1lbnRMaW1pdHNcIixcImNsaXBUb1wiXSk7XG5mYWJyaWMuSVRleHQucHJvdG90eXBlLnN0YXRlUHJvcGVydGllcyAgPSBmYWJyaWMuSVRleHQucHJvdG90eXBlLnN0YXRlUHJvcGVydGllcy5jb25jYXQoW1wibW92ZW1lbnRMaW1pdHNcIixcImNsaXBUb1wiXSk7XG5mYWJyaWMuSW1hZ2UucHJvdG90eXBlLnN0YXRlUHJvcGVydGllcyAgPSBmYWJyaWMuSW1hZ2UucHJvdG90eXBlLnN0YXRlUHJvcGVydGllcy5jb25jYXQoW1wibW92ZW1lbnRMaW1pdHNcIixcImNsaXBUb1wiXSk7XG5cblxuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9tb2R1bGVzL21vdmVtZW50TGltaXRzLmpzIiwiXG52YXIgX09CSiA9IGZhYnJpYy5PYmplY3QucHJvdG90eXBlO1xudmFyIF9oYW5kbGVHcm91cGluZ19vdmVyd3JpdHRlbiA9IGZhYnJpYy5DYW52YXMucHJvdG90eXBlLl9oYW5kbGVHcm91cGluZztcbmZhYnJpYy5PYmplY3QucHJvdG90eXBlLmdyb3VwYWJsZSA9IHRydWU7XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLkNhbnZhcy5wcm90b3R5cGUsIHtcbiAgLyoqXG4gICAqIERlYWN0aXZhdGVzIGFsbCBvYmplY3RzIGFuZCBkaXNwYXRjaGVzIGFwcHJvcHJpYXRlIGV2ZW50c1xuICAgKiBAcmV0dXJuIHtmYWJyaWMuQ2FudmFzfSB0aGlzQXJnXG4gICAqIEBjaGFpbmFibGVcbiAgICovXG4gIGRlYWN0aXZhdGVBbGxXaXRoRGlzcGF0Y2g6IGZ1bmN0aW9uIChlKSB7XG4gICAgdmFyIGFjdGl2ZUdyb3VwID0gdGhpcy5nZXRBY3RpdmVHcm91cCgpLFxuICAgICAgYWN0aXZlT2JqZWN0ID0gdGhpcy5nZXRBY3RpdmVPYmplY3QoKTtcbiAgICB2YXIgX3RhcmdldCA9IGFjdGl2ZU9iamVjdCB8fCBhY3RpdmVHcm91cDtcbiAgICBpZiAoX3RhcmdldCkge1xuICAgICAgdGhpcy5maXJlKCdiZWZvcmU6c2VsZWN0aW9uOmNsZWFyZWQnLCB7IHRhcmdldDogX3RhcmdldCwgZTogZSB9KTtcbiAgICB9XG4gICAgdGhpcy5kZWFjdGl2YXRlQWxsKCk7XG4gICAgaWYgKF90YXJnZXQpIHtcbiAgICAgIHRoaXMuZmlyZSgnc2VsZWN0aW9uOmNsZWFyZWQnLCB7IGU6IGUsIHRhcmdldDogX3RhcmdldCB9KTtcbiAgICAgIF90YXJnZXQuZmlyZSgnZGVzZWxlY3RlZCcpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfSxcblxuICAvKipcbiAgICogRGl2aWRlcyBvYmplY3RzIGluIHR3byBncm91cHMsIG9uZSB0byByZW5kZXIgaW1tZWRpYXRlbHlcbiAgICogYW5kIG9uZSB0byByZW5kZXIgYXMgYWN0aXZlR3JvdXAuXG4gICAqIHJldHVybiBvYmplY3RzIHRvIHJlbmRlciBpbW1lZGlhdGVseSBhbmQgcHVzaGVzIHRoZSBvdGhlciBpbiB0aGUgYWN0aXZlR3JvdXAuXG4gICAqL1xuICBfY2hvb3NlT2JqZWN0c1RvUmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgYWN0aXZlR3JvdXAgPSB0aGlzLmdldEFjdGl2ZUdyb3VwKCksXG4gICAgICBhY3RpdmVPYmplY3QgPSB0aGlzLmdldEFjdGl2ZU9iamVjdCgpLFxuICAgICAgb2JqZWN0LCBvYmpzVG9SZW5kZXIgPSBbIF0sIGFjdGl2ZUdyb3VwT2JqZWN0cyA9IFsgXTtcblxuICAgIGlmIChhY3RpdmVHcm91cCAmJiAhdGhpcy5wcmVzZXJ2ZU9iamVjdFN0YWNraW5nKSB7XG4gICAgICBmb3IgKHZhciBpID0gMCwgbGVuZ3RoID0gdGhpcy5fb2JqZWN0cy5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgICBvYmplY3QgPSB0aGlzLl9vYmplY3RzW2ldO1xuICAgICAgICBpZiAoIWFjdGl2ZUdyb3VwLmNvbnRhaW5zKG9iamVjdCkpIHtcbiAgICAgICAgICBpZighb2JqZWN0LmhpZGRlbkFjdGl2ZSl7XG4gICAgICAgICAgICBvYmpzVG9SZW5kZXIucHVzaChvYmplY3QpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICBhY3RpdmVHcm91cE9iamVjdHMucHVzaChvYmplY3QpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoYWN0aXZlR3JvdXApIHtcbiAgICAgICAgLy8gYWN0aXZlR3JvdXAuX3NldCgnX29iamVjdHMnLCBhY3RpdmVHcm91cE9iamVjdHMpO1xuICAgICAgICBvYmpzVG9SZW5kZXIucHVzaChhY3RpdmVHcm91cCk7XG4gICAgICB9XG4gICAgICBhY3RpdmVPYmplY3QgJiYgb2Jqc1RvUmVuZGVyLnB1c2goYWN0aXZlT2JqZWN0KTtcbiAgICAgIC8vIGFjdGl2ZUdyb3VwLl9zZXQoJ19vYmplY3RzJywgYWN0aXZlR3JvdXBPYmplY3RzKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICBvYmpzVG9SZW5kZXIgPSB0aGlzLl9vYmplY3RzO1xuICAgIH1cbiAgICByZXR1cm4gb2Jqc1RvUmVuZGVyO1xuICB9LFxuICAvKipcbiAgICogYWRkaW5nIGJlZm9yZTpzZWxlY3Rpb246Y3JlYXRlZCBldmVudFxuICAgKiBAcHJpdmF0ZVxuICAgKiBAcGFyYW0ge0V2ZW50fSBlIEV2ZW50IG9iamVjdFxuICAgKiBAcGFyYW0ge2ZhYnJpYy5PYmplY3R9IHRhcmdldFxuICAgKi9cbiAgX2hhbmRsZUdyb3VwaW5nOiBmdW5jdGlvbiAoZSwgdGFyZ2V0KSB7XG4gICAgdGhpcy5maXJlKFwiYmVmb3JlOnNlbGVjdGlvbjpjcmVhdGVkXCIpO1xuICAgIF9oYW5kbGVHcm91cGluZ19vdmVyd3JpdHRlbi5jYWxsKHRoaXMsIGUsIHRhcmdldCk7XG4gIH0sXG4gIC8qKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAcGFyYW0ge0V2ZW50fSBlIG1vdXNlIGV2ZW50XG4gICAqL1xuICBfZ3JvdXBTZWxlY3RlZE9iamVjdHM6IGZ1bmN0aW9uIChlKSB7XG5cbiAgICB2YXIgZ3JvdXAgPSB0aGlzLl9jb2xsZWN0T2JqZWN0cygpO1xuXG4gICAgZ3JvdXAgPSBmYWJyaWMudXRpbC5vYmplY3QuZmlsdGVyKGdyb3VwLHtncm91cGFibGU6IHRydWV9KTtcblxuICAgIC8vIGRvIG5vdCBjcmVhdGUgZ3JvdXAgZm9yIDEgZWxlbWVudCBvbmx5XG4gICAgaWYgKGdyb3VwLmxlbmd0aCA9PT0gMSkge1xuICAgICAgdGhpcy5zZXRBY3RpdmVPYmplY3QoZ3JvdXBbMF0sIGUpO1xuICAgIH1cbiAgICBlbHNlIGlmIChncm91cC5sZW5ndGggPiAxKSB7XG4gICAgICBncm91cCA9IG5ldyBmYWJyaWMuR3JvdXAoZ3JvdXAucmV2ZXJzZSgpLCB7XG4gICAgICAgIGNhbnZhczogdGhpc1xuICAgICAgfSk7XG4gICAgICBncm91cC5hZGRXaXRoVXBkYXRlKCk7XG4gICAgICB0aGlzLnNldEFjdGl2ZUdyb3VwKGdyb3VwLCBlKTtcbiAgICAgIGdyb3VwLnNhdmVDb29yZHMoKTtcbiAgICAgIHRoaXMuZmlyZSgnc2VsZWN0aW9uOmNyZWF0ZWQnLCB7IHRhcmdldDogZ3JvdXAgfSk7XG4gICAgICB0aGlzLnJlbmRlckFsbCgpO1xuICAgIH1cbiAgfVxufSk7XG5cbl9PQkouY2xvbmVTeW5jID0gZnVuY3Rpb24oKXtcbiAgdmFyIF9rbGFzcyA9IGZhYnJpY1tmYWJyaWMudXRpbC5zdHJpbmcuY2FtZWxpemUoZmFicmljLnV0aWwuc3RyaW5nLmNhcGl0YWxpemUodGhpcy50eXBlKSldO1xuICBpZihfa2xhc3MuYXN5bmMpe1xuICAgIHZhciBfb2JqID0gbmV3IF9rbGFzcy5mcm9tT2JqZWN0KHRoaXMsZnVuY3Rpb24oKXtcblxuICAgIH0pO1xuICB9ZWxzZXtcbiAgICB2YXIgX29iaiA9IHRoaXMuY2xvbmUoKTtcbiAgfVxuICBfb2JqLmNhbnZhcyA9IHRoaXMuY2FudmFzO1xuICByZXR1cm4gX29iajtcbn07XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLkdyb3VwLnByb3RvdHlwZSwge1xuICBpc1Bvc3NpYmxlVGFyZ2V0OiBmdW5jdGlvbiAoZSwgb2JqZWN0KSB7XG4gICAgcmV0dXJuIHRoaXMuc2VhcmNoUG9zc2libGVUYXJnZXRzKGUsIFtvYmplY3RdKS50YXJnZXQgIT09IG51bGw7XG4gIH0sXG4gIC8qKlxuICAgKiByZXR1cm4gaW5uZXIgdGFyZ2V0IGFuZCBncm91cCBvZiB0YXJnZXRzIHVuZGVyIHRoZSBjdXJzb3JcbiAgICogQHBhcmFtIGVcbiAgICogQHBhcmFtIG9iamVjdHNcbiAgICogQHJldHVybnMge3t0YXJnZXQ6IG51bGwsIGdyb3VwOiBBcnJheX19XG4gICAqL1xuICBzZWFyY2hQb3NzaWJsZVRhcmdldHM6IGZ1bmN0aW9uIChlLCBvYmplY3RzKSB7XG5cbiAgICBpZiAoIW9iamVjdHMpb2JqZWN0cyA9IHRoaXMuX29iamVjdHM7XG4gICAgdmFyIHBvaW50ZXIgPSB0aGlzLmNhbnZhcy5nZXRQb2ludGVyKGUsIHRydWUpO1xuICAgIHZhciBpID0gb2JqZWN0cy5sZW5ndGgsXG4gICAgICBub3JtYWxpemVkUG9pbnRlciA9IHRoaXMuY2FudmFzLl9ub3JtYWxpemVQb2ludGVyKHRoaXMsIHBvaW50ZXIpO1xuXG4gICAgdmFyIHRhcmdldHMgPSB7XG4gICAgICB0YXJnZXQ6IG51bGwsXG4gICAgICBncm91cDogW11cbiAgICB9O1xuICAgIHdoaWxlIChpLS0pIHtcbiAgICAgIGlmICh0aGlzLmNhbnZhcy5fY2hlY2tUYXJnZXQobm9ybWFsaXplZFBvaW50ZXIsIG9iamVjdHNbaV0pKSB7XG4gICAgICAgIGlmICghdGFyZ2V0cy50YXJnZXQpdGFyZ2V0cy50YXJnZXQgPSBvYmplY3RzW2ldO1xuICAgICAgICB0YXJnZXRzLmdyb3VwLnB1c2gob2JqZWN0c1tpXSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0YXJnZXRzO1xuICB9LFxuXG4gIGdyb3VwU2VsZWN0YWJsZTogdHJ1ZSxcbiAgY2xvbmVTeW5jOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgX2Nsb25lZE9iamVjdHMgPSB0aGlzLl9vYmplY3RzLm1hcChmdW5jdGlvbihvYmplY3Qpe1xuICAgICAgcmV0dXJuIG9iamVjdC5jbG9uZVN5bmMoKTtcbiAgICB9KTtcblxuXG4gICAgdmFyIG9iamVjdCA9IHRoaXMudG9PYmplY3QoKTtcbiAgICBkZWxldGUgb2JqZWN0Lm9iamVjdHM7XG5cbiAgICByZXR1cm4gbmV3IGZhYnJpYy5Hcm91cChfY2xvbmVkT2JqZWN0cywgb2JqZWN0LCB0cnVlKTtcblxuICAgIC8vIGZhYnJpYy51dGlsLmVubGl2ZW5PYmplY3RzKG9iamVjdC5vYmplY3RzLCBmdW5jdGlvbiAoZW5saXZlbmVkT2JqZWN0cykge1xuICAgIC8vICAgZGVsZXRlIG9iamVjdC5vYmplY3RzO1xuICAgIC8vICAgY2FsbGJhY2sgJiYgY2FsbGJhY2sobmV3IGZhYnJpYy5Hcm91cChlbmxpdmVuZWRPYmplY3RzLCBvYmplY3QsIHRydWUpKTtcbiAgICAvLyB9KTtcbiAgfSxcbiAgX2NhbGNCb3VuZHMgOiBmdW5jdGlvbiAob25seVdpZHRoSGVpZ2h0KSB7XG4gICAgdmFyIGFYID0gW10sXG4gICAgICBhWSA9IFtdLFxuICAgICAgbywgcHJvcCxcbiAgICAgIHByb3BzID0gWyd0cicsICdicicsICdibCcsICd0bCddO1xuXG4gICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHRoaXMuX29iamVjdHMubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHtcbiAgICAgIG8gPSB0aGlzLl9vYmplY3RzW2ldO1xuICAgICAgaWYgKG8ubm90U2VsZWN0YWJsZUluVGhlR3JvdXApIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBvLnNldENvb3JkcygpO1xuICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBwcm9wcy5sZW5ndGg7IGorKykge1xuICAgICAgICBwcm9wID0gcHJvcHNbal07XG4gICAgICAgIGFYLnB1c2goby5vQ29vcmRzW3Byb3BdLngpO1xuICAgICAgICBhWS5wdXNoKG8ub0Nvb3Jkc1twcm9wXS55KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLnNldCh0aGlzLl9nZXRCb3VuZHMoYVgsIGFZLCBvbmx5V2lkdGhIZWlnaHQpKTtcbiAgfSxcbiAgaW5pdGlhbGl6ZV9vdmVyd3JpdHRlbjogZmFicmljLkdyb3VwLnByb3RvdHlwZS5pbml0aWFsaXplLFxuICBpc1NlbGVjdGlvbkdyb3VwOiBmdW5jdGlvbigpe1xuICAgIHJldHVybiB0aGlzLmNhbnZhcy5fb2JqZWN0cy5pbmRleE9mKHRoaXMpID09PSAtMVxuICB9LFxuICAvL2Nsb25lOiBmdW5jdGlvbihjYWxsYmFjayl7XG4gIC8vICBpZihjYWxsYmFjayA9PT0gdHJ1ZSB8fCBjYWxsYmFjay5jb25zdHJ1Y3RvciA9PT0gT2JqZWN0KXtcbiAgLy8gICAgdmFyIF9mcmFtZSA9IG5ldyBmYWJyaWMuR3JvdXAodGhpcyk7XG4gIC8vICAgIGlmKGNhbGxiYWNrLmNvbnN0cnVjdG9yID09PSBPYmplY3Qpe1xuICAvLyAgICAgIF9mcmFtZS5zZXQoY2FsbGJhY2spO1xuICAvLyAgICAgIHJldHVybiBfZnJhbWU7XG4gIC8vICAgIH1cbiAgLy8gIH1cbiAgLy8gIHJldHVybiB0aGlzLmNhbGxTdXBlcignY2xvbmUnLGNhbGxiYWNrKTtcbiAgLy99LFxuICBpbml0aWFsaXplOiBmdW5jdGlvbihvYmplY3RzLG9wdGlvbnMpe1xuICAgIGlmKG9iamVjdHMuY29uc3RydWN0b3IgIT0gQXJyYXkpe1xuICAgICAgdmFyIGVsID0gb2JqZWN0cztcbiAgICAgIG9wdGlvbnMgPSBlbC50b09iamVjdCgpO1xuICAgICAgb2JqZWN0cyA9IFtdO1xuICAgICAgZm9yKHZhciBpIGluIGVsLl9vYmplY3RzKXtcbiAgICAgICAgb2JqZWN0cy5wdXNoKGVsLl9vYmplY3RzW2ldLmNsb25lU3luYygpKVxuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMuaW5pdGlhbGl6ZV9vdmVyd3JpdHRlbihvYmplY3RzLG9wdGlvbnMpO1xuICAgIGlmKHRoaXMudHlwZSA9PSAnZ3JvdXAnKXtcbiAgICAgIHRoaXMub24oXCJkYmxjbGlja1wiLCBmdW5jdGlvbigpe1xuICAgICAgICBpZih0aGlzLmNhbnZhcy5fb2JqZWN0cy5pbmRleE9mKHRoaXMpID09PSAtMSl7XG4gICAgICAgICAgdGhpcy5ncm91cFNlbGVjdGVkRWxlbWVudHMoKTtcbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgdGhpcy51bmdyb3VwKCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfSxcbiAgdW5ncm91cCA6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuY2FudmFzLmRpc2NhcmRBY3RpdmVHcm91cCgpO1xuICAgIHRoaXMuX3Jlc3RvcmVPYmplY3RzU3RhdGUoKTtcbiAgICB0aGlzLmNhbnZhcy5yZW1vdmUodGhpcyk7XG4gICAgZm9yKHZhciBpIGluIHRoaXMuX29iamVjdHMpe1xuICAgICAgdGhpcy5jYW52YXMuYWRkKHRoaXMuX29iamVjdHNbaV0pO1xuICAgICAgdGhpcy5fb2JqZWN0c1tpXS5jbGlwVG8gPSB0aGlzLmNsaXBUbztcbiAgICAgIC8vdGhpcy5fb2JqZWN0c1tpXS5hY3RpdmUgPSB0cnVlO1xuICAgIH1cbiAgICB2YXIgZ3JvdXAgPSBuZXcgZmFicmljLkdyb3VwKHRoaXMuX29iamVjdHMsIHtcbiAgICAgIGNhbnZhczogdGhpcy5jYW52YXNcbiAgICB9KTtcbiAgICBncm91cC5hZGRXaXRoVXBkYXRlKCk7XG4gICAgdGhpcy5jYW52YXMuc2V0QWN0aXZlR3JvdXAoZ3JvdXApO1xuICAgIGdyb3VwLnNhdmVDb29yZHMoKTtcbiAgICB0aGlzLmNhbnZhcy5maXJlKCdzZWxlY3Rpb246Y3JlYXRlZCcsIHsgdGFyZ2V0OiBncm91cCB9KTtcbiAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcblxuICAgIC8vdmFyIF9ncm91cCA9IG5ldyBmYWJyaWMuR3JvdXAodGhpcy5fb2JqZWN0cyk7XG4gICAgLy9fZ3JvdXAuY2FudmFzID0gdGhpcy5jYW52YXM7XG4gICAgLy90aGlzLmNhbnZhcy5zZXRBY3RpdmVPYmplY3QoX2dyb3VwKTtcbiAgfSxcblxuICBncm91cFNlbGVjdGVkRWxlbWVudHM6IGZ1bmN0aW9uKCl7XG5cblxuXG4gICAgdmFyIGVsID0gdGhpcy5jbG9uZVN5bmMoKTtcbiAgICB0aGlzLmNhbnZhcy5hZGQoZWwpO1xuICAgIHRoaXMuY2FudmFzLmRpc2NhcmRBY3RpdmVHcm91cCgpO1xuICAgIHRoaXMuY2FudmFzLnNldEFjdGl2ZU9iamVjdChlbCk7XG5cbiAgICBmb3IodmFyIGkgaW4gdGhpcy5fb2JqZWN0cyl7XG4gICAgICB0aGlzLmNhbnZhcy5yZW1vdmUodGhpcy5fb2JqZWN0c1tpXS5vcmlnaW5hbE9iamVjdCk7XG4gICAgfVxuXG5cbiAgfSxcbiAgYWN0aW9uczoge1xuXG4gICAgcmVtb3ZlOiB7XG4gICAgICBjbGFzc05hbWU6ICAnZmEgZmEtdHJhc2gnLFxuICAgICAgdGl0bGU6ICAgICAgJ0RlbGV0ZScsXG4gICAgICBrZXk6ICAgICAgICBcIkRlbGV0ZVwiLFxuICAgICAgYWN0aW9uOiAgICAgZnVuY3Rpb24oKXtcbiAgICAgICAgaWYodGhpcy5pc1NlbGVjdGlvbkdyb3VwKCkpe1xuICAgICAgICAgIGZvcih2YXIgaSBpbiB0aGlzLl9vYmplY3RzKXtcbiAgICAgICAgICAgIHZhciBfb2JqID0gdGhpcy5fb2JqZWN0c1tpXTtcbiAgICAgICAgICAgIHRoaXMuY2FudmFzLnJlbW92ZShfb2JqLm9yaWdpbmFsT2JqZWN0KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy5jYW52YXMuZGlzY2FyZEFjdGl2ZUdyb3VwKCk7XG4gICAgICAgICAgdGhpcy5jYW52YXMuZGlzY2FyZEFjdGl2ZU9iamVjdCgpO1xuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICB0aGlzLmNhbnZhcy5yZW1vdmUodGhpcyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gICAgICB9XG4gICAgfSxcbiAgICBkdXBsaWNhdGU6IHtcbiAgICAgIGNsYXNzTmFtZTogICdmYSBmYS1jbG9uZScsXG4gICAgICB0aXRsZTogICAgICAnRHVwbGljYXRlJyxcbiAgICAgIGFjdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZih0aGlzLmlzU2VsZWN0aW9uR3JvdXAoKSl7XG4gICAgICAgICAgdGhpcy5jYW52YXMuZmlyZSgnYmVmb3JlOnNlbGVjdGlvbjpjbGVhcmVkJywgeyB0YXJnZXQ6IHRoaXMsIGU6IG51bGwgfSk7XG4gICAgICAgICAgdGhpcy5jYW52YXMuZGlzY2FyZEFjdGl2ZUdyb3VwKCk7XG4gICAgICAgICAgdGhpcy5kdXBsaWNhdGUoZnVuY3Rpb24oZWwpe1xuICAgICAgICAgICAgZWwudW5ncm91cCgpO1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gICAgICAgIH1lbHNle1xuICAgICAgICAgIHRoaXMuZHVwbGljYXRlKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuICAgIGdyb3VwU2VsZWN0ZWRFbGVtZW50czoge1xuICAgICAgdGl0bGU6ICfQs9GA0YPQv9C/0LAnLFxuICAgICAgY2xhc3NOYW1lOiAnZmEgZmEtb2JqZWN0LWdyb3VwJyxcbiAgICAgIHZpc2libGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiB0aGlzLmlzU2VsZWN0aW9uR3JvdXAoKTtcbiAgICAgIH0sXG4gICAgICBhY3Rpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5ncm91cFNlbGVjdGVkRWxlbWVudHMoKTtcbiAgICAgICAgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gICAgICB9XG4gICAgICAvL3Zpc2libGU6IElERS5ncm91cEF2YWlsYWJsZVxuICAgIH0sXG4gICAgdW5ncm91cDoge1xuICAgICAgdGl0bGU6ICfQs9GA0YPQv9C/0LAnLFxuICAgICAgY2xhc3NOYW1lOiAnZmEgZmEtb2JqZWN0LXVuZ3JvdXAnLFxuICAgICAgdmlzaWJsZTogZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2FudmFzLl9vYmplY3RzLmluZGV4T2YodGhpcykgIT09IC0xXG4gICAgICB9LFxuICAgICAgYWN0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMudW5ncm91cCgpO1xuICAgICAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn0pO1xuXG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLlNsaWRlQ2FudmFzLnByb3RvdHlwZSx7XG4gIGV2ZW50TGlzdGVuZXJzOiBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kQXJyYXlzT2JqZWN0KGZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUuZXZlbnRMaXN0ZW5lcnMsIHtcbiAgICAnc2VsZWN0aW9uOmNyZWF0ZWQnOiBmdW5jdGlvbihldmVudCl7XG4gICAgICB0aGlzLl9vblNlbGVjdGlvbkNyZWF0ZWQoZXZlbnQpO1xuICAgIH1cbiAgfSksXG4gIF9vblNlbGVjdGlvbk1vZGlmaWVkOiBmdW5jdGlvbiAoKSB7XG4gICAgZm9yICh2YXIgaSBpbiB0aGlzLl9vYmplY3RzKSB7XG4gICAgICB2YXIgY29weSA9IHRoaXMuX29iamVjdHNbaV0uY2xvbmVTeW5jKCk7XG4gICAgICBjb3B5Lmdyb3VwID0gdGhpcztcbiAgICAgIHRoaXMuX3Jlc3RvcmVPYmplY3RTdGF0ZShjb3B5KTtcbiAgICAgIHRoaXMuX29iamVjdHNbaV0ub3JpZ2luYWxPYmplY3Quc2V0KHtcbiAgICAgICAgY2xpcFRvOiB0aGlzLmNsaXBUbyxcbiAgICAgICAgbW92ZW1lbnRMaW1pdHM6IHRoaXMubW92ZW1lbnRMaW1pdHMsXG4gICAgICAgIGxlZnQ6IGNvcHkubGVmdCxcbiAgICAgICAgdG9wOiBjb3B5LnRvcCxcbiAgICAgICAgYW5nbGU6IGNvcHkuYW5nbGUsXG4gICAgICAgIHNjYWxlWDogY29weS5zY2FsZVgsXG4gICAgICAgIHNjYWxlWTogY29weS5zY2FsZVksXG4gICAgICAgIHNrZXdYOiBjb3B5LnNrZXdYLFxuICAgICAgICBza2V3WTogY29weS5za2V3WSxcbiAgICAgICAgd2lkdGg6IGNvcHkud2lkdGgsXG4gICAgICAgIGhlaWdodDogY29weS5oZWlnaHRcbiAgICAgIH0pO1xuICAgIH1cbiAgfSxcbiAgX29uU2VsZWN0aW9uRGVzZWxlY3RlZDogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICBmb3IgKHZhciBpIGluIHRoaXMuX29iamVjdHMpIHtcbiAgICAgIHZhciBfb2JqID0gdGhpcy5fb2JqZWN0c1tpXTtcbiAgICAgIF9vYmoub3JpZ2luYWxPYmplY3Quc2V0Q29vcmRzKCk7XG4gICAgICBfb2JqLm9yaWdpbmFsT2JqZWN0LmV2ZW50ZWQgPSB0cnVlO1xuICAgICAgZGVsZXRlIF9vYmoub3JpZ2luYWxPYmplY3QuaGlkZGVuQWN0aXZlO1xuICAgIH1cbiAgfSxcbiAgX29uU2VsZWN0aW9uQ3JlYXRlZDogZnVuY3Rpb24gKGVsKSB7XG5cbiAgICB2YXIgZ3JvdXAgID0gZWwudGFyZ2V0O1xuXG4gICAgdmFyIG9yaWdpbmFsT2JqZWN0cyA9IFtdXG4gICAgZm9yKHZhciBpIGluIGdyb3VwLl9vYmplY3RzKXtcbiAgICAgIHZhciBfb2JqID0gZ3JvdXAuX29iamVjdHNbaV07XG4gICAgICBvcmlnaW5hbE9iamVjdHMucHVzaChfb2JqLm9yaWdpbmFsT2JqZWN0IHx8IF9vYmopXG4gICAgfVxuXG4gICAgZ3JvdXAuZGVzdHJveSgpO1xuICAgIGdyb3VwLl9vYmplY3RzID0gW107XG5cbiAgICB2YXIgX2NsaXBUbyA9IG9yaWdpbmFsT2JqZWN0c1swXS5jbGlwVG87XG5cbiAgICBmb3IgKHZhciBpIGluIG9yaWdpbmFsT2JqZWN0cykge1xuICAgICAgdmFyIG9yaWdpbmFsID0gb3JpZ2luYWxPYmplY3RzW2ldO1xuXG4gICAgICBpZiAoX2NsaXBUbyAhPSBvcmlnaW5hbC5jbGlwVG8pIHtcbiAgICAgICAgX2NsaXBUbyA9IGZhbHNlO1xuICAgICAgfVxuXG4gICAgICB2YXIgX29iaiA9IG9yaWdpbmFsLmNsb25lU3luYygpO1xuXG4gICAgICBfb2JqLnNldCh7XG4gICAgICAgIGNsaXBUbzogbnVsbCxcbiAgICAgICAgb3JpZ2luYWxPYmplY3Q6IG9yaWdpbmFsXG4gICAgICB9KTtcbiAgICAgIG9yaWdpbmFsLnNldCh7XG4gICAgICAgIGFjdGl2ZTpmYWxzZSxcbiAgICAgICAgZXZlbnRlZDogZmFsc2UsXG4gICAgICAgIGhpZGRlbkFjdGl2ZTogdHJ1ZVxuICAgICAgfSk7XG5cbiAgICAgIGdyb3VwLmFkZFdpdGhVcGRhdGUoX29iaik7XG4gICAgICBncm91cC5zZXRDb29yZHMoKTtcbiAgICB9XG5cbiAgICBncm91cC5jbGlwVG8gPSAgX2NsaXBUbztcblxuICAgIGdyb3VwLm9uKHtcbiAgICAgIFwibW9kaWZpZWRcIjogdGhpcy5fb25TZWxlY3Rpb25Nb2RpZmllZCxcbiAgICAgICdkZXNlbGVjdGVkJzogdGhpcy5fb25TZWxlY3Rpb25EZXNlbGVjdGVkXG4gICAgfSk7XG5cbiAgfVxufSk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL21vZHVsZXMvZ3JvdXBzLmpzIiwiJ3VzZSBzdHJpY3QnO1xuXG52YXIgSGlzdG9yeSA9IHJlcXVpcmUoJy4vLi4vcGx1Z2lucy9oaXN0b3J5Jyk7XG5cbkhpc3RvcnkucHJvdG90eXBlLmluc2VydFJlY29yZHMgPSBmYWxzZTtcbkhpc3RvcnkucHJvdG90eXBlLmFjdGlvbnMgPSB7XG4gIHVuZG86IHtcbiAgICBrZXlDb2RlOiAneicsXG4gICAgY3RybEtleTogIHRydWUsXG4gICAgb2JzZXJ2ZTogJ2NoYW5nZWQnLFxuICAgIGNsYXNzTmFtZTogJ2ZhIGZhLXVuZG8nLFxuICAgIHRpdGxlOiAndW5kbycsXG4gICAgZW5hYmxlZDogJ2NhblVuZG8nLFxuICAgIGFjdGlvbjogZnVuY3Rpb24oKXtcbiAgICAgIHRoaXMudW5kbygpO1xuICAgIH1cbiAgfSxcbiAgcmVjb3Jkczoge1xuICAgIHRpdGxlOiAgICAgICAgICBcInJlY29yZHNcIixcbiAgICBpdGVtQ2xhc3NOYW1lOiAgXCJmaWx0ZXJzLXNlbGVjdG9yXCIsXG4gICAgY2xhc3NOYW1lOiAgICAgIFwiZmEgZmEtaGlzdG9yeVwiLFxuICAgIHR5cGU6ICAgICAgICAgICBcInNlbGVjdFwiLFxuICAgIHRlbXBsYXRlU2VsZWN0aW9uOiBmdW5jdGlvbihzdGF0ZSwgY29udGFpbmVyKSB7XG4gICAgICBpZiAoc3RhdGUuYW55KSB7XG4gICAgICAgIHJldHVybiBzdGF0ZS50ZXh0O1xuICAgICAgfVxuICAgICAgcmV0dXJuICQoJzxzcGFuPicgKyBzdGF0ZS5pZCArIFwiOlwiICsgc3RhdGUudHlwZSArICc8L3NwYW4+Jyk7XG4gICAgfSxcbiAgICB0ZW1wbGF0ZVJlc3VsdDogZnVuY3Rpb24oc3RhdGUsIGNvbnRhaW5lcixkYXRhKSB7XG4gICAgICBpZighc3RhdGUudHlwZSlyZXR1cm47XG4gICAgICB2YXIgX2tleXMgPSBzdGF0ZS5vcmlnaW5hbFN0YXRlICYmIE9iamVjdC5rZXlzKHN0YXRlLm9yaWdpbmFsU3RhdGUpLmpvaW4oJywnKSB8fCAnJztcbiAgICAgIHZhciB0eXBlID0gc3RhdGUub2JqZWN0ICYmIHN0YXRlLm9iamVjdC50eXBlIHx8ICcnO1xuICAgICAgcmV0dXJuICQoXCI8c3Bhbj57aWR9Ont0eXBlfSh7b3R5cGV9IHtrZXlzfSk8L3NwYW4+XCIuZm9ybWF0KGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoe2tleXMgOiBfa2V5cywgb3R5cGU6IHR5cGV9LHN0YXRlKSkpO1xuICAgICAgLy8gaWYoc3RhdGUuaWQgIT0gXCJub25lXCIpe1xuICAgICAgLy8gICB2YXIgJGNhbnZhcyA9ICQoJzxjYW52YXM+Jyk7XG4gICAgICAvLyAgICRlbC5wcmVwZW5kKCRjYW52YXMpO1xuICAgICAgLy8gfVxuICAgICAgLy8gcmV0dXJuICRlbDtcbiAgICB9LFxuICAgIHZhbHVlOiAgICAgIHtcbiAgICAgIG9ic2VydmU6ICdjaGFuZ2VkJyxcbiAgICAgIHNldCA6IGZ1bmN0aW9uKHZhbCxmaWx0ZXJzRGF0YSl7XG4gICAgICAgIHRoaXMuZ290byh2YWwpO1xuICAgICAgfSxcbiAgICAgIGdldDogZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuIHRoaXMucmVjb3Jkc1t0aGlzLmN1cnJlbnRdLmlkO1xuICAgICAgfSxcbiAgICAgIG9wdGlvbnM6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiB0aGlzLnJlY29yZHM7XG4gICAgICB9XG4gICAgfVxuICB9LFxuICByZWRvOiB7XG4gICAga2V5Q29kZTogJ3knLFxuICAgIGN0cmxLZXk6ICB0cnVlLFxuICAgIG9ic2VydmU6ICdjaGFuZ2VkJyxcbiAgICBjbGFzc05hbWU6ICdmYSBmYS1yZXBlYXQnLFxuICAgIHRpdGxlOiAncmVkbycsXG4gICAgZW5hYmxlZDogJ2NhblJlZG8nLFxuICAgIGFjdGlvbjogZnVuY3Rpb24oKXtcbiAgICAgIHRoaXMucmVkbygpO1xuICAgIH1cbiAgfVxufTtcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuU2xpZGVDYW52YXMucHJvdG90eXBlLmFjdGlvbnMsIHtcbiAgaGlzdG9yeToge1xuICAgIHRpdGxlOiAnaGlzdG9yeScsXG4gICAgdHlwZTogJ21lbnUnLFxuICAgIHRhcmdldDogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuaGlzdG9yeTtcbiAgICB9LFxuICAgIG1lbnU6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLmFjdGlvbnM7XG4gICAgfVxuICB9XG59KTtcblxuXG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLkNhbnZhcy5wcm90b3R5cGUsIHtcbiAgaW5zZXJ0SGlzdG9yeTogZmFsc2UsXG4gIG9uT2JqZWN0TW9kaWZpZWQ6IGZ1bmN0aW9uIChlKSB7XG4gICAgaWYgKCF0aGlzLmhpc3RvcnkuZW5hYmxlZCB8fCB0aGlzLnByb2Nlc3NpbmcgfHwgdGhpcy5oaXN0b3J5LnByb2Nlc3NpbmcpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgdmFyIF9jYW52YXMgPSBlLnRhcmdldC5jYW52YXMgfHwgZS50YXJnZXQud3JhcHBlckVsICYmIGUudGFyZ2V0O1xuXG4gICAgdGhpcy5oaXN0b3J5LmFkZCh7XG4gICAgICBjYW52YXM6ICBlLnRhcmdldC5jYW52YXMub3JpZ2luYWxTbGlkZSB8fCBlLnRhcmdldC5jYW52YXMsXG4gICAgICBvcmlnaW5hbFN0YXRlOiAgZS5zdGF0ZXMub3JpZ2luYWwsXG4gICAgICBtb2RpZmllZFN0YXRlOiAgZS5zdGF0ZXMubW9kaWZpZWQsXG4gICAgICBvYmplY3Q6IGUudGFyZ2V0LFxuICAgICAgdHlwZTogJ29iamVjdDptb2RpZmllZCcsXG4gICAgICB1bmRvOiBmdW5jdGlvbiAoX2FjdGlvbikge1xuICAgICAgICBfYWN0aW9uLm9iamVjdC5zZXQoX2FjdGlvbi5vcmlnaW5hbFN0YXRlKTtcbiAgICAgICAgaWYoX2FjdGlvbi5jYW52YXMubWlycm9yU2xpZGUgPT0gdGhpcy5jYW52YXMpe1xuICAgICAgICAgIF9hY3Rpb24ub2JqZWN0LnNldENvb3JkcygpO1xuICAgICAgICAgIHZhciBfY2FudmFzID0gdGhpcy5jYW52YXMgfHwgdGhpcztcbiAgICAgICAgICBfY2FudmFzLnJlbmRlckFsbCgpO1xuICAgICAgICB9XG4gICAgICAgIF9hY3Rpb24uY2FudmFzLmZpcmUoJ29iamVjdDptb2RpZmllZCcsIHsgdGFyZ2V0OiBfYWN0aW9uLm9iamVjdCB9KTtcbiAgICAgICAgX2FjdGlvbi5vYmplY3QuZmlyZSgnbW9kaWZpZWQnKTtcbiAgICAgICAgX2FjdGlvbi5jYW52YXMucmVuZGVyQWxsKCk7XG4gICAgICB9LFxuICAgICAgcmVkbzogZnVuY3Rpb24gKF9hY3Rpb24pIHtcbiAgICAgICAgX2FjdGlvbi5vYmplY3Quc2V0KF9hY3Rpb24ubW9kaWZpZWRTdGF0ZSk7XG4gICAgICAgIF9hY3Rpb24ub2JqZWN0LnNldENvb3JkcygpO1xuICAgICAgICBpZihfYWN0aW9uLmNhbnZhcy5taXJyb3JTbGlkZSA9PSB0aGlzLmNhbnZhcyl7XG4gICAgICAgICAgX2FjdGlvbi5vYmplY3Quc2V0Q29vcmRzKCk7XG4gICAgICAgICAgdmFyIF9jYW52YXMgPSB0aGlzLmNhbnZhcyB8fCB0aGlzO1xuICAgICAgICAgIF9jYW52YXMucmVuZGVyQWxsKCk7XG4gICAgICAgIH1cbiAgICAgICAgX2FjdGlvbi5jYW52YXMuZmlyZSgnb2JqZWN0Om1vZGlmaWVkJywgeyB0YXJnZXQ6IF9hY3Rpb24ub2JqZWN0IH0pO1xuICAgICAgICBfYWN0aW9uLm9iamVjdC5maXJlKCdtb2RpZmllZCcpO1xuICAgICAgICBfYWN0aW9uLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSxcbiAgY2xlYXJIaXN0b3J5OiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5oaXN0b3J5LmNsZWFyKCk7XG4gIH0sXG4gIGRpc2FibGVIaXN0b3J5OiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5oaXN0b3J5LmVuYWJsZWQgPSBmYWxzZTtcbiAgfSxcbiAgX2FkZF9vYmplY3RfaGlzdG9yeV9hY3Rpb246IGZ1bmN0aW9uIChfYWN0aW9uKSB7XG4gICAgdmFyIF9jYW52YXMgPSB0aGlzLmNhbnZhcyB8fCB0aGlzO1xuICAgIGlmKHRoaXMuY2FudmFzICYmIF9hY3Rpb24uY2FudmFzLm1pcnJvclNsaWRlID09IHRoaXMuY2FudmFzKXtcbiAgICAgIF9jYW52YXMuYWRkKF9hY3Rpb24ub2JqZWN0KTtcbiAgICAgIF9jYW52YXMuc2V0QWN0aXZlT2JqZWN0KF9hY3Rpb24ub2JqZWN0KTtcbiAgICAgIF9jYW52YXMucmVuZGVyQWxsKCk7XG4gICAgfWVsc2V7XG4gICAgICBfYWN0aW9uLmNhbnZhcy5hZGQoX2FjdGlvbi5vYmplY3QpO1xuICAgIH1cbiAgICBfYWN0aW9uLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgfSxcblxuICBfcmVtb3ZlX29iamVjdF9oaXN0b3J5X2FjdGlvbjogZnVuY3Rpb24gKF9hY3Rpb24pIHtcbiAgICBfYWN0aW9uLmNhbnZhcy5yZW1vdmUoX2FjdGlvbi5vYmplY3QpO1xuICAgIF9hY3Rpb24uY2FudmFzLnJlbmRlckFsbCgpO1xuICAgIGlmKHRoaXMuY2FudmFzICYmIF9hY3Rpb24uY2FudmFzLm1pcnJvclNsaWRlID09IHRoaXMuY2FudmFzKXtcbiAgICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgIH1cbiAgfSxcblxuICBvbk9iamVjdFJlbW92ZWQ6IGZ1bmN0aW9uIChlKSB7XG4gICAgaWYgKCF0aGlzLmhpc3RvcnkuZW5hYmxlZCB8fCB0aGlzLnByb2Nlc3NpbmcgfHwgdGhpcy5oaXN0b3J5LnByb2Nlc3NpbmcpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgdGhpcy5oaXN0b3J5LmFkZCh7XG4gICAgICBjYW52YXM6IGUudGFyZ2V0LmNhbnZhcy5vcmlnaW5hbFNsaWRlIHx8IGUudGFyZ2V0LmNhbnZhcyxcbiAgICAgIG9iamVjdDogZS50YXJnZXQsXG4gICAgICB0eXBlOiAnb2JqZWN0OnJlbW92ZWQnLFxuICAgICAgcmVkbzogdGhpcy5fcmVtb3ZlX29iamVjdF9oaXN0b3J5X2FjdGlvbixcbiAgICAgIHVuZG86IHRoaXMuX2FkZF9vYmplY3RfaGlzdG9yeV9hY3Rpb25cbiAgICB9KTtcbiAgfSxcbiAgb25EcmF3QWZ0ZXI6IGZ1bmN0aW9uKGV2ZW50KXtcbiAgICBpZiAoIXRoaXMuaGlzdG9yeS5lbmFibGVkIHx8IHRoaXMucHJvY2Vzc2luZyB8fCB0aGlzLmhpc3RvcnkucHJvY2Vzc2luZykge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICB0aGlzLmhpc3RvcnkuYWRkKHRoaXMuZnJlZURyYXdpbmdCcnVzaC5nZXRIaXN0b3J5UmVjb3JkKGV2ZW50KSlcbiAgfSxcbiAgb25PYmplY3RBZGRlZDogZnVuY3Rpb24gKGUpIHtcbiAgICBpZiAoIXRoaXMuaGlzdG9yeS5lbmFibGVkIHx8IHRoaXMucHJvY2Vzc2luZyB8fCB0aGlzLmhpc3RvcnkucHJvY2Vzc2luZykge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICB0aGlzLmhpc3RvcnkuYWRkKHtcbiAgICAgIGNhbnZhczogIGUudGFyZ2V0LmNhbnZhcy5vcmlnaW5hbFNsaWRlIHx8IGUudGFyZ2V0LmNhbnZhcyxcbiAgICAgIG9iamVjdDogZS50YXJnZXQsXG4gICAgICB0eXBlOiAnb2JqZWN0OmFkZGVkJyxcbiAgICAgIHVuZG86IHRoaXMuX3JlbW92ZV9vYmplY3RfaGlzdG9yeV9hY3Rpb24sXG4gICAgICByZWRvOiB0aGlzLl9hZGRfb2JqZWN0X2hpc3RvcnlfYWN0aW9uXG4gICAgfSk7XG4gIH0sXG4gIGluaXRIaXN0b3J5OiBmdW5jdGlvbiAoaGlzdG9yeSkge1xuICAgIGlmKCFoaXN0b3J5KXtcbiAgICAgIGhpc3RvcnkgPSBuZXcgSGlzdG9yeSh0aGlzKTtcbiAgICAgIGhpc3RvcnkuYXBwbGljYXRpb24gPSB0aGlzLmFwcGxpY2F0aW9uO1xuICAgIH1cblxuICAgIHRoaXMuaGlzdG9yeSA9IGhpc3Rvcnk7XG4gICAgdGhpcy5vbih7XG4gICAgICAnbG9hZGluZzpiZWdpbic6ICAgIHRoaXMuY2xlYXJIaXN0b3J5LFxuICAgICAgJ2RyYXc6YWZ0ZXInOiAgICAgICB0aGlzLm9uRHJhd0FmdGVyLFxuICAgICAgJ29iamVjdDptb2RpZmllZCc6ICB0aGlzLm9uT2JqZWN0TW9kaWZpZWQsXG4gICAgICAnb2JqZWN0OmFkZGVkJzogICAgIHRoaXMub25PYmplY3RBZGRlZCxcbiAgICAgICdvYmplY3Q6cmVtb3ZlZCc6ICAgdGhpcy5vbk9iamVjdFJlbW92ZWRcbiAgICB9KTtcblxuICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgdGhpcy5oaXN0b3J5Lm9uKCdjaGFuZ2VkJywgZnVuY3Rpb24oZSl7XG4gICAgICBpZih0aGlzLmFjdGl2ZUFjdGlvbi5jYW52YXMpe1xuICAgICAgICB0aGlzLmFjdGl2ZUFjdGlvbi5jYW52YXMubW9tZW50ID0gZS5hY3Rpb24ubW9tZW50O1xuICAgICAgfVxuICAgIH0pO1xuICAgIHZhciBwcm90byA9IHRoaXMuYXBwbGljYXRpb24ucHJvdG90eXBlcy5IaXN0b3J5O1xuICAgIGlmKHByb3RvKXtcbiAgICAgIGlmKHByb3RvLmV2ZW50TGlzdGVuZXJzKXtcbiAgICAgICAgaGlzdG9yeS5vbihwcm90by5ldmVudExpc3RlbmVycyk7XG4gICAgICB9XG4gICAgfVxuICB9LFxuICBlbmFibGVIaXN0b3J5OiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5oaXN0b3J5LmVuYWJsZWQgPSB0cnVlO1xuICB9XG59KTtcblxuZmFicmljLkhJU1RPUllfT1BUSU9OUyA9IHtcbiAgSU5ESVZJRFVBTDogMCxcbiAgU0hBUkVEOiAxXG59O1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5BcHBsaWNhdGlvbi5wcm90b3R5cGUsIHtcbiAgaGlzdG9yeTogdHJ1ZSxcbiAgc2V0SGlzdG9yeTogZnVuY3Rpb24oaGlzdG9yeU9wdGlvbil7XG5cbiAgICBpZihoaXN0b3J5T3B0aW9uID09PSBmYWJyaWMuSElTVE9SWV9PUFRJT05TLlNIQVJFRCl7XG4gICAgICB0aGlzLmhpc3RvcnkgPSBuZXcgSGlzdG9yeSh0aGlzKTtcbiAgICAgIHRoaXMuZW5hYmxlSGlzdG9yeSgpO1xuXG4gICAgICB0aGlzLm9uKFwicmVhZHlcIixmdW5jdGlvbigpe1xuICAgICAgICBpZiAodGhpcy5jYW52YXMpIHtcbiAgICAgICAgICB0aGlzLmNhbnZhcy5pbml0SGlzdG9yeSh0aGlzLmhpc3RvcnkpO1xuICAgICAgICB9XG4gICAgICB9KVxuXG4gICAgfVxuICAgIGlmKGhpc3RvcnlPcHRpb24gPT09IGZhYnJpYy5ISVNUT1JZX09QVElPTlMuSU5ESVZJRFVBTCl7XG4gICAgICAvL3RvZG8gdW5zdXBwb3J0ZWRcbiAgICB9XG5cbiAgfSxcbiAgYWN0aW9uczogZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuQXBwbGljYXRpb24ucHJvdG90eXBlLmFjdGlvbnMse1xuICAgIGhpc3Rvcnk6IHtcbiAgICAgIGluc2VydDogJ2hpc3RvcnlUb29scycsXG4gICAgICB0aXRsZTogJ2hpc3RvcnknLFxuICAgICAgdHlwZTogJ21lbnUnLFxuICAgICAgdGFyZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmhpc3Rvcnk7XG4gICAgICB9LFxuICAgICAgbWVudTogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5hY3Rpb25zO1xuICAgICAgfVxuICAgIH1cbiAgfSksXG4gIF9kZWZhdWx0X2V2ZW50X2xpc3RlbmVycyA6IHtcbiAgICBcInNsaWRlOmNoYW5nZTpiZWdpblwiIDogZnVuY3Rpb24oKXtcbiAgICAgIHRoaXMucHJvY2Vzc2luZyA9IHRydWUgO1xuICAgICAgaWYodGhpcy5oaXN0b3J5KXtcbiAgICAgICAgdGhpcy5oaXN0b3J5LnByb2Nlc3NpbmcgPSB0cnVlIDtcbiAgICAgIH1cbiAgICB9LFxuICAgIFwic2xpZGU6Y2hhbmdlZFwiIDogZnVuY3Rpb24oKXtcbiAgICAgIHRoaXMucHJvY2Vzc2luZyA9IGZhbHNlO1xuICAgICAgaWYodGhpcy5oaXN0b3J5KXtcbiAgICAgICAgdGhpcy5oaXN0b3J5LnByb2Nlc3NpbmcgPSBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIGhpc3RvcnlUb29sczogZmFsc2UsXG4gIGVuYWJsZUhpc3Rvcnk6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmhpc3RvcnkuZW5hYmxlZCA9IHRydWU7XG4gIH1cbn0pO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9tb2R1bGVzL2hpc3RvcnkuanMiLCJcbnZhciB1dGlscyA9IHJlcXVpcmUoJy4vLi4vdXRpbC91dGlsLmpzJyk7XG51dGlscy5vYmplY3QgPSByZXF1aXJlKCcuLy4uL3V0aWwvb2JqZWN0LmpzJyk7XG5cblxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gKiogRFBIaXN0b3J5XG4gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG5cblxudmFyIERQSGlzdG9yeSA9IGZ1bmN0aW9uIChwYXJlbnQsIGluaXRBY3Rpb24pIHtcbiAgICB0aGlzLnBhcmVudCA9IHBhcmVudDtcbiAgICB0aGlzLmNsZWFyKGluaXRBY3Rpb24pO1xufTtcblxuRFBIaXN0b3J5LnByb3RvdHlwZS5zZXRSZWNvcmRzID0gZnVuY3Rpb24gKHJlY29yZHMsY3VycmVudCkge1xuICB0aGlzLmNhblVuZG8gPSByZWNvcmRzLmxlbmd0aDtcbiAgdGhpcy5jYW5SZWRvID0gZmFsc2U7XG5cbiAgaWYoIXJlY29yZHMubGVuZ3RoKXtcbiAgICByZWNvcmRzID0gW3tcbiAgICAgIHR5cGU6ICdpbml0aWFsaXplZCcsXG4gICAgICBpZDogMCxcbiAgICAgIHRleHQgOiAnaW5pdGlhbGl6ZWQnXG4gICAgfV1cbiAgfVxuICB0aGlzLnJlY29yZHMgPSByZWNvcmRzO1xuICB0aGlzLmxlbmd0aCA9IHRoaXMucmVjb3Jkcy5sZW5ndGggO1xuICB0aGlzLmN1cnJlbnQgPSBjdXJyZW50ID09PSB1bmRlZmluZWQgPyByZWNvcmRzLmxlbmd0aCAtIDEgOiBjdXJyZW50O1xuICB0aGlzLmFjdGl2ZUFjdGlvbiA9IHRoaXMucmVjb3Jkc1t0aGlzLmN1cnJlbnRdO1xuICB0aGlzLmZpcmUoXCJjaGFuZ2VkXCIse2FjdGlvbjogdGhpcy5hY3RpdmVBY3Rpb259KTtcbiAgcmV0dXJuIHRoaXM7XG59O1xuXG5EUEhpc3RvcnkucHJvdG90eXBlLnJlc3RvcmUgPSBmdW5jdGlvbiAoKSB7XG4gIHRoaXMuc2V0UmVjb3Jkcyh0aGlzLnNhdmVkLnJlY29yZHMsdGhpcy5zYXZlZC5jdXJyZW50KTtcbiAgcmV0dXJuIHRoaXM7XG59O1xuXG5EUEhpc3RvcnkucHJvdG90eXBlLnNhdmUgPSBmdW5jdGlvbiAoKSB7XG4gIHRoaXMuc2F2ZWQgPSB7XG4gICAgY3VycmVudDogdGhpcy5jdXJyZW50LFxuICAgIHJlY29yZHM6IHV0aWxzLm9iamVjdC5jbG9uZURlZXAodGhpcy5yZWNvcmRzKVxuICB9XG4gIHJldHVybiB0aGlzO1xufTtcblxuRFBIaXN0b3J5LnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uIChpbml0QWN0aW9uKSB7XG4gICAgaWYgKGluaXRBY3Rpb24pIHtcbiAgICAgICAgaW5pdEFjdGlvbi5pZCA9IDA7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgaW5pdEFjdGlvbiA9IHtcbiAgICAgICAgICAgIHR5cGU6ICdpbml0aWFsaXplZCcsXG4gICAgICAgICAgICBpZDogMCxcbiAgICAgICAgICB0ZXh0IDogJ2luaXRpYWxpemVkJ1xuICAgICAgICB9XG4gICAgfVxuICAgIHRoaXMucmVjb3JkcyA9IFtpbml0QWN0aW9uXTtcbiAgICB0aGlzLmN1cnJlbnQgPSAwO1xuICAgIHRoaXMuY2FuVW5kbyA9IGZhbHNlO1xuICAgIHRoaXMuY2FuUmVkbyA9IGZhbHNlO1xuICAgIHRoaXMuYWN0aXZlQWN0aW9uID0gdGhpcy5yZWNvcmRzW3RoaXMuY3VycmVudF07XG4gIHRoaXMuZmlyZShcImNoYW5nZWRcIix7YWN0aW9uOiB0aGlzLmFjdGl2ZUFjdGlvbn0pO1xuICByZXR1cm4gdGhpcztcbn07XG5cblxuRFBIaXN0b3J5LnByb3RvdHlwZS5hZGQgPSBmdW5jdGlvbihhY3Rpb24pe1xuXG5cbiAgICBpZiAoIXRoaXMuZW5hYmxlZCB8fCB0aGlzLnByb2Nlc3NpbmcpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBhY3Rpb24ubW9tZW50ID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gICAgdGhpcy5jYW5VbmRvID0gdHJ1ZTtcbiAgICB0aGlzLmNhblJlZG8gPSBmYWxzZTtcbiAgICB0aGlzLnJlY29yZHMuc3BsaWNlKHRoaXMuY3VycmVudCsgMSk7XG4gICAgdGhpcy5yZWNvcmRzLnB1c2goYWN0aW9uKTtcbiAgICB0aGlzLmxlbmd0aCA9IHRoaXMucmVjb3Jkcy5sZW5ndGg7XG4gICAgYWN0aW9uLmlkID0gdGhpcy5sZW5ndGggLSAxO1xuICAgIGFjdGlvbi50ZXh0ID0gYWN0aW9uLnR5cGUgfHwgYWN0aW9uLnRleHQ7XG4gICAgdGhpcy5jdXJyZW50ID0gdGhpcy5sZW5ndGggLSAxO1xuXG4gIHRoaXMuYWN0aXZlQWN0aW9uID0gdGhpcy5yZWNvcmRzW3RoaXMuY3VycmVudF07XG4gIHRoaXMuZmlyZShcImNoYW5nZWRcIix7YWN0aW9uOiBhY3Rpb259KTtcbiAgcmV0dXJuIHRoaXM7XG59O1xuRFBIaXN0b3J5LnByb3RvdHlwZS5kaXNhYmxlID0gZnVuY3Rpb24oKXtcbiAgdGhpcy5lbmFibGVkID0gZmFsc2U7XG4gIHJldHVybiB0aGlzO1xufTtcbkRQSGlzdG9yeS5wcm90b3R5cGUuZW5hYmxlID0gZnVuY3Rpb24oKXtcbiAgdGhpcy5lbmFibGVkID0gdHJ1ZTtcbiAgcmV0dXJuIHRoaXM7XG59O1xuRFBIaXN0b3J5LnByb3RvdHlwZS51bmRvID0gZnVuY3Rpb24obm9GaXJlKXtcbiAgICB0aGlzLmNhblJlZG8gPSB0cnVlO1xuICAgIHZhciBfYWN0aW9uID0gdGhpcy5yZWNvcmRzW3RoaXMuY3VycmVudF07XG4gICAgdGhpcy5jdXJyZW50LS07XG4gIHRoaXMucHJvY2Vzc2luZyA9IHRydWU7XG4gICAgX2FjdGlvbi51bmRvLmNhbGwodGhpcy5wYXJlbnQsX2FjdGlvbik7XG4gIHRoaXMucHJvY2Vzc2luZyA9IGZhbHNlO1xuICAgIGlmKHRoaXMuY3VycmVudCA9PSAwKXtcbiAgICAgICAgdGhpcy5jYW5VbmRvID0gZmFsc2U7XG4gICAgfVxuICAgIGlmKCFub0ZpcmUpe1xuICAgICAgdGhpcy5hY3RpdmVBY3Rpb24gPSB0aGlzLnJlY29yZHNbdGhpcy5jdXJyZW50XTtcbiAgICAgIHRoaXMuZmlyZShcImNoYW5nZWRcIix7YWN0aW9uOiBfYWN0aW9ufSk7XG4gICAgfVxuICByZXR1cm4gdGhpcztcbn07XG5cbkRQSGlzdG9yeS5wcm90b3R5cGUuZ290byA9IGZ1bmN0aW9uKGluZGV4KXtcbiAgICBpZihpbmRleCA9PSB0aGlzLmN1cnJlbnQpcmV0dXJuO1xuICAgIGlmKGluZGV4IDwgdGhpcy5jdXJyZW50KXtcbiAgICAgICAgZm9yKHZhciBpID0gdGhpcy5jdXJyZW50IC0gaW5kZXggO2ktLTsgKXtcbiAgICAgICAgICAgIHRoaXMudW5kbyh0cnVlKTtcbiAgICAgICAgfVxuICAgIH1pZihpbmRleCA+IHRoaXMuY3VycmVudCl7XG4gICAgICAgIGZvcih2YXIgaSA9IGluZGV4IC0gdGhpcy5jdXJyZW50IDtpLS07ICl7XG4gICAgICAgICAgICB0aGlzLnJlZG8odHJ1ZSk7XG4gICAgICAgIH1cbiAgICB9XG4gIHRoaXMuYWN0aXZlQWN0aW9uID0gdGhpcy5yZWNvcmRzW3RoaXMuY3VycmVudF07XG4gIHRoaXMuZmlyZShcImNoYW5nZWRcIix7YWN0aW9uOiB0aGlzLmFjdGl2ZUFjdGlvbn0pO1xuICByZXR1cm4gdGhpcztcbn07XG5cbkRQSGlzdG9yeS5wcm90b3R5cGUucmVkbyA9IGZ1bmN0aW9uKG5vRmlyZSl7XG4gICAgaWYodGhpcy5jdXJyZW50ID09IHRoaXMubGVuZ3RoIC0gMSl7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gIHRoaXMucHJvY2Vzc2luZyA9IHRydWU7XG4gICAgdGhpcy5jYW5VbmRvID0gdHJ1ZTtcbiAgICB0aGlzLmN1cnJlbnQrKztcbiAgICB2YXIgX2FjdGlvbiA9IHRoaXMucmVjb3Jkc1t0aGlzLmN1cnJlbnRdO1xuXG4gICAgX2FjdGlvbi5yZWRvLmNhbGwodGhpcy5wYXJlbnQsX2FjdGlvbik7XG5cbiAgICBpZih0aGlzLmN1cnJlbnQgPT0gdGhpcy5sZW5ndGggLSAxKXtcbiAgICAgICAgdGhpcy5jYW5SZWRvID0gZmFsc2U7XG4gICAgfVxuICB0aGlzLnByb2Nlc3NpbmcgPSBmYWxzZTtcbiAgaWYoIW5vRmlyZSkge1xuICAgIHRoaXMuYWN0aXZlQWN0aW9uID0gdGhpcy5yZWNvcmRzW3RoaXMuY3VycmVudF07XG4gICAgdGhpcy5maXJlKFwiY2hhbmdlZFwiLHthY3Rpb246IF9hY3Rpb259KTtcbiAgfVxuICByZXR1cm4gdGhpcztcbn07XG51dGlscy5vYnNlcnZhYmxlKERQSGlzdG9yeS5wcm90b3R5cGUpO1xubW9kdWxlLmV4cG9ydHMgPSBEUEhpc3Rvcnk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL3BsdWdpbnMvaGlzdG9yeS5qcyIsIid1c2Ugc3RyaWN0JztcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vbW9kdWxlIHJlc3BvbnNpdmUgYm9yZGVycy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5PYmplY3QucHJvdG90eXBlLCB7XG4gIHJlc3BvbnNpdmVCb3JkZXJzOiBmYWxzZVxufSk7XG5cbmlmKCFmYWJyaWMuU2xpZGVDYW52YXMucHJvdG90eXBlLl9kZWZhdWx0X2V2ZW50X2xpc3RlbmVycyl7XG4gIGZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUuX2RlZmF1bHRfZXZlbnRfbGlzdGVuZXJzID0ge307XG59O1xuXG5mYWJyaWMuT2JqZWN0LnByb3RvdHlwZS51cGRhdGVSZXNwb25zaXZlQm9yZGVyID0gZnVuY3Rpb24oKXtcbiAgaWYodGhpcy5yZXNwb25zaXZlQm9yZGVycyl7XG4gICAgaWYoIXRoaXMub3JpZ2luYWxTdHJva2VXaWR0aCl7XG4gICAgICB0aGlzLm9yaWdpbmFsU3Ryb2tlV2lkdGggPSB0aGlzLnN0cm9rZVdpZHRoO1xuICAgIH1cbiAgICB0aGlzLnN0cm9rZVdpZHRoID0gdGhpcy5jYW52YXMgPyB0aGlzLm9yaWdpbmFsU3Ryb2tlV2lkdGggLyB0aGlzLmNhbnZhcy52aWV3cG9ydFRyYW5zZm9ybVswXSA6IDA7XG4gIH1cbn07XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLlNsaWRlQ2FudmFzLnByb3RvdHlwZSwge1xuICBfZGVmYXVsdF9ldmVudF9saXN0ZW5lcnM6IHtcbiAgICBcImRpbWVuc2lvbnM6bW9kaWZpZWRcIjogZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5jZW50ZXJBbmRab29tT3V0KCk7XG4gICAgfSxcbiAgICAndmlld3BvcnQ6c2NhbGVkJzogZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKHRoaXMuYmFja2dyb3VuZEltYWdlKSB7XG4gICAgICAgIHRoaXMuYmFja2dyb3VuZEltYWdlLnVwZGF0ZVJlc3BvbnNpdmVCb3JkZXIoKTtcbiAgICAgIH1cbiAgICAgIGZvciAodmFyIGkgaW4gdGhpcy5fb2JqZWN0cykge1xuICAgICAgICB0aGlzLl9vYmplY3RzW2ldLnVwZGF0ZVJlc3BvbnNpdmVCb3JkZXIoKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIFwiYmFja2dyb3VuZC1pbWFnZTpsb2FkZWRcIjogZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICBpZiAodGhpcy5hdXRvQ2VudGVyQW5kWm9vbU91dEVuYWJsZWQpIHtcbiAgICAgICAgdGhpcy5jZW50ZXJBbmRab29tT3V0KCk7XG4gICAgICB9XG4gICAgfSxcbiAgICBcImxvYWRpbmc6ZW5kXCI6IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgaWYgKHRoaXMuYXV0b0NlbnRlckFuZFpvb21PdXRFbmFibGVkICYmICh0aGlzLm9yaWdpbmFsSGVpZ2h0IHx8IHRoaXMub3JpZ2luYWxXaWR0aCkpIHtcbiAgICAgICAgdGhpcy5jZW50ZXJBbmRab29tT3V0KCk7XG4gICAgICB9XG4gICAgfSxcbiAgICBcIm9iamVjdDphZGRlZFwiOiBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgIGV2ZW50LnRhcmdldC51cGRhdGVSZXNwb25zaXZlQm9yZGVyKClcbiAgICB9XG4gIH1cbn0pO1xuXG5cbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG5cblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuU2xpZGVDYW52YXMucHJvdG90eXBlLCB7XG4gIHpvb21DdHJsS2V5OiB0cnVlLFxuICBtb3VzZVdoZWVsRW5hYmxlZCA6IGZhbHNlLFxuICBfc2V0Wm9vbU5hdGl2ZSAgOiBmYWJyaWMuQ2FudmFzLnByb3RvdHlwZS5zZXRab29tLFxuICBfem9vbVRvUG9pbnROYXRpdmUgIDogZmFicmljLkNhbnZhcy5wcm90b3R5cGUuem9vbVRvUG9pbnQsXG4gIGNoYW5nZURpbWVuc2lvbk9uWm9vbTogZmFsc2UsXG4gIGRyYXdab29tQXJlYSA6IGZ1bmN0aW9uKF9jdHgsbGVmdCwgdG9wICx3aWR0aCwgaGVpZ2h0ICl7XG4gICAgX2N0eC5zYXZlKCk7XG4gICAgX2N0eC50cmFuc2xhdGUobGVmdCB8fCAwLCB0b3AgfHwgMCk7XG4gICAgdmFyIF9zY2FsZSA9IHRoaXMuZ2V0Wm9vbSgpO1xuICAgIHZhciBfc2l6ZSA9IGZhYnJpYy51dGlsLmdldFByb3BvcnRpb25zKHRoaXMuYmFja2dyb3VuZEltYWdlLCB7d2lkdGg6IHdpZHRoIHx8IDEwMCwgaGVpZ2h0OiBoZWlnaHQgfHwgMTAwfSk7XG4gICAgX2N0eC5nbG9iYWxBbHBoYSA9IDAuNTtcbiAgICBfY3R4LmZpbGxSZWN0KDAsMCxfc2l6ZS53aWR0aCwgX3NpemUuaGVpZ2h0KTtcbiAgICBfY3R4LnN0cm9rZVN0eWxlID0gXCJyZWRcIjtcblxuICAgIHZhciB2ID0gdGhpcy52aWV3cG9ydFRyYW5zZm9ybTtcblxuICAgIHZhciB4MSA9IC12WzRdICogX3NpemUuc2NhbGUgLyBfc2NhbGU7XG4gICAgdmFyIHkxID0gLXZbNV0gKiBfc2l6ZS5zY2FsZSAvIF9zY2FsZTtcbiAgICB2YXIgeDIgPSB4MSArIHRoaXMud2lkdGggKiBfc2l6ZS5zY2FsZSAvIF9zY2FsZTtcbiAgICB2YXIgeTIgPSB5MSArIHRoaXMuaGVpZ2h0ICogX3NpemUuc2NhbGUgLyBfc2NhbGU7XG5cbiAgICB4MSA9IE1hdGgubWF4KHgxLDApO1xuICAgIHkxID0gTWF0aC5tYXgoeTEsMCk7XG4gICAgeDIgPSBNYXRoLm1pbih4Mixfc2l6ZS53aWR0aCk7XG4gICAgeTIgPSBNYXRoLm1pbih5Mixfc2l6ZS5oZWlnaHQpO1xuXG4gICAgX2N0eC5nbG9iYWxBbHBoYSA9IDE7XG4gICAgX2N0eC5iZWdpblBhdGgoKTtcbiAgICBfY3R4Lm1vdmVUbyh4MSx5MSk7XG4gICAgX2N0eC5saW5lVG8oeDIseTEpO1xuICAgIF9jdHgubGluZVRvKHgyLHkyKTtcbiAgICBfY3R4LmxpbmVUbyh4MSx5Mik7XG4gICAgX2N0eC5saW5lVG8oeDEseTEpO1xuXG4gICAgX2N0eC5maWxsKCk7XG4gICAgX2N0eC5jbGlwKCk7XG4gICAgLy8gX2N0eC5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSBcInNvdXJjZS1pblwiO1xuICAgIF9jdHguZHJhd0ltYWdlKHRoaXMuYmFja2dyb3VuZEltYWdlLl9lbGVtZW50LDAsMCxfc2l6ZS53aWR0aCwgX3NpemUuaGVpZ2h0KVxuICAgIC8vIF9jdHguZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gXCJzb3VyY2Utb3ZlclwiO1xuICAgIC8vIF9jdHguZHJhd0ltYWdlKHRoaXMuYmFja2dyb3VuZEltYWdlLl9lbGVtZW50LDAsMCxfc2l6ZS53aWR0aCwgX3NpemUuaGVpZ2h0KVxuICAgIF9jdHguc3Ryb2tlKCk7XG4gICAgX2N0eC5zdHJva2VSZWN0KDAsMCxfc2l6ZS53aWR0aCwgX3NpemUuaGVpZ2h0KTtcbiAgICBfY3R4LnJlc3RvcmUoKTtcbiAgfSxcbiAgc2V0Wm9vbTogZnVuY3Rpb24gKF9zY2FsZSl7XG4gICAgaWYodGhpcy5jaGFuZ2VEaW1lbnNpb25Pblpvb20pe1xuICAgICAgdmFyIF93ID0gTWF0aC5yb3VuZCh0aGlzLm9yaWdpbmFsV2lkdGggKiBfc2NhbGUpO1xuICAgICAgdmFyIF9oID0gTWF0aC5yb3VuZCh0aGlzLm9yaWdpbmFsSGVpZ2h0ICogX3NjYWxlKTtcbiAgICAgIHRoaXMuc2V0RGltZW5zaW9ucyh7XG4gICAgICAgIHdpZHRoOiBfdyxcbiAgICAgICAgaGVpZ2h0OiBfaFxuICAgICAgfSk7XG4gICAgfVxuICAgIHRoaXMuX3pvb21Ub1BvaW50TmF0aXZlKCBuZXcgZmFicmljLlBvaW50KDAsIDApLCBfc2NhbGUpXG4gICAgLy8gIHRoaXMuX3NldFpvb21OYXRpdmUoX3NjYWxlKTtcbiAgICB0aGlzLmZpcmUoJ3ZpZXdwb3J0OnNjYWxlZCcsIHtzY2FsZTogX3NjYWxlfSk7XG4gIH0sXG4gIHpvb21Ub1BvaW50OiBmdW5jdGlvbihwb2ludCwgbmV3Wm9vbSl7XG4gICAgdmFyIF9tYXggPSAgdGhpcy5nZXRNYXhab29tKCk7XG4gICAgdmFyIF9taW4gPSAgdGhpcy5nZXRNaW5ab29tKCkuc2NhbGU7XG4gICAgaWYobmV3Wm9vbSA+IF9tYXgpe1xuICAgICAgbmV3Wm9vbSA9IF9tYXg7XG4gICAgfVxuICAgIGlmKG5ld1pvb20gPCBfbWluKXtcbiAgICAgIG5ld1pvb20gPSBfbWluO1xuICAgIH1cbiAgICB0aGlzLl96b29tVG9Qb2ludE5hdGl2ZSggcG9pbnQsIG5ld1pvb20pO1xuICAgIGZvciAodmFyIGkgaW4gdGhpcy5fb2JqZWN0cykge1xuICAgICAgdGhpcy5fb2JqZWN0c1tpXS5zZXRDb29yZHMoKTtcbiAgICB9XG4gICAgdGhpcy5maXJlKCd2aWV3cG9ydDpzY2FsZWQnLCB7c2NhbGU6IG5ld1pvb219KTtcbiAgfSxcbiAgcmVzZXRWaWV3cG9ydDogZnVuY3Rpb24gKCkge1xuICAgIF9jYW52YXMudmlld3BvcnRUcmFuc2Zvcm1bMF0gPSAxO1xuICAgIF9jYW52YXMudmlld3BvcnRUcmFuc2Zvcm1bM10gPSAxO1xuICAgIF9jYW52YXMudmlld3BvcnRUcmFuc2Zvcm1bNF0gPSAwO1xuICAgIF9jYW52YXMudmlld3BvcnRUcmFuc2Zvcm1bNV0gPSAwO1xuICAgIF9jYW52YXMucmVuZGVyQWxsKCk7XG4gICAgZm9yICh2YXIgaSBpbiB0aGlzLl9vYmplY3RzKSB7XG4gICAgICB0aGlzLl9vYmplY3RzW2ldLnNldENvb3JkcygpO1xuICAgIH1cbiAgfSxcbiAgem9vbVRvUG9pbnRFbmFibGVkOiB0cnVlLFxuICBtaW5ab29tRmFjdG9yOiAxLFxuICBtYXhab29tOiAyMCxcbiAgYXV0b0NlbnRlckFuZFpvb21PdXRFbmFibGVkOiBmYWxzZSxcbiAgZ2V0TWF4Wm9vbTogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLm1heFpvb207XG4gIH0sXG4gIGdldE1pblpvb206IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgX2NvbnRhaW5lclNpemUgPSB7XG4gICAgICB3aWR0aDogJCh0aGlzLndyYXBwZXJFbCkud2lkdGgoKSxcbiAgICAgIGhlaWdodDogJCh0aGlzLndyYXBwZXJFbCkuaGVpZ2h0KClcbiAgICB9O1xuICAgIHZhciBfYmdTaXplID0ge1xuICAgICAgd2lkdGg6IHRoaXMub3JpZ2luYWxXaWR0aCxcbiAgICAgIGhlaWdodDogdGhpcy5vcmlnaW5hbEhlaWdodFxuICAgIH07XG4gICAgdmFyIF9tYXhTaXplID0ge1xuICAgICAgd2lkdGg6IF9jb250YWluZXJTaXplLndpZHRoICogdGhpcy5taW5ab29tRmFjdG9yLFxuICAgICAgaGVpZ2h0OiBfY29udGFpbmVyU2l6ZS5oZWlnaHQgKiB0aGlzLm1pblpvb21GYWN0b3JcbiAgICB9O1xuXG4gICAgcmV0dXJuIGZhYnJpYy51dGlsLmdldFByb3BvcnRpb25zKF9iZ1NpemUsIF9tYXhTaXplLCAnZml0Jyk7XG4gIH0sXG4gIGNlbnRlckFuZFpvb21PdXQ6IGZ1bmN0aW9uICgpIHtcblxuICAgIGlmKHRoaXMudmlydHVhbCl7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHZhciBvcHRpb25zID0gdGhpcy5nZXRNaW5ab29tKCk7XG5cbiAgICB2YXIgX2NvbnRhaW5lclNpemUgPSB7XG4gICAgICB3aWR0aDogJCh0aGlzLndyYXBwZXJFbCkud2lkdGgoKSxcbiAgICAgIGhlaWdodDogJCh0aGlzLndyYXBwZXJFbCkuaGVpZ2h0KClcbiAgICB9O1xuXG4gICAgdmFyIHZwdCA9IHRoaXMudmlld3BvcnRUcmFuc2Zvcm0uc2xpY2UoMCk7XG4gICAgdnB0WzBdID0gb3B0aW9ucy5zY2FsZTtcbiAgICB2cHRbM10gPSBvcHRpb25zLnNjYWxlO1xuICAgIHZwdFs0XSA9IChfY29udGFpbmVyU2l6ZS53aWR0aCAtIG9wdGlvbnMud2lkdGggKSAvIDI7XG4gICAgdnB0WzVdID0gKF9jb250YWluZXJTaXplLmhlaWdodCAtIG9wdGlvbnMuaGVpZ2h0KSAvIDI7XG5cbiAgICB0aGlzLnNldFZpZXdwb3J0VHJhbnNmb3JtKHZwdCk7XG5cblxuICAgIHRoaXMuX3VwZGF0ZV9iYWNrZ3JvdW5kX2ltYWdlKCk7XG4gICAgLy8gdGhpcy5maXJlKFwidmlld3BvcnQ6c2NhbGVkXCIse3NjYWxlOiBvcHRpb25zLnNjYWxlfSlcbiAgICAvL3RoaXMucmVuZGVyQWxsKCk7XG4gIH0sXG4gIGNlbnRlck9uT2JqZWN0OiBmdW5jdGlvbih0YWcpe1xuICAgIHZhciBiciA9IHRhZy5nZXRCb3VuZGluZ1JlY3QoKTtcbiAgICB2YXIgY3QgPSB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtO1xuICAgIGJyLndpZHRoIC89IGN0WzBdO1xuICAgIGJyLmhlaWdodCAvPSBjdFszXTtcbiAgICB2YXIgc2l6ZSA9IHtcbiAgICAgIHdpZHRoOiBici53aWR0aCAqIDEuMSxcbiAgICAgIGhlaWdodDogYnIuaGVpZ2h0ICogMS4xXG4gICAgfTtcblxuICAgIHZhciBwcm9wID0gZmFicmljLnV0aWwuZ2V0UHJvcG9ydGlvbnMoc2l6ZSx0aGlzKTtcbiAgICB2YXIgX3cgPSAodGhpcy53aWR0aCAvIHByb3Auc2NhbGUgLSBzaXplLndpZHRoICkgLyAyO1xuICAgIHZhciBfaCA9ICh0aGlzLmhlaWdodCAvIHByb3Auc2NhbGUgLSBzaXplLmhlaWdodCkgLyAyO1xuICAgIHZhciBfbCA9IChici5sZWZ0ICAtIGN0WzRdKSAvIGN0WzBdO1xuICAgIHZhciBfdCA9IChici50b3AgLSBjdFs1XSkgLyBjdFszXTtcblxuICAgIHZhciB4MSA9IFtcbiAgICAgIHByb3Auc2NhbGUsXG4gICAgICAwLDAsXG4gICAgICBwcm9wLnNjYWxlLFxuICAgICAgLSB0YWcubGVmdCAqIHByb3Auc2NhbGUgKyAodGFnLndpZHRoICogMC4wNSArIF93KSAqIHByb3Auc2NhbGUsXG4gICAgICAtIHRhZy50b3AgKiBwcm9wLnNjYWxlICsgKHRhZy5oZWlnaHQgKiAwLjA1ICsgX2ggKSogcHJvcC5zY2FsZVxuICAgIF07XG4gICAgdmFyIHgyID0gW1xuICAgICAgcHJvcC5zY2FsZSxcbiAgICAgIDAsMCxcbiAgICAgIHByb3Auc2NhbGUsXG4gICAgICAtIF9sICAqIHByb3Auc2NhbGUgKyAoYnIud2lkdGggKiAwLjA1ICsgX3cpICogcHJvcC5zY2FsZSxcbiAgICAgIC0gX3QgICogcHJvcC5zY2FsZSArIChici5oZWlnaHQgKiAwLjA1ICsgX2ggKSogcHJvcC5zY2FsZVxuICAgIF07XG5cbiAgICB0aGlzLnNldFZpZXdwb3J0VHJhbnNmb3JtKHgyKTtcbiAgICB0aGlzLmZpcmUoXCJ2aWV3cG9ydDpzY2FsZWRcIix7c2NhbGU6IHByb3Auc2NhbGV9KVxuICAgIHRoaXMucmVuZGVyQWxsKCk7XG4gIH0sXG5cbiAgX19vbk1vdXNlV2hlZWw6IGZ1bmN0aW9uIChldmVudCkge1xuXG4gICAgaWYoIXRoaXMubW91c2VXaGVlbEVuYWJsZWQgfHwgdGhpcy56b29tQ3RybEtleSAmJiAhZXZlbnQuY3RybEtleSl7XG4gICAgICByZXR1cm47XG4gICAgfVxuLy9GaW5kIG5lYXJlc3QgcG9pbnQsIHRoYXQgaXMgaW5zaWRlIGltYWdlIEVORFxuICAgIHZhciB6b29tU3RlcDsvLyA9IDAuMSAqIGV2ZW50LmRlbHRhWTtcbiAgICBpZiAoZXZlbnQuZGVsdGFZIDwgMCkge1xuICAgICAgem9vbVN0ZXAgPSAxLjE7XG4gICAgfSBlbHNlIHtcbiAgICAgIHpvb21TdGVwID0gMC45O1xuICAgIH1cblxuICAgIHZhciBuZXdab29tID0gdGhpcy5nZXRab29tKCkgKiB6b29tU3RlcDtcbiAgICB2YXIgbWluWm9vbSA9IHRoaXMuZ2V0TWluWm9vbSgpLnNjYWxlO1xuXG5cbiAgICBpZih0aGlzLnpvb21Ub1BvaW50RW5hYmxlZCl7XG4gICAgICB2YXIgcG9pbnQgPSBuZXcgZmFicmljLlBvaW50KGV2ZW50Lm9mZnNldFgsIGV2ZW50Lm9mZnNldFkpO1xuICAgICAgdmFyIF94ID0gdGhpcy52aWV3cG9ydFRyYW5zZm9ybVs0XTtcbiAgICAgIHZhciBfeSA9IHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bNV07XG5cbiAgICAgIC8vIEZpbmQgbmVhcmVzdCBwb2ludCwgdGhhdCBpcyBpbnNpZGUgaW1hZ2UgQkVHSU5cbiAgICAgIC8vIEl0IGlzIG5lZWRlZCB0byBwcmV2ZW50IGNhbnZhcyB0byB6b29tIG91dHNpZGUgaW1hZ2VcbiAgICAgIHZhciBfdyA9IHRoaXMub3JpZ2luYWxXaWR0aCAqIHRoaXMuZ2V0Wm9vbSgpICsgX3g7XG4gICAgICB2YXIgX2ggPSB0aGlzLm9yaWdpbmFsSGVpZ2h0ICogdGhpcy5nZXRab29tKCkgKyBfeTtcblxuXG4gICAgICBpZiAocG9pbnQueCA8IF94KSB7XG4gICAgICAgIHBvaW50LnggPSBfeDtcbiAgICAgIH1cbiAgICAgIGlmIChwb2ludC55IDwgX3kpIHtcbiAgICAgICAgcG9pbnQueSA9IF95O1xuICAgICAgfVxuICAgICAgaWYgKHBvaW50LnggPiBfdykge1xuICAgICAgICBwb2ludC54ID0gX3c7XG4gICAgICB9XG4gICAgICBpZiAocG9pbnQueSA+IF9oKSB7XG4gICAgICAgIHBvaW50LnkgPSBfaDtcbiAgICAgIH1cbiAgICAgIGlmIChtaW5ab29tID4gbmV3Wm9vbSkge1xuICAgICAgICBpZih0aGlzLmF1dG9DZW50ZXJBbmRab29tT3V0RW5hYmxlZCl7XG4gICAgICAgICAgdGhpcy5jZW50ZXJBbmRab29tT3V0KCk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuem9vbVRvUG9pbnQocG9pbnQsIG5ld1pvb20pO1xuICAgICAgfVxuICAgIH1lbHNle1xuICAgICAgdGhpcy5zZXRab29tKG5ld1pvb20pO1xuICAgIH1cblxuXG5cblxuICAgIGZvciAodmFyIGkgaW4gdGhpcy5fb2JqZWN0cykge1xuICAgICAgdGhpcy5fb2JqZWN0c1tpXS5zZXRDb29yZHMoKTtcbiAgICB9XG4gICAgdGhpcy5yZW5kZXJBbGwoKTtcbiAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIHJldHVybiBmYWxzZTsgLy9wcmV2ZW50aW5nIHNjcm9sbCBwYWdlXG4gIH0sXG4gIHNjYWxlRmFjdG9yOiAxLjEsXG4gIGdldE9yaWduYWxDZW50ZXIgOiBmdW5jdGlvbigpe1xuICAgIHZhciBwb2ludCA9IHRoaXMuZ2V0Q2VudGVyKCk7XG4gICAgcG9pbnQubGVmdCArPSB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzRdIDtcbiAgICBwb2ludC50b3AgKz0gdGhpcy52aWV3cG9ydFRyYW5zZm9ybVs1XTtcbiAgICByZXR1cm4gcG9pbnQ7XG4gIH1cbn0pO1xuXG5cblxuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUuYWN0aW9ucywge1xuICB6b29tT3V0OiB7XG4gICAgY2xhc3NOYW1lOiAnZmEgZmEtc2VhcmNoLW1pbnVzJyxcbiAgICB0aXRsZTogJ3pvb20tb3V0JyxcbiAgICBhY3Rpb246IGZ1bmN0aW9uIChtKSB7XG4gICAgICB2YXIgcG9pbnQgPSB0aGlzLmdldE9yaWduYWxDZW50ZXIoKTtcbiAgICAgIHZhciBzY2FsZVZhbHVlID0gdGhpcy5nZXRab29tKCkgLyB0aGlzLnNjYWxlRmFjdG9yO1xuICAgICAgdGhpcy56b29tVG9Qb2ludCh7eDogcG9pbnQubGVmdCwgeTogcG9pbnQudG9wfSxzY2FsZVZhbHVlKTtcbiAgICB9XG4gIH0sXG4gIHpvb21OdW1iZXI6IHtcbiAgICB0eXBlOiAnbnVtYmVyJyxcbiAgICB2YWx1ZToge1xuICAgICAgbWluOiAgZnVuY3Rpb24oKXtyZXR1cm4gMC4wMX0sXG4gICAgICBtYXg6ICBmdW5jdGlvbigpe3JldHVybiAxMH0sXG4gICAgICBzZXQ6IGZ1bmN0aW9uICh2YWwpIHtcbiAgICAgICAgdGhpcy5zZXRab29tKHZhbClcbiAgICAgIH0sXG4gICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0Wm9vbSgpXG4gICAgICB9LFxuICAgICAgb2JzZXJ2ZTogXCJ2aWV3cG9ydDpzY2FsZWRcIlxuICAgIH1cbiAgfSxcbiAgem9vbUluOiB7XG4gICAgY2xhc3NOYW1lOiAnZmEgZmEtc2VhcmNoLXBsdXMnLFxuICAgIHRpdGxlOiAnem9vbS1pbicsXG4gICAgYWN0aW9uOiBmdW5jdGlvbiAobSkge1xuICAgICAgdmFyIHBvaW50ID0gdGhpcy5nZXRPcmlnbmFsQ2VudGVyKCk7XG4gICAgICB2YXIgc2NhbGVWYWx1ZSA9IHRoaXMuZ2V0Wm9vbSgpICogdGhpcy5zY2FsZUZhY3RvcjtcbiAgICAgIHRoaXMuem9vbVRvUG9pbnQoe3g6IHBvaW50LmxlZnQsIHk6IHBvaW50LnRvcH0sc2NhbGVWYWx1ZSk7XG4gICAgfVxuICB9XG4gIC8vIHpvb206IHtcbiAgLy8gICB0aXRsZTogXCJ6b29tXCIsXG4gIC8vICAgbWVudTogem9vbU91dFxuICAvLyB9XG59KTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvbW9kdWxlcy96b29tLmpzIiwiLyoqXG4qIEludGVyYWN0aXZlTW9kZSBtaXhpbi4gQWxsb3cgdG8gc3dpdGNoIGJldHdlZW4gcGFuL2VkaXQvZHJhd2luZyBjYW52YXMgbW9kZXMuXG4qL1xuXG4ndXNlIHN0cmljdCc7XG5cblxudmFyIF9tb3VzZV9kb3duX292ZXJ3cml0dGVuID0gZmFicmljLkNhbnZhcy5wcm90b3R5cGUuX29uTW91c2VEb3duO1xudmFyIF9tb3VzZV91cF9vdmVyd3JpdHRlbiA9IGZhYnJpYy5DYW52YXMucHJvdG90eXBlLl9vbk1vdXNlVXA7XG52YXIgX21vdXNlX21vdmVfb3ZlcndyaXR0ZW4gPSBmYWJyaWMuQ2FudmFzLnByb3RvdHlwZS5fb25Nb3VzZU1vdmU7XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLlNsaWRlQ2FudmFzLnByb3RvdHlwZSwge1xuICBfaW5pdEV2ZW50TGlzdGVuZXJzX292ZXJ3cml0dGVuOiBmYWJyaWMuQ2FudmFzLnByb3RvdHlwZS5faW5pdEV2ZW50TGlzdGVuZXJzLFxuICBfaW5pdEV2ZW50TGlzdGVuZXJzOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5faW5pdEV2ZW50TGlzdGVuZXJzX292ZXJ3cml0dGVuKCk7XG4gICAgdGhpcy5fX19vbktleURvd24gPSB0aGlzLl9vbktleURvd24uYmluZCh0aGlzKTtcbiAgICBmYWJyaWMudXRpbC5hZGRMaXN0ZW5lcihmYWJyaWMud2luZG93LCAna2V5ZG93bicsIHRoaXMuX19fb25LZXlEb3duKTtcbiAgfSxcbiAgX3JlbW92ZUxpc3RlbmVyc19vdmVyd3JpdHRlbjogZmFicmljLkNhbnZhcy5wcm90b3R5cGUucmVtb3ZlTGlzdGVuZXJzLFxuICByZW1vdmVMaXN0ZW5lcnM6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLl9yZW1vdmVMaXN0ZW5lcnNfb3ZlcndyaXR0ZW4oKTtcbiAgICBmYWJyaWMudXRpbC5yZW1vdmVMaXN0ZW5lcihmYWJyaWMud2luZG93LCAna2V5ZG93bicsIHRoaXMuX19fb25LZXlEb3duKTtcbiAgfSxcbiAgX29uS2V5RG93bjogZnVuY3Rpb24gKGUpIHtcbiAgICByZXR1cm4gdGhpcy5fYXBwbHlNaXhlZE1vZGUoZSk7XG4gIH0sXG4gIGdldEludGVyYWN0aXZlTW9kZTogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLmludGVyYWN0aXZlTW9kZTtcbiAgfSxcbiAgc2V0SW50ZXJhY3RpdmVNb2RlOiBmdW5jdGlvbiAodG9vbCkge1xuICAgIC8vdG9kbyBjaGVja3RoaXMgb3V0XG4gICAgLy8gaWYgKHRvb2wgPT09ICdoYW5kJykge1xuICAgIC8vICAgdGhpcy5zZXRDdXJzb3IoJ3BvaW50ZXInKTtcbiAgICAvLyB9XG4gICAgdGhpcy5pc0RyYXdpbmdNb2RlID0gKHRvb2wgPT09ICdkcmF3Jyk7XG4gICAgdGhpcy5pc0hhbmRNb2RlID0gKHRvb2wgPT09ICdoYW5kJyk7XG4gICAgdGhpcy5pbnRlcmFjdGl2ZSA9ICh0b29sICE9PSAnZGlzYWJsZWQnKTtcbiAgICB0aGlzLmlzTWl4ZWRNb2RlID0gKHRvb2wgPT09ICdtaXhlZCcpO1xuXG4gICAgaWYgKCF0aGlzLmludGVyYWN0aXZlKSB7XG4gICAgICB0aGlzLnVwcGVyQ2FudmFzRWwuc3R5bGUuY3Vyc29yID0gJ2RlZmF1bHQnO1xuICAgIH1cbiAgICB0aGlzLmludGVyYWN0aXZlTW9kZSA9IHRvb2w7XG4gIH0sXG5cbiAgLyoqXG4gICAqICBjdXJyZW50IG1vZGVcbiAgICogIEB2YWx1ZXMgZGVmYXVsdCB8IGhhbmQgfCBzZWxlY3Rpb25cbiAgICogIEBjb21tZW50XG4gICAqICAgICAgaGFuZCAgICAgIC0gbW92aW5nIGNhbnZhc1xuICAgKiAgICAgIGRyYXcgLSBkcmF3aW5nIHJlYWN0YW5nbGVzXG4gICAqICAgICAgc2VsZWN0aW9uIC0gZGVmYXVsdCBiZWhhdmlvclxuICAgKi9cbiAgaW50ZXJhY3RpdmVNb2RlOiAnZGVmYXVsdCcsXG5cbiAgaXNIYW5kTW9kZTogZmFsc2UsXG4gIF9oYW5kTW9kZUN1cnNvck1vdmU6IGZhbHNlLFxuICBfaGFuZE1vZGVDdXJzb3JEb3duOiBmYWxzZSxcbiAgX2hhbmRNb2RlQ3Vyc29yUG9zaXRpb246IHt4OiAwLCB5OiAwfSxcbiAgX2hhbmRNb2RlTW91c2VNb3ZlOiBmdW5jdGlvbiAoZSkge1xuICAgIGlmICh0aGlzLl9oYW5kTW9kZUN1cnNvckRvd24gPT09IHRydWUpIHtcblxuICAgICAgaWYgKGUucGFnZVkgPT09IHRoaXMuX2hhbmRNb2RlQ3Vyc29yUG9zaXRpb24ueSAmJiBlLnBhZ2VYID09PSB0aGlzLl9oYW5kTW9kZUN1cnNvclBvc2l0aW9uLngpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICB0aGlzLl9oYW5kTW9kZUN1cnNvck1vdmUgPSB0cnVlO1xuXG4gICAgICB2YXIgc2Nyb2xsID0ge3g6IHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bNF0sIHk6IHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bNV19O1xuXG4gICAgICB2YXIgbmV3U2Nyb2xsID0ge1xuICAgICAgICB4OiBzY3JvbGwueCAtICh0aGlzLl9oYW5kTW9kZUN1cnNvclBvc2l0aW9uLnggLSBlLnBhZ2VYKSxcbiAgICAgICAgeTogc2Nyb2xsLnkgLSAodGhpcy5faGFuZE1vZGVDdXJzb3JQb3NpdGlvbi55IC0gZS5wYWdlWSlcbiAgICAgIH07XG5cbiAgICAgIHZhciBkaW1zID0ge1xuICAgICAgICB3aWR0aDogdGhpcy5zaXplLndpZHRoICogdGhpcy56b29tIC0gdGhpcy5sb3dlckNhbnZhc0VsLndpZHRoLFxuICAgICAgICBoZWlnaHQ6IHRoaXMuc2l6ZS5oZWlnaHQgKiB0aGlzLnpvb20gLSB0aGlzLmxvd2VyQ2FudmFzRWwuaGVpZ2h0XG4gICAgICB9O1xuICAgICAgLyogIHRvZG8gbmVlZCB0byBhZGQgc29tZSByZXN0cmljdGlvbnMgbGF0ZXJcbiAgICAgICAvL01hdGgubWF4KE1hdGgubWluKDAsbmV3U2Nyb2xsLngpLC1kaW1zLndpZHRoKTtcbiAgICAgICAvL01hdGgubWF4KE1hdGgubWluKDAsbmV3U2Nyb2xsLnkpLC1kaW1zLmhlaWdodCk7XG4gICAgICAgKi9cbiAgICAgIHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bNF0gPSBuZXdTY3JvbGwueDtcbiAgICAgIHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bNV0gPSBuZXdTY3JvbGwueTtcblxuICAgICAgdGhpcy5maXJlKCd2aWV3cG9ydDp0cmFuc2xhdGUnKTtcblxuICAgICAgdGhpcy5yZW5kZXJBbGwoKTtcbiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB0aGlzLl9vYmplY3RzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgIHRoaXMuX29iamVjdHNbaV0uc2V0Q29vcmRzKCk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuX2hhbmRNb2RlQ3Vyc29yUG9zaXRpb24ueSA9IGUucGFnZVk7XG4gICAgICB0aGlzLl9oYW5kTW9kZUN1cnNvclBvc2l0aW9uLnggPSBlLnBhZ2VYO1xuICAgIH1cbiAgfSxcbiAgX2hhbmRNb2RlTW91c2VVcDogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuX2hhbmRNb2RlQ3Vyc29yRG93biA9IGZhbHNlO1xuICAgIGlmICghdGhpcy5faGFuZE1vZGVDdXJzb3JNb3ZlKSB7XG5cbiAgICB9XG4gIH0sXG4gIF9oYW5kTW9kZU1vdXNlRG93bjogZnVuY3Rpb24gKGUpIHtcblxuICAgIHRoaXMuX2hhbmRNb2RlQ3Vyc29yTW92ZSA9IGZhbHNlO1xuICAgIHRoaXMuX2hhbmRNb2RlQ3Vyc29yRG93biA9IHRydWU7XG4gICAgdGhpcy5faGFuZE1vZGVDdXJzb3JQb3NpdGlvbiA9IHtcbiAgICAgIHk6IGUucGFnZVksXG4gICAgICB4OiBlLnBhZ2VYXG4gICAgfTtcbiAgfSxcbiAgaGFuZE1vZGVFbmFibGVkOiBmYWxzZSxcbiAgaGFuZE1vZGVLZXk6IFwiQWx0XCIsXG4gIF9hcHBseU1peGVkTW9kZTogZnVuY3Rpb24gKGUpIHtcbiAgICB0aGlzLl9jdXJyZW50X3RhcmdldCA9IHRoaXMuZmluZFRhcmdldChlKTtcblxuICAgIGlmICh0aGlzLmhhbmRNb2RlRW5hYmxlZCAmJiBlLmFsdEtleSB8fCBlLmtleSA9PT0gdGhpcy5oYW5kTW9kZUtleSkge1xuICAgICAgLy9pZiBzaGlmdCB1c2UgaGFuZCBtb2RlXG4gICAgICBpZiAoIXRoaXMuaXNIYW5kTW9kZSkge1xuICAgICAgICB0aGlzLmlzSGFuZE1vZGUgPSB0cnVlO1xuICAgICAgICB0aGlzLmlzRHJhd2luZ01vZGUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5zZXRDdXJzb3IoJ3BvaW50ZXInKTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHRoaXMuaXNNaXhlZE1vZGUgJiYgIXRoaXMuX2lzQ3VycmVudGx5RHJhd2luZyAmJiAhdGhpcy5fY3VycmVudFRyYW5zZm9ybSkge1xuXG4gICAgICB0aGlzLmlzSGFuZE1vZGUgPSBmYWxzZTtcblxuICAgICAgaWYgKHRoaXMuX2N1cnJlbnRfdGFyZ2V0KSB7XG4gICAgICAgIGlmICh0aGlzLmZyZWVEcmF3aW5nQnJ1c2ggJiYgdGhpcy5fY3VycmVudF90YXJnZXQuYWxsb3dEcmF3aW5nKSB7XG4gICAgICAgICAgdmFyIGNvcm5lciA9IHRoaXMuX2N1cnJlbnRfdGFyZ2V0Ll9maW5kVGFyZ2V0Q29ybmVyKHRoaXMuZ2V0UG9pbnRlcihlLCB0cnVlKSk7XG4gICAgICAgICAgaWYgKCFjb3JuZXIpIHtcbiAgICAgICAgICAgIHRoaXMuaXNEcmF3aW5nTW9kZSA9IHRydWU7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuaXNEcmF3aW5nTW9kZSA9IGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmlzRHJhd2luZ01vZGUpIHtcbiAgICAgICAgICB0aGlzLmlzRHJhd2luZ01vZGUgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKHRoaXMuZnJlZURyYXdpbmdCcnVzaCAmJiAhdGhpcy5pc0RyYXdpbmdNb2RlKSB7XG4gICAgICAgICAgdGhpcy5zZXRDdXJzb3IodGhpcy5mcmVlRHJhd2luZ0N1cnNvcik7XG4gICAgICAgICAgdGhpcy5pc0RyYXdpbmdNb2RlID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmlzSGFuZE1vZGUgPSBmYWxzZTtcbiAgICB9XG5cbiAgfSxcbiAgX29uTW91c2VNb3ZlOiBmdW5jdGlvbiAoZSkge1xuICAgIGlmICghdGhpcy5pbnRlcmFjdGl2ZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuX2FwcGx5TWl4ZWRNb2RlKGUpO1xuXG4gICAgaWYgKHRoaXMuaXNIYW5kTW9kZSkge1xuXG4gICAgICBpZiAodGhpcy5fY3VycmVudF90YXJnZXQgJiYgdGhpcy5fY3VycmVudF90YXJnZXQuc2VsZWN0YWJsZV9vdmVyd3JpdHRlbikge1xuICAgICAgICB0aGlzLl9jdXJyZW50X3RhcmdldC5zZWxlY3RhYmxlID0gdHJ1ZTtcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMuX2hhbmRNb2RlQWN0aXZlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9oYW5kTW9kZU1vdXNlTW92ZShlKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuZmlyZSgnbW91c2U6bW92ZScsIHt0YXJnZXQ6IHRoaXMuX2N1cnJlbnRfdGFyZ2V0LCBlOiBlfSk7XG4gICAgICB0aGlzLl9jdXJyZW50X3RhcmdldCAmJiB0aGlzLl9jdXJyZW50X3RhcmdldC5maXJlKCdtb3VzZW1vdmUnLCB7ZTogZX0pO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBfbW91c2VfbW92ZV9vdmVyd3JpdHRlbi5jYWxsKHRoaXMsIGUpO1xuICAgIH1cbiAgfSwgLyoqXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBfb25TY2FsZTogZnVuY3Rpb24gKGUsIHRyYW5zZm9ybSwgeCwgeSkge1xuXG4gICAgdmFyIHVzZVVuaVNjYWxlID0gZS5zaGlmdEtleSBeIHRoaXMuc2hpZnRJbnZlcnRlZDtcbiAgICAvLyByb3RhdGUgb2JqZWN0IG9ubHkgaWYgc2hpZnQga2V5IGlzIG5vdCBwcmVzc2VkXG4gICAgLy8gYW5kIGlmIGl0IGlzIG5vdCBhIGdyb3VwIHdlIGFyZSB0cmFuc2Zvcm1pbmdcbiAgICBpZiAoKHVzZVVuaVNjYWxlIHx8IHRoaXMudW5pU2NhbGVUcmFuc2Zvcm0pICYmICF0cmFuc2Zvcm0udGFyZ2V0LmdldCgnbG9ja1VuaVNjYWxpbmcnKSkge1xuICAgICAgdHJhbnNmb3JtLmN1cnJlbnRBY3Rpb24gPSAnc2NhbGUnO1xuICAgICAgcmV0dXJuIHRoaXMuX3NjYWxlT2JqZWN0KHgsIHkpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIC8vIFN3aXRjaCBmcm9tIGEgbm9ybWFsIHJlc2l6ZSB0byBwcm9wb3J0aW9uYWxcbiAgICAgIGlmICghdHJhbnNmb3JtLnJlc2V0ICYmIHRyYW5zZm9ybS5jdXJyZW50QWN0aW9uID09PSAnc2NhbGUnKSB7XG4gICAgICAgIHRoaXMuX3Jlc2V0Q3VycmVudFRyYW5zZm9ybShlKTtcbiAgICAgIH1cblxuICAgICAgdHJhbnNmb3JtLmN1cnJlbnRBY3Rpb24gPSAnc2NhbGVFcXVhbGx5JztcbiAgICAgIHJldHVybiB0aGlzLl9zY2FsZU9iamVjdCh4LCB5LCAnZXF1YWxseScpO1xuICAgIH1cbiAgfSxcbiAgc2hpZnRJbnZlcnRlZDogZmFsc2UsXG4gIF9zZXRDdXJzb3JGcm9tRXZlbnRfb3ZlcndyaXR0ZW46IGZhYnJpYy5DYW52YXMucHJvdG90eXBlLl9zZXRDdXJzb3JGcm9tRXZlbnQsXG4gIF9zZXRDdXJzb3JGcm9tRXZlbnQ6IGZ1bmN0aW9uIChlLCB0YXJnZXQpIHtcbiAgICBpZiAodGhpcy5pc0hhbmRNb2RlKSB7XG4gICAgICB0aGlzLnNldEN1cnNvcigncG9pbnRlcicpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9zZXRDdXJzb3JGcm9tRXZlbnRfb3ZlcndyaXR0ZW4oZSwgdGFyZ2V0KTtcbiAgICB9XG4gIH0sXG4gIF9vbk1vdXNlRG93bjogZnVuY3Rpb24gKGUpIHtcbiAgICBpZiAoIXRoaXMuaW50ZXJhY3RpdmUpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcblxuICAgIHRoaXMuX2FwcGx5TWl4ZWRNb2RlKGUpO1xuICAgIGlmICh0aGlzLmlzSGFuZE1vZGUgJiYgdGhpcy5fY3VycmVudF90YXJnZXQpIHtcbiAgICAgIHRoaXMuX2N1cnJlbnRfdGFyZ2V0LnNlbGVjdGFibGVfb3ZlcndyaXR0ZW4gPSB0aGlzLl9jdXJyZW50X3RhcmdldC5zZWxlY3RhYmxlO1xuICAgICAgdGhpcy5fY3VycmVudF90YXJnZXQuc2VsZWN0YWJsZSA9IGZhbHNlO1xuICAgIH1cblxuICAgIF9tb3VzZV9kb3duX292ZXJ3cml0dGVuLmNhbGwodGhpcywgZSk7XG5cblxuICAgIGlmICh0aGlzLmlzSGFuZE1vZGUpIHtcblxuICAgICAgaWYgKHRoaXMuX2N1cnJlbnRfdGFyZ2V0ICYmIHRoaXMuX2N1cnJlbnRfdGFyZ2V0LnNlbGVjdGFibGVfb3ZlcndyaXR0ZW4pIHtcbiAgICAgICAgdGhpcy5fY3VycmVudF90YXJnZXQuc2VsZWN0YWJsZSA9IHRydWU7XG4gICAgICB9XG4gICAgICB0aGlzLl9oYW5kTW9kZUFjdGl2ZSA9IHRydWU7XG4gICAgICB0aGlzLl9oYW5kTW9kZU1vdXNlRG93bihlKTtcbiAgICB9XG4gIH0sXG5cbiAgX29uTW91c2VVcDogZnVuY3Rpb24gKGUpIHtcbiAgICBpZiAoIXRoaXMuaW50ZXJhY3RpdmUpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgX21vdXNlX3VwX292ZXJ3cml0dGVuLmNhbGwodGhpcywgZSk7XG5cbiAgICBpZiAodGhpcy5pc0hhbmRNb2RlKSB7XG4gICAgICB0aGlzLl9oYW5kTW9kZUFjdGl2ZSA9IGZhbHNlO1xuICAgIH1cbiAgfVxufSk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL21vZHVsZXMvaW50ZXJhY3RpdmVNb2RlLmpzIiwiJ3VzZSBzdHJpY3QnO1xuXG5cbi8qKlxuICAgKiBEcmF3IENTUzMgYm9yZGVyIGltYWdlIG9uIGNhbnZhcy5cbiAgICogQHBhcmFtIGNhbnZhcyAgICB7SFRNTENhbnZhc0VsZW1lbnR9XG4gICAqIEBwYXJhbSBpbWcgICAgICAge0hUTUxJbWFnZUVsZW1lbnR9IGJvcmRlci1pbWFnZS1zb3VyY2UgaW1hZ2VcbiAgICogQHBhcmFtIG9wdGlvbnMgICB7T2JqZWN0fVxuICAgKiAgICAgIHNsaWNlIHtBcnJheX0gYm9yZGVyLWltYWdlLXNsaWNlIHZhbHVlc1xuICAgKiAgICAgIHdpZHRoIHtBcnJheX0gYm9yZGVyLWltYWdlLXdpZHRoIHZhbHVlc1xuICAgKiAgICAgIG91dHNldCB7QXJyYXl9IGJvcmRlci1pbWFnZS1vdXRzZXQgdmFsdWVzXG4gICAqICAgICAgcmVwZWF0IHtBcnJheX0gYm9yZGVyLWltYWdlLXJlcGVhdCB2YWx1ZXNcbiAgICogQHBhcmFtIHNpemUgICAgICB7T2JqZWN0fVxuICAgKi9cbiAgIGZhYnJpYy51dGlsLmRyYXdCb3JkZXJJbWFnZSAgPSBmdW5jdGlvbihjYW52YXMsIGltZywgb3B0aW9ucyl7XG5cblxuICAgIHZhciBvcHRpb25zID0gZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCh7XG4gICAgICBcInNsaWNlXCI6ICAgICAgICBbMjUsMjUsMjUsMjVdLFxuICAgICAgXCJ3aWR0aFwiOiAgICAgICAgWzI1LDI1LDI1LDI1XSxcbiAgICAgIFwiZmlsbFwiOiAgICAgICAgIGZhbHNlLFxuICAgICAgXCJyZXBlYXRcIjogICAgICAgW1wicm91bmRcIixcInJvdW5kXCJdLFxuICAgICAgXCJvdXRzZXRfdmFsdWVzXCJcdDogWzAsIDAsIDAsIDBdLFxuICAgICAgXCJzbGljZV91bml0c1wiICAgOiBbMCwgMCwgMCwgMF0sXG4gICAgICBcIndpZHRoX3VuaXRzXCJcdDogWzAsIDAsIDAsIDBdLFxuICAgICAgXCJvdXRzZXRfdW5pdHNcIlx0OiBbMCwgMCwgMCwgMF0sXG4gICAgICBcInNpemVcIlx0XHRcdDogW2NhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodF1cbiAgICB9LG9wdGlvbnMpXG5cblxuICAgIHZhciB3ID0gaW1nLndpZHRoO1xuICAgIHZhciBoID0gaW1nLmhlaWdodDtcblxuICAgIHZhciBjdHggPSBjYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpO1xuICAgIHZhciBzbGljZSA9IG9wdGlvbnMuc2xpY2U7XG4gICAgdmFyIHdpZHRoID0gb3B0aW9ucy53aWR0aDtcblxuICAgIHZhciB3MiA9IG9wdGlvbnMuc2l6ZVswXTtcbiAgICB2YXIgaDIgPSBvcHRpb25zLnNpemVbMV07XG5cblxuICAgIGlmKG9wdGlvbnMuc2xpY2VfdW5pdHNbMF0gPT0gMSlzbGljZVswXSAqPSAgaCAvIDEwMDtcbiAgICBpZihvcHRpb25zLnNsaWNlX3VuaXRzWzFdID09IDEpc2xpY2VbMV0gKj0gIHcgLyAxMDA7XG4gICAgaWYob3B0aW9ucy5zbGljZV91bml0c1syXSA9PSAxKXNsaWNlWzJdICo9ICBoIC8gMTAwO1xuICAgIGlmKG9wdGlvbnMuc2xpY2VfdW5pdHNbM10gPT0gMSlzbGljZVszXSAqPSAgdyAvIDEwMDtcblxuICAgIGlmKG9wdGlvbnMud2lkdGhfdW5pdHNbMF0gPT0gMSl3aWR0aFswXSAqPSBoMiAvIDEwMDtcbiAgICBpZihvcHRpb25zLndpZHRoX3VuaXRzWzFdID09IDEpd2lkdGhbMV0gKj0gdzIgLyAxMDA7XG4gICAgaWYob3B0aW9ucy53aWR0aF91bml0c1syXSA9PSAxKXdpZHRoWzJdICo9IGgyIC8gMTAwO1xuICAgIGlmKG9wdGlvbnMud2lkdGhfdW5pdHNbM10gPT0gMSl3aWR0aFszXSAqPSB3MiAvIDEwMDtcblxuXG4gICAgZnVuY3Rpb24gZHJhd1NpZGUoc2lkZSxzbGljZU9mZnNldCxzbGljZVdpZHRoLCBkcmF3T2Zmc2V0LGRyYXdXaWR0aCl7XG4gICAgICB2YXIgZDtcbiAgICAgIGlmKHNpZGUgPT0gMCkge1xuICAgICAgICBkID0gW3NsaWNlWzNdICsgc2xpY2VPZmZzZXQsIDAsIHNsaWNlV2lkdGgsICBzbGljZVswXSxcbiAgICAgICAgICB3aWR0aFszXSArIGRyYXdPZmZzZXQsIDAsIGRyYXdXaWR0aCwgIHdpZHRoWzBdXVxuICAgICAgfVxuICAgICAgaWYoc2lkZSA9PSAyKXtcbiAgICAgICAgZCA9IFtzbGljZVszXSArIHNsaWNlT2Zmc2V0LCBoIC0gc2xpY2VbMl0gLHNsaWNlV2lkdGgsICBzbGljZVsyXSxcbiAgICAgICAgICB3aWR0aFszXSArIGRyYXdPZmZzZXQsIGgyIC0gd2lkdGhbMl0sZHJhd1dpZHRoLCB3aWR0aFsyXV1cbiAgICAgIH1cbiAgICAgIGlmKHNpZGUgPT0gMSkge1xuICAgICAgICBkID0gWyB3IC0gc2xpY2VbMV0sIHNsaWNlWzBdICsgc2xpY2VPZmZzZXQsICBzbGljZVsxXSwgc2xpY2VXaWR0aCxcbiAgICAgICAgICB3MiAtIHdpZHRoWzFdLCB3aWR0aFswXSArIGRyYXdPZmZzZXQsd2lkdGhbMV0sIGRyYXdXaWR0aF07XG4gICAgICB9XG4gICAgICBpZihzaWRlID09IDMpIHtcbiAgICAgICAgZCA9IFsgMCwgc2xpY2VbMF0gKyBzbGljZU9mZnNldCwgIHNsaWNlWzNdLCBzbGljZVdpZHRoLFxuICAgICAgICAgIDAsIHdpZHRoWzBdICsgZHJhd09mZnNldCwgd2lkdGhbM10sZHJhd1dpZHRoXTtcbiAgICAgIH1cbiAgICAgIGN0eC5kcmF3SW1hZ2UoaW1nLGRbMF0sZFsxXSxkWzJdLGRbM10sZFs0XSxkWzVdLGRbNl0sZFs3XSlcbiAgICB9XG5cblxuICAgIGZ1bmN0aW9uIF9kcmF3X2JvcmRlcl9zaWRlKHNpZGUpe1xuICAgICAgdmFyIF90b3Bfd2lkdGgsIF90b3Bfc2xpY2UsIHJlcGVhdDtcbiAgICAgIGlmKHNpZGUgPT0gMCB8fCBzaWRlID09IDIpe1xuICAgICAgICBfdG9wX3dpZHRoID0gdzIgLSB3aWR0aFsxXS0gd2lkdGhbM107XG4gICAgICAgIF90b3Bfc2xpY2UgID0gIHcgLSBzbGljZVsxXSAtIHNsaWNlWzNdO1xuICAgICAgICByZXBlYXQgPSBvcHRpb25zLnJlcGVhdFswXTtcbiAgICAgIH1lbHNle1xuICAgICAgICBfdG9wX3dpZHRoID0gaDIgLSB3aWR0aFswXS0gd2lkdGhbMl07XG4gICAgICAgIF90b3Bfc2xpY2UgID0gIGggLSBzbGljZVswXSAtIHNsaWNlWzJdO1xuICAgICAgICByZXBlYXQgPSBvcHRpb25zLnJlcGVhdFsxXTtcbiAgICAgIH1cblxuXG4gICAgICBpZihyZXBlYXQgPT0gXCJzdHJldGNoXCIpe1xuICAgICAgICByZXR1cm4gZHJhd1NpZGUoc2lkZSwgMCwgIF90b3Bfc2xpY2UgLCAgMCwgICAgIF90b3Bfd2lkdGgpO1xuICAgICAgfVxuXG4gICAgICB2YXIgX2FzcGVjdCA9ICAgc2xpY2Vbc2lkZV0gLyB3aWR0aFtzaWRlXTtcbiAgICAgIHZhciBfb25lX3dpZHRoID0gIF90b3Bfc2xpY2UgKiAgd2lkdGhbc2lkZV0gLyBzbGljZVtzaWRlXSA7XG4gICAgICB2YXIgY291bnQgPSAxO1xuICAgICAgdmFyIF9sZWZ0ID0gMDtcblxuICAgICAgaWYocmVwZWF0ID09IFwicmVwZWF0XCIpe1xuXG4gICAgICAgIHZhciBfcmVzdCA9IF9vbmVfd2lkdGggLSBfdG9wX3dpZHRoICUgX29uZV93aWR0aCAvIDI7XG4gICAgICAgIHZhciBfcmVzdF9hc3BlY3QgID0gX2FzcGVjdCAqIF9yZXN0O1xuICAgICAgICBjb3VudCA9ICBNYXRoLmZsb29yKF90b3Bfd2lkdGggLyBfb25lX3dpZHRoKTtcblxuXG4gICAgICAgIGlmKF9yZXN0ID4gMCl7XG4gICAgICAgICAgZHJhd1NpZGUoc2lkZSwgX3Jlc3RfYXNwZWN0ICwgIF90b3Bfc2xpY2UgLSBfcmVzdF9hc3BlY3QsICAwLCAgICAgX29uZV93aWR0aCAtIF9yZXN0KVxuICAgICAgICB9XG5cbiAgICAgICAgX2xlZnQgPSAgX29uZV93aWR0aCAtIF9yZXN0O1xuXG4gICAgICAgIGZvcih2YXIgaSA9IDAgOyBpPCBjb3VudDtpICsrKXtcbiAgICAgICAgICBkcmF3U2lkZSggc2lkZSwwLCAgIF90b3Bfc2xpY2UgLCAgX2xlZnQsICAgICBfb25lX3dpZHRoKTtcbiAgICAgICAgICBfbGVmdCArPV9vbmVfd2lkdGg7XG4gICAgICAgIH1cblxuICAgICAgICBpZihfcmVzdCA+IDApe1xuICAgICAgICAgIGRyYXdTaWRlKHNpZGUsICAwICwgICAgX3RvcF9zbGljZSAtIF9yZXN0X2FzcGVjdCwgIF9sZWZ0LCAgICBfb25lX3dpZHRoIC0gX3Jlc3QgKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYocmVwZWF0ID09IFwicm91bmRcIil7XG5cbiAgICAgICAgX2xlZnQgPSAwO1xuICAgICAgICBjb3VudCA9ICBNYXRoLm1heCgxLE1hdGgucm91bmQoX3RvcF93aWR0aCAvIF9vbmVfd2lkdGgpKTtcbiAgICAgICAgX29uZV93aWR0aCA9IF90b3Bfd2lkdGggLyBjb3VudDtcblxuICAgICAgICB3aGlsZShfbGVmdCA8IF90b3Bfd2lkdGgpe1xuICAgICAgICAgIGRyYXdTaWRlKHNpZGUsMCwgICAgIF90b3Bfc2xpY2UgLCAgX2xlZnQsICAgICBfb25lX3dpZHRoICk7XG4gICAgICAgICAgX2xlZnQgKz1fb25lX3dpZHRoO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgX2RyYXdfYm9yZGVyX3NpZGUoMCk7XG4gICAgX2RyYXdfYm9yZGVyX3NpZGUoMik7XG4gICAgX2RyYXdfYm9yZGVyX3NpZGUoMSk7XG4gICAgX2RyYXdfYm9yZGVyX3NpZGUoMyk7XG5cbiAgLy90b3AgbGVmdFxuICAgIGN0eC5kcmF3SW1hZ2UoaW1nLCAwLCAwLCBzbGljZVszXSwgc2xpY2VbMF0sIDAsIDAsIHdpZHRoWzNdLCB3aWR0aFswXSk7XG4gIC8vdG9wIHJpZ2h0XG4gICAgY3R4LmRyYXdJbWFnZShpbWcsIHcgLSBzbGljZVsxXSwgMCwgc2xpY2VbMV0sIHNsaWNlWzBdLFxuICAgICAgdzIgLSB3aWR0aFsxXSwgMCwgd2lkdGhbMV0sIHdpZHRoWzBdKTtcbiAgLy9ib3R0b20gbGVmdFxuICAgIGN0eC5kcmF3SW1hZ2UoaW1nLCAwLCBoIC0gc2xpY2VbMl0sIHNsaWNlWzNdLCBzbGljZVsyXSxcbiAgICAgIDAsIGgyIC0gd2lkdGhbMl0sIHdpZHRoWzNdLCB3aWR0aFsyXSk7XG5cbiAgLy9ib3R0b20gcmlnaHRcbiAgICBjdHguZHJhd0ltYWdlKGltZywgdyAtIHNsaWNlWzFdLCBoIC0gc2xpY2VbMl0sIHNsaWNlWzFdLCBzbGljZVsyXSxcbiAgICAgIHcyIC0gd2lkdGhbMV0sIGgyIC0gd2lkdGhbMl0sIHdpZHRoWzFdLCB3aWR0aFsyXSk7XG5cbiAgfVxuXG4gIC8qXG4gICB2YXIgRnJhbWUgPSBmdW5jdGlvbihwcm9qZWN0LGRhdGEpe1xuXG4gICBpZihkYXRhLmJvcmRlcl9pbWFnZSl7XG4gICBkYXRhLmJvcmRlcl9pbWFnZSA9IG1peGluKCB7XG4gICBcInNsaWNlXCI6ICAgICAgICAgIFsyNSwyNSwyNSwyNV0sXG4gICBcIndpZHRoXCI6ICAgICAgICAgIFsyNSwyNSwyNSwyNV0sXG4gICBcImZpbGxcIjogICAgICAgICAgIGZhbHNlLFxuICAgXCJyZXBlYXRcIjogICAgICAgICBbXCJyb3VuZFwiLFwicm91bmRcIl0sXG4gICBcIm91dHNldFwiXHQ6ICAgICBbMCwgMCwgMCwgMF0sXG4gICBcInNsaWNlX3VuaXRzXCIgICA6IFswLCAwLCAwLCAwXSxcbiAgIFwid2lkdGhfdW5pdHNcIlx0OiBbMCwgMCwgMCwgMF0sXG4gICBcIm91dHNldF91bml0c1wiXHQ6IFswLCAwLCAwLCAwXVxuICAgfSwgZGF0YS5ib3JkZXJfaW1hZ2UpXG4gICB9XG5cblxuICAgdGhpcy5zdXBlcmNsYXNzLmNvbnN0cnVjdG9yLmNhbGwodGhpcyxwcm9qZWN0LGRhdGEpO1xuICAgdGhpcy5fYWRkX3Jvb3QoXCJtYXNrXCIpO1xuICAgdGhpcy5fYWRkX3Jvb3QoXCJpbWFnZVwiKTtcbiAgIHRoaXMuZXhhbXBsZSA9IHRoaXMuX2dldF9leGFtcGxlKCk7XG5cbiAgIH07Ki9cbiAgZmFicmljLnV0aWwuZ2V0T2Zmc2V0c0NsaXBQYXRoID0gZnVuY3Rpb24obykge1xuXG4gICAgcmV0dXJuIFsnTScsIG9bM10sIG9bMF0sICdMJywgMTAwIC0gb1sxXSwgb1swXSwgJ0wnLCAxMDAgLSBvWzFdLCAxMDAgLSBvWzJdLCAnTCcsIG9bM10sIDEwMCAtIG9bMl0sICd6J10uam9pbihcIiBcIik7XG4gIH07XG5cbiAgZmFicmljLnV0aWwuZ2V0UmFkaXVzQ2xpcFBhdGggPSBmdW5jdGlvbihyYWRpdXMscmFkaXVzX3VuaXRzLCB3aWR0aCxoZWlnaHQpIHtcblxuICB2YXIgYnIgID0gcmFkaXVzO1xuICB2YXIgYnJ1ID0gcmFkaXVzX3VuaXRzIHx8IFsxLDEsMSwxLDEsMSwxLDFdO1xuXG5cblxuICB2YXIgcyA9IHtcbiAgICBcInRvcC1sZWZ0LWhcIjogICAgIGJyWzBdICogKGJydVswXSA/IGhlaWdodCAvIDEwMCA6IDEpLFxuICAgIFwidG9wLWxlZnQtd1wiOiAgICAgYnJbMV0gKiAoYnJ1WzFdID8gd2lkdGggLyAxMDAgOiAxKSxcbiAgICBcInRvcC1yaWdodC1oXCI6ICAgIGJyWzJdICogKGJydVsyXSA/IGhlaWdodCAvIDEwMCA6IDEpLFxuICAgIFwidG9wLXJpZ2h0LXdcIjogICAgYnJbM10gKiAoYnJ1WzNdID8gd2lkdGggLyAxMDAgOiAxKSxcbiAgICBcImJvdHRvbS1yaWdodC13XCI6IGJyWzRdICogKGJydVs0XSA/IHdpZHRoIC8gMTAwIDogMSksXG4gICAgXCJib3R0b20tcmlnaHQtaFwiOiBicls1XSAqIChicnVbNV0gPyBoZWlnaHQgLyAxMDAgOiAxKSxcbiAgICBcImJvdHRvbS1sZWZ0LXdcIjogIGJyWzZdICogKGJydVs2XSA/IHdpZHRoIC8gMTAwIDogMSksXG4gICAgXCJib3R0b20tbGVmdC1oXCI6ICBicls3XSAqIChicnVbN10gPyBoZWlnaHQgLyAxMDAgOiAxKVxuICB9O1xuXG4gIHJldHVybiBbXG4gICAgXCJNXCIsIDAsIHNbXCJ0b3AtbGVmdC1oXCJdLFxuICAgIFwiQ1wiLCAwLCBzW1widG9wLWxlZnQtaFwiXSwgMCwgMCwgc1tcInRvcC1sZWZ0LXdcIl0sIDAsXG4gICAgXCJIXCIsIHdpZHRoIC0gc1tcInRvcC1yaWdodC13XCJdLFxuICAgIFwiQ1wiLCB3aWR0aCAtIHNbXCJ0b3AtcmlnaHQtd1wiXSwgMCwgd2lkdGgsIDAsIHdpZHRoLCBzW1widG9wLXJpZ2h0LWhcIl0sXG4gICAgXCJWXCIsIGhlaWdodCAtIHNbXCJib3R0b20tcmlnaHQtaFwiXSxcbiAgICBcIkNcIiwgd2lkdGgsIGhlaWdodCAtIHNbXCJib3R0b20tcmlnaHQtaFwiXSwgd2lkdGgsIGhlaWdodCwgd2lkdGggLSBzW1wiYm90dG9tLXJpZ2h0LXdcIl0sIGhlaWdodCxcbiAgICBcIkhcIiwgc1tcImJvdHRvbS1sZWZ0LXdcIl0sXG4gICAgXCJDXCIsIHNbXCJib3R0b20tbGVmdC13XCJdLCBoZWlnaHQsIDAsIGhlaWdodCwgMCwgaGVpZ2h0IC0gc1tcImJvdHRvbS1sZWZ0LWhcIl0sXG4gICAgXCJaXCJcbiAgXS5qb2luKFwiIFwiKTtcbn07XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL21vZHVsZXMvYm9yZGVySW1hZ2UuanMiLCJcbmlmKHR5cGVvZiBzYXZlQXMgPT0gXCJ1bmRlZmluZWRcIil7XG4gIGZhYnJpYy5zYXZlQXMgID0gcmVxdWlyZShcIi4vLi4vLi4vcGx1Z2lucy9zYXZlQXMuanNcIikuc2F2ZUFzO1xufWVsc2V7XG4gIGZhYnJpYy5zYXZlQXMgPSBzYXZlQXM7XG59XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLlNsaWRlQ2FudmFzLnByb3RvdHlwZSwge1xuICBpbnNlcnRSZW5kZXJBcmVhOiBmYWxzZSxcbiAgaW5zZXJ0UmVuZGVyRnVsbDogZmFsc2UsXG59KTtcblxuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUuYWN0aW9ucywge1xuICByZW5kZXJBcmVhOiB7XG4gICAgY2xhc3NOYW1lOiAnZmEgZmEtZG93bmxvYWQnLFxuICAgIHRpdGxlOiAnZG93bmxvYWQnLFxuICAgIGFjdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgZmFicmljLnNhdmVBcyh0aGlzLmdldEltYWdlRGF0YSh7XG4gICAgICAgIGNsaXBwZWRfYXJlYTogdGhpcy5hY3RpdmVBcmVhLFxuICAgICAgICB6b29tOiB0aGlzLmRvdHNQZXJVbml0LFxuICAgICAgICBjbGlwcGVkX2FyZWFfb25seTogdHJ1ZSxcbiAgICAgICAgZHJhd19iYWNrZ3JvdW5kOiB0cnVlXG4gICAgICB9KS5ibG9iLCB0aGlzLnRpdGxlKTtcbiAgICB9XG4gIH0sXG4gIHJlbmRlckZ1bGw6IHtcbiAgICB0aXRsZTogJ2Rvd25sb2FkIHdpdGggYmFja2dyb3VuZCcsXG4gICAgYWN0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICBmYWJyaWMuc2F2ZUFzKHRoaXMuZ2V0SW1hZ2VEYXRhKHtcbiAgICAgICAgem9vbTogdGhpcy5kb3RzUGVyVW5pdCxcbiAgICAgICAgY2xpcHBlZF9hcmVhX29ubHk6IGZhbHNlLFxuICAgICAgICBkcmF3X2JhY2tncm91bmQ6IHRydWVcbiAgICAgIH0pLmJsb2IsIHRoaXMudGl0bGUpO1xuICAgIH1cbiAgfVxufSk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL21vZHVsZXMvc2F2ZUFzLmpzIiwiLyogRmlsZVNhdmVyLmpzXG4gKiBBIHNhdmVBcygpIEZpbGVTYXZlciBpbXBsZW1lbnRhdGlvbi5cbiAqIDEuMS4yMDE1MDcxNlxuICpcbiAqIEJ5IEVsaSBHcmV5LCBodHRwOi8vZWxpZ3JleS5jb21cbiAqIExpY2Vuc2U6IFgxMS9NSVRcbiAqICAgU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9lbGlncmV5L0ZpbGVTYXZlci5qcy9ibG9iL21hc3Rlci9MSUNFTlNFLm1kXG4gKi9cblxuLypnbG9iYWwgc2VsZiAqL1xuLypqc2xpbnQgYml0d2lzZTogdHJ1ZSwgaW5kZW50OiA0LCBsYXhicmVhazogdHJ1ZSwgbGF4Y29tbWE6IHRydWUsIHNtYXJ0dGFiczogdHJ1ZSwgcGx1c3BsdXM6IHRydWUgKi9cblxuLyohIEBzb3VyY2UgaHR0cDovL3B1cmwuZWxpZ3JleS5jb20vZ2l0aHViL0ZpbGVTYXZlci5qcy9ibG9iL21hc3Rlci9GaWxlU2F2ZXIuanMgKi9cblxuXG5cbnZhciBpc0xpa2VseU5vZGUgPSB0eXBlb2YgQnVmZmVyICE9PSAndW5kZWZpbmVkJyAmJiB0eXBlb2Ygd2luZG93ID09PSAndW5kZWZpbmVkJztcblxuXG5cbnZhciBzYXZlQXMgPSAhaXNMaWtlbHlOb2RlICYmICAoZnVuY3Rpb24odmlldykge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgLy8gSUUgPDEwIGlzIGV4cGxpY2l0bHkgdW5zdXBwb3J0ZWRcbiAgICAgICAgaWYgKHR5cGVvZiBuYXZpZ2F0b3IgIT09IFwidW5kZWZpbmVkXCIgJiYgL01TSUUgWzEtOV1cXC4vLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB2YXJcbiAgICAgICAgICAgIGRvYyA9IHZpZXcuZG9jdW1lbnRcbiAgICAgICAgLy8gb25seSBnZXQgVVJMIHdoZW4gbmVjZXNzYXJ5IGluIGNhc2UgQmxvYi5qcyBoYXNuJ3Qgb3ZlcnJpZGRlbiBpdCB5ZXRcbiAgICAgICAgICAgICwgZ2V0X1VSTCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB2aWV3LlVSTCB8fCB2aWV3LndlYmtpdFVSTCB8fCB2aWV3O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLCBzYXZlX2xpbmsgPSBkb2MuY3JlYXRlRWxlbWVudE5TKFwiaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbFwiLCBcImFcIilcbiAgICAgICAgICAgICwgY2FuX3VzZV9zYXZlX2xpbmsgPSBcImRvd25sb2FkXCIgaW4gc2F2ZV9saW5rXG4gICAgICAgICAgICAsIGNsaWNrID0gZnVuY3Rpb24obm9kZSkge1xuICAgICAgICAgICAgICAgIHZhciBldmVudCA9IG5ldyBNb3VzZUV2ZW50KFwiY2xpY2tcIik7XG4gICAgICAgICAgICAgICAgbm9kZS5kaXNwYXRjaEV2ZW50KGV2ZW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICwgd2Via2l0X3JlcV9mcyA9IHZpZXcud2Via2l0UmVxdWVzdEZpbGVTeXN0ZW1cbiAgICAgICAgICAgICwgcmVxX2ZzID0gdmlldy5yZXF1ZXN0RmlsZVN5c3RlbSB8fCB3ZWJraXRfcmVxX2ZzIHx8IHZpZXcubW96UmVxdWVzdEZpbGVTeXN0ZW1cbiAgICAgICAgICAgICwgdGhyb3dfb3V0c2lkZSA9IGZ1bmN0aW9uKGV4KSB7XG4gICAgICAgICAgICAgICAgKHZpZXcuc2V0SW1tZWRpYXRlIHx8IHZpZXcuc2V0VGltZW91dCkoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IGV4O1xuICAgICAgICAgICAgICAgIH0sIDApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLCBmb3JjZV9zYXZlYWJsZV90eXBlID0gXCJhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW1cIlxuICAgICAgICAgICAgLCBmc19taW5fc2l6ZSA9IDBcbiAgICAgICAgLy8gU2VlIGh0dHBzOi8vY29kZS5nb29nbGUuY29tL3AvY2hyb21pdW0vaXNzdWVzL2RldGFpbD9pZD0zNzUyOTcjYzcgYW5kXG4gICAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9lbGlncmV5L0ZpbGVTYXZlci5qcy9jb21taXQvNDg1OTMwYSNjb21taXRjb21tZW50LTg3NjgwNDdcbiAgICAgICAgLy8gZm9yIHRoZSByZWFzb25pbmcgYmVoaW5kIHRoZSB0aW1lb3V0IGFuZCByZXZvY2F0aW9uIGZsb3dcbiAgICAgICAgICAgICwgYXJiaXRyYXJ5X3Jldm9rZV90aW1lb3V0ID0gNTAwIC8vIGluIG1zXG4gICAgICAgICAgICAsIHJldm9rZSA9IGZ1bmN0aW9uKGZpbGUpIHtcbiAgICAgICAgICAgICAgICB2YXIgcmV2b2tlciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGZpbGUgPT09IFwic3RyaW5nXCIpIHsgLy8gZmlsZSBpcyBhbiBvYmplY3QgVVJMXG4gICAgICAgICAgICAgICAgICAgICAgICBnZXRfVVJMKCkucmV2b2tlT2JqZWN0VVJMKGZpbGUpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgeyAvLyBmaWxlIGlzIGEgRmlsZVxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsZS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgaWYgKHZpZXcuY2hyb21lKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldm9rZXIoKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KHJldm9rZXIsIGFyYml0cmFyeV9yZXZva2VfdGltZW91dCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLCBkaXNwYXRjaCA9IGZ1bmN0aW9uKGZpbGVzYXZlciwgZXZlbnRfdHlwZXMsIGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgZXZlbnRfdHlwZXMgPSBbXS5jb25jYXQoZXZlbnRfdHlwZXMpO1xuICAgICAgICAgICAgICAgIHZhciBpID0gZXZlbnRfdHlwZXMubGVuZ3RoO1xuICAgICAgICAgICAgICAgIHdoaWxlIChpLS0pIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGxpc3RlbmVyID0gZmlsZXNhdmVyW1wib25cIiArIGV2ZW50X3R5cGVzW2ldXTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBsaXN0ZW5lciA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpc3RlbmVyLmNhbGwoZmlsZXNhdmVyLCBldmVudCB8fCBmaWxlc2F2ZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvd19vdXRzaWRlKGV4KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICwgYXV0b19ib20gPSBmdW5jdGlvbihibG9iKSB7XG4gICAgICAgICAgICAgICAgLy8gcHJlcGVuZCBCT00gZm9yIFVURi04IFhNTCBhbmQgdGV4dC8qIHR5cGVzIChpbmNsdWRpbmcgSFRNTClcbiAgICAgICAgICAgICAgICBpZiAoL15cXHMqKD86dGV4dFxcL1xcUyp8YXBwbGljYXRpb25cXC94bWx8XFxTKlxcL1xcUypcXCt4bWwpXFxzKjsuKmNoYXJzZXRcXHMqPVxccyp1dGYtOC9pLnRlc3QoYmxvYi50eXBlKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEJsb2IoW1wiXFx1ZmVmZlwiLCBibG9iXSwge3R5cGU6IGJsb2IudHlwZX0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gYmxvYjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICwgRmlsZVNhdmVyID0gZnVuY3Rpb24oYmxvYiwgbmFtZSwgbm9fYXV0b19ib20pIHtcbiAgICAgICAgICAgICAgICBpZiAoIW5vX2F1dG9fYm9tKSB7XG4gICAgICAgICAgICAgICAgICAgIGJsb2IgPSBhdXRvX2JvbShibG9iKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gRmlyc3QgdHJ5IGEuZG93bmxvYWQsIHRoZW4gd2ViIGZpbGVzeXN0ZW0sIHRoZW4gb2JqZWN0IFVSTHNcbiAgICAgICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgICAgICAgZmlsZXNhdmVyID0gdGhpc1xuICAgICAgICAgICAgICAgICAgICAsIHR5cGUgPSBibG9iLnR5cGVcbiAgICAgICAgICAgICAgICAgICAgLCBibG9iX2NoYW5nZWQgPSBmYWxzZVxuICAgICAgICAgICAgICAgICAgICAsIG9iamVjdF91cmxcbiAgICAgICAgICAgICAgICAgICAgLCB0YXJnZXRfdmlld1xuICAgICAgICAgICAgICAgICAgICAsIGRpc3BhdGNoX2FsbCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGF0Y2goZmlsZXNhdmVyLCBcIndyaXRlc3RhcnQgcHJvZ3Jlc3Mgd3JpdGUgd3JpdGVlbmRcIi5zcGxpdChcIiBcIikpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gb24gYW55IGZpbGVzeXMgZXJyb3JzIHJldmVydCB0byBzYXZpbmcgd2l0aCBvYmplY3QgVVJMc1xuICAgICAgICAgICAgICAgICAgICAsIGZzX2Vycm9yID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBkb24ndCBjcmVhdGUgbW9yZSBvYmplY3QgVVJMcyB0aGFuIG5lZWRlZFxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJsb2JfY2hhbmdlZCB8fCAhb2JqZWN0X3VybCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdF91cmwgPSBnZXRfVVJMKCkuY3JlYXRlT2JqZWN0VVJMKGJsb2IpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRhcmdldF92aWV3KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0X3ZpZXcubG9jYXRpb24uaHJlZiA9IG9iamVjdF91cmw7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuZXdfdGFiID0gdmlldy5vcGVuKG9iamVjdF91cmwsIFwiX2JsYW5rXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuZXdfdGFiID09IHVuZGVmaW5lZCAmJiB0eXBlb2Ygc2FmYXJpICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vQXBwbGUgZG8gbm90IGFsbG93IHdpbmRvdy5vcGVuLCBzZWUgaHR0cDovL2JpdC5seS8xa1pmZlJJXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpZXcubG9jYXRpb24uaHJlZiA9IG9iamVjdF91cmxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWxlc2F2ZXIucmVhZHlTdGF0ZSA9IGZpbGVzYXZlci5ET05FO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGF0Y2hfYWxsKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXZva2Uob2JqZWN0X3VybCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLCBhYm9ydGFibGUgPSBmdW5jdGlvbihmdW5jKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGVzYXZlci5yZWFkeVN0YXRlICE9PSBmaWxlc2F2ZXIuRE9ORSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZnVuYy5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLCBjcmVhdGVfaWZfbm90X2ZvdW5kID0ge2NyZWF0ZTogdHJ1ZSwgZXhjbHVzaXZlOiBmYWxzZX1cbiAgICAgICAgICAgICAgICAgICAgLCBzbGljZVxuICAgICAgICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgICAgZmlsZXNhdmVyLnJlYWR5U3RhdGUgPSBmaWxlc2F2ZXIuSU5JVDtcbiAgICAgICAgICAgICAgICBpZiAoIW5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZSA9IFwiZG93bmxvYWRcIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGNhbl91c2Vfc2F2ZV9saW5rKSB7XG4gICAgICAgICAgICAgICAgICAgIG9iamVjdF91cmwgPSBnZXRfVVJMKCkuY3JlYXRlT2JqZWN0VVJMKGJsb2IpO1xuICAgICAgICAgICAgICAgICAgICBzYXZlX2xpbmsuaHJlZiA9IG9iamVjdF91cmw7XG4gICAgICAgICAgICAgICAgICAgIHNhdmVfbGluay5kb3dubG9hZCA9IG5hbWU7XG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjbGljayhzYXZlX2xpbmspO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGF0Y2hfYWxsKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXZva2Uob2JqZWN0X3VybCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWxlc2F2ZXIucmVhZHlTdGF0ZSA9IGZpbGVzYXZlci5ET05FO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBPYmplY3QgYW5kIHdlYiBmaWxlc3lzdGVtIFVSTHMgaGF2ZSBhIHByb2JsZW0gc2F2aW5nIGluIEdvb2dsZSBDaHJvbWUgd2hlblxuICAgICAgICAgICAgICAgIC8vIHZpZXdlZCBpbiBhIHRhYiwgc28gSSBmb3JjZSBzYXZlIHdpdGggYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtXG4gICAgICAgICAgICAgICAgLy8gaHR0cDovL2NvZGUuZ29vZ2xlLmNvbS9wL2Nocm9taXVtL2lzc3Vlcy9kZXRhaWw/aWQ9OTExNThcbiAgICAgICAgICAgICAgICAvLyBVcGRhdGU6IEdvb2dsZSBlcnJhbnRseSBjbG9zZWQgOTExNTgsIEkgc3VibWl0dGVkIGl0IGFnYWluOlxuICAgICAgICAgICAgICAgIC8vIGh0dHBzOi8vY29kZS5nb29nbGUuY29tL3AvY2hyb21pdW0vaXNzdWVzL2RldGFpbD9pZD0zODk2NDJcbiAgICAgICAgICAgICAgICBpZiAodmlldy5jaHJvbWUgJiYgdHlwZSAmJiB0eXBlICE9PSBmb3JjZV9zYXZlYWJsZV90eXBlKSB7XG4gICAgICAgICAgICAgICAgICAgIHNsaWNlID0gYmxvYi5zbGljZSB8fCBibG9iLndlYmtpdFNsaWNlO1xuICAgICAgICAgICAgICAgICAgICBibG9iID0gc2xpY2UuY2FsbChibG9iLCAwLCBibG9iLnNpemUsIGZvcmNlX3NhdmVhYmxlX3R5cGUpO1xuICAgICAgICAgICAgICAgICAgICBibG9iX2NoYW5nZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBTaW5jZSBJIGNhbid0IGJlIHN1cmUgdGhhdCB0aGUgZ3Vlc3NlZCBtZWRpYSB0eXBlIHdpbGwgdHJpZ2dlciBhIGRvd25sb2FkXG4gICAgICAgICAgICAgICAgLy8gaW4gV2ViS2l0LCBJIGFwcGVuZCAuZG93bmxvYWQgdG8gdGhlIGZpbGVuYW1lLlxuICAgICAgICAgICAgICAgIC8vIGh0dHBzOi8vYnVncy53ZWJraXQub3JnL3Nob3dfYnVnLmNnaT9pZD02NTQ0MFxuICAgICAgICAgICAgICAgIGlmICh3ZWJraXRfcmVxX2ZzICYmIG5hbWUgIT09IFwiZG93bmxvYWRcIikge1xuICAgICAgICAgICAgICAgICAgICBuYW1lICs9IFwiLmRvd25sb2FkXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICh0eXBlID09PSBmb3JjZV9zYXZlYWJsZV90eXBlIHx8IHdlYmtpdF9yZXFfZnMpIHtcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0X3ZpZXcgPSB2aWV3O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoIXJlcV9mcykge1xuICAgICAgICAgICAgICAgICAgICBmc19lcnJvcigpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGZzX21pbl9zaXplICs9IGJsb2Iuc2l6ZTtcbiAgICAgICAgICAgICAgICByZXFfZnModmlldy5URU1QT1JBUlksIGZzX21pbl9zaXplLCBhYm9ydGFibGUoZnVuY3Rpb24oZnMpIHtcbiAgICAgICAgICAgICAgICAgICAgZnMucm9vdC5nZXREaXJlY3RvcnkoXCJzYXZlZFwiLCBjcmVhdGVfaWZfbm90X2ZvdW5kLCBhYm9ydGFibGUoZnVuY3Rpb24oZGlyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2F2ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpci5nZXRGaWxlKG5hbWUsIGNyZWF0ZV9pZl9ub3RfZm91bmQsIGFib3J0YWJsZShmdW5jdGlvbihmaWxlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUuY3JlYXRlV3JpdGVyKGFib3J0YWJsZShmdW5jdGlvbih3cml0ZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlci5vbndyaXRlZW5kID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXRfdmlldy5sb2NhdGlvbi5ocmVmID0gZmlsZS50b1VSTCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVzYXZlci5yZWFkeVN0YXRlID0gZmlsZXNhdmVyLkRPTkU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGF0Y2goZmlsZXNhdmVyLCBcIndyaXRlZW5kXCIsIGV2ZW50KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXZva2UoZmlsZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVyLm9uZXJyb3IgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3IgPSB3cml0ZXIuZXJyb3I7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVycm9yLmNvZGUgIT09IGVycm9yLkFCT1JUX0VSUikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmc19lcnJvcigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIndyaXRlc3RhcnQgcHJvZ3Jlc3Mgd3JpdGUgYWJvcnRcIi5zcGxpdChcIiBcIikuZm9yRWFjaChmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlcltcIm9uXCIgKyBldmVudF0gPSBmaWxlc2F2ZXJbXCJvblwiICsgZXZlbnRdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXIud3JpdGUoYmxvYik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlc2F2ZXIuYWJvcnQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXIuYWJvcnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlc2F2ZXIucmVhZHlTdGF0ZSA9IGZpbGVzYXZlci5ET05FO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVzYXZlci5yZWFkeVN0YXRlID0gZmlsZXNhdmVyLldSSVRJTkc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBmc19lcnJvcik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksIGZzX2Vycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICBkaXIuZ2V0RmlsZShuYW1lLCB7Y3JlYXRlOiBmYWxzZX0sIGFib3J0YWJsZShmdW5jdGlvbihmaWxlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZGVsZXRlIGZpbGUgaWYgaXQgYWxyZWFkeSBleGlzdHNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBhYm9ydGFibGUoZnVuY3Rpb24oZXgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXguY29kZSA9PT0gZXguTk9UX0ZPVU5EX0VSUikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYXZlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnNfZXJyb3IoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgICAgIH0pLCBmc19lcnJvcik7XG4gICAgICAgICAgICAgICAgfSksIGZzX2Vycm9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICwgRlNfcHJvdG8gPSBGaWxlU2F2ZXIucHJvdG90eXBlXG4gICAgICAgICAgICAsIHNhdmVBcyA9IGZ1bmN0aW9uKGJsb2IsIG5hbWUsIG5vX2F1dG9fYm9tKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBGaWxlU2F2ZXIoYmxvYiwgbmFtZSwgbm9fYXV0b19ib20pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgO1xuICAgICAgICAvLyBJRSAxMCsgKG5hdGl2ZSBzYXZlQXMpXG4gICAgICAgIGlmICh0eXBlb2YgbmF2aWdhdG9yICE9PSBcInVuZGVmaW5lZFwiICYmIG5hdmlnYXRvci5tc1NhdmVPck9wZW5CbG9iKSB7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oYmxvYiwgbmFtZSwgbm9fYXV0b19ib20pIHtcbiAgICAgICAgICAgICAgICBpZiAoIW5vX2F1dG9fYm9tKSB7XG4gICAgICAgICAgICAgICAgICAgIGJsb2IgPSBhdXRvX2JvbShibG9iKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5hdmlnYXRvci5tc1NhdmVPck9wZW5CbG9iKGJsb2IsIG5hbWUgfHwgXCJkb3dubG9hZFwiKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICBGU19wcm90by5hYm9ydCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIGZpbGVzYXZlciA9IHRoaXM7XG4gICAgICAgICAgICBmaWxlc2F2ZXIucmVhZHlTdGF0ZSA9IGZpbGVzYXZlci5ET05FO1xuICAgICAgICAgICAgZGlzcGF0Y2goZmlsZXNhdmVyLCBcImFib3J0XCIpO1xuICAgICAgICB9O1xuICAgICAgICBGU19wcm90by5yZWFkeVN0YXRlID0gRlNfcHJvdG8uSU5JVCA9IDA7XG4gICAgICAgIEZTX3Byb3RvLldSSVRJTkcgPSAxO1xuICAgICAgICBGU19wcm90by5ET05FID0gMjtcblxuICAgICAgICBGU19wcm90by5lcnJvciA9XG4gICAgICAgICAgICBGU19wcm90by5vbndyaXRlc3RhcnQgPVxuICAgICAgICAgICAgICAgIEZTX3Byb3RvLm9ucHJvZ3Jlc3MgPVxuICAgICAgICAgICAgICAgICAgICBGU19wcm90by5vbndyaXRlID1cbiAgICAgICAgICAgICAgICAgICAgICAgIEZTX3Byb3RvLm9uYWJvcnQgPVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZTX3Byb3RvLm9uZXJyb3IgPVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGU19wcm90by5vbndyaXRlZW5kID1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bGw7XG5cbiAgICAgICAgcmV0dXJuIHNhdmVBcztcbiAgICB9KFxuICAgICAgICB0eXBlb2Ygc2VsZiAhPT0gXCJ1bmRlZmluZWRcIiAmJiBzZWxmXG4gICAgICAgIHx8IHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgJiYgd2luZG93XG4gICAgICAgIHx8IHRoaXMuY29udGVudFxuICAgICkpO1xuLy8gYHNlbGZgIGlzIHVuZGVmaW5lZCBpbiBGaXJlZm94IGZvciBBbmRyb2lkIGNvbnRlbnQgc2NyaXB0IGNvbnRleHRcbi8vIHdoaWxlIGB0aGlzYCBpcyBuc0lDb250ZW50RnJhbWVNZXNzYWdlTWFuYWdlclxuLy8gd2l0aCBhbiBhdHRyaWJ1dGUgYGNvbnRlbnRgIHRoYXQgY29ycmVzcG9uZHMgdG8gdGhlIHdpbmRvd1xuXG5pZiAodHlwZW9mIG1vZHVsZSAhPT0gXCJ1bmRlZmluZWRcIiAmJiBtb2R1bGUuZXhwb3J0cykge1xuICAgIG1vZHVsZS5leHBvcnRzLnNhdmVBcyA9IHNhdmVBcztcbn0gZWxzZSBpZiAoKHR5cGVvZiBkZWZpbmUgIT09IFwidW5kZWZpbmVkXCIgJiYgZGVmaW5lICE9PSBudWxsKSAmJiAoZGVmaW5lLmFtZCAhPSBudWxsKSkge1xuICAgIGRlZmluZShbXSwgZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBzYXZlQXM7XG4gICAgfSk7XG59XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gcGx1Z2lucy9zYXZlQXMuanMiLCJtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKCkge1xyXG5cdHRocm93IG5ldyBFcnJvcihcImRlZmluZSBjYW5ub3QgYmUgdXNlZCBpbmRpcmVjdFwiKTtcclxufTtcclxuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi4vbm9kZV9tb2R1bGVzL3dlYnBhY2svYnVpbGRpbi9hbWQtZGVmaW5lLmpzXG4vLyBtb2R1bGUgaWQgPSA2M1xuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCIvKiBnbG9iYWxzIF9fd2VicGFja19hbWRfb3B0aW9uc19fICovXHJcbm1vZHVsZS5leHBvcnRzID0gX193ZWJwYWNrX2FtZF9vcHRpb25zX187XHJcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4uL25vZGVfbW9kdWxlcy93ZWJwYWNrL2J1aWxkaW4vYW1kLW9wdGlvbnMuanNcbi8vIG1vZHVsZSBpZCA9IDY0XG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsImZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLkJhc2VCcnVzaC5wcm90b3R5cGUsIHtcbiAgdXNlRHJhd2luZ0NvbG9yOiB0cnVlLFxuICBzZXRPcHRpb25zOiBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgIGZvciAodmFyIHByb3AgaW4gb3B0aW9ucykge1xuICAgICAgdGhpc1twcm9wXSA9IG9wdGlvbnNbcHJvcF07XG4gICAgfVxuICB9LFxuICB0eXBlOiBcImJhc2UtYnJ1c2hcIixcbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKGNhbnZhcywgb3B0aW9ucykge1xuICAgIHRoaXMuY2FudmFzID0gY2FudmFzO1xuICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICAgIGlmKHRoaXMuY2FudmFzLmFwcGxpY2F0aW9uKSB7XG4gICAgICB0aGlzLmNhbnZhcy5hcHBsaWNhdGlvbi5maXJlKFwiZW50aXR5OmNyZWF0ZWRcIiwge3RhcmdldDogdGhpcywgb3B0aW9uczogb3B0aW9uc30pXG4gICAgfVxuICAgIHRoaXMuc2V0T3B0aW9ucyhvcHRpb25zKTtcbiAgfSxcbiAgY29udmVydENvbG9yOiBmdW5jdGlvbiAoY29sb3IsIHR5cGUpIHtcbiAgICB0eXBlID0gdHlwZSB8fCBcIm5hbWVcIjtcbiAgICBpZiAoY29sb3IgaW5zdGFuY2VvZiBBcnJheSkge1xuICAgICAgaWYgKHR5cGUgPT0gXCJzb3VyY2VcIikge1xuICAgICAgICByZXR1cm4gY29sb3I7XG4gICAgICB9XG4gICAgICBjb2xvciA9IFwiI1wiICsgZmFicmljLkNvbG9yLmZyb21Tb3VyY2UoY29sb3IpLnRvSGV4KCk7XG4gICAgfVxuICAgIGlmICh0eXBlID09IFwiaGV4XCIgfHwgdHlwZSA9PSBcInNvdXJjZVwiKSB7XG4gICAgICBpZiAoZmFicmljLkNvbG9yLmNvbG9yTmFtZU1hcFtjb2xvcl0pIHtcbiAgICAgICAgY29sb3IgPSBmYWJyaWMuQ29sb3IuY29sb3JOYW1lTWFwW2NvbG9yXTtcbiAgICAgIH1cbiAgICAgIGlmICh0eXBlID09IFwic291cmNlXCIpIHtcbiAgICAgICAgaWYgKGNvbG9yID09IFwidHJhbnNwYXJlbnRcIikge1xuICAgICAgICAgIHJldHVybiBbMCwgMCwgMCwgMF07XG4gICAgICAgIH1cbiAgICAgICAgdmFyIF9zb3VyY2UgPSBmYWJyaWMuQ29sb3IuZnJvbUhleChjb2xvcikuZ2V0U291cmNlKClcbiAgICAgICAgX3NvdXJjZVszXSAqPSAyNTU7XG4gICAgICAgIHJldHVybiBfc291cmNlO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gY29sb3I7XG4gIH0sXG4gIGdldENvbG9yOiBmdW5jdGlvbiAodHlwZSkge1xuICAgIHZhciBjb2xvciA9IHRoaXMudXNlRHJhd2luZ0NvbG9yICYmIHRoaXMuY2FudmFzLmRyYXdpbmdDb2xvciB8fCB0aGlzLmNvbG9yO1xuICAgIHJldHVybiB0aGlzLmNvbnZlcnRDb2xvcihjb2xvciwgdHlwZSk7XG4gIH1cbn0pO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9icnVzaGVzL0Jhc2VCcnVzaC5qcyIsIlxuXG5mYWJyaWMuUGVuY2lsQnJ1c2gucHJvdG90eXBlLmluaXRpYWxpemUgPSBmdW5jdGlvbihjYW52YXMpIHtcbiAgdGhpcy5jYWxsU3VwZXIoJ2luaXRpYWxpemUnLCBjYW52YXMpO1xuICB0aGlzLl9wb2ludHMgPSBbIF07XG59O1xuZmFicmljLlBlbmNpbEJydXNoLnByb3RvdHlwZS50eXBlID0gJ3BlbmNpbC1icnVzaCc7XG5cbmZhYnJpYy5QZW5jaWxCcnVzaC5wcm90b3R5cGUuX3JlbmRlciA9IGZ1bmN0aW9uKCkge1xuICB2YXIgY3R4ICA9IHRoaXMuY2FudmFzLmNvbnRleHRUb3AsIHYgPSB0aGlzLmNhbnZhcy52aWV3cG9ydFRyYW5zZm9ybSwgcDEgPSB0aGlzLl9wb2ludHNbMF0sIHAyID0gdGhpcy5fcG9pbnRzWzFdO1xuICBjdHguc2F2ZSgpO1xuICBjdHgudHJhbnNmb3JtKHZbMF0sIHZbMV0sIHZbMl0sIHZbM10sIHZbNF0sIHZbNV0pO1xuICBjdHguYmVnaW5QYXRoKCk7XG4gIGN0eC5saW5lV2lkdGggPSAxIC8gdGhpcy5jYW52YXMudmlld3BvcnRUcmFuc2Zvcm1bMF07XG4gIGlmICh0aGlzLl9wb2ludHMubGVuZ3RoID09PSAyICYmIHAxLnggPT09IHAyLnggJiYgcDEueSA9PT0gcDIueSkge1xuICAgIHAxLnggLT0gMC41IC8gdGhpcy5jYW52YXMudmlld3BvcnRUcmFuc2Zvcm1bMF07XG4gICAgcDIueCArPSAwLjUgLyB0aGlzLmNhbnZhcy52aWV3cG9ydFRyYW5zZm9ybVswXTtcbiAgfVxuICBjdHgubW92ZVRvKHAxLngsIHAxLnkpO1xuICBmb3IgKHZhciBpID0gMSwgbGVuID0gdGhpcy5fcG9pbnRzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgdmFyIG1pZFBvaW50ID0gcDEubWlkUG9pbnRGcm9tKHAyKTtcbiAgICBjdHgucXVhZHJhdGljQ3VydmVUbyhwMS54LCBwMS55LCBtaWRQb2ludC54LCBtaWRQb2ludC55KTtcbiAgICBwMSA9IHRoaXMuX3BvaW50c1tpXTtcbiAgICBwMiA9IHRoaXMuX3BvaW50c1tpICsgMV07XG4gIH1cbiAgY3R4LmxpbmVUbyhwMS54LCBwMS55KTtcbiAgY3R4LnN0cm9rZSgpO1xuICBjdHgucmVzdG9yZSgpO1xufTtcblxuZmFicmljLlBlbmNpbEJydXNoLnByb3RvdHlwZS5jcmVhdGVQYXRoID0gZnVuY3Rpb24ocGF0aERhdGEpIHtcbiAgdmFyIHBhdGggPSBuZXcgZmFicmljLlBhdGgocGF0aERhdGEsIHtcbiAgICBzdHJva2U6IHRoaXMuZ2V0Q29sb3IoKSxcbiAgICBzdHJva2VXaWR0aDogdGhpcy53aWR0aCxcbiAgICBhcHBsaWNhdGlvbjogdGhpcy5jYW52YXMuYXBwbGljYXRpb25cbiAgfSk7XG4gIGlmICh0aGlzLnNoYWRvdykge1xuICAgIHRoaXMuc2hhZG93LmFmZmVjdFN0cm9rZSA9IHRydWU7XG4gICAgcGF0aC5zZXRTaGFkb3codGhpcy5zaGFkb3cpO1xuICB9XG4gIHJldHVybiBwYXRoO1xufTtcbmZhYnJpYy5QZW5jaWxCcnVzaC5wcm90b3R5cGUubWluTGVuZ3RoID0gMztcblxuZmFicmljLlBlbmNpbEJydXNoLnByb3RvdHlwZS5hY2N1cmFjeSA9IDA7XG5mYWJyaWMuUGVuY2lsQnJ1c2gucHJvdG90eXBlLl9maW5hbGl6ZUFuZEFkZFBhdGggPSBmdW5jdGlvbigpIHtcbiAgaWYodGhpcy5fcG9pbnRzLmxlbmd0aCA8IDIpcmV0dXJuO1xuICB2YXIgY3R4ID0gdGhpcy5jYW52YXMuY29udGV4dFRvcDtcbiAgY3R4LmNsb3NlUGF0aCgpO1xuICB0aGlzLmNhbnZhcy5jbGVhckNvbnRleHQodGhpcy5jYW52YXMuY29udGV4dFRvcCk7XG4gIGlmKHRoaXMuYWNjdXJhY3kpe1xuICAgIGZvcih2YXIgaSBpbiB0aGlzLl9wb2ludHMpe1xuICAgICAgdGhpcy5fcG9pbnRzW2ldLnggPSArdGhpcy5fcG9pbnRzW2ldLngudG9GaXhlZCh0aGlzLmFjY3VyYWN5KTtcbiAgICAgIHRoaXMuX3BvaW50c1tpXS55ID0gK3RoaXMuX3BvaW50c1tpXS55LnRvRml4ZWQodGhpcy5hY2N1cmFjeSk7XG4gICAgfVxuICAgIGZvcihpID0gdGhpcy5fcG9pbnRzLmxlbmd0aCAtIDE7IGktLTsgKXtcbiAgICAgIGlmKHRoaXMuX3BvaW50c1tpXS54ID09IHRoaXMuX3BvaW50c1tpICsgMV0ueCAmJiAgdGhpcy5fcG9pbnRzW2ldLnkgPT0gdGhpcy5fcG9pbnRzW2kgKyAxXS55KXtcbiAgICAgICAgdGhpcy5fcG9pbnRzLnNwbGljZShpLDEpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBpZih0aGlzLl9wb2ludHMubGVuZ3RoIDwgMilyZXR1cm47XG4gIHZhciBwYXRoRGF0YSA9IHRoaXMuY29udmVydFBvaW50c1RvU1ZHUGF0aCh0aGlzLl9wb2ludHMpLmpvaW4oJycpO1xuICBpZiAodGhpcy5fcG9pbnRzLmxlbmd0aCA8IHRoaXMubWluTGVuZ3RoIHx8IHBhdGhEYXRhID09PSAnTSAwIDAgUSAwIDAgMCAwIEwgMCAwJykge1xuICAgIHJldHVybiB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgfVxuICB2YXIgcGF0aCA9IHRoaXMuY3JlYXRlUGF0aChwYXRoRGF0YSk7XG4gIHRoaXMuY2FudmFzLmFkZChwYXRoKTtcbiAgcGF0aC5zZXRDb29yZHMoKTtcbiAgdGhpcy5fcmVzZXRTaGFkb3coKTtcbiAgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gIHRoaXMuY2FudmFzLmZpcmUoJ3BhdGg6Y3JlYXRlZCcsIHsgcGF0aDogcGF0aCB9KTtcbn07XG5cblxuZmFicmljLlNsaWRlQ2FudmFzLnByb3RvdHlwZS5kcmF3aW5nVG9vbHMuUGVuY2lsQnJ1c2ggPSB7XG4gIGNsYXNzTmFtZTogJ2ZhIGZhLXBlbmNpbCcsXG4gIHRpdGxlOiAnUGVuY2lsIEJydXNoJ1xufTtcbmZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUuYWN0aXZlRHJhd2luZ1Rvb2xzLnB1c2goXCJQZW5jaWxCcnVzaFwiKTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvYnJ1c2hlcy9QZW5jaWxCcnVzaC5qcyIsIid1c2Ugc3RyaWN0JztcblxuXG4vKipcbiAqIFBlbmNpbEJydXNoIGNsYXNzXG4gKiBAY2xhc3MgZmFicmljLlJlY3RhbmdsZUJydXNoXG4gKiBAZXh0ZW5kcyBmYWJyaWMuQmFzZUJydXNoXG4gKi9cbmZhYnJpYy5SZWN0YW5nbGVCcnVzaCA9IGZhYnJpYy51dGlsLmNyZWF0ZUNsYXNzKGZhYnJpYy5CYXNlQnJ1c2gsIC8qKiBAbGVuZHMgZmFicmljLlJlY3RhbmdsZUJydXNoLnByb3RvdHlwZSAqLyB7XG4gIHJlc3VsdE9iamVjdFR5cGU6IFwiUmVjdFwiLFxuICB0eXBlOiBcInJlY3RhbmdsZS1icnVzaFwiLFxuICAvKipcbiAgICogQ29uc3RydWN0b3JcbiAgICogQHBhcmFtIHtmYWJyaWMuQ2FudmFzfSBjYW52YXNcbiAgICogQHJldHVybiB7ZmFicmljLlJlY3RhbmdsZUJydXNofSBJbnN0YW5jZSBvZiBhIHBlbmNpbCBicnVzaFxuICAgKi9cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKGNhbnZhcykge1xuICAgIHRoaXMuY2FsbFN1cGVyKCdpbml0aWFsaXplJywgY2FudmFzKTtcbiAgfSxcblxuICAvKipcbiAgICogSW5vdm9rZWQgb24gbW91c2UgZG93blxuICAgKiBAcGFyYW0ge09iamVjdH0gcG9pbnRlclxuICAgKi9cbiAgb25Nb3VzZURvd246IGZ1bmN0aW9uIChwb2ludGVyKSB7XG4gICAgLy9wcmVwYXJlIGZvciBkcmF3aW5nXG4gICAgZGVsZXRlIHRoaXMucDI7XG5cbiAgICB0aGlzLnAxID0gbmV3IGZhYnJpYy5Qb2ludChwb2ludGVyLngsIHBvaW50ZXIueSk7XG4gICAgdGhpcy5fc2V0QnJ1c2hTdHlsZXMoKTtcbiAgICB0aGlzLl9zZXRTaGFkb3coKTtcbiAgICB0aGlzLmNhbnZhcy5jb250ZXh0VG9wLm1vdmVUbyh0aGlzLnAxLngsIHRoaXMucDEueSk7XG4gICAgdGhpcy5fcmVuZGVyKCk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIElub3Zva2VkIG9uIG1vdXNlIG1vdmVcbiAgICogQHBhcmFtIHtPYmplY3R9IHBvaW50ZXJcbiAgICovXG4gIG9uTW91c2VNb3ZlOiBmdW5jdGlvbiAocG9pbnRlcikge1xuXG4gICAgdGhpcy5wMiA9IG5ldyBmYWJyaWMuUG9pbnQocG9pbnRlci54LCBwb2ludGVyLnkpO1xuXG4gICAgaWYodGhpcy5kcmF3aW5nT2JqZWN0KXtcbiAgICAgIHZhciBfcmVjdCA9IHRoaXMuX2dldFJlY3QoKTtcbiAgICAgIHRoaXMuZHJhd2luZ09iamVjdC5zZXQoX3JlY3QpO1xuICAgICAgdGhpcy5kcmF3aW5nT2JqZWN0LmZpcmUoXCJzY2FsaW5nXCIpO1xuICAgIH1lbHNle1xuXG4gICAgICBpZiAodGhpcy5wMS54ID09PSB0aGlzLnAyLnggJiYgdGhpcy5wMS55ID09PSB0aGlzLnAyLnkpIHtcbiAgICAgICAgZGVsZXRlIHRoaXMucDI7XG4gICAgICB9IGVsc2Uge1xuXG4gICAgICAgIGlmKHRoaXMucmVzdWx0T2JqZWN0VHlwZSl7XG4gICAgICAgICAgdmFyIF9yZWN0ID0gdGhpcy5fZ2V0UmVjdCgpO1xuICAgICAgICAgIHRoaXMuZHJhd2luZ09iamVjdCA9IHRoaXMuX2NyZWF0ZVJlY3RhbmdsZShfcmVjdCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy5jYW52YXMucmVuZGVyTGF5ZXIoXCJsb3dlclwiKTtcbiAgfSxcblxuICAvKipcbiAgICogSW52b2tlZCBvbiBtb3VzZSB1cFxuICAgKi9cbiAgb25Nb3VzZVVwOiBmdW5jdGlvbiAoKSB7XG4gICAgaWYodGhpcy5kcmF3aW5nT2JqZWN0KXtcbiAgICAgIHZhciBfcmVjdCA9IHRoaXMuX2dldFJlY3QoKTtcbiAgICAgIHZhciBfcmVjdDIgPSB0aGlzLl9jaGVja1JlY3RhbmdsZShfcmVjdCk7XG5cbiAgICAgIHRoaXMuY2FudmFzLmxheWVycy5sb3dlci5vYmplY3RzLnNwbGljZSh0aGlzLmNhbnZhcy5sYXllcnMubG93ZXIub2JqZWN0cy5pbmRleE9mKHRoaXMuZHJhd2luZ09iamVjdCksIDEpO1xuXG4gICAgICB0aGlzLmRyYXdpbmdPYmplY3Quc2V0KF9yZWN0Mik7XG4gICAgICB0aGlzLmNhbnZhcy5hZGQodGhpcy5kcmF3aW5nT2JqZWN0KTtcbiAgICAgIHRoaXMuY2FudmFzLnNldEFjdGl2ZU9iamVjdCh0aGlzLmRyYXdpbmdPYmplY3QpO1xuICAgICAgdGhpcy5kcmF3aW5nT2JqZWN0LnNldENvb3JkcygpO1xuICAgICAgZGVsZXRlIHRoaXMuZHJhd2luZ09iamVjdDtcbiAgICB9XG4gICAgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gICAgLy8gdGhpcy5fZmluYWxpemVBbmRBZGRQYXRoKCk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIERyYXcgYSBzbW9vdGggcGF0aCBvbiB0aGUgdG9wQ2FudmFzIHVzaW5nIHF1YWRyYXRpY0N1cnZlVG9cbiAgICogQHByaXZhdGVcbiAgICovXG4gIF9yZW5kZXI6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmNhbnZhcy5maXJlKFwiYmVmb3JlOmJydXNoOnJlbmRlclwiLHt0YXJnZXQ6IHRoaXN9KVxuICAgIGlmICghdGhpcy5wMikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB2YXIgY3R4ID0gdGhpcy5jYW52YXMuY29udGV4dFRvcCxcbiAgICAgIHYgPSB0aGlzLmNhbnZhcy52aWV3cG9ydFRyYW5zZm9ybSxcbiAgICAgIHAxID0gdGhpcy5wMSxcbiAgICAgIHAyID0gdGhpcy5wMjtcblxuICAgIGN0eC5zYXZlKCk7XG4gICAgY3R4LnRyYW5zZm9ybSh2WzBdLCB2WzFdLCB2WzJdLCB2WzNdLCB2WzRdLCB2WzVdKTtcbiAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgaWYodGhpcy5hcHBsaWNhdGlvbil7XG4gICAgICB2YXIgX2tsYXNzX3Byb3RvID0gdGhpcy5hcHBsaWNhdGlvbi5nZXREZWZhdWx0UHJvcGVydGllcyhmYWJyaWNbdGhpcy5yZXN1bHRPYmplY3RUeXBlXS5wcm90b3R5cGUpIHx8IHt9O1xuICAgICAgY3R4LmxpbmVXaWR0aCA9IF9rbGFzc19wcm90by5zdHJva2VXaWR0aDtcbiAgICAgIGN0eC5zdHJva2VTdHlsZSA9IF9rbGFzc19wcm90by5zdHJva2U7XG4gICAgICBjdHguZmlsbFN0eWxlID0gX2tsYXNzX3Byb3RvLmZpbGw7XG4gICAgfVxuXG4gICAgdmFyIF9yZWN0ID0gdGhpcy5fZ2V0UmVjdCgpO1xuICAgIGN0eC5yZWN0KF9yZWN0LmxlZnQsIF9yZWN0LnRvcCwgX3JlY3Qud2lkdGgsIF9yZWN0LmhlaWdodCk7XG5cbiAgICBjdHguZmlsbCgpO1xuICAgIGN0eC5zdHJva2UoKTtcbiAgICBjdHgucmVzdG9yZSgpO1xuICAgIHRoaXMuY2FudmFzLmZpcmUoXCJicnVzaDpyZW5kZXJcIix7dGFyZ2V0OiB0aGlzfSlcbiAgfSxcbiAgX2dldFJlY3Q6IGZ1bmN0aW9uICgpIHtcblxuICAgIHZhciB4MSwgeDIsIHkxLCB5MjtcbiAgICBpZiAodGhpcy5wMS54IDwgdGhpcy5wMi54KSB7XG4gICAgICB4MSA9IHRoaXMucDEueCwgeDIgPSB0aGlzLnAyLng7XG4gICAgfSBlbHNlIHtcbiAgICAgIHgyID0gdGhpcy5wMS54LCB4MSA9IHRoaXMucDIueDtcbiAgICB9XG4gICAgaWYgKHRoaXMucDEueSA8IHRoaXMucDIueSkge1xuICAgICAgeTEgPSB0aGlzLnAxLnksIHkyID0gdGhpcy5wMi55O1xuICAgIH0gZWxzZSB7XG4gICAgICB5MiA9IHRoaXMucDEueSwgeTEgPSB0aGlzLnAyLnk7XG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICBsZWZ0OiB4MSxcbiAgICAgIHRvcDogeTEsXG4gICAgICB3aWR0aDogeDIgLSB4MSxcbiAgICAgIGhlaWdodDogeTIgLSB5MVxuICAgIH07XG4gIH0sXG4gIGRyYXdpbmdMaW1pdHM6IG51bGwsIC8qe1xuICAgbGVmdDogMCxcbiAgIHdpZHRoOiAwLFxuICAgaGVpZ2h0OiAwLFxuICAgdG9wOiAwXG4gICB9LCovXG4gIG1pbkhlaWdodDogNTAsXG4gIG1pbldpZHRoOiA1MCxcbiAgX2NoZWNrUmVjdGFuZ2xlOiBmdW5jdGlvbihfcmVjdCl7XG5cblxuICAgIHZhciBkbCA9IHRoaXMuZHJhd2luZ0xpbWl0cztcbiAgICBpZihkbCAmJiBkbCA9PSBcImJhY2tncm91bmRJbWFnZVwiKXtcbiAgICAgIGRsPSB0aGlzLmNhbnZhcy5iYWNrZ3JvdW5kSW1hZ2U7XG4gICAgfVxuXG4gICAgX3JlY3QgPSB7XG4gICAgICBsZWZ0OiBfcmVjdC5sZWZ0LFxuICAgICAgdG9wOiBfcmVjdC50b3AsXG4gICAgICB3aWR0aDogX3JlY3Qud2lkdGgsXG4gICAgICBoZWlnaHQ6IF9yZWN0LmhlaWdodCxcbiAgICB9O1xuXG4gICAgLy8gX3JlY3QubGVmdCAgLT0gZmFicmljLlJlY3QucHJvdG90eXBlLnN0cm9rZVdpZHRoIC8gMjtcbiAgICAvLyBfcmVjdC50b3AgICAtPSBmYWJyaWMuUmVjdC5wcm90b3R5cGUuc3Ryb2tlV2lkdGggLyAyO1xuXG4gICAgaWYoZGwpe1xuICAgICAgaWYoX3JlY3QubGVmdCArIF9yZWN0LndpZHRoIDwgZGwubGVmdCB8fFxuICAgICAgICBfcmVjdC50b3AgICsgX3JlY3QuaGVpZ2h0IDwgZGwudG9wIHx8XG4gICAgICAgIF9yZWN0LmxlZnQgPiBkbC53aWR0aCB8fFxuICAgICAgICBfcmVjdC50b3AgPiBkbC5oZWlnaHQpe1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG5cbiAgICAgIGlmKF9yZWN0LnRvcCA8IGRsLnRvcCl7XG4gICAgICAgIF9yZWN0LmhlaWdodCArPV9yZWN0LnRvcCA7XG4gICAgICAgIF9yZWN0LnRvcCA9IGRsLnRvcDtcbiAgICAgIH1cbiAgICAgIGlmKF9yZWN0LmxlZnQgPCBkbC5sZWZ0KXtcbiAgICAgICAgX3JlY3Qud2lkdGggKz0gX3JlY3QubGVmdDtcbiAgICAgICAgX3JlY3QubGVmdCA9IGRsLmxlZnQ7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYodGhpcy5taW5XaWR0aCAmJiBfcmVjdC53aWR0aCA8IHRoaXMubWluV2lkdGgpe1xuICAgICAgX3JlY3Qud2lkdGggPSB0aGlzLm1pbldpZHRoO1xuICAgIH1cbiAgICBpZih0aGlzLm1pbkhlaWdodCAmJiBfcmVjdC5oZWlnaHQgPCB0aGlzLm1pbkhlaWdodCl7XG4gICAgICBfcmVjdC5oZWlnaHQgPSB0aGlzLm1pbkhlaWdodDtcbiAgICB9XG5cblxuICAgIGlmKGRsKSB7XG4gICAgICB2YXIgX3hkaWZmID0gX3JlY3QubGVmdCArIF9yZWN0LndpZHRoIC0gZGwud2lkdGg7XG4gICAgICBpZiAoX3hkaWZmID4gMCkge1xuICAgICAgICBfcmVjdC53aWR0aCAtPSBfeGRpZmY7XG4gICAgICAgIGlmICh0aGlzLm1pbldpZHRoICYmIF9yZWN0LndpZHRoIDwgdGhpcy5taW5XaWR0aCkge1xuICAgICAgICAgIF9yZWN0LmxlZnQgLT0gdGhpcy5taW5XaWR0aCAtIF9yZWN0LndpZHRoO1xuICAgICAgICAgIF9yZWN0LndpZHRoID0gdGhpcy5taW5XaWR0aDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdmFyIF95ZGlmZiA9IF9yZWN0LnRvcCArIF9yZWN0LmhlaWdodCAtIGRsLmhlaWdodDtcbiAgICAgIGlmIChfeWRpZmYgPiAwKSB7XG4gICAgICAgIF9yZWN0LmhlaWdodCAtPSBfeWRpZmY7XG4gICAgICAgIGlmICh0aGlzLm1pbkhlaWdodCAmJiBfcmVjdC5oZWlnaHQgPCB0aGlzLm1pbkhlaWdodCkge1xuICAgICAgICAgIF9yZWN0LnRvcCAtPSB0aGlzLm1pbkhlaWdodCAtIF9yZWN0LmhlaWdodDtcbiAgICAgICAgICBfcmVjdC5oZWlnaHQgPSB0aGlzLm1pbkhlaWdodDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gX3JlY3Q7XG4gIH0sXG4gIF9jcmVhdGVSZWN0YW5nbGU6IGZ1bmN0aW9uKHJlY3Qpe1xuICAgIHRoaXMuY2FudmFzLnNldEFjdGl2ZU9iamVjdChmYWxzZSk7XG4gICAgcmVjdC5hY3RpdmUgPSB0cnVlO1xuICAgIHJlY3QuYXBwbGljYXRpb24gPSB0aGlzLmFwcGxpY2F0aW9uO1xuICAgIHJlY3QuY2FudmFzID0gdGhpcy5jYW52YXM7XG4gICAgdmFyIF9vYmplY3QgPSBmYWJyaWMudXRpbC5jcmVhdGVPYmplY3QodGhpcy5yZXN1bHRPYmplY3RUeXBlLHJlY3QpO1xuICAgIHRoaXMuY2FudmFzLmxheWVycy5sb3dlci5vYmplY3RzLnB1c2goX29iamVjdCk7XG4gICAgX29iamVjdC51cGRhdGVSZXNwb25zaXZlQm9yZGVyKCk7XG4gICAgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gICAgcmV0dXJuIF9vYmplY3Q7XG4gIH1cblxuICAvKipcbiAgICogT24gbW91c2V1cCBhZnRlciBkcmF3aW5nIHRoZSBwYXRoIG9uIGNvbnRleHRUb3AgY2FudmFzXG4gICAqIHdlIHVzZSB0aGUgcG9pbnRzIGNhcHR1cmVkIHRvIGNyZWF0ZSBhbiBuZXcgZmFicmljIHJlY3Qgb2JqZWN0XG4gICAqIGFuZCBhZGQgaXQgdG8gdGhlIGZhYnJpYyBjYW52YXMuXG4gICAqL1xuICAvLyBfZmluYWxpemVBbmRBZGRQYXRoOiBmdW5jdGlvbiAoKSB7XG4gIC8vXG4gIC8vICAgaWYgKCF0aGlzLnAyKSB7XG4gIC8vICAgICByZXR1cm4gZmFsc2U7XG4gIC8vICAgfVxuICAvLyAgIHZhciBjdHggPSB0aGlzLmNhbnZhcy5jb250ZXh0VG9wO1xuICAvLyAgIGN0eC5jbG9zZVBhdGgoKTtcbiAgLy9cbiAgLy9cbiAgLy8gICB0aGlzLmNhbnZhcy5jbGVhckNvbnRleHQodGhpcy5jYW52YXMuY29udGV4dFRvcCk7XG4gIC8vICAgdGhpcy5fcmVzZXRTaGFkb3coKTtcbiAgLy9cbiAgLy8gICAvLyB2YXIgX3JlY3QgPSB0aGlzLl9nZXRSZWN0KCk7XG4gIC8vICAgdmFyIF9yZWN0MiA9IHRoaXMuX2NoZWNrUmVjdGFuZ2xlKF9yZWN0KTtcbiAgLy8gICBpZihfcmVjdDIpe1xuICAvLyAgICAgLy8gaWYodGhpcy5yZXN1bHRPYmplY3RUeXBlKXtcbiAgLy8gICAgIC8vICAgdGhpcy5fY3JlYXRlUmVjdGFuZ2xlKF9yZWN0Mik7XG4gIC8vICAgICAvLyB9XG4gIC8vICAgICB0aGlzLmNhbnZhcy5maXJlKCdyZWN0OmNyZWF0ZWQnLCB7cmVjdDogX3JlY3QyLCBvcmlnaW5hbDogX3JlY3R9KTtcbiAgLy8gICB9ZWxzZXtcbiAgLy8gICAgIHRoaXMuY2FudmFzLmZpcmUoJ3JlY3Q6cmVqZWN0ZWQnLCB7cmVjdDogX3JlY3R9KTtcbiAgLy8gICB9XG4gIC8vICAgdGhpcy5jYW52YXMucmVuZGVyTGF5ZXIodGhpcy5sYXllcnMubG93ZXIpO1xuICAvLyB9XG59KTtcblxuXG5mYWJyaWMuU2xpZGVDYW52YXMucHJvdG90eXBlLmRyYXdpbmdUb29scy5SZWN0YW5nbGVCcnVzaCA9IHtcbiAgY2xhc3NOYW1lOiAnZmEgZmEtcGVuY2lsLXNxdWFyZScsXG4gIHRpdGxlOiAnc2VsZWN0LWJydXNoJ1xufTtcbmZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUuYWN0aXZlRHJhd2luZ1Rvb2xzLnB1c2goXCJSZWN0YW5nbGVCcnVzaFwiKTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvYnJ1c2hlcy9SZWN0YW5nbGVCcnVzaC5qcyIsIid1c2Ugc3RyaWN0JztcblxuXG4gIC8qKlxuICAgKiBQZW5jaWxCcnVzaCBjbGFzc1xuICAgKiBAY2xhc3MgZmFicmljLlJlY3RhbmdsZUJydXNoXG4gICAqIEBleHRlbmRzIGZhYnJpYy5CYXNlQnJ1c2hcbiAgICovXG4gIGZhYnJpYy5Qb2x5Z29uQnJ1c2ggPSBmYWJyaWMudXRpbC5jcmVhdGVDbGFzcyhmYWJyaWMuQmFzZUJydXNoLCAvKiogQGxlbmRzIGZhYnJpYy5SZWN0YW5nbGVCcnVzaC5wcm90b3R5cGUgKi8ge1xuICAgIHJlc3VsdE9iamVjdFR5cGU6IFwiUG9seWxpbmVcIixcbiAgICB0eXBlOiBcInBvbHlnb24tYnJ1c2hcIixcbiAgICB2aXJ0dWFsT2JqZWN0OiBmYWxzZSxcbiAgICBtYXhpbXVtUG9pbnRzIDogMCxcbiAgICBpbmRpdmlkdWFsRHJhd2luZzogdHJ1ZSxcbiAgICAvKipcbiAgICAgKiBDb25zdHJ1Y3RvclxuICAgICAqIEBwYXJhbSB7ZmFicmljLkNhbnZhc30gY2FudmFzXG4gICAgICogQHJldHVybiB7ZmFicmljLlJlY3RhbmdsZUJydXNofSBJbnN0YW5jZSBvZiBhIHBlbmNpbCBicnVzaFxuICAgICAqL1xuICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIChjYW52YXMpIHtcbiAgICAgIHRoaXMuY2FsbFN1cGVyKCdpbml0aWFsaXplJywgY2FudmFzKTtcbiAgICAgIHRoaXMucmVzZXQoKTtcbiAgICB9LFxuICAgIC8qKlxuICAgICAqIElub3Zva2VkIG9uIG1vdXNlIGRvd25cbiAgICAgKiBAcGFyYW0ge09iamVjdH0gcG9pbnRlclxuICAgICAqL1xuICAgIG9uTW91c2VEb3duOiBmdW5jdGlvbiAocG9pbnRlcikge1xuXG5cbiAgICAgIGlmKHRoaXMuaW5kaXZpZHVhbERyYXdpbmcgfHwgIXRoaXMudGFyZ2V0KXtcbiAgICAgICAgdmFyIF9wb2ludCA9IHt4OiBwb2ludGVyLngsIHk6IHBvaW50ZXIueX07XG4gICAgICAgIHRoaXMucG9pbnRzLnB1c2goX3BvaW50KTtcbiAgICAgICAgaWYoIXRoaXMudmlydHVhbE9iamVjdCl7XG4gICAgICAgICAgdGhpcy50YXJnZXQgPSB0aGlzLmNhbnZhcy5jcmVhdGVPYmplY3QoXG4gICAgICAgICAgICBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKHt9LFxuICAgICAgICAgICAgICB0aGlzLnJlc3VsdE9iamVjdFByb3BlcnRpZXMsIHtcbiAgICAgICAgICAgICAgICB0eXBlOiB0aGlzLnJlc3VsdE9iamVjdFR5cGUsXG4gICAgICAgICAgICAgICAgcG9pbnRzOiBbX3BvaW50XSxcbiAgICAgICAgICAgICAgICBhY3RpdmU6IHRydWVcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgKVxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH1lbHNle1xuICAgICAgICB0aGlzLl9jcmVhdGVfYWN0aXZlX3BvaW50KHBvaW50ZXIpO1xuICAgICAgfVxuXG4gICAgICBpZih0aGlzLnZpcnR1YWxPYmplY3QpIHtcbiAgICAgICAgdGhpcy5fc2V0QnJ1c2hTdHlsZXMoKTtcbiAgICAgICAgdGhpcy5fc2V0U2hhZG93KCk7XG4gICAgICAgIHRoaXMuX3JlbmRlcigpO1xuICAgICAgfWVsc2V7XG4gICAgICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICBfY3JlYXRlX2FjdGl2ZV9wb2ludDogZnVuY3Rpb24gKHBvaW50ZXIpIHtcbiAgICAgIHZhciBfcG9pbnQgPSB7eDogcG9pbnRlci54LCB5OiBwb2ludGVyLnl9O1xuICAgICAgdGhpcy5hY3RpdmVQb2ludCA9ICBfcG9pbnQ7XG4gICAgICB0aGlzLmFjdGl2ZVRhcmdldFBvaW50ID0gIHt4OiBwb2ludGVyLnggLSB0aGlzLnRhcmdldC5sZWZ0LCB5IDogcG9pbnRlci55IC0gdGhpcy50YXJnZXQudG9wfTtcbiAgICAgIHRoaXMucG9pbnRzLnB1c2godGhpcy5hY3RpdmVQb2ludCk7XG4gICAgICB0aGlzLnRhcmdldC5hZGRQb2ludCh0aGlzLmFjdGl2ZVRhcmdldFBvaW50KTtcbiAgICB9LFxuICAgIC8qKlxuICAgICAqIElub3Zva2VkIG9uIG1vdXNlIG1vdmVcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gcG9pbnRlclxuICAgICAqL1xuICAgIG9uTW91c2VNb3ZlOiBmdW5jdGlvbiAocG9pbnRlcikge1xuXG5cbiAgICAgIHZhciBfcCA9ICB7eDogcG9pbnRlci54IC0gdGhpcy50YXJnZXQubGVmdCwgeSA6IHBvaW50ZXIueSAtIHRoaXMudGFyZ2V0LnRvcH07XG5cblxuICAgICAgaWYodGhpcy5hY3RpdmVQb2ludCl7XG4gICAgICAgIHRoaXMuYWN0aXZlUG9pbnQueCA9IHBvaW50ZXIueDtcbiAgICAgICAgdGhpcy5hY3RpdmVQb2ludC55ID0gcG9pbnRlci55O1xuICAgICAgICB2YXIgX29yZGVyID0gdGhpcy50YXJnZXQucG9pbnRzLmxlbmd0aCA7XG5cbiAgICAgICAgdGhpcy50YXJnZXQuc2V0UG9pbnQoXCJwXCIgKyBfb3JkZXIsIHtcbiAgICAgICAgICB4IDogcG9pbnRlci54IC0gdGhpcy50YXJnZXQubGVmdCxcbiAgICAgICAgICB5IDogcG9pbnRlci55IC0gdGhpcy50YXJnZXQudG9wXG4gICAgICAgIH0pO1xuICAgICAgfWVsc2V7XG4gICAgICAgIHZhciBfZGlzdCA9IGZhYnJpYy5Qb2ludC5wcm90b3R5cGUuZGlzdGFuY2VGcm9tLmNhbGwodGhpcy5wb2ludHNbMF0sX3ApXG4gICAgICAgIGlmKF9kaXN0ID4gMTApe1xuICAgICAgICAgIHRoaXMuX2NyZWF0ZV9hY3RpdmVfcG9pbnQocG9pbnRlcik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgIH0sXG4gICAgcmVzZXQ6IGZ1bmN0aW9uKCl7XG4gICAgICB0aGlzLnBvaW50cyA9IFtdO1xuICAgICAgdGhpcy50YXJnZXQgPSBudWxsO1xuICAgICAgdGhpcy5hY3RpdmVQb2ludCA9IG51bGw7XG4gICAgICB0aGlzLmFjdGl2ZVRhcmdldFBvaW50ID0gbnVsbDtcbiAgICB9LFxuICAgIC8qKlxuICAgICAqIEludm9rZWQgb24gbW91c2UgdXBcbiAgICAgKi9cbiAgICBvbk1vdXNlVXA6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMudGFyZ2V0LnVwZGF0ZUJib3goKTtcbiAgICAgIGlmKHRoaXMucG9pbnRzLmxlbmd0aCA9PSB0aGlzLm1heGltdW1Qb2ludHMpe1xuICAgICAgICB0aGlzLnJlc2V0KCk7XG4gICAgICB9XG4gICAgICB0aGlzLmFjdGl2ZVBvaW50ID0gbnVsbDtcbiAgICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBEcmF3IGEgc21vb3RoIHBhdGggb24gdGhlIHRvcENhbnZhcyB1c2luZyBxdWFkcmF0aWNDdXJ2ZVRvXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfcmVuZGVyOiBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLmNhbnZhcy5maXJlKFwiYmVmb3JlOmJydXNoOnJlbmRlclwiLHt0YXJnZXQ6IHRoaXN9KTtcblxuICAgICAgdmFyIGN0eCA9IHRoaXMuY2FudmFzLmNvbnRleHRUb3AsXG4gICAgICAgIHYgPSB0aGlzLmNhbnZhcy52aWV3cG9ydFRyYW5zZm9ybTtcblxuICAgICAgY3R4LnNhdmUoKTtcbiAgICAgIGN0eC50cmFuc2Zvcm0odlswXSwgdlsxXSwgdlsyXSwgdlszXSwgdls0XSwgdls1XSk7XG5cbiAgICAgIHZhciBfa2xhc3NfcHJvdG8gPSBmYWJyaWNbdGhpcy5yZXN1bHRPYmplY3RUeXBlXS5wcm90b3R5cGU7XG5cbiAgICAgIGN0eC5saW5lV2lkdGggPSBfa2xhc3NfcHJvdG8uc3Ryb2tlV2lkdGg7XG4gICAgICBjdHguc3Ryb2tlU3R5bGUgPSBfa2xhc3NfcHJvdG8uc3Ryb2tlO1xuICAgICAgY3R4LmZpbGxTdHlsZSA9IF9rbGFzc19wcm90by5maWxsO1xuXG4gICAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgICBjdHgubW92ZVRvKHRoaXMucG9pbnRzWzBdLngsdGhpcy5wb2ludHNbMF0ueSk7XG4gICAgICBmb3IodmFyIGkgPSAxOyBpIDwgdGhpcy5wb2ludHMubGVuZ3RoOyBpKyspe1xuICAgICAgICBjdHgubGluZVRvKHRoaXMucG9pbnRzW2ldLngsdGhpcy5wb2ludHNbaV0ueSlcbiAgICAgIH1cbiAgICAgIGN0eC5jbG9zZVBhdGgoKTtcbiAgICAgIGN0eC5maWxsKCk7XG4gICAgICBjdHguc3Ryb2tlKCk7XG4gICAgICBjdHgucmVzdG9yZSgpO1xuICAgICAgdGhpcy5jYW52YXMuZmlyZShcImJydXNoOnJlbmRlclwiLHt0YXJnZXQ6IHRoaXN9KVxuICAgIH0sXG4gICAgZHJhd2luZ0xpbWl0czogbnVsbCwgLyp7XG4gICAgICBsZWZ0OiAwLFxuICAgICAgd2lkdGg6IDAsXG4gICAgICBoZWlnaHQ6IDAsXG4gICAgICB0b3A6IDBcbiAgICB9LCovXG4gICAgbWluSGVpZ2h0OiA1MCxcbiAgICBtaW5XaWR0aDogNTAsXG4gICAgX2NoZWNrUmVjdGFuZ2xlOiBmdW5jdGlvbihfcmVjdCl7XG5cblxuICAgICAgdmFyIGRsID0gdGhpcy5kcmF3aW5nTGltaXRzO1xuICAgICAgaWYoZGwgJiYgZGwgPT0gXCJiYWNrZ3JvdW5kSW1hZ2VcIil7XG4gICAgICAgIGRsPSB0aGlzLmNhbnZhcy5iYWNrZ3JvdW5kSW1hZ2U7XG4gICAgICB9XG5cbiAgICAgIF9yZWN0ID0ge1xuICAgICAgICBsZWZ0OiBfcmVjdC5sZWZ0LFxuICAgICAgICB0b3A6IF9yZWN0LnRvcCxcbiAgICAgICAgd2lkdGg6IF9yZWN0LndpZHRoLFxuICAgICAgICBoZWlnaHQ6IF9yZWN0LmhlaWdodCxcbiAgICAgIH07XG5cbiAgICAgIF9yZWN0LmxlZnQgIC09IGZhYnJpYy5SZWN0LnByb3RvdHlwZS5zdHJva2VXaWR0aCAvIDI7XG4gICAgICBfcmVjdC50b3AgICAtPSBmYWJyaWMuUmVjdC5wcm90b3R5cGUuc3Ryb2tlV2lkdGggLyAyO1xuXG4gICAgICBpZihkbCl7XG4gICAgICAgIGlmKF9yZWN0LmxlZnQgKyBfcmVjdC53aWR0aCA8IGRsLmxlZnQgfHxcbiAgICAgICAgICBfcmVjdC50b3AgICsgX3JlY3QuaGVpZ2h0IDwgZGwudG9wIHx8XG4gICAgICAgICAgX3JlY3QubGVmdCA+IGRsLndpZHRoIHx8XG4gICAgICAgICAgX3JlY3QudG9wID4gZGwuaGVpZ2h0KXtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBpZihfcmVjdC50b3AgPCBkbC50b3Ape1xuICAgICAgICAgIF9yZWN0LmhlaWdodCArPV9yZWN0LnRvcCA7XG4gICAgICAgICAgX3JlY3QudG9wID0gZGwudG9wO1xuICAgICAgICB9XG4gICAgICAgIGlmKF9yZWN0LmxlZnQgPCBkbC5sZWZ0KXtcbiAgICAgICAgICBfcmVjdC53aWR0aCArPSBfcmVjdC5sZWZ0O1xuICAgICAgICAgIF9yZWN0LmxlZnQgPSBkbC5sZWZ0O1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmKHRoaXMubWluV2lkdGggJiYgX3JlY3Qud2lkdGggPCB0aGlzLm1pbldpZHRoKXtcbiAgICAgICAgX3JlY3Qud2lkdGggPSB0aGlzLm1pbldpZHRoO1xuICAgICAgfVxuICAgICAgaWYodGhpcy5taW5IZWlnaHQgJiYgX3JlY3QuaGVpZ2h0IDwgdGhpcy5taW5IZWlnaHQpe1xuICAgICAgICBfcmVjdC5oZWlnaHQgPSB0aGlzLm1pbkhlaWdodDtcbiAgICAgIH1cblxuXG4gICAgICBpZihkbCkge1xuICAgICAgICB2YXIgX3hkaWZmID0gX3JlY3QubGVmdCArIF9yZWN0LndpZHRoIC0gZGwud2lkdGg7XG4gICAgICAgIGlmIChfeGRpZmYgPiAwKSB7XG4gICAgICAgICAgX3JlY3Qud2lkdGggLT0gX3hkaWZmO1xuICAgICAgICAgIGlmICh0aGlzLm1pbldpZHRoICYmIF9yZWN0LndpZHRoIDwgdGhpcy5taW5XaWR0aCkge1xuICAgICAgICAgICAgX3JlY3QubGVmdCAtPSB0aGlzLm1pbldpZHRoIC0gX3JlY3Qud2lkdGg7XG4gICAgICAgICAgICBfcmVjdC53aWR0aCA9IHRoaXMubWluV2lkdGg7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHZhciBfeWRpZmYgPSBfcmVjdC50b3AgKyBfcmVjdC5oZWlnaHQgLSBkbC5oZWlnaHQ7XG4gICAgICAgIGlmIChfeWRpZmYgPiAwKSB7XG4gICAgICAgICAgX3JlY3QuaGVpZ2h0IC09IF95ZGlmZjtcbiAgICAgICAgICBpZiAodGhpcy5taW5IZWlnaHQgJiYgX3JlY3QuaGVpZ2h0IDwgdGhpcy5taW5IZWlnaHQpIHtcbiAgICAgICAgICAgIF9yZWN0LnRvcCAtPSB0aGlzLm1pbkhlaWdodCAtIF9yZWN0LmhlaWdodDtcbiAgICAgICAgICAgIF9yZWN0LmhlaWdodCA9IHRoaXMubWluSGVpZ2h0O1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIF9yZWN0O1xuICAgIH0sXG4gICAgcmVzdWx0T2JqZWN0UHJvcGVydGllczoge31cbiAgfSk7XG5cblxuZmFicmljLlNsaWRlQ2FudmFzLnByb3RvdHlwZS5kcmF3aW5nVG9vbHMuUG9seWdvbkJydXNoID0ge1xuICBpY29uOiAnZGF0YTppbWFnZS9wbmc7YmFzZTY0LCcrIHJlcXVpcmUoJ2Jhc2U2NC1sb2FkZXIhLi8uLi9tZWRpYS9wb2x5Z29uLnBuZycpLFxuICB0aXRsZTogJ1BvbHlnb24gQnJ1c2gnXG59O1xuZmFicmljLlNsaWRlQ2FudmFzLnByb3RvdHlwZS5hY3RpdmVEcmF3aW5nVG9vbHMucHVzaChcIlBvbHlnb25CcnVzaFwiKTtcblxuXG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2JydXNoZXMvUG9seWdvbkJydXNoLmpzIiwibW9kdWxlLmV4cG9ydHMgPSBcImlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFFQUFBQUJBQ0FZQUFBQ3FhWEhlQUFBQUJITkNTVlFJQ0FnSWZBaGtpQUFBQUFsd1NGbHpBQUFObEFBQURaUUJFTEQvZkFBQUFCbDBSVmgwVTI5bWRIZGhjbVVBZDNkM0xtbHVhM05qWVhCbExtOXlaNXZ1UEJvQUFBWFBTVVJCVkhpYzVkdC95RjVsR1Fmd3o3VTU1NWFhdHBFb3BrNnlMYmExNkllZ0RDazBDMGtEMndvSkRacjlJYlVnMHpZaSt5TVNRdnRGaGhHMWFPSS9PZi9RTExFZ2NnZ3p6Y3BCYzFDVDJvcXNYTmhxc3puYnJ2NjQ3eGZmUFh1ZjdYbWVjNTd6N3AxZnVEbWNjKzRmMS9XOXIzT2YrMXpYZFNJenZSb1FFZlB4dWN6OC9HSFhYdzBFUk1SQy9BUnpNL090aysvTm1oNlJ1a05FWElndHVIaXEreWMwQVJIeE5rWDVpL3JWT1dFSmlJZ3JzUmxuNFlsKzlVNUlBaUxpZXZ3WXArSmIrRmkvdWljY0FSR3hEaHN4UjFuMTErSlF2L29uZFNYWXVCRVJzL0FOck1YL2NHTm1ianhXdXhPQ2dJaVlpM3V4Q3Z1d0tqTWZHYVR0akNjZ0lzN0FnN2dNeitPcXpIeHEwUFl6bW9DSU9CZVBZQ21leGZzeWM4Y3dmUnl4Q0ViRTRvaDRiVHNpamc4UnNSU1BLOHIvR3BjT3F6eFRXOERWdURNaS9veHQrRjB0Mi9CTVpyNDRzdFF0SVNJdVU4eitEUHhVZWViM2p0UlpaaDVXY0JyK2haeWlITVFPUElEYmNSMlc0K1RlZnNaVmxJVnVmNVhuSHN3Wm9NMlNXdi9wSSs3MWFmRGwydUFwM0l3TnltN3FQMzJJZVJuUDRENThBUi9FWXN4dVdmbTFkUkt5eWhnRHRodWFnTFB4RWc3ZzNFblhBNHZ3ZnF4WFhqMi9uVFFqdldVL25xNzExdGQyaXdZVnZHZmNpVWs1aUxWRHRoK09nTnBvUTIzMGxRRUdtRjFuL05wcUFmY3BhOGJMZllqWld5M3ErOVhDcnNRNWZmcWVVMDE5Z3REVkkxaE9Yd0w2K2dNaTRzMVZpYjE0UTJidW1iTGlVUkFSSjFkaWxtSlpMVXR4b2FtMzRTOTRaZUhkcGp4VzZ5cEJlL0NCek53OGdoeExzQjFiczhjZmNDem1mcVF3dDc3bFoza2UzbzRiY0FjZXhrNVRXMHZpTDFqZVlMemhMYUF5dHhLUDRUbGNrSmtIaG1WL0dFVEU2WXFGVExhWWViZ3VNM2MxNkhjMEM2amtQSzZ3dDZaTksraXlPSW9GRFBJNWZFYzkzaElSTWVvc0hLOFloSUFIOFh1RnhhdkhLMDczT0NZQm1Ya0lYNjJudDQ1WG5PNHhxRWZvSHZ3ZEt5UGlrakhLMHprR0lpQXo5K091ZXZyWjhZblRQWWJ4Q2Q2dGJJcXVpWWczalVtZXpqRXdBWm41QXI1WDI5d3lOb2s2eHJCZTRhOHJEc2NiSXVLc01jalRPWVlpb083R2ZvaTUrTlJZSk9vWW84UUY3cXpIbXlMaTFEYUZtUTRNVFVCbWJzWFBjQ1p1YkYyaWpqRnFaR2hpZS96cGlKalJudVdSQ01qTW4rTTNPQThmYmxXaWp0RWtOaml4RnN6bzdYRVRBamJoVDFoUlE5RXpFaU1Ua0prSDhiVjZPbU8zeDAzRDR4dndUMXhlc3pGbUhCb1JrQ1ZLZEhjOW5aRnJRUnNKRW5maHYxZ2RFUmUwMEYrbmFFeEFaajZQSHlpeGdadWI5amNtTE9wN3B5V240eHVWaU0wK0xEZ09uS0J6Y0FXK2lUOTZ4YjArZUdSb2hFRTMxVUZ1bXlhbFg0ZVBLQjlyZXh3ZVYvaUQ0dGE3ZEp3RVhGd0grd2ZtZGFUMFJmZ01IbFUrMHlkSHNSOVRYczlManRwSHl3STlXZ1c0YVV3S3o4Wks1VnRrZTg4cy94djNLOUdtaFFQMzJiS0FWMDB5dVZrdDlYbWFraE93RWJ0N2xONnA1QUcrMTRnNUNtMFRFRXBnTTVXc2pWSDdPUStmVVBKL1hwcWs4Q0U4aWR1d29oV1oyeVNnQ3YvUkt1d1RReEwzVG54UnlTZVlQTXN2NGlGOEhHZTNMbStMaWkvR0dzVnhPaUg4N1ZqV3AvNDhKV0hpTy9ocmo5TFA0YnU0QnZQYlZycFZBcXJpOTFmejdCZmUvaVhlb2lRdXIxSENiZnQ2Nm16RmwrcmJaS2dNa2lhbDBROFROVDZ3QlF1VWJKQmY0UmRLYnRGeXZCdVg0QlRsMVRTcm1qc2wvV2F6a29Qd1VHYnVIRm1RSm1nNCt4TUwzcjE0VFo4NmM1VWMzb21aM29UVk9MMnJXUjdMSTZEc3J4TzdER0N5U2s1UTRvcnBWbnB5YWZJeE5CRVkyWldEUFVmUDF1T1pEY1pzSHcwczRDUWxvZktnWTh3cTNxSEVGUS9oL09tZTlWWWVnYXJZSnhXelBxQ2t2RjJ2NWhYaTlmZ1F2bDJWSHlqbGJrWVJVQlc5MVpHSmtuOHo5V3Z4WGRPdGNHOXA1Yi9CaURoSGNZYThSL0VOekZkOGhVOHFpOS9DYWkzYk1uTlo0d0ZiUk9zL1R0WkVxZ1dadWJ2bjJnNGxRZkw4YkpEeTFqWmEvMmtxQzNiM1hsTjJnN0NpN1RHYllEcitHanRsR3Nic2kwNElxUC8xWEY1UHQzY3g1cURveWdMV0tSdW5MVW9TOUhHRHJnallvNFRSVm1YYnEyNUQvQjlQTGZvM0VNRVppd0FBQUFCSlJVNUVya0pnZ2c9PVwiXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi4vbm9kZV9tb2R1bGVzL2Jhc2U2NC1sb2FkZXIhLi9tZWRpYS9wb2x5Z29uLnBuZ1xuLy8gbW9kdWxlIGlkID0gNjlcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiJ3VzZSBzdHJpY3QnO1xuXG5cbiAgLyoqXG4gICAqIFBlbmNpbEJydXNoIGNsYXNzXG4gICAqIEBjbGFzcyBmYWJyaWMuUGVuY2lsQnJ1c2hcbiAgICogQGV4dGVuZHMgZmFicmljLkJhc2VCcnVzaFxuICAgKi9cbiAgZmFicmljLlBhaW50UGVuQnJ1c2ggPSBmYWJyaWMudXRpbC5jcmVhdGVDbGFzcyhmYWJyaWMuQmFzZUJydXNoLCAvKiogQGxlbmRzIGZhYnJpYy5QZW5jaWxCcnVzaC5wcm90b3R5cGUgKi8ge1xuICAgIHR5cGU6ICdwYWludC1wZW4tYnJ1c2gnLFxuXG4gICAgLyoqXG4gICAgICogQ29uc3RydWN0b3JcbiAgICAgKiBAcGFyYW0ge2ZhYnJpYy5DYW52YXN9IGNhbnZhc1xuICAgICAqIEByZXR1cm4ge2ZhYnJpYy5QZW5jaWxCcnVzaH0gSW5zdGFuY2Ugb2YgYSBwZW5jaWwgYnJ1c2hcbiAgICAgKi9cbiAgICBpbml0aWFsaXplOiBmdW5jdGlvbihjYW52YXMpIHtcbiAgICAgIHRoaXMuY2FsbFN1cGVyKCdpbml0aWFsaXplJywgY2FudmFzKTtcbiAgICAgIHRoaXMuX3BvaW50cyA9IFtdO1xuICAgIH0sXG4gICAgZ2V0VGFyZ2V0OiBmdW5jdGlvbigpe1xuICAgICAgcmV0dXJuIHRoaXMuY2FudmFzLmRyYXdpbmdDb250ZXh0O1xuICAgIH0sXG4gICAgLyoqXG4gICAgICogSW5vdm9rZWQgb24gbW91c2UgZG93blxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBwb2ludGVyXG4gICAgICovXG4gICAgb25Nb3VzZURvd246IGZ1bmN0aW9uKHBvaW50ZXIpIHtcbiAgICAgIHRoaXMuX3Jlc2V0KCk7XG4gICAgICB0aGlzLl9maWxsKHBvaW50ZXIpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBJbm92b2tlZCBvbiBtb3VzZSBtb3ZlXG4gICAgICogQHBhcmFtIHtPYmplY3R9IHBvaW50ZXJcbiAgICAgKi9cbiAgICBvbk1vdXNlTW92ZTogZnVuY3Rpb24ocG9pbnRlcikge1xuICAgICAgdGhpcy5fZmlsbChwb2ludGVyKTtcbiAgICB9LFxuICAgIC8qKlxuICAgICAqIEludm9rZWQgb24gbW91c2UgdXBcbiAgICAgKi9cbiAgICBvbk1vdXNlVXA6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5jYW52YXMuZmlyZShcImRyYXc6YWZ0ZXJcIix7XG4gICAgICAgIHRhcmdldDogdGhpcy5nZXRUYXJnZXQoKSAsXG4gICAgICAgIHBvaW50czogdGhpcy5fcG9pbnRzLnNsaWNlKCkgLFxuICAgICAgICBjb2xvcjogdGhpcy5nZXRDb2xvcignc291cmNlJylcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgX2ZpbGw6IGZ1bmN0aW9uKHBvaW50ZXIpe1xuICAgICAgcG9pbnRlciA9IHtcbiAgICAgICAgeDogTWF0aC5mbG9vcihwb2ludGVyLngpLFxuICAgICAgICB5OiBNYXRoLmZsb29yKHBvaW50ZXIueSlcbiAgICAgIH07XG5cbiAgICAgIGlmKF8uZmluZFdoZXJlKHRoaXMuX3BvaW50cyxwb2ludGVyKSl7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgLy8gdGhpcy5nZXRUYXJnZXQoKS5maWxsUmVjdChwb2ludGVyLnggLCBwb2ludGVyLnkgICwxLDEpO1xuICAgICAgdmFyIF9kYXRhID0gdGhpcy5nZXRUYXJnZXQoKS5nZXRJbWFnZURhdGEocG9pbnRlci54ICwgcG9pbnRlci55ICAsMSwxKTtcbiAgICAgIHBvaW50ZXIuY29sb3IgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChfZGF0YS5kYXRhKTtcbiAgICAgIHRoaXMuX3BvaW50cy5wdXNoKHBvaW50ZXIpO1xuICAgICAgdmFyIF9jb2xvciA9IHRoaXMuZ2V0Q29sb3IoJ3NvdXJjZScpO1xuXG5cblxuXG4gICAgICBfZGF0YS5kYXRhWzBdID0gX2NvbG9yWzBdO1xuICAgICAgX2RhdGEuZGF0YVsxXSA9IF9jb2xvclsxXTtcbiAgICAgIF9kYXRhLmRhdGFbMl0gPSBfY29sb3JbMl07XG4gICAgICBfZGF0YS5kYXRhWzNdID0gX2NvbG9yWzNdO1xuXG4gICAgICB0aGlzLmdldFRhcmdldCgpLnB1dEltYWdlRGF0YShfZGF0YSwgcG9pbnRlci54ICwgcG9pbnRlci55KTtcbiAgICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgIH0sXG4gICAgdW5kb1BhaW50QWN0aW9uOiBmdW5jdGlvbihfYWN0aW9uKXtcbiAgICAgIHZhciBjdHggPSBfYWN0aW9uLm9iamVjdDtcbiAgICAgIGZvcih2YXIgaSBpbiBfYWN0aW9uLnBvaW50cyl7XG4gICAgICAgIHZhciBfcCAgPV9hY3Rpb24ucG9pbnRzW2ldLCBfYyA9IF9hY3Rpb24uYnJ1c2guZ2V0QWN0aW9uQ29sb3IoX3AuY29sb3IpO1xuICAgICAgICBpZihfY1szXSA9PSAwKSB7XG4gICAgICAgICAgY3R4LmNsZWFyUmVjdChfcC54LF9wLnkgICwxLDEpO1xuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICBjdHguZmlsbFN0eWxlID0gXCJyZ2JhKFwiICsgX2NbMF0gKyBcIixcIiArIF9jWzFdICsgXCIsXCIgKyBfY1syXSArIFwiLFwiICsgX2NbM10gKyAgXCIpXCI7XG4gICAgICAgICAgY3R4LmZpbGxSZWN0KF9wLngsX3AueSAgLDEsMSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIF9hY3Rpb24uY2FudmFzLnJlbmRlckFsbCgpO1xuICAgIH0sXG4gICAgcmVkb1BhaW50QWN0aW9uOiBmdW5jdGlvbihfYWN0aW9uKXtcblxuICAgICAgdmFyIGN0eCA9IF9hY3Rpb24ub2JqZWN0LCBfYyA9IF9hY3Rpb24uYnJ1c2guZ2V0QWN0aW9uQ29sb3IoX2FjdGlvbi5jb2xvcik7XG4gICAgICB2YXIgcHRzID0gX2FjdGlvbi5wb2ludHM7XG4gICAgICBpZihfY1szXSA9PSAwKSB7XG4gICAgICAgIGZvcih2YXIgaSBpbiBwdHMpe1xuICAgICAgICAgIGN0eC5jbGVhclJlY3QocHRzW2ldLngscHRzW2ldLnkgICwxLDEpO1xuICAgICAgICB9XG4gICAgICB9ZWxzZXtcbiAgICAgICAgY3R4LmZpbGxTdHlsZSA9IFwicmdiYShcIiArIF9jWzBdICsgXCIsXCIgKyBfY1sxXSArIFwiLFwiICsgX2NbMl0gKyBcIixcIiArIF9jWzNdICsgXCIpXCI7XG4gICAgICAgIGZvcih2YXIgaSBpbiBwdHMpe1xuICAgICAgICAgIGN0eC5maWxsUmVjdChwdHNbaV0ueCxwdHNbaV0ueSAsMSwxKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgX2FjdGlvbi5jYW52YXMucmVuZGVyQWxsKCk7XG4gICAgfSxcbiAgICAvKipcbiAgICAgKiBDbGVhciBwb2ludHMgYXJyYXkgYW5kIHNldCBjb250ZXh0VG9wIGNhbnZhcyBzdHlsZS5cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9yZXNldDogZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLl9wb2ludHMubGVuZ3RoID0gMDtcbiAgICAgIHRoaXMuZ2V0VGFyZ2V0KCkuZmlsbFN0eWxlID0gdGhpcy5jb2xvcjtcbiAgICB9LFxuICAgIGdldEhpc3RvcnlSZWNvcmQ6IGZ1bmN0aW9uKGV2ZW50KXtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgY2FudmFzOiAgIHRoaXMuY2FudmFzLFxuICAgICAgICB0eXBlOiAgICAgXCJkcmF3OnBlblwiLFxuICAgICAgICBvYmplY3Q6ICAgZXZlbnQudGFyZ2V0ICxcbiAgICAgICAgcG9pbnRzOiAgIGV2ZW50LnBvaW50cyAsXG4gICAgICAgIGJydXNoOiAgIHRoaXMsXG4gICAgICAgIGNvbG9yOiAgICBldmVudC5jb2xvcixcbiAgICAgICAgdW5kbzogICAgIHRoaXMudW5kb1BhaW50QWN0aW9uLFxuICAgICAgICByZWRvOiAgICAgdGhpcy5yZWRvUGFpbnRBY3Rpb25cbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuXG5mYWJyaWMuU2xpZGVDYW52YXMucHJvdG90eXBlLmRyYXdpbmdUb29scy5QYWludFBlbkJydXNoID0ge1xuICBjbGFzc05hbWU6ICdmYSBmYS1wYWludC1icnVzaCcsXG4gIHRpdGxlOiAnUGVuIEJydXNoJ1xufTtcbmZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUuYWN0aXZlRHJhd2luZ1Rvb2xzLnB1c2goXCJQYWludFBlbkJydXNoXCIpO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9icnVzaGVzL1BhaW50UGVuQnJ1c2guanMiLCIndXNlIHN0cmljdCc7XG5cblxuZmFicmljLk1hZ2ljV2FuZCA9IHJlcXVpcmUoJy4uL3BsdWdpbnMvbWFnaWN3YW5kJyk7XG5cbiAgLyoqXG4gICAqIFBlbmNpbEJydXNoIGNsYXNzXG4gICAqIEBjbGFzcyBmYWJyaWMuUGVuY2lsQnJ1c2hcbiAgICogQGV4dGVuZHMgZmFicmljLkJhc2VCcnVzaFxuICAgKi9cbiAgZmFicmljLlBhaW50QnVja2V0QnJ1c2ggPSBmYWJyaWMudXRpbC5jcmVhdGVDbGFzcyhmYWJyaWMuQmFzZUJydXNoLCAvKiogQGxlbmRzIGZhYnJpYy5QZW5jaWxCcnVzaC5wcm90b3R5cGUgKi8ge1xuICAgIHR5cGU6ICdwYWludC1idWNrZXQtYnJ1c2gnLFxuICAgIC8qKlxuICAgICAqIENvbnN0cnVjdG9yXG4gICAgICogQHBhcmFtIHtmYWJyaWMuQ2FudmFzfSBjYW52YXNcbiAgICAgKiBAcmV0dXJuIHtmYWJyaWMuUGVuY2lsQnJ1c2h9IEluc3RhbmNlIG9mIGEgcGVuY2lsIGJydXNoXG4gICAgICovXG4gICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oY2FudmFzKSB7XG4gICAgICB0aGlzLmNhbGxTdXBlcignaW5pdGlhbGl6ZScsIGNhbnZhcyk7XG4gICAgICB0aGlzLl9wb2ludHMgPSBbXTtcbiAgICB9LFxuICAgIGdldFRhcmdldDogZnVuY3Rpb24oKXtcbiAgICAgIHJldHVybiB0aGlzLmNhbnZhcy5kcmF3aW5nQ29udGV4dDtcbiAgICB9LFxuICAgIG9uTW91c2VVcDogZnVuY3Rpb24oKSB7fSxcbiAgICBvbk1vdXNlTW92ZTogZnVuY3Rpb24oKSB7fSxcbiAgICBvbk1vdXNlRG93bjogZnVuY3Rpb24ocG9pbnRlcikge1xuICAgICAgdGhpcy5fZmlsbChwb2ludGVyKTtcbiAgICB9LFxuICAgIF9maWxsOiBmdW5jdGlvbihwb2ludGVyKXtcbiAgICAgIHBvaW50ZXIgPSB7XG4gICAgICAgIHg6IE1hdGguZmxvb3IocG9pbnRlci54KSxcbiAgICAgICAgeTogTWF0aC5mbG9vcihwb2ludGVyLnkpXG4gICAgICB9O1xuXG4gICAgICB2YXIgaW5mbyA9IHRoaXMuZ2V0VGFyZ2V0KCkuZ2V0SW1hZ2VEYXRhKDAsMCx0aGlzLmdldFRhcmdldCgpLmNhbnZhcy53aWR0aCx0aGlzLmdldFRhcmdldCgpLmNhbnZhcy5oZWlnaHQpO1xuXG4gICAgICBmYWJyaWMuTWFnaWNXYW5kLmZsb29kRmlsbChpbmZvLCBwb2ludGVyLnggLCBwb2ludGVyLnksIDEse30sbnVsbCxmdW5jdGlvbihtYXNrKXtcbiAgICAgICAgdmFyIF9jb2xvciA9IHRoaXMuZ2V0Q29sb3IoJ3NvdXJjZScpO1xuICAgICAgICB2YXIgX3RhcmdldCA9IHRoaXMuZ2V0VGFyZ2V0KCk7XG4gICAgICAgIHZhciBfdyA9IG1hc2suYm91bmRzLm1heFggLSBtYXNrLmJvdW5kcy5taW5YICsgMSwgX2ggPSBtYXNrLmJvdW5kcy5tYXhZIC0gbWFzay5ib3VuZHMubWluWSArIDE7XG4gICAgICAgIHZhciBvbGRJbWFnZURhdGEgPSBfdGFyZ2V0LmdldEltYWdlRGF0YSggbWFzay5ib3VuZHMubWluWCxtYXNrLmJvdW5kcy5taW5ZLF93LCBfaCk7XG5cbiAgICAgICAgbWFzay5yZW5kZXIoX3RhcmdldCx7XG4gICAgICAgICAgaW50ZXJzZWN0aW9uQ29sb3IgOiBfY29sb3IsXG4gICAgICAgICAgZmlsbCA6IF9jb2xvcixcbiAgICAgICAgICBjYWNoZTogZmFsc2UsXG4gICAgICAgICAgbGVmdCA6IG1hc2suYm91bmRzLm1pblgsXG4gICAgICAgICAgdG9wIDogbWFzay5ib3VuZHMubWluWVxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmNhbnZhcy5maXJlKFwiZHJhdzphZnRlclwiLHtcbiAgICAgICAgICB0YXJnZXQ6IHRoaXMuZ2V0VGFyZ2V0KCkgLFxuICAgICAgICAgIHJlZG86IF90YXJnZXQuZ2V0SW1hZ2VEYXRhKCBtYXNrLmJvdW5kcy5taW5YLG1hc2suYm91bmRzLm1pblksX3csIF9oKSxcbiAgICAgICAgICB1bmRvOiBvbGRJbWFnZURhdGEgLFxuICAgICAgICAgIGxlZnQgOiBtYXNrLmJvdW5kcy5taW5YLFxuICAgICAgICAgIHRvcCA6IG1hc2suYm91bmRzLm1pblksXG4gICAgICAgICAgY29sb3I6IHRoaXMuZ2V0Q29sb3IoKS5zbGljZSgpXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICB9LFxuICAgIGdldEhpc3RvcnlSZWNvcmQ6IGZ1bmN0aW9uKGV2ZW50KSB7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGNhbnZhczogICB0aGlzLmNhbnZhcyxcbiAgICAgICAgb2JqZWN0OiAgIGV2ZW50LnRhcmdldCAsXG4gICAgICAgIHR5cGU6ICAgICBcImRyYXc6YnVja2V0XCIsXG4gICAgICAgIGxlZnQ6ICAgICBldmVudC5sZWZ0ICxcbiAgICAgICAgdG9wOiAgICAgIGV2ZW50LnRvcCAsXG4gICAgICAgIHVuZG9EYXRhOiBldmVudC51bmRvLFxuICAgICAgICByZWRvRGF0YTogZXZlbnQucmVkbyxcbiAgICAgICAgY29sb3I6ICAgIHRoaXMuY29udmVydENvbG9yKGV2ZW50LmNvbG9yLFwic291cmNlXCIgICksXG4gICAgICAgIHVuZG86IGZ1bmN0aW9uKF9hY3Rpb24pe1xuICAgICAgICAgIF9hY3Rpb24ub2JqZWN0LnB1dEltYWdlRGF0YShfYWN0aW9uLnVuZG9EYXRhLCBfYWN0aW9uLmxlZnQsX2FjdGlvbi50b3ApO1xuICAgICAgICAgIF9hY3Rpb24uY2FudmFzLnJlbmRlckFsbCgpO1xuICAgICAgICB9LFxuICAgICAgICByZWRvOiBmdW5jdGlvbihfYWN0aW9uKXtcbiAgICAgICAgICBfYWN0aW9uLm9iamVjdC5wdXRJbWFnZURhdGEoX2FjdGlvbi5yZWRvRGF0YSwgX2FjdGlvbi5sZWZ0LF9hY3Rpb24udG9wKTtcbiAgICAgICAgICBfYWN0aW9uLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSk7XG5cbmZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUuZHJhd2luZ1Rvb2xzLlBhaW50QnVja2V0QnJ1c2ggPSB7XG4gIGljb246ICAnZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCwnICsgcmVxdWlyZSgnYmFzZTY0LWxvYWRlciEuLy4uL21lZGlhL3BhaW50LWJ1Y2tldC5zdmcnKSxcbiAgdGl0bGU6ICdCdWNrZXQgQnJ1c2gnXG59O1xuZmFicmljLlNsaWRlQ2FudmFzLnByb3RvdHlwZS5hY3RpdmVEcmF3aW5nVG9vbHMucHVzaChcIlBhaW50QnVja2V0QnJ1c2hcIik7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2JydXNoZXMvUGFpbnRCdWNrZXRCcnVzaC5qcyIsIm1vZHVsZS5leHBvcnRzID0gXCJQSE4yWnlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpSUhkcFpIUm9QU0l5TkNJZ2FHVnBaMmgwUFNJeU5DSWdkbWxsZDBKdmVEMGlNQ0F3SURJMElESTBJajQ4Y0dGMGFDQmtQU0pOTWpFdU1UUXpJRGt1TmpZM1l5MHVOek16TFRFdU16a3lMVEV1T1RFMExUTXVNRFV0TXk0Mk1UY3ROQzQzTlRNdE1pNDVOemN0TWk0NU56Z3ROUzQwTnpndE15NDVNVFF0Tmk0M09EVXRNeTQ1TVRRdExqUXhOQ0F3TFM0M01EZ3VNRGswTFM0NE5pNHlORFpzTFRFdU16WXhJREV1TXpaakxURXVPRGs1TFM0eU16WXRNeTQwTWk0eE1EWXROQzR5T1RRdU9UZ3pMUzQ0TnpZdU9EYzFMVEV1TVRZMElESXVNVFU1TFM0M09USWdNeTQxTWpNdU5Ea3lJREV1T0RBMklESXVNekExSURRdU1EUTVJRFV1T1RBMUlEVXVNemMxTGpBek9DNHpNak11TVRVM0xqWXpPQzQwTURVdU9EZzFMalU0T0M0MU9EZ2dNUzQxTXpVdU5UZzJJREl1TVRJeElEQnpMalU0T0MweExqVXpNeTR3TURJdE1pNHhNVGxqTFM0MU9EZ3RMalU0TnkweExqVXpOeTB1TlRnNExUSXVNVEl6TFM0d01ERnNMUzR4Tnk0eU5UWmpMVEl1TURNeExTNDNOalV0TXk0ek9UVXRNUzQ0TWpndE5DNHlNekl0TWk0NWJETXVPRGM1TFRNdU9EYzFZeTQwT1RZZ01pNDNNeUEyTGpRek1pQTRMalkzTmlBNUxqRTNPQ0E1TGpFM09Hd3ROeTR4TVRVZ055NHhNRGRqTFM0eU16UXVNVFV6TFRJdU56azRMUzR6TVRZdE5pNHhOVFl0TXk0Mk56VXRNeTR6T1RNdE15NHpPVE10TXk0eE56VXROUzR5TnpFdE15NHdNamN0TlM0ME9UaHNNUzQ0TlRrdE1TNDROVFpqTFM0ME16a3RMak0xT1MwdU9USTFMVEV1TVRBekxURXVNVFF4TFRFdU5qZzViQzB5TGpFek5DQXlMakV6TVdNdExqUTBOUzQwTkRZdExqWTROU0F4TGpBMk5DMHVOamcxSURFdU9ESWdNQ0F4TGpZek5DQXhMakV5TVNBekxqa3hOU0F6TGpjeE15QTJMalV3TmlBeUxqYzJOQ0F5TGpjMk5DQTFMalU0SURRdU1qUXpJRGN1TkRNeUlEUXVNalF6TGpZME9DQXdJREV1TVRndExqRTVOU0F4TGpVME55MHVOVFl5YkRndU1EZzJMVGd1TURjNFl5NDVNUzQ0TnpRdExqYzNPQ0F6TGpVek9DMHVOemM0SURRdU5qUTRJREFnTVM0eE1EUXVPRGsySURFdU9UazVJRElnTVM0NU9Ua2dNUzR4TURVZ01DQXlMUzQ0T1RZZ01pMHlJREF0TXk0eE9EUXRNUzQwTWpVdE5pNDRNUzB5TGpnMU55MDVMak0wZW0wdE1UWXVNakE1TFRVdU16Y3hZeTQxTWpjdExqVXpJREV1TkRjeExTNDNPVEVnTWk0Mk5UWXRMamMyTVd3dE15NHlNRGtnTXk0eU1EWmpMUzR5TXpZdExqazNPQzB1TURRNUxURXVPRFExTGpVMU15MHlMalEwTlhwdE9TNHlPVElnTkM0d056bHNMUzR3TXkwdU1ESTVZeTB4TGpJNU1pMHhMakk1TWkwekxqZ3dNeTAwTGpNMU5pMHpMakE1TmkwMUxqQTJNeTQzTVRVdExqY3hOU0F6TGpRNE9DQXhMalV5TVNBMUxqQTJNaUF6TGpBNU5pNDROakl1T0RZeUlESXVNRGc0SURJdU1qUTNJREl1T1RNM0lETXVORFU0TFRFdU56RTNMVEV1TURjMExUTXVORGt4TFRFdU5EWTVMVFF1T0RjekxURXVORFl5ZWlJdlBqd3ZjM1puUGc9PVwiXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi4vbm9kZV9tb2R1bGVzL2Jhc2U2NC1sb2FkZXIhLi9tZWRpYS9wYWludC1idWNrZXQuc3ZnXG4vLyBtb2R1bGUgaWQgPSA3MlxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCIndXNlIHN0cmljdCc7XG5cbmZhYnJpYy5Qb2ludHNCcnVzaCA9IGZhYnJpYy51dGlsLmNyZWF0ZUNsYXNzKGZhYnJpYy5CYXNlQnJ1c2gsIHtcbiAgdHlwZTogXCJwb2ludHMtYnJ1c2hcIixcbiAgbWF4aW11bVBvaW50cyA6IDAsXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uIChjYW52YXMpIHtcbiAgICB0aGlzLmNhbGxTdXBlcignaW5pdGlhbGl6ZScsIGNhbnZhcyk7XG4gICAgdGhpcy5yZXNldCgpO1xuICB9LFxuICBjdXJyZW50UG9pbnQgOiAxLFxuICBnZXRQb2ludHM6IGZ1bmN0aW9uKCl7XG4gICAgcmV0dXJuIGZhYnJpYy51dGlsLm9iamVjdC53aGVyZSh0aGlzLmNhbnZhcy5fb2JqZWN0cyx7dHlwZTogXCJtYXRlcmlhbC1wb2ludFwifSk7XG4gIH0sXG4gIGNoZWNrUG9zaXRpb246IG51bGwsXG4gIG9uTW91c2VEb3duOiBmdW5jdGlvbiAocG9pbnRlcikge1xuXG4gIH0sXG4gIG9uTW91c2VNb3ZlOiBmdW5jdGlvbiAocG9pbnRlcikge1xuICB9LFxuICByZXNldDogZnVuY3Rpb24oKXtcbiAgfSxcbiAgb25Nb3VzZVVwOiBmdW5jdGlvbiAocG9pbnRlcikge1xuICAgIHZhciBfcG9pbnRzID0gdGhpcy5nZXRQb2ludHMoKTtcblxuICAgIHZhciBwb3MgPSB7XG4gICAgICBsZWZ0OiBwb2ludGVyLnggLTAuNSxcbiAgICAgIHRvcDogcG9pbnRlci55ICAtMC41LFxuICAgIH07XG5cbiAgICB2YXIgX2NvcnJlY3QgPSB0aGlzLmNoZWNrUG9zaXRpb24gPyB0aGlzLmNoZWNrUG9zaXRpb24ocG9pbnRlcikgOiB0cnVlIDtcblxuICAgIGlmKCFfY29ycmVjdCl7XG4gICAgICB0aGlzLmNhbnZhcy5maXJlKFwicG9pbnQ6cmVqZWN0ZWRcIix7cG9pbnQgOiBwb2ludGVyfSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYodGhpcy5tYXhpbXVtUG9pbnRzICYmIF9wb2ludHMubGVuZ3RoID49IHRoaXMubWF4aW11bVBvaW50cyl7XG4gICAgICBpZih0aGlzLmN1cnJlbnRQb2ludCA+IHRoaXMubWF4aW11bVBvaW50cyl7XG4gICAgICAgIHRoaXMuY3VycmVudFBvaW50ID0gMTtcbiAgICAgIH1cbiAgICAgIGlmKHRoaXMud2hvbGVDb29yZGluYXRlcyl7XG4gICAgICAgIHBvaW50ZXIueCA9IE1hdGgucm91bmQocG9pbnRlci54KSArIDAuNTtcbiAgICAgICAgcG9pbnRlci55ID0gTWF0aC5yb3VuZChwb2ludGVyLnkpICArIDAuNTtcbiAgICAgIH1cblxuICAgICAgdmFyIF9vYmogPSBmYWJyaWMudXRpbC5vYmplY3QuZmluZFdoZXJlKF9wb2ludHMse251bWJlciA6IHRoaXMuY3VycmVudFBvaW50Kyt9KTtcblxuICAgICAgdmFyIHN0YXRlcyA9IHtcbiAgICAgICAgb3JpZ2luYWwgOiB7XG4gICAgICAgICAgbGVmdDogX29iai5sZWZ0LFxuICAgICAgICAgIHRvcDogX29iai50b3BcbiAgICAgICAgfSxcbiAgICAgICAgbW9kaWZpZWQ6ICB7XG4gICAgICAgICAgbGVmdDogcG9pbnRlci54IC0gMC41LFxuICAgICAgICAgIHRvcDogcG9pbnRlci55IC0gMC41XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIF9vYmouc2V0KHN0YXRlcy5tb2RpZmllZCkuc2V0Q29vcmRzKCkuZmlyZShcIm1vZGlmaWVkXCIse3N0YXRlczogc3RhdGVzfSk7XG4gICAgICB0aGlzLmNhbnZhcy5maXJlKFwib2JqZWN0Om1vZGlmaWVkXCIse3RhcmdldCA6IF9vYmosIHN0YXRlczogc3RhdGVzfSk7XG4gICAgICB0aGlzLmNhbnZhcy5zZXRBY3RpdmVPYmplY3QoX29iaik7XG4gICAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICAgIHJldHVybjtcbiAgICB9ZWxzZXtcbiAgICAgIHRoaXMuY3VycmVudFBvaW50ID0gMTtcbiAgICAgIHdoaWxlKGZhYnJpYy51dGlsLm9iamVjdC5maW5kV2hlcmUoX3BvaW50cyx7bnVtYmVyIDogdGhpcy5jdXJyZW50UG9pbnR9KSl7XG4gICAgICAgIHRoaXMuY3VycmVudFBvaW50Kys7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdmFyIF9vYmogPSBuZXcgZmFicmljLk1hdGVyaWFsUG9pbnQoe1xuICAgICAgbnVtYmVyOiB0aGlzLmN1cnJlbnRQb2ludCAsXG4gICAgICBhcHBsaWNhdGlvbjogdGhpcy5jYW52YXMuYXBwbGljYXRpb24sXG4gICAgICBsZWZ0OiBwb3MubGVmdCxcbiAgICAgIHRvcDogcG9zLnRvcFxuICAgIH0pO1xuXG4gICAgdGhpcy5jdXJyZW50UG9pbnQrKztcbiAgICB0aGlzLmNhbnZhcy5hZGQoX29iaik7XG4gICAgdGhpcy5jYW52YXMuZmlyZShcInBvaW50OmNyZWF0ZWRcIix7cG9pbnQgOiBfb2JqfSlcbiAgICB0aGlzLmNhbnZhcy5zZXRBY3RpdmVPYmplY3QoX29iaik7XG4gICAgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gIH0sXG4gIF9yZW5kZXI6IGZ1bmN0aW9uICgpIHtcbiAgfVxufSk7XG5cbmZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUuZHJhd2luZ1Rvb2xzLlBvaW50c0JydXNoID0ge1xuICBjbGFzc05hbWU6ICdmYSBmYS1jaXJjbGUtbycsXG4gIHRpdGxlOiAnUG9pbnRzIEJydXNoJ1xufTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvYnJ1c2hlcy9Qb2ludHNCcnVzaC5qcyIsIid1c2Ugc3RyaWN0JztcblxudmFyIHBhdGhfaW5pdGlhbGl6ZV9vdmVyd3JpdHRlbiA9IGZhYnJpYy5QYXRoLnByb3RvdHlwZS5pbml0aWFsaXplO1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5QYXRoLnByb3RvdHlwZSwge1xuICBhY2N1cmFjeTogLTEsXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uIChwYXRoLCBvcHRpb25zKSB7XG4gICAgdGhpcy5jYWxsU3VwZXIoJ2luaXRpYWxpemUnLCBvcHRpb25zKTtcbiAgICBwYXRoX2luaXRpYWxpemVfb3ZlcndyaXR0ZW4uY2FsbCh0aGlzLCBwYXRoLCBvcHRpb25zKTtcblxuICAgIGlmKHRoaXMuYWNjdXJhY3kgIT0gLTEpe1xuICAgICAgdGhpcy5fc2V0X2FjY3VyYWN5KHRoaXMuYWNjdXJhY3ksIHRoaXMucGF0aCk7XG4gICAgfVxuICB9LFxuICB0cmFuc2xhdGU6IGZ1bmN0aW9uIChwYXRoLCB0cmFuc2xhdGVYLCB0cmFuc2xhdGVZKSB7XG4gICAgdmFyIGN1cnJlbnQ7XG4gICAgLy9pZih0aGlzLnBhdGhbMF1bMF0gPT09IFwibVwiKXtcbiAgICAvLyAgcmV0dXJuO1xuICAgIC8vfVxuICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBwYXRoLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7XG5cbiAgICAgIGN1cnJlbnQgPSBwYXRoW2ldO1xuXG4gICAgICBzd2l0Y2ggKGN1cnJlbnRbMF0pIHsgLy8gZmlyc3QgbGV0dGVyXG4gICAgICAgIGNhc2UgJ0wnOiAvLyBsaW5ldG8sIGFic29sdXRlXG4gICAgICAgICAgY3VycmVudFsxXSArPSB0cmFuc2xhdGVYO1xuICAgICAgICAgIGN1cnJlbnRbMl0gKz0gdHJhbnNsYXRlWTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnSCc6XG4gICAgICAgICAgY3VycmVudFsxXSArPSB0cmFuc2xhdGVYO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdWJzogLy8gdmVyaWNhbCBsaW5ldG8sIGFic29sdXRlXG4gICAgICAgICAgY3VycmVudFsxXSArPSB0cmFuc2xhdGVZO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdNJzpcbiAgICAgICAgICBjdXJyZW50WzFdICs9IHRyYW5zbGF0ZVg7XG4gICAgICAgICAgY3VycmVudFsyXSArPSB0cmFuc2xhdGVZO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdDJzpcbiAgICAgICAgICBjdXJyZW50WzFdICs9IHRyYW5zbGF0ZVg7XG4gICAgICAgICAgY3VycmVudFsyXSArPSB0cmFuc2xhdGVZO1xuICAgICAgICAgIGN1cnJlbnRbM10gKz0gdHJhbnNsYXRlWDtcbiAgICAgICAgICBjdXJyZW50WzRdICs9IHRyYW5zbGF0ZVk7XG4gICAgICAgICAgY3VycmVudFs1XSArPSB0cmFuc2xhdGVYO1xuICAgICAgICAgIGN1cnJlbnRbNl0gKz0gdHJhbnNsYXRlWTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnUyc6XG4gICAgICAgICAgY3VycmVudFsxXSArPSB0cmFuc2xhdGVYO1xuICAgICAgICAgIGN1cnJlbnRbMl0gKz0gdHJhbnNsYXRlWTtcbiAgICAgICAgICBjdXJyZW50WzNdICs9IHRyYW5zbGF0ZVg7XG4gICAgICAgICAgY3VycmVudFs0XSArPSB0cmFuc2xhdGVZO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdRJzogLy8gcXVhZHJhdGljQ3VydmVUbywgYWJzb2x1dGVcbiAgICAgICAgICBjdXJyZW50WzFdICs9IHRyYW5zbGF0ZVg7XG4gICAgICAgICAgY3VycmVudFsyXSArPSB0cmFuc2xhdGVZO1xuICAgICAgICAgIGN1cnJlbnRbM10gKz0gdHJhbnNsYXRlWDtcbiAgICAgICAgICBjdXJyZW50WzRdICs9IHRyYW5zbGF0ZVk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ1QnOlxuICAgICAgICAgIGN1cnJlbnRbMV0gKz0gdHJhbnNsYXRlWDtcbiAgICAgICAgICBjdXJyZW50WzJdICs9IHRyYW5zbGF0ZVk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ0EnOlxuICAgICAgICAgIGN1cnJlbnRbMV0gKz0gdHJhbnNsYXRlWDsvL3RvZG8/P1xuICAgICAgICAgIGN1cnJlbnRbMl0gKz0gdHJhbnNsYXRlWTsvL3RvZG8gPz9cbiAgICAgICAgICBjdXJyZW50WzZdICs9IHRyYW5zbGF0ZVg7XG4gICAgICAgICAgY3VycmVudFs3XSArPSB0cmFuc2xhdGVZO1xuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgX3NldF9hY2N1cmFjeTogZnVuY3Rpb24gKGFjY3VyYWN5LCBwYXRoKSB7XG4gICAgZm9yICh2YXIgaSA9MCA7IGkgPCBwYXRoLmxlbmd0aDsgaSsrKSB7XG4gICAgICBmb3IgKHZhciBqID0gMTsgaiA8IHBhdGhbaV0ubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgcGF0aFtpXVtqXSA9ICtwYXRoW2ldW2pdLnRvRml4ZWQodGhpcy5hY2N1cmFjeSk7XG4gICAgICB9XG4gICAgfVxuICB9LFxuICBzZXRBY2N1cmFjeTogZnVuY3Rpb24gKGFjY3VyYWN5KSB7XG4gICAgdGhpcy5hY2N1cmFjeSA9IGFjY3VyYWN5O1xuICAgIGlmKCF0aGlzLl9wb2ludHMpcmV0dXJuO1xuICAgIHRoaXMuX3NldF9hY2N1cmFjeShhY2N1cmFjeSwgdGhpcy5wYXRoKTtcbiAgfSxcbiAgc3RvcmVQYXRoQXNTdHJpbmc6IGZhbHNlLFxuICBfdG9PYmplY3Rfb3ZlcndyaXR0ZW46IGZhYnJpYy5QYXRoLnByb3RvdHlwZS50b09iamVjdCxcbi8vdG9kbyB1c2UgZXZlbnQgXCJiZWZvcmU6b2JqZWN0XCI7XG4gIHRvT2JqZWN0OiBmdW5jdGlvbiAocHJvcGVydGllc1RvSW5jbHVkZSkge1xuXG4gICAgaWYodGhpcy5hY2N1cmFjeSAhPT0gLTEpe1xuICAgICAgdGhpcy5fc2V0X2FjY3VyYWN5KHRoaXMuYWNjdXJhY3ksdGhpcy5wYXRoKTtcbiAgICAgIHRoaXMubGVmdCA9ICt0aGlzLmxlZnQudG9GaXhlZCh0aGlzLmFjY3VyYWN5KTtcbiAgICAgIHRoaXMudG9wICA9ICt0aGlzLnRvcC50b0ZpeGVkKHRoaXMuYWNjdXJhY3kpO1xuICAgICAgdGhpcy5wYXRoT2Zmc2V0LnggPSArdGhpcy5wYXRoT2Zmc2V0LngudG9GaXhlZCh0aGlzLmFjY3VyYWN5KTtcbiAgICAgIHRoaXMucGF0aE9mZnNldC55ID0gK3RoaXMucGF0aE9mZnNldC55LnRvRml4ZWQodGhpcy5hY2N1cmFjeSk7XG4gICAgfVxuXG4gICAgdmFyIF9vYmogPSB0aGlzLl90b09iamVjdF9vdmVyd3JpdHRlbihwcm9wZXJ0aWVzVG9JbmNsdWRlKTtcblxuICAgIGlmICh0aGlzLnN0b3JlUHJvcGVydGllcy5pbmRleE9mKFwiKlwiKSA9PSAtMSkge1xuXG4gICAgICBpZiAoX29iai5wYXRoT2Zmc2V0ICYmIHRoaXMuc3RvcmVQcm9wZXJ0aWVzLmluZGV4T2YoXCJwYXRoT2Zmc2V0XCIpID09IC0xKSB7XG4gICAgICAgIHRoaXMudHJhbnNsYXRlKF9vYmoucGF0aCwgX29iai5wYXRoT2Zmc2V0LngsIF9vYmoucGF0aE9mZnNldC55KVxuICAgICAgICB0aGlzLl9zZXRfYWNjdXJhY3kodGhpcy5hY2N1cmFjeSxfb2JqLnBhdGgpO1xuICAgICAgfVxuXG4gICAgICBmb3IgKHZhciBpIGluIF9vYmopIHtcbiAgICAgICAgaWYgKHRoaXMuc3RvcmVQcm9wZXJ0aWVzLmluZGV4T2YoaSkgPT0gLTEpIHtcbiAgICAgICAgICBkZWxldGUgX29ialtpXTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgY29uc29sZS5sb2coXCIhISFcIilcbiAgICB9XG4gICAgaWYgKHRoaXMuc3RvcmVQYXRoQXNTdHJpbmcpIHtcbiAgICAgIF9vYmoucGF0aCA9IF9vYmoucGF0aC5qb2luKCcnKVxuICAgIH1cbiAgICByZXR1cm4gX29iajtcbiAgfVxufSk7XG5cbi8qKlxuICogQ3JlYXRlcyBhbiBpbnN0YW5jZSBvZiBmYWJyaWMuUGF0aCBmcm9tIGFuIG9iamVjdFxuICogQHN0YXRpY1xuICogQG1lbWJlck9mIGZhYnJpYy5QYXRoXG4gKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0XG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayB0byBpbnZva2Ugd2hlbiBhbiBmYWJyaWMuUGF0aCBpbnN0YW5jZSBpcyBjcmVhdGVkXG4gKi9cbmZhYnJpYy5QYXRoLmZyb21PYmplY3QgPSBmdW5jdGlvbiAob2JqZWN0LCBjYWxsYmFjaykge1xuICAvKiBpZiAodHlwZW9mIG9iamVjdC5wYXRoID09PSAnc3RyaW5nJykge1xuICAgZmFicmljLmxvYWRTVkdGcm9tVVJMKG9iamVjdC5wYXRoLCBmdW5jdGlvbiAoZWxlbWVudHMpIHtcbiAgIHZhciBwYXRoID0gZWxlbWVudHNbMF0sXG4gICBwYXRoVXJsID0gb2JqZWN0LnBhdGg7XG5cbiAgIGRlbGV0ZSBvYmplY3QucGF0aDtcblxuICAgZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChwYXRoLCBvYmplY3QpO1xuICAgcGF0aC5zZXRTb3VyY2VQYXRoKHBhdGhVcmwpO1xuXG4gICBjYWxsYmFjayhwYXRoKTtcbiAgIH0pO1xuICAgfVxuICAgZWxzZSB7Ki9cblxuICB2YXIgX3NjYWxlZCA9IG9iamVjdC5zY2FsZVggfHwgb2JqZWN0LnNjYWxlWTtcblxuICB2YXIgcGF0aCA9IG5ldyBmYWJyaWMuUGF0aChvYmplY3QucGF0aCwgb2JqZWN0KTtcblxuICBpZighX3NjYWxlZCl7XG4gICAgaWYob2JqZWN0LndpZHRoKXtcbiAgICAgIHBhdGguc2NhbGVYID0gb2JqZWN0LndpZHRoIC8gcGF0aC53aWR0aDtcbiAgICB9XG4gICAgaWYob2JqZWN0LmhlaWdodCl7XG4gICAgICBwYXRoLnNjYWxlWSA9IG9iamVjdC5oZWlnaHQgLyBwYXRoLmhlaWdodDtcbiAgICB9XG4gIH1cblxuICBjYWxsYmFjayAmJiBjYWxsYmFjayhwYXRoKTtcbiAgcmV0dXJuIHBhdGg7XG4gIC8vIH1cbn07XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL3NoYXBlcy9wYXRoLmpzIiwiJ3VzZSBzdHJpY3QnO1xuXG5yZXF1aXJlKFwiLi4vbWl4aW5zL3N0cm9rZU1peGluXCIpO1xucmVxdWlyZShcIi4uL21peGlucy9jYWNoZU1peGluXCIpO1xucmVxdWlyZShcIi4uL3NoYXBlcy9QYXRoR3JvdXBcIik7XG5yZXF1aXJlKFwiLi4vbWl4aW5zL3Byb3BvcnRpYW5hbFNpemVNaXhpblwiKTtcbnJlcXVpcmUoXCIuLi9tb2R1bGVzL3Jlc2l6YWJsZVwiKTtcblxuLyoqXG4gKiBAYXV0aG9yIERlbmlzIFBvbm9tYXJldlxuICogQGVtYWlsIGRlbi5wb25vbWFyZXZAZ21haWwuY29tXG4gKi9cbmZhYnJpYy5DbGlwYXJ0ID0gZmFicmljLnV0aWwuY3JlYXRlQ2xhc3MoXG4gIGZhYnJpYy5Hcm91cCxcbiAgZmFicmljLlN0cm9rZU1peGluLFxuICBmYWJyaWMuQ2FjaGVNaXhpbixcbiAgZmFicmljLkltYWdlTWl4aW4sIHtcbiAgICB0eXBlOiAnY2xpcGFydCcsXG4gICAgY29sb3JzOiBudWxsLFxuICAgIGZvcm1hdDogJ3N2ZycsXG4gICAgcmVzaXphYmxlOiB0cnVlLFxuICAgIHByb2Nlc3Npbmc6IGZhbHNlLFxuICAgIHN0YXRlUHJvcGVydGllczogZmFicmljLkdyb3VwLnByb3RvdHlwZS5zdGF0ZVByb3BlcnRpZXMuY29uY2F0KFtcImNvbG9yc1wiXSksXG4gICAgb3B0aW9uc09yZGVyOiBbXCIqXCIsXCJjb2xvcnNcIixcImVsZW1lbnRcIiwgXCJhY3Rpb25zXCIsIFwidG9vbHNcIl0sXG4gICAgZ2V0T3JpZ2luYWxTaXplOiBmdW5jdGlvbigpe1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgd2lkdGg6IHRoaXMuZWxlbWVudC53aWR0aCxcbiAgICAgICAgaGVpZ2h0OiB0aGlzLmVsZW1lbnQuaGVpZ2h0XG4gICAgICB9XG4gICAgfSxcbiAgICBpbml0aWFsaXplOiBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgb3B0aW9ucyB8fCAoIG9wdGlvbnMgPSB7fSk7XG5cbiAgICAgIGlmIChvcHRpb25zLmNvbnN0cnVjdG9yICE9IE9iamVjdCkge1xuXG4gICAgICAgIHZhciBfb2JqID0gb3B0aW9ucy50b09iamVjdCgpO1xuICAgICAgICBpZiAob3B0aW9ucy5lbGVtZW50KSB7XG4gICAgICAgICAgX29iai5lbGVtZW50ID0gb3B0aW9ucy5lbGVtZW50LmNsb25lU3luYygpO1xuICAgICAgICAgIF9vYmouZWxlbWVudC5jbGlwVG8gPSBfb2JqLl9mYWJyaWNfc2hhcGU7XG4gICAgICAgIH1cbiAgICAgICAgX29iai5zaGFwZSA9IG9wdGlvbnMuc2hhcGU7XG4gICAgICAgIG9wdGlvbnMgPSBfb2JqO1xuICAgICAgfVxuXG4gICAgICB0aGlzLm9uKHtcbiAgICAgICAgXCJzY2FsaW5nXCI6IHRoaXMudXBkYXRlRWxlbWVudFxuICAgICAgfSk7XG5cbiAgICAgIHRoaXMuaW5pdFNoYXBlKG9wdGlvbnMpO1xuICAgICAgdGhpcy5fZmFicmljX3NoYXBlLnNldCh7XG4gICAgICAgIG9wYWNpdHk6IDAsXG4gICAgICAgIG9yaWdpblggOiAnY2VudGVyJyxcbiAgICAgICAgb3JpZ2luWSA6ICdjZW50ZXInLFxuICAgICAgfSk7XG5cbiAgICAgIHRoaXMuY2FsbFN1cGVyKCdpbml0aWFsaXplJywgW3RoaXMuX2ZhYnJpY19zaGFwZV0sIG9wdGlvbnMpO1xuICAgICAgdGhpcy5fc2V0V2lkdGhIZWlnaHQob3B0aW9ucyk7XG4gICAgfSxcbiAgICBzZXRTaGFwZTogZnVuY3Rpb24oZWwsY2Ipe1xuXG4gICAgICBlbCA9ICBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKHtcbiAgICAgICAgc3Ryb2tlV2lkdGhGdWxsOiB0aGlzLnNoYXBlLnN0cm9rZVdpZHRoRnVsbCxcbiAgICAgICAgc3Ryb2tlV2lkdGhFbXB0eTogdGhpcy5zaGFwZS5zdHJva2VXaWR0aEVtcHR5LFxuICAgICAgICBzdHJva2VXaWR0aEFjdGl2ZTogdGhpcy5zaGFwZS5zdHJva2VXaWR0aEFjdGl2ZSxcbiAgICAgICAgZGFzaEFycmF5IDogdGhpcy5zaGFwZS5kYXNoQXJyYXksXG4gICAgICAgIHN0cm9rZUVtcHR5OiAgdGhpcy5zaGFwZS5zdHJva2VFbXB0eSxcbiAgICAgICAgc3Ryb2tlRnVsbDogIHRoaXMuc2hhcGUuc3Ryb2tlRnVsbCxcbiAgICAgICAgc3Ryb2tlQWN0aXZlOnRoaXMuc2hhcGUuc3Ryb2tlQWN0aXZlXG4gICAgICB9LGVsKTtcblxuICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgIGlmKGVsICYmIGVsLnNyYyAmJiAhZWwucGF0aHMpe1xuICAgICAgICBmYWJyaWMubG9hZFNWR0Zyb21VUkwoZWwuc3JjLGZ1bmN0aW9uKHBhdGhzLG9wdGlvbnMpIHtcbiAgICAgICAgICBlbC5wYXRocyAgPSBwYXRocztcbiAgICAgICAgICBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGVsLG9wdGlvbnMpO1xuICAgICAgICAgIF90aGlzLl9zZXRfc2hhcGUoZWwpO1xuICAgICAgICAgIF90aGlzLmFkZChfdGhpcy5fZmFicmljX3NoYXBlKVxuICAgICAgICAgIF90aGlzLl9hcHBseV9zaGFwZSgpO1xuICAgICAgICAgIGNiICYmIGNiKCk7XG4gICAgICAgIH0pXG4gICAgICB9ZWxzZXtcbiAgICAgICAgX3RoaXMuX3NldF9zaGFwZShlbCk7XG4gICAgICAgIF90aGlzLmFkZChfdGhpcy5fZmFicmljX3NoYXBlKTtcbiAgICAgICAgX3RoaXMuX2FwcGx5X3NoYXBlKCk7XG4gICAgICAgIGNiICYmIGNiKCk7XG4gICAgICB9XG4gICAgfSxcbiAgICBzZXRFbGVtZW50OiBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgaWYodGhpcy5lbGVtZW50KXtcbiAgICAgICAgdGhpcy5yZW1vdmUodGhpcy5lbGVtZW50KTtcbiAgICAgIH1cbiAgICAgIGlmKCFlbGVtZW50KXtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgZWxlbWVudC5zZXQoe1xuICAgICAgICBvcmlnaW5YIDogJ2NlbnRlcicsXG4gICAgICAgIG9yaWdpblkgOiAnY2VudGVyJ1xuICAgICAgfSk7XG4gICAgICB0aGlzLmFkZChlbGVtZW50KTtcbiAgICAgIHRoaXMuZWxlbWVudCA9IGVsZW1lbnQ7XG4gICAgICBpZiAodGhpcy5mb3JtYXQgPT09ICdwbmcnIHx8IHRoaXMuZm9ybWF0ID09PSAnaW1hZ2UvcG5nJyB8fCB0aGlzLmZvcm1hdCA9PT0gJ2pwZWcnIHx8IHRoaXMuZm9ybWF0ID09PSAnaW1hZ2UvanBlZycpIHtcbiAgICAgICAgdGhpcy5fY2FjaGUgPSB0aGlzLmVsZW1lbnQuX2VsZW1lbnQ7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLl9pbml0X2NvbG9yX2FycmF5KCk7XG4gICAgICB9XG4gICAgICB0aGlzLmRpcnR5ID0gdHJ1ZTtcbiAgICAgIHRoaXMuY2FudmFzICYmIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgIH0sXG4gICAgdXBkYXRlRWxlbWVudDogZnVuY3Rpb24gKCkge1xuICAgICAgaWYodGhpcy5lbGVtZW50KXtcbiAgICAgICAgdGhpcy5lbGVtZW50LnNjYWxlWCA9IHRoaXMud2lkdGggLyB0aGlzLmVsZW1lbnQud2lkdGg7XG4gICAgICAgIHRoaXMuZWxlbWVudC5zY2FsZVkgPSB0aGlzLmhlaWdodCAvIHRoaXMuZWxlbWVudC5oZWlnaHQ7XG4gICAgICB9XG4gICAgICBpZih0aGlzLl9mYWJyaWNfc2hhcGUpe1xuICAgICAgICB0aGlzLl9mYWJyaWNfc2hhcGUuc2V0KHtcbiAgICAgICAgICB3aWR0aDogdGhpcy53aWR0aCxcbiAgICAgICAgICBoZWlnaHQ6IHRoaXMuaGVpZ2h0XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgdGhpcy5kaXJ0eSA9IHRydWU7XG4gICAgfSxcbiAgICBfcmVuZGVyOiBmdW5jdGlvbiAoY3R4KSB7XG4gICAgICBjdHguc2F2ZSgpO1xuICAgICAgY3R4LnNjYWxlKHRoaXMuZWxlbWVudC5zY2FsZVgsdGhpcy5lbGVtZW50LnNjYWxlWSlcbiAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gdGhpcy5lbGVtZW50LnBhdGhzLmxlbmd0aDsgaSA8IGw7ICsraSkge1xuICAgICAgICB0aGlzLmVsZW1lbnQucGF0aHNbaV0ucmVuZGVyKGN0eCwgdHJ1ZSk7XG4gICAgICB9XG4gICAgICBjdHgucmVzdG9yZSgpO1xuICAgIH0sXG4gICAgLyoqXG4gICAgICog0LrQvtCx0YrQtdC60YIg0LPQvtGC0L7QstC40YLRgdGPINC6INC30LDQvNC10L3RgyDRhNC+0YLQvlxuICAgICAqL1xuICAgIGFjdGl2YXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLl9hY3RpdmF0ZWQgPSB0cnVlO1xuICAgICAgdGhpcy5fZmFicmljX3NoYXBlLnNldE9wYWNpdHkoMSk7XG4gICAgICB0aGlzLnVwZGF0ZVN0cm9rZSgpO1xuICAgICAgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gICAgfSxcbiAgICAvKipcbiAgICAgKiDQutC+0LHRitC10LrRgiDQvdC1INCz0L7RgtC+0LLQuNGC0YHRjyDQuiDQt9Cw0LzQtdC90YMg0YTQvtGC0L5cbiAgICAgKi9cbiAgICBkZWFjdGl2YXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLl9hY3RpdmF0ZWQgPSBmYWxzZTtcbiAgICAgIHRoaXMudXBkYXRlU3Ryb2tlKCk7XG4gICAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICB9LFxuICAgIF9pbml0X2NvbG9yX2FycmF5OiBmdW5jdGlvbiAoKSB7XG5cbiAgICAgIHRoaXMucHJvY2Vzc2luZyA9IHRydWU7XG4gICAgICB0aGlzLl9jb2xvcnMgPSB0aGlzLmVsZW1lbnQuZXh0cmFjdENvbG9ycygpO1xuXG4gICAgICB0aGlzLmNvbG9ycyA9IHRoaXMuY29sb3JzIHx8IHt9O1xuXG4gICAgICBmb3IgKHZhciBfY29sb3IgaW4gdGhpcy5jb2xvcnMpIHtcbiAgICAgICAgdGhpcy5zZXRDbGlwYXJ0Q29sb3IoX2NvbG9yLCB0aGlzLmNvbG9yc1tfY29sb3JdLHRydWUpXG4gICAgICB9XG4gICAgfSxcbiAgICBzZXREYXRhOiBmdW5jdGlvbihkYXRhKXtcbiAgICAgIHRoaXMuc2V0U3JjKGRhdGEuc3JjKVxuICAgIH0sXG4gICAgc2V0U3JjOiBmdW5jdGlvbihzcmMpe1xuICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgIGZhYnJpYy5QYXRoR3JvdXAuZnJvbVVSTChzcmMsIGZ1bmN0aW9uIChlbCkge1xuICAgICAgICBfdGhpcy5zZXRFbGVtZW50KGVsKTtcbiAgICAgICAgX3RoaXMubWFrZUFjdGlvbnMoKTtcbiAgICAgIC8vICBfdGhpcy5jYW52YXMuY3JlYXRlRmxvYXRlZE1lbnUoX3RoaXMuYXBwbGljYXRpb24ub2JqZWN0c1Rvb2xiYXJPcHRpb25zKTtcbiAgICAgIH0se1xuICAgICAgICB3aWR0aDogdGhpcy53aWR0aCxcbiAgICAgICAgaGVpZ2h0OiB0aGlzLmhlaWdodFxuICAgICAgfSk7XG4gICAgfSxcbiAgICAvLyByZW5kZXI6IGZ1bmN0aW9uIChjdHgpIHtcbiAgICAvLyAgIC8vIHZhciB4ID0gbm9UcmFuc2Zvcm0gPyAwIDogLSB0aGlzLndpZHRoICogdGhpcy5zY2FsZVggLyAyLFxuICAgIC8vICAgLy8gICB5ID0gbm9UcmFuc2Zvcm0gPyAwIDogLSB0aGlzLmhlaWdodCAqIHRoaXMuc2NhbGVZIC8gMjtcbiAgICAvLyAgIC8vXG4gICAgLy8gICAvLyBjdHguc2F2ZSgpO1xuICAgIC8vICAgLy8gY3R4LnRyYW5zbGF0ZSh4LHkpO1xuICAgIC8vICAgZmFicmljLkdyb3VwLnByb3RvdHlwZS5yZW5kZXIuYXBwbHkodGhpcyxhcmd1bWVudHMpXG4gICAgLy8gICAvLyBjdHgucmVzdG9yZSgpO1xuICAgIC8vIH0sXG4gICAgc2V0Q2xpcGFydENvbG9yOiBmdW5jdGlvbiAoa2V5LCB2YWx1ZSwgcHJldmVudENhY2hlVXBkYXRlKSB7XG5cbiAgICAgIGlmICghdmFsdWUpIHtcbiAgICAgICAgdmFsdWUgPSBrZXk7XG4gICAgICAgIGRlbGV0ZSB0aGlzLmNvbG9yc1trZXldO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5jb2xvcnNba2V5XSA9IHZhbHVlO1xuICAgICAgfVxuICAgICAgdmFyIF9jb2xvcnMgPSB0aGlzLl9jb2xvcnNba2V5XTtcbiAgICAgIGZvciAodmFyIGkgaW4gX2NvbG9ycykge1xuICAgICAgICBpZiAoX2NvbG9yc1tpXS5jb2xvcikge1xuICAgICAgICAgIF9jb2xvcnNbaV0uY29sb3IuZmlsbCA9IHZhbHVlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChfY29sb3JzW2ldLnN0b3ApIHtcbiAgICAgICAgICBfY29sb3JzW2ldLnN0b3AuY29sb3IgPSB2YWx1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICB0aGlzLmRpcnR5ID0gdHJ1ZTtcbiAgICAgIHRoaXMuY2FudmFzICYmIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgIH0sXG4gICAgZ2V0U3JjOiBmdW5jdGlvbigpe1xuICAgICAgcmV0dXJuIHRoaXMuc3JjIHx8IHRoaXMuZWxlbWVudCAmJiB0aGlzLmVsZW1lbnQuc3JjO1xuICAgIH0sXG4gICAgdG9PYmplY3Q6IGZ1bmN0aW9uIChwcm9wZXJ0aWVzVG9JbmNsdWRlKSB7XG4gICAgICB2YXIgb2JqID0gZmFicmljLk9iamVjdC5wcm90b3R5cGUudG9PYmplY3QuY2FsbCh0aGlzKTtcbiAgICAgIGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQob2JqLHtcbiAgICAgICAgc3JjOiB0aGlzLmdldFNyYygpLFxuICAgICAgICBjb2xvcnM6IHRoaXMuY29sb3JzXG4gICAgICB9KVxuICAgICAgcmV0dXJuIG9iajtcbiAgICB9LFxuICAgIGFjdGlvbnM6ICB7XG4gICAgICBzb3VyY2U6IHtcbiAgICAgICAgdHlwZTogJ2VmZmVjdCcsXG4gICAgICAgIGNsYXNzTmFtZTogJ2ZhIGZhLWZpbGUtaW1hZ2UtbycsXG4gICAgICAgIHRpdGxlOiBcInNvdXJjZVwiLFxuICAgICAgICBhY3Rpb25QYXJhbWV0ZXJzOiBmdW5jdGlvbiAoJGVsZW1lbnQsIGRhdGEpIHtcbiAgICAgICAgICB0aGlzLmFwcGxpY2F0aW9uLmNyZWF0ZUVsZW1lbnRzTGlzdCgkZWxlbWVudCwgdGhpcy5hcHBsaWNhdGlvbi5nZXRMaWJyYXJ5RWxlbWVudHMoe2NhdGVnb3J5OiBcImNsaXBhcnRcIn0pICk7XG4gICAgICAgIC8vICBkYXRhLnRhcmdldC5hcHBsaWNhdGlvbi5jcmVhdGVHYWxsZXJ5KGRhdGEudGFyZ2V0LCAkZWwsIGRhdGEpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgY29sb3JzOiB7XG4gICAgICAgIHR5cGU6ICdtZW51JyxcbiAgICAgICAgdGl0bGU6ICdjb2xvciBtZW51JyxcbiAgICAgICAgbWVudTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHZhciBfbWVudSA9IFtdO1xuICAgICAgICAgIGZvciAodmFyIGtleSBpbiB0aGlzLl9jb2xvcnMpIHtcbiAgICAgICAgICAgIF9tZW51LnB1c2goe1xuICAgICAgICAgICAgICB0aXRsZTogXCJDb2xvciAoXCIgKyBrZXkgKyBcIilcIixcbiAgICAgICAgICAgICAgdmFsdWU6IHtcbiAgICAgICAgICAgICAgICBkZWZhdWx0VmFsdWU6IGtleSxcbiAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5jb2xvcnNba2V5XSB8fCBrZXksXG4gICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jb2xvcnNba2V5XSB8fCBrZXk7XG4gICAgICAgICAgICAgICAgfS5iaW5kKHRoaXMsIGtleSksXG4gICAgICAgICAgICAgICAgc2V0OiB0aGlzLnNldENsaXBhcnRDb2xvci5iaW5kKHRoaXMsIGtleSlcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgdHlwZTogXCJjb2xvclwiXG4gICAgICAgICAgICB9KVxuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gX21lbnU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbik7XG5cbmZhYnJpYy5DbGlwYXJ0LmFzeW5jID0gdHJ1ZTtcblxuLyoqXG4gKiBDcmVhdGVzIGZhYnJpYy5QYXRoR3JvdXAgaW5zdGFuY2UgZnJvbSBhbiBvYmplY3QgcmVwcmVzZW50YXRpb25cbiAqIEBzdGF0aWNcbiAqIEBtZW1iZXJPZiBmYWJyaWMuUGF0aEdyb3VwXG4gKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IE9iamVjdCB0byBjcmVhdGUgYW4gaW5zdGFuY2UgZnJvbVxuICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgdG8gaW52b2tlIHdoZW4gYW4gZmFicmljLlBhdGhHcm91cCBpbnN0YW5jZSBpcyBjcmVhdGVkXG4gKi9cbmZhYnJpYy5DbGlwYXJ0LmZyb21PYmplY3QgPSBmdW5jdGlvbiAob2JqZWN0LCBjYWxsYmFjaykge1xuICBpZiAodHlwZW9mIG9iamVjdC5zcmMgPT09ICdzdHJpbmcnKSB7XG4gICAgaWYgKG9iamVjdC5mb3JtYXQgPT09ICdwbmcnIHx8IG9iamVjdC5mb3JtYXQgPT09IFwiaW1hZ2UvcG5nXCIgfHwgb2JqZWN0LmZvcm1hdCA9PT0gJ2pwZWcnIHx8IG9iamVjdC5mb3JtYXQgPT09IFwiaW1hZ2UvanBlZ1wiKSB7XG4gICAgICBmYWJyaWMuSW1hZ2UuZnJvbVVSTChvYmplY3Quc3JjLCBmdW5jdGlvbiAoZWwpIHtcbiAgICAgICAgb2JqZWN0LmVsZW1lbnQgPSBlbDtcbiAgICAgICAgb2JqZWN0LmVsZW1lbnQuc3JjID0gb2JqZWN0LnNyYztcbiAgICAgICAgY2FsbGJhY2sobmV3IGZhYnJpYy5DbGlwYXJ0KG9iamVjdCkpO1xuICAgICAgfSwge1xuICAgICAgICB3aWR0aDogb2JqZWN0LndpZHRoIHx8IGZhYnJpYy5DbGlwYXJ0LnByb3RvdHlwZS53aWR0aCxcbiAgICAgICAgaGVpZ2h0OiBvYmplY3QuaGVpZ2h0IHx8IGZhYnJpYy5DbGlwYXJ0LnByb3RvdHlwZS5oZWlnaHRcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBmYWJyaWMuUGF0aEdyb3VwLmZyb21VUkwob2JqZWN0LnNyYywgZnVuY3Rpb24gKGVsKSB7XG4gICAgICAgIG9iamVjdC5lbGVtZW50ID0gZWw7XG4gICAgICAgIG9iamVjdC5lbGVtZW50LnNyYyA9IG9iamVjdC5zcmM7XG4gICAgICAgIGRlbGV0ZSBvYmplY3Quc3JjO1xuICAgICAgICBjYWxsYmFjayhuZXcgZmFicmljLkNsaXBhcnQob2JqZWN0KSk7XG4gICAgICB9LCB7XG4gICAgICAgIHdpZHRoOiBvYmplY3Qud2lkdGggfHwgZmFicmljLkNsaXBhcnQucHJvdG90eXBlLndpZHRoLFxuICAgICAgICBoZWlnaHQ6IG9iamVjdC5oZWlnaHQgfHwgZmFicmljLkNsaXBhcnQucHJvdG90eXBlLmhlaWdodFxuICAgICAgfSk7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIHJldHVybiBuZXcgZmFicmljLkNsaXBhcnQob2JqZWN0KTtcbiAgfVxufTtcblxuZmFicmljLnV0aWwuY3JlYXRlQWNjZXNzb3JzKGZhYnJpYy5DbGlwYXJ0KTtcblxuaWYgKGZhYnJpYy5vYmplY3RzTGlicmFyeSkge1xuICBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5vYmplY3RzTGlicmFyeSwge1xuICAgIGNsaXBhcnQ6IHtcbiAgICAgIFwid2lkdGhcIjogZnVuY3Rpb24gKHcsIGgpIHtcbiAgICAgICAgdmFyIF9hc3AgPSBNYXRoLm1pbigyODUgLyAzNjUsIHcgLyBoKTtcbiAgICAgICAgcmV0dXJuIHc7XG4gICAgICB9LFxuICAgICAgXCJoZWlnaHRcIjogZnVuY3Rpb24gKHcsIGgpIHtcbiAgICAgICAgdmFyIF9hc3AgPSBNYXRoLm1pbigyODUgLyAzNjUsIHcgLyBoKTtcbiAgICAgICAgcmV0dXJuIGg7XG4gICAgICB9LFxuICAgICAgXCJ0eXBlXCI6IFwiY2xpcGFydFwiLFxuICAgICAgXCJzcmNcIjogXCJkYXRhOmltYWdlL3N2Zyt4bWw7dXRmODtiYXNlNjQsUEQ5NGJXd2dkbVZ5YzJsdmJqMGlNUzR3SWlCbGJtTnZaR2x1WnowaWFYTnZMVGc0TlRrdE1TSS9QZ284SVMwdElFZGxibVZ5WVhSdmNqb2dRV1J2WW1VZ1NXeHNkWE4wY21GMGIzSWdNVGt1TUM0d0xDQlRWa2NnUlhod2IzSjBJRkJzZFdjdFNXNGdMaUJUVmtjZ1ZtVnljMmx2YmpvZ05pNHdNQ0JDZFdsc1pDQXdLU0FnTFMwK0NqeHpkbWNnZUcxc2JuTTlJbWgwZEhBNkx5OTNkM2N1ZHpNdWIzSm5Mekl3TURBdmMzWm5JaUI0Yld4dWN6cDRiR2x1YXowaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1UazVPUzk0YkdsdWF5SWdkbVZ5YzJsdmJqMGlNUzR4SWlCcFpEMGlUR0Y1WlhKZk1TSWdlRDBpTUhCNElpQjVQU0l3Y0hnaUlIWnBaWGRDYjNnOUlqQWdNQ0ExTVRJZ05URXlJaUJ6ZEhsc1pUMGlaVzVoWW14bExXSmhZMnRuY205MWJtUTZibVYzSURBZ01DQTFNVElnTlRFeU95SWdlRzFzT25Od1lXTmxQU0p3Y21WelpYSjJaU0lnZDJsa2RHZzlJalV4TW5CNElpQm9aV2xuYUhROUlqVXhNbkI0SWo0S1BHYytDZ2s4Y0dGMGFDQnpkSGxzWlQwaVptbHNiRG9qUmtZNFF6UTJPeUlnWkQwaVRURTJNeTR4T0Rrc05qY3VNVFE0UXpFeU9TNDJNVFlzTmpjdU1UUTRMREV5TVM0eU1qSXNNQ3czT1M0eU5UVXNNRU0xTWk0M01UTXNNQ3d5T0M0NE9UUXNNVFl1TnpnM0xESTRMamc1TkN3MU1DNHpOakVnSUNCek5UZ3VOelUwTERVd0xqTTJNU3cwTVM0NU5qY3NNVEE1TGpFeE5Vd3hOak11TVRnNUxEWTNMakUwT0hvaUx6NEtDVHh3WVhSb0lITjBlV3hsUFNKbWFXeHNPaU5HUmpoRE5EWTdJaUJrUFNKTk16UTNMamcwTlN3Mk55NHhORGhETXpneExqUXhPU3cyTnk0eE5EZ3NNemc1TGpneE1pd3dMRFF6TVM0M09Dd3dZekkyTGpVME1pd3dMRFV3TGpNMk1Td3hOaTQzT0Rjc05UQXVNell4TERVd0xqTTJNU0FnSUhNdE5UZ3VOelUwTERVd0xqTTJNUzAwTVM0NU5qY3NNVEE1TGpFeE5Vd3pORGN1T0RRMUxEWTNMakUwT0hvaUx6NEtQQzluUGdvOFp6NEtDVHh3WVhSb0lITjBlV3hsUFNKbWFXeHNPaU5HUmtWQ1JESTdJaUJrUFNKTk16TXhMalUwTVN3ME5qRXVOak01UXpNek1TNDFOREVzTkRnNUxqUTFNeXd6TVRFdU5qSTJMRFV4TWl3eU5UWXNOVEV5Y3kwM05TNDFOREV0TWpJdU5UUTNMVGMxTGpVME1TMDFNQzR6TmpGMkxUZ3VNemt6YURFMU1DNDFPVGtnSUNCTU16TXhMalUwTVN3ME5qRXVOak01ZWlJdlBnb0pQSEJoZEdnZ2MzUjViR1U5SW1acGJHdzZJMFpHUlVKRU1qc2lJR1E5SWswME5Ua3VNelk0TERFNE1pNDVNV016TkM0ME5EWXNOVFl1TXpBekxEUXdMakEwTWl3eE1ESXVORFkzTERRd0xqQTBNaXd4TURJdU5EWTNhQzB4Tmk0M09EY2dJQ0JqTUN3d0xERTJMamM0Tnl3ME1TNDBORE1zTVRZdU56ZzNMRFkzTGpFME9Hd3RNalV1TVRndE9DNHpPVE5qTUN3d0xERTJMamM0Tnl3ek55NDNOeXd4Tmk0M09EY3NOamN1TVRRNFl6QXNNQzQxTWpVdE1qVXVNVGd0T0M0ek9UTXRNalV1TVRndE9DNHpPVE1nSUNCek1USXVOVGtzTWpndU16STRMRGd1TXprekxEUXhMamsyTjJNdE1DNHhOVFFzTUM0MU1ERXRNalV1TVRndE9DNHpPVE10TWpVdU1UZ3RPQzR6T1ROek55NHpORFFzTVRrdU5UZzFMREFzTXpNdU5UYzBiQzAwTVM0NU5qY3RNVFl1TnpnM0lDQWdZekFzTUMwM0xqZzBOaXd5TlM0Mk9ERXRPQzR6T1RNc01qVXVNVGhqTFRFNExqTTJNUzB4Tmk0M09EY3ROREV1T1RZM0xUSTFMakU0TFRReExqazJOeTB5TlM0eE9FZ3hOVFV1TWpjNVl6QXNNQzB5TXk0Mk1EY3NPQzR6T1RNdE5ERXVPVFkzTERJMUxqRTRJQ0FnWXkwd0xqVTBPQ3d3TGpVdE9DNHpPVE10TWpVdU1UZ3RPQzR6T1RNdE1qVXVNVGhzTFRReExqazJOeXd4Tmk0M09EZGpMVGN1TXpRMExURXpMams0T1N3d0xUTXpMalUzTkN3d0xUTXpMalUzTkhNdE1qVXVNREkyTERndU9EazFMVEkxTGpFNExEZ3VNemt6SUNBZ1l5MDBMakU1TnkweE15NDJNemtzT0M0ek9UTXROREV1T1RZM0xEZ3VNemt6TFRReExqazJOM010TWpVdU1UZ3NPQzQ1TVRndE1qVXVNVGdzT0M0ek9UTmpNQzB5T1M0ek56Y3NNVFl1TnpnM0xUWTNMakUwT0N3eE5pNDNPRGN0TmpjdU1UUTRiQzB5TlM0eE9DdzRMak01TXlBZ0lHTXdMVEkxTGpjd05Td3hOaTQzT0RjdE5qY3VNVFE0TERFMkxqYzROeTAyTnk0eE5EaElNVEl1TlRsak1Dd3dMRFV1TlRrMUxUUTJMakUyTkN3ME1DNHdOREl0TVRBeUxqUTJOMGcwTlRrdU16WTRlaUl2UGdvOEwyYytDanhsYkd4cGNITmxJSE4wZVd4bFBTSm1hV3hzT2lOR1JrRTFORUk3SWlCamVEMGlNalUxTGpVeE55SWdZM2s5SWpJek1DNDRNaUlnY25nOUlqSXdPUzQ0TXpZaUlISjVQU0l4T1RjdU1qUTJJaTgrQ2p4blBnb0pDZ2tKUEdWc2JHbHdjMlVnZEhKaGJuTm1iM0p0UFNKdFlYUnlhWGdvTFRBdU5qQTBNaUF0TUM0M09UWTRJREF1TnprMk9DQXRNQzQyTURReUlEWXpMamswTnpVZ05EazVMamc1TWpZcElpQnpkSGxzWlQwaVptbHNiRG9qUmtaRlFrUXlPeUlnWTNnOUlqRTFOaTR4TWpNaUlHTjVQU0l5TXpRdU1EWTFJaUJ5ZUQwaU16Y3VOelk1SWlCeWVUMGlORFl1TVRZeklpOCtDZ2tLQ1FrOFpXeHNhWEJ6WlNCMGNtRnVjMlp2Y20wOUltMWhkSEpwZUNndE1DNDJNRFF5SURBdU56azJPQ0F0TUM0M09UWTRJQzB3TGpZd05ESWdOelUxTGpreU1EUWdPVEl1TnpBek1Ta2lJSE4wZVd4bFBTSm1hV3hzT2lOR1JrVkNSREk3SWlCamVEMGlNelUwTGprek55SWdZM2s5SWpJek5DNHdPRFlpSUhKNFBTSXpOeTQzTmpraUlISjVQU0kwTmk0eE5qTWlMejRLUEM5blBnbzhjR0YwYUNCemRIbHNaVDBpWm1sc2JEb2pSa1k0UXpRMk95SWdaRDBpVFRJMU5TNDFNalFzTWpZd0xqRTVOMmd0TUM0d01UTmpMVEk0TGpjeE1Td3dMVFUxTGpBME5Td3hPQzR5TmpndE5qZ3VOVE0yTERRM0xqVXhNU0FnWXkweE9DNHhOak1zTXprdU16YzBMVFF3TGpVM015dzVNUzQ1T1RZdE5EQXVOVGN6TERFeE1TNDVOalJvTWpFNExqSXlPV013TFRFNUxqazJOeTB5TWk0ME1Ea3ROekl1TlRrdE5EQXVOVGN6TFRFeE1TNDVOalFnSUVNek1UQXVOVFk1TERJM09DNDBOalFzTWpnMExqSXpOQ3d5TmpBdU1UazNMREkxTlM0MU1qUXNNall3TGpFNU4zb2lMejRLUEhCaGRHZ2djM1I1YkdVOUltWnBiR3c2STBaR1JFVkNOenNpSUdROUlrMHpNRFF1TnprMUxETTJPUzR6TVRGakxURTVMak01TXl3d0xUTTJMamcxTlN3MkxUUTVMakkzT0N3eE5TNDFPRGhqTFRFeUxqUXlNaTA1TGpVNE9DMHlPUzQ0T0RVdE1UVXVOVGc0TFRRNUxqSTNPQzB4TlM0MU9EZ2dJR010TXpjdU5qZ3lMREF0TmpndU1qTXNNakl1TlRRM0xUWTRMakl6TERVd0xqTTJNWE16TUM0MU5EZ3NOVEF1TXpZeExEWTRMakl6TERVd0xqTTJNV014TlM0M01qZ3NNQ3d6TUM0eE9EY3RNeTQ1TkRjc05ERXVOekUyTFRFd0xqVTFOQ0FnWXpRdU56WTBMVEl1TnpNc01UQXVNelUzTFRJdU56TXNNVFV1TVRJeUxEQmpNVEV1TlRJNUxEWXVOakEzTERJMUxqazRPQ3d4TUM0MU5UUXNOREV1TnpFMkxERXdMalUxTkdNek55NDJPRElzTUN3Mk9DNHlNeTB5TWk0MU5EY3NOamd1TWpNdE5UQXVNell4SUNCVE16UXlMalEzT0N3ek5qa3VNekV4TERNd05DNDNPVFVzTXpZNUxqTXhNWG9pTHo0S1BHYytDZ2s4Y0dGMGFDQnpkSGxzWlQwaVptbHNiRG9qTkRZME5qVTFPeUlnWkQwaVRUSXhOUzR6TkRRc016YzBMams1TVd3ek15NDBPQ3cwTkM0eU16SmpNeTR6TlRnc05DNDBNemNzTVRBdU1ESTJMRFF1TkRNM0xERXpMak00TkN3d2JETXpMalE0TFRRMExqSXpNaUFnSUdNMExqRTROQzAxTGpVeU9Dd3dMakkwTVMweE15NDBOVGt0Tmk0Mk9UTXRNVE11TkRVNWFDMDBMalZqTFRJdU5USXNNQzAxTGpBeU5pd3dMak0zT0MwM0xqUXpNaXd4TGpFeU1td3RNVFF1TVRFMkxEUXVNell4WXkwMExqZzBNaXd4TGpRNU5pMHhNQzR3TWpNc01TNDBPVFl0TVRRdU9EWTFMREFnSUNCc0xURTBMakV4TmkwMExqTTJNV010TWk0ME1EZ3RNQzQzTkRRdE5DNDVNVE10TVM0eE1qSXROeTQwTXpJdE1TNHhNakpvTFRRdU5EazVRekl4TlM0eE1ETXNNell4TGpVek1pd3lNVEV1TVRZc016WTVMalEyTXl3eU1UVXVNelEwTERNM05DNDVPVEY2SWk4K0NnazhZMmx5WTJ4bElITjBlV3hsUFNKbWFXeHNPaU0wTmpRMk5UVTdJaUJqZUQwaU1UVTBMamM1TmlJZ1kzazlJakl6TlM0d01UWWlJSEk5SWpFMkxqYzROeUl2UGdvSlBHTnBjbU5zWlNCemRIbHNaVDBpWm1sc2JEb2pORFkwTmpVMU95SWdZM2c5SWpNMU5pNHlNemtpSUdONVBTSXlNelV1TURFMklpQnlQU0l4Tmk0M09EY2lMejRLQ1R4d1lYUm9JSE4wZVd4bFBTSm1hV3hzT2lNME5qUTJOVFU3SWlCa1BTSk5OemN1TXpVNExETXpOUzR3TURGc05EWXVNakEyTFRNM0xqZ3dOV00wTGpBeE1pMHpMakk0TXl3eExqRXlNeTA1TGpjMk1TMDBMakF3TVMwNExqazJPV3d0TmpFdU5EYzRMRGt1TlNBZ0lFTTJNeTR4TWpNc016RXdMamcyTERZNUxqWXhPQ3d6TWpNdU16TXhMRGMzTGpNMU9Dd3pNelV1TURBeGVpSXZQZ29KUEhCaGRHZ2djM1I1YkdVOUltWnBiR3c2SXpRMk5EWTFOVHNpSUdROUlrMHhNakV1TkRrekxETTRNaTQxTnpkc01qVXVNRFV5TFRZMkxqZ3dOMk14TGpreU1pMDFMakV5TlMwMExqUTVOQzA1TGpJMU5pMDRMak0yTkMwMUxqTTROV3d0TkRVdU1UZ3pMRFExTGpFNE15QWdJRU14TURFdU5UVTFMRE0yTlM0ME1EWXNNVEV4TGpBNU9Dd3pOelF1TkRVMUxERXlNUzQwT1RNc016Z3lMalUzTjNvaUx6NEtDVHh3WVhSb0lITjBlV3hsUFNKbWFXeHNPaU0wTmpRMk5UVTdJaUJrUFNKTk1qSTJMalF3TlN3eE1Ea3VNVFE1YkMwMkxqWXpNeTAzTWk0Mk5qZGpMVGd1TVRBMkxERXVNekE0TFRFMkxqQTFNaXd6TGpBME5DMHlNeTQ0TVRFc05TNHlNREZzTWpFdU5UTXlMRFk1TGpJek9TQWdJRU15TVRrdU1USXNNVEUyTGpFMU55d3lNall1T1RBekxERXhOQzQyTURrc01qSTJMalF3TlN3eE1Ea3VNVFE1ZWlJdlBnb0pQSEJoZEdnZ2MzUjViR1U5SW1acGJHdzZJelEyTkRZMU5Uc2lJR1E5SWsweU9URXVNall6TERNMkxqUTRNbXd0Tmk0Mk16TXNOekl1TmpZM1l5MHdMalE1T0N3MUxqUTJMRGN1TWpnMExEY3VNREEzTERndU9URXpMREV1TnpjeWJESXhMalV6TWkwMk9TNHlNemtnSUNCRE16QTNMak14TlN3ek9TNDFNamNzTWprNUxqTTJPU3d6Tnk0M09Td3lPVEV1TWpZekxETTJMalE0TW5vaUx6NEtDVHh3WVhSb0lITjBlV3hsUFNKbWFXeHNPaU0wTmpRMk5UVTdJaUJrUFNKTk16TTNMak00Tnl3ME9TNHhOVFpzTFRJd0xqVXdPU3cwTnk0ME5EbGpMVEl1TVRNM0xEUXVPVFEyTERRdU5UUTVMRGd1T0RZNExEY3VPREl6TERRdU5UZzRiRE15TGpjekxUUXlMamM1TVNBZ0lFTXpOVEF1T1RRMkxEVTFMakF4TERNME5DNHlOekVzTlRFdU9Td3pNemN1TXpnM0xEUTVMakUxTm5vaUx6NEtDVHh3WVhSb0lITjBlV3hsUFNKbWFXeHNPaU0wTmpRMk5UVTdJaUJrUFNKTk1UazBMakUxTnl3NU5pNDJNRFZzTFRJd0xqVXdPUzAwTnk0ME5EbGpMVFl1T0RnMExESXVOelExTFRFekxqVTFPU3cxTGpnMU15MHlNQzR3TkRRc09TNHlORGRzTXpJdU56TXNOREl1TnprZ0lDQkRNVGc1TGpZd09Dd3hNRFV1TkRjekxERTVOaTR5T1RVc01UQXhMalUxTVN3eE9UUXVNVFUzTERrMkxqWXdOWG9pTHo0S0NUeHdZWFJvSUhOMGVXeGxQU0ptYVd4c09pTTBOalEyTlRVN0lpQmtQU0pOTWpjeUxqSXlOQ3d6TkM0eU5UTmpMVFV1TlRFNExUQXVOREE0TFRFeExqQTNOeTB3TGpZM09TMHhOaTQzTURjdE1DNDJOemxqTFRVdU5qTXNNQzB4TVM0eE9Ea3NNQzR5TnpFdE1UWXVOekEzTERBdU5qYzVJQ0FnYkRFeUxqRTJPU3d4TURNdU5EUmpNQzQyTXpNc05TNHpPQ3c0TGpRME1pdzFMak00TERrdU1EYzFMREJNTWpjeUxqSXlOQ3d6TkM0eU5UTjZJaTgrQ2drOGNHRjBhQ0J6ZEhsc1pUMGlabWxzYkRvak5EWTBOalUxT3lJZ1pEMGlUVFF6TkM0NE5qZ3NNek0xTGpBd01Xd3RORFl1TWpBMkxUTTNMamd3TldNdE5DNHdNVEl0TXk0eU9ETXRNUzR4TWpNdE9TNDNOakVzTkM0d01ERXRPQzQ1Tmpsc05qRXVORGM0TERrdU5TQWdJRU0wTkRrdU1UQTBMRE14TUM0NE5pdzBOREl1TmpBNExETXlNeTR6TXpFc05ETTBMamcyT0N3ek16VXVNREF4ZWlJdlBnb0pQSEJoZEdnZ2MzUjViR1U5SW1acGJHdzZJelEyTkRZMU5Uc2lJR1E5SWswek9UQXVOek16TERNNE1pNDFOemRzTFRJMUxqQTFNaTAyTmk0NE1EZGpMVEV1T1RJeUxUVXVNVEkxTERRdU5EazBMVGt1TWpVMkxEZ3VNelkwTFRVdU16ZzFiRFExTGpFNE15dzBOUzR4T0RNZ0lDQkROREV3TGpZM01Td3pOalV1TkRBMkxEUXdNUzR4TWprc016YzBMalExTlN3ek9UQXVOek16TERNNE1pNDFOemQ2SWk4K0Nqd3ZaejRLUEdjK0Nqd3ZaejRLUEdjK0Nqd3ZaejRLUEdjK0Nqd3ZaejRLUEdjK0Nqd3ZaejRLUEdjK0Nqd3ZaejRLUEdjK0Nqd3ZaejRLUEdjK0Nqd3ZaejRLUEdjK0Nqd3ZaejRLUEdjK0Nqd3ZaejRLUEdjK0Nqd3ZaejRLUEdjK0Nqd3ZaejRLUEdjK0Nqd3ZaejRLUEdjK0Nqd3ZaejRLUEdjK0Nqd3ZaejRLUEdjK0Nqd3ZaejRLUEM5emRtYytDZz09XCJcbiAgICB9XG4gIH0pO1xufVxuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9zaGFwZXMvY2xpcGFydC5qcyIsIlxuZmFicmljLkNhY2hlTWl4aW4gPSB7XG4gIGNhY2hpbmc6IHRydWUsXG4gIGRpcnR5OiB0cnVlLFxuICByZW5kZXI6IGZ1bmN0aW9uICggY3R4KSB7XG5cbiAgICBjdHguc2F2ZSgpO1xuICAgIGlmICh0aGlzLnRyYW5zZm9ybU1hdHJpeCkge1xuICAgICAgY3R4LnRyYW5zZm9ybS5hcHBseShjdHgsIHRoaXMudHJhbnNmb3JtTWF0cml4KTtcbiAgICB9XG4gICAgdGhpcy50cmFuc2Zvcm0oY3R4KTtcblxuICAgIHRoaXMuX3NldFNoYWRvdyhjdHgpO1xuICAgIHRoaXMuY2xpcFRvICYmIGZhYnJpYy51dGlsLmNsaXBDb250ZXh0KHRoaXMsIGN0eCk7XG5cbiAgICBjdHgudHJhbnNsYXRlKC10aGlzLndpZHRoIC8gMiwgLXRoaXMuaGVpZ2h0IC8gMik7XG5cbiAgICBpZiAodGhpcy5jYWNoaW5nKSB7XG4gICAgICBpZih0aGlzLmRpcnR5ICkge1xuXG4gICAgICAgIGlmKCF0aGlzLl9jYWNoZSl7XG4gICAgICAgICAgdGhpcy5fY2FjaGUgPSBmYWJyaWMudXRpbC5jcmVhdGVDYW52YXNFbGVtZW50V2l0aFNpemUodGhpcyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5lbGVtZW50KSB7XG4gICAgICAgICAgdGhpcy5fY2FjaGUud2lkdGggPSB0aGlzLndpZHRoO1xuICAgICAgICAgIHRoaXMuX2NhY2hlLmhlaWdodCA9IHRoaXMuaGVpZ2h0O1xuICAgICAgICAgIHZhciBjYWNoZUN0eCA9IHRoaXMuX2NhY2hlLmdldENvbnRleHQoXCIyZFwiKTtcbiAgICAgICAgICBjYWNoZUN0eC5jbGVhclJlY3QoMCwgMCwgdGhpcy5fY2FjaGUud2lkdGgsIHRoaXMuX2NhY2hlLmhlaWdodClcbiAgICAgICAgICB0aGlzLl9yZW5kZXIoY2FjaGVDdHgpO1xuICAgICAgICAgIHRoaXMuZGlydHkgPSBmYWxzZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLl9jYWNoZSA9IG51bGw7XG4gICAgICAgICAgdGhpcy5kaXJ0eSA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmKHRoaXMuX2NhY2hlKXtcbiAgICAgICAgY3R4LmRyYXdJbWFnZSh0aGlzLl9jYWNoZSwgMCwgMCwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQsMCwgMCwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpO1xuICAgICAgfVxuICAgIH1lbHNle1xuICAgICAgdGhpcy5fcmVuZGVyKGN0eCk7XG4gICAgfVxuXG4gICAgdGhpcy5jbGlwVG8gJiYgY3R4LnJlc3RvcmUoKTtcbiAgICBjdHgucmVzdG9yZSgpO1xuICB9XG5cbn07XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL21peGlucy9jYWNoZU1peGluLmpzIiwiXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5QYXRoR3JvdXAucHJvdG90eXBlLHtcbiAgY2xvbmVTeW5jOiBmdW5jdGlvbigpIHtcblxuXG4gICAgcmV0dXJuIG5ldyBmYWJyaWMuUGF0aEdyb3VwLmZyb21FbGVtZW50cyh0aGlzLnBhdGhzLHRoaXMpXG5cbiAgICAvLyBmYWJyaWMudXRpbC5lbmxpdmVuT2JqZWN0cyhvYmplY3Qub2JqZWN0cywgZnVuY3Rpb24gKGVubGl2ZW5lZE9iamVjdHMpIHtcbiAgICAvLyAgIGRlbGV0ZSBvYmplY3Qub2JqZWN0cztcbiAgICAvLyAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKG5ldyBmYWJyaWMuR3JvdXAoZW5saXZlbmVkT2JqZWN0cywgb2JqZWN0LCB0cnVlKSk7XG4gICAgLy8gfSk7XG4gIH0sXG4gIGluaXRpYWxpemVfb3ZlcndyaXR0ZW46IGZhYnJpYy5QYXRoR3JvdXAucHJvdG90eXBlLmluaXRpYWxpemUsXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKHBhdGhzLCBvcHRpb25zKXtcblxuICAgIGlmKHBhdGhzLmNvbnN0cnVjdG9yICE9IEFycmF5KXtcbiAgICAgIG9wdGlvbnMgPSBwYXRocy50b09iamVjdCgpO1xuICAgICAgZGVsZXRlIG9wdGlvbnMucGF0aHM7XG4gICAgICBwYXRocyA9IHBhdGhzLnBhdGhzO1xuICAgIH1cblxuICAgIHRoaXMuaW5pdGlhbGl6ZV9vdmVyd3JpdHRlbihwYXRocywgb3B0aW9ucyk7XG4gIH0sXG4gIGV4dHJhY3RDb2xvcnM6IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgX2NvbG9ycyA9IHt9O1xuICAgIHZhciBfcGF0aHMgPSB0aGlzLnBhdGhzO1xuICAgIGZvciAodmFyIGkgaW4gX3BhdGhzKSB7XG4gICAgICBpZiAoX3BhdGhzW2ldLmZpbGwudHlwZSkge1xuICAgICAgICBmb3IgKHZhciBqIGluIF9wYXRoc1tpXS5maWxsLmNvbG9yU3RvcHMpIHtcbiAgICAgICAgICB2YXIgX2NvbG9yID0gX3BhdGhzW2ldLmZpbGwuY29sb3JTdG9wc1tqXS5jb2xvcjtcbiAgICAgICAgICBpZiAoIV9jb2xvcnNbX2NvbG9yXSkgX2NvbG9yc1tfY29sb3JdID0gW107XG4gICAgICAgICAgX2NvbG9yc1tfY29sb3JdLnB1c2goe29iamVjdDogX3BhdGhzW2ldLCBzdG9wOiBfcGF0aHNbaV0uZmlsbC5jb2xvclN0b3BzW2pdfSk7XG4gICAgICAgIH1cblxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIF9jb2xvciA9IF9wYXRoc1tpXS5maWxsO1xuICAgICAgICBpZiAoIV9jb2xvcnNbX2NvbG9yXSkgX2NvbG9yc1tfY29sb3JdID0gW107XG4gICAgICAgIF9jb2xvcnNbX2NvbG9yXS5wdXNoKHtvYmplY3Q6IF9wYXRoc1tpXSwgY29sb3I6IF9wYXRoc1tpXX0pO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gX2NvbG9ycztcbiAgfVxufSlcblxuZmFicmljLlBhdGhHcm91cC5mcm9tRWxlbWVudHMgPSBmdW5jdGlvbiAoZWxlbWVudHMsIG9iamVjdCwgdXJsKSB7XG4gIHZhciBfb3B0aW9ucyA9IHtcbiAgICB0b0JlUGFyc2VkOiB0cnVlLFxuICAgIC8vb3JpZ2luWDogXCJjZW50ZXJcIixcbiAgICAvL29yaWdpblk6IFwiY2VudGVyXCJcbiAgfTtcblxuICAvL9GB0LzQtdGJ0LDQtdC8INGN0LvQtdC80LXQvdGC0Ysg0YLQsNC6LCDRh9GC0L7QsdGLINC40YUg0LrQvtC+0YDQuNC90LDRgtGLINC90LDRh9C40L3QsNC70LjRgdGMINC+0YIgMC4wXG4gIGlmIChlbGVtZW50cy5sZW5ndGgpIHtcbiAgICB2YXIgbWluWCA9IEluZmluaXR5LCBtaW5ZID0gSW5maW5pdHk7XG4gICAgZm9yICh2YXIgaSBpbiBlbGVtZW50cykge1xuICAgICAgbWluWCA9IE1hdGgubWluKGVsZW1lbnRzW2ldLmxlZnQsIG1pblgpO1xuICAgICAgbWluWSA9IE1hdGgubWluKGVsZW1lbnRzW2ldLnRvcCwgbWluWSk7XG4gICAgfVxuICAgIG1pblggPSBNYXRoLm1heChtaW5YLCAwKTtcbiAgICBtaW5ZID0gTWF0aC5tYXgobWluWSwgMCk7XG4gICAgLyogZm9yICh2YXIgaSBpbiBlbGVtZW50cykge1xuICAgICBlbGVtZW50c1tpXS50cmFuc2xhdGUoLW1pblgsIC1taW5ZKTtcbiAgICAgZWxlbWVudHNbaV0ubGVmdCAtPSBtaW5YO1xuICAgICBlbGVtZW50c1tpXS5wYXRoT2Zmc2V0LnggLT0gbWluWDtcbiAgICAgZWxlbWVudHNbaV0udG9wIC09IG1pblk7XG4gICAgIGVsZW1lbnRzW2ldLnBhdGhPZmZzZXQueSAtPSBtaW5ZO1xuICAgICB9Ki9cbiAgfVxuXG4gIHZhciBlbCA9IGZhYnJpYy51dGlsLmdyb3VwU1ZHRWxlbWVudHMoZWxlbWVudHMsIF9vcHRpb25zLCB1cmwpO1xuXG4gIGlmKCFvYmplY3Quc2NhbGVYICYmICFvYmplY3Quc2NhbGVZKXtcbiAgICB2YXIgc2NhbGVYID0gb2JqZWN0LndpZHRoID8gb2JqZWN0LndpZHRoIC8gZWwud2lkdGggOiBudWxsLFxuICAgICAgc2NhbGVZID0gb2JqZWN0LmhlaWdodCA/IG9iamVjdC5oZWlnaHQgLyBlbC5oZWlnaHQgOiBudWxsO1xuICAgIGlmIChzY2FsZVggJiYgIXNjYWxlWSkge1xuICAgICAgc2NhbGVZID0gc2NhbGVYO1xuICAgIH1cbiAgICBpZiAoc2NhbGVZICYmICFzY2FsZVgpIHtcbiAgICAgIHNjYWxlWCA9IHNjYWxlWTtcbiAgICB9XG4gICAgaWYgKCFzY2FsZVkgJiYgIXNjYWxlWCkge1xuICAgICAgc2NhbGVYID0gc2NhbGVZID0gMTtcbiAgICB9XG5cbiAgICBkZWxldGUgb2JqZWN0LmhlaWdodDtcbiAgICBkZWxldGUgb2JqZWN0LndpZHRoO1xuICAgIGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQob2JqZWN0LCB7XG4gICAgICAvL2xlZnQ6IDAsIHRvcDogMCxcbiAgICAgIHNjYWxlWDogc2NhbGVYLFxuICAgICAgc2NhbGVZOiBzY2FsZVlcbiAgICB9KTtcbiAgfVxuICBlbC5zZXQob2JqZWN0KTtcblxuICBlbC5zZXRMZWZ0KG9iamVjdC5sZWZ0KTtcbiAgZWwuc2V0VG9wKG9iamVjdC50b3ApO1xuXG4gIHJldHVybiBlbDtcbn07XG5cbi8vIGZhYnJpYy5QYXRoR3JvdXAucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uKGN0eCxub1RyYW5zZm9ybSkge1xuLy8gICBpZiAoIXRoaXMudmlzaWJsZSkge1xuLy8gICAgIHJldHVybjtcbi8vICAgfVxuLy8gICB2YXIgeCA9IG5vVHJhbnNmb3JtID8gMCA6IC0gdGhpcy53aWR0aCAqIHRoaXMuc2NhbGVYIC8gMixcbi8vICAgICB5ID0gbm9UcmFuc2Zvcm0gPyAwIDogLSB0aGlzLmhlaWdodCAqIHRoaXMuc2NhbGVZIC8gMjtcbi8vXG4vLyAgIGN0eC5zYXZlKCk7XG4vLyAgIGN0eC50cmFuc2xhdGUoeCx5KTtcbi8vXG4vLyAgIGlmICh0aGlzLnRyYW5zZm9ybU1hdHJpeCkge1xuLy8gICAgIGN0eC50cmFuc2Zvcm0uYXBwbHkoY3R4LCB0aGlzLnRyYW5zZm9ybU1hdHJpeCk7XG4vLyAgIH1cbi8vICAgdGhpcy50cmFuc2Zvcm0oY3R4KTtcbi8vXG4vLyAgIHRoaXMuX3NldFNoYWRvdyhjdHgpO1xuLy8gICB0aGlzLmNsaXBUbyAmJiBmYWJyaWMudXRpbC5jbGlwQ29udGV4dCh0aGlzLCBjdHgpO1xuLy8gICBjdHgudHJhbnNsYXRlKC10aGlzLndpZHRoLzIsIC10aGlzLmhlaWdodC8yKTtcbi8vICAgZm9yICh2YXIgaSA9IDAsIGwgPSB0aGlzLnBhdGhzLmxlbmd0aDsgaSA8IGw7ICsraSkge1xuLy8gICAgIHRoaXMucGF0aHNbaV0ucmVuZGVyKGN0eCwgdHJ1ZSk7XG4vLyAgIH1cbi8vICAgdGhpcy5jbGlwVG8gJiYgY3R4LnJlc3RvcmUoKTtcbi8vICAgY3R4LnJlc3RvcmUoKTtcbi8vIH1cblxuXG5cblxuXG5cbmZhYnJpYy5QYXRoR3JvdXAuZnJvbVVSTCA9IGZ1bmN0aW9uICh1cmwsIGNhbGxiYWNrLCBvYmplY3QpIHtcblxuICBmYWJyaWMubG9hZFNWR0Zyb21VUkwodXJsLGZ1bmN0aW9uKGVscyl7XG5cbiAgICB2YXIgZWwgPSBuZXcgZmFicmljLlBhdGhHcm91cChlbHMsIHt0b0JlUGFyc2VkOnRydWV9KTtcblxuICAgIC8vIC8v0YHQvNC10YnQsNC10Lwg0Y3Qu9C10LzQtdC90YLRiyDRgtCw0LosINGH0YLQvtCx0Ysg0LjRhSDQutC+0L7RgNC40L3QsNGC0Ysg0L3QsNGH0LjQvdCw0LvQuNGB0Ywg0L7RgiAwLjBcbiAgICAvLyBpZiAoZWwucGF0aHMubGVuZ3RoKSB7XG4gICAgLy9cbiAgICAvLyAgIHZhciBtaW5YID0gSW5maW5pdHksXG4gICAgLy8gICAgIG1pblkgPSBJbmZpbml0eTtcbiAgICAvLyAgIHZhciBtYXhYID0gLUluZmluaXR5LFxuICAgIC8vICAgICBtYXhZID0gLUluZmluaXR5O1xuICAgIC8vXG4gICAgLy8gICBmb3IgKHZhciBpIGluIGVsLnBhdGhzKSB7XG4gICAgLy8gICAgIHZhciBfcCA9IGVsLnBhdGhzW2ldO1xuICAgIC8vICAgICBtaW5YID0gTWF0aC5taW4oX3AubGVmdCwgbWluWCk7XG4gICAgLy8gICAgIG1pblkgPSBNYXRoLm1pbihfcC50b3AsIG1pblkpO1xuICAgIC8vICAgICBtYXhYID0gTWF0aC5tYXgoX3AubGVmdCArIF9wLndpZHRoLCBtYXhYKTtcbiAgICAvLyAgICAgbWF4WSA9IE1hdGgubWF4KF9wLnRvcCArIF9wLmhlaWdodCwgbWF4WSk7XG4gICAgLy8gICB9XG4gICAgLy9cbiAgICAvLyAgIHZhciBfVyA9IG1heFggLSBtaW5YO1xuICAgIC8vICAgdmFyIF9IID0gbWF4WSAtIG1pblk7XG4gICAgLy8gICAvL1xuICAgIC8vICAgLy9cbiAgICAvLyAgIC8vIG1pblggPSBNYXRoLm1heChtaW5YLCAwKTtcbiAgICAvLyAgIC8vIG1pblkgPSBNYXRoLm1heChtaW5ZLCAwKTtcbiAgICAvLyAgIC8qIGZvciAodmFyIGkgaW4gZWxlbWVudHMpIHtcbiAgICAvLyAgICBlbGVtZW50c1tpXS50cmFuc2xhdGUoLW1pblgsIC1taW5ZKTtcbiAgICAvLyAgICBlbGVtZW50c1tpXS5sZWZ0IC09IG1pblg7XG4gICAgLy8gICAgZWxlbWVudHNbaV0ucGF0aE9mZnNldC54IC09IG1pblg7XG4gICAgLy8gICAgZWxlbWVudHNbaV0udG9wIC09IG1pblk7XG4gICAgLy8gICAgZWxlbWVudHNbaV0ucGF0aE9mZnNldC55IC09IG1pblk7XG4gICAgLy8gICAgfSovXG4gICAgLy8gfWVsc2V7XG4gICAgLy8gICBfVyA9IDE7XG4gICAgLy8gICBfSCA9IDE7XG4gICAgLy8gfVxuXG4gICAgdmFyIHNjYWxlWCA9IG9iamVjdC53aWR0aCA/IG9iamVjdC53aWR0aCAvIGVsLndpZHRoIDogbnVsbCxcbiAgICAgIHNjYWxlWSA9IG9iamVjdC5oZWlnaHQgPyBvYmplY3QuaGVpZ2h0IC8gZWwuaGVpZ2h0IDogbnVsbDtcbiAgICBpZiAoc2NhbGVYICYmICFzY2FsZVkpIHtcbiAgICAgIHNjYWxlWSA9IHNjYWxlWDtcbiAgICB9XG4gICAgaWYgKHNjYWxlWSAmJiAhc2NhbGVYKSB7XG4gICAgICBzY2FsZVggPSBzY2FsZVk7XG4gICAgfVxuICAgIGlmICghc2NhbGVZICYmICFzY2FsZVgpIHtcbiAgICAgIHNjYWxlWCA9IHNjYWxlWSA9IDE7XG4gICAgfVxuICAgIC8vIGNvbnNvbGUubG9nKG9iamVjdC53aWR0aCxlbC53aWR0aCxvYmplY3QuaGVpZ2h0LGVsLmhlaWdodClcbiAgICAvLyBjb25zb2xlLmxvZyhlbCk7XG4gICAgZWwuc2V0KCB7XG4gICAgICBzY2FsZVg6IHNjYWxlWCAsXG4gICAgICBzY2FsZVk6IHNjYWxlWVxuICAgIH0pO1xuXG4gICAgY2FsbGJhY2soZWwpO1xuICB9KTtcblxuICAvLyBmYWJyaWMubG9hZFNWR0Zyb21VUkwodXJsLGZ1bmN0aW9uKGVscyl7XG4gIC8vICAgY2FsbGJhY2soZmFicmljLlBhdGhHcm91cC5mcm9tRWxlbWVudHMoZWxzLCBvYmplY3QpKTtcbiAgLy8gfSk7XG59O1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9zaGFwZXMvUGF0aEdyb3VwLmpzIiwiJ3VzZSBzdHJpY3QnO1xuXG5cbnZhciBfc2V0X29iamVjdF9zY2FsZV9vdmVyd3JpdHRlbiA9IGZhYnJpYy5DYW52YXMucHJvdG90eXBlLl9zZXRPYmplY3RTY2FsZTtcbnZhciBfc2V0dXBfY3VycmVudF90cmFuc2Zvcm0gPSBmYWJyaWMuQ2FudmFzLnByb3RvdHlwZS5fc2V0dXBDdXJyZW50VHJhbnNmb3JtO1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5DYW52YXMucHJvdG90eXBlLCB7XG4gIF9zZXR1cEN1cnJlbnRTY2FsZVRyYW5zZm9ybTogX3NldHVwX2N1cnJlbnRfdHJhbnNmb3JtLFxuICBfc2V0dXBDdXJyZW50VHJhbnNmb3JtOiBmdW5jdGlvbiAoZSwgdGFyZ2V0KSB7XG4gICAgaWYgKCF0YXJnZXQpcmV0dXJuO1xuICAgIGlmICh0YXJnZXQuc2V0dXBDdXJyZW50VHJhbnNmb3JtKSB7XG4gICAgICByZXR1cm4gdGFyZ2V0LnNldHVwQ3VycmVudFRyYW5zZm9ybShlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHRhcmdldC5yZXNpemFibGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3NldHVwQ3VycmVudFJlc2l6ZVRyYW5zZm9ybShlLCB0YXJnZXQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3NldHVwQ3VycmVudFNjYWxlVHJhbnNmb3JtLmNhbGwodGhpcywgZSwgdGFyZ2V0KTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIF9zZXRPYmplY3RTY2FsZTogZnVuY3Rpb24gKGxvY2FsTW91c2UsIHRyYW5zZm9ybSwgbG9ja1NjYWxpbmdYLCBsb2NrU2NhbGluZ1ksIGJ5LCBsb2NrU2NhbGluZ0ZsaXAsIF9kaW0pIHtcblxuICAgIHZhciB0ID0gdHJhbnNmb3JtLnRhcmdldDtcblxuICAgIGlmICghX2RpbSkge1xuICAgICAgdmFyIHN0cm9rZVdpZHRoID0gdC5zdHJva2UgPyB0LnN0cm9rZVdpZHRoIDogMDtcbiAgICAgIF9kaW0gPSB7XG4gICAgICAgIHg6ICh0LndpZHRoICsgKHN0cm9rZVdpZHRoIC8gMikpLFxuICAgICAgICB5OiAodC5oZWlnaHQgKyAoc3Ryb2tlV2lkdGggLyAyKSlcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAodC5zZXRPYmplY3RTY2FsZSkge1xuICAgICAgcmV0dXJuIHQuc2V0T2JqZWN0U2NhbGUobG9jYWxNb3VzZSwgdHJhbnNmb3JtLFxuICAgICAgICBsb2NrU2NhbGluZ1gsIGxvY2tTY2FsaW5nWSwgYnksIGxvY2tTY2FsaW5nRmxpcCwgX2RpbSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgaWYgKHQucmVzaXphYmxlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9zZXRPYmplY3RTaXplKGxvY2FsTW91c2UsIHRyYW5zZm9ybSxcbiAgICAgICAgICBsb2NrU2NhbGluZ1gsIGxvY2tTY2FsaW5nWSwgYnksIGxvY2tTY2FsaW5nRmxpcCwgX2RpbSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gX3NldF9vYmplY3Rfc2NhbGVfb3ZlcndyaXR0ZW4uY2FsbCh0aGlzLCBsb2NhbE1vdXNlLCB0cmFuc2Zvcm0sXG4gICAgICAgICAgbG9ja1NjYWxpbmdYLCBsb2NrU2NhbGluZ1ksIGJ5LCBsb2NrU2NhbGluZ0ZsaXAsIF9kaW0pO1xuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgX3NldE9iamVjdFNpemU6IGZ1bmN0aW9uIChsb2NhbE1vdXNlLCB0cmFuc2Zvcm0sIGxvY2tTY2FsaW5nWCwgbG9ja1NjYWxpbmdZLCBieSwgbG9ja1NjYWxpbmdGbGlwLCBfZGltKSB7XG5cbiAgICB2YXIgdGFyZ2V0ID0gdHJhbnNmb3JtLnRhcmdldCwgZm9yYmlkU2NhbGluZ1ggPSBmYWxzZSwgZm9yYmlkU2NhbGluZ1kgPSBmYWxzZTtcbiAgICB2YXIgX3N0cm9rZSA9IHRyYW5zZm9ybS50YXJnZXQuc3Ryb2tlV2lkdGggfHwgMDtcbiAgICB0cmFuc2Zvcm0ubmV3V2lkdGggPSB0aGlzLndpZHRoICogKChsb2NhbE1vdXNlLnggLyB0cmFuc2Zvcm0uc2NhbGVYKSAvICh0aGlzLndpZHRoICsgX3N0cm9rZSkpO1xuICAgIHRyYW5zZm9ybS5uZXdIZWlnaHQgPSB0aGlzLmhlaWdodCAqICgobG9jYWxNb3VzZS55IC8gdHJhbnNmb3JtLnNjYWxlWSkgLyAodGhpcy5oZWlnaHQgKyBfc3Ryb2tlKSk7XG5cbiAgICBpZih0aGlzLndob2xlQ29vcmRpbmF0ZXMgfHwgdGFyZ2V0Lndob2xlQ29vcmRpbmF0ZXMpe1xuICAgICAgdHJhbnNmb3JtLm5ld1dpZHRoID0gTWF0aC5yb3VuZCh0cmFuc2Zvcm0ubmV3V2lkdGgpO1xuICAgICAgdHJhbnNmb3JtLm5ld0hlaWdodCA9IE1hdGgucm91bmQodHJhbnNmb3JtLm5ld0hlaWdodCk7XG4gICAgfVxuICAgIGlmKHRyYW5zZm9ybS5uZXdIZWlnaHQgPCAwICl7XG4gICAgICB0YXJnZXQudG9wID0gdHJhbnNmb3JtLnRvcCAtIHRyYW5zZm9ybS5uZXdIZWlnaHQ7XG4gICAgfVxuICAgIGlmICh0YXJnZXQubWluV2lkdGggJiYgdHJhbnNmb3JtLm5ld1dpZHRoIDw9IHRhcmdldC5taW5XaWR0aCkge1xuICAgICAgdHJhbnNmb3JtLm5ld1dpZHRoID0gdGFyZ2V0Lm1pbldpZHRoO1xuICAgIH1cbiAgICBpZiAodGFyZ2V0Lm1pbkhlaWdodCAmJiB0cmFuc2Zvcm0ubmV3SGVpZ2h0IDw9IHRhcmdldC5taW5IZWlnaHQpIHtcbiAgICAgIHRyYW5zZm9ybS5uZXdIZWlnaHQgPSB0YXJnZXQubWluSGVpZ2h0O1xuICAgIH1cbiAgICBpZiAobG9ja1NjYWxpbmdGbGlwICYmIHRyYW5zZm9ybS5uZXdXaWR0aCA8IHRhcmdldC53aWR0aCkge1xuICAgICAgZm9yYmlkU2NhbGluZ1ggPSB0cnVlO1xuICAgIH1cbiAgICBpZiAobG9ja1NjYWxpbmdGbGlwICYmIHRyYW5zZm9ybS5uZXdIZWlnaHQgPCB0YXJnZXQuaGVpZ2h0KSB7XG4gICAgICBmb3JiaWRTY2FsaW5nWSA9IHRydWU7XG4gICAgfVxuXG4gICAgaWYgKGJ5ID09PSAnZXF1YWxseScpIHtcbiAgICAgIGZvcmJpZFNjYWxpbmdYIHx8IGZvcmJpZFNjYWxpbmdZIHx8IHRoaXMuX3Jlc2l6ZU9iamVjdEVxdWFsbHkobG9jYWxNb3VzZSwgdGFyZ2V0LCB0cmFuc2Zvcm0sIF9kaW0pO1xuICAgIH1cbiAgICBlbHNlIGlmICghYnkpIHtcbiAgICAgIGZvcmJpZFNjYWxpbmdYIHx8IHRhcmdldC5zZXRXaWR0aCh0cmFuc2Zvcm0ubmV3V2lkdGgpO1xuICAgICAgZm9yYmlkU2NhbGluZ1kgfHwgdGFyZ2V0LnNldEhlaWdodCh0cmFuc2Zvcm0ubmV3SGVpZ2h0KTtcbiAgICB9XG4gICAgZWxzZSBpZiAoYnkgPT09ICd4JyAmJiAhdGFyZ2V0LmdldCgnbG9ja1VuaVNjYWxpbmcnKSkge1xuICAgICAgZm9yYmlkU2NhbGluZ1ggfHwgdGFyZ2V0LnNldFdpZHRoKHRyYW5zZm9ybS5uZXdXaWR0aCk7XG4gICAgfVxuICAgIGVsc2UgaWYgKGJ5ID09PSAneScgJiYgIXRhcmdldC5nZXQoJ2xvY2tVbmlTY2FsaW5nJykpIHtcbiAgICAgIGZvcmJpZFNjYWxpbmdZIHx8IHRhcmdldC5zZXRIZWlnaHQodHJhbnNmb3JtLm5ld0hlaWdodCk7XG4gICAgfVxuICAgIHJldHVybiAhZm9yYmlkU2NhbGluZ1ggJiYgIWZvcmJpZFNjYWxpbmdZO1xuICAgIC8vdHJhbnNmb3JtLm5ld1dpZHRoIC09IF9zdHJva2U7XG4gICAgLy90cmFuc2Zvcm0ubmV3SGVpZ2h0IC09IF9zdHJva2U7XG4gIH0sXG4gIF9zZXR1cEN1cnJlbnRSZXNpemVUcmFuc2Zvcm06IGZ1bmN0aW9uIChlLCB0YXJnZXQpIHtcbiAgICB0aGlzLl9zZXR1cEN1cnJlbnRTY2FsZVRyYW5zZm9ybShlLCB0YXJnZXQpO1xuICAgIHRoaXMuX2N1cnJlbnRUcmFuc2Zvcm0ub3JpZ2luYWwuaGVpZ2h0ID0gdGFyZ2V0LmhlaWdodDtcbiAgICB0aGlzLl9jdXJyZW50VHJhbnNmb3JtLm9yaWdpbmFsLndpZHRoID0gdGFyZ2V0LndpZHRoO1xuICB9LFxuICBfcmVzaXplT2JqZWN0RXF1YWxseTogZnVuY3Rpb24gKGxvY2FsTW91c2UsIHRhcmdldCwgdHJhbnNmb3JtLCBfZGltKSB7XG5cbiAgICB2YXIgZGlzdCA9IGxvY2FsTW91c2UueSArIGxvY2FsTW91c2UueCxcbiAgICAgIGxhc3REaXN0ID0gX2RpbS55ICogdHJhbnNmb3JtLm9yaWdpbmFsLmhlaWdodCAvIHRhcmdldC5oZWlnaHQgK1xuICAgICAgICBfZGltLnggKiB0cmFuc2Zvcm0ub3JpZ2luYWwud2lkdGggLyB0YXJnZXQud2lkdGg7XG5cbiAgICB0cmFuc2Zvcm0ubmV3V2lkdGggPSB0cmFuc2Zvcm0ub3JpZ2luYWwud2lkdGggKiBkaXN0IC8gbGFzdERpc3Q7XG4gICAgdHJhbnNmb3JtLm5ld0hlaWdodCA9IHRyYW5zZm9ybS5vcmlnaW5hbC5oZWlnaHQgKiBkaXN0IC8gbGFzdERpc3Q7XG5cbiAgICB2YXIgcmF0aW8gPSB0cmFuc2Zvcm0ub3JpZ2luYWwuaGVpZ2h0IC8gdHJhbnNmb3JtLm9yaWdpbmFsLndpZHRoO1xuICAgIGlmIChyYXRpbyA+IDEpIHtcbiAgICAgIGlmICh0YXJnZXQubWluV2lkdGggJiYgdHJhbnNmb3JtLm5ld1dpZHRoIDw9IHRhcmdldC5taW5XaWR0aCkge1xuICAgICAgICB0cmFuc2Zvcm0ubmV3V2lkdGggPSB0YXJnZXQubWluV2lkdGg7XG4gICAgICAgIHRyYW5zZm9ybS5uZXdIZWlnaHQgPSB0YXJnZXQubWluSGVpZ2h0ICogcmF0aW87XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICh0YXJnZXQubWluSGVpZ2h0ICYmIHRyYW5zZm9ybS5uZXdIZWlnaHQgPD0gdGFyZ2V0Lm1pbkhlaWdodCkge1xuICAgICAgICB0cmFuc2Zvcm0ubmV3SGVpZ2h0ID0gdGFyZ2V0Lm1pbkhlaWdodDtcbiAgICAgICAgdHJhbnNmb3JtLm5ld1dpZHRoID0gdGFyZ2V0Lm1pbldpZHRoIC8gcmF0aW87XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGFyZ2V0LnNldFdpZHRoKHRyYW5zZm9ybS5uZXdXaWR0aCk7XG4gICAgdGFyZ2V0LnNldEhlaWdodCh0cmFuc2Zvcm0ubmV3SGVpZ2h0KTtcbiAgfVxufSk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL21vZHVsZXMvcmVzaXphYmxlLmpzIiwiJ3VzZSBzdHJpY3QnO1xuXG5pZighZmFicmljLkZyYW1lKXtcbiAgcmVxdWlyZShcIi4vLi4vc2hhcGVzL2ZyYW1lXCIpO1xufVxuaWYoIWZhYnJpYy5PYmplY3QucHJvdG90eXBlLl9pbml0Q2xpcHBpbmcpe1xuICByZXF1aXJlKFwiLi8uLi9tb2R1bGVzL2NsaXBUb1wiKTtcbn1cblxuLy9mYWJyaWMuRFBJIHRvZG8gd2h5IGRvIG5vdCB1c2UgaXQ/XG4vKipcbiogQGF1dGhvciBEZW5pcyBQb25vbWFyZXZcbiogQGVtYWlsIGRlbi5wb25vbWFyZXZAZ21haWwuY29tXG4qL1xuXG5mYWJyaWMuUGhvdG8gPSBmYWJyaWMudXRpbC5jcmVhdGVDbGFzcyhmYWJyaWMuRnJhbWUsIHtcbiAgdHlwZTogJ3Bob3RvJyxcbiAgZnJhbWVUb29sOiBmYWxzZSxcbiAgaW1hZ2VUb29sczogZmFsc2UsXG4gIGZpbHRlclRvb2w6IGZhbHNlLFxuICBzdGF0ZVByb3BlcnRpZXM6IGZhYnJpYy5GcmFtZS5wcm90b3R5cGUuc3RhdGVQcm9wZXJ0aWVzLmNvbmNhdChbXCJmcmFtZVwiXSksXG4gIF9zY2FsaW5nX2V2ZW50c19lbmFibGVkOiB0cnVlLFxuXG4gIGNsb25lU3luYzogZnVuY3Rpb24ob3B0aW9ucyl7XG4gICAgdmFyIF9mcmFtZSA9IG5ldyBmYWJyaWMuUGhvdG8odGhpcyk7XG4gICAgb3B0aW9ucyAmJiBfZnJhbWUuc2V0KG9wdGlvbnMpO1xuICAgIHJldHVybiBfZnJhbWU7XG4gIH0sXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uIChvcHRpb25zKSB7XG5cbiAgICBvcHRpb25zIHx8ICggb3B0aW9ucyA9IHt9KTtcbiAgICB0aGlzLmNhbGxTdXBlcignaW5pdGlhbGl6ZScsb3B0aW9ucyk7XG5cbiAgICB0aGlzLmRwaSA9IDA7XG4gICAgdGhpcy5fY3JlYXRlX3NpZ24oKTtcbiAgICB0aGlzLl9zZXRfYm9yZGVyKG9wdGlvbnMuYm9yZGVyICwgXCJib3JkZXJcIik7XG4gICAgdGhpcy5fc2V0X2JvcmRlcihvcHRpb25zLmJvcmRlcjIsXCJib3JkZXIyXCIpO1xuICAgIHRoaXMuX3NldF9mcmFtZShvcHRpb25zLmZyYW1lKTtcblxuICAgIHRoaXMub24oe1xuICAgICAgXCJhZGRlZFwiOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX2NoZWNrX2RwaSgpO1xuICAgICAgfSxcbiAgICAgIFwic2NhbGluZ1wiOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX2FwcGx5X2ZyYW1lKCk7XG4gICAgICAgIHRoaXMuX3VwZGF0ZV9mcmFtZSgpO1xuICAgICAgICB0aGlzLl9jaGVja19kcGkoKTtcbiAgICAgIH0sXG4gICAgICBcImNsaXBwaW5nOmVudGVyZWRcIjogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5fZmFicmljX2ZyYW1lKSB7XG4gICAgICAgICAgaWYodGhpcy5mcmFtZS5wb3NpdGlvbiAhPT0gXCJiYWNrXCIpe1xuICAgICAgICAgICAgdGhpcy5fcmVzdG9yZU9iamVjdFN0YXRlKHRoaXMuX2ZhYnJpY19mcmFtZSk7XG4gICAgICAgICAgICB0aGlzLnJlbW92ZSh0aGlzLl9mYWJyaWNfZnJhbWUpO1xuICAgICAgICAgICAgdGhpcy5jYW52YXMuYWRkKHRoaXMuX2ZhYnJpY19mcmFtZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgXCJjbGlwcGluZzpleGl0ZWRcIjogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5fZmFicmljX2ZyYW1lKSB7XG4gICAgICAgICAgaWYodGhpcy5mcmFtZS5wb3NpdGlvbiAhPT0gXCJiYWNrXCIpIHtcbiAgICAgICAgICAgIHRoaXMuY2FudmFzLnJlbW92ZSh0aGlzLl9mYWJyaWNfZnJhbWUpO1xuICAgICAgICAgICAgdGhpcy5hZGQodGhpcy5fZmFicmljX2ZyYW1lKTtcbiAgICAgICAgICAgIHRoaXMuX2FwcGx5X2ZyYW1lKCk7XG4gICAgICAgICAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfSxcblxuICBfYXBwbHlfZnJhbWU6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLl9mYWJyaWNfZnJhbWUgJiYgdGhpcy5fZmFicmljX2ZyYW1lLnNldCh7XG4gICAgICBsZWZ0OiAwICxcbiAgICAgIHRvcDogMCxcbiAgICAgIHdpZHRoIDogdGhpcy53aWR0aCxcbiAgICAgIGhlaWdodDogIHRoaXMuaGVpZ2h0XG4gICAgfSlcbiAgfSxcbiAgX2NyZWF0ZV9zaWduOiBmdW5jdGlvbiAoKSB7XG5cblxuICAgIHRoaXMuX2ZhYnJpY19zaWduID0gbmV3IGZhYnJpYy5UZXh0KFwi74GxXCIsIHtcbiAgICAgIGZpbGw6IFwieWVsbG93XCIsXG4gICAgICBzdHJva2U6IFwiYmxhY2tcIixcbiAgICAgIGV2ZW50ZWQ6IGZhbHNlLFxuICAgICAgdmlzaWJsZTogZmFsc2UsXG4gICAgICBoZWlnaHQ6IDIwLFxuICAgICAgZm9udFNpemU6IDI0LFxuICAgICAgZm9udEZhbWlseTogXCJGb250QXdlc29tZVwiLFxuICAgICAgbGVmdDogdGhpcy53aWR0aCAvIDIgLSAzMCxcbiAgICAgIHRvcDogdGhpcy5oZWlnaHQgLyAyIC0gMzUsXG4gICAgICB0ZXh0QWxpZ246IFwiY2VudGVyXCJcbiAgICB9KTtcbiAgICB0aGlzLl9lbGVtZW50c190b191cGRhdGUucHVzaCh7XG4gICAgICBlbGVtZW50OiB0aGlzLl9mYWJyaWNfc2lnbixcbiAgICAgIGJvdHRvbTogMzUsXG4gICAgICByaWdodDogMzBcbiAgICB9KTtcblxuICAgIHRoaXMuX2ZhYnJpY19zaWduX3RleHQgPSBuZXcgZmFicmljLlRleHQoTWF0aC5mbG9vcih0aGlzLmRwaSkudG9TdHJpbmcoKSwge1xuICAgICAgZmlsbDogXCJ5ZWxsb3dcIixcbiAgICAgIGV2ZW50ZWQ6IGZhbHNlLFxuICAgICAgdmlzaWJsZTogZmFsc2UsXG4gICAgICBoZWlnaHQ6IDUsXG4gICAgICBmb250U2l6ZTogMTAsXG4gICAgICBsZWZ0OiB0aGlzLndpZHRoIC8gMiAtIDI3LFxuICAgICAgdG9wOiB0aGlzLmhlaWdodCAvIDIgLSAxMixcbiAgICAgIHRleHRBbGlnbjogXCJjZW50ZXJcIlxuICAgIH0pO1xuXG4gICAgdGhpcy5fZWxlbWVudHNfdG9fdXBkYXRlLnB1c2goe1xuICAgICAgZWxlbWVudDogdGhpcy5fZmFicmljX3NpZ25fdGV4dCxcbiAgICAgIGJvdHRvbTogMTIsXG4gICAgICByaWdodDogMjdcbiAgICB9KTtcbiAgICB0aGlzLmFkZCh0aGlzLl9mYWJyaWNfc2lnbik7XG4gICAgdGhpcy5hZGQodGhpcy5fZmFicmljX3NpZ25fdGV4dCk7XG4gIH0sXG4gIF9jaGVja19kcGk6IGZ1bmN0aW9uICgpIHtcbiAgICAvL3RoaXMuZHBpX3dhcm5pbmcgPSB0cnVlO1xuICAgIHRoaXMuZHBpID0gdGhpcy5nZXREUEkoKTtcbiAgICBpZiAoIXRoaXMuY2FudmFzKXJldHVybjsvL3RvZG9cblxuICAgIGlmICh0aGlzLmNhbnZhcy5kcGkgJiYgdGhpcy5kcGkgPCB0aGlzLmNhbnZhcy5kcGkpIHtcbiAgICAgIHRoaXMuX2ZhYnJpY19zaWduLnNldFZpc2libGUodHJ1ZSk7XG4gICAgICB0aGlzLl9mYWJyaWNfc2lnbl90ZXh0LnNldFZpc2libGUodHJ1ZSk7XG4gICAgICB0aGlzLl9mYWJyaWNfc2lnbl90ZXh0LnNldFRleHQoTWF0aC5mbG9vcih0aGlzLmRwaSkudG9TdHJpbmcoKSk7XG4gICAgICAvL3RoaXMuc2xpZGUuZHBpX3dhcm5pbmcgPSB0cnVlO1xuICAgIH0gZWxzZSB7XG5cbiAgICAgIHRoaXMuX2ZhYnJpY19zaWduLnNldFZpc2libGUoZmFsc2UpO1xuICAgICAgdGhpcy5fZmFicmljX3NpZ25fdGV4dC5zZXRWaXNpYmxlKGZhbHNlKTtcbiAgICAgIC8vaWYoIXRoaXMuX2ZhYnJpY19zaWduKXJldHVybjtcbiAgICAgIC8vdGhpcy5yZW1vdmUodGhpcy5fZmFicmljX3NpZ24pO1xuICAgICAgLy9kZWxldGUgdGhpcy5fZmFicmljX3NpZ247XG4gICAgICAvL3RoaXMuc2xpZGUuZHBpX3dhcm5pbmcgPSB0aGlzLnNsaWRlLmNoZWNrRFBJKCk7XG4gICAgfVxuICB9LFxuICBnZXREUEk6IGZ1bmN0aW9uICgpIHtcblxuICAgIHJldHVybjtcbiAgICBpZiAoIXRoaXMuX29yaWdpbmFsKXJldHVybiB0aGlzLmNhbnZhcy5kcGk7XG5cbiAgICB2YXIgSU5DSCA9IDI1LjQ7IC8vbW1cblxuICAgIHZhciBkaW1zID0gW107XG5cbiAgICBkaW1zLnB1c2godGhpcy5fb3JpZ2luYWwud2lkdGggLyAodGhpcy53aWR0aCAvIElOQ0gpKTtcbiAgICBkaW1zLnB1c2godGhpcy5fb3JpZ2luYWwuaGVpZ2h0IC8gKCB0aGlzLmhlaWdodCAvIElOQ0gpKTtcblxuXG4gICAgdmFyIF9kcGkgPSBkaW1zWzBdO1xuXG4gICAgZm9yICh2YXIgaSA9IDE7IGkgPCBkaW1zLmxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAoZGltc1tpXSA8IF9kcGkpIHtcbiAgICAgICAgX2RwaSA9IGRpbXNbaV1cbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy5kcGkgPSBfZHBpICogMTsvLy90aGlzLmNhbnZhcy5zY2FsZVg7XG5cbiAgICByZXR1cm4gX2RwaTtcbiAgfSxcbiAgc3VwcG9ydGVkVHlwZXM6IFtcImltYWdlXCJdLFxuXG4gIF9zZXRfZWxlbWVudDogZnVuY3Rpb24gKG9wdGlvbnMsIGNhbGxiYWNrKSB7XG5cbiAgICBpZiAob3B0aW9ucy50eXBlID09IFwiaW1hZ2VcIikge1xuICAgICAgdGhpcy5fb3JpZ2luYWwgPSBvcHRpb25zLm9yaWdpbmFsO1xuICAgICAgZmFicmljLkltYWdlLmZyb21VUkwoKGZhYnJpYy5mcmFtZXNQYXRoIHx8IFwiXCIgKSArIG9wdGlvbnMuc3JjLCBmdW5jdGlvbiAobykge1xuICAgICAgICBvLm9uKFwicm90YXRpbmdcIiwgZmFicmljLnV0aWwuc3RlcFJvdGF0aW5nLmJpbmQobykpO1xuXG4gICAgICAgIHRoaXMuX2NoZWNrX2RwaSgpO1xuXG4gICAgICAgIGNhbGxiYWNrKG8pO1xuICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICB9XG5cbiAgfSxcblxuXG4gIC8qKlxuICAgKiDvv73vv73vv73vv73vv73vv73vv73vv73vv70g77+977+977+977+977+9XG4gICAqIEBwYXJhbSBkYXRhIC0g77+977+977+977+977+9IO+/ve+/ve+/ve+/ve+/vVxuICAgKi9cbiAgX3NldF9ib3JkZXI6IGZ1bmN0aW9uIChib3JkZXIsbmFtZSkge1xuICAgIHRoaXNbbmFtZV0gPSBib3JkZXI7XG4gICAgaWYoIWJvcmRlcilyZXR1cm47XG4gICAgdGhpc1tcIl9mYWJyaWNcIiArIG5hbWVdID0gbmV3IGZhYnJpYy5QYXRoKHRoaXMuX2ZhYnJpY19zaGFwZS5wYXRoLGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoe1xuICAgICAgZmlsbDogXCJ0cmFuc3BhcmVudFwiLFxuICAgICAgc2VsZWN0YWJsZTogZmFsc2UsXG4gICAgICBvcmlnaW5YOiBcImNlbnRlclwiLFxuICAgICAgb3JpZ2luWTogXCJjZW50ZXJcIlxuICAgIH0sYm9yZGVyKSk7XG5cbiAgICB0aGlzLmFkZCh0aGlzW1wiX2ZhYnJpY1wiICsgbmFtZV0pO1xuICAgIGlmKGJvcmRlci5wb3NpdGlvbiA9PSBcImJlZm9yZVwiKXtcbiAgICAgIHRoaXMuX29iamVjdHMudW5zaGlmdCh0aGlzLl9vYmplY3RzLnBvcCgpKTtcbiAgICB9XG5cbiAgICB2YXIgb3B0aW9ucyA9IHtcbiAgICAgIGxlZnQ6ICAgdGhpcy5fZmFicmljX3NoYXBlLmxlZnQgKyB0aGlzLndpZHRoLzIsXG4gICAgICB0b3A6ICAgIHRoaXMuX2ZhYnJpY19zaGFwZS50b3AgKyB0aGlzLmhlaWdodC8yLFxuICAgICAgc2NhbGVYOiB0aGlzLl9mYWJyaWNfc2hhcGUuc2NhbGVYICogKGJvcmRlci5zY2FsZVggfHwgMSksXG4gICAgICBzY2FsZVk6IHRoaXMuX2ZhYnJpY19zaGFwZS5zY2FsZVkgKiAoYm9yZGVyLnNjYWxlWSB8fCAxKVxuICAgIH07XG5cbiAgICB0aGlzW1wiX2ZhYnJpY1wiICsgbmFtZV0uc2V0KG9wdGlvbnMpO1xuICB9LFxuICBzZXRGcmFtZTogZnVuY3Rpb24gKGZyYW1lLGNiKSB7XG5cbiAgICBpZihmcmFtZSAmJiBmcmFtZS5jb25zdHJ1Y3RvciA9PVN0cmluZyl7XG4gICAgICBmcmFtZSA9IHRoaXMuZnJhbWVzW2ZyYW1lXTtcbiAgICB9XG5cbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgIGlmKGZyYW1lICYmIGZyYW1lLnNyYyl7XG5cbiAgICAgIGZhYnJpYy51dGlsLmxvYWRJbWFnZShmcmFtZS5zcmMsIGZ1bmN0aW9uIChpbWcpIHtcbiAgICAgICAgZnJhbWUuaW1hZ2UgPSBpbWc7XG4gICAgICAgIF90aGlzLl9zZXRfZnJhbWUoZnJhbWUpO1xuICAgICAgICBfdGhpcy5jYW52YXMgJiYgX3RoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgICAgICBjYiAmJiBjYigpO1xuICAgICAgfSlcbiAgICB9ZWxzZXtcbiAgICAgIF90aGlzLl9zZXRfZnJhbWUoZnJhbWUpO1xuICAgICAgX3RoaXMuY2FudmFzICYmIF90aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICAgIGNiICYmIGNiKCk7XG4gICAgfVxuICB9LFxuICBfdXBkYXRlX2ZyYW1lOiBmdW5jdGlvbiAoKSB7XG4gICAgaWYodGhpcy5mcmFtZSAmJiB0aGlzLmZyYW1lLmltYWdlICYmIHRoaXMuZnJhbWUuc2xpY2UpIHtcbiAgICAgIHZhciBfY2FudmFzID0gdGhpcy5fZmFicmljX2ZyYW1lLl9lbGVtZW50O1xuICAgICAgX2NhbnZhcy53aWR0aCA9IHRoaXMud2lkdGg7XG4gICAgICBfY2FudmFzLmhlaWdodCA9IHRoaXMuaGVpZ2h0O1xuICAgICAgZmFicmljLnV0aWwuZHJhd0JvcmRlckltYWdlKF9jYW52YXMsIHRoaXMuZnJhbWUuaW1hZ2UsIHRoaXMuZnJhbWUpO1xuICAgIH1cbiAgfSxcbiAgX3NldF9mcmFtZTogZnVuY3Rpb24gKGZyYW1lKSB7XG4gICAgaWYodGhpcy5fZmFicmljX2ZyYW1lKXtcbiAgICAgIHRoaXMucmVtb3ZlKHRoaXMuX2ZhYnJpY19mcmFtZSk7XG4gICAgICBkZWxldGUgdGhpcy5fZmFicmljX2ZyYW1lO1xuICAgIH1cbiAgICBpZihmcmFtZSAmJiBmcmFtZS5pbWFnZSkge1xuXG4gICAgICAvL1xuICAgICAgLy9pZiAoIWZyYW1lW1wiYm9yZGVyX2ltYWdlXCJdKSB7XG4gICAgICAvLyAgICBpbWcud2lkdGggPSB0aGlzLndpZHRoO1xuICAgICAgLy8gICAgaW1nLmhlaWdodCA9IHRoaXMuaGVpZ2h0O1xuICAgICAgLy99XG5cbiAgICAgIGlmIChmcmFtZS53aWR0aCAmJiBmcmFtZS5zbGljZSkge1xuXG4gICAgICAgIC8vQ2FudmFzIGZvciBOb2RlSlNcbiAgICAgICAgdmFyIGNhbnZhcyA9IHR5cGVvZiBDYW52YXMgIT09ICd1bmRlZmluZWQnICYmIG5ldyBDYW52YXMoKSB8fCBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpO1xuXG4gICAgICAgIGNhbnZhcy53aWR0aCA9IHRoaXMud2lkdGg7XG4gICAgICAgIGNhbnZhcy5oZWlnaHQgPSB0aGlzLmhlaWdodDtcbiAgICAgICAgZmFicmljLnV0aWwuZHJhd0JvcmRlckltYWdlKGNhbnZhcywgZnJhbWUuaW1hZ2UsIGZyYW1lKTtcbiAgICAgICAgLy90b2RvXG4gICAgICAgIC8vdmFyIF9zcmMgPSBjYW52YXMudG9EYXRhVVJMKCk7XG4gICAgICAgIC8vdmFyIGltYWdlID0gbmV3IEltYWdlKCk7XG4gICAgICAgIC8vaW1hZ2Uuc3JjID0gX3NyYztcbiAgICAgICAgdGhpcy5fZmFicmljX2ZyYW1lID0gbmV3IGZhYnJpYy5JbWFnZShjYW52YXMpO1xuICAgICAgICAvL1xuICAgICAgICAvL3RoaXMuX2ZhYnJpY19mcmFtZS53aWR0aCA9IHRoaXMud2lkdGg7XG4gICAgICAgIC8vdGhpcy5fZmFicmljX2ZyYW1lLmhlaWdodCA9IHRoaXMuaGVpZ2h0O1xuXG4gICAgICAgIC8vdGhpcy5hZGQodGhpcy5fZmFicmljX2ZyYW1lKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuX2ZhYnJpY19mcmFtZSA9IG5ldyBmYWJyaWMuSW1hZ2UoZnJhbWUuaW1hZ2UpO1xuICAgICAgfVxuXG5cbiAgICAgIHRoaXMuX2ZhYnJpY19mcmFtZS5zZXQoe1xuICAgICAgICBvcmlnaW5YOiBcImNlbnRlclwiLFxuICAgICAgICBvcmlnaW5ZOiBcImNlbnRlclwiLFxuICAgICAgICBoYXNDb250cm9sczogZmFsc2UsXG4gICAgICAgIGV2ZW50ZWQ6IGZhbHNlXG4gICAgICB9KTtcblxuICAgICAgdGhpcy5hZGQodGhpcy5fZmFicmljX2ZyYW1lKTtcbiAgICAgIGlmKHRoaXMuZnJhbWUgJiYgdGhpcy5mcmFtZS5wb3NpdGlvbiA9PSBcImJhY2tcIil7XG4gICAgICAgIHRoaXMuX2ZhYnJpY19mcmFtZS5zZW5kVG9CYWNrKCk7XG4gICAgICB9XG4gICAgICB0aGlzLl9hcHBseV9mcmFtZSgpO1xuICAgIH1cbiAgICB0aGlzLmZyYW1lID0gZnJhbWU7XG4gIH0sXG5cblxuICAvKipcbiAgICog77+977+977+977+977+977+977+977+9IO+/ve+/ve+/ve+/ve+/ve+/ve+/ve+/vSDvv73vv73vv73vv73vv71cbiAgICogQHByaXZhdGVcbiAgICovXG4gIF9jcmVhdGVfZnJhbWU6IGZ1bmN0aW9uICgpIHtcblxuICAgIGlmICh0aGlzLmZyYW1lKSB7XG4gICAgICB0aGlzLmZyYW1lLndpZHRoID0gdGhpcy5fZmFicmljX2ltYWdlLndpZHRoO1xuICAgICAgdGhpcy5mcmFtZS5oZWlnaHQgPSB0aGlzLl9mYWJyaWNfaW1hZ2UuaGVpZ2h0O1xuICAgIH1cblxuICAgIHRoaXMuX2ZhYnJpY19mcmFtZSA9IG5ldyBmYWJyaWMuSW1hZ2UodGhpcy5mcmFtZSwge1xuICAgICAgb3JpZ2luWDogXCJjZW50ZXJcIixcbiAgICAgIG9yaWdpblk6IFwiY2VudGVyXCIsXG4gICAgICBwZXJQaXhlbFRhcmdldEZpbmQ6IHRydWUsXG4gICAgICB3aWR0aDogdGhpcy5kYXRhLmdlb21ldHJ5LndpZHRoLFxuICAgICAgaGVpZ2h0OiB0aGlzLmRhdGEuZ2VvbWV0cnkuaGVpZ2h0XG4gICAgfSk7XG4gIH0sXG4gIHRvT2JqZWN0OiBmdW5jdGlvbihwcm9wZXJ0aWVzVG9JbmNsdWRlKXtcbiAgICB2YXIgb2JqZWN0ID0gdGhpcy5jYWxsU3VwZXIoJ3RvT2JqZWN0Jyxwcm9wZXJ0aWVzVG9JbmNsdWRlKTtcbiAgICBkZWxldGUgb2JqZWN0LmVsZW1lbnQ7XG5cbiAgICBpZih0aGlzLmVsZW1lbnQpe1xuICAgICAgdmFyIF9vYmoyID0gdGhpcy5lbGVtZW50LnRvT2JqZWN0KCk7XG4gICAgICBvYmplY3Quc3JjID0gX29iajIuc3JjO1xuICAgICAgb2JqZWN0LmZpbHRlcnMgPSBfb2JqMi5maWx0ZXJzO1xuICAgIH1cbiAgICBvYmplY3QuZnJhbWUgPSBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKHt9LHRoaXMuZnJhbWUpO1xuXG4gICAgZGVsZXRlIG9iamVjdC5mcmFtZS5pbWFnZTtcbiAgICByZXR1cm4gb2JqZWN0O1xuICB9LFxuICBpbnNlcnRQaG90b0ZyYW1lczogZmFsc2UsXG4gIGluc2VydFBob3RvRmlsdGVycyA6IGZhbHNlXG59KTtcblxuXG4vLyBmYWJyaWMuUGhvdG8uZnJhbWVzTWFuYWdlciA9IHtcbi8vICAgYWN0aXZlT2JqZWN0OiBudWxsLFxuLy8gICBzaG93OiBmdW5jdGlvbihvYmplY3Qpe1xuLy8gICAgIHRoaXMuYWN0aXZlT2JqZWN0ID0gb2JqZWN0O1xuLy8gICAgIHRoaXMuZmlyZSgnc2hvdycsb2JqZWN0KTtcbi8vICAgfVxuLy8gfTtcbi8vIGZhYnJpYy51dGlsLm9ic2VydmFibGUoZmFicmljLlBob3RvLmZyYW1lc01hbmFnZXIpO1xuLy9cbi8vIHZhciBfT0JKX0FDVCA9IGZhYnJpYy5PYmplY3QucHJvdG90eXBlLmFjdGlvbnM7XG4vLyB2YXIgX1BITyA9IGZhYnJpYy5QaG90by5wcm90b3R5cGU7XG5cblxuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5QaG90by5wcm90b3R5cGUsIHtcbiAgZ2V0RnJhbWVzRGF0YSA6IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgX2ZpbHRlcnMgPSBmYWJyaWMuUGhvdG8uZ2V0RnJhbWVzTGlzdCh0aGlzKTtcbiAgICBmb3IgKHZhciBpIGluIHRoaXMuZnJhbWVzKSB7XG4gICAgICB2YXIgX2YgPSBmYWJyaWMudXRpbC5vYmplY3QuZmluZFdoZXJlKF9maWx0ZXJzLHt0eXBlOiBmYWJyaWMudXRpbC5zdHJpbmcuY2FwaXRhbGl6ZSh0aGlzLmZyYW1lc1tpXS50eXBlKX0pXG4gICAgICBpZihfZil7XG4gICAgICAgIF9mLmVuYWJsZWQgPSB0cnVlO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gX2ZpbHRlcnM7XG4gIH0sXG4gIGF2YWlsYWJsZUZyYW1lczogW1xuICAgIFwiY2xpcFBhdGhcIlxuICBdLFxuICBpbnNlcnRQaG90b0ZyYW1lczogZmFsc2UsXG4gIGFjdGlvbnMgOiBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5QaG90by5wcm90b3R5cGUuYWN0aW9ucyB8fCB7fSwge1xuICAgIHBob3RvRmlsdGVyczoge1xuICAgICAgdGl0bGU6IFwi0YTQuNC70YzRgtGAXCIsXG4gICAgICBjbGFzc05hbWU6IFwiZmEgZmEtZmlsdGVyXCIsXG4gICAgICBhY3Rpb246IGZ1bmN0aW9uKCl7XG4gICAgICAgIGZhYnJpYy5JbWFnZS5maWx0ZXJNYW5hZ2VyLnNob3codGhpcy5lbGVtZW50KTtcbiAgICAgIH1cbiAgICB9LFxuICAgIHJlbW92ZVdoaXRlRnJvbUJvcmRlcnM6IGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoe30sZmFicmljLkltYWdlLnByb3RvdHlwZS5hY3Rpb25zLnJlbW92ZVdoaXRlRnJvbUJvcmRlcnMse1xuICAgICAgdGFyZ2V0OiBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gdGhpcy5lbGVtZW50O1xuICAgICAgfVxuICAgIH0pLFxuICAgIHJldmVydENoYW5nZXM6IGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoe30sZmFicmljLkltYWdlLnByb3RvdHlwZS5hY3Rpb25zLnJldmVydENoYW5nZXMse1xuICAgICAgdGFyZ2V0OiBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gdGhpcy5lbGVtZW50O1xuICAgICAgfVxuICAgIH0pLFxuICAgIHBob3RvRnJhbWVzOiB7XG4gICAgICB0aXRsZTogXCLRgNCw0LzQvtGH0LrQuFwiLFxuICAgICAgY2xhc3NOYW1lOiBcImZhIGZhLWhlYXJ0LW9cIixcbiAgICAgIHR5cGU6IFwic2VsZWN0XCIsXG4gICAgICB0ZW1wbGF0ZVNlbGVjdGlvbjogZnVuY3Rpb24gKHN0YXRlLCBjb250YWluZXIpIHtcbiAgICAgICAgaWYgKHN0YXRlLmFueSkge1xuICAgICAgICAgIHJldHVybiBzdGF0ZS50ZXh0O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAkKCc8c3Bhbj48c3BhbiBjbGFzcz1cImNvbG9yLXNwYW5cIiBzdHlsZT1cImJhY2tncm91bmQtY29sb3I6JyArIHN0YXRlLnRleHQgKyAnXCI+PC9zcGFuPicgKyBzdGF0ZS50ZXh0ICsgJzwvc3Bhbj4nKTtcbiAgICAgIH0sXG4gICAgICB0ZW1wbGF0ZVJlc3VsdDogZnVuY3Rpb24gKHN0YXRlLCBjb250YWluZXIsIGRhdGEpIHtcbiAgICAgICAgdmFyICRlbCA9ICQoJzxzcGFuPicgKyBzdGF0ZS50ZXh0ICsgJzwvc3Bhbj4nKTtcbiAgICAgICAgaWYgKHN0YXRlLmlkICE9IFwibm9uZVwiKSB7XG4gICAgICAgICAgLyogdmFyICRjYW52YXMgPSAkKCc8Y2FudmFzPicpO1xuICAgICAgICAgIGZhYnJpYy51dGlsLmRyYXdGaWx0ZXIoJGNhbnZhc1swXSwgZGF0YS50YXJnZXQuc3JjLCBzdGF0ZS5pZCwge1xuICAgICAgICAgICAgaGVpZ2h0OiAyMlxuICAgICAgICAgIH0pO1xuICAgICAgICAgICRlbC5wcmVwZW5kKCRjYW52YXMpOyovXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuICRlbDtcbiAgICAgIH0sXG4gICAgICB2YWx1ZToge1xuICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2YWwsIGZyYW1lc0RhdGEpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyh2YWwsIGZyYW1lc0RhdGEpO1xuICAgICAgICAgIHZhciBvcHRpb25zID0gZmFsc2U7XG4gICAgICAgICAgaWYgKHZhbCA9PSBcIm5vbmVcIikge1xuICAgICAgICAgICAgdmFsID0gZmFsc2U7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhciBfZiA9IF8uZmluZFdoZXJlKGZyYW1lc0RhdGEsIHtpZDogdmFsfSk7XG4gICAgICAgICAgICBfZi5lbmFibGVkID0gIV9mLmVuYWJsZWQ7XG4gICAgICAgICAgICBmb3IgKHZhciBpIGluIF9mLm9wdGlvbnMpIHtcbiAgICAgICAgICAgICAgaWYgKCQuaXNOdW1lcmljKF9mLm9wdGlvbnNbaV0pKSB7XG4gICAgICAgICAgICAgICAgX2Yub3B0aW9uc1tpXSA9IHBhcnNlRmxvYXQoX2Yub3B0aW9uc1tpXSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChfZi5lbmFibGVkKSB7XG4gICAgICAgICAgICAgIG9wdGlvbnMgPSB7fTtcbiAgICAgICAgICAgICAgZm9yICh2YXIgaSBpbiBfZi5vcHRpb25zKSB7XG4gICAgICAgICAgICAgICAgb3B0aW9uc1tpXSA9IF9mLm9wdGlvbnNbaV0udmFsdWU7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuXG4gICAgICAgICAgfVxuICAgICAgICAgIHRoaXMuc2V0RnJhbWUodmFsKTtcbiAgICAgICAgfSxcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuZnJhbWUgPyB0aGlzLmZyYW1lLmlkIHx8IFwiY3VzdG9tXCIgOiBcIm5vbmVcIlxuICAgICAgICB9LFxuICAgICAgICBvcHRpb25zOiBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICB2YXIgX2ZyYW1lcyA9IHRoaXMuZ2V0RnJhbWVzRGF0YSgpO1xuICAgICAgICAgIHJldHVybiBbe1xuICAgICAgICAgICAgaWQ6ICdub25lJyxcbiAgICAgICAgICAgIHRleHQ6ICdvcmlnaW5hbCcsXG4gICAgICAgICAgICBlbmFibGVkOiAhdGhpcy5mcmFtZVxuICAgICAgICAgIH1dLmNvbmNhdChfZnJhbWVzKTtcblxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9KVxufSk7XG5cblxuXG5cbmZhYnJpYy5QaG90by5mcm9tT2JqZWN0ID0gZnVuY3Rpb24ob2JqZWN0LGNhbGxiYWNrKSB7XG4gIHZhciBfa2xhc3M9IHRoaXM7XG4gIHZhciBfYXBwID0gb2JqZWN0LmFwcGxpY2F0aW9uO1xuICBkZWxldGUgb2JqZWN0LmFwcGxpY2F0aW9uO1xuICBvYmplY3QgPSBmYWJyaWMudXRpbC5vYmplY3QuY2xvbmVEZWVwKG9iamVjdCk7XG4gIG9iamVjdC5hcHBsaWNhdGlvbiA9IF9hcHA7XG5cbiAgaWYob2JqZWN0LnNyYyl7XG4gICAgb2JqZWN0LmVsZW1lbnQgPSB7XG4gICAgICB0eXBlOiBcImltYWdlXCIsXG4gICAgICBzcmM6IG9iamVjdC5zcmMsXG4gICAgICBmaWx0ZXJzOiBvYmplY3QuZmlsdGVyc1xuICAgIH07XG5cbiAgICBkZWxldGUgb2JqZWN0LnNyYztcbiAgICBkZWxldGUgb2JqZWN0LmZpbHRlcnM7XG4gIH1cblxuXG4gIHZhciBjYiA9IGZhYnJpYy51dGlsLnF1ZXVlTG9hZCgzLGZ1bmN0aW9uKCl7XG4gICAgY2FsbGJhY2sgJiYgY2FsbGJhY2sobmV3IF9rbGFzcyhvYmplY3QpKTtcbiAgfSk7XG5cbiAgaWYob2JqZWN0LmVsZW1lbnQpe1xuICAgIGZhYnJpYy51dGlsLmNyZWF0ZU9iamVjdChvYmplY3QuZWxlbWVudCxmdW5jdGlvbihlbCl7XG4gICAgICBvYmplY3QuZWxlbWVudCA9IGVsO1xuICAgICAgY2IoKTtcbiAgICB9KTtcbiAgfWVsc2V7XG4gICAgY2IoKTtcbiAgfVxuXG5cbiAgaWYob2JqZWN0LmZyYW1lICYmIG9iamVjdC5mcmFtZS5zcmMpIHtcblxuICAgIGZhYnJpYy51dGlsLmxvYWRJbWFnZShvYmplY3QuZnJhbWUuc3JjLCBmdW5jdGlvbiAoaW1nKSB7XG4gICAgICBvYmplY3QuZnJhbWUuaW1hZ2UgPSBpbWc7XG4gICAgICBjYigpO1xuICAgIH0pXG4gIH1lbHNlIHtcbiAgICBjYigpO1xuICB9XG5cbiAgaWYob2JqZWN0LnNoYXBlICYmIG9iamVjdC5zaGFwZS5zcmMpe1xuICAgIGZhYnJpYy5sb2FkU1ZHRnJvbVVSTChvYmplY3Quc2hhcGUuc3JjLGZ1bmN0aW9uKHBhdGhzLG9wdGlvbnMpIHtcbiAgICAgIG9iamVjdC5zaGFwZS5wYXRocyAgPSBwYXRocztcbiAgICAgIGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQob2JqZWN0LnNoYXBlLG9wdGlvbnMpO1xuICAgICAgY2IoKTtcbiAgICB9KVxuICB9ZWxzZSB7XG4gICAgY2IoKTtcbiAgfVxuXG59O1xuXG5cbmZhYnJpYy5QaG90by5nZXRGcmFtZXNMaXN0ID0gZnVuY3Rpb24oZWwpe1xuXG4gIGVsID0gZWwgfHwgZmFicmljLlBob3RvLnByb3RvdHlwZTtcbiAgdmFyIGZyYW1lc0xpc3QgPSBbXTtcbiAgXy5mb3JFYWNoKGVsLmF2YWlsYWJsZUZyYW1lcywgZnVuY3Rpb24oZnJhbWVJZCl7XG4gICAgdmFyIF9kYXRhID0gZmFicmljLlBob3RvLmZyYW1lc1tmcmFtZUlkXTtcbiAgICBmcmFtZXNMaXN0LnB1c2goe1xuICAgICAgdGV4dDogX2RhdGEudGl0bGUgfHwgZnJhbWVJZCxcbiAgICAgIGlkOiBmcmFtZUlkLFxuICAgICAgZGF0YTogZmFicmljLnV0aWwub2JqZWN0LmNsb25lKF9kYXRhKVxuICAgIH0pXG4gIH0pO1xuXG4gIHJldHVybiBmcmFtZXNMaXN0O1xufTtcblxuZmFicmljLlBob3RvLmZyYW1lcyA9IHtcbiAgY2xpcFBhdGg6IHtcbiAgICBcInRpdGxlXCI6IFwi0KFsaXAtcGF0aCBzaGFwZVwiLFxuICAgIFwic2hhcGVcIjp7XG4gICAgICBcInBhdGhcIjogIFwiTSAyMzIuMDAwIDI1Mi4wMDAgTCAyNTIuMDAwIDI2Ni42NDEgTCAyNDkuMzIxIDI0Mi4wMDAgTCAyNzIuMDAwIDIzMi4wMDAgTCAyNDkuMzIxIDIyMi4wMDAgTCAyNTIuMDAwIDE5Ny4zNTkgTCAyMzIuMDAwIDIxMi4wMDAgTCAyMTIuMDAwIDE5Ny4zNTkgTCAyMTQuNjc5IDIyMi4wMDAgTCAxOTIuMDAwIDIzMi4wMDAgTCAyMTQuNjc5IDI0Mi4wMDAgTCAyMTIuMDAwIDI2Ni42NDEgelwiXG4gICAgfVxuICB9XG59O1xuXG5cbi8qKlxuICogSW5kaWNhdGVzIHRoYXQgaW5zdGFuY2VzIG9mIHRoaXMgdHlwZSBhcmUgYXN5bmNcbiAqIEBzdGF0aWNcbiAqIEB0eXBlIEJvb2xlYW5cbiAqIEBkZWZhdWx0XG4gKi9cbmZhYnJpYy5QaG90by5hc3luYyA9IHRydWU7XG5cbmZhYnJpYy51dGlsLmNyZWF0ZUFjY2Vzc29ycyhmYWJyaWMuUGhvdG8pO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9zaGFwZXMvcGhvdG8uanMiLCIndXNlIHN0cmljdCc7XG5cbmlmKCFmYWJyaWMuU3Ryb2tlTWl4aW4pe1xuICByZXF1aXJlKFwiLi8uLi9taXhpbnMvc3Ryb2tlTWl4aW5cIik7XG59XG5cbi8qKlxuICogQGF1dGhvciBEZW5pcyBQb25vbWFyZXZcbiAqIEBlbWFpbCBkZW4ucG9ub21hcmV2QGdtYWlsLmNvbVxuICovXG5mYWJyaWMuRnJhbWUgPSBmYWJyaWMudXRpbC5jcmVhdGVDbGFzcyhmYWJyaWMuR3JvdXAsIGZhYnJpYy5TdHJva2VNaXhpbiwge1xuXG4gIHR5cGU6ICdmcmFtZScsXG4gIC8vc3Ryb2tlQWN0aXZlOiAgIFwibGlnaHRncmVlblwiLFxuICAvL3N0cm9rZTogXCJyZWRcIixcbiAgbWluV2lkdGg6IDM1LFxuICBtaW5IZWlnaHQ6IDM1LFxuICBmaWxsIDogXCJ0cmFuc3BhcmVudFwiLFxuICByZXNpemFibGU6IHRydWUsXG4gIGNvbnRlbnRUb29sczogZmFsc2UsXG4gIC8vc3RhdGVzIDogRW1wdHkgLyBGdWxsIC8gQWN0aXZlXG4gIHN0YXRlUHJvcGVydGllczogZmFicmljLkdyb3VwLnByb3RvdHlwZS5zdGF0ZVByb3BlcnRpZXMuY29uY2F0KFtcImNsaXBcIl0pLFxuICBvcHRpb25zT3JkZXI6IChmdW5jdGlvbigpe1xuICAgIHZhciBvbyA9IGZhYnJpYy5PYmplY3QucHJvdG90eXBlLm9wdGlvbnNPcmRlcjtcbiAgICBvby51bnNoaWZ0KFwiZWxlbWVudFwiLFwiY2xpcFwiKTtcbiAgICByZXR1cm4gb287XG4gIH0pKCksXG4gIGNsaXA6IHtcbiAgICBsZWZ0OiAwLFxuICAgIHRvcDogMCxcbiAgICBzY2FsZVg6IDEsXG4gICAgc2NhbGVZOiAxXG4gIH0sXG4gIGNsaXBwaW5nQXZhaWxhYmxlOiBmdW5jdGlvbigpe1xuICAgIHJldHVybiB0aGlzLmNsaXBFbmFibGVkICYmIHRoaXMuZWxlbWVudCAmJiAhdGhpcy5fY2xpcG1vZGU7XG4gIH0sXG4gIGNsaXBFbmFibGVkOiB0cnVlLFxuICAvKipcbiAgICogY3JlYXRlIGNsb25lIHdpdGggc2FtZSBpbWFnZSBhbmQgc2hhcGUgYXMgb3JpZ2luYWwgKHN5bmNyb25vdXMpXG4gICAqIEBwYXJhbSBjYWxsYmFja1xuICAgKiBAcmV0dXJucyB7Kn1cbiAgICovXG4gIGNsb25lU3luYzogZnVuY3Rpb24ob3B0aW9ucyl7XG4gICAgdmFyIF9mcmFtZSA9IG5ldyBmYWJyaWMuRnJhbWUodGhpcyk7XG4gICAgb3B0aW9ucyAmJiBfZnJhbWUuc2V0KG9wdGlvbnMpO1xuICAgIHJldHVybiBfZnJhbWU7XG4gIH0sXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgb3B0aW9ucyB8fCAoIG9wdGlvbnMgPSB7fSk7XG5cbiAgICBpZihvcHRpb25zLmNvbnN0cnVjdG9yICE9IE9iamVjdCl7XG5cbiAgICAgIHZhciBfb2JqID0gb3B0aW9ucy50b09iamVjdCgpO1xuICAgICAgaWYob3B0aW9ucy5lbGVtZW50KXtcbiAgICAgICAgX29iai5lbGVtZW50ID0gb3B0aW9ucy5lbGVtZW50LmNsb25lU3luYygpO1xuICAgICAgICBfb2JqLmVsZW1lbnQuY2xpcFRvID0gX29iai5fZmFicmljX3NoYXBlO1xuICAgICAgfVxuICAgICAgX29iai5zaGFwZSA9IG9wdGlvbnMuc2hhcGU7XG4gICAgICBvcHRpb25zID0gX29iajtcbiAgICB9XG5cbiAgICB0aGlzLm9uKHtcbiAgICAgIFwib2JqZWN0OmNsaWNrXCI6dGhpcy5fY2hlY2tfdGV4dF9hc190YXJnZXRfYW5kX2VkaXQsXG4gICAgICBcImRibGNsaWNrXCI6dGhpcy50b2dnbGVDbGlwTW9kZUJ5Q2xpY2ssXG4gICAgICBcInNjYWxpbmdcIjogdGhpcy5fYXBwbHlfc2hhcGUsXG4gICAgICBcImVsZW1lbnQ6bW9kaWZpZWRcIjogZnVuY3Rpb24oZXZlbnQpe1xuICAgICAgICB0aGlzLnVwZGF0ZVN0cm9rZSgpO1xuICAgICAgICB0aGlzLl9hcHBseV9zaGFwZSgpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgdGhpcy5pbml0U2hhcGUob3B0aW9ucyk7XG4gICAgdGhpcy5jYWxsU3VwZXIoJ2luaXRpYWxpemUnLCBbXG4gICAgICB0aGlzLl9mYWJyaWNfc2hhcGVcbiAgICBdLCBvcHRpb25zKTtcbiAgICB0aGlzLl9lbGVtZW50c190b191cGRhdGUgPSBbXTtcblxuICB9LFxuICB0b2dnbGVDbGlwTW9kZUJ5Q2xpY2s6IGZ1bmN0aW9uKGUpe1xuICAgIGlmKHRoaXMuX2lzX2NsaXBwaW5nX2F2YWlsYWJsZShlLmUpKXtcbiAgICAgIGlmKCF0aGlzLl9jbGlwbW9kZSl7XG4gICAgICAgIHRoaXMuY2xpcFBob3RvU3RhcnQoKVxuICAgICAgfWVsc2V7XG4gICAgICAgIHRoaXMuY2xpcFBob3RvRW5kKClcbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIF9jaGVja190ZXh0X2FzX3RhcmdldF9hbmRfZWRpdDogZnVuY3Rpb24oZSl7XG4gICAgaWYoIHRoaXMuaXNQb3NzaWJsZVRhcmdldChlLmUsdGhpcy50ZXh0KSl7XG4gICAgICB0aGlzLnRleHQuc2V0T3BhY2l0eSgxKTtcbiAgICAgIHRoaXMuX29uX3RleHRfZWRpdChlKTtcbiAgICB9XG4gIH0sXG4gIGNsaXBQaG90b0VuZDpmdW5jdGlvbigpe1xuICAgIHRoaXMuY2FudmFzLmVkaXRpbmdPYmplY3QgPSBudWxsO1xuICAgIHRoaXMuY2FudmFzLm9mZihcInRhcmdldDpjaGFuZ2VkIHRhcmdldDpjbGVhcmVkXCIsdGhpcy5fZW5kRm9vKTtcblxuICAgIGlmKHRoaXMuY2FudmFzLmdyaWQpe1xuICAgICAgdGhpcy5jYW52YXMuZ3JpZC5lbmFibGVkID0gdHJ1ZTtcbiAgICB9XG5cbiAgICAvL3RoaXMucHJvamVjdC5jbGlwTW9kZSA9IGZhbHNlO1xuXG5cbiAgICB0aGlzLmNhbnZhcy5yZW1vdmUodGhpcy5lbGVtZW50KTtcbiAgICB0aGlzLnNldCh7XG4gICAgICBoYXNDb250cm9sczogZmFsc2UsXG4gICAgICBldmVudGVkOiB0cnVlLFxuICAgICAgZmxpcFg6ICAgdGhpcy5lbGVtZW50LmZsaXBYLFxuICAgICAgZmxpcFk6ICAgdGhpcy5lbGVtZW50LmZsaXBZXG4gICAgfSk7XG5cbiAgICB2YXIgdG9fcmFkaWFucyA9IE1hdGguUEkgLyAxODA7XG4gICAgdmFyIGNvc0EgPSBNYXRoLmNvcyh0aGlzLmFuZ2xlICogdG9fcmFkaWFucyk7XG4gICAgdmFyIHNpbkEgPSBNYXRoLnNpbih0aGlzLmFuZ2xlICogdG9fcmFkaWFucyk7XG4gICAgdmFyIEkgPSB0aGlzLmVsZW1lbnQsIEYgPSB0aGlzO1xuXG5cbiAgICB2YXIgX25ld0dlb21ldHJ5ID0ge1xuICAgICAgYW5nbGU6IHRoaXMuZWxlbWVudC5hbmdsZSAtIHRoaXMuYW5nbGUsXG4gICAgICBsZWZ0OiAoIChJLmxlZnQgLSBGLmxlZnQgKSAqIGNvc0EgKyAoSS50b3AgLSBGLnRvcCkqIHNpbkEgIC0gRi53aWR0aC8gMikgKiAoSS5mbGlwWCA/IC0xIDogMSksXG4gICAgICB0b3A6ICAoLShJLmxlZnQgLSBGLmxlZnQgKSAqIHNpbkEgKyAoSS50b3AgLSBGLnRvcCkqIGNvc0EgIC0gRi5oZWlnaHQvIDIpKiAoSS5mbGlwWSA/IC0xIDogMSksXG4gICAgICBmbGlwWDogZmFsc2UsXG4gICAgICBmbGlwWTogZmFsc2VcbiAgICB9O1xuXG4gICAgaWYodGhpcy5lbGVtZW50Lm9yaWdpblggPT09IFwiY2VudGVyXCIpe1xuICAgLy8gICBfbmV3R2VvbWV0cnkubGVmdCArPSB0aGlzLmVsZW1lbnQud2lkdGggLzI7XG4gICAgfVxuICAgIGlmKHRoaXMuZWxlbWVudC5vcmlnaW5ZID09PSBcImNlbnRlclwiKXtcbiAgICAgIC8vX25ld0dlb21ldHJ5LnRvcCArPSB0aGlzLmVsZW1lbnQuaGVpZ2h0IC8yO1xuICAgIH1cblxuICAgIHRoaXMuYWRkKHRoaXMuZWxlbWVudCk7XG4gICAgdGhpcy5lbGVtZW50LnNldChfbmV3R2VvbWV0cnkpO1xuICAgIC8vXG4gICAgLy9cbiAgICB0aGlzLl9jbGlwbW9kZSA9ZmFsc2U7XG4gICAgLy/RgNCw0LzQutGDINC00LLQuNCz0LDRgtGMINC90LXQu9GM0LfRj1xuICAgIHRoaXMuc2V0KHtcbiAgICAgIGhhc0NvbnRyb2xzOiB0cnVlLFxuICAgICAgZXZlbnRlZDogdHJ1ZVxuICAgIH0pO1xuICAgIHRoaXMuY2FudmFzLnJlbW92ZSh0aGlzLl9mYWJyaWNfc2hhcGUpO1xuICAgIHRoaXMuYWRkKHRoaXMuX2ZhYnJpY19zaGFwZSk7XG4gICAgdGhpcy51cGRhdGVTdHJva2UoKTtcbiAgICB0aGlzLl9hcHBseV9zaGFwZSgpO1xuXG4gICAgdGhpcy5lbGVtZW50LmFjdGl2ZSA9IGZhbHNlO1xuICAgIHRoaXMuY2FudmFzLnNldEFjdGl2ZU9iamVjdCh0aGlzKTtcbiAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcblxuICAgIHZhciB3ID0gdGhpcy53aWR0aCwgIGggPSB0aGlzLmhlaWdodCwgZWwgPSB0aGlzLmVsZW1lbnQ7XG5cbiAgICB0aGlzLmNsaXAgPSB7XG4gICAgICBsZWZ0ICAgOiAoZWwubGVmdCkgLyB3ICxcbiAgICAgIHRvcCAgICA6IChlbC50b3ApIC8gaCAsXG4gICAgICBzY2FsZVggOiAoZWwud2lkdGggKSAvIHcsXG4gICAgICBzY2FsZVkgOiAoZWwuaGVpZ2h0KSAvIGhcbiAgICB9O1xuXG4gICAgdGhpcy5maXJlKFwiY2xpcHBpbmc6ZXhpdGVkXCIpO1xuICAgIHRoaXMuY2FudmFzLmZpcmUoJ2ZyYW1lOmNsaXBwaW5nOmV4aXRlZCcsIHsgdGFyZ2V0OiB0aGlzIH0pO1xuICB9LFxuXG4gIGNsaXBQaG90b1N0YXJ0OmZ1bmN0aW9uKCl7XG4gICAgdmFyIF90aGlzID0gdGhpcztcbiAgICB0aGlzLl9jbGlwbW9kZSA9IHRydWU7XG4gICAgdGhpcy51cGRhdGVTdHJva2UoKTtcbiAgICB0aGlzLl9hcHBseV9zaGFwZSgpO1xuICAgIHRoaXMuY2FudmFzLmRpc2NhcmRBY3RpdmVHcm91cCgpO1xuICAgIGlmKHRoaXMuY2FudmFzLmdyaWQpe1xuICAgICAgdGhpcy5jYW52YXMuZ3JpZC5lbmFibGVkID0gZmFsc2U7XG4gICAgfVxuXG4gICAgLyogdGhpcy5mYWJyaWMuc2V0KHtcbiAgICAgb3JpZ2luWDogXCJjZW50ZXJcIixcbiAgICAgb3JpZ2luWTogIFwiY2VudGVyXCIsXG4gICAgIGxlZnQ6IHRoaXMuZmFicmljLmxlZnQgKyB0aGlzLmZhYnJpYy53aWR0aC8yLFxuICAgICB0b3A6IHRoaXMuZmFicmljLnRvcCArIHRoaXMuZmFicmljLmhlaWdodC8yLFxuICAgICB9KTsqL1xuXG4gICAgdGhpcy5lbGVtZW50LnNldCh7XG4gICAgICBtb3ZlbWVudExpbWl0czogdGhpcyxcbiAgICAgIG1vdmVtZW50TGltaXRNb2RlOiBcImNvbnRlbnRcIixcbiAgICAgIC8vY2xpcFRvOiAgICAgICAgIHRoaXMsXG4gICAgICBmbGlwWDogdGhpcy5mbGlwWCxcbiAgICAgIGZsaXBZOiB0aGlzLmZsaXBZLFxuICAgICAgLy9sZWZ0OiB0aGlzLmVsZW1lbnQubGVmdCogKHRoaXMuZmxpcFggPyAtMSA6IDEpLFxuICAgICAgLy90b3A6ICB0aGlzLmVsZW1lbnQudG9wKiAodGhpcy5mbGlwWSA/IC0xIDogMSlcbiAgICB9KTtcblxuICAgIHRoaXMuX3Jlc3RvcmVPYmplY3RTdGF0ZSh0aGlzLmVsZW1lbnQpO1xuICAgIHRoaXMuZWxlbWVudC5zZXQoe1xuICAgICAgaGFzQ29udHJvbHM6IHRydWUsXG4gICAgICAvL3NlbGVjdGFibGU6IGZhbHNlLFxuICAgICAgLy9wZXJQaXhlbFRhcmdldEZpbmQ6IHRydWUsXG4gICAgICBzZWxlY3RhYmxlOiB0cnVlLFxuICAgICAgcGVyUGl4ZWxUYXJnZXRGaW5kOiBmYWxzZVxuICAgIH0pO1xuICAgIHRoaXMucmVtb3ZlKHRoaXMuZWxlbWVudCk7XG4gICAgdGhpcy5jYW52YXMuYWRkKHRoaXMuZWxlbWVudCk7XG5cbiAgICB0aGlzLl9yZXN0b3JlT2JqZWN0U3RhdGUodGhpcy5fZmFicmljX3NoYXBlKTtcbiAgICB0aGlzLnJlbW92ZSh0aGlzLl9mYWJyaWNfc2hhcGUpO1xuICAgIHRoaXMuY2FudmFzLmFkZCh0aGlzLl9mYWJyaWNfc2hhcGUpO1xuXG4vL9GA0LDQvNC60LAg0LTQvtC70LbQvdCwINGA0LjRgdC+0LLQsNGC0YzRgdGPINC90LDQtCDQutCw0YDRgtC40L3QutC+0LksINC40L3QsNGH0LUgINC90LXQutGA0LDRgdC40LLQvlxuLy8gICAgICB0aGlzLnNsaWRlLmNhbnZhcy5icmluZ1RvRnJvbnQodGhpcy5mYWJyaWMpO1xuXG4gICAgLy/RgNCw0LzQutGDINC00LLQuNCz0LDRgtGMINC90LXQu9GM0LfRj1xuICAgIHRoaXMuc2V0KHtcbiAgICAgIGhhc0NvbnRyb2xzOiBmYWxzZSxcbiAgICAgIGV2ZW50ZWQ6IGZhbHNlXG4gICAgfSk7XG5cblxuICAgIHRoaXMuY2FudmFzLnNldEFjdGl2ZU9iamVjdCh0aGlzLmVsZW1lbnQpO1xuICAgIHRoaXMuYWN0aXZlID0gdHJ1ZTtcblxuXG4gICAgdGhpcy5fZW5kRm9vID0gZnVuY3Rpb24oKXtcbiAgICAgIF90aGlzLmNsaXBQaG90b0VuZCgpO1xuICAgIH07XG4gICAgdGhpcy5jYW52YXMub24oXCJ0YXJnZXQ6Y2hhbmdlZCB0YXJnZXQ6Y2xlYXJlZFwiLHRoaXMuX2VuZEZvbyk7XG5cbiAgICB0aGlzLmZpcmUoXCJjbGlwcGluZzplbnRlcmVkXCIpO1xuICAgIHRoaXMuY2FudmFzLmZpcmUoJ2ZyYW1lOmNsaXBwaW5nOmVudGVyZWQnLCB7IHRhcmdldDogdGhpcyB9KTtcblxuICAgIHRoaXMuY2FudmFzLmVkaXRpbmdPYmplY3QgPSB0aGlzO1xuICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICB9LFxuICByZW5kZXI6IGZ1bmN0aW9uKGN0eCwgbm9UcmFuc2Zvcm0pIHtcbiAgICBpZih0aGlzLl9jbGlwbW9kZSl7XG4gICAgICB2YXIgX3pvb20gPSB0aGlzLmNhbnZhcy5nZXRab29tKCk7XG4gICAgICBjdHguc2F2ZSgpO1xuICAgICAgLy8gIHRoaXMudHJhbnNmb3JtKGN0eCk7XG4gICAgICBjdHguZ2xvYmFsQWxwaGEgPSAwLjU7XG4gICAgICB2YXIgX2NsaXBfdG8gPSB0aGlzLmVsZW1lbnQuY2xpcFRvO1xuICAgICAgdGhpcy5lbGVtZW50LmNsaXBUbyA9IG51bGw7XG4gICAgICB0aGlzLmVsZW1lbnQucmVuZGVyKGN0eCk7XG4gICAgICBjdHguc2NhbGUoX3pvb20sX3pvb20pO1xuICAgICAgdGhpcy5lbGVtZW50LmNsaXBUbyA9IF9jbGlwX3RvO1xuICAgICAgdGhpcy50cmFuc2Zvcm0oY3R4KTtcbiAgICAgIGN0eC5zdHJva2VTdHlsZSA9IHRoaXMuYm9yZGVyQ29sb3I7XG4gICAgICBjdHgubGluZVdpZHRoID0gMSAvIHRoaXMuYm9yZGVyU2NhbGVGYWN0b3I7XG4gICAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgICBjdHguY2xvc2VQYXRoKCk7XG4gICAgICBjdHguc3Ryb2tlKCk7XG4gICAgICBjdHgucmVzdG9yZSgpO1xuICAgIH1cbiAgICB0aGlzLmNhbGxTdXBlcigncmVuZGVyJywgY3R4LCBub1RyYW5zZm9ybSk7XG4gIH0sXG4gIC8vc3VwcG9ydGVkVHlwZXM6IFwiKlwiLCAvLyAqIG9yIFtcImltYWdlXCIsXCJ2aWRlb1wiLC4uLl1cbiAgY2xpcHBpbmdTdXBwb3J0ZWRUeXBlczogXCIqXCIsIC8vICogb3IgW1wiaW1hZ2VcIixcInZpZGVvXCIsLi4uXVxuICBfaXNfY2xpcHBpbmdfYXZhaWxhYmxlIDogZnVuY3Rpb24oZSl7XG4gICAgaWYoIXRoaXMuY2xpcEVuYWJsZWQpcmV0dXJuIGZhbHNlO1xuICAgIGlmKGUgJiYgdGhpcy5pc1Bvc3NpYmxlVGFyZ2V0KGUsdGhpcy5idXR0b24pKXtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuZWxlbWVudCAmJiAodGhpcy5jbGlwcGluZ1N1cHBvcnRlZFR5cGVzID09IFwiKlwiIHx8IHRoaXMuY2xpcHBpbmdTdXBwb3J0ZWRUeXBlcy5pbmRleE9mKHRoaXMuZWxlbWVudC50eXBlKSE9IC0xKTtcbiAgfSxcbiAgX3JlbW92ZV9lbGVtZW50OiBmdW5jdGlvbigpe30sXG4gIGRyb3A6IGZ1bmN0aW9uKGRhdGEpe1xuICAgIGlmKGRhdGEudHlwZSA9PSBcImZyYW1lXCIpe1xuICAgICAgdGhpcy5zZXRGcmFtZShkYXRhLmZyYW1lKTtcbiAgICAgIHRoaXMuc2V0U2hhcGUoZGF0YS5zaGFwZSk7XG4gICAgfWVsc2V7XG4gICAgICB0aGlzLnNldEVsZW1lbnRPYmplY3QoZGF0YSk7XG4gICAgfVxuICB9LFxuICBkcm9wcGFibGU6IHtcbiAgICB0eXBlOiBbXCJpbWFnZVwiLFwidmlkZW9cIixcImZyYW1lXCJdXG4gIH0sXG4gIHNldEVsZW1lbnRPYmplY3Q6IGZ1bmN0aW9uKG9wdGlvbnMsY2FsbGJhY2spe1xuICAgIHRoaXMuX3NldF9wZW5kaW5nKHRydWUpO1xuICAgIHRoaXMuZmlyZShcImVsZW1lbnQ6bG9hZGluZ1wiKTtcbiAgICBmYWJyaWMudXRpbC5jcmVhdGVPYmplY3Qob3B0aW9ucyxmdW5jdGlvbihlbCl7XG4gICAgICB0aGlzLl9zZXRfcGVuZGluZyhmYWxzZSk7XG4gICAgICB0aGlzLnNldEVsZW1lbnRLbGFzcyhlbCk7XG4gICAgICBjYWxsYmFjayAmJiBjYWxsYmFjayhlbCk7XG4gICAgfS5iaW5kKHRoaXMpKTtcbiAgfSxcbiAgc2V0RWxlbWVudDogZnVuY3Rpb24oZWwsY2Ipe1xuICAgIGlmKGVsKXtcbiAgICAgIGlmKGVsLmNvbnN0cnVjdG9yID09IE9iamVjdCl7XG4gICAgICAgIHRoaXMuc2V0RWxlbWVudE9iamVjdChlbCxjYilcbiAgICAgIH1lbHNle1xuICAgICAgICB0aGlzLnNldEVsZW1lbnRLbGFzcyhlbCk7XG4gICAgICAgIGNiICYmIGNiKCk7XG4gICAgICB9XG4gICAgfWVsc2V7XG4gICAgICB0aGlzLnNldEVsZW1lbnRLbGFzcygpO1xuICAgICAgY2IgJiYgY2IoKVxuICAgIH1cbiAgfSxcbiAgZHJvcEVsZW1lbnRNZXRob2Q6IFwiY292ZXJcIiwvL3Jlc2l6ZVxuICAvKipcbiAgICog0KHQvtC30LTQsNC90LjQtSDRjdC70LXQvNC10L3RgtCwINGE0L7RgtC+XG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBzZXRFbGVtZW50S2xhc3M6IGZ1bmN0aW9uKGVsKXtcbiAgICBpZih0aGlzLmVsZW1lbnQgPT09IGVsKXJldHVybjtcblxuICAgIGlmKHRoaXMuZWxlbWVudCl7XG4gICAgICB0aGlzLl9yZW1vdmVfZWxlbWVudCgpO1xuICAgICAgdGhpcy5lbGVtZW50LmRlc3RydWN0b3IgJiYgdGhpcy5lbGVtZW50LmRlc3RydWN0b3IoKTtcbiAgICAgIHRoaXMucmVtb3ZlKHRoaXMuZWxlbWVudCk7XG4gICAgICB0aGlzLmNhbnZhcyAmJiB0aGlzLmNhbnZhcy5yZW1vdmUodGhpcy5lbGVtZW50KTtcbiAgICB9XG4gICAgdGhpcy5lbGVtZW50ID0gZWw7XG5cbiAgICBpZihlbCl7XG4gICAgICBlbC5vbihcImRibGNsaWNrXCIsZnVuY3Rpb24oZSl7XG4gICAgICAgIHRoaXMucGFyZW50LnRvZ2dsZUNsaXBNb2RlQnlDbGljayhlKTtcbiAgICAgIH0pO1xuICAgICAgZWwuc2V0dXBTdGF0ZSgpO1xuXG4gICAgICBpZih0aGlzLmRyb3BFbGVtZW50TWV0aG9kICA9PSBcInJlc2l6ZVwiKXtcbiAgICAgICAgdGhpcy5jbGlwID0ge1xuICAgICAgICAgIGxlZnQ6IDAsXG4gICAgICAgICAgdG9wOiAwLFxuICAgICAgICAgIHNjYWxlWDogMSxcbiAgICAgICAgICBzY2FsZVk6IDFcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZih0aGlzLmRyb3BFbGVtZW50TWV0aG9kICA9PSBcImNvdmVyXCIpe1xuICAgICAgICB2YXIgc2l6ZSA9IGZhYnJpYy51dGlsLmdldFByb3BvcnRpb25zKGVsLHRoaXMsJ2NvdmVyJylcbiAgICAgICAgdGhpcy5jbGlwID0ge1xuICAgICAgICAgIGxlZnQ6IDAsXG4gICAgICAgICAgdG9wOiAwLFxuICAgICAgICAgIHNjYWxlWDogc2l6ZS53aWR0aCAvdGhpcy53aWR0aCxcbiAgICAgICAgICBzY2FsZVk6IHNpemUuaGVpZ2h0IC90aGlzLmhlaWdodFxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGVsLnNldCh7XG4gICAgICAgIHRvb2xzOiBbXCJjbGlwRW5kXCJdLFxuICAgICAgICBhY3Rpb25zOiB7XG4gICAgICAgICAgY2xpcEVuZDoge1xuICAgICAgICAgICAgY2xhc3NOYW1lOiAgXCJmYSBmYS1jcm9wXCIsXG4gICAgICAgICAgICB0aXRsZTogICAgICBcImNsaXAgZW5kXCIsXG4gICAgICAgICAgICBhY3Rpb246ICAgICBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICB0aGlzLnBhcmVudC5jbGlwUGhvdG9FbmQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHBhcmVudDogdGhpcyxcbiAgICAgICAgbm90U2VsZWN0YWJsZUluVGhlR3JvdXAgOiB0cnVlLFxuICAgICAgICBvcmlnaW5YOiBcImNlbnRlclwiLFxuICAgICAgICBvcmlnaW5ZOiBcImNlbnRlclwiLFxuICAgICAgICB0cmFuc3BhcmVudENvcm5lcnMgOiBmYWxzZSxcbiAgICAgICAgcmVzaXphYmxlOiB0cnVlLFxuICAgICAgICBjbGlwVG86IHRoaXMuX2ZhYnJpY19zaGFwZVxuICAgICAgfSk7XG5cbiAgICAgIHRoaXMuYWRkKGVsKTtcblxuICAgICAgZm9yKHZhciBpIGluIHRoaXMuX2VsZW1lbnRzX3RvX3VwZGF0ZSl7XG4gICAgICAgIHRoaXMucmVtb3ZlKHRoaXMuX2VsZW1lbnRzX3RvX3VwZGF0ZVtpXS5lbGVtZW50KTtcbiAgICAgICAgdGhpcy5hZGQodGhpcy5fZWxlbWVudHNfdG9fdXBkYXRlW2ldLmVsZW1lbnQpO1xuICAgICAgfVxuICAgICAgdGhpcy5fdXBkYXRlX2VsZW1lbnRfc2l6ZSgpO1xuICAgIH1cblxuICAgIHRoaXMuZmlyZShcImVsZW1lbnQ6bW9kaWZpZWRcIix7ZWxlbWVudDogZWx9KTtcbiAgICB0aGlzLmNhbnZhcyAmJiB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgfSxcblxuICAvKipcbiAgICog0L7Qs9GA0LDQvdC40YfQuNCy0LDQtdC8INC/0LXRgNC10LzQtdGJ0LXQvdC40LUg0YTQvtGC0L7Qs9GA0LDRhNC40Lgg0LLQvdGD0YLRgNC4INGA0LDQvNC60LhcbiAgICogQHBhcmFtIGVsXG4gICAqL1xuICBfbGltaXRfbW92aW5nOiBmdW5jdGlvbihkYXRhKXtcblxuICAgIHZhciByID0gdGhpcy5nZXRCb3VuZGluZ1JlY3QoKTtcbiAgICB2YXIgaSAgID0gdGhpcy5lbGVtZW50O1xuICAgIGkub24oXCJtb3ZpbmdcIiwgZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgYiA9IHtcbiAgICAgICAgbDogIHIubGVmdCAgKyBpLndpZHRoICogaS5zY2FsZVgvMixcbiAgICAgICAgcjogIHIubGVmdCArIHIud2lkdGggLSBpLndpZHRoICogaS5zY2FsZVgvMixcbiAgICAgICAgdDogIHIudG9wICArIGkuaGVpZ2h0ICogaS5zY2FsZVkvMixcbiAgICAgICAgYjogIHIudG9wICArIHIuaGVpZ2h0IC0gaS5oZWlnaHQgKiBpLnNjYWxlWS8yXG4gICAgICB9O1xuICAgICAgLy8gY2FwcGluZyBsb2dpYyBoZXJlXG4gICAgICBpLnNldExlZnQoTWF0aC5tYXgoTWF0aC5taW4oYi5sLCBpLmxlZnQpLGIucikpO1xuICAgICAgaS5zZXRUb3AoTWF0aC5tYXgoTWF0aC5taW4oYi50LCBpLnRvcCksYi5iKSk7XG4gICAgfSk7XG5cbiAgICBpLm9uKFwic2NhbGluZ1wiLCBmdW5jdGlvbigpIHtcbiAgICAgIGkuc2V0KHtcbiAgICAgICAgd2lkdGg6IE1hdGgubWF4KHIud2lkdGgsIGkud2lkdGggKiBpLnNjYWxlWCksXG4gICAgICAgIGhlaWdodDogTWF0aC5tYXgoci5oZWlnaHQsaS5oZWlnaHQqIGkuc2NhbGVZKSxcbiAgICAgICAgc2NhbGVYIDogMSxcbiAgICAgICAgc2NhbGVZOiAxXG4gICAgICB9KTtcblxuICAgICAgdmFyIGIgPSB7XG4gICAgICAgIGw6ICByLmxlZnQgICsgaS53aWR0aCAqIGkuc2NhbGVYLzIsXG4gICAgICAgIHI6ICByLmxlZnQgKyByLndpZHRoIC0gaS53aWR0aCAqIGkuc2NhbGVYLzIsXG4gICAgICAgIHQ6ICByLnRvcCAgKyBpLmhlaWdodCAqIGkuc2NhbGVZLzIsXG4gICAgICAgIGIgOiByLnRvcCAgKyByLmhlaWdodCAtIGkuaGVpZ2h0ICogaS5zY2FsZVkvMlxuICAgICAgfTtcbiAgICAgIC8vLy8gY2FwcGluZyBsb2dpYyBoZXJlXG4gICAgICAvL2kuc2V0TGVmdChNYXRoLm1pbihNYXRoLm1heChiLmwsIGkubGVmdCksYi5yKSk7XG4gICAgICAvL2kuc2V0VG9wKE1hdGgubWluKE1hdGgubWF4KGIudCwgaS50b3ApLGIuYikpO1xuICAgIH0pO1xuICB9LFxuXG4gIF9zZXRfcGVuZGluZzogZnVuY3Rpb24odmFsKXtcbiAgICB0aGlzLl9wZW5kaW5nID0gdmFsO1xuICB9LFxuXG4gIC8qKlxuICAgKiDQodC+0LfQtNCw0L3QuNC1INGN0LvQtdC80LXQvdGC0LAg0YTQvtGC0L5cbiAgICogQHByaXZhdGVcbiAgICovXG4gIF9jcmVhdGVfcmVtb3ZlX2J1dHRvbjogZnVuY3Rpb24ob3B0aW9ucyl7XG5cbiAgICB0aGlzLmJ1dHRvbiA9IHRoaXMuX2NyZWF0ZV9idXR0b24oe1xuICAgICAgdGV4dDogXCLvgI1cIixcbiAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgdmlzaWJsZTogZmFsc2VcbiAgICAgIH0sXG4gICAgICBwb3NpdGlvbjp7XG4gICAgICAgIHRvcDogMCxcbiAgICAgICAgcmlnaHQ6IDBcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHRoaXMuYnV0dG9uLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpe1xuICAgICAgaWYoIXRoaXMuX3BlbmRpbmcpe1xuICAgICAgICB0aGlzLnNldEVsZW1lbnQoZmFsc2UpO1xuICAgICAgfVxuICAgIH0uYmluZCh0aGlzKSk7XG5cbiAgfSxcbiAgX2FkZF9lbGVtZW50X3RvX3VwZGF0ZTogZnVuY3Rpb24oZGF0YSl7XG4gICAgdGhpcy5fZWxlbWVudHNfdG9fdXBkYXRlLnB1c2goZGF0YSk7XG5cbiAgICBpZihkYXRhLnJpZ2h0ICE9PSB1bmRlZmluZWQpe1xuICAgICAgZGF0YS5lbGVtZW50LnNldE9yaWdpblgoXCJyaWdodFwiKTtcbiAgICB9XG4gICAgaWYoZGF0YS5sZWZ0ICE9PSB1bmRlZmluZWQpe1xuICAgICAgZGF0YS5lbGVtZW50LnNldE9yaWdpblgoXCJsZWZ0XCIpO1xuICAgIH1cbiAgICBpZihkYXRhLmJvdHRvbSAhPT0gdW5kZWZpbmVkKXtcbiAgICAgIGRhdGEuZWxlbWVudC5zZXRPcmlnaW5ZKFwiYm90dG9tXCIpO1xuICAgIH1cbiAgICBpZihkYXRhLnRvcCAhPT0gdW5kZWZpbmVkKXtcbiAgICAgIGRhdGEuZWxlbWVudC5zZXRPcmlnaW5ZKFwidG9wXCIpO1xuICAgIH1cblxuICAgIHRoaXMuX3VwZGF0ZV9pbnRlcmZhY2VfZWxlbWVudF9wb3NpdGlvbihkYXRhLmVsZW1lbnQsZGF0YSk7XG5cbiAgfSxcbiAgc2V0Q2xpcDogZnVuY3Rpb24odmFsKXtcbiAgICB0aGlzLmNsaXAgPSB2YWw7XG4gICAgdGhpcy5fdXBkYXRlX2VsZW1lbnRfc2l6ZSgpO1xuICB9LFxuICBfdXBkYXRlX2VsZW1lbnRfc2l6ZTogZnVuY3Rpb24oKXtcbiAgICB0aGlzLl91cGRhdGVfZWxlbWVudF93aWR0aCgpO1xuICAgIHRoaXMuX3VwZGF0ZV9lbGVtZW50X2hlaWdodCgpO1xuICB9LFxuXG4gIF91cGRhdGVfZWxlbWVudF93aWR0aDogZnVuY3Rpb24oKXtcbiAgICBpZih0aGlzLmVsZW1lbnQpe1xuICAgICAgaWYodGhpcy5lbGVtZW50LnR5cGUgPT0gXCJlbGxpcHNlXCIpe1xuICAgICAgICB0aGlzLmVsZW1lbnQuc2V0KHtcbiAgICAgICAgICByeDogdGhpcy53aWR0aC8yICogdGhpcy5jbGlwLnNjYWxlWFxuICAgICAgICB9KTtcbiAgICAgIH1lbHNlIGlmKCB0aGlzLmVsZW1lbnQudHlwZSA9PVwidmlkZW9cIiB8fCB0aGlzLmVsZW1lbnQudHlwZSA9PSBcInBhdGhcIil7XG5cbiAgICAgICAgdGhpcy5lbGVtZW50LnNldCh7XG4gICAgICAgICAgbGVmdDogMCxcbiAgICAgICAgICBzY2FsZVg6IHRoaXMud2lkdGggLyB0aGlzLmVsZW1lbnQud2lkdGhcbiAgICAgICAgfSk7XG4gICAgICB9ZWxzZSB7XG4gICAgICAgIHRoaXMuZWxlbWVudC5zZXRXaWR0aCh0aGlzLndpZHRoICogdGhpcy5jbGlwLnNjYWxlWClcbiAgICAgICAgdGhpcy5lbGVtZW50LnNldExlZnQodGhpcy53aWR0aCAqIHRoaXMuY2xpcC5sZWZ0KTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIF91cGRhdGVfZWxlbWVudF9oZWlnaHQ6IGZ1bmN0aW9uKCl7XG4gICAgaWYodGhpcy5lbGVtZW50KXtcblxuICAgICAgaWYodGhpcy5lbGVtZW50LnR5cGUgPT0gXCJlbGxpcHNlXCIpe1xuICAgICAgICB0aGlzLmVsZW1lbnQuc2V0KHtcbiAgICAgICAgICByeTogICAgIHRoaXMuaGVpZ2h0LzIgKiB0aGlzLmNsaXAuc2NhbGVZXG4gICAgICAgIH0pO1xuICAgICAgfWVsc2UgaWYoIHRoaXMuZWxlbWVudC50eXBlID09XCJ2aWRlb1wiIHx8IHRoaXMuZWxlbWVudC50eXBlID09IFwicGF0aFwiKXtcblxuICAgICAgICB0aGlzLmVsZW1lbnQuc2V0KHtcbiAgICAgICAgICB0b3A6IDAsXG4gICAgICAgICAgc2NhbGVZOiB0aGlzLmhlaWdodCAvIHRoaXMuZWxlbWVudC5oZWlnaHRcbiAgICAgICAgfSk7XG4gICAgICB9ZWxzZXtcbiAgICAgICAgdGhpcy5lbGVtZW50LnNldEhlaWdodCh0aGlzLmhlaWdodCAqIHRoaXMuY2xpcC5zY2FsZVkpXG4gICAgICAgIHRoaXMuZWxlbWVudC5zZXRUb3AoIHRoaXMuaGVpZ2h0ICogdGhpcy5jbGlwLnRvcCk7XG4gICAgICB9XG4gICAgfVxuICB9LFxuICBfdXBkYXRlX2ludGVyZmFjZV9lbGVtZW50X3Bvc2l0aW9uOiBmdW5jdGlvbihlbCxkYXRhLCBwcm9wKXtcbiAgICBpZighcHJvcCB8fCBwcm9wID09IFwiaGVpZ2h0XCIpe1xuICAgICAgaWYgKGRhdGEudG9wICE9PSB1bmRlZmluZWQgJiYgZGF0YS5ib3R0b20gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBlbC5zZXRUb3AoLXRoaXMuaGVpZ2h0IC8gMiArIGRhdGEudG9wKTtcbiAgICAgICAgZWwuc2V0SGVpZ2h0KHRoaXMuaGVpZ2h0IC0gZGF0YS50b3AgLSBkYXRhLmJvdHRvbSk7XG4gICAgICB9aWYgKGRhdGEudG9wICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgZWwuc2V0VG9wKC10aGlzLmhlaWdodCAvIDIgKyBkYXRhLnRvcCk7XG4gICAgICB9IGVsc2UgaWYgKGRhdGEuYm90dG9tICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgZWwuc2V0VG9wKHRoaXMuaGVpZ2h0IC8gMiAtIGRhdGEuYm90dG9tKTtcbiAgICAgIH1lbHNlIGlmIChkYXRhLmhlaWdodCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGVsLnNldEhlaWdodChkYXRhLmhlaWdodCk7XG4gICAgICB9XG4gICAgfVxuICAgIGlmKCFwcm9wIHx8IHByb3AgPT0gXCJ3aWR0aFwiKSB7XG4gICAgICBpZiAoZGF0YS5yaWdodCAhPT0gdW5kZWZpbmVkICYmIGRhdGEubGVmdCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGVsLnNldExlZnQoLXRoaXMud2lkdGggLyAyICsgZGF0YS5sZWZ0KTtcbiAgICAgICAgZWwuc2V0V2lkdGgodGhpcy53aWR0aCAtIGRhdGEubGVmdCAtIGRhdGEucmlnaHQpO1xuXG4gICAgICB9ZWxzZSBpZiAoZGF0YS5yaWdodCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGVsLnNldExlZnQodGhpcy53aWR0aCAvIDIgLSBkYXRhLnJpZ2h0KTtcbiAgICAgIH1lbHNlIGlmIChkYXRhLmxlZnQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBlbC5zZXRMZWZ0KC10aGlzLndpZHRoIC8gMiArIGRhdGEubGVmdCk7XG4gICAgICB9ZWxzZSBpZiAoZGF0YS53aWR0aCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGVsLnNldFdpZHRoKGRhdGEud2lkdGgpO1xuICAgICAgfVxuICAgIH1cbiAgICBlbC5zZXRDb29yZHMoKTtcbiAgfSxcbiAgc2V0SGVpZ2h0OiBmdW5jdGlvbihoKXtcbiAgICB0aGlzLmhlaWdodCA9IGg7XG4gICAgLy90aGlzLnNldChcImhlaWdodFwiLHcpO1xuICAgIGZvcih2YXIgaSBpbiB0aGlzLl9lbGVtZW50c190b191cGRhdGUpIHtcbiAgICAgIHZhciBkYXRhID0gdGhpcy5fZWxlbWVudHNfdG9fdXBkYXRlW2ldO1xuICAgICAgdGhpcy5fdXBkYXRlX2ludGVyZmFjZV9lbGVtZW50X3Bvc2l0aW9uKGRhdGEuZWxlbWVudCxkYXRhLFwiaGVpZ2h0XCIpO1xuICAgIH1cbiAgICB0aGlzLl91cGRhdGVfZWxlbWVudF9oZWlnaHQoKTtcbiAgICB0aGlzLl9hcHBseV9zaGFwZSgpO1xuICB9LFxuICBzZXRXaWR0aDogZnVuY3Rpb24odyl7XG4gICAgdGhpcy53aWR0aCA9IHc7XG4gICAgLy90aGlzLnNldChcIndpZHRoXCIsdyk7XG4gICAgZm9yKHZhciBpIGluIHRoaXMuX2VsZW1lbnRzX3RvX3VwZGF0ZSl7XG4gICAgICB2YXIgZGF0YSA9IHRoaXMuX2VsZW1lbnRzX3RvX3VwZGF0ZVtpXTtcbiAgICAgIHRoaXMuX3VwZGF0ZV9pbnRlcmZhY2VfZWxlbWVudF9wb3NpdGlvbihkYXRhLmVsZW1lbnQsZGF0YSxcIndpZHRoXCIpO1xuICAgIH1cbiAgICB0aGlzLl91cGRhdGVfZWxlbWVudF93aWR0aCgpO1xuICAgIHRoaXMuX2FwcGx5X3NoYXBlKCk7XG4gIH0sXG4gIHRvT2JqZWN0OiBmdW5jdGlvbihwcm9wZXJ0aWVzVG9JbmNsdWRlKXtcbiAgICBwcm9wZXJ0aWVzVG9JbmNsdWRlID0gW1wiY2xpcFwiLFwiZGF0YVwiXS5jb25jYXQocHJvcGVydGllc1RvSW5jbHVkZSk7XG5cbiAgICB2YXIgb2JqZWN0ID0gdGhpcy5jYWxsU3VwZXIoJ3RvT2JqZWN0JywgcHJvcGVydGllc1RvSW5jbHVkZSk7XG5cblxuICAgIGlmKHRoaXMuc2hhcGUpe1xuICAgICAgb2JqZWN0LnNoYXBlID0gXy5jbG9uZSh0aGlzLnNoYXBlKTtcbiAgICAgIGlmKG9iamVjdC5zaGFwZS5zcmMpe1xuICAgICAgICBkZWxldGUgb2JqZWN0LnNoYXBlLnBhdGhzO1xuICAgICAgICBkZWxldGUgb2JqZWN0LnNoYXBlLmhlaWdodDtcbiAgICAgICAgZGVsZXRlIG9iamVjdC5zaGFwZS53aWR0aDtcbiAgICAgICAgZGVsZXRlIG9iamVjdC5zaGFwZS5zdmdVaWQ7XG4gICAgICAgIGRlbGV0ZSBvYmplY3Quc2hhcGUudG9CZVBhcnNlZDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBkZWxldGUgb2JqZWN0Lm9iamVjdHM7XG5cbiAgICBpZih0aGlzLmVsZW1lbnQpe1xuICAgICAgdmFyIF9vYmoyID0gdGhpcy5lbGVtZW50LnRvT2JqZWN0KCk7XG4gICAgICBvYmplY3QuZWxlbWVudCA9IHtcbiAgICAgICAgdHlwZTogX29iajIudHlwZSxcbiAgICAgICAgc3JjOiBfb2JqMi5zcmNcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG9iamVjdDtcbiAgfSxcbiAgaW5zZXJ0UGhvdG9DbGlwIDogZmFsc2Vcbn0pO1xuXG52YXIgX0ZSQSA9IGZhYnJpYy5GcmFtZS5wcm90b3R5cGU7XG5mYWJyaWMuRnJhbWUucHJvdG90eXBlLmFjdGlvbnMgPSBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKHt9LCBmYWJyaWMuT2JqZWN0LnByb3RvdHlwZS5hY3Rpb25zLCB7XG4gICAgY2xlYXI6IHtcbiAgICAgIHRpdGxlOiAgICAgIFwiUmVtb3ZlIGNvbnRlbnRcIixcbiAgICAgIGNsYXNzTmFtZTogIFwiZmEgZmEtdGltZXNcIixcbiAgICAgIGFjdGlvbjogICAgIF9GUkEuc2V0RWxlbWVudCxcbiAgICAgIHZpc2libGU6ICAgIFwiZWxlbWVudFwiLFxuICAgICAgb2JzZXJ2ZTogICAgXCJlbGVtZW50Om1vZGlmaWVkXCJcbiAgICB9LFxuICAgIHBob3RvQ2xpcDoge1xuICAgICAgdGl0bGU6ICAgICAgXCLQvtCx0YDQtdC30LDRgtGMXCIsXG4gICAgICBjbGFzc05hbWU6ICBcImZhIGZhLWNyb3BcIixcbiAgICAgIGFjdGlvbjogICAgIF9GUkEuY2xpcFBob3RvU3RhcnQsXG4gICAgICB2aXNpYmxlOiAgICBfRlJBLmNsaXBwaW5nQXZhaWxhYmxlLFxuICAgICAgb2JzZXJ2ZTogIFwiY2xpcHBpbmc6ZW50ZXJlZCBjbGlwcGluZzpleGl0ZWQgZWxlbWVudDptb2RpZmllZFwiXG4gICAgfVxuICB9XG4pO1xuXG5cbmZhYnJpYy5GcmFtZS5mcm9tT2JqZWN0ID0gZnVuY3Rpb24ob2JqZWN0LGNhbGxiYWNrKSB7XG4gIG9iamVjdCA9IGZhYnJpYy51dGlsLm9iamVjdC5jbG9uZURlZXAob2JqZWN0KTtcblxuICB2YXIgY2IgPSBmYWJyaWMudXRpbC5xdWV1ZUxvYWQoMixmdW5jdGlvbigpe1xuICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKG5ldyBmYWJyaWMuRnJhbWUob2JqZWN0KSk7XG4gIH0pO1xuXG4gIGlmKG9iamVjdC5lbGVtZW50KXtcbiAgICBmYWJyaWMudXRpbC5jcmVhdGVPYmplY3Qob2JqZWN0LmVsZW1lbnQsZnVuY3Rpb24oZWwpe1xuICAgICAgb2JqZWN0LmVsZW1lbnQgPSBlbDtcbiAgICAgIGNiKCk7XG4gICAgfSk7XG4gIH1lbHNle1xuICAgIGNiKCk7XG4gIH1cblxuICBpZihvYmplY3Quc2hhcGUgJiYgb2JqZWN0LnNoYXBlLnNyYyl7XG4gICAgZmFicmljLmxvYWRTVkdGcm9tVVJMKG9iamVjdC5zaGFwZS5zcmMsZnVuY3Rpb24ocGF0aHMsb3B0aW9ucykge1xuICAgICAgb2JqZWN0LnNoYXBlLnBhdGhzICA9IHBhdGhzO1xuICAgICAgZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChvYmplY3Quc2hhcGUsb3B0aW9ucyk7XG4gICAgICBjYigpO1xuICAgIH0pXG4gIH1lbHNlIHtcbiAgICBjYigpO1xuICB9XG59O1xuZmFicmljLkZyYW1lLmFzeW5jID0gdHJ1ZTtcblxuZmFicmljLnV0aWwuY3JlYXRlQWNjZXNzb3JzKGZhYnJpYy5GcmFtZSk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL3NoYXBlcy9mcmFtZS5qcyIsIid1c2Ugc3RyaWN0JztcbnZhciBCZXppZXIgPSByZXF1aXJlKFwiLi8uLi9wbHVnaW5zL2JlemllclwiKTtcbnJlcXVpcmUoXCIuLy4uL21peGlucy9iZXppZXJNaXhpblwiKTtcblxuZmFicmljLlBvbHlsaW5lID0gZmFicmljLnV0aWwuY3JlYXRlQ2xhc3MoZmFicmljLk9iamVjdCwgZmFicmljLkJlemllck1peGluLHtcbiAgdHlwZTogJ3BvbHlsaW5lJyxcbiAgaGFzUm90YXRpbmdQb2ludDogZmFsc2UsXG4gIHN0cm9rZTogXCJibGFja1wiLFxuICBwb2ludHNMaW1pdHM6IGZhbHNlLFxuICBoYXNCb3VuZHNDb250cm9sczogZmFsc2UsXG4gIGNsb3NlZDogZmFsc2UsXG4gIGNvcm5lclNpemU6IDE2LFxuICBlbmRlckFyZWFTaXplOiA0LFxuICBleHRlbnNpb25BcmVhRW5hYmxlZDogdHJ1ZSxcbiAgY29ybmVyU3R5bGU6IFwicmVjdFwiLFxuICBtYXhpbXVtUG9pbnRzOiA0LFxuICBwb2ludHM6IFtdLFxuICBfY29ybmVyX2N1cnNvcnMgOiB7XG4gICAgeDogICdidXR0b25DdXJzb3InLFxuICAgIHA6ICAnZGVmYXVsdEN1cnNvcicsXG4gICAgZTogICd0YXJnZXRDdXJzb3InXG4gIH0sXG4gIF9jb3JuZXJfYWN0aW9ucyA6IHtcbiAgICB4MTogXCJhZGRcIixcbiAgICB4MjogXCJyZW1vdmVcIixcbiAgICBlMTogXCJ1bnNoaWZ0XCIsXG4gICAgZTI6IFwicHVzaFwiXG4gIH0sXG4gIHN0YXRlUHJvcGVydGllczogW1widG9wXCIsIFwibGVmdFwiLCBcIndpZHRoXCIsIFwiaGVpZ2h0XCIsIFwiYW5nbGVcIiwgXCJwb2ludHNcIl0sXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgb3B0aW9ucyB8fCAoIG9wdGlvbnMgPSB7fSk7XG4gICAgb3B0aW9ucy5wb2ludHMgPSBmYWJyaWMudXRpbC5vYmplY3QuY2xvbmVEZWVwKG9wdGlvbnMucG9pbnRzKTtcblxuICAgIHRoaXMuY2FsbFN1cGVyKCdpbml0aWFsaXplJywgb3B0aW9ucyk7XG5cbiAgICB0aGlzLm9uKHtcbiAgICAgIFwiYWRkZWRcIjogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnNldENvb3JkcygpO1xuICAgICAgfSxcbiAgICAgIFwibW91c2Vkb3duXCI6IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICBpZiAodGhpcy5fX2Nvcm5lci8qICYmIHRoaXMuX19jb3JuZXJbMF0gPT0gXCJlXCIqLykge1xuICAgICAgICAgIHRoaXMuY2FudmFzLl90cmFuc2Zvcm1PYmplY3QoZXZlbnQuZSk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBcIm1vdXNlb3V0XCI6IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICBpZiAodGhpcy5fX21hZ25ldF9wb2ludCB8fCB0aGlzLl9fbWFnbmV0X2Nvb3JkaW5hdGUpIHtcbiAgICAgICAgICBkZWxldGUgdGhpcy5fX21hZ25ldF9jb29yZGluYXRlO1xuICAgICAgICAgIGRlbGV0ZSB0aGlzLl9fbWFnbmV0X3BvaW50O1xuICAgICAgICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgICAgICAgIHRoaXMuc2V0Q29vcmRzKCk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBcIm1vdXNlbW92ZVwiOiBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgdmFyIHBvaW50ZXIgPSB0aGlzLmNhbnZhcy5nZXRQb2ludGVyKGV2ZW50LmUpO1xuICAgICAgICBpZiAodGhpcy5fX2Nvcm5lcikge1xuICAgICAgICAgIGlmKHRoaXMuX19jb3JuZXJbMF0gIT0gXCJ4XCIpe1xuICAgICAgICAgICAgdGhpcy5fX21hZ25ldF9wb2ludCA9IHRoaXMuX2NvbnRyb2xzW3RoaXMuX19jb3JuZXJdO1xuICAgICAgICAgICAgdGhpcy5zZXRDb29yZHMoKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHRoaXMuX19jb3JuZXJbMF0gPT0gXCJlXCIpIHtcbiAgICAgICAgICAgIHRoaXMuX19tYWduZXRfY29vcmRpbmF0ZSA9IHt4OiBwb2ludGVyLnggLSB0aGlzLmxlZnQsIHk6IHBvaW50ZXIueSAtIHRoaXMudG9wfTtcbiAgICAgICAgICAgIC8vIHRoaXMuc2V0Q29udHJvbFBvaW50cygpO1xuICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5fX21hZ25ldF9jb29yZGluYXRlKSB7XG4gICAgICAgICAgICBkZWxldGUgdGhpcy5fX21hZ25ldF9jb29yZGluYXRlO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAodGhpcy5fX21hZ25ldF9jb29yZGluYXRlKSB7XG4gICAgICAgICAgICBkZWxldGUgdGhpcy5fX21hZ25ldF9wb2ludDtcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLl9fbWFnbmV0X2Nvb3JkaW5hdGU7XG4gICAgICAgICAgICB0aGlzLnNldENvb3JkcygpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGlmKHRoaXMuc2hhZG93KXtcbiAgICAgIHRoaXMuc2V0U2hhZG93KHRoaXMuc2hhZG93KTtcbiAgICB9XG4gICAgdGhpcy5zZXRQb2ludHMob3B0aW9ucy5wb2ludHMpO1xuICAgIHRoaXMudXBkYXRlQmJveCgpO1xuICB9LFxuICBfcGVyZm9ybVB1c2hBY3Rpb246IGZ1bmN0aW9uIChlLCB0cmFuc2Zvcm0sIHBvaW50ZXIpIHtcbiAgICBkZWxldGUgdGhpcy5fX21hZ25ldF9jb29yZGluYXRlO1xuICAgIHRoaXMucG9pbnRzLnB1c2goe1xuICAgICAgeDogcG9pbnRlci54IC0gdGhpcy5sZWZ0LFxuICAgICAgeTogcG9pbnRlci55IC0gdGhpcy50b3AsXG4gICAgfSk7XG4gICAgdHJhbnNmb3JtLmFjdGlvbiA9IFwic2hhcGVcIjtcbiAgICB0cmFuc2Zvcm0uY29ybmVyID0gXCJwXCIgKyB0aGlzLnBvaW50cy5sZW5ndGg7XG4gICAgdGhpcy5jYW52YXMuc2V0Q3Vyc29yKHRoaXMuY2FudmFzLmZyZWVEcmF3aW5nQ3Vyc29yKTtcbiAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgfSxcbiAgX3BlcmZvcm1VbnNoaWZ0QWN0aW9uOiBmdW5jdGlvbiAoZSwgdHJhbnNmb3JtLCBwb2ludGVyKSB7XG4gICAgZGVsZXRlIHRoaXMuX19tYWduZXRfY29vcmRpbmF0ZTtcbiAgICB0aGlzLnBvaW50cy51bnNoaWZ0KHtcbiAgICAgIHg6IHBvaW50ZXIueCAtIHRoaXMubGVmdCxcbiAgICAgIHk6IHBvaW50ZXIueSAtIHRoaXMudG9wLFxuICAgIH0pO1xuICAgIHRyYW5zZm9ybS5hY3Rpb24gPSBcInNoYXBlXCI7XG4gICAgdHJhbnNmb3JtLmNvcm5lciA9IFwicDFcIjtcbiAgICB0aGlzLmNhbnZhcy5zZXRDdXJzb3IodGhpcy5jYW52YXMuZnJlZURyYXdpbmdDdXJzb3IpO1xuICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICB9LFxuXG4gIGRyYXdDb250cm9sc0ludGVyZmFjZTogZnVuY3Rpb24gKGN0eCkge1xuICAgIHRoaXMuZHJhd0JlemllclNoYXBlQ29udHJvbHMoY3R4KTtcbiAgICB0aGlzLl9kcmF3TWFnbmV0TGluZShjdHgpO1xuICB9LFxuICBfZHJhd01hZ25ldExpbmU6IGZ1bmN0aW9uKGN0eCl7XG4gICAgaWYodGhpcy5fX21hZ25ldF9wb2ludCAmJiB0aGlzLl9fbWFnbmV0X2Nvb3JkaW5hdGUpe1xuICAgICAgY3R4LnRyYW5zbGF0ZSgtdGhpcy53aWR0aC8yLCAtIHRoaXMuaGVpZ2h0LzIpXG4gICAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgICBjdHgubGluZVdpZHRoID0gMyA7XG4gICAgICBjdHguc3Ryb2tlU3R5bGUgPSBcInJlZFwiO1xuICAgICAgY3R4Lm1vdmVUbyh0aGlzLl9fbWFnbmV0X3BvaW50LngsIHRoaXMuX19tYWduZXRfcG9pbnQueSk7XG4gICAgICBjdHgubGluZVRvKHRoaXMuX19tYWduZXRfY29vcmRpbmF0ZS54LCB0aGlzLl9fbWFnbmV0X2Nvb3JkaW5hdGUueSk7XG4gICAgICBjdHguc3Ryb2tlKCk7XG4gICAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgICBjdHguYXJjKHRoaXMuX19tYWduZXRfY29vcmRpbmF0ZS54LCB0aGlzLl9fbWFnbmV0X2Nvb3JkaW5hdGUueSwgdGhpcy5jb3JuZXJTaXplIC8gMiwgMCwgTWF0aC5QSSAqIDIsIHRydWUpO1xuICAgICAgY3R4LmNsb3NlUGF0aCgpO1xuICAgICAgY3R4LmZpbGwoKTtcbiAgICB9XG4gIH0sXG4gIF9yZW5kZXI6IGZ1bmN0aW9uIChjdHgsIG5vVHJhbnNmb3JtKSB7XG4gICAgdmFyIHggPSBub1RyYW5zZm9ybSA/IHRoaXMubGVmdCA6IC10aGlzLndpZHRoIC8gMiAsXG4gICAgICAgIHkgPSBub1RyYW5zZm9ybSA/IHRoaXMudG9wIDogLXRoaXMuaGVpZ2h0IC8gMixcbiAgICAgICAgX3BjO1xuXG4gICAgY3R4LnNhdmUoKTtcbiAgICBjdHgudHJhbnNsYXRlKHgseSk7XG4gICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgIGN0eC5tb3ZlVG8odGhpcy5wb2ludHNbMF0ueCwgIHRoaXMucG9pbnRzWzBdLnkpO1xuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnBvaW50cy5sZW5ndGggLSAxOyBpKyspIHtcblxuICAgICAgaWYodGhpcy5wb2ludHNbaV0uY3VydmUpIHtcbiAgICAgICAgaWYoIXRoaXMucG9pbnRzW2ldLm91dGxpbmUpe1xuICAgICAgICAgIF9wYyA9IHRoaXMucG9pbnRzW2ldLmN1cnZlLnBvaW50cztcbiAgICAgICAgICBjdHgucXVhZHJhdGljQ3VydmVUbyggX3BjWzFdLngsICBfcGNbMV0ueSxfcGNbMl0ueCxfcGNbMl0ueSk7XG4gICAgICAgIH1cbiAgICAgIH1lbHNle1xuICAgICAgICBjdHgubGluZVRvKCB0aGlzLnBvaW50c1tpICsgMV0ueCwgIHRoaXMucG9pbnRzW2kgKyAxXS55KTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYodGhpcy5jbG9zZWQpe1xuICAgICAgaWYodGhpcy5wb2ludHNbdGhpcy5wb2ludHMubGVuZ3RoIC0gMV0uY3VydmUpIHtcbiAgICAgICAgX3BjID0gdGhpcy5wb2ludHNbaV0uY3VydmUucG9pbnRzO1xuICAgICAgICBjdHgucXVhZHJhdGljQ3VydmVUbyhfcGNbMV0ueCwgIF9wY1sxXS55LCBfcGNbMl0ueCxfcGNbMl0ueSk7XG4gICAgICB9XG4gICAgICBjdHguY2xvc2VQYXRoKCk7XG4gICAgfVxuICAgIHRoaXMuY2xvc2VkICYmIHRoaXMuX3JlbmRlckZpbGwoY3R4KTtcblxuICAgIHRoaXMuX3JlbmRlclN0cm9rZShjdHgpO1xuXG5cbiAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgZm9yIChpID0gMDsgaSA8IHRoaXMucG9pbnRzLmxlbmd0aCAtIDE7IGkrKykge1xuICAgICAgaWYgKHRoaXMucG9pbnRzW2ldLm91dGxpbmUpIHtcbiAgICAgICAgdmFyIF9jaSA9IDA7XG4gICAgICAgIHdoaWxlKCF0aGlzLnBvaW50c1tpXS5vdXRsaW5lLmN1cnZlc1srK19jaV0uX2xpbmVhcil7XG4gICAgICAgICAgdGhpcy5kcmF3Q3VydmUoY3R4LCB0aGlzLnBvaW50c1tpXS5vdXRsaW5lLmN1cnZlc1tfY2ldKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnBvaW50c1tpXS5vdXRsaW5lLl9fbWlkZGxlID0gX2NpO1xuICAgICAgfVxuICAgIH1cbiAgICBmb3IgKGkgPSB0aGlzLnBvaW50cy5sZW5ndGg7IGkgLS07KSB7XG4gICAgICBpZiAodGhpcy5wb2ludHNbaV0ub3V0bGluZSkge1xuICAgICAgICBfY2kgPSB0aGlzLnBvaW50c1tpXS5vdXRsaW5lLl9fbWlkZGxlO1xuICAgICAgICB3aGlsZSh0aGlzLnBvaW50c1tpXS5vdXRsaW5lLmN1cnZlc1srK19jaV0pe1xuICAgICAgICAgIHRoaXMuZHJhd0N1cnZlKGN0eCwgdGhpcy5wb2ludHNbaV0ub3V0bGluZS5jdXJ2ZXNbX2NpXSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgY3R4LmNsb3NlUGF0aCgpO1xuICAgIHRoaXMuX3JlbmRlckZpbGwoY3R4KTtcbiAgICB0aGlzLl9yZW5kZXJTdHJva2UoY3R4KTtcblxuICAgIGN0eC5yZXN0b3JlKCk7XG4gIH0sXG4gIG1lcmdlOiBmdW5jdGlvbiAocG9seWxpbmUscEluZGV4MSxwSW5kZXgyKSB7XG4gICAgdmFyIGksXG4gICAgICAgIF94ID0gcG9seWxpbmUubGVmdCAtIHRoaXMubGVmdCxcbiAgICAgICAgX3kgPSBwb2x5bGluZS50b3AgLSB0aGlzLnRvcCxcbiAgICAgICAgX3BvaW50cyA9IHRoaXMucG9pbnRzLFxuICAgICAgICBfYWN0aW9uLFxuICAgICAgICBfUFAgPSBwb2x5bGluZS5wb2ludHM7XG5cbiAgICBpZihwSW5kZXgxKSB7XG4gICAgICBfYWN0aW9uID0gXCJwdXNoXCI7XG4gICAgICBfcG9pbnRzLnBvcCgpO1xuICAgIH1lbHNle1xuICAgICAgX2FjdGlvbiA9IFwidW5zaGlmdFwiO1xuICAgICAgX3BvaW50cy5zaGlmdCgpO1xuICAgIH1cbiAgICB2YXIgYWRkUG9pbnQgPSBmdW5jdGlvbiAobWFpbl9wb2ludCxyZXZlcnNlUG9pbnQpe1xuICAgICAgdmFyIGN1cnZlX3BvaW50ID0gcmV2ZXJzZVBvaW50ICYmIHJldmVyc2VQb2ludC5jO1xuICAgICAgdmFyIG5ld19wb2ludCA9IHtcbiAgICAgICAgeDogbWFpbl9wb2ludC54ICsgX3gsXG4gICAgICAgIHk6IG1haW5fcG9pbnQueSArIF95LFxuICAgICAgfTtcbiAgICAgIGlmKGN1cnZlX3BvaW50KXtcbiAgICAgICAgbmV3X3BvaW50LmMgPSB7XG4gICAgICAgICAgeDogY3VydmVfcG9pbnQueCArIF94LFxuICAgICAgICAgIHk6IGN1cnZlX3BvaW50LnkgKyBfeSxcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgX3BvaW50c1tfYWN0aW9uXShuZXdfcG9pbnQpO1xuICAgIH07XG4gICAgaWYocEluZGV4MiA9PSAwKXtcbiAgICAgIGZvcihpID0gMCA7IGkgPCBfUFAubGVuZ3RoOyBpKyspe1xuICAgICAgICBhZGRQb2ludChfUFBbaV0gLCBfUFBbcEluZGV4MSA/IGkgOiAgaSAtIDFdKTtcbiAgICAgIH1cbiAgICB9ZWxzZXtcbiAgICAgIGZvcihpID0gX1BQLmxlbmd0aCA7IGktLTspe1xuICAgICAgICBhZGRQb2ludChfUFBbaV0gLCBfUFBbcEluZGV4MSA/IGkgLSAxOiBpXSk7XG4gICAgICB9XG4gICAgfVxuICAgIHBvbHlsaW5lLnJlbW92ZSgpO1xuICAgIGZvcihpID0wOyBpIDwgX3BvaW50cy5sZW5ndGg7IGkrKyl7XG4gICAgICBpZihfcG9pbnRzW2ldLmMgJiYgIV9wb2ludHNbaV0uY3VydmUpe1xuICAgICAgICB0aGlzLl9tYWtlQ3VydmUoX3BvaW50c1tpXSxfcG9pbnRzW2ldLmMsX3BvaW50c1tpICsgMV0pO1xuICAgICAgfVxuICAgIH1cbiAgICB0aGlzLnVwZGF0ZUJib3goKTtcbiAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgfSxcbiAgZ2V0Q29udHJvbFBvaW50OiBmdW5jdGlvbiAoaWQpIHtcbiAgICByZXR1cm4gZmFicmljLnV0aWwub2JqZWN0LmZpbmRXaGVyZSh0aGlzLl9jb250cm9scyx7aWQ6IGlkfSk7XG4gIH0sXG4gIHNldEV4dHJhQ29udHJvbHM6IGZ1bmN0aW9uKGNvbnRyb2xzKXtcbiAgICB0aGlzLmFkZFBvaW50c0NvbnRyb2xzKGNvbnRyb2xzKTtcbiAgICB0aGlzLmFkZEV4dGVuc2lvbkFyZWFDb250cm9scyhjb250cm9scyk7XG4gIH0sXG4gIGFkZEV4dGVuc2lvbkFyZWFDb250cm9sczogZnVuY3Rpb24oY29udHJvbHMpe1xuXG4gICAgdmFyICBwdHMgPSB0aGlzLnBvaW50cztcbiAgICB2YXIgX2xhc3QgPSBwdHMubGVuZ3RoIC0gMTtcbiAgICBpZih0aGlzLmV4dGVuc2lvbkFyZWFFbmFibGVkKXtcbiAgICAgIGNvbnRyb2xzW1wiZTFcIl0gPSB7XG4gICAgICAgIGFjdGlvbjogXCJ1bnNoaWZ0XCIsXG4gICAgICAgIHg6IHB0c1swXS54LFxuICAgICAgICB5OiBwdHNbMF0ueSxcbiAgICAgICAgc3R5bGU6IHRoaXMuY29ybmVyU3R5bGUsXG4gICAgICAgIGFyZWE6ICB0aGlzLmVuZGVyQXJlYVNpemUsXG4gICAgICAgIHZpc2libGU6IHRydWVcbiAgICAgIH07XG4gICAgICBjb250cm9sc1tcImUyXCJdID0ge1xuICAgICAgICBhY3Rpb246IFwicHVzaFwiLFxuICAgICAgICB4OiBwdHNbX2xhc3RdLngsXG4gICAgICAgIHk6IHB0c1tfbGFzdF0ueSxcbiAgICAgICAgc3R5bGU6IHRoaXMuY29ybmVyU3R5bGUsXG4gICAgICAgIGFyZWE6ICB0aGlzLmVuZGVyQXJlYVNpemUsXG4gICAgICAgIHZpc2libGU6IHRydWVcbiAgICAgIH07XG4gICAgfVxuICB9LFxuICBjaGVja01lcmdlOiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHRhcmdldCA9IHRoaXMsIF90bGFzdCA9IHRoaXMucG9pbnRzLmxlbmd0aCAtIDE7XG4gICAgdmFyIHAxID0gdGhpcy5wb2ludHNbMF0sXG4gICAgICBwMiA9IHRoaXMucG9pbnRzW190bGFzdF0sXG4gICAgICBfZGlzdGFuY2UgPSBmYWJyaWMuUG9pbnQucHJvdG90eXBlLmRpc3RhbmNlRnJvbTtcbiAgICBwMSA9IHtcbiAgICAgIHggOiBwMS54ICsgdGhpcy5sZWZ0LFxuICAgICAgeTogIHAxLnkgKyB0aGlzLnRvcFxuICAgIH07XG4gICAgcDIgPSB7XG4gICAgICB4IDogcDIueCArIHRoaXMubGVmdCxcbiAgICAgIHk6ICBwMi55ICsgdGhpcy50b3BcbiAgICB9O1xuXG4gICAgdmFyIF9kaXN0ID0gMTA7XG5cbiAgICB0aGlzLmNhbnZhcy5fb2JqZWN0cy5zb21lKGZ1bmN0aW9uKG9iaikge1xuICAgICAgaWYgKG9iaiA9PSB0YXJnZXQgfHwgb2JqLnR5cGUgIT09IFwicG9seWxpbmVcIilyZXR1cm4gZmFsc2U7XG4gICAgICB2YXIgX29sYXN0ID0gb2JqLnBvaW50cy5sZW5ndGggLSAxO1xuXG4gICAgICB2YXIgcDMgPSBvYmoucG9pbnRzWzBdO1xuICAgICAgdmFyIHA0ID0gb2JqLnBvaW50c1tfb2xhc3RdO1xuICAgICAgcDMgPSB7XG4gICAgICAgIHggOiBwMy54ICsgb2JqLmxlZnQsXG4gICAgICAgIHk6ICBwMy55ICsgb2JqLnRvcFxuICAgICAgfTtcbiAgICAgIHA0ID0ge1xuICAgICAgICB4IDogcDQueCArIG9iai5sZWZ0LFxuICAgICAgICB5OiAgcDQueSArIG9iai50b3BcbiAgICAgIH07XG5cbiAgICAgIGlmKF9kaXN0YW5jZS5jYWxsKHAxLCBwMykgPCBfZGlzdCl7XG4gICAgICAgIHRhcmdldC5tZXJnZShvYmosMCwwKVxuICAgICAgfVxuICAgICAgaWYoX2Rpc3RhbmNlLmNhbGwocDEsIHA0KSA8IF9kaXN0KXtcbiAgICAgICAgdGFyZ2V0Lm1lcmdlKG9iaiwwLF9vbGFzdClcbiAgICAgIH1cbiAgICAgIGlmKF9kaXN0YW5jZS5jYWxsKHAyLCBwMykgPCBfZGlzdCl7XG4gICAgICAgIHRhcmdldC5tZXJnZShvYmosX3RsYXN0LDApXG4gICAgICB9XG4gICAgICBpZihfZGlzdGFuY2UuY2FsbChwMiwgcDQpIDwgX2Rpc3Qpe1xuICAgICAgICB0YXJnZXQubWVyZ2Uob2JqLF90bGFzdCxfb2xhc3QpXG4gICAgICB9XG4gICAgfSlcbiAgfVxufSk7XG5cbmZhYnJpYy5Qb2x5bGluZS5mcm9tT2JqZWN0ID0gZnVuY3Rpb24gKG9iamVjdCkge1xuICByZXR1cm4gbmV3IHRoaXMob2JqZWN0KTtcbn07XG5cblxuZmFicmljLnV0aWwuY3JlYXRlQWNjZXNzb3JzKGZhYnJpYy5Qb2x5bGluZSk7XG5cbnJlcXVpcmUoXCIuL3BvbHlsaW5lLmNvbnRyb2xzXCIpO1xuXG5cblxuXG5pZiAoZmFicmljLm9iamVjdHNMaWJyYXJ5KSB7XG4gIGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLm9iamVjdHNMaWJyYXJ5LCB7XG4gICAgc2hhcGU6IHtcbiAgICAgIHR5cGU6IFwicG9seWxpbmVcIixcbiAgICAgIHBvaW50czogZnVuY3Rpb24gKHcsIGgpIHtcbiAgICAgICAgICByZXR1cm4gW1xuICAgICAgICAgIHt4OiAyNSwgeTogMX0sXG4gICAgICAgICAge3g6IDMxLCB5OiAxOH0sXG4gICAgICAgICAge3g6IDQ5LCB5OiAxOH0sXG4gICAgICAgICAge3g6IDM1LCB5OiAyOX0sXG4gICAgICAgICAge3g6IDQwLCB5OiA0Nn0sXG4gICAgICAgICAge3g6IDI1LCB5OiAzNn0sXG4gICAgICAgICAge3g6IDEwLCB5OiA0Nn0sXG4gICAgICAgICAge3g6IDE1LCB5OiAyOX0sXG4gICAgICAgICAge3g6IDEsIHk6IDE4fSxcbiAgICAgICAgICB7eDogMTksIHk6IDE4fVxuICAgICAgICBdO1xuICAgICAgfSxcbiAgICAgIFwic3Ryb2tlXCI6IFwiYmxhY2tcIixcbiAgICAgIFwiZmlsbFwiOiBcImJsdWVcIlxuICAgIH1cbiAgfSk7XG59XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL3NoYXBlcy9wb2x5bGluZS5qcyIsIid1c2Ugc3RyaWN0JztcblxudmFyIEJlemllciA9IHJlcXVpcmUoXCIuLi9wbHVnaW5zL2JlemllclwiKTtcbnJlcXVpcmUoXCIuLy4uL21peGlucy9zaGFwZU1peGluXCIpO1xuXG5mYWJyaWMuQmV6aWVyTWl4aW4gPSB7XG4gIGN1cnZlQ29ybmVyU2l6ZTogNCxcbiAgY3VydmVDb3JuZXJTdHlsZTogXCJyZWN0XCIsXG4gIG91dGxpbmVUb3A6IDAsXG4gIG91dGxpbmVCb3R0b206IDAsXG5cblxuICBfcmVuZGVyQmV6aWVyOiBmdW5jdGlvbiAoY3R4LF9vdXRsaW5lICx4LHkpIHtcbiAgICBfb3V0bGluZSA9IF9vdXRsaW5lIHx8IHRoaXMub3V0bGluZTtcbiAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAvLyBjdHguc2F2ZSgpO1xuICAgIC8vIGN0eC50cmFuc2xhdGUodGhpcy5fdHJhbnNhbGF0ZS54LCB0aGlzLl90cmFuc2FsYXRlLnkpO1xuICAgIHZhciBkb2MgPSBmdW5jdGlvbiAoYykge1xuICAgICAgX3RoaXMuZHJhd0N1cnZlKGN0eCwgYyk7XG4gICAgfTtcbiAgICBfb3V0bGluZS5jdXJ2ZXMuZm9yRWFjaChkb2MpO1xuXG4gICAgY3R4LmNsb3NlUGF0aCgpO1xuXG4gICAgdGhpcy5fcmVuZGVyRmlsbChjdHgpO1xuICAgIHRoaXMuX3JlbmRlclN0cm9rZShjdHgpO1xuICB9LFxuICBkcmF3QmV6aWVyQ29udHJvbHM6IGZ1bmN0aW9uIChjdHgsIHAxLCBwMiwgcDMsIHA0KSB7XG4gICAgdmFyIHB0cyA9IHRoaXMucG9pbnRzO1xuICAgIGN0eC5zYXZlKCk7XG4gICAgY3R4Lmdsb2JhbEFscGhhID0gdGhpcy5pc01vdmluZyA/IHRoaXMuYm9yZGVyT3BhY2l0eVdoZW5Nb3ZpbmcgOiAxO1xuICAgIGN0eC5zdHJva2VTdHlsZSA9IGN0eC5maWxsU3R5bGUgPSB0aGlzLmNvcm5lckNvbG9yO1xuICAgIGN0eC5zY2FsZSh0aGlzLmNhbnZhcy52aWV3cG9ydFRyYW5zZm9ybVswXSwgdGhpcy5jYW52YXMudmlld3BvcnRUcmFuc2Zvcm1bM10pO1xuICAgIGN0eC50cmFuc2xhdGUoLXRoaXMud2lkdGggLyAyICogdGhpcy5zY2FsZVgsIC10aGlzLmhlaWdodCAvIDIgKiB0aGlzLnNjYWxlWSk7XG4gICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgIGN0eC5tb3ZlVG8ocDEueCAqIHRoaXMuc2NhbGVYLCBwMS55ICogdGhpcy5zY2FsZVkpO1xuICAgIGN0eC5saW5lVG8ocDIueCAqIHRoaXMuc2NhbGVYLCBwMi55ICogdGhpcy5zY2FsZVkpO1xuICAgIGlmIChwdHMubGVuZ3RoID09PSAzKSB7XG4gICAgICBjdHgubW92ZVRvKHAyLnggKiB0aGlzLnNjYWxlWCwgcDIueSAqIHRoaXMuc2NhbGVZKTtcbiAgICAgIGN0eC5saW5lVG8ocDMueCAqIHRoaXMuc2NhbGVYLCBwMy55ICogdGhpcy5zY2FsZVkpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIGN0eC5tb3ZlVG8ocDMueCAqIHRoaXMuc2NhbGVYLCBwMy55ICogdGhpcy5zY2FsZVkpO1xuICAgICAgY3R4LmxpbmVUbyhwNC54ICogdGhpcy5zY2FsZVgsIHA0LnkgKiB0aGlzLnNjYWxlWSk7XG4gICAgfVxuICAgIGN0eC5jbG9zZVBhdGgoKTtcbiAgICBjdHguc3Ryb2tlKCk7XG4gICAgY3R4LnNjYWxlKHRoaXMuc2NhbGVYLCB0aGlzLnNjYWxlWSk7XG4gICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgIHRoaXMuZHJhd0N1cnZlKGN0eCwgcDEuY3VydmUpO1xuICAgIGN0eC5zdHJva2UoKTtcbiAgICBjdHgucmVzdG9yZSgpO1xuICB9LFxuICBkcmF3Q3VydmU6IGZ1bmN0aW9uIChjdHgsIGN1cnZlLCBvZmZzZXQpIHtcbiAgICBvZmZzZXQgPSBvZmZzZXQgfHwge3g6IDAsIHk6IDB9O1xuICAgIHZhciBveCA9IG9mZnNldC54O1xuICAgIHZhciBveSA9IG9mZnNldC55O1xuICAgIHZhciBwID0gY3VydmUucG9pbnRzLCBpO1xuICAgIC8vY3R4Lm1vdmVUbyhwWzBdLnggKyBveCwgcFswXS55ICsgb3kpO1xuICAgIGN0eC5saW5lVG8ocFswXS54ICsgb3gsIHBbMF0ueSArIG95KTtcbiAgICBpZiAocC5sZW5ndGggPT09IDMpIHtcbiAgICAgIGN0eC5xdWFkcmF0aWNDdXJ2ZVRvKFxuICAgICAgICBwWzFdLnggKyBveCwgcFsxXS55ICsgb3ksXG4gICAgICAgIHBbMl0ueCArIG94LCBwWzJdLnkgKyBveVxuICAgICAgKTtcbiAgICB9XG4gICAgaWYgKHAubGVuZ3RoID09PSA0KSB7XG4gICAgICBjdHguYmV6aWVyQ3VydmVUbyhcbiAgICAgICAgcFsxXS54ICsgb3gsIHBbMV0ueSArIG95LFxuICAgICAgICBwWzJdLnggKyBveCwgcFsyXS55ICsgb3ksXG4gICAgICAgIHBbM10ueCArIG94LCBwWzNdLnkgKyBveVxuICAgICAgKTtcbiAgICB9XG4gIH0sXG4gIGRyYXdMaW5lOiBmdW5jdGlvbiAoY3R4LCBwMSwgcDIsIG9mZnNldCkge1xuICAgIG9mZnNldCA9IG9mZnNldCB8fCB7eDogMCwgeTogMH07XG4gICAgdmFyIG94ID0gb2Zmc2V0Lng7XG4gICAgdmFyIG95ID0gb2Zmc2V0Lnk7XG4gICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgIGN0eC5tb3ZlVG8ocDEueCArIG94LCBwMS55ICsgb3kpO1xuICAgIGN0eC5saW5lVG8ocDIueCArIG94LCBwMi55ICsgb3kpO1xuICAgIGN0eC5zdHJva2UoKTtcbiAgfSxcbiAgZHJhd1BvaW50OiBmdW5jdGlvbiAoY3R4LCBwLCBvZmZzZXQpIHtcbiAgICBvZmZzZXQgPSBvZmZzZXQgfHwge3g6IDAsIHk6IDB9O1xuICAgIHZhciBveCA9IG9mZnNldC54O1xuICAgIHZhciBveSA9IG9mZnNldC55O1xuICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICBjdHguYXJjKHAueCArIG94LCBwLnkgKyBveSwgNSwgMCwgMiAqIE1hdGguUEkpO1xuICAgIGN0eC5zdHJva2UoKTtcbiAgfSxcbiAgZHJhd1BvaW50czogZnVuY3Rpb24gKGN0eCwgcG9pbnRzLCBvZmZzZXQpIHtcbiAgICBvZmZzZXQgPSBvZmZzZXQgfHwge3g6IDAsIHk6IDB9O1xuICAgIHBvaW50cy5mb3JFYWNoKGZ1bmN0aW9uIChwKSB7XG4gICAgICB0aGlzLmRyYXdDaXJjbGUoY3R4LCBwLCAzLCBvZmZzZXQpO1xuICAgIH0uYmluZCh0aGlzKSk7XG4gIH0sXG4gIGRyYXdBcmM6IGZ1bmN0aW9uIChjdHgsIHAsIG9mZnNldCkge1xuICAgIG9mZnNldCA9IG9mZnNldCB8fCB7eDogMCwgeTogMH07XG4gICAgdmFyIG94ID0gb2Zmc2V0Lng7XG4gICAgdmFyIG95ID0gb2Zmc2V0Lnk7XG4gICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgIGN0eC5tb3ZlVG8ocC54ICsgb3gsIHAueSArIG95KTtcbiAgICBjdHguYXJjKHAueCArIG94LCBwLnkgKyBveSwgcC5yLCBwLnMsIHAuZSk7XG4gICAgY3R4LmxpbmVUbyhwLnggKyBveCwgcC55ICsgb3kpO1xuICAgIGN0eC5maWxsKCk7XG4gICAgY3R4LnN0cm9rZSgpO1xuICB9LFxuICBkcmF3Q2lyY2xlOiBmdW5jdGlvbiAoY3R4LCBwLCByLCBvZmZzZXQpIHtcbiAgICBvZmZzZXQgPSBvZmZzZXQgfHwge3g6IDAsIHk6IDB9O1xuICAgIHZhciBveCA9IG9mZnNldC54O1xuICAgIHZhciBveSA9IG9mZnNldC55O1xuICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICBjdHguYXJjKHAueCArIG94LCBwLnkgKyBveSwgciwgMCwgMiAqIE1hdGguUEkpO1xuICAgIGN0eC5zdHJva2UoKTtcbiAgfSxcbiAgZHJhd2Jib3g6IGZ1bmN0aW9uIChjdHgsIGJib3gsIG9mZnNldCkge1xuICAgIG9mZnNldCA9IG9mZnNldCB8fCB7eDogMCwgeTogMH07XG4gICAgdmFyIG94ID0gb2Zmc2V0Lng7XG4gICAgdmFyIG95ID0gb2Zmc2V0Lnk7XG4gICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgIGN0eC5tb3ZlVG8oYmJveC54Lm1pbiArIG94LCBiYm94LnkubWluICsgb3kpO1xuICAgIGN0eC5saW5lVG8oYmJveC54Lm1pbiArIG94LCBiYm94LnkubWF4ICsgb3kpO1xuICAgIGN0eC5saW5lVG8oYmJveC54Lm1heCArIG94LCBiYm94LnkubWF4ICsgb3kpO1xuICAgIGN0eC5saW5lVG8oYmJveC54Lm1heCArIG94LCBiYm94LnkubWluICsgb3kpO1xuICAgIGN0eC5jbG9zZVBhdGgoKTtcbiAgICBjdHguc3Ryb2tlKCk7XG4gIH0sXG4gIGRyYXdIdWxsOiBmdW5jdGlvbiAoY3R4LCBodWxsLCBvZmZzZXQpIHtcbiAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgaWYgKGh1bGwubGVuZ3RoID09PSA2KSB7XG4gICAgICBjdHgubW92ZVRvKGh1bGxbMF0ueCwgaHVsbFswXS55KTtcbiAgICAgIGN0eC5saW5lVG8oaHVsbFsxXS54LCBodWxsWzFdLnkpO1xuICAgICAgY3R4LmxpbmVUbyhodWxsWzJdLngsIGh1bGxbMl0ueSk7XG4gICAgICBjdHgubW92ZVRvKGh1bGxbM10ueCwgaHVsbFszXS55KTtcbiAgICAgIGN0eC5saW5lVG8oaHVsbFs0XS54LCBodWxsWzRdLnkpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjdHgubW92ZVRvKGh1bGxbMF0ueCwgaHVsbFswXS55KTtcbiAgICAgIGN0eC5saW5lVG8oaHVsbFsxXS54LCBodWxsWzFdLnkpO1xuICAgICAgY3R4LmxpbmVUbyhodWxsWzJdLngsIGh1bGxbMl0ueSk7XG4gICAgICBjdHgubGluZVRvKGh1bGxbM10ueCwgaHVsbFszXS55KTtcbiAgICAgIGN0eC5tb3ZlVG8oaHVsbFs0XS54LCBodWxsWzRdLnkpO1xuICAgICAgY3R4LmxpbmVUbyhodWxsWzVdLngsIGh1bGxbNV0ueSk7XG4gICAgICBjdHgubGluZVRvKGh1bGxbNl0ueCwgaHVsbFs2XS55KTtcbiAgICAgIGN0eC5tb3ZlVG8oaHVsbFs3XS54LCBodWxsWzddLnkpO1xuICAgICAgY3R4LmxpbmVUbyhodWxsWzhdLngsIGh1bGxbOF0ueSk7XG4gICAgfVxuICAgIGN0eC5zdHJva2UoKTtcbiAgfSxcbiAgZHJhd1NoYXBlOiBmdW5jdGlvbiAoY3R4LCBzaGFwZSwgb2Zmc2V0KSB7XG4gICAgb2Zmc2V0ID0gb2Zmc2V0IHx8IHt4OiAwLCB5OiAwfTtcbiAgICB2YXIgb3JkZXIgPSBzaGFwZS5mb3J3YXJkLnBvaW50cy5sZW5ndGggLSAxO1xuICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICBjdHgubW92ZVRvKG9mZnNldC54ICsgc2hhcGUuc3RhcnRjYXAucG9pbnRzWzBdLngsIG9mZnNldC55ICsgc2hhcGUuc3RhcnRjYXAucG9pbnRzWzBdLnkpO1xuICAgIGN0eC5saW5lVG8ob2Zmc2V0LnggKyBzaGFwZS5zdGFydGNhcC5wb2ludHNbM10ueCwgb2Zmc2V0LnkgKyBzaGFwZS5zdGFydGNhcC5wb2ludHNbM10ueSk7XG4gICAgaWYgKG9yZGVyID09PSAzKSB7XG4gICAgICBjdHguYmV6aWVyQ3VydmVUbyhcbiAgICAgICAgb2Zmc2V0LnggKyBzaGFwZS5mb3J3YXJkLnBvaW50c1sxXS54LCBvZmZzZXQueSArIHNoYXBlLmZvcndhcmQucG9pbnRzWzFdLnksXG4gICAgICAgIG9mZnNldC54ICsgc2hhcGUuZm9yd2FyZC5wb2ludHNbMl0ueCwgb2Zmc2V0LnkgKyBzaGFwZS5mb3J3YXJkLnBvaW50c1syXS55LFxuICAgICAgICBvZmZzZXQueCArIHNoYXBlLmZvcndhcmQucG9pbnRzWzNdLngsIG9mZnNldC55ICsgc2hhcGUuZm9yd2FyZC5wb2ludHNbM10ueVxuICAgICAgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY3R4LnF1YWRyYXRpY0N1cnZlVG8oXG4gICAgICAgIG9mZnNldC54ICsgc2hhcGUuZm9yd2FyZC5wb2ludHNbMV0ueCwgb2Zmc2V0LnkgKyBzaGFwZS5mb3J3YXJkLnBvaW50c1sxXS55LFxuICAgICAgICBvZmZzZXQueCArIHNoYXBlLmZvcndhcmQucG9pbnRzWzJdLngsIG9mZnNldC55ICsgc2hhcGUuZm9yd2FyZC5wb2ludHNbMl0ueVxuICAgICAgKTtcbiAgICB9XG4gICAgY3R4LmxpbmVUbyhvZmZzZXQueCArIHNoYXBlLmVuZGNhcC5wb2ludHNbM10ueCwgb2Zmc2V0LnkgKyBzaGFwZS5lbmRjYXAucG9pbnRzWzNdLnkpO1xuICAgIGlmIChvcmRlciA9PT0gMykge1xuICAgICAgY3R4LmJlemllckN1cnZlVG8oXG4gICAgICAgIG9mZnNldC54ICsgc2hhcGUuYmFjay5wb2ludHNbMV0ueCwgb2Zmc2V0LnkgKyBzaGFwZS5iYWNrLnBvaW50c1sxXS55LFxuICAgICAgICBvZmZzZXQueCArIHNoYXBlLmJhY2sucG9pbnRzWzJdLngsIG9mZnNldC55ICsgc2hhcGUuYmFjay5wb2ludHNbMl0ueSxcbiAgICAgICAgb2Zmc2V0LnggKyBzaGFwZS5iYWNrLnBvaW50c1szXS54LCBvZmZzZXQueSArIHNoYXBlLmJhY2sucG9pbnRzWzNdLnlcbiAgICAgICk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGN0eC5xdWFkcmF0aWNDdXJ2ZVRvKFxuICAgICAgICBvZmZzZXQueCArIHNoYXBlLmJhY2sucG9pbnRzWzFdLngsIG9mZnNldC55ICsgc2hhcGUuYmFjay5wb2ludHNbMV0ueSxcbiAgICAgICAgb2Zmc2V0LnggKyBzaGFwZS5iYWNrLnBvaW50c1syXS54LCBvZmZzZXQueSArIHNoYXBlLmJhY2sucG9pbnRzWzJdLnlcbiAgICAgICk7XG4gICAgfVxuICAgIGN0eC5jbG9zZVBhdGgoKTtcbiAgICBjdHguZmlsbCgpO1xuICAgIGN0eC5zdHJva2UoKTtcbiAgfSxcbiAgLy8gaW5pdEJlemllcjogZnVuY3Rpb24gKCkge1xuICAvLyAgIHRoaXMuY3VydmUgPSBuZXcgQmV6aWVyKDAsIDAsIDAsIDEsIDEsIDEsIDAsIDEpO1xuICAvLyAgIHRoaXMub3V0bGluZSA9IHRoaXMuY3VydmUub3V0bGluZSh0aGlzLmJlemllck91dGxpbmVbMF0sIHRoaXMuYmV6aWVyT3V0bGluZVsxXSk7XG4gIC8vIH0sXG4gIC8vIGJlemllclR5cGU6IFwicXVhZHJhdGljQnlQb2ludHNcIixcbiAgLy8gZGVmYXVsdFNoYXBlOiBcImFyY1wiLC8vbGluZVxuICBzZXRQb2ludHM6IGZ1bmN0aW9uIChwb2ludHMpIHtcblxuICAgIGlmKHBvaW50cyAmJiBwb2ludHNbMF0gIT09IHVuZGVmaW5lZCAmJiBwb2ludHNbMF0ueCA9PT0gdW5kZWZpbmVkKXtcbiAgICAgIHZhciBfTkVXX3BvaW50cyA9IFtdO1xuICAgICAgZm9yKHZhciBpPTA7IGkgPCBwb2ludHMubGVuZ3RoIDtpKz0yKXtcbiAgICAgICAgX05FV19wb2ludHMucHVzaCh7eDogcG9pbnRzW2ldICwgeTogcG9pbnRzW2kgKyAxXX0pO1xuICAgICAgfVxuICAgICAgcG9pbnRzID0gX05FV19wb2ludHM7XG4gICAgfVxuXG5cbiAgICAvLyBpZih0aGlzLmRlZmF1bHRTaGFwZSA9PSBcImN1cnZlXCIpe1xuICAgIC8vICAgcG9pbnRzID0gWzAsIDAsIHRoaXMud2lkdGgvMiwgLXRoaXMud2lkdGgvMiwgdGhpcy53aWR0aC8yLCB0aGlzLndpZHRoLzIsIHRoaXMud2lkdGgsIDBdO1xuICAgIC8vIH1lbHNlIGlmKHRoaXMuZGVmYXVsdFNoYXBlID09IFwiYXJjXCIpe1xuICAgIC8vICAgcG9pbnRzID0gWzAsIDAsIHRoaXMud2lkdGgqMC4xNiwgLXRoaXMud2lkdGgqMC40MywgdGhpcy53aWR0aCAqKDEgLSAwLjE2KSwgLXRoaXMud2lkdGgqMC40MywgdGhpcy53aWR0aCwgMF07XG4gICAgLy8gfWVsc2V7XG4gICAgLy8gICBwb2ludHMgPSBbMCwgMCwgdGhpcy53aWR0aCAvIDMsIDEsIHRoaXMud2lkdGggLyAzICogMiwgMSwgdGhpcy53aWR0aCwgMF07XG4gICAgLy8gfVxuICAgIHZhciBfaW50ZXJ2YWxzID0gdGhpcy5jbG9zZWQgJiYgcG9pbnRzLmxlbmd0aCA+IDEgPyBwb2ludHMubGVuZ3RoIDogcG9pbnRzLmxlbmd0aCAtIDE7XG4gICAgdGhpcy5wb2ludHMgPSBbXS5jb25jYXQocG9pbnRzKTtcbiAgICBpZih0aGlzLnBvaW50cy5sZW5ndGggPiAxICYmIHRoaXMuYmV6aWVyQ29udHJvbHMpe1xuICAgICAgZm9yKHZhciBpID0gMCA7IGkgPCBfaW50ZXJ2YWxzOyBpICsrICl7XG4gICAgICAgIHZhciBwMiA9IHRoaXMucG9pbnRzW2kgKyAxXSB8fCB0aGlzLnBvaW50c1swXTtcbiAgICAgICAgdmFyIHAxID0gdGhpcy5wb2ludHNbaV07XG4gICAgICAgIHZhciBfY3AgPSBwMS5jO1xuICAgICAgICBpZihfY3Ape1xuICAgICAgICAgIGlmKHAxLmMyKXtcbiAgICAgICAgICAgIHRoaXMuX21ha2VDdWJpYyhwMSwgcDEuYyxwMS5jMiwgcDIpO1xuICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgdGhpcy5fbWFrZUN1cnZlKHAxLCBwMS5jLCBwMik7XG4gICAgICAgICAgfVxuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICBfY3AgPSB7XG4gICAgICAgICAgICB4OiAocDEueCArIHAyLngpLzIsXG4gICAgICAgICAgICB5OiAocDEueSArIHAyLnkpLzJcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIC8vIHNldFBvaW50OiBmdW5jdGlvbiAob3JkZXIsIF9wb2ludCkge1xuICAvLyAgIHZhciBfcG9pbnRzID0gdGhpcy5wb2ludHM7XG4gIC8vICAgX3BvaW50c1tvcmRlcl0ueCA9IF9wb2ludC54O1xuICAvLyAgIF9wb2ludHNbb3JkZXJdLnkgPSBfcG9pbnQueTtcbiAgLy9cbiAgLy8gICBpZihvcmRlciA9PSAwICl7XG4gIC8vICAgICB2YXIgX3AxID0gX3BvaW50c1sxXSwgX3AyID0gIF9wb2ludHNbMF07XG4gIC8vICAgfVxuICAvLyAgIGlmKG9yZGVyID09IDEgKXtcbiAgLy8gICAgIHZhciBfcDEgPSBfcG9pbnRzWzBdLCBfcDIgPSAgX3BvaW50c1sxXTtcbiAgLy8gICB9XG4gIC8vICAgaWYoX3BvaW50cy5sZW5ndGggPT0gMyl7XG4gIC8vICAgICBpZihvcmRlciA9PSAyICl7XG4gIC8vICAgICAgIHZhciBfcDEgPSBfcG9pbnRzWzFdLCBfcDIgPSAgX3BvaW50c1syXTtcbiAgLy8gICAgIH1cbiAgLy8gICB9ZWxzZXtcbiAgLy8gICAgIGlmKG9yZGVyID09IDIgKXtcbiAgLy8gICAgICAgdmFyIF9wMSA9IF9wb2ludHNbM10sIF9wMiA9ICBfcG9pbnRzWzJdO1xuICAvLyAgICAgfVxuICAvLyAgICAgaWYob3JkZXIgPT0gMyApe1xuICAvLyAgICAgICB2YXIgX3AxID0gX3BvaW50c1syXSwgX3AyID0gIF9wb2ludHNbM107XG4gIC8vICAgICB9XG4gIC8vICAgfVxuICAvLyAgIGlmIChfcDEueCAtIF9wMi54IDwgMSkge1xuICAvLyAgICAgaWYoX3AxLnggPCAgX3AyLngpe1xuICAvLyAgICAgICBfcDIueCsrO1xuICAvLyAgICAgfWVsc2V7XG4gIC8vICAgICAgIF9wMi54LS07XG4gIC8vICAgICB9XG4gIC8vICAgfVxuICAvLyAgIGlmIChfcDEueSAtIF9wMi55IDwgMSkge1xuICAvLyAgICAgaWYoX3AxLnkgPCAgX3AyLnkpe1xuICAvLyAgICAgICBfcDIueSsrO1xuICAvLyAgICAgfWVsc2V7XG4gIC8vICAgICAgIF9wMi55LS07XG4gIC8vICAgICB9XG4gIC8vICAgfVxuICAvLyAgIHRoaXMuY3VydmUudXBkYXRlKCk7XG4gIC8vICAgdGhpcy5vdXRsaW5lID0gdGhpcy5jdXJ2ZS5vdXRsaW5lKHRoaXMuYmV6aWVyT3V0bGluZVswXSwgdGhpcy5iZXppZXJPdXRsaW5lWzFdKTtcbiAgLy8gICB0aGlzLnVwZGF0ZUJib3goKTtcbiAgLy8gICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgLy8gfVxuXG4gIHNldEV4dHJhQ29udHJvbHM6IGZ1bmN0aW9uKGNvbnRyb2xzKXtcbiAgICB0aGlzLmFkZFBvaW50c0NvbnRyb2xzKGNvbnRyb2xzKTtcbiAgfSxcblxuICBhZGRQb2ludHNDb250cm9sczogZnVuY3Rpb24oY29udHJvbHMpe1xuXG4gICAgdmFyIHB0cyA9IHRoaXMucG9pbnRzLFxuICAgICAgX2xhc3QgPSBwdHMubGVuZ3RoIC0gMTtcbiAgICBmb3IodmFyIGkgaW4gcHRzKXtcbiAgICAgIGNvbnRyb2xzW1wicFwiICsgKCtpICsgMSldID0ge1xuICAgICAgICBhY3Rpb246IFwic2hhcGVcIixcbiAgICAgICAgdmlzaWJsZTogdHJ1ZSxcbiAgICAgICAgeDogcHRzW2ldLngsXG4gICAgICAgIHk6IHB0c1tpXS55LFxuICAgICAgICBhcmVhOiAgKHRoaXMuZXh0ZW5zaW9uQXJlYUVuYWJsZWQgJiYgKGkgPT0gMCB8fCBpID09IF9sYXN0KSk/IHRoaXMuY29ybmVyU2l6ZSA6IHRoaXMuY29ybmVyQXJlYVNpemUsXG4gICAgICAgIHNpemUgOiB0aGlzLmNvcm5lclNpemUsXG4gICAgICAgIHN0eWxlOiB0aGlzLmNvcm5lclN0eWxlXG4gICAgICB9O1xuXG4gICAgICBpZih0aGlzLmJlemllckNvbnRyb2xzKSB7XG4gICAgICAgIGlmIChwdHNbaV0uYzIpIHtcblxuICAgICAgICAgIGNvbnRyb2xzWyBcImRcIiArICgraSArIDEpXSA9e1xuICAgICAgICAgICAgYWN0aW9uOiBcInNoYXBlXCIsXG4gICAgICAgICAgICB2aXNpYmxlOiB0cnVlLFxuICAgICAgICAgICAgeDogcHRzW2ldLmMyLngsXG4gICAgICAgICAgICB5OiBwdHNbaV0uYzIueSxcbiAgICAgICAgICAgIHNpemU6IHRoaXMuY3VydmVDb3JuZXJTaXplICsgMixcbiAgICAgICAgICAgIGFyZWE6IHRoaXMuY29ybmVyQXJlYVNpemUsXG4gICAgICAgICAgICBzdHlsZTogXCJyZWN0XCJcbiAgICAgICAgICB9XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChwdHNbaV0uYykge1xuICAgICAgICAgIGNvbnRyb2xzW1wiY1wiICsgKCtpICsgMSldID0ge1xuICAgICAgICAgICAgYWN0aW9uOiBcInNoYXBlXCIsXG4gICAgICAgICAgICB2aXNpYmxlOiB0cnVlLFxuICAgICAgICAgICAgeDogcHRzW2ldLmMueCxcbiAgICAgICAgICAgIHk6IHB0c1tpXS5jLnksXG4gICAgICAgICAgICBzaXplOiB0aGlzLmN1cnZlQ29ybmVyU2l6ZSArIDIsXG4gICAgICAgICAgICBhcmVhOiB0aGlzLmNvcm5lckFyZWFTaXplLFxuICAgICAgICAgICAgc3R5bGU6IFwicmVjdFwiXG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHZhciBwMiA9IHB0c1sraSArIDFdIHx8IHRoaXMuY2xvc2VkICYmIHB0c1swXTtcbiAgICAgICAgICBpZihwMil7XG4gICAgICAgICAgICBjb250cm9sc1tcImNcIiArICgraSArIDEpXSA9IHtcbiAgICAgICAgICAgICAgYWN0aW9uOiBcInNoYXBlXCIsXG4gICAgICAgICAgICAgIHZpc2libGU6IHRydWUsXG4gICAgICAgICAgICAgIHg6IChwdHNbaV0ueCArIHAyLngpIC8gMixcbiAgICAgICAgICAgICAgeTogKHB0c1tpXS55ICsgcDIueSkgLyAyLFxuICAgICAgICAgICAgICBhcmVhOiB0aGlzLmNvcm5lckFyZWFTaXplLFxuICAgICAgICAgICAgICBzaXplOiB0aGlzLmN1cnZlQ29ybmVyU2l6ZSxcbiAgICAgICAgICAgICAgc3R5bGU6IFwiY2lyY2xlXCJcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIGRyYXdCZXppZXJTaGFwZUNvbnRyb2xzOiBmdW5jdGlvbihjdHgpe1xuICAgIGZvcih2YXIgaSA9IDAgOyBpIDwgdGhpcy5wb2ludHMubGVuZ3RoIDsgaSsrKXtcbiAgICAgIGlmKHRoaXMucG9pbnRzW2ldLmMyKXtcbiAgICAgICAgdGhpcy5kcmF3QmV6aWVyQ29udHJvbHMoY3R4LCB0aGlzLnBvaW50c1tpXSx0aGlzLnBvaW50c1tpXS5jLHRoaXMucG9pbnRzW2ldLmMyLHRoaXMucG9pbnRzW2kgKyAxXSk7XG4gICAgICB9XG4gICAgfVxuICB9LFxuICBiZXppZXJDb250cm9sczogZmFsc2UsXG4gIF9tYWtlQ3VydmVCeUluZGV4OiBmdW5jdGlvbiAoaW5kZXgpIHtcbiAgICB0aGlzLl9tYWtlQ3VydmUodGhpcy5wb2ludHNbaW5kZXhdLHRoaXMucG9pbnRzW2luZGV4XS5jLHRoaXMucG9pbnRzW2luZGV4ICsgMV0gfHwgdGhpcy5wb2ludHNbMF0pXG4gIH0sXG4gIF9tYWtlQ3ViaWM6IGZ1bmN0aW9uIChwMSwgYzEsYzIscDIpIHtcbiAgICBwMS5jdXJ2ZSA9IG5ldyBCZXppZXIocDEueCxwMS55ICwgYzEueCAsYzEueSAsIGMyLngsYzIueSAsIHAyLngscDIueSk7XG4gICAgaWYodGhpcy5vdXRsaW5lVG9wIHx8IHRoaXMub3V0bGluZUJvdHRvbSl7XG4gICAgICBwMS5vdXRsaW5lID0gcDEuY3VydmUub3V0bGluZSh0aGlzLm91dGxpbmVCb3R0b20sIHRoaXMub3V0bGluZVRvcCk7XG4gICAgfVxuICB9LFxuICBfbWFrZUN1cnZlOiBmdW5jdGlvbiAoX2N1clBvaW50LCBjMSxfcDIpIHtcbiAgICBfY3VyUG9pbnQuYyA9IHt4OiBjMS54LHkgOiBjMS55fTtcbiAgICBfY3VyUG9pbnQuY3VydmUgPSBCZXppZXIucXVhZHJhdGljRnJvbVBvaW50cy5hcHBseSh0aGlzLFtfY3VyUG9pbnQsYzEsX3AyXSk7XG4gICAgaWYodGhpcy5vdXRsaW5lVG9wIHx8IHRoaXMub3V0bGluZUJvdHRvbSl7XG4gICAgICBfY3VyUG9pbnQub3V0bGluZSA9IF9jdXJQb2ludC5jdXJ2ZS5vdXRsaW5lKHRoaXMub3V0bGluZVRvcCwgdGhpcy5vdXRsaW5lQm90dG9tKTtcbiAgICB9XG4gIH0sXG4gIF91cGRhdGVfY3VydmU6IGZ1bmN0aW9uIChfcG9pbnRJbmRleCkge1xuICAgIHZhciBfcDEgPSB0aGlzLnBvaW50c1tfcG9pbnRJbmRleCBdO1xuICAgIGlmKCFfcDEuYyl7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHZhciBfcDIgPSB0aGlzLnBvaW50c1tfcG9pbnRJbmRleCArIDFdIHx8IHRoaXMucG9pbnRzWzBdO1xuXG4gICAgaWYoX3AxLmMyKXtcbiAgICAgIF9wMS5jdXJ2ZS5wb2ludHNbMF0ueCA9IF9wMS54O1xuICAgICAgX3AxLmN1cnZlLnBvaW50c1swXS55ID0gX3AxLnk7XG4gICAgICBfcDEuY3VydmUucG9pbnRzWzFdLnggPSBfcDEuYy54O1xuICAgICAgX3AxLmN1cnZlLnBvaW50c1sxXS55ID0gX3AxLmMueTtcbiAgICAgIF9wMS5jdXJ2ZS5wb2ludHNbMl0ueCA9IF9wMS5jMi54O1xuICAgICAgX3AxLmN1cnZlLnBvaW50c1syXS55ID0gX3AxLmMyLnk7XG4gICAgICBfcDEuY3VydmUucG9pbnRzWzNdLnggPSBfcDIueDtcbiAgICAgIF9wMS5jdXJ2ZS5wb2ludHNbM10ueSA9IF9wMi55O1xuICAgICAgX3AxLmN1cnZlLnVwZGF0ZSgpO1xuICAgICAgX3AxLm91dGxpbmUgPSBfcDEuY3VydmUub3V0bGluZSh0aGlzLm91dGxpbmVCb3R0b20sIHRoaXMub3V0bGluZVRvcCk7XG4gICAgfWVsc2V7XG4gICAgICB2YXIgYmV6aWVyX3BvaW50ZXJzID0gQmV6aWVyLmdldEFCQygyLCBfcDEsIF9wMS5jLCBfcDIgLCAwLjUpO1xuICAgICAgX3AxLmN1cnZlLnBvaW50c1swXS54ID0gX3AxLng7XG4gICAgICBfcDEuY3VydmUucG9pbnRzWzBdLnkgPSBfcDEueTtcbiAgICAgIF9wMS5jdXJ2ZS5wb2ludHNbMV0ueCA9IGJlemllcl9wb2ludGVycy5BLng7XG4gICAgICBfcDEuY3VydmUucG9pbnRzWzFdLnkgPSBiZXppZXJfcG9pbnRlcnMuQS55O1xuICAgICAgX3AxLmN1cnZlLnBvaW50c1syXS54ID0gX3AyLng7XG4gICAgICBfcDEuY3VydmUucG9pbnRzWzJdLnkgPSBfcDIueTtcbiAgICAgIF9wMS5jdXJ2ZS51cGRhdGUoKTtcbiAgICAgIGlmKHRoaXMub3V0bGluZVRvcCB8fCB0aGlzLm91dGxpbmVCb3R0b20pIHtcbiAgICAgICAgX3AxLm91dGxpbmUgPSBfcDEuY3VydmUub3V0bGluZSh0aGlzLm91dGxpbmVCb3R0b20sIHRoaXMub3V0bGluZVRvcCk7XG4gICAgICB9XG4gICAgfVxuICB9LFxuICBzZXRQb2ludDogZnVuY3Rpb24gKG9yZGVyLCBfcG9pbnQpIHtcblxuICAgIHZhciBkcmFnUG9pbnRlcixcbiAgICAgIF9jdXJ2ZXBvaW50ZXIgPSBvcmRlclswXSA9PSBcImNcIixcbiAgICAgIHBJbmRleDEgPSArb3JkZXIuc3Vic3RyKDEpIC0gMSxcbiAgICAgIHAxID0gdGhpcy5wb2ludHNbcEluZGV4MV0sXG4gICAgICBwSW5kZXgyID0gdGhpcy5wb2ludHNbcEluZGV4MSArIDFdID8gcEluZGV4MSArIDEgOiAodGhpcy5jbG9zZWQgPyAwIDogLTEpLFxuICAgICAgcDIgPSBwSW5kZXgyICE9PSAtMSAmJiB0aGlzLnBvaW50c1twSW5kZXgyXSxcbiAgICAgIHBJbmRleDAgPSB0aGlzLnBvaW50c1twSW5kZXgxIC0gMV0gPyBwSW5kZXgxIC0gMSA6ICh0aGlzLmNsb3NlZCA/IHRoaXMucG9pbnRzLmxlbmd0aCAtIDEgOiAtMSksXG4gICAgICBwMCA9IHBJbmRleDAgIT09IC0xICYmIHRoaXMucG9pbnRzW3BJbmRleDBdO1xuXG4gICAgaWYgKHRoaXMucG9pbnRzTGltaXRzKSB7XG4gICAgICBfcG9pbnQueCA9IE1hdGgubWF4KDAsIE1hdGgubWluKF9wb2ludC54LCB0aGlzLndpZHRoKSk7XG4gICAgICBfcG9pbnQueSA9IE1hdGgubWF4KDAsIE1hdGgubWluKF9wb2ludC55LCB0aGlzLmhlaWdodCkpO1xuICAgIH1cbiAgICB2YXIgX2N1cnZlcG9pbnRlcjIgPSBvcmRlclswXSA9PSBcImRcIjtcbiAgICBpZihfY3VydmVwb2ludGVyMil7XG4gICAgICBkcmFnUG9pbnRlciA9ICBwMS5jMjtcbiAgICB9ZWxzZXtcbiAgICAgIGlmKF9jdXJ2ZXBvaW50ZXIpe1xuXG4gICAgICAgIGlmKCFwMS5jKXtcbiAgICAgICAgICB0aGlzLl9tYWtlQ3VydmUocDEsIF9wb2ludCwgcDIpO1xuICAgICAgICB9XG4gICAgICAgIGRyYWdQb2ludGVyID0gcDEuY1xuICAgICAgfWVsc2V7XG4gICAgICAgIGRyYWdQb2ludGVyID0gcDE7XG4gICAgICB9XG4gICAgfVxuICAgIGlmKGRyYWdQb2ludGVyKXtcbiAgICAgIGRyYWdQb2ludGVyLnggPSBfcG9pbnQueDtcbiAgICAgIGRyYWdQb2ludGVyLnkgPSBfcG9pbnQueTtcbiAgICB9XG4gICAgZm9yKHZhciBpIGluIHRoaXMucG9pbnRzKXtcbiAgICAgIHRoaXMucG9pbnRzW2ldLmMgJiYgdGhpcy5fdXBkYXRlX2N1cnZlKCtpKTtcbiAgICB9XG4gICAgdGhpcy51cGRhdGVCYm94KCk7XG4gICAgdGhpcy5maXJlKFwic2hhcGU6bW9kaWZpZWRcIik7XG4gICAgdGhpcy5jYW52YXMgJiYgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gIH1cbn07XG5cbmZhYnJpYy51dGlsLm9iamVjdC5kZWZhdWx0cyhmYWJyaWMuQmV6aWVyTWl4aW4sICBmYWJyaWMuU2hhcGVNaXhpbik7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL21peGlucy9iZXppZXJNaXhpbi5qcyIsIid1c2Ugc3RyaWN0JztcblxuXG4gIGZhYnJpYy5TaGFwZU1peGluID0ge1xuICAgIHN0b3JlUHJvcGVydGllczogZmFicmljLk9iamVjdC5wcm90b3R5cGUuc3RvcmVQcm9wZXJ0aWVzLmNvbmNhdChbXCJwb2ludHNcIl0pLFxuICAgIHN0YXRlUHJvcGVydGllczogZmFicmljLk9iamVjdC5wcm90b3R5cGUuc3RhdGVQcm9wZXJ0aWVzLmNvbmNhdChbXCJwb2ludHNcIl0pLFxuICAgIGdldFBvaW50czogZnVuY3Rpb24oKXtcbiAgICAgIHJldHVybiBmYWJyaWMudXRpbC5vYmplY3QuZmlsdGVyVmFsdWVzKHRoaXMucG9pbnRzLFtcInhcIixcInlcIixcImNcIixcImMyXCJdKTtcbiAgICB9LFxuICAgIGFkZFBvaW50OiBmdW5jdGlvbiAoX3BvaW50KSB7XG4gICAgICB0aGlzLnBvaW50cy5wdXNoKHtcbiAgICAgICAgeCA6IF9wb2ludC54LFxuICAgICAgICB5IDogX3BvaW50LnlcbiAgICAgIH0pO1xuICAgICAgaWYodGhpcy5jbG9zZU9uRnVsbCAmJiB0aGlzLnBvaW50cy5sZW5ndGggPT0gdGhpcy5tYXhpbXVtUG9pbnRzICl7XG4gICAgICAgIHRoaXMuY2xvc2VkID0gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIHRoaXMudXBkYXRlQmJveCgpO1xuICAgIH0sXG4gICAgZ2V0TGVuZ3RoOiBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgX2wgPSAwO1xuICAgICAgZm9yKHZhciBpID0gMCA7IGkgPCB0aGlzLnBvaW50cy5sZW5ndGggLSAxOyBpKyspe1xuICAgICAgICBpZih0aGlzLnBvaW50c1tpXS5jdXJ2ZSl7XG4gICAgICAgICAgX2wgKz0gdGhpcy5wb2ludHNbaV0uY3VydmUubGVuZ3RoKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBfbDtcbiAgICB9LFxuICAgIHVwZGF0ZUJib3g6IGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmICh0aGlzLnBvaW50cy5sZW5ndGggPT0gMCkge1xuICAgICAgICB0aGlzLmxlZnQgPSAwO1xuICAgICAgICB0aGlzLnRvcCA9IDA7XG4gICAgICAgIHRoaXMud2lkdGggPSAxO1xuICAgICAgICB0aGlzLmhlaWdodCA9IDE7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHZhciBtaW5YID0gSW5maW5pdHksIG1heFggPSAtSW5maW5pdHksIG1pblkgPSBJbmZpbml0eSwgbWF4WSA9IC1JbmZpbml0eSwgaTtcbiAgICAgIGZvciAoaSBpbiB0aGlzLnBvaW50cykge1xuICAgICAgICB2YXIgX3AgPSB0aGlzLnBvaW50c1tpXTtcbiAgICAgICAgaWYgKF9wLm91dGxpbmUpIHtcbiAgICAgICAgICB2YXIgYmJveCA9IF9wLm91dGxpbmUuYmJveCgpO1xuICAgICAgICAgIG1pblggPSBNYXRoLm1pbihtaW5YLCBiYm94LngubWluKTtcbiAgICAgICAgICBtYXhYID0gTWF0aC5tYXgobWF4WCwgYmJveC54Lm1heCk7XG4gICAgICAgICAgbWluWSA9IE1hdGgubWluKG1pblksIGJib3gueS5taW4pO1xuICAgICAgICAgIG1heFkgPSBNYXRoLm1heChtYXhZLCBiYm94LnkubWF4KTtcbiAgICAgICAgfWVsc2UgaWYgKF9wLmN1cnZlKSB7XG4gICAgICAgICAgdmFyIGJib3ggPSBfcC5jdXJ2ZS5iYm94KCk7XG4gICAgICAgICAgbWluWCA9IE1hdGgubWluKG1pblgsIGJib3gueC5taW4pO1xuICAgICAgICAgIG1heFggPSBNYXRoLm1heChtYXhYLCBiYm94LngubWF4KTtcbiAgICAgICAgICBtaW5ZID0gTWF0aC5taW4obWluWSwgYmJveC55Lm1pbik7XG4gICAgICAgICAgbWF4WSA9IE1hdGgubWF4KG1heFksIGJib3gueS5tYXgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG1pblggPSBNYXRoLm1pbihtaW5YLCBfcC54KTtcbiAgICAgICAgICBtYXhYID0gTWF0aC5tYXgobWF4WCwgX3AueCk7XG4gICAgICAgICAgbWluWSA9IE1hdGgubWluKG1pblksIF9wLnkpO1xuICAgICAgICAgIG1heFkgPSBNYXRoLm1heChtYXhZLCBfcC55KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdGhpcy5fX3RyYW5zbGF0ZWQgPSB7XG4gICAgICAgIHg6IG1pblgsXG4gICAgICAgIHk6IG1pblksXG4gICAgICB9O1xuICAgICAgdGhpcy5sZWZ0ICs9IG1pblg7XG4gICAgICB0aGlzLnRvcCArPSBtaW5ZO1xuICAgICAgdGhpcy53aWR0aCA9IG1heFggLSBtaW5YICsgMTtcbiAgICAgIHRoaXMuaGVpZ2h0ID0gbWF4WSAtIG1pblkgKyAxO1xuXG4gICAgICBmb3IgKGkgaW4gdGhpcy5wb2ludHMpIHtcbiAgICAgICAgdmFyIF9wb2ludCA9IHRoaXMucG9pbnRzW2ldO1xuICAgICAgICBfcG9pbnQueCAtPSBtaW5YO1xuICAgICAgICBfcG9pbnQueSAtPSBtaW5ZO1xuICAgICAgICBpZihfcG9pbnQuYyl7XG4gICAgICAgICAgX3BvaW50LmMueCAtPSBtaW5YO1xuICAgICAgICAgIF9wb2ludC5jLnkgLT0gbWluWTtcbiAgICAgICAgfVxuICAgICAgICBpZihfcG9pbnQuYzIpe1xuICAgICAgICAgIF9wb2ludC5jMi54IC09IG1pblg7XG4gICAgICAgICAgX3BvaW50LmMyLnkgLT0gbWluWTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdGhpcy5jYW52YXMgJiYgdGhpcy5zZXRDb29yZHMoKTtcblxuICAgICAgLy/QvdGD0LbQvdC+INC+0L/RgtC40LzQuNC30LjRgNC+0LLQsNGC0Ywo0L/QtdGA0LXQuNGB0L7QstGL0LLQsNGC0Ywg0YLQvtC70YzQutC+IDEg0LjQu9C4IDIg0LrRgNC40LLRi9GFINC30LAg0YDQsNC3XG4gICAgICAvL3RvZG8g0L3Rg9C20L3QviDQv9C10YDQtdGA0LjRgdC+0LLRi9Cy0LDRgtGMINC/0YDQuCDQuNC30LzQtdC90LXQvdC40Lgg0YDQsNC30LzQtdGA0LBcbiAgICAgIGlmKHRoaXMuX190cmFuc2xhdGVkLnggfHwgdGhpcy5fX3RyYW5zbGF0ZWQueSl7XG4gICAgICAgIGZvcihpIGluIHRoaXMucG9pbnRzKXtcbiAgICAgICAgICB0aGlzLnBvaW50c1tpXS5jICYmIHRoaXMuX3VwZGF0ZV9jdXJ2ZSgraSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuICAgIF9wZXJmb3JtU2hhcGVBY3Rpb246IGZ1bmN0aW9uIChlLCB0cmFuc2Zvcm0sIHBvaW50ZXIpIHtcbiAgICAgIHRyYW5zZm9ybS5jb3JuZXIuc3Vic3RyKDEpXG4gICAgICB0aGlzLnNldFBvaW50KHRyYW5zZm9ybS5jb3JuZXIsIHRyYW5zZm9ybS5wb2ludCk7XG4gICAgICB0cmFuc2Zvcm0uYWN0aW9uUGVyZm9ybWVkID0gdHJ1ZTtcbiAgICAgIHRoaXMuZmlyZSgnc2hhcGluZycsIGUpO1xuICAgIH0sXG4gICAgX2luaXRQb2ludHM6IGZ1bmN0aW9uIChwb2ludHMpIHtcblxuICAgICAgaWYgKHBvaW50cykge1xuICAgICAgICB0aGlzLnNldCgncG9pbnRzJywgcG9pbnRzKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5fY29udHJvbHNWaXNpYmlsaXR5ID0ge307XG5cbiAgICAgIHZhciBfcG9pbnRzID0gdGhpcy5wb2ludHMgfHwgdGhpcy5fcG9pbnRzO1xuXG4gICAgICBpZiAoX3BvaW50cykge1xuICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8PSBfcG9pbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgdGhpcy5fY29udHJvbHNWaXNpYmlsaXR5W1wicFwiICsgaV0gPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2NvbnRyb2xzVmlzaWJpbGl0eVtcInBcIl0gPSB0cnVlO1xuICAgICAgfVxuXG5cbiAgICAgIHZhciBfZGVmYXVsdF9jb3JuZXJzID0ge1xuICAgICAgICB0bDogdHJ1ZSxcbiAgICAgICAgdHI6IHRydWUsXG4gICAgICAgIGJyOiB0cnVlLFxuICAgICAgICBibDogdHJ1ZSxcbiAgICAgICAgbWw6IHRydWUsXG4gICAgICAgIG10OiB0cnVlLFxuICAgICAgICBtcjogdHJ1ZSxcbiAgICAgICAgbWI6IHRydWUsXG4gICAgICAgIG10cjogdHJ1ZVxuICAgICAgfTtcbiAgICAgIGZvciAodmFyIGkgaW4gX2RlZmF1bHRfY29ybmVycykge1xuICAgICAgICB0aGlzLl9jb250cm9sc1Zpc2liaWxpdHlbaV0gPSBfZGVmYXVsdF9jb3JuZXJzW2ldO1xuICAgICAgfVxuICAgIH0sXG4gICAgX2RlZmF1bHRfY29ybmVyX2FjdGlvbjogXCJzaGFwZVwiLFxuICAgIF9jb3JuZXJfYWN0aW9uczoge30sXG5cblxuICAgIGRyYXdCb3VuZHNDb250cm9sczpmYWJyaWMuT2JqZWN0LnByb3RvdHlwZS5kcmF3Q29udHJvbHMsXG4gICAgYWRkUG9pbnRzQ29udHJvbHM6IGZ1bmN0aW9uKCl7XG4gICAgICB2YXIgY29udHJvbHMgPSB7fTtcblxuICAgICAgdmFyIHB0cyA9IHRoaXMucG9pbnRzIDtcbiAgICAgIGZvcih2YXIgaSBpbiBwdHMpIHtcbiAgICAgICAgY29udHJvbHNbXCJwXCIgKyAoK2kgKV0gPSB7XG4gICAgICAgICAgeDogcHRzW2ldLngsXG4gICAgICAgICAgeTogcHRzW2ldLnksXG4gICAgICAgICAgc2l6ZTogdGhpcy5jb3JuZXJTaXplLFxuICAgICAgICAgIHN0eWxlOiBcImNpcmNsZVwiXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICByZXR1cm4gY29udHJvbHM7XG4gICAgfSxcbiAgICBkcmF3U2hhcGVCb3JkZXI6IGZ1bmN0aW9uIChjdHgpIHtcbiAgICAgIHZhciBfcG9pbnRzID0gdGhpcy5wb2ludHMgfHwgdGhpcy5fcG9pbnRzO1xuXG4gICAgICB2YXIgeCwgeTtcbiAgICAgIHggPSAtdGhpcy53aWR0aCAvIDI7XG4gICAgICB5ID0gLXRoaXMuaGVpZ2h0IC8gMjtcbiAgICAgIHZhciB6b29tID0gdGhpcy5jYW52YXMudmlld3BvcnRUcmFuc2Zvcm1bMF07XG4gICAgICBjdHguc2F2ZSgpO1xuICAgICAgY3R4LnNjYWxlKHRoaXMuc2NhbGVYICogem9vbSwgdGhpcy5zY2FsZVkgKiB6b29tKTtcbiAgICAgIGN0eC50cmFuc2xhdGUoeCwgeSk7XG5cblxuICAgICAgY3R4LmJlZ2luUGF0aCgpO1xuXG4gICAgICB2YXIgX3AgPSBfcG9pbnRzWzBdOy8vIGZhYnJpYy51dGlsLnRyYW5zZm9ybVBvaW50KF9wb2ludHNbMF0sIHRyYW5zZm9ybU1hdHJpeCk7XG5cbiAgICAgIGN0eC5tb3ZlVG8oX3AueCwgX3AueSk7XG5cbiAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgX3BvaW50cy5sZW5ndGg7IGkrKykge1xuXG4gICAgICAgIHZhciBfcCA9IF9wb2ludHNbaV07Ly9mYWJyaWMudXRpbC50cmFuc2Zvcm1Qb2ludChfcG9pbnRzW2ldLCB0cmFuc2Zvcm1NYXRyaXgpO1xuICAgICAgICBjdHgubGluZVRvKF9wLngsIF9wLnkpO1xuICAgICAgfVxuICAgICAgY3R4LmNsb3NlUGF0aCgpO1xuICAgICAgY3R4LnN0cm9rZSgpO1xuICAgICAgY3R4LnJlc3RvcmUoKTtcbiAgICB9XG4gICAgLy8gc2V0Q29vcmRzOiBmdW5jdGlvbiAoKSB7XG4gICAgLy8gICB0aGlzLnNldEJvdW5kQ29vcmRzKCk7XG4gICAgLy8gICB0aGlzLnNldEV4dHJhQ29vcmRzKCk7XG4gICAgLy8gfVxuICB9O1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9taXhpbnMvc2hhcGVNaXhpbi5qcyIsIlxuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5Qb2x5bGluZS5wcm90b3R5cGUse1xuICBjb250cm9sc0J1dHRvbnNFbmFibGVkOiBmYWxzZSxcbiAgX2NyZWF0ZV9idXR0b25zX2NvbnRyb2xzOiBmdW5jdGlvbihjb250cm9scyl7XG5cbiAgICBpZighdGhpcy5jb250cm9sc0J1dHRvbnNFbmFibGVkKXJldHVybjtcblxuICAgIHZhciBwdHMgPSB0aGlzLnBvaW50cyxcbiAgICAgIF9sYXN0ID0gcHRzLmxlbmd0aCAtIDE7XG4gICAgaWYodGhpcy5fX21hZ25ldF9wb2ludCAmJiB0aGlzLl9fbWFnbmV0X3BvaW50LmlkWzBdICE9IFwieFwiKXtcbiAgICAgIHZhciBfaWQgPSB0aGlzLl9fbWFnbmV0X3BvaW50LmlkO1xuICAgICAgdmFyIF9lbmRlcl9hcmVhID0gKF9pZCA9PSBcImUxXCIgfHwgX2lkID09IFwiZTJcIik7XG4gICAgICB2YXIgX2VuZGVyX3BvaW50cyA9IF9lbmRlcl9hcmVhIHx8IChfaWQgPT0gXCJwMVwiIHx8IF9pZCA9PSBcInBcIiArIHB0cy5sZW5ndGgpO1xuICAgICAgdmFyIF9vZmZzZXQgPSBfZW5kZXJfcG9pbnRzID8gMTUgOiAxMDtcbiAgICAgIHRoaXMuX3hidXR0b25zX3BvaW50ID0gX2VuZGVyX2FyZWEgPyAoX2lkWzFdID09IFwiMVwiID8gMCA6IF9sYXN0KSA6IF9pZC5zdWJzdHIoMSkgLSAxO1xuICAgICAgdGhpcy5feGJ1dHRvbnNfY3VydmUgPSBfaWRbMF0gPT0gXCJjXCI7XG4gICAgICBpZih0aGlzLl94YnV0dG9uc19jdXJ2ZSl7XG4gICAgICAgIGNvbnRyb2xzLnB1c2goe1xuICAgICAgICAgIHg6IHRoaXMuX19tYWduZXRfcG9pbnQueCArIF9vZmZzZXQsXG4gICAgICAgICAgeTogdGhpcy5fX21hZ25ldF9wb2ludC55IC0gX29mZnNldCxcbiAgICAgICAgICBzaXplIDogMTYsXG4gICAgICAgICAgaW50cmFuc2Zvcm1hYmxlOiB0cnVlLFxuICAgICAgICAgIHN0eWxlRnVuY3Rpb246IHRoaXMuX2RyYXdJbnNlcnROb2RlQnV0dG9uLFxuICAgICAgICAgIGlkOiBcIngxXCJcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBjb250cm9scy5wdXNoKHtcbiAgICAgICAgeDogdGhpcy5fX21hZ25ldF9wb2ludC54ICsgX29mZnNldCxcbiAgICAgICAgeTogdGhpcy5fX21hZ25ldF9wb2ludC55ICsgX29mZnNldCxcbiAgICAgICAgc2l6ZSA6IDE2LFxuICAgICAgICBpbnRyYW5zZm9ybWFibGU6IHRydWUsXG4gICAgICAgIHN0eWxlRnVuY3Rpb246IHRoaXMuX2RyYXdSZW1vdmVOb2RlQnV0dG9uLFxuICAgICAgICBpZDogXCJ4MlwiXG4gICAgICB9KTtcbiAgICB9ZWxzZXtcbiAgICAgIGRlbGV0ZSB0aGlzLl94YnV0dG9uc19wb2ludDtcbiAgICAgIGRlbGV0ZSB0aGlzLl94YnV0dG9uc19jdXJ2ZTtcbiAgICB9XG4gIH0sXG4gIF9kcmF3SW5zZXJ0Tm9kZUJ1dHRvbjogZnVuY3Rpb24gKGNvbnRyb2wsIGN0eCwgbWV0aG9kTmFtZSwgbGVmdCwgdG9wLCBzaXplLCBzdHJva2UpIHtcbiAgICBjdHguc2F2ZSgpO1xuICAgIGN0eC5maWxsU3R5bGUgPSBcImdyZWVuXCI7XG4gICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgIHZhciBfc2l6ZSA9IHNpemUgLyA0O1xuICAgIGN0eC5hcmMobGVmdCArIHNpemUvMiAsIHRvcCArIHNpemUvMiAsIF9zaXplICogMiAsIDAsIDIgKiBNYXRoLlBJLCBmYWxzZSk7XG4gICAgY3R4LmZpbGwoKTtcbiAgICBjdHguc3Ryb2tlU3R5bGUgPSBcIndoaXRlXCI7XG4gICAgY3R4LnRyYW5zbGF0ZShNYXRoLmZsb29yKHNpemUvMiksTWF0aC5mbG9vcihzaXplLzIpKTtcbiAgICBjdHgudHJhbnNsYXRlKDAuNSwwLjUgKTtcbiAgICBjdHgubW92ZVRvKGxlZnQgLSBfc2l6ZSAsIHRvcCApO1xuICAgIGN0eC5saW5lVG8obGVmdCArIF9zaXplICwgdG9wICk7XG4gICAgY3R4LnN0cm9rZVN0eWxlID0gXCJ3aGl0ZVwiO1xuICAgIGN0eC5tb3ZlVG8obGVmdCAgLCB0b3AgKyBfc2l6ZSApO1xuICAgIGN0eC5saW5lVG8obGVmdCAgLCB0b3AgLSBfc2l6ZSApO1xuICAgIGN0eC5zdHJva2UoKTtcbiAgICBjdHgucmVzdG9yZSgpO1xuICB9LFxuICBfZHJhd1JlbW92ZU5vZGVCdXR0b246IGZ1bmN0aW9uIChjb250cm9sLCBjdHgsIG1ldGhvZE5hbWUsIGxlZnQsIHRvcCwgc2l6ZSwgc3Ryb2tlKSB7XG4gICAgY3R4LnNhdmUoKTtcbiAgICBjdHguZmlsbFN0eWxlID0gXCJyZWRcIjtcbiAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgdmFyIF9zaXplID0gc2l6ZSAvIDQ7XG4gICAgY3R4LmFyYyhsZWZ0ICsgc2l6ZS8yICwgdG9wICsgc2l6ZS8yICwgX3NpemUgKiAyICwgMCwgMiAqIE1hdGguUEksIGZhbHNlKTtcbiAgICBjdHguZmlsbCgpO1xuICAgIGN0eC5zdHJva2VTdHlsZSA9IFwid2hpdGVcIjtcbiAgICBjdHgudHJhbnNsYXRlKHNpemUvMixzaXplLzIpO1xuICAgIGN0eC5tb3ZlVG8obGVmdCAtIF9zaXplICwgdG9wIC0gX3NpemUpO1xuICAgIGN0eC5saW5lVG8obGVmdCArIF9zaXplICwgdG9wICsgX3NpemUpO1xuICAgIGN0eC5zdHJva2VTdHlsZSA9IFwid2hpdGVcIjtcbiAgICBjdHgubW92ZVRvKGxlZnQgLSBfc2l6ZSAsIHRvcCArIF9zaXplICk7XG4gICAgY3R4LmxpbmVUbyhsZWZ0ICsgX3NpemUgLCB0b3AgLSBfc2l6ZSApO1xuICAgIGN0eC5zdHJva2UoKTtcbiAgICBjdHgucmVzdG9yZSgpO1xuICB9LFxuICBfcGVyZm9ybUFkZEFjdGlvbjogZnVuY3Rpb24gKGUsIHRyYW5zZm9ybSwgcG9pbnRlcikge1xuICAgIHRoaXMuaXNNb3ZpbmcgPSBmYWxzZTtcbiAgICB2YXIgcDEgPSB0aGlzLnBvaW50c1t0aGlzLl94YnV0dG9uc19wb2ludF07XG4gICAgdmFyIHAyID0gdGhpcy5wb2ludHNbdGhpcy5feGJ1dHRvbnNfcG9pbnQgKyAxXTtcbiAgICBpZihwMS5jdXJ2ZSl7XG4gICAgICB2YXIgbmV3X3BvaW50MSA9IHAxLmN1cnZlLmdldCgwLjI1KTtcbiAgICAgIHZhciBuZXdfcG9pbnQyID0gcDEuY3VydmUuZ2V0KDAuNzUpO1xuXG4gICAgICB0aGlzLnBvaW50cy5zcGxpY2UodGhpcy5feGJ1dHRvbnNfcG9pbnQgKyAxLDAse1xuICAgICAgICB4OiBwMS5jLngsXG4gICAgICAgIHk6IHAxLmMueSxcbiAgICAgICAgYzogbmV3X3BvaW50MlxuICAgICAgfSlcbiAgICAgIHAxLmMgPSBuZXdfcG9pbnQxO1xuICAgICAgdGhpcy5fbWFrZUN1cnZlQnlJbmRleCh0aGlzLl94YnV0dG9uc19wb2ludCk7XG4gICAgICB0aGlzLl9tYWtlQ3VydmVCeUluZGV4KHRoaXMuX3hidXR0b25zX3BvaW50ICsgMSk7XG4gICAgfWVsc2V7XG4gICAgICB2YXIgbmV3X3BvaW50MSA9IHt4IDogKHAyLnggLSBwMS54KSAvIDQsIHk6IChwMi55IC0gcDEueSkgLyA0fTtcbiAgICAgIHZhciBuZXdfcG9pbnQyID0ge3ggOiAocDIueCAtIHAxLngpIC8gNCozLCB5OiAocDIueSAtIHAxLnkpIC8gNCozfTtcbiAgICB9XG4gICAgZGVsZXRlIHRoaXMuY2FudmFzLl9jdXJyZW50VHJhbnNmb3JtO1xuICAgIC8vIGRlbGV0ZSB0cmFuc2Zvcm0uYWN0aW9uO1xuICAgIC8vIGRlbGV0ZSB0cmFuc2Zvcm0uY29ybmVyO1xuICB9LFxuICBfcGVyZm9ybVJlbW92ZUFjdGlvbjogZnVuY3Rpb24gKGUsIHRyYW5zZm9ybSwgcG9pbnRlcikge1xuICAgIGlmKHRoaXMucG9pbnRzLmxlbmd0aCA9PSAyKXtcbiAgICAgIHJldHVybiB0aGlzLnJlbW92ZSgpO1xuICAgIH1cblxuICAgIHZhciBfY3VydmVwb2ludGVyID0gdGhpcy5feGJ1dHRvbnNfY3VydmUsXG4gICAgICBwSW5kZXgxID0gdGhpcy5feGJ1dHRvbnNfcG9pbnQ7XG5cbiAgICBpZih0aGlzLnBvaW50c1twSW5kZXgxIC0gMSBdICAmJiB0aGlzLnBvaW50c1twSW5kZXgxICsgMV0pe1xuICAgICAgdGhpcy5wb2ludHNbcEluZGV4MSAtIDEgXS5jID0gdGhpcy5wb2ludHNbcEluZGV4MV07XG4gICAgICB0aGlzLnBvaW50cy5zcGxpY2UocEluZGV4MSwxKTtcbiAgICAgIHRoaXMuX21ha2VDdXJ2ZUJ5SW5kZXgocEluZGV4MSAtIDEpO1xuICAgIH1lbHNle1xuICAgICAgdGhpcy5wb2ludHMuc3BsaWNlKHBJbmRleDEsMSk7XG4gICAgfVxuICAgIHRoaXMuaXNNb3ZpbmcgPSBmYWxzZTtcbiAgICB0aGlzLnNldFNpemUoKTtcbiAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICBkZWxldGUgdGhpcy5jYW52YXMuX2N1cnJlbnRUcmFuc2Zvcm07XG4gICAgLy8gZGVsZXRlIHRyYW5zZm9ybS5hY3Rpb247XG4gICAgLy8gZGVsZXRlIHRyYW5zZm9ybS5jb3JuZXI7XG4gIH1cbn0pO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9zaGFwZXMvcG9seWxpbmUuY29udHJvbHMuanMiLCIndXNlIHN0cmljdCc7XG5cblxucmVxdWlyZShcIi4uL21vZHVsZXMvcGF0aGZpbmRlclwiKTtcbi8vZmFicmljLnJlcXVpcmUoXCJTbGlkZUltYWdlXCIsW1wiU2xpZGVPYmplY3RcIi8qLFwiUGF0aGZpbmRlclwiKi9dLGZ1bmN0aW9uKCkge1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5JbWFnZS5wcm90b3R5cGUsIHtcbiAgY29udGVudE9mZnNldHM6IG51bGwsXG4gIC8qKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAcGFyYW0ge0NhbnZhc1JlbmRlcmluZ0NvbnRleHQyRH0gY3R4IENvbnRleHQgdG8gcmVuZGVyIG9uXG4gICAqIEBwYXJhbSB7Qm9vbGVhbn0gbm9UcmFuc2Zvcm1cbiAgICovXG4gIF9yZW5kZXI6IGZ1bmN0aW9uIChjdHgsIG5vVHJhbnNmb3JtKSB7XG4gICAgdmFyIHgsIHksIGltYWdlTWFyZ2lucyA9IHRoaXMuX2ZpbmRNYXJnaW5zKCksIGVsZW1lbnRUb0RyYXc7XG5cbiAgICB4ID0gKG5vVHJhbnNmb3JtID8gdGhpcy5sZWZ0IDogLXRoaXMud2lkdGggLyAyKTtcbiAgICB5ID0gKG5vVHJhbnNmb3JtID8gdGhpcy50b3AgOiAtdGhpcy5oZWlnaHQgLyAyKTtcblxuICAgIGlmICh0aGlzLm1lZXRPclNsaWNlID09PSAnc2xpY2UnKSB7XG4gICAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgICBjdHgucmVjdCh4LCB5LCB0aGlzLndpZHRoLCB0aGlzLmhlaWdodCk7XG4gICAgICBjdHguY2xpcCgpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmlzTW92aW5nID09PSBmYWxzZSAmJiB0aGlzLnJlc2l6ZUZpbHRlcnMubGVuZ3RoICYmIHRoaXMuX25lZWRzUmVzaXplKCkpIHtcbiAgICAgIHRoaXMuX2xhc3RTY2FsZVggPSB0aGlzLnNjYWxlWDtcbiAgICAgIHRoaXMuX2xhc3RTY2FsZVkgPSB0aGlzLnNjYWxlWTtcbiAgICAgIGVsZW1lbnRUb0RyYXcgPSB0aGlzLmFwcGx5RmlsdGVycyhudWxsLCB0aGlzLnJlc2l6ZUZpbHRlcnMsIHRoaXMuX2ZpbHRlcmVkRWwgfHwgdGhpcy5fb3JpZ2luYWxFbGVtZW50LCB0cnVlKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICBlbGVtZW50VG9EcmF3ID0gdGhpcy5fZWxlbWVudDtcbiAgICB9XG4gIC8vdG9kbyBmaWxsIGFsbCBiYWNrZ3JvdW5kXG4gICAgLy8gIHRoaXMuX3JlbmRlckZpbGwoY3R4KTtcbiAgICBlbGVtZW50VG9EcmF3ICYmIGN0eC5kcmF3SW1hZ2UoZWxlbWVudFRvRHJhdyxcbiAgICAgIHggKyBpbWFnZU1hcmdpbnMubWFyZ2luWCxcbiAgICAgIHkgKyBpbWFnZU1hcmdpbnMubWFyZ2luWSxcbiAgICAgIGltYWdlTWFyZ2lucy53aWR0aCxcbiAgICAgIGltYWdlTWFyZ2lucy5oZWlnaHRcbiAgICApO1xuXG4gICAgdGhpcy5fc3Ryb2tlKGN0eCk7XG4gICAgdGhpcy5fcmVuZGVyU3Ryb2tlKGN0eCk7XG4gIH0sXG4gIGltYWdlVG9vbHM6IGZhbHNlLFxuICBwaG90b3Nob3BUb29sczogZmFsc2UsXG4gIGNsb25lU3luYzogZnVuY3Rpb24gKCkge1xuICAgIHZhciBfb2JqZWN0ID0gdGhpcy50b09iamVjdCgpO1xuICAgIGRlbGV0ZSBfb2JqZWN0LmZpbHRlcnM7XG4gICAgdmFyIGNsb25lID0gbmV3IGZhYnJpYy5JbWFnZSh0aGlzLl9lbGVtZW50LCBfb2JqZWN0KTtcbiAgICBjbG9uZS5fZmlsdGVyZWRFbCA9IHRoaXMuX2ZpbHRlcmVkRWw7XG4gICAgY2xvbmUuZmlsdGVycyA9IHRoaXMuZmlsdGVycztcbiAgICByZXR1cm4gY2xvbmU7XG4gIH0sXG4gIHJldmVydENoYW5nZXM6IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgcGF0aGZpbmRlciA9IHRoaXMuY2FudmFzLmdldFBhdGhmaW5kZXIoKTtcbiAgICBpZiAocGF0aGZpbmRlci50YXJnZXQgJiYgcGF0aGZpbmRlci50YXJnZXQgPT0gdGhpcykge1xuICAgICAgcGF0aGZpbmRlci5oaWRlKCk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuX2VsZW1lbnQgPT0gdGhpcy5fb3JpZ2luYWxFbGVtZW50KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5maWx0ZXJzLmxlbmd0aCA9IDA7XG4gICAgaWYgKHRoaXMuX2ZpbHRlcmVkRWwpIHtcbiAgICAgIGRlbGV0ZSB0aGlzLl9maWx0ZXJlZEVsO1xuICAgIH1cbiAgICBkZWxldGUgdGhpcy5fZWRpdGVkO1xuICAgIHRoaXMuX2VsZW1lbnQgPSB0aGlzLl9vcmlnaW5hbEVsZW1lbnQ7XG5cbiAgICB0aGlzLmZpcmUoXCJjb250ZW50Om1vZGlmaWVkXCIsIHtcbiAgICAgIGJvdW5kczoge21pblg6IDAsIG1pblk6IDAsIG1heFg6IHRoaXMuX2VsZW1lbnQud2lkdGgsIG1heFk6IHRoaXMuX2VsZW1lbnQuaGVpZ2h0fVxuICAgIH0pO1xuXG5cbiAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgfSxcbiAgZXh0cmFjdENvbG9yczogZnVuY3Rpb24oKSB7XG4gICAgdmFyIF9jb2xvcnMgPSBmYWJyaWMuTWFnaWNXYW5kLmV4dHJhY3RDb2xvcnModGhpcy5fZWxlbWVudCk7XG4gICAgdmFyIGNvbG9ycyA9IHt9O1xuICAgIGZvcih2YXIgaSBpbiBfY29sb3JzKXtcbiAgICAgIHZhciBfc3RyID0gXCJyZ2IoXCIgKyBfY29sb3JzW2ldLmpvaW4oXCIsXCIpICsgXCIpXCI7XG4gICAgICBjb2xvcnNbX3N0cl0gPSB7fTtcbiAgICB9XG4gICAgcmV0dXJuIGNvbG9ycztcbiAgfSxcbiAgYWN0aW9uczogZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCggZmFicmljLkltYWdlLnByb3RvdHlwZS5hY3Rpb25zLCB7XG4gICAgcGhvdG9zaG9wVG9vbHM6IHtcbiAgICAgIHR5cGU6ICdlZmZlY3QnLFxuICAgICAgZWZmZWN0VHBsOiAnPGRpdiBpZD1cImVkaXRvci10b29sc1wiIGNsYXNzPVwiaW5saW5lLWFjdGlvbnMgY29tcGFjdFwiPjwvZGl2PicgK1xuICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cImNoZWNrYm9hcmRcIiA+PGRpdiBpZD1cInBhdGhmaW5kZXJcIj48L2Rpdj48L2Rpdj4nLFxuICAgICAgY2xhc3NOYW1lOiAnZmEgZmEtcGVuY2lsLXNxdWFyZS1vJyxcbiAgICAgIHRpdGxlOiBcImFkdmFuY2VkIHRvb2xzXCIsXG4gICAgICBhY3Rpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHBhdGhmaW5kZXIgPSB0aGlzLmNhbnZhcy5nZXRQYXRoZmluZGVyKCk7XG4gICAgICAgIHBhdGhmaW5kZXIudGFyZ2V0ID0gdGhpcztcbiAgICAgICAgcGF0aGZpbmRlci5zZXRQaWN0dXJlKHRoaXMuX2VsZW1lbnQpO1xuICAgICAgICBwYXRoZmluZGVyLnNob3coKTtcbiAgICAgIH0sXG4gICAgICBhY3Rpb25QYXJhbWV0ZXJzOiBmdW5jdGlvbiAoZWwsIGRhdGEpIHtcblxuICAgICAgICB2YXIgcGF0aGZpbmRlciA9IHRoaXMuY2FudmFzLmdldFBhdGhmaW5kZXIoKTtcbiAgICAgICAgcGF0aGZpbmRlci5jYW52YXMgPSB0aGlzLmNhbnZhcztcblxuICAgICAgICBuZXcgZmFicmljLlRvb2xiYXIocGF0aGZpbmRlciwgJ2VkaXRvci10b29scycpO1xuXG5cbiAgICAgICAgcGF0aGZpbmRlci5zZXRDb250YWluZXIoJ3BhdGhmaW5kZXInKTtcblxuICAgICAgICAvLyBpZiAocGF0aGZpbmRlci50YXJnZXQpcGF0aGZpbmRlci5oaWRlKCk7XG4gICAgICAgIHBhdGhmaW5kZXIudGFyZ2V0ID0gdGhpcztcbiAgICAgICAgcGF0aGZpbmRlci5zZXRQaWN0dXJlKHRoaXMuX2VsZW1lbnQpO1xuICAgICAgICBwYXRoZmluZGVyLnNob3coKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIHJldmVydENoYW5nZXM6IHtcbiAgICAgIGNsYXNzTmFtZTogJ2ZhIGZhLWhpc3RvcnknLFxuICAgICAgdGl0bGU6IFwicmV2ZXJ0IHRvIG9yaWduYWwgaW1hZ2VcIixcbiAgICAgIGFjdGlvbjogXCJyZXZlcnRDaGFuZ2VzXCIsXG4gICAgICBvYnNlcnZlOiBcImNvbnRlbnQ6bW9kaWZpZWRcIixcbiAgICAgIHZpc2libGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuICEhdGhpcy5fZmlsdGVyZWRFbCB8fCB0aGlzLl9lZGl0ZWQ7XG4gICAgICB9XG4gICAgfVxuICB9KVxufSk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL3NoYXBlcy9pbWFnZS5waG90b3Nob3AtdG9vbHMuanMiLCIndXNlIHN0cmljdCc7XG5cbmZhYnJpYy5NYWdpY1dhbmQgPSByZXF1aXJlKCcuLi9wbHVnaW5zL21hZ2ljd2FuZCcpO1xuXG52YXIgTWFnaWNXYW5kID0gZmFicmljLk1hZ2ljV2FuZCA7XG5cbi8qKlxuICogUGF0aGZpbmRlciAoUGF0aGZpbmRlcikgSW50ZXJmYWNlIGZvciBNYWdpY1dhbmQgc2VsZWN0aW9uIHRvb2xcbiAqIEBwYXJhbSBvcHRpb25zXG4gKiBAY29uc3RydWN0b3JcbiAqL1xuZnVuY3Rpb24gUGF0aGZpbmRlcihvcHRpb25zKSB7XG4gIHRoaXMuaW5pdGlhbGl6ZShvcHRpb25zKTtcbn1cblxuUGF0aGZpbmRlci5wcm90b3R5cGUgPSB7XG4gIHR5cGU6ICdwYXRoZmluZGVyJyxcbiAga2VlcE9sZFNlbGVjdGlvbjogdHJ1ZSxcbiAgYWxwaGFDaGFubmVsOiB0cnVlLFxuICBwYXRoZmluZGVyTW9kZTogJ25ldycsXG4gIHNlbGVjdGlvblRvb2w6ICdtYWdpYycsXG4gIGFkamFjZW50UGl4ZWxzOiB0cnVlLFxuICBhc3luYzogZmFsc2UsXG4gIHBhdGhmaW5kZXJUb29sczogZmFsc2UsXG4gIGJsdXJSYWRpdXM6IDAsXG4gIGhhdGNoTGVuZ3RoOiA0LFxuICBjb2xvclRocmVzaG9sZDogMTUsXG4gIHNpbXBsaWZ5VG9sZXJhbnQ6IDAsXG4gIHNpbXBsaWZ5Q291bnQ6IDMwLFxuICBoYXRjaE9mZnNldDogMCxcbiAgaW1hZ2VJbmZvOiBudWxsLFxuICBtYXNrOiBudWxsLFxuICBkb3duUG9pbnQ6IG51bGwsXG4gIGFsbG93RHJhdzogZmFsc2UsXG4gIHNoYXBlU2VsZWN0aW9uVG9vbHM6IGZhbHNlLFxuICBpbml0aWFsaXplOiBmdW5jdGlvbiAob3B0aW9ucykge1xuXG4gICAgb3B0aW9ucy5hcHBsaWNhdGlvbiAmJiBvcHRpb25zLmFwcGxpY2F0aW9uLmZpcmUoJ2VudGl0eTpjcmVhdGVkJyx7dGFyZ2V0IDogdGhpcyxvcHRpb25zIDogb3B0aW9uc30pXG5cbiAgICBmb3IgKHZhciBpIGluIG9wdGlvbnMpIHtcbiAgICAgIHRoaXNbaV0gPSBvcHRpb25zW2ldO1xuICAgIH1cbiAgfSxcbiAgYXN5bmNyb25vdXM6IGZ1bmN0aW9uIChjYikge1xuICAgIGlmICh0aGlzLmFzeW5jKSB7XG4gICAgICBzZXRUaW1lb3V0KGNiKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY2IoKTtcbiAgICB9XG4gIH0sXG4gIGZpbGxXaXRoQ3VycmVudENvbG9yOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5maWxsKHRoaXMuY29sb3IpO1xuICB9LFxuICBjbGVhck1lbW9yeTogZnVuY3Rpb24gKCkge1xuICAgIGRlbGV0ZSB0aGlzLnJlc3VsdENhbnZhcztcbiAgICBkZWxldGUgdGhpcy5lZGl0ZWRJbWFnZUNhbnZhcztcbiAgICBkZWxldGUgdGhpcy50ZXN0X3BpY3R1cmU7XG4gICAgZGVsZXRlIHRoaXMubWFzaztcbiAgfSxcbiAgaGlkZTogZnVuY3Rpb24gKCkge1xuICAgIGlmICh0aGlzLmVkaXRlZEltYWdlQ2FudmFzKSB7XG4gICAgICB0aGlzLmVkaXRlZEltYWdlQ2FudmFzLnJlbW92ZSgpO1xuICAgICAgdGhpcy5yZXN1bHRDYW52YXMucmVtb3ZlKCk7XG4gICAgICBjbGVhckludGVydmFsKHRoaXMuaW50ZXJ2YWwpO1xuICAgICAgdGhpcy5jbGVhck1lbW9yeSgpO1xuICAgICAgdGhpcy5maXJlKCdoaWRkZW4nKTtcbiAgICB9XG4gIH0sXG4gIHNldENvbnRhaW5lcjogZnVuY3Rpb24gKGNvbnRhaW5lcikge1xuICAgIGlmIChjb250YWluZXIuY29uc3RydWN0b3IgPT09IFN0cmluZykge1xuICAgICAgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY29udGFpbmVyKTtcbiAgICB9XG4gICAgdGhpcy5jb250YWluZXIgPSBjb250YWluZXI7XG5cbiAgICB0aGlzLnRlc3RfcGljdHVyZSA9IG5ldyBJbWFnZSgpO1xuICAgIHRoaXMudGVzdF9waWN0dXJlLm9ubG9hZCA9IHRoaXMuaW5pdENhbnZhcy5iaW5kKHRoaXMpO1xuICAgIHJldHVybiB0aGlzO1xuICB9LFxuICBnZXRTZWxlY3Rpb25Ub29sOiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMuc2VsZWN0aW9uVG9vbDtcbiAgfSxcbiAgc2V0U2VsZWN0aW9uVG9vbDogZnVuY3Rpb24gKHRvb2wpIHtcbiAgICB0aGlzLnNlbGVjdGlvblRvb2wgPSB0b29sO1xuICAgIHRoaXMuZG93blBvaW50ID0gZmFsc2UgO1xuICAgIHRoaXMuZmlyZSgndG9vbDpjaGFuZ2VkJywgdG9vbCk7XG4gIH0sXG4gIGdldFRocmVzaG9sZDogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLmNvbG9yVGhyZXNob2xkO1xuICB9LFxuICBzZXRUaHJlc2hvbGQ6IGZ1bmN0aW9uICh0aHJlcykge1xuICAgIGlmKHRocmVzICE9PSB1bmRlZmluZWQpe1xuICAgICAgdGhpcy5jb2xvclRocmVzaG9sZCA9IHRocmVzO1xuICAgIH1cbiAgICBpZiAodGhpcy5kb3duUG9pbnQpIHtcbiAgICAgIHRoaXMuZHJhd01hc2sodGhpcy5kb3duUG9pbnQueCwgdGhpcy5kb3duUG9pbnQueSwgdGhpcy5hZGphY2VudFBpeGVscyk7XG4gICAgfVxuICAgIHRoaXMuZmlyZSgndGhyZXNob2xkOmNoYW5nZWQnLCB7dGhyZXNob2xkOiB0aGlzLmNvbG9yVGhyZXNob2xkfSk7XG4gIH0sXG4gIHNldFBpY3R1cmU6IGZ1bmN0aW9uIChpbWcpIHtcbiAgICB0aGlzLnNldEltYWdlKGltZyk7XG4gICAgdmFyIGN2cyA9IGZhYnJpYy51dGlsLmNyZWF0ZUNhbnZhc0VsZW1lbnQoKTtcblxuICAgIGN2cy5vbm1vdXNldXAgPSB0aGlzLm9uTW91c2VVcC5iaW5kKHRoaXMpO1xuICAgIGN2cy5vbm1vdXNlZG93biA9IHRoaXMub25Nb3VzZURvd24uYmluZCh0aGlzKTtcbiAgICBjdnMub25tb3VzZW1vdmUgPSB0aGlzLm9uTW91c2VNb3ZlLmJpbmQodGhpcyk7XG4gICAgY3ZzLm9uY29udGV4dG1lbnUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfTtcbiAgICB0aGlzLmluaXRDYW52YXMoY3ZzKTtcbiAgfSxcbiAgbG9hZDogZnVuY3Rpb24gKGZpbGUpIHtcbiAgICBpZiAoIWZpbGUpcmV0dXJuO1xuXG4gICAgaWYgKGZpbGUuY29uc3RydWN0b3IgPT09IFN0cmluZykge1xuICAgICAgUGF0aGZpbmRlci50ZXN0X3BpY3R1cmUuc2V0QXR0cmlidXRlKCdzcmMnLGZpbGUpO1xuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcbiAgICAgIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICB0aGlzLnRlc3RfcGljdHVyZS5zZXRBdHRyaWJ1dGUoJ3NyYycsIGUudGFyZ2V0LnJlc3VsdCk7XG4gICAgICB9LmJpbmQodGhpcyk7XG4gICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlKTtcbiAgICB9XG4gIH0sXG4gIGluaXRDYW52YXM6IGZ1bmN0aW9uIChjdnMpIHtcbiAgICB2YXIgaW1nID0gdGhpcy5lZGl0ZWRJbWFnZUNhbnZhcztcbiAgICBpZih0aGlzLnJlc3VsdENhbnZhcyl7XG4gICAgICAkKHRoaXMucmVzdWx0Q2FudmFzKS5yZW1vdmUoKVxuICAgIH1cbiAgICB0aGlzLnJlc3VsdENhbnZhcyA9IGN2cztcbiAgICB0aGlzLmNyZWF0ZVNlbGVjdGlvbkRyYXdDYW52YXMoKTtcblxuXG4gICAgdGhpcy5jb250ZXh0ID0gY3ZzLmdldENvbnRleHQoJzJkJyk7XG4gICAgY3ZzLndpZHRoID0gaW1nLndpZHRoO1xuICAgIGN2cy5oZWlnaHQgPSBpbWcuaGVpZ2h0O1xuICAgIC8vdGhpcy5zZXRJbWFnZShpbWcpO1xuICB9LFxuICBzZXRJbWFnZTogZnVuY3Rpb24gKGltZykge1xuICAgIHRoaXMuX3Rlc3RfdG9kb19pbWcgPSBpbWc7XG4gICAgLy90aGlzLm1hc2sgPSBudWxsOy8vTWFnaWNXYW5kLmNyZWF0ZU1hc2soaW1nLndpZHRoLGltZy5oZWlnaHQpO1xuICAgIHRoaXMuZWRpdGVkSW1hZ2VDYW52YXMgPSBmYWJyaWMudXRpbC5jcmVhdGVDYW52YXNFbGVtZW50KCk7XG4gICAgdGhpcy5lZGl0ZWRJbWFnZUNhbnZhcy53aWR0aCA9IGltZy53aWR0aDtcbiAgICB0aGlzLmVkaXRlZEltYWdlQ2FudmFzLmhlaWdodCA9IGltZy5oZWlnaHQ7XG4gICAgdGhpcy5lZGl0ZWRJbWFnZUNhbnZhcy5nZXRDb250ZXh0KCcyZCcpLmRyYXdJbWFnZShpbWcsIDAsIDApO1xuICAgIHRoaXMuaW5pdENhbnZhcyhmYWJyaWMudXRpbC5jcmVhdGVDYW52YXNFbGVtZW50KCkpXG4gIH0sXG4gIGdldEluZm86IGZ1bmN0aW9uICgpIHtcblxuICAgIHZhciBjdHggPSB0aGlzLmVkaXRlZEltYWdlQ2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gICAgdmFyIGltYWdlSW5mbyA9IGN0eC5nZXRJbWFnZURhdGEoMCwgMCwgdGhpcy5lZGl0ZWRJbWFnZUNhbnZhcy53aWR0aCwgdGhpcy5lZGl0ZWRJbWFnZUNhbnZhcy5oZWlnaHQpO1xuICAgIGltYWdlSW5mby5ieXRlcyA9IDQ7XG4gICAgcmV0dXJuIGltYWdlSW5mbztcbiAgfSxcbiAgZ2V0TW91c2VQb3NpdGlvbjogZnVuY3Rpb24gKGUpIHtcbiAgICB2YXIgc2NhbGUgPSB0aGlzLnJlc3VsdENhbnZhcy53aWR0aCAvICQodGhpcy5yZXN1bHRDYW52YXMpLndpZHRoKCk7XG4gICAgdmFyIHRhcmdldCA9IGUudGFyZ2V0IHx8IGUuc3JjRWxlbWVudCxcbiAgICAgIHJlY3QgPSB0YXJnZXQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksXG4gICAgICBvZmZzZXRYID0gZS5jbGllbnRYIC0gcmVjdC5sZWZ0LFxuICAgICAgb2Zmc2V0WSA9IGUuY2xpZW50WSAtIHJlY3QudG9wO1xuICAgIHJldHVybiB7eDogTWF0aC5yb3VuZChvZmZzZXRYICogc2NhbGUpLCB5OiBNYXRoLnJvdW5kKG9mZnNldFkgKiBzY2FsZSl9O1xuICB9LFxuICByYWRpdXM6IDIwLFxuICByZXNldFNlbGVjdGlvbkRyYXdDYW52YXM6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLnNlbGVjdGlvbkRyYXdDb250ZXh0LmZpbGxTdHlsZSA9IFwiYmxhY2tcIjtcbiAgICAvL3RoaXMuc2VsZWN0aW9uRHJhd0NvbnRleHQoMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTtcbiAgICB0aGlzLnNlbGVjdGlvbkRyYXdDb250ZXh0LmZpbGxSZWN0KDAsMCx0aGlzLnNlbGVjdGlvbkRyYXdDYW52YXMud2lkdGgsdGhpcy5zZWxlY3Rpb25EcmF3Q2FudmFzLmhlaWdodCk7XG4gICAgdGhpcy5zZWxlY3Rpb25EcmF3Q29udGV4dC5maWxsU3R5bGUgPSBcIndoaXRlXCI7XG4gICAgdGhpcy5zZWxlY3Rpb25EcmF3Q29udGV4dC5zdHJva2VTdHlsZSA9IFwid2hpdGVcIjtcbiAgfSxcbiAgY3JlYXRlU2VsZWN0aW9uRHJhd0NhbnZhczogZnVuY3Rpb24gKCkge1xuXG4gICAgaWYodGhpcy5zZWxlY3Rpb25EcmF3Q2FudmFzICl7XG4gICAgICAkKHRoaXMuc2VsZWN0aW9uRHJhd0NhbnZhcyApLnJlbW92ZSgpO1xuICAgIH1cbiAgICB0aGlzLnNlbGVjdGlvbkRyYXdDYW52YXMgPSBmYWJyaWMudXRpbC5jcmVhdGVDYW52YXNFbGVtZW50KCk7XG4gICAgdGhpcy5zZWxlY3Rpb25EcmF3Q2FudmFzLndpZHRoICA9IHRoaXMucmVzdWx0Q2FudmFzLndpZHRoO1xuICAgIHRoaXMuc2VsZWN0aW9uRHJhd0NhbnZhcy5oZWlnaHQgPSB0aGlzLnJlc3VsdENhbnZhcy5oZWlnaHQ7XG4gICAgdGhpcy5zZWxlY3Rpb25EcmF3Q29udGV4dCA9IHRoaXMuc2VsZWN0aW9uRHJhd0NhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7XG4gICAgdGhpcy5yZXNldFNlbGVjdGlvbkRyYXdDYW52YXMoKTtcbiAgfSxcbiAgX29uTW91c2VEb3duOiBmdW5jdGlvbiAocG9pbnQpIHtcbiAgICBwb2ludC54ID0gTWF0aC5taW4oTWF0aC5tYXgoMCwgcGFyc2VJbnQocG9pbnQueCkpLCB0aGlzLnJlc3VsdENhbnZhcy53aWR0aCAtIDEpO1xuICAgIHBvaW50LnkgPSBNYXRoLm1pbihNYXRoLm1heCgwLCBwYXJzZUludChwb2ludC55KSksIHRoaXMucmVzdWx0Q2FudmFzLmhlaWdodCAtIDEpO1xuICAgIHRoaXMuYWxsb3dEcmF3ID0gdHJ1ZTtcbiAgICB0aGlzLmRyYXdpbmdUb29sc1t0aGlzLnNlbGVjdGlvblRvb2xdLm1vdXNlRG93bi5jYWxsKHRoaXMscG9pbnQpO1xuICB9LFxuICBvbk1vdXNlRG93bjogZnVuY3Rpb24gKGUpIHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICB0aGlzLl9vbk1vdXNlRG93bih0aGlzLmdldE1vdXNlUG9zaXRpb24oZSkpO1xuXG4gIH0sXG4gIF9vbk1vdXNlTW92ZTogZnVuY3Rpb24gKHApIHtcbiAgICBwLnggPSBNYXRoLm1pbihNYXRoLm1heCgwLCBwYXJzZUludChwLngpKSwgdGhpcy5yZXN1bHRDYW52YXMud2lkdGggLSAxKTtcbiAgICBwLnkgPSBNYXRoLm1pbihNYXRoLm1heCgwLCBwYXJzZUludChwLnkpKSwgdGhpcy5yZXN1bHRDYW52YXMuaGVpZ2h0IC0gMSk7XG4gICAgdGhpcy5kcmF3aW5nVG9vbHNbdGhpcy5zZWxlY3Rpb25Ub29sXS5tb3VzZU1vdmUuY2FsbCh0aGlzLHApO1xuICB9LFxuICBvbk1vdXNlTW92ZTogZnVuY3Rpb24gKGUpIHtcbiAgICB2YXIgcCA9IHRoaXMuZ2V0TW91c2VQb3NpdGlvbihlKTtcbiAgICB0aGlzLl9vbk1vdXNlTW92ZShwKTtcbiAgfSxcbiAgY29sb3I6IFsyNTUsIDAsIDAsIDI1NV0sXG4gIG9uTW91c2VVcDogZnVuY3Rpb24gKGUpIHtcbiAgICB0aGlzLmFsbG93RHJhdyA9IGZhbHNlO1xuICAgIHRoaXMuZHJhd2luZ1Rvb2xzW3RoaXMuc2VsZWN0aW9uVG9vbF0ubW91c2VVcC5jYWxsKHRoaXMsZSk7XG4gIH0sXG4gIGFwcGx5TWFzazogZnVuY3Rpb24gKGNhbnZhcywgbGVmdCwgdG9wKSB7XG4gICAgaWYgKGNhbnZhcy53aWR0aCA9PT0gMCB8fCBjYW52YXMuaGVpZ2h0ID09PSAwKSB7XG4gICAgICBkZWxldGUgdGhpcy5tYXNrO1xuICAgICAgdGhpcy5yZW5kZXIoKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdmFyIGluZm8gPSB0aGlzLmdldEluZm8oKSxcbiAgICAgIG1hc2sgPSBNYWdpY1dhbmQubWFza1NlbGVjdGlvbihjYW52YXMsbGVmdCx0b3ApIDtcblxuICAgIHRoaXMubWFzayA9IG1hc2s7XG4gICAgdGhpcy5maXJlKCdzZWxlY3Rpb246Y2hhbmdlZCcsIHttYXNrOiBtYXNrLCB0YXJnZXQ6IHRoaXMudGFyZ2V0fSk7XG4gIH0sXG4gIHNldFBhdGhmaW5kZXJNb2RlOiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICB0aGlzLnBhdGhmaW5kZXJNb2RlID0gdmFsdWU7XG4gIH0sXG4gIGdldFBhdGhmaW5kZXJNb2RlOiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMucGF0aGZpbmRlck1vZGU7XG4gIH0sXG4gIG1vZGlmeVNlbGVjdGlvbjogZnVuY3Rpb24gKG1hc2ssIHBhdGhmaW5kZXJNb2RlLCBub0V2ZW50cykge1xuICAgIHRoaXMuc2hvdWxkTW9kaWZ5ID0gZmFsc2U7XG4gICAgaWYodGhpcy5zZWxlY3Rpb25PYmplY3Qpe1xuICAgICAgdGhpcy5zZWxlY3Rpb25PYmplY3QucmVtb3ZlKCk7XG4gICAgfVxuICAgIHRoaXMuZG93blBvaW50ID0gZmFsc2U7XG4gICAgaWYgKG1hc2sgPT09IHVuZGVmaW5lZCkge1xuICAgICAgbWFzayA9IHRoaXMubWFzaztcbiAgICB9XG4gICAgaWYgKHBhdGhmaW5kZXJNb2RlID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHBhdGhmaW5kZXJNb2RlID0gdGhpcy5wYXRoZmluZGVyTW9kZTtcbiAgICB9XG4gICAgaWYgKHBhdGhmaW5kZXJNb2RlICE9PSAnbmV3JyAmJiB0aGlzLm9sZE1hc2spIHtcbiAgICAgIG1hc2sgPSBNYWdpY1dhbmRbcGF0aGZpbmRlck1vZGVdKG1hc2ssIHRoaXMub2xkTWFzayk7XG4gICAgfVxuICAgIGlmICh0aGlzLmJsdXJSYWRpdXMpIHtcbiAgICAgIG1hc2sgPSBNYWdpY1dhbmQuZ2F1c3NCbHVyT25seUJvcmRlcihtYXNrLCB0aGlzLmJsdXJSYWRpdXMpO1xuICAgIH1cbiAgICAvL2lmIChwYXRoZmluZGVyTW9kZSAhPT0gJ25ldycgJiYgdGhpcy5vbGRNYXNrIHx8IHRoaXMuYmx1clJhZGl1cykge1xuICAgIC8vICBtYXNrLmNhY2hlSW5kID0gTWFnaWNXYW5kLmdldEJvcmRlckluZGljZXMobWFzayk7XG4gICAgLy99XG5cbiAgICBpZihtYXNrICYmIG1hc2suY291bnQgJiYgdGhpcy5rZWVwT2xkU2VsZWN0aW9uKXtcbiAgICAgIG1hc2subWFrZUNhY2hlKCk7XG4gICAgICB0aGlzLm9sZE1hc2sgPSBtYXNrO1xuICAgIH1lbHNle1xuICAgICAgZGVsZXRlIHRoaXMub2xkTWFzayA7XG4gICAgfVxuXG5cbiAgICB0aGlzLm1hc2sgPSBNYWdpY1dhbmQuY3JlYXRlTWFzayh0aGlzLmVkaXRlZEltYWdlQ2FudmFzLndpZHRoLCB0aGlzLmVkaXRlZEltYWdlQ2FudmFzLmhlaWdodCk7XG4gICAgaWYgKCFub0V2ZW50cykge1xuICAgICAgdGhpcy5maXJlKCdzZWxlY3Rpb246Y2hhbmdlZCcsIHttYXNrOiBtYXNrLCB0YXJnZXQ6IHRoaXMudGFyZ2V0fSk7XG4gICAgfVxuICAgIHRoaXMucmVuZGVyKCk7XG4gIH0sXG4gIGNyZWF0ZVNlbGVjdGlvbjogZnVuY3Rpb24gKG1hc2spIHtcbiAgICBpZiAodGhpcy5zaG91bGRNb2RpZnkpIHtcbiAgICAgIHRoaXMubW9kaWZ5U2VsZWN0aW9uKCk7XG4gICAgfVxuXG4gICAgdGhpcy5tYXNrID0gbWFzayB8fCBNYWdpY1dhbmQuY3JlYXRlTWFzayh0aGlzLmVkaXRlZEltYWdlQ2FudmFzLndpZHRoLCB0aGlzLmVkaXRlZEltYWdlQ2FudmFzLmhlaWdodCk7XG4gICAgdGhpcy5yZW5kZXIoKTtcbiAgfSxcbiAgc2V0U2VsZWN0aW9uOiBmdW5jdGlvbiAobWFzaykge1xuICAgIHRoaXMubWFzayA9IG1hc2s7XG4gICAgdGhpcy5yZW5kZXIoKTtcbiAgICB0aGlzLmZpcmUoJ3NlbGVjdGlvbjpjaGFuZ2VkJywge21hc2s6IG1hc2ssIHRhcmdldDogdGhpcy50YXJnZXR9KTtcbiAgfSxcbiAgZmlsbDogZnVuY3Rpb24gKGNvbG9yLCBjYWxsYmFjaykge1xuICAgIHRoaXMuYXN5bmNyb25vdXMoZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5fZmlsbChjb2xvciwgZmFsc2UpO1xuICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2suY2FsbCh0aGlzKTtcbiAgICB9LmJpbmQodGhpcyksIDApO1xuICB9LFxuICBfZmlsbDogZnVuY3Rpb24gKGNvbG9yLCBpbnZlcnQsIGNhbnZhcykge1xuXG5cbiAgICBpZiAoIXRoaXMubWFzaykgcmV0dXJuO1xuXG5cbiAgICBjYW52YXMgPSBjYW52YXMgfHwgdGhpcy5lZGl0ZWRJbWFnZUNhbnZhcztcbiAgICB2YXIgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7Ly9iLm1pblgsIGIubWluWSwgYi5tYXhYIC0gYi5taW5YLCBiLm1heFkgLSBiLm1pblkpO1xuXG4gICAgTWFnaWNXYW5kLmZpbGxNYXNrKGN0eCwgdGhpcy5tYXNrLCBjb2xvcik7XG5cbiAgICB0aGlzLmZpcmUoJ2ltYWdlOmNoYW5nZWQnLCB0aGlzLmVkaXRlZEltYWdlQ2FudmFzKTtcbiAgfSxcbiAgaGF0Y2hUaWNrOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5oYXRjaE9mZnNldCA9ICh0aGlzLmhhdGNoT2Zmc2V0ICsgMSkgJSAodGhpcy5oYXRjaExlbmd0aCAqIDIpO1xuICAgIHRoaXMucmVuZGVyKHRydWUpO1xuICB9LFxuICBzaG93OiBmdW5jdGlvbiAoKSB7XG4gICAgd2hpbGUgKHRoaXMuY29udGFpbmVyLmxhc3RDaGlsZCkge1xuICAgICAgdGhpcy5jb250YWluZXIucmVtb3ZlQ2hpbGQodGhpcy5jb250YWluZXIubGFzdENoaWxkKTtcbiAgICB9XG4gICAgdGhpcy5jb250YWluZXIuYXBwZW5kQ2hpbGQodGhpcy5lZGl0ZWRJbWFnZUNhbnZhcyk7XG4gICAgdGhpcy5jb250YWluZXIuYXBwZW5kQ2hpbGQodGhpcy5yZXN1bHRDYW52YXMpO1xuICAgIHRoaXMuaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCh0aGlzLmhhdGNoVGljay5iaW5kKHRoaXMpLCAzMDApO1xuXG4gICAgdGhpcy5maXJlKCdzaG93Jyk7XG4gIH0sXG4gIGNsZWFyOiBmdW5jdGlvbiAoaW52ZXJ0LCBjYW52YXMsIGNhbGxiYWNrKSB7XG4gICAgdGhpcy5hc3luY3Jvbm91cyhmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLl9maWxsKFswLCAwLCAwLCAwXSwgaW52ZXJ0LCBjYW52YXMpO1xuICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2suY2FsbCh0aGlzKTtcbiAgICB9LmJpbmQodGhpcyksIDApO1xuICB9LFxuICByZW5kZXI6IGZ1bmN0aW9uIChub0JvcmRlcikge1xuICAgIGlmICghdGhpcy5jb250ZXh0IHx8ICF0aGlzLm1hc2spcmV0dXJuO1xuXG4gICAgdmFyIGN0eCA9IHRoaXMuY29udGV4dDtcbiAgICBpZiAoIW5vQm9yZGVyKSB7XG4gICAgICB0aGlzLm1hc2suY2FjaGVJbmQgPSBNYWdpY1dhbmQuZ2V0Qm9yZGVySW5kaWNlcyh0aGlzLm1hc2spO1xuICAgIH1cbiAgICBjdHguY2xlYXJSZWN0KDAsIDAsIHRoaXMubWFzay53aWR0aCwgdGhpcy5tYXNrLmhlaWdodCk7XG5cbiAgICB2YXIgX25ld19jb2xvciA9ICghdGhpcy5vbGRNYXNrIHx8IHRoaXMucGF0aGZpbmRlck1vZGUgPT0gXCJuZXdcIiB8fCB0aGlzLnBhdGhmaW5kZXJNb2RlID09IFwiYWRkXCJ8fCB0aGlzLnBhdGhmaW5kZXJNb2RlID09IFwiZXhjbHVkZVwiKVxuICAgICAgPyB0aGlzLm5ld01hc2tDb2xvciA6IHRoaXMucmVtb3ZlZE1hc2tDb2xvcjtcblxuICAgIHZhciBfaW50ZXJzZWN0aW9uX2NvbG9yO1xuICAgIGlmKHRoaXMucGF0aGZpbmRlck1vZGUgPT0gXCJhZGRcIiB8fCB0aGlzLnBhdGhmaW5kZXJNb2RlID09IFwibmV3XCJ8fCB0aGlzLnBhdGhmaW5kZXJNb2RlID09IFwiaW50ZXJzZWN0XCIpe1xuICAgICAgX2ludGVyc2VjdGlvbl9jb2xvciA9IHRoaXMubmV3TWFza0NvbG9yO1xuICAgIH1lbHNle1xuICAgICAgX2ludGVyc2VjdGlvbl9jb2xvciA9IHRoaXMucmVtb3ZlZE1hc2tDb2xvciA7Ly9pbnRlcnNlY3Rpb25SZW1vdmVkTWFza0NvbG9yO1xuICAgIH1cbiAgICB2YXIgX29sZF9jb2xvcjtcbiAgICBpZih0aGlzLnBhdGhmaW5kZXJNb2RlID09IFwiZXhjbHVkZVwiIHx8IHRoaXMucGF0aGZpbmRlck1vZGUgPT0gXCJzdWJzdHJhY3RcInx8IHRoaXMucGF0aGZpbmRlck1vZGUgPT0gXCJhZGRcIil7XG4gICAgICBfb2xkX2NvbG9yID0gdGhpcy5uZXdNYXNrQ29sb3I7XG4gICAgfWVsc2V7XG4gICAgICBfb2xkX2NvbG9yID0gdGhpcy5yZW1vdmVkTWFza0NvbG9yO1xuICAgIH1cblxuICAgIHRoaXMub2xkTWFzayAmJiB0aGlzLm9sZE1hc2sucmVuZGVyKGN0eCx7XG4gICAgICBmaWxsOiBfb2xkX2NvbG9yXG4gICAgfSk7XG5cblxuICAgIHRoaXMubWFzay5yZW5kZXIoY3R4LHtcbiAgICAgIGZpbGw6IF9uZXdfY29sb3IsXG4gICAgICBpbnRlcnNlY3Rpb25Db2xvciA6IF9pbnRlcnNlY3Rpb25fY29sb3IsXG4gICAgICBvdXRlckludGVyc2VjdGlvbkNvbG9yIDogX29sZF9jb2xvcixcbiAgICAgIC8vIG91dGVyRmlsbCA6IFwicmdiYSgwLDAsMCwwLjUpXCJcbiAgICB9KTtcblxuICAgIGlmKHRoaXMucmVuZGVyQm9yZGVyKXtcbiAgICAgIHRoaXMub2xkTWFzayAmJiB0aGlzLm9sZE1hc2sucmVuZGVyQm9yZGVyKGN0eCx7fSk7XG5cbiAgICAgIHRoaXMubWFzay5yZW5kZXJCb3JkZXIoY3R4LHtcbiAgICAgICAgaGF0Y2hPZmZzZXQ6IHRoaXMuaGF0Y2hPZmZzZXRcbiAgICAgIH0pO1xuICAgIH1cblxuICB9LFxuICByZW5kZXJCb3JkZXI6IHRydWUsXG4gIGludGVyc2VjdGlvblJlbW92ZWRNYXNrQ29sb3I6ICcjZmZhYWFhJyxcbiAgcmVtb3ZlZE1hc2tDb2xvcjogJyNhYWFhZmYnLFxuICBuZXdNYXNrQ29sb3I6ICAnI2FhRkZhYScgLFxuICByZW5kZXJNYXNrOiBmdW5jdGlvbiAoY3R4LCBtYXNrLCBjb2xvciwgbGVmdCwgdG9wKSB7XG4gICAgbWFzayA9IG1hc2sgfHwgdGhpcy5tYXNrO1xuICAgIG1hc2sgJiYgbWFzay5yZW5kZXIoY3R4LHtcbiAgICAgIGludGVyc2VjdGlvbkNvbG9yOiAnI2ZmZicsXG4gICAgICBvdXRlckludGVyc2VjdGlvbkNvbG9yOiAnIzAwMCcsXG4gICAgICBmaWxsIDpjb2xvciB8fCAnI2ZmZicsXG4gICAgICBsZWZ0IDogbGVmdCxcbiAgICAgIHRvcCA6IHRvcFxuICAgIH0pXG4gIH0sXG4gIGdldENvbnRvdXJzOiBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKCF0aGlzLl9fY3MpIHtcbiAgICAgIHRoaXMuX19jcyA9IE1hZ2ljV2FuZC50cmFjZUNvbnRvdXJzKHRoaXMubWFzayk7XG4gICAgICB0aGlzLl9fY3MgPSBNYWdpY1dhbmQuc2ltcGxpZnlDb250b3Vycyh0aGlzLl9fY3MsIHRoaXMuc2ltcGxpZnlUb2xlcmFudCwgdGhpcy5zaW1wbGlmeUNvdW50KTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuX19jcztcbiAgfSxcbiAgdHJhY2VJbm5lcjogZnVuY3Rpb24gKGN0eCkge1xuXG4gICAgdmFyIGNzID0gdGhpcy5nZXRDb250b3VycygpO1xuICAgIHZhciBjdHggPSBjdHggfHwgdGhpcy5jb250ZXh0O1xuICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAoIWNzW2ldLmlubmVyKSBjb250aW51ZTtcbiAgICAgIHZhciBwcyA9IGNzW2ldLnBvaW50cztcbiAgICAgIGN0eC5tb3ZlVG8ocHNbMF0ueCwgcHNbMF0ueSk7XG4gICAgICBmb3IgKHZhciBqID0gMTsgaiA8IHBzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgIGN0eC5saW5lVG8ocHNbal0ueCwgcHNbal0ueSk7XG4gICAgICB9XG4gICAgfVxuICAgIGN0eC5zdHJva2UoKTtcbiAgfSxcbiAgZ2V0Q29sb3I6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gJ3JnYmEoJyArIHRoaXMuY29sb3Iuam9pbignLCAnKSArICcpJztcbiAgfSxcbiAgc2V0Q29sb3I6IGZ1bmN0aW9uIChjb2xvcikge1xuICAgIHZhciBfYXJyID0gY29sb3Iuc3Vic3RyaW5nKGNvbG9yLmluZGV4T2YoJygnKSArIDEsIGNvbG9yLmxlbmd0aCAtIDEpLnNwbGl0KCcsICcpO1xuICAgIGZvciAodmFyIGkgaW4gX2Fycikge1xuICAgICAgX2FycltpXSA9IHBhcnNlRmxvYXQoX2FycltpXSk7XG4gICAgfVxuICAgIF9hcnJbM10gPSBNYXRoLnJvdW5kKF9hcnJbM10gKiAyNTUpO1xuICAgIHRoaXMuY29sb3IgPSBfYXJyO1xuICB9LFxuICB0cmFjZTogZnVuY3Rpb24gKGN0eCkge1xuICAgIHZhciBpbmZvID0gdGhpcy5nZXRJbmZvKCk7XG4gICAgdmFyIGNzID0gTWFnaWNXYW5kLnRyYWNlQ29udG91cnModGhpcy5tYXNrKTtcbiAgICBjcyA9IE1hZ2ljV2FuZC5zaW1wbGlmeUNvbnRvdXJzKGNzLCB0aGlzLnNpbXBsaWZ5VG9sZXJhbnQsIHRoaXMuc2ltcGxpZnlDb3VudCk7XG5cbiAgICAvLyBkcmF3IGNvbnRvdXJzXG4gICAgdmFyIGN0eCA9IGN0eCB8fCB0aGlzLmNvbnRleHQ7XG4gICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBpbmZvLndpZHRoLCBpbmZvLmhlaWdodCk7XG4gICAgLy9pbm5lclxuICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAoIWNzW2ldLmlubmVyKSBjb250aW51ZTtcbiAgICAgIHZhciBwcyA9IGNzW2ldLnBvaW50cztcbiAgICAgIGN0eC5tb3ZlVG8ocHNbMF0ueCwgcHNbMF0ueSk7XG4gICAgICBmb3IgKHZhciBqID0gMTsgaiA8IHBzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgIGN0eC5saW5lVG8ocHNbal0ueCwgcHNbal0ueSk7XG4gICAgICB9XG4gICAgfVxuICAgIGN0eC5zdHJva2VTdHlsZSA9ICdyZWQnO1xuICAgIGN0eC5zdHJva2UoKTtcbiAgICAvL291dGVyXG4gICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY3MubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmIChjc1tpXS5pbm5lcikgY29udGludWU7XG4gICAgICB2YXIgcHMgPSBjc1tpXS5wb2ludHM7XG4gICAgICBjdHgubW92ZVRvKHBzWzBdLngsIHBzWzBdLnkpO1xuICAgICAgZm9yICh2YXIgaiA9IDE7IGogPCBwcy5sZW5ndGg7IGorKykge1xuICAgICAgICBjdHgubGluZVRvKHBzW2pdLngsIHBzW2pdLnkpO1xuICAgICAgfVxuICAgIH1cbiAgICBjdHguc3Ryb2tlU3R5bGUgPSAnYmx1ZSc7XG4gICAgY3R4LnN0cm9rZSgpO1xuICB9LFxuICByZW1vdmVOb2lzZTogZnVuY3Rpb24gKHRocmVzaG9sZCkge1xuXG4gICAgaWYoIXRoaXMubWFzayB8fCAhdGhpcy5tYXNrLmNvdW50KXJldHVybjtcbiAgICB0aGlzLmNyZWF0ZVNlbGVjdGlvbkRyYXdDYW52YXMoKTtcbiAgICAvL3RoaXMucmVuZGVyTWFzayh0aGlzLnNlbGVjdGlvbkRyYXdDb250ZXh0LCB0aGlzLm1hc2spO1xuXG4gICAgdmFyIGNzID0gTWFnaWNXYW5kLnRyYWNlQ29udG91cnModGhpcy5tYXNrKTtcbiAgICBjcyA9IE1hZ2ljV2FuZC5zaW1wbGlmeUNvbnRvdXJzKGNzLCB0aGlzLnNpbXBsaWZ5VG9sZXJhbnQsIHRoaXMuc2ltcGxpZnlDb3VudCk7XG5cbiAgICB2YXIgY3R4ID0gdGhpcy5zZWxlY3Rpb25EcmF3Q29udGV4dCwgdiA9IHRoaXMuY2FudmFzLnZpZXdwb3J0VHJhbnNmb3JtO1xuXG4gICAgLy8gIGNzID0gTWFnaWNXYW5kLnNpbXBsaWZ5Q29udG91cnMoY3MsIHRoaXMuc2ltcGxpZnlUb2xlcmFudCwgdGhpcy5zaW1wbGlmeUNvdW50KTtcblxuICAgIGN0eC5zYXZlKCk7XG4gICAgY3R4LnRyYW5zbGF0ZSgwLjUsMC41KTtcbiAgICBjdHguZmlsbFN0eWxlPSBcIiNmZmZcIjtcbiAgICAvL2N0eC5maWxsU3R5bGU9IFwiIzBmMFwiO1xuICAgIGN0eC5zdHJva2VTdHlsZT0gXCIjZmZmXCI7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjcy5sZW5ndGg7IGkrKykge1xuICAgICAgaWYgKCFjc1tpXS5pbm5lciAmJiBjc1tpXS5wb2ludHMubGVuZ3RoID4gdGhyZXNob2xkKSB7XG4gICAgICAgIHZhciBwcyA9IGNzW2ldLnBvaW50cztcbiAgICAgICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgICAgICBjdHgubW92ZVRvKHBzWzBdLngsIHBzWzBdLnkpO1xuICAgICAgICBmb3IgKHZhciBqID0gMTsgaiA8IHBzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgY3R4LmxpbmVUbyhwc1tqXS54LCBwc1tqXS55KTtcbiAgICAgICAgfVxuICAgICAgICBjdHguY2xvc2VQYXRoKCk7XG4gICAgICAgIGN0eC5maWxsKCk7XG4gICAgICB9XG5cbiAgICB9XG4gICAgdGhpcy5tYXNrID0gTWFnaWNXYW5kLm1hc2tTZWxlY3Rpb24oIHRoaXMuc2VsZWN0aW9uRHJhd0NhbnZhcyk7XG4gICAgdGhpcy5zZXRTZWxlY3Rpb24odGhpcy5tYXNrKTtcblxuICAgIGN0eC5yZXN0b3JlKCk7XG4gIH0sXG5cbiAgdG9vbHM6IFtcbiAgICBcImFkamFjZW50UGl4ZWxzXCIsXG4gICAgXCJwYXRoZmluZGVyUmFkaXVzXCIsXG4gICAgXCJwYXRoZmluZGVyVGhyZXNob2xkXCIsXG4gICAgXCJzZWxlY3Rpb25Ub29sXCIsXG4gICAgXCJwYXRoZmluZGVyXCIsXG4gICAgXCJmaWxsV2l0aEN1cnJlbnRDb2xvclwiLFxuICAgIFwiY2xlYXJcIixcbiAgICBcInBhdGhmaW5kZXJDb2xvclwiXG4gIF0sXG4gIGFjdGlvbnMgOiB7XG5cbiAgICBjYW5jZWxTZWxlY3Rpb246IHtcbiAgICAgIHZpc2libGU6IGZhbHNlLFxuICAgICAga2V5OiAgJ0VzY2FwZScsXG4gICAgICBhY3Rpb246IGZ1bmN0aW9uKCl7XG4gICAgICAgIGRlbGV0ZSB0aGlzLnNob3VsZE1vZGlmeTtcbiAgICAgICAgdGhpcy5tYXNrID0gTWFnaWNXYW5kLmNyZWF0ZU1hc2sodGhpcy5lZGl0ZWRJbWFnZUNhbnZhcy53aWR0aCwgdGhpcy5lZGl0ZWRJbWFnZUNhbnZhcy5oZWlnaHQpO1xuICAgICAgfVxuICAgIH0sXG4gICAgbW9kaWZ5U2VsZWN0aW9uOiB7XG4gICAgICB2aXNpYmxlOiBmYWxzZSxcbiAgICAgIGtleTogICdFbnRlcicsXG4gICAgICBhY3Rpb246IGZ1bmN0aW9uKCl7XG4gICAgICAgIGlmKHRoaXMuc2hvdWxkTW9kaWZ5KXtcbiAgICAgICAgICB0aGlzLm1vZGlmeVNlbGVjdGlvbigpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcbiAgICBhZGphY2VudFBpeGVsczoge1xuICAgICAgY2xhc3NOYW1lOiAnYnV0dG9uLWFkamFjZW50JyxcbiAgICAgIHRpdGxlOiAnc2VsZXQgYWxsJyxcbiAgICAgIHR5cGU6ICdjaGVja2JveCcsXG4gICAgICB2YWx1ZTogJ2FkamFjZW50UGl4ZWxzJyxcbiAgICAgIHZpc2libGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0aW9uVG9vbCA9PT0gJ21hZ2ljJztcbiAgICAgIH0sXG4gICAgICBvYnNlcnZlOiAndG9vbDpjaGFuZ2VkJ1xuICAgIH0sXG4gICAgcGF0aGZpbmRlclJhZGl1czoge1xuICAgICAgdGl0bGU6ICdyYWRpdXMnLFxuICAgICAgdHlwZTogJ3JhbmdlJyxcbiAgICAgIHZhbHVlOiB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiB0aGlzLnJhZGl1c1xuICAgICAgICB9LFxuICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2YWwpIHtcbiAgICAgICAgICB0aGlzLnJhZGl1cyA9IHZhbDtcbiAgICAgICAgfSxcbiAgICAgICAgbWluOiAxLFxuICAgICAgICBtYXg6IDI1NVxuICAgICAgfSxcbiAgICAgIHZpc2libGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0aW9uVG9vbCA9PT0gJ2JydXNoJztcbiAgICAgIH0sXG4gICAgICBvYnNlcnZlOiAndG9vbDpjaGFuZ2VkJ1xuICAgIH0sXG4gICAgcGF0aGZpbmRlclRocmVzaG9sZDoge1xuICAgICAgdGl0bGU6ICdUaHJlc2hvbGQnLFxuICAgICAgdHlwZTogJ3JhbmdlJyxcbiAgICAgIHZhbHVlOiB7XG4gICAgICAgIG9ic2VydmU6ICd0aHJlc2hvbGQ6Y2hhbmdlZCcsXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiB0aGlzLmNvbG9yVGhyZXNob2xkXG4gICAgICAgIH0sXG4gICAgICAgIHNldDogZnVuY3Rpb24gKHZhbCkge1xuICAgICAgICAgIHRoaXMuc2V0VGhyZXNob2xkKHZhbCk7XG4gICAgICAgIH0sXG4gICAgICAgIG1pbjogMCxcbiAgICAgICAgbWF4OiAyNTVcbiAgICAgIH0sXG4gICAgICB2aXNpYmxlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGlvblRvb2wgPT09ICdtYWdpYyc7XG4gICAgICB9LFxuICAgICAgb2JzZXJ2ZTogJ3Rvb2w6Y2hhbmdlZCdcbiAgICB9LFxuICAgIHNlbGVjdGlvblRvb2w6IHtcbiAgICAgIHRpdGxlOiAnc2VsZWN0aW9uLXRvb2wnLFxuICAgICAgdHlwZTogJ29wdGlvbnMnLFxuICAgICAgdmFsdWU6ICdzZWxlY3Rpb25Ub29sJyxcbiAgICAgIG1lbnU6IHtcbiAgICAgICAgc2VsZWN0aW9uVG9vbEJydXNoOiB7XG4gICAgICAgICAgY2xhc3NOYW1lOiAnZmEgZmEtcGFpbnQtYnJ1c2gnLFxuICAgICAgICAgIHRpdGxlOiAnc2VsZWN0LWJydXNoJyxcbiAgICAgICAgICBvcHRpb246ICdicnVzaCdcbiAgICAgICAgfSxcbiAgICAgICAgc2VsZWN0aW9uVG9vbFJlY3RhbmdsZToge1xuICAgICAgICAgIGNsYXNzTmFtZTogJ2ZhIGZhLXNxdWFyZScsXG4gICAgICAgICAgdGl0bGU6ICdzZWxlY3QtcmVjdGFuZ2xlJyxcbiAgICAgICAgICBvcHRpb246ICdyZWN0YW5nbGUnXG4gICAgICAgIH0sXG4gICAgICAgIHNlbGVjdGlvbkVsbGlwdGljYWw6IHtcbiAgICAgICAgICBjbGFzc05hbWU6ICdmYSBmYS1jaXJjbGUnLFxuICAgICAgICAgIHRpdGxlOiAnc2VsZWN0LWNpcmNsZScsXG4gICAgICAgICAgb3B0aW9uOiAnY2lyY2xlJ1xuICAgICAgICB9LFxuICAgICAgICBzZWxlY3Rpb25Ub29sTWFnaWM6IHtcbiAgICAgICAgICBjbGFzc05hbWU6ICdmYSBmYS1tYWdpYycsXG4gICAgICAgICAgdGl0bGU6ICdzZWxlY3QtbWFnaWMnLFxuICAgICAgICAgIG9wdGlvbjogJ21hZ2ljJ1xuICAgICAgICB9LFxuICAgICAgICBzZWxlY3Rpb25Ub29sTGFzc286IHtcbiAgICAgICAgICB1c2U6ICdzaGFwZVNlbGVjdGlvblRvb2xzJyxcbiAgICAgICAgICB0aXRsZTogJ3NlbGVjdC1sYXNzbycsXG4gICAgICAgICAgb3B0aW9uOiAnbGFzc28nLFxuICAgICAgICAgIGljb246ICdkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LCcrIHJlcXVpcmUoJ2Jhc2U2NC1sb2FkZXIhLi8uLi9tZWRpYS9sYXNzby5zdmcnKVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcbiAgICBwYXRoZmluZGVyOiB7XG4gICAgICB0aXRsZTogJ3BhdGhmaW5kZXInLFxuICAgICAgdHlwZTogJ29wdGlvbnMnLFxuICAgICAgdmFsdWU6ICdwYXRoZmluZGVyTW9kZScsXG4gICAgICBtZW51OiB7XG4gICAgICAgIHBhdGhmaW5kZXJOZXc6IHtcbiAgICAgICAgICB0aXRsZTogJ3BhdGhmaW5kZXItbmV3JyxcbiAgICAgICAgICBvcHRpb246ICduZXcnXG4gICAgICAgIH0sXG4gICAgICAgIHBhdGhmaW5kZXJFeGNsdWRlOiB7XG4gICAgICAgICAgdGl0bGU6ICdwYXRoZmluZGVyLWV4Y2x1ZGUnLFxuICAgICAgICAgIG9wdGlvbjogJ2V4Y2x1ZGUnXG4gICAgICAgIH0sXG4gICAgICAgIHBhdGhmaW5kZXJTdWJzdHJhY3Q6IHtcbiAgICAgICAgICB0aXRsZTogJ3BhdGhmaW5kZXItc3Vic3RyYWN0JyxcbiAgICAgICAgICBvcHRpb246ICdzdWJzdHJhY3QnXG4gICAgICAgIH0sXG4gICAgICAgIHBhdGhmaW5kZXJBZGQ6IHtcbiAgICAgICAgICB0aXRsZTogJ3BhdGhmaW5kZXItYWRkJyxcbiAgICAgICAgICBvcHRpb246ICdhZGQnXG4gICAgICAgIH0sXG4gICAgICAgIHBhdGhmaW5kZXJJbnRlcnNlY3Q6IHtcbiAgICAgICAgICB0aXRsZTogJ3BhdGhmaW5kZXItaW50ZXJzZWN0JyxcbiAgICAgICAgICBvcHRpb246ICdpbnRlcnNlY3QnXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuICAgIGZpbGxXaXRoQ3VycmVudENvbG9yOiB7XG4gICAgICB0aXRsZTogJ2ZpbGxXaXRoQ3VycmVudENvbG9yJyxcbiAgICAgIGNsYXNzTmFtZTogJ2ZhIGZhLXBhaW50LWJydXNoJ1xuICAgIH0sXG4gICAgY2xlYXI6IHtcbiAgICAgIGNsYXNzTmFtZTogJ2ZhIGZhLWVyYXNlcicsXG4gICAgICBpZDogICAgICdQYXRoZmluZGVyLWNsZWFyJyxcbiAgICAgIHRpdGxlOiAgJ2NsZWFyJ1xuICAgIH0sXG4gICAgcGF0aGZpbmRlckNvbG9yOiB7XG4gICAgICB0aXRsZTogICdjb2xvcicsXG4gICAgICB0eXBlOiAgICdjb2xvcicsXG4gICAgICB2YWx1ZTogICdjb2xvcidcbiAgICB9XG4gIH1cbn07XG5cbmZhYnJpYy51dGlsLm9ic2VydmFibGUoUGF0aGZpbmRlci5wcm90b3R5cGUpO1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKFBhdGhmaW5kZXIucHJvdG90eXBlLCBmYWJyaWMuVG9vbHNNaXhpbiwge1xuICBzZWxlY3RCYWNrZ3JvdW5kOiBmdW5jdGlvbiAoZnJvbUNvcm5lcnMpIHtcbiAgICB2YXIgaW5mbyA9IHRoaXMuZ2V0SW5mbygpLCBtYXNrO1xuXG4gICAgaWYgKGZyb21Db3JuZXJzKSB7XG4gICAgICB2YXIgbWFzazEgPSBNYWdpY1dhbmQuc2VsZWN0QmFja2dyb3VuZChpbmZvLCBbMjU1LCAyNTUsIDI1NSwgZmFsc2VdLCB0aGlzLmNvbG9yVGhyZXNob2xkKTtcbiAgICAgIHZhciBtYXNrMiA9IE1hZ2ljV2FuZC5zZWxlY3RCYWNrZ3JvdW5kKGluZm8sIFtmYWxzZSwgZmFsc2UsIGZhbHNlLCAwXSwgdGhpcy5jb2xvclRocmVzaG9sZCk7XG4gICAgICBtYXNrID0gTWFnaWNXYW5kLmFkZChtYXNrMSwgbWFzazIpO1xuICAgIH0gZWxzZSB7XG4gICAgICBtYXNrID0gTWFnaWNXYW5kLnNlbGVjdEFsbEJ5Q29sb3IoaW5mbywgWzI1NSwgMjU1LCAyNTUsIDI1NV0sIHRoaXMuY29sb3JUaHJlc2hvbGQpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmJsdXJSYWRpdXMpIHtcbiAgICAgIG1hc2sgPSBNYWdpY1dhbmQuZ2F1c3NCbHVyT25seUJvcmRlcihtYXNrLCB0aGlzLmJsdXJSYWRpdXMpO1xuICAgIH1cbiAgICB0aGlzLnNldFNlbGVjdGlvbihtYXNrKTtcbiAgfSxcbiAgY29sb3JTZWxlY3Rpb246IGZ1bmN0aW9uIChjb2xvcnMsIHRocmVzaG9sZCkge1xuICAgIHZhciBpbmZvID0gdGhpcy5nZXRJbmZvKCksIG1hc2syLFxuICAgICAgbWFzayA9IE1hZ2ljV2FuZC5jcmVhdGVNYXNrKGluZm8ud2lkdGgsIGluZm8uaGVpZ2h0KTtcbiAgICBmb3IgKHZhciBpIGluIGNvbG9ycykge1xuICAgICAgdmFyIF9jb2xvciA9IG5ldyBmYWJyaWMuQ29sb3IoY29sb3JzW2ldKS5fc291cmNlO1xuICAgICAgX2NvbG9yWzNdID0gTWF0aC5yb3VuZChfY29sb3JbM10gKiAyNTUpO1xuICAgICAgbWFzazIgPSBNYWdpY1dhbmQuc2VsZWN0QWxsQnlDb2xvcihpbmZvLCBfY29sb3IsIHRocmVzaG9sZFtpXSlcbiAgICAgIG1hc2sgPSBNYWdpY1dhbmQuYWRkKG1hc2ssIG1hc2syKTtcbiAgICB9XG4gICAgZGVsZXRlIHRoaXMub2xkTWFzaztcbiAgICB0aGlzLm1vZGlmeVNlbGVjdGlvbihtYXNrKTtcbiAgfSxcbiAgc21hcnRTZWxlY3Rpb246IGZ1bmN0aW9uICh0aHJlc2hvbGQpIHtcbiAgICB2YXIgaW5mbyA9IHRoaXMuZ2V0SW5mbygpLCBtYXNrO1xuICAgIG1hc2sgPSBNYWdpY1dhbmQuc2VsZWN0QmFja2dyb3VuZChpbmZvLCBudWxsLCB0aHJlc2hvbGQgfHwgdGhpcy5jb2xvclRocmVzaG9sZCk7XG4gICAgbWFzayA9IE1hZ2ljV2FuZC5pbnZlcnRNYXNrKG1hc2spO1xuICAgIGRlbGV0ZSB0aGlzLm9sZE1hc2s7XG4gICAgdGhpcy5tb2RpZnlTZWxlY3Rpb24obWFzayk7XG4gIH1cbn0pO1xuXG5cblBhdGhmaW5kZXIucHJvdG90eXBlLmRyYXdpbmdUb29scyA9IHtcbiAgYnJ1c2g6IHtcbiAgICBtb3VzZVVwOiBmdW5jdGlvbigpe1xuICAgICAgdGhpcy5tb2RpZnlTZWxlY3Rpb24oKTtcbiAgICAgIHRoaXMucmVzZXRTZWxlY3Rpb25EcmF3Q2FudmFzKCk7XG4gICAgfSxcbiAgICBtb3VzZU1vdmU6IGZ1bmN0aW9uKHApe1xuICAgICAgaWYgKCF0aGlzLmFsbG93RHJhdykgcmV0dXJuO1xuICAgICAgdGhpcy5kcmF3Q2lyY2xlKHAueCwgcC55LCB0aGlzLnJhZGl1cyk7XG4gICAgfSxcbiAgICBtb3VzZURvd246IGZ1bmN0aW9uKHBvaW50KXtcbiAgICAgIHRoaXMuY3JlYXRlU2VsZWN0aW9uKCk7XG4gICAgICB0aGlzLmRvd25Qb2ludCA9IHBvaW50O1xuICAgICAgdGhpcy5jcmVhdGVTZWxlY3Rpb25EcmF3Q2FudmFzKCk7XG4gICAgICB0aGlzLmRyYXdDaXJjbGUocG9pbnQueCwgcG9pbnQueSwgdGhpcy5yYWRpdXMpO1xuICAgIH0sXG4gICAgdXRpbHM6IHtcbiAgICAgIGRyYXdDaXJjbGU6IGZ1bmN0aW9uICh4LCB5LCByKSB7XG4gICAgICAgIHZhciBjdHggPSB0aGlzLnNlbGVjdGlvbkRyYXdDb250ZXh0LFxuICAgICAgICAgIHYgPSB0aGlzLmNhbnZhcy52aWV3cG9ydFRyYW5zZm9ybTtcbiAgICAgICAgY3R4LnNhdmUoKTtcbiAgICAgICAgLy8gIGN0eC50cmFuc2Zvcm0odlswXSwgdlsxXSwgdlsyXSwgdlszXSwgdls0XSwgdls1XSk7XG4gICAgICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICAgICAgY3R4LmFyYyh4LCB5LCB0aGlzLnJhZGl1cywgMCwgTWF0aC5QSSAqIDIsIGZhbHNlKTtcbiAgICAgICAgY3R4LmNsb3NlUGF0aCgpO1xuICAgICAgICBjdHguZmlsbCgpO1xuICAgICAgICBjdHgucmVzdG9yZSgpO1xuICAgICAgICBNYWdpY1dhbmQubWFza1NlbGVjdGlvbiggdGhpcy5zZWxlY3Rpb25EcmF3Q2FudmFzLCAwLDAsIHRoaXMubWFzaywgJ2FkZCcpO1xuICAgICAgICB0aGlzLnNldFNlbGVjdGlvbih0aGlzLm1hc2spO1xuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgbWFnaWM6IHtcbiAgICBtb3VzZVVwOiBmdW5jdGlvbigpe1xuICAgICAgdGhpcy5zaG91bGRNb2RpZnkgPSB0cnVlO1xuICAgIH0sXG4gICAgbW91c2VNb3ZlOiBmdW5jdGlvbiAocCl7XG4gICAgICBpZiAoIXRoaXMuYWxsb3dEcmF3KSByZXR1cm47XG4gICAgICB2YXIgZGlzdCA9IHAueCAtIHRoaXMuZG93blBvaW50Lng7XG5cbiAgICAgIHZhciB2YWwgPSB0aGlzLl9pbml0X3RocmVzICsgZGlzdDtcbiAgICAgIHZhciB0aHJlcyA9IE1hdGgubWluKE1hdGgubWF4KHZhbCwgMSksIDI1NSk7XG4gICAgICBpZiAodGhyZXMgIT0gdGhpcy5jb2xvclRocmVzaG9sZCkge1xuICAgICAgICB0aGlzLnNldFRocmVzaG9sZCh0aHJlcyk7XG4gICAgICB9XG4gICAgfSxcbiAgICBtb3VzZURvd246IGZ1bmN0aW9uIChwb2ludCl7XG4gICAgICBpZiAodGhpcy5zaG91bGRNb2RpZnkpIHtcbiAgICAgICAgdGhpcy5tb2RpZnlTZWxlY3Rpb24oKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuZG93blBvaW50ID0gcG9pbnQ7XG4gICAgICB0aGlzLmNvbG9yVGhyZXNob2xkID0gMTU7XG4gICAgICB0aGlzLmZpcmUoJ3RocmVzaG9sZDpjaGFuZ2VkJywge3RocmVzaG9sZDogdGhpcy5jb2xvclRocmVzaG9sZH0pO1xuICAgICAgdGhpcy5faW5pdF90aHJlcyA9IHRoaXMuY29sb3JUaHJlc2hvbGQ7XG4gICAgICB0aGlzLmRyYXdNYXNrKHRoaXMuZG93blBvaW50LngsIHRoaXMuZG93blBvaW50LnksIHRoaXMuYWRqYWNlbnRQaXhlbHMpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0sXG4gICAgdXRpbHM6e1xuICAgICAgZHJhd01hc2s6IGZ1bmN0aW9uICh4LCB5LCBhZGphY2VudFBpeGVscykge1xuICAgICAgICB0aGlzLmFzeW5jcm9ub3VzKHRoaXMuX2RyYXdNYXNrLmJpbmQodGhpcywgeCwgeSwgYWRqYWNlbnRQaXhlbHMpLCAwKTtcbiAgICAgIH0sXG4gICAgICBfZHJhd01hc2s6IGZ1bmN0aW9uICh4LCB5LCBhZGphY2VudFBpeGVscykge1xuICAgICAgICBNYWdpY1dhbmQuYWxwaGFDaGFubmVsID0gdGhpcy5hbHBoYUNoYW5uZWw7XG4gICAgICAgIHZhciBpbmZvID0gdGhpcy5nZXRJbmZvKCksIG1hc2s7XG4gICAgICAgIGlmIChhZGphY2VudFBpeGVscykge1xuICAgICAgICAgIE1hZ2ljV2FuZC5mbG9vZEZpbGwoaW5mbywgeCwgeSwgdGhpcy5jb2xvclRocmVzaG9sZCx7fSxudWxsLGZ1bmN0aW9uKG1hc2spe1xuICAgICAgICAgICAgdGhpcy5zZXRTZWxlY3Rpb24obWFzayk7XG4gICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBtYXNrID0gTWFnaWNXYW5kLnNlbGVjdEFsbChpbmZvLCB4LCB5LCB0aGlzLmNvbG9yVGhyZXNob2xkKTtcbiAgICAgICAgICB0aGlzLnNldFNlbGVjdGlvbihtYXNrKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgcmVjdGFuZ2xlOiB7XG4gICAgbW91c2VEb3duOiBmdW5jdGlvbihwb2ludCkge1xuICAgICAgaWYgKHRoaXMuc2hvdWxkTW9kaWZ5KSB7XG4gICAgICAgIHRoaXMubW9kaWZ5U2VsZWN0aW9uKCk7XG4gICAgICB9XG4gICAgICB0aGlzLmRvd25Qb2ludCA9IHBvaW50O1xuICAgICAgdGhpcy5zaG91bGRNb2RpZnkgPSB0cnVlO1xuICAgIH0sXG4gICAgbW91c2VVcDogZnVuY3Rpb24oKXtcbiAgICAgIC8vdGhpcy5tb2RpZnlTZWxlY3Rpb24oKTtcbiAgICAgIC8vdGhpcy5yZXNldFNlbGVjdGlvbkRyYXdDYW52YXMoKTtcbiAgICB9LFxuICAgIG1vdXNlTW92ZTogZnVuY3Rpb24ocCl7XG4gICAgICBpZiAoIXRoaXMuYWxsb3dEcmF3KSByZXR1cm47XG4gICAgICB0aGlzLmRyYXdSZWN0YW5nbGUodGhpcy5kb3duUG9pbnQueCwgdGhpcy5kb3duUG9pbnQueSwgcC54LCBwLnkpO1xuICAgIH0sXG4gICAgdXRpbHM6e1xuICAgICAgZHJhd1JlY3RhbmdsZTogZnVuY3Rpb24gKHgsIHksIHgyLCB5Mikge1xuICAgICAgICB2YXIgaW5mbyA9IHRoaXMuZ2V0SW5mbygpLFxuICAgICAgICAgIG1hc2sgPSBNYWdpY1dhbmQuc2VsZWN0UmVjdGFuZ2xlKGluZm8sIHgsIHksIHgyLCB5Mik7XG4gICAgICAgIHRoaXMuc2V0U2VsZWN0aW9uKG1hc2spO1xuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgY2lyY2xlOiB7XG4gICAgbW91c2VEb3duOiBmdW5jdGlvbihwb2ludCkge1xuICAgICAgaWYgKHRoaXMuc2hvdWxkTW9kaWZ5KSB7XG4gICAgICAgIHRoaXMubW9kaWZ5U2VsZWN0aW9uKCk7XG4gICAgICB9XG4gICAgICB0aGlzLmRvd25Qb2ludCA9IHBvaW50O1xuICAgICAgdGhpcy5jcmVhdGVTZWxlY3Rpb25EcmF3Q2FudmFzKCk7XG4gICAgICB0aGlzLnNlbGVjdGlvbk9iamVjdCA9IG5ldyBmYWJyaWMuRWxsaXBzZSh7XG4gICAgICAgIGxlZnQ6IHBvaW50LnggKyB0aGlzLnRhcmdldC5sZWZ0LFxuICAgICAgICB0b3A6ICBwb2ludC55ICsgdGhpcy50YXJnZXQudG9wLFxuICAgICAgICByeDoxLFxuICAgICAgICByeToxLFxuICAgICAgICBoYXNCb3JkZXJzOiBmYWxzZSxcbiAgICAgICAgb3JpZ2luWDogJ2NlbnRlcicsXG4gICAgICAgIG9yaWdpblk6ICdjZW50ZXInLFxuICAgICAgICBzdHJva2VXaWR0aDogMSxcbiAgICAgICAgZmlsbDogJ3RyYW5zcGFyZW50JyxcbiAgICAgICAgc3Ryb2tlOiAndHJhbnNwYXJlbnQnXG4gICAgICB9KTtcbiAgICAgIHRoaXMuY2FudmFzLmFkZCh0aGlzLnNlbGVjdGlvbk9iamVjdCk7XG4gICAgICB0aGlzLnVwZGF0ZVNoYXBlKCk7XG4gICAgfSxcbiAgICBtb3VzZVVwOiBmdW5jdGlvbigpe1xuICAgICAgdGhpcy5jYW52YXMuc2V0SW50ZXJhY3RpdmVNb2RlKFwibWl4ZWRcIik7XG4gICAgICB0aGlzLnNlbGVjdGlvbk9iamVjdC5zZXRDb29yZHMoKTtcbiAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICB0aGlzLnNlbGVjdGlvbk9iamVjdC5vbignc2NhbGluZyBtb3Zpbmcgcm90YXRpbmcnLGZ1bmN0aW9uKCl7XG4gICAgICAgIF90aGlzLnVwZGF0ZVNoYXBlKCk7XG4gICAgICB9KTtcbiAgICAgIHRoaXMuY2FudmFzLnNldEFjdGl2ZU9iamVjdCh0aGlzLnNlbGVjdGlvbk9iamVjdCk7XG4gICAgICB0aGlzLnNob3VsZE1vZGlmeSA9IHRydWU7XG4gICAgICAvLyAgdGhpcy5tb2RpZnlTZWxlY3Rpb24oKTtcbiAgICAgIC8vICB0aGlzLnJlc2V0U2VsZWN0aW9uRHJhd0NhbnZhcygpO1xuICAgIH0sXG4gICAgbW91c2VNb3ZlOiBmdW5jdGlvbihwKXtcbiAgICAgIGlmICghdGhpcy5hbGxvd0RyYXcpIHJldHVybjtcbiAgICAgIHRoaXMuc2VsZWN0aW9uT2JqZWN0LnNldCh7XG4gICAgICAgIHJ4OiBNYXRoLmFicygocC54ICsgdGhpcy50YXJnZXQubGVmdCAtICB0aGlzLnNlbGVjdGlvbk9iamVjdC5nZXQoJ2xlZnQnKSkpICxcbiAgICAgICAgcnk6IE1hdGguYWJzKChwLnkgKyB0aGlzLnRhcmdldC50b3AgIC0gdGhpcy5zZWxlY3Rpb25PYmplY3QuZ2V0KCd0b3AnKSkpXG4gICAgICB9KTtcblxuICAgICAgdGhpcy51cGRhdGVTaGFwZSgpO1xuXG4gICAgfSxcbiAgICB1dGlsczp7XG4gICAgICB1cGRhdGVTaGFwZTogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnJlc2V0U2VsZWN0aW9uRHJhd0NhbnZhcygpO1xuICAgICAgICB0aGlzLnNlbGVjdGlvbk9iamVjdC5maWxsID0gJ3doaXRlJztcbiAgICAgICAgdGhpcy5zZWxlY3Rpb25EcmF3Q29udGV4dC5zYXZlKCk7XG4gICAgICAgIHRoaXMuc2VsZWN0aW9uRHJhd0NvbnRleHQudHJhbnNsYXRlKC10aGlzLnRhcmdldC5sZWZ0LCAtIHRoaXMudGFyZ2V0LnRvcCk7XG4gICAgICAgIHRoaXMuc2VsZWN0aW9uT2JqZWN0LnJlbmRlcih0aGlzLnNlbGVjdGlvbkRyYXdDb250ZXh0KTtcbiAgICAgICAgdGhpcy5zZWxlY3Rpb25EcmF3Q29udGV4dC5yZXN0b3JlKCk7XG4gICAgICAgIHRoaXMuc2VsZWN0aW9uT2JqZWN0LmZpbGwgPSAndHJhbnNwYXJlbnQnO1xuICAgICAgICB0aGlzLm1hc2sgPSBNYWdpY1dhbmQubWFza1NlbGVjdGlvbiggdGhpcy5zZWxlY3Rpb25EcmF3Q2FudmFzKTtcbiAgICAgICAgdGhpcy5zZXRTZWxlY3Rpb24odGhpcy5tYXNrKTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIGxhc3NvOiB7XG4gICAgbW91c2VVcDogZnVuY3Rpb24oKXtcbiAgICAgIGlmKHRoaXMucmVhZHlUb0Nsb3NlUGF0aCkge1xuICAgICAgICB0aGlzLl9jbG9zZVBhdGgoKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIG1vdXNlTW92ZTogZnVuY3Rpb24ocCl7XG4gICAgICBpZiAoIXRoaXMuYWxsb3dEcmF3KSByZXR1cm47XG4gICAgICB0aGlzLmRyYXdMaW5lKHRoaXMuX2xhc3RfcG9pbnQsIHApXG4gICAgICB0aGlzLl9wb2ludHMucHVzaChwKTtcbiAgICAgIHRoaXMuX2xhc3RfcG9pbnQgPSBwO1xuICAgIH0sXG4gICAgbW91c2VEb3duOiBmdW5jdGlvbihwb2ludCl7XG4gICAgICBpZighdGhpcy5kb3duUG9pbnQpe1xuICAgICAgICB0aGlzLmNyZWF0ZVNlbGVjdGlvbigpO1xuICAgICAgICB0aGlzLmNyZWF0ZVNlbGVjdGlvbkRyYXdDYW52YXMoKTtcbiAgICAgICAgdGhpcy5fcGF0aF9vdXQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5kb3duUG9pbnQgPSBwb2ludDtcbiAgICAgICAgdGhpcy5fcG9pbnRzID0gW107XG4gICAgICAgIHRoaXMuc2VsZWN0aW9uRHJhd0NvbnRleHQuYmVnaW5QYXRoKCk7XG4gICAgICAgIHRoaXMuY2FudmFzLm9uKCdtb3VzZTptb3ZlJywgdGhpcy5fY2hhbmdlQ3Vyc29yT3ZlckNsb3NlUG9pbnQpO1xuICAgICAgfVxuICAgICAgaWYodGhpcy5fbGFzdF9wb2ludCl7XG4gICAgICAgIGlmKHRoaXMucmVhZHlUb0Nsb3NlUGF0aCl7XG4gICAgICAgICAgdGhpcy5fY2xvc2VQYXRoKCk7XG4gICAgICAgIH1lbHNle1xuICAgICAgICAgIHRoaXMuZHJhd0xpbmUodGhpcy5fbGFzdF9wb2ludCwgcG9pbnQpXG4gICAgICAgICAgdGhpcy5fbGFzdF9wb2ludCA9IHBvaW50O1xuICAgICAgICAgIHRoaXMuX3BvaW50cy5wdXNoKHBvaW50KTtcbiAgICAgICAgfVxuICAgICAgfWVsc2V7XG5cbiAgICAgICAgdGhpcy5kcmF3TGluZSh7eDpwb2ludC54IC0gMC41LHk6IHBvaW50Lnl9LCB7eDpwb2ludC54ICsgMC41LHk6IHBvaW50LnkgfSlcbiAgICAgICAgdGhpcy5fbGFzdF9wb2ludCA9IHt4OnBvaW50LnggKyAwLjUseTogcG9pbnQueSB9O1xuICAgICAgICB0aGlzLl9wb2ludHMucHVzaChwb2ludCk7XG4gICAgICAgIHRoaXMuc2hvdWxkTW9kaWZ5ID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9LFxuICAgIHV0aWxzOiB7XG4gICAgICBkcmF3TGluZTogZnVuY3Rpb24gKHAxICxwMiApIHtcbiAgICAgICAgdmFyIGN0eCA9IHRoaXMuc2VsZWN0aW9uRHJhd0NvbnRleHQsXG4gICAgICAgICAgdiA9IHRoaXMuY2FudmFzLnZpZXdwb3J0VHJhbnNmb3JtO1xuICAgICAgICBjdHguc2F2ZSgpO1xuICAgICAgICAvL2N0eC50cmFuc2Zvcm0odlswXSwgdlsxXSwgdlsyXSwgdlszXSwgdls0XSwgdls1XSk7XG4gICAgICAgIGN0eC5tb3ZlVG8ocDEueCxwMS55KTtcbiAgICAgICAgY3R4LmxpbmVUbyhwMi54LHAyLnkpO1xuICAgICAgICBjdHguc3Ryb2tlKCk7XG4gICAgICAgIGN0eC5yZXN0b3JlKCk7XG4gICAgICAgIE1hZ2ljV2FuZC5tYXNrU2VsZWN0aW9uKHRoaXMuc2VsZWN0aW9uRHJhd0NhbnZhcywwLDAsdGhpcy5tYXNrLCdhZGQnKTtcbiAgICAgICAgdGhpcy5zZXRTZWxlY3Rpb24odGhpcy5tYXNrKTtcbiAgICAgIH0sXG4gICAgICBfY2xvc2VQYXRoOiAgZnVuY3Rpb24gKGUpIHtcblxuICAgICAgICB0aGlzLmFsbG93RHJhdyA9IGZhbHNlO1xuICAgICAgICB2YXIgY3R4ID0gdGhpcy5zZWxlY3Rpb25EcmF3Q29udGV4dDtcbiAgICAgICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgICAgICBjdHgubW92ZVRvKHRoaXMuX3BvaW50c1swXS54LHRoaXMuX3BvaW50c1swXS55KVxuICAgICAgICBmb3IodmFyIGkgPSAxIDsgaSA8IHRoaXMuX3BvaW50cy5sZW5ndGg7aSArKyl7XG4gICAgICAgICAgY3R4LmxpbmVUbyh0aGlzLl9wb2ludHNbaV0ueCx0aGlzLl9wb2ludHNbaV0ueSlcbiAgICAgICAgfVxuICAgICAgICBjdHguY2xvc2VQYXRoKCk7XG4gICAgICAgIGN0eC5maWxsKCk7XG4gICAgICAgIE1hZ2ljV2FuZC5tYXNrU2VsZWN0aW9uKHRoaXMuc2VsZWN0aW9uRHJhd0NhbnZhcywwLDAsdGhpcy5tYXNrLCdhZGQnKTtcbiAgICAgICAgdGhpcy5zZXRTZWxlY3Rpb24odGhpcy5tYXNrKTtcbiAgICAgICAgdGhpcy5yZXNldFNlbGVjdGlvbkRyYXdDYW52YXMoKTtcbiAgICAgICAgdGhpcy5fcG9pbnRzID0gW107XG4gICAgICAgIGRlbGV0ZSB0aGlzLmRvd25Qb2ludDtcbiAgICAgICAgZGVsZXRlIHRoaXMucmVhZHlUb0Nsb3NlUGF0aDtcbiAgICAgICAgZGVsZXRlIHRoaXMuX2xhc3RfcG9pbnQ7XG4gICAgICAgIHRoaXMuY2FudmFzLm9mZignbW91c2U6bW92ZScsIHRoaXMuX2NoYW5nZUN1cnNvck92ZXJDbG9zZVBvaW50KTtcbiAgICAgICAgdGhpcy5jYW52YXMuZnJlZURyYXdpbmdDdXJzb3IgPSAnY3Jvc3NoYWlyJztcbiAgICAgICAgdGhpcy5jYW52YXMuc2V0Q3Vyc29yKHRoaXMuY2FudmFzLmZyZWVEcmF3aW5nQ3Vyc29yKTtcbiAgICAgICAgLy8gdGhpcy5kcmF3TGluZSh0aGlzLl9sYXN0X3BvaW50LCB0aGlzLmRvd25Qb2ludCk7XG4gICAgICB9LFxuICAgICAgX2NoYW5nZUN1cnNvck92ZXJDbG9zZVBvaW50OiAgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgdmFyIGNhbnZhcyA9IHRoaXMsXG4gICAgICAgICAgcGF0aGZpbmRlciA9IGNhbnZhcy5wYXRoZmluZGVyO1xuICAgICAgICBpZighcGF0aGZpbmRlci50YXJnZXQpcmV0dXJuO1xuICAgICAgICB2YXIgaXZ0ID0gZmFicmljLnV0aWwuaW52ZXJ0VHJhbnNmb3JtKGNhbnZhcy52aWV3cG9ydFRyYW5zZm9ybSksXG4gICAgICAgICAgcCA9IGZhYnJpYy51dGlsLnRyYW5zZm9ybVBvaW50KGNhbnZhcy5nZXRQb2ludGVyKGUuZSwgdHJ1ZSksIGl2dCk7XG4gICAgICAgIHAueCAtPSBwYXRoZmluZGVyLnRhcmdldC5sZWZ0O1xuICAgICAgICBwLnkgLT0gcGF0aGZpbmRlci50YXJnZXQudG9wO1xuICAgICAgICBpZiAoIHBhdGhmaW5kZXIuZG93blBvaW50ICYmIHBhdGhmaW5kZXIuZG93blBvaW50LmRpc3RhbmNlRnJvbShwKSA8IDEwKSB7XG4gICAgICAgICAgaWYoIXBhdGhmaW5kZXIuX3BhdGhfb3V0KXtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgcGF0aGZpbmRlci5yZWFkeVRvQ2xvc2VQYXRoID0gdHJ1ZTtcbiAgICAgICAgICBjYW52YXMuZnJlZURyYXdpbmdDdXJzb3IgPSBjYW52YXMudGFyZ2V0Q3Vyc29yO1xuICAgICAgICAgIGNhbnZhcy5zZXRDdXJzb3IoY2FudmFzLmZyZWVEcmF3aW5nQ3Vyc29yKTtcbiAgICAgICAgICAvL2NvbnNvbGUubG9nKGNhbnZhcy5mcmVlRHJhd2luZ0N1cnNvcik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcGF0aGZpbmRlci5fcGF0aF9vdXQgPSB0cnVlO1xuICAgICAgICAgIHBhdGhmaW5kZXIucmVhZHlUb0Nsb3NlUGF0aCA9IGZhbHNlO1xuICAgICAgICAgIGNhbnZhcy5mcmVlRHJhd2luZ0N1cnNvciA9ICdjcm9zc2hhaXInO1xuICAgICAgICAgIGNhbnZhcy5zZXRDdXJzb3IoY2FudmFzLmZyZWVEcmF3aW5nQ3Vyc29yKTtcbiAgICAgICAgICAvLyBjb25zb2xlLmxvZyhjYW52YXMuZnJlZURyYXdpbmdDdXJzb3IpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG59O1xuZm9yKHZhciBpIGluIFBhdGhmaW5kZXIucHJvdG90eXBlLmRyYXdpbmdUb29scyl7XG4gIGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoUGF0aGZpbmRlci5wcm90b3R5cGUsIFBhdGhmaW5kZXIucHJvdG90eXBlLmRyYXdpbmdUb29sc1tpXS51dGlscylcbn1cbmZhYnJpYy5QYXRoZmluZGVyID0gUGF0aGZpbmRlcjtcblxuXG5cblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuU2xpZGVDYW52YXMucHJvdG90eXBlLCB7XG4gIHBhdGhmaW5kZXI6IGZhbHNlLFxuICBzZXRQYXRoZmluZGVyOiBmdW5jdGlvbiAodmFsKSB7XG4gICAgaWYgKHZhbCkge1xuICAgICAgdGhpcy5wYXRoZmluZGVyID0gbmV3IGZhYnJpYy5QYXRoZmluZGVyKCdwYXRoZmluZGVyJyk7XG4gICAgICB0aGlzLnBhdGhmaW5kZXIuY2FudmFzID0gdGhpcztcbiAgICB9XG4gIH0sXG4gIGdldFBhdGhmaW5kZXI6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5wYXRoZmluZGVyIHx8IHRoaXMuYXBwbGljYXRpb24gJiYgdGhpcy5hcHBsaWNhdGlvbi5wYXRoZmluZGVyO1xuICB9XG59KTtcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuQXBwbGljYXRpb24ucHJvdG90eXBlLCB7XG4gIGluaXRQYXRoZmluZGVyOiBmdW5jdGlvbiAoKSB7XG4gICAgLy9pZih0aGlzLnBhdGhmaW5kZXIpe1xuXG4gICAgICB0aGlzLnBhdGhmaW5kZXIgPSBuZXcgZmFicmljLlBhdGhmaW5kZXIoe1xuICAgICAgICBhcHBsaWNhdGlvbjogdGhpc1xuICAgICAgfSk7XG5cbiAgICAgIHRoaXMucGF0aGZpbmRlci5vbihcImltYWdlOmNoYW5nZWRcIiwgZnVuY3Rpb24gKGltZykge1xuICAgICAgICB2YXIgZGF0YVVybCA9IGltZy50b0RhdGFVUkwoKTtcbiAgICAgICAgaWYgKCF0aGlzLnRhcmdldC5fb3JpZ2luYWxFbGVtZW50KSB7XG4gICAgICAgICAgdGhpcy50YXJnZXQuX29yaWdpbmFsRWxlbWVudCA9IHRoaXMudGFyZ2V0Ll9lbGVtZW50O1xuICAgICAgICB9XG4gICAgICAgIHRoaXMudGFyZ2V0Ll9lbGVtZW50ID0gbmV3IEltYWdlKCk7XG5cbiAgICAgICAgdGhpcy50YXJnZXQuX2VsZW1lbnQub25sb2FkID0gZnVuY3Rpb24oKXtcbiAgICAgICAgICB0aGlzLnRhcmdldC5maXJlKFwiY29udGVudDptb2RpZmllZFwiKVxuICAgICAgICAgIHRoaXMudGFyZ2V0LmNhbnZhcyAmJiB0aGlzLnRhcmdldC5jYW52YXMucmVuZGVyQWxsKCk7XG4gICAgICAgIH0uYmluZCh0aGlzKTtcblxuICAgICAgICB0aGlzLnRhcmdldC5fZWxlbWVudC5zcmMgPSBkYXRhVXJsO1xuICAgICAgICB0aGlzLnRhcmdldC5fZWRpdGVkID0gdHJ1ZVxuICAgICAgICBpZih0aGlzLnRhcmdldC5kaXJ0eSAhPT0gXCJ1bmRlZmluZWRcIil7XG4gICAgICAgICAgdGhpcy50YXJnZXQuZGlydHkgPSB0cnVlO1xuICAgICAgICB9XG5cblxuICAgICAgfSk7XG4gICAgLy99XG4gIH1cbn0pO1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5BcHBsaWNhdGlvbi5wcm90b3R5cGUsIHtcbiAgZXZlbnRMaXN0ZW5lcnM6IGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmRBcnJheXNPYmplY3QoZmFicmljLkFwcGxpY2F0aW9uLnByb3RvdHlwZS5ldmVudExpc3RlbmVycywge1xuICAgIFwicmVhZHlcIjogZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5pbml0UGF0aGZpbmRlcigpO1xuICAgIH1cbiAgfSlcbn0pO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9tb2R1bGVzL3BhdGhmaW5kZXIuanMiLCJtb2R1bGUuZXhwb3J0cyA9IFwiUEhOMlp5QjRiV3h1Y3owaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNQzl6ZG1jaUlIWnBaWGRDYjNnOUlqQWdNQ0F5TWlBeU1pSStQR2NnZEhKaGJuTm1iM0p0UFNKdFlYUnlhWGdvTGpBek9UWTFJREFnTUNBdU1ETTVOalVnTVM0eE5qTWdNUzR4TmpNcElpQm1hV3hzUFNJak5HUTBaRFJrSWo0OGNHRjBhQ0JrUFNKdE1qVXdMaklnT0RFdU5qRmpPVGN1TkRNZ01DQXhOemt1TnpVZ05ETXVORE1nTVRjNUxqYzFJRGswTGpneklEQWdNVEl1TkRRNUxUUXVPVE0wSURJMExqUTBPUzB4TXk0Mk5EVWdNelV1TkRZMWJETTFMalF3TWlBeE1DNDBNRFJqT0M0Mk1UTXRNVFF1TWpJM0lERXpMalV6TXkweU9TNDJNamtnTVRNdU5UTXpMVFExTGpnMk9TQXdMVGN5TGprMk5TMDVOQzQwTmkweE16QXVNVEl0TWpFMUxqQTBMVEV6TUM0eE1pMHhNakF1TlRjZ01DMHlNVFV1TURRZ05UY3VNVFl0TWpFMUxqQTBJREV6TUM0eE1pQXdJREkyTGpreE9DQXhNaTQ1TXpZZ05URXVOalF6SURNMUxqRTVJRGN5TGpFM0xUWXVPVFV4SURRdU5UQXlMVEV6TGpjMU5pQXhNQzQxTURJdE1UZ3VPRE0ySURFNExqazROQzB4TUM0ME5UTWdNVGN1TkRRNUxURXdMalkySURNNUxqQTVMUzQyTkRVZ05qUXVNelVnT1M0ME16TWdNak11TnpreElEY3VNVEkxSURNeUxqVTRNaUExTGpZNU15QXpOUzR5TkMwekxqTTFOQ0EyTGpNeU1pMHhPQzR4TXlBNUxqVXhOQzB6TWk0ek9EVWdNVEl1TlRrMkxUTXVORGcyTGpjMU9DMDNMakEwSURFdU5UTXhMVEV3TGpVNE1pQXlMak0zTVMwNUxqUTROQ0F5TGpJMExURTFMak0xTXlBeE1TNDNNalV0TVRNdU1UTWdNakV1TWpNZ01TNDVNRElnT0M0eE1URWdPUzR4TmpRZ01UTXVOVGsySURFM0xqRTJJREV6TGpVNU5pQXhMak0wSURBZ01pNDNNRGt0TGpFMklEUXVNRFk0TFM0ME5qY2dNeTR6TWkwdU56a3hJRFl1TmpVMkxURXVOVEU0SURrdU9UTXlMVEl1TWpJM0lESXhMakV4TFRRdU5UWTBJRFExTGpBeUxUa3VOelF5SURVMkxqQTRMVE13TGpRNE1pQTRMalE0TmkweE5TNDVNRElnTnk0eE9UVXRNell1TlRFMkxUUXVNRE10TmpRdU9EVXROUzQzTWpVdE1UUXVORE0xTFRZdU16ZzFMVEkxTGpVMk5DMHhMamswTnkwek15NHhJRFF1T1RZMUxUZ3VORFV4SURFMkxqRTBMVEV5TGpJd055QXlNaTR4T1MweE15NDBOamNnTXpVdU56QTFJREU1TGprd01pQTRNaTQ0TlNBek1pNHpOVFFnTVRNMUxqVTVJRE16TGpnMk9Xd3RNVEF1TlRBMExUTTFMamMwWXkwNE55NDROeTAxTGpjMU9DMHhOVGd1TlRZdE5EWXVORFV0TVRVNExqVTJMVGswTGpBM0xqQXdNREV0TlRFdU5DQTRNaTR6TWkwNU5DNDRNeUF4TnprdU56VXRPVFF1T0RNaUx6NDhjR0YwYUNCa1BTSnRORGczTGpVM0lESTJPUzQyTTJ3dE1qSXlMakExTFRZMUxqSTNZeTB4TGpFeE5TMHVNek00TFRJdU1qUTBMUzQwT0RJdE15NHpOek10TGpRNE1pMHpMakV4TXlBd0xUWXVNVFU0SURFdU1qSTNMVGd1TkRNMElETXVOUzB6TGpBNU5pQXpMakE0TFRRdU1qVTRJRGN1TmpFekxUTXVNRElnTVRFdU56ZzViRFkxTGpJM0lESXlNaTR4WXpFdU16UWdOQzQyTVRNZ05TNHpOVElnTnk0NU9ESWdNVEF1TVRReklEZ3VOUzQwTlRNdU1EUTNMamc1TVM0d05qUWdNUzR6TWpJdU1EWTBJRFF1TXpBNUlEQWdPQzR6TURjdE1pNHpNemdnTVRBdU5ETTVMVFl1TVRZeWJEVTBMakE0TFRrNExqQTBJRGs0TGpBekxUVTBMakE1WXpRdU1qSTFMVEl1TXpJeUlEWXVOakk1TFRZdU9UVXhJRFl1TVMweE1TNDNNamN0TGpVeE5DMDBMamM0TnkwekxqZzNOQzA0TGpnd05TMDRMalV3TWkweE1DNHhOellpTHo0OEwyYytQQzl6ZG1jK0NnPT1cIlxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4uL25vZGVfbW9kdWxlcy9iYXNlNjQtbG9hZGVyIS4vbWVkaWEvbGFzc28uc3ZnXG4vLyBtb2R1bGUgaWQgPSA4N1xuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCJcbi8vIHJlcXVpcmUoXCIuLi9tb2R1bGVzL3BhdGhmaW5kZXJcIik7XG5yZXF1aXJlKFwiLi4vZmlsdGVycy9yZW1vdmVXaGl0ZVwiKTtcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuSW1hZ2UucHJvdG90eXBlLCB7XG4gIHJlbW92ZVdoaXRlOiBmdW5jdGlvbiAodGhyZXNob2xkLCByZW1vdmVBbGwsIGNhbGxiYWNrKSB7XG5cblxuICAgIHZhciByd2YgPSBfLmZpbmRXaGVyZSh0aGlzLmZpbHRlcnMsIHt0eXBlOiAnUmVtb3ZlV2hpdGVEUCd9KTtcblxuICAgIGlmIChyd2YpIHtcbiAgICAgIHJ3Zi5vcHRpb25zLmNvbG9yVGhyZXNob2xkID0gdGhyZXNob2xkO1xuICAgICAgcndmLm9wdGlvbnMuZnJvbUNvcm5lcnMgPSAhcmVtb3ZlQWxsO1xuICAgIH0gZWxzZSB7XG4gICAgICByd2YgPSBuZXcgZmFicmljLkltYWdlLmZpbHRlcnMuUmVtb3ZlV2hpdGVEUCh7XG4gICAgICAgIGZyb21Db3JuZXJzOiAhcmVtb3ZlQWxsLFxuICAgICAgICBibHVyUmFkaXVzOiAyLFxuICAgICAgICBjb2xvclRocmVzaG9sZDogdGhyZXNob2xkXG4gICAgICB9KTtcbiAgICAgIHRoaXMuZmlsdGVycy5wdXNoKHJ3Zik7XG4gICAgfVxuXG4gICAgdmFyIF90aGlzID0gdGhpcztcbiAgICB0aGlzLmFwcGx5RmlsdGVycyhmdW5jdGlvbiAoKSB7XG4gICAgICAvL190aGlzLndpZHRoID0gX3RoaXMuX2VsZW1lbnQud2lkdGg7XG4gICAgICAvL190aGlzLmhlaWdodCA9IF90aGlzLl9lbGVtZW50LmhlaWdodDtcbiAgICAgIF90aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICAgIF90aGlzLmZpcmUoXCJjb250ZW50Om1vZGlmaWVkXCIsIHtmaWx0ZXI6IHJ3ZiwgYm91bmRzOiByd2YuYm91bmRzfSk7XG4gICAgICBjYWxsYmFjayAmJiBjYWxsYmFjaygpO1xuICAgIH0pO1xuICB9LFxuICByZW1vdmVXaGl0ZUFsbDogdHJ1ZSxcblxuICBhY3Rpb25zOiBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5JbWFnZS5wcm90b3R5cGUuYWN0aW9ucywge1xuICAgIHJlbW92ZVdoaXRlRnJvbUJvcmRlcnM6IHtcbiAgICAgIHRpdGxlOiAnUmVtb3ZlIEJhY2tncm91bmQnLFxuICAgICAgdHlwZTogJ2VmZmVjdCcsXG4gICAgICBjbGFzc05hbWU6IFwiZmEgZmEtZG90LWNpcmNsZS1vXCIsXG4gICAgICBlZmZlY3RUcGw6ICc8YnV0dG9uIGlkPVwic2VsZWN0LWNvbG9ycy1hY3Rpb24tYnV0dG9uXCIgY2xhc3M9XCJmYSBmYS1jaGVja1wiPjwvYnV0dG9uPicgK1xuICAgICAgJzxpbnB1dCBpZD1cInNlbGVjdC1jb2xvcnMtY2hlY2tib3hcIiB0eXBlPVwiY2hlY2tib3hcIj4nICtcbiAgICAgICc8aW5wdXQgaWQ9XCJzZWxlY3QtY29sb3JzLXRocmVzaG9sZFwiIHR5cGU9XCJyYW5nZVwiICAgbWluPVwiMVwiIG1heD1cIjI1NVwiPicsXG4gICAgICBhY3Rpb25QYXJhbWV0ZXJzOiBmdW5jdGlvbiAoZWwsIGRhdGEpIHtcbiAgICAgICAgdmFyXG4gICAgICAgICAgYWN0aW9uQ2hrID0gZWwuZmluZCgnI3NlbGVjdC1jb2xvcnMtY2hlY2tib3gnKSxcbiAgICAgICAgICBhY3Rpb25CdG4gPSBlbC5maW5kKCcjc2VsZWN0LWNvbG9ycy1hY3Rpb24tYnV0dG9uJyk7XG4gICAgICAgIGRhdGEudGhyZXNob2xkRWwgPSBlbC5maW5kKCcjc2VsZWN0LWNvbG9ycy10aHJlc2hvbGQnKTtcblxuICAgICAgICBkYXRhLnJlbW92ZVdoaXRlQWxsID0gYWN0aW9uQ2hrLmlzKFwiOmNoZWNrZWRcIik7XG4gICAgICAgIGFjdGlvbkNoay5jaGFuZ2UoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGRhdGEucmVtb3ZlV2hpdGVBbGwgPSBhY3Rpb25DaGsuaXMoXCI6Y2hlY2tlZFwiKVxuICAgICAgICB9KTtcbiAgICAgICAgYWN0aW9uQnRuLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBkYXRhLmFjdGlvbigpO1xuICAgICAgICB9KTtcbiAgICAgICAgaWYgKCFkYXRhLl9fYWN0aW9uKSB7XG5cbiAgICAgICAgICBkYXRhLl9fYWN0aW9uID0gZGF0YS5hY3Rpb247XG4gICAgICAgICAgZGF0YS5hY3Rpb24gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBkYXRhLl9fYWN0aW9uKHBhcnNlSW50KGRhdGEudGhyZXNob2xkRWwudmFsKCkpLCBkYXRhLnJlbW92ZVdoaXRlQWxsKVxuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBhY3Rpb246IFwicmVtb3ZlV2hpdGVcIixcbiAgICAgIGluc2VydDogJ2ltYWdlVG9vbHMnXG4gICAgfVxuICB9KVxufSk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL3NoYXBlcy9pbWFnZS5yZW1vdmUtd2hpdGUuanMiLCIndXNlIHN0cmljdCc7XG5cblxuZmFicmljLlJlbW92ZVdoaXRlRFAgPSBmYWJyaWMuSW1hZ2UuZmlsdGVycy5SZW1vdmVXaGl0ZURQID0gIGZhYnJpYy51dGlsLmNyZWF0ZUNsYXNzKGZhYnJpYy5JbWFnZS5maWx0ZXJzLkJhc2VGaWx0ZXIse1xuICAgIHR5cGU6ICdSZW1vdmVXaGl0ZURQJyxcbiAgICBpbml0aWFsaXplOiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICAgIGlmKG9wdGlvbnMpZGVsZXRlIG9wdGlvbnMudHlwZTtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gZmFicmljLnV0aWwub2JqZWN0LmRlZmF1bHRzKG9wdGlvbnMgfHwge30se1xuICAgICAgICAgICAgICAgIGZyb21Db3JuZXJzIDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBibHVyUmFkaXVzOiAyLFxuICAgICAgICAgICAgICAgIGNvbG9yVGhyZXNob2xkOiAzMlxuICAgICAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucGF0aGZpbmRlciA9IG5ldyBmYWJyaWMuUGF0aGZpbmRlcih0aGlzLm9wdGlvbnMpO1xuICAgIH0sXG4gICAgYXBwbHlUbzogZnVuY3Rpb24oY2FudmFzRWwpIHtcblxuICAgICAgICB2YXIgcGF0aGZpbmRlciA9IHRoaXMucGF0aGZpbmRlcjtcblxuICAgICAgICBwYXRoZmluZGVyLmNvbG9yVGhyZXNob2xkID0gdGhpcy5vcHRpb25zLmNvbG9yVGhyZXNob2xkO1xuICAgICAgICBwYXRoZmluZGVyLnNldFBpY3R1cmUoY2FudmFzRWwpO1xuICAgICAgICBwYXRoZmluZGVyLnNlbGVjdEJhY2tncm91bmQodGhpcy5vcHRpb25zLmZyb21Db3JuZXJzKTtcbiAgICAgICAgaWYocGF0aGZpbmRlci5tYXNrLmNvdW50ICkge1xuICAgICAgICAgIHBhdGhmaW5kZXIuX2ZpbGwoWzAsIDAsIDAsIDBdKTtcbiAgICAgICAgICBwYXRoZmluZGVyLm1hc2sgPSBmYWJyaWMuTWFnaWNXYW5kLmludmVydE1hc2socGF0aGZpbmRlci5tYXNrKTtcbiAgICAgICAgICAvL3RvZG8gaW52ZXJ0aW5nIG1hc2tcblxuICAgICAgICAgIGlmKHBhdGhmaW5kZXIubWFzay5jb3VudCl7XG4gICAgICAgICAgICB2YXIgX3dpZHRoID0gcGF0aGZpbmRlci5tYXNrLmJvdW5kcy5tYXhYIC0gcGF0aGZpbmRlci5tYXNrLmJvdW5kcy5taW5YICsgMTtcbiAgICAgICAgICAgIHZhciBfaGVpZ2h0ID0gcGF0aGZpbmRlci5tYXNrLmJvdW5kcy5tYXhZIC0gcGF0aGZpbmRlci5tYXNrLmJvdW5kcy5taW5ZICsgMTtcbiAgICAgICAgICAgIHZhciBjdHggPSBjYW52YXNFbC5nZXRDb250ZXh0KCcyZCcpO1xuICAgICAgICAgICAgdmFyIGltYWdlRGF0YSA9IHBhdGhmaW5kZXIuZWRpdGVkSW1hZ2VDYW52YXMuZ2V0Q29udGV4dCgnMmQnKS5nZXRJbWFnZURhdGEocGF0aGZpbmRlci5tYXNrLmJvdW5kcy5taW5YLCBwYXRoZmluZGVyLm1hc2suYm91bmRzLm1pblksIF93aWR0aCwgX2hlaWdodCk7XG4gICAgICAgICAgICBjYW52YXNFbC53aWR0aCAgPSBfd2lkdGg7XG4gICAgICAgICAgICBjYW52YXNFbC5oZWlnaHQgPSBfaGVpZ2h0O1xuICAgICAgICAgICAgY3R4LnB1dEltYWdlRGF0YShpbWFnZURhdGEsIDAsIDApO1xuICAgICAgICAgICAgdGhpcy5ib3VuZHMgPSBwYXRoZmluZGVyLm1hc2suYm91bmRzO1xuICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgdmFyIGN0eCA9IGNhbnZhc0VsLmdldENvbnRleHQoJzJkJyk7XG4gICAgICAgICAgICBjYW52YXNFbC53aWR0aCAgPSAxO1xuICAgICAgICAgICAgY2FudmFzRWwuaGVpZ2h0ID0gMTtcbiAgICAgICAgICAgIGN0eC5jbGVhclJlY3QoMCwwLDEsMSk7XG4gICAgICAgICAgICB0aGlzLmJvdW5kcyA9IHtcbiAgICAgICAgICAgICAgbWF4WDogMCxcbiAgICAgICAgICAgICAgbWF4WTogMCxcbiAgICAgICAgICAgICAgbWluWDogMCxcbiAgICAgICAgICAgICAgbWluWTogMFxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG5cblxuICAgICAgICAgICAgLy9jbGlwIHRoZSBpbWFnZVxuICAgICAgICBwYXRoZmluZGVyLmNsZWFyTWVtb3J5KCk7XG5cbiAgICB9LFxuICAgIHRvT2JqZWN0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQodGhpcy5jYWxsU3VwZXIoJ3RvT2JqZWN0JyksIHRoaXMub3B0aW9ucyk7XG4gICAgfVxufSk7XG5cbmZhYnJpYy5JbWFnZS5maWx0ZXJzLlJlbW92ZVdoaXRlRFAuZnJvbU9iamVjdCA9IGZ1bmN0aW9uKG9iamVjdCkge1xuICAgIHJldHVybiBuZXcgZmFicmljLkltYWdlLmZpbHRlcnMuUmVtb3ZlV2hpdGVEUChvYmplY3QpO1xufTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvZmlsdGVycy9yZW1vdmVXaGl0ZS5qcyIsIlxuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4vLyBMaXN0U3R5bGVcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuVGV4dGJveC5wcm90b3R5cGUsIHtcbiAgc3RhdGVQcm9wZXJ0aWVzOiBmYWJyaWMuVGV4dGJveC5wcm90b3R5cGUuc3RhdGVQcm9wZXJ0aWVzLmNvbmNhdChbXCJsaXN0U3R5bGVUeXBlXCIsXCJsaXN0U3R5bGVGb3JtYXRcIixcImxpc3RUZXh0UGFkZGluZ1wiLFwidGV4dFBhZGRpbmdcIl0pLFxuICBsaXN0U3R5bGVUeXBlOiBcIm5vbmVcIixcbiAgbGlzdFN0eWxlRm9ybWF0OiBcIk4uXCIsXG4gIGxpc3RUZXh0UGFkZGluZzogNDAsXG4gIHRleHRQYWRkaW5nOiAwLFxuICBzZXRUZXh0UGFkZGluZzogZnVuY3Rpb24odmFsKXtcbiAgICB0aGlzLnRleHRQYWRkaW5nID0gdmFsO1xuICAgIHRoaXMuX2luaXREaW1lbnNpb25zKCk7XG4gIH0sXG4gIHNldExpc3RTdHlsZVR5cGU6IGZ1bmN0aW9uKHZhbCl7XG4gICAgdGhpcy5saXN0U3R5bGVUeXBlID0gdmFsO1xuICAgIHRoaXMuc2V0VGV4dFBhZGRpbmcodmFsID09PSBcIm5vbmVcIiA/IDA6IHRoaXMubGlzdFRleHRQYWRkaW5nKTtcbiAgfSxcbiAgLyoqXG4gICAqIFdyYXBzIHRleHQgdXNpbmcgdGhlICd3aWR0aCcgcHJvcGVydHkgb2YgVGV4dGJveC4gRmlyc3QgdGhpcyBmdW5jdGlvblxuICAgKiBzcGxpdHMgdGV4dCBvbiBuZXdsaW5lcywgc28gd2UgcHJlc2VydmUgbmV3bGluZXMgZW50ZXJlZCBieSB0aGUgdXNlci5cbiAgICogVGhlbiBpdCB3cmFwcyBlYWNoIGxpbmUgdXNpbmcgdGhlIHdpZHRoIG9mIHRoZSBUZXh0Ym94IGJ5IGNhbGxpbmdcbiAgICogX3dyYXBMaW5lKCkuXG4gICAqIEBwYXJhbSB7Q2FudmFzUmVuZGVyaW5nQ29udGV4dDJEfSBjdHggQ29udGV4dCB0byB1c2UgZm9yIG1lYXN1cmVtZW50c1xuICAgKiBAcGFyYW0ge1N0cmluZ30gdGV4dCBUaGUgc3RyaW5nIG9mIHRleHQgdGhhdCBpcyBzcGxpdCBpbnRvIGxpbmVzXG4gICAqIEByZXR1cm5zIHtBcnJheX0gQXJyYXkgb2YgbGluZXNcbiAgICovXG4gIF93cmFwVGV4dDogZnVuY3Rpb24oY3R4LCB0ZXh0KSB7XG4gICAgdmFyIGxpbmVzID0gdGV4dC5zcGxpdCh0aGlzLl9yZU5ld2xpbmUpLCB3cmFwcGVkID0gW10sIGk7XG5cblxuICAgIHRoaXMuX3BhcmFncmFwaHMgPSB7fTtcblxuICAgIGZvciAoaSA9IDA7IGkgPCBsaW5lcy5sZW5ndGg7IGkrKykge1xuICAgICAgdGhpcy5fcGFyYWdyYXBoc1t3cmFwcGVkLmxlbmd0aF0gPSB0aGlzLmxpc3RTdHlsZUZvcm1hdC5yZXBsYWNlKFwiTlwiLGkgKyAxKVxuICAgICAgd3JhcHBlZCA9IHdyYXBwZWQuY29uY2F0KHRoaXMuX3dyYXBMaW5lKGN0eCwgbGluZXNbaV0sIGkpKTtcbiAgICB9XG5cbiAgICByZXR1cm4gd3JhcHBlZDtcbiAgfSxcblxuXG4gIC8qKlxuICAgKiBXcmFwcyBhIGxpbmUgb2YgdGV4dCB1c2luZyB0aGUgd2lkdGggb2YgdGhlIFRleHRib3ggYW5kIGEgY29udGV4dC5cbiAgICogQHBhcmFtIHtDYW52YXNSZW5kZXJpbmdDb250ZXh0MkR9IGN0eCBDb250ZXh0IHRvIHVzZSBmb3IgbWVhc3VyZW1lbnRzXG4gICAqIEBwYXJhbSB7U3RyaW5nfSB0ZXh0IFRoZSBzdHJpbmcgb2YgdGV4dCB0byBzcGxpdCBpbnRvIGxpbmVzXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBsaW5lSW5kZXhcbiAgICogQHJldHVybnMge0FycmF5fSBBcnJheSBvZiBsaW5lKHMpIGludG8gd2hpY2ggdGhlIGdpdmVuIHRleHQgaXMgd3JhcHBlZFxuICAgKiB0by5cbiAgICovXG4gIF93cmFwTGluZTogZnVuY3Rpb24oY3R4LCB0ZXh0LCBsaW5lSW5kZXgpIHtcbiAgICB2YXIgbGluZVdpZHRoICAgICAgICA9IDAsXG4gICAgICBsaW5lcyAgICAgICAgICAgID0gW10sXG4gICAgICBsaW5lICAgICAgICAgICAgID0gJycsXG4gICAgICB3b3JkcyAgICAgICAgICAgID0gdGV4dC5zcGxpdCgnICcpLFxuICAgICAgd29yZCAgICAgICAgICAgICA9ICcnLFxuICAgICAgb2Zmc2V0ICAgICAgICAgICA9IDAsXG4gICAgICBpbmZpeCAgICAgICAgICAgID0gJyAnLFxuICAgICAgd29yZFdpZHRoICAgICAgICA9IDAsXG4gICAgICBpbmZpeFdpZHRoICAgICAgID0gMCxcbiAgICAgIGxhcmdlc3RXb3JkV2lkdGggPSAwLFxuICAgICAgbGluZUp1c3RTdGFydGVkID0gdHJ1ZSxcbiAgICAgIGFkZGl0aW9uYWxTcGFjZSA9IHRoaXMuX2dldFdpZHRoT2ZDaGFyU3BhY2luZygpO1xuXG5cblxuICAgIHZhciBfdGV4dEFyZWFXaWR0aCA9IHRoaXMud2lkdGg7XG4gICAgaWYodGhpcy50ZXh0UGFkZGluZyl7XG4gICAgICBfdGV4dEFyZWFXaWR0aCAtPSB0aGlzLnRleHRQYWRkaW5nXG4gICAgfVxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgd29yZHMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHdvcmQgPSB3b3Jkc1tpXTtcbiAgICAgIHdvcmRXaWR0aCA9IHRoaXMuX21lYXN1cmVUZXh0KGN0eCwgd29yZCwgbGluZUluZGV4LCBvZmZzZXQpO1xuXG4gICAgICBvZmZzZXQgKz0gd29yZC5sZW5ndGg7XG5cbiAgICAgIGxpbmVXaWR0aCArPSBpbmZpeFdpZHRoICsgd29yZFdpZHRoIC0gYWRkaXRpb25hbFNwYWNlO1xuXG4gICAgICBpZiAobGluZVdpZHRoID49IF90ZXh0QXJlYVdpZHRoICYmICFsaW5lSnVzdFN0YXJ0ZWQpIHtcbiAgICAgICAgbGluZXMucHVzaChsaW5lKTtcbiAgICAgICAgbGluZSA9ICcnO1xuICAgICAgICBsaW5lV2lkdGggPSB3b3JkV2lkdGg7XG4gICAgICAgIGxpbmVKdXN0U3RhcnRlZCA9IHRydWU7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgbGluZVdpZHRoICs9IGFkZGl0aW9uYWxTcGFjZTtcbiAgICAgIH1cblxuICAgICAgaWYgKCFsaW5lSnVzdFN0YXJ0ZWQpIHtcbiAgICAgICAgbGluZSArPSBpbmZpeDtcbiAgICAgIH1cbiAgICAgIGxpbmUgKz0gd29yZDtcblxuICAgICAgaW5maXhXaWR0aCA9IHRoaXMuX21lYXN1cmVUZXh0KGN0eCwgaW5maXgsIGxpbmVJbmRleCwgb2Zmc2V0KTtcbiAgICAgIG9mZnNldCsrO1xuICAgICAgbGluZUp1c3RTdGFydGVkID0gZmFsc2U7XG4gICAgICAvLyBrZWVwIHRyYWNrIG9mIGxhcmdlc3Qgd29yZFxuICAgICAgaWYgKHdvcmRXaWR0aCA+IGxhcmdlc3RXb3JkV2lkdGgpIHtcbiAgICAgICAgbGFyZ2VzdFdvcmRXaWR0aCA9IHdvcmRXaWR0aDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpICYmIGxpbmVzLnB1c2gobGluZSk7XG5cbiAgICBpZiAobGFyZ2VzdFdvcmRXaWR0aCA+IHRoaXMuZHluYW1pY01pbldpZHRoKSB7XG4gICAgICB0aGlzLmR5bmFtaWNNaW5XaWR0aCA9IGxhcmdlc3RXb3JkV2lkdGggLSBhZGRpdGlvbmFsU3BhY2U7XG4gICAgfVxuXG4gICAgcmV0dXJuIGxpbmVzO1xuICB9LFxuICAvKipcbiAgICogQHByaXZhdGVcbiAgICogQHBhcmFtIHtOdW1iZXJ9IGxpbmVXaWR0aCBXaWR0aCBvZiB0ZXh0IGxpbmVcbiAgICogQHJldHVybiB7TnVtYmVyfSBMaW5lIGxlZnQgb2Zmc2V0XG4gICAqL1xuICBfZ2V0TGluZUxlZnRPZmZzZXQ6IGZ1bmN0aW9uKGxpbmVXaWR0aCkge1xuICAgIGlmICh0aGlzLnRleHRBbGlnbiA9PT0gJ2NlbnRlcicpIHtcbiAgICAgIHJldHVybiAodGhpcy53aWR0aCAtIGxpbmVXaWR0aCkgLyAyICsgdGhpcy50ZXh0UGFkZGluZy8yO1xuICAgIH1cbiAgICBpZiAodGhpcy50ZXh0QWxpZ24gPT09ICdyaWdodCcpIHtcbiAgICAgIHJldHVybiB0aGlzLndpZHRoIC0gbGluZVdpZHRoO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy50ZXh0UGFkZGluZztcbiAgfSxcbiAgLyoqXG4gICAqIEBwcml2YXRlXG4gICAqIEBwYXJhbSB7Q2FudmFzUmVuZGVyaW5nQ29udGV4dDJEfSBjdHggQ29udGV4dCB0byByZW5kZXIgb25cbiAgICogQHBhcmFtIHtTdHJpbmd9IG1ldGhvZCBNZXRob2QgbmFtZSAoXCJmaWxsVGV4dFwiIG9yIFwic3Ryb2tlVGV4dFwiKVxuICAgKi9cbiAgX3JlbmRlclRleHRDb21tb246IGZ1bmN0aW9uKGN0eCwgbWV0aG9kKSB7XG5cbiAgICB2YXIgbGluZUhlaWdodHMgPSAwLCBsZWZ0ID0gdGhpcy5fZ2V0TGVmdE9mZnNldCgpLCB0b3AgPSB0aGlzLl9nZXRUb3BPZmZzZXQoKTtcblxuICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB0aGlzLl90ZXh0TGluZXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgIHZhciBoZWlnaHRPZkxpbmUgPSB0aGlzLl9nZXRIZWlnaHRPZkxpbmUoY3R4LCBpKSxcbiAgICAgICAgbWF4SGVpZ2h0ID0gaGVpZ2h0T2ZMaW5lIC8gdGhpcy5saW5lSGVpZ2h0LFxuICAgICAgICBsaW5lV2lkdGggPSB0aGlzLl9nZXRMaW5lV2lkdGgoY3R4LCBpKSxcbiAgICAgICAgbGVmdE9mZnNldCA9IHRoaXMuX2dldExpbmVMZWZ0T2Zmc2V0KGxpbmVXaWR0aCk7XG5cblxuICAgICAgdGhpcy5fcmVuZGVyVGV4dExpbmUoXG4gICAgICAgIG1ldGhvZCxcbiAgICAgICAgY3R4LFxuICAgICAgICB0aGlzLl90ZXh0TGluZXNbaV0sXG4gICAgICAgIGxlZnQgKyBsZWZ0T2Zmc2V0LFxuICAgICAgICB0b3AgKyBsaW5lSGVpZ2h0cyArIG1heEhlaWdodCxcbiAgICAgICAgaVxuICAgICAgKTtcbiAgICAgIGxpbmVIZWlnaHRzICs9IGhlaWdodE9mTGluZTtcbiAgICB9XG4gIH0sXG5cblxuICAvKipcbiAgICogQHByaXZhdGVcbiAgICogQHBhcmFtIHtTdHJpbmd9IG1ldGhvZCBNZXRob2QgbmFtZSAoXCJmaWxsVGV4dFwiIG9yIFwic3Ryb2tlVGV4dFwiKVxuICAgKiBAcGFyYW0ge0NhbnZhc1JlbmRlcmluZ0NvbnRleHQyRH0gY3R4IENvbnRleHQgdG8gcmVuZGVyIG9uXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBsaW5lIFRleHQgdG8gcmVuZGVyXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBsZWZ0IExlZnQgcG9zaXRpb24gb2YgdGV4dFxuICAgKiBAcGFyYW0ge051bWJlcn0gdG9wIFRvcCBwb3NpdGlvbiBvZiB0ZXh0XG4gICAqIEBwYXJhbSB7TnVtYmVyfSBsaW5lSW5kZXggSW5kZXggb2YgYSBsaW5lIGluIGEgdGV4dFxuICAgKi9cbiAgX3JlbmRlclRleHRMaW5lOiBmdW5jdGlvbihtZXRob2QsIGN0eCwgbGluZSwgbGVmdCwgdG9wLCBsaW5lSW5kZXgpIHtcblxuXG5cbiAgICAvLyBsaWZ0IHRoZSBsaW5lIGJ5IHF1YXJ0ZXIgb2YgZm9udFNpemVcbiAgICB0b3AgLT0gdGhpcy5mb250U2l6ZSAqIHRoaXMuX2ZvbnRTaXplRnJhY3Rpb247XG5cbiAgICBzd2l0Y2godGhpcy5saXN0U3R5bGVUeXBlKXtcbiAgICAgIGNhc2UgXCJkZWNpbWFsXCI6XG4gICAgICAgIGlmKCB0aGlzLl9wYXJhZ3JhcGhzW2xpbmVJbmRleF0pe1xuICAgICAgICAgIC8vIGxpZnQgdGhlIGxpbmUgYnkgcXVhcnRlciBvZiBmb250U2l6ZVxuICAgICAgICAgIHRoaXMuX3JlbmRlckNoYXJzKG1ldGhvZCwgY3R4LCB0aGlzLl9wYXJhZ3JhcGhzW2xpbmVJbmRleF0gLCBsZWZ0IC0gdGhpcy50ZXh0UGFkZGluZyAsIHRvcCAgLCBsaW5lSW5kZXgsIDApO1xuICAgICAgICB9XG4gICAgfVxuXG5cbiAgICAvLyBzaG9ydC1jaXJjdWl0XG4gICAgdmFyIGxpbmVXaWR0aCA9IHRoaXMuX2dldExpbmVXaWR0aChjdHgsIGxpbmVJbmRleCk7XG4gICAgaWYgKHRoaXMudGV4dEFsaWduICE9PSAnanVzdGlmeScgfHwgdGhpcy53aWR0aCA8IGxpbmVXaWR0aCkge1xuXG4gICAgICB0aGlzLl9yZW5kZXJDaGFycyhtZXRob2QsIGN0eCwgbGluZSwgbGVmdCwgdG9wLCBsaW5lSW5kZXgpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuXG4gICAgLy8gc3RyZXRjaCB0aGUgbGluZVxuICAgIHZhciB3b3JkcyA9IGxpbmUuc3BsaXQoL1xccysvKSxcbiAgICAgIGNoYXJPZmZzZXQgPSAwLFxuICAgICAgd29yZHNXaWR0aCA9IHRoaXMuX2dldFdpZHRoT2ZXb3JkcyhjdHgsIHdvcmRzLmpvaW4oJycpLCBsaW5lSW5kZXgsIDApLFxuICAgICAgd2lkdGhEaWZmID0gdGhpcy53aWR0aCAtIHdvcmRzV2lkdGggLSB0aGlzLnRleHRQYWRkaW5nLFxuICAgICAgbnVtU3BhY2VzID0gd29yZHMubGVuZ3RoIC0gMSxcbiAgICAgIHNwYWNlV2lkdGggPSBudW1TcGFjZXMgPiAwID8gd2lkdGhEaWZmIC8gbnVtU3BhY2VzIDogMCxcbiAgICAgIGxlZnRPZmZzZXQgPSAwLCB3b3JkO1xuXG4gICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHdvcmRzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICB3aGlsZSAobGluZVtjaGFyT2Zmc2V0XSA9PT0gJyAnICYmIGNoYXJPZmZzZXQgPCBsaW5lLmxlbmd0aCkge1xuICAgICAgICBjaGFyT2Zmc2V0Kys7XG4gICAgICB9XG4gICAgICB3b3JkID0gd29yZHNbaV07XG4gICAgICB0aGlzLl9yZW5kZXJDaGFycyhtZXRob2QsIGN0eCwgd29yZCwgbGVmdCArIGxlZnRPZmZzZXQsIHRvcCwgbGluZUluZGV4LCBjaGFyT2Zmc2V0KTtcbiAgICAgIGxlZnRPZmZzZXQgKz0gdGhpcy5fZ2V0V2lkdGhPZldvcmRzKGN0eCwgd29yZCwgbGluZUluZGV4LCBjaGFyT2Zmc2V0KSArIHNwYWNlV2lkdGg7XG4gICAgICBjaGFyT2Zmc2V0ICs9IHdvcmQubGVuZ3RoO1xuICAgIH1cbiAgfSxcbiAgdG9nZ2xlTGlzdFN0eWxlVHlwZTogZnVuY3Rpb24oKXtcbiAgICB0aGlzLnNldExpc3RTdHlsZVR5cGUodGhpcy5saXN0U3R5bGVUeXBlID09IFwibm9uZVwiID8gXCJkZWNpbWFsXCIgOiBcIm5vbmVcIik7XG4gICAgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gIH0sXG4gIGFjdGlvbnM6IHtcbiAgICB0b2dnbGVMaXN0U3R5bGVUeXBlOiB7XG4gICAgICBjbGFzc05hbWU6ICdmYSBmYS1saXN0LW9sJyxcbiAgICAgIHRpdGxlOiAnb3JkZXJlZCBsaXN0J1xuICAgIH1cbiAgfVxuXG59KVxuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9zaGFwZXMvdGV4dGJveC5saXN0LmpzIiwiJ3VzZSBzdHJpY3QnO1xuXG5cbmZhYnJpYy5UZXh0RnJhbWUgPSBmYWJyaWMudXRpbC5jcmVhdGVDbGFzcyhmYWJyaWMuVGV4dGJveCwge1xuICAgIHR5cGU6ICdUZXh0RnJhbWUnLFxuICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uKHRleHQsIG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5jdHggPSBmYWJyaWMudXRpbC5jcmVhdGVDYW52YXNFbGVtZW50KCkuZ2V0Q29udGV4dChcIjJkXCIpO1xuICAgICAgICB0aGlzLmNhbGxTdXBlcihcImluaXRpYWxpemVcIiwgdGV4dCwgb3B0aW9ucyk7XG4gICAgICAgIHRoaXMuc2V0KHtcbiAgICAgICAgICAgIGxvY2tVbmlTY2FsaW5nOiBvcHRpb25zLmxvY2tTY2FsaW5nWSB8fCBmYWxzZSxcbiAgICAgICAgICAgIGxvY2tTY2FsaW5nRmxpcDogb3B0aW9ucy5sb2NrU2NhbGluZ0ZsaXAgfHwgZmFsc2UsXG4gICAgICAgICAgICBsb2NrU2NhbGluZ1k6IG9wdGlvbnMubG9ja1NjYWxpbmdZIHx8IGZhbHNlLFxuICAgICAgICAgICAgaGFzQm9yZGVyczogdHJ1ZVxuICAgICAgICB9KTtcbiAgICAgICAgLy90aGlzLnNldENvbnRyb2xzVmlzaWJpbGl0eShmYWJyaWMuVGV4dGJveC5nZXRUZXh0Ym94Q29udHJvbFZpc2liaWxpdHkoKSk7XG4gICAgICAgIHRoaXMuX2RpbWVuc2lvbkFmZmVjdGluZ1Byb3BzLndpZHRoID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5vbihcImNoYW5nZWRcIiwgdGhpcy5maXRUZXh0LmJpbmQodGhpcykpO1xuICAgICAgICB0aGlzLmZpdFRleHQoKTtcbiAgICB9LFxuICAgIHNldFdpZHRoOiBmdW5jdGlvbih3KSB7XG4gICAgICAgIHRoaXMud2lkdGggPSB3O1xuICAgICAgICB0aGlzLmZpdFRleHQoKTtcbiAgICB9LFxuICAgIHNldEhlaWdodDogZnVuY3Rpb24oaCkge1xuICAgICAgICB0aGlzLmhlaWdodCA9IGg7XG4gICAgICAgIHRoaXMuZml0VGV4dCgpO1xuICAgIH0sXG4gICAgX2luaXREaW1lbnNpb25zOiBmdW5jdGlvbihjdHgpIHtcbiAgICAgICAgaWYgKHRoaXMuX19za2lwRGltZW5zaW9uKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFjdHgpIHtcbiAgICAgICAgICAgIGN0eCA9IGZhYnJpYy51dGlsLmNyZWF0ZUNhbnZhc0VsZW1lbnQoKS5nZXRDb250ZXh0KFwiMmRcIik7XG4gICAgICAgICAgICB0aGlzLl9zZXRUZXh0U3R5bGVzKGN0eCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5keW5hbWljTWluV2lkdGggPSAwO1xuICAgICAgICB0aGlzLl90ZXh0TGluZXMgPSB0aGlzLl9zcGxpdFRleHRJbnRvTGluZXMoKTtcbiAgICAgICAgdGhpcy5fY2xlYXJDYWNoZSgpO1xuICAgIH0sXG4gICAgZml0VGV4dCA6IGZ1bmN0aW9uKCl7XG5cbiAgICAgICAgd2hpbGUodGhpcy5fZ2V0VGV4dEhlaWdodCgpIDwgdGhpcy5oZWlnaHQgKXtcbiAgICAgICAgICAgIHRoaXMuZm9udFNpemUrKztcbiAgICAgICAgICAgIHRoaXMuX2luaXREaW1lbnNpb25zKHRoaXMuY3R4KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHdoaWxlKHRoaXMuX2dldFRleHRIZWlnaHQoKSA+IHRoaXMuaGVpZ2h0IHx8IHRoaXMuZHluYW1pY01pbldpZHRoID4gdGhpcy53aWR0aCApe1xuICAgICAgICAgICAgdGhpcy5mb250U2l6ZS0tO1xuICAgICAgICAgICAgdGhpcy5faW5pdERpbWVuc2lvbnModGhpcy5jdHgpO1xuICAgICAgICB9XG4gICAgICAgIC8vdGhpcy5saW5lSGVpZ2h0ID0gKHRoaXMuaGVpZ2h0IC8gdGhpcy5fdGV4dExpbmVzLmxlbmd0aCkgLyB0aGlzLmZvbnRTaXplIC8gdGhpcy5fZm9udFNpemVNdWx0O1xuICAgIH1cbn0pO1xuLy9cbi8vT2JqZWN0LmRlZmluZVByb3BlcnR5KGZhYnJpYy5UZXh0RnJhbWUsIFwid2lkdGhcIiwge1xuLy8gICAgZ2V0OiBmdW5jdGlvbigpIHtcbi8vICAgICAgICByZXR1cm4gdGhpcy5fdztcbi8vICAgIH0sXG4vLyAgICBzZXQ6IGZ1bmN0aW9uKHNsaWRlKSB7XG4vLyAgICAgICAgY29uc29sZS5sb2coc2xpZGUpO1xuLy8gICAgICAgIHRoaXMuX3cgPSBzbGlkZTtcbi8vICAgIH1cbi8vfSk7XG5cblxuZmFicmljLlRleHRGcmFtZS5mcm9tT2JqZWN0ID0gZnVuY3Rpb24ob2JqZWN0LCBjYWxsYmFjaykge1xuICAgIHZhciBfdG90YWwgPSAwLCBsb2FkZWQgPSAwO1xuICAgIGZ1bmN0aW9uIGNyZWF0ZSgpe1xuICAgICAgICB2YXIgZiA9IG5ldyBmYWJyaWMuVGV4dEZyYW1lKG9iamVjdC50ZXh0LG9iamVjdCk7XG4gICAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKGYpO1xuICAgIH1cbiAgICBmYWJyaWMudXRpbC5kYXRhLnJlY291cnNpdmUob2JqZWN0LFxuICAgICAgICBmdW5jdGlvbihwcm9wZXJ0eSwgdmFsdWUsIHBhcmVudCkge1xuXG4gICAgICAgICAgICBpZiAocHJvcGVydHkgPT0gXCJwYXR0ZXJuXCIpIHtcbiAgICAgICAgICAgICAgICBfdG90YWwgKys7XG4gICAgICAgICAgICAgICAgLy8gIHZhciBfdGV4dHVyZSA9IF8uZmluZFdoZXJlKG8ucHJvamVjdC50ZXh0dXJlcyx7aWQ6IHBhcmVudFtwcm9wZXJ0eV19KTtcblxuICAgICAgICAgICAgICAgIHZhciBfdGV4dHVyZSA9ICBmYWJyaWMudGV4dHVyZXNQYXRoICsgcGFyZW50W3Byb3BlcnR5XTtcblxuICAgICAgICAgICAgICAgIGZhYnJpYy51dGlsLmxvYWRJbWFnZShfdGV4dHVyZSwgZnVuY3Rpb24oaW1nKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vdGhpc1twcm9wZXJ0eV0gPSBuZXcgZmFicmljLkltYWdlKGltZyk7XG5cbiAgICAgICAgICAgICAgICAgICAgcGFyZW50W1wiZmlsbFwiXSA9IG5ldyBmYWJyaWMuUGF0dGVybih7XG4gICAgICAgICAgICAgICAgICAgICAgICBzb3VyY2U6IGltZyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcGVhdDogXCJyZXBlYXRcIlxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlIHBhcmVudFtwcm9wZXJ0eV07XG4gICAgICAgICAgICAgICAgICAgIGxvYWRlZCsrO1xuICAgICAgICAgICAgICAgICAgICBpZihfdG90YWwgPT0gbG9hZGVkKWNyZWF0ZSgpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgICAvL3BhcmVudFtcImZpbGxcIl0gPSBuZXcgZmFicmljLlBhdHRlcm4oe1xuICAgICAgICAgICAgICAgIC8vICAgIHNvdXJjZTogX3RleHR1cmUsXG4gICAgICAgICAgICAgICAgLy8gICAgcmVwZWF0OiBcInJlcGVhdFwiXG4gICAgICAgICAgICAgICAgLy99KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICk7XG4gICAgaWYoX3RvdGFsID09IGxvYWRlZCl7XG4gICAgICAgIHJldHVybiBjcmVhdGUoKTtcbiAgICB9XG59O1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9zaGFwZXMvdGV4dEZyYW1lLmpzIiwibW9kdWxlLmV4cG9ydHMgPSBcIlBEOTRiV3dnZG1WeWMybHZiajBpTVM0d0lpQmxibU52WkdsdVp6MGlWVlJHTFRnaUlITjBZVzVrWVd4dmJtVTlJbTV2SWo4K0Nqd2hMUzBnUTNKbFlYUmxaQ0IzYVhSb0lFbHVhM05qWVhCbElDaG9kSFJ3T2k4dmQzZDNMbWx1YTNOallYQmxMbTl5Wnk4cElDMHRQZ284YzNabkNpQWdJQ0I0Yld4dWN6cHBibXR6WTJGd1pUMGlhSFIwY0RvdkwzZDNkeTVwYm10elkyRndaUzV2Y21jdmJtRnRaWE53WVdObGN5OXBibXR6WTJGd1pTSUtJQ0FnSUhodGJHNXpPbkprWmowaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1UazVPUzh3TWk4eU1pMXlaR1l0YzNsdWRHRjRMVzV6SXlJS0lDQWdJSGh0Ykc1elBTSm9kSFJ3T2k4dmQzZDNMbmN6TG05eVp5OHlNREF3TDNOMlp5SUtJQ0FnSUhodGJHNXpPbk52Wkdsd2IyUnBQU0pvZEhSd09pOHZjMjlrYVhCdlpHa3VjMjkxY21ObFptOXlaMlV1Ym1WMEwwUlVSQzl6YjJScGNHOWthUzB3TG1SMFpDSUtJQ0FnSUhodGJHNXpPbU5qUFNKb2RIUndPaTh2WTNKbFlYUnBkbVZqYjIxdGIyNXpMbTl5Wnk5dWN5TWlDaUFnSUNCNGJXeHVjenA0YkdsdWF6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNVGs1T1M5NGJHbHVheUlLSUNBZ0lIaHRiRzV6T21SalBTSm9kSFJ3T2k4dmNIVnliQzV2Y21jdlpHTXZaV3hsYldWdWRITXZNUzR4THlJS0lDQWdJSGh0Ykc1ek9uTjJaejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpQ2lBZ0lDQjRiV3h1Y3pwdWN6RTlJbWgwZEhBNkx5OXpiM3BwTG1KaGFXVnliM1ZuWlM1bWNpSUtJQ0FnSUdsa1BTSnpkbWMwT0RnNElnb2dJQ0FnYzI5a2FYQnZaR2s2Wkc5amJtRnRaVDBpZDJGeWJtbHVaMTlpZFhSMGIyNHVjM1puSWdvZ0lDQWdkbWxsZDBKdmVEMGlNQ0F3SURRd01DQTBNREFpQ2lBZ0lDQjJaWEp6YVc5dVBTSXhMakVpQ2lBZ0lDQnBibXR6WTJGd1pUcDJaWEp6YVc5dVBTSXdMalE0TGpBZ2NqazJOVFFpQ2lBZ1Bnb2dJRHhrWldaekNpQWdJQ0FnSUdsa1BTSmtaV1p6TkRnNU1DSUtJQ0FnSUQ0S0lDQWdJRHhzYVc1bFlYSkhjbUZrYVdWdWRBb2dJQ0FnSUNBZ0lHbGtQU0pzYVc1bFlYSkhjbUZrYVdWdWREZzBNVEVpQ2lBZ0lDQWdJQ0FnZVRJOUlqTTJOeTQ0T0NJS0lDQWdJQ0FnSUNCbmNtRmthV1Z1ZEZWdWFYUnpQU0oxYzJWeVUzQmhZMlZQYmxWelpTSUtJQ0FnSUNBZ0lDQjVNVDBpTWpnM0xqUTVJZ29nSUNBZ0lDQWdJSGd5UFNJek1UVXVORGNpQ2lBZ0lDQWdJQ0FnZURFOUlqSTBNUzQwTVNJS0lDQWdJQ0FnSUNCcGJtdHpZMkZ3WlRwamIyeHNaV04wUFNKaGJIZGhlWE1pQ2lBZ0lDQWdJRDRLSUNBZ0lDQWdQSE4wYjNBS0lDQWdJQ0FnSUNBZ0lHbGtQU0p6ZEc5d05ERTFPQ0lLSUNBZ0lDQWdJQ0FnSUhOMGVXeGxQU0p6ZEc5d0xXTnZiRzl5T2lObVptWm1abVlpQ2lBZ0lDQWdJQ0FnSUNCdlptWnpaWFE5SWpBaUNpQWdJQ0FnSUM4K0NpQWdJQ0FnSUR4emRHOXdDaUFnSUNBZ0lDQWdJQ0JwWkQwaWMzUnZjRFF4TmpBaUNpQWdJQ0FnSUNBZ0lDQnpkSGxzWlQwaWMzUnZjQzFqYjJ4dmNqb2pabVptWm1abU8zTjBiM0F0YjNCaFkybDBlVG93SWdvZ0lDQWdJQ0FnSUNBZ2IyWm1jMlYwUFNJeElnb2dJQ0FnSUNBdlBnb2dJQ0FnUEM5c2FXNWxZWEpIY21Ga2FXVnVkQW9nSUNBZ1Bnb2dJQ0FnUEdacGJIUmxjZ29nSUNBZ0lDQWdJR2xrUFNKbWFXeDBaWEkyTVRJMklnb2dJQ0FnSUNBZ0lHTnZiRzl5TFdsdWRHVnljRzlzWVhScGIyNHRabWxzZEdWeWN6MGljMUpIUWlJS0lDQWdJQ0FnSUNCcGJtdHpZMkZ3WlRwamIyeHNaV04wUFNKaGJIZGhlWE1pQ2lBZ0lDQWdJRDRLSUNBZ0lDQWdQR1psUjJGMWMzTnBZVzVDYkhWeUNpQWdJQ0FnSUNBZ0lDQnBaRDBpWm1WSFlYVnpjMmxoYmtKc2RYSTJNVEk0SWdvZ0lDQWdJQ0FnSUNBZ2MzUmtSR1YyYVdGMGFXOXVQU0l3TGpVek1ETTFOekV6SWdvZ0lDQWdJQ0FnSUNBZ2FXNXJjMk5oY0dVNlkyOXNiR1ZqZEQwaVlXeDNZWGx6SWdvZ0lDQWdJQ0F2UGdvZ0lDQWdQQzltYVd4MFpYSUtJQ0FnSUQ0S0lDQWdJRHhzYVc1bFlYSkhjbUZrYVdWdWRBb2dJQ0FnSUNBZ0lHbGtQU0pzYVc1bFlYSkhjbUZrYVdWdWREZzBNVE1pQ2lBZ0lDQWdJQ0FnZVRJOUlqTTVNUzQwTlNJS0lDQWdJQ0FnSUNCbmNtRmthV1Z1ZEZWdWFYUnpQU0oxYzJWeVUzQmhZMlZQYmxWelpTSUtJQ0FnSUNBZ0lDQjVNVDBpTXpBd0xqZzJJZ29nSUNBZ0lDQWdJSGd5UFNJek5ESWlDaUFnSUNBZ0lDQWdlREU5SWpJM05TNDJNU0lLSUNBZ0lDQWdJQ0JwYm10elkyRndaVHBqYjJ4c1pXTjBQU0poYkhkaGVYTWlDaUFnSUNBZ0lENEtJQ0FnSUNBZ1BITjBiM0FLSUNBZ0lDQWdJQ0FnSUdsa1BTSnpkRzl3TnpJd01TSUtJQ0FnSUNBZ0lDQWdJSE4wZVd4bFBTSnpkRzl3TFdOdmJHOXlPaU0xTlRBd01EQWlDaUFnSUNBZ0lDQWdJQ0J2Wm1aelpYUTlJakFpQ2lBZ0lDQWdJQzgrQ2lBZ0lDQWdJRHh6ZEc5d0NpQWdJQ0FnSUNBZ0lDQnBaRDBpYzNSdmNEY3lNRE1pQ2lBZ0lDQWdJQ0FnSUNCemRIbHNaVDBpYzNSdmNDMWpiMnh2Y2pvalptWXdNREF3SWdvZ0lDQWdJQ0FnSUNBZ2IyWm1jMlYwUFNJeElnb2dJQ0FnSUNBdlBnb2dJQ0FnUEM5c2FXNWxZWEpIY21Ga2FXVnVkQW9nSUNBZ1Bnb2dJQ0FnUEhKaFpHbGhiRWR5WVdScFpXNTBDaUFnSUNBZ0lDQWdhV1E5SW5KaFpHbGhiRWR5WVdScFpXNTBPRFF4TlNJS0lDQWdJQ0FnSUNCbmNtRmthV1Z1ZEZWdWFYUnpQU0oxYzJWeVUzQmhZMlZQYmxWelpTSUtJQ0FnSUNBZ0lDQmplRDBpTXpFeUxqYzRJZ29nSUNBZ0lDQWdJR041UFNJek9EWXVOVGNpQ2lBZ0lDQWdJQ0FnY2owaU5UTXVNRE0ySWdvZ0lDQWdJQ0FnSUdkeVlXUnBaVzUwVkhKaGJuTm1iM0p0UFNKdFlYUnlhWGdvTFM0MU9UTXlOeUF0TGpVNU16STNJQzQzTVRVd05TQXRMamN4TlRBMUlESTBNeTR5TnlBNE5Ea3VNRE1wSWdvZ0lDQWdJQ0FnSUdsdWEzTmpZWEJsT21OdmJHeGxZM1E5SW1Gc2QyRjVjeUlLSUNBZ0lDQWdQZ29nSUNBZ0lDQThjM1J2Y0FvZ0lDQWdJQ0FnSUNBZ2FXUTlJbk4wYjNBM01URXpMVGNpQ2lBZ0lDQWdJQ0FnSUNCemRIbHNaVDBpYzNSdmNDMWpiMnh2Y2pvalptWm1abVptTzNOMGIzQXRiM0JoWTJsMGVUb3VOREE0TVRZaUNpQWdJQ0FnSUNBZ0lDQnZabVp6WlhROUlqQWlDaUFnSUNBZ0lDOCtDaUFnSUNBZ0lEeHpkRzl3Q2lBZ0lDQWdJQ0FnSUNCcFpEMGljM1J2Y0RjeE1UVXROeUlLSUNBZ0lDQWdJQ0FnSUhOMGVXeGxQU0p6ZEc5d0xXTnZiRzl5T2lObVptWm1abVk3YzNSdmNDMXZjR0ZqYVhSNU9qQWlDaUFnSUNBZ0lDQWdJQ0J2Wm1aelpYUTlJakVpQ2lBZ0lDQWdJQzgrQ2lBZ0lDQThMM0poWkdsaGJFZHlZV1JwWlc1MENpQWdJQ0ErQ2lBZ0lDQThiR2x1WldGeVIzSmhaR2xsYm5RS0lDQWdJQ0FnSUNCcFpEMGliR2x1WldGeVIzSmhaR2xsYm5ReE1EUTBPU0lLSUNBZ0lDQWdJQ0I1TWowaU16TTRMamd5SWdvZ0lDQWdJQ0FnSUdkeVlXUnBaVzUwVlc1cGRITTlJblZ6WlhKVGNHRmpaVTl1VlhObElnb2dJQ0FnSUNBZ0lIa3hQU0l5T0RZdU5qY2lDaUFnSUNBZ0lDQWdaM0poWkdsbGJuUlVjbUZ1YzJadmNtMDlJbTFoZEhKcGVDZ3VPVFUxTXpRZ01DQXdJQzQ1TlRVek5DQXhNell1TVRJZ01UUXVNRFUxS1NJS0lDQWdJQ0FnSUNCNE1qMGlNekF3TGpJM0lnb2dJQ0FnSUNBZ0lIZ3hQU0l5TlRVdU16SWlDaUFnSUNBZ0lDQWdhVzVyYzJOaGNHVTZZMjlzYkdWamREMGlZV3gzWVhseklnb2dJQ0FnSUNBK0NpQWdJQ0FnSUR4emRHOXdDaUFnSUNBZ0lDQWdJQ0JwWkQwaWMzUnZjRFF4TlRBaUNpQWdJQ0FnSUNBZ0lDQnpkSGxzWlQwaWMzUnZjQzFqYjJ4dmNqb2pabVptWm1abUlnb2dJQ0FnSUNBZ0lDQWdiMlptYzJWMFBTSXdJZ29nSUNBZ0lDQXZQZ29nSUNBZ0lDQThjM1J2Y0FvZ0lDQWdJQ0FnSUNBZ2FXUTlJbk4wYjNBME1UVXlJZ29nSUNBZ0lDQWdJQ0FnYzNSNWJHVTlJbk4wYjNBdFkyOXNiM0k2STJabVptWm1aanR6ZEc5d0xXOXdZV05wZEhrNk1DSUtJQ0FnSUNBZ0lDQWdJRzltWm5ObGREMGlNU0lLSUNBZ0lDQWdMejRLSUNBZ0lEd3ZiR2x1WldGeVIzSmhaR2xsYm5RS0lDQWdJRDRLSUNBZ0lEeG1hV3gwWlhJS0lDQWdJQ0FnSUNCcFpEMGlabWxzZEdWeU1URTBNamdpQ2lBZ0lDQWdJQ0FnWTI5c2IzSXRhVzUwWlhKd2IyeGhkR2x2YmkxbWFXeDBaWEp6UFNKelVrZENJZ29nSUNBZ0lDQWdJR2x1YTNOallYQmxPbU52Ykd4bFkzUTlJbUZzZDJGNWN5SUtJQ0FnSUNBZ1Bnb2dJQ0FnSUNBOFptVkhZWFZ6YzJsaGJrSnNkWElLSUNBZ0lDQWdJQ0FnSUdsa1BTSm1aVWRoZFhOemFXRnVRbXgxY2pFeE5ETXdJZ29nSUNBZ0lDQWdJQ0FnYzNSa1JHVjJhV0YwYVc5dVBTSXhMakkwTXpRMk56Z2lDaUFnSUNBZ0lDQWdJQ0JwYm10elkyRndaVHBqYjJ4c1pXTjBQU0poYkhkaGVYTWlDaUFnSUNBZ0lDOCtDaUFnSUNBOEwyWnBiSFJsY2dvZ0lDQWdQZ29nSUR3dlpHVm1jd29nSUQ0S0lDQThjMjlrYVhCdlpHazZibUZ0WldSMmFXVjNDaUFnSUNBZ0lHbGtQU0ppWVhObElnb2dJQ0FnSUNCaWIzSmtaWEpqYjJ4dmNqMGlJelkyTmpZMk5pSUtJQ0FnSUNBZ2FXNXJjMk5oY0dVNmNHRm5aWE5vWVdSdmR6MGlNaUlLSUNBZ0lDQWdhVzVyYzJOaGNHVTZkMmx1Wkc5M0xYazlJaTA0SWdvZ0lDQWdJQ0J3WVdkbFkyOXNiM0k5SWlObVptWm1abVlpQ2lBZ0lDQWdJR2x1YTNOallYQmxPbmRwYm1SdmR5MW9aV2xuYUhROUlqazRPQ0lLSUNBZ0lDQWdhVzVyYzJOaGNHVTZkMmx1Wkc5M0xXMWhlR2x0YVhwbFpEMGlNU0lLSUNBZ0lDQWdhVzVyYzJOaGNHVTZlbTl2YlQwaU1DNDNNRGN4TURZM09DSUtJQ0FnSUNBZ2FXNXJjMk5oY0dVNmQybHVaRzkzTFhnOUlpMDRJZ29nSUNBZ0lDQnphRzkzWjNKcFpEMGlabUZzYzJVaUNpQWdJQ0FnSUdKdmNtUmxjbTl3WVdOcGRIazlJakV1TUNJS0lDQWdJQ0FnYVc1cmMyTmhjR1U2WTNWeWNtVnVkQzFzWVhsbGNqMGliR0Y1WlhJeElnb2dJQ0FnSUNCcGJtdHpZMkZ3WlRwamVEMGlNekEwTGpnNU5EQTVJZ29nSUNBZ0lDQnBibXR6WTJGd1pUcGplVDBpTXpReExqVXlNVGcySWdvZ0lDQWdJQ0JwYm10elkyRndaVHAzYVc1a2IzY3RkMmxrZEdnOUlqRTJPREFpQ2lBZ0lDQWdJR2x1YTNOallYQmxPbkJoWjJWdmNHRmphWFI1UFNJd0xqQWlDaUFnSUNBZ0lHbHVhM05qWVhCbE9tUnZZM1Z0Wlc1MExYVnVhWFJ6UFNKd2VDSUtJQ0F2UGdvZ0lEeG5DaUFnSUNBZ0lHbGtQU0pzWVhsbGNqRWlDaUFnSUNBZ0lHbHVhM05qWVhCbE9teGhZbVZzUFNKTVlYbGxjaUF4SWdvZ0lDQWdJQ0JwYm10elkyRndaVHBuY205MWNHMXZaR1U5SW14aGVXVnlJZ29nSUNBZ0lDQjBjbUZ1YzJadmNtMDlJblJ5WVc1emJHRjBaU2d3SUMwMk5USXVNellwSWdvZ0lDQWdQZ29nSUNBZ1BHY0tJQ0FnSUNBZ0lDQnBaRDBpWnpFeE5ETXlJZ29nSUNBZ0lDQWdJR2x1YTNOallYQmxPbVY0Y0c5eWRDMTVaSEJwUFNJNU1DSUtJQ0FnSUNBZ0lDQnBibXR6WTJGd1pUcGxlSEJ2Y25RdGVHUndhVDBpT1RBaUNpQWdJQ0FnSUNBZ2RISmhibk5tYjNKdFBTSnRZWFJ5YVhnb01pNDVNRFV4SURBZ01DQXlMamt3TlRFZ0xURXdNREV1T1NBdE56Z3VPVFl4S1NJS0lDQWdJQ0FnUGdvZ0lDQWdJQ0E4Y0dGMGFBb2dJQ0FnSUNBZ0lDQWdhV1E5SW5CaGRHZzNNamMySWdvZ0lDQWdJQ0FnSUNBZ2MyOWthWEJ2WkdrNmNuZzlJalV6TGpBek5UY3hNeUlLSUNBZ0lDQWdJQ0FnSUhOdlpHbHdiMlJwT25KNVBTSTFNeTR3TXpVM01UTWlDaUFnSUNBZ0lDQWdJQ0J6ZEhsc1pUMGlabWxzYkRvak9UazVPVGs1SWdvZ0lDQWdJQ0FnSUNBZ2MyOWthWEJ2WkdrNmRIbHdaVDBpWVhKaklnb2dJQ0FnSUNBZ0lDQWdaRDBpYlRNMU5pNDNPU0F6TkRZdU1URmpNQ0F5T1M0eU9URXRNak11TnpRMUlEVXpMakF6TmkwMU15NHdNellnTlRNdU1ETTJjeTAxTXk0d016WXRNak11TnpRMUxUVXpMakF6TmkwMU15NHdNellnTWpNdU56UTFMVFV6TGpBek5pQTFNeTR3TXpZdE5UTXVNRE0ySURVekxqQXpOaUF5TXk0M05EVWdOVE11TURNMklEVXpMakF6Tm5vaUNpQWdJQ0FnSUNBZ0lDQjBjbUZ1YzJadmNtMDlJbTFoZEhKcGVDZ3VPVGN6TlRRZ01DQXdJQzQ1TnpNMU5DQXhNakF1TURrZ0xURXlMall5T0NraUNpQWdJQ0FnSUNBZ0lDQnpiMlJwY0c5a2FUcGplVDBpTXpRMkxqRXhNakU0SWdvZ0lDQWdJQ0FnSUNBZ2MyOWthWEJ2WkdrNlkzZzlJak13TXk0M05TSUtJQ0FnSUNBZ0x6NEtJQ0FnSUNBZ1BIQmhkR2dLSUNBZ0lDQWdJQ0FnSUdsa1BTSndZWFJvTnpJM09DSUtJQ0FnSUNBZ0lDQWdJSE52Wkdsd2IyUnBPbko0UFNJMU15NHdNelUzTVRNaUNpQWdJQ0FnSUNBZ0lDQnpiMlJwY0c5a2FUcHllVDBpTlRNdU1ETTFOekV6SWdvZ0lDQWdJQ0FnSUNBZ2MzUjViR1U5SW1acGJHdzZkWEpzS0NOc2FXNWxZWEpIY21Ga2FXVnVkRGcwTVRFcElnb2dJQ0FnSUNBZ0lDQWdjMjlrYVhCdlpHazZkSGx3WlQwaVlYSmpJZ29nSUNBZ0lDQWdJQ0FnWkQwaWJUTTFOaTQzT1NBek5EWXVNVEZqTUNBeU9TNHlPVEV0TWpNdU56UTFJRFV6TGpBek5pMDFNeTR3TXpZZ05UTXVNRE0yY3kwMU15NHdNell0TWpNdU56UTFMVFV6TGpBek5pMDFNeTR3TXpZZ01qTXVOelExTFRVekxqQXpOaUExTXk0d016WXROVE11TURNMklEVXpMakF6TmlBeU15NDNORFVnTlRNdU1ETTJJRFV6TGpBek5ub2lDaUFnSUNBZ0lDQWdJQ0IwY21GdWMyWnZjbTA5SW0xaGRISnBlQ2d1T1RVNU5qQWdNQ0F3SUM0NU5UazJNQ0F4TWpRdU16TWdMVGN1T0RBeE5Da2lDaUFnSUNBZ0lDQWdJQ0J6YjJScGNHOWthVHBqZVQwaU16UTJMakV4TWpFNElnb2dJQ0FnSUNBZ0lDQWdjMjlrYVhCdlpHazZZM2c5SWpNd015NDNOU0lLSUNBZ0lDQWdMejRLSUNBZ0lDQWdQSEJoZEdnS0lDQWdJQ0FnSUNBZ0lHbGtQU0p3WVhSb056STRNQ0lLSUNBZ0lDQWdJQ0FnSUhOdlpHbHdiMlJwT25KNFBTSTFNeTR3TXpVM01UTWlDaUFnSUNBZ0lDQWdJQ0J6YjJScGNHOWthVHB5ZVQwaU5UTXVNRE0xTnpFeklnb2dJQ0FnSUNBZ0lDQWdjM1I1YkdVOUltWnBiSFJsY2pwMWNtd29JMlpwYkhSbGNqWXhNallwTzJacGJHdzZJMlZqWldObFl5SUtJQ0FnSUNBZ0lDQWdJSE52Wkdsd2IyUnBPblI1Y0dVOUltRnlZeUlLSUNBZ0lDQWdJQ0FnSUdROUltMHpOVFl1TnprZ016UTJMakV4WXpBZ01qa3VNamt4TFRJekxqYzBOU0ExTXk0d016WXROVE11TURNMklEVXpMakF6Tm5NdE5UTXVNRE0yTFRJekxqYzBOUzAxTXk0d016WXROVE11TURNMklESXpMamMwTlMwMU15NHdNellnTlRNdU1ETTJMVFV6TGpBek5pQTFNeTR3TXpZZ01qTXVOelExSURVekxqQXpOaUExTXk0d016WjZJZ29nSUNBZ0lDQWdJQ0FnZEhKaGJuTm1iM0p0UFNKdFlYUnlhWGdvTGpnM016VTFJREFnTUNBdU9EY3pOVFVnTVRVd0xqUTNJREl4TGprNE1Ta2lDaUFnSUNBZ0lDQWdJQ0J6YjJScGNHOWthVHBqZVQwaU16UTJMakV4TWpFNElnb2dJQ0FnSUNBZ0lDQWdjMjlrYVhCdlpHazZZM2c5SWpNd015NDNOU0lLSUNBZ0lDQWdMejRLSUNBZ0lDQWdQSEJoZEdnS0lDQWdJQ0FnSUNBZ0lHbGtQU0p3WVhSb056STRNaUlLSUNBZ0lDQWdJQ0FnSUhOdlpHbHdiMlJwT25KNFBTSTFNeTR3TXpVM01UTWlDaUFnSUNBZ0lDQWdJQ0J6YjJScGNHOWthVHB5ZVQwaU5UTXVNRE0xTnpFeklnb2dJQ0FnSUNBZ0lDQWdjM1I1YkdVOUltWnBiSFJsY2pwMWNtd29JMlpwYkhSbGNqWXhNallwTzJacGJHdzZJems1T1RrNU9TSUtJQ0FnSUNBZ0lDQWdJSE52Wkdsd2IyUnBPblI1Y0dVOUltRnlZeUlLSUNBZ0lDQWdJQ0FnSUdROUltMHpOVFl1TnprZ016UTJMakV4WXpBZ01qa3VNamt4TFRJekxqYzBOU0ExTXk0d016WXROVE11TURNMklEVXpMakF6Tm5NdE5UTXVNRE0yTFRJekxqYzBOUzAxTXk0d016WXROVE11TURNMklESXpMamMwTlMwMU15NHdNellnTlRNdU1ETTJMVFV6TGpBek5pQTFNeTR3TXpZZ01qTXVOelExSURVekxqQXpOaUExTXk0d016WjZJZ29nSUNBZ0lDQWdJQ0FnZEhKaGJuTm1iM0p0UFNKdFlYUnlhWGdvTGpnek9ETTRJREFnTUNBdU9ETTRNemdnTVRZeExqRTFJRE0wTGpFMU1pa2lDaUFnSUNBZ0lDQWdJQ0J6YjJScGNHOWthVHBqZVQwaU16UTJMakV4TWpFNElnb2dJQ0FnSUNBZ0lDQWdjMjlrYVhCdlpHazZZM2c5SWpNd015NDNOU0lLSUNBZ0lDQWdMejRLSUNBZ0lDQWdQSEJoZEdnS0lDQWdJQ0FnSUNBZ0lHbGtQU0p3WVhSb056STROQ0lLSUNBZ0lDQWdJQ0FnSUhOdlpHbHdiMlJwT25KNFBTSTFNeTR3TXpVM01UTWlDaUFnSUNBZ0lDQWdJQ0J6YjJScGNHOWthVHB5ZVQwaU5UTXVNRE0xTnpFeklnb2dJQ0FnSUNBZ0lDQWdjM1I1YkdVOUltWnBiR3c2ZFhKc0tDTnNhVzVsWVhKSGNtRmthV1Z1ZERnME1UTXBJZ29nSUNBZ0lDQWdJQ0FnYzI5a2FYQnZaR2s2ZEhsd1pUMGlZWEpqSWdvZ0lDQWdJQ0FnSUNBZ1pEMGliVE0xTmk0M09TQXpORFl1TVRGak1DQXlPUzR5T1RFdE1qTXVOelExSURVekxqQXpOaTAxTXk0d016WWdOVE11TURNMmN5MDFNeTR3TXpZdE1qTXVOelExTFRVekxqQXpOaTAxTXk0d016WWdNak11TnpRMUxUVXpMakF6TmlBMU15NHdNell0TlRNdU1ETTJJRFV6TGpBek5pQXlNeTQzTkRVZ05UTXVNRE0ySURVekxqQXpObm9pQ2lBZ0lDQWdJQ0FnSUNCMGNtRnVjMlp2Y20wOUltMWhkSEpwZUNndU9EQTFPRGNnTUNBd0lDNDRNRFU0TnlBeE56RXVNRE1nTkRVdU5EQTFLU0lLSUNBZ0lDQWdJQ0FnSUhOdlpHbHdiMlJwT21ONVBTSXpORFl1TVRFeU1UZ2lDaUFnSUNBZ0lDQWdJQ0J6YjJScGNHOWthVHBqZUQwaU16QXpMamMxSWdvZ0lDQWdJQ0F2UGdvZ0lDQWdJQ0E4Y0dGMGFBb2dJQ0FnSUNBZ0lDQWdhV1E5SW5CaGRHZzNNamcySWdvZ0lDQWdJQ0FnSUNBZ2MyOWthWEJ2WkdrNmNuZzlJalV6TGpBek5UY3hNeUlLSUNBZ0lDQWdJQ0FnSUhOdlpHbHdiMlJwT25KNVBTSTFNeTR3TXpVM01UTWlDaUFnSUNBZ0lDQWdJQ0J6ZEhsc1pUMGlabWxzYkRwMWNtd29JM0poWkdsaGJFZHlZV1JwWlc1ME9EUXhOU2tpQ2lBZ0lDQWdJQ0FnSUNCemIyUnBjRzlrYVRwMGVYQmxQU0poY21NaUNpQWdJQ0FnSUNBZ0lDQmtQU0p0TXpVMkxqYzVJRE0wTmk0eE1XTXdJREk1TGpJNU1TMHlNeTQzTkRVZ05UTXVNRE0yTFRVekxqQXpOaUExTXk0d016WnpMVFV6TGpBek5pMHlNeTQzTkRVdE5UTXVNRE0yTFRVekxqQXpOaUF5TXk0M05EVXROVE11TURNMklEVXpMakF6TmkwMU15NHdNellnTlRNdU1ETTJJREl6TGpjME5TQTFNeTR3TXpZZ05UTXVNRE0yZWlJS0lDQWdJQ0FnSUNBZ0lIUnlZVzV6Wm05eWJUMGliV0YwY21sNEtDNDNOVGd5TlNBd0lEQWdMamMxT0RJMUlERTROaTQzTlNBMk15NDVNRFlwSWdvZ0lDQWdJQ0FnSUNBZ2MyOWthWEJ2WkdrNlkzazlJak0wTmk0eE1USXhPQ0lLSUNBZ0lDQWdJQ0FnSUhOdlpHbHdiMlJwT21ONFBTSXpNRE11TnpVaUNpQWdJQ0FnSUM4K0NpQWdJQ0FnSUR4d1lYUm9DaUFnSUNBZ0lDQWdJQ0JwWkQwaWNHRjBhRGN5T0RnaUNpQWdJQ0FnSUNBZ0lDQnpkSGxzWlQwaWIzQmhZMmwwZVRvdU16RTNOekU3Wm1sc2JEcDFjbXdvSTJ4cGJtVmhja2R5WVdScFpXNTBNVEEwTkRrcElnb2dJQ0FnSUNBZ0lDQWdhVzVyYzJOaGNHVTZZMjl1Ym1WamRHOXlMV04xY25aaGRIVnlaVDBpTUNJS0lDQWdJQ0FnSUNBZ0lHUTlJbTAwTVRRdU9DQXlPRFF1TVRWakxURXpMak16TVNBd0xqTXdNRFk1TFRJMkxqRTROaUEzTGpNMU9DMHpNeTR6TXpZZ01Ua3VOelF5TFRjdU5qa3dNeUF4TXk0ek1pMDJMamN4TXprZ01qa3VNalkySURFdU1UVTBOU0EwTVM0ek16RWdNQzQ0TlRNd05pMHlOaTQxTXpJZ01qRXVNVE15TFRRMkxqVXhOU0EwTmk0ek1qUXRORFV1TURVMElEZ3VNalU0T1NBd0xqUTNPVEEzSURFMkxqQTFOQ0F6TGpJd01ERWdNakl1T0RVNUlEY3VOVGt3T0MwekxqSTFOemd0Tnk0ME5EazRMVGd1T0RFM01TMHhNeTQ1TlRNdE1UWXVNemswTFRFNExqTXlOeTAyTGpRNE5qY3RNeTQzTkRVeExURXpMall5TlMwMUxqUXpPVE10TWpBdU5qQTRMVFV1TWpneE9Ib2lDaUFnSUNBZ0lDOCtDaUFnSUNBZ0lEeHdZWFJvQ2lBZ0lDQWdJQ0FnSUNCcFpEMGljbVZqZERjek56QWlDaUFnSUNBZ0lDQWdJQ0JrUFNKdE5EQXlMamc0SURNd01DNHdPUzB4TVM0MU9ERWdNVEV1TlRneElERXpMakk1TlNBeE15NHlPVFV0TVRNdU1qazFJREV6TGpJNE1TQXhNUzQxT0RFZ01URXVOVGd4SURFekxqSTRNUzB4TXk0eU9UVWdNVE11TWprMUlERXpMakk1TlNBeE1TNDFPREV0TVRFdU5UZ3hMVEV6TGpJNE1TMHhNeTR5T0RFZ01UTXVNamd4TFRFekxqSTVOUzB4TVM0MU9ERXRNVEV1TlRneExURXpMakk1TlNBeE15NHlPREV0TVRNdU1qZ3hMVEV6TGpJNE1Yb2lDaUFnSUNBZ0lDQWdJQ0J6ZEhsc1pUMGlabWxzZEdWeU9uVnliQ2dqWm1sc2RHVnlNVEUwTWpncE8yWnBiR3c2SXpGaE1XRXhZU0lLSUNBZ0lDQWdJQ0FnSUdsdWEzTmpZWEJsT21OdmJtNWxZM1J2Y2kxamRYSjJZWFIxY21VOUlqQWlDaUFnSUNBZ0lDOCtDaUFnSUNBZ0lEeHdZWFJvQ2lBZ0lDQWdJQ0FnSUNCcFpEMGljR0YwYURFd05EVTNJZ29nSUNBZ0lDQWdJQ0FnYzNSNWJHVTlJbVpwYkd3NkkyWm1abVptWmlJS0lDQWdJQ0FnSUNBZ0lHbHVhM05qWVhCbE9tTnZibTVsWTNSdmNpMWpkWEoyWVhSMWNtVTlJakFpQ2lBZ0lDQWdJQ0FnSUNCa1BTSnROREF6TGpRMUlETXdNUzR4TlMweE1TNHdPRGNnTVRFdU1EZzNJREV5TGpjeU9DQXhNaTQzTWpndE1USXVOekk0SURFeUxqY3hOQ0F4TVM0d09EY2dNVEV1TURnM0lERXlMamN4TkMweE1pNDNNamdnTVRJdU56STRJREV5TGpjeU9DQXhNUzR3T0RjdE1URXVNRGczTFRFeUxqY3hOQzB4TWk0M01UUWdNVEl1TnpFMExURXlMamN5T0MweE1TNHdPRGN0TVRFdU1EZzNMVEV5TGpjeU9DQXhNaTQzTVRRdE1USXVOekUwTFRFeUxqY3hOSG9pQ2lBZ0lDQWdJQzgrQ2lBZ0lDQThMMmNLSUNBZ0lENEtJQ0E4TDJjS0lDQStDaUFnUEcxbGRHRmtZWFJoQ2lBZ0lDQStDaUFnSUNBOGNtUm1PbEpFUmdvZ0lDQWdJQ0ErQ2lBZ0lDQWdJRHhqWXpwWGIzSnJDaUFnSUNBZ0lDQWdQZ29nSUNBZ0lDQWdJRHhrWXpwbWIzSnRZWFFLSUNBZ0lDQWdJQ0FnSUQ1cGJXRm5aUzl6ZG1jcmVHMXNQQzlrWXpwbWIzSnRZWFFLSUNBZ0lDQWdJQ0ErQ2lBZ0lDQWdJQ0FnUEdSak9uUjVjR1VLSUNBZ0lDQWdJQ0FnSUNBZ2NtUm1PbkpsYzI5MWNtTmxQU0pvZEhSd09pOHZjSFZ5YkM1dmNtY3ZaR012WkdOdGFYUjVjR1V2VTNScGJHeEpiV0ZuWlNJS0lDQWdJQ0FnSUNBdlBnb2dJQ0FnSUNBZ0lEeGpZenBzYVdObGJuTmxDaUFnSUNBZ0lDQWdJQ0FnSUhKa1pqcHlaWE52ZFhKalpUMGlhSFIwY0RvdkwyTnlaV0YwYVhabFkyOXRiVzl1Y3k1dmNtY3ZiR2xqWlc1elpYTXZjSFZpYkdsalpHOXRZV2x1THlJS0lDQWdJQ0FnSUNBdlBnb2dJQ0FnSUNBZ0lEeGtZenB3ZFdKc2FYTm9aWElLSUNBZ0lDQWdJQ0FnSUQ0S0lDQWdJQ0FnSUNBZ0lEeGpZenBCWjJWdWRBb2dJQ0FnSUNBZ0lDQWdJQ0FnSUhKa1pqcGhZbTkxZEQwaWFIUjBjRG92TDI5d1pXNWpiR2x3WVhKMExtOXlaeThpQ2lBZ0lDQWdJQ0FnSUNBZ0lENEtJQ0FnSUNBZ0lDQWdJQ0FnUEdSak9uUnBkR3hsQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdQazl3Wlc1amJHbHdZWEowUEM5a1l6cDBhWFJzWlFvZ0lDQWdJQ0FnSUNBZ0lDQStDaUFnSUNBZ0lDQWdJQ0E4TDJOak9rRm5aVzUwQ2lBZ0lDQWdJQ0FnSUNBK0NpQWdJQ0FnSUNBZ1BDOWtZenB3ZFdKc2FYTm9aWElLSUNBZ0lDQWdJQ0ErQ2lBZ0lDQWdJQ0FnUEdSak9uUnBkR3hsQ2lBZ0lDQWdJQ0FnSUNBK1pYSnliM0lnWW5WMGRHOXVQQzlrWXpwMGFYUnNaUW9nSUNBZ0lDQWdJRDRLSUNBZ0lDQWdJQ0E4WkdNNlpHRjBaUW9nSUNBZ0lDQWdJQ0FnUGpJd01URXRNREl0TWpSVU1UYzZORFU2TkRVOEwyUmpPbVJoZEdVS0lDQWdJQ0FnSUNBK0NpQWdJQ0FnSUNBZ1BHUmpPbVJsYzJOeWFYQjBhVzl1Q2lBZ0lDQWdJQ0FnTHo0S0lDQWdJQ0FnSUNBOFpHTTZjMjkxY21ObENpQWdJQ0FnSUNBZ0lDQSthSFIwY0hNNkx5OXZjR1Z1WTJ4cGNHRnlkQzV2Y21jdlpHVjBZV2xzTHpFeU1qUXlOUzlsY25KdmNpMWlkWFIwYjI0dFlua3RjbWxqWVhKa2IyMWhhV0U4TDJSak9uTnZkWEpqWlFvZ0lDQWdJQ0FnSUQ0S0lDQWdJQ0FnSUNBOFpHTTZZM0psWVhSdmNnb2dJQ0FnSUNBZ0lDQWdQZ29nSUNBZ0lDQWdJQ0FnUEdOak9rRm5aVzUwQ2lBZ0lDQWdJQ0FnSUNBZ0lENEtJQ0FnSUNBZ0lDQWdJQ0FnUEdSak9uUnBkR3hsQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdQbkpwWTJGeVpHOXRZV2xoUEM5a1l6cDBhWFJzWlFvZ0lDQWdJQ0FnSUNBZ0lDQStDaUFnSUNBZ0lDQWdJQ0E4TDJOak9rRm5aVzUwQ2lBZ0lDQWdJQ0FnSUNBK0NpQWdJQ0FnSUNBZ1BDOWtZenBqY21WaGRHOXlDaUFnSUNBZ0lDQWdQZ29nSUNBZ0lDQWdJRHhrWXpwemRXSnFaV04wQ2lBZ0lDQWdJQ0FnSUNBK0NpQWdJQ0FnSUNBZ0lDQThjbVJtT2tKaFp3b2dJQ0FnSUNBZ0lDQWdJQ0ErQ2lBZ0lDQWdJQ0FnSUNBZ0lEeHlaR1k2YkdrS0lDQWdJQ0FnSUNBZ0lDQWdJQ0ErWW5WMGRHOXVQQzl5WkdZNmJHa0tJQ0FnSUNBZ0lDQWdJQ0FnUGdvZ0lDQWdJQ0FnSUNBZ0lDQThjbVJtT214cENpQWdJQ0FnSUNBZ0lDQWdJQ0FnUG1OaGJtTmxiRHd2Y21SbU9teHBDaUFnSUNBZ0lDQWdJQ0FnSUQ0S0lDQWdJQ0FnSUNBZ0lDQWdQSEprWmpwc2FRb2dJQ0FnSUNBZ0lDQWdJQ0FnSUQ1amFYSmpiR1U4TDNKa1pqcHNhUW9nSUNBZ0lDQWdJQ0FnSUNBK0NpQWdJQ0FnSUNBZ0lDQWdJRHh5WkdZNmJHa0tJQ0FnSUNBZ0lDQWdJQ0FnSUNBK1pHVnNaWFJsUEM5eVpHWTZiR2tLSUNBZ0lDQWdJQ0FnSUNBZ1Bnb2dJQ0FnSUNBZ0lDQWdJQ0E4Y21SbU9teHBDaUFnSUNBZ0lDQWdJQ0FnSUNBZ1BuSmxaRHd2Y21SbU9teHBDaUFnSUNBZ0lDQWdJQ0FnSUQ0S0lDQWdJQ0FnSUNBZ0lDQWdQSEprWmpwc2FRb2dJQ0FnSUNBZ0lDQWdJQ0FnSUQ1eWIzVnVaRHd2Y21SbU9teHBDaUFnSUNBZ0lDQWdJQ0FnSUQ0S0lDQWdJQ0FnSUNBZ0lEd3ZjbVJtT2tKaFp3b2dJQ0FnSUNBZ0lDQWdQZ29nSUNBZ0lDQWdJRHd2WkdNNmMzVmlhbVZqZEFvZ0lDQWdJQ0FnSUQ0S0lDQWdJQ0FnUEM5all6cFhiM0pyQ2lBZ0lDQWdJRDRLSUNBZ0lDQWdQR05qT2t4cFkyVnVjMlVLSUNBZ0lDQWdJQ0FnSUhKa1pqcGhZbTkxZEQwaWFIUjBjRG92TDJOeVpXRjBhWFpsWTI5dGJXOXVjeTV2Y21jdmJHbGpaVzV6WlhNdmNIVmliR2xqWkc5dFlXbHVMeUlLSUNBZ0lDQWdJQ0ErQ2lBZ0lDQWdJQ0FnUEdOak9uQmxjbTFwZEhNS0lDQWdJQ0FnSUNBZ0lDQWdjbVJtT25KbGMyOTFjbU5sUFNKb2RIUndPaTh2WTNKbFlYUnBkbVZqYjIxdGIyNXpMbTl5Wnk5dWN5TlNaWEJ5YjJSMVkzUnBiMjRpQ2lBZ0lDQWdJQ0FnTHo0S0lDQWdJQ0FnSUNBOFkyTTZjR1Z5YldsMGN3b2dJQ0FnSUNBZ0lDQWdJQ0J5WkdZNmNtVnpiM1Z5WTJVOUltaDBkSEE2THk5amNtVmhkR2wyWldOdmJXMXZibk11YjNKbkwyNXpJMFJwYzNSeWFXSjFkR2x2YmlJS0lDQWdJQ0FnSUNBdlBnb2dJQ0FnSUNBZ0lEeGpZenB3WlhKdGFYUnpDaUFnSUNBZ0lDQWdJQ0FnSUhKa1pqcHlaWE52ZFhKalpUMGlhSFIwY0RvdkwyTnlaV0YwYVhabFkyOXRiVzl1Y3k1dmNtY3Zibk1qUkdWeWFYWmhkR2wyWlZkdmNtdHpJZ29nSUNBZ0lDQWdJQzgrQ2lBZ0lDQWdJRHd2WTJNNlRHbGpaVzV6WlFvZ0lDQWdJQ0ErQ2lBZ0lDQThMM0prWmpwU1JFWUtJQ0FnSUQ0S0lDQThMMjFsZEdGa1lYUmhDaUFnUGdvOEwzTjJad28rQ2c9PVwiXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi4vbm9kZV9tb2R1bGVzL2Jhc2U2NC1sb2FkZXIhLi9tZWRpYS9lcnJvci1idXR0b24uc3ZnXG4vLyBtb2R1bGUgaWQgPSA5MlxuLy8gbW9kdWxlIGNodW5rcyA9IDAiXSwibWFwcGluZ3MiOiI7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBOzs7O0FDN0RBOzs7Ozs7Ozs7QUNDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBOzs7Ozs7Ozs7Ozs7Ozs7QUFrQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFUQTtBQVdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBS0E7QUFDQTtBQUNBO0FBUEE7QUFBQTtBQUFBO0FBQ0E7QUFXQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFGQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFaQTtBQWNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFYQTtBQWFBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFwQkE7QUFzQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFQQTtBQVNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFoQkE7QUFrQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU1BO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFmQTtBQWlCQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQW5CQTtBQXFCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBUEE7QUE5RkE7QUE2R0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUdBO0FBQ0E7QUFDQTtBQUZBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQXRXQTtBQXdXQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBOzs7Ozs7Ozs7Ozs7QUM5dkJBO0FBQ0E7Ozs7Ozs7Ozs7O0FBV0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBb0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQTVOQTtBQThOQTs7Ozs7Ozs7Ozs7QUM5TkE7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7O0FBV0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFUQTtBQVdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQTdFQTtBQStFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFYQTtBQWFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVJBO0FBVUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBL1FBO0FBaVJBOzs7Ozs7Ozs7QUNuUkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQW5CQTs7Ozs7Ozs7Ozs7QUNDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQTlHQTtBQWdIQTtBQUNBO0FBQ0E7Ozs7Ozs7OztBQ2xJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQURBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFoVUE7QUFDQTtBQWtVQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUFJQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBREE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFEQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBTEE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQU1BO0FBUEE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBT0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQXJMQTtBQXVMQTs7Ozs7Ozs7OztBQzNmQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQTFDQTtBQUNBO0FBNENBO0FBQ0E7QUFDQTs7Ozs7Ozs7QUMvQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBREE7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTkE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVJBO0FBVUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBQUE7QUFBQTtBQUNBO0FBREE7QUFLQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBUEE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTEE7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7O0FBZ0JBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7O0FBZUE7QUFDQTs7Ozs7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBTEE7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7OztBQWFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUE1U0E7QUFDQTtBQThTQTtBQUNBO0FBQ0E7QUFEQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFiQTtBQUpBOzs7Ozs7O0FDalRBOzs7Ozs7O0FDQUE7QUFDQTs7Ozs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFmQTtBQUNBO0FBaUJBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQXZCQTtBQUNBO0FBeUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7O0FDMUhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUxBO0FBUUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTs7Ozs7O0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUdBO0FBQ0E7QUFDQTtBQUVBOzs7Ozs7Ozs7OztBQVdBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBQ0E7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFDQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBUkE7QUFVQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUVBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBUkE7QUFVQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBQ0E7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUFBO0FBQUE7QUFDQTtBQUdBO0FBQUE7QUFBQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFDQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFNQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBREE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7OztBQVNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7OztBQVNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFDQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQUNBO0FBTUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFDQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBQ0E7QUFNQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQUNBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBQ0E7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7O0FBUUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFGQTtBQUFBO0FBSUE7QUFKQTtBQUtBO0FBTEE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQWFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQURBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBeEJBO0FBMkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTEE7QUFZQTtBQUNBO0FBQ0E7Ozs7OztBQU1BO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFXQTtBQVhBO0FBWUE7QUFaQTtBQUFBO0FBQUE7QUFDQTtBQWdCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQWZBO0FBa0JBO0FBQ0E7QUFFQTtBQURBO0FBTUE7QUFEQTtBQU1BO0FBREE7QUFNQTtBQURBO0FBSUE7QUFDQTtBQURBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7QUFTQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBREE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFIQTtBQUFBO0FBS0E7QUFMQTtBQU1BO0FBTkE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQWNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQURBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFDQTtBQU1BO0FBQ0E7QUFDQTtBQUNBOzs7O0FBSUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFTQTtBQVRBO0FBQUE7QUFXQTtBQVhBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFnQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFoQkE7QUFtQkE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFRQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBUUE7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQVFBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTEE7QUFPQTtBQUNBO0FBQ0E7Ozs7QUFJQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFLQTtBQUxBO0FBQ0E7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFmQTtBQWtCQTtBQUNBO0FBQ0E7QUFEQTtBQUtBO0FBREE7QUFLQTtBQUNBO0FBREE7QUFLQTtBQUNBO0FBREE7QUFLQTtBQUNBO0FBQ0E7Ozs7QUFJQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBUUE7QUFSQTtBQUNBO0FBVUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUpBO0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU1BO0FBQ0E7QUFDQTs7Ozs7QUFLQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBV0E7QUFYQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFZQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFyRUE7QUF3RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTs7Ozs7Ozs7QUFRQTtBQUNBO0FBQUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7QUNwcERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBUkE7QUFVQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVBBO0FBQ0E7QUFVQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFNQTtBQUNBO0FBQ0E7Ozs7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7QUFTQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFDQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFMQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTEE7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQU5BO0FBQ0E7QUFVQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUE3UUE7Ozs7Ozs7Ozs7OztBQ0FBOzs7Ozs7O0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBSUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBTUE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFWQTtBQUFBO0FBQ0E7QUFZQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQTBCQTtBQUNBO0FBMEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBUUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBR0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUxBO0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFJQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFJQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBSUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQWNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQVFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUlBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFJQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQVFBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFJQTtBQUFBO0FBQUE7QUFBQTtBQUlBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFJQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBSUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFBQTtBQUFBO0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBMWZBO0FBQ0E7QUE4ZkE7Ozs7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUEvQkE7QUFDQTtBQW9DQTs7Ozs7Ozs7QUFRQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUdBO0FBQ0E7QUFGQTtBQUZBO0FBQUE7QUFRQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFPQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBSUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBSUE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBUUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVhBO0FBYUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQWpyQkE7QUFtckJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7O0FDNTVDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBOzs7O0FBSUE7QUFDQTs7O0FBR0E7QUFKQTtBQU1BO0FBQ0E7QUFDQTs7Ozs7Ozs7OztBQy9FQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQU1BO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBOzs7OztBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7QUFhQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7QUFnQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQTNQQTtBQUNBO0FBNlBBOzs7Ozs7QUM3YUE7Ozs7Ozs7OztBQ0VBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUE1QkE7Ozs7Ozs7OztBQ0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQWhGQTtBQUNBO0FBa0ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBR0E7QUFFQTtBQUtBO0FBRUE7QUFHQTtBQUVBO0FBR0E7QUFDQTtBQUNBO0FBR0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFHQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBeEhBOzs7Ozs7Ozs7OztBQ2pGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVhBO0FBYUE7QUFDQTtBQUVBO0FBQ0E7QUFEQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUExQ0E7QUFDQTtBQTRDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTEE7QUFDQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQS9DQTtBQUNBO0FBaURBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFMQTtBQU9BO0FBQ0E7QUFDQTs7Ozs7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7OztBQWVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBaEZBO0FBQ0E7QUFrRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFsQkE7QUFvQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTs7Ozs7Ozs7QUNyY0E7QUFDQTtBQUVBOzs7Ozs7OztBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUxBO0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7O0FDOUZBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUF5Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBSkE7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTs7Ozs7Ozs7Ozs7O0FBWUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQTdCQTtBQWdDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBR0E7QUFDQTtBQUtBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFEQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFUQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBVUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFOQTtBQURBO0FBMUxBO0FBQ0E7QUFxTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7QUN6UEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBNkVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBeUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTEE7QUFPQTtBQXhIQTtBQUNBO0FBNEhBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTs7O0FBR0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUxBO0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFyQkE7QUFoSUE7QUF3SkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQURBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTEE7QUFSQTtBQUNBO0FBZ0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVJBO0FBQ0E7QUFVQTs7Ozs7Ozs7OztBQ3hZQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUEyQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUFBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFMQTtBQU1BO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQXJTQTtBQUNBO0FBd1NBO0FBQ0E7QUFDQTs7OztBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7QUFjQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTs7Ozs7Ozs7OztBQVVBOzs7O0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBWEE7QUExRkE7Ozs7Ozs7Ozs7QUN0VUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBd0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7QUFEQTtBQUdBO0FBQ0E7QUFEQTtBQUpBO0FBUUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBNUJBO0FBbEdBOzs7Ozs7OztBQ3hDQTtBQUNBOzs7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFqRkE7QUFDQTtBQXFGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQU5BO0FBUUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVpBO0FBY0E7QUFoREE7QUFIQTtBQXNEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFWQTtBQUhBO0FBZ0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFWQTtBQUhBO0FBakJBO0FBSEE7QUFzQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQWZBO0FBSEE7QUFxQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFmQTtBQUhBO0FBdEJBO0FBSEE7QUFnREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFOQTtBQVFBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQWpMQTtBQTdCQTs7Ozs7Ozs7OztBQ2pHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVRBO0FBV0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQW9CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFQQTtBQUhBO0FBYUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFMQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUxBO0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQWhCQTtBQUxBO0FBNEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFQQTtBQVNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU1BOzs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFrQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTEE7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQU5BO0FBbElBO0FBOVVBO0FBQ0E7QUE2ZEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFEQTtBQXRDQTs7Ozs7Ozs7OztBQ2hlQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFkQTs7Ozs7Ozs7OztBQ0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQU5BO0FBREE7QUEvRUE7QUFDQTtBQTBGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7OztBQ2pLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBUEE7QUFTQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUE5QkE7Ozs7Ozs7Ozs7QUNWQTs7Ozs7OztBQU9BO0FBQ0E7OztBQUdBO0FBQ0E7Ozs7Ozs7OztBQVNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVhBO0FBREE7QUFlQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQWxGQTtBQUNBO0FBb0ZBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7Ozs7Ozs7O0FDaEdBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBakRBO0FBQ0E7QUFtREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUxBO0FBQ0E7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQTFCQTtBQTZCQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUErQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFOQTtBQXRHQTtBQUNBO0FBK0dBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTEE7QUFDQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFDQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFUQTtBQVdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVRBO0FBV0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBQ0E7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBakVBOzs7Ozs7Ozs7O0FDMU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFDQTtBQUdBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQXBCQTtBQUNBO0FBc0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBekNBOzs7Ozs7Ozs7Ozs7QUNsQkE7Ozs7Ozs7Ozs7O0FBYUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBbkJBO0FBREE7QUFDQTtBQXVCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQXRGQTtBQXlGQTtBQTVGQTtBQUNBO0FBOEZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFTQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBb0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFLQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBS0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFTQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFEQTtBQUdBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBS0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBTkE7QUFBQTtBQUNBO0FBQ0E7QUFRQTtBQUNBO0FBWEE7QUFBQTtBQUNBO0FBQ0E7QUFhQTtBQUNBO0FBaEJBO0FBQUE7QUFDQTtBQUNBO0FBa0JBO0FBQ0E7QUFyQkE7QUFBQTtBQUNBO0FBd0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBQ0E7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQXpFQTtBQUNBO0FBMkVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBSEE7QUFBQTtBQUNBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFNQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFkQTtBQUFBO0FBQ0E7QUFDQTtBQWdCQTtBQUNBO0FBbkJBO0FBQUE7QUFDQTtBQXNCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQTFFQTtBQUNBO0FBNEVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTEE7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBUEE7QUFTQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFkQTtBQWdCQTtBQUNBO0FBQ0E7QUFDQTtBQW5CQTtBQXFCQTtBQUNBO0FBQ0E7QUF2QkE7QUF5QkE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQTlCQTtBQWdDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQXpDQTtBQTJDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBL0NBO0FBaURBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBMUdBO0FBNEdBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBUkE7QUFVQTtBQUNBO0FBekhBO0FBMkhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUEvSEE7QUFpSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7Ozs7Ozs7OztBQ25wQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFpQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU1BO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBQ0E7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQXZCQTs7Ozs7Ozs7Ozs7QUMzQkE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQTBCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQU5BO0FBQ0E7QUFRQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBbElBO0FBb0lBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7O0FDM0xBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFaQTtBQWNBO0FBQ0E7QUFsQkE7QUFDQTtBQTBCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQWZBOzs7Ozs7Ozs7QUN6Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFSQTtBQVVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBVEE7QUFXQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBckNBOzs7Ozs7Ozs7QUNKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFqQ0E7Ozs7Ozs7QUNYQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBRkE7QUFDQTtBQUlBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUNBO0FBSUE7QUFDQTtBQU9BO0FBQ0E7QUFDQTtBQURBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQURBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQURBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBbFFBOzs7Ozs7OztBQ1RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBb0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBS0E7QUFYQTtBQWFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUtBO0FBWkE7QUFjQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBS0E7QUFYQTtBQWFBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQURBO0FBR0E7QUFDQTtBQURBO0FBR0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUZBO0FBTUE7QUFQQTtBQVNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUZBO0FBakNBO0FBQ0E7QUFrREE7QUFDQTtBQUNBO0FBSUE7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQURBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBVUE7QUFDQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7Ozs7QUFlQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBTUE7QUF6Q0E7QUF0QkE7QUFEQTtBQXZHQTtBQUNBO0FBNEtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7QUNwYUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQURBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBZ0JBO0FBQ0E7QUFsQkE7QUEvQ0E7QUFDQTtBQXFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUF4REE7Ozs7Ozs7Ozs7QUNsRkE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTs7Ozs7Ozs7O0FDaEJBOzs7Ozs7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFrQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUxBO0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFQQTtBQUNBO0FBU0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFuQkE7QUFxQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBVkE7QUFZQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVpBO0FBY0E7QUFDQTtBQTNMQTs7Ozs7Ozs7QUNaQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFUQTtBQVdBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVlBO0FBakJBO0FBbUJBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUpBO0FBTUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUZBO0FBekRBO0FBQ0E7QUE4REE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFvQkE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFuQ0E7QUFxQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7QUN0SEE7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUF6QkE7QUFDQTtBQTJCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7QUNqRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQXhCQTtBQUNBO0FBNkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7Ozs7Ozs7O0FDMVBBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFGQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBRkE7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFJQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQU5BO0FBUUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVJBO0FBREE7QUFkQTs7Ozs7Ozs7OztBQ25JQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBN0JBO0FBQ0E7QUFnQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUNyREE7Ozs7Ozs7QUNBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVJBO0FBQ0E7QUFVQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBNUdBOzs7Ozs7OztBQ0ZBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQXZDQTtBQTBDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUF6RkE7QUFDQTtBQTJGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQWpJQTtBQUNBO0FBbUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUZBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUF6RkE7QUFDQTtBQTJGQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FDL1RBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7OztBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQUNBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUtBO0FBQ0E7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTEE7QUFDQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBNUlBOzs7Ozs7Ozs7O0FDTEE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUZBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUE3SEE7Ozs7Ozs7Ozs7QUM3RkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQS9CQTtBQWlDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBSUE7QUF4R0E7QUFDQTtBQTJHQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7Ozs7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFOQTtBQUNBO0FBUUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OztBQU9BO0FBQ0E7QUFBQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUF2UkE7QUFDQTtBQXlSQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQUNBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7OztBQWVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7QUFRQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBdkNBO0FBQ0E7QUF5Q0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQWhDQTtBQWtDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUdBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBNkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBOzs7Ozs7O0FBT0E7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBeGZBO0FBQ0E7QUE0Z0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7OztBQ3I3QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQUtBO0FBQ0E7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQUtBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQURBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUF6RkE7QUFDQTtBQTJGQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7O0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQURBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQWhCQTtBQWtCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQWZBO0FBaUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFWQTtBQVlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBVEE7QUFqREE7QUE3SUE7QUFDQTtBQTRNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBWEE7QUFhQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFLQTtBQS9FQTs7Ozs7Ozs7QUMzVEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFUQTtBQVdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVZBO0FBdEJBO0FBbUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBVEE7QUEvQ0E7QUFDQTtBQTJEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVJBO0FBREE7QUFDQTtBQWNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBNUJBO0FBOEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTEE7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTEE7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTEE7QUFDQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBN0hBO0FBQ0E7QUErSEE7QUFDQTtBQUNBO0FBRkE7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFUQTtBQURBO0FBYUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFaQTtBQWNBO0FBQ0E7QUFDQTtBQUNBO0FBbERBOzs7Ozs7Ozs7O0FDcE5BO0FBQ0E7QUFDQTtBQUVBOzs7O0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OztBQ3ZKQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBeEJBO0FBREE7QUFDQTtBQTZCQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFGQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFPQTtBQUNBO0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBM09BO0FBQ0E7QUFnUEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBUEE7QUFTQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVRBO0FBRkE7QUFjQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFaQTs7Ozs7Ozs7QUNsVUE7Ozs7QUFJQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7OztBQVFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBRkE7QUFJQTs7OztBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQXRPQTs7Ozs7Ozs7QUNYQTtBQUNBO0FBRUE7Ozs7Ozs7Ozs7OztBQVdBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVRBO0FBQ0E7QUFZQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUdBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQXVCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVJBO0FBQ0E7QUFVQTtBQVdBOzs7Ozs7Ozs7O0FDL01BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBQ0E7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7QUFWQTtBQVlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQVJBO0FBYkE7Ozs7Ozs7Ozs7QUNiQTs7Ozs7Ozs7O0FBU0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFGQTtBQUFBO0FBSUE7QUFDQTtBQUxBO0FBQUE7QUFBQTtBQVNBO0FBQ0E7QUFDQTtBQVhBO0FBQUE7QUFBQTtBQWVBO0FBQ0E7QUFDQTtBQUNBO0FBbEJBO0FBQUE7QUFxQkE7QUFDQTtBQUNBO0FBdkJBO0FBQUE7QUFBQTtBQUFBO0FBMEJBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQXRDQTtBQXdDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQXBEQTtBQXNEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUEzREE7QUE2REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFPQTtBQUNBO0FBQ0E7QUFUQTtBQUFBO0FBV0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQTNCQTtBQTZCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFsQ0E7QUFBQTtBQXNDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBekxBO0FBQUE7QUE0TEE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVFBO0FBQ0E7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7Ozs7OztBQ3JRQTtBQUNBO0FBQ0E7Ozs7Ozs7QUNGQTtBQUNBOzs7Ozs7Ozs7OztBQ0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBMUNBOzs7Ozs7Ozs7O0FDRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRkE7QUFJQTs7Ozs7Ozs7QUMvRUE7QUFDQTtBQUVBOzs7Ozs7QUFLQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7QUFDQTs7Ozs7O0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBQ0E7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUE5T0E7QUFDQTtBQWlQQTtBQUNBO0FBQ0E7QUFGQTtBQUlBOzs7Ozs7OztBQzlQQTtBQUNBO0FBRUE7Ozs7OztBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUFJQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUhBO0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUFJQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQUNBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUEzTUE7QUFDQTtBQThNQTtBQUNBO0FBQ0E7QUFGQTtBQUlBOzs7Ozs7O0FDM05BOzs7Ozs7O0FDQUE7QUFDQTtBQUVBOzs7Ozs7QUFLQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FBSUE7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVJBO0FBVUE7QUFySEE7QUFDQTtBQXVIQTtBQUNBO0FBQ0E7QUFGQTtBQUlBOzs7Ozs7OztBQ3BJQTtBQUNBO0FBRUE7QUFDQTtBQUNBOzs7OztBQUtBO0FBQ0E7QUFDQTs7Ozs7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFMQTtBQUNBO0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFOQTtBQUNBO0FBUUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFoQkE7QUFrQkE7QUF6RUE7QUFDQTtBQTJFQTtBQUNBO0FBQ0E7QUFGQTtBQUlBOzs7Ozs7O0FDMUZBOzs7Ozs7O0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBRkE7QUFMQTtBQUNBO0FBVUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBQ0E7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQWpGQTtBQUNBO0FBb0ZBO0FBQ0E7QUFDQTtBQUZBOzs7Ozs7OztBQ3ZGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQTNDQTtBQTZDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUEvR0E7QUFDQTtBQWlIQTs7Ozs7OztBQU9BO0FBQ0E7Ozs7Ozs7Ozs7OztBQWVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7O0FDN0pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQUlBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQURBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBUEE7QUFDQTtBQVNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFQQTtBQVNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQU5BO0FBUUE7QUFWQTtBQVlBO0FBQ0E7QUFDQTtBQXBCQTtBQVZBO0FBcE1BO0FBQ0E7QUF1T0E7QUFDQTtBQUNBOzs7Ozs7O0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBVkE7QUFEQTtBQWNBOzs7Ozs7Ozs7O0FDNVNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUE5Q0E7Ozs7Ozs7Ozs7QUNBQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUF4Q0E7QUFDQTtBQTBDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7QUNsTUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQWpIQTs7Ozs7Ozs7QUNOQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBM0JBO0FBNkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU1BO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFWQTtBQVlBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVJBO0FBQ0E7QUFVQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBOzs7O0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBQ0E7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBQ0E7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFDQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBOzs7O0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFMQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFyVEE7QUFDQTtBQXdUQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFMQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQU1BO0FBckNBO0FBckJBO0FBbEJBO0FBZkE7QUFDQTtBQW1HQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQURBO0FBRkE7QUFEQTtBQUNBO0FBU0E7Ozs7OztBQU1BO0FBQ0E7QUFDQTs7Ozs7Ozs7QUNwaEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBUEE7QUFDQTtBQVNBO0FBQ0E7QUFHQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBQ0E7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFMQTtBQUNBO0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBQ0E7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBUEE7QUFDQTtBQVNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTEE7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFMQTtBQURBO0FBU0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFqQkE7QUFDQTtBQW1CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQUNBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQURBO0FBR0E7QUFDQTtBQUNBO0FBRkE7QUFMQTtBQUNBO0FBVUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQURBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUF6akJBO0FBQ0E7QUEyakJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFMQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUxBO0FBUkE7QUFDQTtBQWtCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7OztBQ3RuQkE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBdENBO0FBQ0E7QUF3Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQU5BO0FBUUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFOQTtBQVFBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFHQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUZBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFGQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQTFTQTtBQUNBO0FBNFNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFZQTtBQUNBO0FBQ0E7QUFqQkE7QUFEQTtBQXFCQTs7Ozs7Ozs7QUNuVkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBS0E7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBS0E7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFQQTtBQUNBO0FBU0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVBBO0FBVUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVBBO0FBU0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVBBO0FBU0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBUUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQXphQTtBQUNBO0FBMmFBOzs7Ozs7OztBQ2piQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFUQTtBQVdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBL0tBOzs7Ozs7Ozs7O0FDREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQU5BO0FBUUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQU5BO0FBUUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQXRIQTs7Ozs7Ozs7QUNGQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQUtBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBMUJBO0FBNEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFQQTtBQTdCQTtBQWxGQTs7Ozs7Ozs7QUNOQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQURBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFDQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUdBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFMQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQU5BO0FBUUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVBBO0FBU0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBUkE7QUFVQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFSQTtBQVVBO0FBQ0E7QUFDQTtBQUNBO0FBaEJBO0FBa0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBVEE7QUFXQTtBQUNBO0FBQ0E7QUFDQTtBQWpCQTtBQW1CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQXJCQTtBQUpBO0FBaUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUZBO0FBakJBO0FBSkE7QUEyQkE7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQXZJQTtBQXRkQTtBQUNBO0FBb21CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBbkNBO0FBQ0E7QUFzQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBYkE7QUFmQTtBQStCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFmQTtBQXpCQTtBQTJDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBRUE7QUFDQTtBQUxBO0FBaEJBO0FBd0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVZBO0FBWUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBQ0E7QUFJQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBWEE7QUE1Q0E7QUEwREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUVBO0FBQ0E7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQTNEQTtBQXRDQTtBQTdKQTtBQWtRQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVZBO0FBQ0E7QUFZQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQTdCQTtBQUNBO0FBK0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQURBOzs7Ozs7O0FDcDlCQTs7Ozs7Ozs7O0FDQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQUE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQTdCQTtBQURBO0FBN0JBOzs7Ozs7OztBQ0pBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU1BO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQXREQTtBQUNBO0FBd0RBO0FBQ0E7QUFDQTs7Ozs7Ozs7OztBQzdEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7OztBQVNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBOzs7Ozs7OztBQVFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFjQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQUtBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUtBO0FBUUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTs7Ozs7Ozs7O0FBU0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUxBO0FBQ0E7QUFRQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQURBO0FBQ0E7QUEvTUE7Ozs7Ozs7O0FDSkE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBaERBO0FBa0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUN2R0E7OztBIiwic291cmNlUm9vdCI6IiJ9