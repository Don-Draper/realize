/*! Fiera.js Copyright 2016, www.homeTLT.ru (Denis Ponomarev <ponomarevtlt@gmail.com>) */
var fiera =
/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, {
/******/ 				configurable: false,
/******/ 				enumerable: true,
/******/ 				get: getter
/******/ 			});
/******/ 		}
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = 11);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ (function(module, exports) {

module.exports = fabric;

/***/ }),
/* 1 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

var utils = __webpack_require__(3);
utils.object = __webpack_require__(2);
utils.compile = __webpack_require__(5);

function capitalize(string, firstLetterOnly) {
  return string.charAt(0).toUpperCase() + (firstLetterOnly ? string.slice(1) : string.slice(1).toLowerCase());
}

function toDashed(str) {
  return str.replace(/([a-z])([A-Z])/g, '$1-$2').toLowerCase();
}

var Toolbar = function Toolbar(PARENT, el, options, menu) {
  this.initialize(PARENT, el, options, menu);
};

Toolbar._getKeyString = function (config) {
  var string = "";

  if (config.ctrlKey) string += "Ctrl + ";
  if (config.altKey) string += "Alt + ";
  if (config.shiftKey) string += "Shift + ";

  var _code = config.key;
  if (_code) {
    string += config.key;
  }
  return string;
};

Toolbar.makeActions = function (actions, PARENT) {
  var result = {};
  for (var i in actions) {
    actions[i].id = i;
    var _action = this.makeAction(actions[i], PARENT);
    if (_action) {
      result[i] = _action;
    }
  }
  return result;
};

Toolbar.makeAction = function (_ORIGINAL, parent) {

  if (_ORIGINAL.constructor === Function) {
    _ORIGINAL = _ORIGINAL.call(parent);
  }

  var target;

  if (_ORIGINAL.target && _ORIGINAL.target.constructor === Function) {
    target = _ORIGINAL.target.call(parent);
  } else {
    target = _ORIGINAL.target || parent;
  }

  var ___target = _ORIGINAL.target;
  var ___parent = _ORIGINAL.parent;
  delete _ORIGINAL.parent;
  delete _ORIGINAL.target;
  var RES = utils.object.cloneDeep(_ORIGINAL);
  _ORIGINAL.parent = ___parent;
  _ORIGINAL.target = ___target;

  RES.parent = ___parent;
  RES.target = target;
  RES.id = toDashed(_ORIGINAL.id);

  function createGetter(property, useParent) {
    if (property.constructor === Function) {
      return property;
    }
    if (property.constructor === String) {
      var negative = false;
      if (property[0] === "!") {
        property = property.substr(1);
        negative = true;
      }
      if (useParent) {
        return function () {
          return this && !!this[property] ^ negative;
        };
      } else {
        return function () {
          return this && !!this[property] ^ negative;
        };
      }
    }
    return null;
  }

  /*var _insert = _ORIGINAL.insert;
  if (!_insert || _insert.constructor == String) {
     if(_ORIGINAL.parent){
      var insertproperty = fabric.util.string.capitalize(fabric.util.string.camelize(_ORIGINAL.parent.id))
    }else{
      var insertproperty = _insert || "insert" + fabric.util.string.capitalize(id,true);
    }
     if(target[insertproperty] !== undefined){
      _insert = target[insertproperty]// createGetter(insertproperty,true)()
    }else{
      _insert = true;
    }
  }
   if(!_insert)return;*/

  if (!RES.type) {
    if (RES.menu) {
      RES.type = "menu";
    } else {
      RES.type = "button";
    }
  }
  if (!RES.action) {
    if (RES.type === "button") {
      RES.action = _ORIGINAL.id;
    }
  }

  if (RES.action) {
    if (RES.action.constructor === String) {
      RES.action = target[RES.action];
    }
    //RES = RES.action.bind(target);
    //RES.action = RES.action.bind(target);
    //_.extend(RES, _act);
    //arguments for action function
    if (_ORIGINAL.args) {
      RES._action = RES.action.bind(target, _ORIGINAL.args);
    } else {
      RES._action = RES.action.bind(target);
    }
    RES.action = function () {
      if (RES.disabled) return;
      RES._action.apply(this, arguments);
    };
  }

  if (_ORIGINAL.menu && _ORIGINAL.menu.constructor === Function) {
    RES.menu = _ORIGINAL.menu.bind(target);
  }
  if (_ORIGINAL.active) {
    RES.active = createGetter(_ORIGINAL.active).bind(target);
  }
  if (_ORIGINAL.visible) {
    RES.visible = createGetter(_ORIGINAL.visible).bind(target);
  }
  if (_ORIGINAL.enabled) {
    RES.enabled = createGetter(_ORIGINAL.enabled).bind(target);
  }
  if (!_ORIGINAL.value) {
    switch (_ORIGINAL.type) {
      case "color":
      case "text":
      case "number":
      case "range":
      case "label":
      case "select":
      case "checkbox":
        _ORIGINAL.value = _ORIGINAL.id;
      // console.log(id, _ORIGINAL);
    }
  }
  if (_ORIGINAL.value) {
    var _set, _get, _options;
    if (_ORIGINAL.value.constructor === String) {

      var setFunctionName = "set" + capitalize(_ORIGINAL.value, true),
          getFunctionName = "get" + capitalize(_ORIGINAL.value, true),
          minName = "min" + capitalize(_ORIGINAL.value, true),
          maxName = "max" + capitalize(_ORIGINAL.value, true),
          setFoo = function setFoo(val) {
        target[setFunctionName](val);
        // todo self.setFunctionCallback(target);
      },
          getFoo = target[getFunctionName],
          minFoo = target[minName],
          maxFoo = target[maxName];

      _set = setFoo || (_ORIGINAL.args ? function (val, args) {
        this[_ORIGINAL.value][args] = val;
      } : function (val) {
        this[_ORIGINAL.value] = val;
      });

      _get = getFoo || (_ORIGINAL.args ? function (args) {
        return this[_ORIGINAL.value][args];
      } : function () {
        return this[_ORIGINAL.value];
      });

      RES.value = {
        min: minFoo,
        max: maxFoo
      };
    } else {
      _set = _ORIGINAL.value.set;
      _get = _ORIGINAL.value.get;
      _options = _ORIGINAL.value.options;
    }

    if (RES.value.min !== undefined && RES.value.min.constructor === String) {
      RES.value.min = target[RES.value.min];
    }
    if (RES.value.max !== undefined && RES.value.max.constructor === String) {
      RES.value.max = target[RES.value.max];
    }
    if (RES.value.step !== undefined && RES.value.step.constructor === String) {
      RES.value.step = target[RES.value.step];
    }
    var _min = RES.value.min,
        _max = RES.value.max,
        _step = RES.value.step;

    if (_set) {
      RES.value.set = _ORIGINAL.args ? _set.bind(target, _ORIGINAL.args) : _set.bind(target);
    }
    if (_get) {
      RES.value.get = _ORIGINAL.args ? _get.bind(target, _ORIGINAL.args) : _get.bind(target);
    }
    if (_min && _min.constructor === Function) {
      RES.value.min = _ORIGINAL.args ? _min.bind(target, _ORIGINAL.args) : _min.bind(target);
    }
    if (_max && _max.constructor === Function) {
      RES.value.max = _ORIGINAL.args ? _max.bind(target, _ORIGINAL.args) : _max.bind(target);
    }
    if (_step && _step.constructor === Function) {
      RES.value.step = _ORIGINAL.args ? _step.bind(target, _ORIGINAL.args) : _step.bind(target);
    }
    if (_options) {
      RES.value.options = _ORIGINAL.args ? _options.bind(target, _ORIGINAL.args) : _options.bind(target);
    }
  }

  if (_ORIGINAL.data) {
    RES.data = _ORIGINAL.data.call(target);
  }
  if (RES.menu) {
    if (_ORIGINAL.menu.constructor === Function) {
      RES.menu = _ORIGINAL.menu.call(target);
    }
    if (RES.type === "options") {
      for (var i in RES.menu) {
        RES.menu[i].parent = RES;
        RES.menu[i].type = "option";
        if (!RES.menu[i].title) {
          RES.menu[i].title = i;
        }
        if (!RES.menu[i].option) {
          RES.menu[i].option = i;
        }
      }
    }
    for (var i in RES.menu) {
      if (RES.menu[i].constructor === String) {
        RES.menu[i] = fabric.util.object.clone(RES.target.actions[RES.menu[i]]);
        RES.menu[i].parent = RES;
      }
      if (!RES.menu[i].id) {
        RES.menu[i].id = i;
      }
      RES.menu[i] = Toolbar.makeAction(RES.menu[i], target);
      if (!RES.menu[i]) {
        delete RES.menu[i];
      }
    }
  }

  if (_ORIGINAL.keyboard !== false && (_ORIGINAL.key || _ORIGINAL.shiftKey || _ORIGINAL.altKey || _ORIGINAL.ctrlKey || _ORIGINAL.metaKey)) {
    if (_ORIGINAL.keyCode && _ORIGINAL.keyCode.constructor === String) {
      RES.keyCode = _ORIGINAL.keyCode.toUpperCase().charCodeAt(0);
      RES.key = String.fromCharCode(RES.keyCode);
    }
    RES.keyboard = true;
  };

  return RES;
};

Toolbar.getButtons = function (actions) {
  var _buttons = [];
  for (var i in actions) {
    var action = actions[i];
    if (action.keyboard) {
      action.title += " (" + Toolbar._getKeyString(action) + ")";
      _buttons.push(action);
    }
    if (actions.menu) {
      _buttons = _buttons.concat(Toolbar.getButtons(actions.menu));
    }
  };

  return _buttons;
};
Toolbar.initKeys = function (actions) {

  var buttons = Toolbar.getButtons(actions);

  var self = this;
  $("body").on("keydown", function (e) {
    for (var i in buttons) {
      var _config = buttons[i];

      if (_config.enabled && !_config.enabled()) {
        continue;
      }
      if (_config.disabled || _config.disabled) {
        continue;
      }
      if (!_config.disabled && !_config.hidden && (_config.keyCode == e.keyCode || _config.key == e.key) && (_config.ctrlKey === undefined || _config.ctrlKey == e.ctrlKey) && (_config.altKey === undefined || _config.altKey == e.altKey) && (_config.shiftKey === undefined || _config.shiftKey == e.shiftKey) && (_config.metaKey === undefined || _config.metaKey == e.metaKey)) {

        e.preventDefault();
        e.stopPropagation();
        if (_config.option !== undefined) {
          _config.action.call(_config.target, _config.option, e);
        } else {
          _config.action.call(_config.target, e);
        }
      }
    }
  });

  //$(window).on("mousewheel", function (event) {
  //  for (var i in self.buttons) {
  //    var data = self.buttons[i];
  //    if (!data.mousewheel)continue;
  //    if (!data.ctrlKey || data.ctrlKey && event.ctrlKey) {
  //      if (event.deltaY > 0 && data.mousewheel == ">") {
  //        data.action.call(target, data.option || event, event)
  //      }
  //      if (event.deltaY < 0 && data.mousewheel == "<") {
  //        data.action.call(target, data.option || event, event)
  //      }
  //      event.preventDefault();
  //      event.stopPropagation();
  //      return false;
  //    }
  //  }
  //});
};

Toolbar.prototype = {

  // setFunctionCallback: function(){},
  tools: {

    "label": {
      scope: function scope(data, options) {
        return {
          getValue: data.value.get,
          valueCurrent: data.value.get()
        };
      },
      template: '<div class="object-menu-item object-menu-label" title="{title}">',
      render: function render($item, data, options, tool, val) {
        var scope = fabric.util.object.defaults(tool.scope.call(this, data, options), data);
        $item.html(data.template.format(data.value.get()));
        utils.compile.compileElement($item, scope);
      }
    },
    "number": {
      scope: function scope(data, options) {
        return {
          getInputValue: function getInputValue() {
            return parseFloat(data.$item.find("input").val());
          },
          getValue: data.value.get,
          setValue: data.value.set,
          minValue: data.value.min && data.value.min(),
          maxValue: data.value.max && data.value.max(),
          valueCurrent: data.value.get(),
          onchange: function onchange(e) {
            data.value.set(parseFloat($(e.target).val()));
          }
        };
      },
      template: '<div class="object-menu-item object-menu-number" title="{title}">' + '<input type="number" min="{minValue}" max="{maxValue}" value="{valueCurrent}" onchange="onchange(event)">',
      render: function render($item, data, options, tool, val) {
        $item.find("input").val(data.value.get());
      }
    },
    "range": {
      scope: function scope(data, options) {
        return {
          minValue: data.value.min ? typeof data.value.min == "function" ? data.value.min() : data.value.min : 0,
          maxValue: data.value.max ? typeof data.value.max == "function" ? data.value.max() : data.value.max : 1,
          valueStep: data.value.step ? typeof data.value.step == "function" ? data.value.step() : data.value.step : 0.1,
          valueCurrent: data.value.get(),
          onchange: function onchange(e) {
            data.value.set(parseFloat($(e.target).val()));
          }
        };
      },
      template: '<div class="object-menu-item object-menu-range" title="{title}">' + '<input type="range" step="{valueStep}" min="{minValue}" max="{maxValue}" value="{valueCurrent}" onchange="onchange(event)">',
      render: function render($item, data, options, tool, val) {
        $item.find("input").val(data.value.get());
      }
    },
    "checkbox": {
      scope: function scope(data, options) {
        return {
          onchange: function onchange(e) {
            data.value.set(e.target.checked);
          },
          valueCurrent: data.value.get()
        };
      },
      template: '<div class="object-menu-item object-menu-checkbox" title="{title}">' + '<input type="checkbox" onchange="onchange(event)" dp-checked="{valueCurrent}" id="checkbox-{id}">' + '<label for="checkbox-{id}"  class="btn button-{id} {className}">',
      render: function render($item, data, options, tool, val) {
        $item.find("input").val(val);
      }
    },
    "menu": {
      template: '<div class="object-menu-item object-menu-menu" title="{title}">' + '<label dp-if="title" for="button-{id}">{title}</label>' + '<button class="btn button-menu-trigger button-{id} {className}" id="button-{id}"/>' + '<div class="object-menu submenu" transclude/>',
      post: function post($item, data, options, transclude) {
        //$item.find(".button-menu-trigger").click(function () {
        //  $item.find(".object-menu").toggle();
        //})
        if (data.hovered) {
          $item.addClass("hovered");
          this.toggleByHover($item, transclude, null, data);
        }
        if (data.toggled) {
          $item.addClass("toggled");
          this.toggleByButton($item, transclude);
        };
        this.generateMenu(data.target, transclude, options, data.menu);
      }
    },
    "button": {
      scope: function scope(data, options) {
        return {
          buttonsTitle: options.buttons && options.buttons.title || false,
          buttonscClassName: options.buttons && options.buttons.className || ''
        };
      },
      template: '<div class="object-menu-item" title="{title}">' + '<button class="btn button-{id} {className} {buttonscClassName}"  onclick="!disabled && option ? action(option) : action()">' + '<img dp-if="icon" dp-src="icon">' + '<span dp-include="svg" dp-if="svg"></span>' + '<span dp-if="buttonsTitle" class="button-title">{title}</span>'
    }
  },
  initialize: function initialize(PARENT, el, options, menu) {
    this.buttons = [];
    //todo это не совсем хорошо. нельзя создать улбраы с разными конфигами кнопок
    // this.tools = utils.object.cloneDeep(this.tools);

    if (options) {
      if (options.button) {
        utils.object.extend(this.tools.button, options.button);
      }
    }
    if (!PARENT.generatedActions) {
      PARENT.makeActions(menu);
    }

    if (el.constructor === String) {
      el = $(document.getElementById(el));
    }
    if (el.length && Object.keys(PARENT.generatedActions).length) {
      this.generateMenu(PARENT, el, options, PARENT.generatedActions);
      this.onCreate();
      el.show();
    }
    Toolbar.initKeys(PARENT.generatedActions);
  },
  onCreate: function onCreate() {},
  destroy: function destroy(target) {
    for (var i = this.buttons.length; i--;) {
      var _config = this.buttons[i];
      if (target && _config.target != target) {
        continue;
      }
      this.buttons.splice(i, 1);
    }
    this.fire("destroy");
  },
  createInput: function createInput($item, data, type) {

    var target = data.target;
    var $input = $("<input>").attr("type", type).attr("min", data.value.min()).attr("max", data.value.max());

    $input.val(data.value.get());
    if (data.value.observe) {
      target.on(data.value.observe, function (val) {
        $input.val(data.value.get());
      });
    }
    $input.change(function (e) {
      data.value.set(parseFloat($input.val()));
    });
    $item.append($input);
  },
  initItem: function initItem($item, data) {

    if (data.active) {
      if (data.active.call(data.target, data.option)) {
        $item.addClass("active");
      }
    }

    if (data.visible !== undefined) {
      if (data.visible.constructor == Function) {
        if (!data.visible.call(data.target)) {
          $item.hide();
        }
      } else if (!data.visible) {
        $item.hide();
      }
    }

    data.disabled = false;
    if (data.enabled !== undefined) {
      if (data.enabled.constructor == Function) {
        if (!data.enabled.call(data.target)) {
          $item.attr("disabled", true);
          data.disabled = true;
        }
      }
    }

    if (data.observe) {
      //todo
      if (data.visible && data.visible.constructor == Function) {
        data.target && data.target.on(data.observe, function () {
          if (!data.visible.call(data.target)) {
            $item.hide();
            data.hidden = true;
          } else {
            $item.show();
            data.hidden = false;
          }
        });
      }

      if (data.type == "options") {
        data.target && data.target.on(data.observe, function () {
          var _val = data.value.get();
          $("[name=" + data.id + "]").prop("checked", false);
          $("[name=" + data.id + "][value=" + _val + "]").prop("checked", true);
        });
      }

      if (data.enabled && data.enabled.constructor == Function) {
        data.target && data.target.on(data.observe, function () {
          if (!data.enabled.call(data.target)) {
            $item.attr("disabled", true);
            data.disabled = true;
          } else {
            $item.removeAttr("disabled");
            data.disabled = false;
          }
        });
      }
    }
  },
  toggleByHover: function toggleByHover($item, $toggleElement, foo, data) {

    var onClose;

    $toggleElement.hide();
    $item.mouseout(function () {
      $toggleElement.hide();
      onClose && onClose();
    });
    $item.mouseover(function () {
      $toggleElement.show();
      onClose = foo && foo();
    });

    $item.click(function () {
      if (data && data.immediately) {
        data.action();
      }
    });
  },
  toggleByButton: function toggleByButton($item, $toggleElement, foo, data) {

    var onClose;
    var _try_hide = function _try_hide(e) {
      var _parents = $(e.target).parents();
      for (var i in _parents) {
        if (_parents[i] === $item[0]) {
          return false;
        }
      }
      if ($toggleElement.css("display") !== "none") {
        $toggleElement.hide();
        onClose && onClose();
      }
    };

    $toggleElement.click(function (e) {
      e.stopPropagation();
    });
    $toggleElement.hide();
    $item.click(function () {

      if ($toggleElement.css("display") !== "none") {
        $toggleElement.hide();
        onClose && onClose();
        $(window).off("click", _try_hide);
      } else {
        $toggleElement.show();
        $(window).on("click", _try_hide);

        onClose = foo && foo();

        if (data && data.immediately) {
          data.action();
        }
      }
    });
  },
  generateMenu: function generateMenu(target, $el, options, menu) {

    options = options || {
      title: false
    };
    options.buttons = options.buttons || {
      className: "",
      title: false
    };

    $el.empty();

    var _this = this;
    for (var i in menu) {
      var data = menu[i];
      if (!data || data.insert !== undefined && !data.insert) {
        continue;
      }
      data.type = data.type || "button";

      //todo непонятно зачем аргумент target в начале
      var target = data.target;

      var tool = this.tools[data.type];

      if (!tool) {
        console.warn("tool '" + data.type + "' undefined");
        continue;
      }
      var scope = data;
      if (tool.scope) {
        scope = fabric.util.object.defaults(tool.scope.call(this, data, options), data);
      }

      var $item = $(tool.template.format(scope));
      var transclude = $item.find("[transclude]");
      scope.$item = data.$item = $item;
      if (data.template) {
        $item.html(data.template.format(data.value.get()));
      }

      utils.compile.compileElement($item, scope);

      if (data.value && data.value.observe) {

        target.on(data.value.observe, function (val) {

          if (tool.post) {
            tool.post.call(_this, $item, scope, options, transclude.length ? transclude : null);
          }
          if (tool.render) {
            tool.render.call(_this, $item, data, options, tool, val);
          }
          //this.fire(data.type + ":render",{item: $item, data: data, options: options, tool: tool, val: val})
        });
      }

      this.initItem($item, data);

      if (tool.post) {
        tool.post.call(this, $item, scope, options, transclude.length ? transclude : null);
      }

      this.fire(data.type + ":created", { item: $item, data: data, options: options, tool: tool });

      $el.append($item);
    }
  }
};
utils.observable(Toolbar.prototype);

Toolbar.single = function (data, element) {
  data.$item = element;
  data.type = data.type || "button";

  var tool = Toolbar.prototype.tools[data.type];

  Toolbar.prototype.initItem(element, data);

  if (data.value && data.value.observe) {
    data.target.on(data.value.observe, function (val) {
      tool.render(element, data, {}, tool, val);
    });
  }

  if (tool.post) {
    var transclude = element.find("[transclude]");

    tool.post.call(Toolbar.prototype, element, data, {}, transclude.length ? transclude : null);
  }

  var scope = data;
  if (tool.scope) {
    scope = _.defaults(data, tool.scope.call(Toolbar.prototype, data, {}));
  }

  element.eachSelf("*", function () {
    var nodes = [],
        values = [];
    for (var att, i = 0, atts = this.attributes, n = atts.length; i < n; i++) {
      att = atts[i];
      nodes.push(att.nodeName);
      values.push(att.nodeValue);
      this.setAttribute(att.nodeName, att.nodeValue.format(scope));
    }
  });
  utils.compile.compileElement(element, scope);
};

module.exports = Toolbar;
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 2 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

var utils = {
  /**
   *
   * @param arr
   * @param arr2
   * @returns {{}}
   * @example
   *    x = {a: 1 ,b: 1, c: [1,2]}
   *    y = {a: 2 ,  c : 3 , d : 1}
   *
   *    extendArraysObject(x,y) = {a: [1,2] b : [1] c : [1,2,3], d [1] }
   */
  extendArraysObject: function extendArraysObject(arr, arr2) {
    var newArray = {};

    for (var i in arr) {
      if (arr[i].constructor == Array) {
        newArray[i] = [].concat(arr[i]);
      } else {
        newArray[i] = [arr[i]];
      }
    }

    for (var i in arr2) {
      if (newArray[i]) {
        newArray[i].push(arr2[i]);
      } else {
        newArray[i] = [arr2[i]];
      }
    }
    return newArray;
  },
  filterValues: function filterValues(array, values) {
    var new_array = [];
    for (var i in array) {
      var _new_object = {};
      for (var j in values) {
        _new_object[values[j]] = array[i][values[j]];
      }
      new_array.push(_new_object);
    }
    return new_array;
  },

  /**
   *  Тасование Фишера–Йетса,случайное тасование множества
   * @param object
   * @returns {*}
   */
  shuffle: function shuffle(object) {
    if (!object.length) return;
    var i = object.length;
    while (--i) {
      var j = Math.floor(Math.random() * (i + 1));
      var temp = object[i];
      object[i] = object[j];
      object[j] = temp;
    }

    return object; // for convenience, in case we want a reference to the array
  },
  /**
   * Dependency: underscore.js ( http://documentcloud.github.com/underscore/ )
   *
   * Mix it in with underscore.js:
   * _.mixin({deepExtend: deepExtend});
   *
   * Call it like this:
   * var myObj = utils.deepExtend(grandparent, child, grandchild, greatgrandchild)
   *
   * Notes:
   * Keep it DRY.
   * This function is especially useful if you're working with JSON config documents. It allows you to create a default
   * config document with the most common settings, then override those settings for specific cases. It accepts any
   * number of objects as arguments, giving you fine-grained control over your config document hierarchy.
   *
   * Special Features and Considerations:
   * - parentRE allows you to concatenate strings. example:
   *   var obj = utils.deepExtend({url: "www.example.com"}, {url: "http://#{_}/path/to/file.html"});
   *   console.log(obj.url);
   *   output: "http://www.example.com/path/to/file.html"
   *
   * - parentRE also acts as a placeholder, which can be useful when you need to change one value in an array, while
   *   leaving the others untouched. example:
   *   var arr = utils.deepExtend([100,    {id: 1234}, true,  "foo",  [250, 500]],
   *                          ["#{_}", "#{_}",     false, "#{_}", "#{_}"]);
   *   console.log(arr);
   *   output: [100, {id: 1234}, false, "foo", [250, 500]]
   *
   * - The previous example can also be written like this:
   *   var arr = utils.deepExtend([100,    {id:1234},   true,  "foo",  [250, 500]],
   *                          ["#{_}", {},          false, "#{_}", []]);
   *   console.log(arr);
   *   output: [100, {id: 1234}, false, "foo", [250, 500]]
   *
   * - And also like this:
   *   var arr = utils.deepExtend([100,    {id:1234},   true,  "foo",  [250, 500]],
   *                          ["#{_}", {},          false]);
   *   console.log(arr);
   *   output: [100, {id: 1234}, false, "foo", [250, 500]]
   *
   * - Array order is important. example:
   *   var arr = utils.deepExtend([1, 2, 3, 4], [1, 4, 3, 2]);
   *   console.log(arr);
   *   output: [1, 4, 3, 2]
   *
   * - You can remove an array element set in a parent object by setting the same index value to null in a child object.
   *   example:
   *   var obj = utils.deepExtend({arr: [1, 2, 3, 4]}, {arr: ["#{_}", null]});
   *   console.log(obj.arr);
   *   output: [1, 3, 4]
   *
   **/
  deepExtend: function deepExtend() /*obj_1, [obj_2], [obj_N]*/{
    if (arguments.length < 1 || _typeof(arguments[0]) !== 'object') {
      return false;
    }

    if (arguments.length < 2) return arguments[0];

    var target = arguments[0];

    // convert arguments to array and cut off target object
    var args = Array.prototype.slice.call(arguments, 1);

    var key, val, src, clone, tmpBuf;

    args.forEach(function (obj) {
      if ((typeof obj === 'undefined' ? 'undefined' : _typeof(obj)) !== 'object') return;

      for (key in obj) {
        if (!(key in obj)) continue;

        src = target[key];
        val = utils.cloneDeep(obj[key]);

        if ((typeof src === 'undefined' ? 'undefined' : _typeof(src)) !== 'object' || src === null) {
          target[key] = val;
        } else if (Array.isArray(val)) {
          clone = Array.isArray(src) ? src : [];

          val.forEach(function (item) {
            clone.push(utils.cloneDeep(item));
          });

          target[key] = clone;
          //todo  если заимствуем массив , то ссохраняем значения из обоих массивов
          //target[key] = utils.deepExtend(clone, val);
        } else {
          clone = !Array.isArray(src) ? src : {};
          target[key] = utils.deepExtend(clone, val);
        }
      }
    });

    return target;
  },
  cloneDeep: function cloneDeep(val) {

    if (typeof val === 'undefined') {
      return undefined;
    }

    if (val === null) {
      return null;
    } else if (val instanceof Date) {
      return new Date(val.getTime());
    } else if (val instanceof RegExp) {
      return new RegExp(val);
    }

    if (val.cloneSync) {
      return val.cloneSync();
    } else if (val.constructor == Object) {
      return utils.deepExtend({}, val);
    } else if (val.constructor == Array) {
      var clone = [];
      for (var i = 0; i < val.length; i++) {
        clone.push(utils.cloneDeep(val[i]));
      }
      return clone;
    } else {
      return val;
    }
  },
  rearrange: function rearrange(object, keys) {
    var _newOrder = {};
    for (var i in keys) {
      if (object[keys[i]] !== undefined) {
        _newOrder[keys[i]] = object[keys[i]];
      }
    }
    // for (i in object) {
    //   delete object[i];
    // }
    // for (i in _newOrder) {
    //   object[i] = _newOrder[i];
    // }
    return _newOrder;
  },
  map: _.map,
  sortBy: _.sortBy,
  defaults: _.defaults,
  where: _.where,
  findWhere: _.findWhere,
  filter: _.filter,
  pick: _.pick,
  pluck: _.pluck,
  extend: function extend(destination) {
    // JScript DontEnum bug is not taken care of
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];
      for (var property in source) {
        destination[property] = source[property];
      }
    }
    return destination;
  }
};
module.exports = utils;

/***/ }),
/* 3 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

var objectUtils = __webpack_require__(2);

var utils = {
  /**
   * will divide total width for every object in columnts array
   *
   *
   * @example
   *     var _flexArray = fabric.util.flex(200 , [{flex: 0},{value: 100, flex: 1},{flex: 0}] );
   * @param total
   * @param columns
   * @returns {Array}
   * @example [50,100,50]
   */
  flex: function flex(total, columns) {
    var _return = [];
    var split = 0;
    columns.forEach(function (column, index) {
      if (column.value === undefined) {
        split++;
      } else {
        total -= column.value;
      }
    });
    var _w = total / split;
    columns.forEach(function (column) {
      _return.push(column.value === undefined ? _w : column.value);
    });
    return _return;
  },
  worker: function worker(foo) {
    if (window.Worker) {
      var str = foo.toString();
      var eventArg = str.substring(str.indexOf("(") + 1, str.indexOf(","));
      var postMessageArg = str.substring(str.indexOf(",") + 1, str.indexOf(")"));
      var _functionBody = str.substring(str.indexOf("{") + 1);
      str = "onmessage=function(" + eventArg + "){" + postMessageArg + "= postMessage;" + _functionBody;
      var blob = new Blob([str]);
      //"onmessage = function(e) { postMessage('msg from worker'); }"]);
      var blobURL = window.URL.createObjectURL(blob);
      return new Worker(blobURL);
    } else {
      var worker = {
        terminate: function terminate() {},
        postMessage: function postMessage(data) {
          setTimeout(function () {
            foo({ data: data }, function (responseData) {
              worker.onmessage && worker.onmessage({ data: responseData });
            });
          });
        }
      };
      return worker;
    }
  },
  observable: function observable(obj) {
    _.extend(obj, {

      fire: function fire(eventName, options) {
        if (!this.__eventListeners) {
          return;
        }
        var listenersForEvent = this.__eventListeners[eventName];
        if (!listenersForEvent) {
          return;
        }
        for (var i = 0, len = listenersForEvent.length; i < len; i++) {
          listenersForEvent[i].call(this, options || {});
        }
        return this;
      },
      on: function on(eventName, handler) {
        if (eventName.constructor == Object) {
          for (var i in eventName) {
            this.on(i, eventName[i]);
          }
          return this;
        }
        var events = eventName.split(" ");
        for (var i in events) {
          this.observe(events[i], handler);
        }
        return this;
      },
      observe: function observe(eventName, handler) {
        if (!this.__eventListeners) {
          this.__eventListeners = {};
        }
        if (arguments.length === 1) {
          for (var prop in eventName) {
            this.on(prop, eventName[prop]);
          }
        } else {
          if (!this.__eventListeners[eventName]) {
            this.__eventListeners[eventName] = [];
          }
          this.__eventListeners[eventName].push(handler);
        }
        return this;
      },
      off: function stopObserving(eventName, handler) {
        function _removeEventListener(eventName, handler) {
          if (!this.__eventListeners[eventName]) {
            return;
          }

          if (handler) {
            var idx = this.__eventListeners[eventName].indexOf(handler);
            if (idx !== -1) {
              this.__eventListeners[eventName].splice(idx, 1);
            }
          } else {
            this.__eventListeners[eventName].length = 0;
          }
        }

        if (!this.__eventListeners) {
          return;
        }
        if (arguments.length === 0) {
          this.__eventListeners = {};
        } else if (arguments.length === 1 && _typeof(arguments[0]) === 'object') {
          for (var prop in eventName) {
            _removeEventListener.call(this, prop, eventName[prop]);
          }
        } else {
          _removeEventListener.call(this, eventName, handler);
        }
        return this;
      }
    });
  },
  inOrder: function inOrder(array, foo, callback) {
    var _index = 0;
    function _inOrderIndex() {
      if (++_index < array.length) {
        foo(array[_index], _index, _inOrderIndex);
      } else {
        callback && callback();
      }
    }
    foo(array[_index], _index, _inOrderIndex);
  },
  /**
   * возвращает объект с ключами строки url
   * @returns {{}}
   */
  queryString: function queryString(query) {
    if (query) {
      query = query.substr(query.indexOf("?") + 1);
    } else {
      query = window.location.search.substring(1);
    }
    var obj = {};
    var _length = 0;
    if (!query) return obj;
    var vars = query.split("&");
    for (var i = 0; i < vars.length; i++) {
      var pair = vars[i].split("=");
      var _vname = pair[0],
          val = pair[1];
      if (typeof obj[_vname] === "undefined") {
        obj[_vname] = val || "";
        Object.defineProperty(obj, _length, { value: _vname, enumerable: false });
        _length++;
        // If second entry with this name
      } else if (typeof obj[_vname] === "string") {
        var arr = [obj[_vname], val];
        obj[_vname] = arr;
        Object.defineProperty(obj, _length, { value: _vname, enumerable: false });
        _length++;
        // If third or later entry with this name
      } else {
        obj[_vname].push(val);
        Object.defineProperty(obj, _length, { value: _vname, enumerable: false });
        _length++;
      }
    }
    Object.defineProperty(obj, "length", { value: _length, enumerable: false });
    return obj;
  },
  copyValue: function copyValue(value) {
    if (value == null) {
      return null;
    }
    if (value == undefined) {
      return undefined;
    }
    switch (value.constructor) {
      case Object:
        return objectUtils.deepExtend({}, value);
      case Array:
        return objectUtils.deepExtend([], value);
      case String:
      case Number:
      case Boolean:
        return value;
      default:
        //console.log(value.constructor);
        return objectUtils.deepExtend({}, value);
    }
  },
  clearValue: function clearValue(value) {
    switch (value.constructor) {
      case Object:
        for (var member in value) {
          delete value[member];
        }break;
      case Array:
        value.length = 0;
        break;
      default:
      //delete value;
    }
  },
  objectsDifference: function objectsDifference(prev, now) {
    var changes = {};
    for (var prop in now) {
      if (!prev || prev[prop] !== now[prop]) {
        if (_typeof(now[prop]) == "object") {
          var c = utils.objectsDifference(prev[prop], now[prop]);
          if (!_.isEmpty(c)) // underscore
            changes[prop] = c;
        } else {
          changes[prop] = now[prop];
        }
      }
    }
    return changes;
  },
  splitBy: function splitBy(query, delimiter) {
    var traceQueries = [];
    var r = 0,
        f = 0,
        _p_start = 0;
    if (query == "") return [];
    for (var i = 0; i < query.length; i++) {
      var c = query[i];
      if (c == "(") {
        r++;
        f = 1;
      } else if (c == ")") {
        r--;
      }
      if (r == 0 && f == 1) f = 0;
      if (delimiter.indexOf(c) != -1 && r == 0 && f == 0) {
        traceQueries.push(query.substring(_p_start, i));
        _p_start = i + 1;
      }
    }
    traceQueries.push(query.substring(_p_start));
    return traceQueries;
  },
  queueLoad: function queueLoad(total, completeCB, progressCB) {
    var loader = function loader(el) {
      loader.loaded.push(el);
      loader.progressCB && loader.progressCB(loader.loaded.length, loader.total, el, loader.loaded);

      if (loader.loaded.length == loader.total) {
        loader.completeCB && loader.completeCB(loader.loaded);
        loader.fire("loaded");
      }
    };
    loader.completeCB = completeCB;
    loader.progressCB = progressCB;
    loader.total = total;
    loader.loaded = [];
    utils.observable(loader);

    return loader;
  }
};
module.exports = utils;

/***/ }),
/* 4 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


module.exports = {
  resolve: function resolve(path) {
    var chunks = path.split("/");
    var prev = 0;
    for (var i = chunks.length; i-- > 0;) {
      if (chunks[i] == "..") {
        prev++;
      } else {
        while (prev > 0) {
          chunks.splice(i, 1);
          chunks.splice(i--, 1);
          prev--;
        }
      }
    }
    return chunks.join("/");
  },
  getParentDirectoryUrl: function getParentDirectoryUrl(url) {
    return url.substr(0, url.lastIndexOf("/") + 1);
  }
};

/***/ }),
/* 5 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

String.prototype.format = function () {
  var str = this.toString();
  if (arguments.length) {
    var type = _typeof(arguments[0]),
        args = type == 'string' || type == 'number' ? Array.prototype.slice.call(arguments) : arguments[0];
    //
    // for (var arg in args) str = str.replace(new RegExp('\\{' + arg + '\\}', 'gi'), args[arg])

    str = str.replace(/\{([^}]*)\}/g, function (a, b) {
      return utils.evalInContext(b, args);
    });
  }

  return str;
};

var utils = {
  extractVariables: function extractVariables(str) {
    return str.match(/(?!(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$)[$A-Z\_a-z\xaa\xb5\xba\xc0-\xd6\xd8-\xf6\xf8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u08a0\u08a2-\u08ac\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097f\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58\u0c59\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d60\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f0\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191c\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19c1-\u19c7\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua697\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa80-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uabc0-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc][$A-Z\_a-z\xaa\xb5\xba\xc0-\xd6\xd8-\xf6\xf8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u08a0\u08a2-\u08ac\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097f\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58\u0c59\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d60\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f0\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191c\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19c1-\u19c7\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua697\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa80-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uabc0-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc0-9\u0300-\u036f\u0483-\u0487\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u0669\u0670\u06d6-\u06dc\u06df-\u06e4\u06e7\u06e8\u06ea-\u06ed\u06f0-\u06f9\u0711\u0730-\u074a\u07a6-\u07b0\u07c0-\u07c9\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0859-\u085b\u08e4-\u08fe\u0900-\u0903\u093a-\u093c\u093e-\u094f\u0951-\u0957\u0962\u0963\u0966-\u096f\u0981-\u0983\u09bc\u09be-\u09c4\u09c7\u09c8\u09cb-\u09cd\u09d7\u09e2\u09e3\u09e6-\u09ef\u0a01-\u0a03\u0a3c\u0a3e-\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a66-\u0a71\u0a75\u0a81-\u0a83\u0abc\u0abe-\u0ac5\u0ac7-\u0ac9\u0acb-\u0acd\u0ae2\u0ae3\u0ae6-\u0aef\u0b01-\u0b03\u0b3c\u0b3e-\u0b44\u0b47\u0b48\u0b4b-\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b66-\u0b6f\u0b82\u0bbe-\u0bc2\u0bc6-\u0bc8\u0bca-\u0bcd\u0bd7\u0be6-\u0bef\u0c01-\u0c03\u0c3e-\u0c44\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0c66-\u0c6f\u0c82\u0c83\u0cbc\u0cbe-\u0cc4\u0cc6-\u0cc8\u0cca-\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0ce6-\u0cef\u0d02\u0d03\u0d3e-\u0d44\u0d46-\u0d48\u0d4a-\u0d4d\u0d57\u0d62\u0d63\u0d66-\u0d6f\u0d82\u0d83\u0dca\u0dcf-\u0dd4\u0dd6\u0dd8-\u0ddf\u0df2\u0df3\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0e50-\u0e59\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0ed0-\u0ed9\u0f18\u0f19\u0f20-\u0f29\u0f35\u0f37\u0f39\u0f3e\u0f3f\u0f71-\u0f84\u0f86\u0f87\u0f8d-\u0f97\u0f99-\u0fbc\u0fc6\u102b-\u103e\u1040-\u1049\u1056-\u1059\u105e-\u1060\u1062-\u1064\u1067-\u106d\u1071-\u1074\u1082-\u108d\u108f-\u109d\u135d-\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b4-\u17d3\u17dd\u17e0-\u17e9\u180b-\u180d\u1810-\u1819\u18a9\u1920-\u192b\u1930-\u193b\u1946-\u194f\u19b0-\u19c0\u19c8\u19c9\u19d0-\u19d9\u1a17-\u1a1b\u1a55-\u1a5e\u1a60-\u1a7c\u1a7f-\u1a89\u1a90-\u1a99\u1b00-\u1b04\u1b34-\u1b44\u1b50-\u1b59\u1b6b-\u1b73\u1b80-\u1b82\u1ba1-\u1bad\u1bb0-\u1bb9\u1be6-\u1bf3\u1c24-\u1c37\u1c40-\u1c49\u1c50-\u1c59\u1cd0-\u1cd2\u1cd4-\u1ce8\u1ced\u1cf2-\u1cf4\u1dc0-\u1de6\u1dfc-\u1dff\u200c\u200d\u203f\u2040\u2054\u20d0-\u20dc\u20e1\u20e5-\u20f0\u2cef-\u2cf1\u2d7f\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua620-\ua629\ua66f\ua674-\ua67d\ua69f\ua6f0\ua6f1\ua802\ua806\ua80b\ua823-\ua827\ua880\ua881\ua8b4-\ua8c4\ua8d0-\ua8d9\ua8e0-\ua8f1\ua900-\ua909\ua926-\ua92d\ua947-\ua953\ua980-\ua983\ua9b3-\ua9c0\ua9d0-\ua9d9\uaa29-\uaa36\uaa43\uaa4c\uaa4d\uaa50-\uaa59\uaa7b\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uaaeb-\uaaef\uaaf5\uaaf6\uabe3-\uabea\uabec\uabed\uabf0-\uabf9\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\ufe33\ufe34\ufe4d-\ufe4f\uff10-\uff19\uff3f]*/gi);
  },
  evalInContext: function evalInContext(js) {
    js = js.replace(/\s+/g, '');

    var keys = [],
        values = [];

    for (var i = 1; i < arguments.length; i++) {
      keys = keys.concat(Object.keys(arguments[i]));
      for (var j in arguments[i]) {
        values.push(arguments[i][j]);
      }
    }

    //
    //if(_.isCorrectVariableName(js) && keys.indexOf(js) === -1){
    //  keys.push(js);
    //  values.push(undefined);
    //}

    var arr = utils.extractVariables(js);
    //console.log(arr);
    for (var i in arr) {
      if (keys.indexOf(arr[i]) === -1) {
        keys.push(arr[i]);
        values.push(undefined);
      }
    }
    js = "var foo = function(" + keys.join(",") + "){ var __return__value = " + js + " ;return __return__value;}; foo;";
    try {
      var foo = eval(js);
      return foo.apply(this, values);
    } catch (e) {
      return undefined;
    }
  },
  compileElement: function compileElement($item, scope) {

    function _eachSelf(el, selector, foo) {
      el.find(selector).each(foo);
      if (el.is(selector)) {
        foo.call(el[0]);
      }
    }

    //.addBack('selector')
    _eachSelf($item, "[onclick]", function () {
      var onClick = $(this).attr("onclick");
      $(this).removeAttr("onclick");
      $(this).click(function (event) {
        utils.evalInContext(onClick, scope, { event: event });
      });
    });

    _eachSelf($item, "[onchange]", function () {
      var onChange = $(this).attr("onchange");
      $(this).removeAttr("onchange");
      $(this).change(function (event) {
        utils.evalInContext(onChange, scope, { event: event });
      });
    });

    _eachSelf($item, "[dp-checked]", function () {
      var _val = $(this).attr("dp-checked");
      var val = utils.evalInContext(_val, scope);
      if (val) {
        $(this).attr("checked", "checked");
      } else {
        $(this).removeAttr("checked");
      }
    });
    _eachSelf($item, "[dp-src]", function () {
      var _val = $(this).attr("dp-src");
      var val = utils.evalInContext(_val, scope);
      if (val) {
        $(this).attr("src", val);
      }
    });
    _eachSelf($item, "[dp-if]", function () {
      var _val = $(this).attr("dp-if");
      if (_val === "false") {
        $(this).remove();
      }
      if (_val === "true") {} else {
        var val = utils.evalInContext(_val, scope);
        if (!val) {
          $(this).remove();
        }
      }
    });
    _eachSelf($item, "[dp-include]", function () {
      var _el = $(this);
      var _val = _el.attr("dp-include");
      var val = utils.evalInContext(_val, scope);
      _el.load(val);
    });
  },
  parseTemplate: function parseTemplate(tpl, scope) {
    var $item = $(tpl.format(scope));
    _.compileElement($item, scope);
    return $item;
  }
};
if (true) {
  module.exports = utils;
}

/***/ }),
/* 6 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

var ExtCanvasMixin = {
  defaultOptions: {},
  animated: false,
  fitIndex: 0.8,
  /**
   * required to show video
   */
  setAnimated: function setAnimated(val) {
    if (!val) {
      return;
    }

    fabric.util.requestAnimFrame(function render() {
      this.renderAll();
      fabric.util.requestAnimFrame(render);
    }.bind(this));
  },
  find: function find(options) {
    if (typeof options === "string") {
      options = {
        type: options
      };
    }
    return fabric.util.object.where(this._objects, options);
  },
  _update_background_image: function _update_background_image() {
    var photo = this.backgroundImage;
    if (!photo || photo.constructor == Object || photo.constructor == String) return;

    if (this.backgroundPosition === 'resize') {
      this.originalWidth = photo.width;
      this.originalHeight = photo.height;
    } else if (this.backgroundPosition !== 'manual') {

      var _w = this.originalWidth || this.width,
          _h = this.originalHeight || this.height;

      if (photo._originalElement) {
        var size = fabric.util.getProportions(photo._originalElement, {
          width: _w,
          height: _h
        }, this.backgroundPosition);
      } else {
        size = {
          width: _w,
          height: _h
        };
      }

      var _l;
      if (this.backgroundImage.originX == 'center') {
        _l = _w / 2;
      } else {
        _l = (_w - size.width) / 2;
      }
      var _t;
      if (this.backgroundImage.originY == 'center') {
        _t = _h / 2;
      } else {
        _t = (_h - size.height) / 2;
      }

      this.backgroundImage.set({
        left: _l + this.viewportTransform[4],
        top: _t + this.viewportTransform[5],
        width: size.width,
        height: size.height
      });
    } else {
      // var _orig = this.backgroundImage.getOriginalSize();
      // this.backgroundImage.set({
      //   originX: 'left',
      //   originY: 'top',
      //   left: 0, //this.viewportTransform[4],
      //   top: 0, //this.viewportTransform[5],
      //   width: _orig.width,
      //   height: _orig.height
      // });
    }
  },
  setBackgroundImage: function setBackgroundImage(bg, callback) {
    var _bgimageLoaded = function _bgimageLoaded(el) {

      if (this.loaded) {
        var originalState = { backgroundImage: this.backgroundImage };
      }

      this.backgroundImage = el;
      this.backgroundImage.canvas = this;
      this._update_background_image();
      if (this.backgroundPosition === "resize") {
        this.originalWidth = el.width;
        this.originalHeight = el.height;
      }

      if (this.loaded) {
        this.fire('modified', { states: {
            original: originalState,
            modified: { backgroundImage: this.backgroundImage }
          } });
      }

      this.fire("background-image:loaded", { target: el });
      callback && callback();
    };

    if (!bg) {
      this.backgroundImage = null;
      return callback();
    }
    if (bg instanceof HTMLImageElement || bg instanceof Image) {

      var el = new fabric.Image(bg, {
        width: bg.naturalWidth,
        height: bg.naturalHeight
      });

      _bgimageLoaded.call(this, el);
    }
    if (bg.constructor == String) {
      bg = {
        src: bg
      };
    }
    var _proto = this.application.prototypes;
    if (_proto && _proto.SlideCanvas && _proto.SlideCanvas.backgroundImageProperties) {
      fabric.util.object.extend(bg, _proto.SlideCanvas.backgroundImageProperties);
    }
    bg.application = this.application;
    bg.type = bg.type || "image";
    // bg.width = bg.naturalWidth;
    // bg.height = bg.naturalHeight;
    //
    fabric.util.createObject(bg, _bgimageLoaded.bind(this));
  },
  createObjects: function createObjects(objects, callback) {

    if (this.application) {
      for (var i in objects) {
        if (objects[i].constructor == String) {
          objects[i] = this.application.objects[objects[i]];
        }
      }
    }

    var _canvas = this;

    function success(_objects) {
      _canvas.fire("progress:complete", { objects: objects });
      for (var i in _objects) {
        _canvas.add(_objects[i]);
      }
      _canvas.renderAll();
      callback && callback.call(_canvas);
    }

    function progress(l, t) {
      _canvas.fire("progress", { loaded: l, total: t });
      if (fabric.util.loaderDebug) {
        console.log("loaded " + l + " / " + t);
      }
    }

    var _objects = [];
    if (!objects || !objects.length) {
      success(_objects);
      return;
    }

    if (objects[0].constructor.name === "klass") {
      success(objects);
      return;
    }

    var queueLoadCallback = fabric.util.queueLoad(objects.length, function () {
      success(fabric.util.object.pluck(_objects, "object"));
    }, progress);

    queueLoadCallback.data = (this.title || "") + "objects";

    for (var i in objects) {
      (function (options) {
        var _object_slot = { object: null, options: options };
        _objects.push(_object_slot);

        options.application = _canvas.application;
        fabric.util.createObject(options, function (el) {
          _object_slot.object = el;
          queueLoadCallback();
        });
      }).call(this, objects[i]);
    }
  },
  /**
   * apply options for group of filtered objects
   * @param filter
   * @param options
   */
  applyOptions: function applyOptions(filter, options) {
    this._objects.forEach(function (_obj) {
      for (var prop in filter) {
        if (_obj[prop] !== filter[prop]) return;
      }
      _obj.setOptions(options);
    });
  },
  /**
   * Create Object by type and options
   * @param type
   * @param options
   * @param callback
   */
  createObject: function createObject(type, options, callback) {
    if (typeof type !== "string") {
      callback = options;
      options = fabric.util.object.clone(type);
      type = null;
    } else {
      options = fabric.util.object.clone(options);
      options.type = type;
    }

    var _self = this;
    options.application = this.application;
    // var _active = options.active;
    // var _position = options.position;
    //    delete options.active;
    //  delete options.position;


    function _add(el) {
      if (el.canvas) return;
      _self.add(el);
      /*
            if(_active){
            if(_active){
              _self.setActiveObject(el);
            }*/
      callback && callback(el);
    }

    var el = fabric.util.createObject(options, _add);
    el && _add(el);
    return el;
  },
  onLoad: function onLoad(callback) {
    this.processing = false;
    this.loaded = true;
    this.fire("loading:end", { type: "slide", target: this });
    this.renderAll();
    callback && callback.call(this);
  },
  load: function load(options, callback) {
    this.originalWidth = 0;
    this.originalHeight = 0;

    if (this.application.prototypes.Slide) {
      fabric.util.object.defaults(options, this.application.prototypes.Slide);
    }

    if (!options) return;

    if (!this.virtual) {
      this.clear();
    }

    if (options.width) {
      options.originalWidth = options.width;
      options.originalHeight = options.height;
    }

    this.processing = true;
    this.fire("loading:begin", { type: "slide", options: options });

    this.set(options, this.onLoad.bind(this, callback));

    //todo
    if (this.plugins) {
      this.plugins.preloaders.forEach(function (preloader) {
        preloader.call(this, options);
        this.onResize();
      }.bind(this));
    }
  },
  setObjects: function setObjects(objects, callback) {

    this.clear();
    this.createObjects(objects, function () {
      for (var i in this._objects) {
        this._objects[i].setCoords();
      }
      callback();
    });
  },
  onResize: function onResize() {
    var _scale = Math.min(1, 800 / this.width);
    // this.setZoom(_scale);
    this.setDimensions({ width: this.width, height: this.height });
  },
  getCenter: function getCenter(el) {
    return {
      top: (this.originalHeight || this.getHeight()) / 2,
      left: (this.originalWidth || this.getWidth()) / 2
    };
  },
  setOriginalSize: function setOriginalSize(w, h) {
    this.originalWidth = h ? w : w.naturalWidth || w.width;
    this.originalHeight = h ? h : w.naturalHeight || w.height;
    return this;
  }
};

fabric.util.object.extend(fabric.StaticCanvas.prototype, ExtCanvasMixin, {
  type: "slide",
  optionsOrder: ["originalWidth", "originalHeight", "width", "height", "*"],
  _initEntity: function _initEntity(options) {
    options.application && options.application.fire("entity:created", { target: this, options: options });
  },
  _layers: ["_objects", "_areasObjects"],
  /**
   * Renders background, objects, overlay and controls.
   * @param {CanvasRenderingContext2D} ctx
   * @param {Array} objects to render
   * @return {fabric.Canvas} instance
   * @chainable
   */
  renderCanvas: function renderCanvas(ctx, objects) {
    this.clearContext(ctx);
    this.fire('before:render');
    if (this.clipTo) {
      fabric.util.clipContext(this, ctx);
    }
    this._renderBackground(ctx);

    ctx.save();
    //apply viewport transform once for all rendering process
    ctx.transform.apply(ctx, this.viewportTransform);
    this._renderBackgroundObjects(ctx);
    this._renderObjects(ctx, objects);
    this._renderOverlayObjects(ctx);
    ctx.restore();
    if (!this.controlsAboveOverlay && this.interactive) {
      this.drawControls(ctx);
    }
    if (this.clipTo) {
      ctx.restore();
    }
    this._renderOverlay(ctx);
    if (this.controlsAboveOverlay && this.interactive) {
      this.drawControls(ctx);
    }
    this.fire('after:render');
  },
  _renderOverlayObjects: function _renderOverlayObjects() {},
  _renderBackgroundObjects: function _renderBackgroundObjects() {},
  /**
   * @private
   * @param {HTMLElement | String} el &lt;canvas> element to initialize instance on
   * @param {Object} [options] Options object
   */
  _initStatic: function _initStatic(el, options) {
    this._objects = [];
    this._createLowerCanvas(el);
    this._initSize(options);
    this.set(options);
    this._setImageSmoothing();

    // only initialize retina scaling once
    if (!this.interactive) {
      this._initRetinaScaling();
    }
    this.calcOffset();
  },
  _initSize: function _initSize() {
    this.width = this.width || parseInt(this.lowerCanvasEl.width, 10) || 0;
    this.height = this.height || parseInt(this.lowerCanvasEl.height, 10) || 0;

    if (!this.lowerCanvasEl.style) {
      return;
    }

    this.lowerCanvasEl.width = this.width;
    this.lowerCanvasEl.height = this.height;

    this.lowerCanvasEl.style.width = this.width + 'px';
    this.lowerCanvasEl.style.height = this.height + 'px';

    this.viewportTransform = this.viewportTransform.slice();
  },
  initialize: function initialize(el, options) {
    options = fabric.util.object.defaults(fabric.util.object.deepExtend(options || {}), this.defaultOptions);
    this._initEntity(options);
    this._initStatic(el, options);
  },
  setData: function setData(data) {

    if (data.category == "background") {
      this.setBackgroundImage(data.src, this.renderAll.bind(this));
    } else {
      var id = this.activeArea ? "#" + this.activeArea.id : "canvas";
      this.createObject(fabric.util.object.deepExtend({
        movementLimits: id,
        clipTo: id,
        position: "center",
        active: true
      }, fabric.util.object.clone(data)));
    }
  },
  setWidth: function setWidth(value) {
    return this.setDimensions({ width: value }, {});
  },
  setHeight: function setHeight(value) {
    return this.setDimensions({ height: value }, {});
  },
  /**
   * @private
   */

  getObjectByID: function getObjectByID(_id) {
    var _iteratorNormalCompletion = true;
    var _didIteratorError = false;
    var _iteratorError = undefined;

    try {
      for (var _iterator = this._layers[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
        var layerName = _step.value;
        var _iteratorNormalCompletion2 = true;
        var _didIteratorError2 = false;
        var _iteratorError2 = undefined;

        try {
          for (var _iterator2 = this[layerName][Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
            var o = _step2.value;

            if (o.id === _id) {
              return o;
            }
          }
        } catch (err) {
          _didIteratorError2 = true;
          _iteratorError2 = err;
        } finally {
          try {
            if (!_iteratorNormalCompletion2 && _iterator2.return) {
              _iterator2.return();
            }
          } finally {
            if (_didIteratorError2) {
              throw _iteratorError2;
            }
          }
        }
      }
    } catch (err) {
      _didIteratorError = true;
      _iteratorError = err;
    } finally {
      try {
        if (!_iteratorNormalCompletion && _iterator.return) {
          _iterator.return();
        }
      } finally {
        if (_didIteratorError) {
          throw _iteratorError;
        }
      }
    }

    return null;
  },
  /*
   Add Custom Object Tranformations
   */
  getPointer: function getPointer(e, ignoreZoom, upperCanvasEl) {
    var pointer = _get_pointer_overwritten.call(this, e, ignoreZoom, upperCanvasEl);
    if (e._group) {
      return this._normalizePointer(e._group, pointer);
    }
    return pointer;
  },

  hasStateChanged: fabric.Object.prototype.hasStateChanged,
  /** Creates a bottom canvas
   * @private
   * @param {HTMLElement} [canvasEl]
   */
  _createLowerCanvas: function _createLowerCanvas(canvasEl) {
    if (typeof canvasEl == "string") {
      this.lowerCanvasEl = fabric.util.getById(canvasEl) || this._createCanvasElement();
    } else if (canvasEl) {
      this.lowerCanvasEl = canvasEl;
    } else {
      this.virtual = true;
      this.lowerCanvasEl = fabric.util.createCanvasElement();
    }

    this._initCanvasElement(this.lowerCanvasEl);

    fabric.util.addClass(this.lowerCanvasEl, 'lower-canvas');

    if (this.interactive) {
      this._applyCanvasStyle(this.lowerCanvasEl);
    }

    this.contextContainer = this.lowerCanvasEl.getContext('2d');
  },
  findTarget: function findTarget(e, skipGroup) {
    if (this.skipTargetFind) {
      return;
    }

    var ignoreZoom = true,
        pointer = this.getPointer(e, ignoreZoom),
        activeGroup = this.getActiveGroup(),
        activeObject = this.getActiveObject();
    if (activeGroup && !skipGroup && this._checkTarget(pointer, activeGroup)) {
      return activeGroup;
    }

    if (activeObject && this._checkTarget(pointer, activeObject)) {
      //added visceroid
      this._fireOverOutEvents(activeObject, e);
      return activeObject;
    }

    this.targets = [];

    var target = this._searchPossibleTargets(this._objects, pointer);
    this._fireOverOutEvents(target, e);
    return target;
  }
});
fabric.util.object.extend(fabric.Canvas.prototype, ExtCanvasMixin);
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 7 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.ImageMixin = {
  setElementFromMenu: function setElementFromMenu(data) {
    this.setElement(data.image);
  },
  initProportinalSize: true,
  /**
   * @private
   * @param {Object} [options] Object with width/height properties
   */
  _setWidthHeight: function _setWidthHeight(options) {
    if (this.element) {
      var _size = this.getOriginalSize();
    } else {
      _size = {};
    }
    if ('width' in options) {
      this.width = options.width;
    } else {
      if (!_size.width) {
        this.width = 100;
      } else {
        if (this.initProportinalSize && 'height' in options) {
          this.width = options.height / _size.height * _size.width;
        } else {
          this.width = _size.width;
        }
      }
    }

    if ('height' in options) {
      this.height = options.height;
    } else {
      if (!_size.height) {
        this.height = 100;
      } else {
        if (this.initProportinalSize && 'width' in options) {
          this.height = options.width / _size.width * _size.height;
        } else {
          this.height = _size.height;
        }
      }
    }
  }
};

fabric.Application.prototype.getLibraryElements = function (options) {
  return [];
};
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 8 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.util.object.extend(fabric.StaticCanvas.prototype, {

  optionsOrder: function () {
    var oo = fabric.StaticCanvas.prototype.optionsOrder;
    oo.splice(oo.indexOf("*"), 0, "areas", "offsets", "helpers");
    return oo;
  }(),
  _helpersObjects: null,
  _areasObjects: null,
  //offsets: {left: 0, top: 0, right: 0, bottom: 0},
  _update_clip_rect: function _update_clip_rect() {
    //todo
    return;
    if (this.areas || !this._areasObjects[0]) return;
    var geometry = this.getRect(this.offsets);
    this._areasObjects[0].set(geometry);
  },
  //offsets: {left : 0,top : 0, right: 0, bottom:0},
  setHelpers: function setHelpers(helpers, callback) {
    var _this2 = this;

    this.helpers = helpers;
    this._helpersObjects = [];
    if (helpers) {
      var _iteratorNormalCompletion = true;
      var _didIteratorError = false;
      var _iteratorError = undefined;

      try {
        for (var _iterator = helpers[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
          var h = _step.value;

          fabric.util.createObject(h, function (helper) {
            _this2._helpersObjects.push(helper);
            _this2.renderAll();
          });
        }
      } catch (err) {
        _didIteratorError = true;
        _iteratorError = err;
      } finally {
        try {
          if (!_iteratorNormalCompletion && _iterator.return) {
            _iterator.return();
          }
        } finally {
          if (_didIteratorError) {
            throw _iteratorError;
          }
        }
      }
    }
    callback && callback();
  },
  storeProperties: fabric.StaticCanvas.prototype.storeProperties.concat(["offsets", "helpers", "areas"]),
  areaActivating: false,
  addElementsInsideActiveArea: false,
  areaProperties: {
    originX: 'left',
    originY: 'top',
    fill: 'transparent',
    strokeDashArray: [5, 5],
    strokeWidth: 1,
    stroke: 'black',
    resizable: true
    //selectable: false
  },
  setAreaProperty: function setAreaProperty(property, value) {
    this["area_" + property] = value;
    if (this._offsetsObject) {
      this._offsetsObject[property] = value;
    }
    var _iteratorNormalCompletion2 = true;
    var _didIteratorError2 = false;
    var _iteratorError2 = undefined;

    try {
      for (var _iterator2 = this._areasObjects[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
        var object = _step2.value;

        object[property] = value;
      }
    } catch (err) {
      _didIteratorError2 = true;
      _iteratorError2 = err;
    } finally {
      try {
        if (!_iteratorNormalCompletion2 && _iterator2.return) {
          _iterator2.return();
        }
      } finally {
        if (_didIteratorError2) {
          throw _iteratorError2;
        }
      }
    }

    this.renderAll();
  },
  setActiveArea: function setActiveArea(area) {
    if (this.activeArea) {
      this.activeArea.setStroke("#000");
    }
    this.activeArea = area;
    if (area) {
      area.setStroke("#B7F1ED");
    }
  },
  setAreaActivating: function setAreaActivating(value /*, force*/) {
    //todo force
    var force = true;
    if (force || value && !this.areaActivating) {
      this.areaActivating = true;
      this.on("object:modified", function (e) {
        if (!this._areasObjects) return;
        if (this.editingObject) {
          return;
        }
        //todo event! не ъотел бы это тут испольовать,но работает
        var pointer = this.getPointer(event, true);
        var target = this._searchPossibleTargets(this._areasObjects, pointer);
        if (this._currentTransform && target && this.target.movementLimits != target) {
          this.target.set({
            movementLimits: target,
            clipTo: target
          });
          this.setActiveArea(target);
        }
      });
      this.on("mouse:down", function (e) {
        if (!this._areasObjects) return;
        var pointer = this.getPointer(e.e, true);
        var target = this._searchPossibleTargets(this._areasObjects, pointer);
        if (target) {
          this.setActiveArea(target);
        }
      });
    }
  },
  _update_area_geometry: function _update_area_geometry(el, options) {
    if (options.path) {

      options.width = options.width || el.width;
      var geometry = this.getRect(options);
      var _scale = el.width / geometry.width;
      el.set({
        left: geometry.left, ///* el.left * _scale*/,
        top: geometry.top, //+ el.top * _scale,
        scaleX: _scale,
        scaleY: _scale
      });
      return;
    }
    var geometry = this.getRect(options);

    if (options.src) {
      var _scale = geometry.width / img.width;
      el.set({
        left: geometry.left, // + el.left * _scale,
        top: geometry.top, //+ el.top * _scale,
        strokeWidth: this.areaProperties.strokeWidth / _scale,
        scaleX: _scale,
        scaleY: _scale
      });
    } else {
      el.set(geometry);
    }
  },
  _renderOverlayObjects: function _renderOverlayObjects(ctx) {
    if (this._offsetsObject) {
      this._offsetsObject.render(ctx);
    }
    if (this._areasObjects) {
      this._renderObjects(ctx, this._areasObjects);
    }
    if (this._helpersObjects) {
      this._renderObjects(ctx, this._helpersObjects);
    }
  },
  createArea: function createArea(area, callback) {

    var _this = this;

    var _finalize = function (path, area) {
      path.id = area.id;
      //
      // area.instance = path;
      // path.layer = "background";
      // this.add(path);
      this._update_area_geometry(path, area);
      this._areasObjects.push(path);
      // _this._backgroundLayer.push(path);
      // path.canvas = _this;
      callback();
    }.bind(this);

    var path, rectarea;
    if (area.path) {
      path = new fabric.Path(area.path, this.areaProperties);
      area.top = path.top;
      area.left = path.left;
      area.width = path.width;
      area.height = path.height;
      _finalize(path, area);
    } else if (area.src) {
      var clipFiller = new fabric.Pathfinder({});
      fabric.util.loadImage(area.src, function (img) {
        clipFiller.setImage(img);
        clipFiller.mask = MagicWand.selectBackground(clipFiller.getInfo(), null, 15);

        var contours = clipFiller.getContours();
        var clipPoints = contours[1].points;
        var pathData = fabric.PencilBrush.prototype.convertPointsToSVGPath(clipPoints).join(''); //todo
        path = new fabric.Path(pathData, _this.areaProperties);

        _finalize(path, area);
      });
    } else {
      path = new fabric.Rect(this.areaProperties);
      _finalize(path, area);
    }

    if ((area.right || area.bottom || area.path) && (!this.originalWidth || !this.originalHeight)) {
      this.on("background-image:loaded", function () {
        this._update_area_geometry(path, area);
        this.renderAll();
      }.bind(this));
    }

    /*
     app.canvas.setOffsets({
     right:  1,
     left:   1,
     top:    1,
     bottom: 1
     });
       app.canvas.clipTo = function (ctx) {
     var zoom = app.canvas_config.width / app.canvas.backgroundImage.filters[0].pathfinder.mask.width;
     ctx.save();
     ctx.scale(zoom, zoom);
     app.clipFiller.traceInner(ctx);
     ctx.restore();
     };*/
  },
  removeArea: function removeArea(area) {
    /*
        var objs = this.getObjects();
        for (var i in objs) {
          if (objs[i].movementLimits === area) {
            delete objs[i].movementLimits;
          }
          if (objs[i].clipTo === area) {
            //if(objs[i].olcClipToID){
            //    objs[i].clipToID = objs[i].oldClipToID;
            //}
            delete objs[i].clipTo;
            //objs[i].olcClipToID = area.id;
          }
        }
        area.remove();*/
  },
  /**
   *
   * @param offsets : {top: number, right: number, bottom: number, left: number} | number | [?number,?number,?number,?number]
   * @param callback
   */
  setOffsets: function setOffsets(offsets) {
    if (offsets === null) {
      this.offsets = { top: 0, right: 0, bottom: 0, left: 0 };
    } else if (offsets.constructor === Number) {
      this.offsets = { top: offsets, right: offsets, bottom: offsets, left: offsets };
    } else if (offsets.constructor === Array) {
      switch (offsets.length) {
        case 0:
          this.offsets = { top: 0, right: 0, bottom: 0, left: 0 };break;
        case 1:
          this.offsets = { top: offsets[0], right: offsets[0], bottom: offsets[0], left: offsets[0] };break;
        case 2:
          this.offsets = { top: offsets[0], right: offsets[1], bottom: offsets[0], left: offsets[1] };break;
        case 3:
          this.offsets = { top: offsets[0], right: offsets[1], bottom: offsets[2], left: offsets[1] };break;
        case 4:
          this.offsets = { top: offsets[0], right: offsets[1], bottom: offsets[2], left: offsets[3] };break;
      }
    } else {
      this.offsets = offsets;
    }

    if (this.offsets.top || this.offsets.bottom || this.offsets.left || this.offsets.right) {

      this._offsetsObject = new fabric.Rect(this.offsets);
      this._offsetsObject.set(this.areaProperties);
      this._update_area_geometry(this._offsetsObject, this.offsets);
      if (this.areaActivating) {
        this.setActiveArea(this._offsetsObject || null);
      }
    } else {
      this._offsetsObject = null;
    }

    this.renderAll();
  },
  setAreas: function setAreas(areas, callback) {
    this._areasObjects = [];
    areas = areas || [];
    if (this.areas) {
      for (var i = this.areas.length; i--;) {
        this.removeArea(this.areas[i].instance);
      }
    }
    this.areas = areas;

    var cb = fabric.util.queueLoad(areas.length + 1, function () {
      if (this.areaActivating) {
        this.setActiveArea(this._areasObjects[0] || null);
      }

      /* var objs = this.getObjects();
      //work with object
       if (!areas.length) {
         objs.length && this.clear();
       } else {
         /* todo : применить текущую зону ко всем объектам
          var _area = this.activeArea || this.layers.background.objects[0];
          for (var i in objs) {
          var obj = objs[i];
          obj.clipTo = _area;
          obj.setMovementLimits(_area);
          obj.setCoords();
          }*/
      //}*/
      callback && callback.call(this);
    }.bind(this));

    for (var i in areas) {
      if (!areas[i].id) {
        areas[i].id = "__" + i;
      }
      this.createArea(areas[i], cb);
    }
    cb();

    this.renderAll();
  }
});

fabric.util.object.extend(fabric.SlideCanvas.prototype, {
  defaultOptions: fabric.util.object.extend(fabric.SlideCanvas.prototype.defaultOptions, {
    //offsets: {left : 0,top : 0, right: 0, bottom:0}
  }),
  eventListeners: fabric.util.object.extendArraysObject(fabric.SlideCanvas.prototype.eventListeners, {
    "before:drop": function beforeDrop(e) {
      //todo;
      if (!this._backgroundLayer) {
        return;
      }
      var pointer = this.getPointer(e.originalEvent, true);
      var target = this._searchPossibleTargets(this._backgroundLayer, pointer);
      if (target) {
        this.setActiveArea(target);
        e.data.clipTo = "#" + target.id;
        e.data.movementLimits = "#" + target.id;
      }
    }
  })
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 9 */
/***/ (function(module, exports) {

module.exports = $;

/***/ }),
/* 10 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

// Magic Wand (Fuzzy Selection Tool) for Javascript
//
// The MIT License (MIT)
//
// Copyright (c) 2014, Ryasnoy Paul (ryasnoypaul@gmail.com)
//
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
//
// The above copyright notice and this permission notice shall be included in
// all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
// THE SOFTWARE.

var MagicWand = function () {
  var lib = {};
  //var canvas = document.createElement("canvas");
  //var context = canvas.getContext("2d");

  function createCanvasElement() {
    if (typeof Canvas !== "undefined") {
      return new Canvas();
    }
    return document.createElement("canvas");
  }

  function SelectionMask(w, h, data) {
    if (arguments.length == 1) {
      for (var i in arguments[0]) {
        this[i] = arguments[0][i];
      }
    } else {
      this.data = new Uint8Array(data || w * h);
      this.width = w;
      this.height = h;
      this.count = 0;
      this.bounds = {
        minX: Infinity,
        minY: Infinity,
        maxY: -1,
        maxX: -1
      };
      // this.bounds = {
      //   minX: 0,
      //   minY: 0,
      //   maxY: h,
      //   maxX: w
      // };
    }
  }
  lib.SelectionMask = SelectionMask;

  SelectionMask.prototype.debug = function () {
    var canvas = document.createElement("canvas");
    canvas.width = this.width;
    canvas.height = this.height;
    var ctx = canvas.getContext('2d');
    this.render(ctx, {
      fill: "#fff",
      outerFill: "#000"
    });
    ctx.debug();
  };

  SelectionMask.prototype.makeCache = function (options) {
    this.cache = createCanvasElement();
    this.cache.width = this.bounds.maxX - this.bounds.minX + 1;
    this.cache.height = this.bounds.maxY - this.bounds.minY + 1;
    this.context = this.cache.getContext('2d');

    options = options || {};
    this.render(this.context, {
      fill: "#fff",
      outerFill: "#000",
      cache: false,
      left: -this.bounds.minX,
      top: -this.bounds.minY
    });
  };

  SelectionMask.prototype.add = function (mask) {
    var index, x, y;
    for (x = mask.bounds.minX; x <= mask.bounds.maxX; x++) {
      for (y = mask.bounds.minY; y <= mask.bounds.maxY; y++) {
        index = mask.width * y + x;
        if (mask.data[index] && !this.data[index]) {
          this.data[index] = 1;
          this.count++;
        }
      }
    }

    this.bounds.minX = Math.min(mask.bounds.minX, this.bounds.minX);
    this.bounds.maxX = Math.max(mask.bounds.maxX, this.bounds.maxX);
    this.bounds.minY = Math.min(mask.bounds.minY, this.bounds.minY);
    this.bounds.maxY = Math.max(mask.bounds.maxY, this.bounds.maxY);
  };
  function hexToRgb(hex) {
    // Expand shorthand form (e.g. "03F") to full form (e.g. "0033FF")
    var shorthandRegex = /^#?([a-f\d])([a-f\d])([a-f\d])$/i;
    hex = hex.replace(shorthandRegex, function (m, r, g, b) {
      return r + r + g + g + b + b;
    });

    var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
    return result ? {
      r: parseInt(result[1], 16),
      g: parseInt(result[2], 16),
      b: parseInt(result[3], 16)
    } : null;
  }

  SelectionMask.prototype.render = function (ctx, options) {
    if (!this.count) return;

    options = options || {};
    options.left = options.left || 0;
    options.top = options.top || 0;
    options.fill = options.fill || false; // [0,0,0,0];
    options.intersectionColor = options.intersectionColor || false; //  [0,0,0,0];

    options.outerFill = options.outerFill || false; // [0,0,0,0];
    options.outerIntersectionColor = options.outerIntersectionColor || false; //  [0,0,0,0];

    //if(this.cache && options.cache !== false){
    //
    //  var _ctx = this.context;
    //  _ctx.save();
    //  _ctx.globalCompositeOperation="source-in";
    //  _ctx.fillStyle= options.fill;
    //  _ctx.fillRect(0,0,this.cache.width,this.cache.height);
    //  _ctx.restore();
    //
    //  ctx.save();
    //  ctx.globalAlpha = options.opacity;
    //  ctx.drawImage(this.cache,this.bounds.minX,this.bounds.minY)
    //  ctx.restore();
    //  return;
    //}

    //todo do not use fabric here!
    function convertColor(color) {
      if (color.constructor == String) {
        if (color[0] == "#") {
          var _rgb = hexToRgb(color);
          return [_rgb.r, _rgb.g, _rgb.b, 255];
        }
        color = new fabric.Color(color)._source;
        color[3] *= 255;
      }
      return color;
    }

    var _w = this.bounds.maxX - this.bounds.minX + 1;
    var _h = this.bounds.maxY - this.bounds.minY + 1;

    //var imgData = ctx.getImageData(options.left,options.top,_w,_h);
    var imgData = ctx.getImageData(this.bounds.minX, this.bounds.minY, _w, _h);

    var color = convertColor(options.fill);
    var color2 = convertColor(options.intersectionColor);
    var color3 = convertColor(options.outerFill);
    var color4 = convertColor(options.outerIntersectionColor);

    for (var x = this.bounds.minX; x <= this.bounds.maxX; x++) {
      for (var y = this.bounds.minY; y <= this.bounds.maxY; y++) {
        var index = this.width * y + x;
        var index_small = _w * (y - this.bounds.minY) + x - this.bounds.minX;

        if (this.data[index]) {
          var _color = imgData.data[index_small * 4 + 3] ? color2 : color;
          if (!_color) continue;

          imgData.data[index_small * 4] = _color[0];
          imgData.data[index_small * 4 + 1] = _color[1];
          imgData.data[index_small * 4 + 2] = _color[2];
          imgData.data[index_small * 4 + 3] = _color[3];
        } else {
          var _color = imgData.data[index_small * 4 + 3] ? color4 : color3;
          if (!_color) continue;

          imgData.data[index_small * 4] = _color[0];
          imgData.data[index_small * 4 + 1] = _color[1];
          imgData.data[index_small * 4 + 2] = _color[2];
          imgData.data[index_small * 4 + 3] = _color[3];
        }
      }
    }

    // ctx.putImageData(imgData, options.left  , options.top  );
    ctx.putImageData(imgData, this.bounds.minX, this.bounds.minY);
  };

  /**
   * get array with begin and end indices of filled 1 intervals
   * @param ctx
   * @param options
   * @returns {Array}
   */
  SelectionMask.prototype.getIntervalsArray = function (ctx, options) {
    var _newData = [];
    for (var i = 0, _val = 0; i < array.length; i++) {
      if (_val != array[i]) {
        _newData.push(i);
        _val = array[i];
      }
    }
    return _newData;
  };

  SelectionMask.prototype.renderBorder = function (ctx, options) {

    options = options || {};
    options.left = options.left || 0;
    options.top = options.top || 0;
    options.hatchOffset = options.hatchOffset || 0;
    options.hatchLength = options.hatchLength || 4;
    options.opacity = options.opacity || 1;

    var imgData = ctx.getImageData(0, 0, this.width, this.height);

    if (!this.cacheInd) {
      this.cacheInd = MagicWand.getBorderIndices(this);
    }

    var x,
        y,
        i,
        j,
        k,
        w = imgData.width,
        h = imgData.height;
    var res = imgData.data;

    var len = this.cacheInd.length;
    for (j = 0; j < len; j++) {
      i = this.cacheInd[j];
      x = i % w; // calc x by index
      y = (i - x) / w; // calc y by index
      k = (y * w + x) * 4;

      if ((x + y + options.hatchOffset) % (options.hatchLength * 2) < options.hatchLength) {
        // detect hatch color

        res[k] = 0;
        res[k + 1] = 0;
        res[k + 2] = 0;
        res[k + 3] = 255; // black, change only alpha
      } else {
        res[k] = 255; // white
        res[k + 1] = 255;
        res[k + 2] = 255;
        res[k + 3] = 255;
      }
    }
    ctx.save();
    ctx.globalAlpha = options.opacity;
    ctx.putImageData(imgData, options.left || 0, options.top || 0);
    ctx.restore();
  };

  lib.createMask = function (w, h, data) {
    return new SelectionMask(w, h, data);
  };

  lib.difference = function (a, b) {
    return Math.max(b[0] !== false ? Math.abs(b[0] - a[0]) : 0, b[1] !== false ? Math.abs(b[1] - a[1]) : 0, b[2] !== false ? Math.abs(b[2] - a[2]) : 0, b[3] !== false ? Math.abs(b[3] - a[3]) : 0);
  };

  lib.acceptable = function (x, y, image, visited, sampleColor, colorThreshold) {
    // check whether the point has been visited
    if (visited[y * image.width + x] === 1) {
      return false;
    }
    var i = (y * image.width + x) * lib.bytes,
        color2 = [image.data[i], image.data[i + 1], image.data[i + 2], image.data[i + 3]];

    if (sampleColor[0] !== false && Math.abs(sampleColor[0] - color2[0]) > colorThreshold) return false;
    if (sampleColor[1] !== false && Math.abs(sampleColor[1] - color2[1]) > colorThreshold) return false;
    if (sampleColor[2] !== false && Math.abs(sampleColor[2] - color2[2]) > colorThreshold) return false;
    if (sampleColor[3] !== false && Math.abs(sampleColor[3] - color2[3]) > colorThreshold) return false;
    return true;
  };

  lib.selectAll = function (image, px, py, colorThreshold) {
    var i = (py * image.width + px) * lib.bytes,
        data = image.data,
        sampleColor = [data[i], data[i + 1], data[i + 2], data[i + 3]]; // start point color (sample)
    return lib.selectAllByColor(image, sampleColor, colorThreshold);
  };

  /**
   * Converts an RGB color value to HSL. Conversion formula
   * adapted from http://en.wikipedia.org/wiki/HSL_color_space.
   * Assumes r, g, and b are contained in the set [0, 255] and
   * returns h, s, and l in the set [0, 1].
   *
   * @param   Number  r       The red color value
   * @param   Number  g       The green color value
   * @param   Number  b       The blue color value
   * @return  Array           The HSL representation
   */
  lib.rgbToHsl = function (r, g, b) {
    r /= 255, g /= 255, b /= 255;
    var max = Math.max(r, g, b),
        min = Math.min(r, g, b);
    var h,
        s,
        l = (max + min) / 2;

    if (max == min) {
      h = s = 0; // achromatic
    } else {
      var d = max - min;
      s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
      switch (max) {
        case r:
          h = (g - b) / d + (g < b ? 6 : 0);break;
        case g:
          h = (b - r) / d + 2;break;
        case b:
          h = (r - g) / d + 4;break;
      }
      h /= 6;
    }

    return [h, s, l];
  };

  lib.selectColored = function (image, options) {

    var mask = new SelectionMask(image.width, image.height);

    mask.bounds = {
      minX: image.width,
      minY: image.height,
      maxY: -1,
      maxX: -1
    };

    var x, y;
    for (y = 0; y < image.height; y++) {
      for (x = 0; x < image.width; x++) {
        var index = y * image.width + x;
        var i = index * lib.bytes;
        //if (!image.data[i + 3]) continue;


        if (options.aMin && image.data[i + 3] < options.aMin) continue;

        var hsl = rgbToHsl(image.data[i], image.data[i + 1], image.data[i + 2]);

        if (options.sMin && hsl[1] < options.sMin) continue;
        if (options.sMax && hsl[1] > options.sMax) continue;
        if (options.bMin && hsl[2] < options.bMin) continue;
        if (options.bMax && hsl[2] > options.bMax) continue;

        mask.data[index] = 1;
        mask.count++;
        mask.bounds.minX = Math.min(mask.bounds.minX, x);
        mask.bounds.maxX = Math.max(mask.bounds.maxX, x);
        mask.bounds.minY = Math.min(mask.bounds.minY, y);
        mask.bounds.maxY = Math.max(mask.bounds.maxY, y);
      }
    }
    return mask;
  };

  lib.selectAllByColor = function (ctx, sampleColor, colorThreshold) {
    var image = _getImageData(ctx);

    var mask = new SelectionMask(image.width, image.height);

    mask.bounds = {
      minX: Infinity,
      minY: Infinity,
      maxY: -1,
      maxX: -1
    };

    var visited = new Uint8Array(image.width * image.height);
    var x, y;
    for (y = 0; y < image.height; y++) {
      for (x = 0; x < image.width; x++) {
        if (lib.acceptable(x, y, image, mask.data, sampleColor, colorThreshold)) {
          MagicWand.floodFill(image, x, y, colorThreshold, {
            sampleColor: sampleColor,
            activeMask: mask,
            visitedPoints: visited
          });
        }
      }
    }
    return mask;
  };

  lib.drawImage = function (ctx, canvas, mask, left, top) {

    var ctx2 = canvas.getContext('2d');

    var imgData = ctx.getImageData(0, 0, mask.width, mask.height);
    var imgDataOriginal = ctx2.getImageData(left, top, mask.width, mask.height);

    var b = mask.bounds;
    for (var x = b.minX; x <= b.maxX; x++) {
      for (var y = b.minY; y <= b.maxY; y++) {
        var i = y * mask.width + x; // * bytes; // point index in the image data
        if (mask.data[i]) {
          imgData.data[i * 4] = imgDataOriginal.data[i * 4];
          imgData.data[i * 4 + 1] = imgDataOriginal.data[i * 4 + 1];
          imgData.data[i * 4 + 2] = imgDataOriginal.data[i * 4 + 2];
          imgData.data[i * 4 + 3] = imgDataOriginal.data[i * 4 + 3];
        }
      }
    }ctx.putImageData(imgData, 0, 0);
  };

  function _getImageData(ctx) {
    if (ctx.constructor.name == "ImageData") {
      return ctx;
    } else {
      return ctx.getImageData(0, 0, ctx.canvas.width, ctx.canvas.height);
    }
  }

  lib.fillMask = function (ctx, mask, color) {
    var imgData = _getImageData(ctx);
    var b = mask.bounds;
    var w = imgData.width,
        h = imgData.height;

    for (var x = b.minX; x <= b.maxX; x++) {
      for (var y = b.minY; y <= b.maxY; y++) {
        var i = y * w + x; // * bytes; // point index in the image data
        if (mask.data[i]) {
          imgData.data[i * 4] = color[0];
          imgData.data[i * 4 + 1] = color[1];
          imgData.data[i * 4 + 2] = color[2];
          imgData.data[i * 4 + 3] = color[3];
        }
      }
    }if (ctx.constructor.name != "ImageData") {
      ctx.clearRect(0, 0, w, h);
      ctx.putImageData(imgData, 0, 0);
    }
  };

  lib.selectBackground = function (ctx, sampleColor, colorThreshold) {
    var image = _getImageData(ctx);

    colorThreshold = colorThreshold || 15;

    var mask = new SelectionMask(image.width, image.height);
    mask.bounds = {
      minX: Infinity,
      minY: Infinity,
      maxY: -1,
      maxX: -1
    };

    var data = image.data;

    sampleColor = sampleColor || [data[0], data[1], data[2], data[3]]; // start point color (sample)

    var color = sampleColor;

    function add(x, y) {
      if (!lib.acceptable(x, y, image, mask.data, sampleColor, colorThreshold)) return;
      if (!sampleColor) {
        var index = (y * image.width + x) * 4;
        color = [data[index], data[index + 1], data[index + 2], data[index + 3]];
      }
      var mask2 = MagicWand.floodFill(image, x, y, colorThreshold, null, color);
      mask = MagicWand.add(mask, mask2);
    }

    var x, y;

    for (x = 0; x < image.width; x++) {
      add(x, 0);
    }
    for (x = 0; x < image.width; x++) {
      add(x, image.height - 1);
    }
    for (y = 0; y < image.height; y++) {
      add(image.width - 1, y);
    }
    for (y = 0; y < image.height; y++) {
      add(0, y);
    }
    return mask;
  };

  lib.extractColors = function (mixedType, threshold) {
    threshold = threshold || 60;
    var imgData = lib.getImageData(mixedType);
    var _colors = [];
    var c1;
    for (var x = 1; x < imgData.width; x += 3) {
      for (var y = 1; y < imgData.height; y += 3) {
        var iii = (x + y * imgData.width) * 4;
        var iiA = (x - 1 + y * imgData.width) * 4;
        var iiB = (x + 1 + y * imgData.width) * 4;
        var iiC = (x - 1 + (y + 1) * imgData.width) * 4;
        var iiD = (x + 1 + (y + 1) * imgData.width) * 4;
        if (imgData.data[iii + 3] < 255) continue;

        c1 = [imgData.data[iii], imgData.data[iii + 1], imgData.data[iii + 2]];
        var cA = [imgData.data[iiA], imgData.data[iiA + 1], imgData.data[iiA + 2]];
        var cB = [imgData.data[iiB], imgData.data[iiB + 1], imgData.data[iiB + 2]];
        var cC = [imgData.data[iiC], imgData.data[iiC + 1], imgData.data[iiC + 2]];
        var cD = [imgData.data[iiD], imgData.data[iiD + 1], imgData.data[iiD + 2]];

        if (c1[0] != cA[0] || cA[0] != cB[0] || cB[0] != cC[0] || cC[0] != cD[0] || c1[1] != cA[1] || cA[1] != cB[1] || cB[1] != cC[1] || cC[1] != cD[1] || c1[2] != cA[2] || cA[2] != cB[2] || cB[2] != cC[2] || cC[2] != cD[2]) {
          continue;
        }

        var isNewColor = true;

        for (var i in _colors) {
          if (MagicWand.difference(_colors[i], c1) < threshold) {
            isNewColor = false;
            break;
          }
        }
        if (isNewColor) {
          _colors.push(c1);
        }
      }
    }
    return _colors;
  };

  /**
   * image
   * canvas - черно блое изображение.
   *
   * mask- предыдущая маска. на нее будет накладывать новая
   * mode - способ наложения.
   */
  lib.maskSelection = function (canvas, left, top, mask, mode) {
    left = left || 0;
    top = top || 0;
    if (canvas.constructor.name == "HTMLImageElement") {

      var __canvas = createCanvasElement();
      __canvas.width = canvas.width;
      __canvas.height = canvas.height;
      var __ctx = __canvas.getContext('2d');
      __ctx.drawImage(canvas, 0, 0);
      canvas = __canvas;
    }

    var ctx = canvas.getContext('2d'),
        imgData = ctx.getImageData(0, 0, canvas.width, canvas.height),
        mask = mask || MagicWand.createMask(canvas.width, canvas.height);

    var _x1 = Math.max(0, -left),
        _y1 = Math.max(0, -top),
        _x2 = Math.min(mask.width - left, canvas.width);
    _y2 = Math.min(mask.height - top, canvas.height);

    for (var x = _x1; x < _x2; x++) {
      for (var y = _y1; y < _y2; y++) {
        var index = (canvas.width * y + x) * 4;

        if (imgData.data[index] > 20) {
          var index2 = mask.width * (y + top) + x + left;
          mask.data[index2] = 1;
          mask.count++;
        }
      }
    }
    return mask;
  }, lib.selectRectangle = function (image, x1, y1, x2, y2) {

    var mask = new SelectionMask(image.width, image.height);
    var minX = Math.min(x1, x2);
    var maxX = Math.max(x1, x2);
    var minY = Math.min(y1, y2);
    var maxY = Math.max(y1, y2);

    var w = image.width,
        h = image.height;

    var data = image.data;
    for (var y = minY; y <= maxY; y++) {
      for (var x = minX; x <= maxX; x++) {
        if (data[(y * w + x) * 4 + 3]) {
          mask.data[y * w + x] = 1;
          mask.count++;
        }
      }
    }

    mask.bounds = {
      minX: minX,
      minY: minY,
      maxX: maxX,
      maxY: maxY
    };

    return mask;
  };

  lib.bytes = 4;

  lib.__floodFill = function (e, postMessage) {

    data = e.data;
    var image = data[0],
        px = data[1],
        py = data[2],
        colorThreshold = data[3],
        options = data[4];

    options = options || {};
    /*{
     visitedPointsArray,
     sampleColor,
     resultMask
     }*/

    var c,
        x,
        newY,
        el,
        xr,
        xl,
        dy,
        dyl,
        dyr,
        checkY,
        data = image.data,
        w = image.width,
        h = image.height,
        bytes = lib.bytes,
        i = py * w + px; // start point index in the mask data
    i = i * bytes; // start point index in the image data

    var visited = options.visitedPoints || new Uint8Array(w * h),
        // mask of visited points
    sampleColor = options.sampleColor || [data[i], data[i + 1], data[i + 2], data[i + 3]],
        // start point color (sample)
    result = options.activeMask;

    function acceptable(x, y) {
      // check whether the point has been visited
      if (visited[y * image.width + x] === 1) {
        return false;
      }
      var i = (y * image.width + x) * lib.bytes,
          color2 = [image.data[i], image.data[i + 1], image.data[i + 2], image.data[i + 3]];
      if (sampleColor[0] !== false && Math.abs(sampleColor[0] - color2[0]) > colorThreshold) return false;
      if (sampleColor[1] !== false && Math.abs(sampleColor[1] - color2[1]) > colorThreshold) return false;
      if (sampleColor[2] !== false && Math.abs(sampleColor[2] - color2[2]) > colorThreshold) return false;
      if (sampleColor[3] !== false && Math.abs(sampleColor[3] - color2[3]) > colorThreshold) return false;
      return true;
    };

    if (visited[i] === 1) return null;

    var first = true;
    var stack = [{ y: py, left: px - 1, right: px + 1, dir: 1 }]; // first scanning line

    var mode = 'strict';
    var _ci;
    do {
      el = stack.shift(); // get line for scanning

      checkY = false;
      for (x = el.left + 1; x < el.right; x++) {
        dy = el.y * w;

        if (mode == 'gradient' && !first) {
          _ci = (dy + x + (el.dir == -1 ? w : -w)) * 4;
          sampleColor = [data[_ci], data[_ci + 1], data[_ci + 2], data[_ci + 3]];
        }
        if (!acceptable(x, el.y, image, visited, sampleColor, colorThreshold)) continue;

        first = false;

        checkY = true; // if the color of the new point(x,y) is similar to the sample color need to check minmax for Y

        result.count++;

        result.data[dy + x] = 1; // mark a new point in mask
        visited[dy + x] = 1; // mark a new point as visited

        xl = x - 1;
        // walk to left side starting with the left neighbor
        while (xl > -1) {
          dyl = dy + xl;

          if (mode == 'gradient') {
            _ci = (dyl + 1) * 4;
            sampleColor = [data[_ci], data[_ci + 1], data[_ci + 2], data[_ci + 3]];
          }
          if (!acceptable(xl, el.y, image, visited, sampleColor, colorThreshold)) break;

          result.count++;
          result.data[dyl] = 1;
          visited[dyl] = 1;

          xl--;
        }
        xr = x + 1;
        // walk to right side starting with the right neighbor
        while (xr < w) {
          dyr = dy + xr;

          if (mode == 'gradient') {
            _ci = (dyr - 1) * 4;
            sampleColor = [data[_ci], data[_ci + 1], data[_ci + 2], data[_ci + 3]];
          }
          if (!acceptable(xr, el.y, image, visited, sampleColor, colorThreshold)) {
            break;
          }

          result.count++;
          result.data[dyr] = 1;
          visited[dyr] = 1;
          xr++;
        }

        // check minmax for X
        if (xl < result.bounds.minX) result.bounds.minX = xl + 1;
        if (xr > result.bounds.maxX) result.bounds.maxX = xr - 1;

        newY = el.y - el.dir;
        if (newY >= 0 && newY < h) {
          if (xl < xr) stack.push({ y: newY, left: xl, right: xr, dir: -el.dir }); // from "new left" to "new right"
          // add two scanning lines in the opposite direction (y - dir) if necessary
          // if (xl <= el.left) stack.push({y: newY, left: xl, right: el.left, dir: -el.dir}); // from "new left" to "current left"
          // if (el.right <= xr) stack.push({y: newY, left: el.right, right: xr, dir: -el.dir}); // from "current right" to "new right"
        }
        newY = el.y + el.dir;
        if (newY >= 0 && newY < h) {
          // add the scanning line in the direction (y + dir) if necessary
          if (xl < xr) stack.push({ y: newY, left: xl, right: xr, dir: el.dir }); // from "new left" to "new right"
        }
      }
      // check minmax for Y if necessary
      if (checkY) {
        if (el.y < result.bounds.minY) result.bounds.minY = el.y;
        if (el.y > result.bounds.maxY) result.bounds.maxY = el.y;
      }
    } while (stack.length > 0);

    postMessage && postMessage(result);
    return result;
  };

  lib.extendMask = function (mask, value) {

    var mask2 = new SelectionMask(mask.width + 2, mask.height + 2);
    if (value) {
      mask2.data.fill(value);
    }

    for (var y = 0; y < mask.height; y++) {
      for (var x = 0; x < mask.width; x++) {
        mask2.data[(y + 1) * mask2.width + x + 1] = mask.data[y * mask.width + x];
      }
    }
    mask2.count = mask.count;

    if (!value) {
      mask2.bounds = {
        minX: mask.bounds.minX + 1,
        maxX: mask.bounds.maxX + 1,
        maxY: mask.bounds.maxY + 1,
        minY: mask.bounds.minY + 1
      };
    } else {
      mask2.bounds = mask.bounds;
    }

    return mask2;
  };

  /** Create a binary mask on the image by color threshold
   * Algorithm: Scanline flood fill (http://en.wikipedia.org/wiki/Flood_fill)
   * @param {Object} image: {Uint8Array} data, {int} width, {int} height, {int} bytes
   * @param {int} x of start pixel
   * @param {int} y of start pixel
   * @param {int} color threshold
   * @param {Uint8Array} mask of visited points (optional)
   * @return {Object} mask: {Uint8Array} data, {int} width, {int} height, {Object} bounds
   */
  lib.floodFill = function (image, px, py, colorThreshold, options, color, callback) {
    options = options || {};
    options.activeMask = options.activeMask || new SelectionMask(image.width, image.height);

    return lib.__floodFill({ data: [image, px, py, colorThreshold, options, color] }, callback);

    /*
    var worker = _.worker(lib.__floodFill);
    worker.onmessage = function(e){
      var mask = new SelectionMask(e.data);
      callback && callback(mask);
    };
    worker.postMessage([image, px, py, colorThreshold, options]);
    */
  };

  lib.substract = function (mask, mask2) {
    var minX, maxX, minY, maxY;

    var result = new SelectionMask(mask.width, mask.height);
    var bounds = mask2.bounds;

    var minX = false,
        minY = mask.height,
        maxX = false,
        maxY = -1;

    for (var x = bounds.minX; x <= bounds.maxX; x++) {
      for (var y = bounds.minY; y <= bounds.maxY; y++) {
        var index = mask.width * y + x;

        if (!mask.data[index] && mask2.data[index]) {
          result.data[index] = 1;
          result.count++;
          if (result.bounds.minY > y) result.bounds.minY = y;
          if (result.bounds.maxY < y) result.bounds.maxY = y;
          if (result.bounds.minX > x) result.bounds.minX = x;
          if (result.bounds.maxX < x) result.bounds.maxX = x;
        }
      }
    }

    return result;
  };

  lib.getImageData = function (mixedType) {
    var canvas;
    if (mixedType.constructor.name == "Image" || mixedType.constructor.name == "HTMLImageElement") {
      var _canvas = createCanvasElement();
      _canvas.width = mixedType.width;
      _canvas.height = mixedType.height;
      var ctx = _canvas.getContext("2d");
      ctx.drawImage(mixedType, 0, 0);
      canvas = _canvas;
    } else {
      canvas = mixedType;
    }
    if (canvas.constructor.name == "HTMLCanvasElement" || canvas.constructor.name == "Canvas") {
      var imgData = canvas.getContext("2d").getImageData(0, 0, canvas.width, canvas.height);
    } else {
      imgData = mixedType;
    }
    return imgData;
  };

  lib.getColoredPixels = function (mixedType) {
    var imgData = lib.getImageData(mixedType);
    var data = imgData.data;
    var pixels = 0;
    for (var i = 3; i < data.length; i += 4) {
      if (data[i]) {
        pixels += data[i] / 255;
      }
    }
    return pixels;
  };

  lib.invertMask = function (mask) {
    var result = new SelectionMask(mask.width, mask.height);
    result.bounds = {
      minX: Infinity,
      minY: Infinity,
      maxY: -1,
      maxX: -1
    };

    for (var x = 0; x < mask.width; x++) {
      for (var y = 0; y < mask.height; y++) {
        var index = mask.width * y + x;
        if (!mask.data[index]) {
          result.data[index] = 1;
          result.count++;
          if (result.bounds.minY > y) result.bounds.minY = y;
          if (result.bounds.maxY < y) result.bounds.maxY = y;
          if (result.bounds.minX > x) result.bounds.minX = x;
          if (result.bounds.maxX < x) result.bounds.maxX = x;
        }
      }
    }
    return result;
  };

  lib.exclude = function (mask, mask2) {
    var result = new SelectionMask(mask.width, mask.height);
    var bounds = {
      minX: Math.min(mask.bounds.minX, mask2.bounds.minX),
      maxX: Math.max(mask.bounds.maxX, mask2.bounds.maxX),
      minY: Math.min(mask.bounds.minY, mask2.bounds.minY),
      maxY: Math.max(mask.bounds.maxY, mask2.bounds.maxY)
    };

    var minX = false,
        minY = mask.height,
        maxX = false,
        maxY = -1;

    for (var x = bounds.minX; x <= bounds.maxX; x++) {
      for (var y = bounds.minY; y <= bounds.maxY; y++) {
        var index = mask2.width * y + x;

        if (mask.data[index] ^ mask2.data[index]) {
          result.data[index] = 1;
          result.count++;
          maxX = x;
          if (minY > y) minY = y;
          if (maxY < y) maxY = y;
          if (minX === false) {
            minX = x;
          }
        }
      }
    }

    result.bounds = {
      minX: minX,
      maxX: maxX,
      minY: minY,
      maxY: maxY
    };

    return result;
  };

  lib.intersect = function (mask, mask2) {
    var minX, maxX, minY, maxY;

    var result = new SelectionMask(mask.width, mask.height);
    var bounds = {
      minX: Math.max(mask.bounds.minX, mask2.bounds.minX),
      maxX: Math.min(mask.bounds.maxX, mask2.bounds.maxX),
      minY: Math.max(mask.bounds.minY, mask2.bounds.minY),
      maxY: Math.min(mask.bounds.maxY, mask2.bounds.maxY)
    };

    var minX = false,
        minY = mask.height,
        maxX = false,
        maxY = -1;

    for (var x = bounds.minX; x <= bounds.maxX; x++) {
      for (var y = bounds.minY; y <= bounds.maxY; y++) {
        var index = mask2.width * y + x;

        if (mask.data[index] && mask2.data[index]) {
          result.data[index] = 1;
          result.count++;
          maxX = x;
          if (minY > y) minY = y;
          if (maxY < y) maxY = y;
          if (minX === false) {
            minX = x;
          }
        }
      }
    }

    result.bounds = {
      minX: minX,
      maxX: maxX,
      minY: minY,
      maxY: maxY
    };

    return result;
  };

  lib.add = function (mask, mask2) {
    var result = new SelectionMask(mask.width, mask.height);

    result.bounds = {
      minX: Math.min(mask.bounds.minX, mask2.bounds.minX),
      maxX: Math.max(mask.bounds.maxX, mask2.bounds.maxX),
      minY: Math.min(mask.bounds.minY, mask2.bounds.minY),
      maxY: Math.max(mask.bounds.maxY, mask2.bounds.maxY)
    };

    for (var x = result.bounds.minX; x <= result.bounds.maxX; x++) {
      for (var y = result.bounds.minY; y <= result.bounds.maxY; y++) {
        var index = mask2.width * y + x;

        if (mask.data[index] || mask2.data[index]) {
          result.data[index] = 1;
          result.count++;
        }
      }
    }

    return result;
  };

  /** Apply the gauss-blur filter to binary mask
   * Algorithms: http://blog.ivank.net/fastest-gaussian-blur.html
   * http://www.librow.com/articles/article-9
   * http://elynxsdk.free.fr/ext-docs/Blur/Fast_box_blur.pdf
   * @param {Object} mask: {Uint8Array} data, {int} width, {int} height, {Object} bounds
   * @param {int} blur radius
   * @return {Object} mask: {Uint8Array} data, {int} width, {int} height, {Object} bounds
   */
  lib.gaussBlur = function (mask, radius) {

    var i,
        k,
        k1,
        x,
        y,
        val,
        start,
        end,
        n = radius * 2 + 1,
        // size of the pattern for radius-neighbors (from -r to +r with the center point)
    s2 = radius * radius,
        wg = new Float32Array(n),
        // weights
    total = 0,
        // sum of weights(used for normalization)
    w = mask.width,
        h = mask.height,
        data = mask.data,
        minX = mask.bounds.minX,
        maxX = mask.bounds.maxX,
        minY = mask.bounds.minY,
        maxY = mask.bounds.maxY,
        count = 0;

    // calc gauss weights
    for (i = 0; i < radius; i++) {
      var dsq = (radius - i) * (radius - i);
      var ww = Math.exp(-dsq / (2.0 * s2)) / (2 * Math.PI * s2);
      wg[radius + i] = wg[radius - i] = ww;
      total += 2 * ww;
    }
    // normalization weights
    for (i = 0; i < n; i++) {
      wg[i] /= total;
    }

    var result = new Uint8Array(w * h),
        // result mask
    endX = radius + w,
        endY = radius + h;

    //walk through all source points for blur
    for (y = minY; y < maxY + 1; y++) {
      for (x = minX; x < maxX + 1; x++) {
        val = 0;
        k = y * w + x; // index of the point
        start = radius - x > 0 ? radius - x : 0;
        end = endX - x < n ? endX - x : n; // Math.min((((w - 1) - x) + radius) + 1, n);
        k1 = k - radius;
        // walk through x-neighbors
        for (i = start; i < end; i++) {
          val += data[k1 + i] * wg[i];
        }
        start = radius - y > 0 ? radius - y : 0;
        end = endY - y < n ? endY - y : n; // Math.min((((h - 1) - y) + radius) + 1, n);
        k1 = k - radius * w;
        // walk through y-neighbors
        for (i = start; i < end; i++) {
          val += data[k1 + i * w] * wg[i];
        }
        if (val > 0.5) {
          result[k] = 1;
          count++;
        } else {
          result[k] = 0;
        }
      }
    }return {
      count: count,
      data: result,
      width: w,
      height: h,
      bounds: {
        minX: minX,
        minY: minY,
        maxX: maxX,
        maxY: maxY
      }
    };
  };

  /** Create a border index array of boundary points of the mask with radius-neighbors
   * @param {Object} mask: {Uint8Array} data, {int} width, {int} height, {Object} bounds
   * @param {int} radius: blur radius
   * @param {Uint8Array} visited: mask of visited points (optional)
   * @return {Array} border index array of boundary points with radius-neighbors (only points need for blur)
   */
  function createBorderForBlur(mask, radius, visited) {

    var x,
        i,
        j,
        y,
        k,
        k1,
        k2,
        w = mask.width,
        h = mask.height,
        data = mask.data,
        visitedData = new Uint8Array(data),
        minX = mask.bounds.minX,
        maxX = mask.bounds.maxX,
        minY = mask.bounds.minY,
        maxY = mask.bounds.maxY,
        len = w * h,
        temp = new Uint8Array(len),
        // auxiliary array to check uniqueness
    border = [],
        // only border points
    x0 = Math.max(minX, 1),
        x1 = Math.min(maxX, w - 2),
        y0 = Math.max(minY, 1),
        y1 = Math.min(maxY, h - 2);

    if (visited && visited.length > 0) {
      // copy visited points (only "black")
      for (k = 0; k < len; k++) {
        if (visited[k] === 1) visitedData[k] = 1;
      }
    }

    // walk through inner values except points on the boundary of the image
    for (y = y0; y < y1 + 1; y++) {
      for (x = x0; x < x1 + 1; x++) {
        k = y * w + x;
        if (data[k] === 0) continue; // "white" point isn't the border
        k1 = k + w; // y + 1
        k2 = k - w; // y - 1
        // check if any neighbor with a "white" color
        if (visitedData[k + 1] === 0 || visitedData[k - 1] === 0 || visitedData[k1] === 0 || visitedData[k1 + 1] === 0 || visitedData[k1 - 1] === 0 || visitedData[k2] === 0 || visitedData[k2 + 1] === 0 || visitedData[k2 - 1] === 0) {
          //if (visitedData[k + 1] + visitedData[k - 1] +
          //    visitedData[k1] + visitedData[k1 + 1] + visitedData[k1 - 1] +
          //    visitedData[k2] + visitedData[k2 + 1] + visitedData[k2 - 1] == 8) continue;
          border.push(k);
        }
      }
    } // walk through points on the boundary of the image if necessary
    // if the "black" point is adjacent to the boundary of the image, it is a border point
    if (minX == 0) for (y = minY; y < maxY + 1; y++) {
      if (data[y * w] === 1) border.push(y * w);
    }if (maxX == w - 1) for (y = minY; y < maxY + 1; y++) {
      if (data[y * w + maxX] === 1) border.push(y * w + maxX);
    }if (minY == 0) for (x = minX; x < maxX + 1; x++) {
      if (data[x] === 1) border.push(x);
    }if (maxY == h - 1) for (x = minX; x < maxX + 1; x++) {
      if (data[maxY * w + x] === 1) border.push(maxY * w + x);
    }var result = [],
        // border points with radius-neighbors
    start,
        end,
        endX = radius + w,
        endY = radius + h,
        n = radius * 2 + 1; // size of the pattern for radius-neighbors (from -r to +r with the center point)

    len = border.length;
    // walk through radius-neighbors of border points and add them to the result array
    for (j = 0; j < len; j++) {
      k = border[j]; // index of the border point
      temp[k] = 1; // mark border point
      result.push(k); // save the border point
      x = k % w; // calc x by index
      y = (k - x) / w; // calc y by index
      start = radius - x > 0 ? radius - x : 0;
      end = endX - x < n ? endX - x : n; // Math.min((((w - 1) - x) + radius) + 1, n);
      k1 = k - radius;
      // walk through x-neighbors
      for (i = start; i < end; i++) {
        k2 = k1 + i;
        if (temp[k2] === 0) {
          // check the uniqueness
          temp[k2] = 1;
          result.push(k2);
        }
      }
      start = radius - y > 0 ? radius - y : 0;
      end = endY - y < n ? endY - y : n; // Math.min((((h - 1) - y) + radius) + 1, n);
      k1 = k - radius * w;
      // walk through y-neighbors
      for (i = start; i < end; i++) {
        k2 = k1 + i * w;
        if (temp[k2] === 0) {
          // check the uniqueness
          temp[k2] = 1;
          result.push(k2);
        }
      }
    }

    return result;
  };

  /** Apply the gauss-blur filter ONLY to border points with radius-neighbors
   * Algorithms: http://blog.ivank.net/fastest-gaussian-blur.html
   * http://www.librow.com/articles/article-9
   * http://elynxsdk.free.fr/ext-docs/Blur/Fast_box_blur.pdf
   * @param  {Object}     mask:     {Uint8Array} data, {int} width, {int} height, {Object} bounds
   * @param  {int}        radius:   blur radius
   * @param  {Uint8Array} visited:  mask of visited points (optional)
   * @return {Object}     mask:     {Uint8Array} data, {int} width, {int} height, {Object} bounds
   */
  lib.gaussBlurOnlyBorder = function (mask, radius, visited) {

    var border = createBorderForBlur(mask, radius, visited),
        // get border points with radius-neighbors
    ww,
        dsq,
        i,
        j,
        k,
        k1,
        x,
        y,
        val,
        start,
        end,
        n = radius * 2 + 1,
        // size of the pattern for radius-neighbors (from -r to +r with center point)
    s2 = 2 * radius * radius,
        wg = new Float32Array(n),
        // weights
    total = 0,
        // sum of weights(used for normalization)
    w = mask.width,
        h = mask.height,
        data = mask.data,
        minX = mask.bounds.minX,
        maxX = mask.bounds.maxX,
        minY = mask.bounds.minY,
        maxY = mask.bounds.maxY,
        len = border.length;

    // calc gauss weights
    for (i = 0; i < radius; i++) {
      dsq = (radius - i) * (radius - i);
      ww = Math.exp(-dsq / s2) / Math.PI;
      wg[radius + i] = wg[radius - i] = ww;
      total += 2 * ww;
    }
    // normalization weights
    for (i = 0; i < n; i++) {
      wg[i] /= total;
    }

    var result = new SelectionMask(w, h, data),
        // copy the source mask
    endX = radius + w,
        endY = radius + h;

    //walk through all border points for blur
    for (i = 0; i < len; i++) {
      k = border[i]; // index of the border point
      val = 0;
      x = k % w; // calc x by index
      y = (k - x) / w; // calc y by index
      start = radius - x > 0 ? radius - x : 0;
      end = endX - x < n ? endX - x : n; // Math.min((((w - 1) - x) + radius) + 1, n);
      k1 = k - radius;
      // walk through x-neighbors
      for (j = start; j < end; j++) {
        val += data[k1 + j] * wg[j];
      }
      if (val > 0.5) {
        result.data[k] = 1;
        result.count++;
        // check minmax
        if (x < minX) minX = x;
        if (x > maxX) maxX = x;
        if (y < minY) minY = y;
        if (y > maxY) maxY = y;
        continue;
      }
      start = radius - y > 0 ? radius - y : 0;
      end = endY - y < n ? endY - y : n; // Math.min((((h - 1) - y) + radius) + 1, n);
      k1 = k - radius * w;
      // walk through y-neighbors
      for (j = start; j < end; j++) {
        val += data[k1 + j * w] * wg[j];
      }
      if (val > 0.5) {
        result.data[k] = 1;
        result.count++;
        // check minmax
        if (x < minX) minX = x;
        if (x > maxX) maxX = x;
        if (y < minY) minY = y;
        if (y > maxY) maxY = y;
      } else {
        result.data[k] = 0;
      }
    }
    result.bounds = {
      minX: minX,
      minY: minY,
      maxX: maxX,
      maxY: maxY
    };

    return result;
  };

  /** Create a border mask (only boundary points)
   * @param {Object} mask: {Uint8Array} data, {int} width, {int} height, {Object} bounds
   * @return {Object} border mask: {Uint8Array} data, {int} width, {int} height, {Object} offset
   */
  lib.createBorderMask = function (mask) {

    var x,
        y,
        k,
        k1,
        k2,
        w = mask.width,
        h = mask.height,
        data = mask.data,
        minX = mask.bounds.minX,
        maxX = mask.bounds.maxX,
        minY = mask.bounds.minY,
        maxY = mask.bounds.maxY,
        rw = maxX - minX + 1,
        // bounds size
    rh = maxY - minY + 1,
        result = new Uint8Array(rw * rh),
        // reduced mask (bounds size)
    x0 = Math.max(minX, 1),
        x1 = Math.min(maxX, w - 2),
        y0 = Math.max(minY, 1),
        y1 = Math.min(maxY, h - 2),
        count = 0;

    // walk through inner values except points on the boundary of the image
    for (y = y0; y < y1 + 1; y++) {
      for (x = x0; x < x1 + 1; x++) {
        k = y * w + x;
        if (data[k] === 0) continue; // "white" point isn't the border
        k1 = k + w; // y + 1
        k2 = k - w; // y - 1
        // check if any neighbor with a "white" color
        if (data[k + 1] === 0 || data[k - 1] === 0 || data[k1] === 0 || data[k1 + 1] === 0 || data[k1 - 1] === 0 || data[k2] === 0 || data[k2 + 1] === 0 || data[k2 - 1] === 0) {
          //if (data[k + 1] + data[k - 1] +
          //    data[k1] + data[k1 + 1] + data[k1 - 1] +
          //    data[k2] + data[k2 + 1] + data[k2 - 1] == 8) continue;
          result[(y - minY) * rw + (x - minX)] = 1;
          count++;
        }
      }
    } // walk through points on the boundary of the image if necessary
    // if the "black" point is adjacent to the boundary of the image, it is a border point
    if (minX == 0) for (y = minY; y < maxY + 1; y++) {
      if (data[y * w] === 1) {
        result[(y - minY) * rw] = 1;
        count++;
      }
    }if (maxX == w - 1) for (y = minY; y < maxY + 1; y++) {
      if (data[y * w + maxX] === 1) {
        result[(y - minY) * rw + (maxX - minX)] = 1;
        count++;
      }
    }if (minY == 0) for (x = minX; x < maxX + 1; x++) {
      if (data[x] === 1) {
        result[x - minX] = 1;
        count++;
      }
    }if (maxY == h - 1) for (x = minX; x < maxX + 1; x++) {
      if (data[maxY * w + x] === 1) {
        result[(maxY - minY) * rw + (x - minX)] = 1;
        count++;
      }
    }return {
      count: count,
      data: result,
      width: rw,
      height: rh,
      offset: { x: minX, y: minY }
    };
  };

  /** Create a border index array of boundary points of the mask
   * @param {Object} mask: {Uint8Array} data, {int} width, {int} height
   * @return {Array} border index array boundary points of the mask
   */
  lib.getBorderIndices = function (mask) {

    var x,
        y,
        k,
        k1,
        k2,
        w = mask.width,
        h = mask.height,
        data = mask.data,
        border = [],
        // only border points
    x1 = w - 1,
        y1 = h - 1;

    // walk through inner values except points on the boundary of the image
    for (y = 1; y < y1; y++) {
      for (x = 1; x < x1; x++) {
        k = y * w + x;
        if (data[k] === 0) continue; // "white" point isn't the border
        k1 = k + w; // y + 1
        k2 = k - w; // y - 1
        // check if any neighbor with a "white" color
        if (data[k + 1] === 0 || data[k - 1] === 0 || data[k1] === 0 || data[k1 + 1] === 0 || data[k1 - 1] === 0 || data[k2] === 0 || data[k2 + 1] === 0 || data[k2 - 1] === 0) {
          //if (data[k + 1] + data[k - 1] +
          //    data[k1] + data[k1 + 1] + data[k1 - 1] +
          //    data[k2] + data[k2 + 1] + data[k2 - 1] == 8) continue;
          border.push(k);
        }
      }
    } // walk through points on the boundary of the image if necessary
    // if the "black" point is adjacent to the boundary of the image, it is a border point
    for (y = 0; y < h; y++) {
      if (data[y * w] === 1) border.push(y * w);
    }for (x = 0; x < w; x++) {
      if (data[x] === 1) border.push(x);
    }k = w - 1;
    for (y = 0; y < h; y++) {
      if (data[y * w + k] === 1) border.push(y * w + k);
    }k = (h - 1) * w;
    for (x = 0; x < w; x++) {
      if (data[k + x] === 1) border.push(k + x);
    }return border;
  };

  /** Create a compressed mask with a "white" border (1px border with zero values) for the contour tracing
   * @param {Object} mask: {Uint8Array} data, {int} width, {int} height, {Object} bounds
   * @return {Object} border mask: {Uint8Array} data, {int} width, {int} height, {Object} offset
   */
  function prepareMask(mask) {
    var x,
        y,
        w = mask.width,
        data = mask.data,
        minX = mask.bounds.minX,
        maxX = mask.bounds.maxX,
        minY = mask.bounds.minY,
        maxY = mask.bounds.maxY,
        rw = maxX - minX + 3,
        // bounds size +1 px on each side (a "white" border)
    rh = maxY - minY + 3,
        result = new Uint8Array(rw * rh); // reduced mask (bounds size)

    // walk through inner values and copy only "black" points to the result mask
    for (y = minY; y < maxY + 1; y++) {
      for (x = minX; x < maxX + 1; x++) {
        if (data[y * w + x] === 1) result[(y - minY + 1) * rw + (x - minX + 1)] = 1;
      }
    }return {
      data: result,
      width: rw,
      height: rh,
      offset: { x: minX - 1, y: minY - 1 }
    };
  };

  /** Create a contour array for the binary mask
   * Algorithm: http://www.sciencedirect.com/science/article/pii/S1077314203001401
   * @param {Object} mask: {Uint8Array} data, {int} width, {int} height, {Object} bounds
   * @return {Array} contours: {Array} points, {bool} inner, {int} label
   */
  lib.traceContours = function (mask) {
    var m = prepareMask(mask),
        contours = [],
        label = 0,
        w = m.width,
        w2 = w * 2,
        h = m.height,
        src = m.data,
        dx = m.offset.x,
        dy = m.offset.y,
        bounds,
        _p,
        dest = new Uint8Array(src),
        // label matrix
    i,
        j,
        x,
        y,
        k,
        k1,
        c,
        inner,
        dir,
        first,
        second,
        current,
        previous,
        next,
        d;

    // all [dx,dy] pairs (array index is the direction)
    // 5 6 7
    // 4 X 0
    // 3 2 1
    var directions = [[1, 0], [1, 1], [0, 1], [-1, 1], [-1, 0], [-1, -1], [0, -1], [1, -1]];

    for (y = 1; y < h - 1; y++) {
      for (x = 1; x < w - 1; x++) {
        k = y * w + x;
        if (src[k] === 1) {
          for (i = -w; i < w2; i += w2) {
            // k - w: outer tracing (y - 1), k + w: inner tracing (y + 1)
            if (src[k + i] === 0 && dest[k + i] === 0) {
              // need contour tracing
              inner = i === w; // is inner contour tracing ?
              label++; // label for the next contour

              c = [];
              bounds = {
                minX: w,
                minY: h,
                maxX: -1,
                maxY: -1
              };
              dir = inner ? 2 : 6; // start direction
              current = previous = first = { x: x, y: y };
              second = null;
              while (true) {
                dest[current.y * w + current.x] = label; // mark label for the current point
                // bypass all the neighbors around the current point in a clockwise
                for (j = 0; j < 8; j++) {
                  dir = (dir + 1) % 8;

                  // get the next point by new direction
                  d = directions[dir]; // index as direction
                  next = { x: current.x + d[0], y: current.y + d[1] };

                  k1 = next.y * w + next.x;
                  if (src[k1] === 1) // black boundary pixel
                    {
                      dest[k1] = label; // mark a label
                      break;
                    }
                  dest[k1] = -1; // mark a white boundary pixel
                  next = null;
                }
                if (next === null) break; // no neighbours (one-point contour)
                current = next;
                if (second) {
                  if (previous.x === first.x && previous.y === first.y && current.x === second.x && current.y === second.y) {
                    break; // creating the contour completed when returned to original position
                  }
                } else {
                  second = next;
                }
                _p = { x: previous.x + dx, y: previous.y + dy };
                if (bounds.minX > _p.x) bounds.minX = _p.x;
                if (bounds.maxX < _p.x) bounds.maxX = _p.x;
                if (bounds.minY > _p.y) bounds.minY = _p.y;
                if (bounds.maxY < _p.y) bounds.maxY = _p.y;
                c.push(_p);
                previous = current;
                dir = (dir + 4) % 8; // next dir (symmetrically to the current direction)
              }

              if (next != null) {
                _p = { x: first.x + dx, y: first.y + dy };
                if (bounds.minX > _p.x) bounds.minX = _p.x;
                if (bounds.maxX < _p.x) bounds.maxX = _p.x;
                if (bounds.minY > _p.y) bounds.minY = _p.y;
                if (bounds.maxY < _p.y) bounds.maxY = _p.y;
                c.push(_p); // close the contour
                contours.push({ inner: inner, label: label, points: c, bounds: bounds }); // add contour to the list
              }
            }
          }
        }
      }
    }return contours;
  };

  function rgbToHsl(r, g, b) {
    r /= 255, g /= 255, b /= 255;
    var max = Math.max(r, g, b),
        min = Math.min(r, g, b);
    var h,
        s,
        l = (max + min) / 2;

    if (max == min) {
      h = s = 0; // achromatic
    } else {
      var d = max - min;
      s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
      switch (max) {
        case r:
          h = (g - b) / d + (g < b ? 6 : 0);break;
        case g:
          h = (b - r) / d + 2;break;
        case b:
          h = (r - g) / d + 4;break;
      }
      h /= 6;
    }

    return [h * 255, s * 255, l * 255];
  }

  lib.simplifyContour = function (c, simplifyTolerant, simplifyCount) {
    var i, j, k, c, points, len, resPoints, lst, stack, ids, maxd, maxi, dist, r1, r2, r12, dx, dy, pi, pf, pl;

    points = c.points;
    len = c.points.length;

    if (len < simplifyCount) {
      // contour isn't simplified
      resPoints = [];
      for (k = 0; k < len; k++) {
        resPoints.push({ x: points[k].x, y: points[k].y });
      }
      return {
        bounds: c.bounds, inner: c.inner, label: c.label, points: resPoints, initialCount: len };
    }

    lst = [0, len - 1]; // always add first and last points
    stack = [{ first: 0, last: len - 1 }]; // first processed edge

    do {
      ids = stack.shift();
      if (ids.last <= ids.first + 1) // no intermediate points
        {
          continue;
        }

      maxd = -1.0; // max distance from point to current edge
      maxi = ids.first; // index of maximally distant point

      for (i = ids.first + 1; i < ids.last; i++) // bypass intermediate points in edge
      {
        // calc the distance from current point to edge
        pi = points[i];
        pf = points[ids.first];
        pl = points[ids.last];
        dx = pi.x - pf.x;
        dy = pi.y - pf.y;
        r1 = Math.sqrt(dx * dx + dy * dy);
        dx = pi.x - pl.x;
        dy = pi.y - pl.y;
        r2 = Math.sqrt(dx * dx + dy * dy);
        dx = pf.x - pl.x;
        dy = pf.y - pl.y;
        r12 = Math.sqrt(dx * dx + dy * dy);
        if (r1 >= Math.sqrt(r2 * r2 + r12 * r12)) dist = r2;else if (r2 >= Math.sqrt(r1 * r1 + r12 * r12)) dist = r1;else dist = Math.abs((dy * pi.x - dx * pi.y + pf.x * pl.y - pl.x * pf.y) / r12);

        if (dist > maxd) {
          maxi = i; // save the index of maximally distant point
          maxd = dist;
        }
      }

      if (maxd > simplifyTolerant) // if the max "deviation" is larger than allowed then...
        {
          lst.push(maxi); // add index to the simplified list
          stack.push({ first: ids.first, last: maxi }); // add the left part for processing
          stack.push({ first: maxi, last: ids.last }); // add the right part for processing
        }
    } while (stack.length > 0);

    resPoints = [];
    len = lst.length;
    lst.sort(function (a, b) {
      return a - b;
    }); // restore index order
    for (k = 0; k < len; k++) {
      resPoints.push({ x: points[lst[k]].x, y: points[lst[k]].y }); // add result points to the correct order
    }
    return {
      bounds: c.bounds,
      inner: c.inner, label: c.label, points: resPoints, initialCount: c.points.length
    };
  };

  /** Simplify contours
   * Algorithms: http://psimpl.sourceforge.net/douglas-peucker.html
   * http://neerc.ifmo.ru/wiki/index.php?title=%D0%A3%D0%BF%D1%80%D0%BE%D1%89%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BF%D0%BE%D0%BB%D0%B8%D0%B3%D0%BE%D0%BD%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D0%B9_%D1%86%D0%B5%D0%BF%D0%B8
   * @param {Array} contours: {Array} points, {bool} inner, {int} label
   * @param {float} simplify tolerant
   * @param {int} simplify count: min number of points when the contour is simplified
   * @return {Array} contours: {Array} points, {bool} inner, {int} label, {int} initialCount
   */
  lib.simplifyContours = function (contours, simplifyTolerant, simplifyCount) {
    var lenContours = contours.length,
        result = [];

    // walk through all contours
    for (var j = 0; j < lenContours; j++) {

      result.push(lib.simplifyContour(contours[j], simplifyTolerant, simplifyCount));
    }

    return result;
  };

  return lib;
}();
if (true) {
  module.exports = MagicWand;
}
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 11 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.debug = true;
fabric.extensions = [];
fabric.util.data = __webpack_require__(12);
fabric.util.path = __webpack_require__(4);
fabric.util.compile = __webpack_require__(5);
fabric.util.loader = __webpack_require__(14);
fabric.util.syntax = __webpack_require__(15);
fabric.util.object.extend(fabric.util.object, __webpack_require__(2));
fabric.util.object.extend(fabric.util, __webpack_require__(3));

//require('./modules');

__webpack_require__(16);
__webpack_require__(17);
__webpack_require__(18);
__webpack_require__(6);
__webpack_require__(19);
__webpack_require__(20);
__webpack_require__(21);
__webpack_require__(22);
__webpack_require__(23);
__webpack_require__(24);
__webpack_require__(25);
// require('./modules/slide.stretchable');
__webpack_require__(26);
__webpack_require__(8);
// require('./modules/slide.layers');
__webpack_require__(27);
__webpack_require__(28);
__webpack_require__(36);
__webpack_require__(37);
__webpack_require__(38);
__webpack_require__(40);
__webpack_require__(41);
__webpack_require__(42);
__webpack_require__(43);
__webpack_require__(44);
__webpack_require__(45);
__webpack_require__(47);
__webpack_require__(48);
__webpack_require__(49);
__webpack_require__(50);
__webpack_require__(51);
__webpack_require__(52);
__webpack_require__(54);
__webpack_require__(56);
__webpack_require__(57);
__webpack_require__(58);
__webpack_require__(59);
__webpack_require__(63);
__webpack_require__(64);
__webpack_require__(65);
__webpack_require__(66);
__webpack_require__(68);
__webpack_require__(69);
__webpack_require__(71);
__webpack_require__(72);
__webpack_require__(73);
__webpack_require__(78);
__webpack_require__(81);
__webpack_require__(83);

if (!fabric.isLikelyNode) {
  /**
   * inline script images
   * @type {{error: string}}
   */
  fabric.media = {
    /**
     * replace images loaded with errors
     */
    error: 'data:image/svg+xml;base64,' + __webpack_require__(84)
  };
}

module.exports = fabric;
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 12 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var path = __webpack_require__(4);
var util = __webpack_require__(3);
var object = __webpack_require__(2);

function isServer() {
  return !(typeof window != 'undefined' && window.document);
}

if (isServer()) {
  var fs = __webpack_require__(13);
}

function _load_json(value, callback_success, callback_error) {

  var output = null;
  var errors = [];

  if (value.constructor == String) {

    var filename, regex_data, init_property;
    regex_data = /^([^#]*)#?(.*)$/.exec(value);

    filename = regex_data[1];
    init_property = regex_data[2];
    utils.getInlineJson(filename, "json", _loadJson_data, function (error) {
      errors.push(error);
      if (callback_error) {
        callback_error(error);
      } else {
        console.error("file: \"" + filename + "\". " + error.message);
      }
    });
  } else {
    _loadJson_data(value);
  }

  function _loadJson_data(data) {
    /*
     замена записей "url(./path/to/file)  на "../../path/to/file"
     url начинающиеся с ./ относительно родителького json файла
      url с "/" добавляется APP_STATIC_PATH
     */
    utils.recoursive(data, function (property, value, parent) {
      if (/^url\(.*\)$/.test(value)) {
        var regex_data = /^url\((\.?\/)?(.*)\)$/.exec(value);
        var url = regex_data[2];

        if (regex_data[1] == "/") {
          url = window.APP_STATIC_PATH + url;
        }
        if (regex_data[1] == "./") {
          url = path.getParentDirectoryUrl(filename) + url;
        }

        parent[property] = path.resolve(url);
      }
    });

    var loader = util.queueLoad(1, function finalize() {

      if (init_property) {
        var prop_arr = init_property.split("/");
        for (var i = 0; i < prop_arr.length; i++) {
          data = data[prop_arr[i]];
        }
      }

      if (errors.length) {
        if (callback_error) callback_error(errors);
      } else {
        if (callback_success) callback_success(data);
        output = data;
      }
    });

    /**
     * remove comments
     */
    utils.recoursive(data, function (property, value, parent) {
      /*
       remove comments like
       ["@comment()"]
       "@comment": {}
       */
      if (/^\/\/.*$/.test(value) || /^@comment\(.*\)$/.test(value) || property == "@comment") {
        if (parent.constructor == Array) {
          parent.splice(property, 1);
        } else {
          delete parent[property];
        }
      } else if (/^@extend.*$/.test(property)) {

        loader.total++;
        _load_json(value, function (data) {
          var ext_data = object.deepExtend(data, parent);
          object.deepExtend(parent, ext_data);
          delete parent["@extend"];
          loader();
        }, function (data, error) {
          errors.push(error);
          loader();
        });
      } else if (/^@extend\(.*\)$/.test(value)) {
        var _reg_data = /^@extend\((\.\/)?(.*)\)$/.exec(value);
        var url = _reg_data[2];
        if (_reg_data[1]) {
          url = path.getParentDirectoryUrl(filename) + url;
        }
        loader.total++;
        _load_json(url, function (data) {
          parent[property] = data;
          loader();
        }, function (data, error) {
          errors.push(error);
          loader();
        });
      } else if (/^@mixin\(.*\)$/.test(value)) {
        var _reg_data = /^@mixin\((\.\/)?(.*)\)$/.exec(value);
        var url = _reg_data[2];
        if (_reg_data[1]) {
          url = path.getParentDirectoryUrl(filename) + url;
        }
        loader.total++;
        _load_json(url, function (data) {
          if (parent.constructor == Array) {
            parent.splice(property, 1);
            for (var i in data) {
              parent.push(data[i]);
            }
          } else {
            delete parent[property];
            for (var i in data) {
              parent[i] = data[i];
            }
          }
          loader();
        }, function (data, error) {
          errors.push(error);
          loader();
        });
      } else if (/^@load\((.*)\)$/.test(value)) {
        var _reg_data = /^@load\((\.?\/)?(.*)\)$/.exec(value);
        var url = _reg_data[2];
        if (_reg_data[1] == "/") {
          url = window.APP_STATIC_PATH + url;
        }
        if (_reg_data[1] == "./") {
          url = path.getParentDirectoryUrl(filename) + url;
        }

        loader.total++;
        utils.getInlineJson(url, "html", function (data) {
          parent[property] = data;
          loader();
        }, function (data, error) {
          errors.push(error);
          loader();
        });
      }
    });
    loader();
  }

  return output;
}

var utils = {
  CACHED_JSON: {},
  loadJsonSync: function loadJsonSync(src) {
    var data;
    _load_json(src, function (_data) {
      data = _data;
    });
    return data;
  },

  /**
   позволяет использовать конструкции вида
   расширить данные из файла template.json
   "@extend" : "url(data/template.json)",
   "@extend" : "url(data/template.json#settings/stages)",
    //заменить строку наданные из файла
   "stages":       "url(data/template.json#settings/stages)",
    * @param filename
   * @param callback_success
   * @param callback_error
   */
  loadJson: function loadJson(value, resolve_cb, fail_cb) {
    return _load_json(value, function (data) {
      resolve_cb && resolve_cb(data);
    }, function (err) {
      fail_cb && fail_cb(err);
    });
  },

  removeComments: function removeComments(str) {
    str = str.replace(/^\s*(\/\/.*|(?:\/\*[\s\S]*?)\*\/\s*)$/gm, "");
    return str;
  },
  /**
   *
   * @param object
   * @param criteria - выполнять функцию со всеми объектами
   */
  recoursive: function recoursive(object, criteria) {
    var readed = [];
    if (!object) return;
    return function sub_recoursive(object) {
      if (readed.indexOf(object) != -1) {
        return;
      }
      readed.push(object);

      if (object instanceof Array) {
        for (var prop = object.length; prop--;) {
          if (object[prop] && (object[prop].constructor == Object || object[prop].constructor == Array)) {
            sub_recoursive(object[prop]);
          } else {
            var break_ = criteria(prop, object[prop], object);
          }
        }
      } else {
        for (var prop in object) {
          if (object[prop] && (object[prop].constructor == Object || object[prop].constructor == Array)) {
            sub_recoursive(object[prop]);
          } else {
            var break_ = criteria(prop, object[prop], object);
          }
        }
      }
    }(object);
  },

  parseCSV: function parseCSV(data) {
    var rows = data.split(/\n/);
    var columns = rows[0].split(',');
    rows.splice(0, 1);

    for (var i = 0; i < rows.length; i++) {
      var output_row_data = {};
      var row_data = [];

      var _quote = false,
          last = -1;
      var j = -1;
      var str = rows[i];
      while (++j < str.length) {
        if (!_quote) {
          if (str[j] == '\'' || str[j] == '\"') {
            _quote = str[j];
          }
          if (str[j] == ",") {
            var _val = str.substring(last, j);
            if (_val[0] == '\"' && _val[_val.length - 1] == '\"') {
              _val = _val.substring(1, _val.length - 1);
            }
            row_data.push(_val);
            last = j + 1;
          }
        } else {
          if (str[j] == _quote) {
            _quote = false;
          }
        }
      }

      for (var j in row_data) {
        output_row_data[columns[j]] = row_data[j];
      }
      rows[i] = output_row_data;
    }
    return rows;
  },
  parseData: function parseData(data, dataType) {
    var _parsed;
    if (dataType == "csv") {
      _parsed = utils.parseCSV(data);
    } else if (dataType == "json") {
      _parsed = data.trim();
      //if (data[0] != "{" && data[0] != "[") {
      //  return false;
      //}

      _parsed = utils.removeComments(_parsed);
      //data  = data.replace(/\n/g,"")

      try {
        var _parsed = JSON.parse(_parsed); //= JSON.parse(data.replace(/\/\*[\s\S]*?\*\/|\/\/.*/g,""));
      } catch (e) {
        return {
          status: "error",
          message: e.toString(),
          data: data
        };
      }
      //var script = $("<script type='text/json' id='" + url + "'>" + JSON.stringify(data) + "</script>");
    }
    return {
      status: "success",
      data: _parsed
    };
  },
  load: function load(url, dataType, callback_success, callback_error) {
    //todo
    if (isServer()) {
      try {
        var data = fs.readFileSync(url, 'utf8');
        data = data.replace(/^\uFEFF/, '');
        var _parsed = utils.parseData(data, dataType);
        if (_parsed.status == "error") {
          callback_error({
            status: "error",
            message: _parsed.message,
            data: _parsed.data
          });
          return;
        }
        callback_success(_parsed.data);
      } catch (e) {

        if (e.code === 'ENOENT') {
          console.log('File not found!');
        } else {
          throw e;
        }
        callback_error(data);
      }
    } else {

      var httpRequest = new XMLHttpRequest();

      httpRequest.onreadystatechange = function () {
        if (httpRequest.readyState === 4) {
          if (httpRequest.status === 200) {
            var data = httpRequest.responseText;
            var _parsed = utils.parseData(data, dataType);
            if (_parsed.status == "error") {
              callback_error({
                status: httpRequest.status,
                message: _parsed.message,
                response: httpRequest.responseText
              });
              return;
            }
            callback_success(_parsed.data);
          } else {
            callback_error(url, httpRequest);
          }
        }
      };
      httpRequest.open('GET', url);
      httpRequest.send();
    }
  },
  /**
   * Позволяетзагружать json файлы , содержащие ссылки на другие json файлы.
   * вместо ссылок типа
   *  "property" : "url(chunk.json)"
   *  будет загружено содержимое файла
   *  "property" : {...}
   *
   *  если указать якорь
   *  "property" : "url(chunk.json#settings/chunk/0/text)"
   *
   * то будет загружено содержимое поля settings.chunk[0].text из файла chunk.json
   *
   *
   * @param filename  путь к основному json файлу
   * @param callback  будет вызван после окончания загрузки всех файлов
   */
  getInlineJson: function getInlineJson(url, dataType, callback_success, callback_error) {

    if (dataType.constructor != String) {
      callback_error = callback_success;
      callback_success = dataType;
      dataType = "json";
    }

    if (typeof utils.CACHED_JSON !== "undefined" && utils.CACHED_JSON && utils.CACHED_JSON[url]) {
      callback_success(utils.CACHED_JSON[url]);
      return;
    }
    if (typeof $ !== "undefined") {
      if (typeof document !== "undefined") {
        var inline = $("script[id='" + url + "']");
        if (inline.length > 0) {
          var _data = inline[0].innerText || //all
          inline[0].textContent || //firefox
          inline[0].text; //ie8
          if (dataType == "json") {

            var _data = utils.removeComments(_data);
            callback_success(JSON.parse(_data));
          } else {
            callback_success(_data);
          }
          return;
        }
      }
    }
    utils.load(url, dataType, callback_success, callback_error);
  }
};

module.exports = utils;

/***/ }),
/* 13 */
/***/ (function(module, exports) {

module.exports = require("fs");

/***/ }),
/* 14 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


module.exports = {

  loadScript: function loadScript(requirement, helper, error) {
    var head = document.getElementsByTagName('head')[0];
    var script = document.createElement('script');
    script.type = 'text/javascript';
    script.onerror = error;
    script.onreadystatechange = function () {
      if (this.readyState == 'complete') {
        helper(script, __src);
      }
    };
    script.addEventListener("load", helper, true);
    script.src = requirement;
    head.appendChild(script);
  },
  scriptURL: function scriptURL() {

    if (document.currentScript) {
      return document.currentScript.src;
    }
    var scripts = document.getElementsByTagName('script');
    for (var i = scripts.length - 1; i--;) {
      if (scripts[i].src) {
        return scripts[i].src;
      }
    }
    return false;
  }
};

/***/ }),
/* 15 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var deepDiffMapper = {
  VALUE_CREATED: 'created',
  VALUE_UPDATED: 'updated',
  VALUE_DELETED: 'deleted',
  VALUE_UNCHANGED: 'unchanged',
  map: function map(obj1, obj2) {
    if (this.isFunction(obj1) || this.isFunction(obj2)) {
      throw 'Invalid argument. Function given, object expected.';
    }
    if (this.isValue(obj1) || this.isValue(obj2)) {
      return {
        '_map_type': this.compareValues(obj1, obj2),
        '_map_data': obj2 === undefined ? obj1 : obj2
      };
    }

    if (_.isArray(obj2)) {
      var _array = true;
      var diff = [];
    } else {
      var diff = {};
    }

    for (var key in obj1) {
      if (this.isFunction(obj1[key])) {
        continue;
      }

      var value2 = undefined;
      if ('undefined' != typeof obj2[key]) {
        value2 = obj2[key];
      }

      diff[key] = this.map(obj1[key], value2);
    }
    for (var key in obj2) {
      if (this.isFunction(obj2[key]) || 'undefined' != typeof diff[key]) {
        continue;
      }

      var _val = this.map(undefined, obj2[key]);
      if (_array) {
        diff.push(_val);
      } else {
        diff[key] = _val;
      }
    }

    return {
      '_map_type': '',
      '_map_data': diff
    };
  },
  compareValues: function compareValues(value1, value2) {
    if (value1 === value2) {
      return this.VALUE_UNCHANGED;
    }
    if ('undefined' == typeof value1) {
      return this.VALUE_CREATED;
    }
    if ('undefined' == typeof value2) {
      return this.VALUE_DELETED;
    }

    return this.VALUE_UPDATED;
  },
  isFunction: function isFunction(obj) {
    return {}.toString.apply(obj) === '[object Function]';
  },
  isArray: function isArray(obj) {
    return {}.toString.apply(obj) === '[object Array]';
  },
  isObject: function isObject(obj) {
    return {}.toString.apply(obj) === '[object Object]';
  },
  isValue: function isValue(obj) {
    return !this.isObject(obj) && !this.isArray(obj);
  }
};

module.exports = {
  differenceMap: deepDiffMapper.map.bind(deepDiffMapper),
  syntaxHighlight: function syntaxHighlight(json) {
    if (typeof json != 'string') {
      json = JSON.stringify(json, null, 2);
    }
    json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');

    json = json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {
      var cls = 'number';
      if (/^"/.test(match)) {
        if (/:$/.test(match)) {
          cls = 'key';
        } else {
          cls = 'string';
        }
      } else if (/true|false/.test(match)) {
        cls = 'boolean';
      } else if (/null/.test(match)) {
        cls = 'null';
      }
      return '<span class="' + cls + '">' + match + '</span>';
    });
    return json = json.replace(/[^,\n][^\n]*/g, function (match) {
      return '<span>' + match + '</span>';
    });
  },
  differenceHighlight: function differenceHighlight(json, output) {

    if (output) {
      output.empty();
    } else {
      output = $("<pre>");
    }

    function printObject(json, level, output, comma, objectIndex) {
      var _el = $("<p>");

      _el.append($("<span>").addClass("object-key").append($("<span>").text(new Array(level).join(' '))));
      if (objectIndex) {
        _el.append($("<span>").text('"').addClass("invisible"), $("<span>").addClass("key").text(objectIndex), $("<span>").text('"').addClass("invisible"), $("<span>").text(': '));
      }

      if (json && json._map_type !== undefined) {
        _el.addClass(json._map_type);

        if (_.isArray(json._map_data)) {
          _el.append($("<span>").text("["));
          var _last_key = json._map_data.length - 1;
          for (var i in json._map_data) {
            printObject(json._map_data[i], level + 1, _el, i != _last_key);
          }
          _el.append($("<p>").text(new Array(level).join(' ') + "]" + (comma ? "," : "")));
        } else if (_.isObject(json._map_data)) {
          _el.append($("<span>").text("{"));
          var _last_key = Object.keys(json._map_data).pop();
          for (var i in json._map_data) {
            printObject(json._map_data[i], level + 1, _el, i != _last_key, i);
          }
          _el.append($("<p>").text(new Array(level).join(' ') + "}" + (comma ? "," : "")));
        } else {

          if (_.isNull(json._map_data)) {
            _el.append($("<span>").text(JSON.stringify(json._map_data, null, 2)));
          } else if (json._map_data.constructor === String) {
            _el.append($("<span>").text('"'), $("<span>").addClass('string').text(json._map_data), $("<span>").text('"'));
          } else if (json._map_data.constructor === Number || json._map_data.constructor === Boolean) {
            _el.append($("<span>").addClass('number').text(json._map_data));
          } else {
            _el.append($("<span>").text(JSON.stringify(json._map_data, null, 2)));
          }
          if (comma) {
            _el.append($("<span>").text(","));
          }
        }
      } else {
        _el.append($("<span>").text(JSON.stringify(json, null, 2)));

        if (comma) {
          _el.append($("<span>").text(","));
        }
      }

      output.append(_el);
    }
    printObject(json, 1, output);
    return output;
  }
};

/***/ }),
/* 16 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

if (!Object.values) {
  Object.defineProperty(Object, 'values', {
    enumerable: false,
    configurable: false,
    writable: false,
    value: function value(_object) {
      var _values = [];
      Object.keys(_object).forEach(function (key) {
        _values.push(_object[key]);
        // use val
      });
      return _values;
    }
  });
}

fabric.util.object.extend(fabric, {
  errors: []
});

fabric.util.order = function (_array, context) {
  (function _call() {
    if (!_array.length) return;
    var foo = _array.shift();
    if (foo) {
      if (foo.length) {
        foo.call(context, _call);
      } else {
        foo.call(context);
        _call();
      }
    } else {
      _call();
    }
  })();
};

fabric.util.promise = {
  map: function map(data, foo) {

    if (data.constructor == Array) {
      return Promise.all(data.map(foo)).then(function (results, error) {
        if (error) {
          return Promise.reject(error);
        }
        return Promise.resolve(results);
      });
    }

    var keys = Object.keys(data);
    var urls = Object.values(data);
    return Promise.all(urls.map(foo)).then(function (results, error) {
      if (error) {
        return Promise.reject(error);
      }
      var _map = {};

      for (var i = 0; i < results.length; i++) {
        _map[keys[i]] = results[i];
      }
      return Promise.resolve(_map);
    });
  },
  wrap: function wrap(context) {
    return function wrap(foo) {
      return function () {
        var options = Array.prototype.slice.call(arguments, 1);
        if (!foo.length) {
          return new Promise(function (resolve, fail) {
            var _result = foo.call(context);
            _result || _result === undefined ? resolve() : fail();
          });
        } else {
          return new Promise(foo.bind(context));
        }
      };
    };
  }
};

fabric.Object.prototype.set = function (key, value) {
  if ((typeof key === 'undefined' ? 'undefined' : _typeof(key)) === 'object') {
    this._setObject(key, value);
  } else {
    if (typeof value === 'function' && key !== 'clipTo') {
      this._set(key, value(this.get(key)));
    } else {
      this._set(key, value);
    }
  }
  return this;
};

fabric.Object.prototype._setObject = function (options, callback) {
  var keys = Object.keys(options);
  if (this.optionsOrder) {
    var middleIndex = this.optionsOrder.indexOf("*") || -1;

    var i = middleIndex,
        prop,
        keyIndex;

    while (prop = this.optionsOrder[--i]) {
      if ((keyIndex = keys.indexOf(prop)) !== -1) {
        keys.splice(keyIndex, 1);
        keys.unshift(prop);
      }
    }
    i = middleIndex;
    while (prop = this.optionsOrder[++i]) {
      if ((keyIndex = keys.indexOf(prop)) !== -1) {
        keys.splice(keyIndex, 1);
        keys.push(prop);
      }
    }
  }
  for (var i = 0; i < keys.length; i++) {
    var prop = keys[i];
    if (typeof options[prop] == "function") {
      keys.splice(i, 1);
      keys.unshift(prop);
    }
  }
  var queue;
  for (var i in keys) {
    var _key = keys[i];
    if (options[_key] === undefined) continue;
    var _fooName = "set" + fabric.util.string.capitalize(_key, true);
    if (this[_fooName] && this[_fooName].name && this[_fooName].name != "anonymous") {
      if (this[_fooName].length == 2) {
        if (!queue) {
          queue = fabric.util.queueLoad(2, callback);
        } else {
          queue.total++;
        }
        this[_fooName](options[_key], function (_key) {
          queue();
        }.bind(this, _key));
      } else {
        this[_fooName](options[_key]);
      }
    } else {
      this.__set(_key, options[_key]);
    }
  }
  if (queue) {
    queue();
  } else if (callback) {
    callback();
  }
};

var _get_pointer_overwritten = fabric.Canvas.prototype.getPointer;

fabric.util.object.extend(fabric.StaticCanvas.prototype, {
  __set: fabric.Object.prototype._set,
  _setObject: fabric.Object.prototype._setObject,
  get: fabric.Object.prototype.get,
  set: fabric.Object.prototype.set
});
fabric.util.object.extend(fabric.Canvas.prototype, {
  originalState: {},
  stateProperties: [],
  editingObject: null,

  getModifiedStates: function getModifiedStates(target) {
    var states = {
      original: {},
      modified: {}
    };
    for (var prop in target.originalState) {
      if (target.originalState[prop] !== target[prop]) {
        if (target.originalState[prop] instanceof Object) {
          if (JSON.stringify(target.originalState[prop]) == JSON.stringify(target[prop])) {
            continue;
          }
        }
        states.original[prop] = target.originalState[prop];
        states.modified[prop] = target[prop];
      }
    }
    return states;
  },
  _finalizeCurrentTransform: function _finalizeCurrentTransform() {

    var transform = this._currentTransform,
        target = transform.target;

    if (target._scaling) {
      target._scaling = false;
    }

    target.setCoords();

    this._restoreOriginXY(target);
    // only fire :modified event if target coordinates were changed during mousedown-mouseup
    this.fireModifiedIfChanged(target);
  },
  fireModifiedIfChanged: function fireModifiedIfChanged(target) {
    if (this.stateful) {
      var _states = target.hasStateChanged();
      if (_states) {
        this.fire('object:modified', { target: target, states: _states });
        target.fire('modified', { states: _states });
      }
    }
  }
});

fabric.util.object.extend(fabric.Object.prototype, {
  setAngle: function setAngle(angle) {
    this.angle = angle;
  },

  setShadow: function setShadow(options) {
    return this.shadow = options ? new fabric.Shadow(options) : null;
  },
  __set: fabric.Object.prototype._set,

  _set: function _set(key, value, callback) {
    var _fooName = "set" + fabric.util.string.capitalize(key, true);
    if (this[_fooName] && this[_fooName].name && this[_fooName].name != "anonymous") {
      // if (this.specialProperties.indexOf(key) !== -1) {
      // if(this[_fooName]){
      this[_fooName](value, callback);
    } else {
      this.__set(key, value);
    }
    return this;
  },
  disable: function disable() {
    this.set({
      selectable: false,
      evented: false,
      hasControls: false,
      lockMovementX: true,
      lockMovementY: true
    });
  },
  stored: true,
  /**
   * Saves state of an object
   * @param {Object} [options] Object with additional `stateProperties` array to include when saving state
   * @return {fabric.Object} thisArg
   */
  saveState: function saveState(options) {
    //State: function(options) {

    this.originalState = this.toObject();
    /*
    // this.stateProperties.forEach(function(prop) {
    //   var _val = this.get(prop);
    //   if(_val instanceof Object){
    //     this.originalState[prop] = fabric.util.object.cloneDeep(_val);
    //   }else{
    //     this.originalState[prop] = _val;
    //   }
    // }, this);
     if (options && options.stateProperties) {
      options.stateProperties.forEach(function(prop) {
        this.originalState[prop] = this.get(prop);
      }, this);
    }*/
    return this;
  },
  hasStateChanged: function hasStateChanged() {
    var modified = 0;
    var states = {
      original: {},
      modified: {}
    };

    var state = this.toObject();

    for (var prop in this.originalState) {
      if (this.originalState[prop] !== state[prop]) {
        if (this.originalState[prop] instanceof Object) {
          if (JSON.stringify(this.originalState[prop]) == JSON.stringify(state[prop])) {
            continue;
          }
        }
        states.original[prop] = this.originalState[prop];
        states.modified[prop] = state[prop];
        modified++;
      }
    }
    return modified && states;
  }
});

fabric.util.getProportions = function (photo, container, mode) {
  mode = mode || 'fit';
  var _w = photo.naturalWidth || photo.width;
  var _h = photo.naturalHeight || photo.height;
  if (!container.height && !container.width) {
    return {
      scale: 1,
      width: _w,
      height: _h
    };
  }
  if (!photo.height && !photo.width) {
    return {
      scale: 0.001,
      width: container.width,
      height: container.height
    };
  }

  // var _asp = _w / _h, _c_asp = container.width / container.height;

  // if (_asp > _c_asp) {
  //   _h = container.height;
  //   _w = _h * _asp;
  //
  // } else {
  //   _w = container.width;
  //   _h = _w / _asp;
  // }
  // var scaleX = container.width / _w;
  // var scaleY = container.height / _h;
  var scaleX = container.width && container.width / _w || 999;
  var scaleY = container.height && container.height / _h || 999;

  var scale;
  if (mode === 'cover') {
    scale = Math.max(scaleX, scaleY);
  }
  if (mode === 'fit') {
    scale = Math.min(scaleX, scaleY);
  }
  if (mode === 'center') {
    scale = 1;
  }
  return {
    scale: scale,
    width: Math.floor(_w * scale),
    height: Math.floor(_h * scale)
  };
};

fabric.util.Utf8ArrayToStr = function (array) {
  var out, i, len, c;
  var char2, char3;

  out = "";
  len = array.length;
  i = 0;
  while (i < len) {
    c = array[i++];
    switch (c >> 4) {
      case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:
        // 0xxxxxxx
        out += String.fromCharCode(c);
        break;
      case 12:case 13:
        // 110x xxxx   10xx xxxx
        char2 = array[i++];
        out += String.fromCharCode((c & 0x1F) << 6 | char2 & 0x3F);
        break;
      case 14:
        // 1110 xxxx  10xx xxxx  10xx xxxx
        char2 = array[i++];
        char3 = array[i++];
        out += String.fromCharCode((c & 0x0F) << 12 | (char2 & 0x3F) << 6 | (char3 & 0x3F) << 0);
        break;
    }
  }

  return out;
};

fabric.util._idCounter = 1;

fabric.util.createObject = function (type, options, callback) {
  if (typeof type !== "string") {
    callback = options;
    options = type;
    type = null;
  } else {
    options.type = type;
  }
  var app = options.application;
  app && app.fire("entity:load", { options: options });

  var _klassName = fabric.util.string.camelize(fabric.util.string.capitalize(type || options.type || app.prototypes.Object.type, true));
  var _klass = fabric[_klassName] || app.klasses[_klassName];

  if (!_klass) {
    console.error(_klassName + " is undefined");
    var _text = options.text || _klassName;
    delete options.text;
    return callback(new fabric.Text(_text, options));
  }

  var el = _klass.fromObject(options, function (el) {
    callback && callback(el);
    callback = null;
  });
  if (el) {
    callback && callback(el);
    callback = null;
  }
  return el;
};

fabric.util.dataURItoBlob = function (dataURI, dataTYPE) {
  var binary = atob(dataURI.split(',')[1]),
      array = [];
  for (var i = 0; i < binary.length; i++) {
    array.push(binary.charCodeAt(i));
  }
  return new Blob([new Uint8Array(array)], { type: dataTYPE });
};

fabric.util.blobToDataURL = function (blob, callback) {
  var a = new FileReader();
  a.onload = function (e) {
    callback(e.target.result);
  };
  a.readAsDataURL(blob);
};

fabric.util.createCanvasElementWithSize = function (size) {
  var canvas = fabric.util.createCanvasElement();
  canvas.width = size.width;
  canvas.height = size.height;
  return canvas;
};

fabric.util.string.toDashed = function (str) {
  return str.replace(/([a-z])([A-Z])/g, '$1-$2').toLowerCase();
};

fabric.util.string.uncapitalize = function (string) {
  return string.charAt(0).toLowerCase() + string.slice(1);
};
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 17 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

/**
 * @private
 * @param {String} eventName
 * @param {Function} handler
 */

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

function _removeEventListener(eventName, handler) {
  if (!this.__eventListeners[eventName]) {
    return;
  }
  var eventListener = this.__eventListeners[eventName];
  if (handler) {
    eventListener.splice(eventListener.indexOf(handler), 1);
  } else {
    eventListener.length = 0;
  }
}

fabric.Canvas.prototype.stopObserving = fabric.Object.prototype.stopObserving = function stopObserving(eventName, handler) {
  if (!this.__eventListeners) {
    return;
  }

  // remove all key/value pairs (event name -> event handler)
  if (arguments.length === 0) {
    for (eventName in this.__eventListeners) {
      _removeEventListener.call(this, eventName);
    }
  }
  // one object with key/value pairs was passed
  else if (arguments.length === 1 && _typeof(arguments[0]) === 'object') {
      for (var prop in eventName) {
        _removeEventListener.call(this, prop, eventName[prop]);
      }
    } else {
      _removeEventListener.call(this, eventName, handler);
    }
  return this;
};

fabric.Observable.on = fabric.Canvas.prototype.on = fabric.Object.prototype.on = function (eventName, handler, priority) {
  if (eventName.constructor == Object) {
    for (var i in eventName) {
      this.on(i, eventName[i], priority);
    }
    return this;
  }
  var events = eventName.split(" ");
  for (var i in events) {
    eventName = events[i];
    this.observe(eventName, handler);
    if (priority) {
      this.__eventListeners[eventName].unshift(this.__eventListeners[eventName].pop());
    }
  }
  return this;
};
fabric.Canvas.prototype.off = fabric.Object.prototype.off = function (eventName, handler) {
  var events = eventName.split(" ");
  for (var i in events) {
    this.stopObserving(events[i], handler);
  }
  return this;
};

fabric.Canvas.prototype.fire = fabric.Object.prototype.fire = function fire(eventName, options) {
  if (!this.__eventListeners) {
    return;
  }

  var listenersForEvent = this.__eventListeners[eventName];
  if (listenersForEvent) {
    for (var i = 0, len = listenersForEvent.length; i < len; i++) {
      listenersForEvent[i].call(this, options || {});
    }
  }

  var listenersForEventAll = this.__eventListeners['*'];
  if (listenersForEventAll) {
    options = options || {};
    options.eventName = eventName;
    options.listeners = listenersForEvent;
    for (i = 0, len = listenersForEventAll.length; i < len; i++) {
      listenersForEventAll[i].call(this, options);
    }
  }

  return this;
};
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 18 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

/**
 * # Application
 *
 * farbic.app function is the entry point of FabricJS application.
 * Application could be initialised with configuration object. Different extensions allows to initialize special application attributes such as *object prototypes*, *resizable canvas*, *available fonts*, etc.
 *
 * ### option: util
 * mediaRoot - root directory for all media files in fabric application
 *
 * ### option: resizable
 * makes canvas responsible. Canvas will be scaled to 100% of its container size
 *
 * ### option: onResize
 * function which override deafult canvas resize behavior.
 *
 * ### option: callback
 * function calls after canvas initialized
 *
 * ### option: initialize
 * function calls before canvas initialize
 *
 * @example
 *
 * new fabric.Application({
 *      resizable: true,
 *      onResize: function(){},
 *      util: {
 *        mediaRoot: '../../media/'
 *      },
 *      canvasContainer: "fiera-canvas",
 *      prototypes: {},
 *      objects: {},
 *      eventListeners: {},
 *      callback: function(){},
 *      initialize:  function(){}
 *      customPublicApplicationFunction: function(){},
 *      customPublicApplicationAttribute: value
 *  })
 *
 */

fabric.Application = function (options) {
  this.init(options);
};

fabric.Application.prototype = fabric.util.object.extend({}, fabric.Observable, {
  defaultOptions: {
    /**
     * id of target canvas element
     */
    canvasContainer: null
  },
  credentials: false,
  ready: false,
  canvasClass: 'Canvas',
  optionsOrder: ["canvasContainer", "*", "objects", "slide"],
  plugins: {
    preloaders: [],
    configuration: [],
    canvas: []
  },
  /**
   * Additional Event Listeners couldbe used to detect activeobject changes
   *  - canvas:created
   *  - entity:load - Event fired on creation of every new fabric instance(canvas,brush,object)
   *
   *  @example
   *  'entity:load' : function(e){
   *     if(e.options.boxType == 'machine') {
   *       e.options.type = "machine-mask-rectangle";
   *     }
   *   }
   */
  eventListeners: {
    "canvas:created": [],
    "entity:created": [function (e) {
      if (e.target.eventListeners) {
        for (var i in e.target.eventListeners) {
          var _listeners = e.target.eventListeners[i];
          if (_listeners.constructor == Array) {
            for (var j in _listeners) {
              e.target.on(i, _listeners[j]);
            }
          } else {
            e.target.on(i, _listeners);
          }
        }
      }

      if (e.options.eventListeners) {
        for (var i in e.options.eventListeners) {
          e.target.on(i, e.options.eventListeners[i]);
        }
      }
      delete e.options.eventListeners;

      if (e.target._default_event_listeners) {
        for (var i in e.target._default_event_listeners) {
          e.target.on(i, e.target._default_event_listeners[i]);
        }
      }
    }]
  },
  onSlideLoaded: function onSlideLoaded() {},
  onCanvasCreated: function onCanvasCreated() {},
  callback: function callback() {},

  init: function init(options) {
    this.initEventListeners();
    options = fabric.util.object.deepExtend({}, this.defaultOptions, options || {});

    this.fire("loading:begin", { options: options });

    this._options = options;

    $(document).ready(function () {
      fabric.util.order([this.preloader, this.loadConfiguration,
      //    this.createApp,
      this.initOptions, this.initialize, this.onApplicationCreated, this.postloader, this.callback && function () {
        setTimeout(this.callback.bind(this), 0);
      }, function () {
        this.fire("ready");
      }.bind(this)], this);
    }.bind(this));
  },
  onApplicationCreated: function onApplicationCreated() {
    this.ready = true;
    this.fire("loading:end", {});
  },
  setCredentials: function setCredentials(credentials) {
    if (credentials) {
      console.info("%cFiera Canvas Editor%c by %cDenis Ponomarev%c %c%6$s%c / %c%9$s%c", "color: #ffa500", "color: #202020", "color: #2EC06C", "color: #202020", "color: #337ab7", "www.hometlt.ru", "color: #202020", "color: #337ab7", "ponomarevtlt@gmail.com", "color: #202020");
    }
  },
  initOptions: function initOptions(resolve, error) {
    this.set(this._options, resolve);
  },
  configurationProperties: [],
  loadConfiguration: function loadConfiguration(resolve, error) {

    if (this.configurationProperties) {
      var _iteratorNormalCompletion = true;
      var _didIteratorError = false;
      var _iteratorError = undefined;

      try {
        for (var _iterator = this.configurationProperties[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
          var prop = _step.value;


          if (this._options[prop]) {
            if (!this._options.configuration) {
              this._options.configuration = {};
            }
            this._options.configuration[prop] = this._options[prop];
          }
        }
      } catch (err) {
        _didIteratorError = true;
        _iteratorError = err;
      } finally {
        try {
          if (!_iteratorNormalCompletion && _iterator.return) {
            _iterator.return();
          }
        } finally {
          if (_didIteratorError) {
            throw _iteratorError;
          }
        }
      }
    }

    if (!this._options.configuration) {
      return resolve();
    }
    var _app = this;
    fabric.util.promise.map(this._options.configuration, function (value) {
      return new Promise(function (resolve, fail) {
        fabric.util.data.loadJson(value, resolve, fail);
      });
    }).then(function (results) {
      fabric.util.object.extend(_app._options, results);
    }).then(resolve, error);
  },
  setCanvasContainer: function setCanvasContainer(canvasContainer) {
    this.canvasContainer = canvasContainer;

    if (canvasContainer.constructor == String) {
      var el = document.getElementById(canvasContainer);
    } else {
      el = canvasContainer;
    }
    this.canvas = new fabric[this.canvasClass](el, { application: this });
    // }else{
    //   this.canvas = new fabric[this.canvasClass]({application: this});
    // }

    this.fire("canvas:created");
    this.onCanvasCreated();
  },
  dispose: function dispose() {
    this.canvas.dispose();
  },

  //--------------------------------------------------------------------------------------------------------------------
  // Event Listeners
  //--------------------------------------------------------------------------------------------------------------------

  setEventListeners: function setEventListeners(val) {
    this.on(val);
  },
  initEventListeners: function initEventListeners() {
    if (!this.__eventListeners) {
      this.__eventListeners = {};
    }
    for (var event in this.eventListeners) {
      if (!this.__eventListeners[event]) {
        this.__eventListeners[event] = [];
      }
      this.__eventListeners[event] = this.__eventListeners[event].concat(this.eventListeners[event]);
    }
  },

  //--------------------------------------------------------------------------------------------------------------------
  //
  __set: fabric.Object.prototype.__set,
  _setObject: fabric.Object.prototype._setObject,
  set: fabric.Object.prototype.set,
  setOptions: fabric.Object.prototype.setOptions,
  actions: {
    save: {
      title: "save project",
      className: 'fa fa-floppy-o',
      action: function action() {
        var data = this.toObject();
        this.application.api.save(data);
      }
    }
  }
});

// fabric.Application.addPlugin = fabric.PluginsMixin.addPlugin.bind(fabric.Application);

fabric.app = function (options) {
  return new fabric.Application(options);
};
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 19 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

__webpack_require__(6);

/**
 * # SlideCanvas
 * Inherited from fabric.Canvas
 *
 *

 ## method: load

Mathod allows to add new objects and set new attributes of canvas.

 ```javascript
 load : ({
    backgroundImage: string,
    objects: [FabricShapeOptions],
    customSyncOption: any,
    customAsyncOption: any
  },callback) : void
 ```

 To extend loading behavior and use custom options it is possible to define **set fucntions** in Canvas prototype.

 ```javascript
 // Canvas Prototype
 setCustomAsyncOption: function(val,callback){
  this.doAsyncMethod(val,callback)
}
 setCustomSyncOption: function(val){
  this.customSyncOtion = val;
}
 ```

 ### attribute: backgroundImageProperties

 default attributes for background image

 ### freeDrawingBrush

 default active drawing brush

 ```
 freeDrawingBrush: "PaintBucketBrush" | "PaintPenBrush" | "PencilBrush"
 ```

 ### attribute: onSlideLoaded

 onSlideLoaded calls as a callback for load fucntion

 ### attribute: backgroundPosition

 onSlideLoaded calls as a callback for load fucntion

 ```
 backgroundPosition: 'manual' | 'resize' | 'fit' | 'cover' | 'center'
 ```

 - manual - background will ne not scaled and put at left top corner
 - resize - canvas will be resized according to image size
 - fit - will be scaled to fit canvas size
 - cover - will be scaled to cover all canvas size
 - center - backogrund will be not scaled but put in the middle

 ### method: setInteractiveMode

 switch between drawing and hand( moving cunvas by mouse) modes

 ```javascript
 canvas.setInteractiveMode( mode : "hand" | "mixed") : void
 ```

 ### drawingColor

 drawing color using by brushes

 */

fabric.util.object.extend(fabric.StaticCanvas.prototype, {

  setBackgroundColor: function setBackgroundColor(backgroundColor, callback) {

    if (this.loaded) {
      var originalState = { backgroundColor: this.backgroundColor };
    }

    return this.__setBgOverlayColor('backgroundColor', backgroundColor, function () {
      this.renderAll();

      if (this.loaded) {
        this.fire('modified', { states: {
            original: originalState,
            modified: { backgroundColor: backgroundColor }
          } });
      }
      callback && callback();
    }.bind(this));
  },
  storeProperties: ['*', 'backgroundColor', 'backgroundImage', 'width', 'height'],

  toObjectSync: function toObjectSync(propertiesToInclude) {
    propertiesToInclude = (propertiesToInclude || []).concat(this.storeProperties);

    var _data = {
      objects: this.getObjects(),
      width: this.originalWidth || this.width,
      height: this.originalHeight || this.height
    };
    fabric.util.populateWithProperties(this, _data, propertiesToInclude);

    this.fire("before:object", { object: _data });

    return _data;
  },
  toObject: function toObject(propertiesToInclude) {
    var _this = this;

    propertiesToInclude = (propertiesToInclude || []).concat(this.storeProperties);

    var _objs = this.getObjects();

    _objs = fabric.util.object.filter(_objs, { stored: true });
    _objs = _objs.map(function (instance) {
      return instance.toObject(_this.objectsPropertiesToInclude);
    });

    var _data = {
      objects: _objs
    };

    fabric.util.populateWithProperties(this, _data, propertiesToInclude);

    if (propertiesToInclude.indexOf('backgroundImage') !== -1) {
      fabric.util.object.extend(_data, this.__serializeBgOverlay());
    }

    if (propertiesToInclude.indexOf('width') !== -1 && this.originalWidth) {
      _data.width = this.originalWidth;
    }
    if (propertiesToInclude.indexOf('height') !== -1 && this.originalHeight) {
      _data.height = this.originalHeight;
    }

    /*
     function serializeThumb(propertiesToInclude, _data){
     if(propertiesToInclude.indexOf('thumb') !== -1){
     var size = fabric.util.getProportions(this.getOriginalSize(), this.thumbSize, 'fit');
     var canvas = fabric.util.createCanvasElement();
     canvas.width = size.width;
     canvas.height = size.height;
     this.renderThumb(canvas);
     _data.thumb = canvas.toDataURL();
     }
     },
     function serializeTemplate(propertiesToInclude, _data) {
     if (propertiesToInclude.indexOf('template') !== -1) {
     if (this.template) {
     for (var i in _data.template) {
     if (JSON.stringify(_data[i]) == JSON.stringify(_data.template[i])) {
     delete _data[i];
     }
     }
     _data.template = this.template.id;
     }
     }
     }*/

    this.fire("before:object", { object: _data });

    return _data;
  },
  setTemplate: function setTemplate(template) {

    this.template = template;
    if (!template) return;

    this.setWidth(this.slideWidth || template.width);
    this.setHeight(this.slideHeight || template.height);
    this.originalHeight = this.height;
    this.originalWidth = this.width;

    this.set(fabric.util.object.rearrange(template, ["areas", "helpers", "offsets"]));

    this._update_clip_rect();
    this._update_background_image();
    this.fire("modified", { type: "template" });
    this.renderAll();
  },
  addText: function addText(text, options) {
    this.createObject({
      position: "center",
      text: text,
      type: this.defaultTextType,
      clipTo: this.activeArea,
      movementLimits: this.activeArea
    });
  }
});

fabric.SlideCanvas = fabric.util.createClass(fabric.Canvas, fabric.PluginsMixin, {
  type: 'canvas',
  /**
   * initialized width of the canvas
   */
  width: 160,
  /**
   * initialized height of the canvas
   */
  height: 90,
  /**
   * output quality
   */
  dotsPerUnit: 1,
  scale: 1,
  loaded: false,
  /**
   * allow user to interact with canvas
   */
  interactive: true,
  /**
   * fill not the slide area, but whole canvas with background color
   */
  defaultText: "text",
  defaultTextType: "text",
  thumbSize: {
    width: 50,
    height: 100
  },

  contextTopImageSmoothingEnabled: true,
  plugins: {
    initialize: [],
    preloaders: [],
    loaders: []
  },
  setInteractive: function setInteractive(value) {
    this.interactive = value;
  },

  _createUpperCanvas: function _createUpperCanvas() {
    fabric.Canvas.prototype._createUpperCanvas.call(this);
    var ctx = this.contextTop;

    if (ctx.imageSmoothingEnabled) {
      ctx.imageSmoothingEnabled = this.contextTopImageSmoothingEnabled;
      return;
    }
    ctx.webkitImageSmoothingEnabled = this.contextTopImageSmoothingEnabled;
    ctx.mozImageSmoothingEnabled = this.contextTopImageSmoothingEnabled;
    ctx.msImageSmoothingEnabled = this.contextTopImageSmoothingEnabled;
    ctx.oImageSmoothingEnabled = this.contextTopImageSmoothingEnabled;
  },
  _onMouseUpInDrawingMode: function _onMouseUpInDrawingMode(e) {
    this._isCurrentlyDrawing = false;
    if (this.clipTo) {
      this.contextTop.restore();
    }
    var pointer = this.getPointer(e);
    this.freeDrawingBrush.onMouseUp(pointer);
    this._handleEvent(e, 'up');
  },
  initialize: function initialize(el, options, callback) {
    if (el && el.constructor == Object) {
      callback = options;
      options = el;
      el = null;
    }
    options = options || {};

    if (options.application) {
      options.application.fire("entity:created", { target: this, options: options });
    }

    this.id = fabric.SlideCanvas.__idcounter++;

    this._objects = [];
    this._createLowerCanvas(el);

    this.created = true;
    this._currentTransform = null;
    this._groupSelector = null;
    this._initWrapperElement();
    this._createUpperCanvas();
    this._initEventListeners();
    this._initRetinaScaling();
    this.calcOffset();

    this.wrapperEl.appendChild(this.upperCanvasEl);

    this._createCacheCanvas();
    this._setImageSmoothing();
    this._initRetinaScaling();

    this.set(options);
    this._initSize();

    this.calcOffset();

    this.fire("created");
    // if(this.application){
    //   this.application.fire("canvas:created",{target : this});
    // }
  },
  animated: false,
  setAnimated: function setAnimated(val) {
    this.animated = val;
    if (val) {
      fabric.util.requestAnimFrame(function render() {
        this.renderAll();
        fabric.util.requestAnimFrame(render);
      }.bind(this));
    }
  },
  create: function create() {
    this.created = true;
    this._initInteractive();
    this._createCacheCanvas();
  },
  /**
   * Additional Event Listeners
   *  - loading:end
   *  - target:modified - couldbe used to detect active object changes
   *  - target:changed
   *  - target:cleared
   */
  eventListeners: {
    'object:moving': function objectMoving(obj) {
      this.fire('target:modified', this, obj);
    },
    'selection:cleared': function selectionCleared(event) {
      if (!this.target) return;
      this.target.fire('deselected', event);
      this.target = null;
      this.fire('target:cleared', event);
    },
    'object:selected': function objectSelected(event) {
      event.previous = this.target;
      this.target = event.target;
      if (event.previous) {
        event.previous.fire('deselected', event);
      }
      this.fire('target:changed', event);
    },
    'group:selected': function groupSelected(event) {
      this.target = event.target;
      this.fire('target:changed', event);
    }
  }
});
fabric.SlideCanvas.__idcounter = 0;
fabric.SlideCanvas.fromJson = function (url, callback, element) {
  fabric.util.data.loadJson(url, function (data) {
    new fabric.SlideCanvas(element, data, callback);
  });
};

fabric.SlideCanvas.prototype.actions = fabric.util.object.extend({}, {
  selectAll: {
    title: 'selectAll',
    type: 'key'
  },
  backgroundColor: {
    type: "color"
  },
  addText: {
    className: 'fa fa-font',
    title: 'text',
    action: function action() {
      this.addText(this.defaultText, {});
    }
  }
});

fabric.util.object.extend(fabric.Application.prototype, {
  setSlide: function setSlide(value, callback) {
    var _canvas = this.canvas;
    if (_canvas.load) {
      _canvas.load(value, callback);
    } else {
      _canvas.createObjects(value, callback);
    }
  }
});

fabric.Application.prototype.canvasClass = 'SlideCanvas';
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 20 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.Slide = function (application, slide) {

  if (fabric.isLikelyNode) {
    // fabric.Canvas = fabric.SlideCanvas;
    var w = slide.slideWidth; //todo|| slide.template.width;
    var h = slide.slideHeight; //todo || slide.template.height;
    var zoom = fabric.SlideCanvas.prototype.zoom || 1;
    this.canvas = fabric.createCanvasForNode(w * zoom, h * zoom);
  } else {
    var $canvas = fabric.util.createCanvasElement();
    this.canvas = new fabric.StaticCanvas($canvas, { application: application, interactive: false });
  }

  this.object = slide;
  // this.data = slide.data;
  this.application = application;
  this.id = ++fabric.Slide._slides_id_counter;
};

fabric.Slide.prototype = fabric.util.object.extend({}, fabric.Observable);

fabric.Slide._slides_id_counter = 1;

fabric.Application.prototype.configurationProperties.push("slides");
fabric.util.object.extend(fabric.Application.prototype, {
  defaultOptions: fabric.util.object.extend(fabric.Application.prototype.defaultOptions, {
    activeSlide: 0
  }),
  optionsOrder: function () {
    var oo = fabric.Application.prototype.optionsOrder;
    oo.push("slides", "activeSlide");
    return oo;
  }(),
  /*initialize: function (options) {
    fabric.util.object.extend(this, {
   last_id: 1,
   scaleValue: 1,
   activeSlide: null,
   history: null,
   slides: [],
   canvas: null
   });
    this.aligmentLineX = false;
   this.aligmentLineY = false;
    fabric.util.object.extend(this,options);
   fabric.util.object.defaults(options,this.defultOptions);
    // this.setAccess(this.access);
    if(options.gridsnapper !== undefined) {
   this.gridsnapper = options.gridsnapper
   }
   if(options.history !== undefined) {
   this.history = options.history;
   }
   if(options.data){
   this.data = options.data;
   }
   if(this.history) {
   this.history = new History(this);
   this.history.application = this.application;
   }
     if(options.canvas){
   var _canvas = new fabric.SlideCanvas(document.getElementById(options.canvas));
   _canvas.application = this.application;
   _canvas.project = this;
   this.setCanvas(_canvas);
   }
    return this;
   },*/
  setSlides: function setSlides(value, callback) {
    var _this = this;

    fabric.util.data.loadJson(value, function (slides) {

      _this.slides = [];

      if (_this.canvas) {
        _this.canvas._objects.length = 0;
      }

      slides.forEach(function (slide) {
        return _this.addSlide(slide);
      });

      _this.preload();
      _this.lazyLoad();
      callback();
    }, function () {
      console.error("slides loading failed");
    });
  },
  setActiveSlide: function setActiveSlide(slideId) {

    var slide = void 0;

    if (!this.slides) {
      return false;
    }
    if (slideId.constructor === Number) {
      slide = this.slides[slideId];
    } else if (slideId.constructor === String) {} else {
      slide = slideId;
    }

    if (this.canvas.processing) return;
    if (this.activeSlide === slide) return;

    this.fire("slide:change:begin", { canvas: this.canvas });
    if (this.activeSlide) {
      delete this.activeSlide.canvas.mirrorSlide;
    }

    this.processing = true;
    if (this.unloadUnactiveSlides && this.canvas && this.activeSlide) {
      delete this.activeSlide.canvas;
      this.activeSlide.fire("canvas:changed", { canvas: null });
      this.activeSlide.data = this.canvas.toObject();
      this.canvas.clear();
    }
    this.activeSlide = slide;
    this.activeSlide.canvas.mirrorSlide = this.canvas;

    this.canvas.processing = true;
    this.canvas.setSlide(this.activeSlide);
    this.fire("slide:changed", { canvas: this.canvas });
    this.canvas.processing = false;
    this.canvas.renderAll();

    if (this.activeSlide.canvas.loaded) {}
    //this.activeSlide.canvas.load(slide.object, function () {

  },
  unloadUnactiveSlides: false,
  lazyLoadEnabled: true,
  lazyLoad: function lazyLoad() {

    var app = this;
    if (this.lazyLoadEnabled) {
      this.slides.forEach(function (slide) {
        if (!slide.canvas.loaded && !slide.canvas.processing) {
          slide.canvas.load(slide.object, function () {
            slide.fire("loaded");
            // if(app.activeSlide === slide.id){
            //   this.setActiveSlide(slide);
            // }

            app.fire("slide:loading:end", { target: this });

            for (var _s in app.slides) {
              if (!app.slides[_s].canvas.loaded) {
                return;
              }
            }
            app.fire("loading:end", {});
          }.bind(slide));
        }
      });
    } else {
      app.fire("loading:end", {});
    }
  },
  addSlide: function addSlide(options) {
    var slide = new fabric.Slide(this, options);
    this.slides.push(slide);
    return slide;
  },
  removeSlide: function removeSlide(slide) {
    var _s = this.slides;
    var _curPos = _s.indexOf(slide);
    _s.splice(_curPos, 1);

    if (slide === this.activeSlide) {
      delete this.activeSlide;
    }
  },
  /**
   * move slide to another position
   * @param slide
   * @param newPosition
   */
  moveSlide: function moveSlide(slide, newPosition) {
    var _s = this.slides;

    var _curPos = _s.indexOf(slide);
    newPosition = parseInt(newPosition);

    if (_curPos < newPosition) {
      _s.splice(_curPos, 1);
      _s.splice(newPosition, 0, slide);
    } else {
      _s.splice(_curPos, 1);
      _s.splice(newPosition, 0, slide);
    }
  },
  /**
   * replace slide
   * @param slide
   * @param newPosition - position of the second slide
   */
  replaceSlide: function replaceSlide(slide, newPosition) {
    var _s = this.slides;
    var _replacedSlide = _s[newPosition];
    var _curPos = _s.indexOf(slide);
    if (_curPos < newPosition) {
      _s.splice(newPosition, 1, slide);
      _s.splice(_curPos, 1, _replacedSlide);
    } else {
      _s.splice(_curPos, 1, _replacedSlide);
      _s.splice(newPosition, 1, slide);
    }
  },

  preload: function preload() {
    for (var i in this.slides) {
      var _slide = this.slides[i];
      // _slide.canvas.preload(_slide.object, function () {
      //   _slide.fire("modified");
      // });
    }
  },

  setActiveSlideByIndex: function setActiveSlideByIndex(index) {
    this.setActiveSlide(this.slides[index]);
  },
  setActiveSlideById: function setActiveSlideById(id) {
    this.setActiveSlide(fabric.util.object.findWhere(this.slides, { id: id }));
  },
  duplicateSlide: function duplicateSlide(slideData) {
    slideData = slideData.canvas.toObject();
    var _slide = this.addSlide(slideData);
    _slide.canvas.load(_slide.object);
  },

  nextSlide: function nextSlide() {
    var i = this.slides.indexOf(this.activeSlide);
    if (i < this.slides.length - 1) {
      this.setActiveSlide(i + 1);
    }
  },
  prevSlide: function prevSlide() {
    var i = this.slides.indexOf(this.activeSlide);
    if (i > 0) {
      this.setActiveSlide(i - 1);
    }
  },
  gotoSlide: function gotoSlide(slide) {
    this.setActiveSlide(slide - 1);
  },
  nextSlideAvailable: function nextSlideAvailable() {
    var i = this.slides.indexOf(this.activeSlide);
    return i < this.slides.length - 1;
  },
  prevSlideAvailable: function prevSlideAvailable() {
    var i = this.slides.indexOf(this.activeSlide);
    return i > 0;
  },
  createSlidesList: function createSlidesList($container) {
    var _this2 = this;

    var $slideList = this.$slidesList = $("<div>").addClass("slides-list");
    var $slideListInner = $("<div>").addClass("slides-list-inner");
    $slideList.append($slideListInner);

    $container.append(this.$slidesList);

    this.slides.forEach(function (slide) {
      var $element = slide.canvas.lowerCanvasEl;
      $element.setAttribute("height", 150);
      fabric.util.createThumb(slide, $element);

      var $slide = $("<div>").addClass("slide").click(function () {
        return _this2.setActiveSlide(slide);
      }).append($element).append($("<span>").html(slide.canvas.title));

      if (slide.canvas.description) {
        $slide.attr("title", slide.canvas.description);
      }

      slide.on("modified", function () {
        this.canvas.renderAll();
      });
      $slideListInner.append($slide);
    });

    return {
      list: $slideList

      //this.canvas.on( "dimensions:modified" ,this.updateThumbs.bind(this))
      //this.updateThumbs();
    };
  },

  updateThumbs: function updateThumbs() {
    var _this3 = this;

    this.slides.forEach(function (slide) {
      slide.canvas.setDimensions({ width: _this3.canvas.width, height: _this3.canvas.height });
    });
  }
});

fabric.util.object.extend(fabric.SlideCanvas.prototype, {
  title: "New Slide",
  /**
   * Copy the content of active slide to main canvas.
   * @param slide
   */
  setSlide: function setSlide(slide) {

    this.loaded = false;
    this._objects = [];

    this.set(slide.canvas.toObjectSync());
    this.slide = slide;
    var sc = slide.canvas;

    sc._objects = this._objects;

    this.discardActiveGroup();
    this.discardActiveObject();
    /*
    // this.slideWidth = sc.slideWidth;
    // this.slideHeight = sc.slideHeight;
    this.setOriginalSize({width: sc.originalWidth || sc.width, height: sc.originalHeight || sc.height})
    this.backgroundImage = sc.backgroundImage;
    this.backgroundColor = sc.backgroundColor;
     if(this.resizable) {
      this.originalWidth  = sc.originalWidth;
      this.originalHeight  = sc.originalHeight ;
    }else{
      this.setWidth((sc.originalWidth || sc.width)* this.viewportTransform[0]);
      this.setHeight((sc.originalHeight || sc.height)  * this.viewportTransform[0]);
    }*/
    this._onResize();
    // this.activeArea = sc.activeArea;
    //this.originalSlide = sc;

    // this.template = sc.template;
    //  this.offsets = sc.offsets;
    // this._objects = [];
    // this.layers = sc.layers;

    /* if(this.backgroundImage){
       this.backgroundImage.canvas = this;
     }*/
    //todo
    // if(this._backgroundLayer) {
    //   for (var i in this._backgroundLayer) {
    //     this._backgroundLayer[i].canvas = this;
    //     this._backgroundLayer[i].setCoords();
    //   }
    //   this.setActiveArea(true);
    // }cd fier

    /*for(var layerName in sc.layers) {
      this.layers[layerName].objects = [];
    }*/
    // this._objects = this._objects;

    /*if(sc.layers) {
      for(var layerName in sc.layers){
        for (var i in sc.layers[layerName].objects) {
          this.add(sc.layers[layerName].objects[i]);
        }
        sc.layers[layerName].objects = this.layers[layerName].objects;
      }
      sc._objects = this._objects;
    }else{*/

    /*this._objects = [];
    for (let i in sc._objects) {
      this.add(sc._objects[i]);
    }*/
    // }

    this.loaded = true;
    this.fire('changed', { target: sc });
  },
  unique: false,
  required: false,
  stateProperties: ["unique", "required"],
  removeSlide: function removeSlide() {
    this.project.removeSlide(this);
  },
  duplicateSlide: function duplicateSlide() {
    this.project.duplicateSlide(this);
  },

  eventListeners: fabric.util.object.extendArraysObject(fabric.SlideCanvas.prototype.eventListeners, {
    "modified": function modified(e) {
      if (this.slide) {
        this.slide.canvas.set(e.states.modified);
        this.slide.fire("modified");
      }
    },
    "object:modified": function objectModified() {
      if (this.slide) {
        this.slide.fire("modified");
      }
    }
  })
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 21 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

/**
 * # Prototypes

 Prototypes allows to define **prototypes** property in Application configuration.

 ```javascript
 Application ({
  prototypes: {
    ClassName: options
  }
 })
 ```

 If prototype is defined every new Object created by application will have this properties by default.

 ```javascript
   NewClass: {
    $super: "ParentClass",
    type: "new-class",
    \/*other properties and methods*\/
   }
  ```

 if property **type** of Object class is defined then every object be default will have this type.

 ```javascript
   Object: {
    type: "rectangle"
   }
 ...
 //rectangle will be created
 fabric.createObject({width:100, height: 100})
 ```
*/

fabric.util.object.extend(fabric.Application.prototype, {
  optionsOrder: function () {
    var oo = fabric.Application.prototype.optionsOrder;
    oo.splice(oo.indexOf("canvasContainer"), 0, "prototypes");
    return oo;
  }(),
  getDefaultProperties: function getDefaultProperties(proto) {
    if (!this.prototypes) return;

    var klassname = fabric.util.string.capitalize(fabric.util.string.camelize(proto.type), true);

    var _protoProperties = proto.__proto__ && proto.__proto__.type && this.getDefaultProperties(proto.__proto__) || {};
    var _defaultProperties = fabric.util.object.clone(this.prototypes[klassname]);

    fabric.util.object.extend(_protoProperties, _defaultProperties);

    return _protoProperties;
  },
  /**
   * default prototypes propertes for objects
   */
  prototypes: {
    Object: {
      includeDefaultValues: false
    },
    Canvas: {
      includeDefaultValues: false
    }
  },
  setUtils: function setUtils(utilsOptions) {

    if (!utilsOptions) {
      return;
    }
    fabric.util.object.extend(this.util || {}, utilsOptions);

    if (this.options['util']) {
      fabric.util.object.extend(fabric.util, this.options['util']);
    }
    if (this.options['fabric']) {
      fabric.util.object.extend(fabric, this.options['fabric']);
    }
    delete this.options['fabric'];
    delete this.options['util'];
  },
  setPrototypes: function setPrototypes(prototypes) {

    var _prototypes = fabric.util.object.deepExtend({}, this.prototypes, prototypes);

    this.prototypes = _prototypes;
    this.klasses = {};

    if (_prototypes.eventListeners) {
      _prototypes.eventListeners.$extend = 'array';
    }

    for (var klassName in _prototypes) {
      var _proto = _prototypes[klassName];

      for (var j in _proto) {
        if (_proto[j] && _proto[j]["$extend"]) {
          var _extend = _proto[j]["$extend"];
          if (_extend == "array") {
            _proto[j] = fabric.util.object.extendArraysObject(fabric[klassName].prototype[j], _proto[j]);
          } else if (_extend == "deep") {
            _proto[j] = fabric.util.object.deepExtend(fabric[klassName].prototype[j], _proto[j]);
          } else {
            _proto[j] = fabric.util.object.extend(fabric[klassName].prototype[j], _proto[j]);
          }
          delete _proto[j]["$extend"];
        }
      }

      if (_proto["$super"]) {
        var _superklass = fabric[_proto["$super"] || klassName];
        delete _proto["$super"];

        var _fromObject = _proto.fromObject || _superklass.fromObject;
        delete _proto.fromObject;
        var _klass = this.klasses[klassName] = fabric.util.createClass(_superklass, _proto);
        _klass.fromObject = _fromObject.bind(_klass);
      }

      //   if (klassName.actions && _proto.actions.constructor == Function) {
      //     fabric[klassName].prototype.actions = _proto.actions.call(fabric[klassName].prototype)
      //   }
    }

    if (_prototypes.Application) {
      fabric.util.object.deepExtend(this, _prototypes.Application);
    }

    // delete this.options['prototypes'];

    if (this.actions && this.actions.constructor == Function) {
      this.actions = this.actions.call(this);
    }
  },
  eventListeners: fabric.util.object.extendArraysObject(fabric.Application.prototype.eventListeners, {
    "entity:created": function entityCreated(e) {
      var target = e.target;

      target.application = this;
      fabric.util.object.defaults(e.options, this.getDefaultProperties(target, e.options));

      for (var key in e.options) {
        var value = e.options[key];
        if (key[0] == "+") {
          var _key = key.substr(1);
          var _arr = target.get(_key);
          if (_arr instanceof Array) {
            _arr = _arr.slice().concat(value);
          } else {
            _arr = fabric.util.object.extend({}, _arr, value);
          }
          e.options[_key] = _arr;
          delete e.options[key];
        }
      }

      delete e.options.type;
      delete e.options.application;
    }
  })
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 22 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

var isVML = function isVML() {
  return typeof G_vmlCanvasManager !== 'undefined';
};

//weird stuff
// delete fabric.Rect.prototype.toObject;
// fabric.Rect.prototype.storeProperties = ["*","rx","ry"];

fabric.INCLUDE_ALL = "*";

var _toObject_overwritten = fabric.Object.prototype.toObject;
fabric.util.object.extend(fabric.Object.prototype, {
  storeProperties: ['*'],
  eventListeners: {},
  toObject: function toObject(propertiesToInclude) {
    if (propertiesToInclude == fabric.INCLUDE_ALL) {
      propertiesToInclude = [fabric.INCLUDE_ALL];
    }

    propertiesToInclude = propertiesToInclude || [];
    propertiesToInclude = propertiesToInclude.concat(this.storeProperties);

    var obj = _toObject_overwritten.call(this, propertiesToInclude);
    if (propertiesToInclude[0] !== fabric.INCLUDE_ALL) {
      if (!this.includeDefaultValues) {
        this._removeDefaultValues(obj);
      }
    }

    if (this.storeProperties.indexOf("*") == -1) {
      for (var i in obj) {
        if (this.storeProperties.indexOf(i) == -1) {
          delete obj[i];
        }
      }
    }

    this.fire("before:object", { object: obj });
    return obj;
  },
  /**
   * Sets object's properties from options
   * @param {Object} [options] Options object
   */
  setOptions: function setOptions(options) {
    this._setObject(options);
    // this._initGradient(options);
    // this._initPattern(options);
    // this._initClipping(options);
  },
  _initEntity: function _initEntity(options) {
    if (options.canvas && !options.application) {
      options.application = options.canvas.application;
    }
    options.application && options.application.fire("entity:created", { target: this, options: options });
  },
  initialize: function initialize(options, callback) {
    options = options || {};
    this._initEntity(options);
    // if(options.wholeCoordinates){
    //   var coordinates = ["left","top","width","height"];
    //   for(var i in coordinates){
    //     if(options[coordinates[i]]){
    //       options[coordinates[i]] = Math.round(options[coordinates[i]]);
    //     }
    //   }
    // }
    var _self = this;
    this._setObject(options, function () {
      _self.loaded = true;
      _self.fire("loaded");
      callback && callback(_self);
    });
  },
  add: function add(canvas) {
    canvas.add(this);
  },
  set: function set(key, value) {
    if ((typeof key === 'undefined' ? 'undefined' : _typeof(key)) === 'object') {
      this._setObject(key);
    } else {
      if (key[0] == "&") {
        key = key.substr(1);
        this._set(key, value(this.get(key)));
      } else {
        this._set(key, value);
      }
    }
    return this;
  }
});

fabric.util.object.extend(fabric.Object.prototype, {
  hasBoundsControls: true,
  stroke: "transparent",
  onTop: function onTop() {
    return this.canvas._objects.indexOf(this) == this.canvas._objects.length - 1;
  },
  flop: function flop() {
    this.flipY = !this.flipY;
    this.canvas.renderAll();
  },
  flip: function flip() {
    this.flipX = !this.flipX;
    this.canvas.renderAll();
  },
  onBottom: function onBottom() {
    return this.canvas._objects.indexOf(this) == 0;
  },
  duplicate: function duplicate() {
    var _object = this.toObject(fabric.INCLUDE_ALL);
    _object.active = true;
    _object.left += 10;
    _object.top += 10;
    var _clone = /*this.cloneSync && this.cloneSync() || */this.canvas.createObject(_object);
    return _clone;
  },
  minStrokeWidth: 0,
  maxStrokeWidth: function maxStrokeWidth() {
    return Math.min(this.width, this.height) / 2;
  },
  actions: {
    boundingRect: {
      type: 'label',
      template: '<dt>L:</dt><dd class="{leftClass}" title="{left}">{roundLeft}</dd><dt>T:</dt><dd class="{topClass}"  title="{top}">{roundTop}</dd><dt>R:</dt><dd class="{rightClass}" title="{right}">{roundRight}</dd><dt>B:</dt><dd class="{bottomClass}"  title="{bottom}">{roundBottom}</dd>',
      value: {
        observe: "modified scaling moving rotating",
        get: function get() {
          var _rect = this.getBoundingRect();

          if (this.movementLimits) {

            if (this.movementLimits == this.canvas) {
              var _v = this.canvas.viewportTransform;
              var _mlr = {
                left: _v[4],
                top: _v[5],
                width: (this.canvas.originalWidth || this.canvas.width) * _v[0],
                height: (this.canvas.originalHeight || this.canvas.height) * _v[3],
                right: 0,
                bottom: 0
              };
            } else {
              _mlr = this.movementLimits.getBoundingRect();
            }

            _rect.bottom = this.movementLimits.height - _rect.height;
            var _t = _rect.top - _mlr.top;
            var _l = _rect.left - _mlr.left;
            var _r = _mlr.width - _rect.width - _l;
            var _b = _mlr.height - _rect.height - _t;
          } else {
            _t = _rect.top;
            _l = _rect.left;
            _b = this.canvas.height - _rect.height - _rect.top;
            _r = this.canvas.width - _rect.width - _rect.left;
          }

          return {
            topClass: _t > 0 ? "positive" : _t < 0 ? "negative" : "zero",
            bottomClass: _b > 0 ? "positive" : _b < 0 ? "negative" : "zero",
            leftClass: _l > 0 ? "positive" : _l < 0 ? "negative" : "zero",
            rightClass: _r > 0 ? "positive" : _r < 0 ? "negative" : "zero",
            top: _t,
            left: _l,
            bottom: _b,
            right: _r,
            roundTop: Math.round(_t),
            roundLeft: Math.round(_l),
            roundBottom: Math.round(_b),
            roundRight: Math.round(_r)
          };
        }
      }
    },
    position: {
      title: 'position',
      type: 'menu',
      menu: {
        objectLeft: {
          type: 'number',
          title: 'left',
          value: {
            set: function set(val) {
              this.left = val;
              this.fire("modified");
              this.canvas.fire("object:modified", { target: this });
              this.canvas.renderAll();
            },
            get: function get() {
              return this.left;
            },
            observe: "modified"
          }
        },
        objectTop: {
          type: 'number',
          title: 'top',
          value: {
            set: function set(val) {
              this.top = val;
              this.fire("modified");
              this.canvas.fire("object:modified", { target: this });
              this.canvas.renderAll();
            },
            get: function get() {
              return this.top;
            },
            observe: "modified"
          }
        }
      }
    },
    dimensions: {
      title: 'dimensions',
      type: 'menu',
      menu: {
        objectWidth: {
          type: 'number',
          title: 'width',
          value: {
            set: function set(val) {
              this.saveState();
              this.dimensionsWidthValue = val;
              this.scaleToWidth(val * this.canvas.getZoom());
              this.canvas.fireModifiedIfChanged(this);
              this.canvas.renderAll();
              delete this.dimensionsWidthValue;
            },
            get: function get() {
              if (this.dimensionsWidthValue) {
                return this.dimensionsWidthValue;
              }
              return Math.round(this.getBoundingRect().width / this.canvas.getZoom());
            },
            observe: "modified"
          }
        },
        objectHeight: {
          type: 'number',
          title: 'height',
          value: {
            set: function set(val) {
              this.saveState();
              this.scaleToHeight(val * this.canvas.getZoom());
              this.dimensionsHeightValue = val;
              this.canvas.fireModifiedIfChanged(this);
              this.canvas.renderAll();
              delete this.dimensionsHeightValue;
            },
            get: function get() {
              if (this.dimensionsHeightValue) {
                return this.dimensionsHeightValue;
              }
              return Math.round(this.getBoundingRect().height / this.canvas.getZoom());
            },
            observe: "modified"
          }
        }
      }
    },
    center: {
      className: 'fa fa-bullseye',
      title: 'Center',
      action: function action() {
        this.center();
        this.setCoords();
      }
    },
    flip: {
      className: 'fa fa-arrows-h',
      title: 'flip',
      action: 'flip'
    },
    flop: {
      className: 'fa fa-arrows-v',
      title: 'flop'
    },
    bringForward: {
      title: 'bring forward',
      className: 'fa fa-level-up',
      disabled: 'onTop'
    },
    sendBackwards: {
      title: 'send backwards',
      className: 'fa fa-level-down',
      disabled: 'onBottom'
    },
    remove: {
      className: 'fa fa-trash',
      title: 'remove',
      key: "Delete"
    },
    duplicate: {
      className: 'fa fa-clone',
      title: 'duplicate'
    },
    fill: {
      type: 'color',
      title: 'fill',
      value: 'fill'
    }
  }
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 23 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

var textInitialize = fabric.Text.prototype.initialize;

fabric.util.object.extend(fabric.Text.prototype, {
  textInitialize: textInitialize,
  editTool: false,
  advancedColorsTools: false,
  textFontSizeTools: false,
  textAligmentTools: false,
  advancedTextStyleTools: false,
  rasterizeTool: false,
  rasterizeKlass: fabric.Image,
  initialize: function initialize(text, options) {
    this._initEntity(options);
    this.textInitialize(text, options);
    // this.updateCache();
  },
  _render_cache: function _render_cache(ctx) {
    ctx.save();
    ctx.scale(this.scaleX * (this.flipX ? -1 : 1), this.scaleY * (this.flipY ? -1 : 1));
    this.transform(ctx);
    this._setShadow(ctx);
    ctx.translate(-this.width / 2, -this.height / 2);
    ctx.drawImage(this._cache, 0, 0, this.width, this.height);
    ctx.restore();
  },
  updateCache: function updateCache() {

    var size = {
      width: this.width * this.canvas.dotsPerUnit,
      height: this.height * this.canvas.dotsPerUnit
    };

    var _clipTo = this.clipTo;
    delete this.clipTo;
    this._cache = fabric.util.createCanvasElementWithSize(size);
    var ctx = this._cache.getContext("2d");
    ctx.scale(this.canvas.dotsPerUnit, this.canvas.dotsPerUnit);
    ctx.translate(this.width / 2, this.height / 2);

    this.render(ctx, true);
    this.render = this._render_cache;
    this.clipTo = _clipTo;
  },
  rasterizeText: function rasterizeText() {
    this.updateCache();
    var img = fabric.util.createImage();

    img.onload = function () {
      var obj = this.toObject();
      obj.width = img.width;
      obj.height = img.height;
      obj.scaleX = this.scaleX * (this.height / img.height);
      obj.scaleY = this.scaleY * (this.width / img.width);
      obj.rasterizedType = obj.type;
      delete obj.type;

      var el = new this.rasterizeKlass(img, obj);
      this.canvas.add(el);
      this.canvas.remove(this);
      setTimeout(function () {
        this.canvas.setActiveObject(el);
        this.canvas.renderAll();
      }.bind(this));
    }.bind(this);
    img.src = this._cache.toDataURL();
    //this.on('modified',this.updateCache.bind(this));
  },
  getStyle: function getStyle(styleName) {
    var object = this;
    return object.getSelectionStyles && object.isEditing ? object.getSelectionStyles()[styleName] || object[styleName] : object[styleName] || object['__' + styleName] || '';
  },
  getPattern: function getPattern(url) {
    var _fill = this.getStyle('fill ');
    return _fill && _fill.source;
  },
  setPattern: function setPattern(url) {
    if (!url) {
      this.setStyle('fill');
    } else {
      // var _texture = _.findWhere(this.project.textures, {id: url});
      var _this = this;
      fabric.util.loadImage(url, function (img) {
        _this.setStyle('fill', new fabric.Pattern({
          source: img,
          repeat: 'repeat'
        }));
      });
    }
  },
  /* getOpacity: function () {
    return this.getStyle('opacity') * 100;
  },
  setOpacity: function (value) {
    this.setStyle('opacity', parseInt(value, 10) / 100);
  },*/
  getRadius: function getRadius() {
    return this.get('radius');
  },
  setShadow: function setShadow(options) {
    return this.setProperty('shadow', options ? new fabric.Shadow(options) : null);
  },
  setProperty: function setProperty(prop, value) {
    this[prop] = value;
    this.canvas && this.canvas.renderAll();
  },
  setRadius: function setRadius(value) {
    this.setProperty('radius', value);
  },
  getSpacing: function getSpacing() {
    return this.get('spacing');
  },
  setSpacing: function setSpacing(value) {
    this.setProperty('spacing', value);
  },
  getReverted: function getReverted() {
    return this.get('reverted');
  },
  setReverted: function setReverted(value) {
    this.setProperty('reverted', value);
  },
  getFill: function getFill() {
    return this.getStyle('fill');
  },
  setFill: function setFill(value) {
    this.setStyle('fill', value);
  },
  getText: function getText() {
    return this.get('text');
  },
  setText: function setText(value) {
    this.setProperty('text', value);
  },
  getTextAlign: function getTextAlign() {
    return this.get('textAlign');
  },
  setTextAlign: function setTextAlign(value) {
    this.setProperty('textAlign', value.toLowerCase());
  },
  getFontFamily: function getFontFamily() {
    return this.get('fontFamily');
  },
  setFontFamily: function setFontFamily(value) {
    this.setStyle('fontFamily', value);
  },
  getStyles: function getStyles() {
    return this.styles || {
      fill: this.fill,
      fontSize: this.fontSize,
      textBackgroundColor: this.textBackgroundColor,
      textDecoration: this.textDecoration,
      fontFamily: this.fontFamily,
      fontWeight: this.fontWeight,
      fontStyle: this.fontStyle,
      stroke: this.stroke,
      strokeWidth: this.strokeWidth
    };
  },
  getBgColor: function getBgColor() {
    return this.get('backgroundColor');
  },
  setBgColor: function setBgColor(value) {
    this.setProperty('backgroundColor', value);
  },
  getTextBgColor: function getTextBgColor() {
    return this.get('textBackgroundColor');
  },
  setTextBgColor: function setTextBgColor(value) {
    this.setProperty('textBackgroundColor', value);
  },
  getStroke: function getStroke() {
    return this.getStyle('stroke');
  },
  setStroke: function setStroke(value) {
    this.setStyle('stroke', value);
  },
  getStrokeWidth: function getStrokeWidth() {
    return this.getStyle('strokeWidth');
  },
  setStrokeWidth: function setStrokeWidth(value) {
    this.setStyle('strokeWidth', parseInt(value, 10));
  },
  decreaseFontSize: function decreaseFontSize() {
    this.setStyle('fontSize', parseInt(this.getStyle('fontSize')) - 1);
  },
  increaseFontSize: function increaseFontSize() {
    this.setStyle('fontSize', parseInt(this.getStyle('fontSize')) + 1);
  },
  getFontSize: function getFontSize() {
    return this.getStyle('fontSize');
  },
  setFontSize: function setFontSize(value) {
    this.setStyle('fontSize', parseInt(value, 10));
  },
  getLineHeight: function getLineHeight() {
    return this.getStyle('lineHeight');
  },
  setLineHeight: function setLineHeight(value) {
    this.setStyle('lineHeight', parseFloat(value, 10));
  },
  addText: function addText(text, options) {

    var _match = this.text.match(/\n/g);
    var _lineIndex = _match && _match.length || 0;
    var charIndex = this.text.length - this.text.lastIndexOf("\n") - 1;

    if (!this.styles[_lineIndex]) {
      this.styles[_lineIndex] = {};
    }

    if (!this.styles[_lineIndex][charIndex]) {
      this.styles[_lineIndex][charIndex] = {};
    }
    fabric.util.object.extend(this.styles[_lineIndex][charIndex], options);
    this.text += text;
    // this.styles;
  },
  getBold: function getBold() {
    return this.getStyle('fontWeight') === "bold";
  },
  setBold: function setBold(value) {
    this.setStyle('fontWeight', value ? 'bold' : '');
  },
  getItalic: function getItalic() {
    return this.getStyle('fontStyle') === 'italic';
  },
  setItalic: function setItalic(value) {
    this.setStyle('fontStyle', value ? 'italic' : '');
  },
  getUnderline: function getUnderline() {
    return this.getStyle('textDecoration').indexOf('underline') > -1;
  },
  setUnderline: function setUnderline(value) {
    value = value ? this.getStyle('textDecoration') + ' underline' : this.getStyle('textDecoration').replace('underline', '');

    this.setStyle('textDecoration', value);
  },
  getLinethrough: function getLinethrough() {
    return this.getStyle('textDecoration').indexOf('line-through') > -1;
  },
  setLinethrough: function setLinethrough(value) {
    value = value ? this.getStyle('textDecoration') + ' line-through' : this.getStyle('textDecoration').replace('line-through', '');

    this.setStyle('textDecoration', value);
  },
  getOverline: function getOverline() {
    return this.getStyle('textDecoration').indexOf('overline') > -1;
  },
  setOverline: function setOverline(value) {
    value = value ? this.getStyle('textDecoration') + ' overline' : this.getStyle('textDecoration').replace('overlin', '');

    this.setStyle('textDecoration', value);
  },
  setStyle: function setStyle(styleName, value) {
    var object = this;
    var _old = fabric.util.object.cloneDeep(object.getStyles());
    //var _old = fabric.util.object.deepExtend({}, object.getStyles);//getSelectionStyles();
    if (object.setSelectionStyles && object.isEditing) {
      var style = {};
      if (value !== undefined) {
        style[styleName] = value;
      } else {
        delete style[styleName];
      }
      object.setSelectionStyles(style);
      object.setCoords();
    } else {
      if (value !== undefined) {
        object[styleName] = value;
      } else {
        delete object[styleName];
      }
      for (var i in object.styles) {
        for (var j in object.styles[i]) {
          if (object.styles[i][j][styleName] !== undefined) {
            delete object.styles[i][j][styleName];
          }
        }
      }
    }

    var styles_data = object.getStyles();

    if (this.type != "text") {
      this.styles = fabric.util.object.cloneDeep(styles_data);
    }

    this.setCoords();

    this.fire("styles:modified", {
      original: _old,
      modified: styles_data
    });
    this.canvas && this.canvas.renderAll();
    /*
     this.project.history.add({
     slide: this.slide,
     object: this,
     undo: _old,
     redo: styles_data,
     type: 'styled',
     undoFn: function(){
     this.object.data.styles = this.undo;
     this.object.fabric.set('styles',this.undo);
     this.object.fabric.setCoords();
     this.object.slide.render();
     },
     redoFn:  function(){
     this.object.data.styles = this.redo;
     this.object.fabric.set('styles',this.redo);
     this.object.fabric.setCoords();
     this.object.slide.render();
     }
     });*/
  },

  generateTextStyle: function generateTextStyle() {
    return {
      'font-style': this.isItalic() ? 'italic' : 'normal',
      'font-weight': this.isBold() ? 700 : 400,
      'text-decoration': (this.isLinethrough() ? 'line-through ' : '') + (this.isOverline() ? 'overline ' : '') + (this.isUnderline() ? 'underline ' : '')
    };
  },
  actions: {
    rasterizeText: {
      insert: 'rasterizeTool',
      className: 'button-easel',
      title: 'rasterizeText'
      //   action: _TEX.rasterizeText
    },
    textBgcolor: {
      type: 'color',
      title: 'bgColor',
      value: 'bgColor'
    },
    textTextbgcolor: {
      type: 'color',
      title: 'textBgColor',
      value: 'textBgColor'
    },
    textBold: {
      type: "checkbox",
      title: 'bold',
      value: 'bold',
      className: 'fa fa-bold'
    },
    textItalic: {
      type: "checkbox",
      title: 'italic',
      value: 'italic',
      className: 'fa fa-italic'
    },
    textUnderline: {
      type: "checkbox",
      title: 'Underline',
      value: 'underline',
      className: 'fa fa-underline'
    },
    textLinethrough: {
      type: "checkbox",
      insert: 'advancedTextStyleTools',
      title: 'Linethrough',
      value: 'linethrough',
      className: 'text-linethrough fa fa-strikethrough'
    },
    textOverline: {
      type: "checkbox",
      insert: 'advancedTextStyleTools',
      title: 'overline',
      value: 'overline',
      className: 'text-overline fa fa-overline'
    },
    textAlign: {
      type: 'options',
      title: 'text align',
      insert: 'textAligmentTools',
      value: "textAlign",
      menu: {
        textAlignCenter: {
          title: 'align center',
          option: 'center',
          className: 'fa fa-align-center'
        },
        textAlignLeft: {
          title: 'align left',
          option: 'left',
          className: 'fa fa-align-left'
        },
        textAlignRight: {
          title: 'align right',
          option: 'right',
          className: 'fa fa-align-right'
        },
        textAlignJustify: {
          title: 'align justify',
          option: 'justify',
          className: 'fa fa-align-justify'
        }
      }
    },
    fontFamily: {
      type: 'fontFamily',
      title: 'font family',
      className: 'fa fa-text',
      value: 'fontFamily',
      data: function data() {
        return this.application._fonts;
      }
    },
    textFontSize: {
      insert: 'textFontSizeTools',
      type: 'number',
      title: 'fontSize',
      value: 'fontSize'
    },
    /*textFont: {
     insert: 'textFontSizeTools',
     type: 'menu',
     title: 'font',
     className: 'fa fa-font',
     menu: {
     textFontSizeDecrease: {
     title: 'decreaseFontSize',
     action: _TEX.decreaseFontSize,
     className: 'fa fa-font font-size-decrease'
     },
     textFontSizeIncrease: {
     title: 'increaseFontSize',
     action: _TEX.increaseFontSize,
     className: 'fa fa-font font-size-increase'
     }
     }
     }*/
    advancedColorsTools: {
      className: 'colors',
      type: 'menu',
      title: 'colors',
      toggled: true,
      menu: ["fill", "textBgcolor", "textTextbgcolor", "textFill"]
    },
    textStyle: {
      type: 'menu',
      title: 'text style',
      toggled: true,
      className: 'fa fa-font',
      style: 'generateTextStyle',
      menu: ["textBold", "textItalic", "textUnderline", "textLinethrough", "textOverline", "textAlign", "fontFamily", "textFontSize"]
    }
  }
});

fabric.util.object.extend(fabric.IText.prototype, {
  initHiddenTextarea_native: fabric.IText.prototype.initHiddenTextarea,
  initHiddenTextarea: function initHiddenTextarea() {
    this.initHiddenTextarea_native();
    this.hiddenTextarea.style.width = "9999px";
    this.hiddenTextarea.style["margin-left"] = "-9999px";
  },
  /**
   * Exits from editing state
   * @return {fabric.IText} thisArg
   * @chainable
   */
  exitEditing: function exitEditing() {
    // var isTextChanged = (this._textBeforeEdit !== this.text);
    this.selected = false;
    this.isEditing = false;
    this.selectable = true;

    this.selectionEnd = this.selectionStart;
    this.hiddenTextarea && this.canvas && this.hiddenTextarea.parentNode.removeChild(this.hiddenTextarea);
    this.hiddenTextarea = null;

    this.abortCursorAnimation();
    this._restoreEditingProps();
    this._currentCursorOpacity = 0;

    this.fire('editing:exited');
    // isTextChanged && this.fire('modified');
    if (this.canvas) {
      this.canvas.off('mouse:move', this.mouseMoveHandler);
      this.canvas.fire('text:editing:exited', { target: this });
      this.canvas.fireModifiedIfChanged(this);
    }
    return this;
  },
  maxStrokeWidth: function maxStrokeWidth() {
    return Math.ceil(this.getFontSize() / 10);
  },
  actions: {
    enterEditing: {
      insert: 'editTool',
      className: 'fa fa-pencil-square-o',
      title: 'edit'
      //action:     _TEX.enterEditing
    }
  }
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 24 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

var _GroupRemoveNetive = fabric.Group.prototype.remove;

fabric.util.object.extend(fabric.Group.prototype, {
  /**
   * Removes object from canvas to which it was added last
   * @return {fabric.Object} thisArg
   * @chainable
   */
  remove: function remove() {
    if (arguments.length === 0) {
      this.canvas && this.canvas.remove(this);
    } else {
      _GroupRemoveNetive.apply(this, arguments);
    }

    return this;
  }
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 25 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

__webpack_require__(7);

fabric.util.object.extend(fabric.Image.prototype, fabric.ImageMixin, {
  async: true,
  toObjectNative: fabric.Image.prototype.toObject,
  toObject: function toObject() {
    var obj = fabric.Image.prototype.toObjectNative.apply(this, arguments);
    if (obj.src.indexOf(fabric.util.mediaRoot) == 0) {
      obj.src = obj.src.replace(fabric.util.mediaRoot, "");
    }
    return obj;
  },
  initialize: function initialize(element, options, callback) {
    options || (options = {});
    this.filters = [];
    this.resizeFilters = [];

    if (options.originalSrc) {
      this._edited = true;
      fabric.util.loadImage(options.originalSrc, function (img) {
        this._originalElement = img;
      }.bind(this));
    }

    this._initElement(element, options, callback && function () {
      fabric.Object.prototype.initialize.call(this, options, callback);
    }.bind(this)); //adding callback
  },

  _initElement: function _initElement(element, options, callback) {
    this.setElement(fabric.util.getById(element), callback, options);
    fabric.util.addClass(this.getElement(), fabric.Image.CSS_CANVAS);
  },
  /**
   * Sets crossOrigin value (on an instance and corresponding image element)
   * @return {fabric.Image} thisArg
   * @chainable
   */
  setCrossOrigin: function setCrossOrigin(value) {
    this.crossOrigin = value;
    if (this._element) {
      this._element.crossOrigin = value;
    }
    return this;
  },
  setElement: function setElement(element, callback, options) {

    var _callback, _this;

    this._element = element;
    this._originalElement = element;
    this._initConfig(options);
    // this.setOptions(options );
    // this._setWidthHeight(this);
    // if (this._element && this.crossOrigin) {
    //   this._element.crossOrigin = this.crossOrigin;
    // }


    if (this.resizeFilters.length === 0) {
      _callback = callback;
    } else {
      _this = this;
      _callback = function _callback() {
        _this.applyFilters(callback, _this.resizeFilters, _this._filteredEl || _this._originalElement, true);
      };
    }

    if (this.filters.length !== 0) {
      this.applyFilters(_callback);
    } else if (_callback) {
      _callback(this);
    }
    if (this.canvas) {
      this.canvas.renderAll();
    }
    return this;
  },
  actions: {
    source: {
      type: 'effect',
      className: 'fa fa-file-image-o',
      title: "source",
      actionParameters: function actionParameters($el, data) {
        data.target.application.createGallery(data.target, $el);
      }
    }
  }
});

fabric.util.initFilters = function (img, object, callback) {

  // if (fabric.version >= 1.6) {
  fabric.Image.prototype._initFilters.call(object, object.filters, function (filters) {
    object.filters = filters || [];
    fabric.Image.prototype._initFilters.call(object, object.resizeFilters, function (resizeFilters) {
      object.resizeFilters = resizeFilters || [];
      callback(img, object);
    });
  });
  // } else {
  //   fabric.Image.prototype._initFilters.call(object, object, function (filters) {
  //     object.filters = filters || [];
  //     callback(img, object);
  //   });
  // }
};

fabric.util.initImageAndFilters = function (object, callback) {
  if (object.image) {
    var img = object.image;
    delete object.src;
    delete object.image;
    fabric.util.initFilters(img, object, callback);
  } else if (object.src) {
    fabric.util.loadImage(object.src, function (img) {
      //delete object.src;
      fabric.util.initFilters(img, object, callback);
    }, null, object.crossOrigin);
  } else {
    fabric.util.initFilters(null, object, callback);
  }
};

fabric.Image.fromObject = function (object, callback) {
  fabric.util.initImageAndFilters(object, function (img, object) {
    var instance = new fabric.Image(img, object, callback);
  });
};

fabric.Image.prototype._to_object_overwritten = fabric.Image.prototype.toObject;
fabric.Image.prototype.setSrc = function (opt) {
  console.log(opt);
};

fabric.Image.prototype.toObject = function (opt) {
  var obj = fabric.Image.prototype._to_object_overwritten.call(this, opt);

  if (this._edited) {
    obj.originalSrc = this._original_src || this._originalElement.src || this._element.src;
    obj.src = this._element.src;
  } else {
    obj.src = this._original_src || this._originalElement.src || this._element.src;
  }
  if (this.contentOffsets) {
    obj.contentOffsets = this.contentOffsets;
  }

  if (!this.includeDefaultValues) {
    if (!obj.filters.length) delete obj.filters;
  }
  //if(this._originalElement){
  //    obj.thumb = this._element.src;
  //}

  return obj;
};
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 26 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.Application.prototype.configurationProperties.push("templates");

fabric.util.object.extend(fabric.Application.prototype, {
  setTemplates: function setTemplates(value) {
    this.templates = value;
  }
});

fabric.util.object.extend(fabric.StaticCanvas.prototype, {
  eventListeners: fabric.util.object.extendArraysObject(fabric.StaticCanvas.prototype.eventListeners, {
    "loading:begin": function loadingBegin(e) {
      var val = e.options.template;
      if (val) {
        var tpl = this.getTemplate(val);
        fabric.util.object.extend(e.options, tpl.data);
      }
    }
  }),
  setTemplate: function setTemplate(value) {
    this.template = value;
  },
  //-------------------------------------------------------------------------------
  getTemplate: function getTemplate(id) {
    return fabric.util.object.findWhere(this.application.templates, { id: id });
  },
  updateSlideTemplate: function updateSlideTemplate(slide) {
    slide.canvas.setTemplate(slide.canvas.template);
    this.canvas.template = slide.canvas.template;
    if (this.activeSlide == slide) {
      this.canvas.setTemplate(slide.canvas.template);
    }
  },
  updateTemplate: function updateTemplate(template) {
    for (var i in this.slides) {
      if (this.slides[i].canvas.template == template) {
        this.updateSlideTemplate(this.slides[i]);
      }
    }
  }
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 27 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

/*todo
fabric.SlideCanvas.addPlugin("initialize",function(){
  if(typeof this.freeDrawingBrush == "string" ){
    this.setFreeDrawingBrush(this.freeDrawingBrush);
  }
});*/

fabric.util.object.extend(fabric.SlideCanvas.prototype, {
  /**
   * ['PencilBrush','RectangleBrush']
   */
  activeDrawingTools: [],
  /**
   *
     {
      BrushClassName: {
        className: 'brush className',
        title: 'brush title'
      }
    }
   */
  drawingTools: {},
  insertDrawingTool: false,
  actions: fabric.util.object.extend(fabric.SlideCanvas.prototype.actions, {
    drawingTool: {
      title: 'drawing-tool',
      type: 'options',
      value: 'freeDrawingBrush',
      menu: function menu() {
        var _tools = {};
        for (var i in this.activeDrawingTools) {
          var _tool = this.activeDrawingTools[i];
          _tools[_tool] = fabric.util.object.extend({ option: _tool }, this.drawingTools[_tool]);
        }
        return _tools;
      }
    }
  }),
  freeDrawingBrush: 'PencilBrush',
  drawingColor: [0, 0, 0, 255],
  _onMouseDownInDrawingMode: function _onMouseDownInDrawingMode(e) {
    this._isCurrentlyDrawing = true;
    if (!this.freeDrawingBrush.target) {
      this.discardActiveObject(e).renderAll();
    }
    if (this.clipTo) {
      fabric.util.clipContext(this, this.contextTop);
    }
    var pointer = this.getPointer(e);
    this.freeDrawingBrush.onMouseDown(pointer);
    this._handleEvent(e, 'down');
  },
  getFreeDrawingBrush: function getFreeDrawingBrush() {
    if (!this.freeDrawingBrush) {
      return "Selection";
    }
    return fabric.util.string.capitalize(fabric.util.string.camelize(this.freeDrawingBrush.type), true);
  },
  setFreeDrawingBrush: function setFreeDrawingBrush(brush) {

    if (brush == 'Selection') {
      this.isDrawingMode = false;
      this.freeDrawingBrush = "";
      return;
    }
    var className = fabric.util.string.capitalize(fabric.util.string.camelize(brush), true);
    if (this["__" + className]) {
      this.freeDrawingBrush = this["__" + className];
    } else {
      this.freeDrawingBrush = this["__" + className] = new fabric[className](this);
    }
    this.fire("brush:changed", { brush: this.freeDrawingBrush });
  },
  drawZoomedArea: function drawZoomedArea(ctx, left, top, width, height, pointer) {

    width = width || 90;
    height = height || 90;

    ctx.save();
    ctx.translate(left || 0, top || 0);

    ctx.fillStyle = 'black';
    ctx.strokeStyle = "#fff";
    ctx.strokeWidth = 1;
    ctx.setLineDash([2, 2]);
    ctx.drawImage(this.backgroundImage._element, Math.floor(pointer.x) - 4, Math.floor(pointer.y) - 4, 9, 9, 0, 0, width, width);
    ctx.strokeRect(0, 0, width, width);
    ctx.strokeRect(40, 40, 10, 10);
    ctx.restore();
  }
});

fabric.SlideCanvas.prototype.drawingTools.Selection = {
  className: 'fa fa-mouse-pointer',
  title: 'Selection'
};
fabric.SlideCanvas.prototype.activeDrawingTools.push("Selection");
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 28 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

if (!Toolbar) {
  var Toolbar = __webpack_require__(1);
  __webpack_require__(29);
  __webpack_require__(31);
  __webpack_require__(33);
  __webpack_require__(34);
  __webpack_require__(35);
}

Toolbar.prototype.setFunctionCallback = function (target) {
  if (target.canvas) {
    return target.canvas.renderAll();
  }
  if (target.renderAll) {
    return target.renderAll();
  }
};

fabric.ToolsMixin = {
  /**
   *
   * @param tools ["x", "*", "y"]
   * @param proto
   * @returns ["x", "a", "b", "c", "y"]
   * @private
   */
  _getTools: function _getTools(tools, proto) {
    var indexOfStar = -1;
    if ((indexOfStar = tools.indexOf("*")) == -1) {
      return tools;
    }

    var klassname = fabric.util.string.capitalize(fabric.util.string.camelize(proto.type), true);
    var protoFabric = fabric[klassname].prototype;
    var protoApp = this.application.prototypes[klassname];

    var tools2 = protoApp && protoApp.tools || protoFabric.tools;
    if (tools2) {
      tools.splice.apply(tools, [indexOfStar, 1].concat(tools2));
    }
    return this._getTools(tools, protoFabric.__proto__);
  },
  setTools: function setTools(tools) {
    this.tools = this._getTools(tools, this.__proto__.__proto__);
    this.makeActions();
  },
  _getActionValue: function _getActionValue(property) {
    var object = this;
    do {
      if (object.actions && object.actions[property]) {
        return object.actions[property];
      }
    } while (object = object.__proto__);
    return null;
  },
  makeActions: function makeActions() {
    var actions = {};
    var self = this;
    _.each(this.tools, function (tool) {
      var _val = self._getActionValue(tool);
      if (_val) {
        actions[tool] = _val;
      } else {
        console.warn("tool " + tool + " is undefined");
      }
    });
    this.generatedActions = Toolbar.makeActions(actions, this);
  }
};
fabric.util.object.extend(fabric.Canvas.prototype, fabric.ToolsMixin);
fabric.util.object.extend(fabric.Object.prototype, fabric.ToolsMixin);
fabric.util.object.extend(fabric.Application.prototype, fabric.ToolsMixin);

fabric.util.object.extend(fabric.Application.prototype, {
  toolbar: false,
  setApplicationToolbarContainer: function setApplicationToolbarContainer(containerId) {
    this.applicationToolbarContainer = containerId;
    new fabric.Toolbar(this, containerId);
  },
  setCanvasToolbarContainer: function setCanvasToolbarContainer(containerId) {
    this.canvasToolbarContainer = containerId;
    new fabric.Toolbar(this.canvas, containerId);
  },
  setObjectsToolbarOptions: function setObjectsToolbarOptions(options) {
    options = _.defaults(options || {
      originX: "left",
      originY: "top",
      marginX: 0,
      marginY: 0
    });

    this.objectsToolbarOptions = options;

    var canvas = this.canvas;
    canvas.on({
      'object:moving': function objectMoving(event) {
        var $menu = this.getToolbarContainer();
        canvas.setToolbarCoords($menu, canvas.target, canvas.application.objectsToolbarOptions);
      }
    });
  },
  setObjectsToolbarContainer: function setObjectsToolbarContainer(containerId) {
    this.objectsToolbarContainer = containerId;

    var canvas = this.canvas;

    if (containerId) {
      this.$menu = $(document.getElementById(containerId)).hide();
    } else {
      this.$menu = this.$menu || $('<div>');
      $(this.wrapperEl).prepend(this.$menu);
    }
    this.$menu.hide();

    var _last_target = canvas.target;
    canvas.on({
      'target:cleared': function targetCleared(event) {
        if (_last_target) {
          var $menu = this.getToolbarContainer();
          $menu.hide();
          canvas.objectToolbar.destroy();
          delete canvas.objectToolbar;
          _last_target = null;
        }
      },
      'target:changed': function targetChanged(event) {
        if (_last_target) {
          canvas.objectToolbar.destroy();
        }
        canvas.createFloatedMenu(this.application.objectsToolbarOptions);
        _last_target = event.target;
      }
    });
  },
  setToolbarOptions: function setToolbarOptions(toolbarOptions) {

    fabric.util.object.deepExtend(Toolbar.tools, toolbarOptions.tools);
    for (var klassName in toolbarOptions.actions) {
      var actions = toolbarOptions.actions[klassName];
      if (!fabric[klassName].prototype.actions) {
        fabric[klassName].prototype.actions = {};
      }
      var protoActions = fabric[klassName].prototype.actions;

      if (actions.constructor == Function) {
        actions = actions.call(fabric[klassName].prototype);
      } else {
        actions = fabric.util.object.cloneDeep(actions);
      }
      // var $order = actions["$order"];
      // delete actions["$order"];

      for (var j in actions) {
        if (protoActions[j]) {
          if (actions[j]["$clone"]) {
            protoActions[j] = fabric.util.object.deepExtend({}, protoActions[j]);
            delete actions[j]["$clone"];
          }
          fabric.util.object.deepExtend(protoActions[j], actions[j]);
        } else {
          protoActions[j] = actions[j];
        }
      }
      /* if($order){
         fabric[klassName].prototype.actions = fabric.util.object.rearrange(protoActions, $order);
       }*/
    }
  },
  eventListeners: fabric.util.object.extendArraysObject(fabric.Application.prototype.eventListeners, {
    // "canvas:created" : function(){
    //  this.initTools();
    // },
    //  "canvas:created": function(){
    //    this.createToolbars();
    //  }
  })
});

fabric.Toolbar = Toolbar;

fabric.util.object.extend(fabric.Canvas.prototype, {
  setToolbarCoords: function setToolbarCoords($menu, target, options) {

    options = fabric.util.object.extend({
      originX: "left",
      originY: "top",
      marginX: 0,
      marginY: 0
    }, options);

    target.setCoords();
    var r = target.getBoundingRect();

    var _left;
    switch (options.originX) {
      case "left":
        _left = r.left;
        break;
      case "right":
        _left = r.left + r.width;
        break;
      case "center":
        _left = r.left + r.width / 2;
        break;
    }
    ;
    var _top;
    switch (options.originY) {
      case "top":
        _top = r.top - $menu.height();
        break;
      case "bottom":
        _top = r.top + r.height;
        break;
      case "center":
        _top = r.top + r.height / 2 - $menu.height() / 2;
        break;
    }
    ;

    _top += options.marginY;
    _left += options.marginX;

    var _menuContainerOffset = $($menu.parents()[0]).offset();
    var _canvasOffset = $(this.wrapperEl).offset();

    _top += _canvasOffset.top - _menuContainerOffset.top;
    _left += _canvasOffset.left - _menuContainerOffset.left;

    var coords = {
      top: Math.max(3, _top),
      left: Math.min(Math.max(3, _left), $(this.wrapperEl).width() - $menu.width() - 5)
    };

    $(this.wrapperEl).offset();

    $menu.css(coords);
    return coords;
  },
  getToolbarContainer: function getToolbarContainer(id, options) {
    return $(document.getElementById(this.application.objectsToolbarContainer));
  },
  createFloatedMenu: function createFloatedMenu(options) {

    var $menu = this.getToolbarContainer();

    $menu.show();
    //this.toolsContainer = this.$menu;
    /* var _tc = $menu.find(".toolbar-tools-container");
     if (_tc.length) {
       this.toolsContainer = _tc;
     }*/
    // this.toolsContainer.empty();
    if (this.target.actions) {
      this.objectToolbar = new fabric.Toolbar(this.target, $menu, options);
    }
    if (this.application.objectsToolbarOptions) {
      $menu.css({
        "position": "absolute",
        "z-index": 999
      });
      $menu.addClass("floated-menu");
      this.setToolbarCoords($menu, this.target, this.application.objectsToolbarOptions);
    }
  }
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 29 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


if (!$.minicolors) {
  __webpack_require__(30);
}

if (typeof Toolbar === "undefined") {
  var Toolbar = __webpack_require__(1);
}

Toolbar.prototype.colorpicker = function (el, options) {
  options.format = 'rgb';
  options.opacity = true;
  el.minicolors(options);
};

Toolbar.prototype.colorpickerOptions = {
  position: "right bottom"
};

Toolbar.prototype.tools.color = {
  template: '<div class="object-menu-item" title="{title}">' + '<div class="btn button-{id} {className}">' + '<input type="text" data-format="rgba" data-opacity="true" data-text="true" data-control="saturation" data-swatches="#fff|#000|#f00|#0f0|#00f|#ff0|#0ff"  value="{valueCurrent}" transclude>',
  post: function post($item, data, options, transclude) {
    var target = data.target;

    var _visible = false;
    this.colorpicker(transclude, {
      // value:        data.value.get() ,//|| data.value.get(),
      defaultValue: /*data.value.defaultValue ||*/data.value.get(),
      control: transclude.attr('data-control') || 'hue',
      format: transclude.attr('data-format') || 'hex',
      keywords: transclude.attr('data-keywords') || '',
      inline: transclude.attr('data-inline') === 'true',
      letterCase: transclude.attr('data-letterCase') || 'lowercase',
      opacity: transclude.attr('data-opacity'),
      position: transclude.attr('data-position') || this.colorpickerOptions.position,
      swatches: transclude.attr('data-swatches') ? transclude.attr('data-swatches').split('|') : [],
      text: transclude.attr('data-text'),
      hide: function hide() {
        _visible = false;
      },
      show: function show() {
        _visible = true;
      },
      change: function change(value, opacity) {
        data.value.set(value);
      }
    });

    var _el = $(transclude.parents()[0]).find(".minicolors-panel");

    var _HIDE = function _HIDE(e) {
      if (_visible && $(e.target).parents().index(_el) == -1) {
        transclude.minicolors("hide");
      }
    };
    $("body").on("mousedown", _HIDE);
  }
};

/***/ }),
/* 30 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

/*
 * jQuery MiniColors: A tiny color picker built on jQuery
 *
 * Copyright: Cory LaViska for A Beautiful Site, LLC: http://www.abeautifulsite.net/
 *
 * Contribute: https://github.com/claviska/jquery-minicolors
 *
 * @license: http://opensource.org/licenses/MIT
 *
 */

(function (factory) {
  if (( false ? 'undefined' : _typeof(exports)) === 'object') {
    module.exports = factory(__webpack_require__(9));
  } else {
    factory(jQuery);
  }
})(function ($) {

  'use strict';
  //if(_ && _.styleSheetContains && !_.styleSheetContains('.minicolors')){
  //  _.linkCSS(_.scriptURL() + "/../../css/jquery.minicolors.css");
  //}

  // Defaults

  $.minicolors = {
    defaults: {
      animationSpeed: 50,
      animationEasing: 'swing',
      change: null,
      changeDelay: 0,
      control: 'hue',
      dataUris: true,
      defaultValue: '',
      format: 'hex',
      hide: null,
      hideSpeed: 100,
      inline: false,
      keywords: '',
      letterCase: 'lowercase',
      opacity: false,
      position: 'bottom left',
      show: null,
      showSpeed: 100,
      theme: 'default',
      swatches: []
    }
  };

  // Public methods
  $.extend($.fn, {
    minicolors: function minicolors(method, data) {

      switch (method) {

        // Destroy the control
        case 'destroy':
          $(this).each(function () {
            destroy($(this));
          });
          return $(this);

        // Hide the color picker
        case 'hide':
          hide();
          return $(this);

        // Get/set opacity
        case 'opacity':
          // Getter
          if (data === undefined) {
            // Getter
            return $(this).attr('data-opacity');
          } else {
            // Setter
            $(this).each(function () {
              updateFromInput($(this).attr('data-opacity', data));
            });
          }
          return $(this);

        // Get an RGB(A) object based on the current color/opacity
        case 'rgbObject':
          return rgbObject($(this), method === 'rgbaObject');

        // Get an RGB(A) string based on the current color/opacity
        case 'rgbString':
        case 'rgbaString':
          return rgbString($(this), method === 'rgbaString');

        // Get/set settings on the fly
        case 'settings':
          if (data === undefined) {
            return $(this).data('minicolors-settings');
          } else {
            // Setter
            $(this).each(function () {
              var settings = $(this).data('minicolors-settings') || {};
              destroy($(this));
              $(this).minicolors($.extend(true, settings, data));
            });
          }
          return $(this);

        // Show the color picker
        case 'show':
          show($(this).eq(0));
          return $(this);

        // Get/set the hex color value
        case 'value':
          if (data === undefined) {
            // Getter
            return $(this).val();
          } else {
            // Setter
            $(this).each(function () {
              if ((typeof data === 'undefined' ? 'undefined' : _typeof(data)) === 'object') {
                if (data.opacity) {
                  $(this).attr('data-opacity', keepWithin(data.opacity, 0, 1));
                }
                if (data.color) {
                  $(this).val(data.color);
                }
              } else {
                $(this).val(data);
              }
              updateFromInput($(this));
            });
          }
          return $(this);

        // Initializes the control
        default:
          if (method !== 'create') data = method;
          $(this).each(function () {
            init($(this), data);
          });
          return $(this);

      }
    }
  });

  var inputText, globalSettings, globalTarget, globalInput;
  // Initialize input elements
  function init(input, settings) {

    var minicolors = $('<div class="minicolors" />'),
        defaults = $.minicolors.defaults,
        size,
        swatches,
        textPanel,
        swatch,
        panel,
        globalTarget = input,
        i;

    // Do nothing if already initialized
    if (input.data('minicolors-initialized')) return;

    // Handle settings
    globalSettings = settings = $.extend(true, {}, defaults, settings);

    // The wrapper
    minicolors.addClass('minicolors-theme-' + settings.theme).toggleClass('minicolors-with-opacity', settings.opacity).toggleClass('minicolors-no-data-uris', settings.dataUris !== true);

    // Custom positioning
    if (settings.position !== undefined) {
      $.each(settings.position.split(' '), function () {
        minicolors.addClass('minicolors-position-' + this);
      });
    }

    // Input size
    if (settings.format === 'rgb') {
      size = settings.opacity ? '25' : '20';
    } else {
      size = settings.keywords ? '11' : '7';
    }
    globalInput = input;
    // The input
    input.addClass('minicolors-input').data('minicolors-initialized', false).data('minicolors-settings', settings).prop('size', size).wrap(minicolors).after('<div class="minicolors-panel minicolors-slider-' + settings.control + '">' + '<div class="minicolors-slider minicolors-sprite">' + '<div class="minicolors-picker"></div>' + '</div>' + '<div class="minicolors-opacity-slider minicolors-sprite">' + '<div class="minicolors-picker"></div>' + '</div>' + '<div class="minicolors-grid minicolors-sprite">' + '<div class="minicolors-grid-inner"></div>' + '<div class="minicolors-picker"><div></div></div>' + '</div>' + '</div>');

    // The swatch
    if (!settings.inline) {
      input.after('<span class="minicolors-swatch minicolors-sprite minicolors-input-swatch"><span class="minicolors-swatch-color"></span></span>');
      input.next('.minicolors-input-swatch').on('click', function (event) {
        event.preventDefault();
        input.focus();
      });
    }

    // Prevent text selection in IE
    panel = input.parent().find('.minicolors-panel');
    panel.on('selectstart', function () {
      return false;
    }).end();

    // Swatches
    if (settings.swatches && settings.swatches.length !== 0) {
      if (settings.swatches.length > 7) {
        settings.swatches.length = 7;
      }
      panel.addClass('minicolors-with-swatches');
      swatches = $('<ul class="minicolors-swatches"></ul>').appendTo(panel);
      for (i = 0; i < settings.swatches.length; ++i) {
        swatch = settings.swatches[i];
        swatch = isRgb(swatch) ? parseRgb(swatch, true) : hex2rgb(parseHex(swatch, true));
        $('<li class="minicolors-swatch minicolors-sprite"><span class="minicolors-swatch-color"></span></li>').appendTo(swatches).data('swatch-color', settings.swatches[i]).find('.minicolors-swatch-color').css({
          backgroundColor: rgb2hex(swatch),
          opacity: swatch.a
        });
        settings.swatches[i] = swatch;
      }
    }

    // Swatches
    if (settings.text) {
      panel.addClass('minicolors-with-text');
      textPanel = $('<div class="minicolors-text"></div>').appendTo(panel);
      inputText = $('<input type="text">').appendTo(textPanel);

      $(inputText).change(function () {
        input.val(inputText.val());
        updateFromInput(input, true);
      });
    }

    // Inline controls
    if (settings.inline) input.parent().addClass('minicolors-inline');

    updateFromInput(input, false);

    input.data('minicolors-initialized', true);
  }

  // Returns the input back to its original state
  function destroy(input) {

    var minicolors = input.parent();

    // Revert the input element
    input.removeData('minicolors-initialized').removeData('minicolors-settings').removeProp('size').removeClass('minicolors-input');

    // Remove the wrap and destroy whatever remains
    minicolors.before(input).remove();
  }

  // Shows the specified dropdown panel
  function show(input) {

    var minicolors = input.parent(),
        panel = minicolors.find('.minicolors-panel'),
        settings = input.data('minicolors-settings');

    // Do nothing if uninitialized, disabled, inline, or already open
    if (!input.data('minicolors-initialized') || input.prop('disabled') || minicolors.hasClass('minicolors-inline') || minicolors.hasClass('minicolors-focus')) return;

    hide();

    minicolors.addClass('minicolors-focus');
    panel.stop(true, true).fadeIn(settings.showSpeed, function () {
      if (settings.show) settings.show.call(input.get(0));
    });
  }

  // Hides all dropdown panels
  function hide() {

    $('.minicolors-focus').each(function () {

      var minicolors = $(this),
          input = minicolors.find('.minicolors-input'),
          panel = minicolors.find('.minicolors-panel'),
          settings = input.data('minicolors-settings');

      panel.fadeOut(settings.hideSpeed, function () {
        if (settings.hide) settings.hide.call(input.get(0));
        minicolors.removeClass('minicolors-focus');
      });
    });
  }

  // Moves the selected picker
  function move(target, event, animate) {

    var input = target.parents('.minicolors').find('.minicolors-input'),
        settings = input.data('minicolors-settings'),
        picker = target.find('[class$=-picker]'),
        offsetX = target.offset().left,
        offsetY = target.offset().top,
        x = Math.round(event.pageX - offsetX),
        y = Math.round(event.pageY - offsetY),
        duration = animate ? settings.animationSpeed : 0,
        wx,
        wy,
        r,
        phi;

    // Touch support
    if (event.originalEvent.changedTouches) {
      x = event.originalEvent.changedTouches[0].pageX - offsetX;
      y = event.originalEvent.changedTouches[0].pageY - offsetY;
    }

    // Constrain picker to its container
    if (x < 0) x = 0;
    if (y < 0) y = 0;
    if (x > target.width()) x = target.width();
    if (y > target.height()) y = target.height();

    // Constrain color wheel values to the wheel
    if (target.parent().is('.minicolors-slider-wheel') && picker.parent().is('.minicolors-grid')) {
      wx = 75 - x;
      wy = 75 - y;
      r = Math.sqrt(wx * wx + wy * wy);
      phi = Math.atan2(wy, wx);
      if (phi < 0) phi += Math.PI * 2;
      if (r > 75) {
        r = 75;
        x = 75 - 75 * Math.cos(phi);
        y = 75 - 75 * Math.sin(phi);
      }
      x = Math.round(x);
      y = Math.round(y);
    }

    // Move the picker
    if (target.is('.minicolors-grid')) {
      picker.stop(true).animate({
        top: y + 'px',
        left: x + 'px'
      }, duration, settings.animationEasing, function () {
        updateFromControl(input, target);
      });
    } else {
      picker.stop(true).animate({
        top: y + 'px'
      }, duration, settings.animationEasing, function () {
        updateFromControl(input, target);
      });
    }
  }

  // Sets the input based on the color picker values
  function updateFromControl(input, target) {

    function getCoords(picker, container) {

      var left, top;
      if (!picker.length || !container) return null;
      left = picker.offset().left;
      top = picker.offset().top;

      return {
        x: left - container.offset().left + picker.outerWidth() / 2,
        y: top - container.offset().top + picker.outerHeight() / 2
      };
    }

    var hue,
        saturation,
        brightness,
        x,
        y,
        r,
        phi,
        hex = input.val(),
        opacity = input.attr('data-opacity'),


    // Helpful references
    minicolors = input.parent(),
        settings = input.data('minicolors-settings'),
        swatch = minicolors.find('.minicolors-input-swatch'),


    // Panel objects
    grid = minicolors.find('.minicolors-grid'),
        slider = minicolors.find('.minicolors-slider'),
        opacitySlider = minicolors.find('.minicolors-opacity-slider'),


    // Picker objects
    gridPicker = grid.find('[class$=-picker]'),
        sliderPicker = slider.find('[class$=-picker]'),
        opacityPicker = opacitySlider.find('[class$=-picker]'),


    // Picker positions
    gridPos = getCoords(gridPicker, grid),
        sliderPos = getCoords(sliderPicker, slider),
        opacityPos = getCoords(opacityPicker, opacitySlider);

    // Handle colors
    if (target.is('.minicolors-grid, .minicolors-slider, .minicolors-opacity-slider')) {

      // Determine HSB values
      switch (settings.control) {

        case 'wheel':
          // Calculate hue, saturation, and brightness
          x = grid.width() / 2 - gridPos.x;
          y = grid.height() / 2 - gridPos.y;
          r = Math.sqrt(x * x + y * y);
          phi = Math.atan2(y, x);
          if (phi < 0) phi += Math.PI * 2;
          if (r > 75) {
            r = 75;
            gridPos.x = 69 - 75 * Math.cos(phi);
            gridPos.y = 69 - 75 * Math.sin(phi);
          }
          saturation = keepWithin(r / 0.75, 0, 100);
          hue = keepWithin(phi * 180 / Math.PI, 0, 360);
          brightness = keepWithin(100 - Math.floor(sliderPos.y * (100 / slider.height())), 0, 100);
          hex = hsb2hex({
            h: hue,
            s: saturation,
            b: brightness
          });

          // Update UI
          slider.css('backgroundColor', hsb2hex({ h: hue, s: saturation, b: 100 }));
          break;

        case 'saturation':
          // Calculate hue, saturation, and brightness
          hue = keepWithin(parseInt(gridPos.x * (360 / grid.width()), 10), 0, 360);
          saturation = keepWithin(100 - Math.floor(sliderPos.y * (100 / slider.height())), 0, 100);
          brightness = keepWithin(100 - Math.floor(gridPos.y * (100 / grid.height())), 0, 100);
          hex = hsb2hex({
            h: hue,
            s: saturation,
            b: brightness
          });

          // Update UI
          slider.css('backgroundColor', hsb2hex({ h: hue, s: 100, b: brightness }));
          minicolors.find('.minicolors-grid-inner').css('opacity', saturation / 100);
          break;

        case 'brightness':
          // Calculate hue, saturation, and brightness
          hue = keepWithin(parseInt(gridPos.x * (360 / grid.width()), 10), 0, 360);
          saturation = keepWithin(100 - Math.floor(gridPos.y * (100 / grid.height())), 0, 100);
          brightness = keepWithin(100 - Math.floor(sliderPos.y * (100 / slider.height())), 0, 100);
          hex = hsb2hex({
            h: hue,
            s: saturation,
            b: brightness
          });

          // Update UI
          slider.css('backgroundColor', hsb2hex({ h: hue, s: saturation, b: 100 }));
          minicolors.find('.minicolors-grid-inner').css('opacity', 1 - brightness / 100);
          break;

        default:
          // Calculate hue, saturation, and brightness
          hue = keepWithin(360 - parseInt(sliderPos.y * (360 / slider.height()), 10), 0, 360);
          saturation = keepWithin(Math.floor(gridPos.x * (100 / grid.width())), 0, 100);
          brightness = keepWithin(100 - Math.floor(gridPos.y * (100 / grid.height())), 0, 100);
          hex = hsb2hex({
            h: hue,
            s: saturation,
            b: brightness
          });

          // Update UI
          grid.css('backgroundColor', hsb2hex({ h: hue, s: 100, b: 100 }));
          break;

      }

      // Handle opacity
      if (settings.opacity) {
        opacity = parseFloat(1 - opacityPos.y / opacitySlider.height()).toFixed(2);
      } else {
        opacity = 1;
      }

      updateInput(input, hex, opacity);
    } else {
      // Set swatch color
      swatch.find('span').css({
        backgroundColor: hex,
        opacity: opacity
      });

      // Handle change event
      doChange(input, hex, opacity);
    }
  }

  // Sets the value of the input and does the appropriate conversions
  // to respect settings, also updates the swatch
  function updateInput(input, value, opacity) {
    var rgb,


    // Helpful references
    minicolors = input.parent(),
        settings = input.data('minicolors-settings'),
        swatch = minicolors.find('.minicolors-input-swatch');

    if (settings.opacity) input.attr('data-opacity', opacity);

    // Set color string
    if (settings.format === 'rgb') {
      // Returns RGB(A) string

      // Checks for input format and does the conversion
      if (isRgb(value)) {
        rgb = parseRgb(value, true);
      } else {
        rgb = hex2rgb(parseHex(value, true));
      }

      opacity = input.attr('data-opacity') === '' ? 1 : keepWithin(parseFloat(input.attr('data-opacity')).toFixed(2), 0, 1);
      if (isNaN(opacity) || !settings.opacity) opacity = 1;

      if (input.minicolors('rgbObject').a <= 1 && rgb && settings.opacity) {
        // Set RGBA string if alpha
        value = 'rgba(' + rgb.r + ', ' + rgb.g + ', ' + rgb.b + ', ' + parseFloat(opacity) + ')';
      } else {
        // Set RGB string (alpha = 1)
        value = 'rgb(' + rgb.r + ', ' + rgb.g + ', ' + rgb.b + ')';
      }
    } else {
      // Returns hex color

      // Checks for input format and does the conversion
      if (isRgb(value)) {
        value = rgbString2hex(value);
      }

      value = convertCase(value, settings.letterCase);
    }

    // Update value from picker
    //globalInput.val( value );
    input.val(value);

    if (inputText) {
      inputText.val(value);
    }

    // Set swatch color
    swatch.find('span').css({
      backgroundColor: value,
      opacity: opacity
    });

    // Handle change event
    doChange(input, value, opacity);
  }

  // Sets the color picker values from the input
  function updateFromInput(input, preserveInputValue) {
    var settings = globalSettings;
    var hex,
        hsb,
        opacity,
        keywords,
        alpha,
        value,
        x,
        y,
        r,
        phi,


    // Helpful references
    minicolors = input.parent(),

    //  settings = input.data('minicolors-settings'),
    swatch = minicolors.find('.minicolors-input-swatch'),


    // Panel objects
    grid = minicolors.find('.minicolors-grid'),
        slider = minicolors.find('.minicolors-slider'),
        opacitySlider = minicolors.find('.minicolors-opacity-slider'),


    // Picker objects
    gridPicker = grid.find('[class$=-picker]'),
        sliderPicker = slider.find('[class$=-picker]'),
        opacityPicker = opacitySlider.find('[class$=-picker]');

    // Determine hex/HSB values
    if (isRgb(input.val())) {
      // If input value is a rgb(a) string, convert it to hex color and update opacity
      hex = rgbString2hex(input.val());
      alpha = keepWithin(parseFloat(getAlpha(input.val())).toFixed(2), 0, 1);
      if (alpha) {
        input.attr('data-opacity', alpha);
      }
    } else {
      hex = convertCase(parseHex(input.val(), true), settings.letterCase);
    }

    if (!hex) {
      hex = convertCase(parseInput(settings.defaultValue, true), settings.letterCase);
    }
    hsb = hex2hsb(hex);

    // Get array of lowercase keywords
    keywords = !settings.keywords ? [] : $.map(settings.keywords.split(','), function (a) {
      return $.trim(a.toLowerCase());
    });

    // Set color string
    if (input.val() !== '' && $.inArray(input.val().toLowerCase(), keywords) > -1) {
      value = convertCase(input.val());
    } else {
      value = isRgb(input.val()) ? parseRgb(input.val()) : hex;
    }

    // Update input value
    if (!preserveInputValue) {
      globalInput.val(value);

      inputText && inputText.val(value);
    }
    globalSettings = settings;
    // Determine opacity value
    if (settings.opacity) {
      // Get from data-opacity attribute and keep within 0-1 range
      opacity = input.attr('data-opacity') === '' ? 1 : keepWithin(parseFloat(input.attr('data-opacity')).toFixed(2), 0, 1);
      if (isNaN(opacity)) opacity = 1;
      input.attr('data-opacity', opacity);
      swatch.find('span').css('opacity', opacity);

      // Set opacity picker position
      y = keepWithin(opacitySlider.height() - opacitySlider.height() * opacity, 0, opacitySlider.height());
      opacityPicker.css('top', y + 'px');
    }

    // Set opacity to zero if input value is transparent
    if (input.val().toLowerCase() === 'transparent') {
      swatch.find('span').css('opacity', 0);
    }

    // Update swatch
    swatch.find('span').css('backgroundColor', hex);

    // Determine picker locations
    switch (settings.control) {

      case 'wheel':
        // Set grid position
        r = keepWithin(Math.ceil(hsb.s * 0.75), 0, grid.height() / 2);
        phi = hsb.h * Math.PI / 180;
        x = keepWithin(75 - Math.cos(phi) * r, 0, grid.width());
        y = keepWithin(75 - Math.sin(phi) * r, 0, grid.height());
        gridPicker.css({
          top: y + 'px',
          left: x + 'px'
        });

        // Set slider position
        y = 150 - hsb.b / (100 / grid.height());
        if (hex === '') y = 0;
        sliderPicker.css('top', y + 'px');

        // Update panel color
        slider.css('backgroundColor', hsb2hex({ h: hsb.h, s: hsb.s, b: 100 }));
        break;

      case 'saturation':
        // Set grid position
        x = keepWithin(5 * hsb.h / 12, 0, 150);
        y = keepWithin(grid.height() - Math.ceil(hsb.b / (100 / grid.height())), 0, grid.height());
        gridPicker.css({
          top: y + 'px',
          left: x + 'px'
        });

        // Set slider position
        y = keepWithin(slider.height() - hsb.s * (slider.height() / 100), 0, slider.height());
        sliderPicker.css('top', y + 'px');

        // Update UI
        slider.css('backgroundColor', hsb2hex({ h: hsb.h, s: 100, b: hsb.b }));
        minicolors.find('.minicolors-grid-inner').css('opacity', hsb.s / 100);
        break;

      case 'brightness':
        // Set grid position
        x = keepWithin(5 * hsb.h / 12, 0, 150);
        y = keepWithin(grid.height() - Math.ceil(hsb.s / (100 / grid.height())), 0, grid.height());
        gridPicker.css({
          top: y + 'px',
          left: x + 'px'
        });

        // Set slider position
        y = keepWithin(slider.height() - hsb.b * (slider.height() / 100), 0, slider.height());
        sliderPicker.css('top', y + 'px');

        // Update UI
        slider.css('backgroundColor', hsb2hex({ h: hsb.h, s: hsb.s, b: 100 }));
        minicolors.find('.minicolors-grid-inner').css('opacity', 1 - hsb.b / 100);
        break;

      default:
        // Set grid position
        x = keepWithin(Math.ceil(hsb.s / (100 / grid.width())), 0, grid.width());
        y = keepWithin(grid.height() - Math.ceil(hsb.b / (100 / grid.height())), 0, grid.height());
        gridPicker.css({
          top: y + 'px',
          left: x + 'px'
        });

        // Set slider position
        y = keepWithin(slider.height() - hsb.h / (360 / slider.height()), 0, slider.height());
        sliderPicker.css('top', y + 'px');

        // Update panel color
        grid.css('backgroundColor', hsb2hex({ h: hsb.h, s: 100, b: 100 }));
        break;

    }

    // Fire change event, but only if minicolors is fully initialized
    if (input.data('minicolors-initialized')) {
      doChange(input, value, opacity);
    }
  }

  // Runs the change and changeDelay callbacks
  function doChange(input, value, opacity) {

    var settings = input.data('minicolors-settings'),
        lastChange = input.data('minicolors-lastChange'),
        obj,
        sel,
        i;

    // Only run if it actually changed
    if (!lastChange || lastChange.value !== value || lastChange.opacity !== opacity) {

      // Remember last-changed value
      input.data('minicolors-lastChange', {
        value: value,
        opacity: opacity
      });

      // Check and select applicable swatch
      if (settings.swatches && settings.swatches.length !== 0) {
        if (!isRgb(value)) {
          obj = hex2rgb(value);
        } else {
          obj = parseRgb(value, true);
        }
        sel = -1;
        for (i = 0; i < settings.swatches.length; ++i) {
          if (obj.r === settings.swatches[i].r && obj.g === settings.swatches[i].g && obj.b === settings.swatches[i].b && obj.a === settings.swatches[i].a) {
            sel = i;
            break;
          }
        }

        input.parent().find('.minicolors-swatches .minicolors-swatch').removeClass('selected');
        if (i !== -1) {
          input.parent().find('.minicolors-swatches .minicolors-swatch').eq(i).addClass('selected');
        }
      }

      // Fire change event
      if (settings.change) {
        if (settings.changeDelay) {
          // Call after a delay
          clearTimeout(input.data('minicolors-changeTimeout'));
          input.data('minicolors-changeTimeout', setTimeout(function () {
            settings.change.call(input.get(0), value, opacity);
          }, settings.changeDelay));
        } else {
          // Call immediately
          settings.change.call(input.get(0), value, opacity);
        }
      }
      input.trigger('change').trigger('input');
    }
  }

  // Generates an RGB(A) object based on the input's value
  function rgbObject(input) {
    var hex = parseHex($(input).val(), true),
        rgb = hex2rgb(hex),
        opacity = $(input).attr('data-opacity');
    if (!rgb) return null;
    if (opacity !== undefined) $.extend(rgb, { a: parseFloat(opacity) });
    return rgb;
  }

  // Generates an RGB(A) string based on the input's value
  function rgbString(input, alpha) {
    var hex = parseHex($(input).val(), true),
        rgb = hex2rgb(hex),
        opacity = $(input).attr('data-opacity');
    if (!rgb) return null;
    if (opacity === undefined) opacity = 1;
    if (alpha) {
      return 'rgba(' + rgb.r + ', ' + rgb.g + ', ' + rgb.b + ', ' + parseFloat(opacity) + ')';
    } else {
      return 'rgb(' + rgb.r + ', ' + rgb.g + ', ' + rgb.b + ')';
    }
  }

  // Converts to the letter case specified in settings
  function convertCase(string, letterCase) {
    return letterCase === 'uppercase' ? string.toUpperCase() : string.toLowerCase();
  }

  // Parses a string and returns a valid hex string when possible
  function parseHex(string, expand) {
    string = string.replace(/^#/g, '');
    if (!string.match(/^[A-F0-9]{3,6}/ig)) return '';
    if (string.length !== 3 && string.length !== 6) return '';
    if (string.length === 3 && expand) {
      string = string[0] + string[0] + string[1] + string[1] + string[2] + string[2];
    }
    return '#' + string;
  }

  // Parses a string and returns a valid RGB(A) string when possible
  function parseRgb(string, obj) {

    var values = string.replace(/[^\d,.]/g, ''),
        rgba = values.split(',');

    rgba[0] = keepWithin(parseInt(rgba[0], 10), 0, 255);
    rgba[1] = keepWithin(parseInt(rgba[1], 10), 0, 255);
    rgba[2] = keepWithin(parseInt(rgba[2], 10), 0, 255);
    if (rgba[3]) {
      rgba[3] = keepWithin(parseFloat(rgba[3], 10), 0, 1);
    }

    // Return RGBA object
    if (obj) {
      return {
        r: rgba[0],
        g: rgba[1],
        b: rgba[2],
        a: rgba[3] ? rgba[3] : null
      };
    }

    // Return RGBA string
    if (typeof rgba[3] !== 'undefined' && rgba[3] <= 1) {
      return 'rgba(' + rgba[0] + ', ' + rgba[1] + ', ' + rgba[2] + ', ' + rgba[3] + ')';
    } else {
      return 'rgb(' + rgba[0] + ', ' + rgba[1] + ', ' + rgba[2] + ')';
    }
  }

  // Parses a string and returns a valid color string when possible
  function parseInput(string, expand) {
    if (isRgb(string)) {
      // Returns a valid rgb(a) string
      return parseRgb(string);
    } else {
      return parseHex(string, expand);
    }
  }

  // Keeps value within min and max
  function keepWithin(value, min, max) {
    if (value < min) value = min;
    if (value > max) value = max;
    return value;
  }

  // Checks if a string is a valid RGB(A) string
  function isRgb(string) {
    var rgb = string.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);
    return rgb && rgb.length === 4 ? true : false;
  }

  // Function to get alpha from a RGB(A) string
  function getAlpha(rgba) {
    rgba = rgba.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+(\.\d{1,2})?|\.\d{1,2})[\s+]?/i);
    return rgba && rgba.length === 6 ? rgba[4] : '1';
  }

  // Converts an HSB object to an RGB object
  function hsb2rgb(hsb) {
    var rgb = {};
    var h = Math.round(hsb.h);
    var s = Math.round(hsb.s * 255 / 100);
    var v = Math.round(hsb.b * 255 / 100);
    if (s === 0) {
      rgb.r = rgb.g = rgb.b = v;
    } else {
      var t1 = v;
      var t2 = (255 - s) * v / 255;
      var t3 = (t1 - t2) * (h % 60) / 60;
      if (h === 360) h = 0;
      if (h < 60) {
        rgb.r = t1;rgb.b = t2;rgb.g = t2 + t3;
      } else if (h < 120) {
        rgb.g = t1;rgb.b = t2;rgb.r = t1 - t3;
      } else if (h < 180) {
        rgb.g = t1;rgb.r = t2;rgb.b = t2 + t3;
      } else if (h < 240) {
        rgb.b = t1;rgb.r = t2;rgb.g = t1 - t3;
      } else if (h < 300) {
        rgb.b = t1;rgb.g = t2;rgb.r = t2 + t3;
      } else if (h < 360) {
        rgb.r = t1;rgb.g = t2;rgb.b = t1 - t3;
      } else {
        rgb.r = 0;rgb.g = 0;rgb.b = 0;
      }
    }
    return {
      r: Math.round(rgb.r),
      g: Math.round(rgb.g),
      b: Math.round(rgb.b)
    };
  }

  // Converts an RGB string to a hex string
  function rgbString2hex(rgb) {
    rgb = rgb.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);
    return rgb && rgb.length === 4 ? '#' + ('0' + parseInt(rgb[1], 10).toString(16)).slice(-2) + ('0' + parseInt(rgb[2], 10).toString(16)).slice(-2) + ('0' + parseInt(rgb[3], 10).toString(16)).slice(-2) : '';
  }

  // Converts an RGB object to a hex string
  function rgb2hex(rgb) {
    var hex = [rgb.r.toString(16), rgb.g.toString(16), rgb.b.toString(16)];
    $.each(hex, function (nr, val) {
      if (val.length === 1) hex[nr] = '0' + val;
    });
    return '#' + hex.join('');
  }

  // Converts an HSB object to a hex string
  function hsb2hex(hsb) {
    return rgb2hex(hsb2rgb(hsb));
  }

  // Converts a hex string to an HSB object
  function hex2hsb(hex) {
    var hsb = rgb2hsb(hex2rgb(hex));
    if (hsb.s === 0) hsb.h = 360;
    return hsb;
  }

  // Converts an RGB object to an HSB object
  function rgb2hsb(rgb) {
    var hsb = { h: 0, s: 0, b: 0 };
    var min = Math.min(rgb.r, rgb.g, rgb.b);
    var max = Math.max(rgb.r, rgb.g, rgb.b);
    var delta = max - min;
    hsb.b = max;
    hsb.s = max !== 0 ? 255 * delta / max : 0;
    if (hsb.s !== 0) {
      if (rgb.r === max) {
        hsb.h = (rgb.g - rgb.b) / delta;
      } else if (rgb.g === max) {
        hsb.h = 2 + (rgb.b - rgb.r) / delta;
      } else {
        hsb.h = 4 + (rgb.r - rgb.g) / delta;
      }
    } else {
      hsb.h = -1;
    }
    hsb.h *= 60;
    if (hsb.h < 0) {
      hsb.h += 360;
    }
    hsb.s *= 100 / 255;
    hsb.b *= 100 / 255;
    return hsb;
  }

  // Converts a hex string to an RGB object
  function hex2rgb(hex) {
    hex = parseInt(hex.indexOf('#') > -1 ? hex.substring(1) : hex, 16);
    return {
      /* jshint ignore:start */
      r: hex >> 16,
      g: (hex & 0x00FF00) >> 8,
      b: hex & 0x0000FF
      /* jshint ignore:end */
    };
  }

  // Handle events
  $(document)
  // Hide on clicks outside of the control
  .on('mousedown.minicolors touchstart.minicolors', function (event) {
    if (!$(event.target).parents().add(event.target).hasClass('minicolors')) {
      hide();
    }
  })
  // Start moving
  .on('mousedown.minicolors touchstart.minicolors', '.minicolors-grid, .minicolors-slider, .minicolors-opacity-slider', function (event) {
    var target = $(this);
    event.preventDefault();
    $(document).data('minicolors-target', target);
    move(target, event, true);
  })
  // Move pickers
  .on('mousemove.minicolors touchmove.minicolors', function (event) {
    var target = $(document).data('minicolors-target');
    if (target) move(target, event);
  })
  // Stop moving
  .on('mouseup.minicolors touchend.minicolors', function () {
    $(this).removeData('minicolors-target');
  })
  // Selected a swatch
  .on('click.minicolors', '.minicolors-swatches li', function (event) {
    event.preventDefault();
    var target = $(this),
        input = target.parents('.minicolors').find('.minicolors-input'),
        color = target.data('swatch-color');
    updateInput(input, color, getAlpha(color));
    updateFromInput(input);
  })
  // Show panel when swatch is clicked
  .on('mousedown.minicolors touchstart.minicolors', '.minicolors-input-swatch', function (event) {
    var input = $(this).parent().find('.minicolors-input');
    event.preventDefault();
    if (input.parent().find('.minicolors-panel').css("display") !== "none") {
      //todo
      //hide();
    } else {
      show(input);
    }
  })
  // Show on focus
  .on('focus.minicolors', '.minicolors-input', function () {
    var input = $(this);
    if (!input.data('minicolors-initialized')) return;
    show(input);
  })
  // Update value on blur
  .on('blur.minicolors', '.minicolors-input', function () {
    var input = $(this),
        settings = input.data('minicolors-settings'),
        keywords,
        hex,
        rgba,
        swatchOpacity,
        value;

    if (!input.data('minicolors-initialized')) return;

    // Get array of lowercase keywords
    keywords = !settings.keywords ? [] : $.map(settings.keywords.split(','), function (a) {
      return $.trim(a.toLowerCase());
    });

    // Set color string
    if (input.val() !== '' && $.inArray(input.val().toLowerCase(), keywords) > -1) {
      value = input.val();
    } else {
      // Get RGBA values for easy conversion
      if (isRgb(input.val())) {
        rgba = parseRgb(input.val(), true);
      } else {
        hex = parseHex(input.val(), true);
        rgba = hex ? hex2rgb(hex) : null;
      }

      // Convert to format
      if (rgba === null) {
        value = settings.defaultValue;
      } else if (settings.format === 'rgb') {
        value = settings.opacity ? parseRgb('rgba(' + rgba.r + ',' + rgba.g + ',' + rgba.b + ',' + input.attr('data-opacity') + ')') : parseRgb('rgb(' + rgba.r + ',' + rgba.g + ',' + rgba.b + ')');
      } else {
        value = rgb2hex(rgba);
      }
    }

    // Update swatch opacity
    swatchOpacity = settings.opacity ? input.attr('data-opacity') : 1;
    if (value.toLowerCase() === 'transparent') swatchOpacity = 0;
    input.closest('.minicolors').find('.minicolors-input-swatch > span').css('opacity', swatchOpacity);

    // Set input value
    input.val(value);

    // Is it blank?
    if (input.val() === '') input.val(parseInput(settings.defaultValue, true));

    // Adjust case
    input.val(convertCase(input.val(), settings.letterCase));
  })
  // Handle keypresses
  .on('keydown.minicolors', '.minicolors-input', function (event) {
    var input = $(this);
    if (!input.data('minicolors-initialized')) return;
    switch (event.keyCode) {
      case 9:
        // tab
        hide();
        break;
      case 13: // enter
      case 27:
        // esc
        hide();
        input.blur();
        break;
    }
  })
  // Update on keyup
  .on('keyup.minicolors', '.minicolors-input', function () {
    var input = $(this);
    if (!input.data('minicolors-initialized')) return;
    updateFromInput(input, true);
  })
  // Update on paste
  .on('paste.minicolors', '.minicolors-input', function () {
    var input = $(this);
    if (!input.data('minicolors-initialized')) return;
    setTimeout(function () {
      updateFromInput(input, true);
    }, 1);
  });
});

/***/ }),
/* 31 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


if (!$.fontSelector) {
  __webpack_require__(32);
}

if (typeof Toolbar === "undefined") {
  var Toolbar = __webpack_require__(1);
}

Toolbar.prototype.fonts = ['Arial,Helvetica,sans-serif', 'Arial Black,Gadget,sans-serif', 'Comic Sans MS,cursive', 'Courier New,Courier,monospace', 'Georgia,serif', 'Impact,Charcoal,sans-serif', 'Lucida Console,Monaco,monospace', 'Lucida Sans Unicode,Lucida Grande,sans-serif', 'Palatino Linotype,Book Antiqua,Palatino,serif', 'Tahoma,Geneva,sans-serif', 'Times New Roman,Times,serif', 'Trebuchet MS,Helvetica,sans-serif', 'Verdana,Geneva,sans-serif', 'Gill Sans,Geneva,sans-serif'];

Toolbar.prototype.tools.fontFamily = {
  scope: function scope(data, options) {
    return {
      //currentValue: data.value.get(),
      onchange: function onchange(e) {
        data.value.set(parseFloat($(e.target).val()));
      }
    };
  },
  template: '<div class="object-menu-item object-menu-font-family" title="{title}">' + '<div class="fontSelect" transclude><div class="arrow-down">',
  post: function post($item, data, options, transclude) {

    transclude.fontSelector({
      'hide_fallbacks': true,
      'initial': data.value.get(), //'Courier New,Courier New,Courier,monospace',
      'selected': data.value.set.bind(data.target),
      'fonts': data.data
    });

    this.on("destroy", function () {
      transclude.fontSelector("destroy");
    });
  }
};

/***/ }),
/* 32 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

/**
 * Font Selector - jQuery plugin 0.1
 *
 * Copyright (c) 2012 Chris Dyer
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following
 * conditions are met:
 *
 * Redistributions of source code must retain the above copyright notice, this list of conditions and the following
 * disclaimer. Redistributions in binary form must reproduce the above copyright notice, this list of conditions
 * and the following disclaimer in the documentation and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING,
 * BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO
 * EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;
 * OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 */

(function (factory) {
  if (( false ? 'undefined' : _typeof(exports)) === 'object') {
    module.exports = factory(__webpack_require__(9));
  } else {
    factory(jQuery);
  }
})(function ($) {

  'use strict';
  //if(_ && _.styleSheetContains && !_.styleSheetContains('.fontSelect')){
  //  _.linkCSS(_.scriptURL() + "/../../css/jquery.fontSelector.css");
  //}

  var settings;

  var methods = {
    destroy: function destroy(options) {
      this.ul.remove();
    },
    close: function close(options) {
      this.closeUl();
    },
    init: function init(options) {

      settings = $.extend({
        'hide_fallbacks': false,
        'selected': function selected(style) {},
        'opened': function opened() {},
        'closed': function closed() {},
        'initial': '',
        'fonts': []
      }, options);

      var root = this;
      var $root = $(this);
      root.selectedCallback = settings['selected'];
      root.openedCallback = settings['opened'];
      root.closedCallback = settings['closed'];
      var visible = false;
      var selected = false;
      var openedClass = 'fontSelectOpen';

      var displayName = function displayName(font) {
        if (settings['hide_fallbacks']) {
          var index = font.indexOf(',');
          if (index == -1) return font;
          return font.substr(0, index);
        } else return font;
      };

      var select = function select(font, initial) {
        root.find('span').html(displayName(font).replace(/["']{1}/gi, ""));
        root.css('font-family', font);
        selected = font;

        if (!initial) root.selectedCallback(selected);
      };

      var positionUl = function positionUl() {
        var left, top;
        left = $(root).offset().left;
        top = $(root).offset().top + $(root).outerHeight();

        $(ul).css({
          'position': 'absolute',
          'left': left + 'px',
          'top': top + 'px',
          'width': $(root).outerWidth() + 'px'
        });
      };

      var closeUl = this.closeUl = function () {
        ul.slideUp('fast', function () {
          visible = false;
        });

        $root.removeClass(openedClass);

        root.closedCallback();
      };

      var openUi = function openUi() {
        ul.slideDown('fast', function () {
          visible = true;
        });

        $root.addClass(openedClass);

        root.openedCallback();
      };

      // Setup markup
      $root.prepend('<span>' + settings['initial'].replace(/'/g, '&#039;') + '</span>');
      var ul = this.ul = $('<ul class="fontSelectUl"></ul>').appendTo('body');
      ul.hide();
      positionUl();

      for (var i = 0; i < settings['fonts'].length; i++) {
        var item = $('<li>' + displayName(settings['fonts'][i]) + '</li>').appendTo(ul);
        item.css('font-family', settings['fonts'][i]);
        item[0].data = settings['fonts'][i];
      }

      if (settings['initial'] != '') select(settings['initial'], true);

      ul.find('li').click(function () {

        if (!visible) return;

        positionUl();
        closeUl();

        select(this.data);
      });

      $root.click(function (event) {

        if (visible) return;

        event.stopPropagation();

        positionUl();
        openUi();
      });

      $('html').click(function () {
        if (visible) {
          closeUl();
        }
      });
    },
    selected: function selected() {
      return this.data;
    },
    select: function select(font) {
      this.find('span').html(font.substr(0, font.indexOf(',')).replace(/["']{1}/gi, ""));
      this.css('font-family', font);
      var selected = false;
      selected = font;
    }
  };
  $.fontSelector = {};

  $.fn.fontSelector = function (method) {
    if (methods[method]) {
      return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
    } else if ((typeof method === 'undefined' ? 'undefined' : _typeof(method)) === 'object' || !method) {
      return methods.init.apply(this, arguments);
    } else {
      $.error('Method ' + method + ' does not exist on jQuery.fontSelector');
    }
  };
});

/***/ }),
/* 33 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


;
if (typeof Toolbar === "undefined") {
  var Toolbar = __webpack_require__(1);
}

Toolbar.prototype.updateSelectedOption = function (data) {
  var $checked = data.$item.find(":checked");
  var $checkedOptionEl = $($checked.parents()[0]);

  var selOption = data.$item.find('.btn-selected-option');
  selOption.html($checkedOptionEl.find("label")[0].outerHTML);
};

Toolbar.prototype.tools.option = {
  scope: function scope(data, options) {
    var _self = this;
    return {
      parentId: data.parent.id,
      valueCurrent: data.parent.value.get() === data.option,
      onchange: function onchange() {
        //оптимизировать

        var $checked = data.$item.find(":checked");
        var _value = $checked.val();
        if (_value == data.option) {
          data.parent.value.set(_value);
        }
        _self.updateSelectedOption(data.parent);
      }
    };
  },
  template: '<div class="object-menu-item object-menu-option " title="{title}" >' + '<input type="radio" id="tool-{id}" dp-checked="{valueCurrent}" name="{parentId}" value="{option}" onchange="onchange()">' + '<label class="btn button-{id} {className}" for="tool-{id}">' + '<img dp-if="icon" dp-src="icon">' + '<span dp-include="svg" dp-if="svg"></span>' + '<span dp-if="title" class="option-title">{title}</span>'
};

Toolbar.prototype.tools.options = {
  scope: function scope(data, options) {
    return {
      className: data.className || 'items-column',
      buttonsTitle: options.buttons && options.buttons.title || false,
      buttonsClassName: options.buttons.className || ''
    };
  },
  template: '<div class="object-menu-item object-menu-options {className}" title="{title}">' + '<div class="btn-selected-option"></div>' + '<div class="object-menu-options-container" transclude>',
  post: function post($item, data, options, transclude) {
    this.generateMenu(data.target, transclude, options, data.menu);
    this.updateSelectedOption(data);
  }
};

/***/ }),
/* 34 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


;
if (typeof Toolbar === "undefined") {
  var Toolbar = __webpack_require__(1);
}

Toolbar.prototype.tools.select = {
  scope: function scope(data, options) {
    return {
      getInputValue: function getInputValue() {
        return parseFloat(data.$item.find("input").val());
      },
      getValue: data.value.get,
      setValue: data.value.set,
      onchange: function onchange(e, model) {
        data.value.set(e.params.data.id, model);
      }
    };
  },
  template: '<div class="object-menu-item object-menu-select {itemClassName}" title="{title}" ><label for="xxx" class="btn button-{id} {className}"></label><select id="xxx">',
  post: function post($item, data, options, tool, val) {
    var model = data.value.options();
    var _val = data.value.get();
    var _select = $item.find("select");
    _select.dpSelect({
      minimumResultsForSearch: Infinity,
      dropdownParent: $("body"),
      data: model,
      templateSelection: function templateSelection(state, container) {
        return data.templateSelection(state, container, data);
      },
      templateResult: function templateResult(state, container) {
        return data.templateResult(state, container, data);
      }
    }).on("select2:select", function (e) {
      data.onchange(e, model);
    });
    _select.dpSelect("val", [_val]);
  }
};

/***/ }),
/* 35 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


if (typeof Toolbar === "undefined") {
  var Toolbar = __webpack_require__(1);
}

Toolbar.prototype.colorpicker = function (el, options) {
  options.format = 'rgb';
  options.opacity = true;
  el.minicolors(options);
};

Toolbar.prototype.tools.effect = {
  scope: function scope(data, options) {
    return {
      buttonsTitle: options.buttons && options.buttons.title || false,
      isParameters: !!data.actionParameters,
      buttonscClassName: options.buttons && options.buttons.className || ''
    };
  },
  template: '<div class="object-menu-item" title="{title}">' + '<button class="btn button-{id} {className} {buttonscClassName}">' + '<span dp-if="buttonsTitle" class="button-title">{title}</span>' + '</button>' + '<div dp-if="isParameters" class="menu-action-parameters" style="display: none" transclude></div>' + '</div>',
  post: function post($item, data, options, transclude) {

    if (data.container) {
      transclude = $(document.getElementById(data.container));
    }

    var $tpl;
    var foo = function foo() {
      if (data.effectTpl) {
        $tpl = $(data.effectTpl);
        transclude.html($tpl);
      }
      if (data.actionParametersId) {
        $tpl = $("#" + data.actionParametersId).clone();
        transclude.html($tpl);
      }
      return data.actionParameters.call(data.target, transclude, data, options);
    };
    this.toggleByButton($item, transclude, foo, data);
  }
};

/***/ }),
/* 36 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

var _bindEvents2 = fabric.Canvas.prototype._bindEvents;
var _onMouseDown_overwritten = fabric.Canvas.prototype._onMouseDown;
var _onMouseUp_overwritten = fabric.Canvas.prototype._onMouseUp;
var _initEventListeners_overwritten = fabric.Canvas.prototype._initEventListeners;
var removeListeners_overwritten = fabric.Canvas.prototype.removeListeners;

fabric.util.object.extend(fabric.Canvas.prototype, {
  tapholdThreshold: 2000,
  _bindEvents: function _bindEvents() {
    _bindEvents2.call(this);
    this._onClick = this._onClick.bind(this);
    this._onDoubleClick = this._onDoubleClick.bind(this);
    this._onTapHold = this._onTapHold.bind(this);
  },

  _onDoubleClick: function _onDoubleClick(e) {
    var self = this;

    var target = self.findTarget(e);
    self.fire('mouse:dblclick', {
      target: target,
      e: e
    });

    if (target && !self.isDrawingMode) {
      // To unify the behavior, the object's double click event does not fire on drawing mode.
      target.fire('dblclick', {
        e: e
      });
    }
  },

  _onDrop: function _onDrop(e) {
    var _zoom = this.getZoom();
    e.x /= _zoom;
    e.y /= _zoom;
    e.offsetX /= _zoom;
    e.offsetY /= _zoom;
    e.width = e.helper.width() / _zoom;
    e.height = e.helper.height() / _zoom;
    var self = this;

    this.fire('mouse:drop', e);
  },

  _onDragMove: function _onDragMove(e) {
    var self = this;

    var target = self.findTarget(e.originalEvent);
    self.fire('mouse:dragmove', {
      target: target,
      e: e,
      data: e.data
    });
    if (target && !self.isDrawingMode) {
      // To unify the behavior, the object's double click event does not fire on drawing mode.
      target.fire('object:dragmove', {
        e: e,
        data: e.data
      });
    }
    if (this._last_target == target) return;
    if (this._last_target) {
      self.fire('mouse:dragleave', {
        target: this._last_target,
        e: e,
        data: e.data
      });
      this._last_target.fire('object:dragleave', {
        e: e,
        data: e.data
      });
      this._last_target = false;
    }
    if (target) {

      self.fire('mouse:dragenter', {
        target: target,
        e: e,
        data: e.data
      });
      target.fire('object:dragenter', {
        e: e,
        data: e.data
      });

      this._last_target = target;
    }
  },

  _onClick: function _onClick(e) {
    var self = this;

    var target = self.findTarget(e);
    self.fire('mouse:click', {
      target: target,
      e: e
    });

    if (target && !self.isDrawingMode) {
      if (target.originalState.left == target.left && target.originalState.top == target.top && target.originalState.scaleX == target.scaleX && target.originalState.scaleY == target.scaleY && target.originalState.angle == target.angle) {
        // To unify the behavior, the object's double click event does not fire on drawing mode.
        target.fire('object:click', {
          e: e
        });
      }
    }
  },

  _onTapHold: function _onTapHold(e) {
    var self = this;

    var target = self.findTarget(e);
    self.fire('touch:taphold', {
      target: target,
      e: e
    });

    if (target && !self.isDrawingMode) {
      // To unify the behavior, the object's tap hold event does not fire on drawing mode.
      target.fire('taphold', {
        e: e
      });
    }

    if (e.type === 'touchend' && self.touchStartTimer != null) {
      clearTimeout(self.touchStartTimer);
    }
  },

  _onMouseDown: function _onMouseDown(e) {
    _onMouseDown_overwritten.call(this, e);
    var self = this;
    if (e.type === 'touchstart') {
      var touchStartTimer = setTimeout(function () {
        self._onTapHold(e);
        self.isLongTap = true;
      }, self.tapholdThreshold);
      self.touchStartTimer = touchStartTimer;
      return;
    }

    // Add right click support
    if (e.which === 3) {
      var target = this.findTarget(e);
      self.fire('mouse:down', { target: target, e: e });
      if (target && !self.isDrawingMode) {
        // To unify the behavior, the object's mouse down event does not fire on drawing mode.
        target.fire('mousedown', {
          e: e
        });
      }
    }
  },

  _onMouseUp: function _onMouseUp(e) {

    _onMouseUp_overwritten.call(this, e);

    if (e.type === 'touchend') {
      // Process tap hold.
      if (this.touchStartTimer != null) {
        clearTimeout(this.touchStartTimer);
      }
      // Process long tap.
      if (this.isLongTap) {
        this._onLongTapEnd(e);
        this.isLongTap = false;
      }
      // Process double click
      var now = new Date().getTime();
      var lastTouch = this.lastTouch || now + 1;
      var delta = now - lastTouch;
      if (delta < 300 && delta > 0) {
        // After we detct a doubletap, start over
        this.lastTouch = null;

        this._onDoubleTap(e);
      } else {
        this.lastTouch = now;
      }
    }
  },

  _onDoubleTap: function _onDoubleTap(e) {
    var self = this;

    var target = self.findTarget(e);
    self.fire('touch:doubletap', {
      target: target,
      e: e
    });

    if (target && !self.isDrawingMode) {
      // To unify the behavior, the object's double tap event does not fire on drawing mode.
      target.fire('object:doubletap', {
        e: e
      });
    }
  },

  _onLongTapEnd: function _onLongTapEnd(e) {
    var self = this;

    var target = self.findTarget(e);
    self.fire('touch:longtapend', {
      target: target,
      e: e
    });

    if (target && !self.isDrawingMode) {
      // To unify the behavior, the object's long tap end event does not fire on drawing mode.
      target.fire('object:longtapend', {
        e: e
      });
    }
  },

  _initEventListeners: function _initEventListeners() {
    var self = this;
    _initEventListeners_overwritten.call(self);

    fabric.util.addListener(self.upperCanvasEl, 'click', self._onClick);
    fabric.util.addListener(self.upperCanvasEl, 'dblclick', self._onDoubleClick);

    self.on('object:scaling', function (e) {
      if (e.target && e.target._scaling_events_enabled) {
        e.target.fire("scaling", e.e);
      }
    });
    self.on('object:selected', function (e) {
      if (e.target) {
        e.target.fire("object:selected", e.e);
      }
    });
    self.on('mouse:over', function (e) {
      if (e.target) {
        e.target.fire("mouse:over", e.e);
      }
    });

    self.on('mouse:out', function (e) {
      if (e.target) {
        e.target.fire("mouse:out", e.e);
      }
    });
  },

  removeListeners: function removeListeners() {
    var self = this;
    removeListeners_overwritten.call(self);

    fabric.util.removeListener(self.upperCanvasEl, 'click', self._onClick);
    fabric.util.removeListener(self.upperCanvasEl, 'dblclick', self._onDoubleClick);
  }
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 37 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

{

  /*
   fabric.Image.filters.Redify = fabric.util.createClass(fabric.Image.filters.BaseFilter, {
   type: 'Redify',
   applyTo: function (canvasEl) {
   var context = canvasEl.getContext('2d'),
   imageData = context.getImageData(0, 0,
   canvasEl.width, canvasEl.height),
   data = imageData.data;
   for (var i = 0, len = data.length; i < len; i += 4) {
   data[i + 1] = 0;
   data[i + 2] = 0;
   }
   context.putImageData(imageData, 0, 0);
   }
   });
   fabric.Image.filters.Redify.fromObject = function (object) {
   return new fabric.Image.filters.Redify(object);
   };
   */

  fabric.Image.filters.Sharpen = fabric.util.createClass(fabric.Image.filters.Convolute, {
    type: 'Sharpen',
    initialize: function initialize(options) {
      options = options || {};

      this.opaque = options.opaque;
      this.matrix = options.matrix || [0, -1, 0, -1, 5, -1, 0, -1, 0];
    }
  });
  fabric.Image.filters.Sharpen.fromObject = function (object) {
    return new fabric.Image.filters.Sharpen(object);
  };

  fabric.Image.filters.Blur = fabric.util.createClass(fabric.Image.filters.Convolute, {
    type: 'Blur',
    initialize: function initialize(options) {
      options = options || {};

      var _v = 1 / 9;
      this.opaque = options.opaque;
      this.matrix = options.matrix || [_v, _v, _v, _v, _v, _v, _v, _v, _v];
    }
  });
  fabric.Image.filters.Blur.fromObject = function (object) {
    return new fabric.Image.filters.Blur(object);
  };

  fabric.Image.filters.Emboss = fabric.util.createClass(fabric.Image.filters.Convolute, {
    type: 'Emboss',
    initialize: function initialize(options) {
      options = options || {};

      this.opaque = options.opaque;
      this.matrix = options.matrix || [1, 1, 1, 1, 0.7, -1, -1, -1, -1];
    }
  });
  fabric.Image.filters.Emboss.fromObject = function (object) {
    return new fabric.Image.filters.Emboss(object);
  };

  fabric.Image.filters.Mask.prototype.maskFilter = true;

  var prototypeOptions = {
    Brightness: {
      "brightness": { value: 100, min: 0, max: 255 }
    },
    Noise: {
      "noise": { value: 100, min: 0, max: 1000 }
    },
    Convolute: {
      "opaque": { value: true, type: "boolean" },
      "matrix": { value: [1, 1, 1, 1, 1, 1, 1, 1, 1], type: "matrix" }
    },
    Blur: {},
    Sharpen: {},
    Emboss: {},
    Multiply: {
      "color": { type: 'color', value: "#F0F" }
    },
    Pixelate: {
      "blocksize": { value: 4, min: 2, max: 20 }
    },
    Tint: {
      "color": { type: 'color', value: "#3513B0" },
      "opacity": { value: 1, min: 0, max: 1, step: 0.1 }
    },
    Mask: {
      mask: {
        type: 'image',
        value: {
          src: "photos/explosion.png"
        }
      },
      channel: { value: 0 }
    },
    Blend: {
      "color": { type: 'color', value: "#3513B0" },
      "mode": {
        value: "add",
        options: [{ value: "add", title: "Add" }, { value: "diff", title: "Diff" }, { value: "subtract", title: "Subtract" }, { value: "multiply", title: "Multiply" }, { value: "screen", title: "Screen" }, { value: "lighten", title: "Lighten" }, { value: "darken", title: "Darken" }]
      }
    }
  };

  for (var i in prototypeOptions) {
    fabric.Image.filters[i].prototype.options = prototypeOptions[i];
  }
}

fabric.Image.getFiltersList = function (el) {

  el = el || fabric.Image.prototype;
  var filterList = [];
  for (var i in el.availableFilters) {
    var _f = fabric.Image.filters[el.availableFilters[i]];

    var _data = {
      type: el.availableFilters[i]
    };
    if (_f.prototype.custom) {
      if (!el.customFilters) {
        continue;
      }
    }
    if (_f.prototype.maskFilter) {
      if (!el.maskFilter) {
        continue;
      }
    }
    if (_f.prototype.caman) {
      if (!el.camanFilters) {
        continue;
      }
      _data.caman = true;
    } else {
      if (!el.fabricFilters) {
        continue;
      }
    }
    if (_f.prototype.options) {
      _data.options = fabric.util.object.clone(_f.prototype.options);
    }
    _data.text = _f.prototype.title || el.availableFilters[i];

    filterList.push(_data);
  }
  return filterList;
};

fabric.util.object.extend(fabric.Image.prototype, {
  camanFilters: false,
  fabricFilters: true,
  customFilters: false,
  maskFilter: false,
  getFiltersData: function getFiltersData() {
    var _filters = fabric.Image.getFiltersList(this);
    for (var i in this.filters) {
      var _f = fabric.util.object.findWhere(_filters, { type: fabric.util.string.capitalize(this.filters[i].type) });
      if (_f) {
        _f.enabled = true;
      }
    }
    return _filters;
  },
  availableFilters: [
  //fabricJS
  "Grayscale", "Sepia", "Sepia2", "Invert", "Blur", "Sharpen", "Emboss", "Blend", "Tint", "Multiply",
  //"Convolute",
  "Noise", "Brightness", "Pixelate", "GradientTransparency", "Mask"],
  getFilter: function getFilter(filterName) {
    filterName = fabric.util.string.uncapitalize(filterName);
    for (var i in this.filters) {
      if (fabric.util.string.uncapitalize(this.filters[i].type) === filterName) {
        return this.filters[i];
      }
    }
    return false;
  },
  setFilter: function setFilter(filter) {

    var _old_filter = false;
    if (filter.replace) {
      this.filters = [];
    } else {
      _old_filter = fabric.util.object.findWhere(this.filters, { type: filter.type });
      _old_filter = _old_filter && _old_filter.toObject() || false;
    }

    if (filter.type) {
      var _type = fabric.util.string.capitalize(filter.type, true);
      var _new_filter = filter.options && fabric.util.object.clone(filter.options);
    } else {
      _type = false;
      _new_filter = false;
    }

    /* this.project.history.add({
     data:   [$.extend(true, {}, this.data)],
     slide:  this.slide,
     object: this,
     redo:   filter,
     undo:   _old_filter ,
     type:   "filter",
     undoFn: function(action){
     action.object._set_filter(action.undo);
     },
     redoFn:  function(action){
     action.object._set_filter(action.redo);
     }
     });
     */
    this._set_filter(_type, _new_filter, _old_filter);
  },

  _set_filter: function _set_filter(_type, _new_filter) {

    if (_type) {
      var _old_filter = this.getFilter(_type);
    }

    if (_old_filter && _new_filter) {
      for (var i in _new_filter) {
        _old_filter[i] = _new_filter[i];
      }
    } else if (_old_filter && !_new_filter) {
      this.filters.splice(this.filters.indexOf(_old_filter), 1);
    }
    if (!_old_filter && _new_filter) {
      this.filters.push(new fabric.Image.filters[_type](_new_filter));
    }
    this.applyFilters(this.canvas.renderAll.bind(this.canvas));
  },

  insertImageFilters: false,
  actions: fabric.util.object.extend(fabric.Image.prototype.actions, {
    imageFilters: {
      title: "фильтр",
      itemClassName: "filters-selector",
      className: "fa fa-filter",
      type: "select",
      templateSelection: function templateSelection(state, container) {
        if (state.any) {
          return state.text;
        }
        return $('<span><span class="color-span" style="background-color:' + state.text + '"></span>' + state.text + '</span>');
      },
      templateResult: function templateResult(state, container, data) {
        var $el = $('<span>' + state.text + '</span>');
        if (state.id != "none") {
          var $canvas = $('<canvas>');
          fabric.util.drawFilter($canvas[0], data.target._element, state.id, {
            height: 22
          });
          $el.prepend($canvas);
        }
        return $el;
      },
      value: {
        set: function set(val, filtersData) {
          var options = false;
          if (val == "none") {
            val = false;
          } else {
            var _f = _.findWhere(filtersData, { id: val });
            _f.enabled = !_f.enabled;
            for (var i in _f.options) {
              if ($.isNumeric(_f.options[i])) {
                _f.options[i] = parseFloat(_f.options[i]);
              }
            }
            if (_f.enabled) {
              options = {};
              for (var i in _f.options) {
                options[i] = _f.options[i].value;
              }
            }
          }
          this.setFilter({
            type: val,
            options: options,
            replace: true
          });
        },
        get: function get() {
          return this.filters.length ? fabric.util.string.capitalize(this.filters[0].type, true) : "none";
        },
        options: function options() {

          var _filters = this.getFiltersData();
          for (var i in _filters) {
            _filters[i].id = _filters[i].type;
          }
          return [{
            id: 'none',
            text: 'original',
            enabled: !this.filters || !this.filters.length
          }].concat(_filters);
        }
      }
    }
  })
});

//
// fabric.Image.filterManager = {
//
//   //hide: function(object){
//   //
//   //},
//   show: function (object) {
//     this.activeObject = object;
//     this.fire('show', object);
//     this.on('target:changed', object)
//   }
// // };


// fabric.util.observable(fabric.Image.filterManager);

fabric.util.drawFilter = function (element, src, filterName, options) {
  if (src.constructor === String) {
    fabric.util.loadImage(src, function (el) {
      fabric.util._drawFilter(element, el, filterName, options);
    });
  } else {
    fabric.util._drawFilter(element, src, filterName, options);
  }
};

fabric.util._drawFilter = function (element, el, filterName, options) {

  var ctx = element.getContext("2d");
  if (options) {
    if (options.width && options.height) {
      element.width = options.width;
      element.height = options.height;
    } else if (options.width) {
      element.width = options.width;
      element.height = options.width * (el.height / el.width);
    } else if (options.height) {
      element.height = options.height;
      element.width = options.height * (el.width / el.height);
    }
  }

  ctx.drawImage(el, 0, 0, element.width, element.height);
  if (!filterName) return;
  filterName = fabric.util.string.capitalize(filterName, true);

  if (fabric.Image.filters[filterName]) {
    var _filter = new fabric.Image.filters[filterName]();
  } else {
    var _filter = fabric.Image.filters[filterName].create({});
  }

  //var _filter = new fabric.Image.filters[filterName];
  if (_filter) {
    var _fo = fabric.Image.filters[filterName].prototype.options;
    var filterOptions = {};
    for (var i in _fo) {
      filterOptions[i] = _fo[i].value;
    }
    fabric.util.object.extend(_filter, filterOptions);
    _filter.imageData = ctx.getImageData(0, 0, element.width, element.height);
    _filter.applyTo(element);
  }
};
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 38 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

if (typeof WebFont == "undefined") {
  fabric.webFontsLoader = __webpack_require__(39);
} else {
  fabric.webFontsLoader = WebFont;
}

//интересная библиотека
// http://opentype.js.org/index.html
//todo add step
//
// fabric.Application.prototype.steps.splice(3,0,"loadWebfonts");

fabric.util.object.extend(fabric.Application.prototype, {
  // setWebfonts: function (callback) {
  //
  // },
  setFonts: function setFonts(fonts, callback) {
    this.fonts = fonts;
    if (fabric.isLikelyNode) {
      //todo шрифты не грузятся на сервере
      return callback();
    }
    // if(!fonts || !fonts.length){
    //   return callback();
    // }
    this.fire("loading", { type: "webfonts" });

    this._fonts = [];

    for (var i in this.fonts) {
      this._fonts = this._fonts.concat(this.fonts[i]);
    }
    this._fonts = fabric.util.object.sortBy(this._fonts, function (font) {
      return font;
    });

    if (fabric.webFontsLoader && (this.fonts.google && this.fonts.google.length || this.fonts.custom && this.fonts.custom.length)) {
      var fonts_options = {
        active: function active() {
          callback();
        }
      };
      if (this.fonts.google && this.fonts.google.length) {
        fonts_options.google = {
          families: this.fonts.google
        };
      }
      if (this.fonts.custom && this.fonts.custom.length) {
        fonts_options.custom = {
          families: this.fonts.custom
        };
      }

      fabric.webFontsLoader.load(fonts_options);
    } else {
      callback();
    }
    if (this.waitForWebfonts) {
      fabric.util.fonts.waitFor(this.waitForWebfonts, callback);
    }
  },
  fonts: {
    standart: ['Arial', 'Arial Black', 'Comic Sans MS', 'Courier New', 'Georgia', 'Impact', 'Lucida Console', 'Tahoma', 'Times New Roman', 'Geneva', 'sans-serif', 'serif', 'monospace', 'cursive'],
    google: [],
    custom: []
  }
});

fabric.util.fonts = {
  waitFor: function waitFor(fonts, callback) {
    var loadedFonts = 0;
    for (var i = 0, l = fonts.length; i < l; ++i) {
      (function (font) {
        var node = document.createElement('span');
        // Characters that vary significantly among different fonts
        node.innerHTML = 'giItT1WQy@!-/#';
        // Visible - so we can measure it - but not on the screen
        node.style.position = 'absolute';
        node.style.left = '-10000px';
        node.style.top = '-10000px';
        // Large font size makes even subtle changes obvious
        node.style.fontSize = '300px';
        // Reset any font properties
        node.style.fontFamily = 'sans-serif';
        node.style.fontVariant = 'normal';
        node.style.fontStyle = 'normal';
        node.style.fontWeight = 'normal';
        node.style.letterSpacing = '0';
        document.body.appendChild(node);

        // Remember width with no applied web font
        var width = node.offsetWidth;

        node.style.fontFamily = font;

        var interval;

        function checkFont() {
          // Compare current width with original width
          if (node && node.offsetWidth != width) {
            ++loadedFonts;
            node.parentNode.removeChild(node);
            node = null;
          }

          // If all fonts have been loaded
          if (loadedFonts >= fonts.length) {
            if (interval) {
              clearInterval(interval);
            }
            if (loadedFonts == fonts.length) {
              setTimeout(function () {
                callback();
              }, 50);
              return true;
            }
          }
        }

        if (!checkFont()) {
          interval = setInterval(checkFont, 50);
        }
      })(fonts[i]);
    }
  }
};
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 39 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
var __WEBPACK_AMD_DEFINE_RESULT__;

/* Web Font Loader v1.6.26 - (c) Adobe Systems, Google. License: Apache 2.0 */(function () {
  function aa(a, b, c) {
    return a.call.apply(a.bind, arguments);
  }function ba(a, b, c) {
    if (!a) throw Error();if (2 < arguments.length) {
      var d = Array.prototype.slice.call(arguments, 2);return function () {
        var c = Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c, d);return a.apply(b, c);
      };
    }return function () {
      return a.apply(b, arguments);
    };
  }function p(a, b, c) {
    p = Function.prototype.bind && -1 != Function.prototype.bind.toString().indexOf("native code") ? aa : ba;return p.apply(null, arguments);
  }var q = Date.now || function () {
    return +new Date();
  };function ca(a, b) {
    this.a = a;this.m = b || a;this.c = this.m.document;
  }var da = !!window.FontFace;function t(a, b, c, d) {
    b = a.c.createElement(b);if (c) for (var e in c) {
      c.hasOwnProperty(e) && ("style" == e ? b.style.cssText = c[e] : b.setAttribute(e, c[e]));
    }d && b.appendChild(a.c.createTextNode(d));return b;
  }function u(a, b, c) {
    a = a.c.getElementsByTagName(b)[0];a || (a = document.documentElement);a.insertBefore(c, a.lastChild);
  }function v(a) {
    a.parentNode && a.parentNode.removeChild(a);
  }
  function w(a, b, c) {
    b = b || [];c = c || [];for (var d = a.className.split(/\s+/), e = 0; e < b.length; e += 1) {
      for (var f = !1, g = 0; g < d.length; g += 1) {
        if (b[e] === d[g]) {
          f = !0;break;
        }
      }f || d.push(b[e]);
    }b = [];for (e = 0; e < d.length; e += 1) {
      f = !1;for (g = 0; g < c.length; g += 1) {
        if (d[e] === c[g]) {
          f = !0;break;
        }
      }f || b.push(d[e]);
    }a.className = b.join(" ").replace(/\s+/g, " ").replace(/^\s+|\s+$/, "");
  }function y(a, b) {
    for (var c = a.className.split(/\s+/), d = 0, e = c.length; d < e; d++) {
      if (c[d] == b) return !0;
    }return !1;
  }
  function z(a) {
    if ("string" === typeof a.f) return a.f;var b = a.m.location.protocol;"about:" == b && (b = a.a.location.protocol);return "https:" == b ? "https:" : "http:";
  }function ea(a) {
    return a.m.location.hostname || a.a.location.hostname;
  }
  function A(a, b, c) {
    function d() {
      k && e && f && (k(g), k = null);
    }b = t(a, "link", { rel: "stylesheet", href: b, media: "all" });var e = !1,
        f = !0,
        g = null,
        k = c || null;da ? (b.onload = function () {
      e = !0;d();
    }, b.onerror = function () {
      e = !0;g = Error("Stylesheet failed to load");d();
    }) : setTimeout(function () {
      e = !0;d();
    }, 0);u(a, "head", b);
  }
  function B(a, b, c, d) {
    var e = a.c.getElementsByTagName("head")[0];if (e) {
      var f = t(a, "script", { src: b }),
          g = !1;f.onload = f.onreadystatechange = function () {
        g || this.readyState && "loaded" != this.readyState && "complete" != this.readyState || (g = !0, c && c(null), f.onload = f.onreadystatechange = null, "HEAD" == f.parentNode.tagName && e.removeChild(f));
      };e.appendChild(f);setTimeout(function () {
        g || (g = !0, c && c(Error("Script load timeout")));
      }, d || 5E3);return f;
    }return null;
  };function C() {
    this.a = 0;this.c = null;
  }function D(a) {
    a.a++;return function () {
      a.a--;E(a);
    };
  }function F(a, b) {
    a.c = b;E(a);
  }function E(a) {
    0 == a.a && a.c && (a.c(), a.c = null);
  };function G(a) {
    this.a = a || "-";
  }G.prototype.c = function (a) {
    for (var b = [], c = 0; c < arguments.length; c++) {
      b.push(arguments[c].replace(/[\W_]+/g, "").toLowerCase());
    }return b.join(this.a);
  };function H(a, b) {
    this.c = a;this.f = 4;this.a = "n";var c = (b || "n4").match(/^([nio])([1-9])$/i);c && (this.a = c[1], this.f = parseInt(c[2], 10));
  }function fa(a) {
    return I(a) + " " + (a.f + "00") + " 300px " + J(a.c);
  }function J(a) {
    var b = [];a = a.split(/,\s*/);for (var c = 0; c < a.length; c++) {
      var d = a[c].replace(/['"]/g, "");-1 != d.indexOf(" ") || /^\d/.test(d) ? b.push("'" + d + "'") : b.push(d);
    }return b.join(",");
  }function K(a) {
    return a.a + a.f;
  }function I(a) {
    var b = "normal";"o" === a.a ? b = "oblique" : "i" === a.a && (b = "italic");return b;
  }
  function ga(a) {
    var b = 4,
        c = "n",
        d = null;a && ((d = a.match(/(normal|oblique|italic)/i)) && d[1] && (c = d[1].substr(0, 1).toLowerCase()), (d = a.match(/([1-9]00|normal|bold)/i)) && d[1] && (/bold/i.test(d[1]) ? b = 7 : /[1-9]00/.test(d[1]) && (b = parseInt(d[1].substr(0, 1), 10))));return c + b;
  };function ha(a, b) {
    this.c = a;this.f = a.m.document.documentElement;this.h = b;this.a = new G("-");this.j = !1 !== b.events;this.g = !1 !== b.classes;
  }function ia(a) {
    a.g && w(a.f, [a.a.c("wf", "loading")]);L(a, "loading");
  }function M(a) {
    if (a.g) {
      var b = y(a.f, a.a.c("wf", "active")),
          c = [],
          d = [a.a.c("wf", "loading")];b || c.push(a.a.c("wf", "inactive"));w(a.f, c, d);
    }L(a, "inactive");
  }function L(a, b, c) {
    if (a.j && a.h[b]) if (c) a.h[b](c.c, K(c));else a.h[b]();
  };function ja() {
    this.c = {};
  }function ka(a, b, c) {
    var d = [],
        e;for (e in b) {
      if (b.hasOwnProperty(e)) {
        var f = a.c[e];f && d.push(f(b[e], c));
      }
    }return d;
  };function N(a, b) {
    this.c = a;this.f = b;this.a = t(this.c, "span", { "aria-hidden": "true" }, this.f);
  }function O(a) {
    u(a.c, "body", a.a);
  }function P(a) {
    return "display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:" + J(a.c) + ";" + ("font-style:" + I(a) + ";font-weight:" + (a.f + "00") + ";");
  };function Q(a, b, c, d, e, f) {
    this.g = a;this.j = b;this.a = d;this.c = c;this.f = e || 3E3;this.h = f || void 0;
  }Q.prototype.start = function () {
    var a = this.c.m.document,
        b = this,
        c = q(),
        d = new Promise(function (d, e) {
      function k() {
        q() - c >= b.f ? e() : a.fonts.load(fa(b.a), b.h).then(function (a) {
          1 <= a.length ? d() : setTimeout(k, 25);
        }, function () {
          e();
        });
      }k();
    }),
        e = new Promise(function (a, d) {
      setTimeout(d, b.f);
    });Promise.race([e, d]).then(function () {
      b.g(b.a);
    }, function () {
      b.j(b.a);
    });
  };function R(a, b, c, d, e, f, g) {
    this.v = a;this.B = b;this.c = c;this.a = d;this.s = g || "BESbswy";this.f = {};this.w = e || 3E3;this.u = f || null;this.o = this.j = this.h = this.g = null;this.g = new N(this.c, this.s);this.h = new N(this.c, this.s);this.j = new N(this.c, this.s);this.o = new N(this.c, this.s);a = new H(this.a.c + ",serif", K(this.a));a = P(a);this.g.a.style.cssText = a;a = new H(this.a.c + ",sans-serif", K(this.a));a = P(a);this.h.a.style.cssText = a;a = new H("serif", K(this.a));a = P(a);this.j.a.style.cssText = a;a = new H("sans-serif", K(this.a));a = P(a);this.o.a.style.cssText = a;O(this.g);O(this.h);O(this.j);O(this.o);
  }var S = { D: "serif", C: "sans-serif" },
      T = null;function U() {
    if (null === T) {
      var a = /AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);T = !!a && (536 > parseInt(a[1], 10) || 536 === parseInt(a[1], 10) && 11 >= parseInt(a[2], 10));
    }return T;
  }R.prototype.start = function () {
    this.f.serif = this.j.a.offsetWidth;this.f["sans-serif"] = this.o.a.offsetWidth;this.A = q();la(this);
  };
  function ma(a, b, c) {
    for (var d in S) {
      if (S.hasOwnProperty(d) && b === a.f[S[d]] && c === a.f[S[d]]) return !0;
    }return !1;
  }function la(a) {
    var b = a.g.a.offsetWidth,
        c = a.h.a.offsetWidth,
        d;(d = b === a.f.serif && c === a.f["sans-serif"]) || (d = U() && ma(a, b, c));d ? q() - a.A >= a.w ? U() && ma(a, b, c) && (null === a.u || a.u.hasOwnProperty(a.a.c)) ? V(a, a.v) : V(a, a.B) : na(a) : V(a, a.v);
  }function na(a) {
    setTimeout(p(function () {
      la(this);
    }, a), 50);
  }function V(a, b) {
    setTimeout(p(function () {
      v(this.g.a);v(this.h.a);v(this.j.a);v(this.o.a);b(this.a);
    }, a), 0);
  };function W(a, b, c) {
    this.c = a;this.a = b;this.f = 0;this.o = this.j = !1;this.s = c;
  }var X = null;W.prototype.g = function (a) {
    var b = this.a;b.g && w(b.f, [b.a.c("wf", a.c, K(a).toString(), "active")], [b.a.c("wf", a.c, K(a).toString(), "loading"), b.a.c("wf", a.c, K(a).toString(), "inactive")]);L(b, "fontactive", a);this.o = !0;oa(this);
  };
  W.prototype.h = function (a) {
    var b = this.a;if (b.g) {
      var c = y(b.f, b.a.c("wf", a.c, K(a).toString(), "active")),
          d = [],
          e = [b.a.c("wf", a.c, K(a).toString(), "loading")];c || d.push(b.a.c("wf", a.c, K(a).toString(), "inactive"));w(b.f, d, e);
    }L(b, "fontinactive", a);oa(this);
  };function oa(a) {
    0 == --a.f && a.j && (a.o ? (a = a.a, a.g && w(a.f, [a.a.c("wf", "active")], [a.a.c("wf", "loading"), a.a.c("wf", "inactive")]), L(a, "active")) : M(a.a));
  };function pa(a) {
    this.j = a;this.a = new ja();this.h = 0;this.f = this.g = !0;
  }pa.prototype.load = function (a) {
    this.c = new ca(this.j, a.context || this.j);this.g = !1 !== a.events;this.f = !1 !== a.classes;qa(this, new ha(this.c, a), a);
  };
  function ra(a, b, c, d, e) {
    var f = 0 == --a.h;(a.f || a.g) && setTimeout(function () {
      var a = e || null,
          k = d || null || {};if (0 === c.length && f) M(b.a);else {
        b.f += c.length;f && (b.j = f);var h,
            m = [];for (h = 0; h < c.length; h++) {
          var l = c[h],
              n = k[l.c],
              r = b.a,
              x = l;r.g && w(r.f, [r.a.c("wf", x.c, K(x).toString(), "loading")]);L(r, "fontloading", x);r = null;null === X && (X = window.FontFace ? (x = /Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent)) ? 42 < parseInt(x[1], 10) : !0 : !1);X ? r = new Q(p(b.g, b), p(b.h, b), b.c, l, b.s, n) : r = new R(p(b.g, b), p(b.h, b), b.c, l, b.s, a, n);m.push(r);
        }for (h = 0; h < m.length; h++) {
          m[h].start();
        }
      }
    }, 0);
  }function qa(a, b, c) {
    var d = [],
        e = c.timeout;ia(b);var d = ka(a.a, c, a.c),
        f = new W(a.c, b, e);a.h = d.length;b = 0;for (c = d.length; b < c; b++) {
      d[b].load(function (b, d, c) {
        ra(a, f, b, d, c);
      });
    }
  };function sa(a, b) {
    this.c = a;this.a = b;
  }function ta(a, b, c) {
    var d = z(a.c);a = (a.a.api || "fast.fonts.net/jsapi").replace(/^.*http(s?):(\/\/)?/, "");return d + "//" + a + "/" + b + ".js" + (c ? "?v=" + c : "");
  }
  sa.prototype.load = function (a) {
    function b() {
      if (f["__mti_fntLst" + d]) {
        var c = f["__mti_fntLst" + d](),
            e = [],
            h;if (c) for (var m = 0; m < c.length; m++) {
          var l = c[m].fontfamily;void 0 != c[m].fontStyle && void 0 != c[m].fontWeight ? (h = c[m].fontStyle + c[m].fontWeight, e.push(new H(l, h))) : e.push(new H(l));
        }a(e);
      } else setTimeout(function () {
        b();
      }, 50);
    }var c = this,
        d = c.a.projectId,
        e = c.a.version;if (d) {
      var f = c.c.m;B(this.c, ta(c, d, e), function (e) {
        e ? a([]) : (f["__MonotypeConfiguration__" + d] = function () {
          return c.a;
        }, b());
      }).id = "__MonotypeAPIScript__" + d;
    } else a([]);
  };function ua(a, b) {
    this.c = a;this.a = b;
  }ua.prototype.load = function (a) {
    var b,
        c,
        d = this.a.urls || [],
        e = this.a.families || [],
        f = this.a.testStrings || {},
        g = new C();b = 0;for (c = d.length; b < c; b++) {
      A(this.c, d[b], D(g));
    }var k = [];b = 0;for (c = e.length; b < c; b++) {
      if (d = e[b].split(":"), d[1]) for (var h = d[1].split(","), m = 0; m < h.length; m += 1) {
        k.push(new H(d[0], h[m]));
      } else k.push(new H(d[0]));
    }F(g, function () {
      a(k, f);
    });
  };function va(a, b, c) {
    a ? this.c = a : this.c = b + wa;this.a = [];this.f = [];this.g = c || "";
  }var wa = "//fonts.googleapis.com/css";function xa(a, b) {
    for (var c = b.length, d = 0; d < c; d++) {
      var e = b[d].split(":");3 == e.length && a.f.push(e.pop());var f = "";2 == e.length && "" != e[1] && (f = ":");a.a.push(e.join(f));
    }
  }
  function ya(a) {
    if (0 == a.a.length) throw Error("No fonts to load!");if (-1 != a.c.indexOf("kit=")) return a.c;for (var b = a.a.length, c = [], d = 0; d < b; d++) {
      c.push(a.a[d].replace(/ /g, "+"));
    }b = a.c + "?family=" + c.join("%7C");0 < a.f.length && (b += "&subset=" + a.f.join(","));0 < a.g.length && (b += "&text=" + encodeURIComponent(a.g));return b;
  };function za(a) {
    this.f = a;this.a = [];this.c = {};
  }
  var Aa = { latin: "BESbswy", "latin-ext": "\xE7\xF6\xFC\u011F\u015F", cyrillic: "\u0439\u044F\u0416", greek: "\u03B1\u03B2\u03A3", khmer: "\u1780\u1781\u1782", Hanuman: "\u1780\u1781\u1782" },
      Ba = { thin: "1", extralight: "2", "extra-light": "2", ultralight: "2", "ultra-light": "2", light: "3", regular: "4", book: "4", medium: "5", "semi-bold": "6", semibold: "6", "demi-bold": "6", demibold: "6", bold: "7", "extra-bold": "8", extrabold: "8", "ultra-bold": "8", ultrabold: "8", black: "9", heavy: "9", l: "3", r: "4", b: "7" },
      Ca = { i: "i", italic: "i", n: "n", normal: "n" },
      Da = /^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/;
  function Ea(a) {
    for (var b = a.f.length, c = 0; c < b; c++) {
      var d = a.f[c].split(":"),
          e = d[0].replace(/\+/g, " "),
          f = ["n4"];if (2 <= d.length) {
        var g;var k = d[1];g = [];if (k) for (var k = k.split(","), h = k.length, m = 0; m < h; m++) {
          var l;l = k[m];if (l.match(/^[\w-]+$/)) {
            var n = Da.exec(l.toLowerCase());if (null == n) l = "";else {
              l = n[2];l = null == l || "" == l ? "n" : Ca[l];n = n[1];if (null == n || "" == n) n = "4";else var r = Ba[n],
                  n = r ? r : isNaN(n) ? "4" : n.substr(0, 1);l = [l, n].join("");
            }
          } else l = "";l && g.push(l);
        }0 < g.length && (f = g);3 == d.length && (d = d[2], g = [], d = d ? d.split(",") : g, 0 < d.length && (d = Aa[d[0]]) && (a.c[e] = d));
      }a.c[e] || (d = Aa[e]) && (a.c[e] = d);for (d = 0; d < f.length; d += 1) {
        a.a.push(new H(e, f[d]));
      }
    }
  };function Fa(a, b) {
    this.c = a;this.a = b;
  }var Ga = { Arimo: !0, Cousine: !0, Tinos: !0 };Fa.prototype.load = function (a) {
    var b = new C(),
        c = this.c,
        d = new va(this.a.api, z(c), this.a.text),
        e = this.a.families;xa(d, e);var f = new za(e);Ea(f);A(c, ya(d), D(b));F(b, function () {
      a(f.a, f.c, Ga);
    });
  };function Ha(a, b) {
    this.c = a;this.a = b;
  }Ha.prototype.load = function (a) {
    var b = this.a.id,
        c = this.c.m;b ? B(this.c, (this.a.api || "https://use.typekit.net") + "/" + b + ".js", function (b) {
      if (b) a([]);else if (c.Typekit && c.Typekit.config && c.Typekit.config.fn) {
        b = c.Typekit.config.fn;for (var e = [], f = 0; f < b.length; f += 2) {
          for (var g = b[f], k = b[f + 1], h = 0; h < k.length; h++) {
            e.push(new H(g, k[h]));
          }
        }try {
          c.Typekit.load({ events: !1, classes: !1, async: !0 });
        } catch (m) {}a(e);
      }
    }, 2E3) : a([]);
  };function Ia(a, b) {
    this.c = a;this.f = b;this.a = [];
  }Ia.prototype.load = function (a) {
    var b = this.f.id,
        c = this.c.m,
        d = this;b ? (c.__webfontfontdeckmodule__ || (c.__webfontfontdeckmodule__ = {}), c.__webfontfontdeckmodule__[b] = function (b, c) {
      for (var g = 0, k = c.fonts.length; g < k; ++g) {
        var h = c.fonts[g];d.a.push(new H(h.name, ga("font-weight:" + h.weight + ";font-style:" + h.style)));
      }a(d.a);
    }, B(this.c, z(this.c) + (this.f.api || "//f.fontdeck.com/s/css/js/") + ea(this.c) + "/" + b + ".js", function (b) {
      b && a([]);
    })) : a([]);
  };var Y = new pa(window);Y.a.c.custom = function (a, b) {
    return new ua(b, a);
  };Y.a.c.fontdeck = function (a, b) {
    return new Ia(b, a);
  };Y.a.c.monotype = function (a, b) {
    return new sa(b, a);
  };Y.a.c.typekit = function (a, b) {
    return new Ha(b, a);
  };Y.a.c.google = function (a, b) {
    return new Fa(b, a);
  };var Z = { load: p(Y.load, Y) }; true ? !(__WEBPACK_AMD_DEFINE_RESULT__ = function () {
    return Z;
  }.call(exports, __webpack_require__, exports, module),
				__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__)) : "undefined" !== typeof module && module.exports ? module.exports = Z : (window.WebFont = Z, window.WebFontConfig && Y.load(window.WebFontConfig));
})();

/***/ }),
/* 40 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

/*
export interface GalleryData : {
 target: fabricjs object
}
*/

fabric.Application.prototype.setElementFromMenu = function (selectedData) {
  this.canvas.createImageObject(selectedData.image, this.uploadClass);
};

fabric.util.object.extend(fabric.Application.prototype, {
  draggableArea: ".ff-container",
  /*createGallery: function (target, $el, options) {
    if ($el.constructor === String) {
      $el = $("#" + $el);
    }
    options = options || {};
     if (target.galleryCategory) {
      options.category = target.galleryCategory;
    }
     $el.empty();
    var library = this.getLibraryElements(options);
      this.createElementsList($el, library);
     _.each(library, function (libraryItem) {
      var img = new Image();
      img.src = fabric.util.mediaRoot + libraryItem.src;
       var $img = $(img).width(100).height(100)
        .click(function () {
           var selectedData = {
            image: img,
            data: libraryItem,
            options: options
          };
          target.setElementFromMenu(selectedData);
        });
       $el.append($img);
    });
  },*/
  getFontsLibrary: function getFontsLibrary() {
    return _.map(this._fonts, function (fontName) {
      return {
        fontFamily: fontName,
        fontSize: 25,
        category: "fontFamily",
        text: fontName,
        type: "text"
      };
    });
  },
  _addCanvasEl: function _addCanvasEl(el, element, $innerEl) {

    // element = fabric.util.object.cloneDeep(element);

    var canvasEl = document.createElement("canvas");
    canvasEl.width = 156;
    canvasEl.height = 86;

    var _fake_canvas = new fabric.StaticCanvas(canvasEl, { application: this });
    _fake_canvas.clear();

    element.position = "center";

    _fake_canvas.createObject(element, function (_object) {
      var b = _object.getBoundingRect();
      /* _object.set({
         left : 80 - b.width/2 - _object.strokeWidth * 2,
         top : 45 - b.height/2 - _object.strokeWidth * 2
       });*/

      fabric.util.object.extend(element, {
        scaleX: _object.scaleX,
        scaleY: _object.scaleY,
        width: _object.width,
        height: _object.height,
        left: _object.left,
        top: _object.top,
        strokeWidth: _object.strokeWidth
      });

      delete element.position;

      _fake_canvas.add(_object);
      _fake_canvas.renderAll();

      $innerEl[0].src = canvasEl.toDataURL();

      delete _object.canvas;
      el[0].data = element;
      el[0].element = _object;
    });
  },
  updateElementsList: function updateElementsList($el, library, options) {

    var app = this;
    for (var i in library) {
      var element = library[i];
      var el = $("<span>").addClass("list-item");

      el[0].data = element;

      if (options.element) {
        element = options.element(element);
      }

      if (element.title) {
        var $span = $("<span>").text(element.title).addClass("element-title");
        el.append($span);
      }
      var $innerEl = null;

      if (options.render) {
        $innerEl = options.render(element);
      } else {
        if (element.category == "fontFamily") {
          $innerEl = $("<span>").css({
            "color": element.fill || fabric.Text.prototype.fill,
            "font-family": element.fontFamily,
            "font-size": element.fontSize
          }).text(element.text);
        } else {
          switch (element.type) {
            case "image":
              $innerEl = $("<img>").attr({
                src: fabric.util.mediaRoot + element.src
              });
              el[0].element = $innerEl[0];
              break;
            case "video":
              $innerEl = $("<video>");
              for (var type in element.src) {
                $innerEl.append($("<source>").attr({
                  src: fabric.util.mediaRoot + element.src[type],
                  type: type
                }));
              }
              el[0].element = $innerEl[0];
              break;
            default:
              $innerEl = $("<img width=160 height=90>");
              this._addCanvasEl(el, element, $innerEl);
          }
        }
      }
      if ($innerEl.constructor == Array) {
        var _span = $("<span>");
        _span.append($innerEl);
        $innerEl = _span;
      }
      el.append($innerEl);

      if (options.draggable) {
        $innerEl.draggable({
          draggable: "helper",
          droppable: ".canvas-container",
          ngModel: element,
          onMove: function onMove(data) {
            app.canvas._onDragMove && app.canvas._onDragMove(data.$event);
          },
          onDrop: function onDrop(data) {
            app.canvas._onDrop(data.$event);
          },
          draggableArea: app.draggableArea
        });
      }
      $innerEl.click(options.activate.bind(this, el[0]));
      $el.append(el);
    }
  },
  createElementsList: function createElementsList($el, library, options) {
    options = fabric.util.object.defaults(options || {}, {
      draggable: true,
      activate: function activate(el) {
        if (this.canvas.target && this.canvas.target.setData) {
          this.canvas.target.setData(el.data);
        } else {
          this.canvas.setData(el.data);
        }
      }
    });
    this.updateElementsList($el, library, options);
  }
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 41 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.objectsLibrary = {
  text: {
    title: "Text",
    type: "i-text",
    text: "Текст"
  },
  line: {
    type: "line",
    strokeWidth: 5,
    stroke: "black",
    scaleX: 1,
    scaleY: 1,
    x1: 0,
    x2: 100,
    y1: 0,
    y2: 50
  },
  triangle: {
    type: "triangle",
    width: function width(w, h) {
      return Math.min(w, h) - 4;
    },
    height: function height(w, h) {
      return Math.min(w, h) - 4;
    }
  },
  rectangle: {
    type: "rect",
    width: function width(w, h) {
      return Math.min(w, h) - 4;
    },
    height: function height(w, h) {
      return Math.min(w, h) - 4;
    }
  },
  polygon: {
    scaleX: 1,
    scaleY: 1,
    type: "polygon",
    points: function points(w, h) {
      return [{ x: 25, y: 1 }, { x: 31, y: 18 }, { x: 49, y: 18 }, { x: 35, y: 29 }, { x: 40, y: 46 }, { x: 25, y: 36 }, { x: 10, y: 46 }, { x: 15, y: 29 }, { x: 1, y: 18 }, { x: 19, y: 18 }];
    }
  },
  path: {
    "type": "path",
    "path": "m581.077942,2.537359c-2.053223,0.047071 -4.04071,0.188348 -6.108093,0.352907c-33.05542,2.663918 -62.235901,19.640541 -77.057678,44.925953l-7.8573,19.135319c1.698822,-6.633144 4.302979,-13.065384 7.8573,-19.135319c-26.430695,-22.16293 -63.531677,-32.388445 -100.192383,-27.574373c-36.661469,4.788353 -68.503082,24.041758 -85.901978,51.935225c-49.116486,-24.490013 -110.34288,-22.999454 -157.711807,3.860092c-47.369164,26.86068 -72.61673,74.40551 -64.941162,122.38308l5.021355,19.49968c-2.263329,-6.38501 -3.960793,-12.887695 -5.021355,-19.49968l-0.761948,1.798569c-41.179165,3.625244 -74.945375,29.465134 -83.716398,64.059235c-8.771805,34.597748 9.46701,70.085876 45.185621,87.96701l55.776558,10.973114c-19.480217,1.291962 -38.915543,-2.534515 -55.776558,-10.973114c-27.5478,24.96817 -33.888516,61.935303 -15.71492,92.467834c18.173733,30.524719 56.988899,48.110687 97.030457,44.11734l24.339722,-5.21109c-7.827499,2.651611 -15.960983,4.379059 -24.339722,5.21109c22.730042,33.857269 60.428192,58.556244 104.66893,68.383514c44.2491,9.81366 91.240952,4.014771 130.425949,-16.094604c31.96701,40.793823 88.707642,62.217468 145.596313,54.99707c56.902466,-7.219666 103.833984,-41.81427 120.501343,-88.770996l5.781433,-26.239532c-0.863708,8.909546 -2.742249,17.681366 -5.781433,26.239532c39.133301,20.753662 88.353333,21.927307 128.785095,3.049316c40.439819,-18.874084 65.665771,-54.869049 66.036133,-94.078247l-14.495605,-58.580597l-57.105713,-39.630768c44.163452,22.374573 71.992615,56.467255 71.601318,98.211365c52.49707,0.448181 97.103394,-35.956573 117.112427,-77.726288c20.011597,-41.769836 12.443604,-89.396759 -19.864929,-125.164642c13.401184,-26.637695 12.609985,-56.937332 -2.183472,-83.034088c-14.786194,-26.097893 -42.065491,-45.476891 -74.873047,-53.098335c-7.341431,-34.580929 -37.602661,-62.404482 -77.600708,-71.526293c-39.998474,-9.121368 -82.584839,2.123992 -109.364807,28.926123l-16.258179,22.19817c4.157959,-8.018612 9.583923,-15.495213 16.258179,-22.19817c-18.876953,-21.060713 -48.486023,-32.954061 -79.348938,-32.155401l0,0z",
    "width": function width(w, h) {
      return w - 4;
    },
    "height": function height(w, h) {
      return h - 4;
    }
  },
  ellipse: {
    "type": "ellipse",
    "rx": function rx(w, h) {
      return w / 2 - 4;
    },
    "ry": function ry(w, h) {
      return h / 2 - 4;
    }
  },
  circle: {
    type: "circle",
    radius: function radius(w, h) {
      return Math.min(w, h) / 2 - 4;
    }
  }
};

fabric.util.object.extend(fabric.Application.prototype, {
  getLibraryElements: function getLibraryElements(options) {
    var category = fabric.util.object.findWhere(this.library, { id: options.category });
    return fabric.util.object.map(fabric.util.object.cloneDeep(category.items), function (el) {
      return fabric.util.object.extend(el, category.template);
    });
  },
  /**
   *
   * @param value
   * @param callback
   *
   * @example
   [{
    "id": 5,
    "title": "video",
    "template": {
      "type": "video"
    },
    "items": [
      {
        "src": "video.mpg"
        "height": 360,
        "width": 480
      }]
    }]
   */
  setLibrary: function setLibrary(value, callback) {
    var _this = this;

    fabric.util.data.loadJson(value, function (data) {
      data.forEach(function (category) {
        if (!category.id) {
          category.id = ++fabric.util._idCounter;
        }
      });
      _this.library = data;
      callback();
    });
  }
});
fabric.Application.prototype.configurationProperties.push("library");

fabric.getObjectsList = function (w, h) {
  var _lib = [];
  for (var i in this.objectsLibrary) {
    var o = _lib[i] = fabric.util.object.cloneDeep(this.objectsLibrary[i]);
    o.title = o.title || o.type;
    if (o.width === 0) o.width = w;
    if (o.height === 0) o.height = h;
    for (var j in o) {
      if (o[j].constructor === Function) {
        o[j] = o[j].call(o, w, h);
      }
    }
  }
  return _lib;
};
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 42 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.util.object.extend(fabric, {
  debugTimeout: 0
});

fabric.util.object.extend(fabric.Application.prototype, {
  setDebug: function setDebug() {
    this.on("ready", function () {
      this.enableDebugging();
    });
  },

  enableDebugging: function enableDebugging() {
    if (fabric.debug) {

      var _operand = "color: #2EC06C; font-style: italic;";
      console.info("debug enabled. (use %capp%c, %cproject%c, %ccanvas%c, %ctarget%c in console)", _operand, "color: #202020", _operand, "color: #202020", _operand, "color: #202020", _operand, "color: #202020");

      window.app = this;
      window.canvas = this.canvas;
      window.project = this.project;
      window.target = null;
      this.canvas && this.canvas.on("target:changed", function () {
        window.target = this.target;
      });
    }
  }
});

fabric.Object.prototype.debug = function (noBorders) {
  var canvas = document.createElement("canvas");
  canvas.width = noBorders ? this.width : this.width + 2;
  canvas.height = noBorders ? this.height : this.height + 2;

  var ctx = canvas.getContext('2d');
  if (!noBorders) {
    ctx.lineWidth = 1;
    ctx.strokeStyle = "yellow";
    ctx.strokeRect(0, 0, this.width + 2, this.height + 2);
    ctx.setLineDash([4, 4]);
    ctx.strokeStyle = "#000000";
    ctx.strokeRect(0, 0, this.width + 2, this.height + 2);
  }
  ctx.translate(this.width / 2 + 1, this.height / 2 + 1);
  var _clipTo = this.clipTo;
  delete this.clipTo;
  this.render(ctx, true);
  this.clipTo = _clipTo;
  window.open(canvas.toDataURL(), "_blank");
};

fabric.Application.prototype.logEvents = fabric.Object.prototype.logEvents = function eventsLogger(options) {
  var _counter = {};
  for (var i in options) {
    _counter[i] = 0;
    this.on(options[i], function (i, event) {
      console.log(i + " " + ++_counter[i], event);
    }.bind(this, i));
  }
};
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 43 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric, __dirname) {

fabric.util.mediaRoot = "";
fabric.util.addNoCache = false;

fabric.util._loadImage_overwritten = fabric.util.loadImage;

fabric.util.object.extend(fabric.Application.prototype, {
  optionsOrder: function () {
    var oo = fabric.Application.prototype.optionsOrder;
    oo.splice(oo.indexOf("canvasContainer"), 0, "mediaRoot");
    return oo;
  }(),
  setMediaRoot: function setMediaRoot(_mediaRoot) {
    if (_mediaRoot) {
      var _dirname;
      if (fabric.isLikelyNode) {
        _dirname = __dirname;
      } else {
        _dirname = fabric.util.path.getParentDirectoryUrl(window.location.href);
      }

      //  if ((_mediaRoot.indexOf("./") == 0)) {
      //  }
      var _last = _mediaRoot[_mediaRoot.length - 1];
      if (_last != "/" && _last != "\\") {
        _mediaRoot += "/";
      }
      _mediaRoot = fabric.util.path.resolve(_dirname + _mediaRoot);
      fabric.util.mediaRoot = _mediaRoot;
    }
  }
});

// if(!fabric.isLikelyNode){
//
//   var URL = require('url'),
//     HTTP = require('http'),
//     HTTPS = require('https'),
//     Image = require('canvas').Image;
//
//   /** @private */
//   var request = function (url, encoding, callback) {
//     var oURL = URL.parse(url);
//
//     // detect if http or https is used
//     if ( !oURL.port ) {
//       oURL.port = ( oURL.protocol.indexOf('https:') === 0 ) ? 443 : 80;
//     }
//
//     // assign request handler based on protocol
//     var reqHandler = (oURL.protocol.indexOf('https:') === 0 ) ? HTTPS : HTTP,
//       req = reqHandler.request({
//         hostname: oURL.hostname,
//         port: oURL.port,
//         path: oURL.path,
//         method: 'GET'
//       }, function(response) {
//         var body = '';
//         if (encoding) {
//           response.setEncoding(encoding);
//         }
//         response.on('end', function () {
//           callback(body);
//         });
//         response.on('data', function (chunk) {
//           if (response.statusCode === 200) {
//             body += chunk;
//           }
//         });
//       });
//
//     req.on('error', function(err) {
//       if (err.errno === process.ECONNREFUSED) {
//         fabric.log('ECONNREFUSED: connection refused to ' + oURL.hostname + ':' + oURL.port);
//       }
//       else {
//         fabric.log(err.message);
//       }
//       callback(null);
//     });
//
//     req.end();
//   }
//
//   /** @private */
//   var requestFs = function (path, callback) {
//     var fs = require('fs');
//     fs.readFile(path, function (err, data) {
//       if (err) {
//         fabric.log(err);
//         throw err;
//       }
//       else {
//         callback(data);
//       }
//     });
//   };
//
//   fabric.util.loadImage = function(url, callback, context) {
//
//
//     var img = new Image();
//     img.onerror = function(){
//       console.log("error");
//       callback && callback.call(context, null, true);
//     };
//     img.onload = function(){
//       console.log("success");
//       callback && callback.call(context, img);
//     };
//
//     function createImageAndCallBack(data) {
//       if (data) {
//         img.src = data;
//         // preserving original url, which seems to be lost in node-canvas
//         img._src = url;
//       }
//       else {
//         img = null;
//         callback && callback.call(context, null, true);
//       }
//     }
//
//     if (url && (url instanceof Buffer || url.indexOf('data') === 0)) {
//       img.src = img._src = url;
//     }
//     else if (url && url.indexOf('http') !== 0) {
//       var path = require("path");
//       url = fabric.util.getURL(url);
//       url =   path.resolve(fabric.util.mediaRoot, url);
//       img.src =  url;
//       // requestFs(url, createImageAndCallBack);
//     }
//     else if (url) {
//       request(url, 'binary', createImageAndCallBack);
//     }
//     else {
//       callback && callback.call(context, url);
//     }
//   };
// }else{
fabric.util.loadResources = function (resources, callback, context, crossOrigin) {

  var loadedResources = {};
  var loader = fabric.util.queueLoad(Object.keys(resources).length, function () {
    callback(loadedResources);
  });
  for (var i in resources) {
    (function (i) {
      fabric.util.loadImage(resources[i], function (image) {
        loadedResources[i] = image;
        loader();
      }, context, crossOrigin);
    })(i);
  }
};

fabric.util.loadImage = function (url, callback, context, crossOrigin) {
  url = fabric.util.getURL(url);
  function _check_errors(img) {
    //изображение не было загружено
    if (img) {
      callback.call(this, img);
    } else {
      fabric.errors.push({ type: "image", message: "Image was not loaded" });
      fabric.util._loadImage_overwritten(fabric.media.error, callback, context, crossOrigin || 'Anonymous');
    }
  }

  if (fabric.debugTimeout) {
    setTimeout(fabric.util._loadImage_overwritten.bind(this, url, _check_errors, context, crossOrigin || 'Anonymous'), fabric.debugTimeout);
  } else {
    fabric.util._loadImage_overwritten(url, _check_errors, context, crossOrigin || 'Anonymous');
  }
};

fabric.util.getURL = function (url) {
  if (url.indexOf('blob') !== 0 && url.indexOf('data') !== 0 && url.indexOf('://') == -1) {
    url = fabric.util.mediaRoot + url;
  }
  if (fabric.util.addNoCache && /^(http|https)\:\/\//.test(url)) {
    url += '?no-cache=' + new Date().getTime();
  }
  return url;
};

fabric.util.loadVideo = function (sources, callback, context, crossOrigin) {

  function loadIt(url) {
    video.src = fabric.util.getURL(url);
    video.addEventListener("loadeddata", function () {
      callback(video);
    }, true);
    video.load();
  }

  var video = document.createElement('video');

  //trying to find the most suitable source for current browser
  for (var type in sources) {
    if (video.canPlayType(type) == "yes") {
      this.mediaType = type;
      loadIt(sources[type]);
      return;
    }
  }
  for (var type in sources) {
    if (video.canPlayType(type) == "maybe") {
      this.mediaType = type;
      loadIt(sources[type]);
      return;
    }
  }
  console.warn("video sources formats is not supported");
};

fabric.util._loadSVGFromURL_overwritten = fabric.loadSVGFromURL;
fabric.loadSVGFromURL = function (url, callback, reviver) {
  if (url.indexOf('data') !== 0 && url.indexOf('://') == -1) {
    url = fabric.util.mediaRoot + url;
  }
  if (fabric.util.addNoCache && /^(http|https)\:\/\//.test(url)) {
    url += '?no-cache=' + moment().format('x');
  }
  fabric.util._loadSVGFromURL_overwritten(url, function (data) {
    if (data) {
      return callback(data);
    }

    var xml = jQuery.parseXML(atob(fabric.media.error.substr(26)));

    fabric.parseSVGDocument(xml.documentElement, function (results, options) {
      callback && callback(results, options);
    }, reviver);
  }, reviver);
};
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0), "/"))

/***/ }),
/* 44 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.util.uploadImageMaxSize = {
  width: 400,
  height: 400
};

fabric.util.uploadImageMinSize = {
  width: 100,
  height: 100
};

fabric.util.multiUpload = false;

fabric.util.readFile = function (file, callback) {

  var reader = new FileReader();
  reader.onload = function (e) {
    var result = e.target.result;
    var type = result.substr(11, result.indexOf(";") - 11);
    var img = new Image();
    img.type = type;
    img.name = file.name;
    img.onload = function () {

      if (!fabric.util.multiUpload) {
        if (fabric.util.uploadPreprocessor) {
          fabric.util.uploadPreprocessor([this], function (val) {
            callback(val);
          }, options);
        } else {
          callback(this);
        }
      } else {
        callback();
      }
    };
    img.src = result;
  };
  reader.readAsDataURL(file);
};

fabric.util.createUploadInput = function (options, complete, progress) {

  var input = document.createElement("input");
  input.setAttribute("type", "file");
  input.setAttribute("multiple", true);
  input.className = "hidden";

  $(input).change(function () {

    if (input.files && input.files.length) {

      var _loader = fabric.util.queueLoad(input.files.length, function (loaded) {

        if (fabric.util.multiUpload) {
          if (fabric.util.uploadPreprocessor) {
            fabric.util.uploadPreprocessor(loaded, function (val) {
              complete(val, options);
            }, options);
          } else {
            complete(loaded, options);
          }
        } else {
          complete(loaded[0], options);
        }
      }, function (total, current, image) {
        if (fabric.util.multiUpload) {
          if (progress) {
            progress(total, current, image);
          }
        }
      });

      for (var i = 0; i < input.files.length; i++) {
        fabric.util.readFile(input.files[i], _loader);
      }
    }
  });

  fabric.util.uploadInput = input;
};

//fabric.util.resizeImage(img, callback);
fabric.util.uploadPreprocessor = null;

fabric.util.uploadImage = function (cb, progress, options) {
  fabric.util.createUploadInput(options, cb, progress);
  $(fabric.util.uploadInput).trigger('click');
};

fabric.util.resizeUploadedImage = function (img, callback) {

  if (img.type === "svg+xml") {
    callback(img);
    return;
  }
  //Here we can put a restriction to upload a minim sized logo
  if (img.width < fabric.util.uploadImageMinSize.width || img.height < fabric.util.uploadImageMinSize.height) {
    alert("Logo is too small. MInimum size is " + fabric.util.uploadImageMinSize.width + "x" + fabric.util.uploadImageMinSize.height);
    callback(false);
    return;
  }

  if (img.width > fabric.util.uploadImageMaxSize.width || img.height > fabric.util.uploadImageMaxSize.height) {

    var size = fabric.util.getProportions(img, fabric.util.uploadImageMaxSize, "fit");

    var filter = new fabric.Image.filters.ResizeDP();

    var canvas = fabric.util.createCanvasElementWithSize(img);
    var ctx = canvas.getContext("2d");
    ctx.drawImage(img, 0, 0);
    filter.applyTo(canvas, size.width, size.height);
    callback(canvas);
  } else {
    callback(img);
  }
};

fabric.util.object.extend(fabric.Canvas.prototype, {
  uploadClass: 'Image',
  uploadImageTool: false,
  createImageObject: function createImageObject(img, objectType) {
    if (!img) return;
    this.createObject({
      position: "center",
      active: true,
      type: this.uploadClass,
      image: img,
      clipTo: this.activeArea,
      movementLimits: this.activeArea
    });
  },
  actions: fabric.util.object.extend(fabric.SlideCanvas.prototype.actions, {
    uploadImage: {
      className: 'fa fa-upload',
      key: 'U',
      title: 'upload image',
      action: function action() {
        fabric.util.uploadImage(function (img) {
          this.createImageObject(img, this.uploadClass);
        }.bind(this));
      }
    }
  })
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 45 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.util.object.extend(fabric.Application.prototype, {
  // loaderTemplate: "<span class='fa fa-pulse fa-spinner canvas-load-spinner'></span>",
  loaderIcon: 'data:image/svg+xml;base64,' + __webpack_require__(46),
  loaderContainer: null,
  _showMainLoaderIndicator: function _showMainLoaderIndicator() {
    this.loaderEl.show();
    this.loaderContainer.addClass("processing");
  },
  _hideMainLoaderIndicator: function _hideMainLoaderIndicator() {
    this.loaderEl.hide();
    this.loaderContainer.removeClass("processing");
  },
  setLoaderTemplate: function setLoaderTemplate(val) {
    if (this.virtual) return false;
    this.loaderTemplate = val.replace("{loaderIcon}", this.loaderIcon);
    if (val) {
      this.loaderContainer = $(this.loaderContainer);
      this.loaderEl = $(this.loaderTemplate).hide();
      this.loaderContainer.append(this.loaderEl);
      // this.on("loading:begin", this._showMainLoaderIndicator);
      // this.on("loading:end", this._hideMainLoaderIndicator);


      this.on("project:changed", function () {
        this.project.on("slide:change:begin", this._showMainLoaderIndicator.bind(this));
        this.project.on("slide:changed", this._hideMainLoaderIndicator.bind(this));
      });
    }
  }
});

// fabric.util.object.extend(fabric.SlideCanvas.prototype, {
//   // loaderTemplate: "<span class='fa fa-pulse fa-spinner canvas-load-spinner'></span>",
//   setLoaderTemplate: function (val) {
//     if(this.virtual) return false;
//     this.loaderTemplate = val;
//     if(val) {
//       this.loaderEl = $(this.loaderTemplate).hide();
//       $(this.wrapperEl).append(this.loaderEl);
//       this.on("loading:begin", function () {
//         this.loaderEl.show();
//         $(this.wrapperEl).addClass("processing");
//       });
//       this.on("loading:end", function () {
//         this.loaderEl.hide();
//         $(this.wrapperEl).removeClass("processing");
//       });
//     }
//   }
// });
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 46 */
/***/ (function(module, exports) {

module.exports = "PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48c3ZnIHdpZHRoPScxODhweCcgaGVpZ2h0PScxODhweCcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2aWV3Qm94PSIwIDAgMTAwIDEwMCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pZFlNaWQiIGNsYXNzPSJ1aWwtc3BpbiI+PHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjEwMCIgaGVpZ2h0PSIxMDAiIGZpbGw9Im5vbmUiIGNsYXNzPSJiayI+PC9yZWN0PjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDUwIDUwKSI+PGcgdHJhbnNmb3JtPSJyb3RhdGUoMCkgdHJhbnNsYXRlKDM0IDApIj48Y2lyY2xlIGN4PSIwIiBjeT0iMCIgcj0iOCIgZmlsbD0iI2NmZmZkZiI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0ib3BhY2l0eSIgZnJvbT0iMSIgdG89IjAuMSIgYmVnaW49IjBzIiBkdXI9IjFzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSI+PC9hbmltYXRlPjxhbmltYXRlVHJhbnNmb3JtIGF0dHJpYnV0ZU5hbWU9InRyYW5zZm9ybSIgdHlwZT0ic2NhbGUiIGZyb209IjEuNSIgdG89IjEiIGJlZ2luPSIwcyIgZHVyPSIxcyIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiPjwvYW5pbWF0ZVRyYW5zZm9ybT48L2NpcmNsZT48L2c+PGcgdHJhbnNmb3JtPSJyb3RhdGUoNDUpIHRyYW5zbGF0ZSgzNCAwKSI+PGNpcmNsZSBjeD0iMCIgY3k9IjAiIHI9IjgiIGZpbGw9IiNjZmZmZGYiPjxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9Im9wYWNpdHkiIGZyb209IjEiIHRvPSIwLjEiIGJlZ2luPSIwLjEycyIgZHVyPSIxcyIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiPjwvYW5pbWF0ZT48YW5pbWF0ZVRyYW5zZm9ybSBhdHRyaWJ1dGVOYW1lPSJ0cmFuc2Zvcm0iIHR5cGU9InNjYWxlIiBmcm9tPSIxLjUiIHRvPSIxIiBiZWdpbj0iMC4xMnMiIGR1cj0iMXMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIj48L2FuaW1hdGVUcmFuc2Zvcm0+PC9jaXJjbGU+PC9nPjxnIHRyYW5zZm9ybT0icm90YXRlKDkwKSB0cmFuc2xhdGUoMzQgMCkiPjxjaXJjbGUgY3g9IjAiIGN5PSIwIiByPSI4IiBmaWxsPSIjY2ZmZmRmIj48YW5pbWF0ZSBhdHRyaWJ1dGVOYW1lPSJvcGFjaXR5IiBmcm9tPSIxIiB0bz0iMC4xIiBiZWdpbj0iMC4yNXMiIGR1cj0iMXMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIj48L2FuaW1hdGU+PGFuaW1hdGVUcmFuc2Zvcm0gYXR0cmlidXRlTmFtZT0idHJhbnNmb3JtIiB0eXBlPSJzY2FsZSIgZnJvbT0iMS41IiB0bz0iMSIgYmVnaW49IjAuMjVzIiBkdXI9IjFzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSI+PC9hbmltYXRlVHJhbnNmb3JtPjwvY2lyY2xlPjwvZz48ZyB0cmFuc2Zvcm09InJvdGF0ZSgxMzUpIHRyYW5zbGF0ZSgzNCAwKSI+PGNpcmNsZSBjeD0iMCIgY3k9IjAiIHI9IjgiIGZpbGw9IiNjZmZmZGYiPjxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9Im9wYWNpdHkiIGZyb209IjEiIHRvPSIwLjEiIGJlZ2luPSIwLjM3cyIgZHVyPSIxcyIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiPjwvYW5pbWF0ZT48YW5pbWF0ZVRyYW5zZm9ybSBhdHRyaWJ1dGVOYW1lPSJ0cmFuc2Zvcm0iIHR5cGU9InNjYWxlIiBmcm9tPSIxLjUiIHRvPSIxIiBiZWdpbj0iMC4zN3MiIGR1cj0iMXMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIj48L2FuaW1hdGVUcmFuc2Zvcm0+PC9jaXJjbGU+PC9nPjxnIHRyYW5zZm9ybT0icm90YXRlKDE4MCkgdHJhbnNsYXRlKDM0IDApIj48Y2lyY2xlIGN4PSIwIiBjeT0iMCIgcj0iOCIgZmlsbD0iI2NmZmZkZiI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0ib3BhY2l0eSIgZnJvbT0iMSIgdG89IjAuMSIgYmVnaW49IjAuNXMiIGR1cj0iMXMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIj48L2FuaW1hdGU+PGFuaW1hdGVUcmFuc2Zvcm0gYXR0cmlidXRlTmFtZT0idHJhbnNmb3JtIiB0eXBlPSJzY2FsZSIgZnJvbT0iMS41IiB0bz0iMSIgYmVnaW49IjAuNXMiIGR1cj0iMXMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIj48L2FuaW1hdGVUcmFuc2Zvcm0+PC9jaXJjbGU+PC9nPjxnIHRyYW5zZm9ybT0icm90YXRlKDIyNSkgdHJhbnNsYXRlKDM0IDApIj48Y2lyY2xlIGN4PSIwIiBjeT0iMCIgcj0iOCIgZmlsbD0iI2NmZmZkZiI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0ib3BhY2l0eSIgZnJvbT0iMSIgdG89IjAuMSIgYmVnaW49IjAuNjJzIiBkdXI9IjFzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSI+PC9hbmltYXRlPjxhbmltYXRlVHJhbnNmb3JtIGF0dHJpYnV0ZU5hbWU9InRyYW5zZm9ybSIgdHlwZT0ic2NhbGUiIGZyb209IjEuNSIgdG89IjEiIGJlZ2luPSIwLjYycyIgZHVyPSIxcyIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiPjwvYW5pbWF0ZVRyYW5zZm9ybT48L2NpcmNsZT48L2c+PGcgdHJhbnNmb3JtPSJyb3RhdGUoMjcwKSB0cmFuc2xhdGUoMzQgMCkiPjxjaXJjbGUgY3g9IjAiIGN5PSIwIiByPSI4IiBmaWxsPSIjY2ZmZmRmIj48YW5pbWF0ZSBhdHRyaWJ1dGVOYW1lPSJvcGFjaXR5IiBmcm9tPSIxIiB0bz0iMC4xIiBiZWdpbj0iMC43NXMiIGR1cj0iMXMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIj48L2FuaW1hdGU+PGFuaW1hdGVUcmFuc2Zvcm0gYXR0cmlidXRlTmFtZT0idHJhbnNmb3JtIiB0eXBlPSJzY2FsZSIgZnJvbT0iMS41IiB0bz0iMSIgYmVnaW49IjAuNzVzIiBkdXI9IjFzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSI+PC9hbmltYXRlVHJhbnNmb3JtPjwvY2lyY2xlPjwvZz48ZyB0cmFuc2Zvcm09InJvdGF0ZSgzMTUpIHRyYW5zbGF0ZSgzNCAwKSI+PGNpcmNsZSBjeD0iMCIgY3k9IjAiIHI9IjgiIGZpbGw9IiNjZmZmZGYiPjxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9Im9wYWNpdHkiIGZyb209IjEiIHRvPSIwLjEiIGJlZ2luPSIwLjg3cyIgZHVyPSIxcyIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiPjwvYW5pbWF0ZT48YW5pbWF0ZVRyYW5zZm9ybSBhdHRyaWJ1dGVOYW1lPSJ0cmFuc2Zvcm0iIHR5cGU9InNjYWxlIiBmcm9tPSIxLjUiIHRvPSIxIiBiZWdpbj0iMC44N3MiIGR1cj0iMXMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIj48L2FuaW1hdGVUcmFuc2Zvcm0+PC9jaXJjbGU+PC9nPjwvZz48L3N2Zz4="

/***/ }),
/* 47 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.util.object.extend(fabric.SlideCanvas.prototype, {
  setDroppable: function setDroppable(val) {
    this.droppable = val;
    if (this.droppable) {
      this.initDragAndDrop();
    }
  },
  droppable: false, //{}
  isDropAvailable: function isDropAvailable(droppable, data) {

    for (var i in droppable) {
      if (droppable[i].constructor == Array) {
        if (droppable[i].indexOf(data[i]) == -1) return false;
      } else {
        if (droppable[i] == "*") continue;
        if (droppable[i] != data[i]) return false;
      }
    }
    return true;
    //return (this.supportedTypes == "*" || this.supportedTypes.indexOf(type)!= -1)
  },
  drop: function drop(data) {
    this.setData(data);
  },
  initDragAndDrop: function initDragAndDrop() {
    this.on("mouse:drop", function (e) {
      var _x = e.x - e.offsetX;
      var _y = e.y - e.offsetY;
      var _w = e.data.width || e.width;
      var _h = e.data.height || e.height;

      if (e.data.scaleX) {
        var _scaleX = e.data.scaleX / this.viewportTransform[0];
      } else {
        _scaleX = 1;
        _w /= this.viewportTransform[0];
      }

      if (e.data.scaleY) {
        var _scaleY = e.data.scaleY / this.viewportTransform[3];
      } else {
        _scaleY = 1;
        _h /= this.viewportTransform[3];
      }

      var _stroke = e.data.strokeWidth || 0;
      if (e.data.left) {
        _x += (e.data.left + _stroke) / this.viewportTransform[0];
      }
      if (e.data.top) {
        _y += (e.data.top + _stroke) / this.viewportTransform[3];
      }

      e.data = fabric.util.object.extend({}, e.data, {
        scaleX: _scaleX,
        scaleY: _scaleY,
        left: _x,
        top: _y,
        width: _w,
        height: _h,
        originalWidth: e.data.width,
        originalHeight: e.data.height
      });

      this.fire("before:drop", e);

      e.target = this.findTarget(e.originalEvent);
      if (e.target && !this.isDrawingMode) {
        // To unify the behavior, the object's double click event does not fire on drawing mode.
        e.target.fire('object:drop', e);
      }

      if (e.target && e.target.droppable) {
        if (this.isDropAvailable(e.target.droppable, e.data)) {
          e.target.deactivate();
          e.target.drop(e.data);
        }
      } else {
        if (this.droppable && this.isDropAvailable(this.droppable, e.data)) {
          this.drop(e.data);
        }
      }
    });
    this.on("mouse:dragenter", function (e) {
      if (e.target && e.target.droppable) {
        if (this.isDropAvailable(e.target.droppable, e.data)) {
          e.target.activate();
          e.e.helper.css("cursor", "alias");
          this.setCursor("alias");
        } else {
          e.e.helper.css("cursor", "not-allowed");
          this.setCursor("not-allowed");
        }
      }
    });
    this.on("mouse:dragleave", function (e) {
      if (e.target && e.target.droppable) {
        if (this.isDropAvailable(e.target.droppable, e.data)) {
          this._activated = false;
          e.target.deactivate();
        }
        e.e.helper.css("cursor", "pointer");
      }
    });
  }
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 48 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.Guidline = fabric.util.createClass(fabric.Object, {
  top: 0,
  left: 0,
  height: 1,
  width: 1,
  griddable: false,
  responsiveBorders: true,
  groupSelectable: false,
  hasControls: false,
  hasBorders: false,
  wholeCoordinates: true,
  stored: false,
  movementLimits: "#__0",
  initialize: function initialize(options) {
    this.x = Math.round(options.x);
    this.y = Math.round(options.y);

    if (this.x) {
      this.lockMovementY = true;
      this.hoverCursor = "ew-resize";
    }

    if (this.y) {
      this.lockMovementX = true;
      this.hoverCursor = "ns-resize";
    }

    this.on({
      "removed": function removed() {
        var i = this.canvas.guidlines.indexOf(this);
        this.canvas.guidlines.splice(i, 1);
      },
      "modified": function modified() {
        if (this.x) {
          this.x = this.left + this.width / 2;
        }
        if (this.y) {
          this.y = this.top + this.height / 2;
        }
      },
      "dblclick": function dblclick() {
        this.remove();
      },
      "added": function added() {
        if (this.x) {
          this.height = this.canvas.height;
          this.width = Math.ceil(10 / this.canvas.viewportTransform[0]);
          if (this.width % 2) {
            this.width++;
          }
          this.left = this.x - this.width / 2;
        }
        if (this.y) {
          this.width = this.canvas.width;
          this.height = Math.ceil(10 / this.canvas.viewportTransform[0]);
          if (this.height % 2) {
            this.height++;
          }
          this.top = this.y - this.height / 2;
        }
        this.setCoords();
        if (this.canvas.guidlines) {
          this.canvas.guidlines.push(this);
        } else {
          this.visible = false;
        }
      }
    });
  },
  render: function render(ctx) {
    ctx.save();

    ctx.beginPath();
    ctx.strokeStyle = "#000000";
    if (this.x) {
      ctx.translate(this.left + this.width / 2, 0);
      ctx.scale(1 / this.canvas.getZoom(), 1 / this.canvas.getZoom());
      ctx.moveTo(0, 0);
      ctx.lineTo(0, this.canvas.height);
    }
    if (this.y) {
      ctx.translate(0, this.top + this.height / 2);
      ctx.scale(1 / this.canvas.getZoom(), 1 / this.canvas.getZoom());
      ctx.moveTo(0, 0);
      ctx.lineTo(this.canvas.width, 0);
    }
    ctx.stroke();
    ctx.restore();
  }
});

fabric.Ruler = fabric.util.createClass({
  initialize: function initialize(options) {

    this.canvas = options.canvas;
    this.type = options.type;
    if (options.size) this.size = options.size;
    var size;
    if (options.type == "vertical") {
      size = {
        width: this.size,
        height: this.canvas.height
      };
    } else {
      size = {
        width: this.canvas.width,
        height: this.size
      };
    }

    this.canvasElement = fabric.util.createCanvasElementWithSize(size);
    this.canvas.wrapperEl.appendChild(this.canvasElement);
    this.rulerContext = this.canvasElement.getContext('2d');
    // this.rulerContext.translate(-0.5,-0.5);
    window.rulerContext = this.rulerContext;
    this.rulerContext.imageSmoothingEnabled = false;
    this.render();
    var _this = this;
    this.canvas.on({
      'viewport:scaled changed modified': function viewportScaledChangedModified() {
        _this.render();
      }
    });
  },
  size: 30,
  orientation: "revert",
  font: "10px Open Sans",
  delimeters: [50, 10, 5, 1],
  render: function render() {

    var v = this.type == "vertical";
    var scale = this.canvas.getZoom();
    var _ctx = this.rulerContext;

    _ctx.mozImageSmoothingEnabled = false;

    _ctx.clearRect(0, 0, this.canvasElement.width, this.canvasElement.height);
    if (v) {
      this.canvasElement.height = this.canvas.height;
      _ctx.textAlign = 'end';
    } else {
      this.canvasElement.width = this.canvas.width;
    }

    var _this = this;
    function push(h) {
      var _x = Math.round(l * scale);
      if (false) {
        var x1 = 0;
        var x2 = h;
      } else {
        var x1 = _this.size;
        var x2 = _this.size - h;
      }
      if (v) {
        _ctx.moveTo(x1, _x);
        _ctx.lineTo(x2, _x);
      } else {
        _ctx.moveTo(_x, x1);
        _ctx.lineTo(_x, x2);
      }
      _ctx.stroke();
    }
    var w = (v ? this.canvas.height : this.canvas.width) / scale;
    var _del = [],
        _labels = [];
    var i = 0,
        j = 0,
        k = 0,
        l = 0,
        d = this.delimeters,
        m;

    for (i = 0; i < w / d[0]; i++) {
      k = 0;
      j = 0;
      l = i * d[0] + j * d[1] + k * d[2];
      if (l >= w) break;
      push(10);

      _ctx.font = this.font;
      if (v) {
        _ctx.strokeText(l, _this.size - 6, l * scale + 12);
      } else {
        _ctx.strokeText(l, l * scale + 2, _this.size - 8);
      }

      if (scale > 1) {

        for (j = 0; j < d[0] / d[1]; j++) {
          k = 0;
          l = i * d[0] + j * d[1] + k * d[2];
          if (l >= w) break;
          push(7);

          if (scale > 2) {
            for (k = 0; k < d[1] / d[2]; k++) {
              l = i * d[0] + j * d[1] + k * d[2];
              if (l >= w) break;
              push(4);
            }

            if (scale > 5) {

              for (m = 0; m < d[2] / d[3]; m++) {
                for (k = 0; k < d[1] / d[2]; k++) {
                  l = i * d[0] + j * d[1] + k * d[2] + m * d[3];
                  if (l >= w) break;
                  push(2);
                }
              }
            }
          }
        }
      }
    }

    this._elements = _del;
    this._labels = _labels;
    _ctx.stroke();
  }
});

fabric.util.object.extend(fabric.StaticCanvas.prototype, {
  guidlinesEnabled: false,
  createGuidline: function createGuidline(data) {
    if (data.y !== undefined) {
      if (fabric.Guidline.prototype.wholeCoordinates) {
        data.y = data.y && Math.round(data.y);
      }
      if (!fabric.util.object.findWhere(this.guidlines, { y: data.y })) {
        var gl = new fabric.Guidline({ y: data.y });
        this.add(gl);
      }
    } else if (data.x !== undefined) {
      if (fabric.Guidline.prototype.wholeCoordinates) {
        data.x = data.x && Math.round(data.x);
      }
      if (!fabric.util.object.findWhere(this.guidlines, { x: data.x })) {
        var gl = new fabric.Guidline({ x: data.x });
        this.add(gl);
      }
    }
  },
  setGuidlines: function setGuidlines(guidlines) {
    this.guidlines = guidlines;
    if (guidlines && this.guidlinesEnabled) {
      // this.guidlines = [];
      for (var i in guidlines) {
        this.createGuidline(guidlines[i]);
      }
    }
  },
  setRulers: function setRulers(value) {
    if (!value) {
      return;
    }
    this.rulers = true;
    this.vRuler = new fabric.Ruler({
      canvas: this,
      type: "vertical"
    });
    this.hRuler = new fabric.Ruler({
      canvas: this,
      type: "horizontal"
    });

    this.hRuler.canvasElement.style.position = "absolute";
    this.hRuler.canvasElement.style.left = 0;
    this.hRuler.canvasElement.style.bottom = "100%";
    this.vRuler.canvasElement.style.position = "absolute";
    this.vRuler.canvasElement.style.top = 0;
    this.vRuler.canvasElement.style.right = "100%";

    this.guidlines = [];

    var _canvas = this;

    this.on('viewport:scaled', function () {

      this.guidlines.forEach(function (gl) {
        if (gl.x) {
          gl.width = Math.ceil(10 / gl.canvas.viewportTransform[0]);
          if (gl.width % 2) {
            gl.width++;
          }
          gl.left = gl.x - gl.width / 2;
        }
        if (gl.y) {
          gl.height = Math.ceil(10 / gl.canvas.viewportTransform[0]);
          if (gl.height % 2) {
            gl.height++;
          }
          gl.top = gl.y - gl.height / 2;
        }
      });
    });

    this.hRuler.canvasElement.onclick = function (e) {
      var pointer = _canvas.getPointer(e);
      _canvas.createGuidline({ x: pointer.x });
    };

    this.vRuler.canvasElement.onclick = function (e) {
      var pointer = _canvas.getPointer(e);

      _canvas.createGuidline({ y: pointer.y });
    };
  }
});

/*
fabric.SlideCanvas.addPlugin("savers",function(propertiesToInclude, _data){
  if(propertiesToInclude.indexOf('guidlines') !== -1 && this.guidlines) {
    _data.guidlines = [];
    this.guidlines.forEach(function(_gl){
      if(_gl.x){
        _data.guidlines.push({x : _gl.x })
      }
      if(_gl.y){
        _data.guidlines.push({y : _gl.y })
      }
    })
  }
});*/
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 49 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

//var _set_background_image_overwritten = fabric.Canvas.prototype.setBackgroundImage;

fabric.util.object.extend(fabric.StaticCanvas.prototype, {
  /**
   * backgroundPosition
   * @values manual | cover | fit
   */
  backgroundPosition: 'manual',
  setBackgroundPosition: function setBackgroundPosition(src) {
    this.backgroundPosition = src;
    this._update_background_image();
    return this;
  },
  offsets: {
    left: 0,
    right: 0,
    bottom: 0,
    top: 0
  },

  // setBackgroundImage: function (src, callback, options) {
  //
  //   _set_background_image_overwritten.call(this, src, function () {
  //     this._update_background_image();
  //     callback && callback(this.backgroundImage);
  //   }.bind(this), options);
  //   return this;
  // },
  fillBackgroundColorOverCanvas: false,
  _renderBackgroundOrOverlay: function _renderBackgroundOrOverlay(ctx, property) {
    var object = this[property + 'Color'];
    if (object) {
      ctx.fillStyle = object.toLive ? object.toLive(ctx) : object;

      if (!this.fillBackgroundColorOverCanvas) {
        //todo do!!!
        ctx.fillRect(object.offsetX || this.viewportTransform[4] * this.viewportTransform[0], object.offsetY || this.viewportTransform[5] * this.viewportTransform[0], this.width * this.viewportTransform[0], this.height * this.viewportTransform[0]);
      } else {
        ctx.fillRect(object.offsetX || 0, object.offsetY || 0, this.originalWidth, this.originalHeight);
      }
    }
    object = this[property + 'Image'];
    if (object && object.constructor !== String && object.constructor !== Object) {
      object.render(ctx);
    }
  },
  getImageData: function getImageData(options) {
    options = fabric.util.object.extend({
      clipped_area: false,
      clipped_area_only: false,
      draw_background: true,
      format: 'png',
      quality: 0.8
    }, options || {});

    var size;
    if (options.clipped_area) {
      size = options.clipped_area.getBoundingRect();
      var _zoom = this.getZoom();
      size.left /= _zoom;
      size.top /= _zoom;
      size.width /= _zoom;
      size.height /= _zoom;
      fabric.util.object.extend(options, size);
    } else {
      size = {
        width: options.width || this.originalWidth || this.width,
        height: options.height || this.originalHeight || this.height
      };

      if (options.clipped_area_only) {
        size.width -= this.offsets.left + this.offsets.right;
        size.height -= this.offsets.top + this.offsets.bottom;
      }
    }
    if (options.zoom) {
      size.width *= options.zoom;
      size.height *= options.zoom;
    }

    var canvas = fabric.util.createCanvasElement();
    canvas.width = size.width;
    canvas.height = size.height;

    options.left = Math.floor(options.left);
    options.top = Math.floor(options.top);
    options.height = Math.ceil(options.height);
    options.width = Math.ceil(options.width);

    this.renderThumb(canvas, options);

    var src = canvas.toDataURL(options);

    var blob = fabric.util.dataURItoBlob(src, 'image/' + options.format);
    var objectURL = URL.createObjectURL(blob);
    return {
      dataURL: src,
      blob: blob,
      url: objectURL,
      canvas: canvas
    };
  },
  getOriginalSize: function getOriginalSize() {
    return {
      width: this.originalWidth,
      height: this.originalHeight
    };
  },

  // setOffsets: function (_offsets) {
  //   this.offsets = _offsets || fabric.util.object.extend({}, fabric.SlideCanvas.prototype.offsets);
  //   //this._update_clip_rect();
  //   return this;
  // },
  getRect: function getRect(options) {
    var rect = {};

    var _w = this.originalWidth || this.width; //this.originalWidth
    var _flexArray = fabric.util.flex(_w, [{ value: options.left, flex: 0 }, { value: options.width, flex: 1 }, { value: options.right, flex: 0 }]);
    rect.left = _flexArray[0];
    rect.width = _flexArray[1];
    rect.right = _flexArray[2];

    var _h = this.originalHeight || this.height; //this.originalHeight
    var _flexArray = fabric.util.flex(_h, [{ value: options.top, flex: 0 }, { value: options.height, flex: 1 }, { value: options.bottom, flex: 0 }]);
    rect.top = _flexArray[0];
    rect.height = _flexArray[1];
    rect.bottom = _flexArray[2];

    return rect;
  }
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 50 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.util.createThumb = function (slide, $el) {

  var _canvas = slide.canvas,
      firstDraw = true,
      modified,
      _w = +$el.getAttribute("width"),
      _h = +$el.getAttribute("height");

  if (_h) {
    $el.style.height = $el.height;
  }

  function renderThumb() {
    if (_canvas.processing || !_canvas.loaded) {
      return false;
    }
    _canvas.renderThumb($el);
    modified = _canvas.modified;
  }

  function forceRenderThumb() {
    if (this.canvas) {
      if (this.canvas.loaded) {
        this.canvas.renderThumb($el);
      }
      return;
    }
    if (firstDraw && this.data.thumb) {
      var img = new Image();
      img.onload = function () {
        var ctx = $el.getContext("2d");
        ctx.clearRect(0, 0, $el.width, $el.height);
        ctx.drawImage(img, 0, 0, $el.width, $el.height);
        modified = this.modified;
      };
      img.src = this.data.thumb;
      return;
    }

    if (attrs.force !== "true") return;
    var canvas = new fabric.SlideCanvas(null, this.data, function () {
      canvas.renderThumb($el);
      //modified = slide.modified;
    });
  }

  function scaleThumb() {

    var _container = {
      width: _w,
      height: _h
    };

    var size = {
      width: slide.canvas.originalWidth || slide.canvas.width,
      height: slide.canvas.originalHeight || slide.canvas.height
    };

    var _fitSize = fabric.util.getProportions(size, _container, "fit");

    $el.width = _fitSize.width;
    $el.height = _fitSize.height;

    $el.style.width = _fitSize.width + 'px';
    $el.style.height = _fitSize.height + 'px';
    renderThumb();
  }

  function canvasChanged() {
    // _canvas && _canvas.off('after:render', renderThumb);
    // if (this.canvas) {
    // _canvas = scope.ffThumb.canvas;
    this.canvas.on('after:render', renderThumb);
    this.canvas.on("dimensions:modified", scaleThumb);
    this.canvas.on("loading:end", scaleThumb);
    // }
  }

  $el.setAttribute("title", slide.title);
  slide.on('canvas:changed', canvasChanged);
  slide.on('modified', forceRenderThumb);

  scaleThumb.call(slide);
  forceRenderThumb.call(slide);
  canvasChanged.call(slide);
};

fabric.util.object.extend(fabric.StaticCanvas.prototype, {
  renderThumb: function renderThumb(canvas, options) {
    options = options || {
      objects: true,
      clipped_area_only: false,
      draw_background: true
    };

    if (options.zoom) {
      var _zoom = options.zoom;
    } else {
      if (canvas.width) {
        var _zoom = canvas.width / (this.originalWidth || this.width);
      } else {
        var _zoom = 1;
      }
    }
    var _old_Scale = this.viewportTransform[0];
    var old_x = this.viewportTransform[4];
    var old_y = this.viewportTransform[5];
    this.viewportTransform[4] = this.viewportTransform[5] = 0;
    this.viewportTransform[0] = this.viewportTransform[3] = 1;

    this.viewportTransform[0] = this.viewportTransform[3] = _zoom;
    //this._update_clip_rect();

    if (this.clipRect) {
      this.clipRect.setOpacity(0);
    }

    var size = {
      width: this.originalWidth || this.width,
      height: this.originalHeight || this.height
    };
    size.width = Math.ceil(size.width * _zoom);
    size.height = Math.ceil(size.height * _zoom);

    var _canvas = fabric.util.createCanvasElement();
    _canvas.width = size.width;
    _canvas.height = size.height;

    var canvasToDrawOn = _canvas.getContext('2d'),
        objsToRender;

    this.clearContext(canvasToDrawOn);
    canvasToDrawOn.save();
    canvasToDrawOn.transform.apply(canvasToDrawOn, this.viewportTransform);

    if (options.draw_background) {
      this._renderBackground(canvasToDrawOn);
      //if (this._backgroundLayer) {
      //  this._renderObjects(canvasToDrawOn, this._backgroundLayer);
      //}
    }

    if (!options.clipped_area_only && this.clipTo) {
      fabric.util.clipContext(this, canvasToDrawOn);
    }

    var _objects;
    if (options.objects && options.objects.constructor === Array) {
      _objects = options.objects;
    } else {
      _objects = options.objects !== false ? this._objects : [];
    }
    if (options.clipped_area) {
      _objects = fabric.util.object.clone(_objects);
      for (var i = _objects.length; i--;) {
        if (_objects[i].clipTo !== options.clipped_area) {
          _objects.splice(i, 1);
        }
      }
    }
    // if (fabric.version >= 1.6) {
    this._renderObjects(canvasToDrawOn, _objects);
    // } else {
    //   for (var i = 0, length = _objects.length; i < length; ++i) {
    //     this._draw(canvasToDrawOn, _objects[i]);
    //   }
    // }


    canvasToDrawOn.restore();
    if (!options.clipped_area_only && this.clipTo) {
      canvasToDrawOn.restore();
    }
    this._renderOverlay(canvasToDrawOn);
    canvasToDrawOn.restore();
    if (this.clipRect) {
      this.clipRect.setOpacity(1);
    }
    var ctx = canvas.getContext('2d');
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    if (options.clipped_area_only && this.clipRect) {
      var _rect = {
        left: this.clipRect.left * _zoom,
        top: this.clipRect.top * _zoom,
        width: this.clipRect.width * _zoom,
        height: this.clipRect.height * _zoom
      };
    } else {
      var _rect = {
        left: options.left * _zoom || 0,
        top: options.top * _zoom || 0,
        width: options.width * _zoom || size.width,
        height: options.height * _zoom || size.height
      };
    }
    if (options.angle) {
      ctx.rotate(-options.angle * Math.PI / 180);
      ctx.drawImage(_canvas, 0, 0, _rect.width + _rect.left + _canvas.width, _rect.height + _rect.top + _canvas.height, -_rect.left, -_rect.top, canvas.width + _rect.left + _canvas.width, canvas.height + _rect.top + _canvas.height);
    } else {
      ctx.drawImage(_canvas, _rect.left, _rect.top, _rect.width, _rect.height, 0, 0, canvas.width, canvas.height);
    }

    this.viewportTransform[0] = this.viewportTransform[3] = _old_Scale;
    // this._update_background_image();
    //this._update_clip_rect();

    this.viewportTransform[4] = old_x;
    this.viewportTransform[5] = old_y;

    return canvas;
  }
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 51 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.util.object.extend(fabric.Canvas.prototype, {
  // enableClipAreaZooming: function(){
  //todo
  // this.on('viewport:scaled', function(){
  //   if (!this.layer("background").objects) return;
  //   this._backgroundLayer[0].setCoords();
  // });
  // },
  _fabric_clip_function: function _fabric_clip_function(ctx2) {

    var clipRect = this.clipRect;
    ctx2.save();
    clipRect.render(ctx2);
    ctx2.restore();
  }
});

fabric.Object.prototype.setClipTo = function (val) {
  if (typeof val !== 'string') {
    this.clipTo = val;
  }

  var functionBody = fabric.util.getFunctionBody(val);
  if (typeof functionBody !== 'undefined') {
    this.clipTo = new Function('ctx', functionBody);
  }
};

/**
 * @private
 * @param {Object} [options] Options object
 */
fabric.Object.prototype._initClipping = function (options) {
  if (!options.clipTo || typeof options.clipTo !== 'string') {
    return;
  }
  if (options.clipTo[0] == '#') {
    //  var _id = options.clipTo[0].substring(1);
    this.clipTo = options.clipTo;
    return;
  }

  var functionBody = fabric.util.getFunctionBody(options.clipTo);
  if (typeof functionBody !== 'undefined') {
    this.clipTo = new Function('ctx', functionBody);
  }
};
fabric.Object.prototype.getClipTo = function () {
  return "#" + this.clipTo.id;
};

fabric.util.clipContext = function (receiver, ctx) {

  if (receiver.clipTo.constructor === String) {
    if (receiver.clipTo === "canvas") {
      receiver.clipTo = receiver.canvas;
    } else {

      var _id = receiver.clipTo.substring(1);

      var _clipCtx = receiver.canvas.getObjectByID(_id);
      if (_clipCtx) {
        receiver.clipTo = _clipCtx;
      } else {
        console.warn("error: clipTo not found" + receiver.clipTo);
        delete receiver.clipTo;
        return;
      }
    }
  }

  ctx.save();
  ctx.beginPath();

  if (receiver.clipTo.constructor === Function) {
    receiver.clipTo(ctx);
  } else {
    fabric.util._clipToObject(receiver, ctx);
    ctx.clip();
  }
};

fabric.util._clipToObject = function (receiver, ctx) {
  ctx.save();
  ctx.beginPath();

  var fromLeft = false;
  var center = fromLeft ? receiver._getLeftTopCoords() : receiver.getCenterPoint();
  ctx.transform(1, Math.tan(fabric.util.degreesToRadians(-receiver.skewY)), 0, 1, 0, 0);
  ctx.transform(1, 0, Math.tan(fabric.util.degreesToRadians(-receiver.skewX)), 1, 0, 0);
  ctx.scale(1 / receiver.scaleX * (receiver.flipX ? -1 : 1), 1 / receiver.scaleY * (receiver.flipY ? -1 : 1));
  ctx.rotate(fabric.util.degreesToRadians(-receiver.angle));
  ctx.translate(-center.x, -center.y);

  if (receiver.clipTo.points) {
    var ps = receiver.clipTo.points;
    ctx.moveTo(ps[0].x, ps[0].y);
    for (var j = 1; j < ps.length; j++) {
      ctx.lineTo(ps[j].x, ps[j].y);
    }
    //ctx.stroke();
  } else if (receiver.clipTo.type == "path") {

    ctx.globalAlpha = 0;
    receiver.clipTo.transform(ctx);
    receiver.clipTo._render(ctx);
  } else if (receiver.clipTo.type == "slide-canvas") {
    ctx.rect(0, 0, receiver.clipTo.width, receiver.clipTo.height);
  } else {
    ctx.translate(receiver.clipTo.left, receiver.clipTo.top);
    ctx.rotate(-(receiver.clipTo.angle * -1) * Math.PI / 180);
    ctx.rect(0, 0, receiver.clipTo.width, receiver.clipTo.height);
  }

  ctx.closePath();
  ctx.restore();
};
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 52 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

__webpack_require__(8);
__webpack_require__(53);

// todo это убрать
//fabric.movementsLimitsEasy = false;
var _toObject_overwritten = fabric.Object.prototype.toObject;
//todo use event "before:object";

fabric.Object.prototype.toObject = function (propertiesToInclude) {
  var obj = _toObject_overwritten.call(this, propertiesToInclude);
  var _storeAll = this.storeProperties.indexOf("*") != -1;
  if (this.clipTo && this.clipTo.id && (_storeAll || this.storeProperties.indexOf("clipTo") != -1)) {
    obj.clipTo = '#' + this.clipTo.id;
  }
  if (this.movementLimits && (_storeAll || this.storeProperties.indexOf("movementLimits") != -1)) {
    obj.movementLimits = this.movementLimits.id ? '#' + this.movementLimits.id : this.movementLimits;
  }
  return obj;
};

var _scaleObject_overwritten = fabric.Canvas.prototype._scaleObject;

fabric.util.object.extend(fabric.Object.prototype, {
  setWholeCoordinates: function setWholeCoordinates(val) {
    this.wholeCoordinates = val;
    this.on("added modified", function () {
      if (this.wholeCoordinates) {
        this.set({
          left: Math.round(this.left),
          top: Math.round(this.top),
          width: Math.round(this.width),
          height: Math.round(this.height)
        });
      }
    }, true);
  },
  // setTop: function(val){
  //   if(this.wholeCoordinates){
  //     val = Math.round(val);
  //   }
  //   this.top = val;
  // },
  // setLeft: function(val){
  //   if(this.wholeCoordinates){
  //     val = Math.round(val);
  //   }
  //   this.left = val;
  // },
  // setWidth: function(w){
  //   if(this.wholeCoordinates){
  //     w = Math.round(w);
  //   }
  //   this.width = w;
  // },
  // setHeight: function(h){
  //   if(this.wholeCoordinates){
  //     h = Math.round(h);
  //   }
  //   this.height = h;
  // },
  // specialProperties: fabric.Object.prototype.specialProperties.concat(["movementLimits"]),

  setActive: function setActive(value) {
    if (!this.canvas) {
      this.on("added", function () {
        this.canvas.setActiveObject(this);
      });
    }

    this.active = value;
  },
  setPosition: function setPosition(_position) {
    if (_position === "center") {
      this.on("added", function () {
        this.canvas.fitObject(this);
      });
    }
  },

  setMovementLimits: function setMovementLimits(val) {

    if (!this.movementLimits) {
      this.on({
        added: function added() {
          if (this.canvas.interactive) {
            this.canvas._check_object_position(this);
          }
        },
        rotated: function rotated(event) {
          var target = this;

          if (target.resizable) {
            if (pos.left !== undefined) {
              if (target.left < pos.left) {
                target.width += target.left - pos.left;
                target.left = pos.left;
              } else {
                target.width -= target.left - pos.left;
              }
            }
            if (pos.top !== undefined) {
              if (target.top < pos.top) {
                target.height += target.top - pos.top;
                target.top = pos.top;
              } else {
                target.height -= target.top - pos.top;
              }
            }
          }
          this.canvas._check_object_position(this);
        },
        modified: function modified(event) {
          this.canvas._check_object_after_modified(this);
        }
      });
    }
    this.movementLimits = val;

    /* if(this.canvas){
       this._setMovementLimitsString();
     }*/
  }
});

fabric.util.object.extend(fabric.StaticCanvas.prototype, {
  fitObject: function fitObject(el) {
    var _rect,
        maxSize,
        o = this.offsets;

    if (!el.movementLimits || el.movementLimits == "canvas") {
      var _zoom = this.getZoom();
      var _w = this.originalWidth || this.width / _zoom;
      var _h = this.originalHeight || this.height / _zoom;
      _rect = {
        width: o ? _w - o.left - o.right : _w,
        height: o ? _h - o.top - o.bottom : _h
      };
      /* offsets = {
       left: o && o.top ||0 ,
       top:  o &&  o.left ||0
       }*/
    } else if (el.movementLimits.constructor !== Function) {
      var lim = el.movementLimits;
      _rect = {
        left: lim.left * lim.scaleX,
        width: lim.width * lim.scaleX,
        top: lim.top * lim.scaleY,
        height: lim.height * lim.scaleY
      };
      //maxSize = _rect;
      // offsets = lim;
    }
    maxSize = {
      width: _rect.width * this.fitIndex,
      height: _rect.height * this.fitIndex
    };
    var size = fabric.util.getProportions(el, maxSize, 'fit');

    if (el.resizable) {
      el.setOptions({
        width: el.width * size.scale,
        height: el.height * size.scale
      });
      el.updateElement();
    } else {
      el.setOptions({
        scaleX: size.scale,
        scaleY: size.scale
      });
    }
    this.centerObject(el);
    el.setCoords();
  },
  //fix getcenter function
  centerObject: function centerObject(object) {
    var center;
    if (object.movementLimits) {

      center = this._getMovementsLimitsCenter(object.movementLimits);
    } else {
      center = this.getCenter();
    }
    this._centerObject(object, new fabric.Point(center.left, center.top));
    this.renderAll();
    return this;
  },
  getCenter: function getCenter() {
    return {
      top: this.originalHeight / 2 / this.getZoom(),
      left: this.originalWidth / 2 / this.getZoom()
    };
  },

  movementLimits: {
    left: false,
    top: false,
    right: false,
    bottom: false
  },
  setMovementLimits: function setMovementLimits(_offsets) {
    this.movementLimits = _offsets;

    return this;
  },
  //content хотя бы  пиксель объекта должен быть внутри зоны
  //fit зона должно полностью находится внутри объекта
  movementLimitMode: "fit",
  _getMovementsLimitsCenter: function _getMovementsLimitsCenter(movementLimits) {

    var o = this.offsets;
    if (movementLimits === 'canvas') {
      var _w = this.originalWidth || this.width;
      var _h = this.originalHeight || this.height;
      return { top: o.top + (_h - o.top - o.bottom) / 2, left: o.left + (_w - o.left - o.right) / 2 };
    } else {
      var obj = this.getObjectByID(movementLimits.substr(1));
      var _xy = obj.getCenterPoint();
      return { top: _xy.y, left: _xy.x };
    }
  },
  _getMovementsLimitsRect: function _getMovementsLimitsRect(movementLimits) {

    var o = this.offsets;
    var _w = this.originalWidth || this.width;
    var _h = this.originalHeight || this.height;

    if (movementLimits.constructor !== String) {
      return movementLimits;
    }

    var scale = this.viewportTransform[0];

    if (movementLimits === 'canvas') {

      var rect = {
        left: o.left,
        top: o.top,
        width: _w - o.left - o.right,
        height: _h - o.top - o.bottom,
        right: o.right,
        bottom: o.bottom
      };

      rect.width *= scale;
      rect.height *= scale;
      return rect;
    } else {
      var obj = this.getObjectByID(movementLimits.substr(1));
      var _stroke_width = obj.strokeWidth;
      obj.strokeWidth = 0;

      obj.setCoords();
      var rect = obj.getBoundingRect();

      obj.strokeWidth = _stroke_width;

      rect.left /= scale;
      rect.top /= scale;
      rect.width /= scale;
      rect.height /= scale;
      rect.left -= this.viewportTransform[4] / scale;
      rect.top -= this.viewportTransform[5] / scale;

      //rect.left   += sw /2;
      //rect.top    += sw /2;
      //rect.width  -= sw;
      //rect.height -= sw;

      rect.right = _w - (rect.left + rect.width);
      rect.bottom = _h - (rect.top + rect.height);

      return rect;
    }
  },
  contentOffsets: 5,
  getFixedPosition: function getFixedPosition(target, x, y) {

    var _w = this.originalWidth || this.width;
    var _h = this.originalHeight || this.height;

    if (x === undefined) {
      x = target.left;
    }
    if (y === undefined) {
      y = target.top;
    }
    var scale = this.viewportTransform[0];
    target.setCoords();
    var bounds = target.getBoundingRect();
    bounds.left /= scale;
    bounds.top /= scale;
    bounds.width /= scale;
    bounds.height /= scale;

    bounds.left -= this.viewportTransform[4] / scale;
    bounds.top -= this.viewportTransform[5] / scale;
    bounds.right = _w - (bounds.left + bounds.width);
    bounds.bottom = _h - (bounds.top + bounds.height);

    var limits = this._getMovementsLimitsRect(target.movementLimits || this.movementLimits);
    // var limits = rect || this.movementLimits;

    var newPos = {};
    var _l = limits.left,
        _r = limits.right;
    var _t = limits.top,
        _b = limits.bottom;

    if (target.movementLimitMode === "content") {
      _l -= bounds.width - this.contentOffsets;
      _r -= bounds.width - this.contentOffsets;
      _t -= bounds.height - this.contentOffsets;
      _b -= bounds.height - this.contentOffsets;
    }

    if (target.movementLimitMode === "fit" && !target.resizable) {
      if (_l !== false && _r !== false) {
        var _w = _w - _l - _r;
        if (bounds.width > _w) {
          var _asp = _w / bounds.width;
          newPos.scaleX = _asp;
          newPos.scaleY = _asp;
        }
      }

      if (_t !== false && _b !== false) {
        var _h = _h - _t - _b;
        if (bounds.height > _h) {
          var _asp = _h / bounds.height;
          target.scaleX *= _asp;
          target.scaleY *= _asp;
        }
      }
    }

    if (target.movementLimitMode === "fit" || target.movementLimitMode === "content") {

      if (_l !== false) {
        var _diff = _l - bounds.left;
        if (_diff > 0) {
          newPos.left = x + _diff;
        }
      }

      if (!newPos.left && _r !== false) {
        var _diff = _r - bounds.right;
        if (_diff > 0) {
          newPos.left = x - _diff;
        }
      }

      if (_t !== false) {
        var _diff = _t - bounds.top;
        if (_diff > 0) {
          newPos.top = y + _diff;
        }
      }

      if (!newPos.top && _b !== false) {
        var _diff = _b - bounds.bottom;
        if (_diff > 0) {
          newPos.top = y - _diff;
        }
      }
    }

    return newPos;
  },

  // _restoreOriginXYNative: _restoreOriginXYNative,
  // _restoreOriginXY: function (target) {
  //   this._restoreOriginXYNative(target);
  //
  //   // if (target.wholeCoordinates) {
  //   //   target.left = Math.round(target.left);
  //   //   target.top = Math.round(target.top);
  //   // }
  // },

  /**
   * Sets the position of the object taking into consideration the object's origin
   * @param {fabric.Point} pos The new position of the object
   * @param {String} originX Horizontal origin: 'left', 'center' or 'right'
   * @param {String} originY Vertical origin: 'top', 'center' or 'bottom'
   * @return {void}
   */
  setPositionByOrigin: function setPositionByOrigin(pos, originX, originY) {
    var center = this.translateToCenterPoint(pos, originX, originY),
        position = this.translateToOriginPoint(center, this.originX, this.originY);

    // if (this.wholeCoordinates) {
    //   position.x = Math.round(position.x);
    //   position.y = Math.round(position.y);
    // }
    this.set('left', position.x);
    this.set('top', position.y);
  }
});

var _translateObject_overwritten = fabric.Canvas.prototype._translateObject;
var _beforeScaleTransform_overwritten = fabric.Canvas.prototype._beforeScaleTransform;
var _beforeTransform_overwritten = fabric.Canvas.prototype._beforeTransform;
var _restoreOriginXYNative = fabric.Canvas.prototype._restoreOriginXY;
fabric.util.object.extend(fabric.SlideCanvas.prototype, {
  _beforeScaleTransform_overwritten: _beforeScaleTransform_overwritten,
  _beforeScaleTransform: function _beforeScaleTransform(e, transform) {
    this._beforeScaleTransform_overwritten(e, transform);
    if (!this._currentTransform.original.oCoords) {
      this._currentTransform.original.oCoords = fabric.util.object.cloneDeep(this._currentTransform.target.oCoords);
    }
  },
  getFixedPositionEasy: function getFixedPositionEasy(target, x, y) {
    var _w = this.originalWidth || this.width;
    var _h = this.originalHeight || this.height;

    if (x === undefined) {
      x = target.left;
    }
    if (y === undefined) {
      y = target.top;
    }
    var scale = this.viewportTransform[0];
    target.setCoords();
    target.right = _w - (target.left + target.width);
    target.bottom = _h - (target.top + target.height);

    var _diff, _asp, rect;
    var newPos = {
      left: x,
      top: y,
      width: target.width,
      height: target.height
    };

    if (target.width > _w) {
      newPos.width = _w;
    }
    if (target.height > _h) {
      newPos.height = _h;
    }
    if (target.left < 0) {
      newPos.width += target.left;
      newPos.left -= target.left;
    }
    if (target.right < 0) {
      newPos.width += target.right;
    }
    if (target.top < 0) {
      newPos.height += target.top;
    }
    if (target.bottom < 0) {
      newPos.height += target.bottom;
    }
    return newPos;
  },
  /**
   * функцию можно вызвать с евентом  'after:render'. Позволяет отображать вычисления пересечений изменяемого объекта с рамкой. выделяет красными лиинияи
   * @private
   * @example
   *  eventListeners : {
    Canvas: {
      'before:render': function(){
        this.clearContext(this.contextTop);
      },
      'after:render': function(){
        this._debug_intersections()
      }
    }
  }
   */
  drawInterestionLines: function drawInterestionLines() {
    var tr = this._currentTransform;
    if (tr && tr._intersections) {
      var ctx = this.contextTop;
      ctx.beginPath();
      ctx.strokeStyle = "red";
      for (var i in tr._intersections) {
        var _coord = tr._intersections[i];
        ctx.moveTo(_coord.x + 5, _coord.y);
        ctx.arc(_coord.x, _coord.y, 5, 0, 2 * Math.PI);
      }
      for (var i in tr.lines) {
        var _l = tr.lines[i];
        ctx.moveTo(_l[0].x, _l[0].y);
        ctx.lineTo(_l[1].x, _l[1].y);
      }
      for (var i in tr.mlLines) {
        var _l = tr.mlLines[i];
        ctx.moveTo(_l[0].x, _l[0].y);
        ctx.lineTo(_l[1].x, _l[1].y);
      }
      ctx.stroke();
    }
  },
  _scaleObjectEasy: function _scaleObjectEasy(x, y, by) {
    //_scaleObject_overwritten.call(this, x, y, by);
    var tr = this._currentTransform,
        target = tr.target,
        corner = tr.corner;
    if (!target.movementLimits) {
      return _scaleObject_overwritten.call(this, x, y, by);
    }

    if (target.movementLimitMode !== 'fit') return;
    x = Math.min(target.movementLimits.width, Math.max(0, x));
    y = Math.min(target.movementLimits.height, Math.max(0, y));
    _scaleObject_overwritten.call(this, x, y, by);
  },
  /**
   * Scales object by invoking its scaleX/scaleY methods
   * @private
   * @param {Number} x pointer's x coordinate
   * @param {Number} y pointer's y coordinate
   * @param {String} by Either 'x' or 'y' - specifies dimension constraint by which to scale an object.
   *                    When not provided, an object is scaled by both dimensions equally
   */
  _scaleObject: function _scaleObject(x, y, by) {
    var _scaled = _scaleObject_overwritten.call(this, x, y, by);

    var tr = this._currentTransform,
        target = tr.target,
        corner = tr.corner;
    var _v = this.viewportTransform;

    if (!target.movementLimits || target.movementLimitMode !== "fit") {
      return _scaled;
    }
    target.setCoords();

    var _scale = this.getZoom();

    if (target.movementLimits == this) {
      var _w = this.originalWidth || this.width;
      var _h = this.originalHeight || this.height;
      var _l = this.viewportTransform[4];
      var _t = this.viewportTransform[5];
      _w *= _scale;
      _h *= _scale;
      var _rc = {
        tl: { x: _l, y: _t },
        tr: { x: _l + _w, y: _t },
        bl: { x: _l, y: _t + _h },
        br: { x: _l + _w, y: _t + _h }
      };
    } else {
      target.movementLimits.setCoords();
      var _rc = target.movementLimits.oCoords;
    }

    if (!tr.pointerOffset) {
      tr.pointerOffset = {
        x: x * _v[0] - target.oCoords[corner].x,
        y: y * _v[3] - target.oCoords[corner].y
      };

      tr.pointCenter = target.getCenterPoint();
      tr.pointCenter.x *= _scale;
      tr.pointCenter.y *= _scale;
      tr.pointOriginal = tr.original.oCoords[corner];
    }

    tr.pointTranformed = target.oCoords[corner];

    tr.mlLines = [];
    tr.lines = [];
    function _intersection(corner, coordinate) {
      var _oc;
      if (coordinate == "x" && corner[0] != "m") {
        _oc = tr.original.oCoords["m" + corner[0]];
      } else if (coordinate == "y" && corner[0] != "m") {
        _oc = tr.original.oCoords["m" + corner[1]];
      } else {
        _oc = tr.pointCenter;
        _oc = {
          x: _oc.x + _v[4],
          y: _oc.y + _v[5]
        };
      }
      var _tc = target.oCoords[corner];

      tr.lines.push([_oc, _tc]);
      tr.mlLines.push([_rc.tl, _rc.tr]);
      tr.mlLines.push([_rc.tr, _rc.br]);
      tr.mlLines.push([_rc.br, _rc.bl]);
      tr.mlLines.push([_rc.bl, _rc.tl]);

      var inters = fabric.Intersection.intersectLinePolygon(_oc, _tc, [_rc.tl, _rc.tr, _rc.br, _rc.bl]);
      if (!inters.points.length) {
        return;
      }
      inters.points[0].coordinate = coordinate;
      tr._intersections.push(inters.points[0]);

      //         if (coordinate) {
      //           var p1 = inters.points[0];

      //           var corner2;
      //           if (coordinate == "x") {
      //             corner2 = (corner[0] == "t" ? "b" : "t") + corner[1];
      //           } else {
      //             corner2 = corner[0] + (corner[1] == "l" ? "r" : "l");
      //           }
      //           var _p2 = target.oCoords[corner2];
      //           var _diff = {x: _tc.x - p1.x, y: _tc.y - p1.y};

      //           var p2 = {
      //             x: _p2.x - _diff.x,
      //             y: _p2.y - _diff.y
      //           };

      //           var its = fabric.Intersection.intersectLineLine(tr.pointCenter, tr.pointTranformed, p1, p2);
      //           if (!its.points[0]) {
      //             return;
      //           }
      //           tr._intersections.push(its.points[0]);
      //         } else {
      //           tr._intersections.push(inters.points[0]);
      //         }


      //
      //if(inters.points.length){
      //  _scaleObject_overwritten.call(this, inters.points[0].x,  inters.points[0].y, by);
      //  target.setCoords();
      //}else{
      //  _scaleObject_overwritten.call(this, x, y, by);
      //}
    }

    tr._intersection = null;
    tr._intersections = [];
    switch (corner) {
      case "tl":
        _intersection("tl");
        _intersection("bl", "x");
        _intersection("tr", "y");
        break;
      case "tr":
        _intersection("tr");
        _intersection("tl", "y");
        _intersection("br", "x");
        break;
      case "br":
        _intersection("br");
        _intersection("tr", "x");
        _intersection("bl", "y");
        break;
      case "bl":
        _intersection("bl");
        _intersection("tl", "x");
        _intersection("br", "y");
        break;
      case "mt":
        _intersection("mt");
        _intersection("tl", "y");
        _intersection("tr", "y");
        break;
      case "mb":
        _intersection("mb");
        _intersection("bl", "y");
        _intersection("br", "y");
        break;
      case "mr":
        _intersection("mr");
        _intersection("tr", "x");
        _intersection("br", "x");
        break;
      case "ml":
        _intersection("ml");
        _intersection("tl", "x");
        _intersection("bl", "x");
    }

    if (!tr._intersections.length) {
      return _scaled;
    }

    var _newXY = tr._intersections[0];
    var _l = tr._intersections[0].distanceFrom(tr.pointOriginal);

    for (var i = 1; i < tr._intersections.length; i++) {
      var _l2 = tr._intersections[i].distanceFrom(tr.pointOriginal);
      if (_l2 < _l) {
        _newXY = tr._intersections[i];
        _l = _l2;
      }
    }
    tr._intersection = _newXY;

    if (by == "equally") {
      //by = false;

      var _diff2 = { x: _newXY.x - tr.pointCenter.x, y: _newXY.y - tr.pointCenter.y };
      var _l = Math.sqrt(_diff2.x * _diff2.x + _diff2.y * _diff2.y);

      _newXY.x -= _diff2.x / _l * target.strokeWidth;
      _newXY.y -= _diff2.y / _l * target.strokeWidth;
      // scrt(x*x + y*y) = atrokewidth
      var a = 1;
    }
    //return _scaleObject_overwritten.call(this, x, y, by);
    var __x = (_newXY.x + tr.pointerOffset.x) / _v[0];
    var __y = (_newXY.y + tr.pointerOffset.y) / _v[3];
    return _scaleObject_overwritten.call(this, __x, __y, by);

    //
    //if (corner == "br" || corner == "tr" || corner == "mr") {
    //  if (x < target.movementXMaxLimit) {
    //    x = target.movementXMaxLimit;
    //  }
    //}
    //if (corner == "bl" || corner == "tl" || corner == "ml") {
    //  if (x > target.movementXMinLimit) {
    //    x = target.movementXMinLimit;
    //  }
    //}
    //if (corner == "bl" || corner == "br" || corner == "mb") {
    //  if (y < target.movementYMaxLimit) {
    //    y = target.movementYMaxLimit;
    //  }
    //}
    //if (corner == "tl" || corner == "tr" || corner == "mt") {
    //  if (y > target.movementYMinLimit) {
    //    y = target.movementYMinLimit;
    //  }
    //}
    //
    //_scaleObject_overwritten.call(this, x, y, by);
  },
  movementLimitsOnAddAction: 'translate',
  _check_object_after_modified: function _check_object_after_modified(target) {
    if (!this._currentTransform) {
      return;
    }
    var pos = this.getFixedPosition(target, target.left, target.top);

    switch (this._currentTransform.corner) {
      case "mtr":
        if (pos.left !== undefined) {
          target.set('left', pos.left);
        }
        if (pos.top) {
          target.set('top', pos.top);
        }
        break;
      case "mr":
      case "br":
        if (pos.left !== undefined) {
          var _ldiff = target.left - pos.left;
        }
        if (pos.top !== undefined) {
          var _tdiff = target.top - pos.top;
        }

        if (_ldiff && (!_tdiff || Math.abs(_ldiff) > Math.abs(_tdiff))) {
          if (_ldiff < 0) {
            target.width += _ldiff;
          } else {
            target.width -= _ldiff;
          }
        } else if (_tdiff) {
          if (_tdiff < 0) {
            target.width += _tdiff;
          } else {
            target.width -= _tdiff;
          }
        }
      //console.log(pos,_ldiff,_tdiff)
    }
    // this._check_object_position(target)
  },
  _check_object_position: function _check_object_position(target) {

    var pos = this.getFixedPosition(target, target.left, target.top);
    if (this.movementLimitsOnAddAction == 'translate') {
      if (pos.left !== undefined) {
        target.set('left', pos.left);
      }
      if (pos.top !== undefined) {
        target.set('top', pos.top);
      }
    } else {

      if (pos.left !== undefined) {
        if (target.left < pos.left) {
          target.width += target.left - pos.left;
          target.left = pos.left;
        } else {
          target.width -= target.left - pos.left;
        }
      }
      if (pos.top !== undefined) {
        if (target.top < pos.top) {
          target.height += target.top - pos.top;
          target.top = pos.top;
        } else {
          target.height -= target.top - pos.top;
        }
      }
    }

    if (pos.scaleX) {
      target.scaleX = target.scaleX *= pos.scaleX;
    }
    if (pos.scaleY) {
      target.scaleY = target.scaleY *= pos.scaleY;
    }

    target.setCoords();

    this.renderAll();
    // if(target.wholeCoordinates){
    //   target.top = Math.round(target.top);
    //   target.left = Math.round(target.left);
    //   target.height = Math.round(target.height);
    //   target.width = Math.round(target.width);
    // }
  },
  _translateObject: function _translateObject(x, y, limits) {
    var target = this._currentTransform.target;
    if (target.beforeTranslate) {
      var _point = target.beforeTranslate(x, y);
      if (!_point) return false;
      x = _point.x;
      y = _point.y;
    }
    var _translated = _translateObject_overwritten.call(this, x, y, limits);

    if (this.movementLimits) {

      var pos = this.getFixedPosition(target, x, y);

      if (pos.scaleX) {
        target.scaleX = this._currentTransform.scaleX *= pos.scaleX;
      }
      if (pos.scaleY) {
        target.scaleY = this._currentTransform.scaleY *= pos.scaleY;
      }

      if (pos.top !== undefined || pos.left !== undefined) {
        _translated = _translateObject_overwritten.call(this, pos.left !== undefined ? pos.left : x, pos.top !== undefined ? pos.top : y);
      }
    }
    return _translated || pos.scaleX || pos.scaleY;

    /* if (!target.get('lockMovementX')) {
     var _val = x - this._currentTransform.offsetX;
      //left offset
     var lim = this.movementLimits.minX.constructor == Number ? this.movementLimits.minX : -bounds.width + 1;
     if(target.movementXMinLimit && target.movementXMinLimit.constructor == Number && target.movementXMinLimit > lim ){
     lim = target.movementXMinLimit ;
     }
      _val = Math.min(lim, _val);
      //right offset
     var lim = this.movementLimits.maxX.constructor == Number ? this.movementLimits.maxX : this.width + bounds.width - 1;
     if(target.movementXMaxLimit && target.movementXMaxLimit.constructor == Number && target.movementXMaxLimit > lim ){
     lim = target.movementXMaxLimit ;
     }
     _val = Math.max(lim  - target.width * target.scaleX, _val);
     target.set('left', _val);
     }
     if (!target.get('lockMovementY')) {
     var _val = y - this._currentTransform.offsetY;
     if(target.movementYMinLimit !== undefined)
     _val = Math.min(target.movementYMinLimit, _val);
     if(target.movementYMaxLimit !== undefined)
     _val = Math.max(target.movementYMaxLimit  - target.height, _val);
      target.set('top', _val);
     }
     */
    //movementLimits ={
    //    xmin: 0,
    //    xmax: 0,
    //    ymin: 0,
    //    ymax: 0
    //};
  },

  _beforeTransform: function _beforeTransform(e, target) {
    target && target._beforeTransform ? target._beforeTransform(e) : _beforeTransform_overwritten.call(this, e, target);
  },
  _beforeTransformNative: _beforeTransform_overwritten
  /**
   * Translates object by "setting" its left/top
   * @private
   * @param {Number} x pointer's x coordinate
   * @param {Number} y pointer's y coordinate
   * @return {Boolean} true if the translation occurred
   */
  /* _translateObject: function (x, y) {
     var transform = this._currentTransform,
       target = transform.target,
       newLeft = x - transform.offsetX,
       newTop = y - transform.offsetY,
       moveX = !target.get('lockMovementX') && target.left !== newLeft,
       moveY = !target.get('lockMovementY') && target.top !== newTop;
  
     //round coordinates
     // if (target.wholeCoordinates) {
     //   newLeft = Math.round(newLeft);
     //   newTop = Math.round(newTop);
     // }
      moveX && target.set('left', newLeft);
     moveY && target.set('top', newTop);
     return moveX || moveY;
   }*/
});

//fabric.SlideCanvas.addPlugin("loaders",function(){
//    this.initMovementLimits();
//});

//todo
fabric.Rect.prototype.stateProperties = fabric.Rect.prototype.stateProperties.concat(["movementLimits", "clipTo"]);
fabric.Object.prototype.stateProperties = fabric.Object.prototype.stateProperties.concat(["movementLimits", "clipTo"]);
fabric.IText.prototype.stateProperties = fabric.IText.prototype.stateProperties.concat(["movementLimits", "clipTo"]);
fabric.Image.prototype.stateProperties = fabric.Image.prototype.stateProperties.concat(["movementLimits", "clipTo"]);
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 53 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

// fabric.require('SlideGroup',['SlideObject'], function() {

var _OBJ = fabric.Object.prototype;
var _handleGrouping_overwritten = fabric.Canvas.prototype._handleGrouping;
fabric.Object.prototype.groupable = true;

fabric.util.object.extend(fabric.Canvas.prototype, {
  /**
   * Deactivates all objects and dispatches appropriate events
   * @return {fabric.Canvas} thisArg
   * @chainable
   */
  deactivateAllWithDispatch: function deactivateAllWithDispatch(e) {
    var activeGroup = this.getActiveGroup(),
        activeObject = this.getActiveObject();
    var _target = activeObject || activeGroup;
    if (_target) {
      this.fire('before:selection:cleared', { target: _target, e: e });
    }
    this.deactivateAll();
    if (_target) {
      this.fire('selection:cleared', { e: e, target: _target });
      _target.fire('deselected');
    }
    return this;
  },

  /**
   * Divides objects in two groups, one to render immediately
   * and one to render as activeGroup.
   * return objects to render immediately and pushes the other in the activeGroup.
   */
  _chooseObjectsToRender: function _chooseObjectsToRender() {
    var activeGroup = this.getActiveGroup(),
        activeObject = this.getActiveObject(),
        object,
        objsToRender = [],
        activeGroupObjects = [];

    if (activeGroup && !this.preserveObjectStacking) {
      for (var i = 0, length = this._objects.length; i < length; i++) {
        object = this._objects[i];
        if (!activeGroup.contains(object)) {
          if (!object.hiddenActive) {
            objsToRender.push(object);
          }
        } else {
          activeGroupObjects.push(object);
        }
      }
      if (activeGroup) {
        // activeGroup._set('_objects', activeGroupObjects);
        objsToRender.push(activeGroup);
      }
      activeObject && objsToRender.push(activeObject);
      // activeGroup._set('_objects', activeGroupObjects);
    } else {
      objsToRender = this._objects;
    }
    return objsToRender;
  },
  /**
   * adding before:selection:created event
   * @private
   * @param {Event} e Event object
   * @param {fabric.Object} target
   */
  _handleGrouping: function _handleGrouping(e, target) {
    this.fire("before:selection:created");
    _handleGrouping_overwritten.call(this, e, target);
  },
  /**
   * @private
   * @param {Event} e mouse event
   */
  _groupSelectedObjects: function _groupSelectedObjects(e) {

    var group = this._collectObjects();

    group = fabric.util.object.filter(group, { groupable: true });

    // do not create group for 1 element only
    if (group.length === 1) {
      this.setActiveObject(group[0], e);
    } else if (group.length > 1) {
      group = new fabric.Group(group.reverse(), {
        canvas: this
      });
      group.addWithUpdate();
      this.setActiveGroup(group, e);
      group.saveCoords();
      this.fire('selection:created', { target: group });
      this.renderAll();
    }
  }
});

_OBJ.cloneSync = function () {
  var _klass = fabric[fabric.util.string.camelize(fabric.util.string.capitalize(this.type))];
  if (_klass.async) {
    var _obj = new _klass.fromObject(this, function () {});
  } else {
    var _obj = this.clone();
  }
  _obj.canvas = this.canvas;
  return _obj;
};

fabric.util.object.extend(fabric.Group.prototype, {
  groupSelectable: true,
  cloneSync: function cloneSync() {
    var _clonedObjects = this._objects.map(function (object) {
      return object.cloneSync();
    });

    var object = this.toObject();
    delete object.objects;

    return new fabric.Group(_clonedObjects, object, true);

    // fabric.util.enlivenObjects(object.objects, function (enlivenedObjects) {
    //   delete object.objects;
    //   callback && callback(new fabric.Group(enlivenedObjects, object, true));
    // });
  },
  _calcBounds: function _calcBounds(onlyWidthHeight) {
    var aX = [],
        aY = [],
        o,
        prop,
        props = ['tr', 'br', 'bl', 'tl'];

    for (var i = 0, len = this._objects.length; i < len; ++i) {
      o = this._objects[i];
      if (o.notSelectableInTheGroup) {
        continue;
      }
      o.setCoords();
      for (var j = 0; j < props.length; j++) {
        prop = props[j];
        aX.push(o.oCoords[prop].x);
        aY.push(o.oCoords[prop].y);
      }
    }

    this.set(this._getBounds(aX, aY, onlyWidthHeight));
  },
  initialize_overwritten: fabric.Group.prototype.initialize,
  isSelectionGroup: function isSelectionGroup() {
    return this.canvas._objects.indexOf(this) === -1;
  },
  //clone: function(callback){
  //  if(callback === true || callback.constructor === Object){
  //    var _frame = new fabric.Group(this);
  //    if(callback.constructor === Object){
  //      _frame.set(callback);
  //      return _frame;
  //    }
  //  }
  //  return this.callSuper('clone',callback);
  //},
  initialize: function initialize(objects, options) {
    if (objects.constructor != Array) {
      var el = objects;
      options = el.toObject();
      objects = [];
      for (var i in el._objects) {
        objects.push(el._objects[i].cloneSync());
      }
    }

    this.initialize_overwritten(objects, options);
    if (this.type == 'group') {
      this.on("dblclick", function () {
        if (this.canvas._objects.indexOf(this) === -1) {
          this.groupSelectedElements();
        } else {
          this.ungroup();
        }
      });
    }
  },
  ungroup: function ungroup() {
    this.canvas.discardActiveGroup();
    this._restoreObjectsState();
    this.canvas.remove(this);
    for (var i in this._objects) {
      this.canvas.add(this._objects[i]);
      this._objects[i].clipTo = this.clipTo;
      //this._objects[i].active = true;
    }
    var group = new fabric.Group(this._objects, {
      canvas: this.canvas
    });
    group.addWithUpdate();
    this.canvas.setActiveGroup(group);
    group.saveCoords();
    this.canvas.fire('selection:created', { target: group });
    this.canvas.renderAll();

    //var _group = new fabric.Group(this._objects);
    //_group.canvas = this.canvas;
    //this.canvas.setActiveObject(_group);
  },

  groupSelectedElements: function groupSelectedElements() {

    var el = this.cloneSync();
    this.canvas.add(el);
    this.canvas.discardActiveGroup();
    this.canvas.setActiveObject(el);

    for (var i in this._objects) {
      this.canvas.remove(this._objects[i].originalObject);
    }
  },
  actions: {

    objectRemove: {
      className: 'fa fa-trash',
      title: 'Delete',
      key: "Delete",
      action: function action() {
        if (this.isSelectionGroup()) {
          for (var i in this._objects) {
            var _obj = this._objects[i];
            this.canvas.remove(_obj.originalObject);
          }
          this.canvas.discardActiveGroup();
          this.canvas.discardActiveObject();
        } else {
          this.canvas.remove(this);
        }
        this.canvas.renderAll();
      }
    },
    objectDuplicate: {
      className: 'fa fa-clone',
      insert: 'duplicateTool',
      title: 'Duplicate',
      action: function action() {
        if (this.isSelectionGroup()) {
          this.canvas.fire('before:selection:cleared', { target: this, e: null });
          this.canvas.discardActiveGroup();
          this.duplicate(function (el) {
            el.ungroup();
          });

          this.canvas.renderAll();
        } else {
          this.duplicate();
        }
      }
    },
    groupSelectedElements: {
      title: 'группа',
      className: 'fa fa-object-group',
      visible: function visible() {
        return this.isSelectionGroup();
      },
      action: function action() {
        this.groupSelectedElements();
        this.canvas.renderAll();
      }
      //visible: IDE.groupAvailable
    },
    ungroup: {
      title: 'группа',
      className: 'fa fa-object-ungroup',
      visible: function visible() {
        return this.canvas._objects.indexOf(this) !== -1;
      },
      action: function action() {
        this.ungroup();
        this.canvas.renderAll();
      }
    }
  }
});

fabric.util.object.extend(fabric.SlideCanvas.prototype, {
  eventListeners: fabric.util.object.extendArraysObject(fabric.SlideCanvas.prototype.eventListeners, {
    'selection:created': function selectionCreated(event) {
      this._onSelectionCreated(event);
    }
  }),
  _onSelectionModified: function _onSelectionModified() {
    for (var i in this._objects) {
      var copy = this._objects[i].cloneSync();
      copy.group = this;
      this._restoreObjectState(copy);
      this._objects[i].originalObject.set({
        clipTo: copy.clipTo,
        movementLimits: copy.movementLimits,
        left: copy.left,
        top: copy.top,
        angle: copy.angle,
        scaleX: copy.scaleX,
        scaleY: copy.scaleY,
        skewX: copy.skewX,
        skewY: copy.skewY,
        width: copy.width,
        height: copy.height
      });
    }
  },
  _onSelectionDeselected: function _onSelectionDeselected(data) {
    for (var i in this._objects) {
      var _obj = this._objects[i];
      _obj.originalObject.setCoords();
      _obj.originalObject.evented = true;
      delete _obj.originalObject.hiddenActive;
    }
  },
  _onSelectionCreated: function _onSelectionCreated(el) {

    var group = el.target;

    var originalObjects = [];
    for (var i in group._objects) {
      var _obj = group._objects[i];
      originalObjects.push(_obj.originalObject || _obj);
    }

    group.destroy();
    group._objects = [];

    var _clipTo = originalObjects[0].clipTo;

    for (var i in originalObjects) {
      var original = originalObjects[i];

      if (_clipTo != original.clipTo) {
        _clipTo = false;
      }

      var _obj = original.cloneSync();

      _obj.set({
        clipTo: null,
        originalObject: original
      });
      original.set({
        active: false,
        evented: false,
        hiddenActive: true
      });

      group.addWithUpdate(_obj);
      group.setCoords();
    }

    group.clipTo = _clipTo;

    group.on({
      "modified": this._onSelectionModified,
      'deselected': this._onSelectionDeselected
    });
  }
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 54 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

var History = __webpack_require__(55);

History.prototype.insertRecords = false;
History.prototype.actions = {
  undo: {
    keyCode: 'z',
    ctrlKey: true,
    observe: 'changed',
    className: 'fa fa-undo',
    title: 'undo',
    enabled: 'canUndo',
    action: function action() {
      this.undo();
    }
  },
  records: {
    title: "records",
    itemClassName: "filters-selector",
    className: "fa fa-history",
    type: "select",
    templateSelection: function templateSelection(state, container) {
      if (state.any) {
        return state.text;
      }
      return $('<span>' + state.id + ":" + state.type + '</span>');
    },
    templateResult: function templateResult(state, container, data) {
      if (!state.type) return;
      var _keys = state.originalState && Object.keys(state.originalState).join(',') || '';
      var type = state.object && state.object.type || '';
      return $("<span>{id}:{type}({otype} {keys})</span>".format(fabric.util.object.extend({ keys: _keys, otype: type }, state)));
      // if(state.id != "none"){
      //   var $canvas = $('<canvas>');
      //   $el.prepend($canvas);
      // }
      // return $el;
    },
    value: {
      observe: 'changed',
      set: function set(val, filtersData) {
        this.goto(val);
      },
      get: function get() {
        return this.records[this.current].id;
      },
      options: function options() {
        return this.records;
      }
    }
  },
  redo: {
    keyCode: 'y',
    ctrlKey: true,
    observe: 'changed',
    className: 'fa fa-repeat',
    title: 'redo',
    enabled: 'canRedo',
    action: function action() {
      this.redo();
    }
  }
};

fabric.util.object.extend(fabric.SlideCanvas.prototype.actions, {
  history: {
    title: 'history',
    type: 'menu',
    target: function target() {
      return this.history;
    },
    menu: function menu() {
      return this.actions;
    }
  }
});

fabric.util.object.extend(fabric.Canvas.prototype, {
  insertHistory: false,
  onObjectModified: function onObjectModified(e) {
    if (!this.history.enabled || this.processing || this.history.processing) {
      return false;
    }
    var _canvas = e.target.canvas || e.target.wrapperEl && e.target;

    this.history.add({
      canvas: e.target.canvas.originalSlide || e.target.canvas,
      originalState: e.states.original,
      modifiedState: e.states.modified,
      object: e.target,
      type: 'object:modified',
      undo: function undo(_action) {
        _action.object.set(_action.originalState);
        if (_action.canvas.mirrorSlide == this.canvas) {
          _action.object.setCoords();
          var _canvas = this.canvas || this;
          _canvas.renderAll();
        }
        _action.canvas.fire('object:modified', { target: _action.object });
        _action.object.fire('modified');
        _action.canvas.renderAll();
      },
      redo: function redo(_action) {
        _action.object.set(_action.modifiedState);
        _action.object.setCoords();
        if (_action.canvas.mirrorSlide == this.canvas) {
          _action.object.setCoords();
          var _canvas = this.canvas || this;
          _canvas.renderAll();
        }
        _action.canvas.fire('object:modified', { target: _action.object });
        _action.object.fire('modified');
        _action.canvas.renderAll();
      }
    });
  },
  clearHistory: function clearHistory() {
    this.history.clear();
  },
  disableHistory: function disableHistory() {
    this.history.enabled = false;
  },
  _add_object_history_action: function _add_object_history_action(_action) {
    var _canvas = this.canvas || this;
    if (this.canvas && _action.canvas.mirrorSlide == this.canvas) {
      _canvas.add(_action.object);
      _canvas.setActiveObject(_action.object);
      _canvas.renderAll();
    } else {
      _action.canvas.add(_action.object);
    }
    _action.canvas.renderAll();
  },

  _remove_object_history_action: function _remove_object_history_action(_action) {
    _action.canvas.remove(_action.object);
    _action.canvas.renderAll();
    if (this.canvas && _action.canvas.mirrorSlide == this.canvas) {
      this.canvas.renderAll();
    }
  },

  onObjectRemoved: function onObjectRemoved(e) {
    if (!this.history.enabled || this.processing || this.history.processing) {
      return false;
    }
    this.history.add({
      canvas: e.target.canvas.originalSlide || e.target.canvas,
      object: e.target,
      type: 'object:removed',
      redo: this._remove_object_history_action,
      undo: this._add_object_history_action
    });
  },
  onDrawAfter: function onDrawAfter(event) {
    if (!this.history.enabled || this.processing || this.history.processing) {
      return false;
    }
    this.history.add(this.freeDrawingBrush.getHistoryRecord(event));
  },
  onObjectAdded: function onObjectAdded(e) {
    if (!this.history.enabled || this.processing || this.history.processing) {
      return false;
    }
    this.history.add({
      canvas: e.target.canvas.originalSlide || e.target.canvas,
      object: e.target,
      type: 'object:added',
      undo: this._remove_object_history_action,
      redo: this._add_object_history_action
    });
  },
  initHistory: function initHistory(history) {
    if (!history) {
      history = new History(this);
      history.application = this.application;
    }

    this.history = history;
    this.on({
      'loading:begin': this.clearHistory,
      'draw:after': this.onDrawAfter,
      'object:modified': this.onObjectModified,
      'object:added': this.onObjectAdded,
      'object:removed': this.onObjectRemoved
    });

    var _this = this;
    this.history.on('changed', function (e) {
      if (this.activeAction.canvas) {
        this.activeAction.canvas.moment = e.action.moment;
      }
    });
    var proto = this.application.prototypes.History;
    if (proto) {
      if (proto.eventListeners) {
        history.on(proto.eventListeners);
      }
    }
  },
  enableHistory: function enableHistory() {
    this.history.enabled = true;
  }
});

fabric.HISTORY_OPTIONS = {
  INDIVIDUAL: 0,
  SHARED: 1
};

fabric.util.object.extend(fabric.Application.prototype, {
  history: true,
  setHistory: function setHistory(historyOption) {

    if (historyOption === fabric.HISTORY_OPTIONS.SHARED) {
      this.history = new History(this);
      this.enableHistory();

      this.on("ready", function () {
        if (this.canvas) {
          this.canvas.initHistory(this.history);
        }
      });
    }
    if (historyOption === fabric.HISTORY_OPTIONS.INDIVIDUAL) {
      //todo unsupported
    }
  },
  actions: fabric.util.object.extend(fabric.Application.prototype.actions, {
    history: {
      insert: 'historyTools',
      title: 'history',
      type: 'menu',
      target: function target() {
        return this.history;
      },
      menu: function menu() {
        return this.actions;
      }
    }
  }),
  _default_event_listeners: {
    "slide:change:begin": function slideChangeBegin() {
      this.processing = true;
      if (this.history) {
        this.history.processing = true;
      }
    },
    "slide:changed": function slideChanged() {
      this.processing = false;
      if (this.history) {
        this.history.processing = false;
      }
    }
  },
  historyTools: false,
  enableHistory: function enableHistory() {
    this.history.enabled = true;
  }
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 55 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var utils = __webpack_require__(3);
utils.object = __webpack_require__(2);

/***********************************************************************************************************************
 ** DPHistory
 ***********************************************************************************************************************/

var DPHistory = function DPHistory(parent, initAction) {
  this.parent = parent;
  this.clear(initAction);
};

DPHistory.prototype.setRecords = function (records, current) {
  this.canUndo = records.length;
  this.canRedo = false;

  if (!records.length) {
    records = [{
      type: 'initialized',
      id: 0,
      text: 'initialized'
    }];
  }
  this.records = records;
  this.length = this.records.length;
  this.current = current === undefined ? records.length - 1 : current;
  this.activeAction = this.records[this.current];
  this.fire("changed", { action: this.activeAction });
  return this;
};

DPHistory.prototype.restore = function () {
  this.setRecords(this.saved.records, this.saved.current);
  return this;
};

DPHistory.prototype.save = function () {
  this.saved = {
    current: this.current,
    records: utils.object.cloneDeep(this.records)
  };
  return this;
};

DPHistory.prototype.clear = function (initAction) {
  if (initAction) {
    initAction.id = 0;
  } else {
    initAction = {
      type: 'initialized',
      id: 0,
      text: 'initialized'
    };
  }
  this.records = [initAction];
  this.current = 0;
  this.canUndo = false;
  this.canRedo = false;
  this.activeAction = this.records[this.current];
  this.fire("changed", { action: this.activeAction });
  return this;
};

DPHistory.prototype.add = function (action) {

  if (!this.enabled || this.processing) {
    return false;
  }

  action.moment = new Date().getTime();
  this.canUndo = true;
  this.canRedo = false;
  this.records.splice(this.current + 1);
  this.records.push(action);
  this.length = this.records.length;
  action.id = this.length - 1;
  action.text = action.type || action.text;
  this.current = this.length - 1;

  this.activeAction = this.records[this.current];
  this.fire("changed", { action: action });
  return this;
};
DPHistory.prototype.disable = function () {
  this.enabled = false;
  return this;
};
DPHistory.prototype.enable = function () {
  this.enabled = true;
  return this;
};
DPHistory.prototype.undo = function (noFire) {
  this.canRedo = true;
  var _action = this.records[this.current];
  this.current--;
  this.processing = true;
  _action.undo.call(this.parent, _action);
  this.processing = false;
  if (this.current == 0) {
    this.canUndo = false;
  }
  if (!noFire) {
    this.activeAction = this.records[this.current];
    this.fire("changed", { action: _action });
  }
  return this;
};

DPHistory.prototype.goto = function (index) {
  if (index == this.current) return;
  if (index < this.current) {
    for (var i = this.current - index; i--;) {
      this.undo(true);
    }
  }if (index > this.current) {
    for (var i = index - this.current; i--;) {
      this.redo(true);
    }
  }
  this.activeAction = this.records[this.current];
  this.fire("changed", { action: this.activeAction });
  return this;
};

DPHistory.prototype.redo = function (noFire) {
  if (this.current == this.length - 1) {
    return;
  }
  this.processing = true;
  this.canUndo = true;
  this.current++;
  var _action = this.records[this.current];

  _action.redo.call(this.parent, _action);

  if (this.current == this.length - 1) {
    this.canRedo = false;
  }
  this.processing = false;
  if (!noFire) {
    this.activeAction = this.records[this.current];
    this.fire("changed", { action: _action });
  }
  return this;
};
utils.observable(DPHistory.prototype);
module.exports = DPHistory;

/***/ }),
/* 56 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

/////////////////module responsive borders//////////////////////////////////////////////////////////////////////////////////////////

fabric.util.object.extend(fabric.Object.prototype, {
  responsiveBorders: false
});

if (!fabric.SlideCanvas.prototype._default_event_listeners) {
  fabric.SlideCanvas.prototype._default_event_listeners = {};
};

fabric.Object.prototype.updateResponsiveBorder = function () {
  if (this.responsiveBorders) {
    if (!this.originalStrokeWidth) {
      this.originalStrokeWidth = this.strokeWidth;
    }
    this.strokeWidth = this.canvas ? this.originalStrokeWidth / this.canvas.viewportTransform[0] : 0;
  }
};

fabric.util.object.extend(fabric.SlideCanvas.prototype, {
  _default_event_listeners: {
    "dimensions:modified": function dimensionsModified() {
      this.centerAndZoomOut();
    },
    'viewport:scaled': function viewportScaled() {
      if (this.backgroundImage) {
        this.backgroundImage.updateResponsiveBorder();
      }
      for (var i in this._objects) {
        this._objects[i].updateResponsiveBorder();
      }
    },
    "background-image:loaded": function backgroundImageLoaded(event) {
      if (this.autoCenterAndZoomOutEnabled) {
        this.centerAndZoomOut();
      }
    },
    "loading:end": function loadingEnd(event) {
      if (this.autoCenterAndZoomOutEnabled && (this.originalHeight || this.originalWidth)) {
        this.centerAndZoomOut();
      }
    },
    "object:added": function objectAdded(event) {
      event.target.updateResponsiveBorder();
    }
  }
});

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


fabric.util.object.extend(fabric.SlideCanvas.prototype, {
  zoomCtrlKey: true,
  mouseWheelEnabled: false,
  _setZoomNative: fabric.Canvas.prototype.setZoom,
  _zoomToPointNative: fabric.Canvas.prototype.zoomToPoint,
  changeDimensionOnZoom: false,
  drawZoomArea: function drawZoomArea(_ctx, left, top, width, height) {
    _ctx.save();
    _ctx.translate(left || 0, top || 0);
    var _scale = this.getZoom();
    var _size = fabric.util.getProportions(this.backgroundImage, { width: width || 100, height: height || 100 });
    _ctx.globalAlpha = 0.5;
    _ctx.fillRect(0, 0, _size.width, _size.height);
    _ctx.strokeStyle = "red";

    var v = this.viewportTransform;

    var x1 = -v[4] * _size.scale / _scale;
    var y1 = -v[5] * _size.scale / _scale;
    var x2 = x1 + this.width * _size.scale / _scale;
    var y2 = y1 + this.height * _size.scale / _scale;

    x1 = Math.max(x1, 0);
    y1 = Math.max(y1, 0);
    x2 = Math.min(x2, _size.width);
    y2 = Math.min(y2, _size.height);

    _ctx.globalAlpha = 1;
    _ctx.beginPath();
    _ctx.moveTo(x1, y1);
    _ctx.lineTo(x2, y1);
    _ctx.lineTo(x2, y2);
    _ctx.lineTo(x1, y2);
    _ctx.lineTo(x1, y1);

    _ctx.fill();
    _ctx.clip();
    // _ctx.globalCompositeOperation = "source-in";
    _ctx.drawImage(this.backgroundImage._element, 0, 0, _size.width, _size.height);
    // _ctx.globalCompositeOperation = "source-over";
    // _ctx.drawImage(this.backgroundImage._element,0,0,_size.width, _size.height)
    _ctx.stroke();
    _ctx.strokeRect(0, 0, _size.width, _size.height);
    _ctx.restore();
  },
  setZoom: function setZoom(_scale) {
    if (this.changeDimensionOnZoom) {
      var _w = Math.round(this.originalWidth * _scale);
      var _h = Math.round(this.originalHeight * _scale);
      this.setDimensions({
        width: _w,
        height: _h
      });
    }
    this._zoomToPointNative(new fabric.Point(0, 0), _scale);
    //  this._setZoomNative(_scale);
    this.fire('viewport:scaled', { scale: _scale });
  },
  zoomToPoint: function zoomToPoint(point, newZoom) {
    var _max = this.getMaxZoom();
    var _min = this.getMinZoom().scale;
    if (newZoom > _max) {
      newZoom = _max;
    }
    if (newZoom < _min) {
      newZoom = _min;
    }
    this._zoomToPointNative(point, newZoom);
    for (var i in this._objects) {
      this._objects[i].setCoords();
    }
    this.fire('viewport:scaled', { scale: newZoom });
  },
  resetViewport: function resetViewport() {
    _canvas.viewportTransform[0] = 1;
    _canvas.viewportTransform[3] = 1;
    _canvas.viewportTransform[4] = 0;
    _canvas.viewportTransform[5] = 0;
    _canvas.renderAll();
    for (var i in this._objects) {
      this._objects[i].setCoords();
    }
  },
  zoomToPointEnabled: true,
  minZoomFactor: 1,
  maxZoom: 20,
  autoCenterAndZoomOutEnabled: false,
  getMaxZoom: function getMaxZoom() {
    return this.maxZoom;
  },
  getMinZoom: function getMinZoom() {
    var _containerSize = {
      width: $(this.wrapperEl).width(),
      height: $(this.wrapperEl).height()
    };
    var _bgSize = {
      width: this.originalWidth,
      height: this.originalHeight
    };
    var _maxSize = {
      width: _containerSize.width * this.minZoomFactor,
      height: _containerSize.height * this.minZoomFactor
    };

    return fabric.util.getProportions(_bgSize, _maxSize, 'fit');
  },
  centerAndZoomOut: function centerAndZoomOut() {

    if (this.virtual) {
      return;
    }
    var options = this.getMinZoom();

    var _containerSize = {
      width: $(this.wrapperEl).width(),
      height: $(this.wrapperEl).height()
    };

    var vpt = this.viewportTransform.slice(0);
    vpt[0] = options.scale;
    vpt[3] = options.scale;
    vpt[4] = (_containerSize.width - options.width) / 2;
    vpt[5] = (_containerSize.height - options.height) / 2;

    this.setViewportTransform(vpt);

    this._update_background_image();
    // this.fire("viewport:scaled",{scale: options.scale})
    //this.renderAll();
  },
  centerOnObject: function centerOnObject(tag) {
    var br = tag.getBoundingRect();
    var ct = this.viewportTransform;
    br.width /= ct[0];
    br.height /= ct[3];
    var size = {
      width: br.width * 1.1,
      height: br.height * 1.1
    };

    var prop = fabric.util.getProportions(size, this);
    var _w = (this.width / prop.scale - size.width) / 2;
    var _h = (this.height / prop.scale - size.height) / 2;
    var _l = (br.left - ct[4]) / ct[0];
    var _t = (br.top - ct[5]) / ct[3];

    var x1 = [prop.scale, 0, 0, prop.scale, -tag.left * prop.scale + (tag.width * 0.05 + _w) * prop.scale, -tag.top * prop.scale + (tag.height * 0.05 + _h) * prop.scale];
    var x2 = [prop.scale, 0, 0, prop.scale, -_l * prop.scale + (br.width * 0.05 + _w) * prop.scale, -_t * prop.scale + (br.height * 0.05 + _h) * prop.scale];

    this.setViewportTransform(x2);
    this.fire("viewport:scaled", { scale: prop.scale });
    this.renderAll();
  },

  __onMouseWheel: function __onMouseWheel(event) {

    if (!this.mouseWheelEnabled || this.zoomCtrlKey && !event.ctrlKey) {
      return;
    }
    //Find nearest point, that is inside image END
    var zoomStep; // = 0.1 * event.deltaY;
    if (event.deltaY < 0) {
      zoomStep = 1.1;
    } else {
      zoomStep = 0.9;
    }

    var newZoom = this.getZoom() * zoomStep;
    var minZoom = this.getMinZoom().scale;

    if (this.zoomToPointEnabled) {
      var point = new fabric.Point(event.offsetX, event.offsetY);
      var _x = this.viewportTransform[4];
      var _y = this.viewportTransform[5];

      // Find nearest point, that is inside image BEGIN
      // It is needed to prevent canvas to zoom outside image
      var _w = this.originalWidth * this.getZoom() + _x;
      var _h = this.originalHeight * this.getZoom() + _y;

      if (point.x < _x) {
        point.x = _x;
      }
      if (point.y < _y) {
        point.y = _y;
      }
      if (point.x > _w) {
        point.x = _w;
      }
      if (point.y > _h) {
        point.y = _h;
      }
      if (minZoom > newZoom) {
        if (this.autoCenterAndZoomOutEnabled) {
          this.centerAndZoomOut();
        }
      } else {
        this.zoomToPoint(point, newZoom);
      }
    } else {
      this.setZoom(newZoom);
    }

    for (var i in this._objects) {
      this._objects[i].setCoords();
    }
    this.renderAll();
    event.stopPropagation();
    event.preventDefault();
    return false; //preventing scroll page
  },
  scaleFactor: 1.1,
  getOrignalCenter: function getOrignalCenter() {
    var point = this.getCenter();
    point.left += this.viewportTransform[4];
    point.top += this.viewportTransform[5];
    return point;
  }
});

fabric.util.object.extend(fabric.SlideCanvas.prototype.actions, {
  zoomOut: {
    className: 'fa fa-search-minus',
    title: 'zoom-out',
    action: function action(m) {
      var point = this.getOrignalCenter();
      var scaleValue = this.getZoom() / this.scaleFactor;
      this.zoomToPoint({ x: point.left, y: point.top }, scaleValue);
    }
  },
  zoomNumber: {
    type: 'number',
    value: {
      min: function min() {
        return 0.01;
      },
      max: function max() {
        return 10;
      },
      set: function set(val) {
        this.setZoom(val);
      },
      get: function get() {
        return this.getZoom();
      },
      observe: "viewport:scaled"
    }
  },
  zoomIn: {
    className: 'fa fa-search-plus',
    title: 'zoom-in',
    action: function action(m) {
      var point = this.getOrignalCenter();
      var scaleValue = this.getZoom() * this.scaleFactor;
      this.zoomToPoint({ x: point.left, y: point.top }, scaleValue);
    }
    // zoom: {
    //   title: "zoom",
    //   menu: zoomOut
    // }
  } });
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 57 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {/**
* InteractiveMode mixin. Allow to switch between pan/edit/drawing canvas modes.
*/



var _mouse_down_overwritten = fabric.Canvas.prototype._onMouseDown;
var _mouse_up_overwritten = fabric.Canvas.prototype._onMouseUp;
var _mouse_move_overwritten = fabric.Canvas.prototype._onMouseMove;

fabric.util.object.extend(fabric.SlideCanvas.prototype, {
  _initEventListeners_overwritten: fabric.Canvas.prototype._initEventListeners,
  _initEventListeners: function _initEventListeners() {
    this._initEventListeners_overwritten();
    this.___onKeyDown = this._onKeyDown.bind(this);
    fabric.util.addListener(fabric.window, 'keydown', this.___onKeyDown);
  },
  _removeListeners_overwritten: fabric.Canvas.prototype.removeListeners,
  removeListeners: function removeListeners() {
    this._removeListeners_overwritten();
    fabric.util.removeListener(fabric.window, 'keydown', this.___onKeyDown);
  },
  _onKeyDown: function _onKeyDown(e) {
    return this._applyMixedMode(e);
  },
  getInteractiveMode: function getInteractiveMode() {
    return this.interactiveMode;
  },
  setInteractiveMode: function setInteractiveMode(tool) {
    //todo checkthis out
    // if (tool === 'hand') {
    //   this.setCursor('pointer');
    // }
    this.isDrawingMode = tool === 'draw';
    this.isHandMode = tool === 'hand';
    this.interactive = tool !== 'disabled';
    this.isMixedMode = tool === 'mixed';

    if (!this.interactive) {
      this.upperCanvasEl.style.cursor = 'default';
    }
    this.interactiveMode = tool;
  },

  /**
   *  current mode
   *  @values default | hand | selection
   *  @comment
   *      hand      - moving canvas
   *      draw - drawing reactangles
   *      selection - default behavior
   */
  interactiveMode: 'default',

  isHandMode: false,
  _handModeCursorMove: false,
  _handModeCursorDown: false,
  _handModeCursorPosition: { x: 0, y: 0 },
  _handModeMouseMove: function _handModeMouseMove(e) {
    if (this._handModeCursorDown === true) {

      if (e.pageY === this._handModeCursorPosition.y && e.pageX === this._handModeCursorPosition.x) {
        return;
      }

      this._handModeCursorMove = true;

      var scroll = { x: this.viewportTransform[4], y: this.viewportTransform[5] };

      var newScroll = {
        x: scroll.x - (this._handModeCursorPosition.x - e.pageX),
        y: scroll.y - (this._handModeCursorPosition.y - e.pageY)
      };

      var dims = {
        width: this.size.width * this.zoom - this.lowerCanvasEl.width,
        height: this.size.height * this.zoom - this.lowerCanvasEl.height
      };
      /*  todo need to add some restrictions later
       //Math.max(Math.min(0,newScroll.x),-dims.width);
       //Math.max(Math.min(0,newScroll.y),-dims.height);
       */
      this.viewportTransform[4] = newScroll.x;
      this.viewportTransform[5] = newScroll.y;

      this.fire('viewport:translate');

      this.renderAll();
      for (var i = 0, len = this._objects.length; i < len; i++) {
        this._objects[i].setCoords();
      }

      this._handModeCursorPosition.y = e.pageY;
      this._handModeCursorPosition.x = e.pageX;
    }
  },
  _handModeMouseUp: function _handModeMouseUp() {
    this._handModeCursorDown = false;
    if (!this._handModeCursorMove) {}
  },
  _handModeMouseDown: function _handModeMouseDown(e) {

    this._handModeCursorMove = false;
    this._handModeCursorDown = true;
    this._handModeCursorPosition = {
      y: e.pageY,
      x: e.pageX
    };
  },
  handModeEnabled: false,
  handModeKey: "Alt",
  _applyMixedMode: function _applyMixedMode(e) {
    this._current_target = this.findTarget(e);

    if (this.handModeEnabled && e.altKey || e.key === this.handModeKey) {
      //if shift use hand mode
      if (!this.isHandMode) {
        this.isHandMode = true;
        this.isDrawingMode = false;
        this.setCursor('pointer');
      }
    } else if (this.isMixedMode && !this._isCurrentlyDrawing && !this._currentTransform) {

      this.isHandMode = false;

      if (this._current_target) {
        if (this.freeDrawingBrush && this._current_target.allowDrawing) {
          var corner = this._current_target._findTargetCorner(this.getPointer(e, true));
          if (!corner) {
            this.isDrawingMode = true;
          } else {
            this.isDrawingMode = false;
          }
        } else if (this.isDrawingMode) {
          this.isDrawingMode = false;
        }
      } else {
        if (this.freeDrawingBrush && !this.isDrawingMode) {
          this.setCursor(this.freeDrawingCursor);
          this.isDrawingMode = true;
        }
      }
    } else {
      this.isHandMode = false;
    }
  },
  _onMouseMove: function _onMouseMove(e) {
    if (!this.interactive) {
      return;
    }

    this._applyMixedMode(e);

    if (this.isHandMode) {

      if (this._current_target && this._current_target.selectable_overwritten) {
        this._current_target.selectable = true;
      }

      if (this._handModeActive) {
        return this._handModeMouseMove(e);
      }
      this.fire('mouse:move', { target: this._current_target, e: e });
      this._current_target && this._current_target.fire('mousemove', { e: e });
      return true;
    } else {
      return _mouse_move_overwritten.call(this, e);
    }
  }, /**
     * @private
     */
  _onScale: function _onScale(e, transform, x, y) {

    var useUniScale = e.shiftKey ^ this.shiftInverted;
    // rotate object only if shift key is not pressed
    // and if it is not a group we are transforming
    if ((useUniScale || this.uniScaleTransform) && !transform.target.get('lockUniScaling')) {
      transform.currentAction = 'scale';
      return this._scaleObject(x, y);
    } else {
      // Switch from a normal resize to proportional
      if (!transform.reset && transform.currentAction === 'scale') {
        this._resetCurrentTransform(e);
      }

      transform.currentAction = 'scaleEqually';
      return this._scaleObject(x, y, 'equally');
    }
  },
  shiftInverted: false,
  _setCursorFromEvent_overwritten: fabric.Canvas.prototype._setCursorFromEvent,
  _setCursorFromEvent: function _setCursorFromEvent(e, target) {
    if (this.isHandMode) {
      this.setCursor('pointer');
    } else {
      this._setCursorFromEvent_overwritten(e, target);
    }
  },
  _onMouseDown: function _onMouseDown(e) {
    if (!this.interactive) {
      return;
    }

    e.preventDefault();
    e.stopPropagation();

    this._applyMixedMode(e);
    if (this.isHandMode && this._current_target) {
      this._current_target.selectable_overwritten = this._current_target.selectable;
      this._current_target.selectable = false;
    }

    _mouse_down_overwritten.call(this, e);

    if (this.isHandMode) {

      if (this._current_target && this._current_target.selectable_overwritten) {
        this._current_target.selectable = true;
      }
      this._handModeActive = true;
      this._handModeMouseDown(e);
    }
  },

  _onMouseUp: function _onMouseUp(e) {
    if (!this.interactive) {
      return;
    }
    e.preventDefault();
    e.stopPropagation();
    _mouse_up_overwritten.call(this, e);

    if (this.isHandMode) {
      this._handModeActive = false;
    }
  }
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 58 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

/**
   * Draw CSS3 border image on canvas.
   * @param canvas    {HTMLCanvasElement}
   * @param img       {HTMLImageElement} border-image-source image
   * @param options   {Object}
   *      slice {Array} border-image-slice values
   *      width {Array} border-image-width values
   *      outset {Array} border-image-outset values
   *      repeat {Array} border-image-repeat values
   * @param size      {Object}
   */

fabric.util.drawBorderImage = function (canvas, img, options) {

  var options = fabric.util.object.extend({
    "slice": [25, 25, 25, 25],
    "width": [25, 25, 25, 25],
    "fill": false,
    "repeat": ["round", "round"],
    "outset_values": [0, 0, 0, 0],
    "slice_units": [0, 0, 0, 0],
    "width_units": [0, 0, 0, 0],
    "outset_units": [0, 0, 0, 0],
    "size": [canvas.width, canvas.height]
  }, options);

  var w = img.width;
  var h = img.height;

  var ctx = canvas.getContext("2d");
  var slice = options.slice;
  var width = options.width;

  var w2 = options.size[0];
  var h2 = options.size[1];

  if (options.slice_units[0] == 1) slice[0] *= h / 100;
  if (options.slice_units[1] == 1) slice[1] *= w / 100;
  if (options.slice_units[2] == 1) slice[2] *= h / 100;
  if (options.slice_units[3] == 1) slice[3] *= w / 100;

  if (options.width_units[0] == 1) width[0] *= h2 / 100;
  if (options.width_units[1] == 1) width[1] *= w2 / 100;
  if (options.width_units[2] == 1) width[2] *= h2 / 100;
  if (options.width_units[3] == 1) width[3] *= w2 / 100;

  function drawSide(side, sliceOffset, sliceWidth, drawOffset, drawWidth) {
    var d;
    if (side == 0) {
      d = [slice[3] + sliceOffset, 0, sliceWidth, slice[0], width[3] + drawOffset, 0, drawWidth, width[0]];
    }
    if (side == 2) {
      d = [slice[3] + sliceOffset, h - slice[2], sliceWidth, slice[2], width[3] + drawOffset, h2 - width[2], drawWidth, width[2]];
    }
    if (side == 1) {
      d = [w - slice[1], slice[0] + sliceOffset, slice[1], sliceWidth, w2 - width[1], width[0] + drawOffset, width[1], drawWidth];
    }
    if (side == 3) {
      d = [0, slice[0] + sliceOffset, slice[3], sliceWidth, 0, width[0] + drawOffset, width[3], drawWidth];
    }
    ctx.drawImage(img, d[0], d[1], d[2], d[3], d[4], d[5], d[6], d[7]);
  }

  function _draw_border_side(side) {
    var _top_width, _top_slice, repeat;
    if (side == 0 || side == 2) {
      _top_width = w2 - width[1] - width[3];
      _top_slice = w - slice[1] - slice[3];
      repeat = options.repeat[0];
    } else {
      _top_width = h2 - width[0] - width[2];
      _top_slice = h - slice[0] - slice[2];
      repeat = options.repeat[1];
    }

    if (repeat == "stretch") {
      return drawSide(side, 0, _top_slice, 0, _top_width);
    }

    var _aspect = slice[side] / width[side];
    var _one_width = _top_slice * width[side] / slice[side];
    var count = 1;
    var _left = 0;

    if (repeat == "repeat") {

      var _rest = _one_width - _top_width % _one_width / 2;
      var _rest_aspect = _aspect * _rest;
      count = Math.floor(_top_width / _one_width);

      if (_rest > 0) {
        drawSide(side, _rest_aspect, _top_slice - _rest_aspect, 0, _one_width - _rest);
      }

      _left = _one_width - _rest;

      for (var i = 0; i < count; i++) {
        drawSide(side, 0, _top_slice, _left, _one_width);
        _left += _one_width;
      }

      if (_rest > 0) {
        drawSide(side, 0, _top_slice - _rest_aspect, _left, _one_width - _rest);
      }
    }
    if (repeat == "round") {

      _left = 0;
      count = Math.max(1, Math.round(_top_width / _one_width));
      _one_width = _top_width / count;

      while (_left < _top_width) {
        drawSide(side, 0, _top_slice, _left, _one_width);
        _left += _one_width;
      }
    }
  }

  _draw_border_side(0);
  _draw_border_side(2);
  _draw_border_side(1);
  _draw_border_side(3);

  //top left
  ctx.drawImage(img, 0, 0, slice[3], slice[0], 0, 0, width[3], width[0]);
  //top right
  ctx.drawImage(img, w - slice[1], 0, slice[1], slice[0], w2 - width[1], 0, width[1], width[0]);
  //bottom left
  ctx.drawImage(img, 0, h - slice[2], slice[3], slice[2], 0, h2 - width[2], width[3], width[2]);

  //bottom right
  ctx.drawImage(img, w - slice[1], h - slice[2], slice[1], slice[2], w2 - width[1], h2 - width[2], width[1], width[2]);
};

/*
 var Frame = function(project,data){
  if(data.border_image){
 data.border_image = mixin( {
 "slice":          [25,25,25,25],
 "width":          [25,25,25,25],
 "fill":           false,
 "repeat":         ["round","round"],
 "outset"	:     [0, 0, 0, 0],
 "slice_units"   : [0, 0, 0, 0],
 "width_units"	: [0, 0, 0, 0],
 "outset_units"	: [0, 0, 0, 0]
 }, data.border_image)
 }
   this.superclass.constructor.call(this,project,data);
 this._add_root("mask");
 this._add_root("image");
 this.example = this._get_example();
  };*/
fabric.util.getOffsetsClipPath = function (o) {

  return ['M', o[3], o[0], 'L', 100 - o[1], o[0], 'L', 100 - o[1], 100 - o[2], 'L', o[3], 100 - o[2], 'z'].join(" ");
};

fabric.util.getRadiusClipPath = function (radius, radius_units, width, height) {

  var br = radius;
  var bru = radius_units || [1, 1, 1, 1, 1, 1, 1, 1];

  var s = {
    "top-left-h": br[0] * (bru[0] ? height / 100 : 1),
    "top-left-w": br[1] * (bru[1] ? width / 100 : 1),
    "top-right-h": br[2] * (bru[2] ? height / 100 : 1),
    "top-right-w": br[3] * (bru[3] ? width / 100 : 1),
    "bottom-right-w": br[4] * (bru[4] ? width / 100 : 1),
    "bottom-right-h": br[5] * (bru[5] ? height / 100 : 1),
    "bottom-left-w": br[6] * (bru[6] ? width / 100 : 1),
    "bottom-left-h": br[7] * (bru[7] ? height / 100 : 1)
  };

  return ["M", 0, s["top-left-h"], "C", 0, s["top-left-h"], 0, 0, s["top-left-w"], 0, "H", width - s["top-right-w"], "C", width - s["top-right-w"], 0, width, 0, width, s["top-right-h"], "V", height - s["bottom-right-h"], "C", width, height - s["bottom-right-h"], width, height, width - s["bottom-right-w"], height, "H", s["bottom-left-w"], "C", s["bottom-left-w"], height, 0, height, 0, height - s["bottom-left-h"], "Z"].join(" ");
};
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 59 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

if (typeof saveAs == "undefined") {
  fabric.saveAs = __webpack_require__(60).saveAs;
} else {
  fabric.saveAs = saveAs;
}

fabric.util.object.extend(fabric.SlideCanvas.prototype, {
  insertRenderArea: false,
  insertRenderFull: false
});

fabric.util.object.extend(fabric.SlideCanvas.prototype.actions, {
  renderArea: {
    className: 'fa fa-download',
    title: 'download',
    action: function action() {
      fabric.saveAs(this.getImageData({
        clipped_area: this.activeArea,
        zoom: this.dotsPerUnit,
        clipped_area_only: true,
        draw_background: true
      }).blob, this.title);
    }
  },
  renderFull: {
    title: 'download with background',
    action: function action() {
      fabric.saveAs(this.getImageData({
        zoom: this.dotsPerUnit,
        clipped_area_only: false,
        draw_background: true
      }).blob, this.title);
    }
  }
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 60 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;

/* FileSaver.js
 * A saveAs() FileSaver implementation.
 * 1.1.20150716
 *
 * By Eli Grey, http://eligrey.com
 * License: X11/MIT
 *   See https://github.com/eligrey/FileSaver.js/blob/master/LICENSE.md
 */

/*global self */
/*jslint bitwise: true, indent: 4, laxbreak: true, laxcomma: true, smarttabs: true, plusplus: true */

/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */

var isLikelyNode = typeof Buffer !== 'undefined' && typeof window === 'undefined';

var saveAs = !isLikelyNode && function (view) {
    "use strict";
    // IE <10 is explicitly unsupported

    if (typeof navigator !== "undefined" && /MSIE [1-9]\./.test(navigator.userAgent)) {
        return;
    }
    var doc = view.document
    // only get URL when necessary in case Blob.js hasn't overridden it yet
    ,
        get_URL = function get_URL() {
        return view.URL || view.webkitURL || view;
    },
        save_link = doc.createElementNS("http://www.w3.org/1999/xhtml", "a"),
        can_use_save_link = "download" in save_link,
        click = function click(node) {
        var event = new MouseEvent("click");
        node.dispatchEvent(event);
    },
        webkit_req_fs = view.webkitRequestFileSystem,
        req_fs = view.requestFileSystem || webkit_req_fs || view.mozRequestFileSystem,
        throw_outside = function throw_outside(ex) {
        (view.setImmediate || view.setTimeout)(function () {
            throw ex;
        }, 0);
    },
        force_saveable_type = "application/octet-stream",
        fs_min_size = 0
    // See https://code.google.com/p/chromium/issues/detail?id=375297#c7 and
    // https://github.com/eligrey/FileSaver.js/commit/485930a#commitcomment-8768047
    // for the reasoning behind the timeout and revocation flow
    ,
        arbitrary_revoke_timeout = 500 // in ms
    ,
        revoke = function revoke(file) {
        var revoker = function revoker() {
            if (typeof file === "string") {
                // file is an object URL
                get_URL().revokeObjectURL(file);
            } else {
                // file is a File
                file.remove();
            }
        };
        if (view.chrome) {
            revoker();
        } else {
            setTimeout(revoker, arbitrary_revoke_timeout);
        }
    },
        dispatch = function dispatch(filesaver, event_types, event) {
        event_types = [].concat(event_types);
        var i = event_types.length;
        while (i--) {
            var listener = filesaver["on" + event_types[i]];
            if (typeof listener === "function") {
                try {
                    listener.call(filesaver, event || filesaver);
                } catch (ex) {
                    throw_outside(ex);
                }
            }
        }
    },
        auto_bom = function auto_bom(blob) {
        // prepend BOM for UTF-8 XML and text/* types (including HTML)
        if (/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(blob.type)) {
            return new Blob(['\uFEFF', blob], { type: blob.type });
        }
        return blob;
    },
        FileSaver = function FileSaver(blob, name, no_auto_bom) {
        if (!no_auto_bom) {
            blob = auto_bom(blob);
        }
        // First try a.download, then web filesystem, then object URLs
        var filesaver = this,
            type = blob.type,
            blob_changed = false,
            object_url,
            target_view,
            dispatch_all = function dispatch_all() {
            dispatch(filesaver, "writestart progress write writeend".split(" "));
        }
        // on any filesys errors revert to saving with object URLs
        ,
            fs_error = function fs_error() {
            // don't create more object URLs than needed
            if (blob_changed || !object_url) {
                object_url = get_URL().createObjectURL(blob);
            }
            if (target_view) {
                target_view.location.href = object_url;
            } else {
                var new_tab = view.open(object_url, "_blank");
                if (new_tab == undefined && typeof safari !== "undefined") {
                    //Apple do not allow window.open, see http://bit.ly/1kZffRI
                    view.location.href = object_url;
                }
            }
            filesaver.readyState = filesaver.DONE;
            dispatch_all();
            revoke(object_url);
        },
            abortable = function abortable(func) {
            return function () {
                if (filesaver.readyState !== filesaver.DONE) {
                    return func.apply(this, arguments);
                }
            };
        },
            create_if_not_found = { create: true, exclusive: false },
            slice;
        filesaver.readyState = filesaver.INIT;
        if (!name) {
            name = "download";
        }
        if (can_use_save_link) {
            object_url = get_URL().createObjectURL(blob);
            save_link.href = object_url;
            save_link.download = name;
            setTimeout(function () {
                click(save_link);
                dispatch_all();
                revoke(object_url);
                filesaver.readyState = filesaver.DONE;
            });
            return;
        }
        // Object and web filesystem URLs have a problem saving in Google Chrome when
        // viewed in a tab, so I force save with application/octet-stream
        // http://code.google.com/p/chromium/issues/detail?id=91158
        // Update: Google errantly closed 91158, I submitted it again:
        // https://code.google.com/p/chromium/issues/detail?id=389642
        if (view.chrome && type && type !== force_saveable_type) {
            slice = blob.slice || blob.webkitSlice;
            blob = slice.call(blob, 0, blob.size, force_saveable_type);
            blob_changed = true;
        }
        // Since I can't be sure that the guessed media type will trigger a download
        // in WebKit, I append .download to the filename.
        // https://bugs.webkit.org/show_bug.cgi?id=65440
        if (webkit_req_fs && name !== "download") {
            name += ".download";
        }
        if (type === force_saveable_type || webkit_req_fs) {
            target_view = view;
        }
        if (!req_fs) {
            fs_error();
            return;
        }
        fs_min_size += blob.size;
        req_fs(view.TEMPORARY, fs_min_size, abortable(function (fs) {
            fs.root.getDirectory("saved", create_if_not_found, abortable(function (dir) {
                var save = function save() {
                    dir.getFile(name, create_if_not_found, abortable(function (file) {
                        file.createWriter(abortable(function (writer) {
                            writer.onwriteend = function (event) {
                                target_view.location.href = file.toURL();
                                filesaver.readyState = filesaver.DONE;
                                dispatch(filesaver, "writeend", event);
                                revoke(file);
                            };
                            writer.onerror = function () {
                                var error = writer.error;
                                if (error.code !== error.ABORT_ERR) {
                                    fs_error();
                                }
                            };
                            "writestart progress write abort".split(" ").forEach(function (event) {
                                writer["on" + event] = filesaver["on" + event];
                            });
                            writer.write(blob);
                            filesaver.abort = function () {
                                writer.abort();
                                filesaver.readyState = filesaver.DONE;
                            };
                            filesaver.readyState = filesaver.WRITING;
                        }), fs_error);
                    }), fs_error);
                };
                dir.getFile(name, { create: false }, abortable(function (file) {
                    // delete file if it already exists
                    file.remove();
                    save();
                }), abortable(function (ex) {
                    if (ex.code === ex.NOT_FOUND_ERR) {
                        save();
                    } else {
                        fs_error();
                    }
                }));
            }), fs_error);
        }), fs_error);
    },
        FS_proto = FileSaver.prototype,
        saveAs = function saveAs(blob, name, no_auto_bom) {
        return new FileSaver(blob, name, no_auto_bom);
    };
    // IE 10+ (native saveAs)
    if (typeof navigator !== "undefined" && navigator.msSaveOrOpenBlob) {
        return function (blob, name, no_auto_bom) {
            if (!no_auto_bom) {
                blob = auto_bom(blob);
            }
            return navigator.msSaveOrOpenBlob(blob, name || "download");
        };
    }

    FS_proto.abort = function () {
        var filesaver = this;
        filesaver.readyState = filesaver.DONE;
        dispatch(filesaver, "abort");
    };
    FS_proto.readyState = FS_proto.INIT = 0;
    FS_proto.WRITING = 1;
    FS_proto.DONE = 2;

    FS_proto.error = FS_proto.onwritestart = FS_proto.onprogress = FS_proto.onwrite = FS_proto.onabort = FS_proto.onerror = FS_proto.onwriteend = null;

    return saveAs;
}(typeof self !== "undefined" && self || typeof window !== "undefined" && window || undefined.content);
// `self` is undefined in Firefox for Android content script context
// while `this` is nsIContentFrameMessageManager
// with an attribute `content` that corresponds to the window

if (typeof module !== "undefined" && module.exports) {
    module.exports.saveAs = saveAs;
} else if ("function" !== "undefined" && __webpack_require__(61) !== null && __webpack_require__(62) != null) {
    !(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_AMD_DEFINE_RESULT__ = function () {
        return saveAs;
    }.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),
				__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));
}

/***/ }),
/* 61 */
/***/ (function(module, exports) {

module.exports = function() {
	throw new Error("define cannot be used indirect");
};


/***/ }),
/* 62 */
/***/ (function(module, exports) {

/* WEBPACK VAR INJECTION */(function(__webpack_amd_options__) {/* globals __webpack_amd_options__ */
module.exports = __webpack_amd_options__;

/* WEBPACK VAR INJECTION */}.call(exports, {}))

/***/ }),
/* 63 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.util.object.extend(fabric.BaseBrush.prototype, {
  useDrawingColor: true,
  setOptions: function setOptions(options) {
    for (var prop in options) {
      this[prop] = options[prop];
    }
  },
  type: "base-brush",
  initialize: function initialize(canvas, options) {
    this.canvas = canvas;
    options = options || {};
    if (this.canvas.application) {
      this.canvas.application.fire("entity:created", { target: this, options: options });
    }
    this.setOptions(options);
  },
  convertColor: function convertColor(color, type) {
    type = type || "name";
    if (color instanceof Array) {
      if (type == "source") {
        return color;
      }
      color = "#" + fabric.Color.fromSource(color).toHex();
    }
    if (type == "hex" || type == "source") {
      if (fabric.Color.colorNameMap[color]) {
        color = fabric.Color.colorNameMap[color];
      }
      if (type == "source") {
        if (color == "transparent") {
          return [0, 0, 0, 0];
        }
        var _source = fabric.Color.fromHex(color).getSource();
        _source[3] *= 255;
        return _source;
      }
    }
    return color;
  },
  getColor: function getColor(type) {
    var color = this.useDrawingColor && this.canvas.drawingColor || this.color;
    return this.convertColor(color, type);
  }
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 64 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.PencilBrush.prototype.initialize = function (canvas) {
  this.callSuper('initialize', canvas);
  this._points = [];
};
fabric.PencilBrush.prototype.type = 'pencil-brush';

fabric.PencilBrush.prototype._render = function () {
  var ctx = this.canvas.contextTop,
      v = this.canvas.viewportTransform,
      p1 = this._points[0],
      p2 = this._points[1];
  ctx.save();
  ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);
  ctx.beginPath();
  ctx.lineWidth = 1 / this.canvas.viewportTransform[0];
  if (this._points.length === 2 && p1.x === p2.x && p1.y === p2.y) {
    p1.x -= 0.5 / this.canvas.viewportTransform[0];
    p2.x += 0.5 / this.canvas.viewportTransform[0];
  }
  ctx.moveTo(p1.x, p1.y);
  for (var i = 1, len = this._points.length; i < len; i++) {
    var midPoint = p1.midPointFrom(p2);
    ctx.quadraticCurveTo(p1.x, p1.y, midPoint.x, midPoint.y);
    p1 = this._points[i];
    p2 = this._points[i + 1];
  }
  ctx.lineTo(p1.x, p1.y);
  ctx.stroke();
  ctx.restore();
};

fabric.PencilBrush.prototype.createPath = function (pathData) {
  var path = new fabric.Path(pathData, {
    stroke: this.getColor(),
    strokeWidth: this.width,
    application: this.canvas.application
  });
  if (this.shadow) {
    this.shadow.affectStroke = true;
    path.setShadow(this.shadow);
  }
  return path;
};
fabric.PencilBrush.prototype.minLength = 3;

fabric.PencilBrush.prototype.accuracy = 0;
fabric.PencilBrush.prototype._finalizeAndAddPath = function () {
  if (this._points.length < 2) return;
  var ctx = this.canvas.contextTop;
  ctx.closePath();
  this.canvas.clearContext(this.canvas.contextTop);
  if (this.accuracy) {
    for (var i in this._points) {
      this._points[i].x = +this._points[i].x.toFixed(this.accuracy);
      this._points[i].y = +this._points[i].y.toFixed(this.accuracy);
    }
    for (i = this._points.length - 1; i--;) {
      if (this._points[i].x == this._points[i + 1].x && this._points[i].y == this._points[i + 1].y) {
        this._points.splice(i, 1);
      }
    }
  }
  if (this._points.length < 2) return;
  var pathData = this.convertPointsToSVGPath(this._points).join('');
  if (this._points.length < this.minLength || pathData === 'M 0 0 Q 0 0 0 0 L 0 0') {
    return this.canvas.renderAll();
  }
  var path = this.createPath(pathData);
  this.canvas.add(path);
  path.setCoords();
  this._resetShadow();
  this.canvas.renderAll();
  this.canvas.fire('path:created', { path: path });
};

fabric.SlideCanvas.prototype.drawingTools.PencilBrush = {
  className: 'fa fa-pencil',
  title: 'Pencil Brush'
};
fabric.SlideCanvas.prototype.activeDrawingTools.push("PencilBrush");
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 65 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

/**
 * PencilBrush class
 * @class fabric.RectangleBrush
 * @extends fabric.BaseBrush
 */

fabric.RectangleBrush = fabric.util.createClass(fabric.BaseBrush, /** @lends fabric.RectangleBrush.prototype */{
  resultObjectType: "Rect",
  type: "rectangle-brush",
  /**
   * Constructor
   * @param {fabric.Canvas} canvas
   * @return {fabric.RectangleBrush} Instance of a pencil brush
   */
  initialize: function initialize(canvas) {
    this.callSuper('initialize', canvas);
  },

  /**
   * Inovoked on mouse down
   * @param {Object} pointer
   */
  onMouseDown: function onMouseDown(pointer) {
    //prepare for drawing
    delete this.p2;

    this.p1 = new fabric.Point(pointer.x, pointer.y);
    this._setBrushStyles();
    this._setShadow();
    this.canvas.contextTop.moveTo(this.p1.x, this.p1.y);
    this._render();
  },

  /**
   * Inovoked on mouse move
   * @param {Object} pointer
   */
  onMouseMove: function onMouseMove(pointer) {

    this.p2 = new fabric.Point(pointer.x, pointer.y);

    if (this.drawingObject) {
      var _rect = this._getRect();
      this.drawingObject.set(_rect);
      this.drawingObject.fire("scaling");
    } else {

      if (this.p1.x === this.p2.x && this.p1.y === this.p2.y) {
        delete this.p2;
      } else {

        if (this.resultObjectType) {
          var _rect = this._getRect();
          this.drawingObject = this._createRectangle(_rect);
        }
      }
    }
    this.canvas.renderLayer("lower");
  },

  /**
   * Invoked on mouse up
   */
  onMouseUp: function onMouseUp() {
    if (this.drawingObject) {
      var _rect = this._getRect();
      var _rect2 = this._checkRectangle(_rect);

      this.canvas.layers.lower.objects.splice(this.canvas.layers.lower.objects.indexOf(this.drawingObject), 1);

      this.drawingObject.set(_rect2);
      this.canvas.add(this.drawingObject);
      this.canvas.setActiveObject(this.drawingObject);
      this.drawingObject.setCoords();
      delete this.drawingObject;
    }
    this.canvas.renderAll();
    // this._finalizeAndAddPath();
  },

  /**
   * Draw a smooth path on the topCanvas using quadraticCurveTo
   * @private
   */
  _render: function _render() {
    this.canvas.fire("before:brush:render", { target: this });
    if (!this.p2) {
      return;
    }
    var ctx = this.canvas.contextTop,
        v = this.canvas.viewportTransform,
        p1 = this.p1,
        p2 = this.p2;

    ctx.save();
    ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);
    ctx.beginPath();
    if (this.application) {
      var _klass_proto = this.application.getDefaultProperties(fabric[this.resultObjectType].prototype) || {};
      ctx.lineWidth = _klass_proto.strokeWidth;
      ctx.strokeStyle = _klass_proto.stroke;
      ctx.fillStyle = _klass_proto.fill;
    }

    var _rect = this._getRect();
    ctx.rect(_rect.left, _rect.top, _rect.width, _rect.height);

    ctx.fill();
    ctx.stroke();
    ctx.restore();
    this.canvas.fire("brush:render", { target: this });
  },
  _getRect: function _getRect() {

    var x1, x2, y1, y2;
    if (this.p1.x < this.p2.x) {
      x1 = this.p1.x, x2 = this.p2.x;
    } else {
      x2 = this.p1.x, x1 = this.p2.x;
    }
    if (this.p1.y < this.p2.y) {
      y1 = this.p1.y, y2 = this.p2.y;
    } else {
      y2 = this.p1.y, y1 = this.p2.y;
    }
    return {
      left: x1,
      top: y1,
      width: x2 - x1,
      height: y2 - y1
    };
  },
  drawingLimits: null, /*{
                       left: 0,
                       width: 0,
                       height: 0,
                       top: 0
                       },*/
  minHeight: 50,
  minWidth: 50,
  _checkRectangle: function _checkRectangle(_rect) {

    var dl = this.drawingLimits;
    if (dl && dl == "backgroundImage") {
      dl = this.canvas.backgroundImage;
    }

    _rect = {
      left: _rect.left,
      top: _rect.top,
      width: _rect.width,
      height: _rect.height
    };

    // _rect.left  -= fabric.Rect.prototype.strokeWidth / 2;
    // _rect.top   -= fabric.Rect.prototype.strokeWidth / 2;

    if (dl) {
      if (_rect.left + _rect.width < dl.left || _rect.top + _rect.height < dl.top || _rect.left > dl.width || _rect.top > dl.height) {
        return false;
      }

      if (_rect.top < dl.top) {
        _rect.height += _rect.top;
        _rect.top = dl.top;
      }
      if (_rect.left < dl.left) {
        _rect.width += _rect.left;
        _rect.left = dl.left;
      }
    }

    if (this.minWidth && _rect.width < this.minWidth) {
      _rect.width = this.minWidth;
    }
    if (this.minHeight && _rect.height < this.minHeight) {
      _rect.height = this.minHeight;
    }

    if (dl) {
      var _xdiff = _rect.left + _rect.width - dl.width;
      if (_xdiff > 0) {
        _rect.width -= _xdiff;
        if (this.minWidth && _rect.width < this.minWidth) {
          _rect.left -= this.minWidth - _rect.width;
          _rect.width = this.minWidth;
        }
      }
      var _ydiff = _rect.top + _rect.height - dl.height;
      if (_ydiff > 0) {
        _rect.height -= _ydiff;
        if (this.minHeight && _rect.height < this.minHeight) {
          _rect.top -= this.minHeight - _rect.height;
          _rect.height = this.minHeight;
        }
      }
    }
    return _rect;
  },
  _createRectangle: function _createRectangle(rect) {
    this.canvas.setActiveObject(false);
    rect.active = true;
    rect.application = this.application;
    rect.canvas = this.canvas;
    var _object = fabric.util.createObject(this.resultObjectType, rect);
    this.canvas.layers.lower.objects.push(_object);
    _object.updateResponsiveBorder();
    this.canvas.renderAll();
    return _object;
  }

  /**
   * On mouseup after drawing the path on contextTop canvas
   * we use the points captured to create an new fabric rect object
   * and add it to the fabric canvas.
   */
  // _finalizeAndAddPath: function () {
  //
  //   if (!this.p2) {
  //     return false;
  //   }
  //   var ctx = this.canvas.contextTop;
  //   ctx.closePath();
  //
  //
  //   this.canvas.clearContext(this.canvas.contextTop);
  //   this._resetShadow();
  //
  //   // var _rect = this._getRect();
  //   var _rect2 = this._checkRectangle(_rect);
  //   if(_rect2){
  //     // if(this.resultObjectType){
  //     //   this._createRectangle(_rect2);
  //     // }
  //     this.canvas.fire('rect:created', {rect: _rect2, original: _rect});
  //   }else{
  //     this.canvas.fire('rect:rejected', {rect: _rect});
  //   }
  //   this.canvas.renderLayer(this.layers.lower);
  // }
});

fabric.SlideCanvas.prototype.drawingTools.RectangleBrush = {
  className: 'fa fa-pencil-square',
  title: 'select-brush'
};
fabric.SlideCanvas.prototype.activeDrawingTools.push("RectangleBrush");
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 66 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

/**
 * PencilBrush class
 * @class fabric.RectangleBrush
 * @extends fabric.BaseBrush
 */

fabric.PolygonBrush = fabric.util.createClass(fabric.BaseBrush, /** @lends fabric.RectangleBrush.prototype */{
  resultObjectType: "Polyline",
  type: "polygon-brush",
  virtualObject: false,
  maximumPoints: 0,
  individualDrawing: true,
  /**
   * Constructor
   * @param {fabric.Canvas} canvas
   * @return {fabric.RectangleBrush} Instance of a pencil brush
   */
  initialize: function initialize(canvas) {
    this.callSuper('initialize', canvas);
    this.reset();
  },
  /**
   * Inovoked on mouse down
   * @param {Object} pointer
   */
  onMouseDown: function onMouseDown(pointer) {

    if (this.individualDrawing || !this.target) {
      var _point = { x: pointer.x, y: pointer.y };
      this.points.push(_point);
      if (!this.virtualObject) {
        this.target = this.canvas.createObject(fabric.util.object.extend({}, this.resultObjectProperties, {
          type: this.resultObjectType,
          points: [_point],
          active: true
        }));
      }
    } else {
      this._create_active_point(pointer);
    }

    if (this.virtualObject) {
      this._setBrushStyles();
      this._setShadow();
      this._render();
    } else {
      this.canvas.renderAll();
    }
  },

  _create_active_point: function _create_active_point(pointer) {
    var _point = { x: pointer.x, y: pointer.y };
    this.activePoint = _point;
    this.activeTargetPoint = { x: pointer.x - this.target.left, y: pointer.y - this.target.top };
    this.points.push(this.activePoint);
    this.target.addPoint(this.activeTargetPoint);
  },
  /**
   * Inovoked on mouse move
   * @param {Object} pointer
   */
  onMouseMove: function onMouseMove(pointer) {

    var _p = { x: pointer.x - this.target.left, y: pointer.y - this.target.top };

    if (this.activePoint) {
      this.activePoint.x = pointer.x;
      this.activePoint.y = pointer.y;
      var _order = this.target.points.length;

      this.target.setPoint("p" + _order, {
        x: pointer.x - this.target.left,
        y: pointer.y - this.target.top
      });
    } else {
      var _dist = fabric.Point.prototype.distanceFrom.call(this.points[0], _p);
      if (_dist > 10) {
        this._create_active_point(pointer);
      }
    }
    this.canvas.renderAll();
  },
  reset: function reset() {
    this.points = [];
    this.target = null;
    this.activePoint = null;
    this.activeTargetPoint = null;
  },
  /**
   * Invoked on mouse up
   */
  onMouseUp: function onMouseUp() {
    this.target.updateBbox();
    if (this.points.length == this.maximumPoints) {
      this.reset();
    }
    this.activePoint = null;
    this.canvas.renderAll();
  },

  /**
   * Draw a smooth path on the topCanvas using quadraticCurveTo
   * @private
   */
  _render: function _render() {
    this.canvas.fire("before:brush:render", { target: this });

    var ctx = this.canvas.contextTop,
        v = this.canvas.viewportTransform;

    ctx.save();
    ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);

    var _klass_proto = fabric[this.resultObjectType].prototype;

    ctx.lineWidth = _klass_proto.strokeWidth;
    ctx.strokeStyle = _klass_proto.stroke;
    ctx.fillStyle = _klass_proto.fill;

    ctx.beginPath();
    ctx.moveTo(this.points[0].x, this.points[0].y);
    for (var i = 1; i < this.points.length; i++) {
      ctx.lineTo(this.points[i].x, this.points[i].y);
    }
    ctx.closePath();
    ctx.fill();
    ctx.stroke();
    ctx.restore();
    this.canvas.fire("brush:render", { target: this });
  },
  drawingLimits: null, /*{
                       left: 0,
                       width: 0,
                       height: 0,
                       top: 0
                       },*/
  minHeight: 50,
  minWidth: 50,
  _checkRectangle: function _checkRectangle(_rect) {

    var dl = this.drawingLimits;
    if (dl && dl == "backgroundImage") {
      dl = this.canvas.backgroundImage;
    }

    _rect = {
      left: _rect.left,
      top: _rect.top,
      width: _rect.width,
      height: _rect.height
    };

    _rect.left -= fabric.Rect.prototype.strokeWidth / 2;
    _rect.top -= fabric.Rect.prototype.strokeWidth / 2;

    if (dl) {
      if (_rect.left + _rect.width < dl.left || _rect.top + _rect.height < dl.top || _rect.left > dl.width || _rect.top > dl.height) {
        return false;
      }

      if (_rect.top < dl.top) {
        _rect.height += _rect.top;
        _rect.top = dl.top;
      }
      if (_rect.left < dl.left) {
        _rect.width += _rect.left;
        _rect.left = dl.left;
      }
    }

    if (this.minWidth && _rect.width < this.minWidth) {
      _rect.width = this.minWidth;
    }
    if (this.minHeight && _rect.height < this.minHeight) {
      _rect.height = this.minHeight;
    }

    if (dl) {
      var _xdiff = _rect.left + _rect.width - dl.width;
      if (_xdiff > 0) {
        _rect.width -= _xdiff;
        if (this.minWidth && _rect.width < this.minWidth) {
          _rect.left -= this.minWidth - _rect.width;
          _rect.width = this.minWidth;
        }
      }
      var _ydiff = _rect.top + _rect.height - dl.height;
      if (_ydiff > 0) {
        _rect.height -= _ydiff;
        if (this.minHeight && _rect.height < this.minHeight) {
          _rect.top -= this.minHeight - _rect.height;
          _rect.height = this.minHeight;
        }
      }
    }
    return _rect;
  },
  resultObjectProperties: {}
});

fabric.SlideCanvas.prototype.drawingTools.PolygonBrush = {
  icon: 'data:image/png;base64,' + __webpack_require__(67),
  title: 'Polygon Brush'
};
fabric.SlideCanvas.prototype.activeDrawingTools.push("PolygonBrush");
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 67 */
/***/ (function(module, exports) {

module.exports = "iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAANlAAADZQBELD/fAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAXPSURBVHic5dt/yF5lGQfwz7U555aatpEopk6yLba16IegDCk0C0kD2woJDZr9IbUg0zYi+yMSQvtFhhG1aOI/Of/QLLEgcggzzcpBc1CT2oqsXNhqsznbrv647xffPXuf7Xmec57z7p1fuDmcc+4f1/W9r3Of+1zXdSIzvRoQEfPxucz8/GHXXw0ERMRC/ARzM/Otk+/Nmh6RukNEXIgtuHiq+yc0ARHxNkX5i/rVOWEJiIgrsRln4Yl+9U5IAiLievwYp+Jb+Fi/uiccARGxDhsxR1n11+JQv/ondSXYuBERs/ANrMX/cGNmbjxWuxOCgIiYi3uxCvuwKjMfGaTtjCcgIs7Ag7gMz+OqzHxq0PYzmoCIOBePYCmexfsyc8cwfRyxCEbE4oh4bTsijg8RsRSPK8r/GpcOqzxTW8DVuDMi/oxt+F0t2/BMZr44stQtISIuU8z+DPxUeeb3jtRZZh5WcBr+hZyiHMQOPIDbcR2W4+TefsZVlIVuf5XnHswZoM2SWv/pI+71afDl2uAp3IwNym7qP32IeRnP4D58AR/EYsxuWfm1dRKyyhgDthuagLPxEg7g3EnXA4vwfqxXXj2/nTQjvWU/nq711td2iwYVvGfciUk5iLVDth+OgNpoQ230lQEGmF1n/NpqAfcpa8bLfYjZWy3q+9XCrsQ5ffqeU019gtDVI1hOXwL6+gMi4s1Vib14Q2bumbLiURARJ1dilmJZLUtxoam34S94ZeHdpjxW6ypBe/CBzNw8ghxLsB1bs8cfcCzmfqQwt77lZ3ke3o4bcAcexk5TW0viL1jeYLzhLaAytxKP4TlckJkHhmV/GETE6YqFTLaYebguM3c16Hc0C6jkPK6wt6ZNK+iyOIoFDPI5fEc93hIRMeosHK8YhIAH8XuFxavHK073OCYBmXkIX62nt45XnO4xqEfoHvwdKyPikjHK0zkGIiAz9+OuevrZ8YnTPYbxCd6tbIquiYg3jUmezjEwAZn5Ar5X29wyNok6xrBe4a8rDscbIuKsMcjTOYYioO7Gfoi5+NRYJOoYo8QF7qzHmyLi1DaFmQ4MTUBmbsXPcCZubF2ijjFqZGhie/zpiJjRnuWRCMjMn+M3OA8fblWijtEkNjixFszo7XETAjbhT1hRQ9EzEiMTkJkH8bV6OmO3x03D4xvwT1xeszFmHBoRkCVKdHc9nZFrQRsJEnfhv1gdERe00F+naExAZj6PHyixgZub9jcmLOp7pyWn4xuViM0+LDgOnKBzcAW+iT96xb0+eGRohEE31UFumyalX4ePKB9rexweV/iD4ta7dJwEXFwH+wfmdaT0RfgMHlU+0ydHsR9TXs9LjtpHywI9WgW4aUwKz8ZK5Vtke88s/xv3K9GmhQP32bKAV00yuVkt9XmakhOwEbt7lN6p5AG+14g5Cm0TEEpgM5WsjVH7OQ+fUPJ/Xpqk8CE8iduwohWZ2ySgCv/RKuwTQxL3TnxRySeYPMsv4iF8HGe3Lm+Lii/GGsVxOiH87VjWp/48JWHiO/hrj9LP4bu4BvPbVrpVAqri91fz7Bfe/iXeoiQur1HCbft66mzFl+rbZKgMkial0Q8TNT6wBQuUbJBf4RdKbtFyvBuX4BTl1TSrmjsl/WazkoPwUGbuHFmQJmg4+xML3r14TZ86c5Uc3omZ3oTVOL2rWR7LI6DsrxO7DGCySk5Q4orpVnpyafIxNBEY2ZWDPUfP1uOZDcZsHw0s4CQlofKgY8wq3qHEFQ/h/Ome9VYegarYJxWzPqCkvF2v5hXi9fgQvl2VHyjlbkYRUBW91ZGJkn8z9WvxXdOtcG9p5b/BiDhHcYa8R/ENzFd8hU8qi9/Cai3bMnNZ4wFbROs/TtZEqgWZubvn2g4lQfL8bJDy1jZa/2kqC3b3XlN2g7Ci7TGbYDr+GjtlGsbsi04IqP/1XF5Pt3cx5qDoygLWKRunLUoS9HGDrgjYo4TRVmXbq25D/B9PLfo3EMEZiwAAAABJRU5ErkJggg=="

/***/ }),
/* 68 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

/**
 * PencilBrush class
 * @class fabric.PencilBrush
 * @extends fabric.BaseBrush
 */

fabric.PaintPenBrush = fabric.util.createClass(fabric.BaseBrush, /** @lends fabric.PencilBrush.prototype */{
  type: 'paint-pen-brush',

  /**
   * Constructor
   * @param {fabric.Canvas} canvas
   * @return {fabric.PencilBrush} Instance of a pencil brush
   */
  initialize: function initialize(canvas) {
    this.callSuper('initialize', canvas);
    this._points = [];
  },
  getTarget: function getTarget() {
    return this.canvas.drawingContext;
  },
  /**
   * Inovoked on mouse down
   * @param {Object} pointer
   */
  onMouseDown: function onMouseDown(pointer) {
    this._reset();
    this._fill(pointer);
  },

  /**
   * Inovoked on mouse move
   * @param {Object} pointer
   */
  onMouseMove: function onMouseMove(pointer) {
    this._fill(pointer);
  },
  /**
   * Invoked on mouse up
   */
  onMouseUp: function onMouseUp() {
    this.canvas.fire("draw:after", {
      target: this.getTarget(),
      points: this._points.slice(),
      color: this.getColor('source')
    });
  },
  _fill: function _fill(pointer) {
    pointer = {
      x: Math.floor(pointer.x),
      y: Math.floor(pointer.y)
    };

    if (_.findWhere(this._points, pointer)) {
      return;
    }

    // this.getTarget().fillRect(pointer.x , pointer.y  ,1,1);
    var _data = this.getTarget().getImageData(pointer.x, pointer.y, 1, 1);
    pointer.color = Array.prototype.slice.call(_data.data);
    this._points.push(pointer);
    var _color = this.getColor('source');

    _data.data[0] = _color[0];
    _data.data[1] = _color[1];
    _data.data[2] = _color[2];
    _data.data[3] = _color[3];

    this.getTarget().putImageData(_data, pointer.x, pointer.y);
    this.canvas.renderAll();
  },
  undoPaintAction: function undoPaintAction(_action) {
    var ctx = _action.object;
    for (var i in _action.points) {
      var _p = _action.points[i],
          _c = _action.brush.getActionColor(_p.color);
      if (_c[3] == 0) {
        ctx.clearRect(_p.x, _p.y, 1, 1);
      } else {
        ctx.fillStyle = "rgba(" + _c[0] + "," + _c[1] + "," + _c[2] + "," + _c[3] + ")";
        ctx.fillRect(_p.x, _p.y, 1, 1);
      }
    }
    _action.canvas.renderAll();
  },
  redoPaintAction: function redoPaintAction(_action) {

    var ctx = _action.object,
        _c = _action.brush.getActionColor(_action.color);
    var pts = _action.points;
    if (_c[3] == 0) {
      for (var i in pts) {
        ctx.clearRect(pts[i].x, pts[i].y, 1, 1);
      }
    } else {
      ctx.fillStyle = "rgba(" + _c[0] + "," + _c[1] + "," + _c[2] + "," + _c[3] + ")";
      for (var i in pts) {
        ctx.fillRect(pts[i].x, pts[i].y, 1, 1);
      }
    }
    _action.canvas.renderAll();
  },
  /**
   * Clear points array and set contextTop canvas style.
   * @private
   */
  _reset: function _reset() {
    this._points.length = 0;
    this.getTarget().fillStyle = this.color;
  },
  getHistoryRecord: function getHistoryRecord(event) {

    return {
      canvas: this.canvas,
      type: "draw:pen",
      object: event.target,
      points: event.points,
      brush: this,
      color: event.color,
      undo: this.undoPaintAction,
      redo: this.redoPaintAction
    };
  }
});

fabric.SlideCanvas.prototype.drawingTools.PaintPenBrush = {
  className: 'fa fa-paint-brush',
  title: 'Pen Brush'
};
fabric.SlideCanvas.prototype.activeDrawingTools.push("PaintPenBrush");
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 69 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.MagicWand = __webpack_require__(10);

/**
 * PencilBrush class
 * @class fabric.PencilBrush
 * @extends fabric.BaseBrush
 */
fabric.PaintBucketBrush = fabric.util.createClass(fabric.BaseBrush, /** @lends fabric.PencilBrush.prototype */{
  type: 'paint-bucket-brush',
  /**
   * Constructor
   * @param {fabric.Canvas} canvas
   * @return {fabric.PencilBrush} Instance of a pencil brush
   */
  initialize: function initialize(canvas) {
    this.callSuper('initialize', canvas);
    this._points = [];
  },
  getTarget: function getTarget() {
    return this.canvas.drawingContext;
  },
  onMouseUp: function onMouseUp() {},
  onMouseMove: function onMouseMove() {},
  onMouseDown: function onMouseDown(pointer) {
    this._fill(pointer);
  },
  _fill: function _fill(pointer) {
    pointer = {
      x: Math.floor(pointer.x),
      y: Math.floor(pointer.y)
    };

    var info = this.getTarget().getImageData(0, 0, this.getTarget().canvas.width, this.getTarget().canvas.height);

    fabric.MagicWand.floodFill(info, pointer.x, pointer.y, 1, {}, null, function (mask) {
      var _color = this.getColor('source');
      var _target = this.getTarget();
      var _w = mask.bounds.maxX - mask.bounds.minX + 1,
          _h = mask.bounds.maxY - mask.bounds.minY + 1;
      var oldImageData = _target.getImageData(mask.bounds.minX, mask.bounds.minY, _w, _h);

      mask.render(_target, {
        intersectionColor: _color,
        fill: _color,
        cache: false,
        left: mask.bounds.minX,
        top: mask.bounds.minY
      });

      this.canvas.fire("draw:after", {
        target: this.getTarget(),
        redo: _target.getImageData(mask.bounds.minX, mask.bounds.minY, _w, _h),
        undo: oldImageData,
        left: mask.bounds.minX,
        top: mask.bounds.minY,
        color: this.getColor().slice()
      });

      this.canvas.renderAll();
    }.bind(this));
  },
  getHistoryRecord: function getHistoryRecord(event) {

    return {
      canvas: this.canvas,
      object: event.target,
      type: "draw:bucket",
      left: event.left,
      top: event.top,
      undoData: event.undo,
      redoData: event.redo,
      color: this.convertColor(event.color, "source"),
      undo: function undo(_action) {
        _action.object.putImageData(_action.undoData, _action.left, _action.top);
        _action.canvas.renderAll();
      },
      redo: function redo(_action) {
        _action.object.putImageData(_action.redoData, _action.left, _action.top);
        _action.canvas.renderAll();
      }
    };
  }
});

fabric.SlideCanvas.prototype.drawingTools.PaintBucketBrush = {
  icon: 'data:image/svg+xml;base64,' + __webpack_require__(70),
  title: 'Bucket Brush'
};
fabric.SlideCanvas.prototype.activeDrawingTools.push("PaintBucketBrush");
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 70 */
/***/ (function(module, exports) {

module.exports = "PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNMjEuMTQzIDkuNjY3Yy0uNzMzLTEuMzkyLTEuOTE0LTMuMDUtMy42MTctNC43NTMtMi45NzctMi45NzgtNS40NzgtMy45MTQtNi43ODUtMy45MTQtLjQxNCAwLS43MDguMDk0LS44Ni4yNDZsLTEuMzYxIDEuMzZjLTEuODk5LS4yMzYtMy40Mi4xMDYtNC4yOTQuOTgzLS44NzYuODc1LTEuMTY0IDIuMTU5LS43OTIgMy41MjMuNDkyIDEuODA2IDIuMzA1IDQuMDQ5IDUuOTA1IDUuMzc1LjAzOC4zMjMuMTU3LjYzOC40MDUuODg1LjU4OC41ODggMS41MzUuNTg2IDIuMTIxIDBzLjU4OC0xLjUzMy4wMDItMi4xMTljLS41ODgtLjU4Ny0xLjUzNy0uNTg4LTIuMTIzLS4wMDFsLS4xNy4yNTZjLTIuMDMxLS43NjUtMy4zOTUtMS44MjgtNC4yMzItMi45bDMuODc5LTMuODc1Yy40OTYgMi43MyA2LjQzMiA4LjY3NiA5LjE3OCA5LjE3OGwtNy4xMTUgNy4xMDdjLS4yMzQuMTUzLTIuNzk4LS4zMTYtNi4xNTYtMy42NzUtMy4zOTMtMy4zOTMtMy4xNzUtNS4yNzEtMy4wMjctNS40OThsMS44NTktMS44NTZjLS40MzktLjM1OS0uOTI1LTEuMTAzLTEuMTQxLTEuNjg5bC0yLjEzNCAyLjEzMWMtLjQ0NS40NDYtLjY4NSAxLjA2NC0uNjg1IDEuODIgMCAxLjYzNCAxLjEyMSAzLjkxNSAzLjcxMyA2LjUwNiAyLjc2NCAyLjc2NCA1LjU4IDQuMjQzIDcuNDMyIDQuMjQzLjY0OCAwIDEuMTgtLjE5NSAxLjU0Ny0uNTYybDguMDg2LTguMDc4Yy45MS44NzQtLjc3OCAzLjUzOC0uNzc4IDQuNjQ4IDAgMS4xMDQuODk2IDEuOTk5IDIgMS45OTkgMS4xMDUgMCAyLS44OTYgMi0yIDAtMy4xODQtMS40MjUtNi44MS0yLjg1Ny05LjM0em0tMTYuMjA5LTUuMzcxYy41MjctLjUzIDEuNDcxLS43OTEgMi42NTYtLjc2MWwtMy4yMDkgMy4yMDZjLS4yMzYtLjk3OC0uMDQ5LTEuODQ1LjU1My0yLjQ0NXptOS4yOTIgNC4wNzlsLS4wMy0uMDI5Yy0xLjI5Mi0xLjI5Mi0zLjgwMy00LjM1Ni0zLjA5Ni01LjA2My43MTUtLjcxNSAzLjQ4OCAxLjUyMSA1LjA2MiAzLjA5Ni44NjIuODYyIDIuMDg4IDIuMjQ3IDIuOTM3IDMuNDU4LTEuNzE3LTEuMDc0LTMuNDkxLTEuNDY5LTQuODczLTEuNDYyeiIvPjwvc3ZnPg=="

/***/ }),
/* 71 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.PointsBrush = fabric.util.createClass(fabric.BaseBrush, {
  type: "points-brush",
  maximumPoints: 0,
  initialize: function initialize(canvas) {
    this.callSuper('initialize', canvas);
    this.reset();
  },
  currentPoint: 1,
  getPoints: function getPoints() {
    return fabric.util.object.where(this.canvas._objects, { type: "material-point" });
  },
  checkPosition: null,
  onMouseDown: function onMouseDown(pointer) {},
  onMouseMove: function onMouseMove(pointer) {},
  reset: function reset() {},
  onMouseUp: function onMouseUp(pointer) {
    var _points = this.getPoints();

    var pos = {
      left: pointer.x - 0.5,
      top: pointer.y - 0.5
    };

    var _correct = this.checkPosition ? this.checkPosition(pointer) : true;

    if (!_correct) {
      this.canvas.fire("point:rejected", { point: pointer });
      return;
    }

    if (this.maximumPoints && _points.length >= this.maximumPoints) {
      if (this.currentPoint > this.maximumPoints) {
        this.currentPoint = 1;
      }
      if (this.wholeCoordinates) {
        pointer.x = Math.round(pointer.x) + 0.5;
        pointer.y = Math.round(pointer.y) + 0.5;
      }

      var _obj = fabric.util.object.findWhere(_points, { number: this.currentPoint++ });

      var states = {
        original: {
          left: _obj.left,
          top: _obj.top
        },
        modified: {
          left: pointer.x - 0.5,
          top: pointer.y - 0.5
        }
      };

      _obj.set(states.modified).setCoords().fire("modified", { states: states });
      this.canvas.fire("object:modified", { target: _obj, states: states });
      this.canvas.setActiveObject(_obj);
      this.canvas.renderAll();
      return;
    } else {
      this.currentPoint = 1;
      while (fabric.util.object.findWhere(_points, { number: this.currentPoint })) {
        this.currentPoint++;
      }
    }

    var _obj = new fabric.MaterialPoint({
      number: this.currentPoint,
      application: this.canvas.application,
      left: pos.left,
      top: pos.top
    });

    this.currentPoint++;
    this.canvas.add(_obj);
    this.canvas.fire("point:created", { point: _obj });
    this.canvas.setActiveObject(_obj);
    this.canvas.renderAll();
  },
  _render: function _render() {}
});

fabric.SlideCanvas.prototype.drawingTools.PointsBrush = {
  className: 'fa fa-circle-o',
  title: 'Points Brush'
};
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 72 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

var path_initialize_overwritten = fabric.Path.prototype.initialize;

fabric.util.object.extend(fabric.Path.prototype, {
  accuracy: -1,
  initialize: function initialize(path, options) {
    this.callSuper('initialize', options);
    path_initialize_overwritten.call(this, path, options);

    if (this.accuracy != -1) {
      this._set_accuracy(this.accuracy, this.path);
    }
  },
  translate: function translate(path, translateX, translateY) {
    var current;
    //if(this.path[0][0] === "m"){
    //  return;
    //}
    for (var i = 0, len = path.length; i < len; ++i) {

      current = path[i];

      switch (current[0]) {// first letter
        case 'L':
          // lineto, absolute
          current[1] += translateX;
          current[2] += translateY;
          break;
        case 'H':
          current[1] += translateX;
          break;
        case 'V':
          // verical lineto, absolute
          current[1] += translateY;
          break;
        case 'M':
          current[1] += translateX;
          current[2] += translateY;
          break;
        case 'C':
          current[1] += translateX;
          current[2] += translateY;
          current[3] += translateX;
          current[4] += translateY;
          current[5] += translateX;
          current[6] += translateY;
          break;
        case 'S':
          current[1] += translateX;
          current[2] += translateY;
          current[3] += translateX;
          current[4] += translateY;
          break;
        case 'Q':
          // quadraticCurveTo, absolute
          current[1] += translateX;
          current[2] += translateY;
          current[3] += translateX;
          current[4] += translateY;
          break;
        case 'T':
          current[1] += translateX;
          current[2] += translateY;
          break;
        case 'A':
          current[1] += translateX; //todo??
          current[2] += translateY; //todo ??
          current[6] += translateX;
          current[7] += translateY;
      }
    }
  },
  _set_accuracy: function _set_accuracy(accuracy, path) {
    for (var i = 0; i < path.length; i++) {
      for (var j = 1; j < path[i].length; j++) {
        path[i][j] = +path[i][j].toFixed(this.accuracy);
      }
    }
  },
  setAccuracy: function setAccuracy(accuracy) {
    this.accuracy = accuracy;
    if (!this._points) return;
    this._set_accuracy(accuracy, this.path);
  },
  storePathAsString: false,
  _toObject_overwritten: fabric.Path.prototype.toObject,
  //todo use event "before:object";
  toObject: function toObject(propertiesToInclude) {

    if (this.accuracy !== -1) {
      this._set_accuracy(this.accuracy, this.path);
      this.left = +this.left.toFixed(this.accuracy);
      this.top = +this.top.toFixed(this.accuracy);
      this.pathOffset.x = +this.pathOffset.x.toFixed(this.accuracy);
      this.pathOffset.y = +this.pathOffset.y.toFixed(this.accuracy);
    }

    var _obj = this._toObject_overwritten(propertiesToInclude);

    if (this.storeProperties.indexOf("*") == -1) {

      if (_obj.pathOffset && this.storeProperties.indexOf("pathOffset") == -1) {
        this.translate(_obj.path, _obj.pathOffset.x, _obj.pathOffset.y);
        this._set_accuracy(this.accuracy, _obj.path);
      }

      for (var i in _obj) {
        if (this.storeProperties.indexOf(i) == -1) {
          delete _obj[i];
        }
      }
      console.log("!!!");
    }
    if (this.storePathAsString) {
      _obj.path = _obj.path.join('');
    }
    return _obj;
  }
});

/**
 * Creates an instance of fabric.Path from an object
 * @static
 * @memberOf fabric.Path
 * @param {Object} object
 * @param {Function} callback Callback to invoke when an fabric.Path instance is created
 */
fabric.Path.fromObject = function (object, callback) {
  /* if (typeof object.path === 'string') {
   fabric.loadSVGFromURL(object.path, function (elements) {
   var path = elements[0],
   pathUrl = object.path;
    delete object.path;
    fabric.util.object.extend(path, object);
   path.setSourcePath(pathUrl);
    callback(path);
   });
   }
   else {*/

  var _scaled = object.scaleX || object.scaleY;

  var path = new fabric.Path(object.path, object);

  if (!_scaled) {
    if (object.width) {
      path.scaleX = object.width / path.width;
    }
    if (object.height) {
      path.scaleY = object.height / path.height;
    }
  }

  callback && callback(path);
  return path;
  // }
};
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 73 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

__webpack_require__(74);
__webpack_require__(75);
__webpack_require__(76);
__webpack_require__(7);
__webpack_require__(77);

/**
 * @author Denis Ponomarev
 * @email den.ponomarev@gmail.com
 */
fabric.Clipart = fabric.util.createClass(fabric.Group, fabric.StrokeMixin, fabric.CacheMixin, fabric.ImageMixin, {
  type: 'clipart',
  colors: null,
  format: 'svg',
  resizable: true,
  processing: false,
  stateProperties: fabric.Group.prototype.stateProperties.concat(["colors"]),
  optionsOrder: ["*", "colors", "element", "tools"],
  getOriginalSize: function getOriginalSize() {
    return {
      width: this.element.width,
      height: this.element.height
    };
  },
  initialize: function initialize(options) {
    options || (options = {});

    if (options.constructor != Object) {

      var _obj = options.toObject();
      if (options.element) {
        _obj.element = options.element.cloneSync();
        _obj.element.clipTo = _obj._fabric_shape;
      }
      _obj.shape = options.shape;
      options = _obj;
    }

    this.on({
      "scaling": this.updateElement
    });

    this.initShape(options);
    this._fabric_shape.set({
      opacity: 0,
      originX: 'center',
      originY: 'center'
    });

    this.callSuper('initialize', [this._fabric_shape], options);
    this._setWidthHeight(options);
  },
  setShape: function setShape(el, cb) {

    el = fabric.util.object.extend({
      strokeWidthFull: this.shape.strokeWidthFull,
      strokeWidthEmpty: this.shape.strokeWidthEmpty,
      strokeWidthActive: this.shape.strokeWidthActive,
      dashArray: this.shape.dashArray,
      strokeEmpty: this.shape.strokeEmpty,
      strokeFull: this.shape.strokeFull,
      strokeActive: this.shape.strokeActive
    }, el);

    var _this = this;
    if (el && el.src && !el.paths) {
      fabric.loadSVGFromURL(el.src, function (paths, options) {
        el.paths = paths;
        fabric.util.object.extend(el, options);
        _this._set_shape(el);
        _this.add(_this._fabric_shape);
        _this._apply_shape();
        cb && cb();
      });
    } else {
      _this._set_shape(el);
      _this.add(_this._fabric_shape);
      _this._apply_shape();
      cb && cb();
    }
  },
  setElement: function setElement(element) {
    if (this.element) {
      this.remove(this.element);
    }
    if (!element) {
      return;
    }
    element.set({
      originX: 'center',
      originY: 'center'
    });
    this.add(element);
    this.element = element;
    if (this.format === 'png' || this.format === 'image/png' || this.format === 'jpeg' || this.format === 'image/jpeg') {
      this._cache = this.element._element;
    } else {
      this._init_color_array();
    }
    this.dirty = true;
    this.canvas && this.canvas.renderAll();
  },
  updateElement: function updateElement() {
    if (this.element) {
      this.element.scaleX = this.width / this.element.width;
      this.element.scaleY = this.height / this.element.height;
    }
    if (this._fabric_shape) {
      this._fabric_shape.set({
        width: this.width,
        height: this.height
      });
    }
    this.dirty = true;
  },
  _render: function _render(ctx) {
    ctx.save();
    ctx.scale(this.element.scaleX, this.element.scaleY);
    for (var i = 0, l = this.element.paths.length; i < l; ++i) {
      this.element.paths[i].render(ctx, true);
    }
    ctx.restore();
  },
  /**
   * кобъект готовится к замену фото
   */
  activate: function activate() {
    this._activated = true;
    this._fabric_shape.setOpacity(1);
    this.updateStroke();
    this.canvas.renderAll();
  },
  /**
   * кобъект не готовится к замену фото
   */
  deactivate: function deactivate() {
    this._activated = false;
    this.updateStroke();
    this.canvas.renderAll();
  },
  _init_color_array: function _init_color_array() {

    this.processing = true;
    this._colors = this.element.extractColors();

    this.colors = this.colors || {};

    for (var _color in this.colors) {
      this.setClipartColor(_color, this.colors[_color], true);
    }
  },
  setData: function setData(data) {
    this.setSrc(data.src);
  },
  setSrc: function setSrc(src) {
    var _this = this;
    fabric.PathGroup.fromURL(src, function (el) {
      _this.setElement(el);
      _this.makeActions();
      //  _this.canvas.createFloatedMenu(_this.application.objectsToolbarOptions);
    }, {
      width: this.width,
      height: this.height
    });
  },
  // render: function (ctx) {
  //   // var x = noTransform ? 0 : - this.width * this.scaleX / 2,
  //   //   y = noTransform ? 0 : - this.height * this.scaleY / 2;
  //   //
  //   // ctx.save();
  //   // ctx.translate(x,y);
  //   fabric.Group.prototype.render.apply(this,arguments)
  //   // ctx.restore();
  // },
  setClipartColor: function setClipartColor(key, value, preventCacheUpdate) {

    if (!value) {
      value = key;
      delete this.colors[key];
    } else {
      this.colors[key] = value;
    }
    var _colors = this._colors[key];
    for (var i in _colors) {
      if (_colors[i].color) {
        _colors[i].color.fill = value;
      }
      if (_colors[i].stop) {
        _colors[i].stop.color = value;
      }
    }

    this.dirty = true;
    this.canvas && this.canvas.renderAll();
  },
  getSrc: function getSrc() {
    return this.src || this.element.src;
  },
  toObject: function toObject(propertiesToInclude) {
    var obj = fabric.Object.prototype.toObject.call(this);
    fabric.util.object.extend(obj, {
      src: this.src || this.element.src,
      colors: this.colors
    });
    return obj;
  },
  actions: {
    source: {
      type: 'effect',
      className: 'fa fa-file-image-o',
      title: "source",
      actionParameters: function actionParameters($element, data) {
        this.application.createElementsList($element, this.application.getLibraryElements({ category: "clipart" }));
        //  data.target.application.createGallery(data.target, $el, data);
      }
    },
    colors: {
      type: 'menu',
      title: 'color menu',
      menu: function menu() {
        var _menu = [];
        for (var key in this._colors) {
          _menu.push({
            title: "Color (" + key + ")",
            value: {
              defaultValue: key,
              value: this.colors[key] || key,
              get: function (key) {
                return this.colors[key] || key;
              }.bind(this, key),
              set: this.setClipartColor.bind(this, key)
            },
            type: "color"
          });
        }
        return _menu;
      }
    }
  }
});

fabric.Clipart.async = true;

/**
 * Creates fabric.PathGroup instance from an object representation
 * @static
 * @memberOf fabric.PathGroup
 * @param {Object} object Object to create an instance from
 * @param {Function} callback Callback to invoke when an fabric.PathGroup instance is created
 */
fabric.Clipart.fromObject = function (object, callback) {
  if (typeof object.src === 'string') {
    if (object.format === 'png' || object.format === "image/png" || object.format === 'jpeg' || object.format === "image/jpeg") {
      fabric.Image.fromURL(object.src, function (el) {
        object.element = el;
        object.element.src = object.src;
        callback(new fabric.Clipart(object));
      }, {
        width: object.width || fabric.Clipart.prototype.width,
        height: object.height || fabric.Clipart.prototype.height
      });
    } else {
      fabric.PathGroup.fromURL(object.src, function (el) {
        object.element = el;
        object.element.src = object.src;
        delete object.src;
        callback(new fabric.Clipart(object));
      }, {
        width: object.width || fabric.Clipart.prototype.width,
        height: object.height || fabric.Clipart.prototype.height
      });
    }
  } else {
    return new fabric.Clipart(object);
  }
};

fabric.util.createAccessors(fabric.Clipart);

if (fabric.objectsLibrary) {
  fabric.util.object.extend(fabric.objectsLibrary, {
    clipart: {
      "width": function width(w, h) {
        var _asp = Math.min(285 / 365, w / h);
        return w;
      },
      "height": function height(w, h) {
        var _asp = Math.min(285 / 365, w / h);
        return h;
      },
      "type": "clipart",
      "src": "data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTkuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeD0iMHB4IiB5PSIwcHgiIHZpZXdCb3g9IjAgMCA1MTIgNTEyIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA1MTIgNTEyOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIgd2lkdGg9IjUxMnB4IiBoZWlnaHQ9IjUxMnB4Ij4KPGc+Cgk8cGF0aCBzdHlsZT0iZmlsbDojRkY4QzQ2OyIgZD0iTTE2My4xODksNjcuMTQ4QzEyOS42MTYsNjcuMTQ4LDEyMS4yMjIsMCw3OS4yNTUsMEM1Mi43MTMsMCwyOC44OTQsMTYuNzg3LDI4Ljg5NCw1MC4zNjEgICBzNTguNzU0LDUwLjM2MSw0MS45NjcsMTA5LjExNUwxNjMuMTg5LDY3LjE0OHoiLz4KCTxwYXRoIHN0eWxlPSJmaWxsOiNGRjhDNDY7IiBkPSJNMzQ3Ljg0NSw2Ny4xNDhDMzgxLjQxOSw2Ny4xNDgsMzg5LjgxMiwwLDQzMS43OCwwYzI2LjU0MiwwLDUwLjM2MSwxNi43ODcsNTAuMzYxLDUwLjM2MSAgIHMtNTguNzU0LDUwLjM2MS00MS45NjcsMTA5LjExNUwzNDcuODQ1LDY3LjE0OHoiLz4KPC9nPgo8Zz4KCTxwYXRoIHN0eWxlPSJmaWxsOiNGRkVCRDI7IiBkPSJNMzMxLjU0MSw0NjEuNjM5QzMzMS41NDEsNDg5LjQ1MywzMTEuNjI2LDUxMiwyNTYsNTEycy03NS41NDEtMjIuNTQ3LTc1LjU0MS01MC4zNjF2LTguMzkzaDE1MC41OTkgICBMMzMxLjU0MSw0NjEuNjM5eiIvPgoJPHBhdGggc3R5bGU9ImZpbGw6I0ZGRUJEMjsiIGQ9Ik00NTkuMzY4LDE4Mi45MWMzNC40NDYsNTYuMzAzLDQwLjA0MiwxMDIuNDY3LDQwLjA0MiwxMDIuNDY3aC0xNi43ODcgICBjMCwwLDE2Ljc4Nyw0MS40NDMsMTYuNzg3LDY3LjE0OGwtMjUuMTgtOC4zOTNjMCwwLDE2Ljc4NywzNy43NywxNi43ODcsNjcuMTQ4YzAsMC41MjUtMjUuMTgtOC4zOTMtMjUuMTgtOC4zOTMgICBzMTIuNTksMjguMzI4LDguMzkzLDQxLjk2N2MtMC4xNTQsMC41MDEtMjUuMTgtOC4zOTMtMjUuMTgtOC4zOTNzNy4zNDQsMTkuNTg1LDAsMzMuNTc0bC00MS45NjctMTYuNzg3ICAgYzAsMC03Ljg0NiwyNS42ODEtOC4zOTMsMjUuMThjLTE4LjM2MS0xNi43ODctNDEuOTY3LTI1LjE4LTQxLjk2Ny0yNS4xOEgxNTUuMjc5YzAsMC0yMy42MDcsOC4zOTMtNDEuOTY3LDI1LjE4ICAgYy0wLjU0OCwwLjUtOC4zOTMtMjUuMTgtOC4zOTMtMjUuMThsLTQxLjk2NywxNi43ODdjLTcuMzQ0LTEzLjk4OSwwLTMzLjU3NCwwLTMzLjU3NHMtMjUuMDI2LDguODk1LTI1LjE4LDguMzkzICAgYy00LjE5Ny0xMy42MzksOC4zOTMtNDEuOTY3LDguMzkzLTQxLjk2N3MtMjUuMTgsOC45MTgtMjUuMTgsOC4zOTNjMC0yOS4zNzcsMTYuNzg3LTY3LjE0OCwxNi43ODctNjcuMTQ4bC0yNS4xOCw4LjM5MyAgIGMwLTI1LjcwNSwxNi43ODctNjcuMTQ4LDE2Ljc4Ny02Ny4xNDhIMTIuNTljMCwwLDUuNTk1LTQ2LjE2NCw0MC4wNDItMTAyLjQ2N0g0NTkuMzY4eiIvPgo8L2c+CjxlbGxpcHNlIHN0eWxlPSJmaWxsOiNGRkE1NEI7IiBjeD0iMjU1LjUxNyIgY3k9IjIzMC44MiIgcng9IjIwOS44MzYiIHJ5PSIxOTcuMjQ2Ii8+CjxnPgoJCgkJPGVsbGlwc2UgdHJhbnNmb3JtPSJtYXRyaXgoLTAuNjA0MiAtMC43OTY4IDAuNzk2OCAtMC42MDQyIDYzLjk0NzUgNDk5Ljg5MjYpIiBzdHlsZT0iZmlsbDojRkZFQkQyOyIgY3g9IjE1Ni4xMjMiIGN5PSIyMzQuMDY1IiByeD0iMzcuNzY5IiByeT0iNDYuMTYzIi8+CgkKCQk8ZWxsaXBzZSB0cmFuc2Zvcm09Im1hdHJpeCgtMC42MDQyIDAuNzk2OCAtMC43OTY4IC0wLjYwNDIgNzU1LjkyMDQgOTIuNzAzMSkiIHN0eWxlPSJmaWxsOiNGRkVCRDI7IiBjeD0iMzU0LjkzNyIgY3k9IjIzNC4wODYiIHJ4PSIzNy43NjkiIHJ5PSI0Ni4xNjMiLz4KPC9nPgo8cGF0aCBzdHlsZT0iZmlsbDojRkY4QzQ2OyIgZD0iTTI1NS41MjQsMjYwLjE5N2gtMC4wMTNjLTI4LjcxMSwwLTU1LjA0NSwxOC4yNjgtNjguNTM2LDQ3LjUxMSAgYy0xOC4xNjMsMzkuMzc0LTQwLjU3Myw5MS45OTYtNDAuNTczLDExMS45NjRoMjE4LjIyOWMwLTE5Ljk2Ny0yMi40MDktNzIuNTktNDAuNTczLTExMS45NjQgIEMzMTAuNTY5LDI3OC40NjQsMjg0LjIzNCwyNjAuMTk3LDI1NS41MjQsMjYwLjE5N3oiLz4KPHBhdGggc3R5bGU9ImZpbGw6I0ZGREVCNzsiIGQ9Ik0zMDQuNzk1LDM2OS4zMTFjLTE5LjM5MywwLTM2Ljg1NSw2LTQ5LjI3OCwxNS41ODhjLTEyLjQyMi05LjU4OC0yOS44ODUtMTUuNTg4LTQ5LjI3OC0xNS41ODggIGMtMzcuNjgyLDAtNjguMjMsMjIuNTQ3LTY4LjIzLDUwLjM2MXMzMC41NDgsNTAuMzYxLDY4LjIzLDUwLjM2MWMxNS43MjgsMCwzMC4xODctMy45NDcsNDEuNzE2LTEwLjU1NCAgYzQuNzY0LTIuNzMsMTAuMzU3LTIuNzMsMTUuMTIyLDBjMTEuNTI5LDYuNjA3LDI1Ljk4OCwxMC41NTQsNDEuNzE2LDEwLjU1NGMzNy42ODIsMCw2OC4yMy0yMi41NDcsNjguMjMtNTAuMzYxICBTMzQyLjQ3OCwzNjkuMzExLDMwNC43OTUsMzY5LjMxMXoiLz4KPGc+Cgk8cGF0aCBzdHlsZT0iZmlsbDojNDY0NjU1OyIgZD0iTTIxNS4zNDQsMzc0Ljk5MWwzMy40OCw0NC4yMzJjMy4zNTgsNC40MzcsMTAuMDI2LDQuNDM3LDEzLjM4NCwwbDMzLjQ4LTQ0LjIzMiAgIGM0LjE4NC01LjUyOCwwLjI0MS0xMy40NTktNi42OTMtMTMuNDU5aC00LjVjLTIuNTIsMC01LjAyNiwwLjM3OC03LjQzMiwxLjEyMmwtMTQuMTE2LDQuMzYxYy00Ljg0MiwxLjQ5Ni0xMC4wMjMsMS40OTYtMTQuODY1LDAgICBsLTE0LjExNi00LjM2MWMtMi40MDgtMC43NDQtNC45MTMtMS4xMjItNy40MzItMS4xMjJoLTQuNDk5QzIxNS4xMDMsMzYxLjUzMiwyMTEuMTYsMzY5LjQ2MywyMTUuMzQ0LDM3NC45OTF6Ii8+Cgk8Y2lyY2xlIHN0eWxlPSJmaWxsOiM0NjQ2NTU7IiBjeD0iMTU0Ljc5NiIgY3k9IjIzNS4wMTYiIHI9IjE2Ljc4NyIvPgoJPGNpcmNsZSBzdHlsZT0iZmlsbDojNDY0NjU1OyIgY3g9IjM1Ni4yMzkiIGN5PSIyMzUuMDE2IiByPSIxNi43ODciLz4KCTxwYXRoIHN0eWxlPSJmaWxsOiM0NjQ2NTU7IiBkPSJNNzcuMzU4LDMzNS4wMDFsNDYuMjA2LTM3LjgwNWM0LjAxMi0zLjI4MywxLjEyMy05Ljc2MS00LjAwMS04Ljk2OWwtNjEuNDc4LDkuNSAgIEM2My4xMjMsMzEwLjg2LDY5LjYxOCwzMjMuMzMxLDc3LjM1OCwzMzUuMDAxeiIvPgoJPHBhdGggc3R5bGU9ImZpbGw6IzQ2NDY1NTsiIGQ9Ik0xMjEuNDkzLDM4Mi41NzdsMjUuMDUyLTY2LjgwN2MxLjkyMi01LjEyNS00LjQ5NC05LjI1Ni04LjM2NC01LjM4NWwtNDUuMTgzLDQ1LjE4MyAgIEMxMDEuNTU1LDM2NS40MDYsMTExLjA5OCwzNzQuNDU1LDEyMS40OTMsMzgyLjU3N3oiLz4KCTxwYXRoIHN0eWxlPSJmaWxsOiM0NjQ2NTU7IiBkPSJNMjI2LjQwNSwxMDkuMTQ5bC02LjYzMy03Mi42NjdjLTguMTA2LDEuMzA4LTE2LjA1MiwzLjA0NC0yMy44MTEsNS4yMDFsMjEuNTMyLDY5LjIzOSAgIEMyMTkuMTIsMTE2LjE1NywyMjYuOTAzLDExNC42MDksMjI2LjQwNSwxMDkuMTQ5eiIvPgoJPHBhdGggc3R5bGU9ImZpbGw6IzQ2NDY1NTsiIGQ9Ik0yOTEuMjYzLDM2LjQ4MmwtNi42MzMsNzIuNjY3Yy0wLjQ5OCw1LjQ2LDcuMjg0LDcuMDA3LDguOTEzLDEuNzcybDIxLjUzMi02OS4yMzkgICBDMzA3LjMxNSwzOS41MjcsMjk5LjM2OSwzNy43OSwyOTEuMjYzLDM2LjQ4MnoiLz4KCTxwYXRoIHN0eWxlPSJmaWxsOiM0NjQ2NTU7IiBkPSJNMzM3LjM4Nyw0OS4xNTZsLTIwLjUwOSw0Ny40NDljLTIuMTM3LDQuOTQ2LDQuNTQ5LDguODY4LDcuODIzLDQuNTg4bDMyLjczLTQyLjc5MSAgIEMzNTAuOTQ2LDU1LjAxLDM0NC4yNzEsNTEuOSwzMzcuMzg3LDQ5LjE1NnoiLz4KCTxwYXRoIHN0eWxlPSJmaWxsOiM0NjQ2NTU7IiBkPSJNMTk0LjE1Nyw5Ni42MDVsLTIwLjUwOS00Ny40NDljLTYuODg0LDIuNzQ1LTEzLjU1OSw1Ljg1My0yMC4wNDQsOS4yNDdsMzIuNzMsNDIuNzkgICBDMTg5LjYwOCwxMDUuNDczLDE5Ni4yOTUsMTAxLjU1MSwxOTQuMTU3LDk2LjYwNXoiLz4KCTxwYXRoIHN0eWxlPSJmaWxsOiM0NjQ2NTU7IiBkPSJNMjcyLjIyNCwzNC4yNTNjLTUuNTE4LTAuNDA4LTExLjA3Ny0wLjY3OS0xNi43MDctMC42NzljLTUuNjMsMC0xMS4xODksMC4yNzEtMTYuNzA3LDAuNjc5ICAgbDEyLjE2OSwxMDMuNDRjMC42MzMsNS4zOCw4LjQ0Miw1LjM4LDkuMDc1LDBMMjcyLjIyNCwzNC4yNTN6Ii8+Cgk8cGF0aCBzdHlsZT0iZmlsbDojNDY0NjU1OyIgZD0iTTQzNC44NjgsMzM1LjAwMWwtNDYuMjA2LTM3LjgwNWMtNC4wMTItMy4yODMtMS4xMjMtOS43NjEsNC4wMDEtOC45NjlsNjEuNDc4LDkuNSAgIEM0NDkuMTA0LDMxMC44Niw0NDIuNjA4LDMyMy4zMzEsNDM0Ljg2OCwzMzUuMDAxeiIvPgoJPHBhdGggc3R5bGU9ImZpbGw6IzQ2NDY1NTsiIGQ9Ik0zOTAuNzMzLDM4Mi41NzdsLTI1LjA1Mi02Ni44MDdjLTEuOTIyLTUuMTI1LDQuNDk0LTkuMjU2LDguMzY0LTUuMzg1bDQ1LjE4Myw0NS4xODMgICBDNDEwLjY3MSwzNjUuNDA2LDQwMS4xMjksMzc0LjQ1NSwzOTAuNzMzLDM4Mi41Nzd6Ii8+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPC9zdmc+Cg=="
    }
  });
}
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 74 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.StrokeMixin = {
  shape: {
    strokeWidthFull: 0,
    strokeWidthEmpty: 2,
    strokeWidthActive: 2,
    strokeDashArray: [5, 5],
    fill: "transparent",
    strokeEmpty: "red",
    strokeFull: "red",
    strokeActive: "green"
  },
  setShape: function setShape(el, cb) {

    el = fabric.util.object.extend({
      strokeWidthFull: this.shape.strokeWidthFull,
      strokeWidthEmpty: this.shape.strokeWidthEmpty,
      strokeWidthActive: this.shape.strokeWidthActive,
      dashArray: this.shape.dashArray,
      strokeEmpty: this.shape.strokeEmpty,
      strokeFull: this.shape.strokeFull,
      strokeActive: this.shape.strokeActive
    }, el);

    var _this = this;
    if (el && el.src && !el.paths) {
      fabric.loadSVGFromURL(el.src, function (paths, options) {
        el.paths = paths;
        fabric.util.object.extend(el, options);
        _this._set_shape(el);
        _this.add(_this._fabric_shape);
        _this._apply_shape();
        cb && cb();
      });
    } else {
      _this._set_shape(el);
      _this.add(_this._fabric_shape);
      _this._apply_shape();
      cb && cb();
    }
  },
  initShape: function initShape(options) {

    var _shapeOptions = fabric.util.object.extend(options.shape || {}, this.shape);

    this._fabric_shape = new fabric.Rect(fabric.util.object.extend({}, _shapeOptions, {
      width: options.width,
      height: options.height,
      stroke: _shapeOptions.strokeEmpty,
      strokeWidth: _shapeOptions.strokeWidthEmpty
    }));
  },

  /**
   * �������������� ����� �� ������� ������� ����
   * @private
   */
  _apply_shape: function _apply_shape() {
    var shape = this.shape;

    var _off = shape && shape.offsets;

    if (!_off) {
      _off = [0, 0, 0, 0];
    }

    var _off_units = shape && shape.offsets_units;

    if (!_off_units) {
      //if (frame.border_image) {todo
      //    _off_units = frame.border_image.width_units || [0, 0, 0, 0];
      //} else {
      _off_units = [1, 1, 1, 1];
      //}
    }

    /*else if(shape.offsets && shape.offsets_units){
     var s = this.slide.scaleValue;
     this._fabric_shape = new fabric.Rect({
     originX: 'center',
     originY: 'center',
     width:  (this.data.geometry.width - shape.offsets[3] - shape.offsets[1]) * s,
     height: (this.data.geometry.height -shape.offsets[0] - shape.offsets[2]) * s
     });*/

    _off = {
      top: _off[0] * (_off_units[0] ? this.height / 100 : 1) || 0,
      right: _off[1] * (_off_units[1] ? this.width / 100 : 1) || 0,
      bottom: _off[2] * (_off_units[2] ? this.height / 100 : 1) || 0,
      left: _off[3] * (_off_units[3] ? this.width / 100 : 1) || 0
    };

    var _w = this.width - _off.left - _off.right; // *this.slide.scaleValue;
    var _h = this.height - _off.top - _off.bottom; // *this.slide.scaleValue;


    //if(this.resources.frame.data.shape && this.resources.frame.data.shape.radius){
    //
    //    this._fabric_shape.set({
    //        left: -this.width/2  + _off.left ,
    //        top:  -this.height/2 + _off.top ,
    //        width: _w - _off.left -_off.right,
    //        height:  _h - _off.top -_off.bottom,
    //        scaleX:  1,
    //        scaleY:  1
    //    });
    //}else{


    if (this.shape.path || this.shape.paths || this.shape.offsets) {
      var _sw = this.shape.width || this._fabric_shape.width;
      var _sh = this.shape.height || this._fabric_shape.height;

      if (this._fabric_shape.strokeWidth) {
        _sw += this._fabric_shape.strokeWidth;
        _sh += this._fabric_shape.strokeWidth;
      }

      var options = {
        left: -this.width / 2 + _off.left,
        top: -this.height / 2 + _off.top,
        scaleX: _w / 100 / (_sw / 100), // * (shape.scaleX || 1),
        scaleY: _h / 100 / (_sh / 100), // * (shape.scaleY || 1)
        angle: 0
      };
    } else {
      var options = {
        left: -this.width / 2 + _off.left,
        top: -this.height / 2 + _off.top,
        width: _w, // * (shape.scaleX || 1),
        height: _h, // * (shape.scaleY || 1)
        angle: 0
      };
    }

    this._fabric_shape.set(options);

    this.updateStroke();
    this.canvas && this.canvas.renderAll();
  },
  _set_shape: function _set_shape(shape) {

    if (this._fabric_shape) {
      this.remove(this._fabric_shape);
      delete this._fabric_shape;
    }
    var _fabric_shape;
    var _options = {
      fill: "transparent",
      strokeDashArray: this.shape.dashArray
    };

    this.shape = shape;

    if (!shape) {
      _fabric_shape = new fabric.Rect({
        width: this.width,
        height: this.height
      });
      _fabric_shape.set(_options);
    } else if (shape.paths) {

      for (var i in shape.paths) {
        shape.paths[i].set(_options);
      }

      _fabric_shape = fabric.util.groupSVGElements(shape.paths, shape);
      //this._objects.unshift(this._objects.pop());
    } else {
      var path;

      if (shape.radius) {
        path = fabric.util.getRadiusClipPath(shape.radius, shape.radius_units, this.width, this.height);
        _fabric_shape = new fabric.Path(path, _options);
      } else if (shape.path) {
        _fabric_shape = new fabric.Path(shape.path, _options);
        //} else if(shape.offsets){
        //  path = fabric.util.getOffsetsClipPath(shape.offsets, shape.offsets_units)
      } else {
        path = 'M 0 0 L {width} 0 L {width} {height} L 0 {height} z'.format(fabric.util.object.extend({
          width: 100,
          height: 100
        }, shape));

        _fabric_shape = new fabric.Path(path, _options);
        //
        //_fabric_shape =  new fabric.Rect(fabric.util.object.extend({
        //  width:            100,
        //  height:           100
        //},shape));
      }
    }

    _fabric_shape.set({
      scaleX: this.width / _fabric_shape.width,
      scaleY: this.height / _fabric_shape.height,
      perPixelTargetFind: true,
      selectable: false,
      originX: "left",
      originY: "top"
    });

    this._fabric_shape = _fabric_shape;

    if (this.element) {
      this.element.clipTo = this._fabric_shape;
    }

    this.updateStroke();
  },

  updateStroke: function updateStroke() {

    var _stroke = this.shape.stroke;
    var _sw = 0;
    if ((this._activated || this._clipmode) && this.shape.strokeWidthActive) {
      _sw = this.shape.strokeWidthActive;
    } else if (this.element && this.shape.strokeWidthFull) {
      _sw = this.shape.strokeWidthFull;
    } else if (!this.element && this.shape.strokeWidthEmpty) {
      _sw = this.shape.strokeWidthEmpty;
    }
    if ((this._activated || this._clipmode) && this.shape.strokeActive) {
      _stroke = this.shape.strokeActive;
    } else if (this.element && this.shape.strokeFull) {
      _stroke = this.shape.strokeFull;
    } else if (!this.element && this.shape.strokeEmpty) {
      _stroke = this.shape.strokeEmpty;
    }

    var _strokeWidth = _sw / Math.max(this._fabric_shape.scaleX, this._fabric_shape.scaleY);

    if (this.shape) {
      if (this.shape.paths) {
        for (var i in this._fabric_shape.paths) {
          this._fabric_shape.paths[i].setStrokeWidth(_strokeWidth);
          this._fabric_shape.paths[i].setStroke(_stroke);
        }
      } else {
        this._fabric_shape.setStrokeWidth(_strokeWidth);
        this._fabric_shape.setStroke(_stroke);
      }
    }
  },
  /**
   * кобъект готовится к замену фото
   */
  activate: function activate() {
    this._activated = true;
    this._fabric_shape.setOpacity(1);
    this.updateStroke();
    this.canvas.renderAll();
  },
  /**
   * кобъект не готовится к замену фото
   */
  deactivate: function deactivate() {
    this._activated = false;
    this.updateStroke();
    this.canvas.renderAll();
  }
};
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 75 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.CacheMixin = {
  caching: true,
  dirty: true,
  render: function render(ctx) {

    ctx.save();
    if (this.transformMatrix) {
      ctx.transform.apply(ctx, this.transformMatrix);
    }
    this.transform(ctx);

    this._setShadow(ctx);
    this.clipTo && fabric.util.clipContext(this, ctx);

    ctx.translate(-this.width / 2, -this.height / 2);

    if (this.caching) {
      if (this.dirty) {

        if (!this._cache) {
          this._cache = fabric.util.createCanvasElementWithSize(this);
        }

        if (this.element) {
          this._cache.width = this.width;
          this._cache.height = this.height;
          var cacheCtx = this._cache.getContext("2d");
          cacheCtx.clearRect(0, 0, this._cache.width, this._cache.height);
          this._render(cacheCtx);
          this.dirty = false;
        } else {
          this._cache = null;
          this.dirty = false;
        }
      }

      if (this._cache) {
        ctx.drawImage(this._cache, 0, 0, this.width, this.height, 0, 0, this.width, this.height);
      }
    } else {
      this._render(ctx);
    }

    this.clipTo && ctx.restore();
    ctx.restore();
  }

};
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 76 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.util.object.extend(fabric.PathGroup.prototype, {
  initialize_overwritten: fabric.PathGroup.prototype.initialize,
  initialize: function initialize(paths, options) {

    if (paths.constructor != Array) {
      options = paths.toObject();
      delete options.paths;
      paths = paths.paths;
    }

    this.initialize_overwritten(paths, options);
  },
  extractColors: function extractColors() {
    var _colors = {};
    var _paths = this.paths;
    for (var i in _paths) {
      if (_paths[i].fill.type) {
        for (var j in _paths[i].fill.colorStops) {
          var _color = _paths[i].fill.colorStops[j].color;
          if (!_colors[_color]) _colors[_color] = [];
          _colors[_color].push({ object: _paths[i], stop: _paths[i].fill.colorStops[j] });
        }
      } else {
        var _color = _paths[i].fill;
        if (!_colors[_color]) _colors[_color] = [];
        _colors[_color].push({ object: _paths[i], color: _paths[i] });
      }
    }
    return _colors;
  }
});

fabric.PathGroup.fromElements = function (elements, object, url) {
  var _options = {
    toBeParsed: true
    //originX: "center",
    //originY: "center"
  };

  //смещаем элементы так, чтобы их кооринаты начинались от 0.0
  if (elements.length) {

    var minX = Infinity,
        minY = Infinity;
    for (var i in elements) {
      minX = Math.min(elements[i].left, minX);
      minY = Math.min(elements[i].top, minY);
    }

    minX = Math.max(minX, 0);
    minY = Math.max(minY, 0);
    /* for (var i in elements) {
     elements[i].translate(-minX, -minY);
     elements[i].left -= minX;
     elements[i].pathOffset.x -= minX;
     elements[i].top -= minY;
     elements[i].pathOffset.y -= minY;
     }*/
  }

  var el = fabric.util.groupSVGElements(elements, _options, url);

  var scaleX = object.width ? object.width / el.width : null,
      scaleY = object.height ? object.height / el.height : null;
  if (scaleX && !scaleY) {
    scaleY = scaleX;
  }
  if (scaleY && !scaleX) {
    scaleX = scaleY;
  }
  if (!scaleY && !scaleX) {
    scaleX = scaleY = 1;
  }

  delete object.height;
  delete object.width;
  el.set(fabric.util.object.extend(object, {
    //left: 0, top: 0,
    scaleX: scaleX,
    scaleY: scaleY
  }));
  el.setLeft(object.left);
  el.setTop(object.top);
  return el;
};

// fabric.PathGroup.prototype.render = function(ctx,noTransform) {
//   if (!this.visible) {
//     return;
//   }
//   var x = noTransform ? 0 : - this.width * this.scaleX / 2,
//     y = noTransform ? 0 : - this.height * this.scaleY / 2;
//
//   ctx.save();
//   ctx.translate(x,y);
//
//   if (this.transformMatrix) {
//     ctx.transform.apply(ctx, this.transformMatrix);
//   }
//   this.transform(ctx);
//
//   this._setShadow(ctx);
//   this.clipTo && fabric.util.clipContext(this, ctx);
//   ctx.translate(-this.width/2, -this.height/2);
//   for (var i = 0, l = this.paths.length; i < l; ++i) {
//     this.paths[i].render(ctx, true);
//   }
//   this.clipTo && ctx.restore();
//   ctx.restore();
// }


fabric.PathGroup.fromURL = function (url, callback, object) {

  fabric.loadSVGFromURL(url, function (els) {

    var el = new fabric.PathGroup(els, { toBeParsed: true });

    // //смещаем элементы так, чтобы их кооринаты начинались от 0.0
    // if (el.paths.length) {
    //
    //   var minX = Infinity,
    //     minY = Infinity;
    //   var maxX = -Infinity,
    //     maxY = -Infinity;
    //
    //   for (var i in el.paths) {
    //     var _p = el.paths[i];
    //     minX = Math.min(_p.left, minX);
    //     minY = Math.min(_p.top, minY);
    //     maxX = Math.max(_p.left + _p.width, maxX);
    //     maxY = Math.max(_p.top + _p.height, maxY);
    //   }
    //
    //   var _W = maxX - minX;
    //   var _H = maxY - minY;
    //   //
    //   //
    //   // minX = Math.max(minX, 0);
    //   // minY = Math.max(minY, 0);
    //   /* for (var i in elements) {
    //    elements[i].translate(-minX, -minY);
    //    elements[i].left -= minX;
    //    elements[i].pathOffset.x -= minX;
    //    elements[i].top -= minY;
    //    elements[i].pathOffset.y -= minY;
    //    }*/
    // }else{
    //   _W = 1;
    //   _H = 1;
    // }

    var scaleX = object.width ? object.width / el.width : null,
        scaleY = object.height ? object.height / el.height : null;
    if (scaleX && !scaleY) {
      scaleY = scaleX;
    }
    if (scaleY && !scaleX) {
      scaleX = scaleY;
    }
    if (!scaleY && !scaleX) {
      scaleX = scaleY = 1;
    }
    // console.log(object.width,el.width,object.height,el.height)
    // console.log(el);
    el.set({
      scaleX: scaleX,
      scaleY: scaleY
    });

    callback(el);
  });

  // fabric.loadSVGFromURL(url,function(els){
  //   callback(fabric.PathGroup.fromElements(els, object));
  // });
};
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 77 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

var _set_object_scale_overwritten = fabric.Canvas.prototype._setObjectScale;
var _setup_current_transform = fabric.Canvas.prototype._setupCurrentTransform;

fabric.util.object.extend(fabric.Canvas.prototype, {
  _setupCurrentScaleTransform: _setup_current_transform,
  _setupCurrentTransform: function _setupCurrentTransform(e, target) {
    if (!target) return;
    if (target.setupCurrentTransform) {
      return target.setupCurrentTransform(e);
    } else {
      if (target.resizable) {
        return this._setupCurrentResizeTransform(e, target);
      } else {
        return this._setupCurrentScaleTransform.call(this, e, target);
      }
    }
  },
  _setObjectScale: function _setObjectScale(localMouse, transform, lockScalingX, lockScalingY, by, lockScalingFlip, _dim) {

    var t = transform.target;

    if (!_dim) {
      var strokeWidth = t.stroke ? t.strokeWidth : 0;
      _dim = {
        x: t.width + strokeWidth / 2,
        y: t.height + strokeWidth / 2
      };
    }

    if (t.setObjectScale) {
      return t.setObjectScale(localMouse, transform, lockScalingX, lockScalingY, by, lockScalingFlip, _dim);
    } else {
      if (t.resizable) {
        return this._setObjectSize(localMouse, transform, lockScalingX, lockScalingY, by, lockScalingFlip, _dim);
      } else {
        return _set_object_scale_overwritten.call(this, localMouse, transform, lockScalingX, lockScalingY, by, lockScalingFlip, _dim);
      }
    }
  },
  _setObjectSize: function _setObjectSize(localMouse, transform, lockScalingX, lockScalingY, by, lockScalingFlip, _dim) {

    var target = transform.target,
        forbidScalingX = false,
        forbidScalingY = false;
    var _stroke = transform.target.strokeWidth || 0;
    transform.newWidth = this.width * (localMouse.x / transform.scaleX / (this.width + _stroke));
    transform.newHeight = this.height * (localMouse.y / transform.scaleY / (this.height + _stroke));

    if (this.wholeCoordinates || target.wholeCoordinates) {
      transform.newWidth = Math.round(transform.newWidth);
      transform.newHeight = Math.round(transform.newHeight);
    }
    if (transform.newHeight < 0) {
      target.top = transform.top - transform.newHeight;
    }
    if (target.minWidth && transform.newWidth <= target.minWidth) {
      transform.newWidth = target.minWidth;
    }
    if (target.minHeight && transform.newHeight <= target.minHeight) {
      transform.newHeight = target.minHeight;
    }
    if (lockScalingFlip && transform.newWidth < target.width) {
      forbidScalingX = true;
    }
    if (lockScalingFlip && transform.newHeight < target.height) {
      forbidScalingY = true;
    }

    if (by === 'equally') {
      forbidScalingX || forbidScalingY || this._resizeObjectEqually(localMouse, target, transform, _dim);
    } else if (!by) {
      forbidScalingX || target.setWidth(transform.newWidth);
      forbidScalingY || target.setHeight(transform.newHeight);
    } else if (by === 'x' && !target.get('lockUniScaling')) {
      forbidScalingX || target.setWidth(transform.newWidth);
    } else if (by === 'y' && !target.get('lockUniScaling')) {
      forbidScalingY || target.setHeight(transform.newHeight);
    }
    return !forbidScalingX && !forbidScalingY;
    //transform.newWidth -= _stroke;
    //transform.newHeight -= _stroke;
  },
  _setupCurrentResizeTransform: function _setupCurrentResizeTransform(e, target) {
    this._setupCurrentScaleTransform(e, target);
    this._currentTransform.original.height = target.height;
    this._currentTransform.original.width = target.width;
  },
  _resizeObjectEqually: function _resizeObjectEqually(localMouse, target, transform, _dim) {

    var dist = localMouse.y + localMouse.x,
        lastDist = _dim.y * transform.original.height / target.height + _dim.x * transform.original.width / target.width;

    transform.newWidth = transform.original.width * dist / lastDist;
    transform.newHeight = transform.original.height * dist / lastDist;

    var ratio = transform.original.height / transform.original.width;
    if (ratio > 1) {
      if (target.minWidth && transform.newWidth <= target.minWidth) {
        transform.newWidth = target.minWidth;
        transform.newHeight = target.minHeight * ratio;
      }
    } else {
      if (target.minHeight && transform.newHeight <= target.minHeight) {
        transform.newHeight = target.minHeight;
        transform.newWidth = target.minWidth / ratio;
      }
    }

    target.setWidth(transform.newWidth);
    target.setHeight(transform.newHeight);
  }
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 78 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

__webpack_require__(79);
//fabric.require("SlideImage",["SlideObject"/*,"Pathfinder"*/],function() {

fabric.util.object.extend(fabric.Image.prototype, {
  contentOffsets: null,
  /**
   * @private
   * @param {CanvasRenderingContext2D} ctx Context to render on
   * @param {Boolean} noTransform
   */
  _render: function _render(ctx, noTransform) {
    var x,
        y,
        imageMargins = this._findMargins(),
        elementToDraw;

    x = noTransform ? this.left : -this.width / 2;
    y = noTransform ? this.top : -this.height / 2;

    if (this.meetOrSlice === 'slice') {
      ctx.beginPath();
      ctx.rect(x, y, this.width, this.height);
      ctx.clip();
    }

    if (this.isMoving === false && this.resizeFilters.length && this._needsResize()) {
      this._lastScaleX = this.scaleX;
      this._lastScaleY = this.scaleY;
      elementToDraw = this.applyFilters(null, this.resizeFilters, this._filteredEl || this._originalElement, true);
    } else {
      elementToDraw = this._element;
    }
    this._renderFill(ctx);
    elementToDraw && ctx.drawImage(elementToDraw, x + imageMargins.marginX, y + imageMargins.marginY, imageMargins.width, imageMargins.height);

    this._stroke(ctx);
    this._renderStroke(ctx);
  },
  imageTools: false,
  photoshopTools: false,
  cloneSync: function cloneSync() {
    var _object = this.toObject();
    delete _object.filters;
    var clone = new fabric.Image(this._element, _object);
    clone._filteredEl = this._filteredEl;
    clone.filters = this.filters;
    return clone;
  },
  revertChanges: function revertChanges() {
    var pathfinder = this.canvas.getPathfinder();
    if (pathfinder.target && pathfinder.target == this) {
      pathfinder.hide();
    }

    if (this._element == this._originalElement) {
      return;
    }

    this.filters.length = 0;
    if (this._filteredEl) {
      delete this._filteredEl;
    }
    delete this._edited;
    this._element = this._originalElement;

    this.fire("content:modified", {
      bounds: { minX: 0, minY: 0, maxX: this._element.width, maxY: this._element.height }
    });

    this.canvas.renderAll();
  },
  extractColors: function extractColors() {
    var _colors = fabric.MagicWand.extractColors(this._element);
    var colors = {};
    for (var i in _colors) {
      var _str = "rgb(" + _colors[i].join(",") + ")";
      colors[_str] = {};
    }
    return colors;
  },
  actions: fabric.util.object.extend(fabric.Image.prototype.actions, {
    photoshopTools: {
      type: 'effect',
      effectTpl: '<div id="editor-tools" class="inline-actions compact"></div>' + '<div class="checkboard" ><div id="pathfinder"></div></div>',
      className: 'fa fa-pencil-square-o',
      title: "advanced tools",
      action: function action() {
        var pathfinder = this.canvas.getPathfinder();
        pathfinder.target = this;
        pathfinder.setPicture(this._element);
        pathfinder.show();
      },
      actionParameters: function actionParameters(el, data) {

        var pathfinder = this.canvas.getPathfinder();
        pathfinder.canvas = this.canvas;

        new fabric.Toolbar(pathfinder, 'editor-tools');

        pathfinder.setContainer('pathfinder');

        // if (pathfinder.target)pathfinder.hide();
        pathfinder.target = this;
        pathfinder.setPicture(this._element);
        pathfinder.show();
      }
    },
    revertChanges: {
      className: 'fa fa-history',
      title: "revert to orignal image",
      action: "revertChanges",
      observe: "content:modified",
      visible: function visible() {
        return !!this._filteredEl || this._edited;
      }
    }
  })
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 79 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.MagicWand = __webpack_require__(10);

var MagicWand = fabric.MagicWand;

/**
 * Pathfinder (Pathfinder) Interface for MagicWand selection tool
 * @param options
 * @constructor
 */
function Pathfinder(options) {
  this.initialize(options);
}

Pathfinder.prototype = {
  type: 'pathfinder',
  keepOldSelection: true,
  alphaChannel: true,
  pathfinderMode: 'new',
  selectionTool: 'magic',
  adjacentPixels: true,
  async: false,
  pathfinderTools: false,
  blurRadius: 0,
  hatchLength: 4,
  colorThreshold: 15,
  simplifyTolerant: 0,
  simplifyCount: 30,
  hatchOffset: 0,
  imageInfo: null,
  mask: null,
  downPoint: null,
  allowDraw: false,
  shapeSelectionTools: false,
  initialize: function initialize(options) {

    options.application && options.application.fire('entity:created', { target: this, options: options });

    for (var i in options) {
      this[i] = options[i];
    }
  },
  asyncronous: function asyncronous(cb) {
    if (this.async) {
      setTimeout(cb);
    } else {
      cb();
    }
  },
  fillWithCurrentColor: function fillWithCurrentColor() {
    this.fill(this.color);
  },
  clearMemory: function clearMemory() {
    delete this.resultCanvas;
    delete this.editedImageCanvas;
    delete this.test_picture;
    delete this.mask;
  },
  hide: function hide() {
    if (this.editedImageCanvas) {
      this.editedImageCanvas.remove();
      this.resultCanvas.remove();
      clearInterval(this.interval);
      this.clearMemory();
      this.fire('hidden');
    }
  },
  setContainer: function setContainer(container) {
    if (container.constructor === String) {
      container = document.getElementById(container);
    }
    this.container = container;

    this.test_picture = new Image();
    this.test_picture.onload = this.initCanvas.bind(this);
    return this;
  },
  getSelectionTool: function getSelectionTool() {
    return this.selectionTool;
  },
  setSelectionTool: function setSelectionTool(tool) {
    this.selectionTool = tool;
    this.downPoint = false;
    this.fire('tool:changed', tool);
  },
  getThreshold: function getThreshold() {
    return this.colorThreshold;
  },
  setThreshold: function setThreshold(thres) {
    if (thres !== undefined) {
      this.colorThreshold = thres;
    }
    if (this.downPoint) {
      this.drawMask(this.downPoint.x, this.downPoint.y, this.adjacentPixels);
    }
    this.fire('threshold:changed', { threshold: this.colorThreshold });
  },
  setPicture: function setPicture(img) {
    this.setImage(img);
    var cvs = fabric.util.createCanvasElement();

    cvs.onmouseup = this.onMouseUp.bind(this);
    cvs.onmousedown = this.onMouseDown.bind(this);
    cvs.onmousemove = this.onMouseMove.bind(this);
    cvs.oncontextmenu = function () {
      return false;
    };
    this.initCanvas(cvs);
  },
  load: function load(file) {
    if (!file) return;

    if (file.constructor === String) {
      Pathfinder.test_picture.setAttribute('src', file);
    } else {
      var reader = new FileReader();
      reader.onload = function (e) {
        this.test_picture.setAttribute('src', e.target.result);
      }.bind(this);
      reader.readAsDataURL(file);
    }
  },
  initCanvas: function initCanvas(cvs) {
    var img = this.editedImageCanvas;
    if (this.resultCanvas) {
      $(this.resultCanvas).remove();
    }
    this.resultCanvas = cvs;
    this.createSelectionDrawCanvas();

    this.context = cvs.getContext('2d');
    cvs.width = img.width;
    cvs.height = img.height;
    //this.setImage(img);
  },
  setImage: function setImage(img) {
    this._test_todo_img = img;
    //this.mask = null;//MagicWand.createMask(img.width,img.height);
    this.editedImageCanvas = fabric.util.createCanvasElement();
    this.editedImageCanvas.width = img.width;
    this.editedImageCanvas.height = img.height;
    this.editedImageCanvas.getContext('2d').drawImage(img, 0, 0);
    this.initCanvas(fabric.util.createCanvasElement());
  },
  getInfo: function getInfo() {

    var ctx = this.editedImageCanvas.getContext('2d');
    var imageInfo = ctx.getImageData(0, 0, this.editedImageCanvas.width, this.editedImageCanvas.height);
    imageInfo.bytes = 4;
    return imageInfo;
  },
  getMousePosition: function getMousePosition(e) {
    var scale = this.resultCanvas.width / $(this.resultCanvas).width();
    var target = e.target || e.srcElement,
        rect = target.getBoundingClientRect(),
        offsetX = e.clientX - rect.left,
        offsetY = e.clientY - rect.top;
    return { x: Math.round(offsetX * scale), y: Math.round(offsetY * scale) };
  },
  radius: 20,
  resetSelectionDrawCanvas: function resetSelectionDrawCanvas() {
    this.selectionDrawContext.fillStyle = "black";
    //this.selectionDrawContext(0, 0, canvas.width, canvas.height);
    this.selectionDrawContext.fillRect(0, 0, this.selectionDrawCanvas.width, this.selectionDrawCanvas.height);
    this.selectionDrawContext.fillStyle = "white";
    this.selectionDrawContext.strokeStyle = "white";
  },
  createSelectionDrawCanvas: function createSelectionDrawCanvas() {

    if (this.selectionDrawCanvas) {
      $(this.selectionDrawCanvas).remove();
    }
    this.selectionDrawCanvas = fabric.util.createCanvasElement();
    this.selectionDrawCanvas.width = this.resultCanvas.width;
    this.selectionDrawCanvas.height = this.resultCanvas.height;
    this.selectionDrawContext = this.selectionDrawCanvas.getContext("2d");
    this.resetSelectionDrawCanvas();
  },
  _onMouseDown: function _onMouseDown(point) {
    point.x = Math.min(Math.max(0, parseInt(point.x)), this.resultCanvas.width - 1);
    point.y = Math.min(Math.max(0, parseInt(point.y)), this.resultCanvas.height - 1);
    this.allowDraw = true;
    this.drawingTools[this.selectionTool].mouseDown.call(this, point);
  },
  onMouseDown: function onMouseDown(e) {
    e.preventDefault();
    e.stopPropagation();
    this._onMouseDown(this.getMousePosition(e));
  },
  _onMouseMove: function _onMouseMove(p) {
    p.x = Math.min(Math.max(0, parseInt(p.x)), this.resultCanvas.width - 1);
    p.y = Math.min(Math.max(0, parseInt(p.y)), this.resultCanvas.height - 1);
    this.drawingTools[this.selectionTool].mouseMove.call(this, p);
  },
  onMouseMove: function onMouseMove(e) {
    var p = this.getMousePosition(e);
    this._onMouseMove(p);
  },
  color: [255, 0, 0, 255],
  onMouseUp: function onMouseUp(e) {
    this.allowDraw = false;
    this.drawingTools[this.selectionTool].mouseUp.call(this, e);
  },
  applyMask: function applyMask(canvas, left, top) {
    if (canvas.width === 0 || canvas.height === 0) {
      delete this.mask;
      this.render();
      return;
    }
    var info = this.getInfo(),
        mask = MagicWand.maskSelection(canvas, left, top);

    this.mask = mask;
    this.fire('selection:changed', { mask: mask, target: this.target });
  },
  setPathfinderMode: function setPathfinderMode(value) {
    this.pathfinderMode = value;
  },
  getPathfinderMode: function getPathfinderMode() {
    return this.pathfinderMode;
  },
  modifySelection: function modifySelection(mask, pathfinderMode, noEvents) {
    this.shouldModify = false;
    if (this.selectionObject) {
      this.selectionObject.remove();
    }
    this.downPoint = false;
    if (mask === undefined) {
      mask = this.mask;
    }
    if (pathfinderMode === undefined) {
      pathfinderMode = this.pathfinderMode;
    }
    if (pathfinderMode !== 'new' && this.oldMask) {
      mask = MagicWand[pathfinderMode](mask, this.oldMask);
    }
    if (this.blurRadius) {
      mask = MagicWand.gaussBlurOnlyBorder(mask, this.blurRadius);
    }
    //if (pathfinderMode !== 'new' && this.oldMask || this.blurRadius) {
    //  mask.cacheInd = MagicWand.getBorderIndices(mask);
    //}

    if (mask && mask.count && this.keepOldSelection) {
      mask.makeCache();
      this.oldMask = mask;
    } else {
      delete this.oldMask;
    }

    this.mask = MagicWand.createMask(this.editedImageCanvas.width, this.editedImageCanvas.height);
    if (!noEvents) {
      this.fire('selection:changed', { mask: mask, target: this.target });
    }
    this.render();
  },
  createSelection: function createSelection(mask) {
    if (this.shouldModify) {
      this.modifySelection();
    }

    this.mask = mask || MagicWand.createMask(this.editedImageCanvas.width, this.editedImageCanvas.height);
    this.render();
  },
  setSelection: function setSelection(mask) {
    this.mask = mask;
    this.render();
    this.fire('selection:changed', { mask: mask, target: this.target });
  },
  fill: function fill(color, callback) {
    this.asyncronous(function () {
      this._fill(color, false);
      callback && callback.call(this);
    }.bind(this), 0);
  },
  _fill: function _fill(color, invert, canvas) {

    if (!this.mask) return;

    canvas = canvas || this.editedImageCanvas;
    var ctx = canvas.getContext('2d'); //b.minX, b.minY, b.maxX - b.minX, b.maxY - b.minY);

    MagicWand.fillMask(ctx, this.mask, color);

    this.fire('image:changed', this.editedImageCanvas);
  },
  hatchTick: function hatchTick() {
    this.hatchOffset = (this.hatchOffset + 1) % (this.hatchLength * 2);
    this.render(true);
  },
  show: function show() {
    while (this.container.lastChild) {
      this.container.removeChild(this.container.lastChild);
    }
    this.container.appendChild(this.editedImageCanvas);
    this.container.appendChild(this.resultCanvas);
    this.interval = setInterval(this.hatchTick.bind(this), 300);

    this.fire('show');
  },
  clear: function clear(invert, canvas, callback) {
    this.asyncronous(function () {
      this._fill([0, 0, 0, 0], invert, canvas);
      callback && callback.call(this);
    }.bind(this), 0);
  },
  render: function render(noBorder) {
    if (!this.context || !this.mask) return;

    var ctx = this.context;
    if (!noBorder) {
      this.mask.cacheInd = MagicWand.getBorderIndices(this.mask);
    }
    ctx.clearRect(0, 0, this.mask.width, this.mask.height);

    var _new_color = !this.oldMask || this.pathfinderMode == "new" || this.pathfinderMode == "add" || this.pathfinderMode == "exclude" ? this.newMaskColor : this.removedMaskColor;

    var _intersection_color;
    if (this.pathfinderMode == "add" || this.pathfinderMode == "new" || this.pathfinderMode == "intersect") {
      _intersection_color = this.newMaskColor;
    } else {
      _intersection_color = this.removedMaskColor; //intersectionRemovedMaskColor;
    }
    var _old_color;
    if (this.pathfinderMode == "exclude" || this.pathfinderMode == "substract" || this.pathfinderMode == "add") {
      _old_color = this.newMaskColor;
    } else {
      _old_color = this.removedMaskColor;
    }

    this.oldMask && this.oldMask.render(ctx, {
      fill: _old_color
    });

    this.mask.render(ctx, {
      fill: _new_color,
      intersectionColor: _intersection_color,
      outerIntersectionColor: _old_color
      // outerFill : "rgba(0,0,0,0.5)"
    });

    if (this.renderBorder) {
      this.oldMask && this.oldMask.renderBorder(ctx, {});

      this.mask.renderBorder(ctx, {
        hatchOffset: this.hatchOffset
      });
    }
  },
  renderBorder: true,
  intersectionRemovedMaskColor: '#ffaaaa',
  removedMaskColor: '#aaaaff',
  newMaskColor: '#aaFFaa',
  renderMask: function renderMask(ctx, mask, color, left, top) {
    mask = mask || this.mask;
    mask && mask.render(ctx, {
      intersectionColor: '#fff',
      outerIntersectionColor: '#000',
      fill: color || '#fff',
      left: left,
      top: top
    });
  },
  getContours: function getContours() {
    if (!this.__cs) {
      this.__cs = MagicWand.traceContours(this.mask);
      this.__cs = MagicWand.simplifyContours(this.__cs, this.simplifyTolerant, this.simplifyCount);
    }
    return this.__cs;
  },
  traceInner: function traceInner(ctx) {

    var cs = this.getContours();
    var ctx = ctx || this.context;
    ctx.beginPath();
    for (var i = 0; i < cs.length; i++) {
      if (!cs[i].inner) continue;
      var ps = cs[i].points;
      ctx.moveTo(ps[0].x, ps[0].y);
      for (var j = 1; j < ps.length; j++) {
        ctx.lineTo(ps[j].x, ps[j].y);
      }
    }
    ctx.stroke();
  },
  getColor: function getColor() {
    return 'rgba(' + this.color.join(', ') + ')';
  },
  setColor: function setColor(color) {
    var _arr = color.substring(color.indexOf('(') + 1, color.length - 1).split(', ');
    for (var i in _arr) {
      _arr[i] = parseFloat(_arr[i]);
    }
    _arr[3] = Math.round(_arr[3] * 255);
    this.color = _arr;
  },
  trace: function trace(ctx) {
    var info = this.getInfo();
    var cs = MagicWand.traceContours(this.mask);
    cs = MagicWand.simplifyContours(cs, this.simplifyTolerant, this.simplifyCount);

    // draw contours
    var ctx = ctx || this.context;
    ctx.clearRect(0, 0, info.width, info.height);
    //inner
    ctx.beginPath();
    for (var i = 0; i < cs.length; i++) {
      if (!cs[i].inner) continue;
      var ps = cs[i].points;
      ctx.moveTo(ps[0].x, ps[0].y);
      for (var j = 1; j < ps.length; j++) {
        ctx.lineTo(ps[j].x, ps[j].y);
      }
    }
    ctx.strokeStyle = 'red';
    ctx.stroke();
    //outer
    ctx.beginPath();
    for (var i = 0; i < cs.length; i++) {
      if (cs[i].inner) continue;
      var ps = cs[i].points;
      ctx.moveTo(ps[0].x, ps[0].y);
      for (var j = 1; j < ps.length; j++) {
        ctx.lineTo(ps[j].x, ps[j].y);
      }
    }
    ctx.strokeStyle = 'blue';
    ctx.stroke();
  },
  removeNoise: function removeNoise(threshold) {

    if (!this.mask || !this.mask.count) return;
    this.createSelectionDrawCanvas();
    //this.renderMask(this.selectionDrawContext, this.mask);

    var cs = MagicWand.traceContours(this.mask);
    cs = MagicWand.simplifyContours(cs, this.simplifyTolerant, this.simplifyCount);

    var ctx = this.selectionDrawContext,
        v = this.canvas.viewportTransform;

    //  cs = MagicWand.simplifyContours(cs, this.simplifyTolerant, this.simplifyCount);

    ctx.save();
    ctx.translate(0.5, 0.5);
    ctx.fillStyle = "#fff";
    //ctx.fillStyle= "#0f0";
    ctx.strokeStyle = "#fff";
    for (var i = 0; i < cs.length; i++) {
      if (!cs[i].inner && cs[i].points.length > threshold) {
        var ps = cs[i].points;
        ctx.beginPath();
        ctx.moveTo(ps[0].x, ps[0].y);
        for (var j = 1; j < ps.length; j++) {
          ctx.lineTo(ps[j].x, ps[j].y);
        }
        ctx.closePath();
        ctx.fill();
      }
    }
    this.mask = MagicWand.maskSelection(this.selectionDrawCanvas);
    this.setSelection(this.mask);

    ctx.restore();
  },

  tools: ["adjacentPixels", "pathfinderRadius", "pathfinderThreshold", "selectionTool", "pathfinder", "fillWithCurrentColor", "clear", "pathfinderColor"],
  actions: {

    cancelSelection: {
      visible: false,
      key: 'Escape',
      action: function action() {
        delete this.shouldModify;
        this.mask = MagicWand.createMask(this.editedImageCanvas.width, this.editedImageCanvas.height);
      }
    },
    modifySelection: {
      visible: false,
      key: 'Enter',
      action: function action() {
        if (this.shouldModify) {
          this.modifySelection();
        }
      }
    },
    adjacentPixels: {
      className: 'button-adjacent',
      title: 'selet all',
      type: 'checkbox',
      value: 'adjacentPixels',
      visible: function visible() {
        return this.selectionTool === 'magic';
      },
      observe: 'tool:changed'
    },
    pathfinderRadius: {
      title: 'radius',
      type: 'range',
      value: {
        get: function get() {
          return this.radius;
        },
        set: function set(val) {
          this.radius = val;
        },
        min: 1,
        max: 255
      },
      visible: function visible() {
        return this.selectionTool === 'brush';
      },
      observe: 'tool:changed'
    },
    pathfinderThreshold: {
      title: 'Threshold',
      type: 'range',
      value: {
        observe: 'threshold:changed',
        get: function get() {
          return this.colorThreshold;
        },
        set: function set(val) {
          this.setThreshold(val);
        },
        min: 0,
        max: 255
      },
      visible: function visible() {
        return this.selectionTool === 'magic';
      },
      observe: 'tool:changed'
    },
    selectionTool: {
      title: 'selection-tool',
      type: 'options',
      value: 'selectionTool',
      menu: {
        selectionToolBrush: {
          className: 'fa fa-paint-brush',
          title: 'select-brush',
          option: 'brush'
        },
        selectionToolRectangle: {
          className: 'fa fa-square',
          title: 'select-rectangle',
          option: 'rectangle'
        },
        selectionElliptical: {
          className: 'fa fa-circle',
          title: 'select-circle',
          option: 'circle'
        },
        selectionToolMagic: {
          className: 'fa fa-magic',
          title: 'select-magic',
          option: 'magic'
        },
        selectionToolLasso: {
          use: 'shapeSelectionTools',
          title: 'select-lasso',
          option: 'lasso',
          icon: 'data:image/svg+xml;base64,' + __webpack_require__(80)
        }
      }
    },
    pathfinder: {
      title: 'pathfinder',
      type: 'options',
      value: 'pathfinderMode',
      menu: {
        pathfinderNew: {
          title: 'pathfinder-new',
          option: 'new'
        },
        pathfinderExclude: {
          title: 'pathfinder-exclude',
          option: 'exclude'
        },
        pathfinderSubstract: {
          title: 'pathfinder-substract',
          option: 'substract'
        },
        pathfinderAdd: {
          title: 'pathfinder-add',
          option: 'add'
        },
        pathfinderIntersect: {
          title: 'pathfinder-intersect',
          option: 'intersect'
        }
      }
    },
    fillWithCurrentColor: {
      title: 'fillWithCurrentColor',
      className: 'fa fa-paint-brush'
    },
    clear: {
      className: 'fa fa-eraser',
      id: 'Pathfinder-clear',
      title: 'clear'
    },
    pathfinderColor: {
      title: 'color',
      type: 'color',
      value: 'color'
    }
  }
};

fabric.util.observable(Pathfinder.prototype);

fabric.util.object.extend(Pathfinder.prototype, fabric.ToolsMixin, {
  selectBackground: function selectBackground(fromCorners) {
    var info = this.getInfo(),
        mask;

    if (fromCorners) {
      var mask1 = MagicWand.selectBackground(info, [255, 255, 255, false], this.colorThreshold);
      var mask2 = MagicWand.selectBackground(info, [false, false, false, 0], this.colorThreshold);
      mask = MagicWand.add(mask1, mask2);
    } else {
      mask = MagicWand.selectAllByColor(info, [255, 255, 255, 255], this.colorThreshold);
    }

    if (this.blurRadius) {
      mask = MagicWand.gaussBlurOnlyBorder(mask, this.blurRadius);
    }
    this.setSelection(mask);
  },
  colorSelection: function colorSelection(colors, threshold) {
    var info = this.getInfo(),
        mask2,
        mask = MagicWand.createMask(info.width, info.height);
    for (var i in colors) {
      var _color = new fabric.Color(colors[i])._source;
      _color[3] = Math.round(_color[3] * 255);
      mask2 = MagicWand.selectAllByColor(info, _color, threshold[i]);
      mask = MagicWand.add(mask, mask2);
    }
    delete this.oldMask;
    this.modifySelection(mask);
  },
  smartSelection: function smartSelection(threshold) {
    var info = this.getInfo(),
        mask;
    mask = MagicWand.selectBackground(info, null, threshold || this.colorThreshold);
    mask = MagicWand.invertMask(mask);
    delete this.oldMask;
    this.modifySelection(mask);
  }
});

Pathfinder.prototype.drawingTools = {
  brush: {
    mouseUp: function mouseUp() {
      this.modifySelection();
      this.resetSelectionDrawCanvas();
    },
    mouseMove: function mouseMove(p) {
      if (!this.allowDraw) return;
      this.drawCircle(p.x, p.y, this.radius);
    },
    mouseDown: function mouseDown(point) {
      this.createSelection();
      this.downPoint = point;
      this.createSelectionDrawCanvas();
      this.drawCircle(point.x, point.y, this.radius);
    },
    utils: {
      drawCircle: function drawCircle(x, y, r) {
        var ctx = this.selectionDrawContext,
            v = this.canvas.viewportTransform;
        ctx.save();
        //  ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);
        ctx.beginPath();
        ctx.arc(x, y, this.radius, 0, Math.PI * 2, false);
        ctx.closePath();
        ctx.fill();
        ctx.restore();
        MagicWand.maskSelection(this.selectionDrawCanvas, 0, 0, this.mask, 'add');
        this.setSelection(this.mask);
      }
    }
  },
  magic: {
    mouseUp: function mouseUp() {
      this.shouldModify = true;
    },
    mouseMove: function mouseMove(p) {
      if (!this.allowDraw) return;
      var dist = p.x - this.downPoint.x;

      var val = this._init_thres + dist;
      var thres = Math.min(Math.max(val, 1), 255);
      if (thres != this.colorThreshold) {
        this.setThreshold(thres);
      }
    },
    mouseDown: function mouseDown(point) {
      if (this.shouldModify) {
        this.modifySelection();
      }
      this.downPoint = point;
      this.colorThreshold = 15;
      this.fire('threshold:changed', { threshold: this.colorThreshold });
      this._init_thres = this.colorThreshold;
      this.drawMask(this.downPoint.x, this.downPoint.y, this.adjacentPixels);
      return false;
    },
    utils: {
      drawMask: function drawMask(x, y, adjacentPixels) {
        this.asyncronous(this._drawMask.bind(this, x, y, adjacentPixels), 0);
      },
      _drawMask: function _drawMask(x, y, adjacentPixels) {
        MagicWand.alphaChannel = this.alphaChannel;
        var info = this.getInfo(),
            mask;
        if (adjacentPixels) {
          MagicWand.floodFill(info, x, y, this.colorThreshold, {}, null, function (mask) {
            this.setSelection(mask);
          }.bind(this));
        } else {
          mask = MagicWand.selectAll(info, x, y, this.colorThreshold);
          this.setSelection(mask);
        }
      }
    }
  },
  rectangle: {
    mouseDown: function mouseDown(point) {
      if (this.shouldModify) {
        this.modifySelection();
      }
      this.downPoint = point;
      this.shouldModify = true;
    },
    mouseUp: function mouseUp() {
      //this.modifySelection();
      //this.resetSelectionDrawCanvas();
    },
    mouseMove: function mouseMove(p) {
      if (!this.allowDraw) return;
      this.drawRectangle(this.downPoint.x, this.downPoint.y, p.x, p.y);
    },
    utils: {
      drawRectangle: function drawRectangle(x, y, x2, y2) {
        var info = this.getInfo(),
            mask = MagicWand.selectRectangle(info, x, y, x2, y2);
        this.setSelection(mask);
      }
    }
  },
  circle: {
    mouseDown: function mouseDown(point) {
      if (this.shouldModify) {
        this.modifySelection();
      }
      this.downPoint = point;
      this.createSelectionDrawCanvas();
      this.selectionObject = new fabric.Ellipse({
        left: point.x + this.target.left,
        top: point.y + this.target.top,
        rx: 1,
        ry: 1,
        hasBorders: false,
        originX: 'center',
        originY: 'center',
        strokeWidth: 1,
        fill: 'transparent',
        stroke: 'transparent'
      });
      this.canvas.add(this.selectionObject);
      this.updateShape();
    },
    mouseUp: function mouseUp() {
      this.canvas.setInteractiveMode("mixed");
      this.selectionObject.setCoords();
      var _this = this;
      this.selectionObject.on('scaling moving rotating', function () {
        _this.updateShape();
      });
      this.canvas.setActiveObject(this.selectionObject);
      this.shouldModify = true;
      //  this.modifySelection();
      //  this.resetSelectionDrawCanvas();
    },
    mouseMove: function mouseMove(p) {
      if (!this.allowDraw) return;
      this.selectionObject.set({
        rx: Math.abs(p.x + this.target.left - this.selectionObject.get('left')),
        ry: Math.abs(p.y + this.target.top - this.selectionObject.get('top'))
      });

      this.updateShape();
    },
    utils: {
      updateShape: function updateShape() {
        this.resetSelectionDrawCanvas();
        this.selectionObject.fill = 'white';
        this.selectionDrawContext.save();
        this.selectionDrawContext.translate(-this.target.left, -this.target.top);
        this.selectionObject.render(this.selectionDrawContext);
        this.selectionDrawContext.restore();
        this.selectionObject.fill = 'transparent';
        this.mask = MagicWand.maskSelection(this.selectionDrawCanvas);
        this.setSelection(this.mask);
      }
    }
  },
  lasso: {
    mouseUp: function mouseUp() {
      if (this.readyToClosePath) {
        this._closePath();
      }
    },
    mouseMove: function mouseMove(p) {
      if (!this.allowDraw) return;
      this.drawLine(this._last_point, p);
      this._points.push(p);
      this._last_point = p;
    },
    mouseDown: function mouseDown(point) {
      if (!this.downPoint) {
        this.createSelection();
        this.createSelectionDrawCanvas();
        this._path_out = false;
        this.downPoint = point;
        this._points = [];
        this.selectionDrawContext.beginPath();
        this.canvas.on('mouse:move', this._changeCursorOverClosePoint);
      }
      if (this._last_point) {
        if (this.readyToClosePath) {
          this._closePath();
        } else {
          this.drawLine(this._last_point, point);
          this._last_point = point;
          this._points.push(point);
        }
      } else {

        this.drawLine({ x: point.x - 0.5, y: point.y }, { x: point.x + 0.5, y: point.y });
        this._last_point = { x: point.x + 0.5, y: point.y };
        this._points.push(point);
        this.shouldModify = true;
      }
    },
    utils: {
      drawLine: function drawLine(p1, p2) {
        var ctx = this.selectionDrawContext,
            v = this.canvas.viewportTransform;
        ctx.save();
        //ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);
        ctx.moveTo(p1.x, p1.y);
        ctx.lineTo(p2.x, p2.y);
        ctx.stroke();
        ctx.restore();
        MagicWand.maskSelection(this.selectionDrawCanvas, 0, 0, this.mask, 'add');
        this.setSelection(this.mask);
      },
      _closePath: function _closePath(e) {

        this.allowDraw = false;
        var ctx = this.selectionDrawContext;
        ctx.beginPath();
        ctx.moveTo(this._points[0].x, this._points[0].y);
        for (var i = 1; i < this._points.length; i++) {
          ctx.lineTo(this._points[i].x, this._points[i].y);
        }
        ctx.closePath();
        ctx.fill();
        MagicWand.maskSelection(this.selectionDrawCanvas, 0, 0, this.mask, 'add');
        this.setSelection(this.mask);
        this.resetSelectionDrawCanvas();
        this._points = [];
        delete this.downPoint;
        delete this.readyToClosePath;
        delete this._last_point;
        this.canvas.off('mouse:move', this._changeCursorOverClosePoint);
        this.canvas.freeDrawingCursor = 'crosshair';
        this.canvas.setCursor(this.canvas.freeDrawingCursor);
        // this.drawLine(this._last_point, this.downPoint);
      },
      _changeCursorOverClosePoint: function _changeCursorOverClosePoint(e) {
        var canvas = this,
            pathfinder = canvas.pathfinder;
        if (!pathfinder.target) return;
        var ivt = fabric.util.invertTransform(canvas.viewportTransform),
            p = fabric.util.transformPoint(canvas.getPointer(e.e, true), ivt);
        p.x -= pathfinder.target.left;
        p.y -= pathfinder.target.top;
        if (pathfinder.downPoint && pathfinder.downPoint.distanceFrom(p) < 10) {
          if (!pathfinder._path_out) {
            return;
          }
          pathfinder.readyToClosePath = true;
          canvas.freeDrawingCursor = canvas.targetCursor;
          canvas.setCursor(canvas.freeDrawingCursor);
          //console.log(canvas.freeDrawingCursor);
        } else {
          pathfinder._path_out = true;
          pathfinder.readyToClosePath = false;
          canvas.freeDrawingCursor = 'crosshair';
          canvas.setCursor(canvas.freeDrawingCursor);
          // console.log(canvas.freeDrawingCursor);
        }
      }
    }
  }
};
for (var i in Pathfinder.prototype.drawingTools) {
  fabric.util.object.extend(Pathfinder.prototype, Pathfinder.prototype.drawingTools[i].utils);
}
fabric.Pathfinder = Pathfinder;

fabric.util.object.extend(fabric.SlideCanvas.prototype, {
  pathfinder: false,
  setPathfinder: function setPathfinder(val) {
    if (val) {
      this.pathfinder = new fabric.Pathfinder('pathfinder');
      this.pathfinder.canvas = this;
    }
  },
  getPathfinder: function getPathfinder() {
    return this.pathfinder || this.application && this.application.pathfinder;
  }
});

fabric.util.object.extend(fabric.Application.prototype, {
  initPathfinder: function initPathfinder() {
    //if(this.pathfinder){

    this.pathfinder = new fabric.Pathfinder({
      application: this
    });

    this.pathfinder.on("image:changed", function (img) {
      var dataUrl = img.toDataURL();
      if (!this.target._originalElement) {
        this.target._originalElement = this.target._element;
      }
      this.target._element = new Image();

      this.target._element.onload = function () {
        this.target.fire("content:modified");
        this.target.canvas && this.target.canvas.renderAll();
      }.bind(this);

      this.target._element.src = dataUrl;
      this.target._edited = true;
      if (this.target.dirty !== "undefined") {
        this.target.dirty = true;
      }
    });
    //}
  }
});

fabric.util.object.extend(fabric.Application.prototype, {
  eventListeners: fabric.util.object.extendArraysObject(fabric.Application.prototype.eventListeners, {
    "ready": function ready() {
      this.initPathfinder();
    }
  })
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 80 */
/***/ (function(module, exports) {

module.exports = "PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMiAyMiI+PGcgdHJhbnNmb3JtPSJtYXRyaXgoLjAzOTY1IDAgMCAuMDM5NjUgMS4xNjMgMS4xNjMpIiBmaWxsPSIjNGQ0ZDRkIj48cGF0aCBkPSJtMjUwLjIgODEuNjFjOTcuNDMgMCAxNzkuNzUgNDMuNDMgMTc5Ljc1IDk0LjgzIDAgMTIuNDQ5LTQuOTM0IDI0LjQ0OS0xMy42NDUgMzUuNDY1bDM1LjQwMiAxMC40MDRjOC42MTMtMTQuMjI3IDEzLjUzMy0yOS42MjkgMTMuNTMzLTQ1Ljg2OSAwLTcyLjk2NS05NC40Ni0xMzAuMTItMjE1LjA0LTEzMC4xMi0xMjAuNTcgMC0yMTUuMDQgNTcuMTYtMjE1LjA0IDEzMC4xMiAwIDI2LjkxOCAxMi45MzYgNTEuNjQzIDM1LjE5IDcyLjE3LTYuOTUxIDQuNTAyLTEzLjc1NiAxMC41MDItMTguODM2IDE4Ljk4NC0xMC40NTMgMTcuNDQ5LTEwLjY2IDM5LjA5LS42NDUgNjQuMzUgOS40MzMgMjMuNzkxIDcuMTI1IDMyLjU4MiA1LjY5MyAzNS4yNC0zLjM1NCA2LjMyMi0xOC4xMyA5LjUxNC0zMi4zODUgMTIuNTk2LTMuNDg2Ljc1OC03LjA0IDEuNTMxLTEwLjU4MiAyLjM3MS05LjQ4NCAyLjI0LTE1LjM1MyAxMS43MjUtMTMuMTMgMjEuMjMgMS45MDIgOC4xMTEgOS4xNjQgMTMuNTk2IDE3LjE2IDEzLjU5NiAxLjM0IDAgMi43MDktLjE2IDQuMDY4LS40NjcgMy4zMi0uNzkxIDYuNjU2LTEuNTE4IDkuOTMyLTIuMjI3IDIxLjExLTQuNTY0IDQ1LjAyLTkuNzQyIDU2LjA4LTMwLjQ4MiA4LjQ4Ni0xNS45MDIgNy4xOTUtMzYuNTE2LTQuMDMtNjQuODUtNS43MjUtMTQuNDM1LTYuMzg1LTI1LjU2NC0xLjk0Ny0zMy4xIDQuOTY1LTguNDUxIDE2LjE0LTEyLjIwNyAyMi4xOS0xMy40NjcgMzUuNzA1IDE5LjkwMiA4Mi44NSAzMi4zNTQgMTM1LjU5IDMzLjg2OWwtMTAuNTA0LTM1Ljc0Yy04Ny44Ny01Ljc1OC0xNTguNTYtNDYuNDUtMTU4LjU2LTk0LjA3LjAwMDEtNTEuNCA4Mi4zMi05NC44MyAxNzkuNzUtOTQuODMiLz48cGF0aCBkPSJtNDg3LjU3IDI2OS42M2wtMjIyLjA1LTY1LjI3Yy0xLjExNS0uMzM4LTIuMjQ0LS40ODItMy4zNzMtLjQ4Mi0zLjExMyAwLTYuMTU4IDEuMjI3LTguNDM0IDMuNS0zLjA5NiAzLjA4LTQuMjU4IDcuNjEzLTMuMDIgMTEuNzg5bDY1LjI3IDIyMi4xYzEuMzQgNC42MTMgNS4zNTIgNy45ODIgMTAuMTQzIDguNS40NTMuMDQ3Ljg5MS4wNjQgMS4zMjIuMDY0IDQuMzA5IDAgOC4zMDctMi4zMzggMTAuNDM5LTYuMTYybDU0LjA4LTk4LjA0IDk4LjAzLTU0LjA5YzQuMjI1LTIuMzIyIDYuNjI5LTYuOTUxIDYuMS0xMS43MjctLjUxNC00Ljc4Ny0zLjg3NC04LjgwNS04LjUwMi0xMC4xNzYiLz48L2c+PC9zdmc+Cg=="

/***/ }),
/* 81 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

// require("../modules/pathfinder");
__webpack_require__(82);

fabric.util.object.extend(fabric.Image.prototype, {
  removeWhite: function removeWhite(threshold, removeAll, callback) {

    var rwf = _.findWhere(this.filters, { type: 'RemoveWhiteDP' });

    if (rwf) {
      rwf.options.colorThreshold = threshold;
      rwf.options.fromCorners = !removeAll;
    } else {
      rwf = new fabric.Image.filters.RemoveWhiteDP({
        fromCorners: !removeAll,
        blurRadius: 2,
        colorThreshold: threshold
      });
      this.filters.push(rwf);
    }

    var _this = this;
    this.applyFilters(function () {
      //_this.width = _this._element.width;
      //_this.height = _this._element.height;
      _this.canvas.renderAll();
      _this.fire("content:modified", { filter: rwf, bounds: rwf.bounds });
      callback && callback();
    });
  },
  removeWhiteAll: true,

  actions: fabric.util.object.extend(fabric.Image.prototype.actions, {
    removeWhiteFromBorders: {
      title: 'Remove Background',
      type: 'effect',
      className: "fa fa-dot-circle-o",
      effectTpl: '<button id="select-colors-action-button" class="fa fa-check"></button>' + '<input id="select-colors-checkbox" type="checkbox">' + '<input id="select-colors-threshold" type="range"   min="1" max="255">',
      actionParameters: function actionParameters(el, data) {
        var actionChk = el.find('#select-colors-checkbox'),
            actionBtn = el.find('#select-colors-action-button');
        data.thresholdEl = el.find('#select-colors-threshold');

        data.removeWhiteAll = actionChk.is(":checked");
        actionChk.change(function () {
          data.removeWhiteAll = actionChk.is(":checked");
        });
        actionBtn.click(function () {
          data.action();
        });
        if (!data.__action) {

          data.__action = data.action;
          data.action = function () {
            data.__action(parseInt(data.thresholdEl.val()), data.removeWhiteAll);
          };
        }
      },
      action: "removeWhite",
      insert: 'imageTools'
    }
  })
});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 82 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.RemoveWhiteDP = fabric.Image.filters.RemoveWhiteDP = fabric.util.createClass(fabric.Image.filters.BaseFilter, {
    type: 'RemoveWhiteDP',
    initialize: function initialize(options) {
        if (options) delete options.type;
        this.options = fabric.util.object.defaults(options || {}, {
            fromCorners: true,
            blurRadius: 2,
            colorThreshold: 32
        });
        this.pathfinder = new fabric.Pathfinder(this.options);
    },
    applyTo: function applyTo(canvasEl) {

        var pathfinder = this.pathfinder;

        pathfinder.colorThreshold = this.options.colorThreshold;
        pathfinder.setPicture(canvasEl);
        pathfinder.selectBackground(this.options.fromCorners);
        if (pathfinder.mask.count) {
            pathfinder._fill([0, 0, 0, 0]);
            pathfinder.mask = fabric.MagicWand.invertMask(pathfinder.mask);
            //todo inverting mask

            if (pathfinder.mask.count) {
                var _width = pathfinder.mask.bounds.maxX - pathfinder.mask.bounds.minX + 1;
                var _height = pathfinder.mask.bounds.maxY - pathfinder.mask.bounds.minY + 1;
                var ctx = canvasEl.getContext('2d');
                var imageData = pathfinder.editedImageCanvas.getContext('2d').getImageData(pathfinder.mask.bounds.minX, pathfinder.mask.bounds.minY, _width, _height);
                canvasEl.width = _width;
                canvasEl.height = _height;
                ctx.putImageData(imageData, 0, 0);
                this.bounds = pathfinder.mask.bounds;
            } else {
                var ctx = canvasEl.getContext('2d');
                canvasEl.width = 1;
                canvasEl.height = 1;
                ctx.clearRect(0, 0, 1, 1);
                this.bounds = {
                    maxX: 0,
                    maxY: 0,
                    minX: 0,
                    minY: 0
                };
            }
        }

        //clip the image
        pathfinder.clearMemory();
    },
    toObject: function toObject() {
        return fabric.util.object.extend(this.callSuper('toObject'), this.options);
    }
});

fabric.Image.filters.RemoveWhiteDP.fromObject = function (object) {
    return new fabric.Image.filters.RemoveWhiteDP(object);
};
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 83 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

//----------------------------------------------------------------------------------------------------------------------
// ListStyle

fabric.util.object.extend(fabric.Textbox.prototype, {
  stateProperties: fabric.Rect.prototype.stateProperties.concat(["listStyleType", "listStyleFormat", "listTextPadding", "textPadding"]),
  listStyleType: "none",
  listStyleFormat: "N.",
  listTextPadding: 40,
  textPadding: 0,
  setTextPadding: function setTextPadding(val) {
    this.textPadding = val;
    this._initDimensions();
  },
  setListStyleType: function setListStyleType(val) {
    this.listStyleType = val;
    this.setTextPadding(val === "none" ? 0 : this.listTextPadding);
  },
  /**
   * Wraps text using the 'width' property of Textbox. First this function
   * splits text on newlines, so we preserve newlines entered by the user.
   * Then it wraps each line using the width of the Textbox by calling
   * _wrapLine().
   * @param {CanvasRenderingContext2D} ctx Context to use for measurements
   * @param {String} text The string of text that is split into lines
   * @returns {Array} Array of lines
   */
  _wrapText: function _wrapText(ctx, text) {
    var lines = text.split(this._reNewline),
        wrapped = [],
        i;

    this._paragraphs = {};

    for (i = 0; i < lines.length; i++) {
      this._paragraphs[wrapped.length] = this.listStyleFormat.replace("N", i + 1);
      wrapped = wrapped.concat(this._wrapLine(ctx, lines[i], i));
    }

    return wrapped;
  },

  /**
   * Wraps a line of text using the width of the Textbox and a context.
   * @param {CanvasRenderingContext2D} ctx Context to use for measurements
   * @param {String} text The string of text to split into lines
   * @param {Number} lineIndex
   * @returns {Array} Array of line(s) into which the given text is wrapped
   * to.
   */
  _wrapLine: function _wrapLine(ctx, text, lineIndex) {
    var lineWidth = 0,
        lines = [],
        line = '',
        words = text.split(' '),
        word = '',
        offset = 0,
        infix = ' ',
        wordWidth = 0,
        infixWidth = 0,
        largestWordWidth = 0,
        lineJustStarted = true,
        additionalSpace = this._getWidthOfCharSpacing();

    var _textAreaWidth = this.width;
    if (this.textPadding) {
      _textAreaWidth -= this.textPadding;
    }
    for (var i = 0; i < words.length; i++) {
      word = words[i];
      wordWidth = this._measureText(ctx, word, lineIndex, offset);

      offset += word.length;

      lineWidth += infixWidth + wordWidth - additionalSpace;

      if (lineWidth >= _textAreaWidth && !lineJustStarted) {
        lines.push(line);
        line = '';
        lineWidth = wordWidth;
        lineJustStarted = true;
      } else {
        lineWidth += additionalSpace;
      }

      if (!lineJustStarted) {
        line += infix;
      }
      line += word;

      infixWidth = this._measureText(ctx, infix, lineIndex, offset);
      offset++;
      lineJustStarted = false;
      // keep track of largest word
      if (wordWidth > largestWordWidth) {
        largestWordWidth = wordWidth;
      }
    }

    i && lines.push(line);

    if (largestWordWidth > this.dynamicMinWidth) {
      this.dynamicMinWidth = largestWordWidth - additionalSpace;
    }

    return lines;
  },
  /**
   * @private
   * @param {Number} lineWidth Width of text line
   * @return {Number} Line left offset
   */
  _getLineLeftOffset: function _getLineLeftOffset(lineWidth) {
    if (this.textAlign === 'center') {
      return (this.width - lineWidth) / 2 + this.textPadding / 2;
    }
    if (this.textAlign === 'right') {
      return this.width - lineWidth;
    }
    return this.textPadding;
  },
  /**
   * @private
   * @param {CanvasRenderingContext2D} ctx Context to render on
   * @param {String} method Method name ("fillText" or "strokeText")
   */
  _renderTextCommon: function _renderTextCommon(ctx, method) {

    var lineHeights = 0,
        left = this._getLeftOffset(),
        top = this._getTopOffset();

    for (var i = 0, len = this._textLines.length; i < len; i++) {
      var heightOfLine = this._getHeightOfLine(ctx, i),
          maxHeight = heightOfLine / this.lineHeight,
          lineWidth = this._getLineWidth(ctx, i),
          leftOffset = this._getLineLeftOffset(lineWidth);

      this._renderTextLine(method, ctx, this._textLines[i], left + leftOffset, top + lineHeights + maxHeight, i);
      lineHeights += heightOfLine;
    }
  },

  /**
   * @private
   * @param {String} method Method name ("fillText" or "strokeText")
   * @param {CanvasRenderingContext2D} ctx Context to render on
   * @param {String} line Text to render
   * @param {Number} left Left position of text
   * @param {Number} top Top position of text
   * @param {Number} lineIndex Index of a line in a text
   */
  _renderTextLine: function _renderTextLine(method, ctx, line, left, top, lineIndex) {

    // lift the line by quarter of fontSize
    top -= this.fontSize * this._fontSizeFraction;

    switch (this.listStyleType) {
      case "decimal":
        if (this._paragraphs[lineIndex]) {
          // lift the line by quarter of fontSize
          this._renderChars(method, ctx, this._paragraphs[lineIndex], left - this.textPadding, top, lineIndex, 0);
        }
    }

    // short-circuit
    var lineWidth = this._getLineWidth(ctx, lineIndex);
    if (this.textAlign !== 'justify' || this.width < lineWidth) {

      this._renderChars(method, ctx, line, left, top, lineIndex);
      return;
    }

    // stretch the line
    var words = line.split(/\s+/),
        charOffset = 0,
        wordsWidth = this._getWidthOfWords(ctx, words.join(''), lineIndex, 0),
        widthDiff = this.width - wordsWidth - this.textPadding,
        numSpaces = words.length - 1,
        spaceWidth = numSpaces > 0 ? widthDiff / numSpaces : 0,
        leftOffset = 0,
        word;

    for (var i = 0, len = words.length; i < len; i++) {
      while (line[charOffset] === ' ' && charOffset < line.length) {
        charOffset++;
      }
      word = words[i];
      this._renderChars(method, ctx, word, left + leftOffset, top, lineIndex, charOffset);
      leftOffset += this._getWidthOfWords(ctx, word, lineIndex, charOffset) + spaceWidth;
      charOffset += word.length;
    }
  },
  toggleListStyleType: function toggleListStyleType() {
    this.setListStyleType(this.listStyleType == "none" ? "decimal" : "none");
    this.canvas.renderAll();
  },
  actions: {
    toggleListStyleType: {
      className: 'fa fa-list-ol',
      title: 'ordered list'
    }
  }

});
/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 84 */
/***/ (function(module, exports) {

module.exports = "PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgICB4bWxuczppbmtzY2FwZT0iaHR0cDovL3d3dy5pbmtzY2FwZS5vcmcvbmFtZXNwYWNlcy9pbmtzY2FwZSIKICAgIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyIKICAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgIHhtbG5zOmNjPSJodHRwOi8vY3JlYXRpdmVjb21tb25zLm9yZy9ucyMiCiAgICB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIKICAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgICB4bWxuczpuczE9Imh0dHA6Ly9zb3ppLmJhaWVyb3VnZS5mciIKICAgIGlkPSJzdmc0ODg4IgogICAgc29kaXBvZGk6ZG9jbmFtZT0id2FybmluZ19idXR0b24uc3ZnIgogICAgdmlld0JveD0iMCAwIDQwMCA0MDAiCiAgICB2ZXJzaW9uPSIxLjEiCiAgICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ4LjAgcjk2NTQiCiAgPgogIDxkZWZzCiAgICAgIGlkPSJkZWZzNDg5MCIKICAgID4KICAgIDxsaW5lYXJHcmFkaWVudAogICAgICAgIGlkPSJsaW5lYXJHcmFkaWVudDg0MTEiCiAgICAgICAgeTI9IjM2Ny44OCIKICAgICAgICBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIKICAgICAgICB5MT0iMjg3LjQ5IgogICAgICAgIHgyPSIzMTUuNDciCiAgICAgICAgeDE9IjI0MS40MSIKICAgICAgICBpbmtzY2FwZTpjb2xsZWN0PSJhbHdheXMiCiAgICAgID4KICAgICAgPHN0b3AKICAgICAgICAgIGlkPSJzdG9wNDE1OCIKICAgICAgICAgIHN0eWxlPSJzdG9wLWNvbG9yOiNmZmZmZmYiCiAgICAgICAgICBvZmZzZXQ9IjAiCiAgICAgIC8+CiAgICAgIDxzdG9wCiAgICAgICAgICBpZD0ic3RvcDQxNjAiCiAgICAgICAgICBzdHlsZT0ic3RvcC1jb2xvcjojZmZmZmZmO3N0b3Atb3BhY2l0eTowIgogICAgICAgICAgb2Zmc2V0PSIxIgogICAgICAvPgogICAgPC9saW5lYXJHcmFkaWVudAogICAgPgogICAgPGZpbHRlcgogICAgICAgIGlkPSJmaWx0ZXI2MTI2IgogICAgICAgIGNvbG9yLWludGVycG9sYXRpb24tZmlsdGVycz0ic1JHQiIKICAgICAgICBpbmtzY2FwZTpjb2xsZWN0PSJhbHdheXMiCiAgICAgID4KICAgICAgPGZlR2F1c3NpYW5CbHVyCiAgICAgICAgICBpZD0iZmVHYXVzc2lhbkJsdXI2MTI4IgogICAgICAgICAgc3RkRGV2aWF0aW9uPSIwLjUzMDM1NzEzIgogICAgICAgICAgaW5rc2NhcGU6Y29sbGVjdD0iYWx3YXlzIgogICAgICAvPgogICAgPC9maWx0ZXIKICAgID4KICAgIDxsaW5lYXJHcmFkaWVudAogICAgICAgIGlkPSJsaW5lYXJHcmFkaWVudDg0MTMiCiAgICAgICAgeTI9IjM5MS40NSIKICAgICAgICBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIKICAgICAgICB5MT0iMzAwLjg2IgogICAgICAgIHgyPSIzNDIiCiAgICAgICAgeDE9IjI3NS42MSIKICAgICAgICBpbmtzY2FwZTpjb2xsZWN0PSJhbHdheXMiCiAgICAgID4KICAgICAgPHN0b3AKICAgICAgICAgIGlkPSJzdG9wNzIwMSIKICAgICAgICAgIHN0eWxlPSJzdG9wLWNvbG9yOiM1NTAwMDAiCiAgICAgICAgICBvZmZzZXQ9IjAiCiAgICAgIC8+CiAgICAgIDxzdG9wCiAgICAgICAgICBpZD0ic3RvcDcyMDMiCiAgICAgICAgICBzdHlsZT0ic3RvcC1jb2xvcjojZmYwMDAwIgogICAgICAgICAgb2Zmc2V0PSIxIgogICAgICAvPgogICAgPC9saW5lYXJHcmFkaWVudAogICAgPgogICAgPHJhZGlhbEdyYWRpZW50CiAgICAgICAgaWQ9InJhZGlhbEdyYWRpZW50ODQxNSIKICAgICAgICBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIKICAgICAgICBjeD0iMzEyLjc4IgogICAgICAgIGN5PSIzODYuNTciCiAgICAgICAgcj0iNTMuMDM2IgogICAgICAgIGdyYWRpZW50VHJhbnNmb3JtPSJtYXRyaXgoLS41OTMyNyAtLjU5MzI3IC43MTUwNSAtLjcxNTA1IDI0My4yNyA4NDkuMDMpIgogICAgICAgIGlua3NjYXBlOmNvbGxlY3Q9ImFsd2F5cyIKICAgICAgPgogICAgICA8c3RvcAogICAgICAgICAgaWQ9InN0b3A3MTEzLTciCiAgICAgICAgICBzdHlsZT0ic3RvcC1jb2xvcjojZmZmZmZmO3N0b3Atb3BhY2l0eTouNDA4MTYiCiAgICAgICAgICBvZmZzZXQ9IjAiCiAgICAgIC8+CiAgICAgIDxzdG9wCiAgICAgICAgICBpZD0ic3RvcDcxMTUtNyIKICAgICAgICAgIHN0eWxlPSJzdG9wLWNvbG9yOiNmZmZmZmY7c3RvcC1vcGFjaXR5OjAiCiAgICAgICAgICBvZmZzZXQ9IjEiCiAgICAgIC8+CiAgICA8L3JhZGlhbEdyYWRpZW50CiAgICA+CiAgICA8bGluZWFyR3JhZGllbnQKICAgICAgICBpZD0ibGluZWFyR3JhZGllbnQxMDQ0OSIKICAgICAgICB5Mj0iMzM4LjgyIgogICAgICAgIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIgogICAgICAgIHkxPSIyODYuNjciCiAgICAgICAgZ3JhZGllbnRUcmFuc2Zvcm09Im1hdHJpeCguOTU1MzQgMCAwIC45NTUzNCAxMzYuMTIgMTQuMDU1KSIKICAgICAgICB4Mj0iMzAwLjI3IgogICAgICAgIHgxPSIyNTUuMzIiCiAgICAgICAgaW5rc2NhcGU6Y29sbGVjdD0iYWx3YXlzIgogICAgICA+CiAgICAgIDxzdG9wCiAgICAgICAgICBpZD0ic3RvcDQxNTAiCiAgICAgICAgICBzdHlsZT0ic3RvcC1jb2xvcjojZmZmZmZmIgogICAgICAgICAgb2Zmc2V0PSIwIgogICAgICAvPgogICAgICA8c3RvcAogICAgICAgICAgaWQ9InN0b3A0MTUyIgogICAgICAgICAgc3R5bGU9InN0b3AtY29sb3I6I2ZmZmZmZjtzdG9wLW9wYWNpdHk6MCIKICAgICAgICAgIG9mZnNldD0iMSIKICAgICAgLz4KICAgIDwvbGluZWFyR3JhZGllbnQKICAgID4KICAgIDxmaWx0ZXIKICAgICAgICBpZD0iZmlsdGVyMTE0MjgiCiAgICAgICAgY29sb3ItaW50ZXJwb2xhdGlvbi1maWx0ZXJzPSJzUkdCIgogICAgICAgIGlua3NjYXBlOmNvbGxlY3Q9ImFsd2F5cyIKICAgICAgPgogICAgICA8ZmVHYXVzc2lhbkJsdXIKICAgICAgICAgIGlkPSJmZUdhdXNzaWFuQmx1cjExNDMwIgogICAgICAgICAgc3RkRGV2aWF0aW9uPSIxLjI0MzQ2NzgiCiAgICAgICAgICBpbmtzY2FwZTpjb2xsZWN0PSJhbHdheXMiCiAgICAgIC8+CiAgICA8L2ZpbHRlcgogICAgPgogIDwvZGVmcwogID4KICA8c29kaXBvZGk6bmFtZWR2aWV3CiAgICAgIGlkPSJiYXNlIgogICAgICBib3JkZXJjb2xvcj0iIzY2NjY2NiIKICAgICAgaW5rc2NhcGU6cGFnZXNoYWRvdz0iMiIKICAgICAgaW5rc2NhcGU6d2luZG93LXk9Ii04IgogICAgICBwYWdlY29sb3I9IiNmZmZmZmYiCiAgICAgIGlua3NjYXBlOndpbmRvdy1oZWlnaHQ9Ijk4OCIKICAgICAgaW5rc2NhcGU6d2luZG93LW1heGltaXplZD0iMSIKICAgICAgaW5rc2NhcGU6em9vbT0iMC43MDcxMDY3OCIKICAgICAgaW5rc2NhcGU6d2luZG93LXg9Ii04IgogICAgICBzaG93Z3JpZD0iZmFsc2UiCiAgICAgIGJvcmRlcm9wYWNpdHk9IjEuMCIKICAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ibGF5ZXIxIgogICAgICBpbmtzY2FwZTpjeD0iMzA0Ljg5NDA5IgogICAgICBpbmtzY2FwZTpjeT0iMzQxLjUyMTg2IgogICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9IjE2ODAiCiAgICAgIGlua3NjYXBlOnBhZ2VvcGFjaXR5PSIwLjAiCiAgICAgIGlua3NjYXBlOmRvY3VtZW50LXVuaXRzPSJweCIKICAvPgogIDxnCiAgICAgIGlkPSJsYXllcjEiCiAgICAgIGlua3NjYXBlOmxhYmVsPSJMYXllciAxIgogICAgICBpbmtzY2FwZTpncm91cG1vZGU9ImxheWVyIgogICAgICB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwIC02NTIuMzYpIgogICAgPgogICAgPGcKICAgICAgICBpZD0iZzExNDMyIgogICAgICAgIGlua3NjYXBlOmV4cG9ydC15ZHBpPSI5MCIKICAgICAgICBpbmtzY2FwZTpleHBvcnQteGRwaT0iOTAiCiAgICAgICAgdHJhbnNmb3JtPSJtYXRyaXgoMi45MDUxIDAgMCAyLjkwNTEgLTEwMDEuOSAtNzguOTYxKSIKICAgICAgPgogICAgICA8cGF0aAogICAgICAgICAgaWQ9InBhdGg3Mjc2IgogICAgICAgICAgc29kaXBvZGk6cng9IjUzLjAzNTcxMyIKICAgICAgICAgIHNvZGlwb2RpOnJ5PSI1My4wMzU3MTMiCiAgICAgICAgICBzdHlsZT0iZmlsbDojOTk5OTk5IgogICAgICAgICAgc29kaXBvZGk6dHlwZT0iYXJjIgogICAgICAgICAgZD0ibTM1Ni43OSAzNDYuMTFjMCAyOS4yOTEtMjMuNzQ1IDUzLjAzNi01My4wMzYgNTMuMDM2cy01My4wMzYtMjMuNzQ1LTUzLjAzNi01My4wMzYgMjMuNzQ1LTUzLjAzNiA1My4wMzYtNTMuMDM2IDUzLjAzNiAyMy43NDUgNTMuMDM2IDUzLjAzNnoiCiAgICAgICAgICB0cmFuc2Zvcm09Im1hdHJpeCguOTczNTQgMCAwIC45NzM1NCAxMjAuMDkgLTEyLjYyOCkiCiAgICAgICAgICBzb2RpcG9kaTpjeT0iMzQ2LjExMjE4IgogICAgICAgICAgc29kaXBvZGk6Y3g9IjMwMy43NSIKICAgICAgLz4KICAgICAgPHBhdGgKICAgICAgICAgIGlkPSJwYXRoNzI3OCIKICAgICAgICAgIHNvZGlwb2RpOnJ4PSI1My4wMzU3MTMiCiAgICAgICAgICBzb2RpcG9kaTpyeT0iNTMuMDM1NzEzIgogICAgICAgICAgc3R5bGU9ImZpbGw6dXJsKCNsaW5lYXJHcmFkaWVudDg0MTEpIgogICAgICAgICAgc29kaXBvZGk6dHlwZT0iYXJjIgogICAgICAgICAgZD0ibTM1Ni43OSAzNDYuMTFjMCAyOS4yOTEtMjMuNzQ1IDUzLjAzNi01My4wMzYgNTMuMDM2cy01My4wMzYtMjMuNzQ1LTUzLjAzNi01My4wMzYgMjMuNzQ1LTUzLjAzNiA1My4wMzYtNTMuMDM2IDUzLjAzNiAyMy43NDUgNTMuMDM2IDUzLjAzNnoiCiAgICAgICAgICB0cmFuc2Zvcm09Im1hdHJpeCguOTU5NjAgMCAwIC45NTk2MCAxMjQuMzMgLTcuODAxNCkiCiAgICAgICAgICBzb2RpcG9kaTpjeT0iMzQ2LjExMjE4IgogICAgICAgICAgc29kaXBvZGk6Y3g9IjMwMy43NSIKICAgICAgLz4KICAgICAgPHBhdGgKICAgICAgICAgIGlkPSJwYXRoNzI4MCIKICAgICAgICAgIHNvZGlwb2RpOnJ4PSI1My4wMzU3MTMiCiAgICAgICAgICBzb2RpcG9kaTpyeT0iNTMuMDM1NzEzIgogICAgICAgICAgc3R5bGU9ImZpbHRlcjp1cmwoI2ZpbHRlcjYxMjYpO2ZpbGw6I2VjZWNlYyIKICAgICAgICAgIHNvZGlwb2RpOnR5cGU9ImFyYyIKICAgICAgICAgIGQ9Im0zNTYuNzkgMzQ2LjExYzAgMjkuMjkxLTIzLjc0NSA1My4wMzYtNTMuMDM2IDUzLjAzNnMtNTMuMDM2LTIzLjc0NS01My4wMzYtNTMuMDM2IDIzLjc0NS01My4wMzYgNTMuMDM2LTUzLjAzNiA1My4wMzYgMjMuNzQ1IDUzLjAzNiA1My4wMzZ6IgogICAgICAgICAgdHJhbnNmb3JtPSJtYXRyaXgoLjg3MzU1IDAgMCAuODczNTUgMTUwLjQ3IDIxLjk4MSkiCiAgICAgICAgICBzb2RpcG9kaTpjeT0iMzQ2LjExMjE4IgogICAgICAgICAgc29kaXBvZGk6Y3g9IjMwMy43NSIKICAgICAgLz4KICAgICAgPHBhdGgKICAgICAgICAgIGlkPSJwYXRoNzI4MiIKICAgICAgICAgIHNvZGlwb2RpOnJ4PSI1My4wMzU3MTMiCiAgICAgICAgICBzb2RpcG9kaTpyeT0iNTMuMDM1NzEzIgogICAgICAgICAgc3R5bGU9ImZpbHRlcjp1cmwoI2ZpbHRlcjYxMjYpO2ZpbGw6Izk5OTk5OSIKICAgICAgICAgIHNvZGlwb2RpOnR5cGU9ImFyYyIKICAgICAgICAgIGQ9Im0zNTYuNzkgMzQ2LjExYzAgMjkuMjkxLTIzLjc0NSA1My4wMzYtNTMuMDM2IDUzLjAzNnMtNTMuMDM2LTIzLjc0NS01My4wMzYtNTMuMDM2IDIzLjc0NS01My4wMzYgNTMuMDM2LTUzLjAzNiA1My4wMzYgMjMuNzQ1IDUzLjAzNiA1My4wMzZ6IgogICAgICAgICAgdHJhbnNmb3JtPSJtYXRyaXgoLjgzODM4IDAgMCAuODM4MzggMTYxLjE1IDM0LjE1MikiCiAgICAgICAgICBzb2RpcG9kaTpjeT0iMzQ2LjExMjE4IgogICAgICAgICAgc29kaXBvZGk6Y3g9IjMwMy43NSIKICAgICAgLz4KICAgICAgPHBhdGgKICAgICAgICAgIGlkPSJwYXRoNzI4NCIKICAgICAgICAgIHNvZGlwb2RpOnJ4PSI1My4wMzU3MTMiCiAgICAgICAgICBzb2RpcG9kaTpyeT0iNTMuMDM1NzEzIgogICAgICAgICAgc3R5bGU9ImZpbGw6dXJsKCNsaW5lYXJHcmFkaWVudDg0MTMpIgogICAgICAgICAgc29kaXBvZGk6dHlwZT0iYXJjIgogICAgICAgICAgZD0ibTM1Ni43OSAzNDYuMTFjMCAyOS4yOTEtMjMuNzQ1IDUzLjAzNi01My4wMzYgNTMuMDM2cy01My4wMzYtMjMuNzQ1LTUzLjAzNi01My4wMzYgMjMuNzQ1LTUzLjAzNiA1My4wMzYtNTMuMDM2IDUzLjAzNiAyMy43NDUgNTMuMDM2IDUzLjAzNnoiCiAgICAgICAgICB0cmFuc2Zvcm09Im1hdHJpeCguODA1ODcgMCAwIC44MDU4NyAxNzEuMDMgNDUuNDA1KSIKICAgICAgICAgIHNvZGlwb2RpOmN5PSIzNDYuMTEyMTgiCiAgICAgICAgICBzb2RpcG9kaTpjeD0iMzAzLjc1IgogICAgICAvPgogICAgICA8cGF0aAogICAgICAgICAgaWQ9InBhdGg3Mjg2IgogICAgICAgICAgc29kaXBvZGk6cng9IjUzLjAzNTcxMyIKICAgICAgICAgIHNvZGlwb2RpOnJ5PSI1My4wMzU3MTMiCiAgICAgICAgICBzdHlsZT0iZmlsbDp1cmwoI3JhZGlhbEdyYWRpZW50ODQxNSkiCiAgICAgICAgICBzb2RpcG9kaTp0eXBlPSJhcmMiCiAgICAgICAgICBkPSJtMzU2Ljc5IDM0Ni4xMWMwIDI5LjI5MS0yMy43NDUgNTMuMDM2LTUzLjAzNiA1My4wMzZzLTUzLjAzNi0yMy43NDUtNTMuMDM2LTUzLjAzNiAyMy43NDUtNTMuMDM2IDUzLjAzNi01My4wMzYgNTMuMDM2IDIzLjc0NSA1My4wMzYgNTMuMDM2eiIKICAgICAgICAgIHRyYW5zZm9ybT0ibWF0cml4KC43NTgyNSAwIDAgLjc1ODI1IDE4Ni43NSA2My45MDYpIgogICAgICAgICAgc29kaXBvZGk6Y3k9IjM0Ni4xMTIxOCIKICAgICAgICAgIHNvZGlwb2RpOmN4PSIzMDMuNzUiCiAgICAgIC8+CiAgICAgIDxwYXRoCiAgICAgICAgICBpZD0icGF0aDcyODgiCiAgICAgICAgICBzdHlsZT0ib3BhY2l0eTouMzE3NzE7ZmlsbDp1cmwoI2xpbmVhckdyYWRpZW50MTA0NDkpIgogICAgICAgICAgaW5rc2NhcGU6Y29ubmVjdG9yLWN1cnZhdHVyZT0iMCIKICAgICAgICAgIGQ9Im00MTQuOCAyODQuMTVjLTEzLjMzMSAwLjMwMDY5LTI2LjE4NiA3LjM1OC0zMy4zMzYgMTkuNzQyLTcuNjkwMyAxMy4zMi02LjcxMzkgMjkuMjY2IDEuMTU0NSA0MS4zMzEgMC44NTMwNi0yNi41MzIgMjEuMTMyLTQ2LjUxNSA0Ni4zMjQtNDUuMDU0IDguMjU4OSAwLjQ3OTA3IDE2LjA1NCAzLjIwMDEgMjIuODU5IDcuNTkwOC0zLjI1NzgtNy40NDk4LTguODE3MS0xMy45NTMtMTYuMzk0LTE4LjMyNy02LjQ4NjctMy43NDUxLTEzLjYyNS01LjQzOTMtMjAuNjA4LTUuMjgxOHoiCiAgICAgIC8+CiAgICAgIDxwYXRoCiAgICAgICAgICBpZD0icmVjdDczNzAiCiAgICAgICAgICBkPSJtNDAyLjg4IDMwMC4wOS0xMS41ODEgMTEuNTgxIDEzLjI5NSAxMy4yOTUtMTMuMjk1IDEzLjI4MSAxMS41ODEgMTEuNTgxIDEzLjI4MS0xMy4yOTUgMTMuMjk1IDEzLjI5NSAxMS41ODEtMTEuNTgxLTEzLjI4MS0xMy4yODEgMTMuMjgxLTEzLjI5NS0xMS41ODEtMTEuNTgxLTEzLjI5NSAxMy4yODEtMTMuMjgxLTEzLjI4MXoiCiAgICAgICAgICBzdHlsZT0iZmlsdGVyOnVybCgjZmlsdGVyMTE0MjgpO2ZpbGw6IzFhMWExYSIKICAgICAgICAgIGlua3NjYXBlOmNvbm5lY3Rvci1jdXJ2YXR1cmU9IjAiCiAgICAgIC8+CiAgICAgIDxwYXRoCiAgICAgICAgICBpZD0icGF0aDEwNDU3IgogICAgICAgICAgc3R5bGU9ImZpbGw6I2ZmZmZmZiIKICAgICAgICAgIGlua3NjYXBlOmNvbm5lY3Rvci1jdXJ2YXR1cmU9IjAiCiAgICAgICAgICBkPSJtNDAzLjQ1IDMwMS4xNS0xMS4wODcgMTEuMDg3IDEyLjcyOCAxMi43MjgtMTIuNzI4IDEyLjcxNCAxMS4wODcgMTEuMDg3IDEyLjcxNC0xMi43MjggMTIuNzI4IDEyLjcyOCAxMS4wODctMTEuMDg3LTEyLjcxNC0xMi43MTQgMTIuNzE0LTEyLjcyOC0xMS4wODctMTEuMDg3LTEyLjcyOCAxMi43MTQtMTIuNzE0LTEyLjcxNHoiCiAgICAgIC8+CiAgICA8L2cKICAgID4KICA8L2cKICA+CiAgPG1ldGFkYXRhCiAgICA+CiAgICA8cmRmOlJERgogICAgICA+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgPgogICAgICAgIDxkYzpmb3JtYXQKICAgICAgICAgID5pbWFnZS9zdmcreG1sPC9kYzpmb3JtYXQKICAgICAgICA+CiAgICAgICAgPGRjOnR5cGUKICAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIKICAgICAgICAvPgogICAgICAgIDxjYzpsaWNlbnNlCiAgICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbGljZW5zZXMvcHVibGljZG9tYWluLyIKICAgICAgICAvPgogICAgICAgIDxkYzpwdWJsaXNoZXIKICAgICAgICAgID4KICAgICAgICAgIDxjYzpBZ2VudAogICAgICAgICAgICAgIHJkZjphYm91dD0iaHR0cDovL29wZW5jbGlwYXJ0Lm9yZy8iCiAgICAgICAgICAgID4KICAgICAgICAgICAgPGRjOnRpdGxlCiAgICAgICAgICAgICAgPk9wZW5jbGlwYXJ0PC9kYzp0aXRsZQogICAgICAgICAgICA+CiAgICAgICAgICA8L2NjOkFnZW50CiAgICAgICAgICA+CiAgICAgICAgPC9kYzpwdWJsaXNoZXIKICAgICAgICA+CiAgICAgICAgPGRjOnRpdGxlCiAgICAgICAgICA+ZXJyb3IgYnV0dG9uPC9kYzp0aXRsZQogICAgICAgID4KICAgICAgICA8ZGM6ZGF0ZQogICAgICAgICAgPjIwMTEtMDItMjRUMTc6NDU6NDU8L2RjOmRhdGUKICAgICAgICA+CiAgICAgICAgPGRjOmRlc2NyaXB0aW9uCiAgICAgICAgLz4KICAgICAgICA8ZGM6c291cmNlCiAgICAgICAgICA+aHR0cHM6Ly9vcGVuY2xpcGFydC5vcmcvZGV0YWlsLzEyMjQyNS9lcnJvci1idXR0b24tYnktcmljYXJkb21haWE8L2RjOnNvdXJjZQogICAgICAgID4KICAgICAgICA8ZGM6Y3JlYXRvcgogICAgICAgICAgPgogICAgICAgICAgPGNjOkFnZW50CiAgICAgICAgICAgID4KICAgICAgICAgICAgPGRjOnRpdGxlCiAgICAgICAgICAgICAgPnJpY2FyZG9tYWlhPC9kYzp0aXRsZQogICAgICAgICAgICA+CiAgICAgICAgICA8L2NjOkFnZW50CiAgICAgICAgICA+CiAgICAgICAgPC9kYzpjcmVhdG9yCiAgICAgICAgPgogICAgICAgIDxkYzpzdWJqZWN0CiAgICAgICAgICA+CiAgICAgICAgICA8cmRmOkJhZwogICAgICAgICAgICA+CiAgICAgICAgICAgIDxyZGY6bGkKICAgICAgICAgICAgICA+YnV0dG9uPC9yZGY6bGkKICAgICAgICAgICAgPgogICAgICAgICAgICA8cmRmOmxpCiAgICAgICAgICAgICAgPmNhbmNlbDwvcmRmOmxpCiAgICAgICAgICAgID4KICAgICAgICAgICAgPHJkZjpsaQogICAgICAgICAgICAgID5jaXJjbGU8L3JkZjpsaQogICAgICAgICAgICA+CiAgICAgICAgICAgIDxyZGY6bGkKICAgICAgICAgICAgICA+ZGVsZXRlPC9yZGY6bGkKICAgICAgICAgICAgPgogICAgICAgICAgICA8cmRmOmxpCiAgICAgICAgICAgICAgPnJlZDwvcmRmOmxpCiAgICAgICAgICAgID4KICAgICAgICAgICAgPHJkZjpsaQogICAgICAgICAgICAgID5yb3VuZDwvcmRmOmxpCiAgICAgICAgICAgID4KICAgICAgICAgIDwvcmRmOkJhZwogICAgICAgICAgPgogICAgICAgIDwvZGM6c3ViamVjdAogICAgICAgID4KICAgICAgPC9jYzpXb3JrCiAgICAgID4KICAgICAgPGNjOkxpY2Vuc2UKICAgICAgICAgIHJkZjphYm91dD0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbGljZW5zZXMvcHVibGljZG9tYWluLyIKICAgICAgICA+CiAgICAgICAgPGNjOnBlcm1pdHMKICAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vY3JlYXRpdmVjb21tb25zLm9yZy9ucyNSZXByb2R1Y3Rpb24iCiAgICAgICAgLz4KICAgICAgICA8Y2M6cGVybWl0cwogICAgICAgICAgICByZGY6cmVzb3VyY2U9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zI0Rpc3RyaWJ1dGlvbiIKICAgICAgICAvPgogICAgICAgIDxjYzpwZXJtaXRzCiAgICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjRGVyaXZhdGl2ZVdvcmtzIgogICAgICAgIC8+CiAgICAgIDwvY2M6TGljZW5zZQogICAgICA+CiAgICA8L3JkZjpSREYKICAgID4KICA8L21ldGFkYXRhCiAgPgo8L3N2Zwo+Cg=="

/***/ })
/******/ ]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmllcmEuZGV2LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3dlYnBhY2svYm9vdHN0cmFwIDZlYmM4ZjFiYTAxZmI0YWZiMWEwIiwid2VicGFjazovLy9leHRlcm5hbCBcImZhYnJpY1wiIiwid2VicGFjazovLy90b29sYmFyL3NyYy90b29sYmFyLmpzIiwid2VicGFjazovLy9zcmMvdXRpbC9vYmplY3QuanMiLCJ3ZWJwYWNrOi8vL3NyYy91dGlsL3V0aWwuanMiLCJ3ZWJwYWNrOi8vL3NyYy91dGlsL3BhdGguanMiLCJ3ZWJwYWNrOi8vL3NyYy91dGlsL2NvbXBpbGUuanMiLCJ3ZWJwYWNrOi8vL3NyYy9jb3JlL3N0YXRpYy1jYW52YXMuZXh0LmpzIiwid2VicGFjazovLy9zcmMvbWl4aW5zL3Byb3BvcnRpYW5hbFNpemVNaXhpbi5qcyIsIndlYnBhY2s6Ly8vc3JjL21vZHVsZXMvc2xpZGUuYXJlYXMuanMiLCJ3ZWJwYWNrOi8vL2V4dGVybmFsIFwiJFwiIiwid2VicGFjazovLy9zcmMvcGx1Z2lucy9tYWdpY3dhbmQuanMiLCJ3ZWJwYWNrOi8vL3NyYy9maWVyYS5qcyIsIndlYnBhY2s6Ly8vc3JjL3V0aWwvZGF0YS5qcyIsIndlYnBhY2s6Ly8vZXh0ZXJuYWwgXCJmc1wiIiwid2VicGFjazovLy9zcmMvdXRpbC9sb2FkZXIuanMiLCJ3ZWJwYWNrOi8vL3NyYy91dGlsL3N5bnRheC5qcyIsIndlYnBhY2s6Ly8vc3JjL2NvcmUvYmFzZS5qcyIsIndlYnBhY2s6Ly8vc3JjL2NvcmUvb2JzZXJ2ZS5qcyIsIndlYnBhY2s6Ly8vc3JjL2NvcmUvYXBwbGljYXRpb24uanMiLCJ3ZWJwYWNrOi8vL3NyYy9jb3JlL3NsaWRlLmpzIiwid2VicGFjazovLy9zcmMvY29yZS9hcHBsaWNhdGlvbi5zbGlkZXMuanMiLCJ3ZWJwYWNrOi8vL3NyYy9jb3JlL2FwcGxpY2F0aW9uLnByb3RvdHlwZXMuanMiLCJ3ZWJwYWNrOi8vL3NyYy9jb3JlL29iamVjdC5leHQuanMiLCJ3ZWJwYWNrOi8vL3NyYy9jb3JlL3RleHQuZXh0LmpzIiwid2VicGFjazovLy9zcmMvY29yZS9ncm91cC5leHQuanMiLCJ3ZWJwYWNrOi8vL3NyYy9jb3JlL2ltYWdlLmV4dC5qcyIsIndlYnBhY2s6Ly8vc3JjL21vZHVsZXMvc2xpZGUudGVtcGxhdGUuanMiLCJ3ZWJwYWNrOi8vL3NyYy9tb2R1bGVzL3NsaWRlLmRyYXdpbmctdG9vbHMuanMiLCJ3ZWJwYWNrOi8vL3NyYy9tb2R1bGVzL3Rvb2xiYXIuanMiLCJ3ZWJwYWNrOi8vL3Rvb2xiYXIvbW9kdWxlcy90b29sYmFyLmNvbG9ycy5qcyIsIndlYnBhY2s6Ly8vcGx1Z2lucy8kLm1pbmljb2xvcnMuanMiLCJ3ZWJwYWNrOi8vL3Rvb2xiYXIvbW9kdWxlcy90b29sYmFyLmZvbnRzLmpzIiwid2VicGFjazovLy9wbHVnaW5zLyQuZm9udFNlbGVjdG9yLmpzIiwid2VicGFjazovLy90b29sYmFyL21vZHVsZXMvdG9vbGJhci5vcHRpb25zLmpzIiwid2VicGFjazovLy90b29sYmFyL21vZHVsZXMvdG9vbGJhci5zZWxlY3QuanMiLCJ3ZWJwYWNrOi8vL3Rvb2xiYXIvbW9kdWxlcy90b29sYmFyLmVmZmVjdC5qcyIsIndlYnBhY2s6Ly8vc3JjL21vZHVsZXMvY2FudmFzLmV2ZW50cy5qcyIsIndlYnBhY2s6Ly8vc3JjL21vZHVsZXMvaW1hZ2UuZmlsdGVycy5qcyIsIndlYnBhY2s6Ly8vc3JjL21vZHVsZXMvZm9udHMuanMiLCJ3ZWJwYWNrOi8vL3BsdWdpbnMvd2ViZm9udC5qcyIsIndlYnBhY2s6Ly8vc3JjL21vZHVsZXMvZ2FsbGVyeS5qcyIsIndlYnBhY2s6Ly8vc3JjL21vZHVsZXMvbGlicmFyeS5qcyIsIndlYnBhY2s6Ly8vc3JjL21vZHVsZXMvZGVidWcuanMiLCJ3ZWJwYWNrOi8vL3NyYy9tb2R1bGVzL2Zyb21VUkwuanMiLCJ3ZWJwYWNrOi8vL3NyYy9tb2R1bGVzL3VwbG9hZC5qcyIsIndlYnBhY2s6Ly8vc3JjL21vZHVsZXMvbG9hZGVyLmpzIiwid2VicGFjazovLy8uL21lZGlhL2xvYWRlci5zdmciLCJ3ZWJwYWNrOi8vL3NyYy9tb2R1bGVzL2Ryb3BwYWJsZS5qcyIsIndlYnBhY2s6Ly8vc3JjL21vZHVsZXMvcnVsZXIuanMiLCJ3ZWJwYWNrOi8vL3NyYy9tb2R1bGVzL3JlbmRlci5qcyIsIndlYnBhY2s6Ly8vc3JjL21vZHVsZXMvdGh1bWIuanMiLCJ3ZWJwYWNrOi8vL3NyYy9tb2R1bGVzL2NsaXBUby5qcyIsIndlYnBhY2s6Ly8vc3JjL21vZHVsZXMvbW92ZW1lbnRMaW1pdHMuanMiLCJ3ZWJwYWNrOi8vL3NyYy9tb2R1bGVzL2dyb3Vwcy5qcyIsIndlYnBhY2s6Ly8vc3JjL21vZHVsZXMvaGlzdG9yeS5qcyIsIndlYnBhY2s6Ly8vc3JjL3BsdWdpbnMvaGlzdG9yeS5qcyIsIndlYnBhY2s6Ly8vc3JjL21vZHVsZXMvem9vbS5qcyIsIndlYnBhY2s6Ly8vc3JjL21vZHVsZXMvaW50ZXJhY3RpdmVNb2RlLmpzIiwid2VicGFjazovLy9zcmMvbW9kdWxlcy9ib3JkZXJJbWFnZS5qcyIsIndlYnBhY2s6Ly8vc3JjL21vZHVsZXMvc2F2ZUFzLmpzIiwid2VicGFjazovLy9wbHVnaW5zL3NhdmVBcy5qcyIsIndlYnBhY2s6Ly8vLi4vbm9kZV9tb2R1bGVzL3dlYnBhY2svYnVpbGRpbi9hbWQtZGVmaW5lLmpzIiwid2VicGFjazovLy8uLi9ub2RlX21vZHVsZXMvd2VicGFjay9idWlsZGluL2FtZC1vcHRpb25zLmpzIiwid2VicGFjazovLy9zcmMvYnJ1c2hlcy9CYXNlQnJ1c2guanMiLCJ3ZWJwYWNrOi8vL3NyYy9icnVzaGVzL1BlbmNpbEJydXNoLmpzIiwid2VicGFjazovLy9zcmMvYnJ1c2hlcy9SZWN0YW5nbGVCcnVzaC5qcyIsIndlYnBhY2s6Ly8vc3JjL2JydXNoZXMvUG9seWdvbkJydXNoLmpzIiwid2VicGFjazovLy8uL21lZGlhL3BvbHlnb24ucG5nIiwid2VicGFjazovLy9zcmMvYnJ1c2hlcy9QYWludFBlbkJydXNoLmpzIiwid2VicGFjazovLy9zcmMvYnJ1c2hlcy9QYWludEJ1Y2tldEJydXNoLmpzIiwid2VicGFjazovLy8uL21lZGlhL3BhaW50LWJ1Y2tldC5zdmciLCJ3ZWJwYWNrOi8vL3NyYy9icnVzaGVzL1BvaW50c0JydXNoLmpzIiwid2VicGFjazovLy9zcmMvc2hhcGVzL3BhdGguanMiLCJ3ZWJwYWNrOi8vL3NyYy9zaGFwZXMvY2xpcGFydC5qcyIsIndlYnBhY2s6Ly8vc3JjL21peGlucy9zdHJva2VNaXhpbi5qcyIsIndlYnBhY2s6Ly8vc3JjL21peGlucy9jYWNoZU1peGluLmpzIiwid2VicGFjazovLy9zcmMvc2hhcGVzL1BhdGhHcm91cC5qcyIsIndlYnBhY2s6Ly8vc3JjL21vZHVsZXMvcmVzaXphYmxlLmpzIiwid2VicGFjazovLy9zcmMvc2hhcGVzL2ltYWdlLnBob3Rvc2hvcC10b29scy5qcyIsIndlYnBhY2s6Ly8vc3JjL21vZHVsZXMvcGF0aGZpbmRlci5qcyIsIndlYnBhY2s6Ly8vLi9tZWRpYS9sYXNzby5zdmciLCJ3ZWJwYWNrOi8vL3NyYy9zaGFwZXMvaW1hZ2UucmVtb3ZlLXdoaXRlLmpzIiwid2VicGFjazovLy9zcmMvZmlsdGVycy9yZW1vdmVXaGl0ZS5qcyIsIndlYnBhY2s6Ly8vc3JjL3NoYXBlcy90ZXh0Ym94Lmxpc3QuanMiLCJ3ZWJwYWNrOi8vLy4vbWVkaWEvZXJyb3ItYnV0dG9uLnN2ZyJdLCJzb3VyY2VzQ29udGVudCI6WyIgXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuXG4gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXG4gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkge1xuIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuIFx0XHR9XG4gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbiBcdFx0XHRpOiBtb2R1bGVJZCxcbiBcdFx0XHRsOiBmYWxzZSxcbiBcdFx0XHRleHBvcnRzOiB7fVxuIFx0XHR9O1xuXG4gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4gXHRcdG1vZHVsZS5sID0gdHJ1ZTtcblxuIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4gXHR9XG5cblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuXG4gXHQvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikge1xuIFx0XHRpZighX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHtcbiBcdFx0XHRcdGNvbmZpZ3VyYWJsZTogZmFsc2UsXG4gXHRcdFx0XHRlbnVtZXJhYmxlOiB0cnVlLFxuIFx0XHRcdFx0Z2V0OiBnZXR0ZXJcbiBcdFx0XHR9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAxMSk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gd2VicGFjay9ib290c3RyYXAgNmViYzhmMWJhMDFmYjRhZmIxYTAiLCJtb2R1bGUuZXhwb3J0cyA9IGZhYnJpYztcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyBleHRlcm5hbCBcImZhYnJpY1wiXG4vLyBtb2R1bGUgaWQgPSAwXG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIlxudmFyIHV0aWxzID0gcmVxdWlyZSgnLi8uLi8uLi9zcmMvdXRpbC91dGlsLmpzJyk7XG51dGlscy5vYmplY3QgPSByZXF1aXJlKCcuLy4uLy4uL3NyYy91dGlsL29iamVjdC5qcycpO1xudXRpbHMuY29tcGlsZSA9IHJlcXVpcmUoJy4vLi4vLi4vc3JjL3V0aWwvY29tcGlsZS5qcycpO1xuXG5mdW5jdGlvbiBjYXBpdGFsaXplKHN0cmluZywgZmlyc3RMZXR0ZXJPbmx5KSB7XG4gIHJldHVybiBzdHJpbmcuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgK1xuICAgIChmaXJzdExldHRlck9ubHkgPyBzdHJpbmcuc2xpY2UoMSkgOiBzdHJpbmcuc2xpY2UoMSkudG9Mb3dlckNhc2UoKSk7XG59XG5cbmZ1bmN0aW9uIHRvRGFzaGVkIChzdHIpIHtcbiAgcmV0dXJuIHN0ci5yZXBsYWNlKC8oW2Etel0pKFtBLVpdKS9nLCAnJDEtJDInKS50b0xvd2VyQ2FzZSgpO1xufVxuXG5cbnZhciBUb29sYmFyID0gZnVuY3Rpb24oUEFSRU5ULCBlbCwgb3B0aW9ucywgbWVudSl7XG4gIHRoaXMuaW5pdGlhbGl6ZShQQVJFTlQsIGVsLCBvcHRpb25zLCBtZW51KVxufTtcblxuXG5Ub29sYmFyLl9nZXRLZXlTdHJpbmcgPSBmdW5jdGlvbiAoY29uZmlnKSB7XG4gIHZhciBzdHJpbmcgPSBcIlwiO1xuXG4gIGlmIChjb25maWcuY3RybEtleSlzdHJpbmcgKz0gXCJDdHJsICsgXCI7XG4gIGlmIChjb25maWcuYWx0S2V5KXN0cmluZyArPSBcIkFsdCArIFwiO1xuICBpZiAoY29uZmlnLnNoaWZ0S2V5KXN0cmluZyArPSBcIlNoaWZ0ICsgXCI7XG5cbiAgdmFyIF9jb2RlID0gY29uZmlnLmtleTtcbiAgaWYoX2NvZGUpe1xuICAgIHN0cmluZyArPSBjb25maWcua2V5O1xuICB9XG4gIHJldHVybiBzdHJpbmc7XG59O1xuXG5Ub29sYmFyLm1ha2VBY3Rpb25zID0gZnVuY3Rpb24gKGFjdGlvbnMsIFBBUkVOVCkge1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBmb3IgKHZhciBpIGluIGFjdGlvbnMpIHtcbiAgICAgIGFjdGlvbnNbaV0uaWQgPSBpO1xuICAgICAgdmFyIF9hY3Rpb24gPSB0aGlzLm1ha2VBY3Rpb24oYWN0aW9uc1tpXSwgUEFSRU5UKTtcbiAgICAgIGlmKF9hY3Rpb24pe1xuICAgICAgICByZXN1bHRbaV0gPSBfYWN0aW9uO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xufTtcblxuVG9vbGJhci5tYWtlQWN0aW9uID0gZnVuY3Rpb24gKF9PUklHSU5BTCwgcGFyZW50KSB7XG5cbiAgaWYgKF9PUklHSU5BTC5jb25zdHJ1Y3RvciA9PT0gRnVuY3Rpb24pIHtcbiAgICBfT1JJR0lOQUwgPSBfT1JJR0lOQUwuY2FsbChwYXJlbnQpO1xuICB9XG5cbiAgdmFyIHRhcmdldDtcblxuICBpZiAoX09SSUdJTkFMLnRhcmdldCAmJiBfT1JJR0lOQUwudGFyZ2V0LmNvbnN0cnVjdG9yID09PSBGdW5jdGlvbikge1xuICAgIHRhcmdldCA9IF9PUklHSU5BTC50YXJnZXQuY2FsbChwYXJlbnQpO1xuICB9IGVsc2Uge1xuICAgIHRhcmdldCA9IF9PUklHSU5BTC50YXJnZXQgfHwgcGFyZW50O1xuICB9XG5cbiAgdmFyIF9fX3RhcmdldCA9IF9PUklHSU5BTC50YXJnZXQ7XG4gIHZhciBfX19wYXJlbnQgPSBfT1JJR0lOQUwucGFyZW50O1xuICBkZWxldGUgX09SSUdJTkFMLnBhcmVudDtcbiAgZGVsZXRlIF9PUklHSU5BTC50YXJnZXQ7XG4gIHZhciBSRVMgPSB1dGlscy5vYmplY3QuY2xvbmVEZWVwKF9PUklHSU5BTCk7XG4gIF9PUklHSU5BTC5wYXJlbnQgPSBfX19wYXJlbnQ7XG4gIF9PUklHSU5BTC50YXJnZXQgPSBfX190YXJnZXQ7XG5cblxuICBSRVMucGFyZW50ID0gX19fcGFyZW50O1xuICBSRVMudGFyZ2V0ID0gdGFyZ2V0O1xuICBSRVMuaWQgPSB0b0Rhc2hlZChfT1JJR0lOQUwuaWQpO1xuXG5cbiAgZnVuY3Rpb24gY3JlYXRlR2V0dGVyKHByb3BlcnR5LHVzZVBhcmVudCkge1xuICAgIGlmIChwcm9wZXJ0eS5jb25zdHJ1Y3RvciA9PT0gRnVuY3Rpb24pIHtcbiAgICAgIHJldHVybiBwcm9wZXJ0eTtcbiAgICB9XG4gICAgaWYgKHByb3BlcnR5LmNvbnN0cnVjdG9yID09PSBTdHJpbmcpIHtcbiAgICAgIHZhciBuZWdhdGl2ZSA9IGZhbHNlO1xuICAgICAgaWYgKHByb3BlcnR5WzBdID09PSBcIiFcIikge1xuICAgICAgICBwcm9wZXJ0eSA9IHByb3BlcnR5LnN1YnN0cigxKTtcbiAgICAgICAgbmVnYXRpdmUgPSB0cnVlO1xuICAgICAgfVxuICAgICAgaWYodXNlUGFyZW50KXtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcyAmJiAhIXRoaXNbcHJvcGVydHldIF4gbmVnYXRpdmU7XG4gICAgICAgIH1cbiAgICAgIH1lbHNle1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiB0aGlzICYmICEhdGhpc1twcm9wZXJ0eV0gXiBuZWdhdGl2ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG5cbiAgLyp2YXIgX2luc2VydCA9IF9PUklHSU5BTC5pbnNlcnQ7XG4gIGlmICghX2luc2VydCB8fCBfaW5zZXJ0LmNvbnN0cnVjdG9yID09IFN0cmluZykge1xuXG4gICAgaWYoX09SSUdJTkFMLnBhcmVudCl7XG4gICAgICB2YXIgaW5zZXJ0cHJvcGVydHkgPSBmYWJyaWMudXRpbC5zdHJpbmcuY2FwaXRhbGl6ZShmYWJyaWMudXRpbC5zdHJpbmcuY2FtZWxpemUoX09SSUdJTkFMLnBhcmVudC5pZCkpXG4gICAgfWVsc2V7XG4gICAgICB2YXIgaW5zZXJ0cHJvcGVydHkgPSBfaW5zZXJ0IHx8IFwiaW5zZXJ0XCIgKyBmYWJyaWMudXRpbC5zdHJpbmcuY2FwaXRhbGl6ZShpZCx0cnVlKTtcbiAgICB9XG5cbiAgICBpZih0YXJnZXRbaW5zZXJ0cHJvcGVydHldICE9PSB1bmRlZmluZWQpe1xuICAgICAgX2luc2VydCA9IHRhcmdldFtpbnNlcnRwcm9wZXJ0eV0vLyBjcmVhdGVHZXR0ZXIoaW5zZXJ0cHJvcGVydHksdHJ1ZSkoKVxuICAgIH1lbHNle1xuICAgICAgX2luc2VydCA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgaWYoIV9pbnNlcnQpcmV0dXJuOyovXG5cbiAgaWYgKCFSRVMudHlwZSkge1xuICAgIGlmIChSRVMubWVudSkge1xuICAgICAgUkVTLnR5cGUgPSBcIm1lbnVcIjtcbiAgICB9ZWxzZXtcbiAgICAgIFJFUy50eXBlID0gXCJidXR0b25cIjtcbiAgICB9XG4gIH1cbiAgaWYgKCFSRVMuYWN0aW9uKSB7XG4gICAgaWYoUkVTLnR5cGUgPT09IFwiYnV0dG9uXCIpe1xuICAgICAgUkVTLmFjdGlvbiA9IF9PUklHSU5BTC5pZDtcbiAgICB9XG4gIH1cblxuXG4gIGlmIChSRVMuYWN0aW9uKSB7XG4gICAgaWYgKFJFUy5hY3Rpb24uY29uc3RydWN0b3IgPT09IFN0cmluZykge1xuICAgICAgUkVTLmFjdGlvbiA9IHRhcmdldFtSRVMuYWN0aW9uXTtcbiAgICB9XG4gICAgLy9SRVMgPSBSRVMuYWN0aW9uLmJpbmQodGFyZ2V0KTtcbiAgICAvL1JFUy5hY3Rpb24gPSBSRVMuYWN0aW9uLmJpbmQodGFyZ2V0KTtcbiAgICAvL18uZXh0ZW5kKFJFUywgX2FjdCk7XG4gICAgLy9hcmd1bWVudHMgZm9yIGFjdGlvbiBmdW5jdGlvblxuICAgIGlmIChfT1JJR0lOQUwuYXJncykge1xuICAgICAgUkVTLl9hY3Rpb24gPSBSRVMuYWN0aW9uLmJpbmQodGFyZ2V0LCBfT1JJR0lOQUwuYXJncyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIFJFUy5fYWN0aW9uID0gUkVTLmFjdGlvbi5iaW5kKHRhcmdldCk7XG4gICAgfVxuICAgIFJFUy5hY3Rpb24gPSBmdW5jdGlvbigpe1xuICAgICAgaWYoUkVTLmRpc2FibGVkKXJldHVybjtcbiAgICAgIFJFUy5fYWN0aW9uLmFwcGx5KHRoaXMsYXJndW1lbnRzKTtcbiAgICB9XG4gIH1cblxuXG4gIGlmIChfT1JJR0lOQUwubWVudSAmJiBfT1JJR0lOQUwubWVudS5jb25zdHJ1Y3RvciA9PT0gRnVuY3Rpb24pIHtcbiAgICBSRVMubWVudSA9IF9PUklHSU5BTC5tZW51LmJpbmQodGFyZ2V0KTtcbiAgfVxuICBpZiAoX09SSUdJTkFMLmFjdGl2ZSkge1xuICAgIFJFUy5hY3RpdmUgPSBjcmVhdGVHZXR0ZXIoX09SSUdJTkFMLmFjdGl2ZSkuYmluZCh0YXJnZXQpO1xuICB9XG4gIGlmIChfT1JJR0lOQUwudmlzaWJsZSkge1xuICAgIFJFUy52aXNpYmxlID0gY3JlYXRlR2V0dGVyKF9PUklHSU5BTC52aXNpYmxlKS5iaW5kKHRhcmdldCk7XG4gIH1cbiAgaWYgKF9PUklHSU5BTC5lbmFibGVkKSB7XG4gICAgUkVTLmVuYWJsZWQgPSBjcmVhdGVHZXR0ZXIoX09SSUdJTkFMLmVuYWJsZWQpLmJpbmQodGFyZ2V0KTtcbiAgfVxuICBpZiAoIV9PUklHSU5BTC52YWx1ZSkge1xuICAgIHN3aXRjaChfT1JJR0lOQUwudHlwZSl7XG4gICAgICBjYXNlIFwiY29sb3JcIjpcbiAgICAgIGNhc2UgXCJ0ZXh0XCI6XG4gICAgICBjYXNlIFwibnVtYmVyXCI6XG4gICAgICBjYXNlIFwicmFuZ2VcIjpcbiAgICAgIGNhc2UgXCJsYWJlbFwiOlxuICAgICAgY2FzZSBcInNlbGVjdFwiOlxuICAgICAgY2FzZSBcImNoZWNrYm94XCI6XG4gICAgICAgIF9PUklHSU5BTC52YWx1ZSA9IF9PUklHSU5BTC5pZDtcbiAgICAgIC8vIGNvbnNvbGUubG9nKGlkLCBfT1JJR0lOQUwpO1xuICAgIH1cbiAgfVxuICBpZiAoX09SSUdJTkFMLnZhbHVlKSB7XG4gICAgdmFyIF9zZXQsIF9nZXQsIF9vcHRpb25zO1xuICAgIGlmIChfT1JJR0lOQUwudmFsdWUuY29uc3RydWN0b3IgPT09IFN0cmluZykge1xuXG4gICAgICB2YXIgc2V0RnVuY3Rpb25OYW1lID0gXCJzZXRcIiArIGNhcGl0YWxpemUoX09SSUdJTkFMLnZhbHVlLCB0cnVlKSxcbiAgICAgICAgZ2V0RnVuY3Rpb25OYW1lID0gXCJnZXRcIiArIGNhcGl0YWxpemUoX09SSUdJTkFMLnZhbHVlLCB0cnVlKSxcbiAgICAgICAgbWluTmFtZSA9IFwibWluXCIgKyBjYXBpdGFsaXplKF9PUklHSU5BTC52YWx1ZSwgdHJ1ZSksXG4gICAgICAgIG1heE5hbWUgPSBcIm1heFwiICsgY2FwaXRhbGl6ZShfT1JJR0lOQUwudmFsdWUsIHRydWUpLFxuICAgICAgICBzZXRGb28gPSBmdW5jdGlvbih2YWwpe1xuICAgICAgICAgIHRhcmdldFtzZXRGdW5jdGlvbk5hbWVdKHZhbCk7XG4gICAgICAgICAgLy8gdG9kbyBzZWxmLnNldEZ1bmN0aW9uQ2FsbGJhY2sodGFyZ2V0KTtcbiAgICAgICAgfSxcbiAgICAgICAgZ2V0Rm9vID0gdGFyZ2V0W2dldEZ1bmN0aW9uTmFtZV0sXG4gICAgICAgIG1pbkZvbyA9IHRhcmdldFttaW5OYW1lXSxcbiAgICAgICAgbWF4Rm9vID0gdGFyZ2V0W21heE5hbWVdO1xuXG4gICAgICBfc2V0ID0gc2V0Rm9vIHx8IChfT1JJR0lOQUwuYXJncyA/XG4gICAgICAgICAgZnVuY3Rpb24gKHZhbCwgYXJncykge1xuICAgICAgICAgICAgdGhpc1tfT1JJR0lOQUwudmFsdWVdW2FyZ3NdID0gdmFsO1xuICAgICAgICAgIH0gOlxuICAgICAgICAgIGZ1bmN0aW9uICh2YWwpIHtcbiAgICAgICAgICAgIHRoaXNbX09SSUdJTkFMLnZhbHVlXSA9IHZhbDtcbiAgICAgICAgICB9KTtcblxuICAgICAgX2dldCA9IGdldEZvbyB8fCAoX09SSUdJTkFMLmFyZ3MgP1xuICAgICAgICAgIGZ1bmN0aW9uIChhcmdzKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpc1tfT1JJR0lOQUwudmFsdWVdW2FyZ3NdO1xuICAgICAgICAgIH0gOlxuICAgICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzW19PUklHSU5BTC52YWx1ZV07XG4gICAgICAgICAgfSk7XG5cblxuICAgICAgUkVTLnZhbHVlID0ge1xuICAgICAgICBtaW46IG1pbkZvbyxcbiAgICAgICAgbWF4OiBtYXhGb29cbiAgICAgIH1cblxuICAgIH0gZWxzZSB7XG4gICAgICBfc2V0ID0gX09SSUdJTkFMLnZhbHVlLnNldDtcbiAgICAgIF9nZXQgPSBfT1JJR0lOQUwudmFsdWUuZ2V0O1xuICAgICAgX29wdGlvbnMgPSBfT1JJR0lOQUwudmFsdWUub3B0aW9ucztcbiAgICB9XG5cbiAgICBpZihSRVMudmFsdWUubWluICE9PSB1bmRlZmluZWQgJiYgUkVTLnZhbHVlLm1pbi5jb25zdHJ1Y3RvciA9PT0gU3RyaW5nKXtcbiAgICAgIFJFUy52YWx1ZS5taW4gPSB0YXJnZXRbUkVTLnZhbHVlLm1pbl07XG4gICAgfVxuICAgIGlmKFJFUy52YWx1ZS5tYXggIT09IHVuZGVmaW5lZCAmJiBSRVMudmFsdWUubWF4LmNvbnN0cnVjdG9yID09PSBTdHJpbmcpe1xuICAgICAgUkVTLnZhbHVlLm1heCA9IHRhcmdldFtSRVMudmFsdWUubWF4XTtcbiAgICB9XG4gICAgaWYoUkVTLnZhbHVlLnN0ZXAgIT09IHVuZGVmaW5lZCAmJiBSRVMudmFsdWUuc3RlcC5jb25zdHJ1Y3RvciA9PT0gU3RyaW5nKXtcbiAgICAgIFJFUy52YWx1ZS5zdGVwID0gdGFyZ2V0W1JFUy52YWx1ZS5zdGVwXTtcbiAgICB9XG4gICAgdmFyIF9taW4gPSBSRVMudmFsdWUubWluLCBfbWF4ID0gUkVTLnZhbHVlLm1heCwgX3N0ZXAgPSBSRVMudmFsdWUuc3RlcDtcblxuICAgIGlmIChfc2V0KSB7XG4gICAgICBSRVMudmFsdWUuc2V0ID0gKCBfT1JJR0lOQUwuYXJncyA/IF9zZXQuYmluZCh0YXJnZXQsIF9PUklHSU5BTC5hcmdzKSA6IF9zZXQuYmluZCh0YXJnZXQpKTtcbiAgICB9XG4gICAgaWYgKF9nZXQpIHtcbiAgICAgIFJFUy52YWx1ZS5nZXQgPSAoIF9PUklHSU5BTC5hcmdzID8gX2dldC5iaW5kKHRhcmdldCwgX09SSUdJTkFMLmFyZ3MpIDogX2dldC5iaW5kKHRhcmdldCkpO1xuICAgIH1cbiAgICBpZiAoX21pbiAmJiBfbWluLmNvbnN0cnVjdG9yID09PSBGdW5jdGlvbikge1xuICAgICAgUkVTLnZhbHVlLm1pbiA9ICggX09SSUdJTkFMLmFyZ3MgPyBfbWluLmJpbmQodGFyZ2V0LCBfT1JJR0lOQUwuYXJncykgOiBfbWluLmJpbmQodGFyZ2V0KSk7XG4gICAgfVxuICAgIGlmIChfbWF4ICYmIF9tYXguY29uc3RydWN0b3IgPT09IEZ1bmN0aW9uKSB7XG4gICAgICBSRVMudmFsdWUubWF4ID0gKCBfT1JJR0lOQUwuYXJncyA/IF9tYXguYmluZCh0YXJnZXQsIF9PUklHSU5BTC5hcmdzKSA6IF9tYXguYmluZCh0YXJnZXQpKTtcbiAgICB9XG4gICAgaWYgKF9zdGVwICYmIF9zdGVwLmNvbnN0cnVjdG9yID09PSBGdW5jdGlvbikge1xuICAgICAgUkVTLnZhbHVlLnN0ZXAgPSAoIF9PUklHSU5BTC5hcmdzID8gX3N0ZXAuYmluZCh0YXJnZXQsIF9PUklHSU5BTC5hcmdzKSA6IF9zdGVwLmJpbmQodGFyZ2V0KSk7XG4gICAgfVxuICAgIGlmIChfb3B0aW9ucykge1xuICAgICAgUkVTLnZhbHVlLm9wdGlvbnMgPSAoIF9PUklHSU5BTC5hcmdzID8gX29wdGlvbnMuYmluZCh0YXJnZXQsIF9PUklHSU5BTC5hcmdzKSA6IF9vcHRpb25zLmJpbmQodGFyZ2V0KSk7XG4gICAgfVxuICB9XG5cbiAgaWYgKF9PUklHSU5BTC5kYXRhKSB7XG4gICAgUkVTLmRhdGEgPSBfT1JJR0lOQUwuZGF0YS5jYWxsKHRhcmdldCk7XG4gIH1cbiAgaWYgKFJFUy5tZW51KSB7XG4gICAgaWYgKF9PUklHSU5BTC5tZW51LmNvbnN0cnVjdG9yID09PSBGdW5jdGlvbil7XG4gICAgICBSRVMubWVudSA9ICBfT1JJR0lOQUwubWVudS5jYWxsKHRhcmdldCk7XG4gICAgfVxuICAgIGlmIChSRVMudHlwZSA9PT0gXCJvcHRpb25zXCIpIHtcbiAgICAgIGZvciAodmFyIGkgaW4gUkVTLm1lbnUpIHtcbiAgICAgICAgUkVTLm1lbnVbaV0ucGFyZW50ID0gUkVTO1xuICAgICAgICBSRVMubWVudVtpXS50eXBlID0gXCJvcHRpb25cIjtcbiAgICAgICAgaWYoIVJFUy5tZW51W2ldLnRpdGxlKXtcbiAgICAgICAgICBSRVMubWVudVtpXS50aXRsZSA9IGk7XG4gICAgICAgIH1cbiAgICAgICAgaWYoIVJFUy5tZW51W2ldLm9wdGlvbikge1xuICAgICAgICAgIFJFUy5tZW51W2ldLm9wdGlvbiA9IGk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgZm9yICh2YXIgaSBpbiBSRVMubWVudSkge1xuICAgICAgaWYoUkVTLm1lbnVbaV0uY29uc3RydWN0b3IgPT09IFN0cmluZyl7XG4gICAgICAgIFJFUy5tZW51W2ldID0gZmFicmljLnV0aWwub2JqZWN0LmNsb25lKFJFUy50YXJnZXQuYWN0aW9uc1tSRVMubWVudVtpXV0pO1xuICAgICAgICBSRVMubWVudVtpXS5wYXJlbnQgPSBSRVM7XG4gICAgICB9XG4gICAgICBpZighUkVTLm1lbnVbaV0uaWQpe1xuICAgICAgICBSRVMubWVudVtpXS5pZCA9IGk7XG4gICAgICB9XG4gICAgICBSRVMubWVudVtpXSA9IFRvb2xiYXIubWFrZUFjdGlvbihSRVMubWVudVtpXSwgdGFyZ2V0KTtcbiAgICAgIGlmKCFSRVMubWVudVtpXSl7XG4gICAgICAgIGRlbGV0ZSBSRVMubWVudVtpXTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuXG5cbiAgaWYgKF9PUklHSU5BTC5rZXlib2FyZCAhPT0gZmFsc2UgJiYgKF9PUklHSU5BTC5rZXkgfHwgX09SSUdJTkFMLnNoaWZ0S2V5IHx8IF9PUklHSU5BTC5hbHRLZXkgfHwgX09SSUdJTkFMLmN0cmxLZXkgfHwgX09SSUdJTkFMLm1ldGFLZXkpKSB7XG4gICAgaWYoX09SSUdJTkFMLmtleUNvZGUgJiYgX09SSUdJTkFMLmtleUNvZGUuY29uc3RydWN0b3IgPT09IFN0cmluZyl7XG4gICAgICBSRVMua2V5Q29kZSA9IF9PUklHSU5BTC5rZXlDb2RlLnRvVXBwZXJDYXNlKCkuY2hhckNvZGVBdCgwKTtcbiAgICAgIFJFUy5rZXkgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKFJFUy5rZXlDb2RlKTtcbiAgICB9XG4gICAgUkVTLmtleWJvYXJkID0gdHJ1ZVxuICB9O1xuXG4gIHJldHVybiBSRVM7XG59O1xuXG5Ub29sYmFyLmdldEJ1dHRvbnMgPSBmdW5jdGlvbiAoYWN0aW9ucykge1xuICB2YXIgX2J1dHRvbnMgPSBbXTtcbiAgZm9yKHZhciBpIGluIGFjdGlvbnMpe1xuICAgIHZhciBhY3Rpb24gPSBhY3Rpb25zW2ldO1xuICAgIGlmKGFjdGlvbi5rZXlib2FyZCl7XG4gICAgICBhY3Rpb24udGl0bGUgKz0gXCIgKFwiICsgVG9vbGJhci5fZ2V0S2V5U3RyaW5nKGFjdGlvbikgKyBcIilcIjtcbiAgICAgIF9idXR0b25zLnB1c2goYWN0aW9uKTtcbiAgICB9XG4gICAgaWYgKGFjdGlvbnMubWVudSkge1xuICAgICAgX2J1dHRvbnMgPSBfYnV0dG9ucy5jb25jYXQoVG9vbGJhci5nZXRCdXR0b25zKGFjdGlvbnMubWVudSkpO1xuICAgIH1cbiAgfTtcblxuICByZXR1cm4gX2J1dHRvbnM7XG59O1xuVG9vbGJhci5pbml0S2V5cyA9IGZ1bmN0aW9uIChhY3Rpb25zKSB7XG5cbiAgdmFyIGJ1dHRvbnMgPSBUb29sYmFyLmdldEJ1dHRvbnMoYWN0aW9ucyk7XG5cbiAgdmFyIHNlbGYgPSB0aGlzO1xuICAkKFwiYm9keVwiKS5vbiggXCJrZXlkb3duXCIsZnVuY3Rpb24gKGUpIHtcbiAgICBmb3IgKHZhciBpIGluIGJ1dHRvbnMpIHtcbiAgICAgIHZhciBfY29uZmlnID0gYnV0dG9uc1tpXTtcblxuICAgICAgaWYoX2NvbmZpZy5lbmFibGVkICYmICFfY29uZmlnLmVuYWJsZWQoKSl7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgaWYoX2NvbmZpZy5kaXNhYmxlZCB8fCBfY29uZmlnLmRpc2FibGVkKXtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBpZiAoKCFfY29uZmlnLmRpc2FibGVkICYmICFfY29uZmlnLmhpZGRlbikgJiZcbiAgICAgICAgKF9jb25maWcua2V5Q29kZSA9PSBlLmtleUNvZGUgfHwgX2NvbmZpZy5rZXkgPT0gZS5rZXkpICYmXG4gICAgICAgIChfY29uZmlnLmN0cmxLZXkgPT09IHVuZGVmaW5lZCB8fCBfY29uZmlnLmN0cmxLZXkgPT0gZS5jdHJsS2V5ICkgJiZcbiAgICAgICAgKF9jb25maWcuYWx0S2V5ID09PSB1bmRlZmluZWQgfHwgX2NvbmZpZy5hbHRLZXkgPT0gZS5hbHRLZXkgKSAmJlxuICAgICAgICAoX2NvbmZpZy5zaGlmdEtleSA9PT0gdW5kZWZpbmVkIHx8IF9jb25maWcuc2hpZnRLZXkgPT0gZS5zaGlmdEtleSApICYmXG4gICAgICAgIChfY29uZmlnLm1ldGFLZXkgPT09IHVuZGVmaW5lZCB8fCBfY29uZmlnLm1ldGFLZXkgPT0gZS5tZXRhS2V5ICkpIHtcblxuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIGlmIChfY29uZmlnLm9wdGlvbiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgX2NvbmZpZy5hY3Rpb24uY2FsbChfY29uZmlnLnRhcmdldCwgX2NvbmZpZy5vcHRpb24sIGUpXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgX2NvbmZpZy5hY3Rpb24uY2FsbChfY29uZmlnLnRhcmdldCwgZSlcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSk7XG5cbiAgLy8kKHdpbmRvdykub24oXCJtb3VzZXdoZWVsXCIsIGZ1bmN0aW9uIChldmVudCkge1xuICAvLyAgZm9yICh2YXIgaSBpbiBzZWxmLmJ1dHRvbnMpIHtcbiAgLy8gICAgdmFyIGRhdGEgPSBzZWxmLmJ1dHRvbnNbaV07XG4gIC8vICAgIGlmICghZGF0YS5tb3VzZXdoZWVsKWNvbnRpbnVlO1xuICAvLyAgICBpZiAoIWRhdGEuY3RybEtleSB8fCBkYXRhLmN0cmxLZXkgJiYgZXZlbnQuY3RybEtleSkge1xuICAvLyAgICAgIGlmIChldmVudC5kZWx0YVkgPiAwICYmIGRhdGEubW91c2V3aGVlbCA9PSBcIj5cIikge1xuICAvLyAgICAgICAgZGF0YS5hY3Rpb24uY2FsbCh0YXJnZXQsIGRhdGEub3B0aW9uIHx8IGV2ZW50LCBldmVudClcbiAgLy8gICAgICB9XG4gIC8vICAgICAgaWYgKGV2ZW50LmRlbHRhWSA8IDAgJiYgZGF0YS5tb3VzZXdoZWVsID09IFwiPFwiKSB7XG4gIC8vICAgICAgICBkYXRhLmFjdGlvbi5jYWxsKHRhcmdldCwgZGF0YS5vcHRpb24gfHwgZXZlbnQsIGV2ZW50KVxuICAvLyAgICAgIH1cbiAgLy8gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAvLyAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAvLyAgICAgIHJldHVybiBmYWxzZTtcbiAgLy8gICAgfVxuICAvLyAgfVxuICAvL30pO1xuXG59O1xuXG5Ub29sYmFyLnByb3RvdHlwZSA9IHtcblxuICAvLyBzZXRGdW5jdGlvbkNhbGxiYWNrOiBmdW5jdGlvbigpe30sXG4gIHRvb2xzOiB7XG5cbiAgICBcImxhYmVsXCI6IHtcbiAgICAgIHNjb3BlOiBmdW5jdGlvbiAoZGF0YSwgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGdldFZhbHVlOiBkYXRhLnZhbHVlLmdldCxcbiAgICAgICAgICB2YWx1ZUN1cnJlbnQ6IGRhdGEudmFsdWUuZ2V0KClcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cIm9iamVjdC1tZW51LWl0ZW0gb2JqZWN0LW1lbnUtbGFiZWxcIiB0aXRsZT1cInt0aXRsZX1cIj4nLFxuICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoJGl0ZW0sIGRhdGEsIG9wdGlvbnMsIHRvb2wsIHZhbCkge1xuICAgICAgICB2YXIgc2NvcGUgPSBmYWJyaWMudXRpbC5vYmplY3QuZGVmYXVsdHModG9vbC5zY29wZS5jYWxsKHRoaXMsIGRhdGEsIG9wdGlvbnMpLGRhdGEpO1xuICAgICAgICAkaXRlbS5odG1sKGRhdGEudGVtcGxhdGUuZm9ybWF0KGRhdGEudmFsdWUuZ2V0KCkpKTtcbiAgICAgICAgdXRpbHMuY29tcGlsZS5jb21waWxlRWxlbWVudCgkaXRlbSxzY29wZSk7XG4gICAgICB9XG4gICAgfSxcbiAgICBcIm51bWJlclwiOiB7XG4gICAgICBzY29wZTogZnVuY3Rpb24gKGRhdGEsIG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBnZXRJbnB1dFZhbHVlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgcmV0dXJuIHBhcnNlRmxvYXQoZGF0YS4kaXRlbS5maW5kKFwiaW5wdXRcIikudmFsKCkpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZ2V0VmFsdWU6IGRhdGEudmFsdWUuZ2V0LFxuICAgICAgICAgIHNldFZhbHVlOiBkYXRhLnZhbHVlLnNldCxcbiAgICAgICAgICBtaW5WYWx1ZTogZGF0YS52YWx1ZS5taW4gJiYgZGF0YS52YWx1ZS5taW4oKSxcbiAgICAgICAgICBtYXhWYWx1ZTogZGF0YS52YWx1ZS5tYXggJiYgZGF0YS52YWx1ZS5tYXgoKSxcbiAgICAgICAgICB2YWx1ZUN1cnJlbnQ6IGRhdGEudmFsdWUuZ2V0KCksXG4gICAgICAgICAgb25jaGFuZ2U6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBkYXRhLnZhbHVlLnNldChwYXJzZUZsb2F0KCQoZS50YXJnZXQpLnZhbCgpKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgdGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwib2JqZWN0LW1lbnUtaXRlbSBvYmplY3QtbWVudS1udW1iZXJcIiB0aXRsZT1cInt0aXRsZX1cIj4nICtcbiAgICAgICc8aW5wdXQgdHlwZT1cIm51bWJlclwiIG1pbj1cInttaW5WYWx1ZX1cIiBtYXg9XCJ7bWF4VmFsdWV9XCIgdmFsdWU9XCJ7dmFsdWVDdXJyZW50fVwiIG9uY2hhbmdlPVwib25jaGFuZ2UoZXZlbnQpXCI+JyxcbiAgICAgIHJlbmRlcjogZnVuY3Rpb24gKCRpdGVtLCBkYXRhLCBvcHRpb25zLCB0b29sLCB2YWwpIHtcbiAgICAgICAgJGl0ZW0uZmluZChcImlucHV0XCIpLnZhbChkYXRhLnZhbHVlLmdldCgpKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIFwicmFuZ2VcIjoge1xuICAgICAgc2NvcGU6IGZ1bmN0aW9uIChkYXRhLCBvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgbWluVmFsdWU6IGRhdGEudmFsdWUubWluID8gdHlwZW9mIGRhdGEudmFsdWUubWluID09IFwiZnVuY3Rpb25cIiA/IGRhdGEudmFsdWUubWluKCkgOiBkYXRhLnZhbHVlLm1pbjogMCxcbiAgICAgICAgICBtYXhWYWx1ZTogZGF0YS52YWx1ZS5tYXggPyB0eXBlb2YgZGF0YS52YWx1ZS5tYXggPT0gXCJmdW5jdGlvblwiID8gZGF0YS52YWx1ZS5tYXgoKSA6IGRhdGEudmFsdWUubWF4OiAxLFxuICAgICAgICAgIHZhbHVlU3RlcDogZGF0YS52YWx1ZS5zdGVwID8gdHlwZW9mIGRhdGEudmFsdWUuc3RlcCA9PSBcImZ1bmN0aW9uXCIgPyBkYXRhLnZhbHVlLnN0ZXAoKSA6IGRhdGEudmFsdWUuc3RlcDogMC4xLFxuICAgICAgICAgIHZhbHVlQ3VycmVudDogZGF0YS52YWx1ZS5nZXQoKSxcbiAgICAgICAgICBvbmNoYW5nZTogZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGRhdGEudmFsdWUuc2V0KHBhcnNlRmxvYXQoJChlLnRhcmdldCkudmFsKCkpKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB0ZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJvYmplY3QtbWVudS1pdGVtIG9iamVjdC1tZW51LXJhbmdlXCIgdGl0bGU9XCJ7dGl0bGV9XCI+JyArXG4gICAgICAnPGlucHV0IHR5cGU9XCJyYW5nZVwiIHN0ZXA9XCJ7dmFsdWVTdGVwfVwiIG1pbj1cInttaW5WYWx1ZX1cIiBtYXg9XCJ7bWF4VmFsdWV9XCIgdmFsdWU9XCJ7dmFsdWVDdXJyZW50fVwiIG9uY2hhbmdlPVwib25jaGFuZ2UoZXZlbnQpXCI+JyxcbiAgICAgIHJlbmRlcjogZnVuY3Rpb24gKCRpdGVtLCBkYXRhLCBvcHRpb25zLCB0b29sLCB2YWwpIHtcbiAgICAgICAgJGl0ZW0uZmluZChcImlucHV0XCIpLnZhbChkYXRhLnZhbHVlLmdldCgpKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIFwiY2hlY2tib3hcIjoge1xuICAgICAgc2NvcGU6IGZ1bmN0aW9uIChkYXRhLCBvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgb25jaGFuZ2U6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBkYXRhLnZhbHVlLnNldChlLnRhcmdldC5jaGVja2VkKVxuICAgICAgICAgIH0sXG4gICAgICAgICAgdmFsdWVDdXJyZW50OiBkYXRhLnZhbHVlLmdldCgpXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB0ZW1wbGF0ZTpcbiAgICAgICc8ZGl2IGNsYXNzPVwib2JqZWN0LW1lbnUtaXRlbSBvYmplY3QtbWVudS1jaGVja2JveFwiIHRpdGxlPVwie3RpdGxlfVwiPicgK1xuICAgICAgJzxpbnB1dCB0eXBlPVwiY2hlY2tib3hcIiBvbmNoYW5nZT1cIm9uY2hhbmdlKGV2ZW50KVwiIGRwLWNoZWNrZWQ9XCJ7dmFsdWVDdXJyZW50fVwiIGlkPVwiY2hlY2tib3gte2lkfVwiPicgK1xuICAgICAgJzxsYWJlbCBmb3I9XCJjaGVja2JveC17aWR9XCIgIGNsYXNzPVwiYnRuIGJ1dHRvbi17aWR9IHtjbGFzc05hbWV9XCI+JyxcbiAgICAgIHJlbmRlcjogZnVuY3Rpb24gKCRpdGVtLCBkYXRhLCBvcHRpb25zLCB0b29sLCB2YWwpIHtcbiAgICAgICAgJGl0ZW0uZmluZChcImlucHV0XCIpLnZhbCh2YWwpO1xuICAgICAgfVxuICAgIH0sXG4gICAgXCJtZW51XCI6IHtcbiAgICAgIHRlbXBsYXRlOlxuICAgICAgICAnPGRpdiBjbGFzcz1cIm9iamVjdC1tZW51LWl0ZW0gb2JqZWN0LW1lbnUtbWVudVwiIHRpdGxlPVwie3RpdGxlfVwiPicgK1xuICAgICAgICAnPGxhYmVsIGRwLWlmPVwidGl0bGVcIiBmb3I9XCJidXR0b24te2lkfVwiPnt0aXRsZX08L2xhYmVsPicgK1xuICAgICAgICAnPGJ1dHRvbiBjbGFzcz1cImJ0biBidXR0b24tbWVudS10cmlnZ2VyIGJ1dHRvbi17aWR9IHtjbGFzc05hbWV9XCIgaWQ9XCJidXR0b24te2lkfVwiLz4nICtcbiAgICAgICAgJzxkaXYgY2xhc3M9XCJvYmplY3QtbWVudSBzdWJtZW51XCIgdHJhbnNjbHVkZS8+JyxcbiAgICAgIHBvc3Q6IGZ1bmN0aW9uICgkaXRlbSwgZGF0YSwgb3B0aW9ucywgdHJhbnNjbHVkZSkge1xuICAgICAgICAvLyRpdGVtLmZpbmQoXCIuYnV0dG9uLW1lbnUtdHJpZ2dlclwiKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8vICAkaXRlbS5maW5kKFwiLm9iamVjdC1tZW51XCIpLnRvZ2dsZSgpO1xuICAgICAgICAvL30pXG4gICAgICAgIGlmIChkYXRhLmhvdmVyZWQpIHtcbiAgICAgICAgICAkaXRlbS5hZGRDbGFzcyhcImhvdmVyZWRcIik7XG4gICAgICAgICAgdGhpcy50b2dnbGVCeUhvdmVyKCRpdGVtLCB0cmFuc2NsdWRlLCBudWxsLCBkYXRhKVxuICAgICAgICB9XG4gICAgICAgIGlmIChkYXRhLnRvZ2dsZWQpIHtcbiAgICAgICAgICAkaXRlbS5hZGRDbGFzcyhcInRvZ2dsZWRcIik7XG4gICAgICAgICAgdGhpcy50b2dnbGVCeUJ1dHRvbigkaXRlbSwgdHJhbnNjbHVkZSlcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5nZW5lcmF0ZU1lbnUoZGF0YS50YXJnZXQsIHRyYW5zY2x1ZGUsIG9wdGlvbnMsIGRhdGEubWVudSk7XG4gICAgICB9XG4gICAgfSxcbiAgICBcImJ1dHRvblwiOiB7XG4gICAgICBzY29wZTogZnVuY3Rpb24gKGRhdGEsIG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBidXR0b25zVGl0bGU6IG9wdGlvbnMuYnV0dG9ucyAmJiBvcHRpb25zLmJ1dHRvbnMudGl0bGUgfHwgZmFsc2UsXG4gICAgICAgICAgYnV0dG9uc2NDbGFzc05hbWU6IChvcHRpb25zLmJ1dHRvbnMgJiYgb3B0aW9ucy5idXR0b25zLmNsYXNzTmFtZSB8fCAnJylcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHRlbXBsYXRlOlxuICAgICAgJzxkaXYgY2xhc3M9XCJvYmplY3QtbWVudS1pdGVtXCIgdGl0bGU9XCJ7dGl0bGV9XCI+JyArXG4gICAgICAnPGJ1dHRvbiBjbGFzcz1cImJ0biBidXR0b24te2lkfSB7Y2xhc3NOYW1lfSB7YnV0dG9uc2NDbGFzc05hbWV9XCIgIG9uY2xpY2s9XCIhZGlzYWJsZWQgJiYgb3B0aW9uID8gYWN0aW9uKG9wdGlvbikgOiBhY3Rpb24oKVwiPicgK1xuICAgICAgJzxpbWcgZHAtaWY9XCJpY29uXCIgZHAtc3JjPVwiaWNvblwiPicgK1xuICAgICAgJzxzcGFuIGRwLWluY2x1ZGU9XCJzdmdcIiBkcC1pZj1cInN2Z1wiPjwvc3Bhbj4nICtcbiAgICAgICc8c3BhbiBkcC1pZj1cImJ1dHRvbnNUaXRsZVwiIGNsYXNzPVwiYnV0dG9uLXRpdGxlXCI+e3RpdGxlfTwvc3Bhbj4nXG4gICAgfVxuICB9LFxuICBpbml0aWFsaXplOiBmdW5jdGlvbihQQVJFTlQsIGVsLCBvcHRpb25zLCBtZW51KXtcbiAgICB0aGlzLmJ1dHRvbnMgPSBbXTtcbiAgICAvL3RvZG8g0Y3RgtC+INC90LUg0YHQvtCy0YHQtdC8INGF0L7RgNC+0YjQvi4g0L3QtdC70YzQt9GPINGB0L7Qt9C00LDRgtGMINGD0LvQsdGA0LDRiyDRgSDRgNCw0LfQvdGL0LzQuCDQutC+0L3RhNC40LPQsNC80Lgg0LrQvdC+0L/QvtC6XG4gICAgLy8gdGhpcy50b29scyA9IHV0aWxzLm9iamVjdC5jbG9uZURlZXAodGhpcy50b29scyk7XG5cbiAgICBpZiAob3B0aW9ucykge1xuICAgICAgaWYgKG9wdGlvbnMuYnV0dG9uKSB7XG4gICAgICAgIHV0aWxzLm9iamVjdC5leHRlbmQodGhpcy50b29scy5idXR0b24sIG9wdGlvbnMuYnV0dG9uKTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKCFQQVJFTlQuZ2VuZXJhdGVkQWN0aW9ucykge1xuICAgICAgUEFSRU5ULm1ha2VBY3Rpb25zKCBtZW51KTtcbiAgICB9XG5cbiAgICBpZihlbC5jb25zdHJ1Y3RvciA9PT0gU3RyaW5nKXtcbiAgICAgIGVsID0gJChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChlbCkpO1xuICAgIH1cbiAgICBpZihlbC5sZW5ndGggJiYgT2JqZWN0LmtleXMoUEFSRU5ULmdlbmVyYXRlZEFjdGlvbnMpLmxlbmd0aCl7XG4gICAgICB0aGlzLmdlbmVyYXRlTWVudShQQVJFTlQsIGVsLCBvcHRpb25zLCBQQVJFTlQuZ2VuZXJhdGVkQWN0aW9ucyk7XG4gICAgICB0aGlzLm9uQ3JlYXRlKCk7XG4gICAgICBlbC5zaG93KCk7XG4gICAgfVxuICAgIFRvb2xiYXIuaW5pdEtleXMoUEFSRU5ULmdlbmVyYXRlZEFjdGlvbnMpO1xuICB9LFxub25DcmVhdGU6IGZ1bmN0aW9uICgpIHtcblxuICB9LFxuICBkZXN0cm95OiBmdW5jdGlvbiAodGFyZ2V0KSB7XG4gICAgZm9yICh2YXIgaSA9IHRoaXMuYnV0dG9ucy5sZW5ndGg7aS0tOykge1xuICAgICAgdmFyIF9jb25maWcgPSB0aGlzLmJ1dHRvbnNbaV07XG4gICAgICBpZih0YXJnZXQgJiYgX2NvbmZpZy50YXJnZXQgIT0gdGFyZ2V0ICl7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgdGhpcy5idXR0b25zLnNwbGljZShpLDEpO1xuICAgIH1cbiAgICB0aGlzLmZpcmUoXCJkZXN0cm95XCIpO1xuICB9LFxuICBjcmVhdGVJbnB1dDogZnVuY3Rpb24gKCRpdGVtLCBkYXRhLCB0eXBlKSB7XG5cbiAgICB2YXIgdGFyZ2V0ID0gZGF0YS50YXJnZXQ7XG4gICAgdmFyICRpbnB1dCA9ICQoXCI8aW5wdXQ+XCIpXG4gICAgICAuYXR0cihcInR5cGVcIiwgdHlwZSlcbiAgICAgIC5hdHRyKFwibWluXCIsIGRhdGEudmFsdWUubWluKCkpXG4gICAgICAuYXR0cihcIm1heFwiLCBkYXRhLnZhbHVlLm1heCgpKTtcblxuICAgICRpbnB1dC52YWwoZGF0YS52YWx1ZS5nZXQoKSk7XG4gICAgaWYgKGRhdGEudmFsdWUub2JzZXJ2ZSkge1xuICAgICAgdGFyZ2V0Lm9uKGRhdGEudmFsdWUub2JzZXJ2ZSwgZnVuY3Rpb24gKHZhbCkge1xuICAgICAgICAkaW5wdXQudmFsKGRhdGEudmFsdWUuZ2V0KCkpO1xuICAgICAgfSk7XG4gICAgfVxuICAgICRpbnB1dC5jaGFuZ2UoZnVuY3Rpb24gKGUpIHtcbiAgICAgIGRhdGEudmFsdWUuc2V0KHBhcnNlRmxvYXQoJGlucHV0LnZhbCgpKSlcbiAgICB9KTtcbiAgICAkaXRlbS5hcHBlbmQoJGlucHV0KTtcbiAgfSxcbiAgaW5pdEl0ZW06IGZ1bmN0aW9uICgkaXRlbSwgZGF0YSkge1xuXG4gICAgaWYgKGRhdGEuYWN0aXZlKSB7XG4gICAgICBpZiAoZGF0YS5hY3RpdmUuY2FsbChkYXRhLnRhcmdldCwgZGF0YS5vcHRpb24pKSB7XG4gICAgICAgICRpdGVtLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChkYXRhLnZpc2libGUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgaWYgKGRhdGEudmlzaWJsZS5jb25zdHJ1Y3RvciA9PSBGdW5jdGlvbikge1xuICAgICAgICBpZiAoIWRhdGEudmlzaWJsZS5jYWxsKGRhdGEudGFyZ2V0KSkge1xuICAgICAgICAgICRpdGVtLmhpZGUoKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmICghZGF0YS52aXNpYmxlKSB7XG4gICAgICAgICRpdGVtLmhpZGUoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBkYXRhLmRpc2FibGVkID0gZmFsc2U7XG4gICAgaWYgKGRhdGEuZW5hYmxlZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBpZiAoZGF0YS5lbmFibGVkLmNvbnN0cnVjdG9yID09IEZ1bmN0aW9uKSB7XG4gICAgICAgIGlmICghZGF0YS5lbmFibGVkLmNhbGwoZGF0YS50YXJnZXQpKSB7XG4gICAgICAgICAgJGl0ZW0uYXR0cihcImRpc2FibGVkXCIsIHRydWUpO1xuICAgICAgICAgIGRhdGEuZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKGRhdGEub2JzZXJ2ZSkge1xuICAgICAgLy90b2RvXG4gICAgICBpZiAoZGF0YS52aXNpYmxlICYmIGRhdGEudmlzaWJsZS5jb25zdHJ1Y3RvciA9PSBGdW5jdGlvbikge1xuICAgICAgICBkYXRhLnRhcmdldCAmJiBkYXRhLnRhcmdldC5vbihkYXRhLm9ic2VydmUsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBpZiAoIWRhdGEudmlzaWJsZS5jYWxsKGRhdGEudGFyZ2V0KSkge1xuICAgICAgICAgICAgJGl0ZW0uaGlkZSgpO1xuICAgICAgICAgICAgZGF0YS5oaWRkZW4gPSB0cnVlO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAkaXRlbS5zaG93KCk7XG4gICAgICAgICAgICBkYXRhLmhpZGRlbiA9IGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChkYXRhLnR5cGUgPT0gXCJvcHRpb25zXCIpIHtcbiAgICAgICAgZGF0YS50YXJnZXQgJiYgZGF0YS50YXJnZXQub24oZGF0YS5vYnNlcnZlLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgdmFyIF92YWwgPSBkYXRhLnZhbHVlLmdldCgpO1xuICAgICAgICAgICQoXCJbbmFtZT1cIiArIGRhdGEuaWQgKyBcIl1cIikucHJvcChcImNoZWNrZWRcIixmYWxzZSk7XG4gICAgICAgICAgJChcIltuYW1lPVwiICsgZGF0YS5pZCArIFwiXVt2YWx1ZT1cIiArIF92YWwgK1wiXVwiKS5wcm9wKFwiY2hlY2tlZFwiLHRydWUpO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgaWYgKGRhdGEuZW5hYmxlZCAmJiBkYXRhLmVuYWJsZWQuY29uc3RydWN0b3IgPT0gRnVuY3Rpb24pIHtcbiAgICAgICAgZGF0YS50YXJnZXQgJiYgZGF0YS50YXJnZXQub24oZGF0YS5vYnNlcnZlLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgaWYgKCFkYXRhLmVuYWJsZWQuY2FsbChkYXRhLnRhcmdldCkpIHtcbiAgICAgICAgICAgICRpdGVtLmF0dHIoXCJkaXNhYmxlZFwiLCB0cnVlKTtcbiAgICAgICAgICAgIGRhdGEuZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAkaXRlbS5yZW1vdmVBdHRyKFwiZGlzYWJsZWRcIik7XG4gICAgICAgICAgICBkYXRhLmRpc2FibGVkID0gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIHRvZ2dsZUJ5SG92ZXI6IGZ1bmN0aW9uICgkaXRlbSwgJHRvZ2dsZUVsZW1lbnQsIGZvbyxkYXRhKSB7XG5cbiAgICB2YXIgb25DbG9zZTtcblxuICAgICR0b2dnbGVFbGVtZW50LmhpZGUoKTtcbiAgICAkaXRlbS5tb3VzZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAkdG9nZ2xlRWxlbWVudC5oaWRlKCk7XG4gICAgICBvbkNsb3NlICYmIG9uQ2xvc2UoKTtcbiAgICB9KTtcbiAgICAkaXRlbS5tb3VzZW92ZXIoZnVuY3Rpb24gKCkge1xuICAgICAgJHRvZ2dsZUVsZW1lbnQuc2hvdygpO1xuICAgICAgb25DbG9zZSA9IGZvbyAmJiBmb28oKTtcbiAgICB9KTtcblxuICAgICRpdGVtLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmIChkYXRhICYmIGRhdGEuaW1tZWRpYXRlbHkpIHtcbiAgICAgICAgZGF0YS5hY3Rpb24oKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSxcbiAgdG9nZ2xlQnlCdXR0b246IGZ1bmN0aW9uICgkaXRlbSwgJHRvZ2dsZUVsZW1lbnQsIGZvbyxkYXRhKSB7XG5cbiAgICB2YXIgb25DbG9zZTtcbiAgICB2YXIgX3RyeV9oaWRlID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgIHZhciBfcGFyZW50cyA9ICQoZS50YXJnZXQpLnBhcmVudHMoKTtcbiAgICAgIGZvciAodmFyIGkgaW4gX3BhcmVudHMpIHtcbiAgICAgICAgaWYgKF9wYXJlbnRzW2ldID09PSAkaXRlbVswXSkge1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKCR0b2dnbGVFbGVtZW50LmNzcyhcImRpc3BsYXlcIikgIT09IFwibm9uZVwiKSB7XG4gICAgICAgICR0b2dnbGVFbGVtZW50LmhpZGUoKTtcbiAgICAgICAgb25DbG9zZSAmJiBvbkNsb3NlKCk7XG4gICAgICB9XG4gICAgfTtcblxuICAgICR0b2dnbGVFbGVtZW50LmNsaWNrKGZ1bmN0aW9uIChlKSB7XG4gICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIH0pO1xuICAgICR0b2dnbGVFbGVtZW50LmhpZGUoKTtcbiAgICAkaXRlbS5jbGljayhmdW5jdGlvbiAoKSB7XG5cbiAgICAgIGlmICgkdG9nZ2xlRWxlbWVudC5jc3MoXCJkaXNwbGF5XCIpICE9PSBcIm5vbmVcIikge1xuICAgICAgICAkdG9nZ2xlRWxlbWVudC5oaWRlKCk7XG4gICAgICAgIG9uQ2xvc2UgJiYgb25DbG9zZSgpO1xuICAgICAgICAkKHdpbmRvdykub2ZmKFwiY2xpY2tcIiwgX3RyeV9oaWRlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgICR0b2dnbGVFbGVtZW50LnNob3coKTtcbiAgICAgICAgJCh3aW5kb3cpLm9uKFwiY2xpY2tcIiwgX3RyeV9oaWRlKTtcblxuICAgICAgICBvbkNsb3NlID0gZm9vICYmIGZvbygpO1xuXG4gICAgICAgIGlmKGRhdGEgJiYgZGF0YS5pbW1lZGlhdGVseSl7XG4gICAgICAgICAgZGF0YS5hY3Rpb24oKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pXG4gIH0sXG4gIGdlbmVyYXRlTWVudTogZnVuY3Rpb24gKHRhcmdldCwgJGVsLCBvcHRpb25zLCBtZW51KSB7XG5cbiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7XG4gICAgICAgIHRpdGxlOiBmYWxzZVxuICAgICAgfTtcbiAgICBvcHRpb25zLmJ1dHRvbnMgPSBvcHRpb25zLmJ1dHRvbnMgfHwge1xuICAgICAgICBjbGFzc05hbWU6IFwiXCIsXG4gICAgICAgIHRpdGxlOiBmYWxzZVxuICAgICAgfTtcblxuICAgICRlbC5lbXB0eSgpO1xuXG4gICAgdmFyIF90aGlzID0gIHRoaXM7XG4gICAgZm9yICh2YXIgaSBpbiBtZW51KSB7XG4gICAgICB2YXIgZGF0YSA9IG1lbnVbaV07XG4gICAgICBpZiAoIWRhdGEgfHwgZGF0YS5pbnNlcnQgIT09IHVuZGVmaW5lZCAmJiAhZGF0YS5pbnNlcnQpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBkYXRhLnR5cGUgPSBkYXRhLnR5cGUgfHwgXCJidXR0b25cIjtcblxuICAgICAgLy90b2RvINC90LXQv9C+0L3Rj9GC0L3QviDQt9Cw0YfQtdC8INCw0YDQs9GD0LzQtdC90YIgdGFyZ2V0INCyINC90LDRh9Cw0LvQtVxuICAgICAgdmFyIHRhcmdldCA9IGRhdGEudGFyZ2V0O1xuXG4gICAgICB2YXIgdG9vbCA9IHRoaXMudG9vbHNbZGF0YS50eXBlXTtcblxuICAgICAgaWYgKCF0b29sKSB7XG4gICAgICAgIGNvbnNvbGUud2FybihcInRvb2wgJ1wiICsgZGF0YS50eXBlICsgXCInIHVuZGVmaW5lZFwiKTtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICB2YXIgc2NvcGUgPSBkYXRhO1xuICAgICAgaWYgKHRvb2wuc2NvcGUpIHtcbiAgICAgICAgc2NvcGUgPSBmYWJyaWMudXRpbC5vYmplY3QuZGVmYXVsdHModG9vbC5zY29wZS5jYWxsKHRoaXMsIGRhdGEsIG9wdGlvbnMpLGRhdGEpO1xuICAgICAgfVxuXG4gICAgICB2YXIgJGl0ZW0gPSAkKHRvb2wudGVtcGxhdGUuZm9ybWF0KHNjb3BlKSk7XG4gICAgICB2YXIgdHJhbnNjbHVkZSA9ICRpdGVtLmZpbmQoXCJbdHJhbnNjbHVkZV1cIik7XG4gICAgICBzY29wZS4kaXRlbSA9IGRhdGEuJGl0ZW0gPSAkaXRlbTtcbiAgICAgIGlmKGRhdGEudGVtcGxhdGUpe1xuICAgICAgICAkaXRlbS5odG1sKGRhdGEudGVtcGxhdGUuZm9ybWF0KGRhdGEudmFsdWUuZ2V0KCkpKTtcbiAgICAgIH1cblxuICAgICAgdXRpbHMuY29tcGlsZS5jb21waWxlRWxlbWVudCgkaXRlbSxzY29wZSk7XG5cbiAgICAgIGlmIChkYXRhLnZhbHVlICYmIGRhdGEudmFsdWUub2JzZXJ2ZSkge1xuXG4gICAgICAgIHRhcmdldC5vbihkYXRhLnZhbHVlLm9ic2VydmUsIGZ1bmN0aW9uICh2YWwpIHtcblxuICAgICAgICAgIGlmICh0b29sLnBvc3QpIHtcbiAgICAgICAgICAgIHRvb2wucG9zdC5jYWxsKF90aGlzLCRpdGVtLCBzY29wZSwgb3B0aW9ucywgdHJhbnNjbHVkZS5sZW5ndGggPyB0cmFuc2NsdWRlIDogbnVsbCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmKHRvb2wucmVuZGVyKXtcbiAgICAgICAgICAgIHRvb2wucmVuZGVyLmNhbGwoX3RoaXMsICRpdGVtLCBkYXRhLCBvcHRpb25zLCB0b29sLCB2YWwpO1xuICAgICAgICAgIH1cbiAgICAgICAgICAvL3RoaXMuZmlyZShkYXRhLnR5cGUgKyBcIjpyZW5kZXJcIix7aXRlbTogJGl0ZW0sIGRhdGE6IGRhdGEsIG9wdGlvbnM6IG9wdGlvbnMsIHRvb2w6IHRvb2wsIHZhbDogdmFsfSlcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuaW5pdEl0ZW0oJGl0ZW0sIGRhdGEpO1xuXG4gICAgICBpZiAodG9vbC5wb3N0KSB7XG4gICAgICAgIHRvb2wucG9zdC5jYWxsKHRoaXMsJGl0ZW0sIHNjb3BlLCBvcHRpb25zLCB0cmFuc2NsdWRlLmxlbmd0aCA/IHRyYW5zY2x1ZGUgOiBudWxsKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5maXJlKGRhdGEudHlwZSArIFwiOmNyZWF0ZWRcIix7aXRlbTogJGl0ZW0sIGRhdGE6IGRhdGEsIG9wdGlvbnM6IG9wdGlvbnMsIHRvb2w6IHRvb2x9KTtcblxuICAgICAgJGVsLmFwcGVuZCgkaXRlbSk7XG4gICAgfVxuICB9XG59O1xudXRpbHMub2JzZXJ2YWJsZShUb29sYmFyLnByb3RvdHlwZSk7XG5cblxuVG9vbGJhci5zaW5nbGUgPSBmdW5jdGlvbihkYXRhLGVsZW1lbnQpe1xuICBkYXRhLiRpdGVtID0gZWxlbWVudDtcbiAgZGF0YS50eXBlID0gZGF0YS50eXBlIHx8IFwiYnV0dG9uXCI7XG5cbiAgdmFyIHRvb2wgPSBUb29sYmFyLnByb3RvdHlwZS50b29sc1tkYXRhLnR5cGVdO1xuXG4gIFRvb2xiYXIucHJvdG90eXBlLmluaXRJdGVtKGVsZW1lbnQsZGF0YSk7XG5cbiAgaWYgKGRhdGEudmFsdWUgJiYgZGF0YS52YWx1ZS5vYnNlcnZlKSB7XG4gICAgZGF0YS50YXJnZXQub24oZGF0YS52YWx1ZS5vYnNlcnZlLCBmdW5jdGlvbiAodmFsKSB7XG4gICAgICB0b29sLnJlbmRlciggZWxlbWVudCwgZGF0YSwge30sIHRvb2wsIHZhbClcbiAgICB9KTtcbiAgfVxuXG4gIGlmKHRvb2wucG9zdCl7XG4gICAgdmFyIHRyYW5zY2x1ZGUgPSBlbGVtZW50LmZpbmQoXCJbdHJhbnNjbHVkZV1cIik7XG5cbiAgICB0b29sLnBvc3QuY2FsbChUb29sYmFyLnByb3RvdHlwZSwgZWxlbWVudCwgZGF0YSwge30sIHRyYW5zY2x1ZGUubGVuZ3RoID8gdHJhbnNjbHVkZSA6IG51bGwpO1xuICB9XG5cbiAgdmFyIHNjb3BlID0gZGF0YTtcbiAgaWYodG9vbC5zY29wZSl7XG4gICAgc2NvcGUgPSBfLmRlZmF1bHRzKGRhdGEsIHRvb2wuc2NvcGUuY2FsbChUb29sYmFyLnByb3RvdHlwZSwgZGF0YSwge30pKTtcbiAgfVxuXG4gIGVsZW1lbnQuZWFjaFNlbGYoXCIqXCIsZnVuY3Rpb24oKXtcbiAgICB2YXIgbm9kZXM9W10sIHZhbHVlcz1bXTtcbiAgICBmb3IgKHZhciBhdHQsIGkgPSAwLCBhdHRzID0gdGhpcy5hdHRyaWJ1dGVzLCBuID0gYXR0cy5sZW5ndGg7IGkgPCBuOyBpKyspe1xuICAgICAgYXR0ID0gYXR0c1tpXTtcbiAgICAgIG5vZGVzLnB1c2goYXR0Lm5vZGVOYW1lKTtcbiAgICAgIHZhbHVlcy5wdXNoKGF0dC5ub2RlVmFsdWUpO1xuICAgICAgdGhpcy5zZXRBdHRyaWJ1dGUoYXR0Lm5vZGVOYW1lLGF0dC5ub2RlVmFsdWUuZm9ybWF0KHNjb3BlKSk7XG4gICAgfVxuICB9KTtcbiAgdXRpbHMuY29tcGlsZS5jb21waWxlRWxlbWVudChlbGVtZW50LHNjb3BlKTtcbn07XG5cblxubW9kdWxlLmV4cG9ydHMgPSBUb29sYmFyO1xuXG5cblxuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHRvb2xiYXIvc3JjL3Rvb2xiYXIuanMiLCJ2YXIgdXRpbHMgPSB7XG4gIC8qKlxuICAgKlxuICAgKiBAcGFyYW0gYXJyXG4gICAqIEBwYXJhbSBhcnIyXG4gICAqIEByZXR1cm5zIHt7fX1cbiAgICogQGV4YW1wbGVcbiAgICogICAgeCA9IHthOiAxICxiOiAxLCBjOiBbMSwyXX1cbiAgICogICAgeSA9IHthOiAyICwgIGMgOiAzICwgZCA6IDF9XG4gICAqXG4gICAqICAgIGV4dGVuZEFycmF5c09iamVjdCh4LHkpID0ge2E6IFsxLDJdIGIgOiBbMV0gYyA6IFsxLDIsM10sIGQgWzFdIH1cbiAgICovXG4gIGV4dGVuZEFycmF5c09iamVjdCA6IGZ1bmN0aW9uKGFycixhcnIyKXtcbiAgICB2YXIgbmV3QXJyYXkgPSB7fTtcblxuICAgIGZvcih2YXIgaSBpbiBhcnIpe1xuICAgICAgaWYoYXJyW2ldLmNvbnN0cnVjdG9yID09IEFycmF5KXtcbiAgICAgICAgbmV3QXJyYXlbaV0gID0gW10uY29uY2F0KGFycltpXSk7XG4gICAgICB9ZWxzZXtcbiAgICAgICAgbmV3QXJyYXlbaV0gPSBbYXJyW2ldXTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBmb3IodmFyIGkgaW4gYXJyMil7XG4gICAgICBpZihuZXdBcnJheVtpXSl7XG4gICAgICAgIG5ld0FycmF5W2ldLnB1c2goYXJyMltpXSk7XG4gICAgICB9ZWxzZXtcbiAgICAgICAgbmV3QXJyYXlbaV0gPSBbYXJyMltpXV07XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBuZXdBcnJheTtcbiAgfSxcbiAgZmlsdGVyVmFsdWVzOiBmdW5jdGlvbiAoYXJyYXksIHZhbHVlcykge1xuICAgIHZhciBuZXdfYXJyYXkgPSBbXTtcbiAgICBmb3IgKHZhciBpIGluIGFycmF5KSB7XG4gICAgICB2YXIgX25ld19vYmplY3QgPSB7fTtcbiAgICAgIGZvciAodmFyIGogaW4gdmFsdWVzKSB7XG4gICAgICAgIF9uZXdfb2JqZWN0W3ZhbHVlc1tqXV0gPSBhcnJheVtpXVt2YWx1ZXNbal1dXG4gICAgICB9XG4gICAgICBuZXdfYXJyYXkucHVzaChfbmV3X29iamVjdCk7XG4gICAgfVxuICAgIHJldHVybiBuZXdfYXJyYXk7XG4gIH0sXG5cbiAgLyoqXG4gICAqICDQotCw0YHQvtCy0LDQvdC40LUg0KTQuNGI0LXRgNCw4oCT0JnQtdGC0YHQsCzRgdC70YPRh9Cw0LnQvdC+0LUg0YLQsNGB0L7QstCw0L3QuNC1INC80L3QvtC20LXRgdGC0LLQsFxuICAgKiBAcGFyYW0gb2JqZWN0XG4gICAqIEByZXR1cm5zIHsqfVxuICAgKi9cbiAgc2h1ZmZsZTogZnVuY3Rpb24gKG9iamVjdCkge1xuICAgIGlmICghb2JqZWN0Lmxlbmd0aCkgcmV0dXJuO1xuICAgIHZhciBpID0gb2JqZWN0Lmxlbmd0aDtcbiAgICB3aGlsZSAoLS1pKSB7XG4gICAgICB2YXIgaiA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChpICsgMSkpO1xuICAgICAgdmFyIHRlbXAgPSBvYmplY3RbaV07XG4gICAgICBvYmplY3RbaV0gPSBvYmplY3Rbal07XG4gICAgICBvYmplY3Rbal0gPSB0ZW1wO1xuICAgIH1cblxuICAgIHJldHVybiBvYmplY3Q7IC8vIGZvciBjb252ZW5pZW5jZSwgaW4gY2FzZSB3ZSB3YW50IGEgcmVmZXJlbmNlIHRvIHRoZSBhcnJheVxuICB9LFxuICAvKipcbiAgICogRGVwZW5kZW5jeTogdW5kZXJzY29yZS5qcyAoIGh0dHA6Ly9kb2N1bWVudGNsb3VkLmdpdGh1Yi5jb20vdW5kZXJzY29yZS8gKVxuICAgKlxuICAgKiBNaXggaXQgaW4gd2l0aCB1bmRlcnNjb3JlLmpzOlxuICAgKiBfLm1peGluKHtkZWVwRXh0ZW5kOiBkZWVwRXh0ZW5kfSk7XG4gICAqXG4gICAqIENhbGwgaXQgbGlrZSB0aGlzOlxuICAgKiB2YXIgbXlPYmogPSB1dGlscy5kZWVwRXh0ZW5kKGdyYW5kcGFyZW50LCBjaGlsZCwgZ3JhbmRjaGlsZCwgZ3JlYXRncmFuZGNoaWxkKVxuICAgKlxuICAgKiBOb3RlczpcbiAgICogS2VlcCBpdCBEUlkuXG4gICAqIFRoaXMgZnVuY3Rpb24gaXMgZXNwZWNpYWxseSB1c2VmdWwgaWYgeW91J3JlIHdvcmtpbmcgd2l0aCBKU09OIGNvbmZpZyBkb2N1bWVudHMuIEl0IGFsbG93cyB5b3UgdG8gY3JlYXRlIGEgZGVmYXVsdFxuICAgKiBjb25maWcgZG9jdW1lbnQgd2l0aCB0aGUgbW9zdCBjb21tb24gc2V0dGluZ3MsIHRoZW4gb3ZlcnJpZGUgdGhvc2Ugc2V0dGluZ3MgZm9yIHNwZWNpZmljIGNhc2VzLiBJdCBhY2NlcHRzIGFueVxuICAgKiBudW1iZXIgb2Ygb2JqZWN0cyBhcyBhcmd1bWVudHMsIGdpdmluZyB5b3UgZmluZS1ncmFpbmVkIGNvbnRyb2wgb3ZlciB5b3VyIGNvbmZpZyBkb2N1bWVudCBoaWVyYXJjaHkuXG4gICAqXG4gICAqIFNwZWNpYWwgRmVhdHVyZXMgYW5kIENvbnNpZGVyYXRpb25zOlxuICAgKiAtIHBhcmVudFJFIGFsbG93cyB5b3UgdG8gY29uY2F0ZW5hdGUgc3RyaW5ncy4gZXhhbXBsZTpcbiAgICogICB2YXIgb2JqID0gdXRpbHMuZGVlcEV4dGVuZCh7dXJsOiBcInd3dy5leGFtcGxlLmNvbVwifSwge3VybDogXCJodHRwOi8vI3tffS9wYXRoL3RvL2ZpbGUuaHRtbFwifSk7XG4gICAqICAgY29uc29sZS5sb2cob2JqLnVybCk7XG4gICAqICAgb3V0cHV0OiBcImh0dHA6Ly93d3cuZXhhbXBsZS5jb20vcGF0aC90by9maWxlLmh0bWxcIlxuICAgKlxuICAgKiAtIHBhcmVudFJFIGFsc28gYWN0cyBhcyBhIHBsYWNlaG9sZGVyLCB3aGljaCBjYW4gYmUgdXNlZnVsIHdoZW4geW91IG5lZWQgdG8gY2hhbmdlIG9uZSB2YWx1ZSBpbiBhbiBhcnJheSwgd2hpbGVcbiAgICogICBsZWF2aW5nIHRoZSBvdGhlcnMgdW50b3VjaGVkLiBleGFtcGxlOlxuICAgKiAgIHZhciBhcnIgPSB1dGlscy5kZWVwRXh0ZW5kKFsxMDAsICAgIHtpZDogMTIzNH0sIHRydWUsICBcImZvb1wiLCAgWzI1MCwgNTAwXV0sXG4gICAqICAgICAgICAgICAgICAgICAgICAgICAgICBbXCIje199XCIsIFwiI3tffVwiLCAgICAgZmFsc2UsIFwiI3tffVwiLCBcIiN7X31cIl0pO1xuICAgKiAgIGNvbnNvbGUubG9nKGFycik7XG4gICAqICAgb3V0cHV0OiBbMTAwLCB7aWQ6IDEyMzR9LCBmYWxzZSwgXCJmb29cIiwgWzI1MCwgNTAwXV1cbiAgICpcbiAgICogLSBUaGUgcHJldmlvdXMgZXhhbXBsZSBjYW4gYWxzbyBiZSB3cml0dGVuIGxpa2UgdGhpczpcbiAgICogICB2YXIgYXJyID0gdXRpbHMuZGVlcEV4dGVuZChbMTAwLCAgICB7aWQ6MTIzNH0sICAgdHJ1ZSwgIFwiZm9vXCIsICBbMjUwLCA1MDBdXSxcbiAgICogICAgICAgICAgICAgICAgICAgICAgICAgIFtcIiN7X31cIiwge30sICAgICAgICAgIGZhbHNlLCBcIiN7X31cIiwgW11dKTtcbiAgICogICBjb25zb2xlLmxvZyhhcnIpO1xuICAgKiAgIG91dHB1dDogWzEwMCwge2lkOiAxMjM0fSwgZmFsc2UsIFwiZm9vXCIsIFsyNTAsIDUwMF1dXG4gICAqXG4gICAqIC0gQW5kIGFsc28gbGlrZSB0aGlzOlxuICAgKiAgIHZhciBhcnIgPSB1dGlscy5kZWVwRXh0ZW5kKFsxMDAsICAgIHtpZDoxMjM0fSwgICB0cnVlLCAgXCJmb29cIiwgIFsyNTAsIDUwMF1dLFxuICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgW1wiI3tffVwiLCB7fSwgICAgICAgICAgZmFsc2VdKTtcbiAgICogICBjb25zb2xlLmxvZyhhcnIpO1xuICAgKiAgIG91dHB1dDogWzEwMCwge2lkOiAxMjM0fSwgZmFsc2UsIFwiZm9vXCIsIFsyNTAsIDUwMF1dXG4gICAqXG4gICAqIC0gQXJyYXkgb3JkZXIgaXMgaW1wb3J0YW50LiBleGFtcGxlOlxuICAgKiAgIHZhciBhcnIgPSB1dGlscy5kZWVwRXh0ZW5kKFsxLCAyLCAzLCA0XSwgWzEsIDQsIDMsIDJdKTtcbiAgICogICBjb25zb2xlLmxvZyhhcnIpO1xuICAgKiAgIG91dHB1dDogWzEsIDQsIDMsIDJdXG4gICAqXG4gICAqIC0gWW91IGNhbiByZW1vdmUgYW4gYXJyYXkgZWxlbWVudCBzZXQgaW4gYSBwYXJlbnQgb2JqZWN0IGJ5IHNldHRpbmcgdGhlIHNhbWUgaW5kZXggdmFsdWUgdG8gbnVsbCBpbiBhIGNoaWxkIG9iamVjdC5cbiAgICogICBleGFtcGxlOlxuICAgKiAgIHZhciBvYmogPSB1dGlscy5kZWVwRXh0ZW5kKHthcnI6IFsxLCAyLCAzLCA0XX0sIHthcnI6IFtcIiN7X31cIiwgbnVsbF19KTtcbiAgICogICBjb25zb2xlLmxvZyhvYmouYXJyKTtcbiAgICogICBvdXRwdXQ6IFsxLCAzLCA0XVxuICAgKlxuICAgKiovXG4gIGRlZXBFeHRlbmQ6IGZ1bmN0aW9uICgvKm9ial8xLCBbb2JqXzJdLCBbb2JqX05dKi8pIHtcbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDEgfHwgdHlwZW9mIGFyZ3VtZW50c1swXSAhPT0gJ29iamVjdCcpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDIpIHJldHVybiBhcmd1bWVudHNbMF07XG5cbiAgICB2YXIgdGFyZ2V0ID0gYXJndW1lbnRzWzBdO1xuXG4gICAgLy8gY29udmVydCBhcmd1bWVudHMgdG8gYXJyYXkgYW5kIGN1dCBvZmYgdGFyZ2V0IG9iamVjdFxuICAgIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTtcblxuICAgIHZhciBrZXksIHZhbCwgc3JjLCBjbG9uZSwgdG1wQnVmO1xuXG4gICAgYXJncy5mb3JFYWNoKGZ1bmN0aW9uIChvYmopIHtcbiAgICAgIGlmICh0eXBlb2Ygb2JqICE9PSAnb2JqZWN0JykgcmV0dXJuO1xuXG4gICAgICBmb3IgKGtleSBpbiBvYmopIHtcbiAgICAgICAgaWYgKCEoa2V5IGluIG9iaikpIGNvbnRpbnVlO1xuXG4gICAgICAgIHNyYyA9IHRhcmdldFtrZXldO1xuICAgICAgICB2YWwgPSB1dGlscy5jbG9uZURlZXAob2JqW2tleV0pO1xuXG5cbiAgICAgICAgaWYgKHR5cGVvZiBzcmMgIT09ICdvYmplY3QnIHx8IHNyYyA9PT0gbnVsbCkge1xuICAgICAgICAgIHRhcmdldFtrZXldID0gdmFsO1xuICAgICAgICB9ZWxzZSBpZiAoQXJyYXkuaXNBcnJheSh2YWwpKSB7XG4gICAgICAgICAgY2xvbmUgPSAoQXJyYXkuaXNBcnJheShzcmMpKSA/IHNyYyA6IFtdO1xuXG4gICAgICAgICAgdmFsLmZvckVhY2goZnVuY3Rpb24oaXRlbSl7XG4gICAgICAgICAgICBjbG9uZS5wdXNoKHV0aWxzLmNsb25lRGVlcChpdGVtKSk7XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICB0YXJnZXRba2V5XSA9IGNsb25lO1xuICAgICAgICAgIC8vdG9kbyAg0LXRgdC70Lgg0LfQsNC40LzRgdGC0LLRg9C10Lwg0LzQsNGB0YHQuNCyICwg0YLQviDRgdGB0L7RhdGA0LDQvdGP0LXQvCDQt9C90LDRh9C10L3QuNGPINC40Lcg0L7QsdC+0LjRhSDQvNCw0YHRgdC40LLQvtCyXG4gICAgICAgICAgLy90YXJnZXRba2V5XSA9IHV0aWxzLmRlZXBFeHRlbmQoY2xvbmUsIHZhbCk7XG5cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjbG9uZSA9ICghQXJyYXkuaXNBcnJheShzcmMpKSA/IHNyYyA6IHt9O1xuICAgICAgICAgIHRhcmdldFtrZXldID0gdXRpbHMuZGVlcEV4dGVuZChjbG9uZSwgdmFsKTtcbiAgICAgICAgfVxuXG4gICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gdGFyZ2V0O1xuICB9LFxuICBjbG9uZURlZXA6IGZ1bmN0aW9uICh2YWwpIHtcblxuICAgIGlmICh0eXBlb2YgdmFsID09PSAndW5kZWZpbmVkJykge1xuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgICBpZiAodmFsID09PSBudWxsKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9IGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIERhdGUpIHtcbiAgICAgIHJldHVybiBuZXcgRGF0ZSh2YWwuZ2V0VGltZSgpKTtcbiAgICB9IGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIFJlZ0V4cCkge1xuICAgICAgcmV0dXJuIG5ldyBSZWdFeHAodmFsKTtcbiAgICB9XG5cbiAgICBpZih2YWwuY2xvbmVTeW5jKXtcbiAgICAgIHJldHVybiB2YWwuY2xvbmVTeW5jKCk7XG4gICAgfWVsc2UgaWYodmFsLmNvbnN0cnVjdG9yID09IE9iamVjdCl7XG4gICAgICByZXR1cm4gdXRpbHMuZGVlcEV4dGVuZCh7fSwgdmFsKTtcbiAgICB9ZWxzZSBpZih2YWwuY29uc3RydWN0b3IgPT0gQXJyYXkpe1xuICAgICAgdmFyIGNsb25lID0gW107XG4gICAgICBmb3IodmFyIGkgPTAgO2kgPCB2YWwubGVuZ3RoOyBpKyspe1xuICAgICAgICBjbG9uZS5wdXNoKHV0aWxzLmNsb25lRGVlcCh2YWxbaV0pKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBjbG9uZTtcbiAgICB9ZWxzZXtcbiAgICAgIHJldHVybiB2YWw7XG4gICAgfVxuICB9LFxuICByZWFycmFuZ2U6IGZ1bmN0aW9uIChvYmplY3QsIGtleXMpIHtcbiAgICB2YXIgX25ld09yZGVyID0ge307XG4gICAgZm9yICh2YXIgaSBpbiBrZXlzKSB7XG4gICAgICBpZihvYmplY3Rba2V5c1tpXV0gIT09IHVuZGVmaW5lZCl7XG4gICAgICAgIF9uZXdPcmRlcltrZXlzW2ldXSA9IG9iamVjdFtrZXlzW2ldXVxuICAgICAgfVxuICAgIH1cbiAgICAvLyBmb3IgKGkgaW4gb2JqZWN0KSB7XG4gICAgLy8gICBkZWxldGUgb2JqZWN0W2ldO1xuICAgIC8vIH1cbiAgICAvLyBmb3IgKGkgaW4gX25ld09yZGVyKSB7XG4gICAgLy8gICBvYmplY3RbaV0gPSBfbmV3T3JkZXJbaV07XG4gICAgLy8gfVxuICAgIHJldHVybiBfbmV3T3JkZXI7XG4gIH0sXG4gIG1hcDogXy5tYXAsXG4gIHNvcnRCeTogXy5zb3J0QnksXG4gIGRlZmF1bHRzOiBfLmRlZmF1bHRzLFxuICB3aGVyZTogXy53aGVyZSxcbiAgZmluZFdoZXJlOiBfLmZpbmRXaGVyZSxcbiAgZmlsdGVyOiBfLmZpbHRlcixcbiAgcGljazogXy5waWNrLFxuICBwbHVjazogXy5wbHVjayxcbiAgZXh0ZW5kOiBmdW5jdGlvbiAoZGVzdGluYXRpb24pIHtcbiAgICAvLyBKU2NyaXB0IERvbnRFbnVtIGJ1ZyBpcyBub3QgdGFrZW4gY2FyZSBvZlxuICAgIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldO1xuICAgICAgZm9yICh2YXIgcHJvcGVydHkgaW4gc291cmNlKSB7XG4gICAgICAgIGRlc3RpbmF0aW9uW3Byb3BlcnR5XSA9IHNvdXJjZVtwcm9wZXJ0eV07XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBkZXN0aW5hdGlvbjtcbiAgfVxufTtcbm1vZHVsZS5leHBvcnRzID0gIHV0aWxzO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy91dGlsL29iamVjdC5qcyIsImxldCBvYmplY3RVdGlscyA9IHJlcXVpcmUoXCIuL29iamVjdFwiKTtcblxubGV0IHV0aWxzID0ge1xuICAvKipcbiAgICogd2lsbCBkaXZpZGUgdG90YWwgd2lkdGggZm9yIGV2ZXJ5IG9iamVjdCBpbiBjb2x1bW50cyBhcnJheVxuICAgKlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiAgICAgdmFyIF9mbGV4QXJyYXkgPSBmYWJyaWMudXRpbC5mbGV4KDIwMCAsIFt7ZmxleDogMH0se3ZhbHVlOiAxMDAsIGZsZXg6IDF9LHtmbGV4OiAwfV0gKTtcbiAgICogQHBhcmFtIHRvdGFsXG4gICAqIEBwYXJhbSBjb2x1bW5zXG4gICAqIEByZXR1cm5zIHtBcnJheX1cbiAgICogQGV4YW1wbGUgWzUwLDEwMCw1MF1cbiAgICovXG4gIGZsZXg6IGZ1bmN0aW9uICh0b3RhbCxjb2x1bW5zKXtcbiAgICB2YXIgX3JldHVybiA9IFtdO1xuICAgIHZhciBzcGxpdCA9IDA7XG4gICAgY29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uKGNvbHVtbiwgaW5kZXgpe1xuICAgICAgaWYoY29sdW1uLnZhbHVlID09PSB1bmRlZmluZWQpe1xuICAgICAgICBzcGxpdCsrO1xuICAgICAgfWVsc2V7XG4gICAgICAgIHRvdGFsIC09IGNvbHVtbi52YWx1ZTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICB2YXIgX3cgPSB0b3RhbCAvIHNwbGl0O1xuICAgIGNvbHVtbnMuZm9yRWFjaChmdW5jdGlvbihjb2x1bW4pe1xuICAgICAgX3JldHVybi5wdXNoKGNvbHVtbi52YWx1ZSA9PT0gdW5kZWZpbmVkID8gX3cgOiAgY29sdW1uLnZhbHVlICk7XG4gICAgfSk7XG4gICAgcmV0dXJuIF9yZXR1cm47XG4gIH0sXG4gIHdvcmtlcjogZnVuY3Rpb24gKGZvbykge1xuICAgIGlmICh3aW5kb3cuV29ya2VyKSB7XG4gICAgICB2YXIgc3RyID0gZm9vLnRvU3RyaW5nKCk7XG4gICAgICB2YXIgZXZlbnRBcmcgPSBzdHIuc3Vic3RyaW5nKHN0ci5pbmRleE9mKFwiKFwiKSArIDEsc3RyLmluZGV4T2YoXCIsXCIpKTtcbiAgICAgIHZhciBwb3N0TWVzc2FnZUFyZyA9IHN0ci5zdWJzdHJpbmcoc3RyLmluZGV4T2YoXCIsXCIpICsgMSxzdHIuaW5kZXhPZihcIilcIikpO1xuICAgICAgdmFyIF9mdW5jdGlvbkJvZHkgPSBzdHIuc3Vic3RyaW5nKHN0ci5pbmRleE9mKFwie1wiKSArIDEpO1xuICAgICAgc3RyID0gXCJvbm1lc3NhZ2U9ZnVuY3Rpb24oXCIgKyBldmVudEFyZyArIFwiKXtcIiArIHBvc3RNZXNzYWdlQXJnICsgXCI9IHBvc3RNZXNzYWdlO1wiICsgX2Z1bmN0aW9uQm9keTtcbiAgICAgIHZhciBibG9iID0gbmV3IEJsb2IoW3N0cl0pO1xuICAgICAgLy9cIm9ubWVzc2FnZSA9IGZ1bmN0aW9uKGUpIHsgcG9zdE1lc3NhZ2UoJ21zZyBmcm9tIHdvcmtlcicpOyB9XCJdKTtcbiAgICAgIHZhciBibG9iVVJMID0gd2luZG93LlVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7XG4gICAgICByZXR1cm4gbmV3IFdvcmtlcihibG9iVVJMKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdmFyIHdvcmtlciA9IHtcbiAgICAgICAgdGVybWluYXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIH0sXG4gICAgICAgIHBvc3RNZXNzYWdlOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgZm9vKHtkYXRhOiBkYXRhfSwgZnVuY3Rpb24gKHJlc3BvbnNlRGF0YSkge1xuICAgICAgICAgICAgICB3b3JrZXIub25tZXNzYWdlICYmIHdvcmtlci5vbm1lc3NhZ2Uoe2RhdGE6IHJlc3BvbnNlRGF0YX0pO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIHJldHVybiB3b3JrZXI7XG4gICAgfVxuICB9LFxuICBvYnNlcnZhYmxlOiBmdW5jdGlvbiAob2JqKSB7XG4gICAgXy5leHRlbmQob2JqLCB7XG5cbiAgICAgIGZpcmU6IGZ1bmN0aW9uIGZpcmUoZXZlbnROYW1lLCBvcHRpb25zKSB7XG4gICAgICAgIGlmICghdGhpcy5fX2V2ZW50TGlzdGVuZXJzKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZhciBsaXN0ZW5lcnNGb3JFdmVudCA9IHRoaXMuX19ldmVudExpc3RlbmVyc1tldmVudE5hbWVdO1xuICAgICAgICBpZiAoIWxpc3RlbmVyc0ZvckV2ZW50KSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBsaXN0ZW5lcnNGb3JFdmVudC5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgIGxpc3RlbmVyc0ZvckV2ZW50W2ldLmNhbGwodGhpcywgb3B0aW9ucyB8fCB7fSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICB9LFxuICAgICAgb246IGZ1bmN0aW9uIChldmVudE5hbWUsIGhhbmRsZXIpIHtcbiAgICAgICAgaWYgKGV2ZW50TmFtZS5jb25zdHJ1Y3RvciA9PSBPYmplY3QpIHtcbiAgICAgICAgICBmb3IgKHZhciBpIGluIGV2ZW50TmFtZSkge1xuICAgICAgICAgICAgdGhpcy5vbihpLCBldmVudE5hbWVbaV0pXG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9XG4gICAgICAgIHZhciBldmVudHMgPSBldmVudE5hbWUuc3BsaXQoXCIgXCIpO1xuICAgICAgICBmb3IgKHZhciBpIGluIGV2ZW50cykge1xuICAgICAgICAgIHRoaXMub2JzZXJ2ZShldmVudHNbaV0sIGhhbmRsZXIpXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICB9LFxuICAgICAgb2JzZXJ2ZTogZnVuY3Rpb24gKGV2ZW50TmFtZSwgaGFuZGxlcikge1xuICAgICAgICBpZiAoIXRoaXMuX19ldmVudExpc3RlbmVycykge1xuICAgICAgICAgIHRoaXMuX19ldmVudExpc3RlbmVycyA9IHt9O1xuICAgICAgICB9XG4gICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgZm9yICh2YXIgcHJvcCBpbiBldmVudE5hbWUpIHtcbiAgICAgICAgICAgIHRoaXMub24ocHJvcCwgZXZlbnROYW1lW3Byb3BdKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgaWYgKCF0aGlzLl9fZXZlbnRMaXN0ZW5lcnNbZXZlbnROYW1lXSkge1xuICAgICAgICAgICAgdGhpcy5fX2V2ZW50TGlzdGVuZXJzW2V2ZW50TmFtZV0gPSBbXTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy5fX2V2ZW50TGlzdGVuZXJzW2V2ZW50TmFtZV0ucHVzaChoYW5kbGVyKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgIH0sXG4gICAgICBvZmY6IGZ1bmN0aW9uIHN0b3BPYnNlcnZpbmcoZXZlbnROYW1lLCBoYW5kbGVyKSB7XG4gICAgICAgIGZ1bmN0aW9uIF9yZW1vdmVFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgaGFuZGxlcikge1xuICAgICAgICAgIGlmICghdGhpcy5fX2V2ZW50TGlzdGVuZXJzW2V2ZW50TmFtZV0pIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAoaGFuZGxlcikge1xuICAgICAgICAgICAgdmFyIGlkeCA9IHRoaXMuX19ldmVudExpc3RlbmVyc1tldmVudE5hbWVdLmluZGV4T2YoaGFuZGxlcik7XG4gICAgICAgICAgICBpZiAoaWR4ICE9PSAtMSkge1xuICAgICAgICAgICAgICB0aGlzLl9fZXZlbnRMaXN0ZW5lcnNbZXZlbnROYW1lXS5zcGxpY2UoaWR4LCAxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl9fZXZlbnRMaXN0ZW5lcnNbZXZlbnROYW1lXS5sZW5ndGggPSAwO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghdGhpcy5fX2V2ZW50TGlzdGVuZXJzKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgdGhpcy5fX2V2ZW50TGlzdGVuZXJzID0ge307XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMSAmJiB0eXBlb2YgYXJndW1lbnRzWzBdID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgIGZvciAodmFyIHByb3AgaW4gZXZlbnROYW1lKSB7XG4gICAgICAgICAgICBfcmVtb3ZlRXZlbnRMaXN0ZW5lci5jYWxsKHRoaXMsIHByb3AsIGV2ZW50TmFtZVtwcm9wXSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIF9yZW1vdmVFdmVudExpc3RlbmVyLmNhbGwodGhpcywgZXZlbnROYW1lLCBoYW5kbGVyKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgIH1cbiAgICB9KVxuICB9LFxuICBpbk9yZGVyOiBmdW5jdGlvbiAoYXJyYXksIGZvbywgY2FsbGJhY2spIHtcbiAgICB2YXIgX2luZGV4ID0gMDtcbiAgICBmdW5jdGlvbiBfaW5PcmRlckluZGV4KCkge1xuICAgICAgaWYgKCsrX2luZGV4IDwgYXJyYXkubGVuZ3RoKSB7XG4gICAgICAgIGZvbyhhcnJheVtfaW5kZXhdLCBfaW5kZXgsIF9pbk9yZGVySW5kZXgpXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjYWxsYmFjayAmJiBjYWxsYmFjaygpO1xuICAgICAgfVxuICAgIH1cbiAgICBmb28oYXJyYXlbX2luZGV4XSwgX2luZGV4LCBfaW5PcmRlckluZGV4KVxuICB9LFxuICAvKipcbiAgICog0LLQvtC30LLRgNCw0YnQsNC10YIg0L7QsdGK0LXQutGCINGBINC60LvRjtGH0LDQvNC4INGB0YLRgNC+0LrQuCB1cmxcbiAgICogQHJldHVybnMge3t9fVxuICAgKi9cbiAgcXVlcnlTdHJpbmc6IGZ1bmN0aW9uIChxdWVyeSkge1xuICAgIGlmKHF1ZXJ5KSB7XG4gICAgICBxdWVyeSA9IHF1ZXJ5LnN1YnN0cihxdWVyeS5pbmRleE9mKFwiP1wiKSArIDEpIDtcbiAgICB9ZWxzZXtcbiAgICAgIHF1ZXJ5ID0gd2luZG93LmxvY2F0aW9uLnNlYXJjaC5zdWJzdHJpbmcoMSk7XG4gICAgfVxuICAgIHZhciBvYmogPSB7fTtcbiAgICB2YXIgX2xlbmd0aCA9IDA7XG4gICAgaWYgKCFxdWVyeSlyZXR1cm4gb2JqO1xuICAgIHZhciB2YXJzID0gcXVlcnkuc3BsaXQoXCImXCIpO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdmFycy5sZW5ndGg7IGkrKykge1xuICAgICAgdmFyIHBhaXIgPSB2YXJzW2ldLnNwbGl0KFwiPVwiKTtcbiAgICAgIHZhciBfdm5hbWUgPSBwYWlyWzBdLCB2YWwgPSBwYWlyWzFdO1xuICAgICAgaWYgKHR5cGVvZiBvYmpbX3ZuYW1lXSA9PT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICBvYmpbX3ZuYW1lXSA9IHZhbCB8fCBcIlwiO1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBfbGVuZ3RoLCB7dmFsdWU6IF92bmFtZSwgZW51bWVyYWJsZTogZmFsc2V9KTtcbiAgICAgICAgX2xlbmd0aCsrO1xuICAgICAgICAvLyBJZiBzZWNvbmQgZW50cnkgd2l0aCB0aGlzIG5hbWVcbiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIG9ialtfdm5hbWVdID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIHZhciBhcnIgPSBbb2JqW192bmFtZV0sIHZhbF07XG4gICAgICAgIG9ialtfdm5hbWVdID0gYXJyO1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBfbGVuZ3RoLCB7dmFsdWU6IF92bmFtZSwgZW51bWVyYWJsZTogZmFsc2V9KTtcbiAgICAgICAgX2xlbmd0aCsrO1xuICAgICAgICAvLyBJZiB0aGlyZCBvciBsYXRlciBlbnRyeSB3aXRoIHRoaXMgbmFtZVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgb2JqW192bmFtZV0ucHVzaCh2YWwpO1xuICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBfbGVuZ3RoLCB7dmFsdWU6IF92bmFtZSwgZW51bWVyYWJsZTogZmFsc2V9KTtcbiAgICAgICAgX2xlbmd0aCsrO1xuICAgICAgfVxuICAgIH1cbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBcImxlbmd0aFwiLCB7dmFsdWU6IF9sZW5ndGgsIGVudW1lcmFibGU6IGZhbHNlfSk7XG4gICAgcmV0dXJuIG9iajtcbiAgfSxcbiAgY29weVZhbHVlOiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICBpZiAodmFsdWUgPT0gbnVsbCkge1xuICAgICAgcmV0dXJuIG51bGxcbiAgICB9XG4gICAgaWYgKHZhbHVlID09IHVuZGVmaW5lZCkge1xuICAgICAgcmV0dXJuIHVuZGVmaW5lZFxuICAgIH1cbiAgICBzd2l0Y2ggKHZhbHVlLmNvbnN0cnVjdG9yKSB7XG4gICAgICBjYXNlIE9iamVjdDpcbiAgICAgICAgcmV0dXJuIG9iamVjdFV0aWxzLmRlZXBFeHRlbmQoe30sIHZhbHVlKTtcbiAgICAgIGNhc2UgQXJyYXk6XG4gICAgICAgIHJldHVybiBvYmplY3RVdGlscy5kZWVwRXh0ZW5kKFtdLCB2YWx1ZSk7XG4gICAgICBjYXNlIFN0cmluZzpcbiAgICAgIGNhc2UgTnVtYmVyOlxuICAgICAgY2FzZSBCb29sZWFuOlxuICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICAvL2NvbnNvbGUubG9nKHZhbHVlLmNvbnN0cnVjdG9yKTtcbiAgICAgICAgcmV0dXJuIG9iamVjdFV0aWxzLmRlZXBFeHRlbmQoe30sIHZhbHVlKTtcbiAgICB9XG4gIH0sXG4gIGNsZWFyVmFsdWU6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgIHN3aXRjaCAodmFsdWUuY29uc3RydWN0b3IpIHtcbiAgICAgIGNhc2UgT2JqZWN0OlxuICAgICAgICBmb3IgKHZhciBtZW1iZXIgaW4gdmFsdWUpIGRlbGV0ZSB2YWx1ZVttZW1iZXJdO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgQXJyYXk6XG4gICAgICAgIHZhbHVlLmxlbmd0aCA9IDA7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgLy9kZWxldGUgdmFsdWU7XG4gICAgfVxuICB9LFxuICBvYmplY3RzRGlmZmVyZW5jZTogZnVuY3Rpb24gKHByZXYsIG5vdykge1xuICAgIHZhciBjaGFuZ2VzID0ge307XG4gICAgZm9yICh2YXIgcHJvcCBpbiBub3cpIHtcbiAgICAgIGlmICghcHJldiB8fCBwcmV2W3Byb3BdICE9PSBub3dbcHJvcF0pIHtcbiAgICAgICAgaWYgKHR5cGVvZiBub3dbcHJvcF0gPT0gXCJvYmplY3RcIikge1xuICAgICAgICAgIHZhciBjID0gdXRpbHMub2JqZWN0c0RpZmZlcmVuY2UocHJldltwcm9wXSwgbm93W3Byb3BdKTtcbiAgICAgICAgICBpZiAoIV8uaXNFbXB0eShjKSkgLy8gdW5kZXJzY29yZVxuICAgICAgICAgICAgY2hhbmdlc1twcm9wXSA9IGM7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY2hhbmdlc1twcm9wXSA9IG5vd1twcm9wXTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gY2hhbmdlcztcbiAgfSxcbiAgc3BsaXRCeTogZnVuY3Rpb24gKHF1ZXJ5LCBkZWxpbWl0ZXIpIHtcbiAgICB2YXIgdHJhY2VRdWVyaWVzID0gW107XG4gICAgdmFyIHIgPSAwLFxuICAgICAgZiA9IDAsXG4gICAgICBfcF9zdGFydCA9IDA7XG4gICAgaWYgKHF1ZXJ5ID09IFwiXCIpIHJldHVybiBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHF1ZXJ5Lmxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgYyA9IHF1ZXJ5W2ldO1xuICAgICAgaWYgKGMgPT0gXCIoXCIpIHtcbiAgICAgICAgcisrO1xuICAgICAgICBmID0gMTtcbiAgICAgIH0gZWxzZSBpZiAoYyA9PSBcIilcIikge1xuICAgICAgICByLS07XG4gICAgICB9XG4gICAgICBpZiAociA9PSAwICYmIGYgPT0gMSkgZiA9IDA7XG4gICAgICBpZiAoZGVsaW1pdGVyLmluZGV4T2YoYykgIT0gLTEgJiYgciA9PSAwICYmIGYgPT0gMCkge1xuICAgICAgICB0cmFjZVF1ZXJpZXMucHVzaChxdWVyeS5zdWJzdHJpbmcoX3Bfc3RhcnQsIGkpKTtcbiAgICAgICAgX3Bfc3RhcnQgPSBpICsgMTtcbiAgICAgIH1cbiAgICB9XG4gICAgdHJhY2VRdWVyaWVzLnB1c2gocXVlcnkuc3Vic3RyaW5nKF9wX3N0YXJ0KSk7XG4gICAgcmV0dXJuIHRyYWNlUXVlcmllcztcbiAgfSxcbiAgcXVldWVMb2FkOiBmdW5jdGlvbiAodG90YWwsIGNvbXBsZXRlQ0IsIHByb2dyZXNzQ0IpIHtcbiAgICB2YXIgbG9hZGVyID0gZnVuY3Rpb24gKGVsKSB7XG4gICAgICBsb2FkZXIubG9hZGVkLnB1c2goZWwpO1xuICAgICAgbG9hZGVyLnByb2dyZXNzQ0IgJiYgbG9hZGVyLnByb2dyZXNzQ0IobG9hZGVyLmxvYWRlZC5sZW5ndGgsIGxvYWRlci50b3RhbCwgZWwsIGxvYWRlci5sb2FkZWQpO1xuXG4gICAgICBpZiAobG9hZGVyLmxvYWRlZC5sZW5ndGggPT0gbG9hZGVyLnRvdGFsKSB7XG4gICAgICAgIGxvYWRlci5jb21wbGV0ZUNCICYmIGxvYWRlci5jb21wbGV0ZUNCKGxvYWRlci5sb2FkZWQpO1xuICAgICAgICBsb2FkZXIuZmlyZShcImxvYWRlZFwiKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIGxvYWRlci5jb21wbGV0ZUNCID0gY29tcGxldGVDQjtcbiAgICBsb2FkZXIucHJvZ3Jlc3NDQiA9IHByb2dyZXNzQ0I7XG4gICAgbG9hZGVyLnRvdGFsID0gdG90YWw7XG4gICAgbG9hZGVyLmxvYWRlZCA9IFtdO1xuICAgIHV0aWxzLm9ic2VydmFibGUobG9hZGVyKTtcblxuICAgIHJldHVybiBsb2FkZXI7XG4gIH1cbn07XG5tb2R1bGUuZXhwb3J0cyA9ICB1dGlscztcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvdXRpbC91dGlsLmpzIiwibW9kdWxlLmV4cG9ydHMgPSB7XG4gIHJlc29sdmU6IGZ1bmN0aW9uIChwYXRoKSB7XG4gICAgdmFyIGNodW5rcyA9IHBhdGguc3BsaXQoXCIvXCIpO1xuICAgIHZhciBwcmV2ID0gMDtcbiAgICBmb3IgKHZhciBpID0gY2h1bmtzLmxlbmd0aDsgaS0tID4gMDspIHtcbiAgICAgIGlmIChjaHVua3NbaV0gPT0gXCIuLlwiKSB7XG4gICAgICAgIHByZXYrKztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHdoaWxlIChwcmV2ID4gMCkge1xuICAgICAgICAgIGNodW5rcy5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgY2h1bmtzLnNwbGljZShpLS0sIDEpO1xuICAgICAgICAgIHByZXYtLTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gY2h1bmtzLmpvaW4oXCIvXCIpO1xuICB9LFxuICBnZXRQYXJlbnREaXJlY3RvcnlVcmw6IGZ1bmN0aW9uICh1cmwpIHtcbiAgICByZXR1cm4gdXJsLnN1YnN0cigwLCB1cmwubGFzdEluZGV4T2YoXCIvXCIpICsgMSk7XG4gIH1cbn1cblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvdXRpbC9wYXRoLmpzIiwiXG5TdHJpbmcucHJvdG90eXBlLmZvcm1hdCAgPSBmdW5jdGlvbiAoKSB7XG4gIHZhciBzdHIgPSB0aGlzLnRvU3RyaW5nKCk7XG4gIGlmIChhcmd1bWVudHMubGVuZ3RoKSB7XG4gICAgdmFyIHR5cGUgPSB0eXBlb2YgYXJndW1lbnRzWzBdXG4gICAgICAsIGFyZ3MgPSB0eXBlID09ICdzdHJpbmcnIHx8IHR5cGUgPT0gJ251bWJlcicgPyBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpIDogYXJndW1lbnRzWzBdXG4gICAgLy9cbiAgICAvLyBmb3IgKHZhciBhcmcgaW4gYXJncykgc3RyID0gc3RyLnJlcGxhY2UobmV3IFJlZ0V4cCgnXFxcXHsnICsgYXJnICsgJ1xcXFx9JywgJ2dpJyksIGFyZ3NbYXJnXSlcblxuICAgIHN0ciA9IHN0ci5yZXBsYWNlKC9cXHsoW159XSopXFx9L2csZnVuY3Rpb24oYSxiKXtcbiAgICAgIHJldHVybiB1dGlscy5ldmFsSW5Db250ZXh0KGIsYXJncylcbiAgICB9KVxuICB9XG5cbiAgcmV0dXJuIHN0clxufTtcblxudmFyIHV0aWxzID0ge1xuICBleHRyYWN0VmFyaWFibGVzOiBmdW5jdGlvbiAoc3RyKSB7XG4gICAgcmV0dXJuIHN0ci5tYXRjaCgvKD8hKD86ZG98aWZ8aW58Zm9yfGxldHxuZXd8dHJ5fHZhcnxjYXNlfGVsc2V8ZW51bXxldmFsfGZhbHNlfG51bGx8dGhpc3x0cnVlfHZvaWR8d2l0aHxicmVha3xjYXRjaHxjbGFzc3xjb25zdHxzdXBlcnx0aHJvd3x3aGlsZXx5aWVsZHxkZWxldGV8ZXhwb3J0fGltcG9ydHxwdWJsaWN8cmV0dXJufHN0YXRpY3xzd2l0Y2h8dHlwZW9mfGRlZmF1bHR8ZXh0ZW5kc3xmaW5hbGx5fHBhY2thZ2V8cHJpdmF0ZXxjb250aW51ZXxkZWJ1Z2dlcnxmdW5jdGlvbnxhcmd1bWVudHN8aW50ZXJmYWNlfHByb3RlY3RlZHxpbXBsZW1lbnRzfGluc3RhbmNlb2YpJClbJEEtWlxcX2EtelxceGFhXFx4YjVcXHhiYVxceGMwLVxceGQ2XFx4ZDgtXFx4ZjZcXHhmOC1cXHUwMmMxXFx1MDJjNi1cXHUwMmQxXFx1MDJlMC1cXHUwMmU0XFx1MDJlY1xcdTAyZWVcXHUwMzcwLVxcdTAzNzRcXHUwMzc2XFx1MDM3N1xcdTAzN2EtXFx1MDM3ZFxcdTAzODZcXHUwMzg4LVxcdTAzOGFcXHUwMzhjXFx1MDM4ZS1cXHUwM2ExXFx1MDNhMy1cXHUwM2Y1XFx1MDNmNy1cXHUwNDgxXFx1MDQ4YS1cXHUwNTI3XFx1MDUzMS1cXHUwNTU2XFx1MDU1OVxcdTA1NjEtXFx1MDU4N1xcdTA1ZDAtXFx1MDVlYVxcdTA1ZjAtXFx1MDVmMlxcdTA2MjAtXFx1MDY0YVxcdTA2NmVcXHUwNjZmXFx1MDY3MS1cXHUwNmQzXFx1MDZkNVxcdTA2ZTVcXHUwNmU2XFx1MDZlZVxcdTA2ZWZcXHUwNmZhLVxcdTA2ZmNcXHUwNmZmXFx1MDcxMFxcdTA3MTItXFx1MDcyZlxcdTA3NGQtXFx1MDdhNVxcdTA3YjFcXHUwN2NhLVxcdTA3ZWFcXHUwN2Y0XFx1MDdmNVxcdTA3ZmFcXHUwODAwLVxcdTA4MTVcXHUwODFhXFx1MDgyNFxcdTA4MjhcXHUwODQwLVxcdTA4NThcXHUwOGEwXFx1MDhhMi1cXHUwOGFjXFx1MDkwNC1cXHUwOTM5XFx1MDkzZFxcdTA5NTBcXHUwOTU4LVxcdTA5NjFcXHUwOTcxLVxcdTA5NzdcXHUwOTc5LVxcdTA5N2ZcXHUwOTg1LVxcdTA5OGNcXHUwOThmXFx1MDk5MFxcdTA5OTMtXFx1MDlhOFxcdTA5YWEtXFx1MDliMFxcdTA5YjJcXHUwOWI2LVxcdTA5YjlcXHUwOWJkXFx1MDljZVxcdTA5ZGNcXHUwOWRkXFx1MDlkZi1cXHUwOWUxXFx1MDlmMFxcdTA5ZjFcXHUwYTA1LVxcdTBhMGFcXHUwYTBmXFx1MGExMFxcdTBhMTMtXFx1MGEyOFxcdTBhMmEtXFx1MGEzMFxcdTBhMzJcXHUwYTMzXFx1MGEzNVxcdTBhMzZcXHUwYTM4XFx1MGEzOVxcdTBhNTktXFx1MGE1Y1xcdTBhNWVcXHUwYTcyLVxcdTBhNzRcXHUwYTg1LVxcdTBhOGRcXHUwYThmLVxcdTBhOTFcXHUwYTkzLVxcdTBhYThcXHUwYWFhLVxcdTBhYjBcXHUwYWIyXFx1MGFiM1xcdTBhYjUtXFx1MGFiOVxcdTBhYmRcXHUwYWQwXFx1MGFlMFxcdTBhZTFcXHUwYjA1LVxcdTBiMGNcXHUwYjBmXFx1MGIxMFxcdTBiMTMtXFx1MGIyOFxcdTBiMmEtXFx1MGIzMFxcdTBiMzJcXHUwYjMzXFx1MGIzNS1cXHUwYjM5XFx1MGIzZFxcdTBiNWNcXHUwYjVkXFx1MGI1Zi1cXHUwYjYxXFx1MGI3MVxcdTBiODNcXHUwYjg1LVxcdTBiOGFcXHUwYjhlLVxcdTBiOTBcXHUwYjkyLVxcdTBiOTVcXHUwYjk5XFx1MGI5YVxcdTBiOWNcXHUwYjllXFx1MGI5ZlxcdTBiYTNcXHUwYmE0XFx1MGJhOC1cXHUwYmFhXFx1MGJhZS1cXHUwYmI5XFx1MGJkMFxcdTBjMDUtXFx1MGMwY1xcdTBjMGUtXFx1MGMxMFxcdTBjMTItXFx1MGMyOFxcdTBjMmEtXFx1MGMzM1xcdTBjMzUtXFx1MGMzOVxcdTBjM2RcXHUwYzU4XFx1MGM1OVxcdTBjNjBcXHUwYzYxXFx1MGM4NS1cXHUwYzhjXFx1MGM4ZS1cXHUwYzkwXFx1MGM5Mi1cXHUwY2E4XFx1MGNhYS1cXHUwY2IzXFx1MGNiNS1cXHUwY2I5XFx1MGNiZFxcdTBjZGVcXHUwY2UwXFx1MGNlMVxcdTBjZjFcXHUwY2YyXFx1MGQwNS1cXHUwZDBjXFx1MGQwZS1cXHUwZDEwXFx1MGQxMi1cXHUwZDNhXFx1MGQzZFxcdTBkNGVcXHUwZDYwXFx1MGQ2MVxcdTBkN2EtXFx1MGQ3ZlxcdTBkODUtXFx1MGQ5NlxcdTBkOWEtXFx1MGRiMVxcdTBkYjMtXFx1MGRiYlxcdTBkYmRcXHUwZGMwLVxcdTBkYzZcXHUwZTAxLVxcdTBlMzBcXHUwZTMyXFx1MGUzM1xcdTBlNDAtXFx1MGU0NlxcdTBlODFcXHUwZTgyXFx1MGU4NFxcdTBlODdcXHUwZTg4XFx1MGU4YVxcdTBlOGRcXHUwZTk0LVxcdTBlOTdcXHUwZTk5LVxcdTBlOWZcXHUwZWExLVxcdTBlYTNcXHUwZWE1XFx1MGVhN1xcdTBlYWFcXHUwZWFiXFx1MGVhZC1cXHUwZWIwXFx1MGViMlxcdTBlYjNcXHUwZWJkXFx1MGVjMC1cXHUwZWM0XFx1MGVjNlxcdTBlZGMtXFx1MGVkZlxcdTBmMDBcXHUwZjQwLVxcdTBmNDdcXHUwZjQ5LVxcdTBmNmNcXHUwZjg4LVxcdTBmOGNcXHUxMDAwLVxcdTEwMmFcXHUxMDNmXFx1MTA1MC1cXHUxMDU1XFx1MTA1YS1cXHUxMDVkXFx1MTA2MVxcdTEwNjVcXHUxMDY2XFx1MTA2ZS1cXHUxMDcwXFx1MTA3NS1cXHUxMDgxXFx1MTA4ZVxcdTEwYTAtXFx1MTBjNVxcdTEwYzdcXHUxMGNkXFx1MTBkMC1cXHUxMGZhXFx1MTBmYy1cXHUxMjQ4XFx1MTI0YS1cXHUxMjRkXFx1MTI1MC1cXHUxMjU2XFx1MTI1OFxcdTEyNWEtXFx1MTI1ZFxcdTEyNjAtXFx1MTI4OFxcdTEyOGEtXFx1MTI4ZFxcdTEyOTAtXFx1MTJiMFxcdTEyYjItXFx1MTJiNVxcdTEyYjgtXFx1MTJiZVxcdTEyYzBcXHUxMmMyLVxcdTEyYzVcXHUxMmM4LVxcdTEyZDZcXHUxMmQ4LVxcdTEzMTBcXHUxMzEyLVxcdTEzMTVcXHUxMzE4LVxcdTEzNWFcXHUxMzgwLVxcdTEzOGZcXHUxM2EwLVxcdTEzZjRcXHUxNDAxLVxcdTE2NmNcXHUxNjZmLVxcdTE2N2ZcXHUxNjgxLVxcdTE2OWFcXHUxNmEwLVxcdTE2ZWFcXHUxNmVlLVxcdTE2ZjBcXHUxNzAwLVxcdTE3MGNcXHUxNzBlLVxcdTE3MTFcXHUxNzIwLVxcdTE3MzFcXHUxNzQwLVxcdTE3NTFcXHUxNzYwLVxcdTE3NmNcXHUxNzZlLVxcdTE3NzBcXHUxNzgwLVxcdTE3YjNcXHUxN2Q3XFx1MTdkY1xcdTE4MjAtXFx1MTg3N1xcdTE4ODAtXFx1MThhOFxcdTE4YWFcXHUxOGIwLVxcdTE4ZjVcXHUxOTAwLVxcdTE5MWNcXHUxOTUwLVxcdTE5NmRcXHUxOTcwLVxcdTE5NzRcXHUxOTgwLVxcdTE5YWJcXHUxOWMxLVxcdTE5YzdcXHUxYTAwLVxcdTFhMTZcXHUxYTIwLVxcdTFhNTRcXHUxYWE3XFx1MWIwNS1cXHUxYjMzXFx1MWI0NS1cXHUxYjRiXFx1MWI4My1cXHUxYmEwXFx1MWJhZVxcdTFiYWZcXHUxYmJhLVxcdTFiZTVcXHUxYzAwLVxcdTFjMjNcXHUxYzRkLVxcdTFjNGZcXHUxYzVhLVxcdTFjN2RcXHUxY2U5LVxcdTFjZWNcXHUxY2VlLVxcdTFjZjFcXHUxY2Y1XFx1MWNmNlxcdTFkMDAtXFx1MWRiZlxcdTFlMDAtXFx1MWYxNVxcdTFmMTgtXFx1MWYxZFxcdTFmMjAtXFx1MWY0NVxcdTFmNDgtXFx1MWY0ZFxcdTFmNTAtXFx1MWY1N1xcdTFmNTlcXHUxZjViXFx1MWY1ZFxcdTFmNWYtXFx1MWY3ZFxcdTFmODAtXFx1MWZiNFxcdTFmYjYtXFx1MWZiY1xcdTFmYmVcXHUxZmMyLVxcdTFmYzRcXHUxZmM2LVxcdTFmY2NcXHUxZmQwLVxcdTFmZDNcXHUxZmQ2LVxcdTFmZGJcXHUxZmUwLVxcdTFmZWNcXHUxZmYyLVxcdTFmZjRcXHUxZmY2LVxcdTFmZmNcXHUyMDcxXFx1MjA3ZlxcdTIwOTAtXFx1MjA5Y1xcdTIxMDJcXHUyMTA3XFx1MjEwYS1cXHUyMTEzXFx1MjExNVxcdTIxMTktXFx1MjExZFxcdTIxMjRcXHUyMTI2XFx1MjEyOFxcdTIxMmEtXFx1MjEyZFxcdTIxMmYtXFx1MjEzOVxcdTIxM2MtXFx1MjEzZlxcdTIxNDUtXFx1MjE0OVxcdTIxNGVcXHUyMTYwLVxcdTIxODhcXHUyYzAwLVxcdTJjMmVcXHUyYzMwLVxcdTJjNWVcXHUyYzYwLVxcdTJjZTRcXHUyY2ViLVxcdTJjZWVcXHUyY2YyXFx1MmNmM1xcdTJkMDAtXFx1MmQyNVxcdTJkMjdcXHUyZDJkXFx1MmQzMC1cXHUyZDY3XFx1MmQ2ZlxcdTJkODAtXFx1MmQ5NlxcdTJkYTAtXFx1MmRhNlxcdTJkYTgtXFx1MmRhZVxcdTJkYjAtXFx1MmRiNlxcdTJkYjgtXFx1MmRiZVxcdTJkYzAtXFx1MmRjNlxcdTJkYzgtXFx1MmRjZVxcdTJkZDAtXFx1MmRkNlxcdTJkZDgtXFx1MmRkZVxcdTJlMmZcXHUzMDA1LVxcdTMwMDdcXHUzMDIxLVxcdTMwMjlcXHUzMDMxLVxcdTMwMzVcXHUzMDM4LVxcdTMwM2NcXHUzMDQxLVxcdTMwOTZcXHUzMDlkLVxcdTMwOWZcXHUzMGExLVxcdTMwZmFcXHUzMGZjLVxcdTMwZmZcXHUzMTA1LVxcdTMxMmRcXHUzMTMxLVxcdTMxOGVcXHUzMWEwLVxcdTMxYmFcXHUzMWYwLVxcdTMxZmZcXHUzNDAwLVxcdTRkYjVcXHU0ZTAwLVxcdTlmY2NcXHVhMDAwLVxcdWE0OGNcXHVhNGQwLVxcdWE0ZmRcXHVhNTAwLVxcdWE2MGNcXHVhNjEwLVxcdWE2MWZcXHVhNjJhXFx1YTYyYlxcdWE2NDAtXFx1YTY2ZVxcdWE2N2YtXFx1YTY5N1xcdWE2YTAtXFx1YTZlZlxcdWE3MTctXFx1YTcxZlxcdWE3MjItXFx1YTc4OFxcdWE3OGItXFx1YTc4ZVxcdWE3OTAtXFx1YTc5M1xcdWE3YTAtXFx1YTdhYVxcdWE3ZjgtXFx1YTgwMVxcdWE4MDMtXFx1YTgwNVxcdWE4MDctXFx1YTgwYVxcdWE4MGMtXFx1YTgyMlxcdWE4NDAtXFx1YTg3M1xcdWE4ODItXFx1YThiM1xcdWE4ZjItXFx1YThmN1xcdWE4ZmJcXHVhOTBhLVxcdWE5MjVcXHVhOTMwLVxcdWE5NDZcXHVhOTYwLVxcdWE5N2NcXHVhOTg0LVxcdWE5YjJcXHVhOWNmXFx1YWEwMC1cXHVhYTI4XFx1YWE0MC1cXHVhYTQyXFx1YWE0NC1cXHVhYTRiXFx1YWE2MC1cXHVhYTc2XFx1YWE3YVxcdWFhODAtXFx1YWFhZlxcdWFhYjFcXHVhYWI1XFx1YWFiNlxcdWFhYjktXFx1YWFiZFxcdWFhYzBcXHVhYWMyXFx1YWFkYi1cXHVhYWRkXFx1YWFlMC1cXHVhYWVhXFx1YWFmMi1cXHVhYWY0XFx1YWIwMS1cXHVhYjA2XFx1YWIwOS1cXHVhYjBlXFx1YWIxMS1cXHVhYjE2XFx1YWIyMC1cXHVhYjI2XFx1YWIyOC1cXHVhYjJlXFx1YWJjMC1cXHVhYmUyXFx1YWMwMC1cXHVkN2EzXFx1ZDdiMC1cXHVkN2M2XFx1ZDdjYi1cXHVkN2ZiXFx1ZjkwMC1cXHVmYTZkXFx1ZmE3MC1cXHVmYWQ5XFx1ZmIwMC1cXHVmYjA2XFx1ZmIxMy1cXHVmYjE3XFx1ZmIxZFxcdWZiMWYtXFx1ZmIyOFxcdWZiMmEtXFx1ZmIzNlxcdWZiMzgtXFx1ZmIzY1xcdWZiM2VcXHVmYjQwXFx1ZmI0MVxcdWZiNDNcXHVmYjQ0XFx1ZmI0Ni1cXHVmYmIxXFx1ZmJkMy1cXHVmZDNkXFx1ZmQ1MC1cXHVmZDhmXFx1ZmQ5Mi1cXHVmZGM3XFx1ZmRmMC1cXHVmZGZiXFx1ZmU3MC1cXHVmZTc0XFx1ZmU3Ni1cXHVmZWZjXFx1ZmYyMS1cXHVmZjNhXFx1ZmY0MS1cXHVmZjVhXFx1ZmY2Ni1cXHVmZmJlXFx1ZmZjMi1cXHVmZmM3XFx1ZmZjYS1cXHVmZmNmXFx1ZmZkMi1cXHVmZmQ3XFx1ZmZkYS1cXHVmZmRjXVskQS1aXFxfYS16XFx4YWFcXHhiNVxceGJhXFx4YzAtXFx4ZDZcXHhkOC1cXHhmNlxceGY4LVxcdTAyYzFcXHUwMmM2LVxcdTAyZDFcXHUwMmUwLVxcdTAyZTRcXHUwMmVjXFx1MDJlZVxcdTAzNzAtXFx1MDM3NFxcdTAzNzZcXHUwMzc3XFx1MDM3YS1cXHUwMzdkXFx1MDM4NlxcdTAzODgtXFx1MDM4YVxcdTAzOGNcXHUwMzhlLVxcdTAzYTFcXHUwM2EzLVxcdTAzZjVcXHUwM2Y3LVxcdTA0ODFcXHUwNDhhLVxcdTA1MjdcXHUwNTMxLVxcdTA1NTZcXHUwNTU5XFx1MDU2MS1cXHUwNTg3XFx1MDVkMC1cXHUwNWVhXFx1MDVmMC1cXHUwNWYyXFx1MDYyMC1cXHUwNjRhXFx1MDY2ZVxcdTA2NmZcXHUwNjcxLVxcdTA2ZDNcXHUwNmQ1XFx1MDZlNVxcdTA2ZTZcXHUwNmVlXFx1MDZlZlxcdTA2ZmEtXFx1MDZmY1xcdTA2ZmZcXHUwNzEwXFx1MDcxMi1cXHUwNzJmXFx1MDc0ZC1cXHUwN2E1XFx1MDdiMVxcdTA3Y2EtXFx1MDdlYVxcdTA3ZjRcXHUwN2Y1XFx1MDdmYVxcdTA4MDAtXFx1MDgxNVxcdTA4MWFcXHUwODI0XFx1MDgyOFxcdTA4NDAtXFx1MDg1OFxcdTA4YTBcXHUwOGEyLVxcdTA4YWNcXHUwOTA0LVxcdTA5MzlcXHUwOTNkXFx1MDk1MFxcdTA5NTgtXFx1MDk2MVxcdTA5NzEtXFx1MDk3N1xcdTA5NzktXFx1MDk3ZlxcdTA5ODUtXFx1MDk4Y1xcdTA5OGZcXHUwOTkwXFx1MDk5My1cXHUwOWE4XFx1MDlhYS1cXHUwOWIwXFx1MDliMlxcdTA5YjYtXFx1MDliOVxcdTA5YmRcXHUwOWNlXFx1MDlkY1xcdTA5ZGRcXHUwOWRmLVxcdTA5ZTFcXHUwOWYwXFx1MDlmMVxcdTBhMDUtXFx1MGEwYVxcdTBhMGZcXHUwYTEwXFx1MGExMy1cXHUwYTI4XFx1MGEyYS1cXHUwYTMwXFx1MGEzMlxcdTBhMzNcXHUwYTM1XFx1MGEzNlxcdTBhMzhcXHUwYTM5XFx1MGE1OS1cXHUwYTVjXFx1MGE1ZVxcdTBhNzItXFx1MGE3NFxcdTBhODUtXFx1MGE4ZFxcdTBhOGYtXFx1MGE5MVxcdTBhOTMtXFx1MGFhOFxcdTBhYWEtXFx1MGFiMFxcdTBhYjJcXHUwYWIzXFx1MGFiNS1cXHUwYWI5XFx1MGFiZFxcdTBhZDBcXHUwYWUwXFx1MGFlMVxcdTBiMDUtXFx1MGIwY1xcdTBiMGZcXHUwYjEwXFx1MGIxMy1cXHUwYjI4XFx1MGIyYS1cXHUwYjMwXFx1MGIzMlxcdTBiMzNcXHUwYjM1LVxcdTBiMzlcXHUwYjNkXFx1MGI1Y1xcdTBiNWRcXHUwYjVmLVxcdTBiNjFcXHUwYjcxXFx1MGI4M1xcdTBiODUtXFx1MGI4YVxcdTBiOGUtXFx1MGI5MFxcdTBiOTItXFx1MGI5NVxcdTBiOTlcXHUwYjlhXFx1MGI5Y1xcdTBiOWVcXHUwYjlmXFx1MGJhM1xcdTBiYTRcXHUwYmE4LVxcdTBiYWFcXHUwYmFlLVxcdTBiYjlcXHUwYmQwXFx1MGMwNS1cXHUwYzBjXFx1MGMwZS1cXHUwYzEwXFx1MGMxMi1cXHUwYzI4XFx1MGMyYS1cXHUwYzMzXFx1MGMzNS1cXHUwYzM5XFx1MGMzZFxcdTBjNThcXHUwYzU5XFx1MGM2MFxcdTBjNjFcXHUwYzg1LVxcdTBjOGNcXHUwYzhlLVxcdTBjOTBcXHUwYzkyLVxcdTBjYThcXHUwY2FhLVxcdTBjYjNcXHUwY2I1LVxcdTBjYjlcXHUwY2JkXFx1MGNkZVxcdTBjZTBcXHUwY2UxXFx1MGNmMVxcdTBjZjJcXHUwZDA1LVxcdTBkMGNcXHUwZDBlLVxcdTBkMTBcXHUwZDEyLVxcdTBkM2FcXHUwZDNkXFx1MGQ0ZVxcdTBkNjBcXHUwZDYxXFx1MGQ3YS1cXHUwZDdmXFx1MGQ4NS1cXHUwZDk2XFx1MGQ5YS1cXHUwZGIxXFx1MGRiMy1cXHUwZGJiXFx1MGRiZFxcdTBkYzAtXFx1MGRjNlxcdTBlMDEtXFx1MGUzMFxcdTBlMzJcXHUwZTMzXFx1MGU0MC1cXHUwZTQ2XFx1MGU4MVxcdTBlODJcXHUwZTg0XFx1MGU4N1xcdTBlODhcXHUwZThhXFx1MGU4ZFxcdTBlOTQtXFx1MGU5N1xcdTBlOTktXFx1MGU5ZlxcdTBlYTEtXFx1MGVhM1xcdTBlYTVcXHUwZWE3XFx1MGVhYVxcdTBlYWJcXHUwZWFkLVxcdTBlYjBcXHUwZWIyXFx1MGViM1xcdTBlYmRcXHUwZWMwLVxcdTBlYzRcXHUwZWM2XFx1MGVkYy1cXHUwZWRmXFx1MGYwMFxcdTBmNDAtXFx1MGY0N1xcdTBmNDktXFx1MGY2Y1xcdTBmODgtXFx1MGY4Y1xcdTEwMDAtXFx1MTAyYVxcdTEwM2ZcXHUxMDUwLVxcdTEwNTVcXHUxMDVhLVxcdTEwNWRcXHUxMDYxXFx1MTA2NVxcdTEwNjZcXHUxMDZlLVxcdTEwNzBcXHUxMDc1LVxcdTEwODFcXHUxMDhlXFx1MTBhMC1cXHUxMGM1XFx1MTBjN1xcdTEwY2RcXHUxMGQwLVxcdTEwZmFcXHUxMGZjLVxcdTEyNDhcXHUxMjRhLVxcdTEyNGRcXHUxMjUwLVxcdTEyNTZcXHUxMjU4XFx1MTI1YS1cXHUxMjVkXFx1MTI2MC1cXHUxMjg4XFx1MTI4YS1cXHUxMjhkXFx1MTI5MC1cXHUxMmIwXFx1MTJiMi1cXHUxMmI1XFx1MTJiOC1cXHUxMmJlXFx1MTJjMFxcdTEyYzItXFx1MTJjNVxcdTEyYzgtXFx1MTJkNlxcdTEyZDgtXFx1MTMxMFxcdTEzMTItXFx1MTMxNVxcdTEzMTgtXFx1MTM1YVxcdTEzODAtXFx1MTM4ZlxcdTEzYTAtXFx1MTNmNFxcdTE0MDEtXFx1MTY2Y1xcdTE2NmYtXFx1MTY3ZlxcdTE2ODEtXFx1MTY5YVxcdTE2YTAtXFx1MTZlYVxcdTE2ZWUtXFx1MTZmMFxcdTE3MDAtXFx1MTcwY1xcdTE3MGUtXFx1MTcxMVxcdTE3MjAtXFx1MTczMVxcdTE3NDAtXFx1MTc1MVxcdTE3NjAtXFx1MTc2Y1xcdTE3NmUtXFx1MTc3MFxcdTE3ODAtXFx1MTdiM1xcdTE3ZDdcXHUxN2RjXFx1MTgyMC1cXHUxODc3XFx1MTg4MC1cXHUxOGE4XFx1MThhYVxcdTE4YjAtXFx1MThmNVxcdTE5MDAtXFx1MTkxY1xcdTE5NTAtXFx1MTk2ZFxcdTE5NzAtXFx1MTk3NFxcdTE5ODAtXFx1MTlhYlxcdTE5YzEtXFx1MTljN1xcdTFhMDAtXFx1MWExNlxcdTFhMjAtXFx1MWE1NFxcdTFhYTdcXHUxYjA1LVxcdTFiMzNcXHUxYjQ1LVxcdTFiNGJcXHUxYjgzLVxcdTFiYTBcXHUxYmFlXFx1MWJhZlxcdTFiYmEtXFx1MWJlNVxcdTFjMDAtXFx1MWMyM1xcdTFjNGQtXFx1MWM0ZlxcdTFjNWEtXFx1MWM3ZFxcdTFjZTktXFx1MWNlY1xcdTFjZWUtXFx1MWNmMVxcdTFjZjVcXHUxY2Y2XFx1MWQwMC1cXHUxZGJmXFx1MWUwMC1cXHUxZjE1XFx1MWYxOC1cXHUxZjFkXFx1MWYyMC1cXHUxZjQ1XFx1MWY0OC1cXHUxZjRkXFx1MWY1MC1cXHUxZjU3XFx1MWY1OVxcdTFmNWJcXHUxZjVkXFx1MWY1Zi1cXHUxZjdkXFx1MWY4MC1cXHUxZmI0XFx1MWZiNi1cXHUxZmJjXFx1MWZiZVxcdTFmYzItXFx1MWZjNFxcdTFmYzYtXFx1MWZjY1xcdTFmZDAtXFx1MWZkM1xcdTFmZDYtXFx1MWZkYlxcdTFmZTAtXFx1MWZlY1xcdTFmZjItXFx1MWZmNFxcdTFmZjYtXFx1MWZmY1xcdTIwNzFcXHUyMDdmXFx1MjA5MC1cXHUyMDljXFx1MjEwMlxcdTIxMDdcXHUyMTBhLVxcdTIxMTNcXHUyMTE1XFx1MjExOS1cXHUyMTFkXFx1MjEyNFxcdTIxMjZcXHUyMTI4XFx1MjEyYS1cXHUyMTJkXFx1MjEyZi1cXHUyMTM5XFx1MjEzYy1cXHUyMTNmXFx1MjE0NS1cXHUyMTQ5XFx1MjE0ZVxcdTIxNjAtXFx1MjE4OFxcdTJjMDAtXFx1MmMyZVxcdTJjMzAtXFx1MmM1ZVxcdTJjNjAtXFx1MmNlNFxcdTJjZWItXFx1MmNlZVxcdTJjZjJcXHUyY2YzXFx1MmQwMC1cXHUyZDI1XFx1MmQyN1xcdTJkMmRcXHUyZDMwLVxcdTJkNjdcXHUyZDZmXFx1MmQ4MC1cXHUyZDk2XFx1MmRhMC1cXHUyZGE2XFx1MmRhOC1cXHUyZGFlXFx1MmRiMC1cXHUyZGI2XFx1MmRiOC1cXHUyZGJlXFx1MmRjMC1cXHUyZGM2XFx1MmRjOC1cXHUyZGNlXFx1MmRkMC1cXHUyZGQ2XFx1MmRkOC1cXHUyZGRlXFx1MmUyZlxcdTMwMDUtXFx1MzAwN1xcdTMwMjEtXFx1MzAyOVxcdTMwMzEtXFx1MzAzNVxcdTMwMzgtXFx1MzAzY1xcdTMwNDEtXFx1MzA5NlxcdTMwOWQtXFx1MzA5ZlxcdTMwYTEtXFx1MzBmYVxcdTMwZmMtXFx1MzBmZlxcdTMxMDUtXFx1MzEyZFxcdTMxMzEtXFx1MzE4ZVxcdTMxYTAtXFx1MzFiYVxcdTMxZjAtXFx1MzFmZlxcdTM0MDAtXFx1NGRiNVxcdTRlMDAtXFx1OWZjY1xcdWEwMDAtXFx1YTQ4Y1xcdWE0ZDAtXFx1YTRmZFxcdWE1MDAtXFx1YTYwY1xcdWE2MTAtXFx1YTYxZlxcdWE2MmFcXHVhNjJiXFx1YTY0MC1cXHVhNjZlXFx1YTY3Zi1cXHVhNjk3XFx1YTZhMC1cXHVhNmVmXFx1YTcxNy1cXHVhNzFmXFx1YTcyMi1cXHVhNzg4XFx1YTc4Yi1cXHVhNzhlXFx1YTc5MC1cXHVhNzkzXFx1YTdhMC1cXHVhN2FhXFx1YTdmOC1cXHVhODAxXFx1YTgwMy1cXHVhODA1XFx1YTgwNy1cXHVhODBhXFx1YTgwYy1cXHVhODIyXFx1YTg0MC1cXHVhODczXFx1YTg4Mi1cXHVhOGIzXFx1YThmMi1cXHVhOGY3XFx1YThmYlxcdWE5MGEtXFx1YTkyNVxcdWE5MzAtXFx1YTk0NlxcdWE5NjAtXFx1YTk3Y1xcdWE5ODQtXFx1YTliMlxcdWE5Y2ZcXHVhYTAwLVxcdWFhMjhcXHVhYTQwLVxcdWFhNDJcXHVhYTQ0LVxcdWFhNGJcXHVhYTYwLVxcdWFhNzZcXHVhYTdhXFx1YWE4MC1cXHVhYWFmXFx1YWFiMVxcdWFhYjVcXHVhYWI2XFx1YWFiOS1cXHVhYWJkXFx1YWFjMFxcdWFhYzJcXHVhYWRiLVxcdWFhZGRcXHVhYWUwLVxcdWFhZWFcXHVhYWYyLVxcdWFhZjRcXHVhYjAxLVxcdWFiMDZcXHVhYjA5LVxcdWFiMGVcXHVhYjExLVxcdWFiMTZcXHVhYjIwLVxcdWFiMjZcXHVhYjI4LVxcdWFiMmVcXHVhYmMwLVxcdWFiZTJcXHVhYzAwLVxcdWQ3YTNcXHVkN2IwLVxcdWQ3YzZcXHVkN2NiLVxcdWQ3ZmJcXHVmOTAwLVxcdWZhNmRcXHVmYTcwLVxcdWZhZDlcXHVmYjAwLVxcdWZiMDZcXHVmYjEzLVxcdWZiMTdcXHVmYjFkXFx1ZmIxZi1cXHVmYjI4XFx1ZmIyYS1cXHVmYjM2XFx1ZmIzOC1cXHVmYjNjXFx1ZmIzZVxcdWZiNDBcXHVmYjQxXFx1ZmI0M1xcdWZiNDRcXHVmYjQ2LVxcdWZiYjFcXHVmYmQzLVxcdWZkM2RcXHVmZDUwLVxcdWZkOGZcXHVmZDkyLVxcdWZkYzdcXHVmZGYwLVxcdWZkZmJcXHVmZTcwLVxcdWZlNzRcXHVmZTc2LVxcdWZlZmNcXHVmZjIxLVxcdWZmM2FcXHVmZjQxLVxcdWZmNWFcXHVmZjY2LVxcdWZmYmVcXHVmZmMyLVxcdWZmYzdcXHVmZmNhLVxcdWZmY2ZcXHVmZmQyLVxcdWZmZDdcXHVmZmRhLVxcdWZmZGMwLTlcXHUwMzAwLVxcdTAzNmZcXHUwNDgzLVxcdTA0ODdcXHUwNTkxLVxcdTA1YmRcXHUwNWJmXFx1MDVjMVxcdTA1YzJcXHUwNWM0XFx1MDVjNVxcdTA1YzdcXHUwNjEwLVxcdTA2MWFcXHUwNjRiLVxcdTA2NjlcXHUwNjcwXFx1MDZkNi1cXHUwNmRjXFx1MDZkZi1cXHUwNmU0XFx1MDZlN1xcdTA2ZThcXHUwNmVhLVxcdTA2ZWRcXHUwNmYwLVxcdTA2ZjlcXHUwNzExXFx1MDczMC1cXHUwNzRhXFx1MDdhNi1cXHUwN2IwXFx1MDdjMC1cXHUwN2M5XFx1MDdlYi1cXHUwN2YzXFx1MDgxNi1cXHUwODE5XFx1MDgxYi1cXHUwODIzXFx1MDgyNS1cXHUwODI3XFx1MDgyOS1cXHUwODJkXFx1MDg1OS1cXHUwODViXFx1MDhlNC1cXHUwOGZlXFx1MDkwMC1cXHUwOTAzXFx1MDkzYS1cXHUwOTNjXFx1MDkzZS1cXHUwOTRmXFx1MDk1MS1cXHUwOTU3XFx1MDk2MlxcdTA5NjNcXHUwOTY2LVxcdTA5NmZcXHUwOTgxLVxcdTA5ODNcXHUwOWJjXFx1MDliZS1cXHUwOWM0XFx1MDljN1xcdTA5YzhcXHUwOWNiLVxcdTA5Y2RcXHUwOWQ3XFx1MDllMlxcdTA5ZTNcXHUwOWU2LVxcdTA5ZWZcXHUwYTAxLVxcdTBhMDNcXHUwYTNjXFx1MGEzZS1cXHUwYTQyXFx1MGE0N1xcdTBhNDhcXHUwYTRiLVxcdTBhNGRcXHUwYTUxXFx1MGE2Ni1cXHUwYTcxXFx1MGE3NVxcdTBhODEtXFx1MGE4M1xcdTBhYmNcXHUwYWJlLVxcdTBhYzVcXHUwYWM3LVxcdTBhYzlcXHUwYWNiLVxcdTBhY2RcXHUwYWUyXFx1MGFlM1xcdTBhZTYtXFx1MGFlZlxcdTBiMDEtXFx1MGIwM1xcdTBiM2NcXHUwYjNlLVxcdTBiNDRcXHUwYjQ3XFx1MGI0OFxcdTBiNGItXFx1MGI0ZFxcdTBiNTZcXHUwYjU3XFx1MGI2MlxcdTBiNjNcXHUwYjY2LVxcdTBiNmZcXHUwYjgyXFx1MGJiZS1cXHUwYmMyXFx1MGJjNi1cXHUwYmM4XFx1MGJjYS1cXHUwYmNkXFx1MGJkN1xcdTBiZTYtXFx1MGJlZlxcdTBjMDEtXFx1MGMwM1xcdTBjM2UtXFx1MGM0NFxcdTBjNDYtXFx1MGM0OFxcdTBjNGEtXFx1MGM0ZFxcdTBjNTVcXHUwYzU2XFx1MGM2MlxcdTBjNjNcXHUwYzY2LVxcdTBjNmZcXHUwYzgyXFx1MGM4M1xcdTBjYmNcXHUwY2JlLVxcdTBjYzRcXHUwY2M2LVxcdTBjYzhcXHUwY2NhLVxcdTBjY2RcXHUwY2Q1XFx1MGNkNlxcdTBjZTJcXHUwY2UzXFx1MGNlNi1cXHUwY2VmXFx1MGQwMlxcdTBkMDNcXHUwZDNlLVxcdTBkNDRcXHUwZDQ2LVxcdTBkNDhcXHUwZDRhLVxcdTBkNGRcXHUwZDU3XFx1MGQ2MlxcdTBkNjNcXHUwZDY2LVxcdTBkNmZcXHUwZDgyXFx1MGQ4M1xcdTBkY2FcXHUwZGNmLVxcdTBkZDRcXHUwZGQ2XFx1MGRkOC1cXHUwZGRmXFx1MGRmMlxcdTBkZjNcXHUwZTMxXFx1MGUzNC1cXHUwZTNhXFx1MGU0Ny1cXHUwZTRlXFx1MGU1MC1cXHUwZTU5XFx1MGViMVxcdTBlYjQtXFx1MGViOVxcdTBlYmJcXHUwZWJjXFx1MGVjOC1cXHUwZWNkXFx1MGVkMC1cXHUwZWQ5XFx1MGYxOFxcdTBmMTlcXHUwZjIwLVxcdTBmMjlcXHUwZjM1XFx1MGYzN1xcdTBmMzlcXHUwZjNlXFx1MGYzZlxcdTBmNzEtXFx1MGY4NFxcdTBmODZcXHUwZjg3XFx1MGY4ZC1cXHUwZjk3XFx1MGY5OS1cXHUwZmJjXFx1MGZjNlxcdTEwMmItXFx1MTAzZVxcdTEwNDAtXFx1MTA0OVxcdTEwNTYtXFx1MTA1OVxcdTEwNWUtXFx1MTA2MFxcdTEwNjItXFx1MTA2NFxcdTEwNjctXFx1MTA2ZFxcdTEwNzEtXFx1MTA3NFxcdTEwODItXFx1MTA4ZFxcdTEwOGYtXFx1MTA5ZFxcdTEzNWQtXFx1MTM1ZlxcdTE3MTItXFx1MTcxNFxcdTE3MzItXFx1MTczNFxcdTE3NTJcXHUxNzUzXFx1MTc3MlxcdTE3NzNcXHUxN2I0LVxcdTE3ZDNcXHUxN2RkXFx1MTdlMC1cXHUxN2U5XFx1MTgwYi1cXHUxODBkXFx1MTgxMC1cXHUxODE5XFx1MThhOVxcdTE5MjAtXFx1MTkyYlxcdTE5MzAtXFx1MTkzYlxcdTE5NDYtXFx1MTk0ZlxcdTE5YjAtXFx1MTljMFxcdTE5YzhcXHUxOWM5XFx1MTlkMC1cXHUxOWQ5XFx1MWExNy1cXHUxYTFiXFx1MWE1NS1cXHUxYTVlXFx1MWE2MC1cXHUxYTdjXFx1MWE3Zi1cXHUxYTg5XFx1MWE5MC1cXHUxYTk5XFx1MWIwMC1cXHUxYjA0XFx1MWIzNC1cXHUxYjQ0XFx1MWI1MC1cXHUxYjU5XFx1MWI2Yi1cXHUxYjczXFx1MWI4MC1cXHUxYjgyXFx1MWJhMS1cXHUxYmFkXFx1MWJiMC1cXHUxYmI5XFx1MWJlNi1cXHUxYmYzXFx1MWMyNC1cXHUxYzM3XFx1MWM0MC1cXHUxYzQ5XFx1MWM1MC1cXHUxYzU5XFx1MWNkMC1cXHUxY2QyXFx1MWNkNC1cXHUxY2U4XFx1MWNlZFxcdTFjZjItXFx1MWNmNFxcdTFkYzAtXFx1MWRlNlxcdTFkZmMtXFx1MWRmZlxcdTIwMGNcXHUyMDBkXFx1MjAzZlxcdTIwNDBcXHUyMDU0XFx1MjBkMC1cXHUyMGRjXFx1MjBlMVxcdTIwZTUtXFx1MjBmMFxcdTJjZWYtXFx1MmNmMVxcdTJkN2ZcXHUyZGUwLVxcdTJkZmZcXHUzMDJhLVxcdTMwMmZcXHUzMDk5XFx1MzA5YVxcdWE2MjAtXFx1YTYyOVxcdWE2NmZcXHVhNjc0LVxcdWE2N2RcXHVhNjlmXFx1YTZmMFxcdWE2ZjFcXHVhODAyXFx1YTgwNlxcdWE4MGJcXHVhODIzLVxcdWE4MjdcXHVhODgwXFx1YTg4MVxcdWE4YjQtXFx1YThjNFxcdWE4ZDAtXFx1YThkOVxcdWE4ZTAtXFx1YThmMVxcdWE5MDAtXFx1YTkwOVxcdWE5MjYtXFx1YTkyZFxcdWE5NDctXFx1YTk1M1xcdWE5ODAtXFx1YTk4M1xcdWE5YjMtXFx1YTljMFxcdWE5ZDAtXFx1YTlkOVxcdWFhMjktXFx1YWEzNlxcdWFhNDNcXHVhYTRjXFx1YWE0ZFxcdWFhNTAtXFx1YWE1OVxcdWFhN2JcXHVhYWIwXFx1YWFiMi1cXHVhYWI0XFx1YWFiN1xcdWFhYjhcXHVhYWJlXFx1YWFiZlxcdWFhYzFcXHVhYWViLVxcdWFhZWZcXHVhYWY1XFx1YWFmNlxcdWFiZTMtXFx1YWJlYVxcdWFiZWNcXHVhYmVkXFx1YWJmMC1cXHVhYmY5XFx1ZmIxZVxcdWZlMDAtXFx1ZmUwZlxcdWZlMjAtXFx1ZmUyNlxcdWZlMzNcXHVmZTM0XFx1ZmU0ZC1cXHVmZTRmXFx1ZmYxMC1cXHVmZjE5XFx1ZmYzZl0qL2dpKTtcbiAgfSxcbiAgZXZhbEluQ29udGV4dDogZnVuY3Rpb24gKGpzKSB7XG4gICAganMgPSBqcy5yZXBsYWNlKC9cXHMrL2csICcnKTtcblxuXG4gICAgdmFyIGtleXMgPSBbXSwgdmFsdWVzID0gW107XG5cbiAgICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykge1xuICAgICAga2V5cyA9IGtleXMuY29uY2F0KE9iamVjdC5rZXlzKGFyZ3VtZW50c1tpXSkpO1xuICAgICAgZm9yICh2YXIgaiBpbiBhcmd1bWVudHNbaV0pIHtcbiAgICAgICAgdmFsdWVzLnB1c2goYXJndW1lbnRzW2ldW2pdKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvL1xuICAgIC8vaWYoXy5pc0NvcnJlY3RWYXJpYWJsZU5hbWUoanMpICYmIGtleXMuaW5kZXhPZihqcykgPT09IC0xKXtcbiAgICAvLyAga2V5cy5wdXNoKGpzKTtcbiAgICAvLyAgdmFsdWVzLnB1c2godW5kZWZpbmVkKTtcbiAgICAvL31cblxuICAgIHZhciBhcnIgPSB1dGlscy5leHRyYWN0VmFyaWFibGVzKGpzKTtcbiAgICAvL2NvbnNvbGUubG9nKGFycik7XG4gICAgZm9yICh2YXIgaSBpbiBhcnIpIHtcbiAgICAgIGlmIChrZXlzLmluZGV4T2YoYXJyW2ldKSA9PT0gLTEpIHtcbiAgICAgICAga2V5cy5wdXNoKGFycltpXSk7XG4gICAgICAgIHZhbHVlcy5wdXNoKHVuZGVmaW5lZCk7XG4gICAgICB9XG4gICAgfVxuICAgIGpzID0gXCJ2YXIgZm9vID0gZnVuY3Rpb24oXCIgKyBrZXlzLmpvaW4oXCIsXCIpICsgXCIpeyB2YXIgX19yZXR1cm5fX3ZhbHVlID0gXCIgKyBqcyArIFwiIDtyZXR1cm4gX19yZXR1cm5fX3ZhbHVlO307IGZvbztcIjtcbiAgICB0cnkge1xuICAgICAgdmFyIGZvbyA9IGV2YWwoanMpO1xuICAgICAgcmV0dXJuIGZvby5hcHBseSh0aGlzLCB2YWx1ZXMpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gIH0sXG4gIGNvbXBpbGVFbGVtZW50OiBmdW5jdGlvbiAoJGl0ZW0sIHNjb3BlKSB7XG5cbiAgICBmdW5jdGlvbiBfZWFjaFNlbGYoZWwsIHNlbGVjdG9yLCBmb28pIHtcbiAgICAgIGVsLmZpbmQoc2VsZWN0b3IpLmVhY2goZm9vKTtcbiAgICAgIGlmIChlbC5pcyhzZWxlY3RvcikpIHtcbiAgICAgICAgZm9vLmNhbGwoZWxbMF0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vLmFkZEJhY2soJ3NlbGVjdG9yJylcbiAgICBfZWFjaFNlbGYoJGl0ZW0sIFwiW29uY2xpY2tdXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBvbkNsaWNrID0gJCh0aGlzKS5hdHRyKFwib25jbGlja1wiKTtcbiAgICAgICQodGhpcykucmVtb3ZlQXR0cihcIm9uY2xpY2tcIik7XG4gICAgICAkKHRoaXMpLmNsaWNrKGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICB1dGlscy5ldmFsSW5Db250ZXh0KG9uQ2xpY2ssIHNjb3BlLCB7ZXZlbnQ6IGV2ZW50fSk7XG4gICAgICB9KVxuICAgIH0pXG5cblxuICAgIF9lYWNoU2VsZigkaXRlbSwgXCJbb25jaGFuZ2VdXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBvbkNoYW5nZSA9ICQodGhpcykuYXR0cihcIm9uY2hhbmdlXCIpO1xuICAgICAgJCh0aGlzKS5yZW1vdmVBdHRyKFwib25jaGFuZ2VcIik7XG4gICAgICAkKHRoaXMpLmNoYW5nZShmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgdXRpbHMuZXZhbEluQ29udGV4dChvbkNoYW5nZSwgc2NvcGUsIHtldmVudDogZXZlbnR9KTtcbiAgICAgIH0pXG4gICAgfSk7XG5cbiAgICBfZWFjaFNlbGYoJGl0ZW0sIFwiW2RwLWNoZWNrZWRdXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBfdmFsID0gJCh0aGlzKS5hdHRyKFwiZHAtY2hlY2tlZFwiKTtcbiAgICAgIHZhciB2YWwgPSB1dGlscy5ldmFsSW5Db250ZXh0KF92YWwsIHNjb3BlKTtcbiAgICAgIGlmICh2YWwpIHtcbiAgICAgICAgJCh0aGlzKS5hdHRyKFwiY2hlY2tlZFwiLCBcImNoZWNrZWRcIik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAkKHRoaXMpLnJlbW92ZUF0dHIoXCJjaGVja2VkXCIpO1xuICAgICAgfVxuXG4gICAgfSk7XG4gICAgX2VhY2hTZWxmKCRpdGVtLCBcIltkcC1zcmNdXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBfdmFsID0gJCh0aGlzKS5hdHRyKFwiZHAtc3JjXCIpO1xuICAgICAgdmFyIHZhbCA9IHV0aWxzLmV2YWxJbkNvbnRleHQoX3ZhbCwgc2NvcGUpO1xuICAgICAgaWYgKHZhbCkge1xuICAgICAgICAkKHRoaXMpLmF0dHIoXCJzcmNcIiwgdmFsKTtcbiAgICAgIH1cblxuICAgIH0pO1xuICAgIF9lYWNoU2VsZigkaXRlbSwgXCJbZHAtaWZdXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBfdmFsID0gJCh0aGlzKS5hdHRyKFwiZHAtaWZcIik7XG4gICAgICBpZiAoX3ZhbCA9PT0gXCJmYWxzZVwiKSB7XG4gICAgICAgICQodGhpcykucmVtb3ZlKCk7XG4gICAgICB9XG4gICAgICBpZiAoX3ZhbCA9PT0gXCJ0cnVlXCIpIHtcblxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIHZhbCA9IHV0aWxzLmV2YWxJbkNvbnRleHQoX3ZhbCwgc2NvcGUpO1xuICAgICAgICBpZiAoIXZhbCkge1xuICAgICAgICAgICQodGhpcykucmVtb3ZlKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgICBfZWFjaFNlbGYoJGl0ZW0sIFwiW2RwLWluY2x1ZGVdXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBfZWwgPSAkKHRoaXMpO1xuICAgICAgdmFyIF92YWwgPSBfZWwuYXR0cihcImRwLWluY2x1ZGVcIik7XG4gICAgICB2YXIgdmFsID0gdXRpbHMuZXZhbEluQ29udGV4dChfdmFsLCBzY29wZSk7XG4gICAgICBfZWwubG9hZCh2YWwpO1xuICAgIH0pO1xuICB9LFxuICBwYXJzZVRlbXBsYXRlOiBmdW5jdGlvbiAodHBsLCBzY29wZSkge1xuICAgIHZhciAkaXRlbSA9ICQodHBsLmZvcm1hdChzY29wZSkpO1xuICAgIF8uY29tcGlsZUVsZW1lbnQoJGl0ZW0sIHNjb3BlKTtcbiAgICByZXR1cm4gJGl0ZW07XG4gIH1cbn07XG5pZih0eXBlb2YgbW9kdWxlICE9PSBcInVuZGVmaW5lZFwiKXtcbiAgbW9kdWxlLmV4cG9ydHMgPSB1dGlscztcbn1cblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvdXRpbC9jb21waWxlLmpzIiwiXG52YXIgRXh0Q2FudmFzTWl4aW4gPSB7XG4gIGRlZmF1bHRPcHRpb25zOiB7fSxcbiAgYW5pbWF0ZWQ6IGZhbHNlLFxuICBmaXRJbmRleDogMC44LFxuICAvKipcbiAgICogcmVxdWlyZWQgdG8gc2hvdyB2aWRlb1xuICAgKi9cbiAgc2V0QW5pbWF0ZWQ6IGZ1bmN0aW9uICh2YWwpIHtcbiAgICBpZighdmFsKXtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBmYWJyaWMudXRpbC5yZXF1ZXN0QW5pbUZyYW1lKGZ1bmN0aW9uIHJlbmRlcigpIHtcbiAgICAgIHRoaXMucmVuZGVyQWxsKCk7XG4gICAgICBmYWJyaWMudXRpbC5yZXF1ZXN0QW5pbUZyYW1lKHJlbmRlcik7XG4gICAgfS5iaW5kKHRoaXMpKTtcbiAgfSxcbiAgZmluZDogZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICBpZiAodHlwZW9mIG9wdGlvbnMgPT09IFwic3RyaW5nXCIpe1xuICAgICAgb3B0aW9ucyA9IHtcbiAgICAgICAgdHlwZTogb3B0aW9uc1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZmFicmljLnV0aWwub2JqZWN0LndoZXJlKHRoaXMuX29iamVjdHMsb3B0aW9ucyk7XG4gIH0sXG4gIF91cGRhdGVfYmFja2dyb3VuZF9pbWFnZTogZnVuY3Rpb24gKCkge1xuICAgIHZhciBwaG90byA9IHRoaXMuYmFja2dyb3VuZEltYWdlO1xuICAgIGlmICghcGhvdG8gfHwgcGhvdG8uY29uc3RydWN0b3IgPT0gT2JqZWN0IHx8IHBob3RvLmNvbnN0cnVjdG9yID09IFN0cmluZykgcmV0dXJuO1xuXG4gICAgaWYgKHRoaXMuYmFja2dyb3VuZFBvc2l0aW9uID09PSAncmVzaXplJykge1xuICAgICAgdGhpcy5vcmlnaW5hbFdpZHRoID0gcGhvdG8ud2lkdGg7XG4gICAgICB0aGlzLm9yaWdpbmFsSGVpZ2h0ID0gcGhvdG8uaGVpZ2h0O1xuXG4gICAgfWVsc2UgaWYgKHRoaXMuYmFja2dyb3VuZFBvc2l0aW9uICE9PSAnbWFudWFsJykge1xuXG4gICAgICB2YXIgX3cgID0gIHRoaXMub3JpZ2luYWxXaWR0aCB8fCB0aGlzLndpZHRoLCAgX2ggPSB0aGlzLm9yaWdpbmFsSGVpZ2h0IHx8IHRoaXMuaGVpZ2h0O1xuXG4gICAgICBpZihwaG90by5fb3JpZ2luYWxFbGVtZW50KXtcbiAgICAgICAgdmFyIHNpemUgPSBmYWJyaWMudXRpbC5nZXRQcm9wb3J0aW9ucyhwaG90by5fb3JpZ2luYWxFbGVtZW50LCB7XG4gICAgICAgICAgd2lkdGg6IF93LFxuICAgICAgICAgIGhlaWdodDogX2hcbiAgICAgICAgfSwgdGhpcy5iYWNrZ3JvdW5kUG9zaXRpb24pO1xuICAgICAgfWVsc2V7XG4gICAgICAgIHNpemUgPSB7XG4gICAgICAgICAgd2lkdGg6IF93LFxuICAgICAgICAgIGhlaWdodDogX2hcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICB2YXIgX2wgO1xuICAgICAgaWYodGhpcy5iYWNrZ3JvdW5kSW1hZ2Uub3JpZ2luWCA9PSAnY2VudGVyJyl7XG4gICAgICAgIF9sID0gX3cgLyAyO1xuICAgICAgfWVsc2V7XG4gICAgICAgIF9sID0gKF93IC0gc2l6ZS53aWR0aCkgLyAyIDtcbiAgICAgIH1cbiAgICAgIHZhciBfdCA7XG4gICAgICBpZih0aGlzLmJhY2tncm91bmRJbWFnZS5vcmlnaW5ZID09ICdjZW50ZXInKXtcbiAgICAgICAgX3QgPSBfaCAvIDI7XG4gICAgICB9ZWxzZXtcbiAgICAgICAgX3QgPSAoX2ggLSBzaXplLmhlaWdodCkgLyAyIDtcbiAgICAgIH1cblxuICAgICAgdGhpcy5iYWNrZ3JvdW5kSW1hZ2Uuc2V0KHtcbiAgICAgICAgbGVmdDogX2wgKyB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzRdLFxuICAgICAgICB0b3A6ICBfdCArIHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bNV0sXG4gICAgICAgIHdpZHRoOiBzaXplLndpZHRoLFxuICAgICAgICBoZWlnaHQ6IHNpemUuaGVpZ2h0XG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gdmFyIF9vcmlnID0gdGhpcy5iYWNrZ3JvdW5kSW1hZ2UuZ2V0T3JpZ2luYWxTaXplKCk7XG4gICAgICAvLyB0aGlzLmJhY2tncm91bmRJbWFnZS5zZXQoe1xuICAgICAgLy8gICBvcmlnaW5YOiAnbGVmdCcsXG4gICAgICAvLyAgIG9yaWdpblk6ICd0b3AnLFxuICAgICAgLy8gICBsZWZ0OiAwLCAvL3RoaXMudmlld3BvcnRUcmFuc2Zvcm1bNF0sXG4gICAgICAvLyAgIHRvcDogMCwgLy90aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzVdLFxuICAgICAgLy8gICB3aWR0aDogX29yaWcud2lkdGgsXG4gICAgICAvLyAgIGhlaWdodDogX29yaWcuaGVpZ2h0XG4gICAgICAvLyB9KTtcbiAgICB9XG4gIH0sXG4gIHNldEJhY2tncm91bmRJbWFnZTogZnVuY3Rpb24gKGJnLCBjYWxsYmFjaykge1xuICAgIHZhciBfYmdpbWFnZUxvYWRlZCA9IGZ1bmN0aW9uIChlbCl7XG5cbiAgICAgIGlmKHRoaXMubG9hZGVkKSB7XG4gICAgICAgIHZhciBvcmlnaW5hbFN0YXRlID0ge2JhY2tncm91bmRJbWFnZTogdGhpcy5iYWNrZ3JvdW5kSW1hZ2V9O1xuICAgICAgfVxuXG4gICAgICB0aGlzLmJhY2tncm91bmRJbWFnZSA9IGVsO1xuICAgICAgdGhpcy5iYWNrZ3JvdW5kSW1hZ2UuY2FudmFzID0gdGhpcztcbiAgICAgIHRoaXMuX3VwZGF0ZV9iYWNrZ3JvdW5kX2ltYWdlKCk7XG4gICAgICBpZih0aGlzLmJhY2tncm91bmRQb3NpdGlvbiA9PT0gXCJyZXNpemVcIil7XG4gICAgICAgIHRoaXMub3JpZ2luYWxXaWR0aCA9IGVsLndpZHRoO1xuICAgICAgICB0aGlzLm9yaWdpbmFsSGVpZ2h0ID0gZWwuaGVpZ2h0O1xuICAgICAgfVxuXG4gICAgICBpZih0aGlzLmxvYWRlZCl7XG4gICAgICAgIHRoaXMuZmlyZSgnbW9kaWZpZWQnLHtzdGF0ZXM6IHtcbiAgICAgICAgICBvcmlnaW5hbDogb3JpZ2luYWxTdGF0ZSxcbiAgICAgICAgICBtb2RpZmllZDoge2JhY2tncm91bmRJbWFnZTogdGhpcy5iYWNrZ3JvdW5kSW1hZ2V9XG4gICAgICAgIH19KTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5maXJlKFwiYmFja2dyb3VuZC1pbWFnZTpsb2FkZWRcIix7dGFyZ2V0OiBlbH0pO1xuICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2soKTtcbiAgICB9XG5cblxuICAgIGlmICghYmcpIHtcbiAgICAgIHRoaXMuYmFja2dyb3VuZEltYWdlID0gbnVsbDtcbiAgICAgIHJldHVybiBjYWxsYmFjaygpO1xuICAgIH1cbiAgICBpZiAoYmcgaW5zdGFuY2VvZiBIVE1MSW1hZ2VFbGVtZW50IHx8IGJnIGluc3RhbmNlb2YgSW1hZ2Upe1xuXG4gICAgICB2YXIgZWwgPSBuZXcgZmFicmljLkltYWdlKGJnLHtcbiAgICAgICAgd2lkdGg6IGJnLm5hdHVyYWxXaWR0aCxcbiAgICAgICAgaGVpZ2h0OiBiZy5uYXR1cmFsSGVpZ2h0XG4gICAgICB9KTtcblxuICAgICAgX2JnaW1hZ2VMb2FkZWQuY2FsbCh0aGlzLGVsKTtcbiAgICB9XG4gICAgaWYgKGJnLmNvbnN0cnVjdG9yID09IFN0cmluZykge1xuICAgICAgYmcgPSB7XG4gICAgICAgIHNyYzogYmdcbiAgICAgIH1cbiAgICB9XG4gICAgdmFyIF9wcm90byA9IHRoaXMuYXBwbGljYXRpb24ucHJvdG90eXBlcztcbiAgICBpZihfcHJvdG8gJiYgX3Byb3RvLlNsaWRlQ2FudmFzICYmIF9wcm90by5TbGlkZUNhbnZhcy5iYWNrZ3JvdW5kSW1hZ2VQcm9wZXJ0aWVzKXtcbiAgICAgIGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoYmcsX3Byb3RvLlNsaWRlQ2FudmFzLmJhY2tncm91bmRJbWFnZVByb3BlcnRpZXMpO1xuICAgIH1cbiAgICBiZy5hcHBsaWNhdGlvbiA9IHRoaXMuYXBwbGljYXRpb247XG4gICAgYmcudHlwZSA9IGJnLnR5cGUgfHwgXCJpbWFnZVwiO1xuICAgIC8vIGJnLndpZHRoID0gYmcubmF0dXJhbFdpZHRoO1xuICAgIC8vIGJnLmhlaWdodCA9IGJnLm5hdHVyYWxIZWlnaHQ7XG4gICAgLy9cbiAgICBmYWJyaWMudXRpbC5jcmVhdGVPYmplY3QoYmcsX2JnaW1hZ2VMb2FkZWQuYmluZCh0aGlzKSk7XG4gIH0sXG4gIGNyZWF0ZU9iamVjdHM6IGZ1bmN0aW9uKG9iamVjdHMsY2FsbGJhY2spe1xuXG4gICAgaWYodGhpcy5hcHBsaWNhdGlvbil7XG4gICAgICBmb3IodmFyIGkgaW4gb2JqZWN0cyl7XG4gICAgICAgIGlmKG9iamVjdHNbaV0uY29uc3RydWN0b3IgPT0gU3RyaW5nKXtcbiAgICAgICAgICBvYmplY3RzW2ldID0gdGhpcy5hcHBsaWNhdGlvbi5vYmplY3RzW29iamVjdHNbaV1dO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgdmFyIF9jYW52YXMgPSB0aGlzO1xuXG4gICAgZnVuY3Rpb24gc3VjY2Vzcyhfb2JqZWN0cykge1xuICAgICAgX2NhbnZhcy5maXJlKFwicHJvZ3Jlc3M6Y29tcGxldGVcIiwge29iamVjdHM6IG9iamVjdHN9KTtcbiAgICAgIGZvciAodmFyIGkgaW4gX29iamVjdHMpIHtcbiAgICAgICAgX2NhbnZhcy5hZGQoX29iamVjdHNbaV0pO1xuICAgICAgfVxuICAgICAgX2NhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrLmNhbGwoX2NhbnZhcylcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBwcm9ncmVzcyhsLCB0KSB7XG4gICAgICBfY2FudmFzLmZpcmUoXCJwcm9ncmVzc1wiLCB7IGxvYWRlZCA6IGwsIHRvdGFsIDogdCB9KTtcbiAgICAgIGlmIChmYWJyaWMudXRpbC5sb2FkZXJEZWJ1Zykge1xuICAgICAgICBjb25zb2xlLmxvZyhcImxvYWRlZCBcIiArIGwgKyBcIiAvIFwiICsgdCk7XG4gICAgICB9XG4gICAgfVxuXG5cbiAgICB2YXIgX29iamVjdHMgPSBbXTtcbiAgICBpZiAoIW9iamVjdHMgfHwgIW9iamVjdHMubGVuZ3RoKSB7XG4gICAgICBzdWNjZXNzKF9vYmplY3RzKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZihvYmplY3RzWzBdLmNvbnN0cnVjdG9yLm5hbWUgPT09IFwia2xhc3NcIil7XG4gICAgICBzdWNjZXNzKG9iamVjdHMpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuXG4gICAgdmFyIHF1ZXVlTG9hZENhbGxiYWNrID0gZmFicmljLnV0aWwucXVldWVMb2FkKG9iamVjdHMubGVuZ3RoLCBmdW5jdGlvbigpe1xuICAgICAgc3VjY2VzcyhmYWJyaWMudXRpbC5vYmplY3QucGx1Y2soX29iamVjdHMsXCJvYmplY3RcIikpO1xuICAgIH0sIHByb2dyZXNzKTtcblxuICAgIHF1ZXVlTG9hZENhbGxiYWNrLmRhdGEgPSAodGhpcy50aXRsZSB8fCBcIlwiKSArIFwib2JqZWN0c1wiO1xuXG5cbiAgICBmb3IgKHZhciBpIGluIG9iamVjdHMpIHtcbiAgICAgIChmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICB2YXIgX29iamVjdF9zbG90ID0ge29iamVjdDogbnVsbCwgb3B0aW9uczogb3B0aW9uc307XG4gICAgICAgIF9vYmplY3RzLnB1c2goX29iamVjdF9zbG90KTtcblxuICAgICAgICBvcHRpb25zLmFwcGxpY2F0aW9uID0gX2NhbnZhcy5hcHBsaWNhdGlvbjtcbiAgICAgICAgZmFicmljLnV0aWwuY3JlYXRlT2JqZWN0KG9wdGlvbnMsIGZ1bmN0aW9uIChlbCkge1xuICAgICAgICAgIF9vYmplY3Rfc2xvdC5vYmplY3QgPSBlbDtcbiAgICAgICAgICBxdWV1ZUxvYWRDYWxsYmFjaygpO1xuICAgICAgICB9KTtcbiAgICAgIH0pLmNhbGwodGhpcywgb2JqZWN0c1tpXSk7XG4gICAgfVxuICB9LFxuICAvKipcbiAgICogYXBwbHkgb3B0aW9ucyBmb3IgZ3JvdXAgb2YgZmlsdGVyZWQgb2JqZWN0c1xuICAgKiBAcGFyYW0gZmlsdGVyXG4gICAqIEBwYXJhbSBvcHRpb25zXG4gICAqL1xuICBhcHBseU9wdGlvbnM6IGZ1bmN0aW9uKGZpbHRlcixvcHRpb25zKXtcbiAgICB0aGlzLl9vYmplY3RzLmZvckVhY2goZnVuY3Rpb24oX29iail7XG4gICAgICBmb3IodmFyIHByb3AgaW4gZmlsdGVyKXtcbiAgICAgICAgaWYoX29ialtwcm9wXSAhPT0gIGZpbHRlcltwcm9wXSlyZXR1cm47XG4gICAgICB9XG4gICAgICBfb2JqLnNldE9wdGlvbnMob3B0aW9ucyk7XG4gICAgfSlcbiAgfSxcbiAgLyoqXG4gICAqIENyZWF0ZSBPYmplY3QgYnkgdHlwZSBhbmQgb3B0aW9uc1xuICAgKiBAcGFyYW0gdHlwZVxuICAgKiBAcGFyYW0gb3B0aW9uc1xuICAgKiBAcGFyYW0gY2FsbGJhY2tcbiAgICovXG4gIGNyZWF0ZU9iamVjdDogZnVuY3Rpb24gKHR5cGUsIG9wdGlvbnMsY2FsbGJhY2spIHtcbiAgICBpZih0eXBlb2YgdHlwZSAhPT0gXCJzdHJpbmdcIil7XG4gICAgICBjYWxsYmFjayA9IG9wdGlvbnM7XG4gICAgICBvcHRpb25zID0gZmFicmljLnV0aWwub2JqZWN0LmNsb25lKHR5cGUpO1xuICAgICAgdHlwZSA9IG51bGw7XG4gICAgfWVsc2V7XG4gICAgICBvcHRpb25zID0gZmFicmljLnV0aWwub2JqZWN0LmNsb25lKG9wdGlvbnMpO1xuICAgICAgb3B0aW9ucy50eXBlID0gdHlwZTtcbiAgICB9XG5cbiAgICB2YXIgX3NlbGYgPSB0aGlzO1xuICAgIG9wdGlvbnMuYXBwbGljYXRpb24gPSB0aGlzLmFwcGxpY2F0aW9uO1xuICAgLy8gdmFyIF9hY3RpdmUgPSBvcHRpb25zLmFjdGl2ZTtcbiAgIC8vIHZhciBfcG9zaXRpb24gPSBvcHRpb25zLnBvc2l0aW9uO1xuLy8gICAgZGVsZXRlIG9wdGlvbnMuYWN0aXZlO1xuICAvLyAgZGVsZXRlIG9wdGlvbnMucG9zaXRpb247XG5cblxuICAgIGZ1bmN0aW9uIF9hZGQoZWwpIHtcbiAgICAgIGlmKGVsLmNhbnZhcylyZXR1cm47XG4gICAgICBfc2VsZi5hZGQoZWwpO1xuLypcbiAgICAgIGlmKF9hY3RpdmUpe1xuICAgICAgaWYoX2FjdGl2ZSl7XG4gICAgICAgIF9zZWxmLnNldEFjdGl2ZU9iamVjdChlbCk7XG4gICAgICB9Ki9cbiAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKGVsKTtcbiAgICB9XG5cbiAgICB2YXIgZWwgPSBmYWJyaWMudXRpbC5jcmVhdGVPYmplY3Qob3B0aW9ucywgX2FkZCApO1xuICAgIGVsICYmIF9hZGQoZWwpO1xuICAgIHJldHVybiBlbDtcbiAgfSxcbiAgb25Mb2FkOiBmdW5jdGlvbiAoY2FsbGJhY2spIHtcbiAgICB0aGlzLnByb2Nlc3NpbmcgPWZhbHNlO1xuICAgIHRoaXMubG9hZGVkID0gdHJ1ZTtcbiAgICB0aGlzLmZpcmUoXCJsb2FkaW5nOmVuZFwiLHt0eXBlOiBcInNsaWRlXCIsIHRhcmdldDogdGhpc30pO1xuICAgIHRoaXMucmVuZGVyQWxsKCk7XG4gICAgY2FsbGJhY2sgJiYgY2FsbGJhY2suY2FsbCh0aGlzKTtcbiAgfSxcbiAgbG9hZDogZnVuY3Rpb24gKG9wdGlvbnMsY2FsbGJhY2spIHtcbiAgICB0aGlzLm9yaWdpbmFsV2lkdGggPSAwO1xuICAgIHRoaXMub3JpZ2luYWxIZWlnaHQgPSAwO1xuXG5cbiAgICBpZih0aGlzLmFwcGxpY2F0aW9uLnByb3RvdHlwZXMuU2xpZGUpe1xuICAgICAgZmFicmljLnV0aWwub2JqZWN0LmRlZmF1bHRzKG9wdGlvbnMsdGhpcy5hcHBsaWNhdGlvbi5wcm90b3R5cGVzLlNsaWRlKTtcbiAgICB9XG5cblxuICAgIGlmICghb3B0aW9ucylyZXR1cm47XG5cbiAgICBpZighdGhpcy52aXJ0dWFsKXtcbiAgICAgIHRoaXMuY2xlYXIoKTtcbiAgICB9XG5cbiAgICBpZihvcHRpb25zLndpZHRoKXtcbiAgICAgIG9wdGlvbnMub3JpZ2luYWxXaWR0aCA9IG9wdGlvbnMud2lkdGg7XG4gICAgICBvcHRpb25zLm9yaWdpbmFsSGVpZ2h0ID0gb3B0aW9ucy5oZWlnaHQ7XG4gICAgfVxuXG4gICAgdGhpcy5wcm9jZXNzaW5nID0gdHJ1ZTtcbiAgICB0aGlzLmZpcmUoXCJsb2FkaW5nOmJlZ2luXCIse3R5cGU6IFwic2xpZGVcIiwgb3B0aW9uczogb3B0aW9uc30pO1xuXG4gICAgdGhpcy5zZXQob3B0aW9ucyx0aGlzLm9uTG9hZC5iaW5kKHRoaXMsY2FsbGJhY2spKTtcblxuXG4gICAgLy90b2RvXG4gICAgaWYodGhpcy5wbHVnaW5zKXtcbiAgICAgIHRoaXMucGx1Z2lucy5wcmVsb2FkZXJzLmZvckVhY2goZnVuY3Rpb24ocHJlbG9hZGVyKXtcbiAgICAgICAgcHJlbG9hZGVyLmNhbGwodGhpcywgb3B0aW9ucyk7XG4gICAgICAgIHRoaXMub25SZXNpemUoKTtcbiAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgfVxuXG5cbiAgfSxcbiAgc2V0T2JqZWN0czogZnVuY3Rpb24ob2JqZWN0cyxjYWxsYmFjayl7XG5cbiAgICB0aGlzLmNsZWFyKCk7XG4gICAgdGhpcy5jcmVhdGVPYmplY3RzKG9iamVjdHMsZnVuY3Rpb24oKXtcbiAgICAgIGZvcih2YXIgaSBpbiB0aGlzLl9vYmplY3RzKXtcbiAgICAgICAgdGhpcy5fb2JqZWN0c1tpXS5zZXRDb29yZHMoKTtcbiAgICAgIH1cbiAgICAgIGNhbGxiYWNrKCk7XG4gICAgfSk7XG4gIH0sXG4gIG9uUmVzaXplOiBmdW5jdGlvbigpe1xuICAgIHZhciBfc2NhbGUgPSBNYXRoLm1pbigxLDgwMCAvdGhpcy53aWR0aCApO1xuICAgIC8vIHRoaXMuc2V0Wm9vbShfc2NhbGUpO1xuICAgIHRoaXMuc2V0RGltZW5zaW9ucyh7d2lkdGg6IHRoaXMud2lkdGgsaGVpZ2h0OiB0aGlzLmhlaWdodH0pO1xuICB9LFxuICBnZXRDZW50ZXI6IGZ1bmN0aW9uIChlbCkge1xuICAgIHJldHVybiB7XG4gICAgICB0b3A6ICh0aGlzLm9yaWdpbmFsSGVpZ2h0ICB8fCB0aGlzLmdldEhlaWdodCgpKSAvIDIsXG4gICAgICBsZWZ0OiAodGhpcy5vcmlnaW5hbFdpZHRoIHx8IHRoaXMuZ2V0V2lkdGgoKSkgLyAyXG4gICAgfTtcbiAgfSxcbiAgc2V0T3JpZ2luYWxTaXplOiBmdW5jdGlvbiAodywgaCkge1xuICAgIHRoaXMub3JpZ2luYWxXaWR0aCA9IGggPyB3IDogKHcubmF0dXJhbFdpZHRoIHx8IHcud2lkdGgpO1xuICAgIHRoaXMub3JpZ2luYWxIZWlnaHQgPSBoID8gaCA6ICh3Lm5hdHVyYWxIZWlnaHQgfHwgdy5oZWlnaHQpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG59O1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5TdGF0aWNDYW52YXMucHJvdG90eXBlLEV4dENhbnZhc01peGluLHtcbiAgdHlwZTogXCJzbGlkZVwiLFxuICBvcHRpb25zT3JkZXI6IFtcIm9yaWdpbmFsV2lkdGhcIixcIm9yaWdpbmFsSGVpZ2h0XCIsXCJ3aWR0aFwiLFwiaGVpZ2h0XCIsXCIqXCJdLFxuICBfaW5pdEVudGl0eTogZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICBvcHRpb25zLmFwcGxpY2F0aW9uICYmIG9wdGlvbnMuYXBwbGljYXRpb24uZmlyZShcImVudGl0eTpjcmVhdGVkXCIsIHt0YXJnZXQ6IHRoaXMsIG9wdGlvbnM6IG9wdGlvbnN9KTtcbiAgfSxcbiAgX2xheWVyczogW1wiX29iamVjdHNcIixcIl9hcmVhc09iamVjdHNcIl0sXG4gIC8qKlxuICAgKiBSZW5kZXJzIGJhY2tncm91bmQsIG9iamVjdHMsIG92ZXJsYXkgYW5kIGNvbnRyb2xzLlxuICAgKiBAcGFyYW0ge0NhbnZhc1JlbmRlcmluZ0NvbnRleHQyRH0gY3R4XG4gICAqIEBwYXJhbSB7QXJyYXl9IG9iamVjdHMgdG8gcmVuZGVyXG4gICAqIEByZXR1cm4ge2ZhYnJpYy5DYW52YXN9IGluc3RhbmNlXG4gICAqIEBjaGFpbmFibGVcbiAgICovXG4gIHJlbmRlckNhbnZhczogZnVuY3Rpb24oY3R4LCBvYmplY3RzKSB7XG4gICAgdGhpcy5jbGVhckNvbnRleHQoY3R4KTtcbiAgICB0aGlzLmZpcmUoJ2JlZm9yZTpyZW5kZXInKTtcbiAgICBpZiAodGhpcy5jbGlwVG8pIHtcbiAgICAgIGZhYnJpYy51dGlsLmNsaXBDb250ZXh0KHRoaXMsIGN0eCk7XG4gICAgfVxuICAgIHRoaXMuX3JlbmRlckJhY2tncm91bmQoY3R4KTtcblxuICAgIGN0eC5zYXZlKCk7XG4gICAgLy9hcHBseSB2aWV3cG9ydCB0cmFuc2Zvcm0gb25jZSBmb3IgYWxsIHJlbmRlcmluZyBwcm9jZXNzXG4gICAgY3R4LnRyYW5zZm9ybS5hcHBseShjdHgsIHRoaXMudmlld3BvcnRUcmFuc2Zvcm0pO1xuICAgIHRoaXMuX3JlbmRlckJhY2tncm91bmRPYmplY3RzKGN0eCk7XG4gICAgdGhpcy5fcmVuZGVyT2JqZWN0cyhjdHgsIG9iamVjdHMpO1xuICAgIHRoaXMuX3JlbmRlck92ZXJsYXlPYmplY3RzKGN0eCk7XG4gICAgY3R4LnJlc3RvcmUoKTtcbiAgICBpZiAoIXRoaXMuY29udHJvbHNBYm92ZU92ZXJsYXkgJiYgdGhpcy5pbnRlcmFjdGl2ZSkge1xuICAgICAgdGhpcy5kcmF3Q29udHJvbHMoY3R4KTtcbiAgICB9XG4gICAgaWYgKHRoaXMuY2xpcFRvKSB7XG4gICAgICBjdHgucmVzdG9yZSgpO1xuICAgIH1cbiAgICB0aGlzLl9yZW5kZXJPdmVybGF5KGN0eCk7XG4gICAgaWYgKHRoaXMuY29udHJvbHNBYm92ZU92ZXJsYXkgJiYgdGhpcy5pbnRlcmFjdGl2ZSkge1xuICAgICAgdGhpcy5kcmF3Q29udHJvbHMoY3R4KTtcbiAgICB9XG4gICAgdGhpcy5maXJlKCdhZnRlcjpyZW5kZXInKTtcbiAgfSxcbiAgX3JlbmRlck92ZXJsYXlPYmplY3RzOiBmdW5jdGlvbigpe30sXG4gIF9yZW5kZXJCYWNrZ3JvdW5kT2JqZWN0czogZnVuY3Rpb24oKXt9LFxuICAvKipcbiAgICogQHByaXZhdGVcbiAgICogQHBhcmFtIHtIVE1MRWxlbWVudCB8IFN0cmluZ30gZWwgJmx0O2NhbnZhcz4gZWxlbWVudCB0byBpbml0aWFsaXplIGluc3RhbmNlIG9uXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc10gT3B0aW9ucyBvYmplY3RcbiAgICovXG4gIF9pbml0U3RhdGljOiBmdW5jdGlvbihlbCwgb3B0aW9ucykge1xuICAgIHRoaXMuX29iamVjdHMgPSBbXTtcbiAgICB0aGlzLl9jcmVhdGVMb3dlckNhbnZhcyhlbCk7XG4gICAgdGhpcy5faW5pdFNpemUob3B0aW9ucyk7XG4gICAgdGhpcy5zZXQob3B0aW9ucyk7XG4gICAgdGhpcy5fc2V0SW1hZ2VTbW9vdGhpbmcoKTtcblxuICAgIC8vIG9ubHkgaW5pdGlhbGl6ZSByZXRpbmEgc2NhbGluZyBvbmNlXG4gICAgaWYgKCF0aGlzLmludGVyYWN0aXZlKSB7XG4gICAgICB0aGlzLl9pbml0UmV0aW5hU2NhbGluZygpO1xuICAgIH1cbiAgICB0aGlzLmNhbGNPZmZzZXQoKTtcbiAgfSxcbiAgX2luaXRTaXplOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy53aWR0aCA9IHRoaXMud2lkdGggfHwgcGFyc2VJbnQodGhpcy5sb3dlckNhbnZhc0VsLndpZHRoLCAxMCkgfHwgMDtcbiAgICB0aGlzLmhlaWdodCA9IHRoaXMuaGVpZ2h0IHx8IHBhcnNlSW50KHRoaXMubG93ZXJDYW52YXNFbC5oZWlnaHQsIDEwKSB8fCAwO1xuXG4gICAgaWYgKCF0aGlzLmxvd2VyQ2FudmFzRWwuc3R5bGUpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmxvd2VyQ2FudmFzRWwud2lkdGggPSB0aGlzLndpZHRoO1xuICAgIHRoaXMubG93ZXJDYW52YXNFbC5oZWlnaHQgPSB0aGlzLmhlaWdodDtcblxuICAgIHRoaXMubG93ZXJDYW52YXNFbC5zdHlsZS53aWR0aCA9IHRoaXMud2lkdGggKyAncHgnO1xuICAgIHRoaXMubG93ZXJDYW52YXNFbC5zdHlsZS5oZWlnaHQgPSB0aGlzLmhlaWdodCArICdweCc7XG5cbiAgICB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtID0gdGhpcy52aWV3cG9ydFRyYW5zZm9ybS5zbGljZSgpO1xuICB9LFxuICBpbml0aWFsaXplOiBmdW5jdGlvbihlbCwgb3B0aW9ucykge1xuICAgIG9wdGlvbnMgPSAgZmFicmljLnV0aWwub2JqZWN0LmRlZmF1bHRzKGZhYnJpYy51dGlsLm9iamVjdC5kZWVwRXh0ZW5kKG9wdGlvbnMgfHwge30pLHRoaXMuZGVmYXVsdE9wdGlvbnMpO1xuICAgIHRoaXMuX2luaXRFbnRpdHkob3B0aW9ucyk7XG4gICAgdGhpcy5faW5pdFN0YXRpYyhlbCwgb3B0aW9ucyk7XG4gIH0sXG4gIHNldERhdGE6IGZ1bmN0aW9uIChkYXRhKSB7XG5cbiAgICBpZiAoZGF0YS5jYXRlZ29yeSA9PSBcImJhY2tncm91bmRcIikge1xuICAgICAgdGhpcy5zZXRCYWNrZ3JvdW5kSW1hZ2UoZGF0YS5zcmMsIHRoaXMucmVuZGVyQWxsLmJpbmQodGhpcykpXG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgdmFyIGlkID0gdGhpcy5hY3RpdmVBcmVhID8gXCIjXCIrdGhpcy5hY3RpdmVBcmVhLmlkIDogXCJjYW52YXNcIjtcbiAgICAgIHRoaXMuY3JlYXRlT2JqZWN0KGZhYnJpYy51dGlsLm9iamVjdC5kZWVwRXh0ZW5kKHtcbiAgICAgICAgbW92ZW1lbnRMaW1pdHM6IGlkLFxuICAgICAgICBjbGlwVG86IGlkLFxuICAgICAgICBwb3NpdGlvbjogXCJjZW50ZXJcIixcbiAgICAgICAgYWN0aXZlOiB0cnVlXG4gICAgICB9LCBmYWJyaWMudXRpbC5vYmplY3QuY2xvbmUoZGF0YSkpKTtcbiAgICB9XG4gIH0sXG4gIHNldFdpZHRoOiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICByZXR1cm4gdGhpcy5zZXREaW1lbnNpb25zKHsgd2lkdGg6IHZhbHVlIH0sIHt9KTtcbiAgfSxcbiAgc2V0SGVpZ2h0OiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICByZXR1cm4gdGhpcy5zZXREaW1lbnNpb25zKHsgaGVpZ2h0OiB2YWx1ZSB9LCB7fSk7XG4gIH0sXG4gIC8qKlxuICAgKiBAcHJpdmF0ZVxuICAgKi9cblxuICBnZXRPYmplY3RCeUlEOiBmdW5jdGlvbihfaWQpe1xuICAgIGZvciAodmFyIGxheWVyTmFtZSBvZiB0aGlzLl9sYXllcnMpIHtcbiAgICAgIGZvciAodmFyIG8gb2YgdGhpc1tsYXllck5hbWVdKSB7XG4gICAgICAgIGlmIChvLmlkID09PSBfaWQpIHtcbiAgICAgICAgICByZXR1cm4gbztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbiAgfSxcbiAgLypcbiAgIEFkZCBDdXN0b20gT2JqZWN0IFRyYW5mb3JtYXRpb25zXG4gICAqL1xuICBnZXRQb2ludGVyOiBmdW5jdGlvbiAoZSwgaWdub3JlWm9vbSwgdXBwZXJDYW52YXNFbCkge1xuICAgIHZhciBwb2ludGVyID0gX2dldF9wb2ludGVyX292ZXJ3cml0dGVuLmNhbGwodGhpcywgZSwgaWdub3JlWm9vbSwgdXBwZXJDYW52YXNFbCk7XG4gICAgaWYgKGUuX2dyb3VwKSB7XG4gICAgICByZXR1cm4gdGhpcy5fbm9ybWFsaXplUG9pbnRlcihlLl9ncm91cCwgcG9pbnRlcik7XG4gICAgfVxuICAgIHJldHVybiBwb2ludGVyO1xuICB9LFxuXG4gIGhhc1N0YXRlQ2hhbmdlZDogZmFicmljLk9iamVjdC5wcm90b3R5cGUuaGFzU3RhdGVDaGFuZ2VkLFxuICAvKiogQ3JlYXRlcyBhIGJvdHRvbSBjYW52YXNcbiAgICogQHByaXZhdGVcbiAgICogQHBhcmFtIHtIVE1MRWxlbWVudH0gW2NhbnZhc0VsXVxuICAgKi9cbiAgX2NyZWF0ZUxvd2VyQ2FudmFzOiBmdW5jdGlvbiAoY2FudmFzRWwpIHtcbiAgICBpZiAodHlwZW9mIGNhbnZhc0VsID09IFwic3RyaW5nXCIpIHtcbiAgICAgIHRoaXMubG93ZXJDYW52YXNFbCA9IGZhYnJpYy51dGlsLmdldEJ5SWQoY2FudmFzRWwpIHx8IHRoaXMuX2NyZWF0ZUNhbnZhc0VsZW1lbnQoKTtcbiAgICB9IGVsc2UgaWYgKGNhbnZhc0VsKSB7XG4gICAgICB0aGlzLmxvd2VyQ2FudmFzRWwgPSBjYW52YXNFbDtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy52aXJ0dWFsID0gdHJ1ZTtcbiAgICAgIHRoaXMubG93ZXJDYW52YXNFbCA9IGZhYnJpYy51dGlsLmNyZWF0ZUNhbnZhc0VsZW1lbnQoKTtcbiAgICB9XG5cbiAgICB0aGlzLl9pbml0Q2FudmFzRWxlbWVudCh0aGlzLmxvd2VyQ2FudmFzRWwpO1xuXG4gICAgZmFicmljLnV0aWwuYWRkQ2xhc3ModGhpcy5sb3dlckNhbnZhc0VsLCAnbG93ZXItY2FudmFzJyk7XG5cbiAgICBpZiAodGhpcy5pbnRlcmFjdGl2ZSkge1xuICAgICAgdGhpcy5fYXBwbHlDYW52YXNTdHlsZSh0aGlzLmxvd2VyQ2FudmFzRWwpO1xuICAgIH1cblxuICAgIHRoaXMuY29udGV4dENvbnRhaW5lciA9IHRoaXMubG93ZXJDYW52YXNFbC5nZXRDb250ZXh0KCcyZCcpO1xuICB9LFxuICBmaW5kVGFyZ2V0OiBmdW5jdGlvbiAoZSwgc2tpcEdyb3VwKSB7XG4gICAgaWYgKHRoaXMuc2tpcFRhcmdldEZpbmQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB2YXIgaWdub3JlWm9vbSA9IHRydWUsXG4gICAgICBwb2ludGVyID0gdGhpcy5nZXRQb2ludGVyKGUsIGlnbm9yZVpvb20pLFxuICAgICAgYWN0aXZlR3JvdXAgPSB0aGlzLmdldEFjdGl2ZUdyb3VwKCksXG4gICAgICBhY3RpdmVPYmplY3QgPSB0aGlzLmdldEFjdGl2ZU9iamVjdCgpO1xuICAgIGlmIChhY3RpdmVHcm91cCAmJiAhc2tpcEdyb3VwICYmIHRoaXMuX2NoZWNrVGFyZ2V0KHBvaW50ZXIsIGFjdGl2ZUdyb3VwKSkge1xuICAgICAgcmV0dXJuIGFjdGl2ZUdyb3VwO1xuICAgIH1cblxuICAgIGlmIChhY3RpdmVPYmplY3QgJiYgdGhpcy5fY2hlY2tUYXJnZXQocG9pbnRlciwgYWN0aXZlT2JqZWN0KSkge1xuICAgICAgLy9hZGRlZCB2aXNjZXJvaWRcbiAgICAgIHRoaXMuX2ZpcmVPdmVyT3V0RXZlbnRzKGFjdGl2ZU9iamVjdCwgZSk7XG4gICAgICByZXR1cm4gYWN0aXZlT2JqZWN0O1xuICAgIH1cblxuICAgIHRoaXMudGFyZ2V0cyA9IFsgXTtcblxuICAgIHZhciB0YXJnZXQgPSB0aGlzLl9zZWFyY2hQb3NzaWJsZVRhcmdldHModGhpcy5fb2JqZWN0cywgcG9pbnRlcik7XG4gICAgdGhpcy5fZmlyZU92ZXJPdXRFdmVudHModGFyZ2V0LCBlKTtcbiAgICByZXR1cm4gdGFyZ2V0O1xuICB9XG59KTtcbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLkNhbnZhcy5wcm90b3R5cGUsRXh0Q2FudmFzTWl4aW4pO1xuXG5cblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvY29yZS9zdGF0aWMtY2FudmFzLmV4dC5qcyIsImZhYnJpYy5JbWFnZU1peGluID0ge1xuICBzZXRFbGVtZW50RnJvbU1lbnUgOiBmdW5jdGlvbihkYXRhKXtcbiAgICB0aGlzLnNldEVsZW1lbnQoZGF0YS5pbWFnZSlcbiAgfSxcbiAgaW5pdFByb3BvcnRpbmFsU2l6ZSA6IHRydWUsXG4gIC8qKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdIE9iamVjdCB3aXRoIHdpZHRoL2hlaWdodCBwcm9wZXJ0aWVzXG4gICAqL1xuICBfc2V0V2lkdGhIZWlnaHQ6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICBpZih0aGlzLmVsZW1lbnQpe1xuICAgICAgdmFyIF9zaXplID0gdGhpcy5nZXRPcmlnaW5hbFNpemUoKTtcbiAgICB9ZWxzZXtcbiAgICAgIF9zaXplID0ge307XG4gICAgfVxuICAgIGlmKCd3aWR0aCcgaW4gb3B0aW9ucyl7XG4gICAgICB0aGlzLndpZHRoID0gb3B0aW9ucy53aWR0aDtcbiAgICB9ZWxzZXtcbiAgICAgIGlmKCFfc2l6ZS53aWR0aCl7XG4gICAgICAgIHRoaXMud2lkdGggPSAxMDA7XG4gICAgICB9ZWxzZXtcbiAgICAgICAgaWYodGhpcy5pbml0UHJvcG9ydGluYWxTaXplICYmICdoZWlnaHQnIGluIG9wdGlvbnMpe1xuICAgICAgICAgIHRoaXMud2lkdGggPSAob3B0aW9ucy5oZWlnaHQgIC8gX3NpemUuaGVpZ2h0ICkgKiBfc2l6ZS53aWR0aDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLndpZHRoID0gX3NpemUud2lkdGg7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZignaGVpZ2h0JyBpbiBvcHRpb25zKXtcbiAgICAgIHRoaXMuaGVpZ2h0ID0gb3B0aW9ucy5oZWlnaHQ7XG4gICAgfWVsc2V7XG4gICAgICBpZighX3NpemUuaGVpZ2h0KXtcbiAgICAgICAgdGhpcy5oZWlnaHQgPSAxMDA7XG4gICAgICB9ZWxzZXtcbiAgICAgICAgaWYodGhpcy5pbml0UHJvcG9ydGluYWxTaXplICYmICd3aWR0aCcgaW4gb3B0aW9ucyl7XG4gICAgICAgICAgdGhpcy5oZWlnaHQgPSAob3B0aW9ucy53aWR0aCAgLyBfc2l6ZS53aWR0aCApICogX3NpemUuaGVpZ2h0O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMuaGVpZ2h0ID0gX3NpemUuaGVpZ2h0O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG59O1xuXG5mYWJyaWMuQXBwbGljYXRpb24ucHJvdG90eXBlLmdldExpYnJhcnlFbGVtZW50cyA9IGZ1bmN0aW9uKG9wdGlvbnMpe1xuICByZXR1cm4gW107XG59XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL21peGlucy9wcm9wb3J0aWFuYWxTaXplTWl4aW4uanMiLCIndXNlIHN0cmljdCc7XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLlN0YXRpY0NhbnZhcy5wcm90b3R5cGUsIHtcblxuICBvcHRpb25zT3JkZXI6IChmdW5jdGlvbigpe1xuICAgIHZhciBvbyA9IGZhYnJpYy5TdGF0aWNDYW52YXMucHJvdG90eXBlLm9wdGlvbnNPcmRlcjtcbiAgICBvby5zcGxpY2Uob28uaW5kZXhPZihcIipcIiksMCxcImFyZWFzXCIsXCJvZmZzZXRzXCIsXCJoZWxwZXJzXCIpO1xuICAgIHJldHVybiBvbztcbiAgfSkoKSxcbiAgX2hlbHBlcnNPYmplY3RzOiBudWxsLFxuICBfYXJlYXNPYmplY3RzOiBudWxsLFxuICAvL29mZnNldHM6IHtsZWZ0OiAwLCB0b3A6IDAsIHJpZ2h0OiAwLCBib3R0b206IDB9LFxuICBfdXBkYXRlX2NsaXBfcmVjdDogZnVuY3Rpb24gKCkge1xuICAgIC8vdG9kb1xuICAgIHJldHVybjtcbiAgICBpZiAodGhpcy5hcmVhcyB8fCAhdGhpcy5fYXJlYXNPYmplY3RzWzBdKSByZXR1cm47XG4gICAgdmFyIGdlb21ldHJ5ID0gdGhpcy5nZXRSZWN0KHRoaXMub2Zmc2V0cyk7XG4gICAgdGhpcy5fYXJlYXNPYmplY3RzWzBdLnNldChnZW9tZXRyeSk7XG4gIH0sXG4gIC8vb2Zmc2V0czoge2xlZnQgOiAwLHRvcCA6IDAsIHJpZ2h0OiAwLCBib3R0b206MH0sXG4gIHNldEhlbHBlcnM6IGZ1bmN0aW9uIChoZWxwZXJzLCBjYWxsYmFjaykge1xuICAgIHRoaXMuaGVscGVycyA9IGhlbHBlcnM7XG4gICAgdGhpcy5faGVscGVyc09iamVjdHMgPSBbXTtcbiAgICBpZihoZWxwZXJzKXtcbiAgICAgIGZvciAobGV0IGggb2YgaGVscGVycyl7XG4gICAgICAgIGZhYnJpYy51dGlsLmNyZWF0ZU9iamVjdChoLGhlbHBlciA9PiB7XG4gICAgICAgICAgdGhpcy5faGVscGVyc09iamVjdHMucHVzaChoZWxwZXIpO1xuICAgICAgICAgIHRoaXMucmVuZGVyQWxsKCk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgICBjYWxsYmFjayAmJiBjYWxsYmFjaygpO1xuICB9LFxuICBzdG9yZVByb3BlcnRpZXM6IGZhYnJpYy5TdGF0aWNDYW52YXMucHJvdG90eXBlLnN0b3JlUHJvcGVydGllcy5jb25jYXQoW1wib2Zmc2V0c1wiLFwiaGVscGVyc1wiLFwiYXJlYXNcIl0pLFxuICBhcmVhQWN0aXZhdGluZzogZmFsc2UsXG4gIGFkZEVsZW1lbnRzSW5zaWRlQWN0aXZlQXJlYTogZmFsc2UsXG4gIGFyZWFQcm9wZXJ0aWVzOiB7XG4gICAgb3JpZ2luWDogJ2xlZnQnLFxuICAgIG9yaWdpblk6ICd0b3AnLFxuICAgIGZpbGw6ICd0cmFuc3BhcmVudCcsXG4gICAgc3Ryb2tlRGFzaEFycmF5OiBbNSwgNV0sXG4gICAgc3Ryb2tlV2lkdGg6IDEsXG4gICAgc3Ryb2tlOiAnYmxhY2snLFxuICAgIHJlc2l6YWJsZTogdHJ1ZVxuICAgIC8vc2VsZWN0YWJsZTogZmFsc2VcbiAgfSxcbiAgc2V0QXJlYVByb3BlcnR5OiBmdW5jdGlvbiAocHJvcGVydHksIHZhbHVlKSB7XG4gICAgdGhpc1tcImFyZWFfXCIgKyBwcm9wZXJ0eV0gPSB2YWx1ZTtcbiAgICBpZih0aGlzLl9vZmZzZXRzT2JqZWN0KXtcbiAgICAgIHRoaXMuX29mZnNldHNPYmplY3RbcHJvcGVydHldID0gdmFsdWU7XG4gICAgfVxuICAgIGZvciAobGV0IG9iamVjdCBvZiB0aGlzLl9hcmVhc09iamVjdHMpIHtcbiAgICAgIG9iamVjdFtwcm9wZXJ0eV0gPSB2YWx1ZTtcbiAgICB9XG4gICAgdGhpcy5yZW5kZXJBbGwoKTtcbiAgfSxcbiAgc2V0QWN0aXZlQXJlYTogZnVuY3Rpb24gKGFyZWEpIHtcbiAgICBpZiAodGhpcy5hY3RpdmVBcmVhKSB7XG4gICAgICB0aGlzLmFjdGl2ZUFyZWEuc2V0U3Ryb2tlKFwiIzAwMFwiKTtcbiAgICB9XG4gICAgdGhpcy5hY3RpdmVBcmVhID0gYXJlYTtcbiAgICBpZiAoYXJlYSkge1xuICAgICAgYXJlYS5zZXRTdHJva2UoXCIjQjdGMUVEXCIpO1xuICAgIH1cbiAgfSxcbiAgc2V0QXJlYUFjdGl2YXRpbmc6IGZ1bmN0aW9uICh2YWx1ZS8qLCBmb3JjZSovKSB7XG4gICAgLy90b2RvIGZvcmNlXG4gICAgdmFyIGZvcmNlID0gdHJ1ZTtcbiAgICBpZiAoZm9yY2UgfHwgKHZhbHVlICYmICF0aGlzLmFyZWFBY3RpdmF0aW5nKSkge1xuICAgICAgdGhpcy5hcmVhQWN0aXZhdGluZyA9IHRydWU7XG4gICAgICB0aGlzLm9uKFwib2JqZWN0Om1vZGlmaWVkXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGlmKCF0aGlzLl9hcmVhc09iamVjdHMpcmV0dXJuO1xuICAgICAgICBpZih0aGlzLmVkaXRpbmdPYmplY3Qpe1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvL3RvZG8gZXZlbnQhINC90LUg0YrQvtGC0LXQuyDQsdGLINGN0YLQviDRgtGD0YIg0LjRgdC/0L7Qu9GM0L7QstCw0YLRjCzQvdC+INGA0LDQsdC+0YLQsNC10YJcbiAgICAgICAgdmFyIHBvaW50ZXIgPSB0aGlzLmdldFBvaW50ZXIoZXZlbnQsIHRydWUpO1xuICAgICAgICB2YXIgdGFyZ2V0ID0gdGhpcy5fc2VhcmNoUG9zc2libGVUYXJnZXRzKHRoaXMuX2FyZWFzT2JqZWN0cywgcG9pbnRlcik7XG4gICAgICAgIGlmKHRoaXMuX2N1cnJlbnRUcmFuc2Zvcm0gJiYgdGFyZ2V0ICYmIHRoaXMudGFyZ2V0Lm1vdmVtZW50TGltaXRzICE9IHRhcmdldCl7XG4gICAgICAgICAgdGhpcy50YXJnZXQuc2V0KHtcbiAgICAgICAgICAgIG1vdmVtZW50TGltaXRzOiB0YXJnZXQsXG4gICAgICAgICAgICBjbGlwVG86IHRhcmdldFxuICAgICAgICAgIH0pO1xuICAgICAgICAgIHRoaXMuc2V0QWN0aXZlQXJlYSh0YXJnZXQpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHRoaXMub24oXCJtb3VzZTpkb3duXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGlmKCF0aGlzLl9hcmVhc09iamVjdHMpcmV0dXJuO1xuICAgICAgICB2YXIgcG9pbnRlciA9IHRoaXMuZ2V0UG9pbnRlcihlLmUsIHRydWUpO1xuICAgICAgICB2YXIgdGFyZ2V0ID0gdGhpcy5fc2VhcmNoUG9zc2libGVUYXJnZXRzKHRoaXMuX2FyZWFzT2JqZWN0cywgcG9pbnRlcik7XG4gICAgICAgIGlmICh0YXJnZXQpIHtcbiAgICAgICAgICB0aGlzLnNldEFjdGl2ZUFyZWEodGFyZ2V0KTtcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9XG4gIH0sXG4gIF91cGRhdGVfYXJlYV9nZW9tZXRyeTogZnVuY3Rpb24oZWwsb3B0aW9ucyl7XG4gICAgaWYgKG9wdGlvbnMucGF0aCkge1xuXG4gICAgICBvcHRpb25zLndpZHRoID0gb3B0aW9ucy53aWR0aCB8fCBlbC53aWR0aDtcbiAgICAgIHZhciBnZW9tZXRyeSA9IHRoaXMuZ2V0UmVjdChvcHRpb25zKTtcbiAgICAgIHZhciBfc2NhbGUgPSBlbC53aWR0aCAvIGdlb21ldHJ5LndpZHRoO1xuICAgICAgZWwuc2V0KHtcbiAgICAgICAgbGVmdDogZ2VvbWV0cnkubGVmdCAsLy8vKiBlbC5sZWZ0ICogX3NjYWxlKi8sXG4gICAgICAgIHRvcDogZ2VvbWV0cnkudG9wICwvLysgZWwudG9wICogX3NjYWxlLFxuICAgICAgICBzY2FsZVg6IF9zY2FsZSxcbiAgICAgICAgc2NhbGVZOiBfc2NhbGVcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB2YXIgZ2VvbWV0cnkgPSB0aGlzLmdldFJlY3Qob3B0aW9ucyk7XG5cbiAgICBpZihvcHRpb25zLnNyYyl7XG4gICAgICB2YXIgX3NjYWxlID0gZ2VvbWV0cnkud2lkdGggLyBpbWcud2lkdGg7XG4gICAgICBlbC5zZXQoe1xuICAgICAgICBsZWZ0OiBnZW9tZXRyeS5sZWZ0LC8vICsgZWwubGVmdCAqIF9zY2FsZSxcbiAgICAgICAgdG9wOiBnZW9tZXRyeS50b3AgLC8vKyBlbC50b3AgKiBfc2NhbGUsXG4gICAgICAgIHN0cm9rZVdpZHRoOiB0aGlzLmFyZWFQcm9wZXJ0aWVzLnN0cm9rZVdpZHRoIC8gX3NjYWxlLFxuICAgICAgICBzY2FsZVg6IF9zY2FsZSxcbiAgICAgICAgc2NhbGVZOiBfc2NhbGVcbiAgICAgIH0pO1xuICAgIH1lbHNle1xuICAgICAgZWwuc2V0KGdlb21ldHJ5KTtcbiAgICB9XG4gIH0sXG4gIF9yZW5kZXJPdmVybGF5T2JqZWN0czogZnVuY3Rpb24oY3R4KXtcbiAgICBpZih0aGlzLl9vZmZzZXRzT2JqZWN0KXtcbiAgICAgIHRoaXMuX29mZnNldHNPYmplY3QucmVuZGVyKGN0eCk7XG4gICAgfVxuICAgIGlmKHRoaXMuX2FyZWFzT2JqZWN0cyl7XG4gICAgICB0aGlzLl9yZW5kZXJPYmplY3RzKGN0eCwgdGhpcy5fYXJlYXNPYmplY3RzKTtcbiAgICB9XG4gICAgaWYodGhpcy5faGVscGVyc09iamVjdHMpe1xuICAgICAgdGhpcy5fcmVuZGVyT2JqZWN0cyhjdHgsIHRoaXMuX2hlbHBlcnNPYmplY3RzKTtcbiAgICB9XG4gIH0sXG4gIGNyZWF0ZUFyZWE6IGZ1bmN0aW9uIChhcmVhLCBjYWxsYmFjaykge1xuXG4gICAgdmFyIF90aGlzID0gdGhpcztcblxuICAgIHZhciBfZmluYWxpemUgPSBmdW5jdGlvbiAocGF0aCwgYXJlYSkge1xuICAgICAgcGF0aC5pZCA9IGFyZWEuaWQ7XG4gICAgICAvL1xuICAgICAgLy8gYXJlYS5pbnN0YW5jZSA9IHBhdGg7XG4gICAgIC8vIHBhdGgubGF5ZXIgPSBcImJhY2tncm91bmRcIjtcbiAgICAgLy8gdGhpcy5hZGQocGF0aCk7XG4gICAgICB0aGlzLl91cGRhdGVfYXJlYV9nZW9tZXRyeShwYXRoLGFyZWEpO1xuICAgICAgdGhpcy5fYXJlYXNPYmplY3RzLnB1c2gocGF0aCk7XG4gICAgICAvLyBfdGhpcy5fYmFja2dyb3VuZExheWVyLnB1c2gocGF0aCk7XG4gICAgICAvLyBwYXRoLmNhbnZhcyA9IF90aGlzO1xuICAgICAgY2FsbGJhY2soKTtcbiAgICB9LmJpbmQodGhpcyk7XG5cblxuICAgIHZhciBwYXRoLCByZWN0YXJlYTtcbiAgICBpZiAoYXJlYS5wYXRoKSB7XG4gICAgICBwYXRoID0gbmV3IGZhYnJpYy5QYXRoKGFyZWEucGF0aCwgdGhpcy5hcmVhUHJvcGVydGllcyk7XG4gICAgICBhcmVhLnRvcCA9IHBhdGgudG9wO1xuICAgICAgYXJlYS5sZWZ0ID0gcGF0aC5sZWZ0O1xuICAgICAgYXJlYS53aWR0aCA9IHBhdGgud2lkdGg7XG4gICAgICBhcmVhLmhlaWdodCA9IHBhdGguaGVpZ2h0O1xuICAgICAgX2ZpbmFsaXplKHBhdGgsIGFyZWEpO1xuICAgIH0gZWxzZSBpZiAoYXJlYS5zcmMpIHtcbiAgICAgIHZhciBjbGlwRmlsbGVyID0gbmV3IGZhYnJpYy5QYXRoZmluZGVyKHt9KTtcbiAgICAgIGZhYnJpYy51dGlsLmxvYWRJbWFnZShhcmVhLnNyYywgZnVuY3Rpb24gKGltZykge1xuICAgICAgICBjbGlwRmlsbGVyLnNldEltYWdlKGltZyk7XG4gICAgICAgIGNsaXBGaWxsZXIubWFzayA9IE1hZ2ljV2FuZC5zZWxlY3RCYWNrZ3JvdW5kKGNsaXBGaWxsZXIuZ2V0SW5mbygpLCBudWxsLCAxNSk7XG5cbiAgICAgICAgdmFyIGNvbnRvdXJzID0gY2xpcEZpbGxlci5nZXRDb250b3VycygpO1xuICAgICAgICB2YXIgY2xpcFBvaW50cyA9IGNvbnRvdXJzWzFdLnBvaW50cztcbiAgICAgICAgdmFyIHBhdGhEYXRhID0gZmFicmljLlBlbmNpbEJydXNoLnByb3RvdHlwZS5jb252ZXJ0UG9pbnRzVG9TVkdQYXRoKGNsaXBQb2ludHMpLmpvaW4oJycpOy8vdG9kb1xuICAgICAgICBwYXRoID0gbmV3IGZhYnJpYy5QYXRoKHBhdGhEYXRhLCBfdGhpcy5hcmVhUHJvcGVydGllcyk7XG5cbiAgICAgICAgX2ZpbmFsaXplKHBhdGgsIGFyZWEpO1xuICAgICAgfSk7XG5cbiAgICB9IGVsc2Uge1xuICAgICAgcGF0aCA9IG5ldyBmYWJyaWMuUmVjdCh0aGlzLmFyZWFQcm9wZXJ0aWVzKTtcbiAgICAgIF9maW5hbGl6ZShwYXRoLCBhcmVhKTtcbiAgICB9XG5cbiAgICBpZigoIGFyZWEucmlnaHQgfHwgYXJlYS5ib3R0b20gfHwgYXJlYS5wYXRoICkgJiYgKCF0aGlzLm9yaWdpbmFsV2lkdGggIHx8ICF0aGlzLm9yaWdpbmFsSGVpZ2h0KSApe1xuICAgICAgdGhpcy5vbihcImJhY2tncm91bmQtaW1hZ2U6bG9hZGVkXCIsZnVuY3Rpb24oKXtcbiAgICAgICAgdGhpcy5fdXBkYXRlX2FyZWFfZ2VvbWV0cnkocGF0aCxhcmVhKTtcbiAgICAgICAgdGhpcy5yZW5kZXJBbGwoKTtcbiAgICAgIH0uYmluZCh0aGlzKSlcbiAgICB9XG5cbiAgICAvKlxuICAgICBhcHAuY2FudmFzLnNldE9mZnNldHMoe1xuICAgICByaWdodDogIDEsXG4gICAgIGxlZnQ6ICAgMSxcbiAgICAgdG9wOiAgICAxLFxuICAgICBib3R0b206IDFcbiAgICAgfSk7XG5cblxuICAgICBhcHAuY2FudmFzLmNsaXBUbyA9IGZ1bmN0aW9uIChjdHgpIHtcbiAgICAgdmFyIHpvb20gPSBhcHAuY2FudmFzX2NvbmZpZy53aWR0aCAvIGFwcC5jYW52YXMuYmFja2dyb3VuZEltYWdlLmZpbHRlcnNbMF0ucGF0aGZpbmRlci5tYXNrLndpZHRoO1xuICAgICBjdHguc2F2ZSgpO1xuICAgICBjdHguc2NhbGUoem9vbSwgem9vbSk7XG4gICAgIGFwcC5jbGlwRmlsbGVyLnRyYWNlSW5uZXIoY3R4KTtcbiAgICAgY3R4LnJlc3RvcmUoKTtcbiAgICAgfTsqL1xuICB9LFxuICByZW1vdmVBcmVhOiBmdW5jdGlvbiAoYXJlYSkge1xuLypcbiAgICB2YXIgb2JqcyA9IHRoaXMuZ2V0T2JqZWN0cygpO1xuICAgIGZvciAodmFyIGkgaW4gb2Jqcykge1xuICAgICAgaWYgKG9ianNbaV0ubW92ZW1lbnRMaW1pdHMgPT09IGFyZWEpIHtcbiAgICAgICAgZGVsZXRlIG9ianNbaV0ubW92ZW1lbnRMaW1pdHM7XG4gICAgICB9XG4gICAgICBpZiAob2Jqc1tpXS5jbGlwVG8gPT09IGFyZWEpIHtcbiAgICAgICAgLy9pZihvYmpzW2ldLm9sY0NsaXBUb0lEKXtcbiAgICAgICAgLy8gICAgb2Jqc1tpXS5jbGlwVG9JRCA9IG9ianNbaV0ub2xkQ2xpcFRvSUQ7XG4gICAgICAgIC8vfVxuICAgICAgICBkZWxldGUgb2Jqc1tpXS5jbGlwVG87XG4gICAgICAgIC8vb2Jqc1tpXS5vbGNDbGlwVG9JRCA9IGFyZWEuaWQ7XG4gICAgICB9XG4gICAgfVxuICAgIGFyZWEucmVtb3ZlKCk7Ki9cbiAgfSxcbiAgLyoqXG4gICAqXG4gICAqIEBwYXJhbSBvZmZzZXRzIDoge3RvcDogbnVtYmVyLCByaWdodDogbnVtYmVyLCBib3R0b206IG51bWJlciwgbGVmdDogbnVtYmVyfSB8IG51bWJlciB8IFs/bnVtYmVyLD9udW1iZXIsP251bWJlciw/bnVtYmVyXVxuICAgKiBAcGFyYW0gY2FsbGJhY2tcbiAgICovXG4gIHNldE9mZnNldHM6IGZ1bmN0aW9uIChvZmZzZXRzKSB7XG4gICAgaWYob2Zmc2V0cyA9PT0gbnVsbCApe1xuICAgICAgdGhpcy5vZmZzZXRzID0ge3RvcDogMCwgcmlnaHQ6IDAsIGJvdHRvbTogMCwgbGVmdDogMH07XG4gICAgfWVsc2UgaWYgKG9mZnNldHMuY29uc3RydWN0b3IgPT09IE51bWJlcikge1xuICAgICAgdGhpcy5vZmZzZXRzID0ge3RvcDogb2Zmc2V0cywgcmlnaHQ6IG9mZnNldHMsIGJvdHRvbTogb2Zmc2V0cywgbGVmdDogb2Zmc2V0c307XG4gICAgfWVsc2UgaWYgKG9mZnNldHMuY29uc3RydWN0b3IgPT09IEFycmF5KSB7XG4gICAgICBzd2l0Y2gob2Zmc2V0cy5sZW5ndGgpe1xuICAgICAgICBjYXNlIDA6IHRoaXMub2Zmc2V0cyA9IHt0b3A6IDAsIHJpZ2h0OiAwLCBib3R0b206IDAsIGxlZnQ6IDB9OyBicmVhaztcbiAgICAgICAgY2FzZSAxOiB0aGlzLm9mZnNldHMgPSB7dG9wOiBvZmZzZXRzWzBdLCByaWdodDogb2Zmc2V0c1swXSwgYm90dG9tOiBvZmZzZXRzWzBdLCBsZWZ0OiBvZmZzZXRzWzBdfTsgYnJlYWs7XG4gICAgICAgIGNhc2UgMjogdGhpcy5vZmZzZXRzID0ge3RvcDogb2Zmc2V0c1swXSwgcmlnaHQ6IG9mZnNldHNbMV0sIGJvdHRvbTogb2Zmc2V0c1swXSwgbGVmdDogb2Zmc2V0c1sxXX07IGJyZWFrO1xuICAgICAgICBjYXNlIDM6IHRoaXMub2Zmc2V0cyA9IHt0b3A6IG9mZnNldHNbMF0sIHJpZ2h0OiBvZmZzZXRzWzFdLCBib3R0b206IG9mZnNldHNbMl0sIGxlZnQ6IG9mZnNldHNbMV19OyBicmVhaztcbiAgICAgICAgY2FzZSA0OiB0aGlzLm9mZnNldHMgPSB7dG9wOiBvZmZzZXRzWzBdLCByaWdodDogb2Zmc2V0c1sxXSwgYm90dG9tOiBvZmZzZXRzWzJdLCBsZWZ0OiBvZmZzZXRzWzNdfTsgYnJlYWs7XG4gICAgICB9XG4gICAgfWVsc2V7XG4gICAgICB0aGlzLm9mZnNldHMgPSBvZmZzZXRzO1xuICAgIH1cblxuXG4gICAgaWYodGhpcy5vZmZzZXRzLnRvcCB8fCB0aGlzLm9mZnNldHMuYm90dG9tIHx8IHRoaXMub2Zmc2V0cy5sZWZ0IHx8IHRoaXMub2Zmc2V0cy5yaWdodCl7XG5cbiAgICAgIHRoaXMuX29mZnNldHNPYmplY3QgPSBuZXcgZmFicmljLlJlY3QodGhpcy5vZmZzZXRzKTtcbiAgICAgIHRoaXMuX29mZnNldHNPYmplY3Quc2V0KHRoaXMuYXJlYVByb3BlcnRpZXMpO1xuICAgICAgdGhpcy5fdXBkYXRlX2FyZWFfZ2VvbWV0cnkodGhpcy5fb2Zmc2V0c09iamVjdCx0aGlzLm9mZnNldHMpO1xuICAgICAgaWYgKHRoaXMuYXJlYUFjdGl2YXRpbmcpIHtcbiAgICAgICAgdGhpcy5zZXRBY3RpdmVBcmVhKHRoaXMuX29mZnNldHNPYmplY3QgfHwgbnVsbCk7XG4gICAgICB9XG4gICAgfWVsc2V7XG4gICAgICB0aGlzLl9vZmZzZXRzT2JqZWN0ID0gbnVsbDtcbiAgICB9XG5cblxuXG4gICAgdGhpcy5yZW5kZXJBbGwoKTtcbiAgfSxcbiAgc2V0QXJlYXM6IGZ1bmN0aW9uIChhcmVhcywgY2FsbGJhY2spIHtcbiAgICB0aGlzLl9hcmVhc09iamVjdHMgPSBbXTtcbiAgICBhcmVhcyA9IGFyZWFzIHx8IFtdO1xuICAgIGlmICh0aGlzLmFyZWFzKSB7XG4gICAgICBmb3IgKHZhciBpID0gdGhpcy5hcmVhcy5sZW5ndGg7IGktLTspIHtcbiAgICAgICAgdGhpcy5yZW1vdmVBcmVhKHRoaXMuYXJlYXNbaV0uaW5zdGFuY2UpO1xuICAgICAgfVxuICAgIH1cbiAgICB0aGlzLmFyZWFzID0gYXJlYXM7XG5cbiAgICB2YXIgY2IgPSBmYWJyaWMudXRpbC5xdWV1ZUxvYWQoYXJlYXMubGVuZ3RoICsgMSwgZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKHRoaXMuYXJlYUFjdGl2YXRpbmcpIHtcbiAgICAgICAgdGhpcy5zZXRBY3RpdmVBcmVhKHRoaXMuX2FyZWFzT2JqZWN0c1swXSB8fCBudWxsKTtcbiAgICAgIH1cblxuICAgICAvKiB2YXIgb2JqcyA9IHRoaXMuZ2V0T2JqZWN0cygpO1xuLy93b3JrIHdpdGggb2JqZWN0XG4gICAgICBpZiAoIWFyZWFzLmxlbmd0aCkge1xuICAgICAgICBvYmpzLmxlbmd0aCAmJiB0aGlzLmNsZWFyKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvKiB0b2RvIDog0L/RgNC40LzQtdC90LjRgtGMINGC0LXQutGD0YnRg9GOINC30L7QvdGDINC60L4g0LLRgdC10Lwg0L7QsdGK0LXQutGC0LDQvFxuICAgICAgICAgdmFyIF9hcmVhID0gdGhpcy5hY3RpdmVBcmVhIHx8IHRoaXMubGF5ZXJzLmJhY2tncm91bmQub2JqZWN0c1swXTtcbiAgICAgICAgIGZvciAodmFyIGkgaW4gb2Jqcykge1xuICAgICAgICAgdmFyIG9iaiA9IG9ianNbaV07XG4gICAgICAgICBvYmouY2xpcFRvID0gX2FyZWE7XG4gICAgICAgICBvYmouc2V0TW92ZW1lbnRMaW1pdHMoX2FyZWEpO1xuICAgICAgICAgb2JqLnNldENvb3JkcygpO1xuICAgICAgICAgfSovXG4gICAgICAvL30qL1xuICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2suY2FsbCh0aGlzKTtcbiAgICB9LmJpbmQodGhpcykpO1xuXG4gICAgZm9yICh2YXIgaSBpbiBhcmVhcykge1xuICAgICAgaWYgKCFhcmVhc1tpXS5pZCkge1xuICAgICAgICBhcmVhc1tpXS5pZCA9IFwiX19cIiArIGk7XG4gICAgICB9XG4gICAgICB0aGlzLmNyZWF0ZUFyZWEoYXJlYXNbaV0sIGNiKTtcbiAgICB9XG4gICAgY2IoKTtcblxuICAgIHRoaXMucmVuZGVyQWxsKCk7XG4gIH1cbn0pO1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUsIHtcbiAgZGVmYXVsdE9wdGlvbnM6IGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLlNsaWRlQ2FudmFzLnByb3RvdHlwZS5kZWZhdWx0T3B0aW9ucyx7XG4gICAgLy9vZmZzZXRzOiB7bGVmdCA6IDAsdG9wIDogMCwgcmlnaHQ6IDAsIGJvdHRvbTowfVxuICB9KSxcbiAgZXZlbnRMaXN0ZW5lcnM6IGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmRBcnJheXNPYmplY3QoZmFicmljLlNsaWRlQ2FudmFzLnByb3RvdHlwZS5ldmVudExpc3RlbmVycywge1xuICAgIFwiYmVmb3JlOmRyb3BcIjogZnVuY3Rpb24oZSl7XG4gICAgICAvL3RvZG87XG4gICAgICBpZighdGhpcy5fYmFja2dyb3VuZExheWVyKXtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdmFyIHBvaW50ZXIgPSB0aGlzLmdldFBvaW50ZXIoZS5vcmlnaW5hbEV2ZW50LCB0cnVlKTtcbiAgICAgIHZhciB0YXJnZXQgPSB0aGlzLl9zZWFyY2hQb3NzaWJsZVRhcmdldHModGhpcy5fYmFja2dyb3VuZExheWVyLCBwb2ludGVyKTtcbiAgICAgIGlmICh0YXJnZXQpIHtcbiAgICAgICAgdGhpcy5zZXRBY3RpdmVBcmVhKHRhcmdldCk7XG4gICAgICAgIGUuZGF0YS5jbGlwVG8gPSBcIiNcIiArIHRhcmdldC5pZDtcbiAgICAgICAgZS5kYXRhLm1vdmVtZW50TGltaXRzID0gXCIjXCIgKyB0YXJnZXQuaWQ7XG4gICAgICB9XG4gICAgfVxuICB9KVxufSlcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvbW9kdWxlcy9zbGlkZS5hcmVhcy5qcyIsIm1vZHVsZS5leHBvcnRzID0gJDtcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyBleHRlcm5hbCBcIiRcIlxuLy8gbW9kdWxlIGlkID0gOVxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCIvLyBNYWdpYyBXYW5kIChGdXp6eSBTZWxlY3Rpb24gVG9vbCkgZm9yIEphdmFzY3JpcHRcbi8vXG4vLyBUaGUgTUlUIExpY2Vuc2UgKE1JVClcbi8vXG4vLyBDb3B5cmlnaHQgKGMpIDIwMTQsIFJ5YXNub3kgUGF1bCAocnlhc25veXBhdWxAZ21haWwuY29tKVxuLy9cbi8vIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcbi8vIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlIFwiU29mdHdhcmVcIiksIHRvIGRlYWxcbi8vIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHNcbi8vIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGxcbi8vIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpc1xuLy8gZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczpcbi8vXG4vLyBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpblxuLy8gYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuXG4vL1xuLy8gVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxuLy8gSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXG4vLyBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcbi8vIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcbi8vIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXG4vLyBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOXG4vLyBUSEUgU09GVFdBUkUuXG5cbnZhciBNYWdpY1dhbmQgPSAoZnVuY3Rpb24gKCkge1xuICB2YXIgbGliID0ge307XG4gIC8vdmFyIGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIik7XG4gIC8vdmFyIGNvbnRleHQgPSBjYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpO1xuXG4gIGZ1bmN0aW9uIGNyZWF0ZUNhbnZhc0VsZW1lbnQoKXtcbiAgICBpZih0eXBlb2YgQ2FudmFzICE9PSBcInVuZGVmaW5lZFwiKXtcbiAgICAgIHJldHVybiBuZXcgQ2FudmFzO1xuICAgIH1cbiAgICByZXR1cm4gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIFNlbGVjdGlvbk1hc2sodyxoLGRhdGEpe1xuICAgIGlmKGFyZ3VtZW50cy5sZW5ndGggPT0gMSl7XG4gICAgICBmb3IodmFyIGkgaW4gYXJndW1lbnRzWzBdICl7XG4gICAgICAgIHRoaXNbaV0gPSBhcmd1bWVudHNbMF1baV07XG4gICAgICB9XG4gICAgfWVsc2V7XG4gICAgICB0aGlzLmRhdGEgPSBuZXcgVWludDhBcnJheShkYXRhIHx8IHcgKiBoKTtcbiAgICAgIHRoaXMud2lkdGggID0gdztcbiAgICAgIHRoaXMuaGVpZ2h0ID0gaDtcbiAgICAgIHRoaXMuY291bnQgID0gMDtcbiAgICAgIHRoaXMuYm91bmRzID0ge1xuICAgICAgIG1pblg6IEluZmluaXR5LFxuICAgICAgIG1pblk6IEluZmluaXR5LFxuICAgICAgIG1heFk6IC0xLFxuICAgICAgIG1heFg6IC0xXG4gICAgICB9O1xuICAgICAgLy8gdGhpcy5ib3VuZHMgPSB7XG4gICAgICAvLyAgIG1pblg6IDAsXG4gICAgICAvLyAgIG1pblk6IDAsXG4gICAgICAvLyAgIG1heFk6IGgsXG4gICAgICAvLyAgIG1heFg6IHdcbiAgICAgIC8vIH07XG4gICAgfVxuICB9XG4gIGxpYi5TZWxlY3Rpb25NYXNrID0gU2VsZWN0aW9uTWFzaztcblxuXG4gIFNlbGVjdGlvbk1hc2sucHJvdG90eXBlLmRlYnVnID0gZnVuY3Rpb24oKXtcbiAgICB2YXIgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKTtcbiAgICBjYW52YXMud2lkdGggPSB0aGlzLndpZHRoO1xuICAgIGNhbnZhcy5oZWlnaHQgPSB0aGlzLmhlaWdodDtcbiAgICB2YXIgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gICAgdGhpcy5yZW5kZXIoY3R4LHtcbiAgICAgIGZpbGwgOiBcIiNmZmZcIixcbiAgICAgIG91dGVyRmlsbCA6IFwiIzAwMFwiXG4gICAgfSk7XG4gICAgY3R4LmRlYnVnKCk7XG4gIH07XG5cbiAgU2VsZWN0aW9uTWFzay5wcm90b3R5cGUubWFrZUNhY2hlID0gZnVuY3Rpb24ob3B0aW9ucyApe1xuICAgIHRoaXMuY2FjaGUgPSBjcmVhdGVDYW52YXNFbGVtZW50KCk7XG4gICAgdGhpcy5jYWNoZS53aWR0aCA9IHRoaXMuYm91bmRzLm1heFgtIHRoaXMuYm91bmRzLm1pblggKyAxO1xuICAgIHRoaXMuY2FjaGUuaGVpZ2h0ID0gdGhpcy5ib3VuZHMubWF4WS0gdGhpcy5ib3VuZHMubWluWSArIDE7XG4gICAgdGhpcy5jb250ZXh0ID0gdGhpcy5jYWNoZS5nZXRDb250ZXh0KCcyZCcpO1xuXG4gICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge31cbiAgICB0aGlzLnJlbmRlcih0aGlzLmNvbnRleHQse1xuICAgICAgZmlsbCA6IFwiI2ZmZlwiLFxuICAgICAgb3V0ZXJGaWxsIDogXCIjMDAwXCIsXG4gICAgICBjYWNoZTogZmFsc2UsXG4gICAgICBsZWZ0IDotdGhpcy5ib3VuZHMubWluWCxcbiAgICAgIHRvcCA6LXRoaXMuYm91bmRzLm1pbllcbiAgICB9KTtcblxuICB9O1xuXG4gIFNlbGVjdGlvbk1hc2sucHJvdG90eXBlLmFkZCA9IGZ1bmN0aW9uIChtYXNrKSB7XG4gICAgdmFyIGluZGV4LCB4LCB5O1xuICAgIGZvciAoeCA9IG1hc2suYm91bmRzLm1pblg7IHggPD0gbWFzay5ib3VuZHMubWF4WDsgeCsrKSB7XG4gICAgICBmb3IgKHkgPSBtYXNrLmJvdW5kcy5taW5ZOyB5IDw9IG1hc2suYm91bmRzLm1heFk7IHkrKykge1xuICAgICAgICBpbmRleCA9IG1hc2sud2lkdGggKiB5ICsgeDtcbiAgICAgICAgaWYgKCBtYXNrLmRhdGFbaW5kZXhdICYmICF0aGlzLmRhdGFbaW5kZXhdKXtcbiAgICAgICAgICB0aGlzLmRhdGFbaW5kZXhdID0gMTtcbiAgICAgICAgICB0aGlzLmNvdW50Kys7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLmJvdW5kcy5taW5YID0gTWF0aC5taW4obWFzay5ib3VuZHMubWluWCwgdGhpcy5ib3VuZHMubWluWCk7XG4gICAgdGhpcy5ib3VuZHMubWF4WCA9IE1hdGgubWF4KG1hc2suYm91bmRzLm1heFgsIHRoaXMuYm91bmRzLm1heFgpO1xuICAgIHRoaXMuYm91bmRzLm1pblkgPSBNYXRoLm1pbihtYXNrLmJvdW5kcy5taW5ZLCB0aGlzLmJvdW5kcy5taW5ZKTtcbiAgICB0aGlzLmJvdW5kcy5tYXhZID0gTWF0aC5tYXgobWFzay5ib3VuZHMubWF4WSwgdGhpcy5ib3VuZHMubWF4WSk7XG4gIH07XG4gIGZ1bmN0aW9uIGhleFRvUmdiKGhleCkge1xuICAgIC8vIEV4cGFuZCBzaG9ydGhhbmQgZm9ybSAoZS5nLiBcIjAzRlwiKSB0byBmdWxsIGZvcm0gKGUuZy4gXCIwMDMzRkZcIilcbiAgICB2YXIgc2hvcnRoYW5kUmVnZXggPSAvXiM/KFthLWZcXGRdKShbYS1mXFxkXSkoW2EtZlxcZF0pJC9pO1xuICAgIGhleCA9IGhleC5yZXBsYWNlKHNob3J0aGFuZFJlZ2V4LCBmdW5jdGlvbihtLCByLCBnLCBiKSB7XG4gICAgICByZXR1cm4gciArIHIgKyBnICsgZyArIGIgKyBiO1xuICAgIH0pO1xuXG4gICAgdmFyIHJlc3VsdCA9IC9eIz8oW2EtZlxcZF17Mn0pKFthLWZcXGRdezJ9KShbYS1mXFxkXXsyfSkkL2kuZXhlYyhoZXgpO1xuICAgIHJldHVybiByZXN1bHQgPyB7XG4gICAgICByOiBwYXJzZUludChyZXN1bHRbMV0sIDE2KSxcbiAgICAgIGc6IHBhcnNlSW50KHJlc3VsdFsyXSwgMTYpLFxuICAgICAgYjogcGFyc2VJbnQocmVzdWx0WzNdLCAxNilcbiAgICB9IDogbnVsbDtcbiAgfVxuXG4gIFNlbGVjdGlvbk1hc2sucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uKGN0eCxvcHRpb25zICl7XG4gICAgaWYoIXRoaXMuY291bnQpcmV0dXJuO1xuXG4gICAgb3B0aW9ucyAgICAgICAgICAgICA9IG9wdGlvbnMgICAgICAgICAgICAgfHwge307XG4gICAgb3B0aW9ucy5sZWZ0ICAgICAgICA9IG9wdGlvbnMubGVmdCAgICAgICAgfHwgMCA7XG4gICAgb3B0aW9ucy50b3AgICAgICAgICA9IG9wdGlvbnMudG9wICAgICAgICAgfHwgMCA7XG4gICAgb3B0aW9ucy5maWxsICAgICAgICA9IG9wdGlvbnMuZmlsbCAgICAgICAgfHwgZmFsc2UgOy8vIFswLDAsMCwwXTtcbiAgICBvcHRpb25zLmludGVyc2VjdGlvbkNvbG9yID0gb3B0aW9ucy5pbnRlcnNlY3Rpb25Db2xvciB8fGZhbHNlIDsvLyAgWzAsMCwwLDBdO1xuXG4gICAgb3B0aW9ucy5vdXRlckZpbGwgICAgICAgID0gb3B0aW9ucy5vdXRlckZpbGwgICAgICAgIHx8IGZhbHNlIDsvLyBbMCwwLDAsMF07XG4gICAgb3B0aW9ucy5vdXRlckludGVyc2VjdGlvbkNvbG9yID0gb3B0aW9ucy5vdXRlckludGVyc2VjdGlvbkNvbG9yIHx8ZmFsc2UgOy8vICBbMCwwLDAsMF07XG5cbiAgICAvL2lmKHRoaXMuY2FjaGUgJiYgb3B0aW9ucy5jYWNoZSAhPT0gZmFsc2Upe1xuICAgIC8vXG4gICAgLy8gIHZhciBfY3R4ID0gdGhpcy5jb250ZXh0O1xuICAgIC8vICBfY3R4LnNhdmUoKTtcbiAgICAvLyAgX2N0eC5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb249XCJzb3VyY2UtaW5cIjtcbiAgICAvLyAgX2N0eC5maWxsU3R5bGU9IG9wdGlvbnMuZmlsbDtcbiAgICAvLyAgX2N0eC5maWxsUmVjdCgwLDAsdGhpcy5jYWNoZS53aWR0aCx0aGlzLmNhY2hlLmhlaWdodCk7XG4gICAgLy8gIF9jdHgucmVzdG9yZSgpO1xuICAgIC8vXG4gICAgLy8gIGN0eC5zYXZlKCk7XG4gICAgLy8gIGN0eC5nbG9iYWxBbHBoYSA9IG9wdGlvbnMub3BhY2l0eTtcbiAgICAvLyAgY3R4LmRyYXdJbWFnZSh0aGlzLmNhY2hlLHRoaXMuYm91bmRzLm1pblgsdGhpcy5ib3VuZHMubWluWSlcbiAgICAvLyAgY3R4LnJlc3RvcmUoKTtcbiAgICAvLyAgcmV0dXJuO1xuICAgIC8vfVxuXG4gICAgLy90b2RvIGRvIG5vdCB1c2UgZmFicmljIGhlcmUhXG4gICAgZnVuY3Rpb24gY29udmVydENvbG9yKGNvbG9yKXtcbiAgICAgIGlmKGNvbG9yLmNvbnN0cnVjdG9yICA9PSBTdHJpbmcgKXtcbiAgICAgICAgaWYoY29sb3JbMF0gPT0gXCIjXCIpe1xuICAgICAgICAgIHZhciBfcmdiID0gaGV4VG9SZ2IoY29sb3IpO1xuICAgICAgICAgIHJldHVybiBbX3JnYi5yLF9yZ2IuZyxfcmdiLmIsMjU1XTtcbiAgICAgICAgfVxuICAgICAgICBjb2xvciA9IG5ldyBmYWJyaWMuQ29sb3IoY29sb3IpLl9zb3VyY2U7XG4gICAgICAgIGNvbG9yWzNdICo9IDI1NTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBjb2xvcjtcbiAgICB9XG5cbiAgICB2YXIgX3cgPSB0aGlzLmJvdW5kcy5tYXhYIC0gdGhpcy5ib3VuZHMubWluWCArIDE7XG4gICAgdmFyIF9oID0gdGhpcy5ib3VuZHMubWF4WSAtIHRoaXMuYm91bmRzLm1pblkgKyAxO1xuXG4gICAgLy92YXIgaW1nRGF0YSA9IGN0eC5nZXRJbWFnZURhdGEob3B0aW9ucy5sZWZ0LG9wdGlvbnMudG9wLF93LF9oKTtcbiAgICB2YXIgaW1nRGF0YSA9IGN0eC5nZXRJbWFnZURhdGEodGhpcy5ib3VuZHMubWluWCx0aGlzLmJvdW5kcy5taW5ZLF93LF9oKTtcblxuICAgIHZhciBjb2xvciAgPSBjb252ZXJ0Q29sb3Iob3B0aW9ucy5maWxsKTtcbiAgICB2YXIgY29sb3IyID0gY29udmVydENvbG9yKG9wdGlvbnMuaW50ZXJzZWN0aW9uQ29sb3IpO1xuICAgIHZhciBjb2xvcjMgPSBjb252ZXJ0Q29sb3Iob3B0aW9ucy5vdXRlckZpbGwpO1xuICAgIHZhciBjb2xvcjQgPSBjb252ZXJ0Q29sb3Iob3B0aW9ucy5vdXRlckludGVyc2VjdGlvbkNvbG9yKTtcblxuICAgIGZvcih2YXIgeCA9IHRoaXMuYm91bmRzLm1pblggOyB4IDw9IHRoaXMuYm91bmRzLm1heFg7eCsrICl7XG4gICAgICBmb3IodmFyIHkgPSB0aGlzLmJvdW5kcy5taW5ZIDsgeSA8PSB0aGlzLmJvdW5kcy5tYXhZOyB5KysgKXtcbiAgICAgICAgdmFyIGluZGV4ID0gdGhpcy53aWR0aCAqIHkgKyB4O1xuICAgICAgICB2YXIgaW5kZXhfc21hbGwgPSBfdyAqICh5IC0gKHRoaXMuYm91bmRzLm1pblkpKSArIHggLSAodGhpcy5ib3VuZHMubWluWCk7XG5cbiAgICAgICAgaWYodGhpcy5kYXRhW2luZGV4XSApe1xuICAgICAgICAgIHZhciBfY29sb3IgPSBpbWdEYXRhLmRhdGFbaW5kZXhfc21hbGwgKiA0ICsgM10/IGNvbG9yMiA6IGNvbG9yIDtcbiAgICAgICAgICBpZighX2NvbG9yKWNvbnRpbnVlO1xuXG4gICAgICAgICAgaW1nRGF0YS5kYXRhW2luZGV4X3NtYWxsICogNCBdICAgID0gX2NvbG9yWzBdO1xuICAgICAgICAgIGltZ0RhdGEuZGF0YVtpbmRleF9zbWFsbCAqIDQgKyAxXSA9IF9jb2xvclsxXTtcbiAgICAgICAgICBpbWdEYXRhLmRhdGFbaW5kZXhfc21hbGwgKiA0ICsgMl0gPSBfY29sb3JbMl07XG4gICAgICAgICAgaW1nRGF0YS5kYXRhW2luZGV4X3NtYWxsICogNCArIDNdID0gX2NvbG9yWzNdO1xuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICB2YXIgX2NvbG9yID0gaW1nRGF0YS5kYXRhW2luZGV4X3NtYWxsICogNCArIDNdPyBjb2xvcjQgOiBjb2xvcjMgO1xuICAgICAgICAgIGlmKCFfY29sb3IpY29udGludWU7XG5cbiAgICAgICAgICBpbWdEYXRhLmRhdGFbaW5kZXhfc21hbGwgKiA0IF0gICAgPSBfY29sb3JbMF07XG4gICAgICAgICAgaW1nRGF0YS5kYXRhW2luZGV4X3NtYWxsICogNCArIDFdID0gX2NvbG9yWzFdO1xuICAgICAgICAgIGltZ0RhdGEuZGF0YVtpbmRleF9zbWFsbCAqIDQgKyAyXSA9IF9jb2xvclsyXTtcbiAgICAgICAgICBpbWdEYXRhLmRhdGFbaW5kZXhfc21hbGwgKiA0ICsgM10gPSBfY29sb3JbM107XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBjdHgucHV0SW1hZ2VEYXRhKGltZ0RhdGEsIG9wdGlvbnMubGVmdCAgLCBvcHRpb25zLnRvcCAgKTtcbiAgICBjdHgucHV0SW1hZ2VEYXRhKGltZ0RhdGEsIHRoaXMuYm91bmRzLm1pblgsdGhpcy5ib3VuZHMubWluWSAgKTtcbiAgfTtcblxuXG4gIC8qKlxuICAgKiBnZXQgYXJyYXkgd2l0aCBiZWdpbiBhbmQgZW5kIGluZGljZXMgb2YgZmlsbGVkIDEgaW50ZXJ2YWxzXG4gICAqIEBwYXJhbSBjdHhcbiAgICogQHBhcmFtIG9wdGlvbnNcbiAgICogQHJldHVybnMge0FycmF5fVxuICAgKi9cbiAgU2VsZWN0aW9uTWFzay5wcm90b3R5cGUuZ2V0SW50ZXJ2YWxzQXJyYXkgPSBmdW5jdGlvbiAoY3R4LCBvcHRpb25zKSB7XG4gICAgdmFyIF9uZXdEYXRhID0gW107XG4gICAgZm9yICh2YXIgaSA9IDAsIF92YWwgPSAwOyBpIDwgYXJyYXkubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmIChfdmFsICE9IGFycmF5W2ldKSB7XG4gICAgICAgIF9uZXdEYXRhLnB1c2goaSk7XG4gICAgICAgIF92YWwgPSBhcnJheVtpXTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIF9uZXdEYXRhO1xuICB9O1xuXG4gIFNlbGVjdGlvbk1hc2sucHJvdG90eXBlLnJlbmRlckJvcmRlciA9IGZ1bmN0aW9uIChjdHgsIG9wdGlvbnMpIHtcblxuICAgIG9wdGlvbnMgICAgICAgICAgICAgPSBvcHRpb25zICAgICAgICAgICAgIHx8IHt9O1xuICAgIG9wdGlvbnMubGVmdCAgICAgICAgPSBvcHRpb25zLmxlZnQgICAgICAgIHx8IDAgO1xuICAgIG9wdGlvbnMudG9wICAgICAgICAgPSBvcHRpb25zLnRvcCAgICAgICAgIHx8IDAgO1xuICAgIG9wdGlvbnMuaGF0Y2hPZmZzZXQgPSBvcHRpb25zLmhhdGNoT2Zmc2V0IHx8IDAgO1xuICAgIG9wdGlvbnMuaGF0Y2hMZW5ndGggPSBvcHRpb25zLmhhdGNoTGVuZ3RoIHx8IDQgO1xuICAgIG9wdGlvbnMub3BhY2l0eSA9IG9wdGlvbnMub3BhY2l0eSB8fCAxIDtcblxuICAgIHZhciBpbWdEYXRhID0gY3R4LmdldEltYWdlRGF0YSgwLDAsdGhpcy53aWR0aCx0aGlzLmhlaWdodCk7XG5cbiAgICBpZighdGhpcy5jYWNoZUluZCl7XG4gICAgICB0aGlzLmNhY2hlSW5kID0gTWFnaWNXYW5kLmdldEJvcmRlckluZGljZXModGhpcyk7XG4gICAgfVxuXG4gICAgdmFyIHgsIHksIGksIGosIGssXG4gICAgICB3ID0gaW1nRGF0YS53aWR0aCxcbiAgICAgIGggPSBpbWdEYXRhLmhlaWdodDtcbiAgICB2YXIgcmVzID0gaW1nRGF0YS5kYXRhO1xuXG4gICAgdmFyIGxlbiA9IHRoaXMuY2FjaGVJbmQubGVuZ3RoO1xuICAgIGZvciAoaiA9IDA7IGogPCBsZW47IGorKykge1xuICAgICAgaSA9IHRoaXMuY2FjaGVJbmRbal07XG4gICAgICB4ID0gaSAlIHc7IC8vIGNhbGMgeCBieSBpbmRleFxuICAgICAgeSA9IChpIC0geCkgLyB3OyAvLyBjYWxjIHkgYnkgaW5kZXhcbiAgICAgIGsgPSAoeSAqIHcgKyB4KSAqIDQ7XG5cbiAgICAgIGlmICgoeCArIHkgKyBvcHRpb25zLmhhdGNoT2Zmc2V0KSAlIChvcHRpb25zLmhhdGNoTGVuZ3RoICogMikgPCBvcHRpb25zLmhhdGNoTGVuZ3RoKSB7IC8vIGRldGVjdCBoYXRjaCBjb2xvclxuXG4gICAgICAgIHJlc1trXSA9IDA7XG4gICAgICAgIHJlc1trICsgMV0gPSAwO1xuICAgICAgICByZXNbayArIDJdID0gMDtcbiAgICAgICAgcmVzW2sgKyAzXSA9IDI1NTsgLy8gYmxhY2ssIGNoYW5nZSBvbmx5IGFscGhhXG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXNba10gPSAyNTU7IC8vIHdoaXRlXG4gICAgICAgIHJlc1trICsgMV0gPSAyNTU7XG4gICAgICAgIHJlc1trICsgMl0gPSAyNTU7XG4gICAgICAgIHJlc1trICsgM10gPSAyNTU7XG4gICAgICB9XG4gICAgfVxuICAgIGN0eC5zYXZlKCk7XG4gICAgY3R4Lmdsb2JhbEFscGhhID0gb3B0aW9ucy5vcGFjaXR5O1xuICAgIGN0eC5wdXRJbWFnZURhdGEoaW1nRGF0YSwgb3B0aW9ucy5sZWZ0IHx8IDAgLCBvcHRpb25zLnRvcCB8fCAwICk7XG4gICAgY3R4LnJlc3RvcmUoKTtcbiAgfTtcblxuXG4gIGxpYi5jcmVhdGVNYXNrID0gZnVuY3Rpb24gKHcsIGgsZGF0YSkge1xuICAgIHJldHVybiBuZXcgU2VsZWN0aW9uTWFzayh3LGgsZGF0YSk7XG4gIH07XG5cbiAgbGliLmRpZmZlcmVuY2UgPSBmdW5jdGlvbiAoYSwgYikge1xuICAgIHJldHVybiBNYXRoLm1heChcbiAgICAgIGJbMF0gIT09IGZhbHNlID8gTWF0aC5hYnMoYlswXSAtIGFbMF0pOiAwLFxuICAgICAgYlsxXSAhPT0gZmFsc2UgPyBNYXRoLmFicyhiWzFdIC0gYVsxXSk6IDAsXG4gICAgICBiWzJdICE9PSBmYWxzZSA/IE1hdGguYWJzKGJbMl0gLSBhWzJdKTogMCxcbiAgICAgIGJbM10gIT09IGZhbHNlID8gTWF0aC5hYnMoYlszXSAtIGFbM10pOiAwKTtcbiAgfTtcblxuICBsaWIuYWNjZXB0YWJsZSA9IGZ1bmN0aW9uICh4LCB5LCBpbWFnZSwgdmlzaXRlZCwgc2FtcGxlQ29sb3IsIGNvbG9yVGhyZXNob2xkKSB7XG4vLyBjaGVjayB3aGV0aGVyIHRoZSBwb2ludCBoYXMgYmVlbiB2aXNpdGVkXG4gICAgaWYgKHZpc2l0ZWRbeSAqIGltYWdlLndpZHRoICsgeF0gPT09IDEpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgdmFyIGkgPSAoeSAqIGltYWdlLndpZHRoICsgeCkgKiBsaWIuYnl0ZXMsXG4gICAgICBjb2xvcjIgPSBbaW1hZ2UuZGF0YVtpXSwgaW1hZ2UuZGF0YVtpICsgMV0sIGltYWdlLmRhdGFbaSArIDJdLCBpbWFnZS5kYXRhW2kgKyAzXV07XG5cblxuICAgIGlmIChzYW1wbGVDb2xvclswXSAhPT0gZmFsc2UgJiYgTWF0aC5hYnMoc2FtcGxlQ29sb3JbMF0gLSBjb2xvcjJbMF0pID4gY29sb3JUaHJlc2hvbGQpcmV0dXJuIGZhbHNlO1xuICAgIGlmIChzYW1wbGVDb2xvclsxXSAhPT0gZmFsc2UgJiYgTWF0aC5hYnMoc2FtcGxlQ29sb3JbMV0gLSBjb2xvcjJbMV0pID4gY29sb3JUaHJlc2hvbGQpcmV0dXJuIGZhbHNlO1xuICAgIGlmIChzYW1wbGVDb2xvclsyXSAhPT0gZmFsc2UgJiYgTWF0aC5hYnMoc2FtcGxlQ29sb3JbMl0gLSBjb2xvcjJbMl0pID5jb2xvclRocmVzaG9sZClyZXR1cm4gZmFsc2U7XG4gICAgaWYgKHNhbXBsZUNvbG9yWzNdICE9PSBmYWxzZSAmJiBNYXRoLmFicyhzYW1wbGVDb2xvclszXSAtIGNvbG9yMlszXSkgPiBjb2xvclRocmVzaG9sZClyZXR1cm4gZmFsc2U7XG4gICAgcmV0dXJuIHRydWU7XG4gIH07XG5cbiAgbGliLnNlbGVjdEFsbCA9IGZ1bmN0aW9uIChpbWFnZSwgcHgsIHB5LCBjb2xvclRocmVzaG9sZCkge1xuICAgIHZhciBpID0gKHB5ICogaW1hZ2Uud2lkdGggKyBweCkgKiBsaWIuYnl0ZXMsXG4gICAgICBkYXRhID0gaW1hZ2UuZGF0YSxcbiAgICAgIHNhbXBsZUNvbG9yID0gW2RhdGFbaV0sIGRhdGFbaSArIDFdLCBkYXRhW2kgKyAyXSwgZGF0YVtpICsgM11dOyAvLyBzdGFydCBwb2ludCBjb2xvciAoc2FtcGxlKVxuICAgIHJldHVybiBsaWIuc2VsZWN0QWxsQnlDb2xvcihpbWFnZSwgc2FtcGxlQ29sb3IsIGNvbG9yVGhyZXNob2xkKVxuICB9O1xuXG5cbiAgLyoqXG4gICAqIENvbnZlcnRzIGFuIFJHQiBjb2xvciB2YWx1ZSB0byBIU0wuIENvbnZlcnNpb24gZm9ybXVsYVxuICAgKiBhZGFwdGVkIGZyb20gaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9IU0xfY29sb3Jfc3BhY2UuXG4gICAqIEFzc3VtZXMgciwgZywgYW5kIGIgYXJlIGNvbnRhaW5lZCBpbiB0aGUgc2V0IFswLCAyNTVdIGFuZFxuICAgKiByZXR1cm5zIGgsIHMsIGFuZCBsIGluIHRoZSBzZXQgWzAsIDFdLlxuICAgKlxuICAgKiBAcGFyYW0gICBOdW1iZXIgIHIgICAgICAgVGhlIHJlZCBjb2xvciB2YWx1ZVxuICAgKiBAcGFyYW0gICBOdW1iZXIgIGcgICAgICAgVGhlIGdyZWVuIGNvbG9yIHZhbHVlXG4gICAqIEBwYXJhbSAgIE51bWJlciAgYiAgICAgICBUaGUgYmx1ZSBjb2xvciB2YWx1ZVxuICAgKiBAcmV0dXJuICBBcnJheSAgICAgICAgICAgVGhlIEhTTCByZXByZXNlbnRhdGlvblxuICAgKi9cbiAgbGliLnJnYlRvSHNsID0gZnVuY3Rpb24ociwgZywgYil7XG4gICAgciAvPSAyNTUsIGcgLz0gMjU1LCBiIC89IDI1NTtcbiAgICB2YXIgbWF4ID0gTWF0aC5tYXgociwgZywgYiksIG1pbiA9IE1hdGgubWluKHIsIGcsIGIpO1xuICAgIHZhciBoLCBzLCBsID0gKG1heCArIG1pbikgLyAyO1xuXG4gICAgaWYobWF4ID09IG1pbil7XG4gICAgICBoID0gcyA9IDA7IC8vIGFjaHJvbWF0aWNcbiAgICB9ZWxzZXtcbiAgICAgIHZhciBkID0gbWF4IC0gbWluO1xuICAgICAgcyA9IGwgPiAwLjUgPyBkIC8gKDIgLSBtYXggLSBtaW4pIDogZCAvIChtYXggKyBtaW4pO1xuICAgICAgc3dpdGNoKG1heCl7XG4gICAgICAgIGNhc2UgcjogaCA9IChnIC0gYikgLyBkICsgKGcgPCBiID8gNiA6IDApOyBicmVhaztcbiAgICAgICAgY2FzZSBnOiBoID0gKGIgLSByKSAvIGQgKyAyOyBicmVhaztcbiAgICAgICAgY2FzZSBiOiBoID0gKHIgLSBnKSAvIGQgKyA0OyBicmVhaztcbiAgICAgIH1cbiAgICAgIGggLz0gNjtcbiAgICB9XG5cbiAgICByZXR1cm4gW2gsIHMsIGxdO1xuICB9XG5cbiAgbGliLnNlbGVjdENvbG9yZWQgPSBmdW5jdGlvbiAoaW1hZ2UsIG9wdGlvbnMpIHtcblxuICAgIHZhciBtYXNrID0gbmV3IFNlbGVjdGlvbk1hc2soaW1hZ2Uud2lkdGgsIGltYWdlLmhlaWdodCk7XG5cbiAgICBtYXNrLmJvdW5kcyA9IHtcbiAgICAgIG1pblg6IGltYWdlLndpZHRoLFxuICAgICAgbWluWTogaW1hZ2UuaGVpZ2h0LFxuICAgICAgbWF4WTogLTEsXG4gICAgICBtYXhYOiAtMVxuICAgIH07XG5cbiAgICB2YXIgeCwgeTtcbiAgICBmb3IgKHkgPSAwOyB5IDwgaW1hZ2UuaGVpZ2h0OyB5KyspIHtcbiAgICAgIGZvciAoeCA9IDA7IHggPCBpbWFnZS53aWR0aDsgeCsrKSB7XG4gICAgICAgIHZhciBpbmRleCA9ICh5ICogaW1hZ2Uud2lkdGggKyB4KTtcbiAgICAgICAgdmFyIGkgPSBpbmRleCAqIGxpYi5ieXRlcztcbiAgICAgICAgLy9pZiAoIWltYWdlLmRhdGFbaSArIDNdKSBjb250aW51ZTtcblxuXG4gICAgICAgIGlmIChvcHRpb25zLmFNaW4gJiYgaW1hZ2UuZGF0YVtpICsgM10gPCBvcHRpb25zLmFNaW4pY29udGludWU7XG5cbiAgICAgICAgdmFyIGhzbCA9IHJnYlRvSHNsKGltYWdlLmRhdGFbaV0sIGltYWdlLmRhdGFbaSArIDFdLCBpbWFnZS5kYXRhW2kgKyAyXSk7XG5cblxuICAgICAgICBpZiAob3B0aW9ucy5zTWluICYmIGhzbFsxXSA8IG9wdGlvbnMuc01pbiljb250aW51ZTtcbiAgICAgICAgaWYgKG9wdGlvbnMuc01heCAmJiBoc2xbMV0gPiBvcHRpb25zLnNNYXgpY29udGludWU7XG4gICAgICAgIGlmIChvcHRpb25zLmJNaW4gJiYgaHNsWzJdIDwgb3B0aW9ucy5iTWluKWNvbnRpbnVlO1xuICAgICAgICBpZiAob3B0aW9ucy5iTWF4ICYmIGhzbFsyXSA+IG9wdGlvbnMuYk1heCljb250aW51ZTtcblxuXG4gICAgICAgIG1hc2suZGF0YVtpbmRleF0gPSAxO1xuICAgICAgICBtYXNrLmNvdW50Kys7XG4gICAgICAgIG1hc2suYm91bmRzLm1pblggPSBNYXRoLm1pbihtYXNrLmJvdW5kcy5taW5YLCB4KTtcbiAgICAgICAgbWFzay5ib3VuZHMubWF4WCA9IE1hdGgubWF4KG1hc2suYm91bmRzLm1heFgsIHgpO1xuICAgICAgICBtYXNrLmJvdW5kcy5taW5ZID0gTWF0aC5taW4obWFzay5ib3VuZHMubWluWSwgeSk7XG4gICAgICAgIG1hc2suYm91bmRzLm1heFkgPSBNYXRoLm1heChtYXNrLmJvdW5kcy5tYXhZLCB5KTtcblxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbWFzaztcbiAgfTtcblxuXG5cblxuICBsaWIuc2VsZWN0QWxsQnlDb2xvciA9IGZ1bmN0aW9uIChjdHgsIHNhbXBsZUNvbG9yLCBjb2xvclRocmVzaG9sZCkge1xuICAgIHZhciBpbWFnZSA9IF9nZXRJbWFnZURhdGEoY3R4KTtcblxuICAgIHZhciBtYXNrID0gbmV3IFNlbGVjdGlvbk1hc2soaW1hZ2Uud2lkdGgsIGltYWdlLmhlaWdodCk7XG5cbiAgICBtYXNrLmJvdW5kcyA9IHtcbiAgICAgIG1pblg6IEluZmluaXR5LFxuICAgICAgbWluWTogSW5maW5pdHksXG4gICAgICBtYXhZOiAtMSxcbiAgICAgIG1heFg6IC0xXG4gICAgfTtcblxuXG4gICAgdmFyIHZpc2l0ZWQgPSBuZXcgVWludDhBcnJheSggaW1hZ2Uud2lkdGggKiBpbWFnZS5oZWlnaHQpO1xuICAgIHZhciB4LCB5O1xuICAgIGZvciAoeSA9IDA7IHkgPCBpbWFnZS5oZWlnaHQ7IHkrKykge1xuICAgICAgZm9yICh4ID0gMDsgeCA8IGltYWdlLndpZHRoOyB4KyspIHtcbiAgICAgICAgaWYobGliLmFjY2VwdGFibGUoeCwgeSwgaW1hZ2UsIG1hc2suZGF0YSwgc2FtcGxlQ29sb3IsIGNvbG9yVGhyZXNob2xkKSl7XG4gICAgICAgICAgTWFnaWNXYW5kLmZsb29kRmlsbChpbWFnZSwgeCwgeSwgY29sb3JUaHJlc2hvbGQsIHtcbiAgICAgICAgICAgIHNhbXBsZUNvbG9yOiAgICBzYW1wbGVDb2xvcixcbiAgICAgICAgICAgIGFjdGl2ZU1hc2sgOiAgICBtYXNrLFxuICAgICAgICAgICAgdmlzaXRlZFBvaW50cyA6IHZpc2l0ZWRcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbWFzaztcbiAgfTtcblxuXG5cbiAgbGliLmRyYXdJbWFnZSA9IGZ1bmN0aW9uIChjdHgsY2FudmFzLCBtYXNrICxsZWZ0LCB0b3ApIHtcblxuICAgIHZhciBjdHgyID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG5cblxuICAgIHZhciBpbWdEYXRhID0gY3R4LmdldEltYWdlRGF0YSgwLCAwLCBtYXNrLndpZHRoLCBtYXNrLmhlaWdodCk7XG4gICAgdmFyIGltZ0RhdGFPcmlnaW5hbCA9IGN0eDIuZ2V0SW1hZ2VEYXRhKGxlZnQsIHRvcCwgbWFzay53aWR0aCwgbWFzay5oZWlnaHQpO1xuXG5cbiAgICB2YXIgYiA9IG1hc2suYm91bmRzO1xuICAgIGZvciAodmFyIHggPSBiLm1pblg7IHggPD0gYi5tYXhYOyB4KyspZm9yICh2YXIgeSA9IGIubWluWTsgeSA8PSBiLm1heFk7IHkrKykge1xuICAgICAgdmFyIGkgPSAoeSAqIG1hc2sud2lkdGggKyB4KTsvLyAqIGJ5dGVzOyAvLyBwb2ludCBpbmRleCBpbiB0aGUgaW1hZ2UgZGF0YVxuICAgICAgaWYgKG1hc2suZGF0YVtpXSkge1xuICAgICAgICBpbWdEYXRhLmRhdGFbaSAqIDRdICAgICA9IGltZ0RhdGFPcmlnaW5hbC5kYXRhW2kgKiA0XTtcbiAgICAgICAgaW1nRGF0YS5kYXRhW2kgKiA0ICsgMV0gPSBpbWdEYXRhT3JpZ2luYWwuZGF0YVtpICogNCArIDFdO1xuICAgICAgICBpbWdEYXRhLmRhdGFbaSAqIDQgKyAyXSA9IGltZ0RhdGFPcmlnaW5hbC5kYXRhW2kgKiA0ICsgMl07XG4gICAgICAgIGltZ0RhdGEuZGF0YVtpICogNCArIDNdID0gaW1nRGF0YU9yaWdpbmFsLmRhdGFbaSAqIDQgKyAzXTtcbiAgICAgIH1cbiAgICB9XG4gICAgY3R4LnB1dEltYWdlRGF0YShpbWdEYXRhLDAsIDApO1xuICB9O1xuXG4gIGZ1bmN0aW9uIF9nZXRJbWFnZURhdGEoY3R4KXtcbiAgICBpZihjdHguY29uc3RydWN0b3IubmFtZSA9PSBcIkltYWdlRGF0YVwiKXtcbiAgICAgIHJldHVybiBjdHg7XG4gICAgfWVsc2V7XG4gICAgICByZXR1cm4gY3R4LmdldEltYWdlRGF0YSgwLCAwLCBjdHguY2FudmFzLndpZHRoLCBjdHguY2FudmFzLmhlaWdodCk7XG4gICAgfVxuICB9XG5cbiAgbGliLmZpbGxNYXNrID0gZnVuY3Rpb24gKGN0eCxtYXNrLCBjb2xvcikge1xuICAgIHZhciBpbWdEYXRhID0gX2dldEltYWdlRGF0YShjdHgpO1xuICAgIHZhciBiID0gbWFzay5ib3VuZHM7XG4gICAgdmFyIHcgPSBpbWdEYXRhLndpZHRoLFxuICAgICAgaCA9IGltZ0RhdGEuaGVpZ2h0O1xuXG4gICAgZm9yICh2YXIgeCA9IGIubWluWDsgeCA8PSBiLm1heFg7IHgrKylmb3IgKHZhciB5ID0gYi5taW5ZOyB5IDw9IGIubWF4WTsgeSsrKSB7XG4gICAgICB2YXIgaSA9ICh5ICogdyArIHgpOy8vICogYnl0ZXM7IC8vIHBvaW50IGluZGV4IGluIHRoZSBpbWFnZSBkYXRhXG4gICAgICBpZiAobWFzay5kYXRhW2ldKSB7XG4gICAgICAgIGltZ0RhdGEuZGF0YVtpICogNF0gICAgID0gY29sb3JbMF07XG4gICAgICAgIGltZ0RhdGEuZGF0YVtpICogNCArIDFdID0gY29sb3JbMV07XG4gICAgICAgIGltZ0RhdGEuZGF0YVtpICogNCArIDJdID0gY29sb3JbMl07XG4gICAgICAgIGltZ0RhdGEuZGF0YVtpICogNCArIDNdID0gY29sb3JbM107XG4gICAgICB9XG4gICAgfVxuICAgIGlmKGN0eC5jb25zdHJ1Y3Rvci5uYW1lICE9IFwiSW1hZ2VEYXRhXCIpIHtcbiAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgdywgaCk7XG4gICAgICBjdHgucHV0SW1hZ2VEYXRhKGltZ0RhdGEsIDAsIDApO1xuICAgIH1cbiAgfTtcblxuICBsaWIuc2VsZWN0QmFja2dyb3VuZCA9IGZ1bmN0aW9uIChjdHgsIHNhbXBsZUNvbG9yLCBjb2xvclRocmVzaG9sZCkge1xuICAgIHZhciBpbWFnZSA9IF9nZXRJbWFnZURhdGEoY3R4KTtcblxuICAgIGNvbG9yVGhyZXNob2xkID0gY29sb3JUaHJlc2hvbGQgfHwgMTU7XG5cbiAgICB2YXIgbWFzayA9IG5ldyBTZWxlY3Rpb25NYXNrKGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQpO1xuICAgIG1hc2suYm91bmRzID0ge1xuICAgICAgbWluWDogSW5maW5pdHksXG4gICAgICBtaW5ZOiBJbmZpbml0eSxcbiAgICAgIG1heFk6IC0xLFxuICAgICAgbWF4WDogLTFcbiAgICB9O1xuXG4gICAgdmFyIGRhdGEgPSBpbWFnZS5kYXRhO1xuXG4gICAgc2FtcGxlQ29sb3IgPSBzYW1wbGVDb2xvciB8fFtkYXRhWzBdLCBkYXRhWzFdLCBkYXRhWzJdLCBkYXRhWzNdXTsgLy8gc3RhcnQgcG9pbnQgY29sb3IgKHNhbXBsZSlcblxuICAgIHZhciBjb2xvciA9IHNhbXBsZUNvbG9yO1xuXG4gICAgZnVuY3Rpb24gYWRkKHgsIHkpIHtcbiAgICAgIGlmICghbGliLmFjY2VwdGFibGUoeCwgeSwgaW1hZ2UsIG1hc2suZGF0YSwgc2FtcGxlQ29sb3IsIGNvbG9yVGhyZXNob2xkKSlyZXR1cm47XG4gICAgICBpZiAoIXNhbXBsZUNvbG9yKSB7XG4gICAgICAgIHZhciBpbmRleCA9ICh5ICogaW1hZ2Uud2lkdGggKyB4KSAqIDQ7XG4gICAgICAgIGNvbG9yID0gW2RhdGFbaW5kZXhdLCBkYXRhW2luZGV4ICsgMV0sIGRhdGFbaW5kZXggKyAyXSwgZGF0YVtpbmRleCArIDNdXTtcbiAgICAgIH1cbiAgICAgIHZhciBtYXNrMiA9IE1hZ2ljV2FuZC5mbG9vZEZpbGwoaW1hZ2UsIHgsIHksIGNvbG9yVGhyZXNob2xkLCBudWxsLCBjb2xvcik7XG4gICAgICBtYXNrID0gTWFnaWNXYW5kLmFkZChtYXNrLCBtYXNrMik7XG4gICAgfVxuXG4gICAgdmFyIHgsIHk7XG5cbiAgICBmb3IgKHggPSAwOyB4IDwgaW1hZ2Uud2lkdGg7IHgrKykge1xuICAgICAgYWRkKHgsIDApO1xuICAgIH1cbiAgICBmb3IgKHggPSAwOyB4IDwgaW1hZ2Uud2lkdGg7IHgrKykge1xuICAgICAgYWRkKHgsIGltYWdlLmhlaWdodCAtIDEpO1xuICAgIH1cbiAgICBmb3IgKHkgPSAwOyB5IDwgaW1hZ2UuaGVpZ2h0OyB5KyspIHtcbiAgICAgIGFkZChpbWFnZS53aWR0aCAtIDEsIHkpO1xuICAgIH1cbiAgICBmb3IgKHkgPSAwOyB5IDwgaW1hZ2UuaGVpZ2h0OyB5KyspIHtcbiAgICAgIGFkZCgwLCB5KTtcbiAgICB9XG4gICAgcmV0dXJuIG1hc2s7XG5cbiAgfTtcblxuICBsaWIuZXh0cmFjdENvbG9ycyA9IGZ1bmN0aW9uKG1peGVkVHlwZSx0aHJlc2hvbGQpIHtcbiAgICB0aHJlc2hvbGQ9IHRocmVzaG9sZCB8fCA2MDtcbiAgICB2YXIgaW1nRGF0YSA9IGxpYi5nZXRJbWFnZURhdGEobWl4ZWRUeXBlKTtcbiAgICB2YXIgX2NvbG9ycyA9IFtdO1xuICAgIHZhciBjMTtcbiAgICBmb3IodmFyIHggPSAxOyB4IDxpbWdEYXRhLndpZHRoO3grPTMpe1xuICAgICAgZm9yKHZhciB5ID0gMTsgeSA8aW1nRGF0YS5oZWlnaHQ7eSs9Mykge1xuICAgICAgICB2YXIgaWlpID0gKHggKyB5ICogaW1nRGF0YS53aWR0aCkgKiA0O1xuICAgICAgICB2YXIgaWlBID0gKHggLSAxICsgeSAqIGltZ0RhdGEud2lkdGgpICogNDtcbiAgICAgICAgdmFyIGlpQiA9ICh4ICsgMSArIHkgKiBpbWdEYXRhLndpZHRoKSAqIDQ7XG4gICAgICAgIHZhciBpaUMgPSAoeCAtIDEgKyAoeSArIDEpICogaW1nRGF0YS53aWR0aCkgKiA0O1xuICAgICAgICB2YXIgaWlEID0gKHggKyAxICsgKHkgKyAxKSAqIGltZ0RhdGEud2lkdGgpICogNDtcbiAgICAgICAgaWYoaW1nRGF0YS5kYXRhW2lpaSArIDNdIDwgMjU1KWNvbnRpbnVlO1xuXG4gICAgICAgIGMxID0gWyBpbWdEYXRhLmRhdGFbaWlpXSwgaW1nRGF0YS5kYXRhW2lpaSArIDFdLCBpbWdEYXRhLmRhdGFbaWlpICsgMl1dO1xuICAgICAgICB2YXIgY0EgPSBbIGltZ0RhdGEuZGF0YVtpaUFdLCBpbWdEYXRhLmRhdGFbaWlBICsgMV0sIGltZ0RhdGEuZGF0YVtpaUEgKyAyXV07XG4gICAgICAgIHZhciBjQiA9IFsgaW1nRGF0YS5kYXRhW2lpQl0sIGltZ0RhdGEuZGF0YVtpaUIgKyAxXSwgaW1nRGF0YS5kYXRhW2lpQiArIDJdXTtcbiAgICAgICAgdmFyIGNDID0gWyBpbWdEYXRhLmRhdGFbaWlDXSwgaW1nRGF0YS5kYXRhW2lpQyArIDFdLCBpbWdEYXRhLmRhdGFbaWlDICsgMl1dO1xuICAgICAgICB2YXIgY0QgPSBbIGltZ0RhdGEuZGF0YVtpaURdLCBpbWdEYXRhLmRhdGFbaWlEICsgMV0sIGltZ0RhdGEuZGF0YVtpaUQgKyAyXV07XG5cbiAgICAgICAgaWYoXG4gICAgICAgICAgYzFbMF0gIT0gY0FbMF0gfHwgY0FbMF0gIT0gY0JbMF0gfHwgY0JbMF0gIT0gY0NbMF0gfHwgY0NbMF0gIT0gY0RbMF0gfHxcbiAgICAgICAgICBjMVsxXSAhPSBjQVsxXSB8fCBjQVsxXSAhPSBjQlsxXSB8fCBjQlsxXSAhPSBjQ1sxXSB8fCBjQ1sxXSAhPSBjRFsxXSB8fFxuICAgICAgICAgIGMxWzJdICE9IGNBWzJdIHx8IGNBWzJdICE9IGNCWzJdIHx8IGNCWzJdICE9IGNDWzJdIHx8IGNDWzJdICE9IGNEWzJdXG4gICAgICAgICl7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgaXNOZXdDb2xvciA9IHRydWU7XG5cbiAgICAgICAgZm9yKHZhciBpIGluIF9jb2xvcnMpe1xuICAgICAgICAgIGlmKE1hZ2ljV2FuZC5kaWZmZXJlbmNlKF9jb2xvcnNbaV0sIGMxKSA8IHRocmVzaG9sZCl7XG4gICAgICAgICAgICBpc05ld0NvbG9yID0gZmFsc2U7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYoaXNOZXdDb2xvcil7XG4gICAgICAgICAgX2NvbG9ycy5wdXNoKGMxKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gX2NvbG9ycztcbiAgfTtcblxuICAvKipcbiAgICogaW1hZ2VcbiAgICogY2FudmFzIC0g0YfQtdGA0L3QviDQsdC70L7QtSDQuNC30L7QsdGA0LDQttC10L3QuNC1LlxuICAgKlxuICAgKiBtYXNrLSDQv9GA0LXQtNGL0LTRg9GJ0LDRjyDQvNCw0YHQutCwLiDQvdCwINC90LXQtSDQsdGD0LTQtdGCINC90LDQutC70LDQtNGL0LLQsNGC0Ywg0L3QvtCy0LDRj1xuICAgKiBtb2RlIC0g0YHQv9C+0YHQvtCxINC90LDQu9C+0LbQtdC90LjRjy5cbiAgICovXG4gIGxpYi5tYXNrU2VsZWN0aW9uID0gZnVuY3Rpb24gKCBjYW52YXMsIGxlZnQsIHRvcCwgbWFzayAsbW9kZSkge1xuICAgIGxlZnQgPSBsZWZ0IHx8IDA7XG4gICAgdG9wID0gdG9wIHx8IDA7XG4gICAgaWYoY2FudmFzLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJIVE1MSW1hZ2VFbGVtZW50XCIpe1xuXG4gICAgICB2YXIgX19jYW52YXMgPSBjcmVhdGVDYW52YXNFbGVtZW50KCk7XG4gICAgICBfX2NhbnZhcy53aWR0aCA9IGNhbnZhcy53aWR0aDtcbiAgICAgIF9fY2FudmFzLmhlaWdodCA9IGNhbnZhcy5oZWlnaHQ7XG4gICAgICB2YXIgX19jdHggPSBfX2NhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xuICAgICAgX19jdHguZHJhd0ltYWdlKGNhbnZhcywgMCwgMCk7XG4gICAgICBjYW52YXMgPSBfX2NhbnZhcztcbiAgICB9XG5cblxuICAgIHZhciBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKSxcbiAgICAgIGltZ0RhdGEgPSBjdHguZ2V0SW1hZ2VEYXRhKDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCksXG4gICAgICBtYXNrID0gbWFzayB8fCBNYWdpY1dhbmQuY3JlYXRlTWFzayhjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpO1xuXG4gICAgdmFyIF94MSA9IE1hdGgubWF4KDAsIC0gbGVmdCksXG4gICAgICBfeTEgPSBNYXRoLm1heCgwLCAtIHRvcCksXG4gICAgICBfeDIgPSBNYXRoLm1pbihtYXNrLndpZHRoIC0gbGVmdCxjYW52YXMud2lkdGgpO1xuICAgIF95MiA9IE1hdGgubWluKG1hc2suaGVpZ2h0IC0gdG9wLGNhbnZhcy5oZWlnaHQpO1xuXG4gICAgZm9yICh2YXIgeCA9IF94MTsgeCA8IF94MjsgeCsrKSB7XG4gICAgICBmb3IgKHZhciB5ID0gX3kxOyB5IDwgX3kyOyB5KyspIHtcbiAgICAgICAgdmFyIGluZGV4ID0gKGNhbnZhcy53aWR0aCAqIHkgKyB4KSAqIDQ7XG5cbiAgICAgICAgaWYgKGltZ0RhdGEuZGF0YVtpbmRleF0gPiAyMCkge1xuICAgICAgICAgIHZhciBpbmRleDIgPSBtYXNrLndpZHRoICogKHkgKyB0b3ApICsgeCArIGxlZnQ7XG4gICAgICAgICAgbWFzay5kYXRhW2luZGV4Ml0gPSAxO1xuICAgICAgICAgIG1hc2suY291bnQrKztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbWFzaztcbiAgfSxcbiAgbGliLnNlbGVjdFJlY3RhbmdsZSA9IGZ1bmN0aW9uIChpbWFnZSwgeDEsIHkxLCB4MiwgeTIpIHtcblxuICAgICAgdmFyIG1hc2sgPSBuZXcgU2VsZWN0aW9uTWFzayhpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0KTtcbiAgICAgIHZhciBtaW5YID0gTWF0aC5taW4oeDEsIHgyKTtcbiAgICAgIHZhciBtYXhYID0gTWF0aC5tYXgoeDEsIHgyKTtcbiAgICAgIHZhciBtaW5ZID0gTWF0aC5taW4oeTEsIHkyKTtcbiAgICAgIHZhciBtYXhZID0gTWF0aC5tYXgoeTEsIHkyKTtcblxuICAgICAgdmFyIHcgPSBpbWFnZS53aWR0aCwgaCA9IGltYWdlLmhlaWdodDtcblxuICAgICAgdmFyIGRhdGEgPSBpbWFnZS5kYXRhO1xuICAgICAgZm9yICh2YXIgeSA9IG1pblk7IHkgPD0gbWF4WTsgeSsrKSB7XG4gICAgICAgIGZvciAodmFyIHggPSBtaW5YOyB4IDw9IG1heFg7IHgrKykge1xuICAgICAgICAgIGlmIChkYXRhWyh5ICogdyArIHgpICogNCArIDNdKSB7XG4gICAgICAgICAgICBtYXNrLmRhdGFbeSAqIHcgKyB4XSA9IDE7XG4gICAgICAgICAgICBtYXNrLmNvdW50Kys7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIG1hc2suYm91bmRzID0ge1xuICAgICAgICBtaW5YOiBtaW5YLFxuICAgICAgICBtaW5ZOiBtaW5ZLFxuICAgICAgICBtYXhYOiBtYXhYLFxuICAgICAgICBtYXhZOiBtYXhZXG4gICAgICB9O1xuXG4gICAgICByZXR1cm4gbWFzaztcbiAgICB9O1xuXG4gIGxpYi5ieXRlcyA9IDQ7XG5cblxuXG5cblxuXG4gIGxpYi5fX2Zsb29kRmlsbCA9IGZ1bmN0aW9uIChlLHBvc3RNZXNzYWdlKSB7XG5cbiAgICBkYXRhID0gZS5kYXRhO1xuICAgIHZhciBpbWFnZSA9IGRhdGFbMF0sIHB4ID0gZGF0YVsxXSwgcHkgPSBkYXRhWzJdLCBjb2xvclRocmVzaG9sZCA9IGRhdGFbM10sIG9wdGlvbnMgPSBkYXRhWzRdO1xuXG4gICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG4gICAgLyp7XG4gICAgIHZpc2l0ZWRQb2ludHNBcnJheSxcbiAgICAgc2FtcGxlQ29sb3IsXG4gICAgIHJlc3VsdE1hc2tcbiAgICAgfSovXG5cbiAgICB2YXIgYywgeCwgbmV3WSwgZWwsIHhyLCB4bCwgZHksIGR5bCwgZHlyLCBjaGVja1ksXG4gICAgICBkYXRhID0gaW1hZ2UuZGF0YSwgdyA9IGltYWdlLndpZHRoLCBoID0gaW1hZ2UuaGVpZ2h0LCBieXRlcyA9IGxpYi5ieXRlcyxcbiAgICAgIGkgPSBweSAqIHcgKyBweDsgLy8gc3RhcnQgcG9pbnQgaW5kZXggaW4gdGhlIG1hc2sgZGF0YVxuICAgIGkgPSBpICogYnl0ZXM7IC8vIHN0YXJ0IHBvaW50IGluZGV4IGluIHRoZSBpbWFnZSBkYXRhXG5cbiAgICB2YXIgdmlzaXRlZCAgICAgPSBvcHRpb25zLnZpc2l0ZWRQb2ludHMgfHwgbmV3IFVpbnQ4QXJyYXkoIHcgKiBoKSwgLy8gbWFzayBvZiB2aXNpdGVkIHBvaW50c1xuICAgICAgc2FtcGxlQ29sb3IgPSBvcHRpb25zLnNhbXBsZUNvbG9yICAgfHwgW2RhdGFbaV0sIGRhdGFbaSArIDFdLCBkYXRhW2kgKyAyXSwgZGF0YVtpICsgM11dLCAvLyBzdGFydCBwb2ludCBjb2xvciAoc2FtcGxlKVxuICAgICAgcmVzdWx0ICAgICAgPSBvcHRpb25zLmFjdGl2ZU1hc2s7XG5cbiAgICBmdW5jdGlvbiBhY2NlcHRhYmxlKHgsIHkpIHtcbi8vIGNoZWNrIHdoZXRoZXIgdGhlIHBvaW50IGhhcyBiZWVuIHZpc2l0ZWRcbiAgICAgIGlmICh2aXNpdGVkW3kgKiBpbWFnZS53aWR0aCArIHhdID09PSAxKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIHZhciBpID0gKHkgKiBpbWFnZS53aWR0aCArIHgpICogbGliLmJ5dGVzLFxuICAgICAgICBjb2xvcjIgPSBbaW1hZ2UuZGF0YVtpXSwgaW1hZ2UuZGF0YVtpICsgMV0sIGltYWdlLmRhdGFbaSArIDJdLCBpbWFnZS5kYXRhW2kgKyAzXV07XG4gICAgICBpZiAoc2FtcGxlQ29sb3JbMF0gIT09IGZhbHNlICYmIE1hdGguYWJzKHNhbXBsZUNvbG9yWzBdIC0gY29sb3IyWzBdKSA+IGNvbG9yVGhyZXNob2xkKXJldHVybiBmYWxzZTtcbiAgICAgIGlmIChzYW1wbGVDb2xvclsxXSAhPT0gZmFsc2UgJiYgTWF0aC5hYnMoc2FtcGxlQ29sb3JbMV0gLSBjb2xvcjJbMV0pID4gY29sb3JUaHJlc2hvbGQpcmV0dXJuIGZhbHNlO1xuICAgICAgaWYgKHNhbXBsZUNvbG9yWzJdICE9PSBmYWxzZSAmJiBNYXRoLmFicyhzYW1wbGVDb2xvclsyXSAtIGNvbG9yMlsyXSkgPiBjb2xvclRocmVzaG9sZClyZXR1cm4gZmFsc2U7XG4gICAgICBpZiAoc2FtcGxlQ29sb3JbM10gIT09IGZhbHNlICYmIE1hdGguYWJzKHNhbXBsZUNvbG9yWzNdIC0gY29sb3IyWzNdKSA+IGNvbG9yVGhyZXNob2xkKXJldHVybiBmYWxzZTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH07XG5cblxuXG4gICAgaWYgKHZpc2l0ZWRbaV0gPT09IDEpIHJldHVybiBudWxsO1xuXG5cbiAgICB2YXIgZmlyc3QgPSB0cnVlO1xuICAgIHZhciBzdGFjayA9IFt7eTogcHksIGxlZnQ6IHB4IC0gMSwgcmlnaHQ6IHB4ICsgMSwgZGlyOiAxfV07IC8vIGZpcnN0IHNjYW5uaW5nIGxpbmVcblxuICAgIHZhciBtb2RlID0gJ3N0cmljdCc7XG4gICAgdmFyIF9jaTtcbiAgICBkbyB7XG4gICAgICBlbCA9IHN0YWNrLnNoaWZ0KCk7IC8vIGdldCBsaW5lIGZvciBzY2FubmluZ1xuXG4gICAgICBjaGVja1kgPSBmYWxzZTtcbiAgICAgIGZvciAoeCA9IGVsLmxlZnQgKyAxOyB4IDwgZWwucmlnaHQ7IHgrKykge1xuICAgICAgICBkeSA9IGVsLnkgKiB3O1xuXG4gICAgICAgIGlmKG1vZGUgPT0gJ2dyYWRpZW50JyAmJiAhZmlyc3QpIHtcbiAgICAgICAgICBfY2kgPSAoZHkgKyB4ICsgKGVsLmRpciA9PSAtMSA/IHc6IC0gdykpKjQ7XG4gICAgICAgICAgc2FtcGxlQ29sb3IgPSBbZGF0YVtfY2ldLGRhdGFbX2NpKzFdLGRhdGFbX2NpKzJdLGRhdGFbX2NpKzNdXTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWFjY2VwdGFibGUoeCwgZWwueSwgaW1hZ2UsIHZpc2l0ZWQsIHNhbXBsZUNvbG9yLCBjb2xvclRocmVzaG9sZCkpY29udGludWU7XG5cbiAgICAgICAgZmlyc3QgPSBmYWxzZTtcblxuICAgICAgICBjaGVja1kgPSB0cnVlOyAvLyBpZiB0aGUgY29sb3Igb2YgdGhlIG5ldyBwb2ludCh4LHkpIGlzIHNpbWlsYXIgdG8gdGhlIHNhbXBsZSBjb2xvciBuZWVkIHRvIGNoZWNrIG1pbm1heCBmb3IgWVxuXG4gICAgICAgIHJlc3VsdC5jb3VudCsrO1xuXG4gICAgICAgIHJlc3VsdC5kYXRhW2R5ICsgeF0gPSAxOyAvLyBtYXJrIGEgbmV3IHBvaW50IGluIG1hc2tcbiAgICAgICAgdmlzaXRlZFtkeSArIHhdID0gMTsgLy8gbWFyayBhIG5ldyBwb2ludCBhcyB2aXNpdGVkXG5cbiAgICAgICAgeGwgPSB4IC0gMTtcbiAgICAgICAgLy8gd2FsayB0byBsZWZ0IHNpZGUgc3RhcnRpbmcgd2l0aCB0aGUgbGVmdCBuZWlnaGJvclxuICAgICAgICB3aGlsZSAoeGwgPiAtMSkge1xuICAgICAgICAgIGR5bCA9IGR5ICsgeGw7XG5cbiAgICAgICAgICBpZihtb2RlID09ICdncmFkaWVudCcpIHtcbiAgICAgICAgICAgIF9jaSA9IChkeWwgKyAxKSo0O1xuICAgICAgICAgICAgc2FtcGxlQ29sb3IgPSBbZGF0YVtfY2ldLCBkYXRhW19jaSArIDFdLCBkYXRhW19jaSArIDJdLCBkYXRhW19jaSArIDNdXTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKCFhY2NlcHRhYmxlKHhsLCBlbC55LCBpbWFnZSwgdmlzaXRlZCwgc2FtcGxlQ29sb3IsIGNvbG9yVGhyZXNob2xkKSkgYnJlYWs7XG5cbiAgICAgICAgICByZXN1bHQuY291bnQrKztcbiAgICAgICAgICByZXN1bHQuZGF0YVtkeWxdID0gMTtcbiAgICAgICAgICB2aXNpdGVkW2R5bF0gPSAxO1xuXG4gICAgICAgICAgeGwtLTtcbiAgICAgICAgfVxuICAgICAgICB4ciA9IHggKyAxO1xuICAgICAgICAvLyB3YWxrIHRvIHJpZ2h0IHNpZGUgc3RhcnRpbmcgd2l0aCB0aGUgcmlnaHQgbmVpZ2hib3JcbiAgICAgICAgd2hpbGUgKHhyIDwgdykge1xuICAgICAgICAgIGR5ciA9IGR5ICsgeHI7XG5cbiAgICAgICAgICBpZihtb2RlID09ICdncmFkaWVudCcpIHtcbiAgICAgICAgICAgIF9jaSA9IChkeXIgLSAxKSo0O1xuICAgICAgICAgICAgc2FtcGxlQ29sb3IgPSBbZGF0YVtfY2ldLCBkYXRhW19jaSArIDFdLCBkYXRhW19jaSArIDJdLCBkYXRhW19jaSArIDNdXTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKCFhY2NlcHRhYmxlKHhyLCBlbC55LCBpbWFnZSwgdmlzaXRlZCwgc2FtcGxlQ29sb3IsIGNvbG9yVGhyZXNob2xkKSl7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXN1bHQuY291bnQrKztcbiAgICAgICAgICByZXN1bHQuZGF0YVtkeXJdID0gMTtcbiAgICAgICAgICB2aXNpdGVkW2R5cl0gPSAxO1xuICAgICAgICAgIHhyKys7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBjaGVjayBtaW5tYXggZm9yIFhcbiAgICAgICAgaWYgKHhsIDwgcmVzdWx0LmJvdW5kcy5taW5YKSByZXN1bHQuYm91bmRzLm1pblggPSB4bCArIDE7XG4gICAgICAgIGlmICh4ciA+IHJlc3VsdC5ib3VuZHMubWF4WCkgcmVzdWx0LmJvdW5kcy5tYXhYID0geHIgLSAxO1xuXG4gICAgICAgIG5ld1kgPSBlbC55IC0gZWwuZGlyO1xuICAgICAgICBpZiAobmV3WSA+PSAwICYmIG5ld1kgPCBoKSB7XG4gICAgICAgICAgaWYgKHhsIDwgeHIpIHN0YWNrLnB1c2goe3k6IG5ld1ksIGxlZnQ6IHhsLCByaWdodDogeHIsIGRpcjogLWVsLmRpcn0pOyAvLyBmcm9tIFwibmV3IGxlZnRcIiB0byBcIm5ldyByaWdodFwiXG4gICAgICAgICAgLy8gYWRkIHR3byBzY2FubmluZyBsaW5lcyBpbiB0aGUgb3Bwb3NpdGUgZGlyZWN0aW9uICh5IC0gZGlyKSBpZiBuZWNlc3NhcnlcbiAgICAgICAgICAvLyBpZiAoeGwgPD0gZWwubGVmdCkgc3RhY2sucHVzaCh7eTogbmV3WSwgbGVmdDogeGwsIHJpZ2h0OiBlbC5sZWZ0LCBkaXI6IC1lbC5kaXJ9KTsgLy8gZnJvbSBcIm5ldyBsZWZ0XCIgdG8gXCJjdXJyZW50IGxlZnRcIlxuICAgICAgICAgIC8vIGlmIChlbC5yaWdodCA8PSB4cikgc3RhY2sucHVzaCh7eTogbmV3WSwgbGVmdDogZWwucmlnaHQsIHJpZ2h0OiB4ciwgZGlyOiAtZWwuZGlyfSk7IC8vIGZyb20gXCJjdXJyZW50IHJpZ2h0XCIgdG8gXCJuZXcgcmlnaHRcIlxuICAgICAgICB9XG4gICAgICAgIG5ld1kgPSBlbC55ICsgZWwuZGlyO1xuICAgICAgICBpZiAobmV3WSA+PSAwICYmIG5ld1kgPCBoKSB7IC8vIGFkZCB0aGUgc2Nhbm5pbmcgbGluZSBpbiB0aGUgZGlyZWN0aW9uICh5ICsgZGlyKSBpZiBuZWNlc3NhcnlcbiAgICAgICAgICBpZiAoeGwgPCB4cikgc3RhY2sucHVzaCh7eTogbmV3WSwgbGVmdDogeGwsIHJpZ2h0OiB4ciwgZGlyOiBlbC5kaXJ9KTsgLy8gZnJvbSBcIm5ldyBsZWZ0XCIgdG8gXCJuZXcgcmlnaHRcIlxuICAgICAgICB9XG4gICAgICB9XG4gICAgICAvLyBjaGVjayBtaW5tYXggZm9yIFkgaWYgbmVjZXNzYXJ5XG4gICAgICBpZiAoY2hlY2tZKSB7XG4gICAgICAgIGlmIChlbC55IDwgcmVzdWx0LmJvdW5kcy5taW5ZKSByZXN1bHQuYm91bmRzLm1pblkgPSBlbC55O1xuICAgICAgICBpZiAoZWwueSA+IHJlc3VsdC5ib3VuZHMubWF4WSkgcmVzdWx0LmJvdW5kcy5tYXhZID0gZWwueTtcbiAgICAgIH1cbiAgICB9IHdoaWxlIChzdGFjay5sZW5ndGggPiAwKTtcblxuICAgIHBvc3RNZXNzYWdlICYmIHBvc3RNZXNzYWdlKHJlc3VsdCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcblxuICBsaWIuZXh0ZW5kTWFzayA9IGZ1bmN0aW9uIChtYXNrLCB2YWx1ZSkge1xuXG4gICAgdmFyIG1hc2syID0gbmV3IFNlbGVjdGlvbk1hc2sobWFzay53aWR0aCArIDIsIG1hc2suaGVpZ2h0ICsgMik7XG4gICAgaWYodmFsdWUpe1xuICAgICAgbWFzazIuZGF0YS5maWxsKHZhbHVlKTtcbiAgICB9XG5cbiAgICBmb3IodmFyIHkgPSAwO3kgPCBtYXNrLmhlaWdodCA7IHkrKyl7XG4gICAgICBmb3IodmFyIHggPSAwO3ggPCBtYXNrLndpZHRoIDsgeCsrKXtcbiAgICAgICAgbWFzazIuZGF0YVsgKHkgKyAxKSAqIG1hc2syLndpZHRoICsgeCArIDEgXSA9IG1hc2suZGF0YVt5ICogbWFzay53aWR0aCArIHggXTtcbiAgICAgIH1cbiAgICB9XG4gICAgbWFzazIuY291bnQgID0gbWFzay5jb3VudDtcblxuICAgIGlmKCF2YWx1ZSkge1xuICAgICAgbWFzazIuYm91bmRzID0ge1xuICAgICAgICBtaW5YOiBtYXNrLmJvdW5kcy5taW5YICsgMSxcbiAgICAgICAgbWF4WDogbWFzay5ib3VuZHMubWF4WCArIDEsXG4gICAgICAgIG1heFk6IG1hc2suYm91bmRzLm1heFkgKyAxLFxuICAgICAgICBtaW5ZOiBtYXNrLmJvdW5kcy5taW5ZICsgMVxuICAgICAgfTtcbiAgICB9ZWxzZXtcbiAgICAgIG1hc2syLmJvdW5kcyA9IG1hc2suYm91bmRzO1xuICAgIH1cblxuICAgIHJldHVybiBtYXNrMjtcbiAgfTtcblxuICAvKiogQ3JlYXRlIGEgYmluYXJ5IG1hc2sgb24gdGhlIGltYWdlIGJ5IGNvbG9yIHRocmVzaG9sZFxuICAgKiBBbGdvcml0aG06IFNjYW5saW5lIGZsb29kIGZpbGwgKGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvRmxvb2RfZmlsbClcbiAgICogQHBhcmFtIHtPYmplY3R9IGltYWdlOiB7VWludDhBcnJheX0gZGF0YSwge2ludH0gd2lkdGgsIHtpbnR9IGhlaWdodCwge2ludH0gYnl0ZXNcbiAgICogQHBhcmFtIHtpbnR9IHggb2Ygc3RhcnQgcGl4ZWxcbiAgICogQHBhcmFtIHtpbnR9IHkgb2Ygc3RhcnQgcGl4ZWxcbiAgICogQHBhcmFtIHtpbnR9IGNvbG9yIHRocmVzaG9sZFxuICAgKiBAcGFyYW0ge1VpbnQ4QXJyYXl9IG1hc2sgb2YgdmlzaXRlZCBwb2ludHMgKG9wdGlvbmFsKVxuICAgKiBAcmV0dXJuIHtPYmplY3R9IG1hc2s6IHtVaW50OEFycmF5fSBkYXRhLCB7aW50fSB3aWR0aCwge2ludH0gaGVpZ2h0LCB7T2JqZWN0fSBib3VuZHNcbiAgICovXG4gIGxpYi5mbG9vZEZpbGwgPSBmdW5jdGlvbiAoaW1hZ2UsIHB4LCBweSwgY29sb3JUaHJlc2hvbGQsIG9wdGlvbnMsY29sb3IsY2FsbGJhY2spIHtcbiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgICBvcHRpb25zLmFjdGl2ZU1hc2sgPSBvcHRpb25zLmFjdGl2ZU1hc2sgIHx8IG5ldyBTZWxlY3Rpb25NYXNrKGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQpO1xuXG4gICAgcmV0dXJuIGxpYi5fX2Zsb29kRmlsbCh7ZGF0YTogW2ltYWdlLCBweCwgcHksIGNvbG9yVGhyZXNob2xkLCBvcHRpb25zLCBjb2xvcl19LGNhbGxiYWNrKTtcblxuICAgIC8qXG4gICAgdmFyIHdvcmtlciA9IF8ud29ya2VyKGxpYi5fX2Zsb29kRmlsbCk7XG4gICAgd29ya2VyLm9ubWVzc2FnZSA9IGZ1bmN0aW9uKGUpe1xuICAgICAgdmFyIG1hc2sgPSBuZXcgU2VsZWN0aW9uTWFzayhlLmRhdGEpO1xuICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2sobWFzayk7XG4gICAgfTtcbiAgICB3b3JrZXIucG9zdE1lc3NhZ2UoW2ltYWdlLCBweCwgcHksIGNvbG9yVGhyZXNob2xkLCBvcHRpb25zXSk7XG4qL1xuXG4gIH07XG5cbiAgbGliLnN1YnN0cmFjdCA9IGZ1bmN0aW9uIChtYXNrLCBtYXNrMikge1xuICAgIHZhciBtaW5YLCBtYXhYLCBtaW5ZLCBtYXhZO1xuXG4gICAgdmFyIHJlc3VsdCA9IG5ldyBTZWxlY3Rpb25NYXNrKG1hc2sud2lkdGgsIG1hc2suaGVpZ2h0KTtcbiAgICB2YXIgYm91bmRzID0gbWFzazIuYm91bmRzO1xuXG4gICAgdmFyIG1pblggPSBmYWxzZSwgbWluWSA9IG1hc2suaGVpZ2h0LCBtYXhYID0gZmFsc2UsIG1heFkgPSAtMTtcblxuICAgIGZvciAodmFyIHggPSBib3VuZHMubWluWDsgeCA8PSBib3VuZHMubWF4WDsgeCsrKSB7XG4gICAgICBmb3IgKHZhciB5ID0gYm91bmRzLm1pblk7IHkgPD0gYm91bmRzLm1heFk7IHkrKykge1xuICAgICAgICB2YXIgaW5kZXggPSBtYXNrLndpZHRoICogeSArIHg7XG5cbiAgICAgICAgaWYgKCFtYXNrLmRhdGFbaW5kZXhdICYmIG1hc2syLmRhdGFbaW5kZXhdKSB7XG4gICAgICAgICAgcmVzdWx0LmRhdGFbaW5kZXhdID0gMTtcbiAgICAgICAgICByZXN1bHQuY291bnQrKztcbiAgICAgICAgICBpZiAocmVzdWx0LmJvdW5kcy5taW5ZID4geSlyZXN1bHQuYm91bmRzLm1pblkgPSB5O1xuICAgICAgICAgIGlmIChyZXN1bHQuYm91bmRzLm1heFkgPCB5KXJlc3VsdC5ib3VuZHMubWF4WSA9IHk7XG4gICAgICAgICAgaWYgKHJlc3VsdC5ib3VuZHMubWluWCA+IHgpcmVzdWx0LmJvdW5kcy5taW5YID0geDtcbiAgICAgICAgICBpZiAocmVzdWx0LmJvdW5kcy5tYXhYIDwgeClyZXN1bHQuYm91bmRzLm1heFggPSB4O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIGxpYi5nZXRJbWFnZURhdGEgID0gZnVuY3Rpb24obWl4ZWRUeXBlKXtcbiAgICB2YXIgY2FudmFzO1xuICAgIGlmIChtaXhlZFR5cGUuY29uc3RydWN0b3IubmFtZSA9PSBcIkltYWdlXCIgfHwgbWl4ZWRUeXBlLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJIVE1MSW1hZ2VFbGVtZW50XCIpIHtcbiAgICAgIHZhciBfY2FudmFzID0gY3JlYXRlQ2FudmFzRWxlbWVudCgpO1xuICAgICAgX2NhbnZhcy53aWR0aCA9IG1peGVkVHlwZS53aWR0aDtcbiAgICAgIF9jYW52YXMuaGVpZ2h0ID0gbWl4ZWRUeXBlLmhlaWdodDtcbiAgICAgIHZhciBjdHggPSBfY2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcbiAgICAgIGN0eC5kcmF3SW1hZ2UobWl4ZWRUeXBlLCAwLCAwKTtcbiAgICAgIGNhbnZhcyA9IF9jYW52YXM7XG4gICAgfWVsc2V7XG4gICAgICBjYW52YXMgPSBtaXhlZFR5cGU7XG4gICAgfVxuICAgIGlmIChjYW52YXMuY29uc3RydWN0b3IubmFtZSA9PSBcIkhUTUxDYW52YXNFbGVtZW50XCIgfHwgY2FudmFzLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJDYW52YXNcIikge1xuICAgICAgdmFyIGltZ0RhdGEgPSBjYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpLmdldEltYWdlRGF0YSgwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpO1xuICAgIH1lbHNle1xuICAgICAgaW1nRGF0YSA9IG1peGVkVHlwZTtcbiAgICB9XG4gICAgcmV0dXJuIGltZ0RhdGE7XG4gIH07XG5cbiAgbGliLmdldENvbG9yZWRQaXhlbHMgPSBmdW5jdGlvbiAobWl4ZWRUeXBlKSB7XG4gICAgdmFyIGltZ0RhdGEgPSBsaWIuZ2V0SW1hZ2VEYXRhKG1peGVkVHlwZSk7XG4gICAgdmFyIGRhdGEgPSBpbWdEYXRhLmRhdGE7XG4gICAgdmFyIHBpeGVscyA9IDA7XG4gICAgZm9yICh2YXIgaSA9IDM7IGkgPCBkYXRhLmxlbmd0aDsgaSArPSA0KSB7XG4gICAgICBpZiAoZGF0YVtpXSkge1xuICAgICAgICBwaXhlbHMrPSBkYXRhW2ldIC8gMjU1O1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcGl4ZWxzO1xuICB9O1xuXG4gIGxpYi5pbnZlcnRNYXNrID0gZnVuY3Rpb24gKG1hc2spIHtcbiAgICB2YXIgcmVzdWx0ID0gbmV3IFNlbGVjdGlvbk1hc2sobWFzay53aWR0aCwgbWFzay5oZWlnaHQpO1xuICAgIHJlc3VsdC5ib3VuZHMgPSB7XG4gICAgICBtaW5YOiBJbmZpbml0eSxcbiAgICAgIG1pblk6IEluZmluaXR5LFxuICAgICAgbWF4WTogLTEsXG4gICAgICBtYXhYOiAtMVxuICAgIH07XG5cblxuICAgIGZvciAodmFyIHggPSAwOyB4IDwgbWFzay53aWR0aDsgeCsrKSB7XG4gICAgICBmb3IgKHZhciB5ID0gMDsgeSA8IG1hc2suaGVpZ2h0OyB5KyspIHtcbiAgICAgICAgdmFyIGluZGV4ID0gbWFzay53aWR0aCAqIHkgKyB4O1xuICAgICAgICBpZiAoIW1hc2suZGF0YVtpbmRleF0pIHtcbiAgICAgICAgICByZXN1bHQuZGF0YVtpbmRleF0gPSAxO1xuICAgICAgICAgIHJlc3VsdC5jb3VudCsrO1xuICAgICAgICAgIGlmIChyZXN1bHQuYm91bmRzLm1pblkgPiB5KXJlc3VsdC5ib3VuZHMubWluWSA9IHk7XG4gICAgICAgICAgaWYgKHJlc3VsdC5ib3VuZHMubWF4WSA8IHkpcmVzdWx0LmJvdW5kcy5tYXhZID0geTtcbiAgICAgICAgICBpZiAocmVzdWx0LmJvdW5kcy5taW5YID4geClyZXN1bHQuYm91bmRzLm1pblggPSB4O1xuICAgICAgICAgIGlmIChyZXN1bHQuYm91bmRzLm1heFggPCB4KXJlc3VsdC5ib3VuZHMubWF4WCA9IHg7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcblxuICBsaWIuZXhjbHVkZSA9IGZ1bmN0aW9uIChtYXNrLCBtYXNrMikge1xuICAgIHZhciByZXN1bHQgPSBuZXcgU2VsZWN0aW9uTWFzayhtYXNrLndpZHRoLCBtYXNrLmhlaWdodCk7XG4gICAgdmFyIGJvdW5kcyA9IHtcbiAgICAgIG1pblg6IE1hdGgubWluKG1hc2suYm91bmRzLm1pblgsIG1hc2syLmJvdW5kcy5taW5YKSxcbiAgICAgIG1heFg6IE1hdGgubWF4KG1hc2suYm91bmRzLm1heFgsIG1hc2syLmJvdW5kcy5tYXhYKSxcbiAgICAgIG1pblk6IE1hdGgubWluKG1hc2suYm91bmRzLm1pblksIG1hc2syLmJvdW5kcy5taW5ZKSxcbiAgICAgIG1heFk6IE1hdGgubWF4KG1hc2suYm91bmRzLm1heFksIG1hc2syLmJvdW5kcy5tYXhZKVxuICAgIH07XG5cbiAgICB2YXIgbWluWCA9IGZhbHNlLCBtaW5ZID0gbWFzay5oZWlnaHQsIG1heFggPSBmYWxzZSwgbWF4WSA9IC0xO1xuXG4gICAgZm9yICh2YXIgeCA9IGJvdW5kcy5taW5YOyB4IDw9IGJvdW5kcy5tYXhYOyB4KyspIHtcbiAgICAgIGZvciAodmFyIHkgPSBib3VuZHMubWluWTsgeSA8PSBib3VuZHMubWF4WTsgeSsrKSB7XG4gICAgICAgIHZhciBpbmRleCA9IG1hc2syLndpZHRoICogeSArIHg7XG5cbiAgICAgICAgaWYgKG1hc2suZGF0YVtpbmRleF0gXiBtYXNrMi5kYXRhW2luZGV4XSkge1xuICAgICAgICAgIHJlc3VsdC5kYXRhW2luZGV4XSA9IDE7XG4gICAgICAgICAgcmVzdWx0LmNvdW50Kys7XG4gICAgICAgICAgbWF4WCA9IHg7XG4gICAgICAgICAgaWYgKG1pblkgPiB5KW1pblkgPSB5O1xuICAgICAgICAgIGlmIChtYXhZIDwgeSltYXhZID0geTtcbiAgICAgICAgICBpZiAobWluWCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgIG1pblggPSB4O1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJlc3VsdC5ib3VuZHMgPSB7XG4gICAgICBtaW5YOiBtaW5YLFxuICAgICAgbWF4WDogbWF4WCxcbiAgICAgIG1pblk6IG1pblksXG4gICAgICBtYXhZOiBtYXhZXG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcblxuICBsaWIuaW50ZXJzZWN0ID0gZnVuY3Rpb24gKG1hc2ssIG1hc2syKSB7XG4gICAgdmFyIG1pblgsIG1heFgsIG1pblksIG1heFk7XG5cbiAgICB2YXIgcmVzdWx0ID0gbmV3IFNlbGVjdGlvbk1hc2sobWFzay53aWR0aCwgbWFzay5oZWlnaHQpO1xuICAgIHZhciBib3VuZHMgPSB7XG4gICAgICBtaW5YOiBNYXRoLm1heChtYXNrLmJvdW5kcy5taW5YLCBtYXNrMi5ib3VuZHMubWluWCksXG4gICAgICBtYXhYOiBNYXRoLm1pbihtYXNrLmJvdW5kcy5tYXhYLCBtYXNrMi5ib3VuZHMubWF4WCksXG4gICAgICBtaW5ZOiBNYXRoLm1heChtYXNrLmJvdW5kcy5taW5ZLCBtYXNrMi5ib3VuZHMubWluWSksXG4gICAgICBtYXhZOiBNYXRoLm1pbihtYXNrLmJvdW5kcy5tYXhZLCBtYXNrMi5ib3VuZHMubWF4WSlcbiAgICB9O1xuXG4gICAgdmFyIG1pblggPSBmYWxzZSwgbWluWSA9IG1hc2suaGVpZ2h0LCBtYXhYID0gZmFsc2UsIG1heFkgPSAtMTtcblxuICAgIGZvciAodmFyIHggPSBib3VuZHMubWluWDsgeCA8PSBib3VuZHMubWF4WDsgeCsrKSB7XG4gICAgICBmb3IgKHZhciB5ID0gYm91bmRzLm1pblk7IHkgPD0gYm91bmRzLm1heFk7IHkrKykge1xuICAgICAgICB2YXIgaW5kZXggPSBtYXNrMi53aWR0aCAqIHkgKyB4O1xuXG4gICAgICAgIGlmIChtYXNrLmRhdGFbaW5kZXhdICYmIG1hc2syLmRhdGFbaW5kZXhdKSB7XG4gICAgICAgICAgcmVzdWx0LmRhdGFbaW5kZXhdID0gMTtcbiAgICAgICAgICByZXN1bHQuY291bnQrKztcbiAgICAgICAgICBtYXhYID0geDtcbiAgICAgICAgICBpZiAobWluWSA+IHkpbWluWSA9IHk7XG4gICAgICAgICAgaWYgKG1heFkgPCB5KW1heFkgPSB5O1xuICAgICAgICAgIGlmIChtaW5YID09PSBmYWxzZSkge1xuICAgICAgICAgICAgbWluWCA9IHg7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmVzdWx0LmJvdW5kcyA9IHtcbiAgICAgIG1pblg6IG1pblgsXG4gICAgICBtYXhYOiBtYXhYLFxuICAgICAgbWluWTogbWluWSxcbiAgICAgIG1heFk6IG1heFlcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuXG4gIGxpYi5hZGQgPSBmdW5jdGlvbiAobWFzaywgbWFzazIpIHtcbiAgICB2YXIgcmVzdWx0ID0gbmV3IFNlbGVjdGlvbk1hc2sobWFzay53aWR0aCwgbWFzay5oZWlnaHQpO1xuXG4gICAgcmVzdWx0LmJvdW5kcyA9IHtcbiAgICAgIG1pblg6IE1hdGgubWluKG1hc2suYm91bmRzLm1pblgsIG1hc2syLmJvdW5kcy5taW5YKSxcbiAgICAgIG1heFg6IE1hdGgubWF4KG1hc2suYm91bmRzLm1heFgsIG1hc2syLmJvdW5kcy5tYXhYKSxcbiAgICAgIG1pblk6IE1hdGgubWluKG1hc2suYm91bmRzLm1pblksIG1hc2syLmJvdW5kcy5taW5ZKSxcbiAgICAgIG1heFk6IE1hdGgubWF4KG1hc2suYm91bmRzLm1heFksIG1hc2syLmJvdW5kcy5tYXhZKVxuICAgIH07XG5cbiAgICBmb3IgKHZhciB4ID0gcmVzdWx0LmJvdW5kcy5taW5YOyB4IDw9IHJlc3VsdC5ib3VuZHMubWF4WDsgeCsrKSB7XG4gICAgICBmb3IgKHZhciB5ID0gcmVzdWx0LmJvdW5kcy5taW5ZOyB5IDw9IHJlc3VsdC5ib3VuZHMubWF4WTsgeSsrKSB7XG4gICAgICAgIHZhciBpbmRleCA9IG1hc2syLndpZHRoICogeSArIHg7XG5cbiAgICAgICAgaWYgKG1hc2suZGF0YVtpbmRleF0gfHwgbWFzazIuZGF0YVtpbmRleF0pIHtcbiAgICAgICAgICByZXN1bHQuZGF0YVtpbmRleF0gPSAxO1xuICAgICAgICAgIHJlc3VsdC5jb3VudCsrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcblxuICAvKiogQXBwbHkgdGhlIGdhdXNzLWJsdXIgZmlsdGVyIHRvIGJpbmFyeSBtYXNrXG4gICAqIEFsZ29yaXRobXM6IGh0dHA6Ly9ibG9nLml2YW5rLm5ldC9mYXN0ZXN0LWdhdXNzaWFuLWJsdXIuaHRtbFxuICAgKiBodHRwOi8vd3d3LmxpYnJvdy5jb20vYXJ0aWNsZXMvYXJ0aWNsZS05XG4gICAqIGh0dHA6Ly9lbHlueHNkay5mcmVlLmZyL2V4dC1kb2NzL0JsdXIvRmFzdF9ib3hfYmx1ci5wZGZcbiAgICogQHBhcmFtIHtPYmplY3R9IG1hc2s6IHtVaW50OEFycmF5fSBkYXRhLCB7aW50fSB3aWR0aCwge2ludH0gaGVpZ2h0LCB7T2JqZWN0fSBib3VuZHNcbiAgICogQHBhcmFtIHtpbnR9IGJsdXIgcmFkaXVzXG4gICAqIEByZXR1cm4ge09iamVjdH0gbWFzazoge1VpbnQ4QXJyYXl9IGRhdGEsIHtpbnR9IHdpZHRoLCB7aW50fSBoZWlnaHQsIHtPYmplY3R9IGJvdW5kc1xuICAgKi9cbiAgbGliLmdhdXNzQmx1ciA9IGZ1bmN0aW9uIChtYXNrLCByYWRpdXMpIHtcblxuICAgIHZhciBpLCBrLCBrMSwgeCwgeSwgdmFsLCBzdGFydCwgZW5kLFxuICAgICAgbiA9IHJhZGl1cyAqIDIgKyAxLCAvLyBzaXplIG9mIHRoZSBwYXR0ZXJuIGZvciByYWRpdXMtbmVpZ2hib3JzIChmcm9tIC1yIHRvICtyIHdpdGggdGhlIGNlbnRlciBwb2ludClcbiAgICAgIHMyID0gcmFkaXVzICogcmFkaXVzLFxuICAgICAgd2cgPSBuZXcgRmxvYXQzMkFycmF5KG4pLCAvLyB3ZWlnaHRzXG4gICAgICB0b3RhbCA9IDAsIC8vIHN1bSBvZiB3ZWlnaHRzKHVzZWQgZm9yIG5vcm1hbGl6YXRpb24pXG4gICAgICB3ID0gbWFzay53aWR0aCxcbiAgICAgIGggPSBtYXNrLmhlaWdodCxcbiAgICAgIGRhdGEgPSBtYXNrLmRhdGEsXG4gICAgICBtaW5YID0gbWFzay5ib3VuZHMubWluWCxcbiAgICAgIG1heFggPSBtYXNrLmJvdW5kcy5tYXhYLFxuICAgICAgbWluWSA9IG1hc2suYm91bmRzLm1pblksXG4gICAgICBtYXhZID0gbWFzay5ib3VuZHMubWF4WSxcbiAgICAgIGNvdW50ID0gMDtcblxuICAgIC8vIGNhbGMgZ2F1c3Mgd2VpZ2h0c1xuICAgIGZvciAoaSA9IDA7IGkgPCByYWRpdXM7IGkrKykge1xuICAgICAgdmFyIGRzcSA9IChyYWRpdXMgLSBpKSAqIChyYWRpdXMgLSBpKTtcbiAgICAgIHZhciB3dyA9IE1hdGguZXhwKC1kc3EgLyAoMi4wICogczIpKSAvICgyICogTWF0aC5QSSAqIHMyKTtcbiAgICAgIHdnW3JhZGl1cyArIGldID0gd2dbcmFkaXVzIC0gaV0gPSB3dztcbiAgICAgIHRvdGFsICs9IDIgKiB3dztcbiAgICB9XG4gICAgLy8gbm9ybWFsaXphdGlvbiB3ZWlnaHRzXG4gICAgZm9yIChpID0gMDsgaSA8IG47IGkrKykge1xuICAgICAgd2dbaV0gLz0gdG90YWw7XG4gICAgfVxuXG4gICAgdmFyIHJlc3VsdCA9IG5ldyBVaW50OEFycmF5KHcgKiBoKSwgLy8gcmVzdWx0IG1hc2tcbiAgICAgIGVuZFggPSByYWRpdXMgKyB3LFxuICAgICAgZW5kWSA9IHJhZGl1cyArIGg7XG5cbiAgICAvL3dhbGsgdGhyb3VnaCBhbGwgc291cmNlIHBvaW50cyBmb3IgYmx1clxuICAgIGZvciAoeSA9IG1pblk7IHkgPCBtYXhZICsgMTsgeSsrKVxuICAgICAgZm9yICh4ID0gbWluWDsgeCA8IG1heFggKyAxOyB4KyspIHtcbiAgICAgICAgdmFsID0gMDtcbiAgICAgICAgayA9IHkgKiB3ICsgeDsgLy8gaW5kZXggb2YgdGhlIHBvaW50XG4gICAgICAgIHN0YXJ0ID0gcmFkaXVzIC0geCA+IDAgPyByYWRpdXMgLSB4IDogMDtcbiAgICAgICAgZW5kID0gZW5kWCAtIHggPCBuID8gZW5kWCAtIHggOiBuOyAvLyBNYXRoLm1pbigoKCh3IC0gMSkgLSB4KSArIHJhZGl1cykgKyAxLCBuKTtcbiAgICAgICAgazEgPSBrIC0gcmFkaXVzO1xuICAgICAgICAvLyB3YWxrIHRocm91Z2ggeC1uZWlnaGJvcnNcbiAgICAgICAgZm9yIChpID0gc3RhcnQ7IGkgPCBlbmQ7IGkrKykge1xuICAgICAgICAgIHZhbCArPSBkYXRhW2sxICsgaV0gKiB3Z1tpXTtcbiAgICAgICAgfVxuICAgICAgICBzdGFydCA9IHJhZGl1cyAtIHkgPiAwID8gcmFkaXVzIC0geSA6IDA7XG4gICAgICAgIGVuZCA9IGVuZFkgLSB5IDwgbiA/IGVuZFkgLSB5IDogbjsgLy8gTWF0aC5taW4oKCgoaCAtIDEpIC0geSkgKyByYWRpdXMpICsgMSwgbik7XG4gICAgICAgIGsxID0gayAtIHJhZGl1cyAqIHc7XG4gICAgICAgIC8vIHdhbGsgdGhyb3VnaCB5LW5laWdoYm9yc1xuICAgICAgICBmb3IgKGkgPSBzdGFydDsgaSA8IGVuZDsgaSsrKSB7XG4gICAgICAgICAgdmFsICs9IGRhdGFbazEgKyBpICogd10gKiB3Z1tpXTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodmFsID4gMC41KSB7XG4gICAgICAgICAgcmVzdWx0W2tdID0gMTtcbiAgICAgICAgICBjb3VudCsrO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlc3VsdFtrXSA9IDA7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICBjb3VudDogY291bnQsXG4gICAgICBkYXRhOiByZXN1bHQsXG4gICAgICB3aWR0aDogdyxcbiAgICAgIGhlaWdodDogaCxcbiAgICAgIGJvdW5kczoge1xuICAgICAgICBtaW5YOiBtaW5YLFxuICAgICAgICBtaW5ZOiBtaW5ZLFxuICAgICAgICBtYXhYOiBtYXhYLFxuICAgICAgICBtYXhZOiBtYXhZXG4gICAgICB9XG4gICAgfTtcbiAgfTtcblxuICAvKiogQ3JlYXRlIGEgYm9yZGVyIGluZGV4IGFycmF5IG9mIGJvdW5kYXJ5IHBvaW50cyBvZiB0aGUgbWFzayB3aXRoIHJhZGl1cy1uZWlnaGJvcnNcbiAgICogQHBhcmFtIHtPYmplY3R9IG1hc2s6IHtVaW50OEFycmF5fSBkYXRhLCB7aW50fSB3aWR0aCwge2ludH0gaGVpZ2h0LCB7T2JqZWN0fSBib3VuZHNcbiAgICogQHBhcmFtIHtpbnR9IHJhZGl1czogYmx1ciByYWRpdXNcbiAgICogQHBhcmFtIHtVaW50OEFycmF5fSB2aXNpdGVkOiBtYXNrIG9mIHZpc2l0ZWQgcG9pbnRzIChvcHRpb25hbClcbiAgICogQHJldHVybiB7QXJyYXl9IGJvcmRlciBpbmRleCBhcnJheSBvZiBib3VuZGFyeSBwb2ludHMgd2l0aCByYWRpdXMtbmVpZ2hib3JzIChvbmx5IHBvaW50cyBuZWVkIGZvciBibHVyKVxuICAgKi9cbiAgZnVuY3Rpb24gY3JlYXRlQm9yZGVyRm9yQmx1cihtYXNrLCByYWRpdXMsIHZpc2l0ZWQpIHtcblxuICAgIHZhciB4LCBpLCBqLCB5LCBrLCBrMSwgazIsXG4gICAgICB3ID0gbWFzay53aWR0aCxcbiAgICAgIGggPSBtYXNrLmhlaWdodCxcbiAgICAgIGRhdGEgPSBtYXNrLmRhdGEsXG4gICAgICB2aXNpdGVkRGF0YSA9IG5ldyBVaW50OEFycmF5KGRhdGEpLFxuICAgICAgbWluWCA9IG1hc2suYm91bmRzLm1pblgsXG4gICAgICBtYXhYID0gbWFzay5ib3VuZHMubWF4WCxcbiAgICAgIG1pblkgPSBtYXNrLmJvdW5kcy5taW5ZLFxuICAgICAgbWF4WSA9IG1hc2suYm91bmRzLm1heFksXG4gICAgICBsZW4gPSB3ICogaCxcbiAgICAgIHRlbXAgPSBuZXcgVWludDhBcnJheShsZW4pLCAvLyBhdXhpbGlhcnkgYXJyYXkgdG8gY2hlY2sgdW5pcXVlbmVzc1xuICAgICAgYm9yZGVyID0gW10sIC8vIG9ubHkgYm9yZGVyIHBvaW50c1xuICAgICAgeDAgPSBNYXRoLm1heChtaW5YLCAxKSxcbiAgICAgIHgxID0gTWF0aC5taW4obWF4WCwgdyAtIDIpLFxuICAgICAgeTAgPSBNYXRoLm1heChtaW5ZLCAxKSxcbiAgICAgIHkxID0gTWF0aC5taW4obWF4WSwgaCAtIDIpO1xuXG4gICAgaWYgKHZpc2l0ZWQgJiYgdmlzaXRlZC5sZW5ndGggPiAwKSB7XG4gICAgICAvLyBjb3B5IHZpc2l0ZWQgcG9pbnRzIChvbmx5IFwiYmxhY2tcIilcbiAgICAgIGZvciAoayA9IDA7IGsgPCBsZW47IGsrKykge1xuICAgICAgICBpZiAodmlzaXRlZFtrXSA9PT0gMSkgdmlzaXRlZERhdGFba10gPSAxO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIHdhbGsgdGhyb3VnaCBpbm5lciB2YWx1ZXMgZXhjZXB0IHBvaW50cyBvbiB0aGUgYm91bmRhcnkgb2YgdGhlIGltYWdlXG4gICAgZm9yICh5ID0geTA7IHkgPCB5MSArIDE7IHkrKylcbiAgICAgIGZvciAoeCA9IHgwOyB4IDwgeDEgKyAxOyB4KyspIHtcbiAgICAgICAgayA9IHkgKiB3ICsgeDtcbiAgICAgICAgaWYgKGRhdGFba10gPT09IDApIGNvbnRpbnVlOyAvLyBcIndoaXRlXCIgcG9pbnQgaXNuJ3QgdGhlIGJvcmRlclxuICAgICAgICBrMSA9IGsgKyB3OyAvLyB5ICsgMVxuICAgICAgICBrMiA9IGsgLSB3OyAvLyB5IC0gMVxuICAgICAgICAvLyBjaGVjayBpZiBhbnkgbmVpZ2hib3Igd2l0aCBhIFwid2hpdGVcIiBjb2xvclxuICAgICAgICBpZiAodmlzaXRlZERhdGFbayArIDFdID09PSAwIHx8IHZpc2l0ZWREYXRhW2sgLSAxXSA9PT0gMCB8fFxuICAgICAgICAgIHZpc2l0ZWREYXRhW2sxXSA9PT0gMCB8fCB2aXNpdGVkRGF0YVtrMSArIDFdID09PSAwIHx8IHZpc2l0ZWREYXRhW2sxIC0gMV0gPT09IDAgfHxcbiAgICAgICAgICB2aXNpdGVkRGF0YVtrMl0gPT09IDAgfHwgdmlzaXRlZERhdGFbazIgKyAxXSA9PT0gMCB8fCB2aXNpdGVkRGF0YVtrMiAtIDFdID09PSAwKSB7XG4gICAgICAgICAgLy9pZiAodmlzaXRlZERhdGFbayArIDFdICsgdmlzaXRlZERhdGFbayAtIDFdICtcbiAgICAgICAgICAvLyAgICB2aXNpdGVkRGF0YVtrMV0gKyB2aXNpdGVkRGF0YVtrMSArIDFdICsgdmlzaXRlZERhdGFbazEgLSAxXSArXG4gICAgICAgICAgLy8gICAgdmlzaXRlZERhdGFbazJdICsgdmlzaXRlZERhdGFbazIgKyAxXSArIHZpc2l0ZWREYXRhW2syIC0gMV0gPT0gOCkgY29udGludWU7XG4gICAgICAgICAgYm9yZGVyLnB1c2goayk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgIC8vIHdhbGsgdGhyb3VnaCBwb2ludHMgb24gdGhlIGJvdW5kYXJ5IG9mIHRoZSBpbWFnZSBpZiBuZWNlc3NhcnlcbiAgICAvLyBpZiB0aGUgXCJibGFja1wiIHBvaW50IGlzIGFkamFjZW50IHRvIHRoZSBib3VuZGFyeSBvZiB0aGUgaW1hZ2UsIGl0IGlzIGEgYm9yZGVyIHBvaW50XG4gICAgaWYgKG1pblggPT0gMClcbiAgICAgIGZvciAoeSA9IG1pblk7IHkgPCBtYXhZICsgMTsgeSsrKVxuICAgICAgICBpZiAoZGF0YVt5ICogd10gPT09IDEpXG4gICAgICAgICAgYm9yZGVyLnB1c2goeSAqIHcpO1xuXG4gICAgaWYgKG1heFggPT0gdyAtIDEpXG4gICAgICBmb3IgKHkgPSBtaW5ZOyB5IDwgbWF4WSArIDE7IHkrKylcbiAgICAgICAgaWYgKGRhdGFbeSAqIHcgKyBtYXhYXSA9PT0gMSlcbiAgICAgICAgICBib3JkZXIucHVzaCh5ICogdyArIG1heFgpO1xuXG4gICAgaWYgKG1pblkgPT0gMClcbiAgICAgIGZvciAoeCA9IG1pblg7IHggPCBtYXhYICsgMTsgeCsrKVxuICAgICAgICBpZiAoZGF0YVt4XSA9PT0gMSlcbiAgICAgICAgICBib3JkZXIucHVzaCh4KTtcblxuICAgIGlmIChtYXhZID09IGggLSAxKVxuICAgICAgZm9yICh4ID0gbWluWDsgeCA8IG1heFggKyAxOyB4KyspXG4gICAgICAgIGlmIChkYXRhW21heFkgKiB3ICsgeF0gPT09IDEpXG4gICAgICAgICAgYm9yZGVyLnB1c2gobWF4WSAqIHcgKyB4KTtcblxuICAgIHZhciByZXN1bHQgPSBbXSwgLy8gYm9yZGVyIHBvaW50cyB3aXRoIHJhZGl1cy1uZWlnaGJvcnNcbiAgICAgIHN0YXJ0LCBlbmQsXG4gICAgICBlbmRYID0gcmFkaXVzICsgdyxcbiAgICAgIGVuZFkgPSByYWRpdXMgKyBoLFxuICAgICAgbiA9IHJhZGl1cyAqIDIgKyAxOyAvLyBzaXplIG9mIHRoZSBwYXR0ZXJuIGZvciByYWRpdXMtbmVpZ2hib3JzIChmcm9tIC1yIHRvICtyIHdpdGggdGhlIGNlbnRlciBwb2ludClcblxuICAgIGxlbiA9IGJvcmRlci5sZW5ndGg7XG4gICAgLy8gd2FsayB0aHJvdWdoIHJhZGl1cy1uZWlnaGJvcnMgb2YgYm9yZGVyIHBvaW50cyBhbmQgYWRkIHRoZW0gdG8gdGhlIHJlc3VsdCBhcnJheVxuICAgIGZvciAoaiA9IDA7IGogPCBsZW47IGorKykge1xuICAgICAgayA9IGJvcmRlcltqXTsgLy8gaW5kZXggb2YgdGhlIGJvcmRlciBwb2ludFxuICAgICAgdGVtcFtrXSA9IDE7IC8vIG1hcmsgYm9yZGVyIHBvaW50XG4gICAgICByZXN1bHQucHVzaChrKTsgLy8gc2F2ZSB0aGUgYm9yZGVyIHBvaW50XG4gICAgICB4ID0gayAlIHc7IC8vIGNhbGMgeCBieSBpbmRleFxuICAgICAgeSA9IChrIC0geCkgLyB3OyAvLyBjYWxjIHkgYnkgaW5kZXhcbiAgICAgIHN0YXJ0ID0gcmFkaXVzIC0geCA+IDAgPyByYWRpdXMgLSB4IDogMDtcbiAgICAgIGVuZCA9IGVuZFggLSB4IDwgbiA/IGVuZFggLSB4IDogbjsgLy8gTWF0aC5taW4oKCgodyAtIDEpIC0geCkgKyByYWRpdXMpICsgMSwgbik7XG4gICAgICBrMSA9IGsgLSByYWRpdXM7XG4gICAgICAvLyB3YWxrIHRocm91Z2ggeC1uZWlnaGJvcnNcbiAgICAgIGZvciAoaSA9IHN0YXJ0OyBpIDwgZW5kOyBpKyspIHtcbiAgICAgICAgazIgPSBrMSArIGk7XG4gICAgICAgIGlmICh0ZW1wW2syXSA9PT0gMCkgeyAvLyBjaGVjayB0aGUgdW5pcXVlbmVzc1xuICAgICAgICAgIHRlbXBbazJdID0gMTtcbiAgICAgICAgICByZXN1bHQucHVzaChrMik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHN0YXJ0ID0gcmFkaXVzIC0geSA+IDAgPyByYWRpdXMgLSB5IDogMDtcbiAgICAgIGVuZCA9IGVuZFkgLSB5IDwgbiA/IGVuZFkgLSB5IDogbjsgLy8gTWF0aC5taW4oKCgoaCAtIDEpIC0geSkgKyByYWRpdXMpICsgMSwgbik7XG4gICAgICBrMSA9IGsgLSByYWRpdXMgKiB3O1xuICAgICAgLy8gd2FsayB0aHJvdWdoIHktbmVpZ2hib3JzXG4gICAgICBmb3IgKGkgPSBzdGFydDsgaSA8IGVuZDsgaSsrKSB7XG4gICAgICAgIGsyID0gazEgKyBpICogdztcbiAgICAgICAgaWYgKHRlbXBbazJdID09PSAwKSB7IC8vIGNoZWNrIHRoZSB1bmlxdWVuZXNzXG4gICAgICAgICAgdGVtcFtrMl0gPSAxO1xuICAgICAgICAgIHJlc3VsdC5wdXNoKGsyKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG5cbiAgLyoqIEFwcGx5IHRoZSBnYXVzcy1ibHVyIGZpbHRlciBPTkxZIHRvIGJvcmRlciBwb2ludHMgd2l0aCByYWRpdXMtbmVpZ2hib3JzXG4gICAqIEFsZ29yaXRobXM6IGh0dHA6Ly9ibG9nLml2YW5rLm5ldC9mYXN0ZXN0LWdhdXNzaWFuLWJsdXIuaHRtbFxuICAgKiBodHRwOi8vd3d3LmxpYnJvdy5jb20vYXJ0aWNsZXMvYXJ0aWNsZS05XG4gICAqIGh0dHA6Ly9lbHlueHNkay5mcmVlLmZyL2V4dC1kb2NzL0JsdXIvRmFzdF9ib3hfYmx1ci5wZGZcbiAgICogQHBhcmFtICB7T2JqZWN0fSAgICAgbWFzazogICAgIHtVaW50OEFycmF5fSBkYXRhLCB7aW50fSB3aWR0aCwge2ludH0gaGVpZ2h0LCB7T2JqZWN0fSBib3VuZHNcbiAgICogQHBhcmFtICB7aW50fSAgICAgICAgcmFkaXVzOiAgIGJsdXIgcmFkaXVzXG4gICAqIEBwYXJhbSAge1VpbnQ4QXJyYXl9IHZpc2l0ZWQ6ICBtYXNrIG9mIHZpc2l0ZWQgcG9pbnRzIChvcHRpb25hbClcbiAgICogQHJldHVybiB7T2JqZWN0fSAgICAgbWFzazogICAgIHtVaW50OEFycmF5fSBkYXRhLCB7aW50fSB3aWR0aCwge2ludH0gaGVpZ2h0LCB7T2JqZWN0fSBib3VuZHNcbiAgICovXG4gIGxpYi5nYXVzc0JsdXJPbmx5Qm9yZGVyID0gZnVuY3Rpb24gKG1hc2ssIHJhZGl1cywgdmlzaXRlZCkge1xuXG4gICAgdmFyIGJvcmRlciA9IGNyZWF0ZUJvcmRlckZvckJsdXIobWFzaywgcmFkaXVzLCB2aXNpdGVkKSwgLy8gZ2V0IGJvcmRlciBwb2ludHMgd2l0aCByYWRpdXMtbmVpZ2hib3JzXG4gICAgICB3dywgZHNxLCBpLCBqLCBrLCBrMSwgeCwgeSwgdmFsLCBzdGFydCwgZW5kLFxuICAgICAgbiA9IHJhZGl1cyAqIDIgKyAxLCAvLyBzaXplIG9mIHRoZSBwYXR0ZXJuIGZvciByYWRpdXMtbmVpZ2hib3JzIChmcm9tIC1yIHRvICtyIHdpdGggY2VudGVyIHBvaW50KVxuICAgICAgczIgPSAyICogcmFkaXVzICogcmFkaXVzLFxuICAgICAgd2cgPSBuZXcgRmxvYXQzMkFycmF5KG4pLCAvLyB3ZWlnaHRzXG4gICAgICB0b3RhbCA9IDAsIC8vIHN1bSBvZiB3ZWlnaHRzKHVzZWQgZm9yIG5vcm1hbGl6YXRpb24pXG4gICAgICB3ID0gbWFzay53aWR0aCxcbiAgICAgIGggPSBtYXNrLmhlaWdodCxcbiAgICAgIGRhdGEgPSBtYXNrLmRhdGEsXG4gICAgICBtaW5YID0gbWFzay5ib3VuZHMubWluWCxcbiAgICAgIG1heFggPSBtYXNrLmJvdW5kcy5tYXhYLFxuICAgICAgbWluWSA9IG1hc2suYm91bmRzLm1pblksXG4gICAgICBtYXhZID0gbWFzay5ib3VuZHMubWF4WSxcbiAgICAgIGxlbiA9IGJvcmRlci5sZW5ndGg7XG5cbiAgICAvLyBjYWxjIGdhdXNzIHdlaWdodHNcbiAgICBmb3IgKGkgPSAwOyBpIDwgcmFkaXVzOyBpKyspIHtcbiAgICAgIGRzcSA9IChyYWRpdXMgLSBpKSAqIChyYWRpdXMgLSBpKTtcbiAgICAgIHd3ID0gTWF0aC5leHAoLWRzcSAvIHMyKSAvIE1hdGguUEk7XG4gICAgICB3Z1tyYWRpdXMgKyBpXSA9IHdnW3JhZGl1cyAtIGldID0gd3c7XG4gICAgICB0b3RhbCArPSAyICogd3c7XG4gICAgfVxuICAgIC8vIG5vcm1hbGl6YXRpb24gd2VpZ2h0c1xuICAgIGZvciAoaSA9IDA7IGkgPCBuOyBpKyspIHtcbiAgICAgIHdnW2ldIC89IHRvdGFsO1xuICAgIH1cblxuICAgIHZhciByZXN1bHQgPSBuZXcgU2VsZWN0aW9uTWFzayh3LGgsZGF0YSksIC8vIGNvcHkgdGhlIHNvdXJjZSBtYXNrXG4gICAgICBlbmRYID0gcmFkaXVzICsgdyxcbiAgICAgIGVuZFkgPSByYWRpdXMgKyBoO1xuXG4gICAgLy93YWxrIHRocm91Z2ggYWxsIGJvcmRlciBwb2ludHMgZm9yIGJsdXJcbiAgICBmb3IgKGkgPSAwOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgIGsgPSBib3JkZXJbaV07IC8vIGluZGV4IG9mIHRoZSBib3JkZXIgcG9pbnRcbiAgICAgIHZhbCA9IDA7XG4gICAgICB4ID0gayAlIHc7IC8vIGNhbGMgeCBieSBpbmRleFxuICAgICAgeSA9IChrIC0geCkgLyB3OyAvLyBjYWxjIHkgYnkgaW5kZXhcbiAgICAgIHN0YXJ0ID0gcmFkaXVzIC0geCA+IDAgPyByYWRpdXMgLSB4IDogMDtcbiAgICAgIGVuZCA9IGVuZFggLSB4IDwgbiA/IGVuZFggLSB4IDogbjsgLy8gTWF0aC5taW4oKCgodyAtIDEpIC0geCkgKyByYWRpdXMpICsgMSwgbik7XG4gICAgICBrMSA9IGsgLSByYWRpdXM7XG4gICAgICAvLyB3YWxrIHRocm91Z2ggeC1uZWlnaGJvcnNcbiAgICAgIGZvciAoaiA9IHN0YXJ0OyBqIDwgZW5kOyBqKyspIHtcbiAgICAgICAgdmFsICs9IGRhdGFbazEgKyBqXSAqIHdnW2pdO1xuICAgICAgfVxuICAgICAgaWYgKHZhbCA+IDAuNSkge1xuICAgICAgICByZXN1bHQuZGF0YVtrXSA9IDE7XG4gICAgICAgIHJlc3VsdC5jb3VudCsrO1xuICAgICAgICAvLyBjaGVjayBtaW5tYXhcbiAgICAgICAgaWYgKHggPCBtaW5YKSBtaW5YID0geDtcbiAgICAgICAgaWYgKHggPiBtYXhYKSBtYXhYID0geDtcbiAgICAgICAgaWYgKHkgPCBtaW5ZKSBtaW5ZID0geTtcbiAgICAgICAgaWYgKHkgPiBtYXhZKSBtYXhZID0geTtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBzdGFydCA9IHJhZGl1cyAtIHkgPiAwID8gcmFkaXVzIC0geSA6IDA7XG4gICAgICBlbmQgPSBlbmRZIC0geSA8IG4gPyBlbmRZIC0geSA6IG47IC8vIE1hdGgubWluKCgoKGggLSAxKSAtIHkpICsgcmFkaXVzKSArIDEsIG4pO1xuICAgICAgazEgPSBrIC0gcmFkaXVzICogdztcbiAgICAgIC8vIHdhbGsgdGhyb3VnaCB5LW5laWdoYm9yc1xuICAgICAgZm9yIChqID0gc3RhcnQ7IGogPCBlbmQ7IGorKykge1xuICAgICAgICB2YWwgKz0gZGF0YVtrMSArIGogKiB3XSAqIHdnW2pdO1xuICAgICAgfVxuICAgICAgaWYgKHZhbCA+IDAuNSkge1xuICAgICAgICByZXN1bHQuZGF0YVtrXSA9IDE7XG4gICAgICAgIHJlc3VsdC5jb3VudCsrO1xuICAgICAgICAvLyBjaGVjayBtaW5tYXhcbiAgICAgICAgaWYgKHggPCBtaW5YKSBtaW5YID0geDtcbiAgICAgICAgaWYgKHggPiBtYXhYKSBtYXhYID0geDtcbiAgICAgICAgaWYgKHkgPCBtaW5ZKSBtaW5ZID0geTtcbiAgICAgICAgaWYgKHkgPiBtYXhZKSBtYXhZID0geTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlc3VsdC5kYXRhW2tdID0gMDtcbiAgICAgIH1cbiAgICB9XG4gICAgcmVzdWx0LmJvdW5kcyA9IHtcbiAgICAgIG1pblg6IG1pblgsXG4gICAgICBtaW5ZOiBtaW5ZLFxuICAgICAgbWF4WDogbWF4WCxcbiAgICAgIG1heFk6IG1heFlcbiAgICB9O1xuXG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcblxuICAvKiogQ3JlYXRlIGEgYm9yZGVyIG1hc2sgKG9ubHkgYm91bmRhcnkgcG9pbnRzKVxuICAgKiBAcGFyYW0ge09iamVjdH0gbWFzazoge1VpbnQ4QXJyYXl9IGRhdGEsIHtpbnR9IHdpZHRoLCB7aW50fSBoZWlnaHQsIHtPYmplY3R9IGJvdW5kc1xuICAgKiBAcmV0dXJuIHtPYmplY3R9IGJvcmRlciBtYXNrOiB7VWludDhBcnJheX0gZGF0YSwge2ludH0gd2lkdGgsIHtpbnR9IGhlaWdodCwge09iamVjdH0gb2Zmc2V0XG4gICAqL1xuICBsaWIuY3JlYXRlQm9yZGVyTWFzayA9IGZ1bmN0aW9uIChtYXNrKSB7XG5cbiAgICB2YXIgeCwgeSwgaywgazEsIGsyLFxuICAgICAgdyA9IG1hc2sud2lkdGgsXG4gICAgICBoID0gbWFzay5oZWlnaHQsXG4gICAgICBkYXRhID0gbWFzay5kYXRhLFxuICAgICAgbWluWCA9IG1hc2suYm91bmRzLm1pblgsXG4gICAgICBtYXhYID0gbWFzay5ib3VuZHMubWF4WCxcbiAgICAgIG1pblkgPSBtYXNrLmJvdW5kcy5taW5ZLFxuICAgICAgbWF4WSA9IG1hc2suYm91bmRzLm1heFksXG4gICAgICBydyA9IG1heFggLSBtaW5YICsgMSwgLy8gYm91bmRzIHNpemVcbiAgICAgIHJoID0gbWF4WSAtIG1pblkgKyAxLFxuICAgICAgcmVzdWx0ID0gbmV3IFVpbnQ4QXJyYXkocncgKiByaCksIC8vIHJlZHVjZWQgbWFzayAoYm91bmRzIHNpemUpXG4gICAgICB4MCA9IE1hdGgubWF4KG1pblgsIDEpLFxuICAgICAgeDEgPSBNYXRoLm1pbihtYXhYLCB3IC0gMiksXG4gICAgICB5MCA9IE1hdGgubWF4KG1pblksIDEpLFxuICAgICAgeTEgPSBNYXRoLm1pbihtYXhZLCBoIC0gMiksXG4gICAgICBjb3VudCA9IDA7XG5cbiAgICAvLyB3YWxrIHRocm91Z2ggaW5uZXIgdmFsdWVzIGV4Y2VwdCBwb2ludHMgb24gdGhlIGJvdW5kYXJ5IG9mIHRoZSBpbWFnZVxuICAgIGZvciAoeSA9IHkwOyB5IDwgeTEgKyAxOyB5KyspXG4gICAgICBmb3IgKHggPSB4MDsgeCA8IHgxICsgMTsgeCsrKSB7XG4gICAgICAgIGsgPSB5ICogdyArIHg7XG4gICAgICAgIGlmIChkYXRhW2tdID09PSAwKSBjb250aW51ZTsgLy8gXCJ3aGl0ZVwiIHBvaW50IGlzbid0IHRoZSBib3JkZXJcbiAgICAgICAgazEgPSBrICsgdzsgLy8geSArIDFcbiAgICAgICAgazIgPSBrIC0gdzsgLy8geSAtIDFcbiAgICAgICAgLy8gY2hlY2sgaWYgYW55IG5laWdoYm9yIHdpdGggYSBcIndoaXRlXCIgY29sb3JcbiAgICAgICAgaWYgKGRhdGFbayArIDFdID09PSAwIHx8IGRhdGFbayAtIDFdID09PSAwIHx8XG4gICAgICAgICAgZGF0YVtrMV0gPT09IDAgfHwgZGF0YVtrMSArIDFdID09PSAwIHx8IGRhdGFbazEgLSAxXSA9PT0gMCB8fFxuICAgICAgICAgIGRhdGFbazJdID09PSAwIHx8IGRhdGFbazIgKyAxXSA9PT0gMCB8fCBkYXRhW2syIC0gMV0gPT09IDApIHtcbiAgICAgICAgICAvL2lmIChkYXRhW2sgKyAxXSArIGRhdGFbayAtIDFdICtcbiAgICAgICAgICAvLyAgICBkYXRhW2sxXSArIGRhdGFbazEgKyAxXSArIGRhdGFbazEgLSAxXSArXG4gICAgICAgICAgLy8gICAgZGF0YVtrMl0gKyBkYXRhW2syICsgMV0gKyBkYXRhW2syIC0gMV0gPT0gOCkgY29udGludWU7XG4gICAgICAgICAgcmVzdWx0Wyh5IC0gbWluWSkgKiBydyArICh4IC0gbWluWCldID0gMTtcbiAgICAgICAgICBjb3VudCsrO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAvLyB3YWxrIHRocm91Z2ggcG9pbnRzIG9uIHRoZSBib3VuZGFyeSBvZiB0aGUgaW1hZ2UgaWYgbmVjZXNzYXJ5XG4gICAgLy8gaWYgdGhlIFwiYmxhY2tcIiBwb2ludCBpcyBhZGphY2VudCB0byB0aGUgYm91bmRhcnkgb2YgdGhlIGltYWdlLCBpdCBpcyBhIGJvcmRlciBwb2ludFxuICAgIGlmIChtaW5YID09IDApXG4gICAgICBmb3IgKHkgPSBtaW5ZOyB5IDwgbWF4WSArIDE7IHkrKylcbiAgICAgICAgaWYgKGRhdGFbeSAqIHddID09PSAxKSB7XG4gICAgICAgICAgcmVzdWx0Wyh5IC0gbWluWSkgKiByd10gPSAxO1xuICAgICAgICAgIGNvdW50Kys7XG4gICAgICAgIH1cblxuICAgIGlmIChtYXhYID09IHcgLSAxKVxuICAgICAgZm9yICh5ID0gbWluWTsgeSA8IG1heFkgKyAxOyB5KyspXG4gICAgICAgIGlmIChkYXRhW3kgKiB3ICsgbWF4WF0gPT09IDEpIHtcbiAgICAgICAgICByZXN1bHRbKHkgLSBtaW5ZKSAqIHJ3ICsgKG1heFggLSBtaW5YKV0gPSAxO1xuICAgICAgICAgIGNvdW50Kys7XG4gICAgICAgIH1cblxuICAgIGlmIChtaW5ZID09IDApXG4gICAgICBmb3IgKHggPSBtaW5YOyB4IDwgbWF4WCArIDE7IHgrKylcbiAgICAgICAgaWYgKGRhdGFbeF0gPT09IDEpIHtcbiAgICAgICAgICByZXN1bHRbeCAtIG1pblhdID0gMTtcbiAgICAgICAgICBjb3VudCsrO1xuICAgICAgICB9XG5cbiAgICBpZiAobWF4WSA9PSBoIC0gMSlcbiAgICAgIGZvciAoeCA9IG1pblg7IHggPCBtYXhYICsgMTsgeCsrKVxuICAgICAgICBpZiAoZGF0YVttYXhZICogdyArIHhdID09PSAxKSB7XG4gICAgICAgICAgcmVzdWx0WyhtYXhZIC0gbWluWSkgKiBydyArICh4IC0gbWluWCldID0gMTtcbiAgICAgICAgICBjb3VudCsrO1xuICAgICAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgY291bnQ6IGNvdW50LFxuICAgICAgZGF0YTogcmVzdWx0LFxuICAgICAgd2lkdGg6IHJ3LFxuICAgICAgaGVpZ2h0OiByaCxcbiAgICAgIG9mZnNldDoge3g6IG1pblgsIHk6IG1pbll9XG4gICAgfTtcbiAgfTtcblxuICAvKiogQ3JlYXRlIGEgYm9yZGVyIGluZGV4IGFycmF5IG9mIGJvdW5kYXJ5IHBvaW50cyBvZiB0aGUgbWFza1xuICAgKiBAcGFyYW0ge09iamVjdH0gbWFzazoge1VpbnQ4QXJyYXl9IGRhdGEsIHtpbnR9IHdpZHRoLCB7aW50fSBoZWlnaHRcbiAgICogQHJldHVybiB7QXJyYXl9IGJvcmRlciBpbmRleCBhcnJheSBib3VuZGFyeSBwb2ludHMgb2YgdGhlIG1hc2tcbiAgICovXG4gIGxpYi5nZXRCb3JkZXJJbmRpY2VzID0gZnVuY3Rpb24gKG1hc2spIHtcblxuICAgIHZhciB4LCB5LCBrLCBrMSwgazIsXG4gICAgICB3ID0gbWFzay53aWR0aCxcbiAgICAgIGggPSBtYXNrLmhlaWdodCxcbiAgICAgIGRhdGEgPSBtYXNrLmRhdGEsXG4gICAgICBib3JkZXIgPSBbXSwgLy8gb25seSBib3JkZXIgcG9pbnRzXG4gICAgICB4MSA9IHcgLSAxLFxuICAgICAgeTEgPSBoIC0gMTtcblxuICAgIC8vIHdhbGsgdGhyb3VnaCBpbm5lciB2YWx1ZXMgZXhjZXB0IHBvaW50cyBvbiB0aGUgYm91bmRhcnkgb2YgdGhlIGltYWdlXG4gICAgZm9yICh5ID0gMTsgeSA8IHkxOyB5KyspXG4gICAgICBmb3IgKHggPSAxOyB4IDwgeDE7IHgrKykge1xuICAgICAgICBrID0geSAqIHcgKyB4O1xuICAgICAgICBpZiAoZGF0YVtrXSA9PT0gMCkgY29udGludWU7IC8vIFwid2hpdGVcIiBwb2ludCBpc24ndCB0aGUgYm9yZGVyXG4gICAgICAgIGsxID0gayArIHc7IC8vIHkgKyAxXG4gICAgICAgIGsyID0gayAtIHc7IC8vIHkgLSAxXG4gICAgICAgIC8vIGNoZWNrIGlmIGFueSBuZWlnaGJvciB3aXRoIGEgXCJ3aGl0ZVwiIGNvbG9yXG4gICAgICAgIGlmIChkYXRhW2sgKyAxXSA9PT0gMCB8fCBkYXRhW2sgLSAxXSA9PT0gMCB8fFxuICAgICAgICAgIGRhdGFbazFdID09PSAwIHx8IGRhdGFbazEgKyAxXSA9PT0gMCB8fCBkYXRhW2sxIC0gMV0gPT09IDAgfHxcbiAgICAgICAgICBkYXRhW2syXSA9PT0gMCB8fCBkYXRhW2syICsgMV0gPT09IDAgfHwgZGF0YVtrMiAtIDFdID09PSAwKSB7XG4gICAgICAgICAgLy9pZiAoZGF0YVtrICsgMV0gKyBkYXRhW2sgLSAxXSArXG4gICAgICAgICAgLy8gICAgZGF0YVtrMV0gKyBkYXRhW2sxICsgMV0gKyBkYXRhW2sxIC0gMV0gK1xuICAgICAgICAgIC8vICAgIGRhdGFbazJdICsgZGF0YVtrMiArIDFdICsgZGF0YVtrMiAtIDFdID09IDgpIGNvbnRpbnVlO1xuICAgICAgICAgIGJvcmRlci5wdXNoKGspO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAvLyB3YWxrIHRocm91Z2ggcG9pbnRzIG9uIHRoZSBib3VuZGFyeSBvZiB0aGUgaW1hZ2UgaWYgbmVjZXNzYXJ5XG4gICAgLy8gaWYgdGhlIFwiYmxhY2tcIiBwb2ludCBpcyBhZGphY2VudCB0byB0aGUgYm91bmRhcnkgb2YgdGhlIGltYWdlLCBpdCBpcyBhIGJvcmRlciBwb2ludFxuICAgIGZvciAoeSA9IDA7IHkgPCBoOyB5KyspXG4gICAgICBpZiAoZGF0YVt5ICogd10gPT09IDEpXG4gICAgICAgIGJvcmRlci5wdXNoKHkgKiB3KTtcblxuICAgIGZvciAoeCA9IDA7IHggPCB3OyB4KyspXG4gICAgICBpZiAoZGF0YVt4XSA9PT0gMSlcbiAgICAgICAgYm9yZGVyLnB1c2goeCk7XG5cbiAgICBrID0gdyAtIDE7XG4gICAgZm9yICh5ID0gMDsgeSA8IGg7IHkrKylcbiAgICAgIGlmIChkYXRhW3kgKiB3ICsga10gPT09IDEpXG4gICAgICAgIGJvcmRlci5wdXNoKHkgKiB3ICsgayk7XG5cbiAgICBrID0gKGggLSAxKSAqIHc7XG4gICAgZm9yICh4ID0gMDsgeCA8IHc7IHgrKylcbiAgICAgIGlmIChkYXRhW2sgKyB4XSA9PT0gMSlcbiAgICAgICAgYm9yZGVyLnB1c2goayArIHgpO1xuXG4gICAgcmV0dXJuIGJvcmRlcjtcbiAgfTtcblxuICAvKiogQ3JlYXRlIGEgY29tcHJlc3NlZCBtYXNrIHdpdGggYSBcIndoaXRlXCIgYm9yZGVyICgxcHggYm9yZGVyIHdpdGggemVybyB2YWx1ZXMpIGZvciB0aGUgY29udG91ciB0cmFjaW5nXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBtYXNrOiB7VWludDhBcnJheX0gZGF0YSwge2ludH0gd2lkdGgsIHtpbnR9IGhlaWdodCwge09iamVjdH0gYm91bmRzXG4gICAqIEByZXR1cm4ge09iamVjdH0gYm9yZGVyIG1hc2s6IHtVaW50OEFycmF5fSBkYXRhLCB7aW50fSB3aWR0aCwge2ludH0gaGVpZ2h0LCB7T2JqZWN0fSBvZmZzZXRcbiAgICovXG4gIGZ1bmN0aW9uIHByZXBhcmVNYXNrKG1hc2spIHtcbiAgICB2YXIgeCwgeSxcbiAgICAgIHcgPSBtYXNrLndpZHRoLFxuICAgICAgZGF0YSA9IG1hc2suZGF0YSxcbiAgICAgIG1pblggPSBtYXNrLmJvdW5kcy5taW5YLFxuICAgICAgbWF4WCA9IG1hc2suYm91bmRzLm1heFgsXG4gICAgICBtaW5ZID0gbWFzay5ib3VuZHMubWluWSxcbiAgICAgIG1heFkgPSBtYXNrLmJvdW5kcy5tYXhZLFxuICAgICAgcncgPSBtYXhYIC0gbWluWCArIDMsIC8vIGJvdW5kcyBzaXplICsxIHB4IG9uIGVhY2ggc2lkZSAoYSBcIndoaXRlXCIgYm9yZGVyKVxuICAgICAgcmggPSBtYXhZIC0gbWluWSArIDMsXG4gICAgICByZXN1bHQgPSBuZXcgVWludDhBcnJheShydyAqIHJoKTsgLy8gcmVkdWNlZCBtYXNrIChib3VuZHMgc2l6ZSlcblxuICAgIC8vIHdhbGsgdGhyb3VnaCBpbm5lciB2YWx1ZXMgYW5kIGNvcHkgb25seSBcImJsYWNrXCIgcG9pbnRzIHRvIHRoZSByZXN1bHQgbWFza1xuICAgIGZvciAoeSA9IG1pblk7IHkgPCBtYXhZICsgMTsgeSsrKVxuICAgICAgZm9yICh4ID0gbWluWDsgeCA8IG1heFggKyAxOyB4KyspIHtcbiAgICAgICAgaWYgKGRhdGFbeSAqIHcgKyB4XSA9PT0gMSlcbiAgICAgICAgICByZXN1bHRbKHkgLSBtaW5ZICsgMSkgKiBydyArICh4IC0gbWluWCArIDEpXSA9IDE7XG4gICAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgZGF0YTogcmVzdWx0LFxuICAgICAgd2lkdGg6IHJ3LFxuICAgICAgaGVpZ2h0OiByaCxcbiAgICAgIG9mZnNldDoge3g6IG1pblggLSAxLCB5OiBtaW5ZIC0gMX1cbiAgICB9O1xuICB9O1xuXG4gIC8qKiBDcmVhdGUgYSBjb250b3VyIGFycmF5IGZvciB0aGUgYmluYXJ5IG1hc2tcbiAgICogQWxnb3JpdGhtOiBodHRwOi8vd3d3LnNjaWVuY2VkaXJlY3QuY29tL3NjaWVuY2UvYXJ0aWNsZS9waWkvUzEwNzczMTQyMDMwMDE0MDFcbiAgICogQHBhcmFtIHtPYmplY3R9IG1hc2s6IHtVaW50OEFycmF5fSBkYXRhLCB7aW50fSB3aWR0aCwge2ludH0gaGVpZ2h0LCB7T2JqZWN0fSBib3VuZHNcbiAgICogQHJldHVybiB7QXJyYXl9IGNvbnRvdXJzOiB7QXJyYXl9IHBvaW50cywge2Jvb2x9IGlubmVyLCB7aW50fSBsYWJlbFxuICAgKi9cbiAgbGliLnRyYWNlQ29udG91cnMgPSBmdW5jdGlvbiAobWFzaykge1xuICAgIHZhciBtID0gcHJlcGFyZU1hc2sobWFzayksXG4gICAgICBjb250b3VycyA9IFtdLFxuICAgICAgbGFiZWwgPSAwLFxuICAgICAgdyA9IG0ud2lkdGgsXG4gICAgICB3MiA9IHcgKiAyLFxuICAgICAgaCA9IG0uaGVpZ2h0LFxuICAgICAgc3JjID0gbS5kYXRhLFxuICAgICAgZHggPSBtLm9mZnNldC54LFxuICAgICAgZHkgPSBtLm9mZnNldC55LFxuICAgICAgYm91bmRzLF9wLFxuICAgICAgZGVzdCA9IG5ldyBVaW50OEFycmF5KHNyYyksIC8vIGxhYmVsIG1hdHJpeFxuICAgICAgaSwgaiwgeCwgeSwgaywgazEsIGMsIGlubmVyLCBkaXIsIGZpcnN0LCBzZWNvbmQsIGN1cnJlbnQsIHByZXZpb3VzLCBuZXh0LCBkO1xuXG4gICAgLy8gYWxsIFtkeCxkeV0gcGFpcnMgKGFycmF5IGluZGV4IGlzIHRoZSBkaXJlY3Rpb24pXG4gICAgLy8gNSA2IDdcbiAgICAvLyA0IFggMFxuICAgIC8vIDMgMiAxXG4gICAgdmFyIGRpcmVjdGlvbnMgPSBbWzEsIDBdLCBbMSwgMV0sIFswLCAxXSwgWy0xLCAxXSwgWy0xLCAwXSwgWy0xLCAtMV0sIFswLCAtMV0sIFsxLCAtMV1dO1xuXG4gICAgZm9yICh5ID0gMTsgeSA8IGggLSAxOyB5KyspXG4gICAgICBmb3IgKHggPSAxOyB4IDwgdyAtIDE7IHgrKykge1xuICAgICAgICBrID0geSAqIHcgKyB4O1xuICAgICAgICBpZiAoc3JjW2tdID09PSAxKSB7XG4gICAgICAgICAgZm9yIChpID0gLXc7IGkgPCB3MjsgaSArPSB3MikgeyAvLyBrIC0gdzogb3V0ZXIgdHJhY2luZyAoeSAtIDEpLCBrICsgdzogaW5uZXIgdHJhY2luZyAoeSArIDEpXG4gICAgICAgICAgICBpZiAoc3JjW2sgKyBpXSA9PT0gMCAmJiBkZXN0W2sgKyBpXSA9PT0gMCkgeyAvLyBuZWVkIGNvbnRvdXIgdHJhY2luZ1xuICAgICAgICAgICAgICBpbm5lciA9IGkgPT09IHc7IC8vIGlzIGlubmVyIGNvbnRvdXIgdHJhY2luZyA/XG4gICAgICAgICAgICAgIGxhYmVsKys7IC8vIGxhYmVsIGZvciB0aGUgbmV4dCBjb250b3VyXG5cbiAgICAgICAgICAgICAgYyA9IFtdO1xuICAgICAgICAgICAgICBib3VuZHMgPSB7XG4gICAgICAgICAgICAgICAgbWluWCA6IHcsXG4gICAgICAgICAgICAgICAgbWluWSA6IGgsXG4gICAgICAgICAgICAgICAgbWF4WCA6IC0xLFxuICAgICAgICAgICAgICAgIG1heFkgOiAtMSxcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgZGlyID0gaW5uZXIgPyAyIDogNjsgLy8gc3RhcnQgZGlyZWN0aW9uXG4gICAgICAgICAgICAgIGN1cnJlbnQgPSBwcmV2aW91cyA9IGZpcnN0ID0ge3g6IHgsIHk6IHl9O1xuICAgICAgICAgICAgICBzZWNvbmQgPSBudWxsO1xuICAgICAgICAgICAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgICAgICAgICAgIGRlc3RbY3VycmVudC55ICogdyArIGN1cnJlbnQueF0gPSBsYWJlbDsgLy8gbWFyayBsYWJlbCBmb3IgdGhlIGN1cnJlbnQgcG9pbnRcbiAgICAgICAgICAgICAgICAvLyBieXBhc3MgYWxsIHRoZSBuZWlnaGJvcnMgYXJvdW5kIHRoZSBjdXJyZW50IHBvaW50IGluIGEgY2xvY2t3aXNlXG4gICAgICAgICAgICAgICAgZm9yIChqID0gMDsgaiA8IDg7IGorKykge1xuICAgICAgICAgICAgICAgICAgZGlyID0gKGRpciArIDEpICUgODtcblxuICAgICAgICAgICAgICAgICAgLy8gZ2V0IHRoZSBuZXh0IHBvaW50IGJ5IG5ldyBkaXJlY3Rpb25cbiAgICAgICAgICAgICAgICAgIGQgPSBkaXJlY3Rpb25zW2Rpcl07IC8vIGluZGV4IGFzIGRpcmVjdGlvblxuICAgICAgICAgICAgICAgICAgbmV4dCA9IHt4OiBjdXJyZW50LnggKyBkWzBdLCB5OiBjdXJyZW50LnkgKyBkWzFdfTtcblxuICAgICAgICAgICAgICAgICAgazEgPSBuZXh0LnkgKiB3ICsgbmV4dC54O1xuICAgICAgICAgICAgICAgICAgaWYgKHNyY1trMV0gPT09IDEpIC8vIGJsYWNrIGJvdW5kYXJ5IHBpeGVsXG4gICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGRlc3RbazFdID0gbGFiZWw7IC8vIG1hcmsgYSBsYWJlbFxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIGRlc3RbazFdID0gLTE7IC8vIG1hcmsgYSB3aGl0ZSBib3VuZGFyeSBwaXhlbFxuICAgICAgICAgICAgICAgICAgbmV4dCA9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChuZXh0ID09PSBudWxsKSBicmVhazsgLy8gbm8gbmVpZ2hib3VycyAob25lLXBvaW50IGNvbnRvdXIpXG4gICAgICAgICAgICAgICAgY3VycmVudCA9IG5leHQ7XG4gICAgICAgICAgICAgICAgaWYgKHNlY29uZCkge1xuICAgICAgICAgICAgICAgICAgaWYgKHByZXZpb3VzLnggPT09IGZpcnN0LnggJiYgcHJldmlvdXMueSA9PT0gZmlyc3QueSAmJiBjdXJyZW50LnggPT09IHNlY29uZC54ICYmIGN1cnJlbnQueSA9PT0gc2Vjb25kLnkpIHtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7IC8vIGNyZWF0aW5nIHRoZSBjb250b3VyIGNvbXBsZXRlZCB3aGVuIHJldHVybmVkIHRvIG9yaWdpbmFsIHBvc2l0aW9uXG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgIHNlY29uZCA9IG5leHQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIF9wID0ge3g6IHByZXZpb3VzLnggKyBkeCwgeTogcHJldmlvdXMueSArIGR5fTtcbiAgICAgICAgICAgICAgICBpZihib3VuZHMubWluWCA+IF9wLngpYm91bmRzLm1pblggPSBfcC54O1xuICAgICAgICAgICAgICAgIGlmKGJvdW5kcy5tYXhYIDwgX3AueClib3VuZHMubWF4WCA9IF9wLng7XG4gICAgICAgICAgICAgICAgaWYoYm91bmRzLm1pblkgPiBfcC55KWJvdW5kcy5taW5ZID0gX3AueTtcbiAgICAgICAgICAgICAgICBpZihib3VuZHMubWF4WSA8IF9wLnkpYm91bmRzLm1heFkgPSBfcC55O1xuICAgICAgICAgICAgICAgIGMucHVzaChfcCk7XG4gICAgICAgICAgICAgICAgcHJldmlvdXMgPSBjdXJyZW50O1xuICAgICAgICAgICAgICAgIGRpciA9IChkaXIgKyA0KSAlIDg7IC8vIG5leHQgZGlyIChzeW1tZXRyaWNhbGx5IHRvIHRoZSBjdXJyZW50IGRpcmVjdGlvbilcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIGlmIChuZXh0ICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBfcCA9IHt4OiBmaXJzdC54ICsgZHgsIHk6IGZpcnN0LnkgKyBkeX07XG4gICAgICAgICAgICAgICAgaWYoYm91bmRzLm1pblggPiAgX3AueClib3VuZHMubWluWCA9ICBfcC54O1xuICAgICAgICAgICAgICAgIGlmKGJvdW5kcy5tYXhYIDwgIF9wLngpYm91bmRzLm1heFggPSAgX3AueDtcbiAgICAgICAgICAgICAgICBpZihib3VuZHMubWluWSA+ICBfcC55KWJvdW5kcy5taW5ZID0gIF9wLnk7XG4gICAgICAgICAgICAgICAgaWYoYm91bmRzLm1heFkgPCAgX3AueSlib3VuZHMubWF4WSA9ICBfcC55O1xuICAgICAgICAgICAgICAgIGMucHVzaChfcCk7IC8vIGNsb3NlIHRoZSBjb250b3VyXG4gICAgICAgICAgICAgICAgY29udG91cnMucHVzaCh7aW5uZXI6IGlubmVyLCBsYWJlbDogbGFiZWwsIHBvaW50czogYyxib3VuZHMgOiBib3VuZHN9KTsgLy8gYWRkIGNvbnRvdXIgdG8gdGhlIGxpc3RcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgcmV0dXJuIGNvbnRvdXJzO1xuICB9O1xuXG4gIGZ1bmN0aW9uIHJnYlRvSHNsKHIsIGcsIGIpe1xuICAgIHIgLz0gMjU1LCBnIC89IDI1NSwgYiAvPSAyNTU7XG4gICAgdmFyIG1heCA9IE1hdGgubWF4KHIsIGcsIGIpLCBtaW4gPSBNYXRoLm1pbihyLCBnLCBiKTtcbiAgICB2YXIgaCwgcywgbCA9IChtYXggKyBtaW4pIC8gMjtcblxuICAgIGlmKG1heCA9PSBtaW4pe1xuICAgICAgaCA9IHMgPSAwOyAvLyBhY2hyb21hdGljXG4gICAgfWVsc2V7XG4gICAgICB2YXIgZCA9IG1heCAtIG1pbjtcbiAgICAgIHMgPSBsID4gMC41ID8gZCAvICgyIC0gbWF4IC0gbWluKSA6IGQgLyAobWF4ICsgbWluKTtcbiAgICAgIHN3aXRjaChtYXgpe1xuICAgICAgICBjYXNlIHI6IGggPSAoZyAtIGIpIC8gZCArIChnIDwgYiA/IDYgOiAwKTsgYnJlYWs7XG4gICAgICAgIGNhc2UgZzogaCA9IChiIC0gcikgLyBkICsgMjsgYnJlYWs7XG4gICAgICAgIGNhc2UgYjogaCA9IChyIC0gZykgLyBkICsgNDsgYnJlYWs7XG4gICAgICB9XG4gICAgICBoIC89IDY7XG4gICAgfVxuXG4gICAgcmV0dXJuIFtoICogMjU1LCBzKiAyNTUsIGwqIDI1NV07XG4gIH1cblxuICBsaWIuc2ltcGxpZnlDb250b3VyID0gZnVuY3Rpb24gKGMsIHNpbXBsaWZ5VG9sZXJhbnQsIHNpbXBsaWZ5Q291bnQpIHtcbiAgICB2YXJcbiAgICAgIGksIGosIGssIGMsIHBvaW50cywgbGVuLCByZXNQb2ludHMsIGxzdCwgc3RhY2ssIGlkcyxcbiAgICAgIG1heGQsIG1heGksIGRpc3QsIHIxLCByMiwgcjEyLCBkeCwgZHksIHBpLCBwZiwgcGw7XG5cbiAgICBwb2ludHMgPSBjLnBvaW50cztcbiAgICBsZW4gPSBjLnBvaW50cy5sZW5ndGg7XG5cbiAgICBpZiAobGVuIDwgc2ltcGxpZnlDb3VudCkgeyAvLyBjb250b3VyIGlzbid0IHNpbXBsaWZpZWRcbiAgICAgIHJlc1BvaW50cyA9IFtdO1xuICAgICAgZm9yIChrID0gMDsgayA8IGxlbjsgaysrKSB7XG4gICAgICAgIHJlc1BvaW50cy5wdXNoKHt4OiBwb2ludHNba10ueCwgeTogcG9pbnRzW2tdLnl9KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGJvdW5kczogYy5ib3VuZHMsIGlubmVyOiBjLmlubmVyLCBsYWJlbDogYy5sYWJlbCwgcG9pbnRzOiByZXNQb2ludHMsIGluaXRpYWxDb3VudDogbGVufTtcbiAgICB9XG5cbiAgICBsc3QgPSBbMCwgbGVuIC0gMV07IC8vIGFsd2F5cyBhZGQgZmlyc3QgYW5kIGxhc3QgcG9pbnRzXG4gICAgc3RhY2sgPSBbe2ZpcnN0OiAwLCBsYXN0OiBsZW4gLSAxfV07IC8vIGZpcnN0IHByb2Nlc3NlZCBlZGdlXG5cbiAgICBkbyB7XG4gICAgICBpZHMgPSBzdGFjay5zaGlmdCgpO1xuICAgICAgaWYgKGlkcy5sYXN0IDw9IGlkcy5maXJzdCArIDEpIC8vIG5vIGludGVybWVkaWF0ZSBwb2ludHNcbiAgICAgIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG5cbiAgICAgIG1heGQgPSAtMS4wOyAvLyBtYXggZGlzdGFuY2UgZnJvbSBwb2ludCB0byBjdXJyZW50IGVkZ2VcbiAgICAgIG1heGkgPSBpZHMuZmlyc3Q7IC8vIGluZGV4IG9mIG1heGltYWxseSBkaXN0YW50IHBvaW50XG5cbiAgICAgIGZvciAoaSA9IGlkcy5maXJzdCArIDE7IGkgPCBpZHMubGFzdDsgaSsrKSAvLyBieXBhc3MgaW50ZXJtZWRpYXRlIHBvaW50cyBpbiBlZGdlXG4gICAgICB7XG4gICAgICAgIC8vIGNhbGMgdGhlIGRpc3RhbmNlIGZyb20gY3VycmVudCBwb2ludCB0byBlZGdlXG4gICAgICAgIHBpID0gcG9pbnRzW2ldO1xuICAgICAgICBwZiA9IHBvaW50c1tpZHMuZmlyc3RdO1xuICAgICAgICBwbCA9IHBvaW50c1tpZHMubGFzdF07XG4gICAgICAgIGR4ID0gcGkueCAtIHBmLng7XG4gICAgICAgIGR5ID0gcGkueSAtIHBmLnk7XG4gICAgICAgIHIxID0gTWF0aC5zcXJ0KGR4ICogZHggKyBkeSAqIGR5KTtcbiAgICAgICAgZHggPSBwaS54IC0gcGwueDtcbiAgICAgICAgZHkgPSBwaS55IC0gcGwueTtcbiAgICAgICAgcjIgPSBNYXRoLnNxcnQoZHggKiBkeCArIGR5ICogZHkpO1xuICAgICAgICBkeCA9IHBmLnggLSBwbC54O1xuICAgICAgICBkeSA9IHBmLnkgLSBwbC55O1xuICAgICAgICByMTIgPSBNYXRoLnNxcnQoZHggKiBkeCArIGR5ICogZHkpO1xuICAgICAgICBpZiAocjEgPj0gTWF0aC5zcXJ0KHIyICogcjIgKyByMTIgKiByMTIpKSBkaXN0ID0gcjI7XG4gICAgICAgIGVsc2UgaWYgKHIyID49IE1hdGguc3FydChyMSAqIHIxICsgcjEyICogcjEyKSkgZGlzdCA9IHIxO1xuICAgICAgICBlbHNlIGRpc3QgPSBNYXRoLmFicygoZHkgKiBwaS54IC0gZHggKiBwaS55ICsgcGYueCAqIHBsLnkgLSBwbC54ICogcGYueSkgLyByMTIpO1xuXG4gICAgICAgIGlmIChkaXN0ID4gbWF4ZCkge1xuICAgICAgICAgIG1heGkgPSBpOyAvLyBzYXZlIHRoZSBpbmRleCBvZiBtYXhpbWFsbHkgZGlzdGFudCBwb2ludFxuICAgICAgICAgIG1heGQgPSBkaXN0O1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmIChtYXhkID4gc2ltcGxpZnlUb2xlcmFudCkgLy8gaWYgdGhlIG1heCBcImRldmlhdGlvblwiIGlzIGxhcmdlciB0aGFuIGFsbG93ZWQgdGhlbi4uLlxuICAgICAge1xuICAgICAgICBsc3QucHVzaChtYXhpKTsgLy8gYWRkIGluZGV4IHRvIHRoZSBzaW1wbGlmaWVkIGxpc3RcbiAgICAgICAgc3RhY2sucHVzaCh7Zmlyc3Q6IGlkcy5maXJzdCwgbGFzdDogbWF4aX0pOyAvLyBhZGQgdGhlIGxlZnQgcGFydCBmb3IgcHJvY2Vzc2luZ1xuICAgICAgICBzdGFjay5wdXNoKHtmaXJzdDogbWF4aSwgbGFzdDogaWRzLmxhc3R9KTsgLy8gYWRkIHRoZSByaWdodCBwYXJ0IGZvciBwcm9jZXNzaW5nXG4gICAgICB9XG5cbiAgICB9IHdoaWxlIChzdGFjay5sZW5ndGggPiAwKTtcblxuICAgIHJlc1BvaW50cyA9IFtdO1xuICAgIGxlbiA9IGxzdC5sZW5ndGg7XG4gICAgbHN0LnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcbiAgICAgIHJldHVybiBhIC0gYjtcbiAgICB9KTsgLy8gcmVzdG9yZSBpbmRleCBvcmRlclxuICAgIGZvciAoayA9IDA7IGsgPCBsZW47IGsrKykge1xuICAgICAgcmVzUG9pbnRzLnB1c2goe3g6IHBvaW50c1tsc3Rba11dLngsIHk6IHBvaW50c1tsc3Rba11dLnl9KTsgLy8gYWRkIHJlc3VsdCBwb2ludHMgdG8gdGhlIGNvcnJlY3Qgb3JkZXJcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgIGJvdW5kczogYy5ib3VuZHMsXG4gICAgICBpbm5lcjogYy5pbm5lciwgbGFiZWw6IGMubGFiZWwsIHBvaW50czogcmVzUG9pbnRzLCBpbml0aWFsQ291bnQ6IGMucG9pbnRzLmxlbmd0aFxuICAgIH07XG4gIH07XG5cbiAgLyoqIFNpbXBsaWZ5IGNvbnRvdXJzXG4gICAqIEFsZ29yaXRobXM6IGh0dHA6Ly9wc2ltcGwuc291cmNlZm9yZ2UubmV0L2RvdWdsYXMtcGV1Y2tlci5odG1sXG4gICAqIGh0dHA6Ly9uZWVyYy5pZm1vLnJ1L3dpa2kvaW5kZXgucGhwP3RpdGxlPSVEMCVBMyVEMCVCRiVEMSU4MCVEMCVCRSVEMSU4OSVEMCVCNSVEMCVCRCVEMCVCOCVEMCVCNV8lRDAlQkYlRDAlQkUlRDAlQkIlRDAlQjglRDAlQjMlRDAlQkUlRDAlQkQlRDAlQjAlRDAlQkIlRDElOEMlRDAlQkQlRDAlQkUlRDAlQjlfJUQxJTg2JUQwJUI1JUQwJUJGJUQwJUI4XG4gICAqIEBwYXJhbSB7QXJyYXl9IGNvbnRvdXJzOiB7QXJyYXl9IHBvaW50cywge2Jvb2x9IGlubmVyLCB7aW50fSBsYWJlbFxuICAgKiBAcGFyYW0ge2Zsb2F0fSBzaW1wbGlmeSB0b2xlcmFudFxuICAgKiBAcGFyYW0ge2ludH0gc2ltcGxpZnkgY291bnQ6IG1pbiBudW1iZXIgb2YgcG9pbnRzIHdoZW4gdGhlIGNvbnRvdXIgaXMgc2ltcGxpZmllZFxuICAgKiBAcmV0dXJuIHtBcnJheX0gY29udG91cnM6IHtBcnJheX0gcG9pbnRzLCB7Ym9vbH0gaW5uZXIsIHtpbnR9IGxhYmVsLCB7aW50fSBpbml0aWFsQ291bnRcbiAgICovXG4gIGxpYi5zaW1wbGlmeUNvbnRvdXJzID0gZnVuY3Rpb24gKGNvbnRvdXJzLCBzaW1wbGlmeVRvbGVyYW50LCBzaW1wbGlmeUNvdW50KSB7XG4gICAgdmFyIGxlbkNvbnRvdXJzID0gY29udG91cnMubGVuZ3RoLFxuICAgICAgcmVzdWx0ID0gW107XG5cbiAgICAvLyB3YWxrIHRocm91Z2ggYWxsIGNvbnRvdXJzXG4gICAgZm9yICh2YXIgaiA9IDA7IGogPCBsZW5Db250b3VyczsgaisrKSB7XG5cbiAgICAgIHJlc3VsdC5wdXNoKGxpYi5zaW1wbGlmeUNvbnRvdXIoY29udG91cnNbal0sIHNpbXBsaWZ5VG9sZXJhbnQsIHNpbXBsaWZ5Q291bnQpKTtcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuXG4gIHJldHVybiBsaWI7XG59KSgpO1xuaWYgKHR5cGVvZiBleHBvcnRzICE9PSAndW5kZWZpbmVkJykge1xuICBtb2R1bGUuZXhwb3J0cyA9IE1hZ2ljV2FuZDtcbn1cblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvcGx1Z2lucy9tYWdpY3dhbmQuanMiLCJmYWJyaWMuZGVidWcgPSBERVZFTE9QTUVOVDtcbmZhYnJpYy5leHRlbnNpb25zID0gW107XG5mYWJyaWMudXRpbC5kYXRhID0gcmVxdWlyZSgnLi91dGlsL2RhdGEnKTtcbmZhYnJpYy51dGlsLnBhdGggPSByZXF1aXJlKCcuL3V0aWwvcGF0aCcpO1xuZmFicmljLnV0aWwuY29tcGlsZSA9IHJlcXVpcmUoJy4vdXRpbC9jb21waWxlJyk7XG5mYWJyaWMudXRpbC5sb2FkZXIgPSByZXF1aXJlKCcuL3V0aWwvbG9hZGVyJyk7XG5mYWJyaWMudXRpbC5zeW50YXggPSByZXF1aXJlKFwiLi91dGlsL3N5bnRheFwiKTtcbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLnV0aWwub2JqZWN0LHJlcXVpcmUoJy4vdXRpbC9vYmplY3QuanMnKSk7XG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy51dGlsLHJlcXVpcmUoJy4vdXRpbC91dGlsLmpzJykpO1xuXG4vL3JlcXVpcmUoJy4vbW9kdWxlcycpO1xuXG5yZXF1aXJlKCcuL2NvcmUvYmFzZScpO1xucmVxdWlyZSgnLi9jb3JlL29ic2VydmUnKTtcbnJlcXVpcmUoJy4vY29yZS9hcHBsaWNhdGlvbicpO1xucmVxdWlyZSgnLi9jb3JlL3N0YXRpYy1jYW52YXMuZXh0Jyk7XG5yZXF1aXJlKCcuL2NvcmUvc2xpZGUnKTtcbnJlcXVpcmUoJy4vY29yZS9hcHBsaWNhdGlvbi5zbGlkZXMnKTtcbnJlcXVpcmUoJy4vY29yZS9hcHBsaWNhdGlvbi5wcm90b3R5cGVzJyk7XG5yZXF1aXJlKCcuL2NvcmUvb2JqZWN0LmV4dCcpO1xucmVxdWlyZSgnLi9jb3JlL3RleHQuZXh0Jyk7XG5yZXF1aXJlKCcuL2NvcmUvZ3JvdXAuZXh0Jyk7XG5yZXF1aXJlKCcuL2NvcmUvaW1hZ2UuZXh0Jyk7XG4vLyByZXF1aXJlKCcuL21vZHVsZXMvc2xpZGUuc3RyZXRjaGFibGUnKTtcbnJlcXVpcmUoJy4vbW9kdWxlcy9zbGlkZS50ZW1wbGF0ZScpO1xucmVxdWlyZSgnLi9tb2R1bGVzL3NsaWRlLmFyZWFzJyk7XG4vLyByZXF1aXJlKCcuL21vZHVsZXMvc2xpZGUubGF5ZXJzJyk7XG5yZXF1aXJlKCcuL21vZHVsZXMvc2xpZGUuZHJhd2luZy10b29scycpO1xucmVxdWlyZSgnLi9tb2R1bGVzL3Rvb2xiYXInKTtcbnJlcXVpcmUoJy4vbW9kdWxlcy9jYW52YXMuZXZlbnRzJyk7XG5yZXF1aXJlKCcuL21vZHVsZXMvaW1hZ2UuZmlsdGVycycpO1xucmVxdWlyZSgnLi9tb2R1bGVzL2ZvbnRzJyk7XG5yZXF1aXJlKCcuL21vZHVsZXMvZ2FsbGVyeScpO1xucmVxdWlyZSgnLi9tb2R1bGVzL2xpYnJhcnknKTtcbnJlcXVpcmUoJy4vbW9kdWxlcy9kZWJ1ZycpO1xucmVxdWlyZSgnLi9tb2R1bGVzL2Zyb21VUkwnKTtcbnJlcXVpcmUoJy4vbW9kdWxlcy91cGxvYWQnKTtcbnJlcXVpcmUoJy4vbW9kdWxlcy9sb2FkZXInKTtcbnJlcXVpcmUoJy4vbW9kdWxlcy9kcm9wcGFibGUnKTtcbnJlcXVpcmUoJy4vbW9kdWxlcy9ydWxlcicpO1xucmVxdWlyZSgnLi9tb2R1bGVzL3JlbmRlcicpO1xucmVxdWlyZSgnLi9tb2R1bGVzL3RodW1iJyk7XG5yZXF1aXJlKCcuL21vZHVsZXMvY2xpcFRvJyk7XG5yZXF1aXJlKCcuL21vZHVsZXMvbW92ZW1lbnRMaW1pdHMnKTtcbnJlcXVpcmUoJy4vbW9kdWxlcy9oaXN0b3J5Jyk7XG5yZXF1aXJlKCcuL21vZHVsZXMvem9vbScpO1xucmVxdWlyZSgnLi9tb2R1bGVzL2ludGVyYWN0aXZlTW9kZScpO1xucmVxdWlyZSgnLi9tb2R1bGVzL2JvcmRlckltYWdlJyk7XG5yZXF1aXJlKCcuL21vZHVsZXMvc2F2ZUFzJyk7XG5yZXF1aXJlKCcuL2JydXNoZXMvQmFzZUJydXNoJyk7XG5yZXF1aXJlKCcuL2JydXNoZXMvUGVuY2lsQnJ1c2gnKTtcbnJlcXVpcmUoJy4vYnJ1c2hlcy9SZWN0YW5nbGVCcnVzaCcpO1xucmVxdWlyZSgnLi9icnVzaGVzL1BvbHlnb25CcnVzaCcpO1xucmVxdWlyZSgnLi9icnVzaGVzL1BhaW50UGVuQnJ1c2gnKTtcbnJlcXVpcmUoJy4vYnJ1c2hlcy9QYWludEJ1Y2tldEJydXNoJyk7XG5yZXF1aXJlKCcuL2JydXNoZXMvUG9pbnRzQnJ1c2gnKTtcbnJlcXVpcmUoJy4vc2hhcGVzL3BhdGgnKTtcbnJlcXVpcmUoJy4vc2hhcGVzL2NsaXBhcnQnKTtcbnJlcXVpcmUoJy4vc2hhcGVzL2ltYWdlLnBob3Rvc2hvcC10b29scycpO1xucmVxdWlyZSgnLi9zaGFwZXMvaW1hZ2UucmVtb3ZlLXdoaXRlJyk7XG5yZXF1aXJlKCcuL3NoYXBlcy90ZXh0Ym94Lmxpc3QnKTtcblxuXG5pZighZmFicmljLmlzTGlrZWx5Tm9kZSl7XG4gIC8qKlxuICAgKiBpbmxpbmUgc2NyaXB0IGltYWdlc1xuICAgKiBAdHlwZSB7e2Vycm9yOiBzdHJpbmd9fVxuICAgKi9cbiAgZmFicmljLm1lZGlhID0ge1xuICAgIC8qKlxuICAgICAqIHJlcGxhY2UgaW1hZ2VzIGxvYWRlZCB3aXRoIGVycm9yc1xuICAgICAqL1xuICAgIGVycm9yOiAnZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCwnICsgcmVxdWlyZSgnYmFzZTY0LWxvYWRlciEuL21lZGlhL2Vycm9yLWJ1dHRvbi5zdmcnKVxuICB9O1xufVxuXG5tb2R1bGUuZXhwb3J0cyAgPSBmYWJyaWM7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2ZpZXJhLmpzIiwiXG52YXIgcGF0aCA9IHJlcXVpcmUoXCIuL3BhdGhcIik7XG52YXIgdXRpbCA9IHJlcXVpcmUoXCIuL3V0aWxcIik7XG52YXIgb2JqZWN0ID0gcmVxdWlyZShcIi4vb2JqZWN0XCIpO1xuXG5mdW5jdGlvbiBpc1NlcnZlcigpIHtcbiAgcmV0dXJuICEgKHR5cGVvZiB3aW5kb3cgIT0gJ3VuZGVmaW5lZCcgJiYgd2luZG93LmRvY3VtZW50KTtcbn1cblxuXG5pZiAoaXNTZXJ2ZXIoKSkge1xuICB2YXIgZnMgPSByZXF1aXJlKCdmcycpO1xufVxuXG5cbmZ1bmN0aW9uIF9sb2FkX2pzb24gKHZhbHVlLCBjYWxsYmFja19zdWNjZXNzLCBjYWxsYmFja19lcnJvcil7XG5cbiAgdmFyIG91dHB1dCA9IG51bGw7XG4gIHZhciBlcnJvcnMgPSBbXTtcblxuICBpZiAodmFsdWUuY29uc3RydWN0b3IgPT0gU3RyaW5nKSB7XG5cbiAgICB2YXIgZmlsZW5hbWUsIHJlZ2V4X2RhdGEsIGluaXRfcHJvcGVydHk7XG4gICAgcmVnZXhfZGF0YSA9IC9eKFteI10qKSM/KC4qKSQvLmV4ZWModmFsdWUpO1xuXG4gICAgZmlsZW5hbWUgPSByZWdleF9kYXRhWzFdO1xuICAgIGluaXRfcHJvcGVydHkgPSByZWdleF9kYXRhWzJdO1xuICAgIHV0aWxzLmdldElubGluZUpzb24oZmlsZW5hbWUsIFwianNvblwiLCBfbG9hZEpzb25fZGF0YSwgZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICBlcnJvcnMucHVzaChlcnJvcik7XG4gICAgICBpZiAoY2FsbGJhY2tfZXJyb3IpIHtcbiAgICAgICAgY2FsbGJhY2tfZXJyb3IoZXJyb3IpXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiZmlsZTogXFxcIlwiICsgZmlsZW5hbWUgKyBcIlxcXCIuIFwiICsgZXJyb3IubWVzc2FnZSlcbiAgICAgIH1cbiAgICB9KTtcbiAgfSBlbHNlIHtcbiAgICBfbG9hZEpzb25fZGF0YSh2YWx1ZSk7XG4gIH1cblxuICBmdW5jdGlvbiBfbG9hZEpzb25fZGF0YShkYXRhKSB7XG4gICAgLypcbiAgICAg0LfQsNC80LXQvdCwINC30LDQv9C40YHQtdC5IFwidXJsKC4vcGF0aC90by9maWxlKSAg0L3QsCBcIi4uLy4uL3BhdGgvdG8vZmlsZVwiXG4gICAgIHVybCDQvdCw0YfQuNC90LDRjtGJ0LjQtdGB0Y8g0YEgLi8g0L7RgtC90L7RgdC40YLQtdC70YzQvdC+INGA0L7QtNC40YLQtdC70YzQutC+0LPQviBqc29uINGE0LDQudC70LBcblxuICAgICB1cmwg0YEgXCIvXCIg0LTQvtCx0LDQstC70Y/QtdGC0YHRjyBBUFBfU1RBVElDX1BBVEhcbiAgICAgKi9cbiAgICB1dGlscy5yZWNvdXJzaXZlKGRhdGEsXG4gICAgICBmdW5jdGlvbiAocHJvcGVydHksIHZhbHVlLCBwYXJlbnQpIHtcbiAgICAgICAgaWYgKC9edXJsXFwoLipcXCkkLy50ZXN0KHZhbHVlKSkge1xuICAgICAgICAgIHZhciByZWdleF9kYXRhID0gL151cmxcXCgoXFwuP1xcLyk/KC4qKVxcKSQvLmV4ZWModmFsdWUpO1xuICAgICAgICAgIHZhciB1cmwgPSByZWdleF9kYXRhWzJdO1xuXG4gICAgICAgICAgaWYgKHJlZ2V4X2RhdGFbMV0gPT0gXCIvXCIpIHtcbiAgICAgICAgICAgIHVybCA9IHdpbmRvdy5BUFBfU1RBVElDX1BBVEggKyB1cmw7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChyZWdleF9kYXRhWzFdID09IFwiLi9cIikge1xuICAgICAgICAgICAgdXJsID0gcGF0aC5nZXRQYXJlbnREaXJlY3RvcnlVcmwoZmlsZW5hbWUpICsgdXJsO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHBhcmVudFtwcm9wZXJ0eV0gPSBwYXRoLnJlc29sdmUodXJsKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICk7XG5cblxuICAgIHZhciBsb2FkZXIgPSB1dGlsLnF1ZXVlTG9hZCgxLCBmdW5jdGlvbiBmaW5hbGl6ZSgpIHtcblxuICAgICAgaWYgKGluaXRfcHJvcGVydHkpIHtcbiAgICAgICAgdmFyIHByb3BfYXJyID0gaW5pdF9wcm9wZXJ0eS5zcGxpdChcIi9cIik7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcHJvcF9hcnIubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICBkYXRhID0gZGF0YVtwcm9wX2FycltpXV07XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKGVycm9ycy5sZW5ndGgpIHtcbiAgICAgICAgaWYgKGNhbGxiYWNrX2Vycm9yKSBjYWxsYmFja19lcnJvcihlcnJvcnMpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKGNhbGxiYWNrX3N1Y2Nlc3MpIGNhbGxiYWNrX3N1Y2Nlc3MoZGF0YSk7XG4gICAgICAgIG91dHB1dCA9IGRhdGE7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvKipcbiAgICAgKiByZW1vdmUgY29tbWVudHNcbiAgICAgKi9cbiAgICB1dGlscy5yZWNvdXJzaXZlKGRhdGEsIGZ1bmN0aW9uIChwcm9wZXJ0eSwgdmFsdWUsIHBhcmVudCkge1xuICAgICAgLypcbiAgICAgICByZW1vdmUgY29tbWVudHMgbGlrZVxuICAgICAgIFtcIkBjb21tZW50KClcIl1cbiAgICAgICBcIkBjb21tZW50XCI6IHt9XG4gICAgICAgKi9cbiAgICAgIGlmICgvXlxcL1xcLy4qJC8udGVzdCh2YWx1ZSkgfHwgL15AY29tbWVudFxcKC4qXFwpJC8udGVzdCh2YWx1ZSkgfHwgcHJvcGVydHkgPT0gXCJAY29tbWVudFwiKSB7XG4gICAgICAgIGlmIChwYXJlbnQuY29uc3RydWN0b3IgPT0gQXJyYXkpIHtcbiAgICAgICAgICBwYXJlbnQuc3BsaWNlKHByb3BlcnR5LCAxKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBkZWxldGUgcGFyZW50W3Byb3BlcnR5XTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmICgvXkBleHRlbmQuKiQvLnRlc3QocHJvcGVydHkpKSB7XG5cbiAgICAgICAgbG9hZGVyLnRvdGFsKys7XG4gICAgICAgIF9sb2FkX2pzb24odmFsdWUsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgdmFyIGV4dF9kYXRhID0gb2JqZWN0LmRlZXBFeHRlbmQoZGF0YSwgcGFyZW50KTtcbiAgICAgICAgICBvYmplY3QuZGVlcEV4dGVuZChwYXJlbnQsIGV4dF9kYXRhKTtcbiAgICAgICAgICBkZWxldGUgcGFyZW50W1wiQGV4dGVuZFwiXTtcbiAgICAgICAgICBsb2FkZXIoKTtcbiAgICAgICAgfSwgZnVuY3Rpb24gKGRhdGEsIGVycm9yKSB7XG4gICAgICAgICAgZXJyb3JzLnB1c2goZXJyb3IpO1xuICAgICAgICAgIGxvYWRlcigpO1xuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSBpZiAoL15AZXh0ZW5kXFwoLipcXCkkLy50ZXN0KHZhbHVlKSkge1xuICAgICAgICB2YXIgX3JlZ19kYXRhID0gL15AZXh0ZW5kXFwoKFxcLlxcLyk/KC4qKVxcKSQvLmV4ZWModmFsdWUpO1xuICAgICAgICB2YXIgdXJsID0gX3JlZ19kYXRhWzJdO1xuICAgICAgICBpZiAoX3JlZ19kYXRhWzFdKSB7XG4gICAgICAgICAgdXJsID0gcGF0aC5nZXRQYXJlbnREaXJlY3RvcnlVcmwoZmlsZW5hbWUpICsgdXJsO1xuICAgICAgICB9XG4gICAgICAgIGxvYWRlci50b3RhbCsrO1xuICAgICAgICBfbG9hZF9qc29uKHVybCwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICBwYXJlbnRbcHJvcGVydHldID0gZGF0YTtcbiAgICAgICAgICBsb2FkZXIoKTtcbiAgICAgICAgfSwgZnVuY3Rpb24gKGRhdGEsIGVycm9yKSB7XG4gICAgICAgICAgZXJyb3JzLnB1c2goZXJyb3IpO1xuICAgICAgICAgIGxvYWRlcigpO1xuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSBpZiAoL15AbWl4aW5cXCguKlxcKSQvLnRlc3QodmFsdWUpKSB7XG4gICAgICAgIHZhciBfcmVnX2RhdGEgPSAvXkBtaXhpblxcKChcXC5cXC8pPyguKilcXCkkLy5leGVjKHZhbHVlKTtcbiAgICAgICAgdmFyIHVybCA9IF9yZWdfZGF0YVsyXTtcbiAgICAgICAgaWYgKF9yZWdfZGF0YVsxXSkge1xuICAgICAgICAgIHVybCA9IHBhdGguZ2V0UGFyZW50RGlyZWN0b3J5VXJsKGZpbGVuYW1lKSArIHVybDtcbiAgICAgICAgfVxuICAgICAgICBsb2FkZXIudG90YWwrKztcbiAgICAgICAgX2xvYWRfanNvbih1cmwsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgaWYgKHBhcmVudC5jb25zdHJ1Y3RvciA9PSBBcnJheSkge1xuICAgICAgICAgICAgcGFyZW50LnNwbGljZShwcm9wZXJ0eSwgMSk7XG4gICAgICAgICAgICBmb3IgKHZhciBpIGluIGRhdGEpIHtcbiAgICAgICAgICAgICAgcGFyZW50LnB1c2goZGF0YVtpXSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZGVsZXRlIHBhcmVudFtwcm9wZXJ0eV07XG4gICAgICAgICAgICBmb3IgKHZhciBpIGluIGRhdGEpIHtcbiAgICAgICAgICAgICAgcGFyZW50W2ldID0gZGF0YVtpXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgbG9hZGVyKCk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIChkYXRhLCBlcnJvcikge1xuICAgICAgICAgIGVycm9ycy5wdXNoKGVycm9yKTtcbiAgICAgICAgICBsb2FkZXIoKTtcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2UgaWYgKC9eQGxvYWRcXCgoLiopXFwpJC8udGVzdCh2YWx1ZSkpIHtcbiAgICAgICAgdmFyIF9yZWdfZGF0YSA9IC9eQGxvYWRcXCgoXFwuP1xcLyk/KC4qKVxcKSQvLmV4ZWModmFsdWUpO1xuICAgICAgICB2YXIgdXJsID0gX3JlZ19kYXRhWzJdO1xuICAgICAgICBpZiAoX3JlZ19kYXRhWzFdID09IFwiL1wiKSB7XG4gICAgICAgICAgdXJsID0gd2luZG93LkFQUF9TVEFUSUNfUEFUSCArIHVybDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoX3JlZ19kYXRhWzFdID09IFwiLi9cIikge1xuICAgICAgICAgIHVybCA9IHBhdGguZ2V0UGFyZW50RGlyZWN0b3J5VXJsKGZpbGVuYW1lKSArIHVybDtcbiAgICAgICAgfVxuXG4gICAgICAgIGxvYWRlci50b3RhbCsrO1xuICAgICAgICB1dGlscy5nZXRJbmxpbmVKc29uKHVybCwgXCJodG1sXCIsIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgcGFyZW50W3Byb3BlcnR5XSA9IGRhdGE7XG4gICAgICAgICAgbG9hZGVyKCk7XG4gICAgICAgIH0sIGZ1bmN0aW9uIChkYXRhLCBlcnJvcikge1xuICAgICAgICAgIGVycm9ycy5wdXNoKGVycm9yKTtcbiAgICAgICAgICBsb2FkZXIoKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICB9KTtcbiAgICBsb2FkZXIoKTtcblxuICB9XG5cbiAgcmV0dXJuIG91dHB1dDtcbn1cblxudmFyIHV0aWxzID0ge1xuICBDQUNIRURfSlNPTiA6IHt9LFxuICBsb2FkSnNvblN5bmM6IGZ1bmN0aW9uKHNyYyl7XG4gICAgdmFyIGRhdGE7XG4gICAgX2xvYWRfanNvbihzcmMsZnVuY3Rpb24oX2RhdGEpe1xuICAgICAgZGF0YSA9IF9kYXRhO1xuICAgIH0pO1xuICAgIHJldHVybiBkYXRhO1xuICB9LFxuXG4gIC8qKlxuICAg0L/QvtC30LLQvtC70Y/QtdGCINC40YHQv9C+0LvRjNC30L7QstCw0YLRjCDQutC+0L3RgdGC0YDRg9C60YbQuNC4INCy0LjQtNCwXG4gICDRgNCw0YHRiNC40YDQuNGC0Ywg0LTQsNC90L3Ri9C1INC40Lcg0YTQsNC50LvQsCB0ZW1wbGF0ZS5qc29uXG4gICBcIkBleHRlbmRcIiA6IFwidXJsKGRhdGEvdGVtcGxhdGUuanNvbilcIixcbiAgIFwiQGV4dGVuZFwiIDogXCJ1cmwoZGF0YS90ZW1wbGF0ZS5qc29uI3NldHRpbmdzL3N0YWdlcylcIixcblxuICAgLy/Qt9Cw0LzQtdC90LjRgtGMINGB0YLRgNC+0LrRgyDQvdCw0LTQsNC90L3Ri9C1INC40Lcg0YTQsNC50LvQsFxuICAgXCJzdGFnZXNcIjogICAgICAgXCJ1cmwoZGF0YS90ZW1wbGF0ZS5qc29uI3NldHRpbmdzL3N0YWdlcylcIixcblxuICAgKiBAcGFyYW0gZmlsZW5hbWVcbiAgICogQHBhcmFtIGNhbGxiYWNrX3N1Y2Nlc3NcbiAgICogQHBhcmFtIGNhbGxiYWNrX2Vycm9yXG4gICAqL1xuICBsb2FkSnNvbjogZnVuY3Rpb24gKHZhbHVlLHJlc29sdmVfY2IsZmFpbF9jYikge1xuICAgICAgcmV0dXJuIF9sb2FkX2pzb24odmFsdWUsZnVuY3Rpb24oZGF0YSl7XG4gICAgICAgIHJlc29sdmVfY2IgJiYgcmVzb2x2ZV9jYihkYXRhKTtcbiAgICAgIH0sZnVuY3Rpb24oZXJyKXtcbiAgICAgICAgZmFpbF9jYiAmJiBmYWlsX2NiKGVycik7XG4gICAgICB9KTtcbiAgfSxcblxuICByZW1vdmVDb21tZW50czogZnVuY3Rpb24gKHN0cikge1xuICAgIHN0ciA9IHN0ci5yZXBsYWNlKC9eXFxzKihcXC9cXC8uKnwoPzpcXC9cXCpbXFxzXFxTXSo/KVxcKlxcL1xccyopJC9nbSxcIlwiKTtcbiAgICByZXR1cm4gc3RyO1xuICB9LFxuICAvKipcbiAgICpcbiAgICogQHBhcmFtIG9iamVjdFxuICAgKiBAcGFyYW0gY3JpdGVyaWEgLSDQstGL0L/QvtC70L3Rj9GC0Ywg0YTRg9C90LrRhtC40Y4g0YHQviDQstGB0LXQvNC4INC+0LHRitC10LrRgtCw0LzQuFxuICAgKi9cbiAgcmVjb3Vyc2l2ZTogZnVuY3Rpb24gKG9iamVjdCwgY3JpdGVyaWEpIHtcbiAgICB2YXIgcmVhZGVkID0gW107XG4gICAgaWYgKCFvYmplY3QpIHJldHVybjtcbiAgICByZXR1cm4gKGZ1bmN0aW9uIHN1Yl9yZWNvdXJzaXZlKG9iamVjdCkge1xuICAgICAgaWYgKHJlYWRlZC5pbmRleE9mKG9iamVjdCkgIT0gLTEpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgcmVhZGVkLnB1c2gob2JqZWN0KTtcblxuXG4gICAgICBpZiAob2JqZWN0IGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgICAgZm9yICh2YXIgcHJvcCA9IG9iamVjdC5sZW5ndGg7IHByb3AtLTspIHtcbiAgICAgICAgICBpZiAob2JqZWN0W3Byb3BdICYmIChvYmplY3RbcHJvcF0uY29uc3RydWN0b3IgPT0gT2JqZWN0IHx8IG9iamVjdFtwcm9wXS5jb25zdHJ1Y3RvciA9PSBBcnJheSkpIHtcbiAgICAgICAgICAgIHN1Yl9yZWNvdXJzaXZlKG9iamVjdFtwcm9wXSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhciBicmVha18gPSBjcml0ZXJpYShwcm9wLCBvYmplY3RbcHJvcF0sIG9iamVjdCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBmb3IgKHZhciBwcm9wIGluIG9iamVjdCkge1xuICAgICAgICAgIGlmIChvYmplY3RbcHJvcF0gJiYgKG9iamVjdFtwcm9wXS5jb25zdHJ1Y3RvciA9PSBPYmplY3QgfHwgb2JqZWN0W3Byb3BdLmNvbnN0cnVjdG9yID09IEFycmF5KSkge1xuICAgICAgICAgICAgc3ViX3JlY291cnNpdmUob2JqZWN0W3Byb3BdKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmFyIGJyZWFrXyA9IGNyaXRlcmlhKHByb3AsIG9iamVjdFtwcm9wXSwgb2JqZWN0KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KShvYmplY3QpO1xuICB9LFxuXG4gIHBhcnNlQ1NWOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgIHZhciByb3dzID0gZGF0YS5zcGxpdCgvXFxuLyk7XG4gICAgdmFyIGNvbHVtbnMgPSByb3dzWzBdLnNwbGl0KCcsJyk7XG4gICAgcm93cy5zcGxpY2UoMCwgMSk7XG5cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJvd3MubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciBvdXRwdXRfcm93X2RhdGEgPSB7fTtcbiAgICAgIHZhciByb3dfZGF0YSA9IFtdO1xuXG5cbiAgICAgIHZhciBfcXVvdGUgPSBmYWxzZSwgbGFzdCA9IC0xO1xuICAgICAgdmFyIGogPSAtMTtcbiAgICAgIHZhciBzdHIgPSByb3dzW2ldO1xuICAgICAgd2hpbGUgKCsraiA8IHN0ci5sZW5ndGgpIHtcbiAgICAgICAgaWYgKCFfcXVvdGUpIHtcbiAgICAgICAgICBpZiAoc3RyW2pdID09ICdcXCcnIHx8IHN0cltqXSA9PSAnXFxcIicpIHtcbiAgICAgICAgICAgIF9xdW90ZSA9IHN0cltqXTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHN0cltqXSA9PSBcIixcIikge1xuICAgICAgICAgICAgdmFyIF92YWwgPSBzdHIuc3Vic3RyaW5nKGxhc3QsIGopO1xuICAgICAgICAgICAgaWYgKF92YWxbMF0gPT0gJ1xcXCInICYmIF92YWxbX3ZhbC5sZW5ndGggLSAxXSA9PSAnXFxcIicpIHtcbiAgICAgICAgICAgICAgX3ZhbCA9IF92YWwuc3Vic3RyaW5nKDEsIF92YWwubGVuZ3RoIC0gMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByb3dfZGF0YS5wdXNoKF92YWwpO1xuICAgICAgICAgICAgbGFzdCA9IGogKyAxO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAoc3RyW2pdID09IF9xdW90ZSkge1xuICAgICAgICAgICAgX3F1b3RlID0gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGZvciAodmFyIGogaW4gcm93X2RhdGEpIHtcbiAgICAgICAgb3V0cHV0X3Jvd19kYXRhW2NvbHVtbnNbal1dID0gcm93X2RhdGFbal07XG4gICAgICB9XG4gICAgICByb3dzW2ldID0gb3V0cHV0X3Jvd19kYXRhO1xuICAgIH1cbiAgICByZXR1cm4gcm93cztcbiAgfSxcbiAgcGFyc2VEYXRhOiBmdW5jdGlvbiAoZGF0YSwgZGF0YVR5cGUpIHtcbiAgICB2YXIgX3BhcnNlZDtcbiAgICBpZiAoZGF0YVR5cGUgPT0gXCJjc3ZcIikge1xuICAgICAgX3BhcnNlZCA9IHV0aWxzLnBhcnNlQ1NWKGRhdGEpO1xuICAgIH0gZWxzZSBpZiAoZGF0YVR5cGUgPT0gXCJqc29uXCIpIHtcbiAgICAgIF9wYXJzZWQgPSBkYXRhLnRyaW0oKTtcbiAgICAgIC8vaWYgKGRhdGFbMF0gIT0gXCJ7XCIgJiYgZGF0YVswXSAhPSBcIltcIikge1xuICAgICAgLy8gIHJldHVybiBmYWxzZTtcbiAgICAgIC8vfVxuXG4gICAgICBfcGFyc2VkID0gdXRpbHMucmVtb3ZlQ29tbWVudHMoX3BhcnNlZCk7XG4gICAgICAvL2RhdGEgID0gZGF0YS5yZXBsYWNlKC9cXG4vZyxcIlwiKVxuXG4gICAgICB0cnl7XG4gICAgICAgIHZhciBfcGFyc2VkID0gSlNPTi5wYXJzZShfcGFyc2VkKTsvLz0gSlNPTi5wYXJzZShkYXRhLnJlcGxhY2UoL1xcL1xcKltcXHNcXFNdKj9cXCpcXC98XFwvXFwvLiovZyxcIlwiKSk7XG4gICAgICB9Y2F0Y2goZSl7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgc3RhdHVzOiBcImVycm9yXCIsXG4gICAgICAgICAgbWVzc2FnZTogZS50b1N0cmluZygpLFxuICAgICAgICAgIGRhdGE6ICBkYXRhXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICAvL3ZhciBzY3JpcHQgPSAkKFwiPHNjcmlwdCB0eXBlPSd0ZXh0L2pzb24nIGlkPSdcIiArIHVybCArIFwiJz5cIiArIEpTT04uc3RyaW5naWZ5KGRhdGEpICsgXCI8L3NjcmlwdD5cIik7XG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICBzdGF0dXM6IFwic3VjY2Vzc1wiLFxuICAgICAgZGF0YTogX3BhcnNlZFxuICAgIH07XG4gIH0sXG4gIGxvYWQ6IGZ1bmN0aW9uICh1cmwsIGRhdGFUeXBlLCBjYWxsYmFja19zdWNjZXNzLCBjYWxsYmFja19lcnJvcikge1xuICAgIC8vdG9kb1xuICAgIGlmIChpc1NlcnZlcigpKSB7XG4gICAgICB0cnkge1xuICAgICAgICB2YXIgZGF0YSA9IGZzLnJlYWRGaWxlU3luYyh1cmwsICd1dGY4Jyk7XG4gICAgICAgIGRhdGEgPSBkYXRhLnJlcGxhY2UoL15cXHVGRUZGLywgJycpO1xuICAgICAgICB2YXIgX3BhcnNlZCA9IHV0aWxzLnBhcnNlRGF0YShkYXRhLCBkYXRhVHlwZSk7XG4gICAgICAgIGlmKF9wYXJzZWQuc3RhdHVzID09IFwiZXJyb3JcIil7XG4gICAgICAgICAgY2FsbGJhY2tfZXJyb3Ioe1xuICAgICAgICAgICAgc3RhdHVzOiAgIFwiZXJyb3JcIixcbiAgICAgICAgICAgIG1lc3NhZ2U6ICBfcGFyc2VkLm1lc3NhZ2UsXG4gICAgICAgICAgICBkYXRhOiAgICAgX3BhcnNlZC5kYXRhXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNhbGxiYWNrX3N1Y2Nlc3MoX3BhcnNlZC5kYXRhKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcblxuICAgICAgICBpZiAoZS5jb2RlID09PSAnRU5PRU5UJykge1xuICAgICAgICAgIGNvbnNvbGUubG9nKCdGaWxlIG5vdCBmb3VuZCEnKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aHJvdyBlO1xuICAgICAgICB9XG4gICAgICAgIGNhbGxiYWNrX2Vycm9yKGRhdGEpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG5cbiAgICAgIHZhciBodHRwUmVxdWVzdCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuXG4gICAgICBodHRwUmVxdWVzdC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChodHRwUmVxdWVzdC5yZWFkeVN0YXRlID09PSA0KSB7XG4gICAgICAgICAgaWYgKGh0dHBSZXF1ZXN0LnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICAgICAgICB2YXIgZGF0YSA9IGh0dHBSZXF1ZXN0LnJlc3BvbnNlVGV4dDtcbiAgICAgICAgICAgIHZhciBfcGFyc2VkID0gdXRpbHMucGFyc2VEYXRhKGRhdGEsIGRhdGFUeXBlKTtcbiAgICAgICAgICAgIGlmKF9wYXJzZWQuc3RhdHVzID09IFwiZXJyb3JcIil7XG4gICAgICAgICAgICAgIGNhbGxiYWNrX2Vycm9yKHtcbiAgICAgICAgICAgICAgICBzdGF0dXM6IGh0dHBSZXF1ZXN0LnN0YXR1cyxcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiAgX3BhcnNlZC5tZXNzYWdlLFxuICAgICAgICAgICAgICAgIHJlc3BvbnNlOiBodHRwUmVxdWVzdC5yZXNwb25zZVRleHRcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhbGxiYWNrX3N1Y2Nlc3MoX3BhcnNlZC5kYXRhKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY2FsbGJhY2tfZXJyb3IodXJsLCBodHRwUmVxdWVzdClcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICBodHRwUmVxdWVzdC5vcGVuKCdHRVQnLCB1cmwpO1xuICAgICAgaHR0cFJlcXVlc3Quc2VuZCgpO1xuICAgIH1cbiAgfSxcbiAgLyoqXG4gICAqINCf0L7Qt9Cy0L7Qu9GP0LXRgtC30LDQs9GA0YPQttCw0YLRjCBqc29uINGE0LDQudC70YsgLCDRgdC+0LTQtdGA0LbQsNGJ0LjQtSDRgdGB0YvQu9C60Lgg0L3QsCDQtNGA0YPQs9C40LUganNvbiDRhNCw0LnQu9GLLlxuICAgKiDQstC80LXRgdGC0L4g0YHRgdGL0LvQvtC6INGC0LjQv9CwXG4gICAqICBcInByb3BlcnR5XCIgOiBcInVybChjaHVuay5qc29uKVwiXG4gICAqICDQsdGD0LTQtdGCINC30LDQs9GA0YPQttC10L3QviDRgdC+0LTQtdGA0LbQuNC80L7QtSDRhNCw0LnQu9CwXG4gICAqICBcInByb3BlcnR5XCIgOiB7Li4ufVxuICAgKlxuICAgKiAg0LXRgdC70Lgg0YPQutCw0LfQsNGC0Ywg0Y/QutC+0YDRjFxuICAgKiAgXCJwcm9wZXJ0eVwiIDogXCJ1cmwoY2h1bmsuanNvbiNzZXR0aW5ncy9jaHVuay8wL3RleHQpXCJcbiAgICpcbiAgICog0YLQviDQsdGD0LTQtdGCINC30LDQs9GA0YPQttC10L3QviDRgdC+0LTQtdGA0LbQuNC80L7QtSDQv9C+0LvRjyBzZXR0aW5ncy5jaHVua1swXS50ZXh0INC40Lcg0YTQsNC50LvQsCBjaHVuay5qc29uXG4gICAqXG4gICAqXG4gICAqIEBwYXJhbSBmaWxlbmFtZSAg0L/Rg9GC0Ywg0Log0L7RgdC90L7QstC90L7QvNGDIGpzb24g0YTQsNC50LvRg1xuICAgKiBAcGFyYW0gY2FsbGJhY2sgINCx0YPQtNC10YIg0LLRi9C30LLQsNC9INC/0L7RgdC70LUg0L7QutC+0L3Rh9Cw0L3QuNGPINC30LDQs9GA0YPQt9C60Lgg0LLRgdC10YUg0YTQsNC50LvQvtCyXG4gICAqL1xuICBnZXRJbmxpbmVKc29uOiBmdW5jdGlvbiAodXJsLCBkYXRhVHlwZSwgY2FsbGJhY2tfc3VjY2VzcywgY2FsbGJhY2tfZXJyb3IpIHtcblxuICAgIGlmIChkYXRhVHlwZS5jb25zdHJ1Y3RvciAhPSBTdHJpbmcpIHtcbiAgICAgIGNhbGxiYWNrX2Vycm9yID0gY2FsbGJhY2tfc3VjY2VzcztcbiAgICAgIGNhbGxiYWNrX3N1Y2Nlc3MgPSBkYXRhVHlwZTtcbiAgICAgIGRhdGFUeXBlID0gXCJqc29uXCI7XG4gICAgfVxuXG5cbiAgICBpZiAodHlwZW9mIHV0aWxzLkNBQ0hFRF9KU09OICE9PSBcInVuZGVmaW5lZFwiICYmIHV0aWxzLkNBQ0hFRF9KU09OICYmIHV0aWxzLkNBQ0hFRF9KU09OW3VybF0pIHtcbiAgICAgIGNhbGxiYWNrX3N1Y2Nlc3ModXRpbHMuQ0FDSEVEX0pTT05bdXJsXSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICh0eXBlb2YgJCAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgaWYgKHR5cGVvZiBkb2N1bWVudCAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICB2YXIgaW5saW5lID0gJChcInNjcmlwdFtpZD0nXCIgKyB1cmwgKyBcIiddXCIpO1xuICAgICAgICBpZiAoaW5saW5lLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICB2YXIgX2RhdGEgPVxuICAgICAgICAgICAgaW5saW5lWzBdLmlubmVyVGV4dCB8fCAvL2FsbFxuICAgICAgICAgICAgaW5saW5lWzBdLnRleHRDb250ZW50IHx8IC8vZmlyZWZveFxuICAgICAgICAgICAgaW5saW5lWzBdLnRleHQ7IC8vaWU4XG4gICAgICAgICAgaWYgKGRhdGFUeXBlID09IFwianNvblwiKSB7XG5cbiAgICAgICAgICAgIHZhciBfZGF0YSA9IHV0aWxzLnJlbW92ZUNvbW1lbnRzKF9kYXRhKTtcbiAgICAgICAgICAgIGNhbGxiYWNrX3N1Y2Nlc3MoSlNPTi5wYXJzZShfZGF0YSkpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjYWxsYmFja19zdWNjZXNzKF9kYXRhKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHV0aWxzLmxvYWQodXJsLCBkYXRhVHlwZSwgY2FsbGJhY2tfc3VjY2VzcywgY2FsbGJhY2tfZXJyb3IpO1xuICB9XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IHV0aWxzO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy91dGlsL2RhdGEuanMiLCJtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoXCJmc1wiKTtcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyBleHRlcm5hbCBcImZzXCJcbi8vIG1vZHVsZSBpZCA9IDEzXG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIlxuXG5tb2R1bGUuZXhwb3J0cyA9IHtcblxuICBsb2FkU2NyaXB0OiBmdW5jdGlvbiAocmVxdWlyZW1lbnQsIGhlbHBlciwgZXJyb3IpIHtcbiAgICB2YXIgaGVhZCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdoZWFkJylbMF07XG4gICAgdmFyIHNjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NjcmlwdCcpO1xuICAgIHNjcmlwdC50eXBlID0gJ3RleHQvamF2YXNjcmlwdCc7XG4gICAgc2NyaXB0Lm9uZXJyb3IgPSBlcnJvcjtcbiAgICBzY3JpcHQub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKHRoaXMucmVhZHlTdGF0ZSA9PSAnY29tcGxldGUnKSB7XG4gICAgICAgIGhlbHBlcihzY3JpcHQsIF9fc3JjKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIHNjcmlwdC5hZGRFdmVudExpc3RlbmVyKFwibG9hZFwiLCBoZWxwZXIsIHRydWUpO1xuICAgIHNjcmlwdC5zcmMgPSByZXF1aXJlbWVudDtcbiAgICBoZWFkLmFwcGVuZENoaWxkKHNjcmlwdCk7XG4gIH0sXG4gIHNjcmlwdFVSTDogZnVuY3Rpb24gKCkge1xuXG4gICAgaWYgKGRvY3VtZW50LmN1cnJlbnRTY3JpcHQpIHtcbiAgICAgIHJldHVybiBkb2N1bWVudC5jdXJyZW50U2NyaXB0LnNyYztcbiAgICB9XG4gICAgdmFyIHNjcmlwdHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnc2NyaXB0Jyk7XG4gICAgZm9yICh2YXIgaSA9IHNjcmlwdHMubGVuZ3RoIC0gMTsgaS0tOykge1xuICAgICAgaWYgKHNjcmlwdHNbaV0uc3JjKSB7XG4gICAgICAgIHJldHVybiBzY3JpcHRzW2ldLnNyYztcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59O1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy91dGlsL2xvYWRlci5qcyIsIlxudmFyIGRlZXBEaWZmTWFwcGVyID0ge1xuICBWQUxVRV9DUkVBVEVEOiAnY3JlYXRlZCcsXG4gIFZBTFVFX1VQREFURUQ6ICd1cGRhdGVkJyxcbiAgVkFMVUVfREVMRVRFRDogJ2RlbGV0ZWQnLFxuICBWQUxVRV9VTkNIQU5HRUQ6ICd1bmNoYW5nZWQnLFxuICBtYXA6IGZ1bmN0aW9uKG9iajEsIG9iajIpIHtcbiAgICBpZiAodGhpcy5pc0Z1bmN0aW9uKG9iajEpIHx8IHRoaXMuaXNGdW5jdGlvbihvYmoyKSkge1xuICAgICAgdGhyb3cgJ0ludmFsaWQgYXJndW1lbnQuIEZ1bmN0aW9uIGdpdmVuLCBvYmplY3QgZXhwZWN0ZWQuJztcbiAgICB9XG4gICAgaWYgKHRoaXMuaXNWYWx1ZShvYmoxKSB8fCB0aGlzLmlzVmFsdWUob2JqMikpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgICdfbWFwX3R5cGUnOiB0aGlzLmNvbXBhcmVWYWx1ZXMob2JqMSwgb2JqMiksXG4gICAgICAgICdfbWFwX2RhdGEnOiAob2JqMiA9PT0gdW5kZWZpbmVkKSA/IG9iajEgOiBvYmoyXG4gICAgICB9O1xuICAgIH1cblxuXG4gICAgaWYoXy5pc0FycmF5KG9iajIpKXtcbiAgICAgIHZhciBfYXJyYXkgPSB0cnVlO1xuICAgICAgdmFyIGRpZmYgPSBbXTtcbiAgICB9ZWxzZXtcbiAgICAgIHZhciBkaWZmID0ge307XG4gICAgfVxuXG5cbiAgICBmb3IgKHZhciBrZXkgaW4gb2JqMSkge1xuICAgICAgaWYgKHRoaXMuaXNGdW5jdGlvbihvYmoxW2tleV0pKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuXG4gICAgICB2YXIgdmFsdWUyID0gdW5kZWZpbmVkO1xuICAgICAgaWYgKCd1bmRlZmluZWQnICE9IHR5cGVvZihvYmoyW2tleV0pKSB7XG4gICAgICAgIHZhbHVlMiA9IG9iajJba2V5XTtcbiAgICAgIH1cblxuICAgICAgZGlmZltrZXldID0gdGhpcy5tYXAob2JqMVtrZXldLCB2YWx1ZTIpO1xuICAgIH1cbiAgICBmb3IgKHZhciBrZXkgaW4gb2JqMikge1xuICAgICAgaWYgKHRoaXMuaXNGdW5jdGlvbihvYmoyW2tleV0pIHx8ICgndW5kZWZpbmVkJyAhPSB0eXBlb2YoZGlmZltrZXldKSkpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG5cbiAgICAgIHZhciBfdmFsID0gdGhpcy5tYXAodW5kZWZpbmVkLCBvYmoyW2tleV0pO1xuICAgICAgaWYoX2FycmF5KXtcbiAgICAgICAgZGlmZi5wdXNoKF92YWwpO1xuICAgICAgfWVsc2V7XG4gICAgICAgIGRpZmZba2V5XSA9IF92YWxcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgJ19tYXBfdHlwZSc6ICcnLFxuICAgICAgJ19tYXBfZGF0YSc6IGRpZmZcbiAgICB9O1xuXG4gIH0sXG4gIGNvbXBhcmVWYWx1ZXM6IGZ1bmN0aW9uKHZhbHVlMSwgdmFsdWUyKSB7XG4gICAgaWYgKHZhbHVlMSA9PT0gdmFsdWUyKSB7XG4gICAgICByZXR1cm4gdGhpcy5WQUxVRV9VTkNIQU5HRUQ7XG4gICAgfVxuICAgIGlmICgndW5kZWZpbmVkJyA9PSB0eXBlb2YodmFsdWUxKSkge1xuICAgICAgcmV0dXJuIHRoaXMuVkFMVUVfQ1JFQVRFRDtcbiAgICB9XG4gICAgaWYgKCd1bmRlZmluZWQnID09IHR5cGVvZih2YWx1ZTIpKSB7XG4gICAgICByZXR1cm4gdGhpcy5WQUxVRV9ERUxFVEVEO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLlZBTFVFX1VQREFURUQ7XG4gIH0sXG4gIGlzRnVuY3Rpb246IGZ1bmN0aW9uKG9iaikge1xuICAgIHJldHVybiB7fS50b1N0cmluZy5hcHBseShvYmopID09PSAnW29iamVjdCBGdW5jdGlvbl0nO1xuICB9LFxuICBpc0FycmF5OiBmdW5jdGlvbihvYmopIHtcbiAgICByZXR1cm4ge30udG9TdHJpbmcuYXBwbHkob2JqKSA9PT0gJ1tvYmplY3QgQXJyYXldJztcbiAgfSxcbiAgaXNPYmplY3Q6IGZ1bmN0aW9uKG9iaikge1xuICAgIHJldHVybiB7fS50b1N0cmluZy5hcHBseShvYmopID09PSAnW29iamVjdCBPYmplY3RdJztcbiAgfSxcbiAgaXNWYWx1ZTogZnVuY3Rpb24ob2JqKSB7XG4gICAgcmV0dXJuICF0aGlzLmlzT2JqZWN0KG9iaikgJiYgIXRoaXMuaXNBcnJheShvYmopO1xuICB9XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgZGlmZmVyZW5jZU1hcDogZGVlcERpZmZNYXBwZXIubWFwLmJpbmQoZGVlcERpZmZNYXBwZXIpLFxuICBzeW50YXhIaWdobGlnaHQ6IGZ1bmN0aW9uIChqc29uKSB7XG4gICAgaWYgKHR5cGVvZiBqc29uICE9ICdzdHJpbmcnKSB7XG4gICAgICBqc29uID0gSlNPTi5zdHJpbmdpZnkoanNvbiwgbnVsbCwgMik7XG4gICAgfVxuICAgIGpzb24gPSBqc29uLnJlcGxhY2UoLyYvZywgJyZhbXA7JykucmVwbGFjZSgvPC9nLCAnJmx0OycpLnJlcGxhY2UoLz4vZywgJyZndDsnKTtcblxuICAgIGpzb24gPSBqc29uLnJlcGxhY2UoLyhcIihcXFxcdVthLXpBLVowLTldezR9fFxcXFxbXnVdfFteXFxcXFwiXSkqXCIoXFxzKjopP3xcXGIodHJ1ZXxmYWxzZXxudWxsKVxcYnwtP1xcZCsoPzpcXC5cXGQqKT8oPzpbZUVdWytcXC1dP1xcZCspPykvZywgZnVuY3Rpb24gKG1hdGNoKSB7XG4gICAgICB2YXIgY2xzID0gJ251bWJlcic7XG4gICAgICBpZiAoL15cIi8udGVzdChtYXRjaCkpIHtcbiAgICAgICAgaWYgKC86JC8udGVzdChtYXRjaCkpIHtcbiAgICAgICAgICBjbHMgPSAna2V5JztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjbHMgPSAnc3RyaW5nJztcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmICgvdHJ1ZXxmYWxzZS8udGVzdChtYXRjaCkpIHtcbiAgICAgICAgY2xzID0gJ2Jvb2xlYW4nO1xuICAgICAgfSBlbHNlIGlmICgvbnVsbC8udGVzdChtYXRjaCkpIHtcbiAgICAgICAgY2xzID0gJ251bGwnO1xuICAgICAgfVxuICAgICAgcmV0dXJuICc8c3BhbiBjbGFzcz1cIicgKyBjbHMgKyAnXCI+JyArIG1hdGNoICsgJzwvc3Bhbj4nO1xuICAgIH0pO1xuICAgIHJldHVybiBqc29uID0ganNvbi5yZXBsYWNlKC9bXixcXG5dW15cXG5dKi9nLCBmdW5jdGlvbiAobWF0Y2gpIHtcbiAgICAgIHJldHVybiAnPHNwYW4+JyArIG1hdGNoICsgJzwvc3Bhbj4nO1xuICAgIH0pO1xuICB9LFxuICBkaWZmZXJlbmNlSGlnaGxpZ2h0OiBmdW5jdGlvbiAgKGpzb24sb3V0cHV0KXtcblxuICAgIGlmKG91dHB1dCl7XG4gICAgICBvdXRwdXQuZW1wdHkoKTtcbiAgICB9ZWxzZXtcbiAgICAgIG91dHB1dCA9ICQoXCI8cHJlPlwiKTtcbiAgICB9XG5cblxuICAgIGZ1bmN0aW9uIHByaW50T2JqZWN0KGpzb24sbGV2ZWwsb3V0cHV0LGNvbW1hLG9iamVjdEluZGV4KXtcbiAgICAgIHZhciBfZWwgPSAkKFwiPHA+XCIpO1xuXG4gICAgICBfZWwuYXBwZW5kKCQoXCI8c3Bhbj5cIikuYWRkQ2xhc3MoXCJvYmplY3Qta2V5XCIpLmFwcGVuZChcbiAgICAgICAgJChcIjxzcGFuPlwiKS50ZXh0KG5ldyBBcnJheShsZXZlbCkuam9pbignICcpIClcbiAgICAgICkpO1xuICAgICAgaWYob2JqZWN0SW5kZXgpe1xuICAgICAgICBfZWwuYXBwZW5kKFxuICAgICAgICAgICQoXCI8c3Bhbj5cIikudGV4dCgnXCInKS5hZGRDbGFzcyhcImludmlzaWJsZVwiKSxcbiAgICAgICAgICAkKFwiPHNwYW4+XCIpLmFkZENsYXNzKFwia2V5XCIpLnRleHQob2JqZWN0SW5kZXgpLFxuICAgICAgICAgICQoXCI8c3Bhbj5cIikudGV4dCgnXCInKS5hZGRDbGFzcyhcImludmlzaWJsZVwiKSxcbiAgICAgICAgICAkKFwiPHNwYW4+XCIpLnRleHQoJzogJylcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgaWYoanNvbiAmJiBqc29uLl9tYXBfdHlwZSAhPT0gdW5kZWZpbmVkKXtcbiAgICAgICAgX2VsLmFkZENsYXNzKGpzb24uX21hcF90eXBlKTtcblxuICAgICAgICBpZihfLmlzQXJyYXkoanNvbi5fbWFwX2RhdGEpKXtcbiAgICAgICAgICBfZWwuYXBwZW5kKCQoXCI8c3Bhbj5cIikudGV4dChcIltcIikpO1xuICAgICAgICAgIHZhciBfbGFzdF9rZXkgPSBqc29uLl9tYXBfZGF0YS5sZW5ndGggLSAxO1xuICAgICAgICAgIGZvcih2YXIgaSBpbiBqc29uLl9tYXBfZGF0YSl7XG4gICAgICAgICAgICBwcmludE9iamVjdChqc29uLl9tYXBfZGF0YVtpXSxsZXZlbCArIDEsX2VsLGkgIT0gX2xhc3Rfa2V5KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgX2VsLmFwcGVuZCgkKFwiPHA+XCIpLnRleHQobmV3IEFycmF5KGxldmVsICkuam9pbignICcpICsgXCJdXCIgKyAoY29tbWEgPyBcIixcIiA6IFwiXCIpKSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZihfLmlzT2JqZWN0KGpzb24uX21hcF9kYXRhKSl7XG4gICAgICAgICAgX2VsLmFwcGVuZCgkKFwiPHNwYW4+XCIpLnRleHQoXCJ7XCIpKTtcbiAgICAgICAgICB2YXIgX2xhc3Rfa2V5ID0gT2JqZWN0LmtleXMoanNvbi5fbWFwX2RhdGEpLnBvcCgpO1xuICAgICAgICAgIGZvcih2YXIgaSBpbiBqc29uLl9tYXBfZGF0YSl7XG4gICAgICAgICAgICBwcmludE9iamVjdChqc29uLl9tYXBfZGF0YVtpXSxsZXZlbCArIDEsX2VsLGkgIT0gX2xhc3Rfa2V5LGkpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBfZWwuYXBwZW5kKCQoXCI8cD5cIikudGV4dChuZXcgQXJyYXkobGV2ZWwgKS5qb2luKCcgJykgKyBcIn1cIiArIChjb21tYSA/IFwiLFwiIDogXCJcIikpKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNle1xuXG4gICAgICAgICAgaWYoXy5pc051bGwoanNvbi5fbWFwX2RhdGEpKXtcbiAgICAgICAgICAgIF9lbC5hcHBlbmQoXG4gICAgICAgICAgICAgICQoXCI8c3Bhbj5cIikudGV4dChKU09OLnN0cmluZ2lmeShqc29uLl9tYXBfZGF0YSwgbnVsbCwgMikpXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmKGpzb24uX21hcF9kYXRhLmNvbnN0cnVjdG9yID09PSBTdHJpbmcgKXtcbiAgICAgICAgICAgIF9lbC5hcHBlbmQoXG4gICAgICAgICAgICAgICQoXCI8c3Bhbj5cIikudGV4dCgnXCInKSxcbiAgICAgICAgICAgICAgJChcIjxzcGFuPlwiKS5hZGRDbGFzcygnc3RyaW5nJykudGV4dChqc29uLl9tYXBfZGF0YSksXG4gICAgICAgICAgICAgICQoXCI8c3Bhbj5cIikudGV4dCgnXCInKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSBpZihqc29uLl9tYXBfZGF0YS5jb25zdHJ1Y3RvciA9PT0gTnVtYmVyIHx8IGpzb24uX21hcF9kYXRhLmNvbnN0cnVjdG9yID09PSBCb29sZWFuKXtcbiAgICAgICAgICAgIF9lbC5hcHBlbmQoXG4gICAgICAgICAgICAgICQoXCI8c3Bhbj5cIikuYWRkQ2xhc3MoJ251bWJlcicpLnRleHQoanNvbi5fbWFwX2RhdGEpXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNle1xuICAgICAgICAgICAgX2VsLmFwcGVuZChcbiAgICAgICAgICAgICAgJChcIjxzcGFuPlwiKS50ZXh0KEpTT04uc3RyaW5naWZ5KGpzb24uX21hcF9kYXRhLCBudWxsLCAyKSlcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmKGNvbW1hKXtcbiAgICAgICAgICAgIF9lbC5hcHBlbmQoXG4gICAgICAgICAgICAgICQoXCI8c3Bhbj5cIikudGV4dChcIixcIilcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuXG5cbiAgICAgICAgfVxuICAgICAgfWVsc2V7XG4gICAgICAgIF9lbC5hcHBlbmQoXG4gICAgICAgICAgJChcIjxzcGFuPlwiKS50ZXh0KEpTT04uc3RyaW5naWZ5KGpzb24sIG51bGwsIDIpKVxuICAgICAgICApXG5cbiAgICAgICAgaWYoY29tbWEpe1xuICAgICAgICAgIF9lbC5hcHBlbmQoXG4gICAgICAgICAgICAkKFwiPHNwYW4+XCIpLnRleHQoXCIsXCIpXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICB9XG5cbiAgICAgIG91dHB1dC5hcHBlbmQoX2VsKTtcblxuICAgIH1cbiAgICBwcmludE9iamVjdChqc29uLDEsb3V0cHV0KTtcbiAgICByZXR1cm4gb3V0cHV0O1xuICB9XG59O1xuXG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL3V0aWwvc3ludGF4LmpzIiwiXG5cblxuaWYoIU9iamVjdC52YWx1ZXMpe1xuICBPYmplY3QuZGVmaW5lUHJvcGVydHkoT2JqZWN0LCAndmFsdWVzJywge1xuICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgIGNvbmZpZ3VyYWJsZTogZmFsc2UsXG4gICAgd3JpdGFibGU6IGZhbHNlLFxuICAgIHZhbHVlOiBmdW5jdGlvbihfb2JqZWN0KSB7XG4gICAgICB2YXIgX3ZhbHVlcyA9IFtdO1xuICAgICAgT2JqZWN0LmtleXMoX29iamVjdCkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgIF92YWx1ZXMucHVzaChfb2JqZWN0W2tleV0pO1xuICAgICAgICAvLyB1c2UgdmFsXG4gICAgICB9KTtcbiAgICAgIHJldHVybiBfdmFsdWVzO1xuICAgIH1cbiAgfSk7XG59XG5cblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMse1xuICBlcnJvcnM6IFtdXG59KTtcblxuZmFicmljLnV0aWwub3JkZXIgPSBmdW5jdGlvbihfYXJyYXksY29udGV4dCApe1xuICAoZnVuY3Rpb24gX2NhbGwoKXtcbiAgICBpZighX2FycmF5Lmxlbmd0aClyZXR1cm47XG4gICAgdmFyIGZvbyA9IF9hcnJheS5zaGlmdCgpO1xuICAgIGlmKGZvbyl7XG4gICAgICBpZihmb28ubGVuZ3RoKXtcbiAgICAgICAgZm9vLmNhbGwoY29udGV4dCxfY2FsbCk7XG4gICAgICB9ZWxzZXtcbiAgICAgICAgZm9vLmNhbGwoY29udGV4dCk7XG4gICAgICAgIF9jYWxsKCk7XG4gICAgICB9XG4gICAgfWVsc2V7XG4gICAgICBfY2FsbCgpO1xuICAgIH1cbiAgfSkoKVxufTtcblxuZmFicmljLnV0aWwucHJvbWlzZSA9IHtcbiAgbWFwOiBmdW5jdGlvbiAoZGF0YSwgZm9vKSB7XG5cbiAgICBpZihkYXRhLmNvbnN0cnVjdG9yID09IEFycmF5KXtcbiAgICAgIHJldHVybiBQcm9taXNlLmFsbChkYXRhLm1hcChmb28pKVxuICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzdWx0cywgZXJyb3IpIHtcbiAgICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUocmVzdWx0cyk7XG4gICAgICAgIH0pXG4gICAgfVxuXG4gICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhkYXRhKTtcbiAgICB2YXIgdXJscyA9IE9iamVjdC52YWx1ZXMoZGF0YSk7XG4gICAgcmV0dXJuIFByb21pc2UuYWxsKHVybHMubWFwKGZvbykpXG4gICAgICAudGhlbihmdW5jdGlvbiAocmVzdWx0cywgZXJyb3IpIHtcbiAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgX21hcCA9IHt9O1xuXG4gICAgICAgIGZvcih2YXIgaSA9IDAgOyBpIDwgcmVzdWx0cy5sZW5ndGg7IGkrKyl7XG4gICAgICAgICAgX21hcFtrZXlzW2ldXSA9IHJlc3VsdHNbaV07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShfbWFwKTtcbiAgICAgIH0pXG4gIH0sXG4gIHdyYXA6IGZ1bmN0aW9uIChjb250ZXh0KSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIHdyYXAoZm9vKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgb3B0aW9ucyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywxKTtcbiAgICAgICAgaWYgKCFmb28ubGVuZ3RoKSB7XG4gICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCBmYWlsKSB7XG4gICAgICAgICAgICB2YXIgX3Jlc3VsdCA9IGZvby5jYWxsKGNvbnRleHQpO1xuICAgICAgICAgICAgKF9yZXN1bHQgfHwgX3Jlc3VsdCA9PT0gdW5kZWZpbmVkKSA/IHJlc29sdmUoKSA6IGZhaWwoKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZm9vLmJpbmQoY29udGV4dCkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG59O1xuXG5mYWJyaWMuT2JqZWN0LnByb3RvdHlwZS5zZXQgPSBmdW5jdGlvbihrZXksIHZhbHVlKSB7XG4gIGlmICh0eXBlb2Yga2V5ID09PSAnb2JqZWN0Jykge1xuICAgIHRoaXMuX3NldE9iamVjdChrZXksIHZhbHVlKTtcbiAgfVxuICBlbHNlIHtcbiAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nICYmIGtleSAhPT0gJ2NsaXBUbycpIHtcbiAgICAgIHRoaXMuX3NldChrZXksIHZhbHVlKHRoaXMuZ2V0KGtleSkpKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICB0aGlzLl9zZXQoa2V5LCB2YWx1ZSk7XG4gICAgfVxuICB9XG4gIHJldHVybiB0aGlzO1xufTtcblxuZmFicmljLk9iamVjdC5wcm90b3R5cGUuX3NldE9iamVjdCA9IGZ1bmN0aW9uKG9wdGlvbnMsY2FsbGJhY2spIHtcbiAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhvcHRpb25zKTtcbiAgaWYodGhpcy5vcHRpb25zT3JkZXIpe1xuICAgIHZhciBtaWRkbGVJbmRleCA9IHRoaXMub3B0aW9uc09yZGVyLmluZGV4T2YoXCIqXCIpIHx8IC0xO1xuXG4gICAgdmFyIGkgPSBtaWRkbGVJbmRleCwgcHJvcCAsIGtleUluZGV4O1xuXG4gICAgd2hpbGUoKHByb3AgPSB0aGlzLm9wdGlvbnNPcmRlclstLWldKSl7XG4gICAgICBpZigoa2V5SW5kZXggPSBrZXlzLmluZGV4T2YocHJvcCkpICE9PSAtMSl7XG4gICAgICAgIGtleXMuc3BsaWNlKGtleUluZGV4LCAxKTtcbiAgICAgICAga2V5cy51bnNoaWZ0KHByb3ApO1xuICAgICAgfVxuICAgIH1cbiAgICBpID0gbWlkZGxlSW5kZXg7XG4gICAgd2hpbGUocHJvcCA9IHRoaXMub3B0aW9uc09yZGVyWysraV0pe1xuICAgICAgaWYoKGtleUluZGV4ID0ga2V5cy5pbmRleE9mKHByb3ApKSAhPT0gLTEpe1xuICAgICAgICBrZXlzLnNwbGljZShrZXlJbmRleCwgMSk7XG4gICAgICAgIGtleXMucHVzaChwcm9wKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgfVxuICBmb3IgKHZhciBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIgcHJvcCA9IGtleXNbaV07XG4gICAgaWYodHlwZW9mIG9wdGlvbnNbcHJvcF0gPT0gXCJmdW5jdGlvblwiKXtcbiAgICAgIGtleXMuc3BsaWNlKGksIDEpO1xuICAgICAga2V5cy51bnNoaWZ0KHByb3ApO1xuICAgIH1cbiAgfVxuICB2YXIgcXVldWU7XG4gIGZvciAodmFyIGkgaW4ga2V5cykge1xuICAgIHZhciBfa2V5ID0ga2V5c1tpXTtcbiAgICBpZihvcHRpb25zW19rZXldID09PSB1bmRlZmluZWQgKWNvbnRpbnVlO1xuICAgIHZhciBfZm9vTmFtZSA9IFwic2V0XCIgKyBmYWJyaWMudXRpbC5zdHJpbmcuY2FwaXRhbGl6ZShfa2V5LCB0cnVlKTtcbiAgICBpZih0aGlzW19mb29OYW1lXSAmJiB0aGlzW19mb29OYW1lXS5uYW1lICYmIHRoaXNbX2Zvb05hbWVdLm5hbWUgIT0gXCJhbm9ueW1vdXNcIil7XG4gICAgICBpZih0aGlzW19mb29OYW1lXS5sZW5ndGggPT0gMil7XG4gICAgICAgIGlmKCFxdWV1ZSl7XG4gICAgICAgICAgcXVldWUgPSBmYWJyaWMudXRpbC5xdWV1ZUxvYWQoMixjYWxsYmFjayk7XG4gICAgICAgIH1lbHNle1xuICAgICAgICAgIHF1ZXVlLnRvdGFsICsrO1xuICAgICAgICB9XG4gICAgICAgIHRoaXNbX2Zvb05hbWVdKG9wdGlvbnNbX2tleV0sZnVuY3Rpb24oX2tleSl7XG4gICAgICAgICAgcXVldWUoKTtcbiAgICAgICAgfS5iaW5kKHRoaXMsX2tleSkpO1xuICAgICAgfWVsc2V7XG4gICAgICAgIHRoaXNbX2Zvb05hbWVdKG9wdGlvbnNbX2tleV0pXG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX19zZXQoX2tleSwgb3B0aW9uc1tfa2V5XSk7XG4gICAgfVxuICB9XG4gIGlmKHF1ZXVlKXtcbiAgICBxdWV1ZSgpXG4gIH1lbHNlIGlmKGNhbGxiYWNrICl7XG4gICAgY2FsbGJhY2soKTtcbiAgfVxufTtcblxudmFyIF9nZXRfcG9pbnRlcl9vdmVyd3JpdHRlbiA9IGZhYnJpYy5DYW52YXMucHJvdG90eXBlLmdldFBvaW50ZXI7XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLlN0YXRpY0NhbnZhcy5wcm90b3R5cGUsIHtcbiAgX19zZXQgOiBmYWJyaWMuT2JqZWN0LnByb3RvdHlwZS5fc2V0LFxuICBfc2V0T2JqZWN0OiBmYWJyaWMuT2JqZWN0LnByb3RvdHlwZS5fc2V0T2JqZWN0LFxuICBnZXQ6IGZhYnJpYy5PYmplY3QucHJvdG90eXBlLmdldCxcbiAgc2V0OiBmYWJyaWMuT2JqZWN0LnByb3RvdHlwZS5zZXRcbn0pO1xuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuQ2FudmFzLnByb3RvdHlwZSwge1xuICBvcmlnaW5hbFN0YXRlOiB7fSxcbiAgc3RhdGVQcm9wZXJ0aWVzOiBbXSxcbiAgZWRpdGluZ09iamVjdDogbnVsbCxcblxuICBnZXRNb2RpZmllZFN0YXRlczogZnVuY3Rpb24gKHRhcmdldCkge1xuICAgIHZhciBzdGF0ZXMgPSB7XG4gICAgICBvcmlnaW5hbDoge30sXG4gICAgICBtb2RpZmllZDoge31cbiAgICB9O1xuICAgIGZvciAodmFyIHByb3AgaW4gdGFyZ2V0Lm9yaWdpbmFsU3RhdGUpIHtcbiAgICAgIGlmICh0YXJnZXQub3JpZ2luYWxTdGF0ZVtwcm9wXSAhPT0gdGFyZ2V0W3Byb3BdKSB7XG4gICAgICAgIGlmKHRhcmdldC5vcmlnaW5hbFN0YXRlW3Byb3BdIGluc3RhbmNlb2YgT2JqZWN0KXtcbiAgICAgICAgICBpZihKU09OLnN0cmluZ2lmeSh0YXJnZXQub3JpZ2luYWxTdGF0ZVtwcm9wXSkgPT0gSlNPTi5zdHJpbmdpZnkodGFyZ2V0W3Byb3BdKSl7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgc3RhdGVzLm9yaWdpbmFsW3Byb3BdID0gdGFyZ2V0Lm9yaWdpbmFsU3RhdGVbcHJvcF07XG4gICAgICAgIHN0YXRlcy5tb2RpZmllZFtwcm9wXSA9IHRhcmdldFtwcm9wXTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHN0YXRlcztcbiAgfSxcbiAgX2ZpbmFsaXplQ3VycmVudFRyYW5zZm9ybTogZnVuY3Rpb24gKCkge1xuXG4gICAgdmFyIHRyYW5zZm9ybSA9IHRoaXMuX2N1cnJlbnRUcmFuc2Zvcm0sXG4gICAgICB0YXJnZXQgPSB0cmFuc2Zvcm0udGFyZ2V0O1xuXG4gICAgaWYgKHRhcmdldC5fc2NhbGluZykge1xuICAgICAgdGFyZ2V0Ll9zY2FsaW5nID0gZmFsc2U7XG4gICAgfVxuXG4gICAgdGFyZ2V0LnNldENvb3JkcygpO1xuXG4gICAgdGhpcy5fcmVzdG9yZU9yaWdpblhZKHRhcmdldCk7XG4gICAgLy8gb25seSBmaXJlIDptb2RpZmllZCBldmVudCBpZiB0YXJnZXQgY29vcmRpbmF0ZXMgd2VyZSBjaGFuZ2VkIGR1cmluZyBtb3VzZWRvd24tbW91c2V1cFxuICAgIHRoaXMuZmlyZU1vZGlmaWVkSWZDaGFuZ2VkKHRhcmdldCk7XG4gIH0sXG4gIGZpcmVNb2RpZmllZElmQ2hhbmdlZDogZnVuY3Rpb24gKHRhcmdldCkge1xuICAgIGlmICh0aGlzLnN0YXRlZnVsKSB7XG4gICAgICB2YXIgX3N0YXRlcyA9IHRhcmdldC5oYXNTdGF0ZUNoYW5nZWQoKTtcbiAgICAgIGlmKF9zdGF0ZXMpe1xuICAgICAgICB0aGlzLmZpcmUoJ29iamVjdDptb2RpZmllZCcsIHt0YXJnZXQ6IHRhcmdldCAsIHN0YXRlczogX3N0YXRlc30pO1xuICAgICAgICB0YXJnZXQuZmlyZSgnbW9kaWZpZWQnLHtzdGF0ZXM6IF9zdGF0ZXN9KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn0pO1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5PYmplY3QucHJvdG90eXBlLCB7XG4gIHNldEFuZ2xlOiBmdW5jdGlvbihhbmdsZSkge1xuICAgIHRoaXMuYW5nbGUgPSBhbmdsZTtcbiAgfSxcblxuICBzZXRTaGFkb3c6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICByZXR1cm4gdGhpcy5zaGFkb3cgPSBvcHRpb25zID8gbmV3IGZhYnJpYy5TaGFkb3cob3B0aW9ucykgOiBudWxsO1xuICB9LFxuICBfX3NldCA6IGZhYnJpYy5PYmplY3QucHJvdG90eXBlLl9zZXQsXG5cbiAgX3NldDogZnVuY3Rpb24gKGtleSwgdmFsdWUgLGNhbGxiYWNrKSB7XG4gICAgdmFyIF9mb29OYW1lID0gXCJzZXRcIiArIGZhYnJpYy51dGlsLnN0cmluZy5jYXBpdGFsaXplKGtleSwgdHJ1ZSk7XG4gICAgaWYodGhpc1tfZm9vTmFtZV0gICYmIHRoaXNbX2Zvb05hbWVdLm5hbWUgJiYgdGhpc1tfZm9vTmFtZV0ubmFtZSAhPSBcImFub255bW91c1wiKXtcbiAgICAgIC8vIGlmICh0aGlzLnNwZWNpYWxQcm9wZXJ0aWVzLmluZGV4T2Yoa2V5KSAhPT0gLTEpIHtcbiAgICAgIC8vIGlmKHRoaXNbX2Zvb05hbWVdKXtcbiAgICAgIHRoaXNbX2Zvb05hbWVdKHZhbHVlLGNhbGxiYWNrKTtcbiAgICB9ZWxzZXtcbiAgICAgIHRoaXMuX19zZXQoa2V5LCB2YWx1ZSk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9LFxuICBkaXNhYmxlOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5zZXQoe1xuICAgICAgc2VsZWN0YWJsZTogZmFsc2UsXG4gICAgICBldmVudGVkOiBmYWxzZSxcbiAgICAgIGhhc0NvbnRyb2xzOiBmYWxzZSxcbiAgICAgIGxvY2tNb3ZlbWVudFg6IHRydWUsXG4gICAgICBsb2NrTW92ZW1lbnRZOiB0cnVlXG4gICAgfSk7XG4gIH0sXG4gIHN0b3JlZDogdHJ1ZSxcbiAgLyoqXG4gICAqIFNhdmVzIHN0YXRlIG9mIGFuIG9iamVjdFxuICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdIE9iamVjdCB3aXRoIGFkZGl0aW9uYWwgYHN0YXRlUHJvcGVydGllc2AgYXJyYXkgdG8gaW5jbHVkZSB3aGVuIHNhdmluZyBzdGF0ZVxuICAgKiBAcmV0dXJuIHtmYWJyaWMuT2JqZWN0fSB0aGlzQXJnXG4gICAqL1xuICBzYXZlU3RhdGU6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAvL1N0YXRlOiBmdW5jdGlvbihvcHRpb25zKSB7XG5cbiAgICB0aGlzLm9yaWdpbmFsU3RhdGUgPSB0aGlzLnRvT2JqZWN0KCk7XG4gICAgLypcbiAgICAvLyB0aGlzLnN0YXRlUHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKHByb3ApIHtcbiAgICAvLyAgIHZhciBfdmFsID0gdGhpcy5nZXQocHJvcCk7XG4gICAgLy8gICBpZihfdmFsIGluc3RhbmNlb2YgT2JqZWN0KXtcbiAgICAvLyAgICAgdGhpcy5vcmlnaW5hbFN0YXRlW3Byb3BdID0gZmFicmljLnV0aWwub2JqZWN0LmNsb25lRGVlcChfdmFsKTtcbiAgICAvLyAgIH1lbHNle1xuICAgIC8vICAgICB0aGlzLm9yaWdpbmFsU3RhdGVbcHJvcF0gPSBfdmFsO1xuICAgIC8vICAgfVxuICAgIC8vIH0sIHRoaXMpO1xuXG4gICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5zdGF0ZVByb3BlcnRpZXMpIHtcbiAgICAgIG9wdGlvbnMuc3RhdGVQcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24ocHJvcCkge1xuICAgICAgICB0aGlzLm9yaWdpbmFsU3RhdGVbcHJvcF0gPSB0aGlzLmdldChwcm9wKTtcbiAgICAgIH0sIHRoaXMpO1xuICAgIH0qL1xuICAgIHJldHVybiB0aGlzO1xuICB9LFxuICBoYXNTdGF0ZUNoYW5nZWQ6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBtb2RpZmllZCA9IDA7XG4gICAgdmFyIHN0YXRlcyA9IHtcbiAgICAgIG9yaWdpbmFsOiB7fSxcbiAgICAgIG1vZGlmaWVkOiB7fVxuICAgIH07XG5cbiAgICB2YXIgc3RhdGUgPSB0aGlzLnRvT2JqZWN0KCk7XG5cbiAgICBmb3IgKHZhciBwcm9wIGluIHRoaXMub3JpZ2luYWxTdGF0ZSkge1xuICAgICAgaWYgKHRoaXMub3JpZ2luYWxTdGF0ZVtwcm9wXSAhPT0gc3RhdGVbcHJvcF0pIHtcbiAgICAgICAgaWYodGhpcy5vcmlnaW5hbFN0YXRlW3Byb3BdIGluc3RhbmNlb2YgT2JqZWN0KXtcbiAgICAgICAgICBpZihKU09OLnN0cmluZ2lmeSh0aGlzLm9yaWdpbmFsU3RhdGVbcHJvcF0pID09IEpTT04uc3RyaW5naWZ5KHN0YXRlW3Byb3BdKSl7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgc3RhdGVzLm9yaWdpbmFsW3Byb3BdID0gdGhpcy5vcmlnaW5hbFN0YXRlW3Byb3BdO1xuICAgICAgICBzdGF0ZXMubW9kaWZpZWRbcHJvcF0gPSBzdGF0ZVtwcm9wXTtcbiAgICAgICAgbW9kaWZpZWQrKztcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG1vZGlmaWVkICYmIHN0YXRlcztcbiAgfVxufSk7XG5cbmZhYnJpYy51dGlsLmdldFByb3BvcnRpb25zID0gZnVuY3Rpb24gKHBob3RvLCBjb250YWluZXIsIG1vZGUpIHtcbiAgbW9kZSA9IG1vZGUgfHwgJ2ZpdCc7XG4gIHZhciBfdyA9IHBob3RvLm5hdHVyYWxXaWR0aCB8fCBwaG90by53aWR0aDtcbiAgdmFyIF9oID0gcGhvdG8ubmF0dXJhbEhlaWdodCB8fCBwaG90by5oZWlnaHQ7XG4gIGlmICghY29udGFpbmVyLmhlaWdodCAmJiAhY29udGFpbmVyLndpZHRoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHNjYWxlOiAxLFxuICAgICAgd2lkdGg6IF93LFxuICAgICAgaGVpZ2h0OiBfaFxuICAgIH07XG4gIH1cbiAgaWYgKCFwaG90by5oZWlnaHQgJiYgIXBob3RvLndpZHRoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHNjYWxlOiAwLjAwMSxcbiAgICAgIHdpZHRoOiBjb250YWluZXIud2lkdGgsXG4gICAgICBoZWlnaHQ6IGNvbnRhaW5lci5oZWlnaHRcbiAgICB9O1xuICB9XG5cbiAgLy8gdmFyIF9hc3AgPSBfdyAvIF9oLCBfY19hc3AgPSBjb250YWluZXIud2lkdGggLyBjb250YWluZXIuaGVpZ2h0O1xuXG4gIC8vIGlmIChfYXNwID4gX2NfYXNwKSB7XG4gIC8vICAgX2ggPSBjb250YWluZXIuaGVpZ2h0O1xuICAvLyAgIF93ID0gX2ggKiBfYXNwO1xuICAvL1xuICAvLyB9IGVsc2Uge1xuICAvLyAgIF93ID0gY29udGFpbmVyLndpZHRoO1xuICAvLyAgIF9oID0gX3cgLyBfYXNwO1xuICAvLyB9XG4gIC8vIHZhciBzY2FsZVggPSBjb250YWluZXIud2lkdGggLyBfdztcbiAgLy8gdmFyIHNjYWxlWSA9IGNvbnRhaW5lci5oZWlnaHQgLyBfaDtcbiAgdmFyIHNjYWxlWCA9IGNvbnRhaW5lci53aWR0aCAmJiBjb250YWluZXIud2lkdGggLyBfdyB8fCA5OTk7XG4gIHZhciBzY2FsZVkgPSBjb250YWluZXIuaGVpZ2h0ICYmIGNvbnRhaW5lci5oZWlnaHQgLyBfaCB8fCA5OTk7XG5cbiAgdmFyIHNjYWxlO1xuICBpZiAobW9kZSA9PT0gJ2NvdmVyJykge1xuICAgIHNjYWxlID0gTWF0aC5tYXgoc2NhbGVYLCBzY2FsZVkpO1xuICB9XG4gIGlmIChtb2RlID09PSAnZml0Jykge1xuICAgIHNjYWxlID0gTWF0aC5taW4oc2NhbGVYLCBzY2FsZVkpO1xuICB9XG4gIGlmIChtb2RlID09PSAnY2VudGVyJykge1xuICAgIHNjYWxlID0gMTtcbiAgfVxuICByZXR1cm4ge1xuICAgIHNjYWxlOiBzY2FsZSxcbiAgICB3aWR0aDogTWF0aC5mbG9vcihfdyAqIHNjYWxlKSxcbiAgICBoZWlnaHQ6IE1hdGguZmxvb3IoX2ggKiBzY2FsZSlcbiAgfTtcbn07XG5cbmZhYnJpYy51dGlsLlV0ZjhBcnJheVRvU3RyID0gZnVuY3Rpb24oYXJyYXkpIHtcbiAgdmFyIG91dCwgaSwgbGVuLCBjO1xuICB2YXIgY2hhcjIsIGNoYXIzO1xuXG4gIG91dCA9IFwiXCI7XG4gIGxlbiA9IGFycmF5Lmxlbmd0aDtcbiAgaSA9IDA7XG4gIHdoaWxlKGkgPCBsZW4pIHtcbiAgICBjID0gYXJyYXlbaSsrXTtcbiAgICBzd2l0Y2goYyA+PiA0KVxuICAgIHtcbiAgICAgIGNhc2UgMDogY2FzZSAxOiBjYXNlIDI6IGNhc2UgMzogY2FzZSA0OiBjYXNlIDU6IGNhc2UgNjogY2FzZSA3OlxuICAgICAgLy8gMHh4eHh4eHhcbiAgICAgIG91dCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGMpO1xuICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDEyOiBjYXNlIDEzOlxuICAgICAgLy8gMTEweCB4eHh4ICAgMTB4eCB4eHh4XG4gICAgICBjaGFyMiA9IGFycmF5W2krK107XG4gICAgICBvdXQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoKGMgJiAweDFGKSA8PCA2KSB8IChjaGFyMiAmIDB4M0YpKTtcbiAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAxNDpcbiAgICAgICAgLy8gMTExMCB4eHh4ICAxMHh4IHh4eHggIDEweHggeHh4eFxuICAgICAgICBjaGFyMiA9IGFycmF5W2krK107XG4gICAgICAgIGNoYXIzID0gYXJyYXlbaSsrXTtcbiAgICAgICAgb3V0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoKChjICYgMHgwRikgPDwgMTIpIHxcbiAgICAgICAgICAoKGNoYXIyICYgMHgzRikgPDwgNikgfFxuICAgICAgICAgICgoY2hhcjMgJiAweDNGKSA8PCAwKSk7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBvdXQ7XG59O1xuXG5mYWJyaWMudXRpbC5faWRDb3VudGVyID0gMTtcblxuZmFicmljLnV0aWwuY3JlYXRlT2JqZWN0ID0gZnVuY3Rpb24gKHR5cGUsIG9wdGlvbnMsIGNhbGxiYWNrKSB7XG4gIGlmKHR5cGVvZiB0eXBlICE9PSBcInN0cmluZ1wiKXtcbiAgICBjYWxsYmFjayA9IG9wdGlvbnM7XG4gICAgb3B0aW9ucyA9IHR5cGU7XG4gICAgdHlwZSA9IG51bGw7XG4gIH1lbHNle1xuICAgIG9wdGlvbnMudHlwZSA9IHR5cGU7XG4gIH1cbiAgdmFyIGFwcCA9IG9wdGlvbnMuYXBwbGljYXRpb247XG4gIGFwcCAmJiBhcHAuZmlyZShcImVudGl0eTpsb2FkXCIse29wdGlvbnM6IG9wdGlvbnN9KTtcblxuICB2YXIgX2tsYXNzTmFtZSA9IGZhYnJpYy51dGlsLnN0cmluZy5jYW1lbGl6ZShmYWJyaWMudXRpbC5zdHJpbmcuY2FwaXRhbGl6ZSh0eXBlIHx8IG9wdGlvbnMudHlwZSB8fCBhcHAucHJvdG90eXBlcy5PYmplY3QudHlwZSx0cnVlKSk7XG4gIHZhciBfa2xhc3MgPSBmYWJyaWNbX2tsYXNzTmFtZV0gfHwgYXBwLmtsYXNzZXNbX2tsYXNzTmFtZV07XG5cblxuICBpZighX2tsYXNzKXtcbiAgICBjb25zb2xlLmVycm9yKF9rbGFzc05hbWUgKyBcIiBpcyB1bmRlZmluZWRcIik7XG4gICAgdmFyIF90ZXh0ID0gb3B0aW9ucy50ZXh0IHx8IF9rbGFzc05hbWU7XG4gICAgZGVsZXRlIG9wdGlvbnMudGV4dDtcbiAgICByZXR1cm4gY2FsbGJhY2sobmV3IGZhYnJpYy5UZXh0KF90ZXh0LG9wdGlvbnMpKVxuICB9XG5cbiAgdmFyIGVsID0gX2tsYXNzLmZyb21PYmplY3Qob3B0aW9ucywgZnVuY3Rpb24gKGVsKSB7XG4gICAgY2FsbGJhY2sgJiYgY2FsbGJhY2soZWwpO1xuICAgIGNhbGxiYWNrID0gbnVsbDtcbiAgfSk7XG4gIGlmIChlbCkge1xuICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKGVsKTtcbiAgICBjYWxsYmFjayA9IG51bGw7XG4gIH1cbiAgcmV0dXJuIGVsO1xufTtcblxuZmFicmljLnV0aWwuZGF0YVVSSXRvQmxvYiA9IGZ1bmN0aW9uIChkYXRhVVJJLCBkYXRhVFlQRSkge1xuICB2YXIgYmluYXJ5ID0gYXRvYihkYXRhVVJJLnNwbGl0KCcsJylbMV0pLCBhcnJheSA9IFtdO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IGJpbmFyeS5sZW5ndGg7IGkrKykge1xuICAgIGFycmF5LnB1c2goYmluYXJ5LmNoYXJDb2RlQXQoaSkpO1xuICB9XG4gIHJldHVybiBuZXcgQmxvYihbbmV3IFVpbnQ4QXJyYXkoYXJyYXkpXSwge3R5cGU6IGRhdGFUWVBFfSk7XG59O1xuXG5mYWJyaWMudXRpbC5ibG9iVG9EYXRhVVJMID0gZnVuY3Rpb24gKGJsb2IsIGNhbGxiYWNrKSB7XG4gIHZhciBhID0gbmV3IEZpbGVSZWFkZXIoKTtcbiAgYS5vbmxvYWQgPSBmdW5jdGlvbiAoZSkge1xuICAgIGNhbGxiYWNrKGUudGFyZ2V0LnJlc3VsdCk7XG4gIH07XG4gIGEucmVhZEFzRGF0YVVSTChibG9iKTtcbn07XG5cbmZhYnJpYy51dGlsLmNyZWF0ZUNhbnZhc0VsZW1lbnRXaXRoU2l6ZSA9IGZ1bmN0aW9uIChzaXplKSB7XG4gIHZhciBjYW52YXMgPSBmYWJyaWMudXRpbC5jcmVhdGVDYW52YXNFbGVtZW50KCk7XG4gIGNhbnZhcy53aWR0aCA9IHNpemUud2lkdGg7XG4gIGNhbnZhcy5oZWlnaHQgPSBzaXplLmhlaWdodDtcbiAgcmV0dXJuIGNhbnZhcztcbn07XG5cbmZhYnJpYy51dGlsLnN0cmluZy50b0Rhc2hlZCA9IGZ1bmN0aW9uIChzdHIpIHtcbiAgcmV0dXJuIHN0ci5yZXBsYWNlKC8oW2Etel0pKFtBLVpdKS9nLCAnJDEtJDInKS50b0xvd2VyQ2FzZSgpO1xufTtcblxuZmFicmljLnV0aWwuc3RyaW5nLnVuY2FwaXRhbGl6ZSA9IGZ1bmN0aW9uKHN0cmluZyl7XG4gIHJldHVybiBzdHJpbmcuY2hhckF0KDApLnRvTG93ZXJDYXNlKCkgK1xuICAgIChzdHJpbmcuc2xpY2UoMSkpO1xufTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvY29yZS9iYXNlLmpzIiwiJ3VzZSBzdHJpY3QnO1xuXG5cbi8qKlxuICogQHByaXZhdGVcbiAqIEBwYXJhbSB7U3RyaW5nfSBldmVudE5hbWVcbiAqIEBwYXJhbSB7RnVuY3Rpb259IGhhbmRsZXJcbiAqL1xuZnVuY3Rpb24gX3JlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBoYW5kbGVyKSB7XG4gIGlmICghdGhpcy5fX2V2ZW50TGlzdGVuZXJzW2V2ZW50TmFtZV0pIHtcbiAgICByZXR1cm47XG4gIH1cbiAgdmFyIGV2ZW50TGlzdGVuZXIgPSB0aGlzLl9fZXZlbnRMaXN0ZW5lcnNbZXZlbnROYW1lXTtcbiAgaWYgKGhhbmRsZXIpIHtcbiAgICBldmVudExpc3RlbmVyLnNwbGljZShldmVudExpc3RlbmVyLmluZGV4T2YoaGFuZGxlciksIDEpXG4gIH1cbiAgZWxzZSB7XG4gICAgZXZlbnRMaXN0ZW5lci5sZW5ndGggPSAwO1xuICB9XG59XG5cbmZhYnJpYy5DYW52YXMucHJvdG90eXBlLnN0b3BPYnNlcnZpbmcgPSBmYWJyaWMuT2JqZWN0LnByb3RvdHlwZS5zdG9wT2JzZXJ2aW5nID0gZnVuY3Rpb24gc3RvcE9ic2VydmluZyhldmVudE5hbWUsIGhhbmRsZXIpIHtcbiAgaWYgKCF0aGlzLl9fZXZlbnRMaXN0ZW5lcnMpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICAvLyByZW1vdmUgYWxsIGtleS92YWx1ZSBwYWlycyAoZXZlbnQgbmFtZSAtPiBldmVudCBoYW5kbGVyKVxuICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMCkge1xuICAgIGZvciAoZXZlbnROYW1lIGluIHRoaXMuX19ldmVudExpc3RlbmVycykge1xuICAgICAgX3JlbW92ZUV2ZW50TGlzdGVuZXIuY2FsbCh0aGlzLCBldmVudE5hbWUpO1xuICAgIH1cbiAgfVxuICAvLyBvbmUgb2JqZWN0IHdpdGgga2V5L3ZhbHVlIHBhaXJzIHdhcyBwYXNzZWRcbiAgZWxzZSBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMSAmJiB0eXBlb2YgYXJndW1lbnRzWzBdID09PSAnb2JqZWN0Jykge1xuICAgIGZvciAodmFyIHByb3AgaW4gZXZlbnROYW1lKSB7XG4gICAgICBfcmVtb3ZlRXZlbnRMaXN0ZW5lci5jYWxsKHRoaXMsIHByb3AsIGV2ZW50TmFtZVtwcm9wXSk7XG4gICAgfVxuICB9XG4gIGVsc2Uge1xuICAgIF9yZW1vdmVFdmVudExpc3RlbmVyLmNhbGwodGhpcywgZXZlbnROYW1lLCBoYW5kbGVyKTtcbiAgfVxuICByZXR1cm4gdGhpcztcbn1cblxuXG5mYWJyaWMuT2JzZXJ2YWJsZS5vbiA9IGZhYnJpYy5DYW52YXMucHJvdG90eXBlLm9uID0gZmFicmljLk9iamVjdC5wcm90b3R5cGUub24gPSBmdW5jdGlvbiAoZXZlbnROYW1lLCBoYW5kbGVyLHByaW9yaXR5KSB7XG4gIGlmIChldmVudE5hbWUuY29uc3RydWN0b3IgPT0gT2JqZWN0KSB7XG4gICAgZm9yICh2YXIgaSBpbiBldmVudE5hbWUpIHtcbiAgICAgIHRoaXMub24oaSwgZXZlbnROYW1lW2ldLHByaW9yaXR5KVxuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuICB2YXIgZXZlbnRzID0gZXZlbnROYW1lLnNwbGl0KFwiIFwiKTtcbiAgZm9yICh2YXIgaSBpbiBldmVudHMpIHtcbiAgICBldmVudE5hbWUgPSBldmVudHNbaV07XG4gICAgdGhpcy5vYnNlcnZlKGV2ZW50TmFtZSwgaGFuZGxlcik7XG4gICAgaWYocHJpb3JpdHkpe1xuICAgICAgdGhpcy5fX2V2ZW50TGlzdGVuZXJzW2V2ZW50TmFtZV0udW5zaGlmdCh0aGlzLl9fZXZlbnRMaXN0ZW5lcnNbZXZlbnROYW1lXS5wb3AoKSk7XG4gICAgfVxuICB9XG4gIHJldHVybiB0aGlzO1xufTtcbmZhYnJpYy5DYW52YXMucHJvdG90eXBlLm9mZiA9IGZhYnJpYy5PYmplY3QucHJvdG90eXBlLm9mZiA9IGZ1bmN0aW9uIChldmVudE5hbWUsIGhhbmRsZXIpIHtcbiAgdmFyIGV2ZW50cyA9IGV2ZW50TmFtZS5zcGxpdChcIiBcIik7XG4gIGZvciAodmFyIGkgaW4gZXZlbnRzKSB7XG4gICAgdGhpcy5zdG9wT2JzZXJ2aW5nKGV2ZW50c1tpXSwgaGFuZGxlcilcbiAgfVxuICByZXR1cm4gdGhpcztcbn07XG5cblxuZmFicmljLkNhbnZhcy5wcm90b3R5cGUuZmlyZSA9IGZhYnJpYy5PYmplY3QucHJvdG90eXBlLmZpcmUgPSBmdW5jdGlvbiBmaXJlKGV2ZW50TmFtZSwgb3B0aW9ucykge1xuICBpZiAoIXRoaXMuX19ldmVudExpc3RlbmVycykge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBsaXN0ZW5lcnNGb3JFdmVudCA9IHRoaXMuX19ldmVudExpc3RlbmVyc1tldmVudE5hbWVdO1xuICBpZiAobGlzdGVuZXJzRm9yRXZlbnQpIHtcbiAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gbGlzdGVuZXJzRm9yRXZlbnQubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgIGxpc3RlbmVyc0ZvckV2ZW50W2ldLmNhbGwodGhpcywgb3B0aW9ucyB8fCB7fSk7XG4gICAgfVxuICB9XG5cbiAgdmFyIGxpc3RlbmVyc0ZvckV2ZW50QWxsID0gdGhpcy5fX2V2ZW50TGlzdGVuZXJzWycqJ107XG4gIGlmIChsaXN0ZW5lcnNGb3JFdmVudEFsbCkge1xuICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICAgIG9wdGlvbnMuZXZlbnROYW1lID0gZXZlbnROYW1lO1xuICAgIG9wdGlvbnMubGlzdGVuZXJzID0gbGlzdGVuZXJzRm9yRXZlbnQ7XG4gICAgZm9yIChpID0gMCwgbGVuID0gbGlzdGVuZXJzRm9yRXZlbnRBbGwubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgIGxpc3RlbmVyc0ZvckV2ZW50QWxsW2ldLmNhbGwodGhpcywgb3B0aW9ucyk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHRoaXM7XG59O1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9jb3JlL29ic2VydmUuanMiLCIndXNlIHN0cmljdCc7XG5cbi8qKlxuICogIyBBcHBsaWNhdGlvblxuICpcbiAqIGZhcmJpYy5hcHAgZnVuY3Rpb24gaXMgdGhlIGVudHJ5IHBvaW50IG9mIEZhYnJpY0pTIGFwcGxpY2F0aW9uLlxuICogQXBwbGljYXRpb24gY291bGQgYmUgaW5pdGlhbGlzZWQgd2l0aCBjb25maWd1cmF0aW9uIG9iamVjdC4gRGlmZmVyZW50IGV4dGVuc2lvbnMgYWxsb3dzIHRvIGluaXRpYWxpemUgc3BlY2lhbCBhcHBsaWNhdGlvbiBhdHRyaWJ1dGVzIHN1Y2ggYXMgKm9iamVjdCBwcm90b3R5cGVzKiwgKnJlc2l6YWJsZSBjYW52YXMqLCAqYXZhaWxhYmxlIGZvbnRzKiwgZXRjLlxuICpcbiAqICMjIyBvcHRpb246IHV0aWxcbiAqIG1lZGlhUm9vdCAtIHJvb3QgZGlyZWN0b3J5IGZvciBhbGwgbWVkaWEgZmlsZXMgaW4gZmFicmljIGFwcGxpY2F0aW9uXG4gKlxuICogIyMjIG9wdGlvbjogcmVzaXphYmxlXG4gKiBtYWtlcyBjYW52YXMgcmVzcG9uc2libGUuIENhbnZhcyB3aWxsIGJlIHNjYWxlZCB0byAxMDAlIG9mIGl0cyBjb250YWluZXIgc2l6ZVxuICpcbiAqICMjIyBvcHRpb246IG9uUmVzaXplXG4gKiBmdW5jdGlvbiB3aGljaCBvdmVycmlkZSBkZWFmdWx0IGNhbnZhcyByZXNpemUgYmVoYXZpb3IuXG4gKlxuICogIyMjIG9wdGlvbjogY2FsbGJhY2tcbiAqIGZ1bmN0aW9uIGNhbGxzIGFmdGVyIGNhbnZhcyBpbml0aWFsaXplZFxuICpcbiAqICMjIyBvcHRpb246IGluaXRpYWxpemVcbiAqIGZ1bmN0aW9uIGNhbGxzIGJlZm9yZSBjYW52YXMgaW5pdGlhbGl6ZVxuICpcbiAqIEBleGFtcGxlXG4gKlxuICogbmV3IGZhYnJpYy5BcHBsaWNhdGlvbih7XG4gKiAgICAgIHJlc2l6YWJsZTogdHJ1ZSxcbiAqICAgICAgb25SZXNpemU6IGZ1bmN0aW9uKCl7fSxcbiAqICAgICAgdXRpbDoge1xuICogICAgICAgIG1lZGlhUm9vdDogJy4uLy4uL21lZGlhLydcbiAqICAgICAgfSxcbiAqICAgICAgY2FudmFzQ29udGFpbmVyOiBcImZpZXJhLWNhbnZhc1wiLFxuICogICAgICBwcm90b3R5cGVzOiB7fSxcbiAqICAgICAgb2JqZWN0czoge30sXG4gKiAgICAgIGV2ZW50TGlzdGVuZXJzOiB7fSxcbiAqICAgICAgY2FsbGJhY2s6IGZ1bmN0aW9uKCl7fSxcbiAqICAgICAgaW5pdGlhbGl6ZTogIGZ1bmN0aW9uKCl7fVxuICogICAgICBjdXN0b21QdWJsaWNBcHBsaWNhdGlvbkZ1bmN0aW9uOiBmdW5jdGlvbigpe30sXG4gKiAgICAgIGN1c3RvbVB1YmxpY0FwcGxpY2F0aW9uQXR0cmlidXRlOiB2YWx1ZVxuICogIH0pXG4gKlxuICovXG5cbmZhYnJpYy5BcHBsaWNhdGlvbiA9IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgdGhpcy5pbml0KG9wdGlvbnMpO1xufTtcblxuZmFicmljLkFwcGxpY2F0aW9uLnByb3RvdHlwZSA9IGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoe30sZmFicmljLk9ic2VydmFibGUse1xuICBkZWZhdWx0T3B0aW9uczoge1xuICAgIC8qKlxuICAgICAqIGlkIG9mIHRhcmdldCBjYW52YXMgZWxlbWVudFxuICAgICAqL1xuICAgIGNhbnZhc0NvbnRhaW5lcjogbnVsbFxuICB9LFxuICBjcmVkZW50aWFsczogZmFsc2UsXG4gIHJlYWR5IDogZmFsc2UsXG4gIGNhbnZhc0NsYXNzOiAnQ2FudmFzJyxcbiAgb3B0aW9uc09yZGVyOiBbXG4gICAgXCJjYW52YXNDb250YWluZXJcIixcbiAgICBcIipcIixcbiAgICBcIm9iamVjdHNcIixcbiAgICBcInNsaWRlXCJcbiAgXSxcbiAgcGx1Z2luczoge1xuICAgIHByZWxvYWRlcnM6IFtdLFxuICAgIGNvbmZpZ3VyYXRpb246IFtdLFxuICAgIGNhbnZhczogW11cbiAgfSxcbiAgLyoqXG4gICAqIEFkZGl0aW9uYWwgRXZlbnQgTGlzdGVuZXJzIGNvdWxkYmUgdXNlZCB0byBkZXRlY3QgYWN0aXZlb2JqZWN0IGNoYW5nZXNcbiAgICogIC0gY2FudmFzOmNyZWF0ZWRcbiAgICogIC0gZW50aXR5OmxvYWQgLSBFdmVudCBmaXJlZCBvbiBjcmVhdGlvbiBvZiBldmVyeSBuZXcgZmFicmljIGluc3RhbmNlKGNhbnZhcyxicnVzaCxvYmplY3QpXG4gICAqXG4gICAqICBAZXhhbXBsZVxuICAgKiAgJ2VudGl0eTpsb2FkJyA6IGZ1bmN0aW9uKGUpe1xuICAgKiAgICAgaWYoZS5vcHRpb25zLmJveFR5cGUgPT0gJ21hY2hpbmUnKSB7XG4gICAqICAgICAgIGUub3B0aW9ucy50eXBlID0gXCJtYWNoaW5lLW1hc2stcmVjdGFuZ2xlXCI7XG4gICAqICAgICB9XG4gICAqICAgfVxuICAgKi9cbiAgZXZlbnRMaXN0ZW5lcnM6IHtcbiAgICBcImNhbnZhczpjcmVhdGVkXCI6IFtdLFxuICAgIFwiZW50aXR5OmNyZWF0ZWRcIjogW1xuICAgICAgZnVuY3Rpb24oZSl7XG4gICAgICAgIGlmKGUudGFyZ2V0LmV2ZW50TGlzdGVuZXJzKXtcbiAgICAgICAgICBmb3IodmFyIGkgaW4gZS50YXJnZXQuZXZlbnRMaXN0ZW5lcnMpIHtcbiAgICAgICAgICAgIHZhciBfbGlzdGVuZXJzID0gZS50YXJnZXQuZXZlbnRMaXN0ZW5lcnNbaV07XG4gICAgICAgICAgICBpZihfbGlzdGVuZXJzLmNvbnN0cnVjdG9yID09IEFycmF5KXtcbiAgICAgICAgICAgICAgZm9yICh2YXIgaiBpbiBfbGlzdGVuZXJzKSB7XG4gICAgICAgICAgICAgICAgZS50YXJnZXQub24oaSwgX2xpc3RlbmVyc1tqXSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICBlLnRhcmdldC5vbihpLCBfbGlzdGVuZXJzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZihlLm9wdGlvbnMuZXZlbnRMaXN0ZW5lcnMpe1xuICAgICAgICAgIGZvcih2YXIgaSBpbiBlLm9wdGlvbnMuZXZlbnRMaXN0ZW5lcnMpe1xuICAgICAgICAgICAgZS50YXJnZXQub24oaSxlLm9wdGlvbnMuZXZlbnRMaXN0ZW5lcnNbaV0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBkZWxldGUgZS5vcHRpb25zLmV2ZW50TGlzdGVuZXJzO1xuXG4gICAgICAgIGlmKGUudGFyZ2V0Ll9kZWZhdWx0X2V2ZW50X2xpc3RlbmVycyl7XG4gICAgICAgICAgZm9yKHZhciBpIGluIGUudGFyZ2V0Ll9kZWZhdWx0X2V2ZW50X2xpc3RlbmVycyl7XG4gICAgICAgICAgICBlLnRhcmdldC5vbihpLGUudGFyZ2V0Ll9kZWZhdWx0X2V2ZW50X2xpc3RlbmVyc1tpXSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgXVxuICB9LFxuICBvblNsaWRlTG9hZGVkOiBmdW5jdGlvbiAoKSB7fSxcbiAgb25DYW52YXNDcmVhdGVkOiBmdW5jdGlvbiAoKSB7fSxcbiAgY2FsbGJhY2s6IGZ1bmN0aW9uICgpIHt9LFxuXG4gIGluaXQ6IGZ1bmN0aW9uKG9wdGlvbnMpe1xuICAgIHRoaXMuaW5pdEV2ZW50TGlzdGVuZXJzKCk7XG4gICAgb3B0aW9ucyA9ICBmYWJyaWMudXRpbC5vYmplY3QuZGVlcEV4dGVuZCh7fSx0aGlzLmRlZmF1bHRPcHRpb25zICxvcHRpb25zIHx8IHt9KTtcblxuICAgIHRoaXMuZmlyZShcImxvYWRpbmc6YmVnaW5cIix7b3B0aW9ucyA6IG9wdGlvbnN9KTtcblxuICAgIHRoaXMuX29wdGlvbnMgPSBvcHRpb25zO1xuXG5cbiAgICAkKCBkb2N1bWVudCApLnJlYWR5KGZ1bmN0aW9uKCl7XG4gICAgICBmYWJyaWMudXRpbC5vcmRlcihbXG4gICAgICAgIHRoaXMucHJlbG9hZGVyLFxuICAgICAgICB0aGlzLmxvYWRDb25maWd1cmF0aW9uLFxuICAgIC8vICAgIHRoaXMuY3JlYXRlQXBwLFxuICAgICAgICB0aGlzLmluaXRPcHRpb25zLFxuICAgICAgICB0aGlzLmluaXRpYWxpemUsXG4gICAgICAgIHRoaXMub25BcHBsaWNhdGlvbkNyZWF0ZWQsXG4gICAgICAgIHRoaXMucG9zdGxvYWRlcixcbiAgICAgICAgdGhpcy5jYWxsYmFjayAmJiBmdW5jdGlvbigpe1xuICAgICAgICAgIHNldFRpbWVvdXQodGhpcy5jYWxsYmFjay5iaW5kKHRoaXMpLDApO1xuICAgICAgICB9LFxuICAgICAgICBmdW5jdGlvbigpe1xuICAgICAgICAgIHRoaXMuZmlyZShcInJlYWR5XCIpO1xuICAgICAgICB9LmJpbmQodGhpcylcbiAgICAgIF0sdGhpcylcbiAgICB9LmJpbmQodGhpcykpXG4gIH0sXG4gIG9uQXBwbGljYXRpb25DcmVhdGVkOiBmdW5jdGlvbigpe1xuICAgIHRoaXMucmVhZHkgPSB0cnVlO1xuICAgIHRoaXMuZmlyZShcImxvYWRpbmc6ZW5kXCIse30pO1xuICB9LFxuICBzZXRDcmVkZW50aWFsczogZnVuY3Rpb24oY3JlZGVudGlhbHMpe1xuICAgIGlmKGNyZWRlbnRpYWxzKXtcbiAgICAgIGNvbnNvbGUuaW5mbyhcIiVjRmllcmEgQ2FudmFzIEVkaXRvciVjIGJ5ICVjRGVuaXMgUG9ub21hcmV2JWMgJWMlNiRzJWMgLyAlYyU5JHMlY1wiLCBcImNvbG9yOiAjZmZhNTAwXCIsIFwiY29sb3I6ICMyMDIwMjBcIiwgXCJjb2xvcjogIzJFQzA2Q1wiLCBcImNvbG9yOiAjMjAyMDIwXCIsIFwiY29sb3I6ICMzMzdhYjdcIiwgXCJ3d3cuaG9tZXRsdC5ydVwiLCBcImNvbG9yOiAjMjAyMDIwXCIsIFwiY29sb3I6ICMzMzdhYjdcIiwgXCJwb25vbWFyZXZ0bHRAZ21haWwuY29tXCIsIFwiY29sb3I6ICMyMDIwMjBcIik7XG4gICAgfVxuICB9LFxuICBpbml0T3B0aW9uczogZnVuY3Rpb24gKHJlc29sdmUsZXJyb3IpIHtcbiAgICB0aGlzLnNldCh0aGlzLl9vcHRpb25zLHJlc29sdmUpO1xuICB9LFxuICBjb25maWd1cmF0aW9uUHJvcGVydGllczogW10sXG4gIGxvYWRDb25maWd1cmF0aW9uOiBmdW5jdGlvbiAocmVzb2x2ZSxlcnJvcikge1xuXG4gICAgaWYodGhpcy5jb25maWd1cmF0aW9uUHJvcGVydGllcyl7XG4gICAgICBmb3IobGV0IHByb3Agb2YgdGhpcy5jb25maWd1cmF0aW9uUHJvcGVydGllcyl7XG5cbiAgICAgICAgaWYodGhpcy5fb3B0aW9uc1twcm9wXSl7XG4gICAgICAgICAgaWYoIXRoaXMuX29wdGlvbnMuY29uZmlndXJhdGlvbil7XG4gICAgICAgICAgICB0aGlzLl9vcHRpb25zLmNvbmZpZ3VyYXRpb24gPSB7fTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy5fb3B0aW9ucy5jb25maWd1cmF0aW9uW3Byb3BdID0gdGhpcy5fb3B0aW9uc1twcm9wXTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmKCF0aGlzLl9vcHRpb25zLmNvbmZpZ3VyYXRpb24pe1xuICAgICAgcmV0dXJuIHJlc29sdmUoKTtcbiAgICB9XG4gICAgdmFyIF9hcHAgPSB0aGlzO1xuICAgIGZhYnJpYy51dGlsLnByb21pc2VcbiAgICAgIC5tYXAoXG4gICAgICAgIHRoaXMuX29wdGlvbnMuY29uZmlndXJhdGlvbixcbiAgICAgICAgZnVuY3Rpb24odmFsdWUpe1xuICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLGZhaWwpIHtcbiAgICAgICAgICAgIGZhYnJpYy51dGlsLmRhdGEubG9hZEpzb24odmFsdWUscmVzb2x2ZSxmYWlsKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgKVxuICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzdWx0cyl7XG4gICAgICAgIGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoX2FwcC5fb3B0aW9ucyxyZXN1bHRzKVxuICAgICAgfSlcbiAgICAgIC50aGVuKHJlc29sdmUsZXJyb3IpO1xuICB9LFxuICBzZXRDYW52YXNDb250YWluZXI6IGZ1bmN0aW9uIChjYW52YXNDb250YWluZXIpIHtcbiAgICB0aGlzLmNhbnZhc0NvbnRhaW5lciA9IGNhbnZhc0NvbnRhaW5lcjtcblxuICAgIGlmIChjYW52YXNDb250YWluZXIuY29uc3RydWN0b3IgPT0gU3RyaW5nKSB7XG4gICAgICB2YXIgZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjYW52YXNDb250YWluZXIpO1xuICAgIH0gZWxzZSB7XG4gICAgICBlbCA9IGNhbnZhc0NvbnRhaW5lcjtcbiAgICB9XG4gICAgdGhpcy5jYW52YXMgPSBuZXcgZmFicmljW3RoaXMuY2FudmFzQ2xhc3NdKGVsLCB7YXBwbGljYXRpb246IHRoaXN9KTtcbiAgICAvLyB9ZWxzZXtcbiAgICAvLyAgIHRoaXMuY2FudmFzID0gbmV3IGZhYnJpY1t0aGlzLmNhbnZhc0NsYXNzXSh7YXBwbGljYXRpb246IHRoaXN9KTtcbiAgICAvLyB9XG5cbiAgICB0aGlzLmZpcmUoXCJjYW52YXM6Y3JlYXRlZFwiKTtcbiAgICB0aGlzLm9uQ2FudmFzQ3JlYXRlZCgpO1xuICB9LFxuICBkaXNwb3NlOiBmdW5jdGlvbigpe1xuICAgIHRoaXMuY2FudmFzLmRpc3Bvc2UoKTtcbiAgfSxcblxuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIEV2ZW50IExpc3RlbmVyc1xuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgc2V0RXZlbnRMaXN0ZW5lcnM6IGZ1bmN0aW9uKHZhbCl7XG4gICAgdGhpcy5vbih2YWwpO1xuICB9LFxuICBpbml0RXZlbnRMaXN0ZW5lcnM6IGZ1bmN0aW9uKCl7XG4gICAgaWYoIXRoaXMuX19ldmVudExpc3RlbmVycyl7XG4gICAgICB0aGlzLl9fZXZlbnRMaXN0ZW5lcnMgPSB7fTtcbiAgICB9XG4gICAgZm9yICh2YXIgZXZlbnQgaW4gdGhpcy5ldmVudExpc3RlbmVycykge1xuICAgICAgaWYoIXRoaXMuX19ldmVudExpc3RlbmVyc1tldmVudF0pe1xuICAgICAgICB0aGlzLl9fZXZlbnRMaXN0ZW5lcnNbZXZlbnRdID0gW11cbiAgICAgIH1cbiAgICAgIHRoaXMuX19ldmVudExpc3RlbmVyc1tldmVudF0gPSB0aGlzLl9fZXZlbnRMaXN0ZW5lcnNbZXZlbnRdLmNvbmNhdCAodGhpcy5ldmVudExpc3RlbmVyc1tldmVudF0pO1xuICAgIH1cbiAgfSxcblxuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vXG4gIF9fc2V0IDogZmFicmljLk9iamVjdC5wcm90b3R5cGUuX19zZXQsXG4gIF9zZXRPYmplY3Q6IGZhYnJpYy5PYmplY3QucHJvdG90eXBlLl9zZXRPYmplY3QsXG4gIHNldDogZmFicmljLk9iamVjdC5wcm90b3R5cGUuc2V0LFxuICBzZXRPcHRpb25zOiBmYWJyaWMuT2JqZWN0LnByb3RvdHlwZS5zZXRPcHRpb25zLFxuICBhY3Rpb25zOiB7XG4gICAgc2F2ZToge1xuICAgICAgdGl0bGU6IFwic2F2ZSBwcm9qZWN0XCIsXG4gICAgICBjbGFzc05hbWU6ICdmYSBmYS1mbG9wcHktbycsXG4gICAgICBhY3Rpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGRhdGEgPSB0aGlzLnRvT2JqZWN0KCk7XG4gICAgICAgIHRoaXMuYXBwbGljYXRpb24uYXBpLnNhdmUoZGF0YSk7XG4gICAgICB9XG4gICAgfVxuICB9XG59KTtcblxuLy8gZmFicmljLkFwcGxpY2F0aW9uLmFkZFBsdWdpbiA9IGZhYnJpYy5QbHVnaW5zTWl4aW4uYWRkUGx1Z2luLmJpbmQoZmFicmljLkFwcGxpY2F0aW9uKTtcblxuZmFicmljLmFwcCA9IGZ1bmN0aW9uKG9wdGlvbnMpe1xuICByZXR1cm4gbmV3IGZhYnJpYy5BcHBsaWNhdGlvbihvcHRpb25zKTtcbn07XG5cblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvY29yZS9hcHBsaWNhdGlvbi5qcyIsIid1c2Ugc3RyaWN0JztcblxucmVxdWlyZShcIi4vc3RhdGljLWNhbnZhcy5leHRcIik7XG5cbi8qKlxuICogIyBTbGlkZUNhbnZhc1xuICogSW5oZXJpdGVkIGZyb20gZmFicmljLkNhbnZhc1xuICpcbiAqXG5cbiAjIyBtZXRob2Q6IGxvYWRcblxuTWF0aG9kIGFsbG93cyB0byBhZGQgbmV3IG9iamVjdHMgYW5kIHNldCBuZXcgYXR0cmlidXRlcyBvZiBjYW52YXMuXG5cbiBgYGBqYXZhc2NyaXB0XG4gbG9hZCA6ICh7XG4gICAgYmFja2dyb3VuZEltYWdlOiBzdHJpbmcsXG4gICAgb2JqZWN0czogW0ZhYnJpY1NoYXBlT3B0aW9uc10sXG4gICAgY3VzdG9tU3luY09wdGlvbjogYW55LFxuICAgIGN1c3RvbUFzeW5jT3B0aW9uOiBhbnlcbiAgfSxjYWxsYmFjaykgOiB2b2lkXG4gYGBgXG5cbiBUbyBleHRlbmQgbG9hZGluZyBiZWhhdmlvciBhbmQgdXNlIGN1c3RvbSBvcHRpb25zIGl0IGlzIHBvc3NpYmxlIHRvIGRlZmluZSAqKnNldCBmdWNudGlvbnMqKiBpbiBDYW52YXMgcHJvdG90eXBlLlxuXG4gYGBgamF2YXNjcmlwdFxuIC8vIENhbnZhcyBQcm90b3R5cGVcbiBzZXRDdXN0b21Bc3luY09wdGlvbjogZnVuY3Rpb24odmFsLGNhbGxiYWNrKXtcbiAgdGhpcy5kb0FzeW5jTWV0aG9kKHZhbCxjYWxsYmFjaylcbn1cbiBzZXRDdXN0b21TeW5jT3B0aW9uOiBmdW5jdGlvbih2YWwpe1xuICB0aGlzLmN1c3RvbVN5bmNPdGlvbiA9IHZhbDtcbn1cbiBgYGBcblxuICMjIyBhdHRyaWJ1dGU6IGJhY2tncm91bmRJbWFnZVByb3BlcnRpZXNcblxuIGRlZmF1bHQgYXR0cmlidXRlcyBmb3IgYmFja2dyb3VuZCBpbWFnZVxuXG4gIyMjIGZyZWVEcmF3aW5nQnJ1c2hcblxuIGRlZmF1bHQgYWN0aXZlIGRyYXdpbmcgYnJ1c2hcblxuIGBgYFxuIGZyZWVEcmF3aW5nQnJ1c2g6IFwiUGFpbnRCdWNrZXRCcnVzaFwiIHwgXCJQYWludFBlbkJydXNoXCIgfCBcIlBlbmNpbEJydXNoXCJcbiBgYGBcblxuICMjIyBhdHRyaWJ1dGU6IG9uU2xpZGVMb2FkZWRcblxuIG9uU2xpZGVMb2FkZWQgY2FsbHMgYXMgYSBjYWxsYmFjayBmb3IgbG9hZCBmdWNudGlvblxuXG4gIyMjIGF0dHJpYnV0ZTogYmFja2dyb3VuZFBvc2l0aW9uXG5cbiBvblNsaWRlTG9hZGVkIGNhbGxzIGFzIGEgY2FsbGJhY2sgZm9yIGxvYWQgZnVjbnRpb25cblxuIGBgYFxuIGJhY2tncm91bmRQb3NpdGlvbjogJ21hbnVhbCcgfCAncmVzaXplJyB8ICdmaXQnIHwgJ2NvdmVyJyB8ICdjZW50ZXInXG4gYGBgXG5cbiAtIG1hbnVhbCAtIGJhY2tncm91bmQgd2lsbCBuZSBub3Qgc2NhbGVkIGFuZCBwdXQgYXQgbGVmdCB0b3AgY29ybmVyXG4gLSByZXNpemUgLSBjYW52YXMgd2lsbCBiZSByZXNpemVkIGFjY29yZGluZyB0byBpbWFnZSBzaXplXG4gLSBmaXQgLSB3aWxsIGJlIHNjYWxlZCB0byBmaXQgY2FudmFzIHNpemVcbiAtIGNvdmVyIC0gd2lsbCBiZSBzY2FsZWQgdG8gY292ZXIgYWxsIGNhbnZhcyBzaXplXG4gLSBjZW50ZXIgLSBiYWNrb2dydW5kIHdpbGwgYmUgbm90IHNjYWxlZCBidXQgcHV0IGluIHRoZSBtaWRkbGVcblxuICMjIyBtZXRob2Q6IHNldEludGVyYWN0aXZlTW9kZVxuXG4gc3dpdGNoIGJldHdlZW4gZHJhd2luZyBhbmQgaGFuZCggbW92aW5nIGN1bnZhcyBieSBtb3VzZSkgbW9kZXNcblxuIGBgYGphdmFzY3JpcHRcbiBjYW52YXMuc2V0SW50ZXJhY3RpdmVNb2RlKCBtb2RlIDogXCJoYW5kXCIgfCBcIm1peGVkXCIpIDogdm9pZFxuIGBgYFxuXG4gIyMjIGRyYXdpbmdDb2xvclxuXG4gZHJhd2luZyBjb2xvciB1c2luZyBieSBicnVzaGVzXG5cbiAqL1xuXG5cblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuU3RhdGljQ2FudmFzLnByb3RvdHlwZSwge1xuXG4gIHNldEJhY2tncm91bmRDb2xvcjogZnVuY3Rpb24oYmFja2dyb3VuZENvbG9yLCBjYWxsYmFjaykge1xuXG4gICAgaWYodGhpcy5sb2FkZWQpIHtcbiAgICAgIHZhciBvcmlnaW5hbFN0YXRlID0ge2JhY2tncm91bmRDb2xvcjogdGhpcy5iYWNrZ3JvdW5kQ29sb3J9O1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLl9fc2V0QmdPdmVybGF5Q29sb3IoJ2JhY2tncm91bmRDb2xvcicsIGJhY2tncm91bmRDb2xvciwgZnVuY3Rpb24oKXtcbiAgICAgIHRoaXMucmVuZGVyQWxsKCk7XG5cbiAgICAgIGlmKHRoaXMubG9hZGVkKXtcbiAgICAgICAgdGhpcy5maXJlKCdtb2RpZmllZCcse3N0YXRlczoge1xuICAgICAgICAgIG9yaWdpbmFsOiBvcmlnaW5hbFN0YXRlLFxuICAgICAgICAgIG1vZGlmaWVkOiB7YmFja2dyb3VuZENvbG9yOiBiYWNrZ3JvdW5kQ29sb3J9XG4gICAgICAgIH19KTtcbiAgICAgIH1cbiAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKClcbiAgICB9LmJpbmQodGhpcykpO1xuICB9LFxuICBzdG9yZVByb3BlcnRpZXM6IFsnKicsJ2JhY2tncm91bmRDb2xvcicsJ2JhY2tncm91bmRJbWFnZScsJ3dpZHRoJywnaGVpZ2h0J10sXG5cbiAgdG9PYmplY3RTeW5jOiBmdW5jdGlvbiAocHJvcGVydGllc1RvSW5jbHVkZSkge1xuICAgIHByb3BlcnRpZXNUb0luY2x1ZGUgPSAocHJvcGVydGllc1RvSW5jbHVkZSB8fCBbXSkuY29uY2F0KHRoaXMuc3RvcmVQcm9wZXJ0aWVzKTtcblxuICAgIGxldCBfZGF0YSA9IHtcbiAgICAgIG9iamVjdHM6IHRoaXMuZ2V0T2JqZWN0cygpLFxuICAgICAgd2lkdGg6IHRoaXMub3JpZ2luYWxXaWR0aCB8fCB0aGlzLndpZHRoLFxuICAgICAgaGVpZ2h0OiB0aGlzLm9yaWdpbmFsSGVpZ2h0IHx8IHRoaXMuaGVpZ2h0LFxuICAgIH07XG4gICAgZmFicmljLnV0aWwucG9wdWxhdGVXaXRoUHJvcGVydGllcyh0aGlzLCBfZGF0YSwgcHJvcGVydGllc1RvSW5jbHVkZSk7XG5cblxuICAgIHRoaXMuZmlyZShcImJlZm9yZTpvYmplY3RcIix7b2JqZWN0OiBfZGF0YX0pO1xuXG4gICAgcmV0dXJuIF9kYXRhO1xuICB9LFxuICB0b09iamVjdDogZnVuY3Rpb24gKHByb3BlcnRpZXNUb0luY2x1ZGUpIHtcblxuICAgIHByb3BlcnRpZXNUb0luY2x1ZGUgPSAocHJvcGVydGllc1RvSW5jbHVkZSB8fCBbXSkuY29uY2F0KHRoaXMuc3RvcmVQcm9wZXJ0aWVzKTtcblxuICAgIGxldCBfb2JqcyA9IHRoaXMuZ2V0T2JqZWN0cygpO1xuXG4gICAgX29ianMgPSBmYWJyaWMudXRpbC5vYmplY3QuZmlsdGVyKF9vYmpzLHtzdG9yZWQ6IHRydWV9KTtcbiAgICBfb2JqcyA9IF9vYmpzLm1hcChpbnN0YW5jZSA9PiB7XG4gICAgICByZXR1cm4gaW5zdGFuY2UudG9PYmplY3QodGhpcy5vYmplY3RzUHJvcGVydGllc1RvSW5jbHVkZSk7XG4gICAgfSk7XG5cbiAgICBsZXQgX2RhdGEgPSB7XG4gICAgICBvYmplY3RzOiBfb2Jqc1xuICAgIH07XG5cbiAgICBmYWJyaWMudXRpbC5wb3B1bGF0ZVdpdGhQcm9wZXJ0aWVzKHRoaXMsIF9kYXRhLCBwcm9wZXJ0aWVzVG9JbmNsdWRlKTtcblxuICAgIGlmKHByb3BlcnRpZXNUb0luY2x1ZGUuaW5kZXhPZignYmFja2dyb3VuZEltYWdlJykgIT09IC0xKXtcbiAgICAgIGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoX2RhdGEsIHRoaXMuX19zZXJpYWxpemVCZ092ZXJsYXkoKSk7XG4gICAgfVxuXG4gICAgaWYocHJvcGVydGllc1RvSW5jbHVkZS5pbmRleE9mKCd3aWR0aCcpICE9PSAtMSAmJiB0aGlzLm9yaWdpbmFsV2lkdGgpe1xuICAgICAgX2RhdGEud2lkdGggPSB0aGlzLm9yaWdpbmFsV2lkdGg7XG4gICAgfVxuICAgIGlmKHByb3BlcnRpZXNUb0luY2x1ZGUuaW5kZXhPZignaGVpZ2h0JykgIT09IC0xICYmIHRoaXMub3JpZ2luYWxIZWlnaHQpe1xuICAgICAgX2RhdGEuaGVpZ2h0ID0gdGhpcy5vcmlnaW5hbEhlaWdodDtcbiAgICB9XG5cblxuICAgIC8qXG4gICAgIGZ1bmN0aW9uIHNlcmlhbGl6ZVRodW1iKHByb3BlcnRpZXNUb0luY2x1ZGUsIF9kYXRhKXtcbiAgICAgaWYocHJvcGVydGllc1RvSW5jbHVkZS5pbmRleE9mKCd0aHVtYicpICE9PSAtMSl7XG4gICAgIHZhciBzaXplID0gZmFicmljLnV0aWwuZ2V0UHJvcG9ydGlvbnModGhpcy5nZXRPcmlnaW5hbFNpemUoKSwgdGhpcy50aHVtYlNpemUsICdmaXQnKTtcbiAgICAgdmFyIGNhbnZhcyA9IGZhYnJpYy51dGlsLmNyZWF0ZUNhbnZhc0VsZW1lbnQoKTtcbiAgICAgY2FudmFzLndpZHRoID0gc2l6ZS53aWR0aDtcbiAgICAgY2FudmFzLmhlaWdodCA9IHNpemUuaGVpZ2h0O1xuICAgICB0aGlzLnJlbmRlclRodW1iKGNhbnZhcyk7XG4gICAgIF9kYXRhLnRodW1iID0gY2FudmFzLnRvRGF0YVVSTCgpO1xuICAgICB9XG4gICAgIH0sXG4gICAgIGZ1bmN0aW9uIHNlcmlhbGl6ZVRlbXBsYXRlKHByb3BlcnRpZXNUb0luY2x1ZGUsIF9kYXRhKSB7XG4gICAgIGlmIChwcm9wZXJ0aWVzVG9JbmNsdWRlLmluZGV4T2YoJ3RlbXBsYXRlJykgIT09IC0xKSB7XG4gICAgIGlmICh0aGlzLnRlbXBsYXRlKSB7XG4gICAgIGZvciAodmFyIGkgaW4gX2RhdGEudGVtcGxhdGUpIHtcbiAgICAgaWYgKEpTT04uc3RyaW5naWZ5KF9kYXRhW2ldKSA9PSBKU09OLnN0cmluZ2lmeShfZGF0YS50ZW1wbGF0ZVtpXSkpIHtcbiAgICAgZGVsZXRlIF9kYXRhW2ldO1xuICAgICB9XG4gICAgIH1cbiAgICAgX2RhdGEudGVtcGxhdGUgPSB0aGlzLnRlbXBsYXRlLmlkO1xuICAgICB9XG4gICAgIH1cbiAgICAgfSovXG5cblxuICAgIHRoaXMuZmlyZShcImJlZm9yZTpvYmplY3RcIix7b2JqZWN0OiBfZGF0YX0pO1xuXG4gICAgcmV0dXJuIF9kYXRhO1xuICB9LFxuICBzZXRUZW1wbGF0ZTogZnVuY3Rpb24odGVtcGxhdGUpe1xuXG4gICAgdGhpcy50ZW1wbGF0ZSA9IHRlbXBsYXRlO1xuICAgIGlmKCF0ZW1wbGF0ZSlyZXR1cm47XG5cbiAgICB0aGlzLnNldFdpZHRoKHRoaXMuc2xpZGVXaWR0aCB8fCB0ZW1wbGF0ZS53aWR0aCk7XG4gICAgdGhpcy5zZXRIZWlnaHQodGhpcy5zbGlkZUhlaWdodCB8fCB0ZW1wbGF0ZS5oZWlnaHQpO1xuICAgIHRoaXMub3JpZ2luYWxIZWlnaHQgPSB0aGlzLmhlaWdodDtcbiAgICB0aGlzLm9yaWdpbmFsV2lkdGggPSB0aGlzLndpZHRoO1xuXG4gICAgdGhpcy5zZXQoZmFicmljLnV0aWwub2JqZWN0LnJlYXJyYW5nZSh0ZW1wbGF0ZSxbXCJhcmVhc1wiLFwiaGVscGVyc1wiLFwib2Zmc2V0c1wiXSkpO1xuXG4gICAgdGhpcy5fdXBkYXRlX2NsaXBfcmVjdCgpO1xuICAgIHRoaXMuX3VwZGF0ZV9iYWNrZ3JvdW5kX2ltYWdlKCk7XG4gICAgdGhpcy5maXJlKFwibW9kaWZpZWRcIix7dHlwZTogXCJ0ZW1wbGF0ZVwifSk7XG4gICAgdGhpcy5yZW5kZXJBbGwoKTtcbiAgfSxcbiAgYWRkVGV4dDogZnVuY3Rpb24gKHRleHQsIG9wdGlvbnMpIHtcbiAgICB0aGlzLmNyZWF0ZU9iamVjdCh7XG4gICAgICBwb3NpdGlvbjogXCJjZW50ZXJcIixcbiAgICAgIHRleHQ6IHRleHQsXG4gICAgICB0eXBlOiAgIHRoaXMuZGVmYXVsdFRleHRUeXBlLFxuICAgICAgY2xpcFRvOiB0aGlzLmFjdGl2ZUFyZWEsXG4gICAgICBtb3ZlbWVudExpbWl0cyA6IHRoaXMuYWN0aXZlQXJlYVxuICAgIH0pO1xuICB9XG59KTtcblxuXG5cbmZhYnJpYy5TbGlkZUNhbnZhcyA9IGZhYnJpYy51dGlsLmNyZWF0ZUNsYXNzKGZhYnJpYy5DYW52YXMsZmFicmljLlBsdWdpbnNNaXhpbiwge1xuICB0eXBlOiAnY2FudmFzJyxcbiAgLyoqXG4gICAqIGluaXRpYWxpemVkIHdpZHRoIG9mIHRoZSBjYW52YXNcbiAgICovXG4gIHdpZHRoOiAxNjAgLFxuICAvKipcbiAgICogaW5pdGlhbGl6ZWQgaGVpZ2h0IG9mIHRoZSBjYW52YXNcbiAgICovXG4gIGhlaWdodDogOTAsXG4gIC8qKlxuICAgKiBvdXRwdXQgcXVhbGl0eVxuICAgKi9cbiAgZG90c1BlclVuaXQ6IDEsXG4gIHNjYWxlOiAxLFxuICBsb2FkZWQ6IGZhbHNlLFxuICAvKipcbiAgICogYWxsb3cgdXNlciB0byBpbnRlcmFjdCB3aXRoIGNhbnZhc1xuICAgKi9cbiAgaW50ZXJhY3RpdmU6IHRydWUsXG4gIC8qKlxuICAgKiBmaWxsIG5vdCB0aGUgc2xpZGUgYXJlYSwgYnV0IHdob2xlIGNhbnZhcyB3aXRoIGJhY2tncm91bmQgY29sb3JcbiAgICovXG4gIGRlZmF1bHRUZXh0OiBcInRleHRcIixcbiAgZGVmYXVsdFRleHRUeXBlOiBcInRleHRcIixcbiAgdGh1bWJTaXplOiB7XG4gICAgd2lkdGg6IDUwLFxuICAgIGhlaWdodDogMTAwXG4gIH0sXG5cbiAgY29udGV4dFRvcEltYWdlU21vb3RoaW5nRW5hYmxlZDogdHJ1ZSxcbiAgcGx1Z2luczoge1xuICAgIGluaXRpYWxpemU6IFtcbiAgICBdLFxuICAgIHByZWxvYWRlcnM6IFtcbiAgICBdLFxuICAgIGxvYWRlcnM6IFtdXG4gIH0sXG4gIHNldEludGVyYWN0aXZlOiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICB0aGlzLmludGVyYWN0aXZlID0gdmFsdWU7XG4gIH0sXG5cbiAgX2NyZWF0ZVVwcGVyQ2FudmFzOiBmdW5jdGlvbiAoKSB7XG4gICAgZmFicmljLkNhbnZhcy5wcm90b3R5cGUuX2NyZWF0ZVVwcGVyQ2FudmFzLmNhbGwodGhpcyk7XG4gICAgdmFyIGN0eCA9IHRoaXMuY29udGV4dFRvcDtcblxuICAgIGlmKGN0eC5pbWFnZVNtb290aGluZ0VuYWJsZWQpe1xuICAgICAgY3R4LmltYWdlU21vb3RoaW5nRW5hYmxlZCA9IHRoaXMuY29udGV4dFRvcEltYWdlU21vb3RoaW5nRW5hYmxlZDtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY3R4LndlYmtpdEltYWdlU21vb3RoaW5nRW5hYmxlZCA9IHRoaXMuY29udGV4dFRvcEltYWdlU21vb3RoaW5nRW5hYmxlZDtcbiAgICBjdHgubW96SW1hZ2VTbW9vdGhpbmdFbmFibGVkICAgID0gdGhpcy5jb250ZXh0VG9wSW1hZ2VTbW9vdGhpbmdFbmFibGVkO1xuICAgIGN0eC5tc0ltYWdlU21vb3RoaW5nRW5hYmxlZCAgICAgPSB0aGlzLmNvbnRleHRUb3BJbWFnZVNtb290aGluZ0VuYWJsZWQ7XG4gICAgY3R4Lm9JbWFnZVNtb290aGluZ0VuYWJsZWQgICAgICA9IHRoaXMuY29udGV4dFRvcEltYWdlU21vb3RoaW5nRW5hYmxlZDtcbiAgfSxcbiAgX29uTW91c2VVcEluRHJhd2luZ01vZGU6IGZ1bmN0aW9uKGUpIHtcbiAgICB0aGlzLl9pc0N1cnJlbnRseURyYXdpbmcgPSBmYWxzZTtcbiAgICBpZiAodGhpcy5jbGlwVG8pIHtcbiAgICAgIHRoaXMuY29udGV4dFRvcC5yZXN0b3JlKCk7XG4gICAgfVxuICAgIHZhciBwb2ludGVyID0gdGhpcy5nZXRQb2ludGVyKGUpO1xuICAgIHRoaXMuZnJlZURyYXdpbmdCcnVzaC5vbk1vdXNlVXAocG9pbnRlcik7XG4gICAgdGhpcy5faGFuZGxlRXZlbnQoZSwgJ3VwJyk7XG4gIH0sXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uIChlbCwgb3B0aW9ucyxjYWxsYmFjaykge1xuICAgIGlmKGVsICYmIGVsLmNvbnN0cnVjdG9yID09IE9iamVjdCl7XG4gICAgICBjYWxsYmFjayA9IG9wdGlvbnM7XG4gICAgICBvcHRpb25zID0gZWw7XG4gICAgICBlbCA9IG51bGw7XG4gICAgfVxuICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuXG4gICAgaWYob3B0aW9ucy5hcHBsaWNhdGlvbil7XG4gICAgICBvcHRpb25zLmFwcGxpY2F0aW9uLmZpcmUoXCJlbnRpdHk6Y3JlYXRlZFwiLHt0YXJnZXQgOiB0aGlzICwgb3B0aW9ucyA6IG9wdGlvbnN9KTtcbiAgICB9XG5cbiAgICB0aGlzLmlkID0gZmFicmljLlNsaWRlQ2FudmFzLl9faWRjb3VudGVyKys7XG5cbiAgICB0aGlzLl9vYmplY3RzID0gW107XG4gICAgdGhpcy5fY3JlYXRlTG93ZXJDYW52YXMoZWwpO1xuXG4gICAgdGhpcy5jcmVhdGVkID0gdHJ1ZTtcbiAgICB0aGlzLl9jdXJyZW50VHJhbnNmb3JtID0gbnVsbDtcbiAgICB0aGlzLl9ncm91cFNlbGVjdG9yID0gbnVsbDtcbiAgICB0aGlzLl9pbml0V3JhcHBlckVsZW1lbnQoKTtcbiAgICB0aGlzLl9jcmVhdGVVcHBlckNhbnZhcygpO1xuICAgIHRoaXMuX2luaXRFdmVudExpc3RlbmVycygpO1xuICAgIHRoaXMuX2luaXRSZXRpbmFTY2FsaW5nKCk7XG4gICAgdGhpcy5jYWxjT2Zmc2V0KCk7XG5cbiAgICB0aGlzLndyYXBwZXJFbC5hcHBlbmRDaGlsZCh0aGlzLnVwcGVyQ2FudmFzRWwpO1xuXG4gICAgdGhpcy5fY3JlYXRlQ2FjaGVDYW52YXMoKTtcbiAgICB0aGlzLl9zZXRJbWFnZVNtb290aGluZygpO1xuICAgIHRoaXMuX2luaXRSZXRpbmFTY2FsaW5nKCk7XG5cbiAgICB0aGlzLnNldChvcHRpb25zKTtcbiAgICB0aGlzLl9pbml0U2l6ZSgpO1xuXG4gICAgdGhpcy5jYWxjT2Zmc2V0KCk7XG5cbiAgICB0aGlzLmZpcmUoXCJjcmVhdGVkXCIpO1xuICAgIC8vIGlmKHRoaXMuYXBwbGljYXRpb24pe1xuICAgIC8vICAgdGhpcy5hcHBsaWNhdGlvbi5maXJlKFwiY2FudmFzOmNyZWF0ZWRcIix7dGFyZ2V0IDogdGhpc30pO1xuICAgIC8vIH1cbiAgfSxcbiAgYW5pbWF0ZWQ6IGZhbHNlLFxuICBzZXRBbmltYXRlZDogZnVuY3Rpb24odmFsKXtcbiAgICB0aGlzLmFuaW1hdGVkID0gdmFsO1xuICAgIGlmKHZhbCl7XG4gICAgICBmYWJyaWMudXRpbC5yZXF1ZXN0QW5pbUZyYW1lKGZ1bmN0aW9uIHJlbmRlcigpIHtcbiAgICAgICAgdGhpcy5yZW5kZXJBbGwoKTtcbiAgICAgICAgZmFicmljLnV0aWwucmVxdWVzdEFuaW1GcmFtZShyZW5kZXIpO1xuICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICB9XG4gIH0sXG4gIGNyZWF0ZTogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuY3JlYXRlZCA9IHRydWU7XG4gICAgdGhpcy5faW5pdEludGVyYWN0aXZlKCk7XG4gICAgdGhpcy5fY3JlYXRlQ2FjaGVDYW52YXMoKTtcbiAgfSxcbiAgLyoqXG4gICAqIEFkZGl0aW9uYWwgRXZlbnQgTGlzdGVuZXJzXG4gICAqICAtIGxvYWRpbmc6ZW5kXG4gICAqICAtIHRhcmdldDptb2RpZmllZCAtIGNvdWxkYmUgdXNlZCB0byBkZXRlY3QgYWN0aXZlIG9iamVjdCBjaGFuZ2VzXG4gICAqICAtIHRhcmdldDpjaGFuZ2VkXG4gICAqICAtIHRhcmdldDpjbGVhcmVkXG4gICAqL1xuICBldmVudExpc3RlbmVyczoge1xuICAgICdvYmplY3Q6bW92aW5nJzogZnVuY3Rpb24gKG9iaikge1xuICAgICAgdGhpcy5maXJlKCd0YXJnZXQ6bW9kaWZpZWQnLCB0aGlzLCBvYmopXG4gICAgfSxcbiAgICAnc2VsZWN0aW9uOmNsZWFyZWQnOiBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgIGlmKCF0aGlzLnRhcmdldClyZXR1cm47XG4gICAgICB0aGlzLnRhcmdldC5maXJlKCdkZXNlbGVjdGVkJywgZXZlbnQpO1xuICAgICAgdGhpcy50YXJnZXQgPSBudWxsO1xuICAgICAgdGhpcy5maXJlKCd0YXJnZXQ6Y2xlYXJlZCcsIGV2ZW50KTtcbiAgICB9LFxuICAgICdvYmplY3Q6c2VsZWN0ZWQnOiBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgIGV2ZW50LnByZXZpb3VzID0gdGhpcy50YXJnZXQ7XG4gICAgICB0aGlzLnRhcmdldCA9IGV2ZW50LnRhcmdldDtcbiAgICAgIGlmKGV2ZW50LnByZXZpb3VzKXtcbiAgICAgICAgZXZlbnQucHJldmlvdXMuZmlyZSgnZGVzZWxlY3RlZCcsIGV2ZW50KTtcbiAgICAgIH1cbiAgICAgIHRoaXMuZmlyZSgndGFyZ2V0OmNoYW5nZWQnLCBldmVudCk7XG4gICAgfSxcbiAgICAnZ3JvdXA6c2VsZWN0ZWQnOiBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgIHRoaXMudGFyZ2V0ID0gZXZlbnQudGFyZ2V0O1xuICAgICAgdGhpcy5maXJlKCd0YXJnZXQ6Y2hhbmdlZCcsIGV2ZW50KTtcbiAgICB9XG4gIH1cbn0pO1xuZmFicmljLlNsaWRlQ2FudmFzLl9faWRjb3VudGVyID0gMDtcbmZhYnJpYy5TbGlkZUNhbnZhcy5mcm9tSnNvbiA9IGZ1bmN0aW9uKHVybCxjYWxsYmFjayAsIGVsZW1lbnQpe1xuICBmYWJyaWMudXRpbC5kYXRhLmxvYWRKc29uKHVybCxmdW5jdGlvbihkYXRhKXtcbiAgICBuZXcgZmFicmljLlNsaWRlQ2FudmFzKGVsZW1lbnQsZGF0YSxjYWxsYmFjaylcbiAgfSlcbn07XG5cbmZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUuYWN0aW9ucyA9IGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoe30sIHtcbiAgc2VsZWN0QWxsOiB7XG4gICB0aXRsZTogJ3NlbGVjdEFsbCcsXG4gICB0eXBlOiAna2V5J1xuICB9LFxuICBiYWNrZ3JvdW5kQ29sb3IgOiB7XG4gICAgdHlwZTogXCJjb2xvclwiXG4gIH0sXG4gIGFkZFRleHQ6IHtcbiAgICBjbGFzc05hbWU6ICAnZmEgZmEtZm9udCcsXG4gICAgdGl0bGU6ICd0ZXh0JyxcbiAgICBhY3Rpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuYWRkVGV4dCh0aGlzLmRlZmF1bHRUZXh0LHt9KTtcbiAgICB9XG4gIH1cbn0pO1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5BcHBsaWNhdGlvbi5wcm90b3R5cGUsIHtcbiAgc2V0U2xpZGU6IGZ1bmN0aW9uICh2YWx1ZSwgY2FsbGJhY2spIHtcbiAgICB2YXIgX2NhbnZhcyA9IHRoaXMuY2FudmFzO1xuICAgIGlmIChfY2FudmFzLmxvYWQpIHtcbiAgICAgIF9jYW52YXMubG9hZCh2YWx1ZSwgY2FsbGJhY2spO1xuICAgIH0gZWxzZSB7XG4gICAgICBfY2FudmFzLmNyZWF0ZU9iamVjdHModmFsdWUsIGNhbGxiYWNrKTtcbiAgICB9XG4gIH1cbn0pO1xuXG5mYWJyaWMuQXBwbGljYXRpb24ucHJvdG90eXBlLmNhbnZhc0NsYXNzID0gJ1NsaWRlQ2FudmFzJztcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvY29yZS9zbGlkZS5qcyIsIlxuZmFicmljLlNsaWRlID0gZnVuY3Rpb24oYXBwbGljYXRpb24sIHNsaWRlKXtcblxuXG4gIGlmKGZhYnJpYy5pc0xpa2VseU5vZGUpe1xuICAgIC8vIGZhYnJpYy5DYW52YXMgPSBmYWJyaWMuU2xpZGVDYW52YXM7XG4gICAgdmFyIHcgPSBzbGlkZS5zbGlkZVdpZHRoOyAvL3RvZG98fCBzbGlkZS50ZW1wbGF0ZS53aWR0aDtcbiAgICB2YXIgaCA9IHNsaWRlLnNsaWRlSGVpZ2h0Oy8vdG9kbyB8fCBzbGlkZS50ZW1wbGF0ZS5oZWlnaHQ7XG4gICAgdmFyIHpvb20gPSBmYWJyaWMuU2xpZGVDYW52YXMucHJvdG90eXBlLnpvb20gfHwgMTtcbiAgICB0aGlzLmNhbnZhcyA9IGZhYnJpYy5jcmVhdGVDYW52YXNGb3JOb2RlKHcgKiB6b29tLGggKiB6b29tKTtcbiAgfWVsc2V7XG4gICAgdmFyICRjYW52YXMgPSBmYWJyaWMudXRpbC5jcmVhdGVDYW52YXNFbGVtZW50KCk7XG4gICAgdGhpcy5jYW52YXMgPSAgbmV3IGZhYnJpYy5TdGF0aWNDYW52YXMoJGNhbnZhcywge2FwcGxpY2F0aW9uOiBhcHBsaWNhdGlvbiwgaW50ZXJhY3RpdmU6IGZhbHNlfSk7XG4gIH1cblxuICB0aGlzLm9iamVjdCA9IHNsaWRlO1xuIC8vIHRoaXMuZGF0YSA9IHNsaWRlLmRhdGE7XG4gIHRoaXMuYXBwbGljYXRpb24gPSBhcHBsaWNhdGlvbjtcbiAgdGhpcy5pZCA9ICsrIGZhYnJpYy5TbGlkZS5fc2xpZGVzX2lkX2NvdW50ZXI7XG5cbn07XG5cbmZhYnJpYy5TbGlkZS5wcm90b3R5cGUgPSBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKHt9LGZhYnJpYy5PYnNlcnZhYmxlKTtcblxuZmFicmljLlNsaWRlLl9zbGlkZXNfaWRfY291bnRlciA9IDE7XG5cblxuXG5mYWJyaWMuQXBwbGljYXRpb24ucHJvdG90eXBlLmNvbmZpZ3VyYXRpb25Qcm9wZXJ0aWVzLnB1c2goXCJzbGlkZXNcIik7XG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5BcHBsaWNhdGlvbi5wcm90b3R5cGUsIHtcbiAgZGVmYXVsdE9wdGlvbnM6IGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLkFwcGxpY2F0aW9uLnByb3RvdHlwZS5kZWZhdWx0T3B0aW9ucyx7XG4gICAgYWN0aXZlU2xpZGU6IDBcbiAgfSksXG4gIG9wdGlvbnNPcmRlcjogKGZ1bmN0aW9uKCl7XG4gICAgdmFyIG9vID0gZmFicmljLkFwcGxpY2F0aW9uLnByb3RvdHlwZS5vcHRpb25zT3JkZXI7XG4gICAgb28ucHVzaChcInNsaWRlc1wiLFwiYWN0aXZlU2xpZGVcIik7XG4gICAgcmV0dXJuIG9vO1xuICB9KSgpLFxuICAvKmluaXRpYWxpemU6IGZ1bmN0aW9uIChvcHRpb25zKSB7XG5cbiAgIGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQodGhpcywge1xuICAgbGFzdF9pZDogMSxcbiAgIHNjYWxlVmFsdWU6IDEsXG4gICBhY3RpdmVTbGlkZTogbnVsbCxcbiAgIGhpc3Rvcnk6IG51bGwsXG4gICBzbGlkZXM6IFtdLFxuICAgY2FudmFzOiBudWxsXG4gICB9KTtcblxuICAgdGhpcy5hbGlnbWVudExpbmVYID0gZmFsc2U7XG4gICB0aGlzLmFsaWdtZW50TGluZVkgPSBmYWxzZTtcblxuICAgZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCh0aGlzLG9wdGlvbnMpO1xuICAgZmFicmljLnV0aWwub2JqZWN0LmRlZmF1bHRzKG9wdGlvbnMsdGhpcy5kZWZ1bHRPcHRpb25zKTtcblxuICAgLy8gdGhpcy5zZXRBY2Nlc3ModGhpcy5hY2Nlc3MpO1xuXG4gICBpZihvcHRpb25zLmdyaWRzbmFwcGVyICE9PSB1bmRlZmluZWQpIHtcbiAgIHRoaXMuZ3JpZHNuYXBwZXIgPSBvcHRpb25zLmdyaWRzbmFwcGVyXG4gICB9XG4gICBpZihvcHRpb25zLmhpc3RvcnkgIT09IHVuZGVmaW5lZCkge1xuICAgdGhpcy5oaXN0b3J5ID0gb3B0aW9ucy5oaXN0b3J5O1xuICAgfVxuICAgaWYob3B0aW9ucy5kYXRhKXtcbiAgIHRoaXMuZGF0YSA9IG9wdGlvbnMuZGF0YTtcbiAgIH1cbiAgIGlmKHRoaXMuaGlzdG9yeSkge1xuICAgdGhpcy5oaXN0b3J5ID0gbmV3IEhpc3RvcnkodGhpcyk7XG4gICB0aGlzLmhpc3RvcnkuYXBwbGljYXRpb24gPSB0aGlzLmFwcGxpY2F0aW9uO1xuICAgfVxuXG5cbiAgIGlmKG9wdGlvbnMuY2FudmFzKXtcbiAgIHZhciBfY2FudmFzID0gbmV3IGZhYnJpYy5TbGlkZUNhbnZhcyhkb2N1bWVudC5nZXRFbGVtZW50QnlJZChvcHRpb25zLmNhbnZhcykpO1xuICAgX2NhbnZhcy5hcHBsaWNhdGlvbiA9IHRoaXMuYXBwbGljYXRpb247XG4gICBfY2FudmFzLnByb2plY3QgPSB0aGlzO1xuICAgdGhpcy5zZXRDYW52YXMoX2NhbnZhcyk7XG4gICB9XG5cbiAgIHJldHVybiB0aGlzO1xuICAgfSwqL1xuICBzZXRTbGlkZXM6IGZ1bmN0aW9uICh2YWx1ZSwgY2FsbGJhY2spIHtcblxuICAgIGZhYnJpYy51dGlsLmRhdGEubG9hZEpzb24odmFsdWUsIHNsaWRlcyA9PiB7XG5cbiAgICAgIHRoaXMuc2xpZGVzID0gW107XG5cbiAgICAgIGlmICh0aGlzLmNhbnZhcykge1xuICAgICAgICB0aGlzLmNhbnZhcy5fb2JqZWN0cy5sZW5ndGggPSAwO1xuICAgICAgfVxuXG4gICAgICBzbGlkZXMuZm9yRWFjaChzbGlkZSA9PiB0aGlzLmFkZFNsaWRlKHNsaWRlKSk7XG5cbiAgICAgIHRoaXMucHJlbG9hZCgpO1xuICAgICAgdGhpcy5sYXp5TG9hZCgpO1xuICAgICAgY2FsbGJhY2soKTtcbiAgICB9LCgpID0+IHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJzbGlkZXMgbG9hZGluZyBmYWlsZWRcIilcbiAgICB9KTtcblxuXG4gIH0sXG4gIHNldEFjdGl2ZVNsaWRlOiBmdW5jdGlvbihzbGlkZUlkKXtcblxuICAgIGxldCBzbGlkZTtcblxuICAgIGlmKCF0aGlzLnNsaWRlcyl7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGlmKHNsaWRlSWQuY29uc3RydWN0b3IgPT09IE51bWJlcil7XG4gICAgICBzbGlkZSA9IHRoaXMuc2xpZGVzW3NsaWRlSWRdO1xuICAgIH1cbiAgICBlbHNlIGlmKHNsaWRlSWQuY29uc3RydWN0b3IgPT09IFN0cmluZyl7XG5cbiAgICB9ZWxzZXtcbiAgICAgIHNsaWRlID0gc2xpZGVJZDtcbiAgICB9XG5cbiAgICBpZih0aGlzLmNhbnZhcy5wcm9jZXNzaW5nKXJldHVybjtcbiAgICBpZih0aGlzLmFjdGl2ZVNsaWRlID09PSBzbGlkZSlyZXR1cm47XG5cbiAgICB0aGlzLmZpcmUoXCJzbGlkZTpjaGFuZ2U6YmVnaW5cIiwge2NhbnZhczogdGhpcy5jYW52YXN9KTtcbiAgICBpZih0aGlzLmFjdGl2ZVNsaWRlKSB7XG4gICAgICBkZWxldGUgdGhpcy5hY3RpdmVTbGlkZS5jYW52YXMubWlycm9yU2xpZGU7XG4gICAgfVxuXG4gICAgdGhpcy5wcm9jZXNzaW5nID10cnVlO1xuICAgIGlmICh0aGlzLnVubG9hZFVuYWN0aXZlU2xpZGVzICYmIHRoaXMuY2FudmFzICYmIHRoaXMuYWN0aXZlU2xpZGUpIHtcbiAgICAgIGRlbGV0ZSB0aGlzLmFjdGl2ZVNsaWRlLmNhbnZhcztcbiAgICAgIHRoaXMuYWN0aXZlU2xpZGUuZmlyZShcImNhbnZhczpjaGFuZ2VkXCIse2NhbnZhczogbnVsbH0pO1xuICAgICAgdGhpcy5hY3RpdmVTbGlkZS5kYXRhID0gdGhpcy5jYW52YXMudG9PYmplY3QoKTtcbiAgICAgIHRoaXMuY2FudmFzLmNsZWFyKCk7XG4gICAgfVxuICAgIHRoaXMuYWN0aXZlU2xpZGUgPSBzbGlkZTtcbiAgICB0aGlzLmFjdGl2ZVNsaWRlLmNhbnZhcy5taXJyb3JTbGlkZSA9IHRoaXMuY2FudmFzO1xuXG5cblxuICAgIHRoaXMuY2FudmFzLnByb2Nlc3NpbmcgPSB0cnVlO1xuICAgIHRoaXMuY2FudmFzLnNldFNsaWRlKHRoaXMuYWN0aXZlU2xpZGUpO1xuICAgIHRoaXMuZmlyZShcInNsaWRlOmNoYW5nZWRcIiwge2NhbnZhczogdGhpcy5jYW52YXN9KTtcbiAgICB0aGlzLmNhbnZhcy5wcm9jZXNzaW5nID0gZmFsc2U7XG4gICAgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG5cbiAgICBpZih0aGlzLmFjdGl2ZVNsaWRlLmNhbnZhcy5sb2FkZWQpe1xuICAgIH1cbiAgICAvL3RoaXMuYWN0aXZlU2xpZGUuY2FudmFzLmxvYWQoc2xpZGUub2JqZWN0LCBmdW5jdGlvbiAoKSB7XG5cblxuICB9LFxuICB1bmxvYWRVbmFjdGl2ZVNsaWRlczogZmFsc2UsXG4gIGxhenlMb2FkRW5hYmxlZDogdHJ1ZSxcbiAgbGF6eUxvYWQ6IGZ1bmN0aW9uKCl7XG5cbiAgICB2YXIgYXBwID0gdGhpcztcbiAgICBpZih0aGlzLmxhenlMb2FkRW5hYmxlZCl7XG4gICAgICB0aGlzLnNsaWRlcy5mb3JFYWNoKGZ1bmN0aW9uKHNsaWRlKXtcbiAgICAgICAgaWYoIXNsaWRlLmNhbnZhcy5sb2FkZWQgJiYgIXNsaWRlLmNhbnZhcy5wcm9jZXNzaW5nKXtcbiAgICAgICAgICBzbGlkZS5jYW52YXMubG9hZChzbGlkZS5vYmplY3QsZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHNsaWRlLmZpcmUoXCJsb2FkZWRcIik7XG4gICAgICAgICAgICAvLyBpZihhcHAuYWN0aXZlU2xpZGUgPT09IHNsaWRlLmlkKXtcbiAgICAgICAgICAgIC8vICAgdGhpcy5zZXRBY3RpdmVTbGlkZShzbGlkZSk7XG4gICAgICAgICAgICAvLyB9XG5cbiAgICAgICAgICAgIGFwcC5maXJlKFwic2xpZGU6bG9hZGluZzplbmRcIiwge3RhcmdldDogdGhpc30pO1xuXG4gICAgICAgICAgICBmb3IodmFyIF9zIGluIGFwcC5zbGlkZXMpe1xuICAgICAgICAgICAgICBpZighYXBwLnNsaWRlc1tfc10uY2FudmFzLmxvYWRlZCl7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBhcHAuZmlyZShcImxvYWRpbmc6ZW5kXCIsIHt9KTtcbiAgICAgICAgICB9LmJpbmQoc2xpZGUpKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfWVsc2V7XG4gICAgICBhcHAuZmlyZShcImxvYWRpbmc6ZW5kXCIse30pO1xuICAgIH1cbiAgfSxcbiAgYWRkU2xpZGU6IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgdmFyIHNsaWRlID0gbmV3IGZhYnJpYy5TbGlkZSh0aGlzLCBvcHRpb25zKTtcbiAgICB0aGlzLnNsaWRlcy5wdXNoKHNsaWRlKTtcbiAgICByZXR1cm4gc2xpZGU7XG4gIH0sXG4gIHJlbW92ZVNsaWRlOiBmdW5jdGlvbiAoc2xpZGUpIHtcbiAgICB2YXIgX3MgPSB0aGlzLnNsaWRlcztcbiAgICB2YXIgX2N1clBvcyA9IF9zLmluZGV4T2Yoc2xpZGUpO1xuICAgIF9zLnNwbGljZShfY3VyUG9zLCAxKTtcblxuICAgIGlmKCBzbGlkZSA9PT0gdGhpcy5hY3RpdmVTbGlkZSApe1xuICAgICAgZGVsZXRlIHRoaXMuYWN0aXZlU2xpZGUgO1xuICAgIH1cbiAgfSxcbiAgLyoqXG4gICAqIG1vdmUgc2xpZGUgdG8gYW5vdGhlciBwb3NpdGlvblxuICAgKiBAcGFyYW0gc2xpZGVcbiAgICogQHBhcmFtIG5ld1Bvc2l0aW9uXG4gICAqL1xuICBtb3ZlU2xpZGU6IGZ1bmN0aW9uIChzbGlkZSxuZXdQb3NpdGlvbikge1xuICAgIHZhciBfcyA9IHRoaXMuc2xpZGVzO1xuXG4gICAgdmFyIF9jdXJQb3MgPSBfcy5pbmRleE9mKHNsaWRlKTtcbiAgICBuZXdQb3NpdGlvbiA9IHBhcnNlSW50KG5ld1Bvc2l0aW9uKTtcblxuICAgIGlmIChfY3VyUG9zIDwgbmV3UG9zaXRpb24pIHtcbiAgICAgIF9zLnNwbGljZShfY3VyUG9zLCAxKTtcbiAgICAgIF9zLnNwbGljZShuZXdQb3NpdGlvbiwwLCBzbGlkZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIF9zLnNwbGljZShfY3VyUG9zLCAxKTtcbiAgICAgIF9zLnNwbGljZShuZXdQb3NpdGlvbiwgMCwgc2xpZGUpO1xuICAgIH1cbiAgfSxcbiAgLyoqXG4gICAqIHJlcGxhY2Ugc2xpZGVcbiAgICogQHBhcmFtIHNsaWRlXG4gICAqIEBwYXJhbSBuZXdQb3NpdGlvbiAtIHBvc2l0aW9uIG9mIHRoZSBzZWNvbmQgc2xpZGVcbiAgICovXG4gIHJlcGxhY2VTbGlkZTogZnVuY3Rpb24gKHNsaWRlLG5ld1Bvc2l0aW9uKSB7XG4gICAgdmFyIF9zID0gdGhpcy5zbGlkZXM7XG4gICAgdmFyIF9yZXBsYWNlZFNsaWRlID0gX3NbbmV3UG9zaXRpb25dO1xuICAgIHZhciBfY3VyUG9zID0gX3MuaW5kZXhPZihzbGlkZSk7XG4gICAgaWYgKF9jdXJQb3MgPCBuZXdQb3NpdGlvbikge1xuICAgICAgX3Muc3BsaWNlKG5ld1Bvc2l0aW9uLCAxLCBzbGlkZSk7XG4gICAgICBfcy5zcGxpY2UoX2N1clBvcywgMSwgX3JlcGxhY2VkU2xpZGUpO1xuICAgIH0gZWxzZSB7XG4gICAgICBfcy5zcGxpY2UoX2N1clBvcywgMSwgX3JlcGxhY2VkU2xpZGUpO1xuICAgICAgX3Muc3BsaWNlKG5ld1Bvc2l0aW9uLCAxLCBzbGlkZSk7XG4gICAgfVxuICB9LFxuXG4gIHByZWxvYWQ6IGZ1bmN0aW9uKCl7XG4gICAgZm9yKHZhciBpIGluIHRoaXMuc2xpZGVzKSB7XG4gICAgICB2YXIgX3NsaWRlID0gdGhpcy5zbGlkZXNbaV07XG4gICAgICAvLyBfc2xpZGUuY2FudmFzLnByZWxvYWQoX3NsaWRlLm9iamVjdCwgZnVuY3Rpb24gKCkge1xuICAgICAgLy8gICBfc2xpZGUuZmlyZShcIm1vZGlmaWVkXCIpO1xuICAgICAgLy8gfSk7XG4gICAgfVxuICB9LFxuXG4gIHNldEFjdGl2ZVNsaWRlQnlJbmRleDogZnVuY3Rpb24oaW5kZXgpe1xuICAgIHRoaXMuc2V0QWN0aXZlU2xpZGUodGhpcy5zbGlkZXNbaW5kZXhdKVxuICB9LFxuICBzZXRBY3RpdmVTbGlkZUJ5SWQ6IGZ1bmN0aW9uKGlkKXtcbiAgICB0aGlzLnNldEFjdGl2ZVNsaWRlKCAgZmFicmljLnV0aWwub2JqZWN0LmZpbmRXaGVyZSh0aGlzLnNsaWRlcyx7aWQ6IGlkfSkpO1xuICB9LFxuICBkdXBsaWNhdGVTbGlkZTogZnVuY3Rpb24gKHNsaWRlRGF0YSkge1xuICAgIHNsaWRlRGF0YSA9IHNsaWRlRGF0YS5jYW52YXMudG9PYmplY3QoKTtcbiAgICB2YXIgX3NsaWRlID0gdGhpcy5hZGRTbGlkZShzbGlkZURhdGEpO1xuICAgIF9zbGlkZS5jYW52YXMubG9hZChfc2xpZGUub2JqZWN0KTtcbiAgfSxcblxuICBuZXh0U2xpZGU6IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgaSA9IHRoaXMuc2xpZGVzLmluZGV4T2YodGhpcy5hY3RpdmVTbGlkZSk7XG4gICAgaWYgKGkgPCB0aGlzLnNsaWRlcy5sZW5ndGggLSAxKSB7XG4gICAgICB0aGlzLnNldEFjdGl2ZVNsaWRlKGkgKyAxKTtcbiAgICB9XG4gIH0sXG4gIHByZXZTbGlkZTogZnVuY3Rpb24gKCkge1xuICAgIHZhciBpID0gdGhpcy5zbGlkZXMuaW5kZXhPZih0aGlzLmFjdGl2ZVNsaWRlKTtcbiAgICBpZiAoaSA+IDApIHtcbiAgICAgIHRoaXMuc2V0QWN0aXZlU2xpZGUoaSAtIDEpO1xuICAgIH1cbiAgfSxcbiAgZ290b1NsaWRlOiBmdW5jdGlvbiAoc2xpZGUpIHtcbiAgICB0aGlzLnNldEFjdGl2ZVNsaWRlKHNsaWRlIC0gMSk7XG4gIH0sXG4gIG5leHRTbGlkZUF2YWlsYWJsZTogZnVuY3Rpb24gKCkge1xuICAgIHZhciBpID0gdGhpcy5zbGlkZXMuaW5kZXhPZih0aGlzLmFjdGl2ZVNsaWRlKTtcbiAgICByZXR1cm4gaSA8IHRoaXMuc2xpZGVzLmxlbmd0aCAtIDFcbiAgfSxcbiAgcHJldlNsaWRlQXZhaWxhYmxlOiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGkgPSB0aGlzLnNsaWRlcy5pbmRleE9mKHRoaXMuYWN0aXZlU2xpZGUpO1xuICAgIHJldHVybiBpID4gMFxuICB9LFxuICBjcmVhdGVTbGlkZXNMaXN0OiBmdW5jdGlvbiAoJGNvbnRhaW5lcikge1xuICAgIGxldCAkc2xpZGVMaXN0ID0gdGhpcy4kc2xpZGVzTGlzdCA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcInNsaWRlcy1saXN0XCIpO1xuICAgIGxldCAkc2xpZGVMaXN0SW5uZXIgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJzbGlkZXMtbGlzdC1pbm5lclwiKTtcbiAgICAkc2xpZGVMaXN0LmFwcGVuZCgkc2xpZGVMaXN0SW5uZXIpO1xuXG4gICAgJGNvbnRhaW5lci5hcHBlbmQodGhpcy4kc2xpZGVzTGlzdCk7XG5cblxuICAgIHRoaXMuc2xpZGVzLmZvckVhY2goc2xpZGUgPT4ge1xuICAgICAgbGV0ICRlbGVtZW50ID0gc2xpZGUuY2FudmFzLmxvd2VyQ2FudmFzRWw7XG4gICAgICAkZWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJoZWlnaHRcIiwxNTApO1xuICAgICAgZmFicmljLnV0aWwuY3JlYXRlVGh1bWIoc2xpZGUsJGVsZW1lbnQpO1xuXG4gICAgICBsZXQgJHNsaWRlID0gJChcIjxkaXY+XCIpXG4gICAgICAgIC5hZGRDbGFzcyhcInNsaWRlXCIpXG4gICAgICAgIC5jbGljaygoKSA9PiB0aGlzLnNldEFjdGl2ZVNsaWRlKHNsaWRlKSlcbiAgICAgICAgLmFwcGVuZCgkZWxlbWVudClcbiAgICAgICAgLmFwcGVuZCgkKFwiPHNwYW4+XCIpLmh0bWwoc2xpZGUuY2FudmFzLnRpdGxlKSk7XG5cblxuICAgICAgaWYoc2xpZGUuY2FudmFzLmRlc2NyaXB0aW9uKXtcbiAgICAgICAgJHNsaWRlLmF0dHIoXCJ0aXRsZVwiLHNsaWRlLmNhbnZhcy5kZXNjcmlwdGlvbilcbiAgICAgIH1cblxuICAgICAgc2xpZGUub24oXCJtb2RpZmllZFwiLGZ1bmN0aW9uKCl7XG4gICAgICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgICAgfSk7XG4gICAgICAkc2xpZGVMaXN0SW5uZXIuYXBwZW5kKCRzbGlkZSk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgbGlzdDogJHNsaWRlTGlzdFxuICAgIH1cblxuICAgIC8vdGhpcy5jYW52YXMub24oIFwiZGltZW5zaW9uczptb2RpZmllZFwiICx0aGlzLnVwZGF0ZVRodW1icy5iaW5kKHRoaXMpKVxuICAgIC8vdGhpcy51cGRhdGVUaHVtYnMoKTtcbiAgfSxcblxuICB1cGRhdGVUaHVtYnM6IGZ1bmN0aW9uKCl7XG4gICAgdGhpcy5zbGlkZXMuZm9yRWFjaChzbGlkZSA9PiB7XG4gICAgICBzbGlkZS5jYW52YXMuc2V0RGltZW5zaW9ucyh7d2lkdGg6IHRoaXMuY2FudmFzLndpZHRoLCBoZWlnaHQ6IHRoaXMuY2FudmFzLmhlaWdodH0pXG4gICAgfSlcbiAgfSxcbn0pO1xuXG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLlNsaWRlQ2FudmFzLnByb3RvdHlwZSwge1xuICB0aXRsZTogXCJOZXcgU2xpZGVcIixcbiAgLyoqXG4gICAqIENvcHkgdGhlIGNvbnRlbnQgb2YgYWN0aXZlIHNsaWRlIHRvIG1haW4gY2FudmFzLlxuICAgKiBAcGFyYW0gc2xpZGVcbiAgICovXG4gIHNldFNsaWRlOiBmdW5jdGlvbiAoc2xpZGUpIHtcblxuICAgIHRoaXMubG9hZGVkID0gZmFsc2U7XG4gICAgdGhpcy5fb2JqZWN0cyA9IFtdO1xuXG4gICAgdGhpcy5zZXQoc2xpZGUuY2FudmFzLnRvT2JqZWN0U3luYygpKTtcbiAgICB0aGlzLnNsaWRlID0gc2xpZGU7XG4gICAgdmFyIHNjID0gc2xpZGUuY2FudmFzO1xuXG4gICAgc2MuX29iamVjdHMgPSB0aGlzLl9vYmplY3RzO1xuXG4gICAgdGhpcy5kaXNjYXJkQWN0aXZlR3JvdXAoKTtcbiAgICB0aGlzLmRpc2NhcmRBY3RpdmVPYmplY3QoKTtcbiAgICAvKlxuICAgIC8vIHRoaXMuc2xpZGVXaWR0aCA9IHNjLnNsaWRlV2lkdGg7XG4gICAgLy8gdGhpcy5zbGlkZUhlaWdodCA9IHNjLnNsaWRlSGVpZ2h0O1xuICAgIHRoaXMuc2V0T3JpZ2luYWxTaXplKHt3aWR0aDogc2Mub3JpZ2luYWxXaWR0aCB8fCBzYy53aWR0aCwgaGVpZ2h0OiBzYy5vcmlnaW5hbEhlaWdodCB8fCBzYy5oZWlnaHR9KVxuICAgIHRoaXMuYmFja2dyb3VuZEltYWdlID0gc2MuYmFja2dyb3VuZEltYWdlO1xuICAgIHRoaXMuYmFja2dyb3VuZENvbG9yID0gc2MuYmFja2dyb3VuZENvbG9yO1xuXG4gICAgaWYodGhpcy5yZXNpemFibGUpIHtcbiAgICAgIHRoaXMub3JpZ2luYWxXaWR0aCAgPSBzYy5vcmlnaW5hbFdpZHRoO1xuICAgICAgdGhpcy5vcmlnaW5hbEhlaWdodCAgPSBzYy5vcmlnaW5hbEhlaWdodCA7XG4gICAgfWVsc2V7XG4gICAgICB0aGlzLnNldFdpZHRoKChzYy5vcmlnaW5hbFdpZHRoIHx8IHNjLndpZHRoKSogdGhpcy52aWV3cG9ydFRyYW5zZm9ybVswXSk7XG4gICAgICB0aGlzLnNldEhlaWdodCgoc2Mub3JpZ2luYWxIZWlnaHQgfHwgc2MuaGVpZ2h0KSAgKiB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzBdKTtcbiAgICB9Ki9cbiAgICB0aGlzLl9vblJlc2l6ZSgpO1xuICAgLy8gdGhpcy5hY3RpdmVBcmVhID0gc2MuYWN0aXZlQXJlYTtcbiAgICAvL3RoaXMub3JpZ2luYWxTbGlkZSA9IHNjO1xuXG4gICAvLyB0aGlzLnRlbXBsYXRlID0gc2MudGVtcGxhdGU7XG4gIC8vICB0aGlzLm9mZnNldHMgPSBzYy5vZmZzZXRzO1xuICAgIC8vIHRoaXMuX29iamVjdHMgPSBbXTtcbiAgICAvLyB0aGlzLmxheWVycyA9IHNjLmxheWVycztcblxuICAgLyogaWYodGhpcy5iYWNrZ3JvdW5kSW1hZ2Upe1xuICAgICAgdGhpcy5iYWNrZ3JvdW5kSW1hZ2UuY2FudmFzID0gdGhpcztcbiAgICB9Ki9cbiAgICAvL3RvZG9cbiAgICAvLyBpZih0aGlzLl9iYWNrZ3JvdW5kTGF5ZXIpIHtcbiAgICAvLyAgIGZvciAodmFyIGkgaW4gdGhpcy5fYmFja2dyb3VuZExheWVyKSB7XG4gICAgLy8gICAgIHRoaXMuX2JhY2tncm91bmRMYXllcltpXS5jYW52YXMgPSB0aGlzO1xuICAgIC8vICAgICB0aGlzLl9iYWNrZ3JvdW5kTGF5ZXJbaV0uc2V0Q29vcmRzKCk7XG4gICAgLy8gICB9XG4gICAgLy8gICB0aGlzLnNldEFjdGl2ZUFyZWEodHJ1ZSk7XG4gICAgLy8gfWNkIGZpZXJcblxuICAgIC8qZm9yKHZhciBsYXllck5hbWUgaW4gc2MubGF5ZXJzKSB7XG4gICAgICB0aGlzLmxheWVyc1tsYXllck5hbWVdLm9iamVjdHMgPSBbXTtcbiAgICB9Ki9cbiAgIC8vIHRoaXMuX29iamVjdHMgPSB0aGlzLl9vYmplY3RzO1xuXG4gICAgLyppZihzYy5sYXllcnMpIHtcbiAgICAgIGZvcih2YXIgbGF5ZXJOYW1lIGluIHNjLmxheWVycyl7XG4gICAgICAgIGZvciAodmFyIGkgaW4gc2MubGF5ZXJzW2xheWVyTmFtZV0ub2JqZWN0cykge1xuICAgICAgICAgIHRoaXMuYWRkKHNjLmxheWVyc1tsYXllck5hbWVdLm9iamVjdHNbaV0pO1xuICAgICAgICB9XG4gICAgICAgIHNjLmxheWVyc1tsYXllck5hbWVdLm9iamVjdHMgPSB0aGlzLmxheWVyc1tsYXllck5hbWVdLm9iamVjdHM7XG4gICAgICB9XG4gICAgICBzYy5fb2JqZWN0cyA9IHRoaXMuX29iamVjdHM7XG4gICAgfWVsc2V7Ki9cblxuICAgIC8qdGhpcy5fb2JqZWN0cyA9IFtdO1xuICAgIGZvciAobGV0IGkgaW4gc2MuX29iamVjdHMpIHtcbiAgICAgIHRoaXMuYWRkKHNjLl9vYmplY3RzW2ldKTtcbiAgICB9Ki9cbiAgIC8vIH1cblxuICAgIHRoaXMubG9hZGVkID0gdHJ1ZTtcbiAgICB0aGlzLmZpcmUoJ2NoYW5nZWQnLCB7dGFyZ2V0OiBzY30pXG5cblxuICB9LFxuICB1bmlxdWU6IGZhbHNlLFxuICByZXF1aXJlZDogZmFsc2UsXG4gIHN0YXRlUHJvcGVydGllczogW1widW5pcXVlXCIsXCJyZXF1aXJlZFwiXSxcbiAgcmVtb3ZlU2xpZGU6IGZ1bmN0aW9uKCl7XG4gICAgdGhpcy5wcm9qZWN0LnJlbW92ZVNsaWRlKHRoaXMpXG4gIH0sXG4gIGR1cGxpY2F0ZVNsaWRlOiBmdW5jdGlvbigpe1xuICAgIHRoaXMucHJvamVjdC5kdXBsaWNhdGVTbGlkZSh0aGlzKVxuICB9LFxuXG4gIGV2ZW50TGlzdGVuZXJzOiBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kQXJyYXlzT2JqZWN0KGZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUuZXZlbnRMaXN0ZW5lcnMsIHtcbiAgICBcIm1vZGlmaWVkXCIgOiBmdW5jdGlvbihlKXtcbiAgICAgIGlmKHRoaXMuc2xpZGUpe1xuICAgICAgICB0aGlzLnNsaWRlLmNhbnZhcy5zZXQoZS5zdGF0ZXMubW9kaWZpZWQpO1xuICAgICAgICB0aGlzLnNsaWRlLmZpcmUoXCJtb2RpZmllZFwiKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIFwib2JqZWN0Om1vZGlmaWVkXCIgOiBmdW5jdGlvbigpe1xuICAgICAgaWYodGhpcy5zbGlkZSl7XG4gICAgICAgIHRoaXMuc2xpZGUuZmlyZShcIm1vZGlmaWVkXCIpO1xuICAgICAgfVxuICAgIH1cbiAgfSlcbn0pO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9jb3JlL2FwcGxpY2F0aW9uLnNsaWRlcy5qcyIsIi8qKlxuICogIyBQcm90b3R5cGVzXG5cbiBQcm90b3R5cGVzIGFsbG93cyB0byBkZWZpbmUgKipwcm90b3R5cGVzKiogcHJvcGVydHkgaW4gQXBwbGljYXRpb24gY29uZmlndXJhdGlvbi5cblxuIGBgYGphdmFzY3JpcHRcbiBBcHBsaWNhdGlvbiAoe1xuICBwcm90b3R5cGVzOiB7XG4gICAgQ2xhc3NOYW1lOiBvcHRpb25zXG4gIH1cbiB9KVxuIGBgYFxuXG4gSWYgcHJvdG90eXBlIGlzIGRlZmluZWQgZXZlcnkgbmV3IE9iamVjdCBjcmVhdGVkIGJ5IGFwcGxpY2F0aW9uIHdpbGwgaGF2ZSB0aGlzIHByb3BlcnRpZXMgYnkgZGVmYXVsdC5cblxuIGBgYGphdmFzY3JpcHRcbiAgIE5ld0NsYXNzOiB7XG4gICAgJHN1cGVyOiBcIlBhcmVudENsYXNzXCIsXG4gICAgdHlwZTogXCJuZXctY2xhc3NcIixcbiAgICBcXC8qb3RoZXIgcHJvcGVydGllcyBhbmQgbWV0aG9kcypcXC9cbiAgIH1cbiAgYGBgXG5cbiBpZiBwcm9wZXJ0eSAqKnR5cGUqKiBvZiBPYmplY3QgY2xhc3MgaXMgZGVmaW5lZCB0aGVuIGV2ZXJ5IG9iamVjdCBiZSBkZWZhdWx0IHdpbGwgaGF2ZSB0aGlzIHR5cGUuXG5cbiBgYGBqYXZhc2NyaXB0XG4gICBPYmplY3Q6IHtcbiAgICB0eXBlOiBcInJlY3RhbmdsZVwiXG4gICB9XG4gLi4uXG4gLy9yZWN0YW5nbGUgd2lsbCBiZSBjcmVhdGVkXG4gZmFicmljLmNyZWF0ZU9iamVjdCh7d2lkdGg6MTAwLCBoZWlnaHQ6IDEwMH0pXG4gYGBgXG4qL1xuXG5cblxuXG5cblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuQXBwbGljYXRpb24ucHJvdG90eXBlLCB7XG4gIG9wdGlvbnNPcmRlcjogKGZ1bmN0aW9uKCl7XG4gICAgdmFyIG9vID0gZmFicmljLkFwcGxpY2F0aW9uLnByb3RvdHlwZS5vcHRpb25zT3JkZXI7XG4gICAgb28uc3BsaWNlKG9vLmluZGV4T2YoXCJjYW52YXNDb250YWluZXJcIiksMCxcInByb3RvdHlwZXNcIik7XG4gICAgcmV0dXJuIG9vO1xuICB9KSgpLFxuICBnZXREZWZhdWx0UHJvcGVydGllczogZnVuY3Rpb24ocHJvdG8pe1xuICAgIGlmKCF0aGlzLnByb3RvdHlwZXMpcmV0dXJuO1xuXG4gICAgdmFyIGtsYXNzbmFtZSA9IGZhYnJpYy51dGlsLnN0cmluZy5jYXBpdGFsaXplKGZhYnJpYy51dGlsLnN0cmluZy5jYW1lbGl6ZShwcm90by50eXBlKSx0cnVlKTtcblxuICAgIHZhciBfcHJvdG9Qcm9wZXJ0aWVzID0gcHJvdG8uX19wcm90b19fICYmIHByb3RvLl9fcHJvdG9fXy50eXBlICYmIHRoaXMuZ2V0RGVmYXVsdFByb3BlcnRpZXMocHJvdG8uX19wcm90b19fKSB8fCB7fTtcbiAgICB2YXIgX2RlZmF1bHRQcm9wZXJ0aWVzID0gZmFicmljLnV0aWwub2JqZWN0LmNsb25lKHRoaXMucHJvdG90eXBlc1trbGFzc25hbWVdKTtcblxuICAgIGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoX3Byb3RvUHJvcGVydGllcyxfZGVmYXVsdFByb3BlcnRpZXMpO1xuXG4gICAgcmV0dXJuIF9wcm90b1Byb3BlcnRpZXM7XG4gIH0sXG4gIC8qKlxuICAgKiBkZWZhdWx0IHByb3RvdHlwZXMgcHJvcGVydGVzIGZvciBvYmplY3RzXG4gICAqL1xuICBwcm90b3R5cGVzOiB7XG4gICAgT2JqZWN0OiB7XG4gICAgICBpbmNsdWRlRGVmYXVsdFZhbHVlczogZmFsc2VcbiAgICB9LFxuICAgIENhbnZhczoge1xuICAgICAgaW5jbHVkZURlZmF1bHRWYWx1ZXM6IGZhbHNlXG4gICAgfVxuICB9LFxuICBzZXRVdGlsczogZnVuY3Rpb24gKHV0aWxzT3B0aW9ucykge1xuXG4gICAgaWYoIXV0aWxzT3B0aW9ucyl7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQodGhpcy51dGlsIHx8IHt9LHV0aWxzT3B0aW9ucyk7XG5cbiAgICBpZiAodGhpcy5vcHRpb25zWyd1dGlsJ10pIHtcbiAgICAgIGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLnV0aWwsIHRoaXMub3B0aW9uc1sndXRpbCddKTtcbiAgICB9XG4gICAgaWYgKHRoaXMub3B0aW9uc1snZmFicmljJ10pIHtcbiAgICAgIGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLCB0aGlzLm9wdGlvbnNbJ2ZhYnJpYyddKTtcbiAgICB9XG4gICAgZGVsZXRlIHRoaXMub3B0aW9uc1snZmFicmljJ107XG4gICAgZGVsZXRlIHRoaXMub3B0aW9uc1sndXRpbCddO1xuICB9LFxuICBzZXRQcm90b3R5cGVzOiBmdW5jdGlvbiAocHJvdG90eXBlcykge1xuXG4gICAgdmFyIF9wcm90b3R5cGVzID0gZmFicmljLnV0aWwub2JqZWN0LmRlZXBFeHRlbmQoe30sIHRoaXMucHJvdG90eXBlcyAscHJvdG90eXBlcyk7XG5cbiAgICB0aGlzLnByb3RvdHlwZXMgPSBfcHJvdG90eXBlcztcbiAgICB0aGlzLmtsYXNzZXMgPSB7fTtcblxuXG4gICAgaWYoX3Byb3RvdHlwZXMuZXZlbnRMaXN0ZW5lcnMpe1xuICAgICAgX3Byb3RvdHlwZXMuZXZlbnRMaXN0ZW5lcnMuJGV4dGVuZCA9ICdhcnJheSc7XG4gICAgfVxuXG4gICAgZm9yICh2YXIga2xhc3NOYW1lIGluIF9wcm90b3R5cGVzKSB7XG4gICAgICB2YXIgX3Byb3RvID0gX3Byb3RvdHlwZXNba2xhc3NOYW1lXTtcblxuICAgICAgZm9yICh2YXIgaiBpbiBfcHJvdG8pIHtcbiAgICAgICAgaWYgKF9wcm90b1tqXSAmJiBfcHJvdG9bal1bXCIkZXh0ZW5kXCJdKSB7XG4gICAgICAgICAgdmFyIF9leHRlbmQgPSBfcHJvdG9bal1bXCIkZXh0ZW5kXCJdO1xuICAgICAgICAgIGlmKCBfZXh0ZW5kID09IFwiYXJyYXlcIil7XG4gICAgICAgICAgICBfcHJvdG9bal0gPSBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kQXJyYXlzT2JqZWN0KGZhYnJpY1trbGFzc05hbWVdLnByb3RvdHlwZVtqXSxfcHJvdG9bal0pO1xuICAgICAgICAgIH0gZWxzZSBpZiggX2V4dGVuZCA9PSBcImRlZXBcIil7XG4gICAgICAgICAgICBfcHJvdG9bal0gPSBmYWJyaWMudXRpbC5vYmplY3QuZGVlcEV4dGVuZChmYWJyaWNba2xhc3NOYW1lXS5wcm90b3R5cGVbal0sX3Byb3RvW2pdKTtcbiAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgIF9wcm90b1tqXSA9IGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljW2tsYXNzTmFtZV0ucHJvdG90eXBlW2pdLF9wcm90b1tqXSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGRlbGV0ZSBfcHJvdG9bal1bXCIkZXh0ZW5kXCJdO1xuICAgICAgICB9XG4gICAgICB9XG5cblxuICAgICAgaWYoX3Byb3RvW1wiJHN1cGVyXCJdKXtcbiAgICAgICAgdmFyIF9zdXBlcmtsYXNzID0gZmFicmljW19wcm90b1tcIiRzdXBlclwiXSB8fCBrbGFzc05hbWVdIDtcbiAgICAgICAgZGVsZXRlIF9wcm90b1tcIiRzdXBlclwiXTtcblxuICAgICAgICB2YXIgX2Zyb21PYmplY3QgPSBfcHJvdG8uZnJvbU9iamVjdCB8fCBfc3VwZXJrbGFzcy5mcm9tT2JqZWN0IDtcbiAgICAgICAgZGVsZXRlIF9wcm90by5mcm9tT2JqZWN0O1xuICAgICAgICB2YXIgX2tsYXNzID0gdGhpcy5rbGFzc2VzW2tsYXNzTmFtZV0gPSBmYWJyaWMudXRpbC5jcmVhdGVDbGFzcyhfc3VwZXJrbGFzcywgX3Byb3RvKTtcbiAgICAgICAgX2tsYXNzLmZyb21PYmplY3QgPSBfZnJvbU9iamVjdC5iaW5kKF9rbGFzcyk7XG4gICAgICB9XG5cbiAgICAvLyAgIGlmIChrbGFzc05hbWUuYWN0aW9ucyAmJiBfcHJvdG8uYWN0aW9ucy5jb25zdHJ1Y3RvciA9PSBGdW5jdGlvbikge1xuICAgIC8vICAgICBmYWJyaWNba2xhc3NOYW1lXS5wcm90b3R5cGUuYWN0aW9ucyA9IF9wcm90by5hY3Rpb25zLmNhbGwoZmFicmljW2tsYXNzTmFtZV0ucHJvdG90eXBlKVxuICAgIC8vICAgfVxuICAgIH1cblxuICAgIGlmIChfcHJvdG90eXBlcy5BcHBsaWNhdGlvbikge1xuICAgICAgZmFicmljLnV0aWwub2JqZWN0LmRlZXBFeHRlbmQodGhpcywgX3Byb3RvdHlwZXMuQXBwbGljYXRpb24pO1xuICAgIH1cblxuICAgIC8vIGRlbGV0ZSB0aGlzLm9wdGlvbnNbJ3Byb3RvdHlwZXMnXTtcblxuICAgIGlmICh0aGlzLmFjdGlvbnMgJiYgdGhpcy5hY3Rpb25zLmNvbnN0cnVjdG9yID09IEZ1bmN0aW9uKSB7XG4gICAgICB0aGlzLmFjdGlvbnMgPSB0aGlzLmFjdGlvbnMuY2FsbCh0aGlzKVxuICAgIH1cbiAgfSxcbiAgZXZlbnRMaXN0ZW5lcnM6IGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmRBcnJheXNPYmplY3QoZmFicmljLkFwcGxpY2F0aW9uLnByb3RvdHlwZS5ldmVudExpc3RlbmVycywge1xuICAgIFwiZW50aXR5OmNyZWF0ZWRcIjogZnVuY3Rpb24gKGUpIHtcbiAgICAgIHZhciB0YXJnZXQgPSBlLnRhcmdldDtcblxuICAgICAgdGFyZ2V0LmFwcGxpY2F0aW9uID0gdGhpcztcbiAgICAgIGZhYnJpYy51dGlsLm9iamVjdC5kZWZhdWx0cyhlLm9wdGlvbnMsIHRoaXMuZ2V0RGVmYXVsdFByb3BlcnRpZXModGFyZ2V0LCBlLm9wdGlvbnMpKTtcblxuICAgICAgZm9yICh2YXIga2V5IGluIGUub3B0aW9ucykge1xuICAgICAgICB2YXIgdmFsdWUgPSBlLm9wdGlvbnNba2V5XTtcbiAgICAgICAgaWYgKGtleVswXSA9PSBcIitcIikge1xuICAgICAgICAgIHZhciBfa2V5ID0ga2V5LnN1YnN0cigxKTtcbiAgICAgICAgICB2YXIgX2FyciA9IHRhcmdldC5nZXQoX2tleSk7XG4gICAgICAgICAgaWYgKF9hcnIgaW5zdGFuY2VvZiBBcnJheSkge1xuICAgICAgICAgICAgX2FyciA9IF9hcnIuc2xpY2UoKS5jb25jYXQodmFsdWUpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBfYXJyID0gZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCh7fSwgX2FyciwgdmFsdWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlLm9wdGlvbnNbX2tleV0gPSBfYXJyO1xuICAgICAgICAgIGRlbGV0ZSBlLm9wdGlvbnNba2V5XTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBkZWxldGUgZS5vcHRpb25zLnR5cGU7XG4gICAgICBkZWxldGUgZS5vcHRpb25zLmFwcGxpY2F0aW9uO1xuICAgIH1cbiAgfSlcbn0pO1xuXG5cblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvY29yZS9hcHBsaWNhdGlvbi5wcm90b3R5cGVzLmpzIiwiJ3VzZSBzdHJpY3QnO1xuXG52YXIgaXNWTUwgPSBmdW5jdGlvbigpIHsgcmV0dXJuIHR5cGVvZiBHX3ZtbENhbnZhc01hbmFnZXIgIT09ICd1bmRlZmluZWQnOyB9XG5cbi8vd2VpcmQgc3R1ZmZcbi8vIGRlbGV0ZSBmYWJyaWMuUmVjdC5wcm90b3R5cGUudG9PYmplY3Q7XG4vLyBmYWJyaWMuUmVjdC5wcm90b3R5cGUuc3RvcmVQcm9wZXJ0aWVzID0gW1wiKlwiLFwicnhcIixcInJ5XCJdO1xuXG5mYWJyaWMuSU5DTFVERV9BTEwgPSBcIipcIjtcblxudmFyIF90b09iamVjdF9vdmVyd3JpdHRlbiA9IGZhYnJpYy5PYmplY3QucHJvdG90eXBlLnRvT2JqZWN0O1xuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuT2JqZWN0LnByb3RvdHlwZSwge1xuICBzdG9yZVByb3BlcnRpZXM6IFsnKiddLFxuICBldmVudExpc3RlbmVyczoge30sXG4gIHRvT2JqZWN0OiBmdW5jdGlvbiAocHJvcGVydGllc1RvSW5jbHVkZSkge1xuICAgIGlmIChwcm9wZXJ0aWVzVG9JbmNsdWRlID09IGZhYnJpYy5JTkNMVURFX0FMTCkge1xuICAgICAgcHJvcGVydGllc1RvSW5jbHVkZSA9IFtmYWJyaWMuSU5DTFVERV9BTExdO1xuICAgIH1cblxuICAgIHByb3BlcnRpZXNUb0luY2x1ZGUgPSBwcm9wZXJ0aWVzVG9JbmNsdWRlIHx8IFtdO1xuICAgIHByb3BlcnRpZXNUb0luY2x1ZGUgPSBwcm9wZXJ0aWVzVG9JbmNsdWRlLmNvbmNhdCh0aGlzLnN0b3JlUHJvcGVydGllcyk7XG5cblxuICAgIHZhciBvYmogPSBfdG9PYmplY3Rfb3ZlcndyaXR0ZW4uY2FsbCh0aGlzLCBwcm9wZXJ0aWVzVG9JbmNsdWRlKTtcbiAgICBpZiAocHJvcGVydGllc1RvSW5jbHVkZVswXSAhPT0gZmFicmljLklOQ0xVREVfQUxMKSB7XG4gICAgICBpZiAoIXRoaXMuaW5jbHVkZURlZmF1bHRWYWx1ZXMpIHtcbiAgICAgICAgdGhpcy5fcmVtb3ZlRGVmYXVsdFZhbHVlcyhvYmopO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICh0aGlzLnN0b3JlUHJvcGVydGllcy5pbmRleE9mKFwiKlwiKSA9PSAtMSkge1xuICAgICAgZm9yICh2YXIgaSBpbiBvYmopIHtcbiAgICAgICAgaWYgKHRoaXMuc3RvcmVQcm9wZXJ0aWVzLmluZGV4T2YoaSkgPT0gLTEpIHtcbiAgICAgICAgICBkZWxldGUgb2JqW2ldO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5maXJlKFwiYmVmb3JlOm9iamVjdFwiLCB7b2JqZWN0OiBvYmp9KTtcbiAgICByZXR1cm4gb2JqO1xuICB9LFxuICAvKipcbiAgICogU2V0cyBvYmplY3QncyBwcm9wZXJ0aWVzIGZyb20gb3B0aW9uc1xuICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdIE9wdGlvbnMgb2JqZWN0XG4gICAqL1xuICBzZXRPcHRpb25zOiBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgIHRoaXMuX3NldE9iamVjdChvcHRpb25zKTtcbiAgICAvLyB0aGlzLl9pbml0R3JhZGllbnQob3B0aW9ucyk7XG4gICAgLy8gdGhpcy5faW5pdFBhdHRlcm4ob3B0aW9ucyk7XG4gICAgLy8gdGhpcy5faW5pdENsaXBwaW5nKG9wdGlvbnMpO1xuICB9LFxuICBfaW5pdEVudGl0eTogZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICBpZihvcHRpb25zLmNhbnZhcyAmJiAhb3B0aW9ucy5hcHBsaWNhdGlvbil7XG4gICAgICBvcHRpb25zLmFwcGxpY2F0aW9uID0gb3B0aW9ucy5jYW52YXMuYXBwbGljYXRpb247XG4gICAgfVxuICAgIG9wdGlvbnMuYXBwbGljYXRpb24gJiYgb3B0aW9ucy5hcHBsaWNhdGlvbi5maXJlKFwiZW50aXR5OmNyZWF0ZWRcIiwge3RhcmdldDogdGhpcywgb3B0aW9uczogb3B0aW9uc30pO1xuICB9LFxuICBpbml0aWFsaXplOiBmdW5jdGlvbiAob3B0aW9ucywgY2FsbGJhY2spIHtcbiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgICB0aGlzLl9pbml0RW50aXR5KG9wdGlvbnMpO1xuICAgIC8vIGlmKG9wdGlvbnMud2hvbGVDb29yZGluYXRlcyl7XG4gICAgLy8gICB2YXIgY29vcmRpbmF0ZXMgPSBbXCJsZWZ0XCIsXCJ0b3BcIixcIndpZHRoXCIsXCJoZWlnaHRcIl07XG4gICAgLy8gICBmb3IodmFyIGkgaW4gY29vcmRpbmF0ZXMpe1xuICAgIC8vICAgICBpZihvcHRpb25zW2Nvb3JkaW5hdGVzW2ldXSl7XG4gICAgLy8gICAgICAgb3B0aW9uc1tjb29yZGluYXRlc1tpXV0gPSBNYXRoLnJvdW5kKG9wdGlvbnNbY29vcmRpbmF0ZXNbaV1dKTtcbiAgICAvLyAgICAgfVxuICAgIC8vICAgfVxuICAgIC8vIH1cbiAgICB2YXIgX3NlbGYgPSB0aGlzO1xuICAgIHRoaXMuX3NldE9iamVjdChvcHRpb25zLCBmdW5jdGlvbiAoKSB7XG4gICAgICBfc2VsZi5sb2FkZWQgPSB0cnVlO1xuICAgICAgX3NlbGYuZmlyZShcImxvYWRlZFwiKTtcbiAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKF9zZWxmKTtcbiAgICB9KTtcbiAgfSxcbiAgYWRkOiBmdW5jdGlvbiAoY2FudmFzKSB7XG4gICAgY2FudmFzLmFkZCh0aGlzKTtcbiAgfSxcbiAgc2V0OiBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkge1xuICAgIGlmICh0eXBlb2Yga2V5ID09PSAnb2JqZWN0Jykge1xuICAgICAgdGhpcy5fc2V0T2JqZWN0KGtleSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgaWYgKGtleVswXSA9PSBcIiZcIikge1xuICAgICAgICBrZXkgPSBrZXkuc3Vic3RyKDEpO1xuICAgICAgICB0aGlzLl9zZXQoa2V5LCB2YWx1ZSh0aGlzLmdldChrZXkpKSk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgdGhpcy5fc2V0KGtleSwgdmFsdWUpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfVxufSk7XG5cblxuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5PYmplY3QucHJvdG90eXBlLCB7XG4gIGhhc0JvdW5kc0NvbnRyb2xzOiB0cnVlLFxuICBzdHJva2U6IFwidHJhbnNwYXJlbnRcIixcbiAgb25Ub3A6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5jYW52YXMuX29iamVjdHMuaW5kZXhPZih0aGlzKSA9PSB0aGlzLmNhbnZhcy5fb2JqZWN0cy5sZW5ndGggLSAxO1xuICB9LFxuICBmbG9wOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5mbGlwWSA9ICF0aGlzLmZsaXBZO1xuICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICB9LFxuICBmbGlwOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5mbGlwWCA9ICF0aGlzLmZsaXBYO1xuICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICB9LFxuICBvbkJvdHRvbTogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLmNhbnZhcy5fb2JqZWN0cy5pbmRleE9mKHRoaXMpID09IDA7XG4gIH0sXG4gIGR1cGxpY2F0ZTogZnVuY3Rpb24oKSB7XG4gICAgdmFyIF9vYmplY3QgPSB0aGlzLnRvT2JqZWN0KGZhYnJpYy5JTkNMVURFX0FMTCk7XG4gICAgX29iamVjdC5hY3RpdmUgPSB0cnVlO1xuICAgIF9vYmplY3QubGVmdCs9MTA7XG4gICAgX29iamVjdC50b3ArPTEwO1xuICAgIHZhciBfY2xvbmUgPSAvKnRoaXMuY2xvbmVTeW5jICYmIHRoaXMuY2xvbmVTeW5jKCkgfHwgKi90aGlzLmNhbnZhcy5jcmVhdGVPYmplY3QoX29iamVjdCk7XG4gICAgcmV0dXJuIF9jbG9uZTtcbiAgfSxcbiAgbWluU3Ryb2tlV2lkdGg6IDAsXG4gIG1heFN0cm9rZVdpZHRoOiBmdW5jdGlvbigpe1xuICAgIHJldHVybiBNYXRoLm1pbih0aGlzLndpZHRoLHRoaXMuaGVpZ2h0KSAvIDI7XG4gIH0sXG4gIGFjdGlvbnM6IHtcbiAgICBib3VuZGluZ1JlY3Q6IHtcbiAgICAgIHR5cGU6ICdsYWJlbCcsXG4gICAgICB0ZW1wbGF0ZTogJzxkdD5MOjwvZHQ+PGRkIGNsYXNzPVwie2xlZnRDbGFzc31cIiB0aXRsZT1cIntsZWZ0fVwiPntyb3VuZExlZnR9PC9kZD48ZHQ+VDo8L2R0PjxkZCBjbGFzcz1cInt0b3BDbGFzc31cIiAgdGl0bGU9XCJ7dG9wfVwiPntyb3VuZFRvcH08L2RkPjxkdD5SOjwvZHQ+PGRkIGNsYXNzPVwie3JpZ2h0Q2xhc3N9XCIgdGl0bGU9XCJ7cmlnaHR9XCI+e3JvdW5kUmlnaHR9PC9kZD48ZHQ+Qjo8L2R0PjxkZCBjbGFzcz1cIntib3R0b21DbGFzc31cIiAgdGl0bGU9XCJ7Ym90dG9tfVwiPntyb3VuZEJvdHRvbX08L2RkPicsXG4gICAgICB2YWx1ZToge1xuICAgICAgICBvYnNlcnZlOiBcIm1vZGlmaWVkIHNjYWxpbmcgbW92aW5nIHJvdGF0aW5nXCIsXG4gICAgICAgIGdldDogZnVuY3Rpb24oKXtcbiAgICAgICAgICB2YXIgX3JlY3QgPSB0aGlzLmdldEJvdW5kaW5nUmVjdCgpO1xuXG4gICAgICAgICAgaWYodGhpcy5tb3ZlbWVudExpbWl0cykge1xuXG4gICAgICAgICAgICBpZiAodGhpcy5tb3ZlbWVudExpbWl0cyA9PSB0aGlzLmNhbnZhcykge1xuICAgICAgICAgICAgICB2YXIgX3YgPSB0aGlzLmNhbnZhcy52aWV3cG9ydFRyYW5zZm9ybTtcbiAgICAgICAgICAgICAgdmFyIF9tbHIgPSB7XG4gICAgICAgICAgICAgICAgbGVmdDogX3ZbNF0sXG4gICAgICAgICAgICAgICAgdG9wOiBfdls1XSxcbiAgICAgICAgICAgICAgICB3aWR0aDogKHRoaXMuY2FudmFzLm9yaWdpbmFsV2lkdGggfHwgdGhpcy5jYW52YXMud2lkdGgpICogX3ZbMF0sXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiAodGhpcy5jYW52YXMub3JpZ2luYWxIZWlnaHQgfHwgdGhpcy5jYW52YXMuaGVpZ2h0KSAgKiBfdlszXSxcbiAgICAgICAgICAgICAgICByaWdodDogMCxcbiAgICAgICAgICAgICAgICBib3R0b206IDBcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgIF9tbHIgPSB0aGlzLm1vdmVtZW50TGltaXRzLmdldEJvdW5kaW5nUmVjdCgpO1xuICAgICAgICAgICAgfVxuXG5cbiAgICAgICAgICAgIF9yZWN0LmJvdHRvbSA9IHRoaXMubW92ZW1lbnRMaW1pdHMuaGVpZ2h0IC0gX3JlY3QuaGVpZ2h0O1xuICAgICAgICAgICAgdmFyIF90ID0gX3JlY3QudG9wIC0gX21sci50b3A7XG4gICAgICAgICAgICB2YXIgX2wgPSBfcmVjdC5sZWZ0IC0gX21sci5sZWZ0O1xuICAgICAgICAgICAgdmFyIF9yID0gX21sci53aWR0aCAtIF9yZWN0LndpZHRoIC0gX2w7XG4gICAgICAgICAgICB2YXIgX2IgPSBfbWxyLmhlaWdodCAtIF9yZWN0LmhlaWdodCAtIF90O1xuICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgX3QgPSBfcmVjdC50b3A7XG4gICAgICAgICAgICBfbCA9IF9yZWN0LmxlZnQ7XG4gICAgICAgICAgICBfYiA9IHRoaXMuY2FudmFzLmhlaWdodCAtIF9yZWN0LmhlaWdodCAtIF9yZWN0LnRvcDtcbiAgICAgICAgICAgIF9yICA9IHRoaXMuY2FudmFzLndpZHRoIC0gX3JlY3Qud2lkdGggLSBfcmVjdC5sZWZ0O1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0b3BDbGFzczogX3QgPiAwID8gXCJwb3NpdGl2ZVwiIDogX3QgPCAwID8gXCJuZWdhdGl2ZVwiIDogXCJ6ZXJvXCIsXG4gICAgICAgICAgICBib3R0b21DbGFzczogX2IgPiAwID8gXCJwb3NpdGl2ZVwiIDogX2IgPCAwID8gXCJuZWdhdGl2ZVwiIDogXCJ6ZXJvXCIsXG4gICAgICAgICAgICBsZWZ0Q2xhc3M6IF9sID4gMCA/IFwicG9zaXRpdmVcIiA6IF9sIDwgMCA/IFwibmVnYXRpdmVcIiA6IFwiemVyb1wiLFxuICAgICAgICAgICAgcmlnaHRDbGFzczogX3IgPiAwID8gXCJwb3NpdGl2ZVwiIDogX3IgPCAwID8gXCJuZWdhdGl2ZVwiIDogXCJ6ZXJvXCIsXG4gICAgICAgICAgICB0b3A6ICAgIF90LFxuICAgICAgICAgICAgbGVmdDogICBfbCxcbiAgICAgICAgICAgIGJvdHRvbTogX2IsXG4gICAgICAgICAgICByaWdodDogIF9yLFxuICAgICAgICAgICAgcm91bmRUb3A6ICAgIE1hdGgucm91bmQoX3QpLFxuICAgICAgICAgICAgcm91bmRMZWZ0OiAgIE1hdGgucm91bmQoX2wpLFxuICAgICAgICAgICAgcm91bmRCb3R0b206IE1hdGgucm91bmQoX2IpLFxuICAgICAgICAgICAgcm91bmRSaWdodDogIE1hdGgucm91bmQoX3IpXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcbiAgICBwb3NpdGlvbjoge1xuICAgICAgdGl0bGU6ICdwb3NpdGlvbicsXG4gICAgICB0eXBlOiAnbWVudScsXG4gICAgICBtZW51OiB7XG4gICAgICAgIG9iamVjdExlZnQ6IHtcbiAgICAgICAgICB0eXBlOiAgICdudW1iZXInLFxuICAgICAgICAgIHRpdGxlOiAgJ2xlZnQnLFxuICAgICAgICAgIHZhbHVlOiB7XG4gICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2YWwpIHtcbiAgICAgICAgICAgICAgdGhpcy5sZWZ0ID0gdmFsO1xuICAgICAgICAgICAgICB0aGlzLmZpcmUoXCJtb2RpZmllZFwiKTtcbiAgICAgICAgICAgICAgdGhpcy5jYW52YXMuZmlyZShcIm9iamVjdDptb2RpZmllZFwiLCB7dGFyZ2V0OiB0aGlzfSk7XG4gICAgICAgICAgICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICByZXR1cm4gdGhpcy5sZWZ0O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9ic2VydmU6IFwibW9kaWZpZWRcIlxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgb2JqZWN0VG9wOiB7XG4gICAgICAgICAgdHlwZTogICAnbnVtYmVyJyxcbiAgICAgICAgICB0aXRsZTogICd0b3AnLFxuICAgICAgICAgIHZhbHVlOiB7XG4gICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2YWwpIHtcbiAgICAgICAgICAgICAgdGhpcy50b3AgPSB2YWw7XG4gICAgICAgICAgICAgIHRoaXMuZmlyZShcIm1vZGlmaWVkXCIpO1xuICAgICAgICAgICAgICB0aGlzLmNhbnZhcy5maXJlKFwib2JqZWN0Om1vZGlmaWVkXCIsIHt0YXJnZXQ6IHRoaXN9KTtcbiAgICAgICAgICAgICAgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIHJldHVybiB0aGlzLnRvcDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvYnNlcnZlOiBcIm1vZGlmaWVkXCJcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuICAgIGRpbWVuc2lvbnM6IHtcbiAgICAgIHRpdGxlOiAnZGltZW5zaW9ucycsXG4gICAgICB0eXBlOiAnbWVudScsXG4gICAgICBtZW51OntcbiAgICAgICAgb2JqZWN0V2lkdGg6IHtcbiAgICAgICAgICB0eXBlOiAgICdudW1iZXInLFxuICAgICAgICAgIHRpdGxlOiAgJ3dpZHRoJyxcbiAgICAgICAgICB2YWx1ZToge1xuICAgICAgICAgICAgc2V0OiBmdW5jdGlvbih2YWwpe1xuICAgICAgICAgICAgICB0aGlzLnNhdmVTdGF0ZSgpO1xuICAgICAgICAgICAgICB0aGlzLmRpbWVuc2lvbnNXaWR0aFZhbHVlID0gdmFsO1xuICAgICAgICAgICAgICB0aGlzLnNjYWxlVG9XaWR0aCh2YWwgKiAgdGhpcy5jYW52YXMuZ2V0Wm9vbSgpKTtcbiAgICAgICAgICAgICAgdGhpcy5jYW52YXMuZmlyZU1vZGlmaWVkSWZDaGFuZ2VkKHRoaXMpO1xuICAgICAgICAgICAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuZGltZW5zaW9uc1dpZHRoVmFsdWU7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICBpZih0aGlzLmRpbWVuc2lvbnNXaWR0aFZhbHVlKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5kaW1lbnNpb25zV2lkdGhWYWx1ZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICByZXR1cm4gTWF0aC5yb3VuZCh0aGlzLmdldEJvdW5kaW5nUmVjdCgpLndpZHRoIC8gdGhpcy5jYW52YXMuZ2V0Wm9vbSgpKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvYnNlcnZlOiBcIm1vZGlmaWVkXCJcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIG9iamVjdEhlaWdodDoge1xuICAgICAgICAgIHR5cGU6ICAgJ251bWJlcicsXG4gICAgICAgICAgdGl0bGU6ICAnaGVpZ2h0JyxcbiAgICAgICAgICB2YWx1ZToge1xuICAgICAgICAgICAgc2V0OiBmdW5jdGlvbih2YWwpe1xuICAgICAgICAgICAgICB0aGlzLnNhdmVTdGF0ZSgpO1xuICAgICAgICAgICAgICB0aGlzLnNjYWxlVG9IZWlnaHQodmFsICogIHRoaXMuY2FudmFzLmdldFpvb20oKSk7XG4gICAgICAgICAgICAgIHRoaXMuZGltZW5zaW9uc0hlaWdodFZhbHVlID0gdmFsO1xuICAgICAgICAgICAgICB0aGlzLmNhbnZhcy5maXJlTW9kaWZpZWRJZkNoYW5nZWQodGhpcyk7XG4gICAgICAgICAgICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgICAgICAgICAgICBkZWxldGUgdGhpcy5kaW1lbnNpb25zSGVpZ2h0VmFsdWU7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICBpZih0aGlzLmRpbWVuc2lvbnNIZWlnaHRWYWx1ZSl7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGltZW5zaW9uc0hlaWdodFZhbHVlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHJldHVybiBNYXRoLnJvdW5kKHRoaXMuZ2V0Qm91bmRpbmdSZWN0KCkuaGVpZ2h0IC8gdGhpcy5jYW52YXMuZ2V0Wm9vbSgpKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvYnNlcnZlOiBcIm1vZGlmaWVkXCJcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuICAgIGNlbnRlcjoge1xuICAgICAgY2xhc3NOYW1lOiAgJ2ZhIGZhLWJ1bGxzZXllJyxcbiAgICAgIHRpdGxlOiAnQ2VudGVyJyxcbiAgICAgIGFjdGlvbjogZnVuY3Rpb24oKXtcbiAgICAgICAgdGhpcy5jZW50ZXIoKTtcbiAgICAgICAgdGhpcy5zZXRDb29yZHMoKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIGZsaXA6IHtcbiAgICAgIGNsYXNzTmFtZTogICdmYSBmYS1hcnJvd3MtaCcsXG4gICAgICB0aXRsZTogICAgICAnZmxpcCcsXG4gICAgICBhY3Rpb246ICAgICAnZmxpcCdcbiAgICB9LFxuICAgIGZsb3A6IHtcbiAgICAgIGNsYXNzTmFtZTogICdmYSBmYS1hcnJvd3MtdicsXG4gICAgICB0aXRsZTogICAgICAnZmxvcCdcbiAgICB9LFxuICAgIGJyaW5nRm9yd2FyZDoge1xuICAgICAgdGl0bGU6ICAgICAgJ2JyaW5nIGZvcndhcmQnLFxuICAgICAgY2xhc3NOYW1lOiAgJ2ZhIGZhLWxldmVsLXVwJyxcbiAgICAgIGRpc2FibGVkOiAgICdvblRvcCdcbiAgICB9LFxuICAgIHNlbmRCYWNrd2FyZHM6IHtcbiAgICAgIHRpdGxlOiAgICAgICdzZW5kIGJhY2t3YXJkcycsXG4gICAgICBjbGFzc05hbWU6ICAnZmEgZmEtbGV2ZWwtZG93bicsXG4gICAgICBkaXNhYmxlZDogICAnb25Cb3R0b20nXG4gICAgfSxcbiAgICByZW1vdmU6IHtcbiAgICAgIGNsYXNzTmFtZTogICdmYSBmYS10cmFzaCcsXG4gICAgICB0aXRsZTogICAgICAncmVtb3ZlJyxcbiAgICAgIGtleTogICAgICAgIFwiRGVsZXRlXCJcbiAgICB9LFxuICAgIGR1cGxpY2F0ZToge1xuICAgICAgY2xhc3NOYW1lOiAgJ2ZhIGZhLWNsb25lJyxcbiAgICAgIHRpdGxlOiAgICAgICdkdXBsaWNhdGUnXG4gICAgfSxcbiAgICBmaWxsOiB7XG4gICAgICB0eXBlOiAnY29sb3InLFxuICAgICAgdGl0bGU6ICdmaWxsJyxcbiAgICAgIHZhbHVlOiAnZmlsbCdcbiAgICB9LFxuICB9XG59KTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvY29yZS9vYmplY3QuZXh0LmpzIiwidmFyIHRleHRJbml0aWFsaXplID0gZmFicmljLlRleHQucHJvdG90eXBlLmluaXRpYWxpemU7XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLlRleHQucHJvdG90eXBlLCB7XG4gIHRleHRJbml0aWFsaXplOiB0ZXh0SW5pdGlhbGl6ZSxcbiAgZWRpdFRvb2w6IGZhbHNlLFxuICBhZHZhbmNlZENvbG9yc1Rvb2xzOiBmYWxzZSxcbiAgdGV4dEZvbnRTaXplVG9vbHM6IGZhbHNlLFxuICB0ZXh0QWxpZ21lbnRUb29sczogZmFsc2UsXG4gIGFkdmFuY2VkVGV4dFN0eWxlVG9vbHM6IGZhbHNlLFxuICByYXN0ZXJpemVUb29sOiBmYWxzZSxcbiAgcmFzdGVyaXplS2xhc3M6IGZhYnJpYy5JbWFnZSxcbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKHRleHQsIG9wdGlvbnMpIHtcbiAgICB0aGlzLl9pbml0RW50aXR5KG9wdGlvbnMpO1xuICAgIHRoaXMudGV4dEluaXRpYWxpemUodGV4dCwgb3B0aW9ucyk7XG4gICAgLy8gdGhpcy51cGRhdGVDYWNoZSgpO1xuICB9LFxuICAgIF9yZW5kZXJfY2FjaGU6IGZ1bmN0aW9uIChjdHgpIHtcbiAgY3R4LnNhdmUoKTtcbiAgY3R4LnNjYWxlKFxuICAgIHRoaXMuc2NhbGVYICogKHRoaXMuZmxpcFggPyAtMSA6IDEpLFxuICAgIHRoaXMuc2NhbGVZICogKHRoaXMuZmxpcFkgPyAtMSA6IDEpXG4gICk7XG4gIHRoaXMudHJhbnNmb3JtKGN0eCk7XG4gIHRoaXMuX3NldFNoYWRvdyhjdHgpO1xuICBjdHgudHJhbnNsYXRlKC10aGlzLndpZHRoIC8gMiwgLXRoaXMuaGVpZ2h0IC8gMik7XG4gIGN0eC5kcmF3SW1hZ2UodGhpcy5fY2FjaGUsIDAsIDAsIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KTtcbiAgY3R4LnJlc3RvcmUoKTtcbn0sXG4gIHVwZGF0ZUNhY2hlOiBmdW5jdGlvbiAoKSB7XG5cbiAgICB2YXIgc2l6ZSA9IHtcbiAgICAgIHdpZHRoOiB0aGlzLndpZHRoICogdGhpcy5jYW52YXMuZG90c1BlclVuaXQsXG4gICAgICBoZWlnaHQ6IHRoaXMuaGVpZ2h0ICogdGhpcy5jYW52YXMuZG90c1BlclVuaXRcbiAgICB9O1xuXG4gICAgdmFyIF9jbGlwVG8gPSB0aGlzLmNsaXBUbztcbiAgICBkZWxldGUgdGhpcy5jbGlwVG87XG4gICAgdGhpcy5fY2FjaGUgPSBmYWJyaWMudXRpbC5jcmVhdGVDYW52YXNFbGVtZW50V2l0aFNpemUoc2l6ZSk7XG4gICAgdmFyIGN0eCA9IHRoaXMuX2NhY2hlLmdldENvbnRleHQoXCIyZFwiKTtcbiAgICBjdHguc2NhbGUoXG4gICAgICB0aGlzLmNhbnZhcy5kb3RzUGVyVW5pdCxcbiAgICAgIHRoaXMuY2FudmFzLmRvdHNQZXJVbml0KTtcbiAgICBjdHgudHJhbnNsYXRlKHRoaXMud2lkdGggLyAyLCB0aGlzLmhlaWdodCAvIDIpO1xuXG4gICAgdGhpcy5yZW5kZXIoY3R4LCB0cnVlKTtcbiAgICB0aGlzLnJlbmRlciA9IHRoaXMuX3JlbmRlcl9jYWNoZTtcbiAgICB0aGlzLmNsaXBUbyA9IF9jbGlwVG87XG5cbiAgfSxcbiAgcmFzdGVyaXplVGV4dDogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMudXBkYXRlQ2FjaGUoKTtcbiAgICB2YXIgaW1nID0gZmFicmljLnV0aWwuY3JlYXRlSW1hZ2UoKTtcblxuICAgIGltZy5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgb2JqID0gdGhpcy50b09iamVjdCgpO1xuICAgICAgb2JqLndpZHRoID0gaW1nLndpZHRoO1xuICAgICAgb2JqLmhlaWdodCA9IGltZy5oZWlnaHQ7XG4gICAgICBvYmouc2NhbGVYID0gdGhpcy5zY2FsZVggKiAodGhpcy5oZWlnaHQgLyBpbWcuaGVpZ2h0KTtcbiAgICAgIG9iai5zY2FsZVkgPSB0aGlzLnNjYWxlWSAqICh0aGlzLndpZHRoIC8gaW1nLndpZHRoICk7XG4gICAgICBvYmoucmFzdGVyaXplZFR5cGUgPSBvYmoudHlwZTtcbiAgICAgIGRlbGV0ZSBvYmoudHlwZTtcblxuICAgICAgdmFyIGVsID0gbmV3IHRoaXMucmFzdGVyaXplS2xhc3MoaW1nLCBvYmopO1xuICAgICAgdGhpcy5jYW52YXMuYWRkKGVsKTtcbiAgICAgIHRoaXMuY2FudmFzLnJlbW92ZSh0aGlzKTtcbiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmNhbnZhcy5zZXRBY3RpdmVPYmplY3QoZWwpO1xuICAgICAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICAgIH0uYmluZCh0aGlzKSlcbiAgICB9LmJpbmQodGhpcyk7XG4gICAgaW1nLnNyYyA9IHRoaXMuX2NhY2hlLnRvRGF0YVVSTCgpO1xuICAgIC8vdGhpcy5vbignbW9kaWZpZWQnLHRoaXMudXBkYXRlQ2FjaGUuYmluZCh0aGlzKSk7XG4gIH0sXG4gIGdldFN0eWxlOiBmdW5jdGlvbiAoc3R5bGVOYW1lKSB7XG4gICAgdmFyIG9iamVjdCA9IHRoaXM7XG4gICAgcmV0dXJuIChvYmplY3QuZ2V0U2VsZWN0aW9uU3R5bGVzICYmIG9iamVjdC5pc0VkaXRpbmcpXG4gICAgICA/IChvYmplY3QuZ2V0U2VsZWN0aW9uU3R5bGVzKClbc3R5bGVOYW1lXSB8fCBvYmplY3Rbc3R5bGVOYW1lXSlcbiAgICAgIDogKG9iamVjdFtzdHlsZU5hbWVdIHx8IG9iamVjdFsnX18nICsgc3R5bGVOYW1lXSB8fCAnJyk7XG4gIH0sXG4gIGdldFBhdHRlcm46IGZ1bmN0aW9uICh1cmwpIHtcbiAgICB2YXIgX2ZpbGwgPSB0aGlzLmdldFN0eWxlKCdmaWxsICcpO1xuICAgIHJldHVybiBfZmlsbCAmJiBfZmlsbC5zb3VyY2U7XG4gIH0sXG4gIHNldFBhdHRlcm46IGZ1bmN0aW9uICh1cmwpIHtcbiAgICBpZiAoIXVybCkge1xuICAgICAgdGhpcy5zZXRTdHlsZSgnZmlsbCcpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyB2YXIgX3RleHR1cmUgPSBfLmZpbmRXaGVyZSh0aGlzLnByb2plY3QudGV4dHVyZXMsIHtpZDogdXJsfSk7XG4gICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgZmFicmljLnV0aWwubG9hZEltYWdlKHVybCwgZnVuY3Rpb24oaW1nKSB7XG4gICAgICAgIF90aGlzLnNldFN0eWxlKCdmaWxsJywgbmV3IGZhYnJpYy5QYXR0ZXJuKHtcbiAgICAgICAgICBzb3VyY2U6IGltZyxcbiAgICAgICAgICByZXBlYXQ6ICdyZXBlYXQnXG4gICAgICAgIH0pKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfSxcbiAgLyogZ2V0T3BhY2l0eTogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLmdldFN0eWxlKCdvcGFjaXR5JykgKiAxMDA7XG4gIH0sXG4gIHNldE9wYWNpdHk6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgIHRoaXMuc2V0U3R5bGUoJ29wYWNpdHknLCBwYXJzZUludCh2YWx1ZSwgMTApIC8gMTAwKTtcbiAgfSwqL1xuICBnZXRSYWRpdXM6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5nZXQoJ3JhZGl1cycpO1xuICB9LFxuICBzZXRTaGFkb3c6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICByZXR1cm4gdGhpcy5zZXRQcm9wZXJ0eSgnc2hhZG93Jywgb3B0aW9ucyA/IG5ldyBmYWJyaWMuU2hhZG93KG9wdGlvbnMpIDogbnVsbCk7XG4gIH0sXG4gIHNldFByb3BlcnR5OiBmdW5jdGlvbiAocHJvcCwgdmFsdWUpIHtcbiAgICB0aGlzW3Byb3BdID0gdmFsdWU7XG4gICAgdGhpcy5jYW52YXMgJiYgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gIH0sXG4gIHNldFJhZGl1czogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgdGhpcy5zZXRQcm9wZXJ0eSgncmFkaXVzJywgdmFsdWUpO1xuICB9LFxuICBnZXRTcGFjaW5nOiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0KCdzcGFjaW5nJyk7XG4gIH0sXG4gIHNldFNwYWNpbmc6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgIHRoaXMuc2V0UHJvcGVydHkoJ3NwYWNpbmcnLCB2YWx1ZSk7XG4gIH0sXG4gIGdldFJldmVydGVkOiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0KCdyZXZlcnRlZCcpO1xuICB9LFxuICBzZXRSZXZlcnRlZDogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgdGhpcy5zZXRQcm9wZXJ0eSgncmV2ZXJ0ZWQnLCB2YWx1ZSk7XG4gIH0sXG4gIGdldEZpbGw6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5nZXRTdHlsZSgnZmlsbCcpO1xuICB9LFxuICBzZXRGaWxsOiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICB0aGlzLnNldFN0eWxlKCdmaWxsJywgdmFsdWUpO1xuICB9LFxuICBnZXRUZXh0OiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0KCd0ZXh0Jyk7XG4gIH0sXG4gIHNldFRleHQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgIHRoaXMuc2V0UHJvcGVydHkoJ3RleHQnLCB2YWx1ZSk7XG4gIH0sXG4gIGdldFRleHRBbGlnbjogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLmdldCgndGV4dEFsaWduJyk7XG4gIH0sXG4gIHNldFRleHRBbGlnbjogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgdGhpcy5zZXRQcm9wZXJ0eSgndGV4dEFsaWduJywgdmFsdWUudG9Mb3dlckNhc2UoKSk7XG4gIH0sXG4gIGdldEZvbnRGYW1pbHk6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5nZXQoJ2ZvbnRGYW1pbHknKTtcbiAgfSxcbiAgc2V0Rm9udEZhbWlseTogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgdGhpcy5zZXRTdHlsZSgnZm9udEZhbWlseScsIHZhbHVlKTtcbiAgfSxcbiAgZ2V0U3R5bGVzOiBmdW5jdGlvbigpe1xuICAgIHJldHVybiB0aGlzLnN0eWxlcyB8fCB7XG4gICAgICAgIGZpbGwgOiAgICAgICAgICAgICAgICB0aGlzLmZpbGwsXG4gICAgICAgIGZvbnRTaXplIDogICAgICAgICAgICB0aGlzLmZvbnRTaXplLFxuICAgICAgICB0ZXh0QmFja2dyb3VuZENvbG9yIDogdGhpcy50ZXh0QmFja2dyb3VuZENvbG9yLFxuICAgICAgICB0ZXh0RGVjb3JhdGlvbiA6ICAgICAgdGhpcy50ZXh0RGVjb3JhdGlvbixcbiAgICAgICAgZm9udEZhbWlseSA6ICAgICAgICAgIHRoaXMuZm9udEZhbWlseSxcbiAgICAgICAgZm9udFdlaWdodCA6ICAgICAgICAgIHRoaXMuZm9udFdlaWdodCxcbiAgICAgICAgZm9udFN0eWxlIDogICAgICAgICAgIHRoaXMuZm9udFN0eWxlLFxuICAgICAgICBzdHJva2UgOiAgICAgICAgICAgICAgdGhpcy5zdHJva2UsXG4gICAgICAgIHN0cm9rZVdpZHRoIDogICAgICAgICB0aGlzLnN0cm9rZVdpZHRoXG4gICAgICB9O1xuICB9LFxuICBnZXRCZ0NvbG9yOiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0KCdiYWNrZ3JvdW5kQ29sb3InKTtcbiAgfSxcbiAgc2V0QmdDb2xvcjogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgdGhpcy5zZXRQcm9wZXJ0eSgnYmFja2dyb3VuZENvbG9yJywgdmFsdWUpO1xuICB9LFxuICBnZXRUZXh0QmdDb2xvcjogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLmdldCgndGV4dEJhY2tncm91bmRDb2xvcicpO1xuICB9LFxuICBzZXRUZXh0QmdDb2xvcjogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgdGhpcy5zZXRQcm9wZXJ0eSgndGV4dEJhY2tncm91bmRDb2xvcicsIHZhbHVlKTtcbiAgfSxcbiAgZ2V0U3Ryb2tlOiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0U3R5bGUoJ3N0cm9rZScpO1xuICB9LFxuICBzZXRTdHJva2U6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgIHRoaXMuc2V0U3R5bGUoJ3N0cm9rZScsIHZhbHVlKTtcbiAgfSxcbiAgZ2V0U3Ryb2tlV2lkdGg6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5nZXRTdHlsZSgnc3Ryb2tlV2lkdGgnKTtcbiAgfSxcbiAgc2V0U3Ryb2tlV2lkdGg6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgIHRoaXMuc2V0U3R5bGUoJ3N0cm9rZVdpZHRoJywgcGFyc2VJbnQodmFsdWUsIDEwKSk7XG4gIH0sXG4gIGRlY3JlYXNlRm9udFNpemU6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLnNldFN0eWxlKCdmb250U2l6ZScsIHBhcnNlSW50KHRoaXMuZ2V0U3R5bGUoJ2ZvbnRTaXplJykpIC0gMSk7XG4gIH0sXG4gIGluY3JlYXNlRm9udFNpemU6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLnNldFN0eWxlKCdmb250U2l6ZScsIHBhcnNlSW50KHRoaXMuZ2V0U3R5bGUoJ2ZvbnRTaXplJykpICsgMSk7XG4gIH0sXG4gIGdldEZvbnRTaXplOiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0U3R5bGUoJ2ZvbnRTaXplJyk7XG4gIH0sXG4gIHNldEZvbnRTaXplOiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICB0aGlzLnNldFN0eWxlKCdmb250U2l6ZScsIHBhcnNlSW50KHZhbHVlLCAxMCkpO1xuICB9LFxuICBnZXRMaW5lSGVpZ2h0OiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0U3R5bGUoJ2xpbmVIZWlnaHQnKTtcbiAgfSxcbiAgc2V0TGluZUhlaWdodDogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgdGhpcy5zZXRTdHlsZSgnbGluZUhlaWdodCcsIHBhcnNlRmxvYXQodmFsdWUsIDEwKSk7XG4gIH0sXG4gIGFkZFRleHQ6IGZ1bmN0aW9uICh0ZXh0LG9wdGlvbnMpIHtcblxuICAgIHZhciBfbWF0Y2ggPSB0aGlzLnRleHQubWF0Y2goL1xcbi9nKTtcbiAgICB2YXIgX2xpbmVJbmRleCA9IF9tYXRjaCAmJiBfbWF0Y2gubGVuZ3RoIHx8IDA7XG4gICAgdmFyIGNoYXJJbmRleCA9IHRoaXMudGV4dC5sZW5ndGggLSB0aGlzLnRleHQubGFzdEluZGV4T2YoXCJcXG5cIikgLSAxO1xuXG4gICAgaWYoIXRoaXMuc3R5bGVzW19saW5lSW5kZXhdKXtcbiAgICAgIHRoaXMuc3R5bGVzW19saW5lSW5kZXhdID0ge31cbiAgICB9XG5cbiAgICBpZighdGhpcy5zdHlsZXNbX2xpbmVJbmRleF1bY2hhckluZGV4XSl7XG4gICAgICB0aGlzLnN0eWxlc1tfbGluZUluZGV4XVtjaGFySW5kZXhdID0ge31cbiAgICB9XG4gICAgZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCh0aGlzLnN0eWxlc1tfbGluZUluZGV4XVtjaGFySW5kZXhdLG9wdGlvbnMpO1xuICAgIHRoaXMudGV4dCArPXRleHQ7XG4gICAgLy8gdGhpcy5zdHlsZXM7XG4gIH0sXG4gIGdldEJvbGQ6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5nZXRTdHlsZSgnZm9udFdlaWdodCcpID09PSBcImJvbGRcIjtcbiAgfSxcbiAgc2V0Qm9sZDogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgdGhpcy5zZXRTdHlsZSgnZm9udFdlaWdodCcsIHZhbHVlID8gJ2JvbGQnIDogJycpO1xuICB9LFxuICBnZXRJdGFsaWM6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5nZXRTdHlsZSgnZm9udFN0eWxlJykgPT09ICdpdGFsaWMnO1xuICB9LFxuICBzZXRJdGFsaWM6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgIHRoaXMuc2V0U3R5bGUoJ2ZvbnRTdHlsZScsIHZhbHVlID8gJ2l0YWxpYycgOiAnJyApO1xuICB9LFxuICBnZXRVbmRlcmxpbmU6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5nZXRTdHlsZSgndGV4dERlY29yYXRpb24nKS5pbmRleE9mKCd1bmRlcmxpbmUnKSA+IC0xO1xuICB9LFxuICBzZXRVbmRlcmxpbmU6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgIHZhbHVlID0gdmFsdWUgPyAodGhpcy5nZXRTdHlsZSgndGV4dERlY29yYXRpb24nKSArICcgdW5kZXJsaW5lJylcbiAgICAgIDogdGhpcy5nZXRTdHlsZSgndGV4dERlY29yYXRpb24nKS5yZXBsYWNlKCd1bmRlcmxpbmUnLCAnJyk7XG5cbiAgICB0aGlzLnNldFN0eWxlKCd0ZXh0RGVjb3JhdGlvbicsIHZhbHVlKTtcbiAgfSxcbiAgZ2V0TGluZXRocm91Z2g6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5nZXRTdHlsZSgndGV4dERlY29yYXRpb24nKS5pbmRleE9mKCdsaW5lLXRocm91Z2gnKSA+IC0xO1xuICB9LFxuICBzZXRMaW5ldGhyb3VnaDogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgdmFsdWUgPSB2YWx1ZSA/ICh0aGlzLmdldFN0eWxlKCd0ZXh0RGVjb3JhdGlvbicpICsgJyBsaW5lLXRocm91Z2gnKVxuICAgICAgOiB0aGlzLmdldFN0eWxlKCd0ZXh0RGVjb3JhdGlvbicpLnJlcGxhY2UoJ2xpbmUtdGhyb3VnaCcsICcnKTtcblxuICAgIHRoaXMuc2V0U3R5bGUoJ3RleHREZWNvcmF0aW9uJywgdmFsdWUpO1xuICB9LFxuICBnZXRPdmVybGluZTogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLmdldFN0eWxlKCd0ZXh0RGVjb3JhdGlvbicpLmluZGV4T2YoJ292ZXJsaW5lJykgPiAtMTtcbiAgfSxcbiAgc2V0T3ZlcmxpbmU6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgIHZhbHVlID0gdmFsdWUgPyAodGhpcy5nZXRTdHlsZSgndGV4dERlY29yYXRpb24nKSArICcgb3ZlcmxpbmUnKVxuICAgICAgOiB0aGlzLmdldFN0eWxlKCd0ZXh0RGVjb3JhdGlvbicpLnJlcGxhY2UoJ292ZXJsaW4nLCAnJyk7XG5cbiAgICB0aGlzLnNldFN0eWxlKCd0ZXh0RGVjb3JhdGlvbicsIHZhbHVlKTtcbiAgfSxcbiAgc2V0U3R5bGU6IGZ1bmN0aW9uIChzdHlsZU5hbWUsIHZhbHVlKSB7XG4gICAgdmFyIG9iamVjdCA9IHRoaXM7XG4gICAgdmFyIF9vbGQgPSBmYWJyaWMudXRpbC5vYmplY3QuY2xvbmVEZWVwKG9iamVjdC5nZXRTdHlsZXMoKSk7XG4gICAgLy92YXIgX29sZCA9IGZhYnJpYy51dGlsLm9iamVjdC5kZWVwRXh0ZW5kKHt9LCBvYmplY3QuZ2V0U3R5bGVzKTsvL2dldFNlbGVjdGlvblN0eWxlcygpO1xuICAgIGlmIChvYmplY3Quc2V0U2VsZWN0aW9uU3R5bGVzICYmIG9iamVjdC5pc0VkaXRpbmcpIHtcbiAgICAgIHZhciBzdHlsZSA9IHt9O1xuICAgICAgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgc3R5bGVbc3R5bGVOYW1lXSA9IHZhbHVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZGVsZXRlIHN0eWxlW3N0eWxlTmFtZV07XG4gICAgICB9XG4gICAgICBvYmplY3Quc2V0U2VsZWN0aW9uU3R5bGVzKHN0eWxlKTtcbiAgICAgIG9iamVjdC5zZXRDb29yZHMoKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICBpZiAodmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBvYmplY3Rbc3R5bGVOYW1lXSA9IHZhbHVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZGVsZXRlIG9iamVjdFtzdHlsZU5hbWVdO1xuICAgICAgfVxuICAgICAgZm9yICh2YXIgaSBpbiBvYmplY3Quc3R5bGVzKSB7XG4gICAgICAgIGZvciAodmFyIGogaW4gb2JqZWN0LnN0eWxlc1tpXSkge1xuICAgICAgICAgIGlmIChvYmplY3Quc3R5bGVzW2ldW2pdW3N0eWxlTmFtZV0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgZGVsZXRlIG9iamVjdC5zdHlsZXNbaV1bal1bc3R5bGVOYW1lXTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICB2YXIgc3R5bGVzX2RhdGEgPSBvYmplY3QuZ2V0U3R5bGVzKCk7XG5cbiAgICBpZih0aGlzLnR5cGUgIT0gXCJ0ZXh0XCIpe1xuICAgICAgdGhpcy5zdHlsZXMgPSBmYWJyaWMudXRpbC5vYmplY3QuY2xvbmVEZWVwKHN0eWxlc19kYXRhKTtcbiAgICB9XG5cbiAgICB0aGlzLnNldENvb3JkcygpO1xuXG4gICAgdGhpcy5maXJlKFwic3R5bGVzOm1vZGlmaWVkXCIsIHtcbiAgICAgIG9yaWdpbmFsOiBfb2xkLFxuICAgICAgbW9kaWZpZWQ6IHN0eWxlc19kYXRhXG4gICAgfSk7XG4gICAgdGhpcy5jYW52YXMgJiYgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gICAgLypcbiAgICAgdGhpcy5wcm9qZWN0Lmhpc3RvcnkuYWRkKHtcbiAgICAgc2xpZGU6IHRoaXMuc2xpZGUsXG4gICAgIG9iamVjdDogdGhpcyxcbiAgICAgdW5kbzogX29sZCxcbiAgICAgcmVkbzogc3R5bGVzX2RhdGEsXG4gICAgIHR5cGU6ICdzdHlsZWQnLFxuICAgICB1bmRvRm46IGZ1bmN0aW9uKCl7XG4gICAgIHRoaXMub2JqZWN0LmRhdGEuc3R5bGVzID0gdGhpcy51bmRvO1xuICAgICB0aGlzLm9iamVjdC5mYWJyaWMuc2V0KCdzdHlsZXMnLHRoaXMudW5kbyk7XG4gICAgIHRoaXMub2JqZWN0LmZhYnJpYy5zZXRDb29yZHMoKTtcbiAgICAgdGhpcy5vYmplY3Quc2xpZGUucmVuZGVyKCk7XG4gICAgIH0sXG4gICAgIHJlZG9GbjogIGZ1bmN0aW9uKCl7XG4gICAgIHRoaXMub2JqZWN0LmRhdGEuc3R5bGVzID0gdGhpcy5yZWRvO1xuICAgICB0aGlzLm9iamVjdC5mYWJyaWMuc2V0KCdzdHlsZXMnLHRoaXMucmVkbyk7XG4gICAgIHRoaXMub2JqZWN0LmZhYnJpYy5zZXRDb29yZHMoKTtcbiAgICAgdGhpcy5vYmplY3Quc2xpZGUucmVuZGVyKCk7XG4gICAgIH1cbiAgICAgfSk7Ki9cbiAgfSxcblxuICBnZW5lcmF0ZVRleHRTdHlsZTogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB7XG4gICAgICAnZm9udC1zdHlsZSc6IHRoaXMuaXNJdGFsaWMoKSA/ICdpdGFsaWMnIDogJ25vcm1hbCcsXG4gICAgICAnZm9udC13ZWlnaHQnOiB0aGlzLmlzQm9sZCgpID8gNzAwIDogNDAwLFxuICAgICAgJ3RleHQtZGVjb3JhdGlvbic6ICh0aGlzLmlzTGluZXRocm91Z2goKSA/ICdsaW5lLXRocm91Z2ggJyA6ICcnICkgK1xuICAgICAgKHRoaXMuaXNPdmVybGluZSgpID8gJ292ZXJsaW5lICcgOiAnJyApICtcbiAgICAgICh0aGlzLmlzVW5kZXJsaW5lKCkgPyAndW5kZXJsaW5lICcgOiAnJylcbiAgICB9XG4gIH0sXG4gIGFjdGlvbnM6IHtcbiAgICByYXN0ZXJpemVUZXh0OiB7XG4gICAgICBpbnNlcnQ6ICdyYXN0ZXJpemVUb29sJyxcbiAgICAgIGNsYXNzTmFtZTogJ2J1dHRvbi1lYXNlbCcsXG4gICAgICB0aXRsZTogJ3Jhc3Rlcml6ZVRleHQnLFxuICAgLy8gICBhY3Rpb246IF9URVgucmFzdGVyaXplVGV4dFxuICAgIH0sXG4gICAgdGV4dEJnY29sb3I6IHtcbiAgICAgIHR5cGU6ICdjb2xvcicsXG4gICAgICB0aXRsZTogJ2JnQ29sb3InLFxuICAgICAgdmFsdWU6ICdiZ0NvbG9yJ1xuICAgIH0sXG4gICAgdGV4dFRleHRiZ2NvbG9yOiB7XG4gICAgICB0eXBlOiAnY29sb3InLFxuICAgICAgdGl0bGU6ICd0ZXh0QmdDb2xvcicsXG4gICAgICB2YWx1ZTogJ3RleHRCZ0NvbG9yJ1xuICAgIH0sXG4gICAgdGV4dEJvbGQ6IHtcbiAgICAgIHR5cGU6IFwiY2hlY2tib3hcIixcbiAgICAgIHRpdGxlOiAnYm9sZCcsXG4gICAgICB2YWx1ZTogJ2JvbGQnLFxuICAgICAgY2xhc3NOYW1lOiAnZmEgZmEtYm9sZCdcbiAgICB9LFxuICAgIHRleHRJdGFsaWM6IHtcbiAgICAgIHR5cGU6IFwiY2hlY2tib3hcIixcbiAgICAgIHRpdGxlOiAnaXRhbGljJyxcbiAgICAgIHZhbHVlOiAnaXRhbGljJyxcbiAgICAgIGNsYXNzTmFtZTogJ2ZhIGZhLWl0YWxpYydcbiAgICB9LFxuICAgIHRleHRVbmRlcmxpbmU6IHtcbiAgICAgIHR5cGU6IFwiY2hlY2tib3hcIixcbiAgICAgIHRpdGxlOiAnVW5kZXJsaW5lJyxcbiAgICAgIHZhbHVlOiAndW5kZXJsaW5lJyxcbiAgICAgIGNsYXNzTmFtZTogJ2ZhIGZhLXVuZGVybGluZSdcbiAgICB9LFxuICAgIHRleHRMaW5ldGhyb3VnaDoge1xuICAgICAgdHlwZTogXCJjaGVja2JveFwiLFxuICAgICAgaW5zZXJ0OiAnYWR2YW5jZWRUZXh0U3R5bGVUb29scycsXG4gICAgICB0aXRsZTogJ0xpbmV0aHJvdWdoJyxcbiAgICAgIHZhbHVlOiAnbGluZXRocm91Z2gnLFxuICAgICAgY2xhc3NOYW1lOiAndGV4dC1saW5ldGhyb3VnaCBmYSBmYS1zdHJpa2V0aHJvdWdoJ1xuICAgIH0sXG4gICAgdGV4dE92ZXJsaW5lOiB7XG4gICAgICB0eXBlOiBcImNoZWNrYm94XCIsXG4gICAgICBpbnNlcnQ6ICdhZHZhbmNlZFRleHRTdHlsZVRvb2xzJyxcbiAgICAgIHRpdGxlOiAnb3ZlcmxpbmUnLFxuICAgICAgdmFsdWU6ICdvdmVybGluZScsXG4gICAgICBjbGFzc05hbWU6ICd0ZXh0LW92ZXJsaW5lIGZhIGZhLW92ZXJsaW5lJ1xuICAgIH0sXG4gICAgdGV4dEFsaWduOiB7XG4gICAgICB0eXBlOiAnb3B0aW9ucycsXG4gICAgICB0aXRsZTogJ3RleHQgYWxpZ24nLFxuICAgICAgaW5zZXJ0OiAndGV4dEFsaWdtZW50VG9vbHMnLFxuICAgICAgdmFsdWU6IFwidGV4dEFsaWduXCIsXG4gICAgICBtZW51OiB7XG4gICAgICAgIHRleHRBbGlnbkNlbnRlcjoge1xuICAgICAgICAgIHRpdGxlOiAnYWxpZ24gY2VudGVyJyxcbiAgICAgICAgICBvcHRpb246ICdjZW50ZXInLFxuICAgICAgICAgIGNsYXNzTmFtZTogJ2ZhIGZhLWFsaWduLWNlbnRlcidcbiAgICAgICAgfSxcbiAgICAgICAgdGV4dEFsaWduTGVmdDoge1xuICAgICAgICAgIHRpdGxlOiAnYWxpZ24gbGVmdCcsXG4gICAgICAgICAgb3B0aW9uOiAnbGVmdCcsXG4gICAgICAgICAgY2xhc3NOYW1lOiAnZmEgZmEtYWxpZ24tbGVmdCdcbiAgICAgICAgfSxcbiAgICAgICAgdGV4dEFsaWduUmlnaHQ6IHtcbiAgICAgICAgICB0aXRsZTogJ2FsaWduIHJpZ2h0JyxcbiAgICAgICAgICBvcHRpb246ICdyaWdodCcsXG4gICAgICAgICAgY2xhc3NOYW1lOiAnZmEgZmEtYWxpZ24tcmlnaHQnXG4gICAgICAgIH0sXG4gICAgICAgIHRleHRBbGlnbkp1c3RpZnk6IHtcbiAgICAgICAgICB0aXRsZTogJ2FsaWduIGp1c3RpZnknLFxuICAgICAgICAgIG9wdGlvbjogJ2p1c3RpZnknLFxuICAgICAgICAgIGNsYXNzTmFtZTogJ2ZhIGZhLWFsaWduLWp1c3RpZnknXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuICAgIGZvbnRGYW1pbHk6IHtcbiAgICAgIHR5cGU6ICdmb250RmFtaWx5JyxcbiAgICAgIHRpdGxlOiAnZm9udCBmYW1pbHknLFxuICAgICAgY2xhc3NOYW1lOiAnZmEgZmEtdGV4dCcsXG4gICAgICB2YWx1ZTogJ2ZvbnRGYW1pbHknLFxuICAgICAgZGF0YTogZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuIHRoaXMuYXBwbGljYXRpb24uX2ZvbnRzXG4gICAgICB9XG4gICAgfSxcbiAgICB0ZXh0Rm9udFNpemU6IHtcbiAgICAgIGluc2VydDogJ3RleHRGb250U2l6ZVRvb2xzJyxcbiAgICAgIHR5cGU6ICdudW1iZXInLFxuICAgICAgdGl0bGU6ICdmb250U2l6ZScsXG4gICAgICB2YWx1ZTogJ2ZvbnRTaXplJ1xuICAgIH0sXG4gICAgLyp0ZXh0Rm9udDoge1xuICAgICBpbnNlcnQ6ICd0ZXh0Rm9udFNpemVUb29scycsXG4gICAgIHR5cGU6ICdtZW51JyxcbiAgICAgdGl0bGU6ICdmb250JyxcbiAgICAgY2xhc3NOYW1lOiAnZmEgZmEtZm9udCcsXG4gICAgIG1lbnU6IHtcbiAgICAgdGV4dEZvbnRTaXplRGVjcmVhc2U6IHtcbiAgICAgdGl0bGU6ICdkZWNyZWFzZUZvbnRTaXplJyxcbiAgICAgYWN0aW9uOiBfVEVYLmRlY3JlYXNlRm9udFNpemUsXG4gICAgIGNsYXNzTmFtZTogJ2ZhIGZhLWZvbnQgZm9udC1zaXplLWRlY3JlYXNlJ1xuICAgICB9LFxuICAgICB0ZXh0Rm9udFNpemVJbmNyZWFzZToge1xuICAgICB0aXRsZTogJ2luY3JlYXNlRm9udFNpemUnLFxuICAgICBhY3Rpb246IF9URVguaW5jcmVhc2VGb250U2l6ZSxcbiAgICAgY2xhc3NOYW1lOiAnZmEgZmEtZm9udCBmb250LXNpemUtaW5jcmVhc2UnXG4gICAgIH1cbiAgICAgfVxuICAgICB9Ki9cbiAgICBhZHZhbmNlZENvbG9yc1Rvb2xzOiB7XG4gICAgICBjbGFzc05hbWU6ICdjb2xvcnMnLFxuICAgICAgdHlwZTogJ21lbnUnLFxuICAgICAgdGl0bGU6ICdjb2xvcnMnLFxuICAgICAgdG9nZ2xlZDogdHJ1ZSxcbiAgICAgIG1lbnU6IFtcImZpbGxcIixcInRleHRCZ2NvbG9yXCIsXCJ0ZXh0VGV4dGJnY29sb3JcIixcInRleHRGaWxsXCJdXG4gICAgfSxcbiAgICB0ZXh0U3R5bGU6IHtcbiAgICAgIHR5cGU6ICdtZW51JyxcbiAgICAgIHRpdGxlOiAndGV4dCBzdHlsZScsXG4gICAgICB0b2dnbGVkOiB0cnVlLFxuICAgICAgY2xhc3NOYW1lOiAnZmEgZmEtZm9udCcsXG4gICAgICBzdHlsZTogJ2dlbmVyYXRlVGV4dFN0eWxlJyxcbiAgICAgIG1lbnU6IFtcbiAgICAgICAgXCJ0ZXh0Qm9sZFwiLFwidGV4dEl0YWxpY1wiLFwidGV4dFVuZGVybGluZVwiLFwidGV4dExpbmV0aHJvdWdoXCIsXG4gICAgICAgIFwidGV4dE92ZXJsaW5lXCIsXCJ0ZXh0QWxpZ25cIixcImZvbnRGYW1pbHlcIixcInRleHRGb250U2l6ZVwiXG4gICAgICBdXG4gICAgfVxuICB9XG59KTtcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuSVRleHQucHJvdG90eXBlLCB7XG4gIGluaXRIaWRkZW5UZXh0YXJlYV9uYXRpdmU6IGZhYnJpYy5JVGV4dC5wcm90b3R5cGUuaW5pdEhpZGRlblRleHRhcmVhLFxuICBpbml0SGlkZGVuVGV4dGFyZWE6IGZ1bmN0aW9uKCl7XG4gICAgdGhpcy5pbml0SGlkZGVuVGV4dGFyZWFfbmF0aXZlKCk7XG4gICAgdGhpcy5oaWRkZW5UZXh0YXJlYS5zdHlsZS53aWR0aCA9IFwiOTk5OXB4XCI7XG4gICAgdGhpcy5oaWRkZW5UZXh0YXJlYS5zdHlsZVtcIm1hcmdpbi1sZWZ0XCJdID0gXCItOTk5OXB4XCI7XG4gIH0sXG4gIC8qKlxuICAgKiBFeGl0cyBmcm9tIGVkaXRpbmcgc3RhdGVcbiAgICogQHJldHVybiB7ZmFicmljLklUZXh0fSB0aGlzQXJnXG4gICAqIEBjaGFpbmFibGVcbiAgICovXG4gIGV4aXRFZGl0aW5nOiBmdW5jdGlvbigpIHtcbiAgICAvLyB2YXIgaXNUZXh0Q2hhbmdlZCA9ICh0aGlzLl90ZXh0QmVmb3JlRWRpdCAhPT0gdGhpcy50ZXh0KTtcbiAgICB0aGlzLnNlbGVjdGVkID0gZmFsc2U7XG4gICAgdGhpcy5pc0VkaXRpbmcgPSBmYWxzZTtcbiAgICB0aGlzLnNlbGVjdGFibGUgPSB0cnVlO1xuXG4gICAgdGhpcy5zZWxlY3Rpb25FbmQgPSB0aGlzLnNlbGVjdGlvblN0YXJ0O1xuICAgIHRoaXMuaGlkZGVuVGV4dGFyZWEgJiYgdGhpcy5jYW52YXMgJiYgdGhpcy5oaWRkZW5UZXh0YXJlYS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMuaGlkZGVuVGV4dGFyZWEpO1xuICAgIHRoaXMuaGlkZGVuVGV4dGFyZWEgPSBudWxsO1xuXG4gICAgdGhpcy5hYm9ydEN1cnNvckFuaW1hdGlvbigpO1xuICAgIHRoaXMuX3Jlc3RvcmVFZGl0aW5nUHJvcHMoKTtcbiAgICB0aGlzLl9jdXJyZW50Q3Vyc29yT3BhY2l0eSA9IDA7XG5cbiAgICB0aGlzLmZpcmUoJ2VkaXRpbmc6ZXhpdGVkJyk7XG4gICAgLy8gaXNUZXh0Q2hhbmdlZCAmJiB0aGlzLmZpcmUoJ21vZGlmaWVkJyk7XG4gICAgaWYgKHRoaXMuY2FudmFzKSB7XG4gICAgICB0aGlzLmNhbnZhcy5vZmYoJ21vdXNlOm1vdmUnLCB0aGlzLm1vdXNlTW92ZUhhbmRsZXIpO1xuICAgICAgdGhpcy5jYW52YXMuZmlyZSgndGV4dDplZGl0aW5nOmV4aXRlZCcsIHsgdGFyZ2V0OiB0aGlzIH0pO1xuICAgICAgdGhpcy5jYW52YXMuZmlyZU1vZGlmaWVkSWZDaGFuZ2VkKHRoaXMpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfSxcbiAgbWF4U3Ryb2tlV2lkdGg6IGZ1bmN0aW9uKCl7XG4gICAgcmV0dXJuIE1hdGguY2VpbCggdGhpcy5nZXRGb250U2l6ZSgpIC8gMTApO1xuICB9LFxuICBhY3Rpb25zOiB7XG4gICAgZW50ZXJFZGl0aW5nOiB7XG4gICAgICBpbnNlcnQ6ICAgICAnZWRpdFRvb2wnLFxuICAgICAgY2xhc3NOYW1lOiAgJ2ZhIGZhLXBlbmNpbC1zcXVhcmUtbycsXG4gICAgICB0aXRsZTogICAgICAnZWRpdCdcbiAgICAgIC8vYWN0aW9uOiAgICAgX1RFWC5lbnRlckVkaXRpbmdcbiAgICB9XG4gIH1cbn0pO1xuXG5cblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvY29yZS90ZXh0LmV4dC5qcyIsInZhciBfR3JvdXBSZW1vdmVOZXRpdmUgPSBmYWJyaWMuR3JvdXAucHJvdG90eXBlLnJlbW92ZTtcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuR3JvdXAucHJvdG90eXBlLCB7XG4gIC8qKlxuICAgKiBSZW1vdmVzIG9iamVjdCBmcm9tIGNhbnZhcyB0byB3aGljaCBpdCB3YXMgYWRkZWQgbGFzdFxuICAgKiBAcmV0dXJuIHtmYWJyaWMuT2JqZWN0fSB0aGlzQXJnXG4gICAqIEBjaGFpbmFibGVcbiAgICovXG4gIHJlbW92ZTogZnVuY3Rpb24gKCkge1xuICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAwKSB7XG4gICAgICB0aGlzLmNhbnZhcyAmJiB0aGlzLmNhbnZhcy5yZW1vdmUodGhpcyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIF9Hcm91cFJlbW92ZU5ldGl2ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzO1xuICB9XG59KTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvY29yZS9ncm91cC5leHQuanMiLCJcbnJlcXVpcmUoXCIuLy4uL21peGlucy9wcm9wb3J0aWFuYWxTaXplTWl4aW5cIik7XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLkltYWdlLnByb3RvdHlwZSxmYWJyaWMuSW1hZ2VNaXhpbiwge1xuICBhc3luYzogdHJ1ZSxcbiAgdG9PYmplY3ROYXRpdmU6IGZhYnJpYy5JbWFnZS5wcm90b3R5cGUudG9PYmplY3QsXG4gIHRvT2JqZWN0OiAgICAgZnVuY3Rpb24oKXtcbiAgICB2YXIgb2JqID0gZmFicmljLkltYWdlLnByb3RvdHlwZS50b09iamVjdE5hdGl2ZS5hcHBseSh0aGlzLGFyZ3VtZW50cyk7XG4gICAgaWYob2JqLnNyYy5pbmRleE9mKGZhYnJpYy51dGlsLm1lZGlhUm9vdCkgPT0gMCl7XG4gICAgICBvYmouc3JjID0gb2JqLnNyYy5yZXBsYWNlKGZhYnJpYy51dGlsLm1lZGlhUm9vdCxcIlwiKTtcbiAgICB9XG4gICAgcmV0dXJuIG9iajtcbiAgfSxcbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKGVsZW1lbnQsIG9wdGlvbnMsIGNhbGxiYWNrKSB7XG4gICAgb3B0aW9ucyB8fCAob3B0aW9ucyA9IHt9KTtcbiAgICB0aGlzLmZpbHRlcnMgPSBbXTtcbiAgICB0aGlzLnJlc2l6ZUZpbHRlcnMgPSBbXTtcblxuXG4gICAgaWYgKG9wdGlvbnMub3JpZ2luYWxTcmMpIHtcbiAgICAgIHRoaXMuX2VkaXRlZCA9IHRydWU7XG4gICAgICBmYWJyaWMudXRpbC5sb2FkSW1hZ2Uob3B0aW9ucy5vcmlnaW5hbFNyYywgZnVuY3Rpb24gKGltZykge1xuICAgICAgICB0aGlzLl9vcmlnaW5hbEVsZW1lbnQgPSBpbWc7XG4gICAgICB9LmJpbmQodGhpcykpO1xuICAgIH1cblxuICAgIHRoaXMuX2luaXRFbGVtZW50KGVsZW1lbnQsIG9wdGlvbnMsIGNhbGxiYWNrICYmIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZmFicmljLk9iamVjdC5wcm90b3R5cGUuaW5pdGlhbGl6ZS5jYWxsKHRoaXMsIG9wdGlvbnMsIGNhbGxiYWNrKTtcbiAgICAgIH0uYmluZCh0aGlzKSk7Ly9hZGRpbmcgY2FsbGJhY2tcbiAgfSxcblxuICBfaW5pdEVsZW1lbnQ6IGZ1bmN0aW9uIChlbGVtZW50LCBvcHRpb25zLCBjYWxsYmFjaykge1xuICAgIHRoaXMuc2V0RWxlbWVudChmYWJyaWMudXRpbC5nZXRCeUlkKGVsZW1lbnQpLCBjYWxsYmFjaywgb3B0aW9ucyk7XG4gICAgZmFicmljLnV0aWwuYWRkQ2xhc3ModGhpcy5nZXRFbGVtZW50KCksIGZhYnJpYy5JbWFnZS5DU1NfQ0FOVkFTKTtcbiAgfSxcbiAgLyoqXG4gICAqIFNldHMgY3Jvc3NPcmlnaW4gdmFsdWUgKG9uIGFuIGluc3RhbmNlIGFuZCBjb3JyZXNwb25kaW5nIGltYWdlIGVsZW1lbnQpXG4gICAqIEByZXR1cm4ge2ZhYnJpYy5JbWFnZX0gdGhpc0FyZ1xuICAgKiBAY2hhaW5hYmxlXG4gICAqL1xuICBzZXRDcm9zc09yaWdpbjogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgdGhpcy5jcm9zc09yaWdpbiA9IHZhbHVlO1xuICAgIGlmICh0aGlzLl9lbGVtZW50KSB7XG4gICAgICB0aGlzLl9lbGVtZW50LmNyb3NzT3JpZ2luID0gdmFsdWU7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9LFxuICBzZXRFbGVtZW50OiBmdW5jdGlvbiAoZWxlbWVudCwgY2FsbGJhY2ssIG9wdGlvbnMpIHtcblxuICAgIHZhciBfY2FsbGJhY2ssIF90aGlzO1xuXG4gICAgdGhpcy5fZWxlbWVudCA9IGVsZW1lbnQ7XG4gICAgdGhpcy5fb3JpZ2luYWxFbGVtZW50ID0gZWxlbWVudDtcbiAgICB0aGlzLl9pbml0Q29uZmlnKG9wdGlvbnMpO1xuICAgIC8vIHRoaXMuc2V0T3B0aW9ucyhvcHRpb25zICk7XG4gICAgLy8gdGhpcy5fc2V0V2lkdGhIZWlnaHQodGhpcyk7XG4gICAgLy8gaWYgKHRoaXMuX2VsZW1lbnQgJiYgdGhpcy5jcm9zc09yaWdpbikge1xuICAgIC8vICAgdGhpcy5fZWxlbWVudC5jcm9zc09yaWdpbiA9IHRoaXMuY3Jvc3NPcmlnaW47XG4gICAgLy8gfVxuXG5cbiAgICBpZiAodGhpcy5yZXNpemVGaWx0ZXJzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgX2NhbGxiYWNrID0gY2FsbGJhY2s7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgX3RoaXMgPSB0aGlzO1xuICAgICAgX2NhbGxiYWNrID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBfdGhpcy5hcHBseUZpbHRlcnMoY2FsbGJhY2ssIF90aGlzLnJlc2l6ZUZpbHRlcnMsIF90aGlzLl9maWx0ZXJlZEVsIHx8IF90aGlzLl9vcmlnaW5hbEVsZW1lbnQsIHRydWUpO1xuICAgICAgfTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5maWx0ZXJzLmxlbmd0aCAhPT0gMCkge1xuICAgICAgdGhpcy5hcHBseUZpbHRlcnMoX2NhbGxiYWNrKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoX2NhbGxiYWNrKSB7XG4gICAgICBfY2FsbGJhY2sodGhpcyk7XG4gICAgfVxuICAgIGlmKHRoaXMuY2FudmFzKXtcbiAgICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfSxcbiAgYWN0aW9ucyA6IHtcbiAgICBzb3VyY2U6IHtcbiAgICAgIHR5cGU6ICdlZmZlY3QnLFxuICAgICAgY2xhc3NOYW1lOiAnZmEgZmEtZmlsZS1pbWFnZS1vJyxcbiAgICAgIHRpdGxlOiBcInNvdXJjZVwiLFxuICAgICAgYWN0aW9uUGFyYW1ldGVyczogZnVuY3Rpb24gKCRlbCwgZGF0YSkge1xuICAgICAgICBkYXRhLnRhcmdldC5hcHBsaWNhdGlvbi5jcmVhdGVHYWxsZXJ5KGRhdGEudGFyZ2V0LCAkZWwpO1xuICAgICAgfVxuICAgIH1cbiAgfVxufSk7XG5cbmZhYnJpYy51dGlsLmluaXRGaWx0ZXJzID0gZnVuY3Rpb24gKGltZywgb2JqZWN0LCBjYWxsYmFjaykge1xuXG4gIC8vIGlmIChmYWJyaWMudmVyc2lvbiA+PSAxLjYpIHtcbiAgZmFicmljLkltYWdlLnByb3RvdHlwZS5faW5pdEZpbHRlcnMuY2FsbChvYmplY3QsIG9iamVjdC5maWx0ZXJzLCBmdW5jdGlvbiAoZmlsdGVycykge1xuICAgIG9iamVjdC5maWx0ZXJzID0gZmlsdGVycyB8fCBbXTtcbiAgICBmYWJyaWMuSW1hZ2UucHJvdG90eXBlLl9pbml0RmlsdGVycy5jYWxsKG9iamVjdCwgb2JqZWN0LnJlc2l6ZUZpbHRlcnMsIGZ1bmN0aW9uIChyZXNpemVGaWx0ZXJzKSB7XG4gICAgICBvYmplY3QucmVzaXplRmlsdGVycyA9IHJlc2l6ZUZpbHRlcnMgfHwgW107XG4gICAgICBjYWxsYmFjayhpbWcsIG9iamVjdCk7XG4gICAgfSk7XG4gIH0pO1xuICAvLyB9IGVsc2Uge1xuICAvLyAgIGZhYnJpYy5JbWFnZS5wcm90b3R5cGUuX2luaXRGaWx0ZXJzLmNhbGwob2JqZWN0LCBvYmplY3QsIGZ1bmN0aW9uIChmaWx0ZXJzKSB7XG4gIC8vICAgICBvYmplY3QuZmlsdGVycyA9IGZpbHRlcnMgfHwgW107XG4gIC8vICAgICBjYWxsYmFjayhpbWcsIG9iamVjdCk7XG4gIC8vICAgfSk7XG4gIC8vIH1cbn07XG5cbmZhYnJpYy51dGlsLmluaXRJbWFnZUFuZEZpbHRlcnMgPSBmdW5jdGlvbiAob2JqZWN0LCBjYWxsYmFjaykge1xuICBpZiAob2JqZWN0LmltYWdlKSB7XG4gICAgdmFyIGltZyA9IG9iamVjdC5pbWFnZTtcbiAgICBkZWxldGUgb2JqZWN0LnNyYztcbiAgICBkZWxldGUgb2JqZWN0LmltYWdlO1xuICAgIGZhYnJpYy51dGlsLmluaXRGaWx0ZXJzKGltZywgb2JqZWN0LCBjYWxsYmFjayk7XG4gIH1lbHNlIGlmIChvYmplY3Quc3JjKSB7XG4gICAgZmFicmljLnV0aWwubG9hZEltYWdlKG9iamVjdC5zcmMsIGZ1bmN0aW9uIChpbWcpIHtcbiAgICAgIC8vZGVsZXRlIG9iamVjdC5zcmM7XG4gICAgICBmYWJyaWMudXRpbC5pbml0RmlsdGVycyhpbWcsIG9iamVjdCwgY2FsbGJhY2spO1xuICAgIH0sIG51bGwsIG9iamVjdC5jcm9zc09yaWdpbik7XG4gIH0gZWxzZSB7XG4gICAgZmFicmljLnV0aWwuaW5pdEZpbHRlcnMobnVsbCwgb2JqZWN0LCBjYWxsYmFjayk7XG4gIH1cbn07XG5cbmZhYnJpYy5JbWFnZS5mcm9tT2JqZWN0ID0gZnVuY3Rpb24gKG9iamVjdCwgY2FsbGJhY2spIHtcbiAgZmFicmljLnV0aWwuaW5pdEltYWdlQW5kRmlsdGVycyhvYmplY3QsIGZ1bmN0aW9uIChpbWcsIG9iamVjdCkge1xuICAgIHZhciBpbnN0YW5jZSA9IG5ldyBmYWJyaWMuSW1hZ2UoaW1nLCBvYmplY3QsIGNhbGxiYWNrKTtcbiAgfSlcbn07XG5cblxuZmFicmljLkltYWdlLnByb3RvdHlwZS5fdG9fb2JqZWN0X292ZXJ3cml0dGVuID0gZmFicmljLkltYWdlLnByb3RvdHlwZS50b09iamVjdDtcbmZhYnJpYy5JbWFnZS5wcm90b3R5cGUuc2V0U3JjID0gZnVuY3Rpb24gKG9wdCkge1xuICBjb25zb2xlLmxvZyhvcHQpO1xufTtcblxuZmFicmljLkltYWdlLnByb3RvdHlwZS50b09iamVjdCA9IGZ1bmN0aW9uIChvcHQpIHtcbiAgdmFyIG9iaiA9IGZhYnJpYy5JbWFnZS5wcm90b3R5cGUuX3RvX29iamVjdF9vdmVyd3JpdHRlbi5jYWxsKHRoaXMsIG9wdCk7XG5cblxuICBpZiAodGhpcy5fZWRpdGVkKSB7XG4gICAgb2JqLm9yaWdpbmFsU3JjID0gdGhpcy5fb3JpZ2luYWxfc3JjIHx8IHRoaXMuX29yaWdpbmFsRWxlbWVudC5zcmMgfHwgdGhpcy5fZWxlbWVudC5zcmM7XG4gICAgb2JqLnNyYyA9IHRoaXMuX2VsZW1lbnQuc3JjO1xuICB9IGVsc2Uge1xuICAgIG9iai5zcmMgPSB0aGlzLl9vcmlnaW5hbF9zcmMgfHwgdGhpcy5fb3JpZ2luYWxFbGVtZW50LnNyYyB8fCB0aGlzLl9lbGVtZW50LnNyYztcbiAgfVxuICBpZiAodGhpcy5jb250ZW50T2Zmc2V0cykge1xuICAgIG9iai5jb250ZW50T2Zmc2V0cyA9IHRoaXMuY29udGVudE9mZnNldHM7XG4gIH1cblxuXG4gIGlmICghdGhpcy5pbmNsdWRlRGVmYXVsdFZhbHVlcykge1xuICAgIGlmICghb2JqLmZpbHRlcnMubGVuZ3RoKWRlbGV0ZSBvYmouZmlsdGVycztcbiAgfVxuICAvL2lmKHRoaXMuX29yaWdpbmFsRWxlbWVudCl7XG4gIC8vICAgIG9iai50aHVtYiA9IHRoaXMuX2VsZW1lbnQuc3JjO1xuICAvL31cblxuICByZXR1cm4gb2JqO1xufTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvY29yZS9pbWFnZS5leHQuanMiLCJcblxuZmFicmljLkFwcGxpY2F0aW9uLnByb3RvdHlwZS5jb25maWd1cmF0aW9uUHJvcGVydGllcy5wdXNoKFwidGVtcGxhdGVzXCIpO1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5BcHBsaWNhdGlvbi5wcm90b3R5cGUsIHtcbiAgc2V0VGVtcGxhdGVzOiBmdW5jdGlvbih2YWx1ZSl7XG4gICAgICB0aGlzLnRlbXBsYXRlcyA9IHZhbHVlO1xuICB9XG59KTtcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuU3RhdGljQ2FudmFzLnByb3RvdHlwZSwge1xuICBldmVudExpc3RlbmVyczogZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZEFycmF5c09iamVjdChmYWJyaWMuU3RhdGljQ2FudmFzLnByb3RvdHlwZS5ldmVudExpc3RlbmVycywge1xuICAgIFwibG9hZGluZzpiZWdpblwiOiBmdW5jdGlvbiAoZSkge1xuICAgICAgbGV0IHZhbCA9IGUub3B0aW9ucy50ZW1wbGF0ZTtcbiAgICAgIGlmKHZhbCl7XG4gICAgICAgIGxldCB0cGwgPSB0aGlzLmdldFRlbXBsYXRlKHZhbCk7XG4gICAgICAgIGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZS5vcHRpb25zLHRwbC5kYXRhKTtcbiAgICAgIH1cbiAgICB9XG4gIH0pLFxuICBzZXRUZW1wbGF0ZTogZnVuY3Rpb24odmFsdWUpe1xuICAgIHRoaXMudGVtcGxhdGUgPSB2YWx1ZTtcbiAgfSxcbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIGdldFRlbXBsYXRlOiBmdW5jdGlvbihpZCl7XG4gICAgcmV0dXJuIGZhYnJpYy51dGlsLm9iamVjdC5maW5kV2hlcmUodGhpcy5hcHBsaWNhdGlvbi50ZW1wbGF0ZXMse2lkOiBpZH0pXG4gIH0sXG4gIHVwZGF0ZVNsaWRlVGVtcGxhdGU6IGZ1bmN0aW9uKHNsaWRlKSB7XG4gICAgc2xpZGUuY2FudmFzLnNldFRlbXBsYXRlKHNsaWRlLmNhbnZhcy50ZW1wbGF0ZSk7XG4gICAgdGhpcy5jYW52YXMudGVtcGxhdGUgPSBzbGlkZS5jYW52YXMudGVtcGxhdGU7XG4gICAgaWYodGhpcy5hY3RpdmVTbGlkZSAgPT0gc2xpZGUpe1xuICAgICAgdGhpcy5jYW52YXMuc2V0VGVtcGxhdGUoc2xpZGUuY2FudmFzLnRlbXBsYXRlKTtcbiAgICB9XG4gIH0sXG4gIHVwZGF0ZVRlbXBsYXRlOiBmdW5jdGlvbih0ZW1wbGF0ZSkge1xuICAgIGZvcih2YXIgaSBpbiB0aGlzLnNsaWRlcyl7XG4gICAgICBpZih0aGlzLnNsaWRlc1tpXS5jYW52YXMudGVtcGxhdGUgPT0gdGVtcGxhdGUpe1xuICAgICAgICB0aGlzLnVwZGF0ZVNsaWRlVGVtcGxhdGUodGhpcy5zbGlkZXNbaV0pO1xuICAgICAgfVxuICAgIH1cbiAgfVxufSk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL21vZHVsZXMvc2xpZGUudGVtcGxhdGUuanMiLCIvKnRvZG9cbmZhYnJpYy5TbGlkZUNhbnZhcy5hZGRQbHVnaW4oXCJpbml0aWFsaXplXCIsZnVuY3Rpb24oKXtcbiAgaWYodHlwZW9mIHRoaXMuZnJlZURyYXdpbmdCcnVzaCA9PSBcInN0cmluZ1wiICl7XG4gICAgdGhpcy5zZXRGcmVlRHJhd2luZ0JydXNoKHRoaXMuZnJlZURyYXdpbmdCcnVzaCk7XG4gIH1cbn0pOyovXG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLlNsaWRlQ2FudmFzLnByb3RvdHlwZSx7XG4gIC8qKlxuICAgKiBbJ1BlbmNpbEJydXNoJywnUmVjdGFuZ2xlQnJ1c2gnXVxuICAgKi9cbiAgYWN0aXZlRHJhd2luZ1Rvb2xzOiBbXSxcbiAgLyoqXG4gICAqXG4gICAgIHtcbiAgICAgIEJydXNoQ2xhc3NOYW1lOiB7XG4gICAgICAgIGNsYXNzTmFtZTogJ2JydXNoIGNsYXNzTmFtZScsXG4gICAgICAgIHRpdGxlOiAnYnJ1c2ggdGl0bGUnXG4gICAgICB9XG4gICAgfVxuICAgKi9cbiAgZHJhd2luZ1Rvb2xzOiB7fSxcbiAgaW5zZXJ0RHJhd2luZ1Rvb2w6IGZhbHNlLFxuICBhY3Rpb25zOiBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUuYWN0aW9ucyx7XG4gICAgZHJhd2luZ1Rvb2w6IHtcbiAgICAgIHRpdGxlOiAnZHJhd2luZy10b29sJyxcbiAgICAgIHR5cGU6ICdvcHRpb25zJyxcbiAgICAgIHZhbHVlOiAnZnJlZURyYXdpbmdCcnVzaCcsXG4gICAgICBtZW51OiBmdW5jdGlvbigpe1xuICAgICAgICB2YXIgX3Rvb2xzID0ge307XG4gICAgICAgIGZvcih2YXIgaSBpbiB0aGlzLmFjdGl2ZURyYXdpbmdUb29scyl7XG4gICAgICAgICAgdmFyIF90b29sID0gdGhpcy5hY3RpdmVEcmF3aW5nVG9vbHNbaV07XG4gICAgICAgICAgX3Rvb2xzW190b29sXSA9IGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoe29wdGlvbjogX3Rvb2x9LHRoaXMuZHJhd2luZ1Rvb2xzW190b29sXSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIF90b29scztcbiAgICAgIH1cbiAgICB9XG4gIH0pLFxuICBmcmVlRHJhd2luZ0JydXNoOiAnUGVuY2lsQnJ1c2gnLFxuICBkcmF3aW5nQ29sb3I6IFswLDAsMCwyNTVdLFxuICBfb25Nb3VzZURvd25JbkRyYXdpbmdNb2RlOiBmdW5jdGlvbihlKSB7XG4gICAgdGhpcy5faXNDdXJyZW50bHlEcmF3aW5nID0gdHJ1ZTtcbiAgICBpZighdGhpcy5mcmVlRHJhd2luZ0JydXNoLnRhcmdldCl7XG4gICAgICB0aGlzLmRpc2NhcmRBY3RpdmVPYmplY3QoZSkucmVuZGVyQWxsKCk7XG4gICAgfVxuICAgIGlmICh0aGlzLmNsaXBUbykge1xuICAgICAgZmFicmljLnV0aWwuY2xpcENvbnRleHQodGhpcywgdGhpcy5jb250ZXh0VG9wKTtcbiAgICB9XG4gICAgdmFyIHBvaW50ZXIgPSB0aGlzLmdldFBvaW50ZXIoZSk7XG4gICAgdGhpcy5mcmVlRHJhd2luZ0JydXNoLm9uTW91c2VEb3duKHBvaW50ZXIpO1xuICAgIHRoaXMuX2hhbmRsZUV2ZW50KGUsICdkb3duJyk7XG4gIH0sXG4gIGdldEZyZWVEcmF3aW5nQnJ1c2g6IGZ1bmN0aW9uKCkge1xuICAgIGlmKCF0aGlzLmZyZWVEcmF3aW5nQnJ1c2gpe1xuICAgICAgcmV0dXJuIFwiU2VsZWN0aW9uXCI7XG4gICAgfVxuICAgIHJldHVybiAgZmFicmljLnV0aWwuc3RyaW5nLmNhcGl0YWxpemUoZmFicmljLnV0aWwuc3RyaW5nLmNhbWVsaXplKHRoaXMuZnJlZURyYXdpbmdCcnVzaC50eXBlKSx0cnVlKTtcbiAgfSxcbiAgc2V0RnJlZURyYXdpbmdCcnVzaDogZnVuY3Rpb24oYnJ1c2gpIHtcblxuICAgIGlmKGJydXNoID09ICdTZWxlY3Rpb24nKXtcbiAgICAgIHRoaXMuaXNEcmF3aW5nTW9kZSA9IGZhbHNlO1xuICAgICAgdGhpcy5mcmVlRHJhd2luZ0JydXNoID0gXCJcIjtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdmFyIGNsYXNzTmFtZSA9IGZhYnJpYy51dGlsLnN0cmluZy5jYXBpdGFsaXplKGZhYnJpYy51dGlsLnN0cmluZy5jYW1lbGl6ZShicnVzaCksdHJ1ZSk7XG4gICAgaWYodGhpc1tcIl9fXCIgKyBjbGFzc05hbWVdKXtcbiAgICAgIHRoaXMuZnJlZURyYXdpbmdCcnVzaCA9IHRoaXNbXCJfX1wiICsgY2xhc3NOYW1lXSA7XG4gICAgfWVsc2V7XG4gICAgICB0aGlzLmZyZWVEcmF3aW5nQnJ1c2ggPSB0aGlzW1wiX19cIiArIGNsYXNzTmFtZV0gPSBuZXcgIGZhYnJpY1tjbGFzc05hbWVdKHRoaXMpO1xuICAgIH1cbiAgICB0aGlzLmZpcmUoXCJicnVzaDpjaGFuZ2VkXCIse2JydXNoOiB0aGlzLmZyZWVEcmF3aW5nQnJ1c2h9KTtcbiAgfSxcbiAgZHJhd1pvb21lZEFyZWEgOiBmdW5jdGlvbihjdHgsbGVmdCwgdG9wICx3aWR0aCwgaGVpZ2h0ICwgcG9pbnRlciApIHtcblxuICAgIHdpZHRoID0gd2lkdGggfHwgOTA7XG4gICAgaGVpZ2h0ID0gaGVpZ2h0IHx8IDkwO1xuXG4gICAgY3R4LnNhdmUoKTtcbiAgICBjdHgudHJhbnNsYXRlKGxlZnQgfHwgMCwgdG9wIHx8IDApO1xuXG4gICAgY3R4LmZpbGxTdHlsZSA9ICdibGFjayc7XG4gICAgY3R4LnN0cm9rZVN0eWxlID0gXCIjZmZmXCI7XG4gICAgY3R4LnN0cm9rZVdpZHRoID0gMTtcbiAgICBjdHguc2V0TGluZURhc2goWzIsIDJdKTtcbiAgICBjdHguZHJhd0ltYWdlKHRoaXMuYmFja2dyb3VuZEltYWdlLl9lbGVtZW50LE1hdGguZmxvb3IocG9pbnRlci54KSAtIDQsIE1hdGguZmxvb3IocG9pbnRlci55KSAtIDQgLCA5ICwgOSwgMCwwICwgd2lkdGgsIHdpZHRoICk7XG4gICAgY3R4LnN0cm9rZVJlY3QoMCwwICwgd2lkdGgsIHdpZHRoKTtcbiAgICBjdHguc3Ryb2tlUmVjdCg0MCAsIDQwICwgMTAsIDEwKTtcbiAgICBjdHgucmVzdG9yZSgpO1xuICB9XG59KTtcblxuZmFicmljLlNsaWRlQ2FudmFzLnByb3RvdHlwZS5kcmF3aW5nVG9vbHMuU2VsZWN0aW9uID0ge1xuICBjbGFzc05hbWU6ICdmYSBmYS1tb3VzZS1wb2ludGVyJyxcbiAgdGl0bGU6ICdTZWxlY3Rpb24nXG59O1xuZmFicmljLlNsaWRlQ2FudmFzLnByb3RvdHlwZS5hY3RpdmVEcmF3aW5nVG9vbHMucHVzaChcIlNlbGVjdGlvblwiKTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvbW9kdWxlcy9zbGlkZS5kcmF3aW5nLXRvb2xzLmpzIiwiJ3VzZSBzdHJpY3QnO1xuaWYoIVRvb2xiYXIpe1xuICB2YXIgVG9vbGJhciA9IHJlcXVpcmUoJy4vLi4vLi4vdG9vbGJhci9zcmMvdG9vbGJhcicpO1xuICByZXF1aXJlKCcuLy4uLy4uL3Rvb2xiYXIvbW9kdWxlcy90b29sYmFyLmNvbG9ycycpO1xuICByZXF1aXJlKCcuLy4uLy4uL3Rvb2xiYXIvbW9kdWxlcy90b29sYmFyLmZvbnRzJyk7XG4gIHJlcXVpcmUoJy4vLi4vLi4vdG9vbGJhci9tb2R1bGVzL3Rvb2xiYXIub3B0aW9ucycpO1xuICByZXF1aXJlKCcuLy4uLy4uL3Rvb2xiYXIvbW9kdWxlcy90b29sYmFyLnNlbGVjdCcpO1xuICByZXF1aXJlKCcuLy4uLy4uL3Rvb2xiYXIvbW9kdWxlcy90b29sYmFyLmVmZmVjdCcpO1xufVxuXG5Ub29sYmFyLnByb3RvdHlwZS5zZXRGdW5jdGlvbkNhbGxiYWNrID0gZnVuY3Rpb24odGFyZ2V0KXtcbiAgaWYodGFyZ2V0LmNhbnZhcyl7XG4gICAgcmV0dXJuIHRhcmdldC5jYW52YXMucmVuZGVyQWxsKCk7XG4gIH1cbiAgaWYodGFyZ2V0LnJlbmRlckFsbCl7XG4gICAgcmV0dXJuIHRhcmdldC5yZW5kZXJBbGwoKVxuICB9XG59O1xuXG5cbmZhYnJpYy5Ub29sc01peGluID0ge1xuICAvKipcbiAgICpcbiAgICogQHBhcmFtIHRvb2xzIFtcInhcIiwgXCIqXCIsIFwieVwiXVxuICAgKiBAcGFyYW0gcHJvdG9cbiAgICogQHJldHVybnMgW1wieFwiLCBcImFcIiwgXCJiXCIsIFwiY1wiLCBcInlcIl1cbiAgICogQHByaXZhdGVcbiAgICovXG4gIF9nZXRUb29sczogZnVuY3Rpb24odG9vbHMscHJvdG8pe1xuICAgIHZhciBpbmRleE9mU3RhciA9IC0xO1xuICAgIGlmKChpbmRleE9mU3RhciA9IHRvb2xzLmluZGV4T2YoXCIqXCIpKSA9PSAtMSl7XG4gICAgICByZXR1cm4gdG9vbHM7XG4gICAgfVxuXG4gICAgdmFyIGtsYXNzbmFtZSA9IGZhYnJpYy51dGlsLnN0cmluZy5jYXBpdGFsaXplKGZhYnJpYy51dGlsLnN0cmluZy5jYW1lbGl6ZShwcm90by50eXBlKSx0cnVlKTtcbiAgICB2YXIgcHJvdG9GYWJyaWMgPSBmYWJyaWNba2xhc3NuYW1lXS5wcm90b3R5cGU7XG4gICAgdmFyIHByb3RvQXBwID0gdGhpcy5hcHBsaWNhdGlvbi5wcm90b3R5cGVzW2tsYXNzbmFtZV07XG5cbiAgICB2YXIgdG9vbHMyID0gcHJvdG9BcHAgJiYgcHJvdG9BcHAudG9vbHMgfHwgcHJvdG9GYWJyaWMudG9vbHM7XG4gICAgaWYodG9vbHMyKXtcbiAgICAgIHRvb2xzLnNwbGljZS5hcHBseSh0b29scywgW2luZGV4T2ZTdGFyLCAxXS5jb25jYXQodG9vbHMyKSk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLl9nZXRUb29scyh0b29scywgcHJvdG9GYWJyaWMuX19wcm90b19fICk7XG4gIH0sXG4gIHNldFRvb2xzOiBmdW5jdGlvbih0b29scyl7XG4gICAgdGhpcy50b29scyA9IHRoaXMuX2dldFRvb2xzKHRvb2xzICwgdGhpcy5fX3Byb3RvX18uX19wcm90b19fKTtcbiAgICB0aGlzLm1ha2VBY3Rpb25zKCk7XG4gIH0sXG4gIF9nZXRBY3Rpb25WYWx1ZTogZnVuY3Rpb24gKHByb3BlcnR5KSB7XG4gICAgdmFyIG9iamVjdCA9IHRoaXM7XG4gICAgZG97XG4gICAgICBpZihvYmplY3QuYWN0aW9ucyAmJiBvYmplY3QuYWN0aW9uc1twcm9wZXJ0eV0pe1xuICAgICAgICByZXR1cm4gb2JqZWN0LmFjdGlvbnNbcHJvcGVydHldO1xuICAgICAgfVxuICAgIH13aGlsZShvYmplY3QgPSBvYmplY3QuX19wcm90b19fKTtcbiAgICByZXR1cm4gbnVsbDtcbiAgfSxcbiAgbWFrZUFjdGlvbnM6IGZ1bmN0aW9uKCl7XG4gICAgdmFyIGFjdGlvbnMgPSB7fTtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgXy5lYWNoKHRoaXMudG9vbHMsIGZ1bmN0aW9uKHRvb2wpe1xuICAgICAgdmFyIF92YWwgPSBzZWxmLl9nZXRBY3Rpb25WYWx1ZSh0b29sKTtcbiAgICAgIGlmKF92YWwpe1xuICAgICAgICBhY3Rpb25zW3Rvb2xdID0gX3ZhbDtcbiAgICAgIH1lbHNle1xuICAgICAgICBjb25zb2xlLndhcm4oXCJ0b29sIFwiICsgdG9vbCArIFwiIGlzIHVuZGVmaW5lZFwiKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICB0aGlzLmdlbmVyYXRlZEFjdGlvbnMgPSBUb29sYmFyLm1ha2VBY3Rpb25zKGFjdGlvbnMsdGhpcyk7XG4gIH1cbn07XG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5DYW52YXMucHJvdG90eXBlLGZhYnJpYy5Ub29sc01peGluKTtcbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLk9iamVjdC5wcm90b3R5cGUsZmFicmljLlRvb2xzTWl4aW4pO1xuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuQXBwbGljYXRpb24ucHJvdG90eXBlLGZhYnJpYy5Ub29sc01peGluKTtcblxuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5BcHBsaWNhdGlvbi5wcm90b3R5cGUse1xuICB0b29sYmFyOiBmYWxzZSxcbiAgc2V0QXBwbGljYXRpb25Ub29sYmFyQ29udGFpbmVyOiBmdW5jdGlvbihjb250YWluZXJJZCkge1xuICAgIHRoaXMuYXBwbGljYXRpb25Ub29sYmFyQ29udGFpbmVyID0gY29udGFpbmVySWQ7XG4gICAgbmV3IGZhYnJpYy5Ub29sYmFyKHRoaXMsIGNvbnRhaW5lcklkKTtcbiAgfSxcbiAgc2V0Q2FudmFzVG9vbGJhckNvbnRhaW5lcjogZnVuY3Rpb24oY29udGFpbmVySWQpIHtcbiAgICB0aGlzLmNhbnZhc1Rvb2xiYXJDb250YWluZXIgPSBjb250YWluZXJJZDtcbiAgICBuZXcgZmFicmljLlRvb2xiYXIodGhpcy5jYW52YXMsIGNvbnRhaW5lcklkKTtcbiAgfSxcbiAgc2V0T2JqZWN0c1Rvb2xiYXJPcHRpb25zOiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgb3B0aW9ucyA9IF8uZGVmYXVsdHMob3B0aW9ucyB8fCB7XG4gICAgICBvcmlnaW5YOiBcImxlZnRcIixcbiAgICAgIG9yaWdpblk6IFwidG9wXCIsXG4gICAgICBtYXJnaW5YOiAwLFxuICAgICAgbWFyZ2luWTogMFxuICAgIH0pO1xuXG4gICAgdGhpcy5vYmplY3RzVG9vbGJhck9wdGlvbnMgPSBvcHRpb25zO1xuXG4gICAgdmFyIGNhbnZhcyA9IHRoaXMuY2FudmFzO1xuICAgIGNhbnZhcy5vbih7XG4gICAgICAnb2JqZWN0Om1vdmluZyc6IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICB2YXIgJG1lbnUgPSB0aGlzLmdldFRvb2xiYXJDb250YWluZXIoKTtcbiAgICAgICAgY2FudmFzLnNldFRvb2xiYXJDb29yZHMoJG1lbnUsIGNhbnZhcy50YXJnZXQsIGNhbnZhcy5hcHBsaWNhdGlvbi5vYmplY3RzVG9vbGJhck9wdGlvbnMpO1xuICAgICAgfVxuICAgIH0pO1xuICB9LFxuICBzZXRPYmplY3RzVG9vbGJhckNvbnRhaW5lcjogZnVuY3Rpb24oY29udGFpbmVySWQpIHtcbiAgICB0aGlzLm9iamVjdHNUb29sYmFyQ29udGFpbmVyID0gY29udGFpbmVySWQ7XG5cbiAgICB2YXIgY2FudmFzID0gdGhpcy5jYW52YXM7XG5cbiAgICBpZiAoY29udGFpbmVySWQpIHtcbiAgICAgIHRoaXMuJG1lbnUgPSAkKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGNvbnRhaW5lcklkKSkuaGlkZSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLiRtZW51ID0gdGhpcy4kbWVudSB8fCAkKCc8ZGl2PicpO1xuICAgICAgJCh0aGlzLndyYXBwZXJFbCkucHJlcGVuZCh0aGlzLiRtZW51KTtcbiAgICB9XG4gICAgdGhpcy4kbWVudS5oaWRlKCk7XG5cbiAgICB2YXIgX2xhc3RfdGFyZ2V0ID0gY2FudmFzLnRhcmdldDtcbiAgICBjYW52YXMub24oe1xuICAgICAgJ3RhcmdldDpjbGVhcmVkJzogZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIGlmIChfbGFzdF90YXJnZXQpIHtcbiAgICAgICAgICB2YXIgJG1lbnUgPSB0aGlzLmdldFRvb2xiYXJDb250YWluZXIoKTtcbiAgICAgICAgICAkbWVudS5oaWRlKCk7XG4gICAgICAgICAgY2FudmFzLm9iamVjdFRvb2xiYXIuZGVzdHJveSgpO1xuICAgICAgICAgIGRlbGV0ZSBjYW52YXMub2JqZWN0VG9vbGJhcjtcbiAgICAgICAgICBfbGFzdF90YXJnZXQgPSBudWxsO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgJ3RhcmdldDpjaGFuZ2VkJzogZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIGlmIChfbGFzdF90YXJnZXQpIHtcbiAgICAgICAgICBjYW52YXMub2JqZWN0VG9vbGJhci5kZXN0cm95KCk7XG4gICAgICAgIH1cbiAgICAgICAgY2FudmFzLmNyZWF0ZUZsb2F0ZWRNZW51KHRoaXMuYXBwbGljYXRpb24ub2JqZWN0c1Rvb2xiYXJPcHRpb25zKTtcbiAgICAgICAgX2xhc3RfdGFyZ2V0ID0gZXZlbnQudGFyZ2V0O1xuICAgICAgfVxuICAgIH0pO1xuICB9LFxuICBzZXRUb29sYmFyT3B0aW9uczogZnVuY3Rpb24odG9vbGJhck9wdGlvbnMpe1xuXG4gICAgZmFicmljLnV0aWwub2JqZWN0LmRlZXBFeHRlbmQoVG9vbGJhci50b29scywgdG9vbGJhck9wdGlvbnMudG9vbHMpO1xuICAgIGZvciAodmFyIGtsYXNzTmFtZSBpbiB0b29sYmFyT3B0aW9ucy5hY3Rpb25zKSB7XG4gICAgICB2YXIgYWN0aW9ucyA9IHRvb2xiYXJPcHRpb25zLmFjdGlvbnNba2xhc3NOYW1lXTtcbiAgICAgIGlmKCFmYWJyaWNba2xhc3NOYW1lXS5wcm90b3R5cGUuYWN0aW9ucyl7XG4gICAgICAgIGZhYnJpY1trbGFzc05hbWVdLnByb3RvdHlwZS5hY3Rpb25zID0ge31cbiAgICAgIH1cbiAgICAgIHZhciBwcm90b0FjdGlvbnMgPSBmYWJyaWNba2xhc3NOYW1lXS5wcm90b3R5cGUuYWN0aW9ucztcblxuICAgICAgaWYgKGFjdGlvbnMuY29uc3RydWN0b3IgPT0gRnVuY3Rpb24pIHtcbiAgICAgICAgYWN0aW9ucyA9IGFjdGlvbnMuY2FsbChmYWJyaWNba2xhc3NOYW1lXS5wcm90b3R5cGUpXG4gICAgICB9ZWxzZXtcbiAgICAgICAgYWN0aW9ucyA9IGZhYnJpYy51dGlsLm9iamVjdC5jbG9uZURlZXAoYWN0aW9ucyk7XG4gICAgICB9XG4gICAgIC8vIHZhciAkb3JkZXIgPSBhY3Rpb25zW1wiJG9yZGVyXCJdO1xuICAgICAvLyBkZWxldGUgYWN0aW9uc1tcIiRvcmRlclwiXTtcblxuICAgICAgZm9yICh2YXIgaiBpbiBhY3Rpb25zKSB7XG4gICAgICAgIGlmKHByb3RvQWN0aW9uc1tqXSl7XG4gICAgICAgICAgaWYgKGFjdGlvbnNbal1bXCIkY2xvbmVcIl0pIHtcbiAgICAgICAgICAgIHByb3RvQWN0aW9uc1tqXSA9IGZhYnJpYy51dGlsLm9iamVjdC5kZWVwRXh0ZW5kKHt9LCBwcm90b0FjdGlvbnNbal0pO1xuICAgICAgICAgICAgZGVsZXRlIGFjdGlvbnNbal1bXCIkY2xvbmVcIl07XG4gICAgICAgICAgfVxuICAgICAgICAgIGZhYnJpYy51dGlsLm9iamVjdC5kZWVwRXh0ZW5kKHByb3RvQWN0aW9uc1tqXSwgYWN0aW9uc1tqXSk7XG4gICAgICAgIH1lbHNle1xuICAgICAgICAgIHByb3RvQWN0aW9uc1tqXSA9IGFjdGlvbnNbal07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgLyogaWYoJG9yZGVyKXtcbiAgICAgICAgZmFicmljW2tsYXNzTmFtZV0ucHJvdG90eXBlLmFjdGlvbnMgPSBmYWJyaWMudXRpbC5vYmplY3QucmVhcnJhbmdlKHByb3RvQWN0aW9ucywgJG9yZGVyKTtcbiAgICAgIH0qL1xuICAgIH1cbiAgfSxcbiAgZXZlbnRMaXN0ZW5lcnM6IGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmRBcnJheXNPYmplY3QoZmFicmljLkFwcGxpY2F0aW9uLnByb3RvdHlwZS5ldmVudExpc3RlbmVycywge1xuICAgLy8gXCJjYW52YXM6Y3JlYXRlZFwiIDogZnVuY3Rpb24oKXtcbiAgICAvLyAgdGhpcy5pbml0VG9vbHMoKTtcbiAgIC8vIH0sXG4gICAvLyAgXCJjYW52YXM6Y3JlYXRlZFwiOiBmdW5jdGlvbigpe1xuICAgLy8gICAgdGhpcy5jcmVhdGVUb29sYmFycygpO1xuICAgLy8gIH1cbiAgfSlcbn0pO1xuXG5mYWJyaWMuVG9vbGJhciA9IFRvb2xiYXI7XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLkNhbnZhcy5wcm90b3R5cGUsIHtcbiAgc2V0VG9vbGJhckNvb3JkczogZnVuY3Rpb24gKCRtZW51LCB0YXJnZXQsIG9wdGlvbnMpIHtcblxuICAgIG9wdGlvbnMgPSBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKHtcbiAgICAgIG9yaWdpblg6IFwibGVmdFwiLFxuICAgICAgb3JpZ2luWTogXCJ0b3BcIixcbiAgICAgIG1hcmdpblg6IDAsXG4gICAgICBtYXJnaW5ZOiAwXG4gICAgfSwgb3B0aW9ucyk7XG5cbiAgICB0YXJnZXQuc2V0Q29vcmRzKCk7XG4gICAgdmFyIHIgPSB0YXJnZXQuZ2V0Qm91bmRpbmdSZWN0KCk7XG5cbiAgICB2YXIgX2xlZnQ7XG4gICAgc3dpdGNoIChvcHRpb25zLm9yaWdpblgpIHtcbiAgICAgIGNhc2UgXCJsZWZ0XCI6XG4gICAgICAgIF9sZWZ0ID0gci5sZWZ0O1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJyaWdodFwiOlxuICAgICAgICBfbGVmdCA9IHIubGVmdCArIHIud2lkdGg7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcImNlbnRlclwiOlxuICAgICAgICBfbGVmdCA9IHIubGVmdCArIHIud2lkdGggLyAyO1xuICAgICAgICBicmVhaztcbiAgICB9XG4gICAgO1xuICAgIHZhciBfdG9wO1xuICAgIHN3aXRjaCAob3B0aW9ucy5vcmlnaW5ZKSB7XG4gICAgICBjYXNlIFwidG9wXCI6XG4gICAgICAgIF90b3AgPSByLnRvcCAtICRtZW51LmhlaWdodCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJib3R0b21cIjpcbiAgICAgICAgX3RvcCA9IHIudG9wICsgci5oZWlnaHQ7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcImNlbnRlclwiOlxuICAgICAgICBfdG9wID0gci50b3AgKyByLmhlaWdodCAvIDIgLSAkbWVudS5oZWlnaHQoKSAvIDI7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgICA7XG5cblxuICAgIF90b3AgKz0gb3B0aW9ucy5tYXJnaW5ZO1xuICAgIF9sZWZ0ICs9IG9wdGlvbnMubWFyZ2luWFxuXG4gICAgdmFyIF9tZW51Q29udGFpbmVyT2Zmc2V0ID0gJCgkbWVudS5wYXJlbnRzKClbMF0pLm9mZnNldCgpO1xuICAgIHZhciBfY2FudmFzT2Zmc2V0ID0gJCh0aGlzLndyYXBwZXJFbCkub2Zmc2V0KCk7XG5cbiAgICBfdG9wICs9IF9jYW52YXNPZmZzZXQudG9wIC0gX21lbnVDb250YWluZXJPZmZzZXQudG9wO1xuICAgIF9sZWZ0ICs9IF9jYW52YXNPZmZzZXQubGVmdCAtIF9tZW51Q29udGFpbmVyT2Zmc2V0LmxlZnQ7XG5cbiAgICB2YXIgY29vcmRzID0ge1xuICAgICAgdG9wOiBNYXRoLm1heCgzLCBfdG9wKSxcbiAgICAgIGxlZnQ6IE1hdGgubWluKE1hdGgubWF4KDMsIF9sZWZ0KSwgJCh0aGlzLndyYXBwZXJFbCkud2lkdGgoKSAtICRtZW51LndpZHRoKCkgLSA1KVxuICAgIH07XG5cblxuICAgICQodGhpcy53cmFwcGVyRWwpLm9mZnNldCgpO1xuXG4gICAgJG1lbnUuY3NzKGNvb3Jkcyk7XG4gICAgcmV0dXJuIGNvb3JkcztcbiAgfSxcbiAgZ2V0VG9vbGJhckNvbnRhaW5lcjogZnVuY3Rpb24gKGlkLCBvcHRpb25zKSB7XG4gICAgcmV0dXJuICQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy5hcHBsaWNhdGlvbi5vYmplY3RzVG9vbGJhckNvbnRhaW5lcikpO1xuICB9LFxuICBjcmVhdGVGbG9hdGVkTWVudTogZnVuY3Rpb24gKG9wdGlvbnMpIHtcblxuICAgIHZhciAkbWVudSA9IHRoaXMuZ2V0VG9vbGJhckNvbnRhaW5lcigpO1xuXG4gICAgJG1lbnUuc2hvdygpO1xuICAgIC8vdGhpcy50b29sc0NvbnRhaW5lciA9IHRoaXMuJG1lbnU7XG4gICAvKiB2YXIgX3RjID0gJG1lbnUuZmluZChcIi50b29sYmFyLXRvb2xzLWNvbnRhaW5lclwiKTtcbiAgICBpZiAoX3RjLmxlbmd0aCkge1xuICAgICAgdGhpcy50b29sc0NvbnRhaW5lciA9IF90YztcbiAgICB9Ki9cbiAgIC8vIHRoaXMudG9vbHNDb250YWluZXIuZW1wdHkoKTtcbiAgICBpZiAodGhpcy50YXJnZXQuYWN0aW9ucykge1xuICAgICAgdGhpcy5vYmplY3RUb29sYmFyID0gbmV3IGZhYnJpYy5Ub29sYmFyICh0aGlzLnRhcmdldCwgJG1lbnUsIG9wdGlvbnMpO1xuICAgIH1cbiAgICBpZih0aGlzLmFwcGxpY2F0aW9uLm9iamVjdHNUb29sYmFyT3B0aW9ucyl7XG4gICAgICAkbWVudS5jc3Moe1xuICAgICAgICBcInBvc2l0aW9uXCI6IFwiYWJzb2x1dGVcIixcbiAgICAgICAgXCJ6LWluZGV4XCI6IDk5OVxuICAgICAgfSk7XG4gICAgICAkbWVudS5hZGRDbGFzcyhcImZsb2F0ZWQtbWVudVwiKTtcbiAgICAgIHRoaXMuc2V0VG9vbGJhckNvb3JkcygkbWVudSwgdGhpcy50YXJnZXQsIHRoaXMuYXBwbGljYXRpb24ub2JqZWN0c1Rvb2xiYXJPcHRpb25zKTtcblxuICAgIH1cbiAgfVxufSk7XG5cblxuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9tb2R1bGVzL3Rvb2xiYXIuanMiLCJpZighJC5taW5pY29sb3JzKXtcbiAgICByZXF1aXJlKFwiLi4vLi4vcGx1Z2lucy8kLm1pbmljb2xvcnNcIik7XG59XG5cbmlmKHR5cGVvZiBUb29sYmFyID09PSBcInVuZGVmaW5lZFwiKXtcbiAgdmFyIFRvb2xiYXIgPSByZXF1aXJlKFwiLi4vc3JjL3Rvb2xiYXJcIik7XG59XG5cblRvb2xiYXIucHJvdG90eXBlLmNvbG9ycGlja2VyID0gZnVuY3Rpb24gKGVsLCBvcHRpb25zKSB7XG4gIG9wdGlvbnMuZm9ybWF0ID0gJ3JnYic7XG4gIG9wdGlvbnMub3BhY2l0eSA9IHRydWU7XG4gIGVsLm1pbmljb2xvcnMob3B0aW9ucyk7XG59O1xuXG5Ub29sYmFyLnByb3RvdHlwZS5jb2xvcnBpY2tlck9wdGlvbnMgPSB7XG4gIHBvc2l0aW9uOiBcInJpZ2h0IGJvdHRvbVwiXG59O1xuXG5Ub29sYmFyLnByb3RvdHlwZS50b29scy5jb2xvciA9IHtcbiAgdGVtcGxhdGU6XG4gICAgJzxkaXYgY2xhc3M9XCJvYmplY3QtbWVudS1pdGVtXCIgdGl0bGU9XCJ7dGl0bGV9XCI+JyArXG4gICAgJzxkaXYgY2xhc3M9XCJidG4gYnV0dG9uLXtpZH0ge2NsYXNzTmFtZX1cIj4nICtcbiAgICAnPGlucHV0IHR5cGU9XCJ0ZXh0XCIgZGF0YS1mb3JtYXQ9XCJyZ2JhXCIgZGF0YS1vcGFjaXR5PVwidHJ1ZVwiIGRhdGEtdGV4dD1cInRydWVcIiBkYXRhLWNvbnRyb2w9XCJzYXR1cmF0aW9uXCIgZGF0YS1zd2F0Y2hlcz1cIiNmZmZ8IzAwMHwjZjAwfCMwZjB8IzAwZnwjZmYwfCMwZmZcIiAgdmFsdWU9XCJ7dmFsdWVDdXJyZW50fVwiIHRyYW5zY2x1ZGU+JyxcbiAgcG9zdDogZnVuY3Rpb24gKCRpdGVtLCBkYXRhLCBvcHRpb25zLCB0cmFuc2NsdWRlKSB7XG4gICAgdmFyIHRhcmdldCA9IGRhdGEudGFyZ2V0O1xuXG4gICAgdmFyIF92aXNpYmxlID0gZmFsc2U7XG4gICAgdGhpcy5jb2xvcnBpY2tlcih0cmFuc2NsdWRlLCB7XG4gICAgICAvLyB2YWx1ZTogICAgICAgIGRhdGEudmFsdWUuZ2V0KCkgLC8vfHwgZGF0YS52YWx1ZS5nZXQoKSxcbiAgICAgIGRlZmF1bHRWYWx1ZTogLypkYXRhLnZhbHVlLmRlZmF1bHRWYWx1ZSB8fCovIGRhdGEudmFsdWUuZ2V0KCksXG4gICAgICBjb250cm9sOiAgICAgIHRyYW5zY2x1ZGUuYXR0cignZGF0YS1jb250cm9sJykgfHwgJ2h1ZScsXG4gICAgICBmb3JtYXQ6ICAgICAgIHRyYW5zY2x1ZGUuYXR0cignZGF0YS1mb3JtYXQnKSB8fCAnaGV4JyxcbiAgICAgIGtleXdvcmRzOiAgICAgdHJhbnNjbHVkZS5hdHRyKCdkYXRhLWtleXdvcmRzJykgfHwgJycsXG4gICAgICBpbmxpbmU6ICAgICAgIHRyYW5zY2x1ZGUuYXR0cignZGF0YS1pbmxpbmUnKSA9PT0gJ3RydWUnLFxuICAgICAgbGV0dGVyQ2FzZTogICB0cmFuc2NsdWRlLmF0dHIoJ2RhdGEtbGV0dGVyQ2FzZScpIHx8ICdsb3dlcmNhc2UnLFxuICAgICAgb3BhY2l0eTogICAgICB0cmFuc2NsdWRlLmF0dHIoJ2RhdGEtb3BhY2l0eScpLFxuICAgICAgcG9zaXRpb246ICAgICB0cmFuc2NsdWRlLmF0dHIoJ2RhdGEtcG9zaXRpb24nKSB8fCB0aGlzLmNvbG9ycGlja2VyT3B0aW9ucy5wb3NpdGlvbixcbiAgICAgIHN3YXRjaGVzOiAgICAgdHJhbnNjbHVkZS5hdHRyKCdkYXRhLXN3YXRjaGVzJykgPyB0cmFuc2NsdWRlLmF0dHIoJ2RhdGEtc3dhdGNoZXMnKS5zcGxpdCgnfCcpIDogW10sXG4gICAgICB0ZXh0OiAgICAgdHJhbnNjbHVkZS5hdHRyKCdkYXRhLXRleHQnKSxcbiAgICAgIGhpZGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgX3Zpc2libGUgPSBmYWxzZVxuICAgICAgfSxcbiAgICAgIHNob3c6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgX3Zpc2libGUgPSB0cnVlO1xuICAgICAgfSxcbiAgICAgIGNoYW5nZTogZnVuY3Rpb24gKHZhbHVlLCBvcGFjaXR5KSB7XG4gICAgICAgIGRhdGEudmFsdWUuc2V0KHZhbHVlKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHZhciBfZWwgPSAkKHRyYW5zY2x1ZGUucGFyZW50cygpWzBdKS5maW5kKFwiLm1pbmljb2xvcnMtcGFuZWxcIik7XG5cbiAgICB2YXIgX0hJREUgPSBmdW5jdGlvbihlKXtcbiAgICAgIGlmKF92aXNpYmxlICYmICQoZS50YXJnZXQpLnBhcmVudHMoKS5pbmRleChfZWwpID09IC0xKXtcbiAgICAgICAgdHJhbnNjbHVkZS5taW5pY29sb3JzKFwiaGlkZVwiKTtcbiAgICAgIH1cbiAgICB9O1xuICAgICQoXCJib2R5XCIpLm9uKFwibW91c2Vkb3duXCIsX0hJREUpXG4gIH1cbn07XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gdG9vbGJhci9tb2R1bGVzL3Rvb2xiYXIuY29sb3JzLmpzIiwiLypcbiAqIGpRdWVyeSBNaW5pQ29sb3JzOiBBIHRpbnkgY29sb3IgcGlja2VyIGJ1aWx0IG9uIGpRdWVyeVxuICpcbiAqIENvcHlyaWdodDogQ29yeSBMYVZpc2thIGZvciBBIEJlYXV0aWZ1bCBTaXRlLCBMTEM6IGh0dHA6Ly93d3cuYWJlYXV0aWZ1bHNpdGUubmV0L1xuICpcbiAqIENvbnRyaWJ1dGU6IGh0dHBzOi8vZ2l0aHViLmNvbS9jbGF2aXNrYS9qcXVlcnktbWluaWNvbG9yc1xuICpcbiAqIEBsaWNlbnNlOiBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvTUlUXG4gKlxuICovXG5cblxuXG4oZnVuY3Rpb24gKGZhY3RvcnkpIHtcbiAgaWYgKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0Jykge1xuICAgIG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeShyZXF1aXJlKCdqcXVlcnknKSk7XG4gIH0gZWxzZSB7XG4gICAgZmFjdG9yeShqUXVlcnkpO1xuICB9XG59KFxuICBmdW5jdGlvbiAoJCkge1xuXG4gICAgJ3VzZSBzdHJpY3QnO1xuICAgIC8vaWYoXyAmJiBfLnN0eWxlU2hlZXRDb250YWlucyAmJiAhXy5zdHlsZVNoZWV0Q29udGFpbnMoJy5taW5pY29sb3JzJykpe1xuICAgIC8vICBfLmxpbmtDU1MoXy5zY3JpcHRVUkwoKSArIFwiLy4uLy4uL2Nzcy9qcXVlcnkubWluaWNvbG9ycy5jc3NcIik7XG4gICAgLy99XG5cbiAgICAvLyBEZWZhdWx0c1xuICAgICQubWluaWNvbG9ycyA9IHtcbiAgICAgIGRlZmF1bHRzOiB7XG4gICAgICAgIGFuaW1hdGlvblNwZWVkOiA1MCxcbiAgICAgICAgYW5pbWF0aW9uRWFzaW5nOiAnc3dpbmcnLFxuICAgICAgICBjaGFuZ2U6IG51bGwsXG4gICAgICAgIGNoYW5nZURlbGF5OiAwLFxuICAgICAgICBjb250cm9sOiAnaHVlJyxcbiAgICAgICAgZGF0YVVyaXM6IHRydWUsXG4gICAgICAgIGRlZmF1bHRWYWx1ZTogJycsXG4gICAgICAgIGZvcm1hdDogJ2hleCcsXG4gICAgICAgIGhpZGU6IG51bGwsXG4gICAgICAgIGhpZGVTcGVlZDogMTAwLFxuICAgICAgICBpbmxpbmU6IGZhbHNlLFxuICAgICAgICBrZXl3b3JkczogJycsXG4gICAgICAgIGxldHRlckNhc2U6ICdsb3dlcmNhc2UnLFxuICAgICAgICBvcGFjaXR5OiBmYWxzZSxcbiAgICAgICAgcG9zaXRpb246ICdib3R0b20gbGVmdCcsXG4gICAgICAgIHNob3c6IG51bGwsXG4gICAgICAgIHNob3dTcGVlZDogMTAwLFxuICAgICAgICB0aGVtZTogJ2RlZmF1bHQnLFxuICAgICAgICBzd2F0Y2hlczogW11cbiAgICAgIH1cbiAgICB9O1xuXG4gICAgLy8gUHVibGljIG1ldGhvZHNcbiAgICAkLmV4dGVuZCgkLmZuLCB7XG4gICAgICBtaW5pY29sb3JzOiBmdW5jdGlvbihtZXRob2QsIGRhdGEpIHtcblxuICAgICAgICBzd2l0Y2gobWV0aG9kKSB7XG5cbiAgICAgICAgICAvLyBEZXN0cm95IHRoZSBjb250cm9sXG4gICAgICAgICAgY2FzZSAnZGVzdHJveSc6XG4gICAgICAgICAgICAkKHRoaXMpLmVhY2goIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICBkZXN0cm95KCQodGhpcykpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gJCh0aGlzKTtcblxuICAgICAgICAgIC8vIEhpZGUgdGhlIGNvbG9yIHBpY2tlclxuICAgICAgICAgIGNhc2UgJ2hpZGUnOlxuICAgICAgICAgICAgaGlkZSgpO1xuICAgICAgICAgICAgcmV0dXJuICQodGhpcyk7XG5cbiAgICAgICAgICAvLyBHZXQvc2V0IG9wYWNpdHlcbiAgICAgICAgICBjYXNlICdvcGFjaXR5JzpcbiAgICAgICAgICAgIC8vIEdldHRlclxuICAgICAgICAgICAgaWYoIGRhdGEgPT09IHVuZGVmaW5lZCApIHtcbiAgICAgICAgICAgICAgLy8gR2V0dGVyXG4gICAgICAgICAgICAgIHJldHVybiAkKHRoaXMpLmF0dHIoJ2RhdGEtb3BhY2l0eScpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgLy8gU2V0dGVyXG4gICAgICAgICAgICAgICQodGhpcykuZWFjaCggZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdXBkYXRlRnJvbUlucHV0KCQodGhpcykuYXR0cignZGF0YS1vcGFjaXR5JywgZGF0YSkpO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiAkKHRoaXMpO1xuXG4gICAgICAgICAgLy8gR2V0IGFuIFJHQihBKSBvYmplY3QgYmFzZWQgb24gdGhlIGN1cnJlbnQgY29sb3Ivb3BhY2l0eVxuICAgICAgICAgIGNhc2UgJ3JnYk9iamVjdCc6XG4gICAgICAgICAgICByZXR1cm4gcmdiT2JqZWN0KCQodGhpcyksIG1ldGhvZCA9PT0gJ3JnYmFPYmplY3QnKTtcblxuICAgICAgICAgIC8vIEdldCBhbiBSR0IoQSkgc3RyaW5nIGJhc2VkIG9uIHRoZSBjdXJyZW50IGNvbG9yL29wYWNpdHlcbiAgICAgICAgICBjYXNlICdyZ2JTdHJpbmcnOlxuICAgICAgICAgIGNhc2UgJ3JnYmFTdHJpbmcnOlxuICAgICAgICAgICAgcmV0dXJuIHJnYlN0cmluZygkKHRoaXMpLCBtZXRob2QgPT09ICdyZ2JhU3RyaW5nJyk7XG5cbiAgICAgICAgICAvLyBHZXQvc2V0IHNldHRpbmdzIG9uIHRoZSBmbHlcbiAgICAgICAgICBjYXNlICdzZXR0aW5ncyc6XG4gICAgICAgICAgICBpZiggZGF0YSA9PT0gdW5kZWZpbmVkICkge1xuICAgICAgICAgICAgICByZXR1cm4gJCh0aGlzKS5kYXRhKCdtaW5pY29sb3JzLXNldHRpbmdzJyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAvLyBTZXR0ZXJcbiAgICAgICAgICAgICAgJCh0aGlzKS5lYWNoKCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSAkKHRoaXMpLmRhdGEoJ21pbmljb2xvcnMtc2V0dGluZ3MnKSB8fCB7fTtcbiAgICAgICAgICAgICAgICBkZXN0cm95KCQodGhpcykpO1xuICAgICAgICAgICAgICAgICQodGhpcykubWluaWNvbG9ycygkLmV4dGVuZCh0cnVlLCBzZXR0aW5ncywgZGF0YSkpO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiAkKHRoaXMpO1xuXG4gICAgICAgICAgLy8gU2hvdyB0aGUgY29sb3IgcGlja2VyXG4gICAgICAgICAgY2FzZSAnc2hvdyc6XG4gICAgICAgICAgICBzaG93KCAkKHRoaXMpLmVxKDApICk7XG4gICAgICAgICAgICByZXR1cm4gJCh0aGlzKTtcblxuICAgICAgICAgIC8vIEdldC9zZXQgdGhlIGhleCBjb2xvciB2YWx1ZVxuICAgICAgICAgIGNhc2UgJ3ZhbHVlJzpcbiAgICAgICAgICAgIGlmKCBkYXRhID09PSB1bmRlZmluZWQgKSB7XG4gICAgICAgICAgICAgIC8vIEdldHRlclxuICAgICAgICAgICAgICByZXR1cm4gJCh0aGlzKS52YWwoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIC8vIFNldHRlclxuICAgICAgICAgICAgICAkKHRoaXMpLmVhY2goIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGlmKCB0eXBlb2YoZGF0YSkgPT09ICdvYmplY3QnICkge1xuICAgICAgICAgICAgICAgICAgaWYoIGRhdGEub3BhY2l0eSApIHtcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5hdHRyKCdkYXRhLW9wYWNpdHknLCBrZWVwV2l0aGluKGRhdGEub3BhY2l0eSwgMCwgMSkpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgaWYoIGRhdGEuY29sb3IgKSB7XG4gICAgICAgICAgICAgICAgICAgICQodGhpcykudmFsKGRhdGEuY29sb3IpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAkKHRoaXMpLnZhbChkYXRhKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdXBkYXRlRnJvbUlucHV0KCQodGhpcykpO1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiAkKHRoaXMpO1xuXG4gICAgICAgICAgLy8gSW5pdGlhbGl6ZXMgdGhlIGNvbnRyb2xcbiAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgaWYoIG1ldGhvZCAhPT0gJ2NyZWF0ZScgKSBkYXRhID0gbWV0aG9kO1xuICAgICAgICAgICAgJCh0aGlzKS5lYWNoKCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgaW5pdCgkKHRoaXMpLCBkYXRhKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgcmV0dXJuICQodGhpcyk7XG5cbiAgICAgICAgfVxuXG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB2YXIgaW5wdXRUZXh0LCBnbG9iYWxTZXR0aW5ncywgZ2xvYmFsVGFyZ2V0ICwgZ2xvYmFsSW5wdXQgO1xuICAgIC8vIEluaXRpYWxpemUgaW5wdXQgZWxlbWVudHNcbiAgICBmdW5jdGlvbiBpbml0KGlucHV0LCBzZXR0aW5ncykge1xuXG4gICAgICB2YXIgbWluaWNvbG9ycyA9ICQoJzxkaXYgY2xhc3M9XCJtaW5pY29sb3JzXCIgLz4nKSxcbiAgICAgICAgZGVmYXVsdHMgPSAkLm1pbmljb2xvcnMuZGVmYXVsdHMsXG4gICAgICAgIHNpemUsXG4gICAgICAgIHN3YXRjaGVzLFxuICAgICAgICB0ZXh0UGFuZWwsXG4gICAgICAgIHN3YXRjaCxcbiAgICAgICAgcGFuZWwsXG4gICAgICAgIGdsb2JhbFRhcmdldCA9IGlucHV0LFxuICAgICAgICBpO1xuXG4gICAgICAvLyBEbyBub3RoaW5nIGlmIGFscmVhZHkgaW5pdGlhbGl6ZWRcbiAgICAgIGlmKCBpbnB1dC5kYXRhKCdtaW5pY29sb3JzLWluaXRpYWxpemVkJykgKSByZXR1cm47XG5cbiAgICAgIC8vIEhhbmRsZSBzZXR0aW5nc1xuICAgICAgZ2xvYmFsU2V0dGluZ3MgPSBzZXR0aW5ncyA9ICQuZXh0ZW5kKHRydWUsIHt9LCBkZWZhdWx0cywgc2V0dGluZ3MpO1xuXG4gICAgICAvLyBUaGUgd3JhcHBlclxuICAgICAgbWluaWNvbG9yc1xuICAgICAgICAuYWRkQ2xhc3MoJ21pbmljb2xvcnMtdGhlbWUtJyArIHNldHRpbmdzLnRoZW1lKVxuICAgICAgICAudG9nZ2xlQ2xhc3MoJ21pbmljb2xvcnMtd2l0aC1vcGFjaXR5Jywgc2V0dGluZ3Mub3BhY2l0eSlcbiAgICAgICAgLnRvZ2dsZUNsYXNzKCdtaW5pY29sb3JzLW5vLWRhdGEtdXJpcycsIHNldHRpbmdzLmRhdGFVcmlzICE9PSB0cnVlKTtcblxuICAgICAgLy8gQ3VzdG9tIHBvc2l0aW9uaW5nXG4gICAgICBpZiggc2V0dGluZ3MucG9zaXRpb24gIT09IHVuZGVmaW5lZCApIHtcbiAgICAgICAgJC5lYWNoKHNldHRpbmdzLnBvc2l0aW9uLnNwbGl0KCcgJyksIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIG1pbmljb2xvcnMuYWRkQ2xhc3MoJ21pbmljb2xvcnMtcG9zaXRpb24tJyArIHRoaXMpO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gSW5wdXQgc2l6ZVxuICAgICAgaWYoIHNldHRpbmdzLmZvcm1hdCA9PT0gJ3JnYicgKSB7XG4gICAgICAgIHNpemUgPSBzZXR0aW5ncy5vcGFjaXR5ID8gJzI1JyA6ICcyMCc7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzaXplID0gc2V0dGluZ3Mua2V5d29yZHMgPyAnMTEnIDogJzcnO1xuICAgICAgfVxuICAgICAgIGdsb2JhbElucHV0ID0gaW5wdXQ7XG4gICAgICAvLyBUaGUgaW5wdXRcbiAgICAgIGlucHV0XG4gICAgICAgIC5hZGRDbGFzcygnbWluaWNvbG9ycy1pbnB1dCcpXG4gICAgICAgIC5kYXRhKCdtaW5pY29sb3JzLWluaXRpYWxpemVkJywgZmFsc2UpXG4gICAgICAgIC5kYXRhKCdtaW5pY29sb3JzLXNldHRpbmdzJywgc2V0dGluZ3MpXG4gICAgICAgIC5wcm9wKCdzaXplJywgc2l6ZSlcbiAgICAgICAgLndyYXAobWluaWNvbG9ycylcbiAgICAgICAgLmFmdGVyKFxuICAgICAgICAnPGRpdiBjbGFzcz1cIm1pbmljb2xvcnMtcGFuZWwgbWluaWNvbG9ycy1zbGlkZXItJyArIHNldHRpbmdzLmNvbnRyb2wgKyAnXCI+JyArXG4gICAgICAgICc8ZGl2IGNsYXNzPVwibWluaWNvbG9ycy1zbGlkZXIgbWluaWNvbG9ycy1zcHJpdGVcIj4nICtcbiAgICAgICAgJzxkaXYgY2xhc3M9XCJtaW5pY29sb3JzLXBpY2tlclwiPjwvZGl2PicgK1xuICAgICAgICAnPC9kaXY+JyArXG4gICAgICAgICc8ZGl2IGNsYXNzPVwibWluaWNvbG9ycy1vcGFjaXR5LXNsaWRlciBtaW5pY29sb3JzLXNwcml0ZVwiPicgK1xuICAgICAgICAnPGRpdiBjbGFzcz1cIm1pbmljb2xvcnMtcGlja2VyXCI+PC9kaXY+JyArXG4gICAgICAgICc8L2Rpdj4nICtcbiAgICAgICAgJzxkaXYgY2xhc3M9XCJtaW5pY29sb3JzLWdyaWQgbWluaWNvbG9ycy1zcHJpdGVcIj4nICtcbiAgICAgICAgJzxkaXYgY2xhc3M9XCJtaW5pY29sb3JzLWdyaWQtaW5uZXJcIj48L2Rpdj4nICtcbiAgICAgICAgJzxkaXYgY2xhc3M9XCJtaW5pY29sb3JzLXBpY2tlclwiPjxkaXY+PC9kaXY+PC9kaXY+JyArXG4gICAgICAgICc8L2Rpdj4nICtcbiAgICAgICAgJzwvZGl2PidcbiAgICAgICk7XG5cbiAgICAgIC8vIFRoZSBzd2F0Y2hcbiAgICAgIGlmKCAhc2V0dGluZ3MuaW5saW5lICkge1xuICAgICAgICBpbnB1dC5hZnRlcignPHNwYW4gY2xhc3M9XCJtaW5pY29sb3JzLXN3YXRjaCBtaW5pY29sb3JzLXNwcml0ZSBtaW5pY29sb3JzLWlucHV0LXN3YXRjaFwiPjxzcGFuIGNsYXNzPVwibWluaWNvbG9ycy1zd2F0Y2gtY29sb3JcIj48L3NwYW4+PC9zcGFuPicpO1xuICAgICAgICBpbnB1dC5uZXh0KCcubWluaWNvbG9ycy1pbnB1dC1zd2F0Y2gnKS5vbignY2xpY2snLCBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgaW5wdXQuZm9jdXMoKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIFByZXZlbnQgdGV4dCBzZWxlY3Rpb24gaW4gSUVcbiAgICAgIHBhbmVsID0gaW5wdXQucGFyZW50KCkuZmluZCgnLm1pbmljb2xvcnMtcGFuZWwnKTtcbiAgICAgIHBhbmVsLm9uKCdzZWxlY3RzdGFydCcsIGZ1bmN0aW9uKCkgeyByZXR1cm4gZmFsc2U7IH0pLmVuZCgpO1xuXG4gICAgICAvLyBTd2F0Y2hlc1xuICAgICAgaWYgKHNldHRpbmdzLnN3YXRjaGVzICYmIHNldHRpbmdzLnN3YXRjaGVzLmxlbmd0aCAhPT0gMCkge1xuICAgICAgICBpZiAoc2V0dGluZ3Muc3dhdGNoZXMubGVuZ3RoID4gNykge1xuICAgICAgICAgIHNldHRpbmdzLnN3YXRjaGVzLmxlbmd0aCA9IDc7XG4gICAgICAgIH1cbiAgICAgICAgcGFuZWwuYWRkQ2xhc3MoJ21pbmljb2xvcnMtd2l0aC1zd2F0Y2hlcycpO1xuICAgICAgICBzd2F0Y2hlcyA9ICQoJzx1bCBjbGFzcz1cIm1pbmljb2xvcnMtc3dhdGNoZXNcIj48L3VsPicpXG4gICAgICAgICAgLmFwcGVuZFRvKHBhbmVsKTtcbiAgICAgICAgZm9yKGkgPSAwOyBpIDwgc2V0dGluZ3Muc3dhdGNoZXMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICBzd2F0Y2ggPSBzZXR0aW5ncy5zd2F0Y2hlc1tpXTtcbiAgICAgICAgICBzd2F0Y2ggPSBpc1JnYihzd2F0Y2gpID8gcGFyc2VSZ2Ioc3dhdGNoLCB0cnVlKSA6IGhleDJyZ2IocGFyc2VIZXgoc3dhdGNoLCB0cnVlKSk7XG4gICAgICAgICAgJCgnPGxpIGNsYXNzPVwibWluaWNvbG9ycy1zd2F0Y2ggbWluaWNvbG9ycy1zcHJpdGVcIj48c3BhbiBjbGFzcz1cIm1pbmljb2xvcnMtc3dhdGNoLWNvbG9yXCI+PC9zcGFuPjwvbGk+JylcbiAgICAgICAgICAgIC5hcHBlbmRUbyhzd2F0Y2hlcylcbiAgICAgICAgICAgIC5kYXRhKCdzd2F0Y2gtY29sb3InLCBzZXR0aW5ncy5zd2F0Y2hlc1tpXSlcbiAgICAgICAgICAgIC5maW5kKCcubWluaWNvbG9ycy1zd2F0Y2gtY29sb3InKVxuICAgICAgICAgICAgLmNzcyh7XG4gICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogcmdiMmhleChzd2F0Y2gpLFxuICAgICAgICAgICAgICBvcGFjaXR5OiBzd2F0Y2guYVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgc2V0dGluZ3Muc3dhdGNoZXNbaV0gPSBzd2F0Y2g7XG4gICAgICAgIH1cblxuICAgICAgfVxuXG5cbiAgICAgIC8vIFN3YXRjaGVzXG4gICAgICBpZiAoc2V0dGluZ3MudGV4dCkge1xuICAgICAgICBwYW5lbC5hZGRDbGFzcygnbWluaWNvbG9ycy13aXRoLXRleHQnKTtcbiAgICAgICAgdGV4dFBhbmVsID0gJCgnPGRpdiBjbGFzcz1cIm1pbmljb2xvcnMtdGV4dFwiPjwvZGl2PicpXG4gICAgICAgICAgLmFwcGVuZFRvKHBhbmVsKTtcbiAgICAgICAgaW5wdXRUZXh0ID0gJCgnPGlucHV0IHR5cGU9XCJ0ZXh0XCI+JylcbiAgICAgICAgICAuYXBwZW5kVG8odGV4dFBhbmVsKTtcblxuICAgICAgICAkKGlucHV0VGV4dCkuY2hhbmdlKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgaW5wdXQudmFsKGlucHV0VGV4dC52YWwoKSk7XG4gICAgICAgICAgdXBkYXRlRnJvbUlucHV0KGlucHV0LCB0cnVlKTtcbiAgICAgICAgfSlcblxuICAgICAgfVxuXG4gICAgICAvLyBJbmxpbmUgY29udHJvbHNcbiAgICAgIGlmKCBzZXR0aW5ncy5pbmxpbmUgKSBpbnB1dC5wYXJlbnQoKS5hZGRDbGFzcygnbWluaWNvbG9ycy1pbmxpbmUnKTtcblxuICAgICAgdXBkYXRlRnJvbUlucHV0KGlucHV0LCBmYWxzZSk7XG5cbiAgICAgIGlucHV0LmRhdGEoJ21pbmljb2xvcnMtaW5pdGlhbGl6ZWQnLCB0cnVlKTtcblxuICAgIH1cblxuICAgIC8vIFJldHVybnMgdGhlIGlucHV0IGJhY2sgdG8gaXRzIG9yaWdpbmFsIHN0YXRlXG4gICAgZnVuY3Rpb24gZGVzdHJveShpbnB1dCkge1xuXG4gICAgICB2YXIgbWluaWNvbG9ycyA9IGlucHV0LnBhcmVudCgpO1xuXG4gICAgICAvLyBSZXZlcnQgdGhlIGlucHV0IGVsZW1lbnRcbiAgICAgIGlucHV0XG4gICAgICAgIC5yZW1vdmVEYXRhKCdtaW5pY29sb3JzLWluaXRpYWxpemVkJylcbiAgICAgICAgLnJlbW92ZURhdGEoJ21pbmljb2xvcnMtc2V0dGluZ3MnKVxuICAgICAgICAucmVtb3ZlUHJvcCgnc2l6ZScpXG4gICAgICAgIC5yZW1vdmVDbGFzcygnbWluaWNvbG9ycy1pbnB1dCcpO1xuXG4gICAgICAvLyBSZW1vdmUgdGhlIHdyYXAgYW5kIGRlc3Ryb3kgd2hhdGV2ZXIgcmVtYWluc1xuICAgICAgbWluaWNvbG9ycy5iZWZvcmUoaW5wdXQpLnJlbW92ZSgpO1xuXG4gICAgfVxuXG4gICAgLy8gU2hvd3MgdGhlIHNwZWNpZmllZCBkcm9wZG93biBwYW5lbFxuICAgIGZ1bmN0aW9uIHNob3coaW5wdXQpIHtcblxuICAgICAgdmFyIG1pbmljb2xvcnMgPSBpbnB1dC5wYXJlbnQoKSxcbiAgICAgICAgcGFuZWwgPSBtaW5pY29sb3JzLmZpbmQoJy5taW5pY29sb3JzLXBhbmVsJyksXG4gICAgICAgIHNldHRpbmdzID0gaW5wdXQuZGF0YSgnbWluaWNvbG9ycy1zZXR0aW5ncycpO1xuXG4gICAgICAvLyBEbyBub3RoaW5nIGlmIHVuaW5pdGlhbGl6ZWQsIGRpc2FibGVkLCBpbmxpbmUsIG9yIGFscmVhZHkgb3BlblxuICAgICAgaWYoICFpbnB1dC5kYXRhKCdtaW5pY29sb3JzLWluaXRpYWxpemVkJykgfHxcbiAgICAgICAgaW5wdXQucHJvcCgnZGlzYWJsZWQnKSB8fFxuICAgICAgICBtaW5pY29sb3JzLmhhc0NsYXNzKCdtaW5pY29sb3JzLWlubGluZScpIHx8XG4gICAgICAgIG1pbmljb2xvcnMuaGFzQ2xhc3MoJ21pbmljb2xvcnMtZm9jdXMnKVxuICAgICAgKSByZXR1cm47XG5cbiAgICAgIGhpZGUoKTtcblxuICAgICAgbWluaWNvbG9ycy5hZGRDbGFzcygnbWluaWNvbG9ycy1mb2N1cycpO1xuICAgICAgcGFuZWxcbiAgICAgICAgLnN0b3AodHJ1ZSwgdHJ1ZSlcbiAgICAgICAgLmZhZGVJbihzZXR0aW5ncy5zaG93U3BlZWQsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGlmKCBzZXR0aW5ncy5zaG93ICkgc2V0dGluZ3Muc2hvdy5jYWxsKGlucHV0LmdldCgwKSk7XG4gICAgICAgIH0pO1xuXG4gICAgfVxuXG4gICAgLy8gSGlkZXMgYWxsIGRyb3Bkb3duIHBhbmVsc1xuICAgIGZ1bmN0aW9uIGhpZGUoKSB7XG5cbiAgICAgICQoJy5taW5pY29sb3JzLWZvY3VzJykuZWFjaCggZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgdmFyIG1pbmljb2xvcnMgPSAkKHRoaXMpLFxuICAgICAgICAgIGlucHV0ID0gbWluaWNvbG9ycy5maW5kKCcubWluaWNvbG9ycy1pbnB1dCcpLFxuICAgICAgICAgIHBhbmVsID0gbWluaWNvbG9ycy5maW5kKCcubWluaWNvbG9ycy1wYW5lbCcpLFxuICAgICAgICAgIHNldHRpbmdzID0gaW5wdXQuZGF0YSgnbWluaWNvbG9ycy1zZXR0aW5ncycpO1xuXG4gICAgICAgIHBhbmVsLmZhZGVPdXQoc2V0dGluZ3MuaGlkZVNwZWVkLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICBpZiggc2V0dGluZ3MuaGlkZSApIHNldHRpbmdzLmhpZGUuY2FsbChpbnB1dC5nZXQoMCkpO1xuICAgICAgICAgIG1pbmljb2xvcnMucmVtb3ZlQ2xhc3MoJ21pbmljb2xvcnMtZm9jdXMnKTtcbiAgICAgICAgfSk7XG5cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIE1vdmVzIHRoZSBzZWxlY3RlZCBwaWNrZXJcbiAgICBmdW5jdGlvbiBtb3ZlKHRhcmdldCwgZXZlbnQsIGFuaW1hdGUpIHtcblxuICAgICAgdmFyIGlucHV0ID0gIHRhcmdldC5wYXJlbnRzKCcubWluaWNvbG9ycycpLmZpbmQoJy5taW5pY29sb3JzLWlucHV0JyksXG4gICAgICAgIHNldHRpbmdzID0gaW5wdXQuZGF0YSgnbWluaWNvbG9ycy1zZXR0aW5ncycpLFxuICAgICAgICBwaWNrZXIgPSB0YXJnZXQuZmluZCgnW2NsYXNzJD0tcGlja2VyXScpLFxuICAgICAgICBvZmZzZXRYID0gdGFyZ2V0Lm9mZnNldCgpLmxlZnQsXG4gICAgICAgIG9mZnNldFkgPSB0YXJnZXQub2Zmc2V0KCkudG9wLFxuICAgICAgICB4ID0gTWF0aC5yb3VuZChldmVudC5wYWdlWCAtIG9mZnNldFgpLFxuICAgICAgICB5ID0gTWF0aC5yb3VuZChldmVudC5wYWdlWSAtIG9mZnNldFkpLFxuICAgICAgICBkdXJhdGlvbiA9IGFuaW1hdGUgPyBzZXR0aW5ncy5hbmltYXRpb25TcGVlZCA6IDAsXG4gICAgICAgIHd4LCB3eSwgciwgcGhpO1xuXG4gICAgICAvLyBUb3VjaCBzdXBwb3J0XG4gICAgICBpZiggZXZlbnQub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlcyApIHtcbiAgICAgICAgeCA9IGV2ZW50Lm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0ucGFnZVggLSBvZmZzZXRYO1xuICAgICAgICB5ID0gZXZlbnQub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWSAtIG9mZnNldFk7XG4gICAgICB9XG5cbiAgICAgIC8vIENvbnN0cmFpbiBwaWNrZXIgdG8gaXRzIGNvbnRhaW5lclxuICAgICAgaWYoIHggPCAwICkgeCA9IDA7XG4gICAgICBpZiggeSA8IDAgKSB5ID0gMDtcbiAgICAgIGlmKCB4ID4gdGFyZ2V0LndpZHRoKCkgKSB4ID0gdGFyZ2V0LndpZHRoKCk7XG4gICAgICBpZiggeSA+IHRhcmdldC5oZWlnaHQoKSApIHkgPSB0YXJnZXQuaGVpZ2h0KCk7XG5cbiAgICAgIC8vIENvbnN0cmFpbiBjb2xvciB3aGVlbCB2YWx1ZXMgdG8gdGhlIHdoZWVsXG4gICAgICBpZiggdGFyZ2V0LnBhcmVudCgpLmlzKCcubWluaWNvbG9ycy1zbGlkZXItd2hlZWwnKSAmJiBwaWNrZXIucGFyZW50KCkuaXMoJy5taW5pY29sb3JzLWdyaWQnKSApIHtcbiAgICAgICAgd3ggPSA3NSAtIHg7XG4gICAgICAgIHd5ID0gNzUgLSB5O1xuICAgICAgICByID0gTWF0aC5zcXJ0KHd4ICogd3ggKyB3eSAqIHd5KTtcbiAgICAgICAgcGhpID0gTWF0aC5hdGFuMih3eSwgd3gpO1xuICAgICAgICBpZiggcGhpIDwgMCApIHBoaSArPSBNYXRoLlBJICogMjtcbiAgICAgICAgaWYoIHIgPiA3NSApIHtcbiAgICAgICAgICByID0gNzU7XG4gICAgICAgICAgeCA9IDc1IC0gKDc1ICogTWF0aC5jb3MocGhpKSk7XG4gICAgICAgICAgeSA9IDc1IC0gKDc1ICogTWF0aC5zaW4ocGhpKSk7XG4gICAgICAgIH1cbiAgICAgICAgeCA9IE1hdGgucm91bmQoeCk7XG4gICAgICAgIHkgPSBNYXRoLnJvdW5kKHkpO1xuICAgICAgfVxuXG4gICAgICAvLyBNb3ZlIHRoZSBwaWNrZXJcbiAgICAgIGlmKCB0YXJnZXQuaXMoJy5taW5pY29sb3JzLWdyaWQnKSApIHtcbiAgICAgICAgcGlja2VyXG4gICAgICAgICAgLnN0b3AodHJ1ZSlcbiAgICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgICAgICB0b3A6IHkgKyAncHgnLFxuICAgICAgICAgICAgbGVmdDogeCArICdweCdcbiAgICAgICAgICB9LCBkdXJhdGlvbiwgc2V0dGluZ3MuYW5pbWF0aW9uRWFzaW5nLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHVwZGF0ZUZyb21Db250cm9sKGlucHV0LCB0YXJnZXQpO1xuICAgICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcGlja2VyXG4gICAgICAgICAgLnN0b3AodHJ1ZSlcbiAgICAgICAgICAuYW5pbWF0ZSh7XG4gICAgICAgICAgICB0b3A6IHkgKyAncHgnXG4gICAgICAgICAgfSwgZHVyYXRpb24sIHNldHRpbmdzLmFuaW1hdGlvbkVhc2luZywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB1cGRhdGVGcm9tQ29udHJvbChpbnB1dCwgdGFyZ2V0KTtcbiAgICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgIH1cblxuICAgIC8vIFNldHMgdGhlIGlucHV0IGJhc2VkIG9uIHRoZSBjb2xvciBwaWNrZXIgdmFsdWVzXG4gICAgZnVuY3Rpb24gdXBkYXRlRnJvbUNvbnRyb2woaW5wdXQsIHRhcmdldCkge1xuXG4gICAgICBmdW5jdGlvbiBnZXRDb29yZHMocGlja2VyLCBjb250YWluZXIpIHtcblxuICAgICAgICB2YXIgbGVmdCwgdG9wO1xuICAgICAgICBpZiggIXBpY2tlci5sZW5ndGggfHwgIWNvbnRhaW5lciApIHJldHVybiBudWxsO1xuICAgICAgICBsZWZ0ID0gcGlja2VyLm9mZnNldCgpLmxlZnQ7XG4gICAgICAgIHRvcCA9IHBpY2tlci5vZmZzZXQoKS50b3A7XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB4OiBsZWZ0IC0gY29udGFpbmVyLm9mZnNldCgpLmxlZnQgKyAocGlja2VyLm91dGVyV2lkdGgoKSAvIDIpLFxuICAgICAgICAgIHk6IHRvcCAtIGNvbnRhaW5lci5vZmZzZXQoKS50b3AgKyAocGlja2VyLm91dGVySGVpZ2h0KCkgLyAyKVxuICAgICAgICB9O1xuXG4gICAgICB9XG5cbiAgICAgIHZhciBodWUsIHNhdHVyYXRpb24sIGJyaWdodG5lc3MsIHgsIHksIHIsIHBoaSxcblxuICAgICAgICBoZXggPSBpbnB1dC52YWwoKSxcbiAgICAgICAgb3BhY2l0eSA9IGlucHV0LmF0dHIoJ2RhdGEtb3BhY2l0eScpLFxuXG4gICAgICAvLyBIZWxwZnVsIHJlZmVyZW5jZXNcbiAgICAgICAgbWluaWNvbG9ycyA9IGlucHV0LnBhcmVudCgpLFxuICAgICAgICBzZXR0aW5ncyA9IGlucHV0LmRhdGEoJ21pbmljb2xvcnMtc2V0dGluZ3MnKSxcbiAgICAgICAgc3dhdGNoID0gbWluaWNvbG9ycy5maW5kKCcubWluaWNvbG9ycy1pbnB1dC1zd2F0Y2gnKSxcblxuICAgICAgLy8gUGFuZWwgb2JqZWN0c1xuICAgICAgICBncmlkID0gbWluaWNvbG9ycy5maW5kKCcubWluaWNvbG9ycy1ncmlkJyksXG4gICAgICAgIHNsaWRlciA9IG1pbmljb2xvcnMuZmluZCgnLm1pbmljb2xvcnMtc2xpZGVyJyksXG4gICAgICAgIG9wYWNpdHlTbGlkZXIgPSBtaW5pY29sb3JzLmZpbmQoJy5taW5pY29sb3JzLW9wYWNpdHktc2xpZGVyJyksXG5cbiAgICAgIC8vIFBpY2tlciBvYmplY3RzXG4gICAgICAgIGdyaWRQaWNrZXIgPSBncmlkLmZpbmQoJ1tjbGFzcyQ9LXBpY2tlcl0nKSxcbiAgICAgICAgc2xpZGVyUGlja2VyID0gc2xpZGVyLmZpbmQoJ1tjbGFzcyQ9LXBpY2tlcl0nKSxcbiAgICAgICAgb3BhY2l0eVBpY2tlciA9IG9wYWNpdHlTbGlkZXIuZmluZCgnW2NsYXNzJD0tcGlja2VyXScpLFxuXG4gICAgICAvLyBQaWNrZXIgcG9zaXRpb25zXG4gICAgICAgIGdyaWRQb3MgPSBnZXRDb29yZHMoZ3JpZFBpY2tlciwgZ3JpZCksXG4gICAgICAgIHNsaWRlclBvcyA9IGdldENvb3JkcyhzbGlkZXJQaWNrZXIsIHNsaWRlciksXG4gICAgICAgIG9wYWNpdHlQb3MgPSBnZXRDb29yZHMob3BhY2l0eVBpY2tlciwgb3BhY2l0eVNsaWRlcik7XG5cbiAgICAgIC8vIEhhbmRsZSBjb2xvcnNcbiAgICAgIGlmKCB0YXJnZXQuaXMoJy5taW5pY29sb3JzLWdyaWQsIC5taW5pY29sb3JzLXNsaWRlciwgLm1pbmljb2xvcnMtb3BhY2l0eS1zbGlkZXInKSApIHtcblxuICAgICAgICAvLyBEZXRlcm1pbmUgSFNCIHZhbHVlc1xuICAgICAgICBzd2l0Y2goc2V0dGluZ3MuY29udHJvbCkge1xuXG4gICAgICAgICAgY2FzZSAnd2hlZWwnOlxuICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIGh1ZSwgc2F0dXJhdGlvbiwgYW5kIGJyaWdodG5lc3NcbiAgICAgICAgICAgIHggPSAoZ3JpZC53aWR0aCgpIC8gMikgLSBncmlkUG9zLng7XG4gICAgICAgICAgICB5ID0gKGdyaWQuaGVpZ2h0KCkgLyAyKSAtIGdyaWRQb3MueTtcbiAgICAgICAgICAgIHIgPSBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSk7XG4gICAgICAgICAgICBwaGkgPSBNYXRoLmF0YW4yKHksIHgpO1xuICAgICAgICAgICAgaWYoIHBoaSA8IDAgKSBwaGkgKz0gTWF0aC5QSSAqIDI7XG4gICAgICAgICAgICBpZiggciA+IDc1ICkge1xuICAgICAgICAgICAgICByID0gNzU7XG4gICAgICAgICAgICAgIGdyaWRQb3MueCA9IDY5IC0gKDc1ICogTWF0aC5jb3MocGhpKSk7XG4gICAgICAgICAgICAgIGdyaWRQb3MueSA9IDY5IC0gKDc1ICogTWF0aC5zaW4ocGhpKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzYXR1cmF0aW9uID0ga2VlcFdpdGhpbihyIC8gMC43NSwgMCwgMTAwKTtcbiAgICAgICAgICAgIGh1ZSA9IGtlZXBXaXRoaW4ocGhpICogMTgwIC8gTWF0aC5QSSwgMCwgMzYwKTtcbiAgICAgICAgICAgIGJyaWdodG5lc3MgPSBrZWVwV2l0aGluKDEwMCAtIE1hdGguZmxvb3Ioc2xpZGVyUG9zLnkgKiAoMTAwIC8gc2xpZGVyLmhlaWdodCgpKSksIDAsIDEwMCk7XG4gICAgICAgICAgICBoZXggPSBoc2IyaGV4KHtcbiAgICAgICAgICAgICAgaDogaHVlLFxuICAgICAgICAgICAgICBzOiBzYXR1cmF0aW9uLFxuICAgICAgICAgICAgICBiOiBicmlnaHRuZXNzXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gVXBkYXRlIFVJXG4gICAgICAgICAgICBzbGlkZXIuY3NzKCdiYWNrZ3JvdW5kQ29sb3InLCBoc2IyaGV4KHsgaDogaHVlLCBzOiBzYXR1cmF0aW9uLCBiOiAxMDAgfSkpO1xuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICBjYXNlICdzYXR1cmF0aW9uJzpcbiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSBodWUsIHNhdHVyYXRpb24sIGFuZCBicmlnaHRuZXNzXG4gICAgICAgICAgICBodWUgPSBrZWVwV2l0aGluKHBhcnNlSW50KGdyaWRQb3MueCAqICgzNjAgLyBncmlkLndpZHRoKCkpLCAxMCksIDAsIDM2MCk7XG4gICAgICAgICAgICBzYXR1cmF0aW9uID0ga2VlcFdpdGhpbigxMDAgLSBNYXRoLmZsb29yKHNsaWRlclBvcy55ICogKDEwMCAvIHNsaWRlci5oZWlnaHQoKSkpLCAwLCAxMDApO1xuICAgICAgICAgICAgYnJpZ2h0bmVzcyA9IGtlZXBXaXRoaW4oMTAwIC0gTWF0aC5mbG9vcihncmlkUG9zLnkgKiAoMTAwIC8gZ3JpZC5oZWlnaHQoKSkpLCAwLCAxMDApO1xuICAgICAgICAgICAgaGV4ID0gaHNiMmhleCh7XG4gICAgICAgICAgICAgIGg6IGh1ZSxcbiAgICAgICAgICAgICAgczogc2F0dXJhdGlvbixcbiAgICAgICAgICAgICAgYjogYnJpZ2h0bmVzc1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIFVwZGF0ZSBVSVxuICAgICAgICAgICAgc2xpZGVyLmNzcygnYmFja2dyb3VuZENvbG9yJywgaHNiMmhleCh7IGg6IGh1ZSwgczogMTAwLCBiOiBicmlnaHRuZXNzIH0pKTtcbiAgICAgICAgICAgIG1pbmljb2xvcnMuZmluZCgnLm1pbmljb2xvcnMtZ3JpZC1pbm5lcicpLmNzcygnb3BhY2l0eScsIHNhdHVyYXRpb24gLyAxMDApO1xuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICBjYXNlICdicmlnaHRuZXNzJzpcbiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSBodWUsIHNhdHVyYXRpb24sIGFuZCBicmlnaHRuZXNzXG4gICAgICAgICAgICBodWUgPSBrZWVwV2l0aGluKHBhcnNlSW50KGdyaWRQb3MueCAqICgzNjAgLyBncmlkLndpZHRoKCkpLCAxMCksIDAsIDM2MCk7XG4gICAgICAgICAgICBzYXR1cmF0aW9uID0ga2VlcFdpdGhpbigxMDAgLSBNYXRoLmZsb29yKGdyaWRQb3MueSAqICgxMDAgLyBncmlkLmhlaWdodCgpKSksIDAsIDEwMCk7XG4gICAgICAgICAgICBicmlnaHRuZXNzID0ga2VlcFdpdGhpbigxMDAgLSBNYXRoLmZsb29yKHNsaWRlclBvcy55ICogKDEwMCAvIHNsaWRlci5oZWlnaHQoKSkpLCAwLCAxMDApO1xuICAgICAgICAgICAgaGV4ID0gaHNiMmhleCh7XG4gICAgICAgICAgICAgIGg6IGh1ZSxcbiAgICAgICAgICAgICAgczogc2F0dXJhdGlvbixcbiAgICAgICAgICAgICAgYjogYnJpZ2h0bmVzc1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIFVwZGF0ZSBVSVxuICAgICAgICAgICAgc2xpZGVyLmNzcygnYmFja2dyb3VuZENvbG9yJywgaHNiMmhleCh7IGg6IGh1ZSwgczogc2F0dXJhdGlvbiwgYjogMTAwIH0pKTtcbiAgICAgICAgICAgIG1pbmljb2xvcnMuZmluZCgnLm1pbmljb2xvcnMtZ3JpZC1pbm5lcicpLmNzcygnb3BhY2l0eScsIDEgLSAoYnJpZ2h0bmVzcyAvIDEwMCkpO1xuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIGh1ZSwgc2F0dXJhdGlvbiwgYW5kIGJyaWdodG5lc3NcbiAgICAgICAgICAgIGh1ZSA9IGtlZXBXaXRoaW4oMzYwIC0gcGFyc2VJbnQoc2xpZGVyUG9zLnkgKiAoMzYwIC8gc2xpZGVyLmhlaWdodCgpKSwgMTApLCAwLCAzNjApO1xuICAgICAgICAgICAgc2F0dXJhdGlvbiA9IGtlZXBXaXRoaW4oTWF0aC5mbG9vcihncmlkUG9zLnggKiAoMTAwIC8gZ3JpZC53aWR0aCgpKSksIDAsIDEwMCk7XG4gICAgICAgICAgICBicmlnaHRuZXNzID0ga2VlcFdpdGhpbigxMDAgLSBNYXRoLmZsb29yKGdyaWRQb3MueSAqICgxMDAgLyBncmlkLmhlaWdodCgpKSksIDAsIDEwMCk7XG4gICAgICAgICAgICBoZXggPSBoc2IyaGV4KHtcbiAgICAgICAgICAgICAgaDogaHVlLFxuICAgICAgICAgICAgICBzOiBzYXR1cmF0aW9uLFxuICAgICAgICAgICAgICBiOiBicmlnaHRuZXNzXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gVXBkYXRlIFVJXG4gICAgICAgICAgICBncmlkLmNzcygnYmFja2dyb3VuZENvbG9yJywgaHNiMmhleCh7IGg6IGh1ZSwgczogMTAwLCBiOiAxMDAgfSkpO1xuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEhhbmRsZSBvcGFjaXR5XG4gICAgICAgIGlmKCBzZXR0aW5ncy5vcGFjaXR5ICkge1xuICAgICAgICAgIG9wYWNpdHkgPSBwYXJzZUZsb2F0KDEgLSAob3BhY2l0eVBvcy55IC8gb3BhY2l0eVNsaWRlci5oZWlnaHQoKSkpLnRvRml4ZWQoMik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgb3BhY2l0eSA9IDE7XG4gICAgICAgIH1cblxuICAgICAgICB1cGRhdGVJbnB1dChpbnB1dCwgaGV4LCBvcGFjaXR5KTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICAvLyBTZXQgc3dhdGNoIGNvbG9yXG4gICAgICAgIHN3YXRjaC5maW5kKCdzcGFuJykuY3NzKHtcbiAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IGhleCxcbiAgICAgICAgICBvcGFjaXR5OiBvcGFjaXR5XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIEhhbmRsZSBjaGFuZ2UgZXZlbnRcbiAgICAgICAgZG9DaGFuZ2UoaW5wdXQsIGhleCwgb3BhY2l0eSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gU2V0cyB0aGUgdmFsdWUgb2YgdGhlIGlucHV0IGFuZCBkb2VzIHRoZSBhcHByb3ByaWF0ZSBjb252ZXJzaW9uc1xuICAgIC8vIHRvIHJlc3BlY3Qgc2V0dGluZ3MsIGFsc28gdXBkYXRlcyB0aGUgc3dhdGNoXG4gICAgZnVuY3Rpb24gdXBkYXRlSW5wdXQoaW5wdXQsIHZhbHVlLCBvcGFjaXR5KSB7XG4gICAgICB2YXIgcmdiLFxuXG4gICAgICAvLyBIZWxwZnVsIHJlZmVyZW5jZXNcbiAgICAgICAgbWluaWNvbG9ycyA9IGlucHV0LnBhcmVudCgpLFxuICAgICAgICBzZXR0aW5ncyA9IGlucHV0LmRhdGEoJ21pbmljb2xvcnMtc2V0dGluZ3MnKSxcbiAgICAgICAgc3dhdGNoID0gbWluaWNvbG9ycy5maW5kKCcubWluaWNvbG9ycy1pbnB1dC1zd2F0Y2gnKTtcblxuICAgICAgaWYoIHNldHRpbmdzLm9wYWNpdHkgKSBpbnB1dC5hdHRyKCdkYXRhLW9wYWNpdHknLCBvcGFjaXR5KTtcblxuICAgICAgLy8gU2V0IGNvbG9yIHN0cmluZ1xuICAgICAgaWYoIHNldHRpbmdzLmZvcm1hdCA9PT0gJ3JnYicgKSB7XG4gICAgICAgIC8vIFJldHVybnMgUkdCKEEpIHN0cmluZ1xuXG4gICAgICAgIC8vIENoZWNrcyBmb3IgaW5wdXQgZm9ybWF0IGFuZCBkb2VzIHRoZSBjb252ZXJzaW9uXG4gICAgICAgIGlmICggaXNSZ2IodmFsdWUpICkge1xuICAgICAgICAgIHJnYiA9IHBhcnNlUmdiKHZhbHVlLCB0cnVlKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICByZ2IgPSBoZXgycmdiKHBhcnNlSGV4KHZhbHVlLCB0cnVlKSk7XG4gICAgICAgIH1cblxuXG4gICAgICAgIG9wYWNpdHkgPSBpbnB1dC5hdHRyKCdkYXRhLW9wYWNpdHknKSA9PT0gJycgPyAxIDoga2VlcFdpdGhpbiggcGFyc2VGbG9hdCggaW5wdXQuYXR0cignZGF0YS1vcGFjaXR5JykgKS50b0ZpeGVkKDIpLCAwLCAxICk7XG4gICAgICAgIGlmKCBpc05hTiggb3BhY2l0eSApIHx8ICFzZXR0aW5ncy5vcGFjaXR5ICkgb3BhY2l0eSA9IDE7XG5cbiAgICAgICAgaWYoIGlucHV0Lm1pbmljb2xvcnMoJ3JnYk9iamVjdCcpLmEgPD0gMSAmJiByZ2IgJiYgc2V0dGluZ3Mub3BhY2l0eSkge1xuICAgICAgICAgIC8vIFNldCBSR0JBIHN0cmluZyBpZiBhbHBoYVxuICAgICAgICAgIHZhbHVlID0gJ3JnYmEoJyArIHJnYi5yICsgJywgJyArIHJnYi5nICsgJywgJyArIHJnYi5iICsgJywgJyArIHBhcnNlRmxvYXQoIG9wYWNpdHkgKSArICcpJztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBTZXQgUkdCIHN0cmluZyAoYWxwaGEgPSAxKVxuICAgICAgICAgIHZhbHVlID0gJ3JnYignICsgcmdiLnIgKyAnLCAnICsgcmdiLmcgKyAnLCAnICsgcmdiLmIgKyAnKSc7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIFJldHVybnMgaGV4IGNvbG9yXG5cbiAgICAgICAgLy8gQ2hlY2tzIGZvciBpbnB1dCBmb3JtYXQgYW5kIGRvZXMgdGhlIGNvbnZlcnNpb25cbiAgICAgICAgaWYgKCBpc1JnYih2YWx1ZSkgKSB7XG4gICAgICAgICAgdmFsdWUgPSByZ2JTdHJpbmcyaGV4KHZhbHVlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhbHVlID0gY29udmVydENhc2UoIHZhbHVlLCBzZXR0aW5ncy5sZXR0ZXJDYXNlICk7XG4gICAgICB9XG5cblxuXG5cbiAgICAgIC8vIFVwZGF0ZSB2YWx1ZSBmcm9tIHBpY2tlclxuICAgICAgLy9nbG9iYWxJbnB1dC52YWwoIHZhbHVlICk7XG4gICAgICBpbnB1dC52YWwoIHZhbHVlICk7XG5cbiAgICAgIGlmKGlucHV0VGV4dCl7XG4gICAgICAgIGlucHV0VGV4dC52YWwodmFsdWUpO1xuICAgICAgfVxuXG5cbiAgICAgIC8vIFNldCBzd2F0Y2ggY29sb3JcbiAgICAgIHN3YXRjaC5maW5kKCdzcGFuJykuY3NzKHtcbiAgICAgICAgYmFja2dyb3VuZENvbG9yOiB2YWx1ZSxcbiAgICAgICAgb3BhY2l0eTogb3BhY2l0eVxuICAgICAgfSk7XG5cbiAgICAgIC8vIEhhbmRsZSBjaGFuZ2UgZXZlbnRcbiAgICAgIGRvQ2hhbmdlKGlucHV0LCB2YWx1ZSwgb3BhY2l0eSk7XG4gICAgfVxuXG4gICAgLy8gU2V0cyB0aGUgY29sb3IgcGlja2VyIHZhbHVlcyBmcm9tIHRoZSBpbnB1dFxuICAgIGZ1bmN0aW9uIHVwZGF0ZUZyb21JbnB1dChpbnB1dCwgcHJlc2VydmVJbnB1dFZhbHVlKSB7XG4gICAgIHZhciAgc2V0dGluZ3MgPSBnbG9iYWxTZXR0aW5ncztcbiAgICAgIHZhciBoZXgsXG4gICAgICAgIGhzYixcbiAgICAgICAgb3BhY2l0eSxcbiAgICAgICAga2V5d29yZHMsXG4gICAgICAgIGFscGhhLFxuICAgICAgICB2YWx1ZSxcbiAgICAgICAgeCwgeSwgciwgcGhpLFxuXG4gICAgICAvLyBIZWxwZnVsIHJlZmVyZW5jZXNcbiAgICAgICAgbWluaWNvbG9ycyA9IGlucHV0LnBhcmVudCgpLFxuICAgICAgLy8gIHNldHRpbmdzID0gaW5wdXQuZGF0YSgnbWluaWNvbG9ycy1zZXR0aW5ncycpLFxuICAgICAgICBzd2F0Y2ggPSBtaW5pY29sb3JzLmZpbmQoJy5taW5pY29sb3JzLWlucHV0LXN3YXRjaCcpLFxuXG4gICAgICAvLyBQYW5lbCBvYmplY3RzXG4gICAgICAgIGdyaWQgPSBtaW5pY29sb3JzLmZpbmQoJy5taW5pY29sb3JzLWdyaWQnKSxcbiAgICAgICAgc2xpZGVyID0gbWluaWNvbG9ycy5maW5kKCcubWluaWNvbG9ycy1zbGlkZXInKSxcbiAgICAgICAgb3BhY2l0eVNsaWRlciA9IG1pbmljb2xvcnMuZmluZCgnLm1pbmljb2xvcnMtb3BhY2l0eS1zbGlkZXInKSxcblxuICAgICAgLy8gUGlja2VyIG9iamVjdHNcbiAgICAgICAgZ3JpZFBpY2tlciA9IGdyaWQuZmluZCgnW2NsYXNzJD0tcGlja2VyXScpLFxuICAgICAgICBzbGlkZXJQaWNrZXIgPSBzbGlkZXIuZmluZCgnW2NsYXNzJD0tcGlja2VyXScpLFxuICAgICAgICBvcGFjaXR5UGlja2VyID0gb3BhY2l0eVNsaWRlci5maW5kKCdbY2xhc3MkPS1waWNrZXJdJyk7XG5cbiAgICAgIC8vIERldGVybWluZSBoZXgvSFNCIHZhbHVlc1xuICAgICAgaWYoIGlzUmdiKGlucHV0LnZhbCgpKSApIHtcbiAgICAgICAgLy8gSWYgaW5wdXQgdmFsdWUgaXMgYSByZ2IoYSkgc3RyaW5nLCBjb252ZXJ0IGl0IHRvIGhleCBjb2xvciBhbmQgdXBkYXRlIG9wYWNpdHlcbiAgICAgICAgaGV4ID0gcmdiU3RyaW5nMmhleChpbnB1dC52YWwoKSk7XG4gICAgICAgIGFscGhhID0ga2VlcFdpdGhpbihwYXJzZUZsb2F0KGdldEFscGhhKGlucHV0LnZhbCgpKSkudG9GaXhlZCgyKSwgMCwgMSk7XG4gICAgICAgIGlmKCBhbHBoYSApIHtcbiAgICAgICAgICBpbnB1dC5hdHRyKCdkYXRhLW9wYWNpdHknLCBhbHBoYSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGhleCA9IGNvbnZlcnRDYXNlKHBhcnNlSGV4KGlucHV0LnZhbCgpLCB0cnVlKSwgc2V0dGluZ3MubGV0dGVyQ2FzZSk7XG4gICAgICB9XG5cbiAgICAgIGlmKCAhaGV4ICl7XG4gICAgICAgIGhleCA9IGNvbnZlcnRDYXNlKHBhcnNlSW5wdXQoc2V0dGluZ3MuZGVmYXVsdFZhbHVlLCB0cnVlKSwgc2V0dGluZ3MubGV0dGVyQ2FzZSk7XG4gICAgICB9XG4gICAgICBoc2IgPSBoZXgyaHNiKGhleCk7XG5cbiAgICAgIC8vIEdldCBhcnJheSBvZiBsb3dlcmNhc2Uga2V5d29yZHNcbiAgICAgIGtleXdvcmRzID0gIXNldHRpbmdzLmtleXdvcmRzID8gW10gOiAkLm1hcChzZXR0aW5ncy5rZXl3b3Jkcy5zcGxpdCgnLCcpLCBmdW5jdGlvbihhKSB7XG4gICAgICAgIHJldHVybiAkLnRyaW0oYS50b0xvd2VyQ2FzZSgpKTtcbiAgICAgIH0pO1xuXG4gICAgICAvLyBTZXQgY29sb3Igc3RyaW5nXG4gICAgICBpZiggaW5wdXQudmFsKCkgIT09ICcnICYmICQuaW5BcnJheShpbnB1dC52YWwoKS50b0xvd2VyQ2FzZSgpLCBrZXl3b3JkcykgPiAtMSApIHtcbiAgICAgICAgdmFsdWUgPSBjb252ZXJ0Q2FzZShpbnB1dC52YWwoKSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YWx1ZSA9IGlzUmdiKGlucHV0LnZhbCgpKSA/IHBhcnNlUmdiKGlucHV0LnZhbCgpKSA6IGhleDtcbiAgICAgIH1cblxuICAgICAgLy8gVXBkYXRlIGlucHV0IHZhbHVlXG4gICAgICBpZiggIXByZXNlcnZlSW5wdXRWYWx1ZSApe1xuICAgICAgICBnbG9iYWxJbnB1dC52YWwodmFsdWUpO1xuXG4gICAgICAgIGlucHV0VGV4dCAmJiBpbnB1dFRleHQudmFsKHZhbHVlKTtcbiAgICAgIH1cbiAgICAgIGdsb2JhbFNldHRpbmdzID0gc2V0dGluZ3NcbiAgICAgIC8vIERldGVybWluZSBvcGFjaXR5IHZhbHVlXG4gICAgICBpZiggc2V0dGluZ3Mub3BhY2l0eSApIHtcbiAgICAgICAgLy8gR2V0IGZyb20gZGF0YS1vcGFjaXR5IGF0dHJpYnV0ZSBhbmQga2VlcCB3aXRoaW4gMC0xIHJhbmdlXG4gICAgICAgIG9wYWNpdHkgPSBpbnB1dC5hdHRyKCdkYXRhLW9wYWNpdHknKSA9PT0gJycgPyAxIDoga2VlcFdpdGhpbihwYXJzZUZsb2F0KGlucHV0LmF0dHIoJ2RhdGEtb3BhY2l0eScpKS50b0ZpeGVkKDIpLCAwLCAxKTtcbiAgICAgICAgaWYoIGlzTmFOKG9wYWNpdHkpICkgb3BhY2l0eSA9IDE7XG4gICAgICAgIGlucHV0LmF0dHIoJ2RhdGEtb3BhY2l0eScsIG9wYWNpdHkpO1xuICAgICAgICBzd2F0Y2guZmluZCgnc3BhbicpLmNzcygnb3BhY2l0eScsIG9wYWNpdHkpO1xuXG4gICAgICAgIC8vIFNldCBvcGFjaXR5IHBpY2tlciBwb3NpdGlvblxuICAgICAgICB5ID0ga2VlcFdpdGhpbihvcGFjaXR5U2xpZGVyLmhlaWdodCgpIC0gKG9wYWNpdHlTbGlkZXIuaGVpZ2h0KCkgKiBvcGFjaXR5KSwgMCwgb3BhY2l0eVNsaWRlci5oZWlnaHQoKSk7XG4gICAgICAgIG9wYWNpdHlQaWNrZXIuY3NzKCd0b3AnLCB5ICsgJ3B4Jyk7XG4gICAgICB9XG5cbiAgICAgIC8vIFNldCBvcGFjaXR5IHRvIHplcm8gaWYgaW5wdXQgdmFsdWUgaXMgdHJhbnNwYXJlbnRcbiAgICAgIGlmKCBpbnB1dC52YWwoKS50b0xvd2VyQ2FzZSgpID09PSAndHJhbnNwYXJlbnQnICkge1xuICAgICAgICBzd2F0Y2guZmluZCgnc3BhbicpLmNzcygnb3BhY2l0eScsIDApO1xuICAgICAgfVxuXG4gICAgICAvLyBVcGRhdGUgc3dhdGNoXG4gICAgICBzd2F0Y2guZmluZCgnc3BhbicpLmNzcygnYmFja2dyb3VuZENvbG9yJywgaGV4KTtcblxuICAgICAgLy8gRGV0ZXJtaW5lIHBpY2tlciBsb2NhdGlvbnNcbiAgICAgIHN3aXRjaChzZXR0aW5ncy5jb250cm9sKSB7XG5cbiAgICAgICAgY2FzZSAnd2hlZWwnOlxuICAgICAgICAgIC8vIFNldCBncmlkIHBvc2l0aW9uXG4gICAgICAgICAgciA9IGtlZXBXaXRoaW4oTWF0aC5jZWlsKGhzYi5zICogMC43NSksIDAsIGdyaWQuaGVpZ2h0KCkgLyAyKTtcbiAgICAgICAgICBwaGkgPSBoc2IuaCAqIE1hdGguUEkgLyAxODA7XG4gICAgICAgICAgeCA9IGtlZXBXaXRoaW4oNzUgLSBNYXRoLmNvcyhwaGkpICogciwgMCwgZ3JpZC53aWR0aCgpKTtcbiAgICAgICAgICB5ID0ga2VlcFdpdGhpbig3NSAtIE1hdGguc2luKHBoaSkgKiByLCAwLCBncmlkLmhlaWdodCgpKTtcbiAgICAgICAgICBncmlkUGlja2VyLmNzcyh7XG4gICAgICAgICAgICB0b3A6IHkgKyAncHgnLFxuICAgICAgICAgICAgbGVmdDogeCArICdweCdcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIC8vIFNldCBzbGlkZXIgcG9zaXRpb25cbiAgICAgICAgICB5ID0gMTUwIC0gKGhzYi5iIC8gKDEwMCAvIGdyaWQuaGVpZ2h0KCkpKTtcbiAgICAgICAgICBpZiggaGV4ID09PSAnJyApIHkgPSAwO1xuICAgICAgICAgIHNsaWRlclBpY2tlci5jc3MoJ3RvcCcsIHkgKyAncHgnKTtcblxuICAgICAgICAgIC8vIFVwZGF0ZSBwYW5lbCBjb2xvclxuICAgICAgICAgIHNsaWRlci5jc3MoJ2JhY2tncm91bmRDb2xvcicsIGhzYjJoZXgoeyBoOiBoc2IuaCwgczogaHNiLnMsIGI6IDEwMCB9KSk7XG4gICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgY2FzZSAnc2F0dXJhdGlvbic6XG4gICAgICAgICAgLy8gU2V0IGdyaWQgcG9zaXRpb25cbiAgICAgICAgICB4ID0ga2VlcFdpdGhpbigoNSAqIGhzYi5oKSAvIDEyLCAwLCAxNTApO1xuICAgICAgICAgIHkgPSBrZWVwV2l0aGluKGdyaWQuaGVpZ2h0KCkgLSBNYXRoLmNlaWwoaHNiLmIgLyAoMTAwIC8gZ3JpZC5oZWlnaHQoKSkpLCAwLCBncmlkLmhlaWdodCgpKTtcbiAgICAgICAgICBncmlkUGlja2VyLmNzcyh7XG4gICAgICAgICAgICB0b3A6IHkgKyAncHgnLFxuICAgICAgICAgICAgbGVmdDogeCArICdweCdcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIC8vIFNldCBzbGlkZXIgcG9zaXRpb25cbiAgICAgICAgICB5ID0ga2VlcFdpdGhpbihzbGlkZXIuaGVpZ2h0KCkgLSAoaHNiLnMgKiAoc2xpZGVyLmhlaWdodCgpIC8gMTAwKSksIDAsIHNsaWRlci5oZWlnaHQoKSk7XG4gICAgICAgICAgc2xpZGVyUGlja2VyLmNzcygndG9wJywgeSArICdweCcpO1xuXG4gICAgICAgICAgLy8gVXBkYXRlIFVJXG4gICAgICAgICAgc2xpZGVyLmNzcygnYmFja2dyb3VuZENvbG9yJywgaHNiMmhleCh7IGg6IGhzYi5oLCBzOiAxMDAsIGI6IGhzYi5iIH0pKTtcbiAgICAgICAgICBtaW5pY29sb3JzLmZpbmQoJy5taW5pY29sb3JzLWdyaWQtaW5uZXInKS5jc3MoJ29wYWNpdHknLCBoc2IucyAvIDEwMCk7XG4gICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgY2FzZSAnYnJpZ2h0bmVzcyc6XG4gICAgICAgICAgLy8gU2V0IGdyaWQgcG9zaXRpb25cbiAgICAgICAgICB4ID0ga2VlcFdpdGhpbigoNSAqIGhzYi5oKSAvIDEyLCAwLCAxNTApO1xuICAgICAgICAgIHkgPSBrZWVwV2l0aGluKGdyaWQuaGVpZ2h0KCkgLSBNYXRoLmNlaWwoaHNiLnMgLyAoMTAwIC8gZ3JpZC5oZWlnaHQoKSkpLCAwLCBncmlkLmhlaWdodCgpKTtcbiAgICAgICAgICBncmlkUGlja2VyLmNzcyh7XG4gICAgICAgICAgICB0b3A6IHkgKyAncHgnLFxuICAgICAgICAgICAgbGVmdDogeCArICdweCdcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIC8vIFNldCBzbGlkZXIgcG9zaXRpb25cbiAgICAgICAgICB5ID0ga2VlcFdpdGhpbihzbGlkZXIuaGVpZ2h0KCkgLSAoaHNiLmIgKiAoc2xpZGVyLmhlaWdodCgpIC8gMTAwKSksIDAsIHNsaWRlci5oZWlnaHQoKSk7XG4gICAgICAgICAgc2xpZGVyUGlja2VyLmNzcygndG9wJywgeSArICdweCcpO1xuXG4gICAgICAgICAgLy8gVXBkYXRlIFVJXG4gICAgICAgICAgc2xpZGVyLmNzcygnYmFja2dyb3VuZENvbG9yJywgaHNiMmhleCh7IGg6IGhzYi5oLCBzOiBoc2IucywgYjogMTAwIH0pKTtcbiAgICAgICAgICBtaW5pY29sb3JzLmZpbmQoJy5taW5pY29sb3JzLWdyaWQtaW5uZXInKS5jc3MoJ29wYWNpdHknLCAxIC0gKGhzYi5iIC8gMTAwKSk7XG4gICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAvLyBTZXQgZ3JpZCBwb3NpdGlvblxuICAgICAgICAgIHggPSBrZWVwV2l0aGluKE1hdGguY2VpbChoc2IucyAvICgxMDAgLyBncmlkLndpZHRoKCkpKSwgMCwgZ3JpZC53aWR0aCgpKTtcbiAgICAgICAgICB5ID0ga2VlcFdpdGhpbihncmlkLmhlaWdodCgpIC0gTWF0aC5jZWlsKGhzYi5iIC8gKDEwMCAvIGdyaWQuaGVpZ2h0KCkpKSwgMCwgZ3JpZC5oZWlnaHQoKSk7XG4gICAgICAgICAgZ3JpZFBpY2tlci5jc3Moe1xuICAgICAgICAgICAgdG9wOiB5ICsgJ3B4JyxcbiAgICAgICAgICAgIGxlZnQ6IHggKyAncHgnXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICAvLyBTZXQgc2xpZGVyIHBvc2l0aW9uXG4gICAgICAgICAgeSA9IGtlZXBXaXRoaW4oc2xpZGVyLmhlaWdodCgpIC0gKGhzYi5oIC8gKDM2MCAvIHNsaWRlci5oZWlnaHQoKSkpLCAwLCBzbGlkZXIuaGVpZ2h0KCkpO1xuICAgICAgICAgIHNsaWRlclBpY2tlci5jc3MoJ3RvcCcsIHkgKyAncHgnKTtcblxuICAgICAgICAgIC8vIFVwZGF0ZSBwYW5lbCBjb2xvclxuICAgICAgICAgIGdyaWQuY3NzKCdiYWNrZ3JvdW5kQ29sb3InLCBoc2IyaGV4KHsgaDogaHNiLmgsIHM6IDEwMCwgYjogMTAwIH0pKTtcbiAgICAgICAgICBicmVhaztcblxuICAgICAgfVxuXG4gICAgICAvLyBGaXJlIGNoYW5nZSBldmVudCwgYnV0IG9ubHkgaWYgbWluaWNvbG9ycyBpcyBmdWxseSBpbml0aWFsaXplZFxuICAgICAgaWYoIGlucHV0LmRhdGEoJ21pbmljb2xvcnMtaW5pdGlhbGl6ZWQnKSApIHtcbiAgICAgICAgZG9DaGFuZ2UoaW5wdXQsIHZhbHVlLCBvcGFjaXR5KTtcbiAgICAgIH1cblxuICAgIH1cblxuICAgIC8vIFJ1bnMgdGhlIGNoYW5nZSBhbmQgY2hhbmdlRGVsYXkgY2FsbGJhY2tzXG4gICAgZnVuY3Rpb24gZG9DaGFuZ2UoaW5wdXQsIHZhbHVlLCBvcGFjaXR5KSB7XG5cbiAgICAgIHZhciBzZXR0aW5ncyA9IGlucHV0LmRhdGEoJ21pbmljb2xvcnMtc2V0dGluZ3MnKSxcbiAgICAgICAgbGFzdENoYW5nZSA9IGlucHV0LmRhdGEoJ21pbmljb2xvcnMtbGFzdENoYW5nZScpLFxuICAgICAgICBvYmosXG4gICAgICAgIHNlbCxcbiAgICAgICAgaTtcblxuICAgICAgLy8gT25seSBydW4gaWYgaXQgYWN0dWFsbHkgY2hhbmdlZFxuICAgICAgaWYoICFsYXN0Q2hhbmdlIHx8IGxhc3RDaGFuZ2UudmFsdWUgIT09IHZhbHVlIHx8IGxhc3RDaGFuZ2Uub3BhY2l0eSAhPT0gb3BhY2l0eSApIHtcblxuICAgICAgICAvLyBSZW1lbWJlciBsYXN0LWNoYW5nZWQgdmFsdWVcbiAgICAgICAgaW5wdXQuZGF0YSgnbWluaWNvbG9ycy1sYXN0Q2hhbmdlJywge1xuICAgICAgICAgIHZhbHVlOiB2YWx1ZSxcbiAgICAgICAgICBvcGFjaXR5OiBvcGFjaXR5XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIENoZWNrIGFuZCBzZWxlY3QgYXBwbGljYWJsZSBzd2F0Y2hcbiAgICAgICAgaWYgKHNldHRpbmdzLnN3YXRjaGVzICYmIHNldHRpbmdzLnN3YXRjaGVzLmxlbmd0aCAhPT0gMCkge1xuICAgICAgICAgIGlmKCFpc1JnYih2YWx1ZSkpIHtcbiAgICAgICAgICAgIG9iaiA9IGhleDJyZ2IodmFsdWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIG9iaiA9IHBhcnNlUmdiKHZhbHVlLCB0cnVlKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgc2VsID0gLTE7XG4gICAgICAgICAgZm9yKGkgPSAwOyBpIDwgc2V0dGluZ3Muc3dhdGNoZXMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIGlmIChvYmouciA9PT0gc2V0dGluZ3Muc3dhdGNoZXNbaV0uciAmJiBvYmouZyA9PT0gc2V0dGluZ3Muc3dhdGNoZXNbaV0uZyAmJiBvYmouYiA9PT0gc2V0dGluZ3Muc3dhdGNoZXNbaV0uYiAmJiBvYmouYSA9PT0gc2V0dGluZ3Muc3dhdGNoZXNbaV0uYSkge1xuICAgICAgICAgICAgICBzZWwgPSBpO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpbnB1dC5wYXJlbnQoKS5maW5kKCcubWluaWNvbG9ycy1zd2F0Y2hlcyAubWluaWNvbG9ycy1zd2F0Y2gnKS5yZW1vdmVDbGFzcygnc2VsZWN0ZWQnKTtcbiAgICAgICAgICBpZiAoaSAhPT0gLTEpIHtcbiAgICAgICAgICAgIGlucHV0LnBhcmVudCgpLmZpbmQoJy5taW5pY29sb3JzLXN3YXRjaGVzIC5taW5pY29sb3JzLXN3YXRjaCcpLmVxKGkpLmFkZENsYXNzKCdzZWxlY3RlZCcpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEZpcmUgY2hhbmdlIGV2ZW50XG4gICAgICAgIGlmKCBzZXR0aW5ncy5jaGFuZ2UgKSB7XG4gICAgICAgICAgaWYoIHNldHRpbmdzLmNoYW5nZURlbGF5ICkge1xuICAgICAgICAgICAgLy8gQ2FsbCBhZnRlciBhIGRlbGF5XG4gICAgICAgICAgICBjbGVhclRpbWVvdXQoaW5wdXQuZGF0YSgnbWluaWNvbG9ycy1jaGFuZ2VUaW1lb3V0JykpO1xuICAgICAgICAgICAgaW5wdXQuZGF0YSgnbWluaWNvbG9ycy1jaGFuZ2VUaW1lb3V0Jywgc2V0VGltZW91dCggZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgIHNldHRpbmdzLmNoYW5nZS5jYWxsKGlucHV0LmdldCgwKSwgdmFsdWUsIG9wYWNpdHkpO1xuICAgICAgICAgICAgfSwgc2V0dGluZ3MuY2hhbmdlRGVsYXkpKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gQ2FsbCBpbW1lZGlhdGVseVxuICAgICAgICAgICAgc2V0dGluZ3MuY2hhbmdlLmNhbGwoaW5wdXQuZ2V0KDApLCB2YWx1ZSwgb3BhY2l0eSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlucHV0LnRyaWdnZXIoJ2NoYW5nZScpLnRyaWdnZXIoJ2lucHV0Jyk7XG4gICAgICB9XG5cbiAgICB9XG5cbiAgICAvLyBHZW5lcmF0ZXMgYW4gUkdCKEEpIG9iamVjdCBiYXNlZCBvbiB0aGUgaW5wdXQncyB2YWx1ZVxuICAgIGZ1bmN0aW9uIHJnYk9iamVjdChpbnB1dCkge1xuICAgICAgdmFyIGhleCA9IHBhcnNlSGV4KCQoaW5wdXQpLnZhbCgpLCB0cnVlKSxcbiAgICAgICAgcmdiID0gaGV4MnJnYihoZXgpLFxuICAgICAgICBvcGFjaXR5ID0gJChpbnB1dCkuYXR0cignZGF0YS1vcGFjaXR5Jyk7XG4gICAgICBpZiggIXJnYiApIHJldHVybiBudWxsO1xuICAgICAgaWYoIG9wYWNpdHkgIT09IHVuZGVmaW5lZCApICQuZXh0ZW5kKHJnYiwgeyBhOiBwYXJzZUZsb2F0KG9wYWNpdHkpIH0pO1xuICAgICAgcmV0dXJuIHJnYjtcbiAgICB9XG5cbiAgICAvLyBHZW5lcmF0ZXMgYW4gUkdCKEEpIHN0cmluZyBiYXNlZCBvbiB0aGUgaW5wdXQncyB2YWx1ZVxuICAgIGZ1bmN0aW9uIHJnYlN0cmluZyhpbnB1dCwgYWxwaGEpIHtcbiAgICAgIHZhciBoZXggPSBwYXJzZUhleCgkKGlucHV0KS52YWwoKSwgdHJ1ZSksXG4gICAgICAgIHJnYiA9IGhleDJyZ2IoaGV4KSxcbiAgICAgICAgb3BhY2l0eSA9ICQoaW5wdXQpLmF0dHIoJ2RhdGEtb3BhY2l0eScpO1xuICAgICAgaWYoICFyZ2IgKSByZXR1cm4gbnVsbDtcbiAgICAgIGlmKCBvcGFjaXR5ID09PSB1bmRlZmluZWQgKSBvcGFjaXR5ID0gMTtcbiAgICAgIGlmKCBhbHBoYSApIHtcbiAgICAgICAgcmV0dXJuICdyZ2JhKCcgKyByZ2IuciArICcsICcgKyByZ2IuZyArICcsICcgKyByZ2IuYiArICcsICcgKyBwYXJzZUZsb2F0KG9wYWNpdHkpICsgJyknO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuICdyZ2IoJyArIHJnYi5yICsgJywgJyArIHJnYi5nICsgJywgJyArIHJnYi5iICsgJyknO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIENvbnZlcnRzIHRvIHRoZSBsZXR0ZXIgY2FzZSBzcGVjaWZpZWQgaW4gc2V0dGluZ3NcbiAgICBmdW5jdGlvbiBjb252ZXJ0Q2FzZShzdHJpbmcsIGxldHRlckNhc2UpIHtcbiAgICAgIHJldHVybiBsZXR0ZXJDYXNlID09PSAndXBwZXJjYXNlJyA/IHN0cmluZy50b1VwcGVyQ2FzZSgpIDogc3RyaW5nLnRvTG93ZXJDYXNlKCk7XG4gICAgfVxuXG4gICAgLy8gUGFyc2VzIGEgc3RyaW5nIGFuZCByZXR1cm5zIGEgdmFsaWQgaGV4IHN0cmluZyB3aGVuIHBvc3NpYmxlXG4gICAgZnVuY3Rpb24gcGFyc2VIZXgoc3RyaW5nLCBleHBhbmQpIHtcbiAgICAgIHN0cmluZyA9IHN0cmluZy5yZXBsYWNlKC9eIy9nLCAnJyk7XG4gICAgICBpZiggIXN0cmluZy5tYXRjaCgvXltBLUYwLTldezMsNn0vaWcpICkgcmV0dXJuICcnO1xuICAgICAgaWYoIHN0cmluZy5sZW5ndGggIT09IDMgJiYgc3RyaW5nLmxlbmd0aCAhPT0gNiApIHJldHVybiAnJztcbiAgICAgIGlmKCBzdHJpbmcubGVuZ3RoID09PSAzICYmIGV4cGFuZCApIHtcbiAgICAgICAgc3RyaW5nID0gc3RyaW5nWzBdICsgc3RyaW5nWzBdICsgc3RyaW5nWzFdICsgc3RyaW5nWzFdICsgc3RyaW5nWzJdICsgc3RyaW5nWzJdO1xuICAgICAgfVxuICAgICAgcmV0dXJuICcjJyArIHN0cmluZztcbiAgICB9XG5cbiAgICAvLyBQYXJzZXMgYSBzdHJpbmcgYW5kIHJldHVybnMgYSB2YWxpZCBSR0IoQSkgc3RyaW5nIHdoZW4gcG9zc2libGVcbiAgICBmdW5jdGlvbiBwYXJzZVJnYihzdHJpbmcsIG9iaikge1xuXG4gICAgICB2YXIgdmFsdWVzID0gc3RyaW5nLnJlcGxhY2UoL1teXFxkLC5dL2csICcnKSxcbiAgICAgICAgcmdiYSA9IHZhbHVlcy5zcGxpdCgnLCcpO1xuXG4gICAgICByZ2JhWzBdID0ga2VlcFdpdGhpbihwYXJzZUludChyZ2JhWzBdLCAxMCksIDAsIDI1NSk7XG4gICAgICByZ2JhWzFdID0ga2VlcFdpdGhpbihwYXJzZUludChyZ2JhWzFdLCAxMCksIDAsIDI1NSk7XG4gICAgICByZ2JhWzJdID0ga2VlcFdpdGhpbihwYXJzZUludChyZ2JhWzJdLCAxMCksIDAsIDI1NSk7XG4gICAgICBpZiggcmdiYVszXSApIHtcbiAgICAgICAgcmdiYVszXSA9IGtlZXBXaXRoaW4ocGFyc2VGbG9hdChyZ2JhWzNdLCAxMCksIDAsIDEpO1xuICAgICAgfVxuXG4gICAgICAvLyBSZXR1cm4gUkdCQSBvYmplY3RcbiAgICAgIGlmKCBvYmogKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgcjogcmdiYVswXSxcbiAgICAgICAgICBnOiByZ2JhWzFdLFxuICAgICAgICAgIGI6IHJnYmFbMl0sXG4gICAgICAgICAgYTogcmdiYVszXSA/IHJnYmFbM10gOiBudWxsXG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIC8vIFJldHVybiBSR0JBIHN0cmluZ1xuICAgICAgaWYoIHR5cGVvZihyZ2JhWzNdKSAhPT0gJ3VuZGVmaW5lZCcgJiYgcmdiYVszXSA8PSAxICkge1xuICAgICAgICByZXR1cm4gJ3JnYmEoJyArIHJnYmFbMF0gKyAnLCAnICsgcmdiYVsxXSArICcsICcgKyByZ2JhWzJdICsgJywgJyArIHJnYmFbM10gKyAnKSc7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gJ3JnYignICsgcmdiYVswXSArICcsICcgKyByZ2JhWzFdICsgJywgJyArIHJnYmFbMl0gKyAnKSc7XG4gICAgICB9XG5cbiAgICB9XG5cbiAgICAvLyBQYXJzZXMgYSBzdHJpbmcgYW5kIHJldHVybnMgYSB2YWxpZCBjb2xvciBzdHJpbmcgd2hlbiBwb3NzaWJsZVxuICAgIGZ1bmN0aW9uIHBhcnNlSW5wdXQoc3RyaW5nLCBleHBhbmQpIHtcbiAgICAgIGlmKCBpc1JnYihzdHJpbmcpICkge1xuICAgICAgICAvLyBSZXR1cm5zIGEgdmFsaWQgcmdiKGEpIHN0cmluZ1xuICAgICAgICByZXR1cm4gcGFyc2VSZ2Ioc3RyaW5nKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBwYXJzZUhleChzdHJpbmcsIGV4cGFuZCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gS2VlcHMgdmFsdWUgd2l0aGluIG1pbiBhbmQgbWF4XG4gICAgZnVuY3Rpb24ga2VlcFdpdGhpbih2YWx1ZSwgbWluLCBtYXgpIHtcbiAgICAgIGlmKCB2YWx1ZSA8IG1pbiApIHZhbHVlID0gbWluO1xuICAgICAgaWYoIHZhbHVlID4gbWF4ICkgdmFsdWUgPSBtYXg7XG4gICAgICByZXR1cm4gdmFsdWU7XG4gICAgfVxuXG4gICAgLy8gQ2hlY2tzIGlmIGEgc3RyaW5nIGlzIGEgdmFsaWQgUkdCKEEpIHN0cmluZ1xuICAgIGZ1bmN0aW9uIGlzUmdiKHN0cmluZykge1xuICAgICAgdmFyIHJnYiA9IHN0cmluZy5tYXRjaCgvXnJnYmE/W1xccytdP1xcKFtcXHMrXT8oXFxkKylbXFxzK10/LFtcXHMrXT8oXFxkKylbXFxzK10/LFtcXHMrXT8oXFxkKylbXFxzK10/L2kpO1xuICAgICAgcmV0dXJuIChyZ2IgJiYgcmdiLmxlbmd0aCA9PT0gNCkgPyB0cnVlIDogZmFsc2U7XG4gICAgfVxuXG4gICAgLy8gRnVuY3Rpb24gdG8gZ2V0IGFscGhhIGZyb20gYSBSR0IoQSkgc3RyaW5nXG4gICAgZnVuY3Rpb24gZ2V0QWxwaGEocmdiYSkge1xuICAgICAgcmdiYSA9IHJnYmEubWF0Y2goL15yZ2JhP1tcXHMrXT9cXChbXFxzK10/KFxcZCspW1xccytdPyxbXFxzK10/KFxcZCspW1xccytdPyxbXFxzK10/KFxcZCspW1xccytdPyxbXFxzK10/KFxcZCsoXFwuXFxkezEsMn0pP3xcXC5cXGR7MSwyfSlbXFxzK10/L2kpO1xuICAgICAgcmV0dXJuIChyZ2JhICYmIHJnYmEubGVuZ3RoID09PSA2KSA/IHJnYmFbNF0gOiAnMSc7XG4gICAgfVxuXG4gICAgLy8gQ29udmVydHMgYW4gSFNCIG9iamVjdCB0byBhbiBSR0Igb2JqZWN0XG4gICAgZnVuY3Rpb24gaHNiMnJnYihoc2IpIHtcbiAgICAgIHZhciByZ2IgPSB7fTtcbiAgICAgIHZhciBoID0gTWF0aC5yb3VuZChoc2IuaCk7XG4gICAgICB2YXIgcyA9IE1hdGgucm91bmQoaHNiLnMgKiAyNTUgLyAxMDApO1xuICAgICAgdmFyIHYgPSBNYXRoLnJvdW5kKGhzYi5iICogMjU1IC8gMTAwKTtcbiAgICAgIGlmKHMgPT09IDApIHtcbiAgICAgICAgcmdiLnIgPSByZ2IuZyA9IHJnYi5iID0gdjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciB0MSA9IHY7XG4gICAgICAgIHZhciB0MiA9ICgyNTUgLSBzKSAqIHYgLyAyNTU7XG4gICAgICAgIHZhciB0MyA9ICh0MSAtIHQyKSAqIChoICUgNjApIC8gNjA7XG4gICAgICAgIGlmKCBoID09PSAzNjAgKSBoID0gMDtcbiAgICAgICAgaWYoIGggPCA2MCApIHsgcmdiLnIgPSB0MTsgcmdiLmIgPSB0MjsgcmdiLmcgPSB0MiArIHQzOyB9XG4gICAgICAgIGVsc2UgaWYoIGggPCAxMjAgKSB7cmdiLmcgPSB0MTsgcmdiLmIgPSB0MjsgcmdiLnIgPSB0MSAtIHQzOyB9XG4gICAgICAgIGVsc2UgaWYoIGggPCAxODAgKSB7cmdiLmcgPSB0MTsgcmdiLnIgPSB0MjsgcmdiLmIgPSB0MiArIHQzOyB9XG4gICAgICAgIGVsc2UgaWYoIGggPCAyNDAgKSB7cmdiLmIgPSB0MTsgcmdiLnIgPSB0MjsgcmdiLmcgPSB0MSAtIHQzOyB9XG4gICAgICAgIGVsc2UgaWYoIGggPCAzMDAgKSB7cmdiLmIgPSB0MTsgcmdiLmcgPSB0MjsgcmdiLnIgPSB0MiArIHQzOyB9XG4gICAgICAgIGVsc2UgaWYoIGggPCAzNjAgKSB7cmdiLnIgPSB0MTsgcmdiLmcgPSB0MjsgcmdiLmIgPSB0MSAtIHQzOyB9XG4gICAgICAgIGVsc2UgeyByZ2IuciA9IDA7IHJnYi5nID0gMDsgcmdiLmIgPSAwOyB9XG4gICAgICB9XG4gICAgICByZXR1cm4ge1xuICAgICAgICByOiBNYXRoLnJvdW5kKHJnYi5yKSxcbiAgICAgICAgZzogTWF0aC5yb3VuZChyZ2IuZyksXG4gICAgICAgIGI6IE1hdGgucm91bmQocmdiLmIpXG4gICAgICB9O1xuICAgIH1cblxuICAgIC8vIENvbnZlcnRzIGFuIFJHQiBzdHJpbmcgdG8gYSBoZXggc3RyaW5nXG4gICAgZnVuY3Rpb24gcmdiU3RyaW5nMmhleChyZ2Ipe1xuICAgICAgcmdiID0gcmdiLm1hdGNoKC9ecmdiYT9bXFxzK10/XFwoW1xccytdPyhcXGQrKVtcXHMrXT8sW1xccytdPyhcXGQrKVtcXHMrXT8sW1xccytdPyhcXGQrKVtcXHMrXT8vaSk7XG4gICAgICByZXR1cm4gKHJnYiAmJiByZ2IubGVuZ3RoID09PSA0KSA/ICcjJyArXG4gICAgICAoJzAnICsgcGFyc2VJbnQocmdiWzFdLDEwKS50b1N0cmluZygxNikpLnNsaWNlKC0yKSArXG4gICAgICAoJzAnICsgcGFyc2VJbnQocmdiWzJdLDEwKS50b1N0cmluZygxNikpLnNsaWNlKC0yKSArXG4gICAgICAoJzAnICsgcGFyc2VJbnQocmdiWzNdLDEwKS50b1N0cmluZygxNikpLnNsaWNlKC0yKSA6ICcnO1xuICAgIH1cblxuICAgIC8vIENvbnZlcnRzIGFuIFJHQiBvYmplY3QgdG8gYSBoZXggc3RyaW5nXG4gICAgZnVuY3Rpb24gcmdiMmhleChyZ2IpIHtcbiAgICAgIHZhciBoZXggPSBbXG4gICAgICAgIHJnYi5yLnRvU3RyaW5nKDE2KSxcbiAgICAgICAgcmdiLmcudG9TdHJpbmcoMTYpLFxuICAgICAgICByZ2IuYi50b1N0cmluZygxNilcbiAgICAgIF07XG4gICAgICAkLmVhY2goaGV4LCBmdW5jdGlvbihuciwgdmFsKSB7XG4gICAgICAgIGlmICh2YWwubGVuZ3RoID09PSAxKSBoZXhbbnJdID0gJzAnICsgdmFsO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gJyMnICsgaGV4LmpvaW4oJycpO1xuICAgIH1cblxuICAgIC8vIENvbnZlcnRzIGFuIEhTQiBvYmplY3QgdG8gYSBoZXggc3RyaW5nXG4gICAgZnVuY3Rpb24gaHNiMmhleChoc2IpIHtcbiAgICAgIHJldHVybiByZ2IyaGV4KGhzYjJyZ2IoaHNiKSk7XG4gICAgfVxuXG4gICAgLy8gQ29udmVydHMgYSBoZXggc3RyaW5nIHRvIGFuIEhTQiBvYmplY3RcbiAgICBmdW5jdGlvbiBoZXgyaHNiKGhleCkge1xuICAgICAgdmFyIGhzYiA9IHJnYjJoc2IoaGV4MnJnYihoZXgpKTtcbiAgICAgIGlmKCBoc2IucyA9PT0gMCApIGhzYi5oID0gMzYwO1xuICAgICAgcmV0dXJuIGhzYjtcbiAgICB9XG5cbiAgICAvLyBDb252ZXJ0cyBhbiBSR0Igb2JqZWN0IHRvIGFuIEhTQiBvYmplY3RcbiAgICBmdW5jdGlvbiByZ2IyaHNiKHJnYikge1xuICAgICAgdmFyIGhzYiA9IHsgaDogMCwgczogMCwgYjogMCB9O1xuICAgICAgdmFyIG1pbiA9IE1hdGgubWluKHJnYi5yLCByZ2IuZywgcmdiLmIpO1xuICAgICAgdmFyIG1heCA9IE1hdGgubWF4KHJnYi5yLCByZ2IuZywgcmdiLmIpO1xuICAgICAgdmFyIGRlbHRhID0gbWF4IC0gbWluO1xuICAgICAgaHNiLmIgPSBtYXg7XG4gICAgICBoc2IucyA9IG1heCAhPT0gMCA/IDI1NSAqIGRlbHRhIC8gbWF4IDogMDtcbiAgICAgIGlmKCBoc2IucyAhPT0gMCApIHtcbiAgICAgICAgaWYoIHJnYi5yID09PSBtYXggKSB7XG4gICAgICAgICAgaHNiLmggPSAocmdiLmcgLSByZ2IuYikgLyBkZWx0YTtcbiAgICAgICAgfSBlbHNlIGlmKCByZ2IuZyA9PT0gbWF4ICkge1xuICAgICAgICAgIGhzYi5oID0gMiArIChyZ2IuYiAtIHJnYi5yKSAvIGRlbHRhO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGhzYi5oID0gNCArIChyZ2IuciAtIHJnYi5nKSAvIGRlbHRhO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBoc2IuaCA9IC0xO1xuICAgICAgfVxuICAgICAgaHNiLmggKj0gNjA7XG4gICAgICBpZiggaHNiLmggPCAwICkge1xuICAgICAgICBoc2IuaCArPSAzNjA7XG4gICAgICB9XG4gICAgICBoc2IucyAqPSAxMDAvMjU1O1xuICAgICAgaHNiLmIgKj0gMTAwLzI1NTtcbiAgICAgIHJldHVybiBoc2I7XG4gICAgfVxuXG4gICAgLy8gQ29udmVydHMgYSBoZXggc3RyaW5nIHRvIGFuIFJHQiBvYmplY3RcbiAgICBmdW5jdGlvbiBoZXgycmdiKGhleCkge1xuICAgICAgaGV4ID0gcGFyc2VJbnQoKChoZXguaW5kZXhPZignIycpID4gLTEpID8gaGV4LnN1YnN0cmluZygxKSA6IGhleCksIDE2KTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIC8qIGpzaGludCBpZ25vcmU6c3RhcnQgKi9cbiAgICAgICAgcjogaGV4ID4+IDE2LFxuICAgICAgICBnOiAoaGV4ICYgMHgwMEZGMDApID4+IDgsXG4gICAgICAgIGI6IChoZXggJiAweDAwMDBGRilcbiAgICAgICAgLyoganNoaW50IGlnbm9yZTplbmQgKi9cbiAgICAgIH07XG4gICAgfVxuXG4gICAgLy8gSGFuZGxlIGV2ZW50c1xuICAgICQoZG9jdW1lbnQpXG4gICAgICAvLyBIaWRlIG9uIGNsaWNrcyBvdXRzaWRlIG9mIHRoZSBjb250cm9sXG4gICAgICAub24oJ21vdXNlZG93bi5taW5pY29sb3JzIHRvdWNoc3RhcnQubWluaWNvbG9ycycsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgIGlmKCAhJChldmVudC50YXJnZXQpLnBhcmVudHMoKS5hZGQoZXZlbnQudGFyZ2V0KS5oYXNDbGFzcygnbWluaWNvbG9ycycpICkge1xuICAgICAgICAgIGhpZGUoKTtcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICAgIC8vIFN0YXJ0IG1vdmluZ1xuICAgICAgLm9uKCdtb3VzZWRvd24ubWluaWNvbG9ycyB0b3VjaHN0YXJ0Lm1pbmljb2xvcnMnLCAnLm1pbmljb2xvcnMtZ3JpZCwgLm1pbmljb2xvcnMtc2xpZGVyLCAubWluaWNvbG9ycy1vcGFjaXR5LXNsaWRlcicsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgIHZhciB0YXJnZXQgPSAkKHRoaXMpO1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAkKGRvY3VtZW50KS5kYXRhKCdtaW5pY29sb3JzLXRhcmdldCcsIHRhcmdldCk7XG4gICAgICAgIG1vdmUodGFyZ2V0LCBldmVudCwgdHJ1ZSk7XG4gICAgICB9KVxuICAgICAgLy8gTW92ZSBwaWNrZXJzXG4gICAgICAub24oJ21vdXNlbW92ZS5taW5pY29sb3JzIHRvdWNobW92ZS5taW5pY29sb3JzJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgdmFyIHRhcmdldCA9ICQoZG9jdW1lbnQpLmRhdGEoJ21pbmljb2xvcnMtdGFyZ2V0Jyk7XG4gICAgICAgIGlmKCB0YXJnZXQgKSBtb3ZlKHRhcmdldCwgZXZlbnQpO1xuICAgICAgfSlcbiAgICAgIC8vIFN0b3AgbW92aW5nXG4gICAgICAub24oJ21vdXNldXAubWluaWNvbG9ycyB0b3VjaGVuZC5taW5pY29sb3JzJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICQodGhpcykucmVtb3ZlRGF0YSgnbWluaWNvbG9ycy10YXJnZXQnKTtcbiAgICAgIH0pXG4gICAgICAvLyBTZWxlY3RlZCBhIHN3YXRjaFxuICAgICAgLm9uKCdjbGljay5taW5pY29sb3JzJywgJy5taW5pY29sb3JzLXN3YXRjaGVzIGxpJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgdmFyIHRhcmdldCA9ICQodGhpcyksIGlucHV0ID0gdGFyZ2V0LnBhcmVudHMoJy5taW5pY29sb3JzJykuZmluZCgnLm1pbmljb2xvcnMtaW5wdXQnKSwgY29sb3IgPSB0YXJnZXQuZGF0YSgnc3dhdGNoLWNvbG9yJyk7XG4gICAgICAgIHVwZGF0ZUlucHV0KGlucHV0LCBjb2xvciwgZ2V0QWxwaGEoY29sb3IpKTtcbiAgICAgICAgdXBkYXRlRnJvbUlucHV0KGlucHV0KTtcbiAgICAgIH0pXG4gICAgICAvLyBTaG93IHBhbmVsIHdoZW4gc3dhdGNoIGlzIGNsaWNrZWRcbiAgICAgIC5vbignbW91c2Vkb3duLm1pbmljb2xvcnMgdG91Y2hzdGFydC5taW5pY29sb3JzJywgJy5taW5pY29sb3JzLWlucHV0LXN3YXRjaCcsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgIHZhciBpbnB1dCA9ICQodGhpcykucGFyZW50KCkuZmluZCgnLm1pbmljb2xvcnMtaW5wdXQnKTtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgaWYoIGlucHV0LnBhcmVudCgpLmZpbmQoJy5taW5pY29sb3JzLXBhbmVsJykuY3NzKFwiZGlzcGxheVwiKSAhPT0gXCJub25lXCIpe1xuICAgICAgICAgIC8vdG9kb1xuICAgICAgICAgIC8vaGlkZSgpO1xuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICBzaG93KGlucHV0KTtcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICAgIC8vIFNob3cgb24gZm9jdXNcbiAgICAgIC5vbignZm9jdXMubWluaWNvbG9ycycsICcubWluaWNvbG9ycy1pbnB1dCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgaW5wdXQgPSAkKHRoaXMpO1xuICAgICAgICBpZiggIWlucHV0LmRhdGEoJ21pbmljb2xvcnMtaW5pdGlhbGl6ZWQnKSApIHJldHVybjtcbiAgICAgICAgc2hvdyhpbnB1dCk7XG4gICAgICB9KVxuICAgICAgLy8gVXBkYXRlIHZhbHVlIG9uIGJsdXJcbiAgICAgIC5vbignYmx1ci5taW5pY29sb3JzJywgJy5taW5pY29sb3JzLWlucHV0JywgZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBpbnB1dCA9ICQodGhpcyksXG4gICAgICAgICAgc2V0dGluZ3MgPSBpbnB1dC5kYXRhKCdtaW5pY29sb3JzLXNldHRpbmdzJyksXG4gICAgICAgICAga2V5d29yZHMsXG4gICAgICAgICAgaGV4LFxuICAgICAgICAgIHJnYmEsXG4gICAgICAgICAgc3dhdGNoT3BhY2l0eSxcbiAgICAgICAgICB2YWx1ZTtcblxuICAgICAgICBpZiggIWlucHV0LmRhdGEoJ21pbmljb2xvcnMtaW5pdGlhbGl6ZWQnKSApIHJldHVybjtcblxuICAgICAgICAvLyBHZXQgYXJyYXkgb2YgbG93ZXJjYXNlIGtleXdvcmRzXG4gICAgICAgIGtleXdvcmRzID0gIXNldHRpbmdzLmtleXdvcmRzID8gW10gOiAkLm1hcChzZXR0aW5ncy5rZXl3b3Jkcy5zcGxpdCgnLCcpLCBmdW5jdGlvbihhKSB7XG4gICAgICAgICAgcmV0dXJuICQudHJpbShhLnRvTG93ZXJDYXNlKCkpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBTZXQgY29sb3Igc3RyaW5nXG4gICAgICAgIGlmKCBpbnB1dC52YWwoKSAhPT0gJycgJiYgJC5pbkFycmF5KGlucHV0LnZhbCgpLnRvTG93ZXJDYXNlKCksIGtleXdvcmRzKSA+IC0xICkge1xuICAgICAgICAgIHZhbHVlID0gaW5wdXQudmFsKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gR2V0IFJHQkEgdmFsdWVzIGZvciBlYXN5IGNvbnZlcnNpb25cbiAgICAgICAgICBpZiggaXNSZ2IoaW5wdXQudmFsKCkpICkge1xuICAgICAgICAgICAgcmdiYSA9IHBhcnNlUmdiKGlucHV0LnZhbCgpLCB0cnVlKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaGV4ID0gcGFyc2VIZXgoaW5wdXQudmFsKCksIHRydWUpO1xuICAgICAgICAgICAgcmdiYSA9IGhleCA/IGhleDJyZ2IoaGV4KSA6IG51bGw7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gQ29udmVydCB0byBmb3JtYXRcbiAgICAgICAgICBpZiggcmdiYSA9PT0gbnVsbCApIHtcbiAgICAgICAgICAgIHZhbHVlID0gc2V0dGluZ3MuZGVmYXVsdFZhbHVlO1xuICAgICAgICAgIH0gZWxzZSBpZiggc2V0dGluZ3MuZm9ybWF0ID09PSAncmdiJyApIHtcbiAgICAgICAgICAgIHZhbHVlID0gc2V0dGluZ3Mub3BhY2l0eSA/XG4gICAgICAgICAgICAgIHBhcnNlUmdiKCdyZ2JhKCcgKyByZ2JhLnIgKyAnLCcgKyByZ2JhLmcgKyAnLCcgKyByZ2JhLmIgKyAnLCcgKyBpbnB1dC5hdHRyKCdkYXRhLW9wYWNpdHknKSArICcpJykgOlxuICAgICAgICAgICAgICBwYXJzZVJnYigncmdiKCcgKyByZ2JhLnIgKyAnLCcgKyByZ2JhLmcgKyAnLCcgKyByZ2JhLmIgKyAnKScpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB2YWx1ZSA9IHJnYjJoZXgocmdiYSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gVXBkYXRlIHN3YXRjaCBvcGFjaXR5XG4gICAgICAgIHN3YXRjaE9wYWNpdHkgPSBzZXR0aW5ncy5vcGFjaXR5ID8gaW5wdXQuYXR0cignZGF0YS1vcGFjaXR5JykgOiAxO1xuICAgICAgICBpZiggdmFsdWUudG9Mb3dlckNhc2UoKSA9PT0gJ3RyYW5zcGFyZW50JyApIHN3YXRjaE9wYWNpdHkgPSAwO1xuICAgICAgICBpbnB1dFxuICAgICAgICAgIC5jbG9zZXN0KCcubWluaWNvbG9ycycpXG4gICAgICAgICAgLmZpbmQoJy5taW5pY29sb3JzLWlucHV0LXN3YXRjaCA+IHNwYW4nKVxuICAgICAgICAgIC5jc3MoJ29wYWNpdHknLCBzd2F0Y2hPcGFjaXR5KTtcblxuICAgICAgICAvLyBTZXQgaW5wdXQgdmFsdWVcbiAgICAgICAgaW5wdXQudmFsKHZhbHVlKTtcblxuICAgICAgICAvLyBJcyBpdCBibGFuaz9cbiAgICAgICAgaWYoIGlucHV0LnZhbCgpID09PSAnJyApIGlucHV0LnZhbChwYXJzZUlucHV0KHNldHRpbmdzLmRlZmF1bHRWYWx1ZSwgdHJ1ZSkpO1xuXG4gICAgICAgIC8vIEFkanVzdCBjYXNlXG4gICAgICAgIGlucHV0LnZhbCggY29udmVydENhc2UoaW5wdXQudmFsKCksIHNldHRpbmdzLmxldHRlckNhc2UpICk7XG5cbiAgICAgIH0pXG4gICAgICAvLyBIYW5kbGUga2V5cHJlc3Nlc1xuICAgICAgLm9uKCdrZXlkb3duLm1pbmljb2xvcnMnLCAnLm1pbmljb2xvcnMtaW5wdXQnLCBmdW5jdGlvbihldmVudCkge1xuICAgICAgICB2YXIgaW5wdXQgPSAkKHRoaXMpO1xuICAgICAgICBpZiggIWlucHV0LmRhdGEoJ21pbmljb2xvcnMtaW5pdGlhbGl6ZWQnKSApIHJldHVybjtcbiAgICAgICAgc3dpdGNoKGV2ZW50LmtleUNvZGUpIHtcbiAgICAgICAgICBjYXNlIDk6IC8vIHRhYlxuICAgICAgICAgICAgaGlkZSgpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSAxMzogLy8gZW50ZXJcbiAgICAgICAgICBjYXNlIDI3OiAvLyBlc2NcbiAgICAgICAgICAgIGhpZGUoKTtcbiAgICAgICAgICAgIGlucHV0LmJsdXIoKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgICAgLy8gVXBkYXRlIG9uIGtleXVwXG4gICAgICAub24oJ2tleXVwLm1pbmljb2xvcnMnLCAnLm1pbmljb2xvcnMtaW5wdXQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGlucHV0ID0gJCh0aGlzKTtcbiAgICAgICAgaWYoICFpbnB1dC5kYXRhKCdtaW5pY29sb3JzLWluaXRpYWxpemVkJykgKSByZXR1cm47XG4gICAgICAgIHVwZGF0ZUZyb21JbnB1dChpbnB1dCwgdHJ1ZSk7XG4gICAgICB9KVxuICAgICAgLy8gVXBkYXRlIG9uIHBhc3RlXG4gICAgICAub24oJ3Bhc3RlLm1pbmljb2xvcnMnLCAnLm1pbmljb2xvcnMtaW5wdXQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGlucHV0ID0gJCh0aGlzKTtcbiAgICAgICAgaWYoICFpbnB1dC5kYXRhKCdtaW5pY29sb3JzLWluaXRpYWxpemVkJykgKSByZXR1cm47XG4gICAgICAgIHNldFRpbWVvdXQoIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHVwZGF0ZUZyb21JbnB1dChpbnB1dCwgdHJ1ZSk7XG4gICAgICAgIH0sIDEpO1xuICAgICAgfSk7XG5cbiAgfSkpO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHBsdWdpbnMvJC5taW5pY29sb3JzLmpzIiwiXG5pZighJC5mb250U2VsZWN0b3Ipe1xuICByZXF1aXJlKFwiLi4vLi4vcGx1Z2lucy8kLmZvbnRTZWxlY3RvclwiKTtcbn1cblxuaWYodHlwZW9mIFRvb2xiYXIgPT09IFwidW5kZWZpbmVkXCIpe1xuICB2YXIgVG9vbGJhciA9IHJlcXVpcmUoXCIuLi9zcmMvdG9vbGJhclwiKTtcbn1cblxuVG9vbGJhci5wcm90b3R5cGUuZm9udHMgPSBbXG4gICdBcmlhbCxIZWx2ZXRpY2Esc2Fucy1zZXJpZicsXG4gICdBcmlhbCBCbGFjayxHYWRnZXQsc2Fucy1zZXJpZicsXG4gICdDb21pYyBTYW5zIE1TLGN1cnNpdmUnLFxuICAnQ291cmllciBOZXcsQ291cmllcixtb25vc3BhY2UnLFxuICAnR2VvcmdpYSxzZXJpZicsXG4gICdJbXBhY3QsQ2hhcmNvYWwsc2Fucy1zZXJpZicsXG4gICdMdWNpZGEgQ29uc29sZSxNb25hY28sbW9ub3NwYWNlJyxcbiAgJ0x1Y2lkYSBTYW5zIFVuaWNvZGUsTHVjaWRhIEdyYW5kZSxzYW5zLXNlcmlmJyxcbiAgJ1BhbGF0aW5vIExpbm90eXBlLEJvb2sgQW50aXF1YSxQYWxhdGlubyxzZXJpZicsXG4gICdUYWhvbWEsR2VuZXZhLHNhbnMtc2VyaWYnLFxuICAnVGltZXMgTmV3IFJvbWFuLFRpbWVzLHNlcmlmJyxcbiAgJ1RyZWJ1Y2hldCBNUyxIZWx2ZXRpY2Esc2Fucy1zZXJpZicsXG4gICdWZXJkYW5hLEdlbmV2YSxzYW5zLXNlcmlmJyxcbiAgJ0dpbGwgU2FucyxHZW5ldmEsc2Fucy1zZXJpZidcbl07XG5cblxuVG9vbGJhci5wcm90b3R5cGUudG9vbHMuZm9udEZhbWlseSA9IHtcbiAgc2NvcGU6IGZ1bmN0aW9uIChkYXRhLCBvcHRpb25zKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIC8vY3VycmVudFZhbHVlOiBkYXRhLnZhbHVlLmdldCgpLFxuICAgICAgb25jaGFuZ2U6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGRhdGEudmFsdWUuc2V0KHBhcnNlRmxvYXQoJChlLnRhcmdldCkudmFsKCkpKTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIHRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cIm9iamVjdC1tZW51LWl0ZW0gb2JqZWN0LW1lbnUtZm9udC1mYW1pbHlcIiB0aXRsZT1cInt0aXRsZX1cIj4nICtcbiAgJzxkaXYgY2xhc3M9XCJmb250U2VsZWN0XCIgdHJhbnNjbHVkZT48ZGl2IGNsYXNzPVwiYXJyb3ctZG93blwiPicsXG4gICAgcG9zdDogZnVuY3Rpb24gKCRpdGVtLCBkYXRhLCBvcHRpb25zLCB0cmFuc2NsdWRlKSB7XG5cbiAgICB0cmFuc2NsdWRlLmZvbnRTZWxlY3Rvcih7XG4gICAgICAnaGlkZV9mYWxsYmFja3MnOiB0cnVlLFxuICAgICAgJ2luaXRpYWwnOiBkYXRhLnZhbHVlLmdldCgpLC8vJ0NvdXJpZXIgTmV3LENvdXJpZXIgTmV3LENvdXJpZXIsbW9ub3NwYWNlJyxcbiAgICAgICdzZWxlY3RlZCc6IGRhdGEudmFsdWUuc2V0LmJpbmQoZGF0YS50YXJnZXQpLFxuICAgICAgJ2ZvbnRzJzogZGF0YS5kYXRhXG4gICAgfSk7XG5cbiAgICB0aGlzLm9uKFwiZGVzdHJveVwiLCgpID0+IHtcbiAgICAgIHRyYW5zY2x1ZGUuZm9udFNlbGVjdG9yKFwiZGVzdHJveVwiKTtcbiAgICB9KVxuICB9XG59O1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHRvb2xiYXIvbW9kdWxlcy90b29sYmFyLmZvbnRzLmpzIiwiLyoqXG4gKiBGb250IFNlbGVjdG9yIC0galF1ZXJ5IHBsdWdpbiAwLjFcbiAqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTIgQ2hyaXMgRHllclxuICpcbiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKlxuICogUmVkaXN0cmlidXRpb24gYW5kIHVzZSBpbiBzb3VyY2UgYW5kIGJpbmFyeSBmb3Jtcywgd2l0aCBvciB3aXRob3V0IG1vZGlmaWNhdGlvbiwgYXJlIHBlcm1pdHRlZCBwcm92aWRlZCB0aGF0IHRoZSBmb2xsb3dpbmdcbiAqIGNvbmRpdGlvbnMgYXJlIG1ldDpcbiAqXG4gKiBSZWRpc3RyaWJ1dGlvbnMgb2Ygc291cmNlIGNvZGUgbXVzdCByZXRhaW4gdGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nXG4gKiBkaXNjbGFpbWVyLiBSZWRpc3RyaWJ1dGlvbnMgaW4gYmluYXJ5IGZvcm0gbXVzdCByZXByb2R1Y2UgdGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zXG4gKiBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyIGluIHRoZSBkb2N1bWVudGF0aW9uIGFuZC9vciBvdGhlciBtYXRlcmlhbHMgcHJvdmlkZWQgd2l0aCB0aGUgZGlzdHJpYnV0aW9uLlxuICpcbiAqIFRISVMgU09GVFdBUkUgSVMgUFJPVklERUQgQlkgVEhFIENPUFlSSUdIVCBIT0xERVJTIEFORCBDT05UUklCVVRPUlMgXCJBUyBJU1wiIEFORCBBTlkgRVhQUkVTUyBPUiBJTVBMSUVEIFdBUlJBTlRJRVMsIElOQ0xVRElORyxcbiAqIEJVVCBOT1QgTElNSVRFRCBUTywgVEhFIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkgQU5EIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFSRSBESVNDTEFJTUVELiBJTiBOT1xuICogRVZFTlQgU0hBTEwgVEhFIENPUFlSSUdIVCBIT0xERVIgT1IgQ09OVFJJQlVUT1JTIEJFIExJQUJMRSBGT1IgQU5ZIERJUkVDVCwgSU5ESVJFQ1QsIElOQ0lERU5UQUwsIFNQRUNJQUwsIEVYRU1QTEFSWSwgT1JcbiAqIENPTlNFUVVFTlRJQUwgREFNQUdFUyAoSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFBST0NVUkVNRU5UIE9GIFNVQlNUSVRVVEUgR09PRFMgT1IgU0VSVklDRVM7IExPU1MgT0YgVVNFLCBEQVRBLCBPUiBQUk9GSVRTO1xuICogT1IgQlVTSU5FU1MgSU5URVJSVVBUSU9OKSBIT1dFVkVSIENBVVNFRCBBTkQgT04gQU5ZIFRIRU9SWSBPRiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQ09OVFJBQ1QsIFNUUklDVCBMSUFCSUxJVFksIE9SIFRPUlRcbiAqIChJTkNMVURJTkcgTkVHTElHRU5DRSBPUiBPVEhFUldJU0UpIEFSSVNJTkcgSU4gQU5ZIFdBWSBPVVQgT0YgVEhFIFVTRSBPRiBUSElTIFNPRlRXQVJFLCBFVkVOIElGIEFEVklTRUQgT0YgVEhFIFBPU1NJQklMSVRZIE9GXG4gKiBTVUNIIERBTUFHRS5cbiAqXG4gKi9cblxuXG5cbihmdW5jdGlvbiAoZmFjdG9yeSkge1xuICBpZiAodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KHJlcXVpcmUoJ2pxdWVyeScpKTtcbiAgfSBlbHNlIHtcbiAgICBmYWN0b3J5KGpRdWVyeSk7XG4gIH1cbn0oXG4gICAgZnVuY3Rpb24oICQgKSB7XG5cbiAgJ3VzZSBzdHJpY3QnO1xuICAvL2lmKF8gJiYgXy5zdHlsZVNoZWV0Q29udGFpbnMgJiYgIV8uc3R5bGVTaGVldENvbnRhaW5zKCcuZm9udFNlbGVjdCcpKXtcbiAgLy8gIF8ubGlua0NTUyhfLnNjcmlwdFVSTCgpICsgXCIvLi4vLi4vY3NzL2pxdWVyeS5mb250U2VsZWN0b3IuY3NzXCIpO1xuICAvL31cblxuICB2YXIgc2V0dGluZ3M7XG5cbiAgdmFyIG1ldGhvZHMgPSB7XG4gICAgZGVzdHJveSA6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgIHRoaXMudWwucmVtb3ZlKCk7XG4gICAgfSxcbiAgICBjbG9zZSA6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgIHRoaXMuY2xvc2VVbCgpO1xuICAgIH0sXG4gICAgaW5pdCA6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcblxuICAgICAgc2V0dGluZ3MgPSAkLmV4dGVuZCgge1xuICAgICAgICAnaGlkZV9mYWxsYmFja3MnIDogZmFsc2UsXG4gICAgICAgICdzZWxlY3RlZCcgOiBmdW5jdGlvbihzdHlsZSkge30sXG4gICAgICAgICdvcGVuZWQnIDogZnVuY3Rpb24oKSB7fSxcbiAgICAgICAgJ2Nsb3NlZCcgOiBmdW5jdGlvbigpIHt9LFxuICAgICAgICAnaW5pdGlhbCcgOiAnJyxcbiAgICAgICAgJ2ZvbnRzJyA6IFtdXG4gICAgICB9LCBvcHRpb25zKTtcblxuICAgICAgdmFyIHJvb3QgPSB0aGlzO1xuICAgICAgdmFyICRyb290ID0gJCh0aGlzKTtcbiAgICAgIHJvb3Quc2VsZWN0ZWRDYWxsYmFjayA9IHNldHRpbmdzWydzZWxlY3RlZCddO1xuICAgICAgcm9vdC5vcGVuZWRDYWxsYmFjayA9IHNldHRpbmdzWydvcGVuZWQnXTtcbiAgICAgIHJvb3QuY2xvc2VkQ2FsbGJhY2sgPSBzZXR0aW5nc1snY2xvc2VkJ107XG4gICAgICB2YXIgdmlzaWJsZSA9IGZhbHNlO1xuICAgICAgdmFyIHNlbGVjdGVkID0gZmFsc2U7XG4gICAgICB2YXIgb3BlbmVkQ2xhc3MgPSAnZm9udFNlbGVjdE9wZW4nO1xuXG4gICAgICB2YXIgZGlzcGxheU5hbWUgPSBmdW5jdGlvbihmb250KSB7XG4gICAgICAgIGlmIChzZXR0aW5nc1snaGlkZV9mYWxsYmFja3MnXSl7XG4gICAgICAgICAgdmFyIGluZGV4ID0gZm9udC5pbmRleE9mKCcsJyk7XG4gICAgICAgICAgaWYoaW5kZXggPT0gLTEgKXJldHVybiBmb250O1xuICAgICAgICAgIHJldHVybiBmb250LnN1YnN0cigwLCBpbmRleCk7XG4gICAgICAgIH1lbHNlXG4gICAgICAgICAgcmV0dXJuIGZvbnQ7XG4gICAgICB9XG5cblxuICAgICAgdmFyIHNlbGVjdCA9IGZ1bmN0aW9uKGZvbnQsaW5pdGlhbCkge1xuICAgICAgICByb290LmZpbmQoJ3NwYW4nKS5odG1sKGRpc3BsYXlOYW1lKGZvbnQpLnJlcGxhY2UoL1tcIiddezF9L2dpLFwiXCIpKTtcbiAgICAgICAgcm9vdC5jc3MoJ2ZvbnQtZmFtaWx5JywgZm9udCk7XG4gICAgICAgIHNlbGVjdGVkID0gZm9udDtcblxuICAgICAgICBpZighaW5pdGlhbClyb290LnNlbGVjdGVkQ2FsbGJhY2soc2VsZWN0ZWQpO1xuICAgICAgfVxuXG4gICAgICB2YXIgcG9zaXRpb25VbCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgbGVmdCwgdG9wO1xuICAgICAgICBsZWZ0ID0gJChyb290KS5vZmZzZXQoKS5sZWZ0O1xuICAgICAgICB0b3AgPSAkKHJvb3QpLm9mZnNldCgpLnRvcCArICQocm9vdCkub3V0ZXJIZWlnaHQoKTtcblxuICAgICAgICAkKHVsKS5jc3Moe1xuICAgICAgICAgICdwb3NpdGlvbic6ICdhYnNvbHV0ZScsXG4gICAgICAgICAgJ2xlZnQnOiBsZWZ0ICsgJ3B4JyxcbiAgICAgICAgICAndG9wJzogdG9wICsgJ3B4JyxcbiAgICAgICAgICAnd2lkdGgnOiAkKHJvb3QpLm91dGVyV2lkdGgoKSArICdweCdcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIHZhciBjbG9zZVVsID0gdGhpcy5jbG9zZVVsID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHVsLnNsaWRlVXAoJ2Zhc3QnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICB2aXNpYmxlID0gZmFsc2U7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRyb290LnJlbW92ZUNsYXNzKG9wZW5lZENsYXNzKTtcblxuICAgICAgICByb290LmNsb3NlZENhbGxiYWNrKCk7XG4gICAgICB9XG5cbiAgICAgIHZhciBvcGVuVWkgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdWwuc2xpZGVEb3duKCdmYXN0JywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgdmlzaWJsZSA9IHRydWU7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRyb290LmFkZENsYXNzKG9wZW5lZENsYXNzKTtcblxuICAgICAgICByb290Lm9wZW5lZENhbGxiYWNrKCk7XG4gICAgICB9XG5cbiAgICAgIC8vIFNldHVwIG1hcmt1cFxuICAgICAgJHJvb3QucHJlcGVuZCgnPHNwYW4+JyArIHNldHRpbmdzWydpbml0aWFsJ10ucmVwbGFjZSgvJy9nLCcmIzAzOTsnKSArICc8L3NwYW4+Jyk7XG4gICAgICB2YXIgdWwgPSB0aGlzLnVsID0gJCgnPHVsIGNsYXNzPVwiZm9udFNlbGVjdFVsXCI+PC91bD4nKS5hcHBlbmRUbygnYm9keScpO1xuICAgICAgdWwuaGlkZSgpO1xuICAgICAgcG9zaXRpb25VbCgpO1xuXG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNldHRpbmdzWydmb250cyddLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHZhciBpdGVtID0gJCgnPGxpPicgKyBkaXNwbGF5TmFtZShzZXR0aW5nc1snZm9udHMnXVtpXSkgKyAnPC9saT4nKS5hcHBlbmRUbyh1bCk7XG4gICAgICAgIGl0ZW0uY3NzKCdmb250LWZhbWlseScsIHNldHRpbmdzWydmb250cyddW2ldKTtcbiAgICAgICAgaXRlbVswXS5kYXRhID0gc2V0dGluZ3NbJ2ZvbnRzJ11baV07XG4gICAgICB9XG5cbiAgICAgIGlmIChzZXR0aW5nc1snaW5pdGlhbCddICE9ICcnKVxuICAgICAgICBzZWxlY3Qoc2V0dGluZ3NbJ2luaXRpYWwnXSx0cnVlKTtcblxuICAgICAgdWwuZmluZCgnbGknKS5jbGljayhmdW5jdGlvbigpIHtcblxuICAgICAgICBpZiAoIXZpc2libGUpXG4gICAgICAgICAgcmV0dXJuO1xuXG4gICAgICAgIHBvc2l0aW9uVWwoKTtcbiAgICAgICAgY2xvc2VVbCgpO1xuXG4gICAgICAgIHNlbGVjdCh0aGlzLmRhdGEpO1xuICAgICAgfSk7XG5cbiAgICAgICRyb290LmNsaWNrKGZ1bmN0aW9uKGV2ZW50KSB7XG5cbiAgICAgICAgaWYgKHZpc2libGUpXG4gICAgICAgICAgcmV0dXJuO1xuXG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuXG4gICAgICAgIHBvc2l0aW9uVWwoKTtcbiAgICAgICAgb3BlblVpKCk7XG4gICAgICB9KTtcblxuICAgICAgJCgnaHRtbCcpLmNsaWNrKGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAodmlzaWJsZSlcbiAgICAgICAge1xuICAgICAgICAgIGNsb3NlVWwoKTtcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9LFxuICAgIHNlbGVjdGVkIDogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gdGhpcy5kYXRhO1xuICAgIH0sXG4gICAgc2VsZWN0IDogZnVuY3Rpb24oZm9udCkge1xuICAgICAgdGhpcy5maW5kKCdzcGFuJykuaHRtbChmb250LnN1YnN0cigwLCBmb250LmluZGV4T2YoJywnKSkucmVwbGFjZSgvW1wiJ117MX0vZ2ksXCJcIikpO1xuICAgICAgdGhpcy5jc3MoJ2ZvbnQtZmFtaWx5JywgZm9udCk7XG4gICAgICB2YXIgc2VsZWN0ZWQgPSBmYWxzZTtcbiAgICAgIHNlbGVjdGVkID0gZm9udDtcbiAgICB9XG4gIH07XG4gICQuZm9udFNlbGVjdG9yID0ge1xuXG4gIH07XG5cbiAgJC5mbi5mb250U2VsZWN0b3IgPSBmdW5jdGlvbihtZXRob2QpIHtcbiAgICBpZiAoIG1ldGhvZHNbbWV0aG9kXSApIHtcbiAgICAgIHJldHVybiBtZXRob2RzWyBtZXRob2QgXS5hcHBseSggdGhpcywgQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoIGFyZ3VtZW50cywgMSApKTtcbiAgICB9IGVsc2UgaWYgKCB0eXBlb2YgbWV0aG9kID09PSAnb2JqZWN0JyB8fCAhIG1ldGhvZCApIHtcbiAgICAgIHJldHVybiBtZXRob2RzLmluaXQuYXBwbHkoIHRoaXMsIGFyZ3VtZW50cyApO1xuICAgIH0gZWxzZSB7XG4gICAgICAkLmVycm9yKCAnTWV0aG9kICcgKyAgbWV0aG9kICsgJyBkb2VzIG5vdCBleGlzdCBvbiBqUXVlcnkuZm9udFNlbGVjdG9yJyApO1xuICAgIH1cbiAgfVxufSkpO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHBsdWdpbnMvJC5mb250U2VsZWN0b3IuanMiLCI7XG5pZih0eXBlb2YgVG9vbGJhciA9PT0gXCJ1bmRlZmluZWRcIil7XG4gIHZhciBUb29sYmFyID0gcmVxdWlyZShcIi4uL3NyYy90b29sYmFyXCIpO1xufVxuXG5Ub29sYmFyLnByb3RvdHlwZS51cGRhdGVTZWxlY3RlZE9wdGlvbiA9IGZ1bmN0aW9uKGRhdGEpe1xuICB2YXIgJGNoZWNrZWQgPSBkYXRhLiRpdGVtLmZpbmQoXCI6Y2hlY2tlZFwiKTtcbiAgdmFyICRjaGVja2VkT3B0aW9uRWwgPSAkKCRjaGVja2VkLnBhcmVudHMoKVswXSk7XG5cblxuICB2YXIgc2VsT3B0aW9uID0gZGF0YS4kaXRlbS5maW5kKCcuYnRuLXNlbGVjdGVkLW9wdGlvbicpO1xuICBzZWxPcHRpb24uaHRtbCggJGNoZWNrZWRPcHRpb25FbC5maW5kKFwibGFiZWxcIilbMF0ub3V0ZXJIVE1MICk7XG59O1xuXG5Ub29sYmFyLnByb3RvdHlwZS50b29scy5vcHRpb24gPSB7XG4gIHNjb3BlOiBmdW5jdGlvbiAoZGF0YSwgb3B0aW9ucykge1xuICAgIHZhciBfc2VsZiA9IHRoaXM7XG4gICAgcmV0dXJuIHtcbiAgICAgIHBhcmVudElkOiBkYXRhLnBhcmVudC5pZCxcbiAgICAgIHZhbHVlQ3VycmVudDogZGF0YS5wYXJlbnQudmFsdWUuZ2V0KCkgPT09IGRhdGEub3B0aW9uLFxuICAgICAgb25jaGFuZ2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy/QvtC/0YLQuNC80LjQt9C40YDQvtCy0LDRgtGMXG5cbiAgICAgICAgdmFyICRjaGVja2VkID0gZGF0YS4kaXRlbS5maW5kKFwiOmNoZWNrZWRcIik7XG4gICAgICAgIHZhciBfdmFsdWUgPSAkY2hlY2tlZC52YWwoKTtcbiAgICAgICAgaWYgKF92YWx1ZSA9PSBkYXRhLm9wdGlvbikge1xuICAgICAgICAgIGRhdGEucGFyZW50LnZhbHVlLnNldChfdmFsdWUpO1xuICAgICAgICB9XG4gICAgICAgIF9zZWxmLnVwZGF0ZVNlbGVjdGVkT3B0aW9uKGRhdGEucGFyZW50KTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIHRlbXBsYXRlOlxuICAgICc8ZGl2IGNsYXNzPVwib2JqZWN0LW1lbnUtaXRlbSBvYmplY3QtbWVudS1vcHRpb24gXCIgdGl0bGU9XCJ7dGl0bGV9XCIgPicgK1xuICAgICc8aW5wdXQgdHlwZT1cInJhZGlvXCIgaWQ9XCJ0b29sLXtpZH1cIiBkcC1jaGVja2VkPVwie3ZhbHVlQ3VycmVudH1cIiBuYW1lPVwie3BhcmVudElkfVwiIHZhbHVlPVwie29wdGlvbn1cIiBvbmNoYW5nZT1cIm9uY2hhbmdlKClcIj4nICtcbiAgICAnPGxhYmVsIGNsYXNzPVwiYnRuIGJ1dHRvbi17aWR9IHtjbGFzc05hbWV9XCIgZm9yPVwidG9vbC17aWR9XCI+JyArXG4gICAgICAnPGltZyBkcC1pZj1cImljb25cIiBkcC1zcmM9XCJpY29uXCI+JyArXG4gICAgICAnPHNwYW4gZHAtaW5jbHVkZT1cInN2Z1wiIGRwLWlmPVwic3ZnXCI+PC9zcGFuPicgK1xuICAgICAgJzxzcGFuIGRwLWlmPVwidGl0bGVcIiBjbGFzcz1cIm9wdGlvbi10aXRsZVwiPnt0aXRsZX08L3NwYW4+J1xufTtcblxuVG9vbGJhci5wcm90b3R5cGUudG9vbHMub3B0aW9ucyA9IHtcbiAgc2NvcGU6IGZ1bmN0aW9uIChkYXRhLCBvcHRpb25zKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGNsYXNzTmFtZTogZGF0YS5jbGFzc05hbWUgfHwgJ2l0ZW1zLWNvbHVtbicsXG4gICAgICBidXR0b25zVGl0bGU6IG9wdGlvbnMuYnV0dG9ucyAmJiBvcHRpb25zLmJ1dHRvbnMudGl0bGUgfHwgZmFsc2UsXG4gICAgICBidXR0b25zQ2xhc3NOYW1lOiAob3B0aW9ucy5idXR0b25zLmNsYXNzTmFtZSB8fCAnJylcbiAgICB9XG4gIH0sXG4gIHRlbXBsYXRlOlxuICAnPGRpdiBjbGFzcz1cIm9iamVjdC1tZW51LWl0ZW0gb2JqZWN0LW1lbnUtb3B0aW9ucyB7Y2xhc3NOYW1lfVwiIHRpdGxlPVwie3RpdGxlfVwiPicgK1xuICAnPGRpdiBjbGFzcz1cImJ0bi1zZWxlY3RlZC1vcHRpb25cIj48L2Rpdj4nICtcbiAgJzxkaXYgY2xhc3M9XCJvYmplY3QtbWVudS1vcHRpb25zLWNvbnRhaW5lclwiIHRyYW5zY2x1ZGU+JyxcbiAgcG9zdDogZnVuY3Rpb24gKCRpdGVtLCBkYXRhLCBvcHRpb25zLCB0cmFuc2NsdWRlKSB7XG4gICAgdGhpcy5nZW5lcmF0ZU1lbnUoZGF0YS50YXJnZXQsIHRyYW5zY2x1ZGUsIG9wdGlvbnMsIGRhdGEubWVudSk7XG4gICAgdGhpcy51cGRhdGVTZWxlY3RlZE9wdGlvbihkYXRhKTtcbiAgfVxufTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyB0b29sYmFyL21vZHVsZXMvdG9vbGJhci5vcHRpb25zLmpzIiwiO1xuaWYodHlwZW9mIFRvb2xiYXIgPT09IFwidW5kZWZpbmVkXCIpe1xuICB2YXIgVG9vbGJhciA9IHJlcXVpcmUoXCIuLi9zcmMvdG9vbGJhclwiKTtcbn1cblxuVG9vbGJhci5wcm90b3R5cGUudG9vbHMuc2VsZWN0ID0gIHtcbiAgc2NvcGU6IGZ1bmN0aW9uIChkYXRhLCBvcHRpb25zKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGdldElucHV0VmFsdWU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHBhcnNlRmxvYXQoZGF0YS4kaXRlbS5maW5kKFwiaW5wdXRcIikudmFsKCkpO1xuICAgICAgfSxcbiAgICAgIGdldFZhbHVlOiBkYXRhLnZhbHVlLmdldCxcbiAgICAgIHNldFZhbHVlOiBkYXRhLnZhbHVlLnNldCxcbiAgICAgIG9uY2hhbmdlOiBmdW5jdGlvbiAoZSxtb2RlbCkge1xuICAgICAgICBkYXRhLnZhbHVlLnNldChlLnBhcmFtcy5kYXRhLmlkLG1vZGVsKTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIHRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cIm9iamVjdC1tZW51LWl0ZW0gb2JqZWN0LW1lbnUtc2VsZWN0IHtpdGVtQ2xhc3NOYW1lfVwiIHRpdGxlPVwie3RpdGxlfVwiID48bGFiZWwgZm9yPVwieHh4XCIgY2xhc3M9XCJidG4gYnV0dG9uLXtpZH0ge2NsYXNzTmFtZX1cIj48L2xhYmVsPjxzZWxlY3QgaWQ9XCJ4eHhcIj4nLFxuICBwb3N0OiBmdW5jdGlvbiAoJGl0ZW0sIGRhdGEsIG9wdGlvbnMsIHRvb2wsIHZhbCkge1xuICAgIHZhciBtb2RlbCA9ICBkYXRhLnZhbHVlLm9wdGlvbnMoKTtcbiAgICB2YXIgX3ZhbCA9IGRhdGEudmFsdWUuZ2V0KCk7XG4gICAgdmFyIF9zZWxlY3QgPSAkaXRlbS5maW5kKFwic2VsZWN0XCIpO1xuICAgIF9zZWxlY3QuZHBTZWxlY3Qoe1xuICAgICAgbWluaW11bVJlc3VsdHNGb3JTZWFyY2g6IEluZmluaXR5LFxuICAgICAgZHJvcGRvd25QYXJlbnQ6ICQoXCJib2R5XCIpLFxuICAgICAgZGF0YTogIG1vZGVsLFxuICAgICAgdGVtcGxhdGVTZWxlY3Rpb246IGZ1bmN0aW9uKHN0YXRlLCBjb250YWluZXIpIHtcbiAgICAgICAgcmV0dXJuIGRhdGEudGVtcGxhdGVTZWxlY3Rpb24oc3RhdGUsIGNvbnRhaW5lcixkYXRhKTtcbiAgICAgIH0sXG4gICAgICB0ZW1wbGF0ZVJlc3VsdDogZnVuY3Rpb24oc3RhdGUsIGNvbnRhaW5lcil7XG4gICAgICAgIHJldHVybiBkYXRhLnRlbXBsYXRlUmVzdWx0KHN0YXRlLCBjb250YWluZXIsZGF0YSk7XG4gICAgICB9LFxuICAgIH0pLm9uKFwic2VsZWN0MjpzZWxlY3RcIiwgZnVuY3Rpb24oZSkge1xuICAgICAgZGF0YS5vbmNoYW5nZShlLCBtb2RlbCk7XG4gICAgfSk7XG4gICAgX3NlbGVjdC5kcFNlbGVjdChcInZhbFwiLFtfdmFsXSk7XG4gIH1cbn1cblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyB0b29sYmFyL21vZHVsZXMvdG9vbGJhci5zZWxlY3QuanMiLCJcbmlmKHR5cGVvZiBUb29sYmFyID09PSBcInVuZGVmaW5lZFwiKXtcbiAgdmFyIFRvb2xiYXIgPSByZXF1aXJlKFwiLi4vc3JjL3Rvb2xiYXJcIik7XG59XG5cblRvb2xiYXIucHJvdG90eXBlLmNvbG9ycGlja2VyID0gZnVuY3Rpb24gKGVsLCBvcHRpb25zKSB7XG4gIG9wdGlvbnMuZm9ybWF0ID0gJ3JnYic7XG4gIG9wdGlvbnMub3BhY2l0eSA9IHRydWU7XG4gIGVsLm1pbmljb2xvcnMob3B0aW9ucyk7XG59O1xuXG5Ub29sYmFyLnByb3RvdHlwZS50b29scy5lZmZlY3QgPSB7XG4gIHNjb3BlOiBmdW5jdGlvbiAoZGF0YSwgb3B0aW9ucykge1xuICAgIHJldHVybiB7XG4gICAgICBidXR0b25zVGl0bGU6IG9wdGlvbnMuYnV0dG9ucyAmJiBvcHRpb25zLmJ1dHRvbnMudGl0bGUgfHwgZmFsc2UsXG4gICAgICBpc1BhcmFtZXRlcnM6ICEhZGF0YS5hY3Rpb25QYXJhbWV0ZXJzLFxuICAgICAgYnV0dG9uc2NDbGFzc05hbWU6IChvcHRpb25zLmJ1dHRvbnMgJiYgb3B0aW9ucy5idXR0b25zLmNsYXNzTmFtZSB8fCAnJylcbiAgICB9XG4gIH0sXG4gIHRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cIm9iamVjdC1tZW51LWl0ZW1cIiB0aXRsZT1cInt0aXRsZX1cIj4nICtcbiAgICAgICc8YnV0dG9uIGNsYXNzPVwiYnRuIGJ1dHRvbi17aWR9IHtjbGFzc05hbWV9IHtidXR0b25zY0NsYXNzTmFtZX1cIj4nICtcbiAgICAgICc8c3BhbiBkcC1pZj1cImJ1dHRvbnNUaXRsZVwiIGNsYXNzPVwiYnV0dG9uLXRpdGxlXCI+e3RpdGxlfTwvc3Bhbj4nICtcbiAgICAgICc8L2J1dHRvbj4nICtcbiAgICAgICc8ZGl2IGRwLWlmPVwiaXNQYXJhbWV0ZXJzXCIgY2xhc3M9XCJtZW51LWFjdGlvbi1wYXJhbWV0ZXJzXCIgc3R5bGU9XCJkaXNwbGF5OiBub25lXCIgdHJhbnNjbHVkZT48L2Rpdj4nICtcbiAgICAnPC9kaXY+JyxcbiAgICBwb3N0OiBmdW5jdGlvbiAoJGl0ZW0sIGRhdGEsIG9wdGlvbnMsIHRyYW5zY2x1ZGUpIHtcblxuICAgIGlmKGRhdGEuY29udGFpbmVyKXtcbiAgICAgIHRyYW5zY2x1ZGUgPSAkKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGRhdGEuY29udGFpbmVyKSk7XG4gICAgfVxuXG4gICAgdmFyICR0cGw7XG4gICAgdmFyIGZvbyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmIChkYXRhLmVmZmVjdFRwbCkge1xuICAgICAgICAkdHBsID0gJChkYXRhLmVmZmVjdFRwbCk7XG4gICAgICAgIHRyYW5zY2x1ZGUuaHRtbCgkdHBsKTtcbiAgICAgIH1cbiAgICAgIGlmIChkYXRhLmFjdGlvblBhcmFtZXRlcnNJZCkge1xuICAgICAgICAkdHBsID0gJChcIiNcIiArIGRhdGEuYWN0aW9uUGFyYW1ldGVyc0lkKS5jbG9uZSgpO1xuICAgICAgICB0cmFuc2NsdWRlLmh0bWwoJHRwbCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gZGF0YS5hY3Rpb25QYXJhbWV0ZXJzLmNhbGwoZGF0YS50YXJnZXQsIHRyYW5zY2x1ZGUsIGRhdGEsIG9wdGlvbnMpO1xuICAgIH07XG4gICAgdGhpcy50b2dnbGVCeUJ1dHRvbigkaXRlbSwgdHJhbnNjbHVkZSwgZm9vICxkYXRhKTtcbiAgfVxufTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyB0b29sYmFyL21vZHVsZXMvdG9vbGJhci5lZmZlY3QuanMiLCIndXNlIHN0cmljdCc7XG5cblxudmFyIF9iaW5kRXZlbnRzID0gZmFicmljLkNhbnZhcy5wcm90b3R5cGUuX2JpbmRFdmVudHM7XG52YXIgX29uTW91c2VEb3duX292ZXJ3cml0dGVuID0gZmFicmljLkNhbnZhcy5wcm90b3R5cGUuX29uTW91c2VEb3duO1xudmFyIF9vbk1vdXNlVXBfb3ZlcndyaXR0ZW4gPSBmYWJyaWMuQ2FudmFzLnByb3RvdHlwZS5fb25Nb3VzZVVwO1xudmFyIF9pbml0RXZlbnRMaXN0ZW5lcnNfb3ZlcndyaXR0ZW4gPSBmYWJyaWMuQ2FudmFzLnByb3RvdHlwZS5faW5pdEV2ZW50TGlzdGVuZXJzO1xudmFyIHJlbW92ZUxpc3RlbmVyc19vdmVyd3JpdHRlbiA9IGZhYnJpYy5DYW52YXMucHJvdG90eXBlLnJlbW92ZUxpc3RlbmVycztcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuQ2FudmFzLnByb3RvdHlwZSwge1xuICB0YXBob2xkVGhyZXNob2xkOiAyMDAwLFxuICBfYmluZEV2ZW50czogZnVuY3Rpb24gKCkge1xuICAgIF9iaW5kRXZlbnRzLmNhbGwodGhpcyk7XG4gICAgdGhpcy5fb25DbGljayA9IHRoaXMuX29uQ2xpY2suYmluZCh0aGlzKTtcbiAgICB0aGlzLl9vbkRvdWJsZUNsaWNrID0gdGhpcy5fb25Eb3VibGVDbGljay5iaW5kKHRoaXMpO1xuICAgIHRoaXMuX29uVGFwSG9sZCA9IHRoaXMuX29uVGFwSG9sZC5iaW5kKHRoaXMpO1xuICB9LFxuXG4gIF9vbkRvdWJsZUNsaWNrOiBmdW5jdGlvbiAoZSkge1xuICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgIHZhciB0YXJnZXQgPSBzZWxmLmZpbmRUYXJnZXQoZSk7XG4gICAgc2VsZi5maXJlKCdtb3VzZTpkYmxjbGljaycsIHtcbiAgICAgIHRhcmdldDogdGFyZ2V0LFxuICAgICAgZTogZVxuICAgIH0pO1xuXG4gICAgaWYgKHRhcmdldCAmJiAhc2VsZi5pc0RyYXdpbmdNb2RlKSB7XG4gICAgICAvLyBUbyB1bmlmeSB0aGUgYmVoYXZpb3IsIHRoZSBvYmplY3QncyBkb3VibGUgY2xpY2sgZXZlbnQgZG9lcyBub3QgZmlyZSBvbiBkcmF3aW5nIG1vZGUuXG4gICAgICB0YXJnZXQuZmlyZSgnZGJsY2xpY2snLCB7XG4gICAgICAgIGU6IGVcbiAgICAgIH0pO1xuICAgIH1cbiAgfSxcblxuICBfb25Ecm9wOiBmdW5jdGlvbiAoZSkge1xuICAgIHZhciBfem9vbSA9IHRoaXMuZ2V0Wm9vbSgpO1xuICAgIGUueCAvPSBfem9vbTtcbiAgICBlLnkgLz0gX3pvb207XG4gICAgZS5vZmZzZXRYIC89IF96b29tO1xuICAgIGUub2Zmc2V0WSAvPSBfem9vbTtcbiAgICBlLndpZHRoID0gZS5oZWxwZXIud2lkdGgoKSAvIF96b29tO1xuICAgIGUuaGVpZ2h0ID0gZS5oZWxwZXIuaGVpZ2h0KCkgLyBfem9vbTtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICB0aGlzLmZpcmUoJ21vdXNlOmRyb3AnLCBlKTtcblxuICB9LFxuXG4gIF9vbkRyYWdNb3ZlOiBmdW5jdGlvbiAoZSkge1xuICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgIHZhciB0YXJnZXQgPSBzZWxmLmZpbmRUYXJnZXQoZS5vcmlnaW5hbEV2ZW50KTtcbiAgICBzZWxmLmZpcmUoJ21vdXNlOmRyYWdtb3ZlJywge1xuICAgICAgdGFyZ2V0OiB0YXJnZXQsXG4gICAgICBlOiBlLFxuICAgICAgZGF0YTogZS5kYXRhXG4gICAgfSk7XG4gICAgaWYgKHRhcmdldCAmJiAhc2VsZi5pc0RyYXdpbmdNb2RlKSB7XG4gICAgICAvLyBUbyB1bmlmeSB0aGUgYmVoYXZpb3IsIHRoZSBvYmplY3QncyBkb3VibGUgY2xpY2sgZXZlbnQgZG9lcyBub3QgZmlyZSBvbiBkcmF3aW5nIG1vZGUuXG4gICAgICB0YXJnZXQuZmlyZSgnb2JqZWN0OmRyYWdtb3ZlJywge1xuICAgICAgICBlOiBlLFxuICAgICAgICBkYXRhOiBlLmRhdGFcbiAgICAgIH0pO1xuICAgIH1cbiAgICBpZiAodGhpcy5fbGFzdF90YXJnZXQgPT0gdGFyZ2V0KXJldHVybjtcbiAgICBpZiAodGhpcy5fbGFzdF90YXJnZXQpIHtcbiAgICAgIHNlbGYuZmlyZSgnbW91c2U6ZHJhZ2xlYXZlJywge1xuICAgICAgICB0YXJnZXQ6IHRoaXMuX2xhc3RfdGFyZ2V0LFxuICAgICAgICBlOiBlLFxuICAgICAgICBkYXRhOiBlLmRhdGFcbiAgICAgIH0pO1xuICAgICAgdGhpcy5fbGFzdF90YXJnZXQuZmlyZSgnb2JqZWN0OmRyYWdsZWF2ZScsIHtcbiAgICAgICAgZTogZSxcbiAgICAgICAgZGF0YTogZS5kYXRhXG4gICAgICB9KTtcbiAgICAgIHRoaXMuX2xhc3RfdGFyZ2V0ID0gZmFsc2U7XG4gICAgfVxuICAgIGlmICh0YXJnZXQpIHtcblxuICAgICAgc2VsZi5maXJlKCdtb3VzZTpkcmFnZW50ZXInLCB7XG4gICAgICAgIHRhcmdldDogdGFyZ2V0LFxuICAgICAgICBlOiBlLFxuICAgICAgICBkYXRhOiBlLmRhdGFcbiAgICAgIH0pO1xuICAgICAgdGFyZ2V0LmZpcmUoJ29iamVjdDpkcmFnZW50ZXInLCB7XG4gICAgICAgIGU6IGUsXG4gICAgICAgIGRhdGE6IGUuZGF0YVxuICAgICAgfSk7XG5cbiAgICAgIHRoaXMuX2xhc3RfdGFyZ2V0ID0gdGFyZ2V0O1xuICAgIH1cblxuICB9LFxuXG4gIF9vbkNsaWNrOiBmdW5jdGlvbiAoZSkge1xuICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgIHZhciB0YXJnZXQgPSBzZWxmLmZpbmRUYXJnZXQoZSk7XG4gICAgc2VsZi5maXJlKCdtb3VzZTpjbGljaycsIHtcbiAgICAgIHRhcmdldDogdGFyZ2V0LFxuICAgICAgZTogZVxuICAgIH0pO1xuXG4gICAgaWYgKHRhcmdldCAmJiAhc2VsZi5pc0RyYXdpbmdNb2RlKSB7XG4gICAgICBpZiAoXG4gICAgICAgIHRhcmdldC5vcmlnaW5hbFN0YXRlLmxlZnQgPT0gdGFyZ2V0LmxlZnQgJiZcbiAgICAgICAgdGFyZ2V0Lm9yaWdpbmFsU3RhdGUudG9wID09IHRhcmdldC50b3AgJiZcbiAgICAgICAgdGFyZ2V0Lm9yaWdpbmFsU3RhdGUuc2NhbGVYID09IHRhcmdldC5zY2FsZVggJiZcbiAgICAgICAgdGFyZ2V0Lm9yaWdpbmFsU3RhdGUuc2NhbGVZID09IHRhcmdldC5zY2FsZVkgJiZcbiAgICAgICAgdGFyZ2V0Lm9yaWdpbmFsU3RhdGUuYW5nbGUgPT0gdGFyZ2V0LmFuZ2xlXG4gICAgICApIHtcbiAgICAgICAgLy8gVG8gdW5pZnkgdGhlIGJlaGF2aW9yLCB0aGUgb2JqZWN0J3MgZG91YmxlIGNsaWNrIGV2ZW50IGRvZXMgbm90IGZpcmUgb24gZHJhd2luZyBtb2RlLlxuICAgICAgICB0YXJnZXQuZmlyZSgnb2JqZWN0OmNsaWNrJywge1xuICAgICAgICAgIGU6IGVcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICB9LFxuXG4gIF9vblRhcEhvbGQ6IGZ1bmN0aW9uIChlKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgdmFyIHRhcmdldCA9IHNlbGYuZmluZFRhcmdldChlKTtcbiAgICBzZWxmLmZpcmUoJ3RvdWNoOnRhcGhvbGQnLCB7XG4gICAgICB0YXJnZXQ6IHRhcmdldCxcbiAgICAgIGU6IGVcbiAgICB9KTtcblxuICAgIGlmICh0YXJnZXQgJiYgIXNlbGYuaXNEcmF3aW5nTW9kZSkge1xuICAgICAgLy8gVG8gdW5pZnkgdGhlIGJlaGF2aW9yLCB0aGUgb2JqZWN0J3MgdGFwIGhvbGQgZXZlbnQgZG9lcyBub3QgZmlyZSBvbiBkcmF3aW5nIG1vZGUuXG4gICAgICB0YXJnZXQuZmlyZSgndGFwaG9sZCcsIHtcbiAgICAgICAgZTogZVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgaWYgKGUudHlwZSA9PT0gJ3RvdWNoZW5kJyAmJiBzZWxmLnRvdWNoU3RhcnRUaW1lciAhPSBudWxsKSB7XG4gICAgICBjbGVhclRpbWVvdXQoc2VsZi50b3VjaFN0YXJ0VGltZXIpO1xuICAgIH1cbiAgfSxcblxuICBfb25Nb3VzZURvd246IGZ1bmN0aW9uIChlKSB7XG4gICAgX29uTW91c2VEb3duX292ZXJ3cml0dGVuLmNhbGwodGhpcywgZSk7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIGlmIChlLnR5cGUgPT09ICd0b3VjaHN0YXJ0Jykge1xuICAgICAgdmFyIHRvdWNoU3RhcnRUaW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICBzZWxmLl9vblRhcEhvbGQoZSk7XG4gICAgICAgIHNlbGYuaXNMb25nVGFwID0gdHJ1ZTtcbiAgICAgIH0sIHNlbGYudGFwaG9sZFRocmVzaG9sZCk7XG4gICAgICBzZWxmLnRvdWNoU3RhcnRUaW1lciA9IHRvdWNoU3RhcnRUaW1lcjtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBBZGQgcmlnaHQgY2xpY2sgc3VwcG9ydFxuICAgIGlmIChlLndoaWNoID09PSAzKSB7XG4gICAgICB2YXIgdGFyZ2V0ID0gdGhpcy5maW5kVGFyZ2V0KGUpO1xuICAgICAgc2VsZi5maXJlKCdtb3VzZTpkb3duJywge3RhcmdldDogdGFyZ2V0LCBlOiBlfSk7XG4gICAgICBpZiAodGFyZ2V0ICYmICFzZWxmLmlzRHJhd2luZ01vZGUpIHtcbiAgICAgICAgLy8gVG8gdW5pZnkgdGhlIGJlaGF2aW9yLCB0aGUgb2JqZWN0J3MgbW91c2UgZG93biBldmVudCBkb2VzIG5vdCBmaXJlIG9uIGRyYXdpbmcgbW9kZS5cbiAgICAgICAgdGFyZ2V0LmZpcmUoJ21vdXNlZG93bicsIHtcbiAgICAgICAgICBlOiBlXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgfSxcblxuICBfb25Nb3VzZVVwOiBmdW5jdGlvbiAoZSkge1xuXG4gICAgX29uTW91c2VVcF9vdmVyd3JpdHRlbi5jYWxsKHRoaXMsIGUpO1xuXG4gICAgaWYgKGUudHlwZSA9PT0gJ3RvdWNoZW5kJykge1xuICAgICAgLy8gUHJvY2VzcyB0YXAgaG9sZC5cbiAgICAgIGlmICh0aGlzLnRvdWNoU3RhcnRUaW1lciAhPSBudWxsKSB7XG4gICAgICAgIGNsZWFyVGltZW91dCh0aGlzLnRvdWNoU3RhcnRUaW1lcik7XG4gICAgICB9XG4gICAgICAvLyBQcm9jZXNzIGxvbmcgdGFwLlxuICAgICAgaWYgKHRoaXMuaXNMb25nVGFwKSB7XG4gICAgICAgIHRoaXMuX29uTG9uZ1RhcEVuZChlKTtcbiAgICAgICAgdGhpcy5pc0xvbmdUYXAgPSBmYWxzZTtcbiAgICAgIH1cbiAgICAgIC8vIFByb2Nlc3MgZG91YmxlIGNsaWNrXG4gICAgICB2YXIgbm93ID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gICAgICB2YXIgbGFzdFRvdWNoID0gdGhpcy5sYXN0VG91Y2ggfHwgbm93ICsgMTtcbiAgICAgIHZhciBkZWx0YSA9IG5vdyAtIGxhc3RUb3VjaDtcbiAgICAgIGlmIChkZWx0YSA8IDMwMCAmJiBkZWx0YSA+IDApIHtcbiAgICAgICAgLy8gQWZ0ZXIgd2UgZGV0Y3QgYSBkb3VibGV0YXAsIHN0YXJ0IG92ZXJcbiAgICAgICAgdGhpcy5sYXN0VG91Y2ggPSBudWxsO1xuXG4gICAgICAgIHRoaXMuX29uRG91YmxlVGFwKGUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5sYXN0VG91Y2ggPSBub3c7XG4gICAgICB9XG4gICAgfVxuICB9LFxuXG4gIF9vbkRvdWJsZVRhcDogZnVuY3Rpb24gKGUpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICB2YXIgdGFyZ2V0ID0gc2VsZi5maW5kVGFyZ2V0KGUpO1xuICAgIHNlbGYuZmlyZSgndG91Y2g6ZG91YmxldGFwJywge1xuICAgICAgdGFyZ2V0OiB0YXJnZXQsXG4gICAgICBlOiBlXG4gICAgfSk7XG5cbiAgICBpZiAodGFyZ2V0ICYmICFzZWxmLmlzRHJhd2luZ01vZGUpIHtcbiAgICAgIC8vIFRvIHVuaWZ5IHRoZSBiZWhhdmlvciwgdGhlIG9iamVjdCdzIGRvdWJsZSB0YXAgZXZlbnQgZG9lcyBub3QgZmlyZSBvbiBkcmF3aW5nIG1vZGUuXG4gICAgICB0YXJnZXQuZmlyZSgnb2JqZWN0OmRvdWJsZXRhcCcsIHtcbiAgICAgICAgZTogZVxuICAgICAgfSk7XG4gICAgfVxuICB9LFxuXG4gIF9vbkxvbmdUYXBFbmQ6IGZ1bmN0aW9uIChlKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgdmFyIHRhcmdldCA9IHNlbGYuZmluZFRhcmdldChlKTtcbiAgICBzZWxmLmZpcmUoJ3RvdWNoOmxvbmd0YXBlbmQnLCB7XG4gICAgICB0YXJnZXQ6IHRhcmdldCxcbiAgICAgIGU6IGVcbiAgICB9KTtcblxuICAgIGlmICh0YXJnZXQgJiYgIXNlbGYuaXNEcmF3aW5nTW9kZSkge1xuICAgICAgLy8gVG8gdW5pZnkgdGhlIGJlaGF2aW9yLCB0aGUgb2JqZWN0J3MgbG9uZyB0YXAgZW5kIGV2ZW50IGRvZXMgbm90IGZpcmUgb24gZHJhd2luZyBtb2RlLlxuICAgICAgdGFyZ2V0LmZpcmUoJ29iamVjdDpsb25ndGFwZW5kJywge1xuICAgICAgICBlOiBlXG4gICAgICB9KTtcbiAgICB9XG4gIH0sXG5cbiAgX2luaXRFdmVudExpc3RlbmVyczogZnVuY3Rpb24gKCkge1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICBfaW5pdEV2ZW50TGlzdGVuZXJzX292ZXJ3cml0dGVuLmNhbGwoc2VsZik7XG5cbiAgICBmYWJyaWMudXRpbC5hZGRMaXN0ZW5lcihzZWxmLnVwcGVyQ2FudmFzRWwsICdjbGljaycsIHNlbGYuX29uQ2xpY2spO1xuICAgIGZhYnJpYy51dGlsLmFkZExpc3RlbmVyKHNlbGYudXBwZXJDYW52YXNFbCwgJ2RibGNsaWNrJywgc2VsZi5fb25Eb3VibGVDbGljayk7XG5cbiAgICBzZWxmLm9uKCdvYmplY3Q6c2NhbGluZycsIGZ1bmN0aW9uIChlKSB7XG4gICAgICBpZiAoZS50YXJnZXQgJiYgZS50YXJnZXQuX3NjYWxpbmdfZXZlbnRzX2VuYWJsZWQpIHtcbiAgICAgICAgZS50YXJnZXQuZmlyZShcInNjYWxpbmdcIiwgZS5lKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBzZWxmLm9uKCdvYmplY3Q6c2VsZWN0ZWQnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgaWYgKGUudGFyZ2V0KSB7XG4gICAgICAgIGUudGFyZ2V0LmZpcmUoXCJvYmplY3Q6c2VsZWN0ZWRcIiwgZS5lKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBzZWxmLm9uKCdtb3VzZTpvdmVyJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgIGlmIChlLnRhcmdldCkge1xuICAgICAgICBlLnRhcmdldC5maXJlKFwibW91c2U6b3ZlclwiLCBlLmUpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgc2VsZi5vbignbW91c2U6b3V0JywgZnVuY3Rpb24gKGUpIHtcbiAgICAgIGlmIChlLnRhcmdldCkge1xuICAgICAgICBlLnRhcmdldC5maXJlKFwibW91c2U6b3V0XCIsIGUuZSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgfSxcblxuICByZW1vdmVMaXN0ZW5lcnM6IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgcmVtb3ZlTGlzdGVuZXJzX292ZXJ3cml0dGVuLmNhbGwoc2VsZik7XG5cblxuICAgIGZhYnJpYy51dGlsLnJlbW92ZUxpc3RlbmVyKHNlbGYudXBwZXJDYW52YXNFbCwgJ2NsaWNrJywgc2VsZi5fb25DbGljayk7XG4gICAgZmFicmljLnV0aWwucmVtb3ZlTGlzdGVuZXIoc2VsZi51cHBlckNhbnZhc0VsLCAnZGJsY2xpY2snLCBzZWxmLl9vbkRvdWJsZUNsaWNrKTtcbiAgfVxufSk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL21vZHVsZXMvY2FudmFzLmV2ZW50cy5qcyIsIid1c2Ugc3RyaWN0Jztcblxue1xuXG4gIC8qXG4gICBmYWJyaWMuSW1hZ2UuZmlsdGVycy5SZWRpZnkgPSBmYWJyaWMudXRpbC5jcmVhdGVDbGFzcyhmYWJyaWMuSW1hZ2UuZmlsdGVycy5CYXNlRmlsdGVyLCB7XG4gICB0eXBlOiAnUmVkaWZ5JyxcbiAgIGFwcGx5VG86IGZ1bmN0aW9uIChjYW52YXNFbCkge1xuICAgdmFyIGNvbnRleHQgPSBjYW52YXNFbC5nZXRDb250ZXh0KCcyZCcpLFxuICAgaW1hZ2VEYXRhID0gY29udGV4dC5nZXRJbWFnZURhdGEoMCwgMCxcbiAgIGNhbnZhc0VsLndpZHRoLCBjYW52YXNFbC5oZWlnaHQpLFxuICAgZGF0YSA9IGltYWdlRGF0YS5kYXRhO1xuICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IGRhdGEubGVuZ3RoOyBpIDwgbGVuOyBpICs9IDQpIHtcbiAgIGRhdGFbaSArIDFdID0gMDtcbiAgIGRhdGFbaSArIDJdID0gMDtcbiAgIH1cbiAgIGNvbnRleHQucHV0SW1hZ2VEYXRhKGltYWdlRGF0YSwgMCwgMCk7XG4gICB9XG4gICB9KTtcbiAgIGZhYnJpYy5JbWFnZS5maWx0ZXJzLlJlZGlmeS5mcm9tT2JqZWN0ID0gZnVuY3Rpb24gKG9iamVjdCkge1xuICAgcmV0dXJuIG5ldyBmYWJyaWMuSW1hZ2UuZmlsdGVycy5SZWRpZnkob2JqZWN0KTtcbiAgIH07XG4gICAqL1xuXG4gIGZhYnJpYy5JbWFnZS5maWx0ZXJzLlNoYXJwZW4gPSBmYWJyaWMudXRpbC5jcmVhdGVDbGFzcyhmYWJyaWMuSW1hZ2UuZmlsdGVycy5Db252b2x1dGUsIHtcbiAgICB0eXBlOiAnU2hhcnBlbicsXG4gICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwgeyB9O1xuXG4gICAgICB0aGlzLm9wYXF1ZSA9IG9wdGlvbnMub3BhcXVlO1xuICAgICAgdGhpcy5tYXRyaXggPSBvcHRpb25zLm1hdHJpeCB8fCBbXG4gICAgICAgICAgMCwgLTEsIDAsXG4gICAgICAgICAgLTEsIDUsIC0xLFxuICAgICAgICAgIDAsIC0xLCAwXG4gICAgICAgIF07XG4gICAgfVxuICB9KTtcbiAgZmFicmljLkltYWdlLmZpbHRlcnMuU2hhcnBlbi5mcm9tT2JqZWN0ID0gZnVuY3Rpb24gKG9iamVjdCkge1xuICAgIHJldHVybiBuZXcgZmFicmljLkltYWdlLmZpbHRlcnMuU2hhcnBlbihvYmplY3QpO1xuICB9O1xuXG4gIGZhYnJpYy5JbWFnZS5maWx0ZXJzLkJsdXIgPSBmYWJyaWMudXRpbC5jcmVhdGVDbGFzcyhmYWJyaWMuSW1hZ2UuZmlsdGVycy5Db252b2x1dGUsIHtcbiAgICB0eXBlOiAnQmx1cicsXG4gICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwgeyB9O1xuXG4gICAgICB2YXIgX3YgPSAxIC8gOTtcbiAgICAgIHRoaXMub3BhcXVlID0gb3B0aW9ucy5vcGFxdWU7XG4gICAgICB0aGlzLm1hdHJpeCA9IG9wdGlvbnMubWF0cml4IHx8IFtcbiAgICAgICAgICBfdiwgX3YsIF92LFxuICAgICAgICAgIF92LCBfdiwgX3YsXG4gICAgICAgICAgX3YsIF92LCBfdlxuICAgICAgICBdO1xuICAgIH1cbiAgfSk7XG4gIGZhYnJpYy5JbWFnZS5maWx0ZXJzLkJsdXIuZnJvbU9iamVjdCA9IGZ1bmN0aW9uIChvYmplY3QpIHtcbiAgICByZXR1cm4gbmV3IGZhYnJpYy5JbWFnZS5maWx0ZXJzLkJsdXIob2JqZWN0KTtcbiAgfTtcblxuICBmYWJyaWMuSW1hZ2UuZmlsdGVycy5FbWJvc3MgPSBmYWJyaWMudXRpbC5jcmVhdGVDbGFzcyhmYWJyaWMuSW1hZ2UuZmlsdGVycy5Db252b2x1dGUsIHtcbiAgICB0eXBlOiAnRW1ib3NzJyxcbiAgICBpbml0aWFsaXplOiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7IH07XG5cbiAgICAgIHRoaXMub3BhcXVlID0gb3B0aW9ucy5vcGFxdWU7XG4gICAgICB0aGlzLm1hdHJpeCA9IG9wdGlvbnMubWF0cml4IHx8IFtcbiAgICAgICAgICAxLCAgIDEsICAgMSxcbiAgICAgICAgICAxLCAwLjcsICAtMSxcbiAgICAgICAgICAtMSwgIC0xLCAgLTFcbiAgICAgICAgXTtcbiAgICB9XG4gIH0pO1xuICBmYWJyaWMuSW1hZ2UuZmlsdGVycy5FbWJvc3MuZnJvbU9iamVjdCA9IGZ1bmN0aW9uIChvYmplY3QpIHtcbiAgICByZXR1cm4gbmV3IGZhYnJpYy5JbWFnZS5maWx0ZXJzLkVtYm9zcyhvYmplY3QpO1xuICB9O1xuXG5cbiAgZmFicmljLkltYWdlLmZpbHRlcnMuTWFzay5wcm90b3R5cGUubWFza0ZpbHRlciA9IHRydWU7XG5cbiAgdmFyIHByb3RvdHlwZU9wdGlvbnMgPSB7XG4gICAgQnJpZ2h0bmVzczoge1xuICAgICAgXCJicmlnaHRuZXNzXCI6IHt2YWx1ZTogMTAwLCBtaW46IDAsIG1heDogMjU1fVxuICAgIH0sXG4gICAgTm9pc2U6IHtcbiAgICAgIFwibm9pc2VcIjoge3ZhbHVlOiAxMDAsIG1pbjogMCwgbWF4OiAxMDAwfVxuICAgIH0sXG4gICAgQ29udm9sdXRlOiB7XG4gICAgICBcIm9wYXF1ZVwiOiB7dmFsdWU6IHRydWUsIHR5cGU6IFwiYm9vbGVhblwiIH0sXG4gICAgICBcIm1hdHJpeFwiOiB7dmFsdWU6IFsxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxXSwgdHlwZTogXCJtYXRyaXhcIiB9XG4gICAgfSxcbiAgICBCbHVyOiB7fSxcbiAgICBTaGFycGVuOiB7fSxcbiAgICBFbWJvc3M6IHt9LFxuICAgIE11bHRpcGx5OiB7XG4gICAgICBcImNvbG9yXCI6IHt0eXBlOiAnY29sb3InLCB2YWx1ZTogXCIjRjBGXCJ9XG4gICAgfSxcbiAgICBQaXhlbGF0ZToge1xuICAgICAgXCJibG9ja3NpemVcIjoge3ZhbHVlOiA0LCBtaW46IDIsIG1heDogMjB9XG4gICAgfSxcbiAgICBUaW50OiB7XG4gICAgICBcImNvbG9yXCI6ICB7dHlwZTogJ2NvbG9yJywgdmFsdWU6IFwiIzM1MTNCMFwifSxcbiAgICAgIFwib3BhY2l0eVwiOiB7dmFsdWU6IDEsIG1pbjogMCwgbWF4OiAxLCBzdGVwOiAwLjF9XG4gICAgfSxcbiAgICBNYXNrOiB7XG4gICAgICBtYXNrOiB7XG4gICAgICAgIHR5cGU6ICdpbWFnZScsXG4gICAgICAgIHZhbHVlOiB7XG4gICAgICAgICAgc3JjOiAgXCJwaG90b3MvZXhwbG9zaW9uLnBuZ1wiXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBjaGFubmVsOiB7IHZhbHVlOiAwfVxuICAgIH0sXG4gICAgQmxlbmQ6IHtcbiAgICAgIFwiY29sb3JcIjoge3R5cGU6ICdjb2xvcicsIHZhbHVlOiBcIiMzNTEzQjBcIn0sXG4gICAgICBcIm1vZGVcIjoge1xuICAgICAgICB2YWx1ZTogXCJhZGRcIixcbiAgICAgICAgb3B0aW9uczogW1xuICAgICAgICAgIHt2YWx1ZTogXCJhZGRcIiwgdGl0bGU6IFwiQWRkXCJ9LFxuICAgICAgICAgIHt2YWx1ZTogXCJkaWZmXCIsIHRpdGxlOiBcIkRpZmZcIn0sXG4gICAgICAgICAge3ZhbHVlOiBcInN1YnRyYWN0XCIsIHRpdGxlOiBcIlN1YnRyYWN0XCJ9LFxuICAgICAgICAgIHt2YWx1ZTogXCJtdWx0aXBseVwiLCB0aXRsZTogXCJNdWx0aXBseVwifSxcbiAgICAgICAgICB7dmFsdWU6IFwic2NyZWVuXCIsIHRpdGxlOiBcIlNjcmVlblwifSxcbiAgICAgICAgICB7dmFsdWU6IFwibGlnaHRlblwiLCB0aXRsZTogXCJMaWdodGVuXCJ9LFxuICAgICAgICAgIHt2YWx1ZTogXCJkYXJrZW5cIiwgdGl0bGU6IFwiRGFya2VuXCJ9XG4gICAgICAgIF1cbiAgICAgIH1cbiAgICB9XG4gIH07XG5cblxuICBmb3IodmFyIGkgaW4gcHJvdG90eXBlT3B0aW9ucyl7XG4gICAgZmFicmljLkltYWdlLmZpbHRlcnNbaV0ucHJvdG90eXBlLm9wdGlvbnMgPSBwcm90b3R5cGVPcHRpb25zW2ldO1xuICB9XG5cblxuXG59XG5cblxuXG5cbmZhYnJpYy5JbWFnZS5nZXRGaWx0ZXJzTGlzdCA9IGZ1bmN0aW9uKGVsKXtcblxuICBlbCA9IGVsIHx8IGZhYnJpYy5JbWFnZS5wcm90b3R5cGU7XG4gIHZhciBmaWx0ZXJMaXN0ID0gW107XG4gIGZvcih2YXIgaSBpbiBlbC5hdmFpbGFibGVGaWx0ZXJzKXtcbiAgICB2YXIgX2YgPSBmYWJyaWMuSW1hZ2UuZmlsdGVyc1tlbC5hdmFpbGFibGVGaWx0ZXJzW2ldXTtcblxuICAgIHZhciBfZGF0YSA9IHtcbiAgICAgIHR5cGU6ICAgICBlbC5hdmFpbGFibGVGaWx0ZXJzW2ldXG4gICAgfTtcbiAgICBpZihfZi5wcm90b3R5cGUuY3VzdG9tKXtcbiAgICAgIGlmKCFlbC5jdXN0b21GaWx0ZXJzKXtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgfVxuICAgIGlmKF9mLnByb3RvdHlwZS5tYXNrRmlsdGVyKXtcbiAgICAgIGlmKCFlbC5tYXNrRmlsdGVyKXtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgfVxuICAgIGlmKF9mLnByb3RvdHlwZS5jYW1hbil7XG4gICAgICBpZighZWwuY2FtYW5GaWx0ZXJzKXtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBfZGF0YS5jYW1hbiA9IHRydWU7XG4gICAgfWVsc2V7XG4gICAgICBpZighZWwuZmFicmljRmlsdGVycyl7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgIH1cbiAgICBpZihfZi5wcm90b3R5cGUub3B0aW9ucyl7XG4gICAgICBfZGF0YS5vcHRpb25zID0gZmFicmljLnV0aWwub2JqZWN0LmNsb25lKF9mLnByb3RvdHlwZS5vcHRpb25zKTtcbiAgICB9XG4gICAgX2RhdGEudGV4dCA9IF9mLnByb3RvdHlwZS50aXRsZSB8fCBlbC5hdmFpbGFibGVGaWx0ZXJzW2ldO1xuXG4gICAgZmlsdGVyTGlzdC5wdXNoKF9kYXRhKVxuICB9XG4gIHJldHVybiBmaWx0ZXJMaXN0O1xufTtcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuSW1hZ2UucHJvdG90eXBlLCB7XG4gIGNhbWFuRmlsdGVyczogZmFsc2UsXG4gIGZhYnJpY0ZpbHRlcnM6IHRydWUsXG4gIGN1c3RvbUZpbHRlcnM6IGZhbHNlLFxuICBtYXNrRmlsdGVyOiBmYWxzZSxcbiAgZ2V0RmlsdGVyc0RhdGEgOiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIF9maWx0ZXJzID0gZmFicmljLkltYWdlLmdldEZpbHRlcnNMaXN0KHRoaXMpO1xuICAgIGZvciAodmFyIGkgaW4gdGhpcy5maWx0ZXJzKSB7XG4gICAgICB2YXIgX2YgPSBmYWJyaWMudXRpbC5vYmplY3QuZmluZFdoZXJlKF9maWx0ZXJzLHt0eXBlOiBmYWJyaWMudXRpbC5zdHJpbmcuY2FwaXRhbGl6ZSh0aGlzLmZpbHRlcnNbaV0udHlwZSl9KVxuICAgICAgaWYoX2Ype1xuICAgICAgICBfZi5lbmFibGVkID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIF9maWx0ZXJzO1xuICB9LFxuICBhdmFpbGFibGVGaWx0ZXJzOiBbXG4gICAgLy9mYWJyaWNKU1xuICAgIFwiR3JheXNjYWxlXCIsXG4gICAgXCJTZXBpYVwiLFxuICAgIFwiU2VwaWEyXCIsXG4gICAgXCJJbnZlcnRcIixcbiAgICBcIkJsdXJcIixcbiAgICBcIlNoYXJwZW5cIixcbiAgICBcIkVtYm9zc1wiLFxuICAgIFwiQmxlbmRcIixcbiAgICBcIlRpbnRcIixcbiAgICBcIk11bHRpcGx5XCIsXG4gICAgLy9cIkNvbnZvbHV0ZVwiLFxuICAgIFwiTm9pc2VcIixcbiAgICBcIkJyaWdodG5lc3NcIixcbiAgICBcIlBpeGVsYXRlXCIsXG4gICAgXCJHcmFkaWVudFRyYW5zcGFyZW5jeVwiLFxuICAgIFwiTWFza1wiXG4gIF0sXG4gIGdldEZpbHRlcjogZnVuY3Rpb24gKGZpbHRlck5hbWUpIHtcbiAgICBmaWx0ZXJOYW1lID0gZmFicmljLnV0aWwuc3RyaW5nLnVuY2FwaXRhbGl6ZShmaWx0ZXJOYW1lKTtcbiAgICBmb3IodmFyIGkgaW4gdGhpcy5maWx0ZXJzKXtcbiAgICAgIGlmKGZhYnJpYy51dGlsLnN0cmluZy51bmNhcGl0YWxpemUodGhpcy5maWx0ZXJzW2ldLnR5cGUpID09PSBmaWx0ZXJOYW1lKXtcbiAgICAgICAgcmV0dXJuIHRoaXMuZmlsdGVyc1tpXTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9LFxuICBzZXRGaWx0ZXI6IGZ1bmN0aW9uIChmaWx0ZXIpIHtcblxuICAgIHZhciBfb2xkX2ZpbHRlciA9IGZhbHNlO1xuICAgIGlmKGZpbHRlci5yZXBsYWNlKXtcbiAgICAgIHRoaXMuZmlsdGVycyA9IFtdO1xuICAgIH1lbHNle1xuICAgICAgX29sZF9maWx0ZXIgPSBmYWJyaWMudXRpbC5vYmplY3QuZmluZFdoZXJlKHRoaXMuZmlsdGVycywge3R5cGU6IGZpbHRlci50eXBlfSk7XG4gICAgICBfb2xkX2ZpbHRlciA9IF9vbGRfZmlsdGVyICYmIF9vbGRfZmlsdGVyLnRvT2JqZWN0KCkgfHwgZmFsc2U7XG4gICAgfVxuXG5cbiAgICBpZihmaWx0ZXIudHlwZSl7XG4gICAgICB2YXIgX3R5cGUgPSBmYWJyaWMudXRpbC5zdHJpbmcuY2FwaXRhbGl6ZShmaWx0ZXIudHlwZSx0cnVlKTtcbiAgICAgIHZhciBfbmV3X2ZpbHRlciA9IGZpbHRlci5vcHRpb25zICYmIGZhYnJpYy51dGlsLm9iamVjdC5jbG9uZShmaWx0ZXIub3B0aW9ucyk7XG5cblxuICAgIH1lbHNle1xuICAgICAgX3R5cGUgPSBmYWxzZTtcbiAgICAgIF9uZXdfZmlsdGVyID0gZmFsc2U7XG4gICAgfVxuXG4gICAgLyogdGhpcy5wcm9qZWN0Lmhpc3RvcnkuYWRkKHtcbiAgICAgZGF0YTogICBbJC5leHRlbmQodHJ1ZSwge30sIHRoaXMuZGF0YSldLFxuICAgICBzbGlkZTogIHRoaXMuc2xpZGUsXG4gICAgIG9iamVjdDogdGhpcyxcbiAgICAgcmVkbzogICBmaWx0ZXIsXG4gICAgIHVuZG86ICAgX29sZF9maWx0ZXIgLFxuICAgICB0eXBlOiAgIFwiZmlsdGVyXCIsXG4gICAgIHVuZG9GbjogZnVuY3Rpb24oYWN0aW9uKXtcbiAgICAgYWN0aW9uLm9iamVjdC5fc2V0X2ZpbHRlcihhY3Rpb24udW5kbyk7XG4gICAgIH0sXG4gICAgIHJlZG9GbjogIGZ1bmN0aW9uKGFjdGlvbil7XG4gICAgIGFjdGlvbi5vYmplY3QuX3NldF9maWx0ZXIoYWN0aW9uLnJlZG8pO1xuICAgICB9XG4gICAgIH0pO1xuICAgICAqL1xuICAgIHRoaXMuX3NldF9maWx0ZXIoX3R5cGUsIF9uZXdfZmlsdGVyLCBfb2xkX2ZpbHRlcik7XG5cbiAgfSxcblxuICBfc2V0X2ZpbHRlcjogZnVuY3Rpb24gKF90eXBlLCBfbmV3X2ZpbHRlcikge1xuXG4gICAgaWYoX3R5cGUpe1xuICAgICAgdmFyIF9vbGRfZmlsdGVyID0gdGhpcy5nZXRGaWx0ZXIoX3R5cGUpO1xuICAgIH1cblxuICAgIGlmIChfb2xkX2ZpbHRlciAmJiBfbmV3X2ZpbHRlcikge1xuICAgICAgZm9yICh2YXIgaSBpbiBfbmV3X2ZpbHRlcikge1xuICAgICAgICBfb2xkX2ZpbHRlcltpXSA9IF9uZXdfZmlsdGVyW2ldO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoX29sZF9maWx0ZXIgJiYgIV9uZXdfZmlsdGVyKSB7XG4gICAgICB0aGlzLmZpbHRlcnMuc3BsaWNlKHRoaXMuZmlsdGVycy5pbmRleE9mKF9vbGRfZmlsdGVyKSwgMSk7XG4gICAgfVxuICAgIGlmICghX29sZF9maWx0ZXIgJiYgX25ld19maWx0ZXIpIHtcbiAgICAgIHRoaXMuZmlsdGVycy5wdXNoKG5ldyBmYWJyaWMuSW1hZ2UuZmlsdGVyc1tfdHlwZV0oX25ld19maWx0ZXIpKTtcbiAgICB9XG4gICAgdGhpcy5hcHBseUZpbHRlcnModGhpcy5jYW52YXMucmVuZGVyQWxsLmJpbmQodGhpcy5jYW52YXMpKTtcbiAgfSxcblxuICBpbnNlcnRJbWFnZUZpbHRlcnM6IGZhbHNlLFxuICBhY3Rpb25zIDogZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuSW1hZ2UucHJvdG90eXBlLmFjdGlvbnMsIHtcbiAgICBpbWFnZUZpbHRlcnM6IHtcbiAgICAgIHRpdGxlOiBcItGE0LjQu9GM0YLRgFwiLFxuICAgICAgaXRlbUNsYXNzTmFtZTogXCJmaWx0ZXJzLXNlbGVjdG9yXCIsXG4gICAgICBjbGFzc05hbWU6IFwiZmEgZmEtZmlsdGVyXCIsXG4gICAgICB0eXBlOiBcInNlbGVjdFwiLFxuICAgICAgdGVtcGxhdGVTZWxlY3Rpb246IGZ1bmN0aW9uIChzdGF0ZSwgY29udGFpbmVyKSB7XG4gICAgICAgIGlmIChzdGF0ZS5hbnkpIHtcbiAgICAgICAgICByZXR1cm4gc3RhdGUudGV4dDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gJCgnPHNwYW4+PHNwYW4gY2xhc3M9XCJjb2xvci1zcGFuXCIgc3R5bGU9XCJiYWNrZ3JvdW5kLWNvbG9yOicgKyBzdGF0ZS50ZXh0ICsgJ1wiPjwvc3Bhbj4nICsgc3RhdGUudGV4dCArICc8L3NwYW4+Jyk7XG4gICAgICB9LFxuICAgICAgdGVtcGxhdGVSZXN1bHQ6IGZ1bmN0aW9uIChzdGF0ZSwgY29udGFpbmVyLCBkYXRhKSB7XG4gICAgICAgIHZhciAkZWwgPSAkKCc8c3Bhbj4nICsgc3RhdGUudGV4dCArICc8L3NwYW4+Jyk7XG4gICAgICAgIGlmIChzdGF0ZS5pZCAhPSBcIm5vbmVcIikge1xuICAgICAgICAgIHZhciAkY2FudmFzID0gJCgnPGNhbnZhcz4nKTtcbiAgICAgICAgICBmYWJyaWMudXRpbC5kcmF3RmlsdGVyKCRjYW52YXNbMF0sIGRhdGEudGFyZ2V0Ll9lbGVtZW50LCBzdGF0ZS5pZCwge1xuICAgICAgICAgICAgaGVpZ2h0OiAyMlxuICAgICAgICAgIH0pO1xuICAgICAgICAgICRlbC5wcmVwZW5kKCRjYW52YXMpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAkZWw7XG4gICAgICB9LFxuICAgICAgdmFsdWU6IHtcbiAgICAgICAgc2V0OiBmdW5jdGlvbiAodmFsLCBmaWx0ZXJzRGF0YSkge1xuICAgICAgICAgIHZhciBvcHRpb25zID0gZmFsc2U7XG4gICAgICAgICAgaWYgKHZhbCA9PSBcIm5vbmVcIikge1xuICAgICAgICAgICAgdmFsID0gZmFsc2U7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhciBfZiA9IF8uZmluZFdoZXJlKGZpbHRlcnNEYXRhLCB7aWQ6IHZhbH0pO1xuICAgICAgICAgICAgX2YuZW5hYmxlZCA9ICFfZi5lbmFibGVkO1xuICAgICAgICAgICAgZm9yICh2YXIgaSBpbiBfZi5vcHRpb25zKSB7XG4gICAgICAgICAgICAgIGlmICgkLmlzTnVtZXJpYyhfZi5vcHRpb25zW2ldKSkge1xuICAgICAgICAgICAgICAgIF9mLm9wdGlvbnNbaV0gPSBwYXJzZUZsb2F0KF9mLm9wdGlvbnNbaV0pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoX2YuZW5hYmxlZCkge1xuICAgICAgICAgICAgICBvcHRpb25zID0ge307XG4gICAgICAgICAgICAgIGZvciAodmFyIGkgaW4gX2Yub3B0aW9ucykge1xuICAgICAgICAgICAgICAgIG9wdGlvbnNbaV0gPSBfZi5vcHRpb25zW2ldLnZhbHVlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cblxuICAgICAgICAgIH1cbiAgICAgICAgICB0aGlzLnNldEZpbHRlcih7XG4gICAgICAgICAgICB0eXBlOiB2YWwsXG4gICAgICAgICAgICBvcHRpb25zOiBvcHRpb25zLFxuICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZVxuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5maWx0ZXJzLmxlbmd0aCA/IGZhYnJpYy51dGlsLnN0cmluZy5jYXBpdGFsaXplKHRoaXMuZmlsdGVyc1swXS50eXBlLCB0cnVlKSA6IFwibm9uZVwiXG4gICAgICAgIH0sXG4gICAgICAgIG9wdGlvbnM6IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgIHZhciBfZmlsdGVycyA9IHRoaXMuZ2V0RmlsdGVyc0RhdGEoKTtcbiAgICAgICAgICBmb3IgKHZhciBpIGluIF9maWx0ZXJzKSB7XG4gICAgICAgICAgICBfZmlsdGVyc1tpXS5pZCA9IF9maWx0ZXJzW2ldLnR5cGU7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBbe1xuICAgICAgICAgICAgaWQ6ICdub25lJyxcbiAgICAgICAgICAgIHRleHQ6ICdvcmlnaW5hbCcsXG4gICAgICAgICAgICBlbmFibGVkOiAhdGhpcy5maWx0ZXJzIHx8ICF0aGlzLmZpbHRlcnMubGVuZ3RoXG4gICAgICAgICAgfV0uY29uY2F0KF9maWx0ZXJzKTtcblxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9KVxufSk7XG5cbi8vXG4vLyBmYWJyaWMuSW1hZ2UuZmlsdGVyTWFuYWdlciA9IHtcbi8vXG4vLyAgIC8vaGlkZTogZnVuY3Rpb24ob2JqZWN0KXtcbi8vICAgLy9cbi8vICAgLy99LFxuLy8gICBzaG93OiBmdW5jdGlvbiAob2JqZWN0KSB7XG4vLyAgICAgdGhpcy5hY3RpdmVPYmplY3QgPSBvYmplY3Q7XG4vLyAgICAgdGhpcy5maXJlKCdzaG93Jywgb2JqZWN0KTtcbi8vICAgICB0aGlzLm9uKCd0YXJnZXQ6Y2hhbmdlZCcsIG9iamVjdClcbi8vICAgfVxuLy8gLy8gfTtcblxuXG5cbi8vIGZhYnJpYy51dGlsLm9ic2VydmFibGUoZmFicmljLkltYWdlLmZpbHRlck1hbmFnZXIpO1xuXG5mYWJyaWMudXRpbC5kcmF3RmlsdGVyID0gZnVuY3Rpb24oZWxlbWVudCxzcmMsIGZpbHRlck5hbWUgLG9wdGlvbnMpe1xuICBpZihzcmMuY29uc3RydWN0b3IgPT09IFN0cmluZyl7XG4gICAgZmFicmljLnV0aWwubG9hZEltYWdlKHNyYyxmdW5jdGlvbihlbCl7XG4gICAgICBmYWJyaWMudXRpbC5fZHJhd0ZpbHRlcihlbGVtZW50LCBlbCwgZmlsdGVyTmFtZSAsb3B0aW9ucyk7XG4gICAgfSlcbiAgfWVsc2V7XG4gICAgZmFicmljLnV0aWwuX2RyYXdGaWx0ZXIoZWxlbWVudCxzcmMsIGZpbHRlck5hbWUgLG9wdGlvbnMpO1xuICB9XG59O1xuXG5mYWJyaWMudXRpbC5fZHJhd0ZpbHRlciA9IGZ1bmN0aW9uKGVsZW1lbnQsIGVsLCBmaWx0ZXJOYW1lICxvcHRpb25zKXtcblxuICB2YXIgY3R4ID1lbGVtZW50LmdldENvbnRleHQoXCIyZFwiKTtcbiAgaWYob3B0aW9ucyl7XG4gICAgaWYob3B0aW9ucy53aWR0aCAmJiBvcHRpb25zLmhlaWdodCl7XG4gICAgICBlbGVtZW50LndpZHRoID0gb3B0aW9ucy53aWR0aDtcbiAgICAgIGVsZW1lbnQuaGVpZ2h0ID0gb3B0aW9ucy5oZWlnaHQ7XG4gICAgfWVsc2UgaWYob3B0aW9ucy53aWR0aCl7XG4gICAgICBlbGVtZW50LndpZHRoID0gb3B0aW9ucy53aWR0aDtcbiAgICAgIGVsZW1lbnQuaGVpZ2h0ID0gb3B0aW9ucy53aWR0aCAqIChlbC5oZWlnaHQgLyBlbC53aWR0aCk7XG4gICAgfWVsc2UgaWYob3B0aW9ucy5oZWlnaHQpe1xuICAgICAgZWxlbWVudC5oZWlnaHQgPSBvcHRpb25zLmhlaWdodDtcbiAgICAgIGVsZW1lbnQud2lkdGggPSBvcHRpb25zLmhlaWdodCAqIChlbC53aWR0aCAvIGVsLmhlaWdodCk7XG4gICAgfVxuICB9XG5cbiAgY3R4LmRyYXdJbWFnZShlbCwwLDAsZWxlbWVudC53aWR0aCxlbGVtZW50LmhlaWdodCk7XG4gIGlmKCFmaWx0ZXJOYW1lKXJldHVybjtcbiAgZmlsdGVyTmFtZSA9IGZhYnJpYy51dGlsLnN0cmluZy5jYXBpdGFsaXplKGZpbHRlck5hbWUsdHJ1ZSk7XG5cbiAgaWYoZmFicmljLkltYWdlLmZpbHRlcnNbZmlsdGVyTmFtZV0pe1xuICAgIHZhciBfZmlsdGVyID0gbmV3IGZhYnJpYy5JbWFnZS5maWx0ZXJzW2ZpbHRlck5hbWVdKClcbiAgfWVsc2V7XG4gICAgdmFyIF9maWx0ZXIgPWZhYnJpYy5JbWFnZS5maWx0ZXJzW2ZpbHRlck5hbWVdLmNyZWF0ZSh7fSk7XG4gIH1cblxuICAvL3ZhciBfZmlsdGVyID0gbmV3IGZhYnJpYy5JbWFnZS5maWx0ZXJzW2ZpbHRlck5hbWVdO1xuICBpZihfZmlsdGVyKXtcbiAgICB2YXIgX2ZvID0gZmFicmljLkltYWdlLmZpbHRlcnNbZmlsdGVyTmFtZV0ucHJvdG90eXBlLm9wdGlvbnM7XG4gICAgdmFyIGZpbHRlck9wdGlvbnMgPSB7fTtcbiAgICBmb3IodmFyIGkgaW4gX2ZvKXtcbiAgICAgIGZpbHRlck9wdGlvbnNbaV0gPSBfZm9baV0udmFsdWU7XG5cbiAgICB9XG4gICAgZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChfZmlsdGVyLGZpbHRlck9wdGlvbnMpO1xuICAgIF9maWx0ZXIuaW1hZ2VEYXRhID0gY3R4LmdldEltYWdlRGF0YSgwLDAsZWxlbWVudC53aWR0aCxlbGVtZW50LmhlaWdodCk7XG4gICAgX2ZpbHRlci5hcHBseVRvKGVsZW1lbnQpO1xuICB9XG59O1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9tb2R1bGVzL2ltYWdlLmZpbHRlcnMuanMiLCJpZih0eXBlb2YgV2ViRm9udCA9PSBcInVuZGVmaW5lZFwiKXtcbiAgZmFicmljLndlYkZvbnRzTG9hZGVyID0gcmVxdWlyZShcIi4vLi4vLi4vcGx1Z2lucy93ZWJmb250LmpzXCIpO1xufWVsc2V7XG4gIGZhYnJpYy53ZWJGb250c0xvYWRlciA9IFdlYkZvbnQ7XG59XG5cbi8v0LjQvdGC0LXRgNC10YHQvdCw0Y8g0LHQuNCx0LvQuNC+0YLQtdC60LBcbi8vIGh0dHA6Ly9vcGVudHlwZS5qcy5vcmcvaW5kZXguaHRtbFxuLy90b2RvIGFkZCBzdGVwXG4vL1xuLy8gZmFicmljLkFwcGxpY2F0aW9uLnByb3RvdHlwZS5zdGVwcy5zcGxpY2UoMywwLFwibG9hZFdlYmZvbnRzXCIpO1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5BcHBsaWNhdGlvbi5wcm90b3R5cGUsIHtcbiAgLy8gc2V0V2ViZm9udHM6IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAvL1xuICAvLyB9LFxuICBzZXRGb250czogZnVuY3Rpb24gKGZvbnRzLCBjYWxsYmFjaykge1xuICAgIHRoaXMuZm9udHMgPSBmb250cztcbiAgICBpZihmYWJyaWMuaXNMaWtlbHlOb2RlKXtcbiAgICAgIC8vdG9kbyDRiNGA0LjRhNGC0Ysg0L3QtSDQs9GA0YPQt9GP0YLRgdGPINC90LAg0YHQtdGA0LLQtdGA0LVcbiAgICAgIHJldHVybiBjYWxsYmFjaygpO1xuICAgIH1cbiAgICAvLyBpZighZm9udHMgfHwgIWZvbnRzLmxlbmd0aCl7XG4gICAgLy8gICByZXR1cm4gY2FsbGJhY2soKTtcbiAgICAvLyB9XG4gICAgdGhpcy5maXJlKFwibG9hZGluZ1wiLHt0eXBlOiBcIndlYmZvbnRzXCJ9KTtcblxuICAgIHRoaXMuX2ZvbnRzID0gW107XG5cbiAgICBmb3IodmFyIGkgaW4gdGhpcy5mb250cyl7XG4gICAgICB0aGlzLl9mb250cyA9IHRoaXMuX2ZvbnRzLmNvbmNhdCh0aGlzLmZvbnRzW2ldKTtcbiAgICB9XG4gICAgdGhpcy5fZm9udHMgPSBmYWJyaWMudXRpbC5vYmplY3Quc29ydEJ5KHRoaXMuX2ZvbnRzLCBmdW5jdGlvbihmb250KXsgcmV0dXJuIGZvbnQ7IH0pO1xuXG4gICAgaWYoZmFicmljLndlYkZvbnRzTG9hZGVyICYmICh0aGlzLmZvbnRzLmdvb2dsZSAmJiB0aGlzLmZvbnRzLmdvb2dsZS5sZW5ndGggfHwgdGhpcy5mb250cy5jdXN0b20gJiYgdGhpcy5mb250cy5jdXN0b20ubGVuZ3RoKSApe1xuICAgICAgdmFyIGZvbnRzX29wdGlvbnMgPSB7XG4gICAgICAgIGFjdGl2ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICBpZih0aGlzLmZvbnRzLmdvb2dsZSAmJiB0aGlzLmZvbnRzLmdvb2dsZS5sZW5ndGgpe1xuICAgICAgICBmb250c19vcHRpb25zLmdvb2dsZSA9ICB7XG4gICAgICAgICAgZmFtaWxpZXM6IHRoaXMuZm9udHMuZ29vZ2xlXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICBpZih0aGlzLmZvbnRzLmN1c3RvbSAmJiB0aGlzLmZvbnRzLmN1c3RvbS5sZW5ndGgpe1xuICAgICAgICBmb250c19vcHRpb25zLmN1c3RvbSA9ICB7XG4gICAgICAgICAgZmFtaWxpZXM6IHRoaXMuZm9udHMuY3VzdG9tXG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIGZhYnJpYy53ZWJGb250c0xvYWRlci5sb2FkKGZvbnRzX29wdGlvbnMpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjYWxsYmFjaygpO1xuICAgIH1cbiAgICBpZiAodGhpcy53YWl0Rm9yV2ViZm9udHMpIHtcbiAgICAgIGZhYnJpYy51dGlsLmZvbnRzLndhaXRGb3IodGhpcy53YWl0Rm9yV2ViZm9udHMsIGNhbGxiYWNrKVxuICAgIH1cbiAgfSxcbiAgZm9udHM6IHtcbiAgICBzdGFuZGFydDogW1xuICAgICAgJ0FyaWFsJyxcbiAgICAgICdBcmlhbCBCbGFjaycsXG4gICAgICAnQ29taWMgU2FucyBNUycsXG4gICAgICAnQ291cmllciBOZXcnLFxuICAgICAgJ0dlb3JnaWEnLFxuICAgICAgJ0ltcGFjdCcsXG4gICAgICAnTHVjaWRhIENvbnNvbGUnLFxuICAgICAgJ1RhaG9tYScsXG4gICAgICAnVGltZXMgTmV3IFJvbWFuJyxcbiAgICAgICdHZW5ldmEnLFxuICAgICAgJ3NhbnMtc2VyaWYnLFxuICAgICAgJ3NlcmlmJyxcbiAgICAgICdtb25vc3BhY2UnLFxuICAgICAgJ2N1cnNpdmUnXG4gICAgXSxcbiAgICBnb29nbGU6IFtdLFxuICAgIGN1c3RvbTogW11cbiAgfVxufSk7XG5cblxuZmFicmljLnV0aWwuZm9udHMgPSB7XG4gIHdhaXRGb3I6IGZ1bmN0aW9uIChmb250cywgY2FsbGJhY2spIHtcbiAgICB2YXIgbG9hZGVkRm9udHMgPSAwO1xuICAgIGZvciAodmFyIGkgPSAwLCBsID0gZm9udHMubGVuZ3RoOyBpIDwgbDsgKytpKSB7XG4gICAgICAoZnVuY3Rpb24gKGZvbnQpIHtcbiAgICAgICAgdmFyIG5vZGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XG4gICAgICAgIC8vIENoYXJhY3RlcnMgdGhhdCB2YXJ5IHNpZ25pZmljYW50bHkgYW1vbmcgZGlmZmVyZW50IGZvbnRzXG4gICAgICAgIG5vZGUuaW5uZXJIVE1MID0gJ2dpSXRUMVdReUAhLS8jJztcbiAgICAgICAgLy8gVmlzaWJsZSAtIHNvIHdlIGNhbiBtZWFzdXJlIGl0IC0gYnV0IG5vdCBvbiB0aGUgc2NyZWVuXG4gICAgICAgIG5vZGUuc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnO1xuICAgICAgICBub2RlLnN0eWxlLmxlZnQgPSAnLTEwMDAwcHgnO1xuICAgICAgICBub2RlLnN0eWxlLnRvcCA9ICctMTAwMDBweCc7XG4gICAgICAgIC8vIExhcmdlIGZvbnQgc2l6ZSBtYWtlcyBldmVuIHN1YnRsZSBjaGFuZ2VzIG9idmlvdXNcbiAgICAgICAgbm9kZS5zdHlsZS5mb250U2l6ZSA9ICczMDBweCc7XG4gICAgICAgIC8vIFJlc2V0IGFueSBmb250IHByb3BlcnRpZXNcbiAgICAgICAgbm9kZS5zdHlsZS5mb250RmFtaWx5ID0gJ3NhbnMtc2VyaWYnO1xuICAgICAgICBub2RlLnN0eWxlLmZvbnRWYXJpYW50ID0gJ25vcm1hbCc7XG4gICAgICAgIG5vZGUuc3R5bGUuZm9udFN0eWxlID0gJ25vcm1hbCc7XG4gICAgICAgIG5vZGUuc3R5bGUuZm9udFdlaWdodCA9ICdub3JtYWwnO1xuICAgICAgICBub2RlLnN0eWxlLmxldHRlclNwYWNpbmcgPSAnMCc7XG4gICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobm9kZSk7XG5cbiAgICAgICAgLy8gUmVtZW1iZXIgd2lkdGggd2l0aCBubyBhcHBsaWVkIHdlYiBmb250XG4gICAgICAgIHZhciB3aWR0aCA9IG5vZGUub2Zmc2V0V2lkdGg7XG5cbiAgICAgICAgbm9kZS5zdHlsZS5mb250RmFtaWx5ID0gZm9udDtcblxuICAgICAgICB2YXIgaW50ZXJ2YWw7XG5cbiAgICAgICAgZnVuY3Rpb24gY2hlY2tGb250KCkge1xuICAgICAgICAgIC8vIENvbXBhcmUgY3VycmVudCB3aWR0aCB3aXRoIG9yaWdpbmFsIHdpZHRoXG4gICAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5vZmZzZXRXaWR0aCAhPSB3aWR0aCkge1xuICAgICAgICAgICAgKytsb2FkZWRGb250cztcbiAgICAgICAgICAgIG5vZGUucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChub2RlKTtcbiAgICAgICAgICAgIG5vZGUgPSBudWxsO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIElmIGFsbCBmb250cyBoYXZlIGJlZW4gbG9hZGVkXG4gICAgICAgICAgaWYgKGxvYWRlZEZvbnRzID49IGZvbnRzLmxlbmd0aCkge1xuICAgICAgICAgICAgaWYgKGludGVydmFsKSB7XG4gICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoaW50ZXJ2YWwpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGxvYWRlZEZvbnRzID09IGZvbnRzLmxlbmd0aCkge1xuICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgICB9LCA1MClcbiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFjaGVja0ZvbnQoKSkge1xuICAgICAgICAgIGludGVydmFsID0gc2V0SW50ZXJ2YWwoY2hlY2tGb250LCA1MCk7XG4gICAgICAgIH1cbiAgICAgIH0pKGZvbnRzW2ldKTtcbiAgICB9XG4gIH1cbn07XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL21vZHVsZXMvZm9udHMuanMiLCIvKiBXZWIgRm9udCBMb2FkZXIgdjEuNi4yNiAtIChjKSBBZG9iZSBTeXN0ZW1zLCBHb29nbGUuIExpY2Vuc2U6IEFwYWNoZSAyLjAgKi8oZnVuY3Rpb24oKXtmdW5jdGlvbiBhYShhLGIsYyl7cmV0dXJuIGEuY2FsbC5hcHBseShhLmJpbmQsYXJndW1lbnRzKX1mdW5jdGlvbiBiYShhLGIsYyl7aWYoIWEpdGhyb3cgRXJyb3IoKTtpZigyPGFyZ3VtZW50cy5sZW5ndGgpe3ZhciBkPUFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywyKTtyZXR1cm4gZnVuY3Rpb24oKXt2YXIgYz1BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpO0FycmF5LnByb3RvdHlwZS51bnNoaWZ0LmFwcGx5KGMsZCk7cmV0dXJuIGEuYXBwbHkoYixjKX19cmV0dXJuIGZ1bmN0aW9uKCl7cmV0dXJuIGEuYXBwbHkoYixhcmd1bWVudHMpfX1mdW5jdGlvbiBwKGEsYixjKXtwPUZ1bmN0aW9uLnByb3RvdHlwZS5iaW5kJiYtMSE9RnVuY3Rpb24ucHJvdG90eXBlLmJpbmQudG9TdHJpbmcoKS5pbmRleE9mKFwibmF0aXZlIGNvZGVcIik/YWE6YmE7cmV0dXJuIHAuYXBwbHkobnVsbCxhcmd1bWVudHMpfXZhciBxPURhdGUubm93fHxmdW5jdGlvbigpe3JldHVybituZXcgRGF0ZX07ZnVuY3Rpb24gY2EoYSxiKXt0aGlzLmE9YTt0aGlzLm09Ynx8YTt0aGlzLmM9dGhpcy5tLmRvY3VtZW50fXZhciBkYT0hIXdpbmRvdy5Gb250RmFjZTtmdW5jdGlvbiB0KGEsYixjLGQpe2I9YS5jLmNyZWF0ZUVsZW1lbnQoYik7aWYoYylmb3IodmFyIGUgaW4gYyljLmhhc093blByb3BlcnR5KGUpJiYoXCJzdHlsZVwiPT1lP2Iuc3R5bGUuY3NzVGV4dD1jW2VdOmIuc2V0QXR0cmlidXRlKGUsY1tlXSkpO2QmJmIuYXBwZW5kQ2hpbGQoYS5jLmNyZWF0ZVRleHROb2RlKGQpKTtyZXR1cm4gYn1mdW5jdGlvbiB1KGEsYixjKXthPWEuYy5nZXRFbGVtZW50c0J5VGFnTmFtZShiKVswXTthfHwoYT1kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpO2EuaW5zZXJ0QmVmb3JlKGMsYS5sYXN0Q2hpbGQpfWZ1bmN0aW9uIHYoYSl7YS5wYXJlbnROb2RlJiZhLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoYSl9XG4gIGZ1bmN0aW9uIHcoYSxiLGMpe2I9Ynx8W107Yz1jfHxbXTtmb3IodmFyIGQ9YS5jbGFzc05hbWUuc3BsaXQoL1xccysvKSxlPTA7ZTxiLmxlbmd0aDtlKz0xKXtmb3IodmFyIGY9ITEsZz0wO2c8ZC5sZW5ndGg7Zys9MSlpZihiW2VdPT09ZFtnXSl7Zj0hMDticmVha31mfHxkLnB1c2goYltlXSl9Yj1bXTtmb3IoZT0wO2U8ZC5sZW5ndGg7ZSs9MSl7Zj0hMTtmb3IoZz0wO2c8Yy5sZW5ndGg7Zys9MSlpZihkW2VdPT09Y1tnXSl7Zj0hMDticmVha31mfHxiLnB1c2goZFtlXSl9YS5jbGFzc05hbWU9Yi5qb2luKFwiIFwiKS5yZXBsYWNlKC9cXHMrL2csXCIgXCIpLnJlcGxhY2UoL15cXHMrfFxccyskLyxcIlwiKX1mdW5jdGlvbiB5KGEsYil7Zm9yKHZhciBjPWEuY2xhc3NOYW1lLnNwbGl0KC9cXHMrLyksZD0wLGU9Yy5sZW5ndGg7ZDxlO2QrKylpZihjW2RdPT1iKXJldHVybiEwO3JldHVybiExfVxuICBmdW5jdGlvbiB6KGEpe2lmKFwic3RyaW5nXCI9PT10eXBlb2YgYS5mKXJldHVybiBhLmY7dmFyIGI9YS5tLmxvY2F0aW9uLnByb3RvY29sO1wiYWJvdXQ6XCI9PWImJihiPWEuYS5sb2NhdGlvbi5wcm90b2NvbCk7cmV0dXJuXCJodHRwczpcIj09Yj9cImh0dHBzOlwiOlwiaHR0cDpcIn1mdW5jdGlvbiBlYShhKXtyZXR1cm4gYS5tLmxvY2F0aW9uLmhvc3RuYW1lfHxhLmEubG9jYXRpb24uaG9zdG5hbWV9XG4gIGZ1bmN0aW9uIEEoYSxiLGMpe2Z1bmN0aW9uIGQoKXtrJiZlJiZmJiYoayhnKSxrPW51bGwpfWI9dChhLFwibGlua1wiLHtyZWw6XCJzdHlsZXNoZWV0XCIsaHJlZjpiLG1lZGlhOlwiYWxsXCJ9KTt2YXIgZT0hMSxmPSEwLGc9bnVsbCxrPWN8fG51bGw7ZGE/KGIub25sb2FkPWZ1bmN0aW9uKCl7ZT0hMDtkKCl9LGIub25lcnJvcj1mdW5jdGlvbigpe2U9ITA7Zz1FcnJvcihcIlN0eWxlc2hlZXQgZmFpbGVkIHRvIGxvYWRcIik7ZCgpfSk6c2V0VGltZW91dChmdW5jdGlvbigpe2U9ITA7ZCgpfSwwKTt1KGEsXCJoZWFkXCIsYil9XG4gIGZ1bmN0aW9uIEIoYSxiLGMsZCl7dmFyIGU9YS5jLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwiaGVhZFwiKVswXTtpZihlKXt2YXIgZj10KGEsXCJzY3JpcHRcIix7c3JjOmJ9KSxnPSExO2Yub25sb2FkPWYub25yZWFkeXN0YXRlY2hhbmdlPWZ1bmN0aW9uKCl7Z3x8dGhpcy5yZWFkeVN0YXRlJiZcImxvYWRlZFwiIT10aGlzLnJlYWR5U3RhdGUmJlwiY29tcGxldGVcIiE9dGhpcy5yZWFkeVN0YXRlfHwoZz0hMCxjJiZjKG51bGwpLGYub25sb2FkPWYub25yZWFkeXN0YXRlY2hhbmdlPW51bGwsXCJIRUFEXCI9PWYucGFyZW50Tm9kZS50YWdOYW1lJiZlLnJlbW92ZUNoaWxkKGYpKX07ZS5hcHBlbmRDaGlsZChmKTtzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7Z3x8KGc9ITAsYyYmYyhFcnJvcihcIlNjcmlwdCBsb2FkIHRpbWVvdXRcIikpKX0sZHx8NUUzKTtyZXR1cm4gZn1yZXR1cm4gbnVsbH07ZnVuY3Rpb24gQygpe3RoaXMuYT0wO3RoaXMuYz1udWxsfWZ1bmN0aW9uIEQoYSl7YS5hKys7cmV0dXJuIGZ1bmN0aW9uKCl7YS5hLS07RShhKX19ZnVuY3Rpb24gRihhLGIpe2EuYz1iO0UoYSl9ZnVuY3Rpb24gRShhKXswPT1hLmEmJmEuYyYmKGEuYygpLGEuYz1udWxsKX07ZnVuY3Rpb24gRyhhKXt0aGlzLmE9YXx8XCItXCJ9Ry5wcm90b3R5cGUuYz1mdW5jdGlvbihhKXtmb3IodmFyIGI9W10sYz0wO2M8YXJndW1lbnRzLmxlbmd0aDtjKyspYi5wdXNoKGFyZ3VtZW50c1tjXS5yZXBsYWNlKC9bXFxXX10rL2csXCJcIikudG9Mb3dlckNhc2UoKSk7cmV0dXJuIGIuam9pbih0aGlzLmEpfTtmdW5jdGlvbiBIKGEsYil7dGhpcy5jPWE7dGhpcy5mPTQ7dGhpcy5hPVwiblwiO3ZhciBjPShifHxcIm40XCIpLm1hdGNoKC9eKFtuaW9dKShbMS05XSkkL2kpO2MmJih0aGlzLmE9Y1sxXSx0aGlzLmY9cGFyc2VJbnQoY1syXSwxMCkpfWZ1bmN0aW9uIGZhKGEpe3JldHVybiBJKGEpK1wiIFwiKyhhLmYrXCIwMFwiKStcIiAzMDBweCBcIitKKGEuYyl9ZnVuY3Rpb24gSihhKXt2YXIgYj1bXTthPWEuc3BsaXQoLyxcXHMqLyk7Zm9yKHZhciBjPTA7YzxhLmxlbmd0aDtjKyspe3ZhciBkPWFbY10ucmVwbGFjZSgvWydcIl0vZyxcIlwiKTstMSE9ZC5pbmRleE9mKFwiIFwiKXx8L15cXGQvLnRlc3QoZCk/Yi5wdXNoKFwiJ1wiK2QrXCInXCIpOmIucHVzaChkKX1yZXR1cm4gYi5qb2luKFwiLFwiKX1mdW5jdGlvbiBLKGEpe3JldHVybiBhLmErYS5mfWZ1bmN0aW9uIEkoYSl7dmFyIGI9XCJub3JtYWxcIjtcIm9cIj09PWEuYT9iPVwib2JsaXF1ZVwiOlwiaVwiPT09YS5hJiYoYj1cIml0YWxpY1wiKTtyZXR1cm4gYn1cbiAgZnVuY3Rpb24gZ2EoYSl7dmFyIGI9NCxjPVwiblwiLGQ9bnVsbDthJiYoKGQ9YS5tYXRjaCgvKG5vcm1hbHxvYmxpcXVlfGl0YWxpYykvaSkpJiZkWzFdJiYoYz1kWzFdLnN1YnN0cigwLDEpLnRvTG93ZXJDYXNlKCkpLChkPWEubWF0Y2goLyhbMS05XTAwfG5vcm1hbHxib2xkKS9pKSkmJmRbMV0mJigvYm9sZC9pLnRlc3QoZFsxXSk/Yj03Oi9bMS05XTAwLy50ZXN0KGRbMV0pJiYoYj1wYXJzZUludChkWzFdLnN1YnN0cigwLDEpLDEwKSkpKTtyZXR1cm4gYytifTtmdW5jdGlvbiBoYShhLGIpe3RoaXMuYz1hO3RoaXMuZj1hLm0uZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50O3RoaXMuaD1iO3RoaXMuYT1uZXcgRyhcIi1cIik7dGhpcy5qPSExIT09Yi5ldmVudHM7dGhpcy5nPSExIT09Yi5jbGFzc2VzfWZ1bmN0aW9uIGlhKGEpe2EuZyYmdyhhLmYsW2EuYS5jKFwid2ZcIixcImxvYWRpbmdcIildKTtMKGEsXCJsb2FkaW5nXCIpfWZ1bmN0aW9uIE0oYSl7aWYoYS5nKXt2YXIgYj15KGEuZixhLmEuYyhcIndmXCIsXCJhY3RpdmVcIikpLGM9W10sZD1bYS5hLmMoXCJ3ZlwiLFwibG9hZGluZ1wiKV07Ynx8Yy5wdXNoKGEuYS5jKFwid2ZcIixcImluYWN0aXZlXCIpKTt3KGEuZixjLGQpfUwoYSxcImluYWN0aXZlXCIpfWZ1bmN0aW9uIEwoYSxiLGMpe2lmKGEuaiYmYS5oW2JdKWlmKGMpYS5oW2JdKGMuYyxLKGMpKTtlbHNlIGEuaFtiXSgpfTtmdW5jdGlvbiBqYSgpe3RoaXMuYz17fX1mdW5jdGlvbiBrYShhLGIsYyl7dmFyIGQ9W10sZTtmb3IoZSBpbiBiKWlmKGIuaGFzT3duUHJvcGVydHkoZSkpe3ZhciBmPWEuY1tlXTtmJiZkLnB1c2goZihiW2VdLGMpKX1yZXR1cm4gZH07ZnVuY3Rpb24gTihhLGIpe3RoaXMuYz1hO3RoaXMuZj1iO3RoaXMuYT10KHRoaXMuYyxcInNwYW5cIix7XCJhcmlhLWhpZGRlblwiOlwidHJ1ZVwifSx0aGlzLmYpfWZ1bmN0aW9uIE8oYSl7dShhLmMsXCJib2R5XCIsYS5hKX1mdW5jdGlvbiBQKGEpe3JldHVyblwiZGlzcGxheTpibG9jaztwb3NpdGlvbjphYnNvbHV0ZTt0b3A6LTk5OTlweDtsZWZ0Oi05OTk5cHg7Zm9udC1zaXplOjMwMHB4O3dpZHRoOmF1dG87aGVpZ2h0OmF1dG87bGluZS1oZWlnaHQ6bm9ybWFsO21hcmdpbjowO3BhZGRpbmc6MDtmb250LXZhcmlhbnQ6bm9ybWFsO3doaXRlLXNwYWNlOm5vd3JhcDtmb250LWZhbWlseTpcIitKKGEuYykrXCI7XCIrKFwiZm9udC1zdHlsZTpcIitJKGEpK1wiO2ZvbnQtd2VpZ2h0OlwiKyhhLmYrXCIwMFwiKStcIjtcIil9O2Z1bmN0aW9uIFEoYSxiLGMsZCxlLGYpe3RoaXMuZz1hO3RoaXMuaj1iO3RoaXMuYT1kO3RoaXMuYz1jO3RoaXMuZj1lfHwzRTM7dGhpcy5oPWZ8fHZvaWQgMH1RLnByb3RvdHlwZS5zdGFydD1mdW5jdGlvbigpe3ZhciBhPXRoaXMuYy5tLmRvY3VtZW50LGI9dGhpcyxjPXEoKSxkPW5ldyBQcm9taXNlKGZ1bmN0aW9uKGQsZSl7ZnVuY3Rpb24gaygpe3EoKS1jPj1iLmY/ZSgpOmEuZm9udHMubG9hZChmYShiLmEpLGIuaCkudGhlbihmdW5jdGlvbihhKXsxPD1hLmxlbmd0aD9kKCk6c2V0VGltZW91dChrLDI1KX0sZnVuY3Rpb24oKXtlKCl9KX1rKCl9KSxlPW5ldyBQcm9taXNlKGZ1bmN0aW9uKGEsZCl7c2V0VGltZW91dChkLGIuZil9KTtQcm9taXNlLnJhY2UoW2UsZF0pLnRoZW4oZnVuY3Rpb24oKXtiLmcoYi5hKX0sZnVuY3Rpb24oKXtiLmooYi5hKX0pfTtmdW5jdGlvbiBSKGEsYixjLGQsZSxmLGcpe3RoaXMudj1hO3RoaXMuQj1iO3RoaXMuYz1jO3RoaXMuYT1kO3RoaXMucz1nfHxcIkJFU2Jzd3lcIjt0aGlzLmY9e307dGhpcy53PWV8fDNFMzt0aGlzLnU9Znx8bnVsbDt0aGlzLm89dGhpcy5qPXRoaXMuaD10aGlzLmc9bnVsbDt0aGlzLmc9bmV3IE4odGhpcy5jLHRoaXMucyk7dGhpcy5oPW5ldyBOKHRoaXMuYyx0aGlzLnMpO3RoaXMuaj1uZXcgTih0aGlzLmMsdGhpcy5zKTt0aGlzLm89bmV3IE4odGhpcy5jLHRoaXMucyk7YT1uZXcgSCh0aGlzLmEuYytcIixzZXJpZlwiLEsodGhpcy5hKSk7YT1QKGEpO3RoaXMuZy5hLnN0eWxlLmNzc1RleHQ9YTthPW5ldyBIKHRoaXMuYS5jK1wiLHNhbnMtc2VyaWZcIixLKHRoaXMuYSkpO2E9UChhKTt0aGlzLmguYS5zdHlsZS5jc3NUZXh0PWE7YT1uZXcgSChcInNlcmlmXCIsSyh0aGlzLmEpKTthPVAoYSk7dGhpcy5qLmEuc3R5bGUuY3NzVGV4dD1hO2E9bmV3IEgoXCJzYW5zLXNlcmlmXCIsSyh0aGlzLmEpKTthPVxuICAgIFAoYSk7dGhpcy5vLmEuc3R5bGUuY3NzVGV4dD1hO08odGhpcy5nKTtPKHRoaXMuaCk7Tyh0aGlzLmopO08odGhpcy5vKX12YXIgUz17RDpcInNlcmlmXCIsQzpcInNhbnMtc2VyaWZcIn0sVD1udWxsO2Z1bmN0aW9uIFUoKXtpZihudWxsPT09VCl7dmFyIGE9L0FwcGxlV2ViS2l0XFwvKFswLTldKykoPzpcXC4oWzAtOV0rKSkvLmV4ZWMod2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQpO1Q9ISFhJiYoNTM2PnBhcnNlSW50KGFbMV0sMTApfHw1MzY9PT1wYXJzZUludChhWzFdLDEwKSYmMTE+PXBhcnNlSW50KGFbMl0sMTApKX1yZXR1cm4gVH1SLnByb3RvdHlwZS5zdGFydD1mdW5jdGlvbigpe3RoaXMuZi5zZXJpZj10aGlzLmouYS5vZmZzZXRXaWR0aDt0aGlzLmZbXCJzYW5zLXNlcmlmXCJdPXRoaXMuby5hLm9mZnNldFdpZHRoO3RoaXMuQT1xKCk7bGEodGhpcyl9O1xuICBmdW5jdGlvbiBtYShhLGIsYyl7Zm9yKHZhciBkIGluIFMpaWYoUy5oYXNPd25Qcm9wZXJ0eShkKSYmYj09PWEuZltTW2RdXSYmYz09PWEuZltTW2RdXSlyZXR1cm4hMDtyZXR1cm4hMX1mdW5jdGlvbiBsYShhKXt2YXIgYj1hLmcuYS5vZmZzZXRXaWR0aCxjPWEuaC5hLm9mZnNldFdpZHRoLGQ7KGQ9Yj09PWEuZi5zZXJpZiYmYz09PWEuZltcInNhbnMtc2VyaWZcIl0pfHwoZD1VKCkmJm1hKGEsYixjKSk7ZD9xKCktYS5BPj1hLnc/VSgpJiZtYShhLGIsYykmJihudWxsPT09YS51fHxhLnUuaGFzT3duUHJvcGVydHkoYS5hLmMpKT9WKGEsYS52KTpWKGEsYS5CKTpuYShhKTpWKGEsYS52KX1mdW5jdGlvbiBuYShhKXtzZXRUaW1lb3V0KHAoZnVuY3Rpb24oKXtsYSh0aGlzKX0sYSksNTApfWZ1bmN0aW9uIFYoYSxiKXtzZXRUaW1lb3V0KHAoZnVuY3Rpb24oKXt2KHRoaXMuZy5hKTt2KHRoaXMuaC5hKTt2KHRoaXMuai5hKTt2KHRoaXMuby5hKTtiKHRoaXMuYSl9LGEpLDApfTtmdW5jdGlvbiBXKGEsYixjKXt0aGlzLmM9YTt0aGlzLmE9Yjt0aGlzLmY9MDt0aGlzLm89dGhpcy5qPSExO3RoaXMucz1jfXZhciBYPW51bGw7Vy5wcm90b3R5cGUuZz1mdW5jdGlvbihhKXt2YXIgYj10aGlzLmE7Yi5nJiZ3KGIuZixbYi5hLmMoXCJ3ZlwiLGEuYyxLKGEpLnRvU3RyaW5nKCksXCJhY3RpdmVcIildLFtiLmEuYyhcIndmXCIsYS5jLEsoYSkudG9TdHJpbmcoKSxcImxvYWRpbmdcIiksYi5hLmMoXCJ3ZlwiLGEuYyxLKGEpLnRvU3RyaW5nKCksXCJpbmFjdGl2ZVwiKV0pO0woYixcImZvbnRhY3RpdmVcIixhKTt0aGlzLm89ITA7b2EodGhpcyl9O1xuICBXLnByb3RvdHlwZS5oPWZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMuYTtpZihiLmcpe3ZhciBjPXkoYi5mLGIuYS5jKFwid2ZcIixhLmMsSyhhKS50b1N0cmluZygpLFwiYWN0aXZlXCIpKSxkPVtdLGU9W2IuYS5jKFwid2ZcIixhLmMsSyhhKS50b1N0cmluZygpLFwibG9hZGluZ1wiKV07Y3x8ZC5wdXNoKGIuYS5jKFwid2ZcIixhLmMsSyhhKS50b1N0cmluZygpLFwiaW5hY3RpdmVcIikpO3coYi5mLGQsZSl9TChiLFwiZm9udGluYWN0aXZlXCIsYSk7b2EodGhpcyl9O2Z1bmN0aW9uIG9hKGEpezA9PS0tYS5mJiZhLmomJihhLm8/KGE9YS5hLGEuZyYmdyhhLmYsW2EuYS5jKFwid2ZcIixcImFjdGl2ZVwiKV0sW2EuYS5jKFwid2ZcIixcImxvYWRpbmdcIiksYS5hLmMoXCJ3ZlwiLFwiaW5hY3RpdmVcIildKSxMKGEsXCJhY3RpdmVcIikpOk0oYS5hKSl9O2Z1bmN0aW9uIHBhKGEpe3RoaXMuaj1hO3RoaXMuYT1uZXcgamE7dGhpcy5oPTA7dGhpcy5mPXRoaXMuZz0hMH1wYS5wcm90b3R5cGUubG9hZD1mdW5jdGlvbihhKXt0aGlzLmM9bmV3IGNhKHRoaXMuaixhLmNvbnRleHR8fHRoaXMuaik7dGhpcy5nPSExIT09YS5ldmVudHM7dGhpcy5mPSExIT09YS5jbGFzc2VzO3FhKHRoaXMsbmV3IGhhKHRoaXMuYyxhKSxhKX07XG4gIGZ1bmN0aW9uIHJhKGEsYixjLGQsZSl7dmFyIGY9MD09LS1hLmg7KGEuZnx8YS5nKSYmc2V0VGltZW91dChmdW5jdGlvbigpe3ZhciBhPWV8fG51bGwsaz1kfHxudWxsfHx7fTtpZigwPT09Yy5sZW5ndGgmJmYpTShiLmEpO2Vsc2V7Yi5mKz1jLmxlbmd0aDtmJiYoYi5qPWYpO3ZhciBoLG09W107Zm9yKGg9MDtoPGMubGVuZ3RoO2grKyl7dmFyIGw9Y1toXSxuPWtbbC5jXSxyPWIuYSx4PWw7ci5nJiZ3KHIuZixbci5hLmMoXCJ3ZlwiLHguYyxLKHgpLnRvU3RyaW5nKCksXCJsb2FkaW5nXCIpXSk7TChyLFwiZm9udGxvYWRpbmdcIix4KTtyPW51bGw7bnVsbD09PVgmJihYPXdpbmRvdy5Gb250RmFjZT8oeD0vR2Vja28uKkZpcmVmb3hcXC8oXFxkKykvLmV4ZWMod2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQpKT80MjxwYXJzZUludCh4WzFdLDEwKTohMDohMSk7WD9yPW5ldyBRKHAoYi5nLGIpLHAoYi5oLGIpLGIuYyxsLGIucyxuKTpyPW5ldyBSKHAoYi5nLGIpLHAoYi5oLGIpLGIuYyxsLGIucyxhLFxuICAgIG4pO20ucHVzaChyKX1mb3IoaD0wO2g8bS5sZW5ndGg7aCsrKW1baF0uc3RhcnQoKX19LDApfWZ1bmN0aW9uIHFhKGEsYixjKXt2YXIgZD1bXSxlPWMudGltZW91dDtpYShiKTt2YXIgZD1rYShhLmEsYyxhLmMpLGY9bmV3IFcoYS5jLGIsZSk7YS5oPWQubGVuZ3RoO2I9MDtmb3IoYz1kLmxlbmd0aDtiPGM7YisrKWRbYl0ubG9hZChmdW5jdGlvbihiLGQsYyl7cmEoYSxmLGIsZCxjKX0pfTtmdW5jdGlvbiBzYShhLGIpe3RoaXMuYz1hO3RoaXMuYT1ifWZ1bmN0aW9uIHRhKGEsYixjKXt2YXIgZD16KGEuYyk7YT0oYS5hLmFwaXx8XCJmYXN0LmZvbnRzLm5ldC9qc2FwaVwiKS5yZXBsYWNlKC9eLipodHRwKHM/KTooXFwvXFwvKT8vLFwiXCIpO3JldHVybiBkK1wiLy9cIithK1wiL1wiK2IrXCIuanNcIisoYz9cIj92PVwiK2M6XCJcIil9XG4gIHNhLnByb3RvdHlwZS5sb2FkPWZ1bmN0aW9uKGEpe2Z1bmN0aW9uIGIoKXtpZihmW1wiX19tdGlfZm50THN0XCIrZF0pe3ZhciBjPWZbXCJfX210aV9mbnRMc3RcIitkXSgpLGU9W10saDtpZihjKWZvcih2YXIgbT0wO208Yy5sZW5ndGg7bSsrKXt2YXIgbD1jW21dLmZvbnRmYW1pbHk7dm9pZCAwIT1jW21dLmZvbnRTdHlsZSYmdm9pZCAwIT1jW21dLmZvbnRXZWlnaHQ/KGg9Y1ttXS5mb250U3R5bGUrY1ttXS5mb250V2VpZ2h0LGUucHVzaChuZXcgSChsLGgpKSk6ZS5wdXNoKG5ldyBIKGwpKX1hKGUpfWVsc2Ugc2V0VGltZW91dChmdW5jdGlvbigpe2IoKX0sNTApfXZhciBjPXRoaXMsZD1jLmEucHJvamVjdElkLGU9Yy5hLnZlcnNpb247aWYoZCl7dmFyIGY9Yy5jLm07Qih0aGlzLmMsdGEoYyxkLGUpLGZ1bmN0aW9uKGUpe2U/YShbXSk6KGZbXCJfX01vbm90eXBlQ29uZmlndXJhdGlvbl9fXCIrZF09ZnVuY3Rpb24oKXtyZXR1cm4gYy5hfSxiKCkpfSkuaWQ9XCJfX01vbm90eXBlQVBJU2NyaXB0X19cIitcbiAgICBkfWVsc2UgYShbXSl9O2Z1bmN0aW9uIHVhKGEsYil7dGhpcy5jPWE7dGhpcy5hPWJ9dWEucHJvdG90eXBlLmxvYWQ9ZnVuY3Rpb24oYSl7dmFyIGIsYyxkPXRoaXMuYS51cmxzfHxbXSxlPXRoaXMuYS5mYW1pbGllc3x8W10sZj10aGlzLmEudGVzdFN0cmluZ3N8fHt9LGc9bmV3IEM7Yj0wO2ZvcihjPWQubGVuZ3RoO2I8YztiKyspQSh0aGlzLmMsZFtiXSxEKGcpKTt2YXIgaz1bXTtiPTA7Zm9yKGM9ZS5sZW5ndGg7YjxjO2IrKylpZihkPWVbYl0uc3BsaXQoXCI6XCIpLGRbMV0pZm9yKHZhciBoPWRbMV0uc3BsaXQoXCIsXCIpLG09MDttPGgubGVuZ3RoO20rPTEpay5wdXNoKG5ldyBIKGRbMF0saFttXSkpO2Vsc2Ugay5wdXNoKG5ldyBIKGRbMF0pKTtGKGcsZnVuY3Rpb24oKXthKGssZil9KX07ZnVuY3Rpb24gdmEoYSxiLGMpe2E/dGhpcy5jPWE6dGhpcy5jPWIrd2E7dGhpcy5hPVtdO3RoaXMuZj1bXTt0aGlzLmc9Y3x8XCJcIn12YXIgd2E9XCIvL2ZvbnRzLmdvb2dsZWFwaXMuY29tL2Nzc1wiO2Z1bmN0aW9uIHhhKGEsYil7Zm9yKHZhciBjPWIubGVuZ3RoLGQ9MDtkPGM7ZCsrKXt2YXIgZT1iW2RdLnNwbGl0KFwiOlwiKTszPT1lLmxlbmd0aCYmYS5mLnB1c2goZS5wb3AoKSk7dmFyIGY9XCJcIjsyPT1lLmxlbmd0aCYmXCJcIiE9ZVsxXSYmKGY9XCI6XCIpO2EuYS5wdXNoKGUuam9pbihmKSl9fVxuICBmdW5jdGlvbiB5YShhKXtpZigwPT1hLmEubGVuZ3RoKXRocm93IEVycm9yKFwiTm8gZm9udHMgdG8gbG9hZCFcIik7aWYoLTEhPWEuYy5pbmRleE9mKFwia2l0PVwiKSlyZXR1cm4gYS5jO2Zvcih2YXIgYj1hLmEubGVuZ3RoLGM9W10sZD0wO2Q8YjtkKyspYy5wdXNoKGEuYVtkXS5yZXBsYWNlKC8gL2csXCIrXCIpKTtiPWEuYytcIj9mYW1pbHk9XCIrYy5qb2luKFwiJTdDXCIpOzA8YS5mLmxlbmd0aCYmKGIrPVwiJnN1YnNldD1cIithLmYuam9pbihcIixcIikpOzA8YS5nLmxlbmd0aCYmKGIrPVwiJnRleHQ9XCIrZW5jb2RlVVJJQ29tcG9uZW50KGEuZykpO3JldHVybiBifTtmdW5jdGlvbiB6YShhKXt0aGlzLmY9YTt0aGlzLmE9W107dGhpcy5jPXt9fVxuICB2YXIgQWE9e2xhdGluOlwiQkVTYnN3eVwiLFwibGF0aW4tZXh0XCI6XCJcXHUwMGU3XFx1MDBmNlxcdTAwZmNcXHUwMTFmXFx1MDE1ZlwiLGN5cmlsbGljOlwiXFx1MDQzOVxcdTA0NGZcXHUwNDE2XCIsZ3JlZWs6XCJcXHUwM2IxXFx1MDNiMlxcdTAzYTNcIixraG1lcjpcIlxcdTE3ODBcXHUxNzgxXFx1MTc4MlwiLEhhbnVtYW46XCJcXHUxNzgwXFx1MTc4MVxcdTE3ODJcIn0sQmE9e3RoaW46XCIxXCIsZXh0cmFsaWdodDpcIjJcIixcImV4dHJhLWxpZ2h0XCI6XCIyXCIsdWx0cmFsaWdodDpcIjJcIixcInVsdHJhLWxpZ2h0XCI6XCIyXCIsbGlnaHQ6XCIzXCIscmVndWxhcjpcIjRcIixib29rOlwiNFwiLG1lZGl1bTpcIjVcIixcInNlbWktYm9sZFwiOlwiNlwiLHNlbWlib2xkOlwiNlwiLFwiZGVtaS1ib2xkXCI6XCI2XCIsZGVtaWJvbGQ6XCI2XCIsYm9sZDpcIjdcIixcImV4dHJhLWJvbGRcIjpcIjhcIixleHRyYWJvbGQ6XCI4XCIsXCJ1bHRyYS1ib2xkXCI6XCI4XCIsdWx0cmFib2xkOlwiOFwiLGJsYWNrOlwiOVwiLGhlYXZ5OlwiOVwiLGw6XCIzXCIscjpcIjRcIixiOlwiN1wifSxDYT17aTpcImlcIixpdGFsaWM6XCJpXCIsbjpcIm5cIixub3JtYWw6XCJuXCJ9LFxuICAgIERhPS9eKHRoaW58KD86KD86ZXh0cmF8dWx0cmEpLT8pP2xpZ2h0fHJlZ3VsYXJ8Ym9va3xtZWRpdW18KD86KD86c2VtaXxkZW1pfGV4dHJhfHVsdHJhKS0/KT9ib2xkfGJsYWNrfGhlYXZ5fGx8cnxifFsxLTldMDApPyhufGl8bm9ybWFsfGl0YWxpYyk/JC87XG4gIGZ1bmN0aW9uIEVhKGEpe2Zvcih2YXIgYj1hLmYubGVuZ3RoLGM9MDtjPGI7YysrKXt2YXIgZD1hLmZbY10uc3BsaXQoXCI6XCIpLGU9ZFswXS5yZXBsYWNlKC9cXCsvZyxcIiBcIiksZj1bXCJuNFwiXTtpZigyPD1kLmxlbmd0aCl7dmFyIGc7dmFyIGs9ZFsxXTtnPVtdO2lmKGspZm9yKHZhciBrPWsuc3BsaXQoXCIsXCIpLGg9ay5sZW5ndGgsbT0wO208aDttKyspe3ZhciBsO2w9a1ttXTtpZihsLm1hdGNoKC9eW1xcdy1dKyQvKSl7dmFyIG49RGEuZXhlYyhsLnRvTG93ZXJDYXNlKCkpO2lmKG51bGw9PW4pbD1cIlwiO2Vsc2V7bD1uWzJdO2w9bnVsbD09bHx8XCJcIj09bD9cIm5cIjpDYVtsXTtuPW5bMV07aWYobnVsbD09bnx8XCJcIj09biluPVwiNFwiO2Vsc2UgdmFyIHI9QmFbbl0sbj1yP3I6aXNOYU4obik/XCI0XCI6bi5zdWJzdHIoMCwxKTtsPVtsLG5dLmpvaW4oXCJcIil9fWVsc2UgbD1cIlwiO2wmJmcucHVzaChsKX0wPGcubGVuZ3RoJiYoZj1nKTszPT1kLmxlbmd0aCYmKGQ9ZFsyXSxnPVtdLGQ9ZD9kLnNwbGl0KFwiLFwiKTpcbiAgICBnLDA8ZC5sZW5ndGgmJihkPUFhW2RbMF1dKSYmKGEuY1tlXT1kKSl9YS5jW2VdfHwoZD1BYVtlXSkmJihhLmNbZV09ZCk7Zm9yKGQ9MDtkPGYubGVuZ3RoO2QrPTEpYS5hLnB1c2gobmV3IEgoZSxmW2RdKSl9fTtmdW5jdGlvbiBGYShhLGIpe3RoaXMuYz1hO3RoaXMuYT1ifXZhciBHYT17QXJpbW86ITAsQ291c2luZTohMCxUaW5vczohMH07RmEucHJvdG90eXBlLmxvYWQ9ZnVuY3Rpb24oYSl7dmFyIGI9bmV3IEMsYz10aGlzLmMsZD1uZXcgdmEodGhpcy5hLmFwaSx6KGMpLHRoaXMuYS50ZXh0KSxlPXRoaXMuYS5mYW1pbGllczt4YShkLGUpO3ZhciBmPW5ldyB6YShlKTtFYShmKTtBKGMseWEoZCksRChiKSk7RihiLGZ1bmN0aW9uKCl7YShmLmEsZi5jLEdhKX0pfTtmdW5jdGlvbiBIYShhLGIpe3RoaXMuYz1hO3RoaXMuYT1ifUhhLnByb3RvdHlwZS5sb2FkPWZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMuYS5pZCxjPXRoaXMuYy5tO2I/Qih0aGlzLmMsKHRoaXMuYS5hcGl8fFwiaHR0cHM6Ly91c2UudHlwZWtpdC5uZXRcIikrXCIvXCIrYitcIi5qc1wiLGZ1bmN0aW9uKGIpe2lmKGIpYShbXSk7ZWxzZSBpZihjLlR5cGVraXQmJmMuVHlwZWtpdC5jb25maWcmJmMuVHlwZWtpdC5jb25maWcuZm4pe2I9Yy5UeXBla2l0LmNvbmZpZy5mbjtmb3IodmFyIGU9W10sZj0wO2Y8Yi5sZW5ndGg7Zis9Milmb3IodmFyIGc9YltmXSxrPWJbZisxXSxoPTA7aDxrLmxlbmd0aDtoKyspZS5wdXNoKG5ldyBIKGcsa1toXSkpO3RyeXtjLlR5cGVraXQubG9hZCh7ZXZlbnRzOiExLGNsYXNzZXM6ITEsYXN5bmM6ITB9KX1jYXRjaChtKXt9YShlKX19LDJFMyk6YShbXSl9O2Z1bmN0aW9uIElhKGEsYil7dGhpcy5jPWE7dGhpcy5mPWI7dGhpcy5hPVtdfUlhLnByb3RvdHlwZS5sb2FkPWZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMuZi5pZCxjPXRoaXMuYy5tLGQ9dGhpcztiPyhjLl9fd2ViZm9udGZvbnRkZWNrbW9kdWxlX198fChjLl9fd2ViZm9udGZvbnRkZWNrbW9kdWxlX189e30pLGMuX193ZWJmb250Zm9udGRlY2ttb2R1bGVfX1tiXT1mdW5jdGlvbihiLGMpe2Zvcih2YXIgZz0wLGs9Yy5mb250cy5sZW5ndGg7ZzxrOysrZyl7dmFyIGg9Yy5mb250c1tnXTtkLmEucHVzaChuZXcgSChoLm5hbWUsZ2EoXCJmb250LXdlaWdodDpcIitoLndlaWdodCtcIjtmb250LXN0eWxlOlwiK2guc3R5bGUpKSl9YShkLmEpfSxCKHRoaXMuYyx6KHRoaXMuYykrKHRoaXMuZi5hcGl8fFwiLy9mLmZvbnRkZWNrLmNvbS9zL2Nzcy9qcy9cIikrZWEodGhpcy5jKStcIi9cIitiK1wiLmpzXCIsZnVuY3Rpb24oYil7YiYmYShbXSl9KSk6YShbXSl9O3ZhciBZPW5ldyBwYSh3aW5kb3cpO1kuYS5jLmN1c3RvbT1mdW5jdGlvbihhLGIpe3JldHVybiBuZXcgdWEoYixhKX07WS5hLmMuZm9udGRlY2s9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gbmV3IElhKGIsYSl9O1kuYS5jLm1vbm90eXBlPWZ1bmN0aW9uKGEsYil7cmV0dXJuIG5ldyBzYShiLGEpfTtZLmEuYy50eXBla2l0PWZ1bmN0aW9uKGEsYil7cmV0dXJuIG5ldyBIYShiLGEpfTtZLmEuYy5nb29nbGU9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gbmV3IEZhKGIsYSl9O3ZhciBaPXtsb2FkOnAoWS5sb2FkLFkpfTtcImZ1bmN0aW9uXCI9PT10eXBlb2YgZGVmaW5lJiZkZWZpbmUuYW1kP2RlZmluZShmdW5jdGlvbigpe3JldHVybiBafSk6XCJ1bmRlZmluZWRcIiE9PXR5cGVvZiBtb2R1bGUmJm1vZHVsZS5leHBvcnRzP21vZHVsZS5leHBvcnRzPVo6KHdpbmRvdy5XZWJGb250PVosd2luZG93LldlYkZvbnRDb25maWcmJlkubG9hZCh3aW5kb3cuV2ViRm9udENvbmZpZykpO30oKSk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gcGx1Z2lucy93ZWJmb250LmpzIiwiXG4vKlxuZXhwb3J0IGludGVyZmFjZSBHYWxsZXJ5RGF0YSA6IHtcbiB0YXJnZXQ6IGZhYnJpY2pzIG9iamVjdFxufVxuKi9cblxuXG5mYWJyaWMuQXBwbGljYXRpb24ucHJvdG90eXBlLnNldEVsZW1lbnRGcm9tTWVudSA9IGZ1bmN0aW9uIChzZWxlY3RlZERhdGEpIHtcbiAgdGhpcy5jYW52YXMuY3JlYXRlSW1hZ2VPYmplY3Qoc2VsZWN0ZWREYXRhLmltYWdlLCB0aGlzLnVwbG9hZENsYXNzKTtcbn07XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLkFwcGxpY2F0aW9uLnByb3RvdHlwZSwge1xuICBkcmFnZ2FibGVBcmVhOiBcIi5mZi1jb250YWluZXJcIixcbiAgLypjcmVhdGVHYWxsZXJ5OiBmdW5jdGlvbiAodGFyZ2V0LCAkZWwsIG9wdGlvbnMpIHtcbiAgICBpZiAoJGVsLmNvbnN0cnVjdG9yID09PSBTdHJpbmcpIHtcbiAgICAgICRlbCA9ICQoXCIjXCIgKyAkZWwpO1xuICAgIH1cbiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcblxuICAgIGlmICh0YXJnZXQuZ2FsbGVyeUNhdGVnb3J5KSB7XG4gICAgICBvcHRpb25zLmNhdGVnb3J5ID0gdGFyZ2V0LmdhbGxlcnlDYXRlZ29yeTtcbiAgICB9XG5cbiAgICAkZWwuZW1wdHkoKTtcbiAgICB2YXIgbGlicmFyeSA9IHRoaXMuZ2V0TGlicmFyeUVsZW1lbnRzKG9wdGlvbnMpO1xuXG5cbiAgICB0aGlzLmNyZWF0ZUVsZW1lbnRzTGlzdCgkZWwsIGxpYnJhcnkpO1xuXG4gICAgXy5lYWNoKGxpYnJhcnksIGZ1bmN0aW9uIChsaWJyYXJ5SXRlbSkge1xuICAgICAgdmFyIGltZyA9IG5ldyBJbWFnZSgpO1xuICAgICAgaW1nLnNyYyA9IGZhYnJpYy51dGlsLm1lZGlhUm9vdCArIGxpYnJhcnlJdGVtLnNyYztcblxuICAgICAgdmFyICRpbWcgPSAkKGltZykud2lkdGgoMTAwKS5oZWlnaHQoMTAwKVxuICAgICAgICAuY2xpY2soZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgdmFyIHNlbGVjdGVkRGF0YSA9IHtcbiAgICAgICAgICAgIGltYWdlOiBpbWcsXG4gICAgICAgICAgICBkYXRhOiBsaWJyYXJ5SXRlbSxcbiAgICAgICAgICAgIG9wdGlvbnM6IG9wdGlvbnNcbiAgICAgICAgICB9O1xuICAgICAgICAgIHRhcmdldC5zZXRFbGVtZW50RnJvbU1lbnUoc2VsZWN0ZWREYXRhKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICRlbC5hcHBlbmQoJGltZyk7XG4gICAgfSk7XG4gIH0sKi9cbiAgZ2V0Rm9udHNMaWJyYXJ5OiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIF8ubWFwKHRoaXMuX2ZvbnRzLGZ1bmN0aW9uKGZvbnROYW1lKXtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGZvbnRGYW1pbHk6IGZvbnROYW1lLFxuICAgICAgICBmb250U2l6ZTogMjUsXG4gICAgICAgIGNhdGVnb3J5OiBcImZvbnRGYW1pbHlcIixcbiAgICAgICAgdGV4dDogZm9udE5hbWUsXG4gICAgICAgIHR5cGU6IFwidGV4dFwiXG4gICAgICB9XG4gICAgfSlcbiAgfSxcbiAgX2FkZENhbnZhc0VsOiBmdW5jdGlvbiAoZWwsIGVsZW1lbnQsJGlubmVyRWwpe1xuXG4gICAgLy8gZWxlbWVudCA9IGZhYnJpYy51dGlsLm9iamVjdC5jbG9uZURlZXAoZWxlbWVudCk7XG5cbiAgICB2YXIgY2FudmFzRWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpO1xuICAgIGNhbnZhc0VsLndpZHRoID0gMTU2O1xuICAgIGNhbnZhc0VsLmhlaWdodCA9IDg2O1xuXG4gICAgdmFyIF9mYWtlX2NhbnZhcyA9IG5ldyBmYWJyaWMuU3RhdGljQ2FudmFzKGNhbnZhc0VsLHthcHBsaWNhdGlvbjogdGhpc30pO1xuICAgIF9mYWtlX2NhbnZhcy5jbGVhcigpO1xuXG4gICAgZWxlbWVudC5wb3NpdGlvbiA9IFwiY2VudGVyXCI7XG5cbiAgICBfZmFrZV9jYW52YXMuY3JlYXRlT2JqZWN0KGVsZW1lbnQsZnVuY3Rpb24oX29iamVjdCl7XG4gICAgICB2YXIgYiA9IF9vYmplY3QuZ2V0Qm91bmRpbmdSZWN0KCk7XG4gICAgIC8qIF9vYmplY3Quc2V0KHtcbiAgICAgICAgbGVmdCA6IDgwIC0gYi53aWR0aC8yIC0gX29iamVjdC5zdHJva2VXaWR0aCAqIDIsXG4gICAgICAgIHRvcCA6IDQ1IC0gYi5oZWlnaHQvMiAtIF9vYmplY3Quc3Ryb2tlV2lkdGggKiAyXG4gICAgICB9KTsqL1xuXG4gICAgICBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGVsZW1lbnQse1xuICAgICAgICBzY2FsZVg6IF9vYmplY3Quc2NhbGVYLFxuICAgICAgICBzY2FsZVk6IF9vYmplY3Quc2NhbGVZLFxuICAgICAgICB3aWR0aDogX29iamVjdC53aWR0aCxcbiAgICAgICAgaGVpZ2h0OiBfb2JqZWN0LmhlaWdodCxcbiAgICAgICAgbGVmdDogX29iamVjdC5sZWZ0LFxuICAgICAgICB0b3A6IF9vYmplY3QudG9wLFxuICAgICAgICBzdHJva2VXaWR0aDogX29iamVjdC5zdHJva2VXaWR0aFxuICAgICAgfSk7XG5cbiAgICAgIGRlbGV0ZSBlbGVtZW50LnBvc2l0aW9uO1xuXG4gICAgICBfZmFrZV9jYW52YXMuYWRkKF9vYmplY3QpO1xuICAgICAgX2Zha2VfY2FudmFzLnJlbmRlckFsbCgpO1xuXG4gICAgICAkaW5uZXJFbFswXS5zcmMgPSBjYW52YXNFbC50b0RhdGFVUkwoKTtcblxuICAgICAgZGVsZXRlIF9vYmplY3QuY2FudmFzO1xuICAgICAgZWxbMF0uZGF0YSA9IGVsZW1lbnQ7XG4gICAgICBlbFswXS5lbGVtZW50ID0gX29iamVjdDtcblxuICAgIH0pO1xuICB9LFxuICB1cGRhdGVFbGVtZW50c0xpc3Q6IGZ1bmN0aW9uICgkZWwsIGxpYnJhcnksIG9wdGlvbnMpIHtcblxuICAgIHZhciBhcHAgPSB0aGlzO1xuICAgIGZvciAodmFyIGkgaW4gbGlicmFyeSkge1xuICAgICAgdmFyIGVsZW1lbnQgPSBsaWJyYXJ5W2ldO1xuICAgICAgdmFyIGVsID0gJChcIjxzcGFuPlwiKVxuICAgICAgICAuYWRkQ2xhc3MoXCJsaXN0LWl0ZW1cIik7XG5cbiAgICAgIGVsWzBdLmRhdGEgPSBlbGVtZW50O1xuXG4gICAgICBpZiAob3B0aW9ucy5lbGVtZW50KSB7XG4gICAgICAgIGVsZW1lbnQgPSBvcHRpb25zLmVsZW1lbnQoZWxlbWVudCk7XG4gICAgICB9XG5cbiAgICAgIGlmIChlbGVtZW50LnRpdGxlKSB7XG4gICAgICAgIHZhciAkc3BhbiA9ICQoXCI8c3Bhbj5cIikudGV4dChlbGVtZW50LnRpdGxlKS5hZGRDbGFzcyhcImVsZW1lbnQtdGl0bGVcIik7XG4gICAgICAgIGVsLmFwcGVuZCgkc3Bhbik7XG4gICAgICB9XG4gICAgICB2YXIgJGlubmVyRWwgPSBudWxsO1xuXG4gICAgICBpZiAob3B0aW9ucy5yZW5kZXIpIHtcbiAgICAgICAgJGlubmVyRWwgPSBvcHRpb25zLnJlbmRlcihlbGVtZW50KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChlbGVtZW50LmNhdGVnb3J5ID09IFwiZm9udEZhbWlseVwiKSB7XG4gICAgICAgICAgJGlubmVyRWwgPSAkKFwiPHNwYW4+XCIpLmNzcyh7XG4gICAgICAgICAgICBcImNvbG9yXCI6IGVsZW1lbnQuZmlsbCB8fCBmYWJyaWMuVGV4dC5wcm90b3R5cGUuZmlsbCxcbiAgICAgICAgICAgIFwiZm9udC1mYW1pbHlcIjogZWxlbWVudC5mb250RmFtaWx5LFxuICAgICAgICAgICAgXCJmb250LXNpemVcIjogZWxlbWVudC5mb250U2l6ZVxuICAgICAgICAgIH0pLnRleHQoZWxlbWVudC50ZXh0KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBzd2l0Y2ggKGVsZW1lbnQudHlwZSkge1xuICAgICAgICAgICAgY2FzZSBcImltYWdlXCI6XG4gICAgICAgICAgICAgICRpbm5lckVsID0gJChcIjxpbWc+XCIpLmF0dHIoe1xuICAgICAgICAgICAgICAgIHNyYzogZmFicmljLnV0aWwubWVkaWFSb290ICsgZWxlbWVudC5zcmNcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIGVsWzBdLmVsZW1lbnQgPSAkaW5uZXJFbFswXTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwidmlkZW9cIjpcbiAgICAgICAgICAgICAgJGlubmVyRWwgPSAkKFwiPHZpZGVvPlwiKTtcbiAgICAgICAgICAgICAgZm9yICh2YXIgdHlwZSBpbiBlbGVtZW50LnNyYykge1xuICAgICAgICAgICAgICAgICRpbm5lckVsLmFwcGVuZCgkKFwiPHNvdXJjZT5cIikuYXR0cih7XG4gICAgICAgICAgICAgICAgICBzcmM6IGZhYnJpYy51dGlsLm1lZGlhUm9vdCArIGVsZW1lbnQuc3JjW3R5cGVdLFxuICAgICAgICAgICAgICAgICAgdHlwZTogdHlwZVxuICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBlbFswXS5lbGVtZW50ID0gJGlubmVyRWxbMF07XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgJGlubmVyRWwgPSAkKFwiPGltZyB3aWR0aD0xNjAgaGVpZ2h0PTkwPlwiKTtcbiAgICAgICAgICAgICAgdGhpcy5fYWRkQ2FudmFzRWwoZWwsIGVsZW1lbnQsICRpbm5lckVsKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmICgkaW5uZXJFbC5jb25zdHJ1Y3RvciA9PSBBcnJheSkge1xuICAgICAgICB2YXIgX3NwYW4gPSAkKFwiPHNwYW4+XCIpO1xuICAgICAgICBfc3Bhbi5hcHBlbmQoJGlubmVyRWwpO1xuICAgICAgICAkaW5uZXJFbCA9IF9zcGFuO1xuICAgICAgfVxuICAgICAgZWwuYXBwZW5kKCRpbm5lckVsKTtcblxuXG4gICAgICBpZiAob3B0aW9ucy5kcmFnZ2FibGUpIHtcbiAgICAgICAgJGlubmVyRWwuZHJhZ2dhYmxlKHtcbiAgICAgICAgICBkcmFnZ2FibGU6IFwiaGVscGVyXCIsXG4gICAgICAgICAgZHJvcHBhYmxlOiBcIi5jYW52YXMtY29udGFpbmVyXCIsXG4gICAgICAgICAgbmdNb2RlbDogZWxlbWVudCxcbiAgICAgICAgICBvbk1vdmU6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBhcHAuY2FudmFzLl9vbkRyYWdNb3ZlICYmIGFwcC5jYW52YXMuX29uRHJhZ01vdmUoZGF0YS4kZXZlbnQpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgb25Ecm9wOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgYXBwLmNhbnZhcy5fb25Ecm9wKGRhdGEuJGV2ZW50KTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGRyYWdnYWJsZUFyZWE6IGFwcC5kcmFnZ2FibGVBcmVhXG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgICAkaW5uZXJFbC5jbGljayhvcHRpb25zLmFjdGl2YXRlLmJpbmQodGhpcywgZWxbMF0pKTtcbiAgICAgICRlbC5hcHBlbmQoZWwpO1xuICAgIH1cbiAgfSxcbiAgY3JlYXRlRWxlbWVudHNMaXN0OiBmdW5jdGlvbiAoJGVsLCBsaWJyYXJ5LCBvcHRpb25zKSB7XG4gICAgb3B0aW9ucyA9IGZhYnJpYy51dGlsLm9iamVjdC5kZWZhdWx0cyhvcHRpb25zIHx8IHt9LCB7XG4gICAgICBkcmFnZ2FibGU6IHRydWUsXG4gICAgICBhY3RpdmF0ZTogZnVuY3Rpb24gKGVsKSB7XG4gICAgICAgIGlmICh0aGlzLmNhbnZhcy50YXJnZXQgJiYgdGhpcy5jYW52YXMudGFyZ2V0LnNldERhdGEpIHtcbiAgICAgICAgICB0aGlzLmNhbnZhcy50YXJnZXQuc2V0RGF0YShlbC5kYXRhKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLmNhbnZhcy5zZXREYXRhKGVsLmRhdGEpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gICAgdGhpcy51cGRhdGVFbGVtZW50c0xpc3QoJGVsLCBsaWJyYXJ5LCBvcHRpb25zKTtcbiAgfVxufSk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL21vZHVsZXMvZ2FsbGVyeS5qcyIsIid1c2Ugc3RyaWN0JztcblxuZmFicmljLm9iamVjdHNMaWJyYXJ5ID0ge1xuICB0ZXh0OiB7XG4gICAgdGl0bGU6IFwiVGV4dFwiLFxuICAgIHR5cGU6IFwiaS10ZXh0XCIsXG4gICAgdGV4dDogXCLQotC10LrRgdGCXCJcbiAgfSxcbiAgbGluZToge1xuICAgIHR5cGU6IFwibGluZVwiLFxuICAgIHN0cm9rZVdpZHRoOiA1LFxuICAgIHN0cm9rZTogXCJibGFja1wiLFxuICAgIHNjYWxlWDogMSxcbiAgICBzY2FsZVk6IDEsXG4gICAgeDE6IDAsXG4gICAgeDI6IDEwMCxcbiAgICB5MTogMCxcbiAgICB5MjogNTBcbiAgfSxcbiAgdHJpYW5nbGU6IHtcbiAgICB0eXBlOiBcInRyaWFuZ2xlXCIsXG4gICAgd2lkdGg6IGZ1bmN0aW9uKHcsaCl7IHJldHVybiBNYXRoLm1pbih3LGgpIC0gNH0sXG4gICAgaGVpZ2h0OiBmdW5jdGlvbih3LGgpeyByZXR1cm4gTWF0aC5taW4odyxoKSAtIDR9XG4gIH0sXG4gIHJlY3RhbmdsZToge1xuICAgIHR5cGU6IFwicmVjdFwiLFxuICAgIHdpZHRoOiBmdW5jdGlvbih3LGgpeyByZXR1cm4gTWF0aC5taW4odyxoKSAtIDR9LFxuICAgIGhlaWdodDogZnVuY3Rpb24odyxoKXsgcmV0dXJuIE1hdGgubWluKHcsaCkgLSA0fVxuICB9LFxuICBwb2x5Z29uOiB7XG4gICAgc2NhbGVYOiAxLFxuICAgIHNjYWxlWTogMSxcbiAgICB0eXBlOiBcInBvbHlnb25cIixcbiAgICBwb2ludHM6IGZ1bmN0aW9uKHcsaCkge1xuICAgICAgcmV0dXJuIFtcbiAgICAgICAge3g6IDI1LCB5OiAxfSxcbiAgICAgICAge3g6IDMxLCB5OiAxOH0sXG4gICAgICAgIHt4OiA0OSwgeTogMTh9LFxuICAgICAgICB7eDogMzUsIHk6IDI5fSxcbiAgICAgICAge3g6IDQwLCB5OiA0Nn0sXG4gICAgICAgIHt4OiAyNSwgeTogMzZ9LFxuICAgICAgICB7eDogMTAsIHk6IDQ2fSxcbiAgICAgICAge3g6IDE1LCB5OiAyOX0sXG4gICAgICAgIHt4OiAgMSwgeTogMTh9LFxuICAgICAgICB7eDogMTksIHk6IDE4fVxuICAgICAgXTtcbiAgICB9XG4gIH0sXG4gIHBhdGg6IHtcbiAgICBcInR5cGVcIjogXCJwYXRoXCIsXG4gICAgXCJwYXRoXCI6ICBcIm01ODEuMDc3OTQyLDIuNTM3MzU5Yy0yLjA1MzIyMywwLjA0NzA3MSAtNC4wNDA3MSwwLjE4ODM0OCAtNi4xMDgwOTMsMC4zNTI5MDdjLTMzLjA1NTQyLDIuNjYzOTE4IC02Mi4yMzU5MDEsMTkuNjQwNTQxIC03Ny4wNTc2NzgsNDQuOTI1OTUzbC03Ljg1NzMsMTkuMTM1MzE5YzEuNjk4ODIyLC02LjYzMzE0NCA0LjMwMjk3OSwtMTMuMDY1Mzg0IDcuODU3MywtMTkuMTM1MzE5Yy0yNi40MzA2OTUsLTIyLjE2MjkzIC02My41MzE2NzcsLTMyLjM4ODQ0NSAtMTAwLjE5MjM4MywtMjcuNTc0MzczYy0zNi42NjE0NjksNC43ODgzNTMgLTY4LjUwMzA4MiwyNC4wNDE3NTggLTg1LjkwMTk3OCw1MS45MzUyMjVjLTQ5LjExNjQ4NiwtMjQuNDkwMDEzIC0xMTAuMzQyODgsLTIyLjk5OTQ1NCAtMTU3LjcxMTgwNywzLjg2MDA5MmMtNDcuMzY5MTY0LDI2Ljg2MDY4IC03Mi42MTY3Myw3NC40MDU1MSAtNjQuOTQxMTYyLDEyMi4zODMwOGw1LjAyMTM1NSwxOS40OTk2OGMtMi4yNjMzMjksLTYuMzg1MDEgLTMuOTYwNzkzLC0xMi44ODc2OTUgLTUuMDIxMzU1LC0xOS40OTk2OGwtMC43NjE5NDgsMS43OTg1NjljLTQxLjE3OTE2NSwzLjYyNTI0NCAtNzQuOTQ1Mzc1LDI5LjQ2NTEzNCAtODMuNzE2Mzk4LDY0LjA1OTIzNWMtOC43NzE4MDUsMzQuNTk3NzQ4IDkuNDY3MDEsNzAuMDg1ODc2IDQ1LjE4NTYyMSw4Ny45NjcwMWw1NS43NzY1NTgsMTAuOTczMTE0Yy0xOS40ODAyMTcsMS4yOTE5NjIgLTM4LjkxNTU0MywtMi41MzQ1MTUgLTU1Ljc3NjU1OCwtMTAuOTczMTE0Yy0yNy41NDc4LDI0Ljk2ODE3IC0zMy44ODg1MTYsNjEuOTM1MzAzIC0xNS43MTQ5Miw5Mi40Njc4MzRjMTguMTczNzMzLDMwLjUyNDcxOSA1Ni45ODg4OTksNDguMTEwNjg3IDk3LjAzMDQ1Nyw0NC4xMTczNGwyNC4zMzk3MjIsLTUuMjExMDljLTcuODI3NDk5LDIuNjUxNjExIC0xNS45NjA5ODMsNC4zNzkwNTkgLTI0LjMzOTcyMiw1LjIxMTA5YzIyLjczMDA0MiwzMy44NTcyNjkgNjAuNDI4MTkyLDU4LjU1NjI0NCAxMDQuNjY4OTMsNjguMzgzNTE0YzQ0LjI0OTEsOS44MTM2NiA5MS4yNDA5NTIsNC4wMTQ3NzEgMTMwLjQyNTk0OSwtMTYuMDk0NjA0YzMxLjk2NzAxLDQwLjc5MzgyMyA4OC43MDc2NDIsNjIuMjE3NDY4IDE0NS41OTYzMTMsNTQuOTk3MDdjNTYuOTAyNDY2LC03LjIxOTY2NiAxMDMuODMzOTg0LC00MS44MTQyNyAxMjAuNTAxMzQzLC04OC43NzA5OTZsNS43ODE0MzMsLTI2LjIzOTUzMmMtMC44NjM3MDgsOC45MDk1NDYgLTIuNzQyMjQ5LDE3LjY4MTM2NiAtNS43ODE0MzMsMjYuMjM5NTMyYzM5LjEzMzMwMSwyMC43NTM2NjIgODguMzUzMzMzLDIxLjkyNzMwNyAxMjguNzg1MDk1LDMuMDQ5MzE2YzQwLjQzOTgxOSwtMTguODc0MDg0IDY1LjY2NTc3MSwtNTQuODY5MDQ5IDY2LjAzNjEzMywtOTQuMDc4MjQ3bC0xNC40OTU2MDUsLTU4LjU4MDU5N2wtNTcuMTA1NzEzLC0zOS42MzA3NjhjNDQuMTYzNDUyLDIyLjM3NDU3MyA3MS45OTI2MTUsNTYuNDY3MjU1IDcxLjYwMTMxOCw5OC4yMTEzNjVjNTIuNDk3MDcsMC40NDgxODEgOTcuMTAzMzk0LC0zNS45NTY1NzMgMTE3LjExMjQyNywtNzcuNzI2Mjg4YzIwLjAxMTU5NywtNDEuNzY5ODM2IDEyLjQ0MzYwNCwtODkuMzk2NzU5IC0xOS44NjQ5MjksLTEyNS4xNjQ2NDJjMTMuNDAxMTg0LC0yNi42Mzc2OTUgMTIuNjA5OTg1LC01Ni45MzczMzIgLTIuMTgzNDcyLC04My4wMzQwODhjLTE0Ljc4NjE5NCwtMjYuMDk3ODkzIC00Mi4wNjU0OTEsLTQ1LjQ3Njg5MSAtNzQuODczMDQ3LC01My4wOTgzMzVjLTcuMzQxNDMxLC0zNC41ODA5MjkgLTM3LjYwMjY2MSwtNjIuNDA0NDgyIC03Ny42MDA3MDgsLTcxLjUyNjI5M2MtMzkuOTk4NDc0LC05LjEyMTM2OCAtODIuNTg0ODM5LDIuMTIzOTkyIC0xMDkuMzY0ODA3LDI4LjkyNjEyM2wtMTYuMjU4MTc5LDIyLjE5ODE3YzQuMTU3OTU5LC04LjAxODYxMiA5LjU4MzkyMywtMTUuNDk1MjEzIDE2LjI1ODE3OSwtMjIuMTk4MTdjLTE4Ljg3Njk1MywtMjEuMDYwNzEzIC00OC40ODYwMjMsLTMyLjk1NDA2MSAtNzkuMzQ4OTM4LC0zMi4xNTU0MDFsMCwwelwiLFxuICAgIFwid2lkdGhcIjogZnVuY3Rpb24odyxoKXtyZXR1cm4gdyAtIDQgfSxcbiAgICBcImhlaWdodFwiOiBmdW5jdGlvbih3LGgpe3JldHVybiBoIC0gNH1cbiAgfSxcbiAgZWxsaXBzZToge1xuICAgIFwidHlwZVwiOiBcImVsbGlwc2VcIixcbiAgICBcInJ4XCI6IGZ1bmN0aW9uKHcsaCl7cmV0dXJuIHcgLzIgLSA0fSxcbiAgICBcInJ5XCI6IGZ1bmN0aW9uKHcsaCl7cmV0dXJuIGgvIDIgLSA0fVxuICB9LFxuICBjaXJjbGU6IHtcbiAgICB0eXBlOiBcImNpcmNsZVwiLFxuICAgIHJhZGl1czogZnVuY3Rpb24odyxoKXsgcmV0dXJuIE1hdGgubWluKHcsaCkvMiAtIDR9XG4gIH1cbn07XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLkFwcGxpY2F0aW9uLnByb3RvdHlwZSwge1xuICBnZXRMaWJyYXJ5RWxlbWVudHM6IGZ1bmN0aW9uKG9wdGlvbnMpe1xuICAgIGNvbnN0IGNhdGVnb3J5ID0gZmFicmljLnV0aWwub2JqZWN0LmZpbmRXaGVyZSh0aGlzLmxpYnJhcnkse2lkOiBvcHRpb25zLmNhdGVnb3J5fSk7XG4gICAgcmV0dXJuIGZhYnJpYy51dGlsLm9iamVjdC5tYXAoZmFicmljLnV0aWwub2JqZWN0LmNsb25lRGVlcChjYXRlZ29yeS5pdGVtcyksZWwgPT4gZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChlbCxjYXRlZ29yeS50ZW1wbGF0ZSkpXG4gIH0sXG4gIC8qKlxuICAgKlxuICAgKiBAcGFyYW0gdmFsdWVcbiAgICogQHBhcmFtIGNhbGxiYWNrXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICBbe1xuICAgIFwiaWRcIjogNSxcbiAgICBcInRpdGxlXCI6IFwidmlkZW9cIixcbiAgICBcInRlbXBsYXRlXCI6IHtcbiAgICAgIFwidHlwZVwiOiBcInZpZGVvXCJcbiAgICB9LFxuICAgIFwiaXRlbXNcIjogW1xuICAgICAge1xuICAgICAgICBcInNyY1wiOiBcInZpZGVvLm1wZ1wiXG4gICAgICAgIFwiaGVpZ2h0XCI6IDM2MCxcbiAgICAgICAgXCJ3aWR0aFwiOiA0ODBcbiAgICAgIH1dXG4gICAgfV1cbiAgICovXG4gIHNldExpYnJhcnk6IGZ1bmN0aW9uICh2YWx1ZSwgY2FsbGJhY2spIHtcbiAgICBmYWJyaWMudXRpbC5kYXRhLmxvYWRKc29uKHZhbHVlLCBkYXRhID0+IHtcbiAgICAgIGRhdGEuZm9yRWFjaChjYXRlZ29yeSA9PiB7XG4gICAgICAgIGlmKCFjYXRlZ29yeS5pZCl7XG4gICAgICAgICAgY2F0ZWdvcnkuaWQgPSArK2ZhYnJpYy51dGlsLl9pZENvdW50ZXJcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICB0aGlzLmxpYnJhcnkgPSBkYXRhO1xuICAgICAgY2FsbGJhY2soKTtcbiAgICB9KTtcbiAgfVxufSk7XG5mYWJyaWMuQXBwbGljYXRpb24ucHJvdG90eXBlLmNvbmZpZ3VyYXRpb25Qcm9wZXJ0aWVzLnB1c2goXCJsaWJyYXJ5XCIpO1xuXG5mYWJyaWMuZ2V0T2JqZWN0c0xpc3QgPSBmdW5jdGlvbih3LGgpe1xuICB2YXIgX2xpYiA9IFtdO1xuICBmb3IodmFyIGkgaW4gdGhpcy5vYmplY3RzTGlicmFyeSl7XG4gICAgdmFyIG8gPSBfbGliW2ldID0gZmFicmljLnV0aWwub2JqZWN0LmNsb25lRGVlcCh0aGlzLm9iamVjdHNMaWJyYXJ5W2ldKTtcbiAgICBvLnRpdGxlID0gby50aXRsZSB8fCBvLnR5cGU7XG4gICAgaWYoby53aWR0aCA9PT0gMCApIG8ud2lkdGggPSB3O1xuICAgIGlmKG8uaGVpZ2h0ID09PSAwICkgby5oZWlnaHQgPSBoO1xuICAgIGZvcih2YXIgaiBpbiBvKXtcbiAgICAgIGlmKG9bal0uY29uc3RydWN0b3IgPT09IEZ1bmN0aW9uKXtcbiAgICAgICAgb1tqXSA9IG9bal0uY2FsbChvLHcsaCk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJldHVybiBfbGliO1xufTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvbW9kdWxlcy9saWJyYXJ5LmpzIiwiJ3VzZSBzdHJpY3QnO1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYyx7XG4gIGRlYnVnVGltZW91dDogMFxufSk7XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLkFwcGxpY2F0aW9uLnByb3RvdHlwZSwge1xuICBzZXREZWJ1ZzogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMub24oXCJyZWFkeVwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLmVuYWJsZURlYnVnZ2luZygpO1xuICAgIH0pXG4gIH0sXG5cbiAgZW5hYmxlRGVidWdnaW5nOiBmdW5jdGlvbigpe1xuICAgIGlmKGZhYnJpYy5kZWJ1Zyl7XG5cbiAgICAgIHZhciBfb3BlcmFuZCA9IFwiY29sb3I6ICMyRUMwNkM7IGZvbnQtc3R5bGU6IGl0YWxpYztcIjtcbiAgICAgIGNvbnNvbGUuaW5mbyhcImRlYnVnIGVuYWJsZWQuICh1c2UgJWNhcHAlYywgJWNwcm9qZWN0JWMsICVjY2FudmFzJWMsICVjdGFyZ2V0JWMgaW4gY29uc29sZSlcIixcbiAgICAgICAgX29wZXJhbmQsIFwiY29sb3I6ICMyMDIwMjBcIixcbiAgICAgICAgX29wZXJhbmQsIFwiY29sb3I6ICMyMDIwMjBcIixcbiAgICAgICAgX29wZXJhbmQsIFwiY29sb3I6ICMyMDIwMjBcIixcbiAgICAgICAgX29wZXJhbmQsIFwiY29sb3I6ICMyMDIwMjBcIik7XG5cbiAgICAgIHdpbmRvdy5hcHAgPSB0aGlzO1xuICAgICAgd2luZG93LmNhbnZhcyA9IHRoaXMuY2FudmFzO1xuICAgICAgd2luZG93LnByb2plY3QgPSB0aGlzLnByb2plY3Q7XG4gICAgICB3aW5kb3cudGFyZ2V0ID0gbnVsbDtcbiAgICAgIHRoaXMuY2FudmFzICYmIHRoaXMuY2FudmFzLm9uKFwidGFyZ2V0OmNoYW5nZWRcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICB3aW5kb3cudGFyZ2V0ID0gdGhpcy50YXJnZXQ7XG4gICAgICB9KTtcbiAgICB9XG4gIH1cbn0pO1xuXG5mYWJyaWMuT2JqZWN0LnByb3RvdHlwZS5kZWJ1ZyA9IGZ1bmN0aW9uKG5vQm9yZGVycyl7XG4gIHZhciBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpO1xuICBjYW52YXMud2lkdGggPSBub0JvcmRlcnMgP3RoaXMud2lkdGg6IHRoaXMud2lkdGggKyAyO1xuICBjYW52YXMuaGVpZ2h0ID0gbm9Cb3JkZXJzID90aGlzLmhlaWdodCA6IHRoaXMuaGVpZ2h0ICsgMjtcblxuICB2YXIgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gIGlmKCFub0JvcmRlcnMpe1xuICAgIGN0eC5saW5lV2lkdGg9MTtcbiAgICBjdHguc3Ryb2tlU3R5bGU9XCJ5ZWxsb3dcIjtcbiAgICBjdHguc3Ryb2tlUmVjdCgwLDAsdGhpcy53aWR0aCArIDIsdGhpcy5oZWlnaHQrIDIpO1xuICAgIGN0eC5zZXRMaW5lRGFzaChbNCw0XSk7XG4gICAgY3R4LnN0cm9rZVN0eWxlPVwiIzAwMDAwMFwiO1xuICAgIGN0eC5zdHJva2VSZWN0KDAsMCx0aGlzLndpZHRoICsgMix0aGlzLmhlaWdodCsgMik7XG4gIH1cbiAgY3R4LnRyYW5zbGF0ZSh0aGlzLndpZHRoLzIgICsgMSx0aGlzLmhlaWdodC8yICsgMSk7XG4gIHZhciBfY2xpcFRvID0gdGhpcy5jbGlwVG87XG4gIGRlbGV0ZSB0aGlzLmNsaXBUbztcbiAgdGhpcy5yZW5kZXIoY3R4LHRydWUpO1xuICB0aGlzLmNsaXBUbyA9IF9jbGlwVG87XG4gIHdpbmRvdy5vcGVuKGNhbnZhcy50b0RhdGFVUkwoKSxcIl9ibGFua1wiKTtcbn07XG5cblxuZmFicmljLkFwcGxpY2F0aW9uLnByb3RvdHlwZS5sb2dFdmVudHMgPSBmYWJyaWMuT2JqZWN0LnByb3RvdHlwZS5sb2dFdmVudHMgPSBmdW5jdGlvbiBldmVudHNMb2dnZXIob3B0aW9ucyl7XG4gIHZhciBfY291bnRlciA9IHt9O1xuICBmb3IodmFyIGkgaW4gb3B0aW9ucyl7XG4gICAgX2NvdW50ZXJbaV0gPSAwO1xuICAgIHRoaXMub24ob3B0aW9uc1tpXSxmdW5jdGlvbihpLCBldmVudCkge1xuICAgICAgY29uc29sZS5sb2coaSArIFwiIFwiICsgKytfY291bnRlcltpXSxldmVudCk7XG4gICAgfS5iaW5kKHRoaXMsaSkpO1xuICB9XG59O1xuXG5cblxuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9tb2R1bGVzL2RlYnVnLmpzIiwiJ3VzZSBzdHJpY3QnO1xuXG5cbmZhYnJpYy51dGlsLm1lZGlhUm9vdCA9IFwiXCI7XG5mYWJyaWMudXRpbC5hZGROb0NhY2hlID0gZmFsc2U7XG5cbmZhYnJpYy51dGlsLl9sb2FkSW1hZ2Vfb3ZlcndyaXR0ZW4gPSBmYWJyaWMudXRpbC5sb2FkSW1hZ2U7XG5cblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuQXBwbGljYXRpb24ucHJvdG90eXBlLCB7XG4gIG9wdGlvbnNPcmRlcjogKGZ1bmN0aW9uKCl7XG4gICAgdmFyIG9vID0gZmFicmljLkFwcGxpY2F0aW9uLnByb3RvdHlwZS5vcHRpb25zT3JkZXI7XG4gICAgb28uc3BsaWNlKG9vLmluZGV4T2YoXCJjYW52YXNDb250YWluZXJcIiksMCxcIm1lZGlhUm9vdFwiKTtcbiAgICByZXR1cm4gb287XG4gIH0pKCksXG4gIHNldE1lZGlhUm9vdDogZnVuY3Rpb24gKF9tZWRpYVJvb3QpIHtcbiAgICBpZiAoX21lZGlhUm9vdCkge1xuICAgICAgdmFyIF9kaXJuYW1lO1xuICAgICAgaWYgKGZhYnJpYy5pc0xpa2VseU5vZGUpIHtcbiAgICAgICAgX2Rpcm5hbWUgPSBfX2Rpcm5hbWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBfZGlybmFtZSA9IGZhYnJpYy51dGlsLnBhdGguZ2V0UGFyZW50RGlyZWN0b3J5VXJsKHdpbmRvdy5sb2NhdGlvbi5ocmVmKTtcbiAgICAgIH1cblxuICAgIC8vICBpZiAoKF9tZWRpYVJvb3QuaW5kZXhPZihcIi4vXCIpID09IDApKSB7XG4gICAgLy8gIH1cbiAgICAgIHZhciBfbGFzdCA9IF9tZWRpYVJvb3RbX21lZGlhUm9vdC5sZW5ndGggLSAxXTtcbiAgICAgIGlmIChfbGFzdCAhPSBcIi9cIiAmJiBfbGFzdCAhPSBcIlxcXFxcIikge1xuICAgICAgICBfbWVkaWFSb290ICs9IFwiL1wiXG4gICAgICB9XG4gICAgICBfbWVkaWFSb290ID0gZmFicmljLnV0aWwucGF0aC5yZXNvbHZlKF9kaXJuYW1lICsgX21lZGlhUm9vdCk7XG4gICAgICBmYWJyaWMudXRpbC5tZWRpYVJvb3QgPSBfbWVkaWFSb290O1xuICAgIH1cbiAgfVxufSk7XG5cblxuXG5cbi8vIGlmKCFmYWJyaWMuaXNMaWtlbHlOb2RlKXtcbi8vXG4vLyAgIHZhciBVUkwgPSByZXF1aXJlKCd1cmwnKSxcbi8vICAgICBIVFRQID0gcmVxdWlyZSgnaHR0cCcpLFxuLy8gICAgIEhUVFBTID0gcmVxdWlyZSgnaHR0cHMnKSxcbi8vICAgICBJbWFnZSA9IHJlcXVpcmUoJ2NhbnZhcycpLkltYWdlO1xuLy9cbi8vICAgLyoqIEBwcml2YXRlICovXG4vLyAgIHZhciByZXF1ZXN0ID0gZnVuY3Rpb24gKHVybCwgZW5jb2RpbmcsIGNhbGxiYWNrKSB7XG4vLyAgICAgdmFyIG9VUkwgPSBVUkwucGFyc2UodXJsKTtcbi8vXG4vLyAgICAgLy8gZGV0ZWN0IGlmIGh0dHAgb3IgaHR0cHMgaXMgdXNlZFxuLy8gICAgIGlmICggIW9VUkwucG9ydCApIHtcbi8vICAgICAgIG9VUkwucG9ydCA9ICggb1VSTC5wcm90b2NvbC5pbmRleE9mKCdodHRwczonKSA9PT0gMCApID8gNDQzIDogODA7XG4vLyAgICAgfVxuLy9cbi8vICAgICAvLyBhc3NpZ24gcmVxdWVzdCBoYW5kbGVyIGJhc2VkIG9uIHByb3RvY29sXG4vLyAgICAgdmFyIHJlcUhhbmRsZXIgPSAob1VSTC5wcm90b2NvbC5pbmRleE9mKCdodHRwczonKSA9PT0gMCApID8gSFRUUFMgOiBIVFRQLFxuLy8gICAgICAgcmVxID0gcmVxSGFuZGxlci5yZXF1ZXN0KHtcbi8vICAgICAgICAgaG9zdG5hbWU6IG9VUkwuaG9zdG5hbWUsXG4vLyAgICAgICAgIHBvcnQ6IG9VUkwucG9ydCxcbi8vICAgICAgICAgcGF0aDogb1VSTC5wYXRoLFxuLy8gICAgICAgICBtZXRob2Q6ICdHRVQnXG4vLyAgICAgICB9LCBmdW5jdGlvbihyZXNwb25zZSkge1xuLy8gICAgICAgICB2YXIgYm9keSA9ICcnO1xuLy8gICAgICAgICBpZiAoZW5jb2RpbmcpIHtcbi8vICAgICAgICAgICByZXNwb25zZS5zZXRFbmNvZGluZyhlbmNvZGluZyk7XG4vLyAgICAgICAgIH1cbi8vICAgICAgICAgcmVzcG9uc2Uub24oJ2VuZCcsIGZ1bmN0aW9uICgpIHtcbi8vICAgICAgICAgICBjYWxsYmFjayhib2R5KTtcbi8vICAgICAgICAgfSk7XG4vLyAgICAgICAgIHJlc3BvbnNlLm9uKCdkYXRhJywgZnVuY3Rpb24gKGNodW5rKSB7XG4vLyAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1c0NvZGUgPT09IDIwMCkge1xuLy8gICAgICAgICAgICAgYm9keSArPSBjaHVuaztcbi8vICAgICAgICAgICB9XG4vLyAgICAgICAgIH0pO1xuLy8gICAgICAgfSk7XG4vL1xuLy8gICAgIHJlcS5vbignZXJyb3InLCBmdW5jdGlvbihlcnIpIHtcbi8vICAgICAgIGlmIChlcnIuZXJybm8gPT09IHByb2Nlc3MuRUNPTk5SRUZVU0VEKSB7XG4vLyAgICAgICAgIGZhYnJpYy5sb2coJ0VDT05OUkVGVVNFRDogY29ubmVjdGlvbiByZWZ1c2VkIHRvICcgKyBvVVJMLmhvc3RuYW1lICsgJzonICsgb1VSTC5wb3J0KTtcbi8vICAgICAgIH1cbi8vICAgICAgIGVsc2Uge1xuLy8gICAgICAgICBmYWJyaWMubG9nKGVyci5tZXNzYWdlKTtcbi8vICAgICAgIH1cbi8vICAgICAgIGNhbGxiYWNrKG51bGwpO1xuLy8gICAgIH0pO1xuLy9cbi8vICAgICByZXEuZW5kKCk7XG4vLyAgIH1cbi8vXG4vLyAgIC8qKiBAcHJpdmF0ZSAqL1xuLy8gICB2YXIgcmVxdWVzdEZzID0gZnVuY3Rpb24gKHBhdGgsIGNhbGxiYWNrKSB7XG4vLyAgICAgdmFyIGZzID0gcmVxdWlyZSgnZnMnKTtcbi8vICAgICBmcy5yZWFkRmlsZShwYXRoLCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4vLyAgICAgICBpZiAoZXJyKSB7XG4vLyAgICAgICAgIGZhYnJpYy5sb2coZXJyKTtcbi8vICAgICAgICAgdGhyb3cgZXJyO1xuLy8gICAgICAgfVxuLy8gICAgICAgZWxzZSB7XG4vLyAgICAgICAgIGNhbGxiYWNrKGRhdGEpO1xuLy8gICAgICAgfVxuLy8gICAgIH0pO1xuLy8gICB9O1xuLy9cbi8vICAgZmFicmljLnV0aWwubG9hZEltYWdlID0gZnVuY3Rpb24odXJsLCBjYWxsYmFjaywgY29udGV4dCkge1xuLy9cbi8vXG4vLyAgICAgdmFyIGltZyA9IG5ldyBJbWFnZSgpO1xuLy8gICAgIGltZy5vbmVycm9yID0gZnVuY3Rpb24oKXtcbi8vICAgICAgIGNvbnNvbGUubG9nKFwiZXJyb3JcIik7XG4vLyAgICAgICBjYWxsYmFjayAmJiBjYWxsYmFjay5jYWxsKGNvbnRleHQsIG51bGwsIHRydWUpO1xuLy8gICAgIH07XG4vLyAgICAgaW1nLm9ubG9hZCA9IGZ1bmN0aW9uKCl7XG4vLyAgICAgICBjb25zb2xlLmxvZyhcInN1Y2Nlc3NcIik7XG4vLyAgICAgICBjYWxsYmFjayAmJiBjYWxsYmFjay5jYWxsKGNvbnRleHQsIGltZyk7XG4vLyAgICAgfTtcbi8vXG4vLyAgICAgZnVuY3Rpb24gY3JlYXRlSW1hZ2VBbmRDYWxsQmFjayhkYXRhKSB7XG4vLyAgICAgICBpZiAoZGF0YSkge1xuLy8gICAgICAgICBpbWcuc3JjID0gZGF0YTtcbi8vICAgICAgICAgLy8gcHJlc2VydmluZyBvcmlnaW5hbCB1cmwsIHdoaWNoIHNlZW1zIHRvIGJlIGxvc3QgaW4gbm9kZS1jYW52YXNcbi8vICAgICAgICAgaW1nLl9zcmMgPSB1cmw7XG4vLyAgICAgICB9XG4vLyAgICAgICBlbHNlIHtcbi8vICAgICAgICAgaW1nID0gbnVsbDtcbi8vICAgICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2suY2FsbChjb250ZXh0LCBudWxsLCB0cnVlKTtcbi8vICAgICAgIH1cbi8vICAgICB9XG4vL1xuLy8gICAgIGlmICh1cmwgJiYgKHVybCBpbnN0YW5jZW9mIEJ1ZmZlciB8fCB1cmwuaW5kZXhPZignZGF0YScpID09PSAwKSkge1xuLy8gICAgICAgaW1nLnNyYyA9IGltZy5fc3JjID0gdXJsO1xuLy8gICAgIH1cbi8vICAgICBlbHNlIGlmICh1cmwgJiYgdXJsLmluZGV4T2YoJ2h0dHAnKSAhPT0gMCkge1xuLy8gICAgICAgdmFyIHBhdGggPSByZXF1aXJlKFwicGF0aFwiKTtcbi8vICAgICAgIHVybCA9IGZhYnJpYy51dGlsLmdldFVSTCh1cmwpO1xuLy8gICAgICAgdXJsID0gICBwYXRoLnJlc29sdmUoZmFicmljLnV0aWwubWVkaWFSb290LCB1cmwpO1xuLy8gICAgICAgaW1nLnNyYyA9ICB1cmw7XG4vLyAgICAgICAvLyByZXF1ZXN0RnModXJsLCBjcmVhdGVJbWFnZUFuZENhbGxCYWNrKTtcbi8vICAgICB9XG4vLyAgICAgZWxzZSBpZiAodXJsKSB7XG4vLyAgICAgICByZXF1ZXN0KHVybCwgJ2JpbmFyeScsIGNyZWF0ZUltYWdlQW5kQ2FsbEJhY2spO1xuLy8gICAgIH1cbi8vICAgICBlbHNlIHtcbi8vICAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrLmNhbGwoY29udGV4dCwgdXJsKTtcbi8vICAgICB9XG4vLyAgIH07XG4vLyB9ZWxzZXtcbiAgZmFicmljLnV0aWwubG9hZFJlc291cmNlcyA9IGZ1bmN0aW9uIChyZXNvdXJjZXMsIGNhbGxiYWNrLCBjb250ZXh0LCBjcm9zc09yaWdpbikge1xuXG4gICAgdmFyIGxvYWRlZFJlc291cmNlcyA9IHt9O1xuICAgIHZhciBsb2FkZXIgPSBmYWJyaWMudXRpbC5xdWV1ZUxvYWQoT2JqZWN0LmtleXMocmVzb3VyY2VzKS5sZW5ndGgsZnVuY3Rpb24oKXtcbiAgICAgIGNhbGxiYWNrKGxvYWRlZFJlc291cmNlcyk7XG4gICAgfSk7XG4gICAgZm9yKHZhciBpIGluIHJlc291cmNlcyl7XG4gICAgICAoZnVuY3Rpb24oaSl7XG4gICAgICAgIGZhYnJpYy51dGlsLmxvYWRJbWFnZShyZXNvdXJjZXNbaV0sIGZ1bmN0aW9uKGltYWdlKXtcbiAgICAgICAgICBsb2FkZWRSZXNvdXJjZXNbaV0gPSBpbWFnZTtcbiAgICAgICAgICBsb2FkZXIoKTtcbiAgICAgICAgfSwgY29udGV4dCwgY3Jvc3NPcmlnaW4pO1xuICAgICAgfShpKSk7XG4gICAgfVxuICB9O1xuXG4gIGZhYnJpYy51dGlsLmxvYWRJbWFnZSA9IGZ1bmN0aW9uICh1cmwsIGNhbGxiYWNrLCBjb250ZXh0LCBjcm9zc09yaWdpbikge1xuICAgIHVybCA9IGZhYnJpYy51dGlsLmdldFVSTCh1cmwpO1xuICAgIGZ1bmN0aW9uIF9jaGVja19lcnJvcnMoaW1nKXtcbiAgICAgIC8v0LjQt9C+0LHRgNCw0LbQtdC90LjQtSDQvdC1INCx0YvQu9C+INC30LDQs9GA0YPQttC10L3QvlxuICAgICAgaWYgKGltZykge1xuICAgICAgICBjYWxsYmFjay5jYWxsKHRoaXMsaW1nKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGZhYnJpYy5lcnJvcnMucHVzaCh7dHlwZTogXCJpbWFnZVwiLCBtZXNzYWdlOiBcIkltYWdlIHdhcyBub3QgbG9hZGVkXCJ9KTtcbiAgICAgICAgZmFicmljLnV0aWwuX2xvYWRJbWFnZV9vdmVyd3JpdHRlbihmYWJyaWMubWVkaWEuZXJyb3IsIGNhbGxiYWNrLCBjb250ZXh0LCBjcm9zc09yaWdpbiB8fCAnQW5vbnltb3VzJyk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYoZmFicmljLmRlYnVnVGltZW91dCl7XG4gICAgICBzZXRUaW1lb3V0KGZhYnJpYy51dGlsLl9sb2FkSW1hZ2Vfb3ZlcndyaXR0ZW4uYmluZCh0aGlzLHVybCwgX2NoZWNrX2Vycm9ycyAsIGNvbnRleHQsIGNyb3NzT3JpZ2luIHx8ICdBbm9ueW1vdXMnKSxmYWJyaWMuZGVidWdUaW1lb3V0KVxuICAgIH1lbHNle1xuICAgICAgZmFicmljLnV0aWwuX2xvYWRJbWFnZV9vdmVyd3JpdHRlbih1cmwsIF9jaGVja19lcnJvcnMgLCBjb250ZXh0LCBjcm9zc09yaWdpbiB8fCAnQW5vbnltb3VzJyk7XG4gICAgfVxuICB9O1xuXG5cbmZhYnJpYy51dGlsLmdldFVSTCA9IGZ1bmN0aW9uKHVybCl7XG4gIGlmICh1cmwuaW5kZXhPZignYmxvYicpICE9PSAwICYmIHVybC5pbmRleE9mKCdkYXRhJykgIT09IDAgJiYgdXJsLmluZGV4T2YoJzovLycpID09IC0xKSB7XG4gICAgdXJsID0gZmFicmljLnV0aWwubWVkaWFSb290ICsgdXJsO1xuICB9XG4gIGlmIChmYWJyaWMudXRpbC5hZGROb0NhY2hlICYmIC9eKGh0dHB8aHR0cHMpXFw6XFwvXFwvLy50ZXN0KHVybCkpIHtcbiAgICB1cmwgKz0gJz9uby1jYWNoZT0nICsgbmV3IERhdGUoKS5nZXRUaW1lKClcbiAgfVxuICByZXR1cm4gdXJsO1xufTtcblxuXG5mYWJyaWMudXRpbC5sb2FkVmlkZW8gPSBmdW5jdGlvbiAoc291cmNlcywgY2FsbGJhY2ssIGNvbnRleHQsIGNyb3NzT3JpZ2luKSB7XG5cbiAgZnVuY3Rpb24gbG9hZEl0KHVybCl7XG4gICAgdmlkZW8uc3JjID0gZmFicmljLnV0aWwuZ2V0VVJMKHVybCk7XG4gICAgdmlkZW8uYWRkRXZlbnRMaXN0ZW5lcihcImxvYWRlZGRhdGFcIiwgZnVuY3Rpb24oKXtcbiAgICAgIGNhbGxiYWNrKHZpZGVvKTtcbiAgICB9LCB0cnVlKTtcbiAgICB2aWRlby5sb2FkKCk7XG4gIH1cblxuXG5cblxuICB2YXIgdmlkZW8gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd2aWRlbycpO1xuXG5cbiAgLy90cnlpbmcgdG8gZmluZCB0aGUgbW9zdCBzdWl0YWJsZSBzb3VyY2UgZm9yIGN1cnJlbnQgYnJvd3NlclxuICBmb3IgKHZhciB0eXBlIGluIHNvdXJjZXMpIHtcbiAgICBpZih2aWRlby5jYW5QbGF5VHlwZSh0eXBlKSA9PSBcInllc1wiKXtcbiAgICAgIHRoaXMubWVkaWFUeXBlID0gdHlwZTtcbiAgICAgIGxvYWRJdChzb3VyY2VzW3R5cGVdKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gIH1cbiAgZm9yICh2YXIgdHlwZSBpbiBzb3VyY2VzKSB7XG4gICAgaWYodmlkZW8uY2FuUGxheVR5cGUodHlwZSkgPT0gXCJtYXliZVwiKXtcbiAgICAgIHRoaXMubWVkaWFUeXBlID0gdHlwZTtcbiAgICAgIGxvYWRJdChzb3VyY2VzW3R5cGVdKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gIH1cbiAgY29uc29sZS53YXJuKFwidmlkZW8gc291cmNlcyBmb3JtYXRzIGlzIG5vdCBzdXBwb3J0ZWRcIilcblxuXG59O1xuXG5mYWJyaWMudXRpbC5fbG9hZFNWR0Zyb21VUkxfb3ZlcndyaXR0ZW4gPSBmYWJyaWMubG9hZFNWR0Zyb21VUkw7XG5mYWJyaWMubG9hZFNWR0Zyb21VUkwgPSBmdW5jdGlvbiAodXJsLCBjYWxsYmFjaywgcmV2aXZlcikge1xuICBpZiAodXJsLmluZGV4T2YoJ2RhdGEnKSAhPT0gMCAmJiB1cmwuaW5kZXhPZignOi8vJykgPT0gLTEpIHtcbiAgICB1cmwgPSBmYWJyaWMudXRpbC5tZWRpYVJvb3QgKyB1cmw7XG4gIH1cbiAgaWYgKGZhYnJpYy51dGlsLmFkZE5vQ2FjaGUgJiYgL14oaHR0cHxodHRwcylcXDpcXC9cXC8vLnRlc3QodXJsKSkge1xuICAgIHVybCArPSAnP25vLWNhY2hlPScgKyBtb21lbnQoKS5mb3JtYXQoJ3gnKTtcbiAgfVxuICBmYWJyaWMudXRpbC5fbG9hZFNWR0Zyb21VUkxfb3ZlcndyaXR0ZW4odXJsLCBmdW5jdGlvbihkYXRhKXtcbiAgICAgaWYoZGF0YSl7XG4gICAgICAgcmV0dXJuIGNhbGxiYWNrKGRhdGEpO1xuICAgICB9XG5cbiAgICB2YXIgeG1sID0galF1ZXJ5LnBhcnNlWE1MKGF0b2IoZmFicmljLm1lZGlhLmVycm9yLnN1YnN0cigyNikpKTtcblxuICAgIGZhYnJpYy5wYXJzZVNWR0RvY3VtZW50KHhtbC5kb2N1bWVudEVsZW1lbnQsIGZ1bmN0aW9uIChyZXN1bHRzLCBvcHRpb25zKSB7XG4gICAgICBjYWxsYmFjayAmJiBjYWxsYmFjayhyZXN1bHRzLCBvcHRpb25zKTtcbiAgICB9LCByZXZpdmVyKTtcblxuICB9LCByZXZpdmVyKTtcbn07XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL21vZHVsZXMvZnJvbVVSTC5qcyIsIid1c2Ugc3RyaWN0JztcblxuXG5mYWJyaWMudXRpbC51cGxvYWRJbWFnZU1heFNpemUgPSB7XG4gIHdpZHRoOiA0MDAsXG4gIGhlaWdodDogNDAwXG59O1xuXG5mYWJyaWMudXRpbC51cGxvYWRJbWFnZU1pblNpemUgPSB7XG4gIHdpZHRoOiAxMDAsXG4gIGhlaWdodDogMTAwXG59O1xuXG5mYWJyaWMudXRpbC5tdWx0aVVwbG9hZCA9IGZhbHNlO1xuXG5mYWJyaWMudXRpbC5yZWFkRmlsZSA9IGZ1bmN0aW9uKGZpbGUsY2FsbGJhY2spe1xuXG4gIHZhciByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xuICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24gKGUpIHtcbiAgICB2YXIgcmVzdWx0ID0gZS50YXJnZXQucmVzdWx0O1xuICAgIHZhciB0eXBlID0gcmVzdWx0LnN1YnN0cigxMSwgcmVzdWx0LmluZGV4T2YoXCI7XCIpIC0gMTEpO1xuICAgIHZhciBpbWcgPSBuZXcgSW1hZ2UoKTtcbiAgICBpbWcudHlwZSA9IHR5cGU7XG4gICAgaW1nLm5hbWUgPSBmaWxlLm5hbWU7XG4gICAgaW1nLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcblxuICAgICAgaWYoIWZhYnJpYy51dGlsLm11bHRpVXBsb2FkKXtcbiAgICAgICAgaWYgKGZhYnJpYy51dGlsLnVwbG9hZFByZXByb2Nlc3Nvcikge1xuICAgICAgICAgIGZhYnJpYy51dGlsLnVwbG9hZFByZXByb2Nlc3NvcihbdGhpc10sIGZ1bmN0aW9uICh2YWwpIHtcbiAgICAgICAgICAgIGNhbGxiYWNrKHZhbCk7XG4gICAgICAgICAgfSxvcHRpb25zKVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNhbGxiYWNrKHRoaXMpO1xuICAgICAgICB9XG4gICAgICB9ZWxzZXtcbiAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIGltZy5zcmMgPSByZXN1bHQ7XG4gIH07XG4gIHJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUgKTtcbn07XG5cblxuZmFicmljLnV0aWwuY3JlYXRlVXBsb2FkSW5wdXQgPSBmdW5jdGlvbiAob3B0aW9ucywgY29tcGxldGUsIHByb2dyZXNzKSB7XG5cbiAgdmFyIGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlucHV0XCIpO1xuICBpbnB1dC5zZXRBdHRyaWJ1dGUoXCJ0eXBlXCIsIFwiZmlsZVwiKTtcbiAgaW5wdXQuc2V0QXR0cmlidXRlKFwibXVsdGlwbGVcIiwgdHJ1ZSk7XG4gIGlucHV0LmNsYXNzTmFtZSA9IFwiaGlkZGVuXCI7XG5cbiAgJChpbnB1dCkuY2hhbmdlKGZ1bmN0aW9uICgpIHtcblxuICAgIGlmKGlucHV0LmZpbGVzICYmIGlucHV0LmZpbGVzLmxlbmd0aCl7XG5cbiAgICAgIHZhciBfbG9hZGVyID0gZmFicmljLnV0aWwucXVldWVMb2FkKGlucHV0LmZpbGVzLmxlbmd0aCxmdW5jdGlvbihsb2FkZWQpe1xuXG4gICAgICAgIGlmKGZhYnJpYy51dGlsLm11bHRpVXBsb2FkKXtcbiAgICAgICAgICBpZiAoZmFicmljLnV0aWwudXBsb2FkUHJlcHJvY2Vzc29yKSB7XG4gICAgICAgICAgICBmYWJyaWMudXRpbC51cGxvYWRQcmVwcm9jZXNzb3IobG9hZGVkLCBmdW5jdGlvbiAodmFsKSB7XG4gICAgICAgICAgICAgIGNvbXBsZXRlKHZhbCxvcHRpb25zKTtcbiAgICAgICAgICAgIH0sb3B0aW9ucylcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29tcGxldGUobG9hZGVkLG9wdGlvbnMpO1xuICAgICAgICAgIH1cbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgY29tcGxldGUobG9hZGVkWzBdLG9wdGlvbnMpO1xuXG4gICAgICAgIH1cbiAgICAgIH0sZnVuY3Rpb24odG90YWwsIGN1cnJlbnQsIGltYWdlKXtcbiAgICAgICAgaWYoZmFicmljLnV0aWwubXVsdGlVcGxvYWQpIHtcbiAgICAgICAgICBpZiAocHJvZ3Jlc3MpIHtcbiAgICAgICAgICAgIHByb2dyZXNzKHRvdGFsLCBjdXJyZW50LCBpbWFnZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcblxuXG5cbiAgICAgIGZvcih2YXIgaSA9MDsgaTwgaW5wdXQuZmlsZXMubGVuZ3RoOyBpKyspe1xuICAgICAgICBmYWJyaWMudXRpbC5yZWFkRmlsZShpbnB1dC5maWxlc1tpXSxfbG9hZGVyKTtcbiAgICAgIH1cblxuXG5cbiAgICB9XG5cbiAgfSk7XG5cbiAgZmFicmljLnV0aWwudXBsb2FkSW5wdXQgPSBpbnB1dDtcbn07XG5cblxuLy9mYWJyaWMudXRpbC5yZXNpemVJbWFnZShpbWcsIGNhbGxiYWNrKTtcbmZhYnJpYy51dGlsLnVwbG9hZFByZXByb2Nlc3NvciA9IG51bGw7XG5cblxuZmFicmljLnV0aWwudXBsb2FkSW1hZ2UgPSBmdW5jdGlvbiAoY2IscHJvZ3Jlc3Msb3B0aW9ucykge1xuICBmYWJyaWMudXRpbC5jcmVhdGVVcGxvYWRJbnB1dChvcHRpb25zLGNiLHByb2dyZXNzKTtcbiAgJChmYWJyaWMudXRpbC51cGxvYWRJbnB1dCkudHJpZ2dlcignY2xpY2snKTtcbn07XG5cblxuZmFicmljLnV0aWwucmVzaXplVXBsb2FkZWRJbWFnZSA9IGZ1bmN0aW9uIChpbWcsIGNhbGxiYWNrKSB7XG5cbiAgaWYgKGltZy50eXBlID09PSBcInN2Zyt4bWxcIikge1xuICAgIGNhbGxiYWNrKGltZyk7XG4gICAgcmV0dXJuO1xuICB9XG4gIC8vSGVyZSB3ZSBjYW4gcHV0IGEgcmVzdHJpY3Rpb24gdG8gdXBsb2FkIGEgbWluaW0gc2l6ZWQgbG9nb1xuICBpZiAoaW1nLndpZHRoIDwgZmFicmljLnV0aWwudXBsb2FkSW1hZ2VNaW5TaXplLndpZHRoIHx8IGltZy5oZWlnaHQgPCBmYWJyaWMudXRpbC51cGxvYWRJbWFnZU1pblNpemUuaGVpZ2h0KSB7XG4gICAgYWxlcnQoXCJMb2dvIGlzIHRvbyBzbWFsbC4gTUluaW11bSBzaXplIGlzIFwiICsgZmFicmljLnV0aWwudXBsb2FkSW1hZ2VNaW5TaXplLndpZHRoICsgXCJ4XCIgKyBmYWJyaWMudXRpbC51cGxvYWRJbWFnZU1pblNpemUuaGVpZ2h0KTtcbiAgICBjYWxsYmFjayhmYWxzZSk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaWYgKGltZy53aWR0aCA+IGZhYnJpYy51dGlsLnVwbG9hZEltYWdlTWF4U2l6ZS53aWR0aCB8fCBpbWcuaGVpZ2h0ID4gZmFicmljLnV0aWwudXBsb2FkSW1hZ2VNYXhTaXplLmhlaWdodCkge1xuXG4gICAgdmFyIHNpemUgPSBmYWJyaWMudXRpbC5nZXRQcm9wb3J0aW9ucyhpbWcsIGZhYnJpYy51dGlsLnVwbG9hZEltYWdlTWF4U2l6ZSwgXCJmaXRcIik7XG5cbiAgICB2YXIgZmlsdGVyID0gbmV3IGZhYnJpYy5JbWFnZS5maWx0ZXJzLlJlc2l6ZURQKCk7XG5cbiAgICB2YXIgY2FudmFzID0gZmFicmljLnV0aWwuY3JlYXRlQ2FudmFzRWxlbWVudFdpdGhTaXplKGltZyk7XG4gICAgdmFyIGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7XG4gICAgY3R4LmRyYXdJbWFnZShpbWcsIDAsIDApO1xuICAgIGZpbHRlci5hcHBseVRvKGNhbnZhcywgc2l6ZS53aWR0aCwgc2l6ZS5oZWlnaHQpO1xuICAgIGNhbGxiYWNrKGNhbnZhcyk7XG4gIH0gZWxzZSB7XG4gICAgY2FsbGJhY2soaW1nKTtcbiAgfVxufTtcblxuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5DYW52YXMucHJvdG90eXBlLHtcbiAgdXBsb2FkQ2xhc3M6ICdJbWFnZScsXG4gIHVwbG9hZEltYWdlVG9vbDogZmFsc2UsXG4gIGNyZWF0ZUltYWdlT2JqZWN0OiBmdW5jdGlvbiAoaW1nLCBvYmplY3RUeXBlKSB7XG4gICAgaWYgKCFpbWcpcmV0dXJuO1xuICAgIHRoaXMuY3JlYXRlT2JqZWN0KHtcbiAgICAgIHBvc2l0aW9uOiBcImNlbnRlclwiLFxuICAgICAgYWN0aXZlOiB0cnVlLFxuICAgICAgdHlwZTogdGhpcy51cGxvYWRDbGFzcyxcbiAgICAgIGltYWdlOiBpbWcsXG4gICAgICBjbGlwVG86IHRoaXMuYWN0aXZlQXJlYSxcbiAgICAgIG1vdmVtZW50TGltaXRzOiB0aGlzLmFjdGl2ZUFyZWFcbiAgICB9KTtcbiAgfSxcbiAgYWN0aW9uczogZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuU2xpZGVDYW52YXMucHJvdG90eXBlLmFjdGlvbnMse1xuICAgIHVwbG9hZEltYWdlOiB7XG4gICAgICBjbGFzc05hbWU6ICAnZmEgZmEtdXBsb2FkJyxcbiAgICAgIGtleTogJ1UnLFxuICAgICAgdGl0bGU6ICd1cGxvYWQgaW1hZ2UnLFxuICAgICAgYWN0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGZhYnJpYy51dGlsLnVwbG9hZEltYWdlKGZ1bmN0aW9uKGltZyl7XG4gICAgICAgICAgdGhpcy5jcmVhdGVJbWFnZU9iamVjdChpbWcsdGhpcy51cGxvYWRDbGFzcylcbiAgICAgICAgfS5iaW5kKHRoaXMpKVxuICAgICAgfVxuICAgIH1cbiAgfSlcbn0pO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9tb2R1bGVzL3VwbG9hZC5qcyIsIlxuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5BcHBsaWNhdGlvbi5wcm90b3R5cGUsIHtcbiAgLy8gbG9hZGVyVGVtcGxhdGU6IFwiPHNwYW4gY2xhc3M9J2ZhIGZhLXB1bHNlIGZhLXNwaW5uZXIgY2FudmFzLWxvYWQtc3Bpbm5lcic+PC9zcGFuPlwiLFxuICBsb2FkZXJJY29uOiAgICdkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LCcgKyByZXF1aXJlKCdiYXNlNjQtbG9hZGVyIS4vLi4vbWVkaWEvbG9hZGVyLnN2ZycpLFxuICBsb2FkZXJDb250YWluZXI6IG51bGwsXG4gIF9zaG93TWFpbkxvYWRlckluZGljYXRvcjogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMubG9hZGVyRWwuc2hvdygpO1xuICAgIHRoaXMubG9hZGVyQ29udGFpbmVyLmFkZENsYXNzKFwicHJvY2Vzc2luZ1wiKTtcbiAgfSxcbiAgX2hpZGVNYWluTG9hZGVySW5kaWNhdG9yOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5sb2FkZXJFbC5oaWRlKCk7XG4gICAgdGhpcy5sb2FkZXJDb250YWluZXIucmVtb3ZlQ2xhc3MoXCJwcm9jZXNzaW5nXCIpO1xuICB9LFxuICBzZXRMb2FkZXJUZW1wbGF0ZTogZnVuY3Rpb24gKHZhbCkge1xuICAgIGlmKHRoaXMudmlydHVhbCkgcmV0dXJuIGZhbHNlO1xuICAgIHRoaXMubG9hZGVyVGVtcGxhdGUgPSB2YWwucmVwbGFjZShcIntsb2FkZXJJY29ufVwiLHRoaXMubG9hZGVySWNvbik7XG4gICAgaWYodmFsKSB7XG4gICAgICB0aGlzLmxvYWRlckNvbnRhaW5lciA9ICQodGhpcy5sb2FkZXJDb250YWluZXIpO1xuICAgICAgdGhpcy5sb2FkZXJFbCA9ICQodGhpcy5sb2FkZXJUZW1wbGF0ZSkuaGlkZSgpO1xuICAgICAgdGhpcy5sb2FkZXJDb250YWluZXIuYXBwZW5kKHRoaXMubG9hZGVyRWwpO1xuICAgICAgLy8gdGhpcy5vbihcImxvYWRpbmc6YmVnaW5cIiwgdGhpcy5fc2hvd01haW5Mb2FkZXJJbmRpY2F0b3IpO1xuICAgICAgLy8gdGhpcy5vbihcImxvYWRpbmc6ZW5kXCIsIHRoaXMuX2hpZGVNYWluTG9hZGVySW5kaWNhdG9yKTtcblxuXG4gICAgICB0aGlzLm9uKFwicHJvamVjdDpjaGFuZ2VkXCIsZnVuY3Rpb24oKXtcbiAgICAgICAgdGhpcy5wcm9qZWN0Lm9uKFwic2xpZGU6Y2hhbmdlOmJlZ2luXCIsIHRoaXMuX3Nob3dNYWluTG9hZGVySW5kaWNhdG9yLmJpbmQodGhpcykpO1xuICAgICAgICB0aGlzLnByb2plY3Qub24oXCJzbGlkZTpjaGFuZ2VkXCIsIHRoaXMuX2hpZGVNYWluTG9hZGVySW5kaWNhdG9yLmJpbmQodGhpcykpO1xuICAgICAgfSlcblxuICAgIH1cbiAgfVxufSk7XG5cblxuLy8gZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuU2xpZGVDYW52YXMucHJvdG90eXBlLCB7XG4vLyAgIC8vIGxvYWRlclRlbXBsYXRlOiBcIjxzcGFuIGNsYXNzPSdmYSBmYS1wdWxzZSBmYS1zcGlubmVyIGNhbnZhcy1sb2FkLXNwaW5uZXInPjwvc3Bhbj5cIixcbi8vICAgc2V0TG9hZGVyVGVtcGxhdGU6IGZ1bmN0aW9uICh2YWwpIHtcbi8vICAgICBpZih0aGlzLnZpcnR1YWwpIHJldHVybiBmYWxzZTtcbi8vICAgICB0aGlzLmxvYWRlclRlbXBsYXRlID0gdmFsO1xuLy8gICAgIGlmKHZhbCkge1xuLy8gICAgICAgdGhpcy5sb2FkZXJFbCA9ICQodGhpcy5sb2FkZXJUZW1wbGF0ZSkuaGlkZSgpO1xuLy8gICAgICAgJCh0aGlzLndyYXBwZXJFbCkuYXBwZW5kKHRoaXMubG9hZGVyRWwpO1xuLy8gICAgICAgdGhpcy5vbihcImxvYWRpbmc6YmVnaW5cIiwgZnVuY3Rpb24gKCkge1xuLy8gICAgICAgICB0aGlzLmxvYWRlckVsLnNob3coKTtcbi8vICAgICAgICAgJCh0aGlzLndyYXBwZXJFbCkuYWRkQ2xhc3MoXCJwcm9jZXNzaW5nXCIpO1xuLy8gICAgICAgfSk7XG4vLyAgICAgICB0aGlzLm9uKFwibG9hZGluZzplbmRcIiwgZnVuY3Rpb24gKCkge1xuLy8gICAgICAgICB0aGlzLmxvYWRlckVsLmhpZGUoKTtcbi8vICAgICAgICAgJCh0aGlzLndyYXBwZXJFbCkucmVtb3ZlQ2xhc3MoXCJwcm9jZXNzaW5nXCIpO1xuLy8gICAgICAgfSk7XG4vLyAgICAgfVxuLy8gICB9XG4vLyB9KTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvbW9kdWxlcy9sb2FkZXIuanMiLCJtb2R1bGUuZXhwb3J0cyA9IFwiUEQ5NGJXd2dkbVZ5YzJsdmJqMGlNUzR3SWlCbGJtTnZaR2x1WnowaWRYUm1MVGdpUHo0OGMzWm5JSGRwWkhSb1BTY3hPRGh3ZUNjZ2FHVnBaMmgwUFNjeE9EaHdlQ2NnZUcxc2JuTTlJbWgwZEhBNkx5OTNkM2N1ZHpNdWIzSm5Mekl3TURBdmMzWm5JaUIyYVdWM1FtOTRQU0l3SURBZ01UQXdJREV3TUNJZ2NISmxjMlZ5ZG1WQmMzQmxZM1JTWVhScGJ6MGllRTFwWkZsTmFXUWlJR05zWVhOelBTSjFhV3d0YzNCcGJpSStQSEpsWTNRZ2VEMGlNQ0lnZVQwaU1DSWdkMmxrZEdnOUlqRXdNQ0lnYUdWcFoyaDBQU0l4TURBaUlHWnBiR3c5SW01dmJtVWlJR05zWVhOelBTSmlheUkrUEM5eVpXTjBQanhuSUhSeVlXNXpabTl5YlQwaWRISmhibk5zWVhSbEtEVXdJRFV3S1NJK1BHY2dkSEpoYm5ObWIzSnRQU0p5YjNSaGRHVW9NQ2tnZEhKaGJuTnNZWFJsS0RNMElEQXBJajQ4WTJseVkyeGxJR040UFNJd0lpQmplVDBpTUNJZ2NqMGlPQ0lnWm1sc2JEMGlJMk5tWm1aa1ppSStQR0Z1YVcxaGRHVWdZWFIwY21saWRYUmxUbUZ0WlQwaWIzQmhZMmwwZVNJZ1puSnZiVDBpTVNJZ2RHODlJakF1TVNJZ1ltVm5hVzQ5SWpCeklpQmtkWEk5SWpGeklpQnlaWEJsWVhSRGIzVnVkRDBpYVc1a1pXWnBibWwwWlNJK1BDOWhibWx0WVhSbFBqeGhibWx0WVhSbFZISmhibk5tYjNKdElHRjBkSEpwWW5WMFpVNWhiV1U5SW5SeVlXNXpabTl5YlNJZ2RIbHdaVDBpYzJOaGJHVWlJR1p5YjIwOUlqRXVOU0lnZEc4OUlqRWlJR0psWjJsdVBTSXdjeUlnWkhWeVBTSXhjeUlnY21Wd1pXRjBRMjkxYm5ROUltbHVaR1ZtYVc1cGRHVWlQand2WVc1cGJXRjBaVlJ5WVc1elptOXliVDQ4TDJOcGNtTnNaVDQ4TDJjK1BHY2dkSEpoYm5ObWIzSnRQU0p5YjNSaGRHVW9ORFVwSUhSeVlXNXpiR0YwWlNnek5DQXdLU0krUEdOcGNtTnNaU0JqZUQwaU1DSWdZM2s5SWpBaUlISTlJamdpSUdacGJHdzlJaU5qWm1abVpHWWlQanhoYm1sdFlYUmxJR0YwZEhKcFluVjBaVTVoYldVOUltOXdZV05wZEhraUlHWnliMjA5SWpFaUlIUnZQU0l3TGpFaUlHSmxaMmx1UFNJd0xqRXljeUlnWkhWeVBTSXhjeUlnY21Wd1pXRjBRMjkxYm5ROUltbHVaR1ZtYVc1cGRHVWlQand2WVc1cGJXRjBaVDQ4WVc1cGJXRjBaVlJ5WVc1elptOXliU0JoZEhSeWFXSjFkR1ZPWVcxbFBTSjBjbUZ1YzJadmNtMGlJSFI1Y0dVOUluTmpZV3hsSWlCbWNtOXRQU0l4TGpVaUlIUnZQU0l4SWlCaVpXZHBiajBpTUM0eE1uTWlJR1IxY2owaU1YTWlJSEpsY0dWaGRFTnZkVzUwUFNKcGJtUmxabWx1YVhSbElqNDhMMkZ1YVcxaGRHVlVjbUZ1YzJadmNtMCtQQzlqYVhKamJHVStQQzluUGp4bklIUnlZVzV6Wm05eWJUMGljbTkwWVhSbEtEa3dLU0IwY21GdWMyeGhkR1VvTXpRZ01Da2lQanhqYVhKamJHVWdZM2c5SWpBaUlHTjVQU0l3SWlCeVBTSTRJaUJtYVd4c1BTSWpZMlptWm1SbUlqNDhZVzVwYldGMFpTQmhkSFJ5YVdKMWRHVk9ZVzFsUFNKdmNHRmphWFI1SWlCbWNtOXRQU0l4SWlCMGJ6MGlNQzR4SWlCaVpXZHBiajBpTUM0eU5YTWlJR1IxY2owaU1YTWlJSEpsY0dWaGRFTnZkVzUwUFNKcGJtUmxabWx1YVhSbElqNDhMMkZ1YVcxaGRHVStQR0Z1YVcxaGRHVlVjbUZ1YzJadmNtMGdZWFIwY21saWRYUmxUbUZ0WlQwaWRISmhibk5tYjNKdElpQjBlWEJsUFNKelkyRnNaU0lnWm5KdmJUMGlNUzQxSWlCMGJ6MGlNU0lnWW1WbmFXNDlJakF1TWpWeklpQmtkWEk5SWpGeklpQnlaWEJsWVhSRGIzVnVkRDBpYVc1a1pXWnBibWwwWlNJK1BDOWhibWx0WVhSbFZISmhibk5tYjNKdFBqd3ZZMmx5WTJ4bFBqd3ZaejQ4WnlCMGNtRnVjMlp2Y20wOUluSnZkR0YwWlNneE16VXBJSFJ5WVc1emJHRjBaU2d6TkNBd0tTSStQR05wY21Oc1pTQmplRDBpTUNJZ1kzazlJakFpSUhJOUlqZ2lJR1pwYkd3OUlpTmpabVptWkdZaVBqeGhibWx0WVhSbElHRjBkSEpwWW5WMFpVNWhiV1U5SW05d1lXTnBkSGtpSUdaeWIyMDlJakVpSUhSdlBTSXdMakVpSUdKbFoybHVQU0l3TGpNM2N5SWdaSFZ5UFNJeGN5SWdjbVZ3WldGMFEyOTFiblE5SW1sdVpHVm1hVzVwZEdVaVBqd3ZZVzVwYldGMFpUNDhZVzVwYldGMFpWUnlZVzV6Wm05eWJTQmhkSFJ5YVdKMWRHVk9ZVzFsUFNKMGNtRnVjMlp2Y20waUlIUjVjR1U5SW5OallXeGxJaUJtY205dFBTSXhMalVpSUhSdlBTSXhJaUJpWldkcGJqMGlNQzR6TjNNaUlHUjFjajBpTVhNaUlISmxjR1ZoZEVOdmRXNTBQU0pwYm1SbFptbHVhWFJsSWo0OEwyRnVhVzFoZEdWVWNtRnVjMlp2Y20wK1BDOWphWEpqYkdVK1BDOW5QanhuSUhSeVlXNXpabTl5YlQwaWNtOTBZWFJsS0RFNE1Da2dkSEpoYm5Oc1lYUmxLRE0wSURBcElqNDhZMmx5WTJ4bElHTjRQU0l3SWlCamVUMGlNQ0lnY2owaU9DSWdabWxzYkQwaUkyTm1abVprWmlJK1BHRnVhVzFoZEdVZ1lYUjBjbWxpZFhSbFRtRnRaVDBpYjNCaFkybDBlU0lnWm5KdmJUMGlNU0lnZEc4OUlqQXVNU0lnWW1WbmFXNDlJakF1TlhNaUlHUjFjajBpTVhNaUlISmxjR1ZoZEVOdmRXNTBQU0pwYm1SbFptbHVhWFJsSWo0OEwyRnVhVzFoZEdVK1BHRnVhVzFoZEdWVWNtRnVjMlp2Y20wZ1lYUjBjbWxpZFhSbFRtRnRaVDBpZEhKaGJuTm1iM0p0SWlCMGVYQmxQU0p6WTJGc1pTSWdabkp2YlQwaU1TNDFJaUIwYnowaU1TSWdZbVZuYVc0OUlqQXVOWE1pSUdSMWNqMGlNWE1pSUhKbGNHVmhkRU52ZFc1MFBTSnBibVJsWm1sdWFYUmxJajQ4TDJGdWFXMWhkR1ZVY21GdWMyWnZjbTArUEM5amFYSmpiR1UrUEM5blBqeG5JSFJ5WVc1elptOXliVDBpY205MFlYUmxLREl5TlNrZ2RISmhibk5zWVhSbEtETTBJREFwSWo0OFkybHlZMnhsSUdONFBTSXdJaUJqZVQwaU1DSWdjajBpT0NJZ1ptbHNiRDBpSTJObVptWmtaaUkrUEdGdWFXMWhkR1VnWVhSMGNtbGlkWFJsVG1GdFpUMGliM0JoWTJsMGVTSWdabkp2YlQwaU1TSWdkRzg5SWpBdU1TSWdZbVZuYVc0OUlqQXVOakp6SWlCa2RYSTlJakZ6SWlCeVpYQmxZWFJEYjNWdWREMGlhVzVrWldacGJtbDBaU0krUEM5aGJtbHRZWFJsUGp4aGJtbHRZWFJsVkhKaGJuTm1iM0p0SUdGMGRISnBZblYwWlU1aGJXVTlJblJ5WVc1elptOXliU0lnZEhsd1pUMGljMk5oYkdVaUlHWnliMjA5SWpFdU5TSWdkRzg5SWpFaUlHSmxaMmx1UFNJd0xqWXljeUlnWkhWeVBTSXhjeUlnY21Wd1pXRjBRMjkxYm5ROUltbHVaR1ZtYVc1cGRHVWlQand2WVc1cGJXRjBaVlJ5WVc1elptOXliVDQ4TDJOcGNtTnNaVDQ4TDJjK1BHY2dkSEpoYm5ObWIzSnRQU0p5YjNSaGRHVW9NamN3S1NCMGNtRnVjMnhoZEdVb016UWdNQ2tpUGp4amFYSmpiR1VnWTNnOUlqQWlJR041UFNJd0lpQnlQU0k0SWlCbWFXeHNQU0lqWTJabVptUm1JajQ4WVc1cGJXRjBaU0JoZEhSeWFXSjFkR1ZPWVcxbFBTSnZjR0ZqYVhSNUlpQm1jbTl0UFNJeElpQjBiejBpTUM0eElpQmlaV2RwYmowaU1DNDNOWE1pSUdSMWNqMGlNWE1pSUhKbGNHVmhkRU52ZFc1MFBTSnBibVJsWm1sdWFYUmxJajQ4TDJGdWFXMWhkR1UrUEdGdWFXMWhkR1ZVY21GdWMyWnZjbTBnWVhSMGNtbGlkWFJsVG1GdFpUMGlkSEpoYm5ObWIzSnRJaUIwZVhCbFBTSnpZMkZzWlNJZ1puSnZiVDBpTVM0MUlpQjBiejBpTVNJZ1ltVm5hVzQ5SWpBdU56VnpJaUJrZFhJOUlqRnpJaUJ5WlhCbFlYUkRiM1Z1ZEQwaWFXNWtaV1pwYm1sMFpTSStQQzloYm1sdFlYUmxWSEpoYm5ObWIzSnRQand2WTJseVkyeGxQand2Wno0OFp5QjBjbUZ1YzJadmNtMDlJbkp2ZEdGMFpTZ3pNVFVwSUhSeVlXNXpiR0YwWlNnek5DQXdLU0krUEdOcGNtTnNaU0JqZUQwaU1DSWdZM2s5SWpBaUlISTlJamdpSUdacGJHdzlJaU5qWm1abVpHWWlQanhoYm1sdFlYUmxJR0YwZEhKcFluVjBaVTVoYldVOUltOXdZV05wZEhraUlHWnliMjA5SWpFaUlIUnZQU0l3TGpFaUlHSmxaMmx1UFNJd0xqZzNjeUlnWkhWeVBTSXhjeUlnY21Wd1pXRjBRMjkxYm5ROUltbHVaR1ZtYVc1cGRHVWlQand2WVc1cGJXRjBaVDQ4WVc1cGJXRjBaVlJ5WVc1elptOXliU0JoZEhSeWFXSjFkR1ZPWVcxbFBTSjBjbUZ1YzJadmNtMGlJSFI1Y0dVOUluTmpZV3hsSWlCbWNtOXRQU0l4TGpVaUlIUnZQU0l4SWlCaVpXZHBiajBpTUM0NE4zTWlJR1IxY2owaU1YTWlJSEpsY0dWaGRFTnZkVzUwUFNKcGJtUmxabWx1YVhSbElqNDhMMkZ1YVcxaGRHVlVjbUZ1YzJadmNtMCtQQzlqYVhKamJHVStQQzluUGp3dlp6NDhMM04yWno0PVwiXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi4vbm9kZV9tb2R1bGVzL2Jhc2U2NC1sb2FkZXIhLi9tZWRpYS9sb2FkZXIuc3ZnXG4vLyBtb2R1bGUgaWQgPSA0NlxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCIndXNlIHN0cmljdCc7XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLlNsaWRlQ2FudmFzLnByb3RvdHlwZSwge1xuICBzZXREcm9wcGFibGU6IGZ1bmN0aW9uKHZhbCl7XG4gICAgdGhpcy5kcm9wcGFibGUgPSB2YWw7XG4gICAgaWYodGhpcy5kcm9wcGFibGUpe1xuICAgICAgdGhpcy5pbml0RHJhZ0FuZERyb3AoKTtcbiAgICB9XG4gIH0sXG4gIGRyb3BwYWJsZTogZmFsc2UsIC8ve31cbiAgaXNEcm9wQXZhaWxhYmxlOiBmdW5jdGlvbiAoZHJvcHBhYmxlLCBkYXRhKSB7XG5cbiAgICBmb3IgKHZhciBpIGluIGRyb3BwYWJsZSkge1xuICAgICAgaWYgKGRyb3BwYWJsZVtpXS5jb25zdHJ1Y3RvciA9PSBBcnJheSkge1xuICAgICAgICBpZiAoZHJvcHBhYmxlW2ldLmluZGV4T2YoZGF0YVtpXSkgPT0gLTEpcmV0dXJuIGZhbHNlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYoZHJvcHBhYmxlW2ldID09IFwiKlwiKWNvbnRpbnVlO1xuICAgICAgICBpZiAoZHJvcHBhYmxlW2ldICE9IGRhdGFbaV0pIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRydWU7XG4gICAgLy9yZXR1cm4gKHRoaXMuc3VwcG9ydGVkVHlwZXMgPT0gXCIqXCIgfHwgdGhpcy5zdXBwb3J0ZWRUeXBlcy5pbmRleE9mKHR5cGUpIT0gLTEpXG4gIH0sXG4gIGRyb3A6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgdGhpcy5zZXREYXRhKGRhdGEpO1xuXG4gIH0sXG4gIGluaXREcmFnQW5kRHJvcDogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMub24oXCJtb3VzZTpkcm9wXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICB2YXIgX3ggPSAoZS54IC0gZS5vZmZzZXRYKTtcbiAgICAgIHZhciBfeSA9IChlLnkgLSBlLm9mZnNldFkpXG4gICAgICB2YXIgX3cgPSAoZS5kYXRhLndpZHRoIHx8IGUud2lkdGggICk7XG4gICAgICB2YXIgX2ggPSAoZS5kYXRhLmhlaWdodCB8fCBlLmhlaWdodCApO1xuXG4gICAgICBpZiAoZS5kYXRhLnNjYWxlWCkge1xuICAgICAgICB2YXIgX3NjYWxlWCA9IGUuZGF0YS5zY2FsZVggLyB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzBdXG5cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIF9zY2FsZVggPSAxO1xuICAgICAgICBfdyAvPSB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzBdXG4gICAgICB9XG5cbiAgICAgIGlmIChlLmRhdGEuc2NhbGVZKSB7XG4gICAgICAgIHZhciBfc2NhbGVZID0gZS5kYXRhLnNjYWxlWSAvIHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bM107XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBfc2NhbGVZID0gMTtcbiAgICAgICAgX2ggLz0gdGhpcy52aWV3cG9ydFRyYW5zZm9ybVszXVxuICAgICAgfVxuXG4gICAgICB2YXIgX3N0cm9rZSA9IGUuZGF0YS5zdHJva2VXaWR0aCB8fCAwO1xuICAgICAgaWYgKGUuZGF0YS5sZWZ0KSB7XG4gICAgICAgIF94ICs9IChlLmRhdGEubGVmdCArIF9zdHJva2UpIC8gdGhpcy52aWV3cG9ydFRyYW5zZm9ybVswXTtcbiAgICAgIH1cbiAgICAgIGlmIChlLmRhdGEudG9wKSB7XG4gICAgICAgIF95ICs9IChlLmRhdGEudG9wICsgX3N0cm9rZSkgLyB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzNdO1xuICAgICAgfVxuXG5cbiAgICAgIGUuZGF0YSA9IGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoe30sIGUuZGF0YSwge1xuICAgICAgICBzY2FsZVg6IF9zY2FsZVgsXG4gICAgICAgIHNjYWxlWTogX3NjYWxlWSxcbiAgICAgICAgbGVmdDogX3gsXG4gICAgICAgIHRvcDogX3ksXG4gICAgICAgIHdpZHRoOiBfdyxcbiAgICAgICAgaGVpZ2h0OiBfaCxcbiAgICAgICAgb3JpZ2luYWxXaWR0aDogZS5kYXRhLndpZHRoLFxuICAgICAgICBvcmlnaW5hbEhlaWdodDogZS5kYXRhLmhlaWdodFxuICAgICAgfSk7XG5cbiAgICAgIHRoaXMuZmlyZShcImJlZm9yZTpkcm9wXCIsZSk7XG5cbiAgICAgIGUudGFyZ2V0ID0gdGhpcy5maW5kVGFyZ2V0KGUub3JpZ2luYWxFdmVudCk7XG4gICAgICBpZiAoZS50YXJnZXQgJiYgIXRoaXMuaXNEcmF3aW5nTW9kZSkge1xuICAgICAgICAvLyBUbyB1bmlmeSB0aGUgYmVoYXZpb3IsIHRoZSBvYmplY3QncyBkb3VibGUgY2xpY2sgZXZlbnQgZG9lcyBub3QgZmlyZSBvbiBkcmF3aW5nIG1vZGUuXG4gICAgICAgIGUudGFyZ2V0LmZpcmUoJ29iamVjdDpkcm9wJywgZSk7XG4gICAgICB9XG5cblxuICAgICAgaWYgKGUudGFyZ2V0ICYmIGUudGFyZ2V0LmRyb3BwYWJsZSkge1xuICAgICAgICBpZiAodGhpcy5pc0Ryb3BBdmFpbGFibGUoZS50YXJnZXQuZHJvcHBhYmxlLCBlLmRhdGEpKSB7XG4gICAgICAgICAgZS50YXJnZXQuZGVhY3RpdmF0ZSgpO1xuICAgICAgICAgIGUudGFyZ2V0LmRyb3AoZS5kYXRhKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKHRoaXMuZHJvcHBhYmxlICYmIHRoaXMuaXNEcm9wQXZhaWxhYmxlKHRoaXMuZHJvcHBhYmxlLCBlLmRhdGEpKSB7XG4gICAgICAgICAgdGhpcy5kcm9wKGUuZGF0YSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgICB0aGlzLm9uKFwibW91c2U6ZHJhZ2VudGVyXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICBpZiAoZS50YXJnZXQgJiYgZS50YXJnZXQuZHJvcHBhYmxlKSB7XG4gICAgICAgIGlmICh0aGlzLmlzRHJvcEF2YWlsYWJsZShlLnRhcmdldC5kcm9wcGFibGUsIGUuZGF0YSkpIHtcbiAgICAgICAgICBlLnRhcmdldC5hY3RpdmF0ZSgpO1xuICAgICAgICAgIGUuZS5oZWxwZXIuY3NzKFwiY3Vyc29yXCIsIFwiYWxpYXNcIik7XG4gICAgICAgICAgdGhpcy5zZXRDdXJzb3IoXCJhbGlhc1wiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBlLmUuaGVscGVyLmNzcyhcImN1cnNvclwiLCBcIm5vdC1hbGxvd2VkXCIpO1xuICAgICAgICAgIHRoaXMuc2V0Q3Vyc29yKFwibm90LWFsbG93ZWRcIik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgICB0aGlzLm9uKFwibW91c2U6ZHJhZ2xlYXZlXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICBpZiAoZS50YXJnZXQgJiYgZS50YXJnZXQuZHJvcHBhYmxlKSB7XG4gICAgICAgIGlmICh0aGlzLmlzRHJvcEF2YWlsYWJsZShlLnRhcmdldC5kcm9wcGFibGUsIGUuZGF0YSkpIHtcbiAgICAgICAgICB0aGlzLl9hY3RpdmF0ZWQgPSBmYWxzZTtcbiAgICAgICAgICBlLnRhcmdldC5kZWFjdGl2YXRlKClcbiAgICAgICAgfVxuICAgICAgICBlLmUuaGVscGVyLmNzcyhcImN1cnNvclwiLCBcInBvaW50ZXJcIik7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cbn0pO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9tb2R1bGVzL2Ryb3BwYWJsZS5qcyIsIid1c2Ugc3RyaWN0JztcblxuXG5mYWJyaWMuR3VpZGxpbmUgPSBmYWJyaWMudXRpbC5jcmVhdGVDbGFzcyhmYWJyaWMuT2JqZWN0LHtcbiAgdG9wIDogMCxcbiAgbGVmdCA6IDAsXG4gIGhlaWdodCA6IDEsXG4gIHdpZHRoIDogMSxcbiAgZ3JpZGRhYmxlOiBmYWxzZSxcbiAgcmVzcG9uc2l2ZUJvcmRlcnMgOiB0cnVlLFxuICBncm91cFNlbGVjdGFibGUgOiBmYWxzZSxcbiAgaGFzQ29udHJvbHMgOiBmYWxzZSxcbiAgaGFzQm9yZGVycyA6IGZhbHNlLFxuICB3aG9sZUNvb3JkaW5hdGVzIDogdHJ1ZSxcbiAgc3RvcmVkOiBmYWxzZSxcbiAgbW92ZW1lbnRMaW1pdHM6IFwiI19fMFwiLFxuICBpbml0aWFsaXplOiBmdW5jdGlvbihvcHRpb25zKXtcbiAgICB0aGlzLnggPSBNYXRoLnJvdW5kKG9wdGlvbnMueCk7XG4gICAgdGhpcy55ID0gTWF0aC5yb3VuZChvcHRpb25zLnkpO1xuXG4gICAgaWYodGhpcy54KXtcbiAgICAgIHRoaXMubG9ja01vdmVtZW50WSA9IHRydWU7XG4gICAgICB0aGlzLmhvdmVyQ3Vyc29yID0gXCJldy1yZXNpemVcIjtcbiAgICB9XG5cbiAgICBpZih0aGlzLnkpe1xuICAgICAgdGhpcy5sb2NrTW92ZW1lbnRYID0gdHJ1ZTtcbiAgICAgIHRoaXMuaG92ZXJDdXJzb3IgPSBcIm5zLXJlc2l6ZVwiO1xuICAgIH1cblxuICAgIHRoaXMub24oe1xuICAgICAgXCJyZW1vdmVkXCI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGkgPSB0aGlzLmNhbnZhcy5ndWlkbGluZXMuaW5kZXhPZih0aGlzKTtcbiAgICAgICAgdGhpcy5jYW52YXMuZ3VpZGxpbmVzLnNwbGljZShpLDEpXG4gICAgICB9LFxuICAgICAgXCJtb2RpZmllZFwiOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmKHRoaXMueCl7XG4gICAgICAgICAgdGhpcy54ID0gdGhpcy5sZWZ0ICsgdGhpcy53aWR0aCAvIDI7XG4gICAgICAgIH1cbiAgICAgICAgaWYodGhpcy55KXtcbiAgICAgICAgICB0aGlzLnkgPSB0aGlzLnRvcCArIHRoaXMuaGVpZ2h0IC8gMjtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIFwiZGJsY2xpY2tcIjogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnJlbW92ZSgpO1xuICAgICAgfSxcbiAgICAgIFwiYWRkZWRcIjogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy54KSB7XG4gICAgICAgICAgdGhpcy5oZWlnaHQgPSB0aGlzLmNhbnZhcy5oZWlnaHQ7XG4gICAgICAgICAgdGhpcy53aWR0aCA9IE1hdGguY2VpbCgxMCAvIHRoaXMuY2FudmFzLnZpZXdwb3J0VHJhbnNmb3JtWzBdKTtcbiAgICAgICAgICBpZih0aGlzLndpZHRoICUgMil7XG4gICAgICAgICAgICB0aGlzLndpZHRoKys7XG4gICAgICAgICAgfVxuICAgICAgICAgIHRoaXMubGVmdCA9IHRoaXMueCAtIHRoaXMud2lkdGggLzI7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMueSkge1xuICAgICAgICAgIHRoaXMud2lkdGggPSB0aGlzLmNhbnZhcy53aWR0aDtcbiAgICAgICAgICB0aGlzLmhlaWdodCA9IE1hdGguY2VpbCgxMCAvIHRoaXMuY2FudmFzLnZpZXdwb3J0VHJhbnNmb3JtWzBdKTtcbiAgICAgICAgICBpZih0aGlzLmhlaWdodCAlIDIpe1xuICAgICAgICAgICAgdGhpcy5oZWlnaHQrKztcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy50b3AgPSB0aGlzLnkgLSB0aGlzLmhlaWdodCAvMjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNldENvb3JkcygpO1xuICAgICAgICBpZih0aGlzLmNhbnZhcy5ndWlkbGluZXMpe1xuICAgICAgICAgIHRoaXMuY2FudmFzLmd1aWRsaW5lcy5wdXNoKHRoaXMpO1xuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICB0aGlzLnZpc2libGUgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuXG4gIH0sXG4gIHJlbmRlcjogZnVuY3Rpb24oY3R4KXtcbiAgICBjdHguc2F2ZSgpO1xuXG4gICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgIGN0eC5zdHJva2VTdHlsZSA9IFwiIzAwMDAwMFwiO1xuICAgIGlmKHRoaXMueCl7XG4gICAgICBjdHgudHJhbnNsYXRlKHRoaXMubGVmdCArIHRoaXMud2lkdGggLyAyLDApO1xuICAgICAgY3R4LnNjYWxlKDEgLyB0aGlzLmNhbnZhcy5nZXRab29tKCksIDEgLyB0aGlzLmNhbnZhcy5nZXRab29tKCkpO1xuICAgICAgY3R4Lm1vdmVUbygwLDApO1xuICAgICAgY3R4LmxpbmVUbygwLHRoaXMuY2FudmFzLmhlaWdodCk7XG4gICAgfVxuICAgIGlmKHRoaXMueSkge1xuICAgICAgY3R4LnRyYW5zbGF0ZSgwLCB0aGlzLnRvcCArIHRoaXMuaGVpZ2h0IC8gMik7XG4gICAgICBjdHguc2NhbGUoMSAvIHRoaXMuY2FudmFzLmdldFpvb20oKSwgMSAvIHRoaXMuY2FudmFzLmdldFpvb20oKSk7XG4gICAgICBjdHgubW92ZVRvKDAsIDApO1xuICAgICAgY3R4LmxpbmVUbyh0aGlzLmNhbnZhcy53aWR0aCwgMCk7XG4gICAgfVxuICAgIGN0eC5zdHJva2UoKTtcbiAgICBjdHgucmVzdG9yZSgpO1xuICB9XG59KTtcblxuZmFicmljLlJ1bGVyID0gZmFicmljLnV0aWwuY3JlYXRlQ2xhc3Moe1xuICBpbml0aWFsaXplOiBmdW5jdGlvbiAob3B0aW9ucykge1xuXG4gICAgdGhpcy5jYW52YXMgPW9wdGlvbnMuY2FudmFzO1xuICAgIHRoaXMudHlwZSA9IG9wdGlvbnMudHlwZTtcbiAgICBpZihvcHRpb25zLnNpemUpdGhpcy5zaXplID0gb3B0aW9ucy5zaXplO1xuICAgIHZhciBzaXplO1xuICAgIGlmIChvcHRpb25zLnR5cGUgPT0gXCJ2ZXJ0aWNhbFwiKSB7XG4gICAgICBzaXplID0ge1xuICAgICAgICB3aWR0aDogdGhpcy5zaXplLFxuICAgICAgICBoZWlnaHQ6IHRoaXMuY2FudmFzLmhlaWdodFxuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2l6ZSA9IHtcbiAgICAgICAgd2lkdGg6IHRoaXMuY2FudmFzLndpZHRoLFxuICAgICAgICBoZWlnaHQ6IHRoaXMuc2l6ZVxuICAgICAgfTtcbiAgICB9XG5cbiAgICB0aGlzLmNhbnZhc0VsZW1lbnQgPSBmYWJyaWMudXRpbC5jcmVhdGVDYW52YXNFbGVtZW50V2l0aFNpemUoc2l6ZSk7XG4gICAgdGhpcy5jYW52YXMud3JhcHBlckVsLmFwcGVuZENoaWxkKHRoaXMuY2FudmFzRWxlbWVudCk7XG4gICAgdGhpcy5ydWxlckNvbnRleHQgPSB0aGlzLmNhbnZhc0VsZW1lbnQuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICAvLyB0aGlzLnJ1bGVyQ29udGV4dC50cmFuc2xhdGUoLTAuNSwtMC41KTtcbiAgICB3aW5kb3cucnVsZXJDb250ZXh0ID0gdGhpcy5ydWxlckNvbnRleHQ7XG4gICAgdGhpcy5ydWxlckNvbnRleHQuaW1hZ2VTbW9vdGhpbmdFbmFibGVkID0gZmFsc2U7XG4gICAgdGhpcy5yZW5kZXIoKTtcbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgIHRoaXMuY2FudmFzLm9uKHtcbiAgICAgICd2aWV3cG9ydDpzY2FsZWQgY2hhbmdlZCBtb2RpZmllZCcgOiBmdW5jdGlvbigpe1xuICAgICAgICBfdGhpcy5yZW5kZXIoKTtcbiAgICAgIH1cbiAgICB9KVxuXG4gIH0sXG4gIHNpemU6IDMwLFxuICBvcmllbnRhdGlvbjogXCJyZXZlcnRcIixcbiAgZm9udDogXCIxMHB4IE9wZW4gU2Fuc1wiLFxuICBkZWxpbWV0ZXJzOiBbNTAsIDEwLCA1LCAxXSxcbiAgcmVuZGVyOiBmdW5jdGlvbiAoKSB7XG5cblxuICAgIHZhciB2ID0gdGhpcy50eXBlID09IFwidmVydGljYWxcIjtcbiAgICB2YXIgc2NhbGUgPSB0aGlzLmNhbnZhcy5nZXRab29tKCk7XG4gICAgdmFyIF9jdHggPSB0aGlzLnJ1bGVyQ29udGV4dDtcblxuICAgIF9jdHgubW96SW1hZ2VTbW9vdGhpbmdFbmFibGVkID0gZmFsc2U7XG5cbiAgICBfY3R4LmNsZWFyUmVjdCgwLCAwLCB0aGlzLmNhbnZhc0VsZW1lbnQud2lkdGgsIHRoaXMuY2FudmFzRWxlbWVudC5oZWlnaHQpO1xuICAgIGlmKHYpIHtcbiAgICAgIHRoaXMuY2FudmFzRWxlbWVudC5oZWlnaHQgPSB0aGlzLmNhbnZhcy5oZWlnaHQ7XG4gICAgICBfY3R4LnRleHRBbGlnbiA9ICdlbmQnO1xuICAgIH1lbHNle1xuICAgICAgdGhpcy5jYW52YXNFbGVtZW50LndpZHRoID0gdGhpcy5jYW52YXMud2lkdGg7XG4gICAgfVxuXG4gICAgdmFyIF90aGlzID0gdGhpcztcbiAgICBmdW5jdGlvbiBwdXNoKGgpe1xuICAgICAgdmFyIF94ID0gTWF0aC5yb3VuZCggbCAqIHNjYWxlKTtcbiAgICAgIGlmKGZhbHNlKXtcbiAgICAgICAgdmFyIHgxID0gMDtcbiAgICAgICAgdmFyIHgyID0gaDtcbiAgICAgIH1lbHNle1xuICAgICAgICB2YXIgeDEgPSBfdGhpcy5zaXplO1xuICAgICAgICB2YXIgeDIgPSBfdGhpcy5zaXplIC0gaDtcbiAgICAgIH1cbiAgICAgIGlmKHYpe1xuICAgICAgICBfY3R4Lm1vdmVUbyh4MSxfeCk7XG4gICAgICAgIF9jdHgubGluZVRvKHgyLCBfeCk7XG4gICAgICB9IGVsc2V7XG4gICAgICAgIF9jdHgubW92ZVRvKF94LHgxKTtcbiAgICAgICAgX2N0eC5saW5lVG8oX3gseDIpO1xuICAgICAgfVxuICAgICAgX2N0eC5zdHJva2UoKTtcbiAgICB9XG4gICAgdmFyIHcgPSAoIHYgPyB0aGlzLmNhbnZhcy5oZWlnaHQgOiB0aGlzLmNhbnZhcy53aWR0aCkgLyBzY2FsZTtcbiAgICB2YXIgX2RlbCA9IFtdLCBfbGFiZWxzID0gW107XG4gICAgdmFyIGkgPSAwLCBqID0gMCwgayA9IDAsIGwgPSAwLCBkID0gdGhpcy5kZWxpbWV0ZXJzLCBtO1xuXG4gICAgZm9yIChpID0gMDsgaSA8IHcgLyBkWzBdOyBpKyspIHtcbiAgICAgIGsgPSAwO1xuICAgICAgaiA9IDA7XG4gICAgICBsID0gaSAqIGRbMF0gKyBqICogZFsxXSArIGsgKiBkWzJdO1xuICAgICAgaWYgKGwgPj0gdylicmVhaztcbiAgICAgIHB1c2goMTApO1xuXG4gICAgICBfY3R4LmZvbnQgPSB0aGlzLmZvbnQ7XG4gICAgICBpZiAodikge1xuICAgICAgICBfY3R4LnN0cm9rZVRleHQobCxfdGhpcy5zaXplIC0gNixsICogc2NhbGUgKyAxMik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBfY3R4LnN0cm9rZVRleHQobCxsICogc2NhbGUgKyAyLF90aGlzLnNpemUgLSA4ICk7XG4gICAgICB9XG5cbiAgICAgIGlmIChzY2FsZSA+IDEpIHtcblxuICAgICAgICBmb3IgKGogPSAwOyBqIDwgZFswXSAvIGRbMV07IGorKykge1xuICAgICAgICAgIGsgPSAwO1xuICAgICAgICAgIGwgPSBpICogZFswXSArIGogKiBkWzFdICsgayAqIGRbMl07XG4gICAgICAgICAgaWYgKGwgPj0gdylicmVhaztcbiAgICAgICAgICBwdXNoKDcpO1xuXG5cbiAgICAgICAgICBpZiAoc2NhbGUgPiAyKSB7XG4gICAgICAgICAgICBmb3IgKGsgPSAwOyBrIDwgZFsxXSAvIGRbMl07IGsrKykge1xuICAgICAgICAgICAgICBsID0gaSAqIGRbMF0gKyBqICogZFsxXSArIGsgKiBkWzJdO1xuICAgICAgICAgICAgICBpZiAobCA+PSB3KWJyZWFrO1xuICAgICAgICAgICAgICBwdXNoKDQpO1xuICAgICAgICAgICAgfVxuXG5cbiAgICAgICAgICAgIGlmIChzY2FsZSA+IDUpIHtcblxuICAgICAgICAgICAgICBmb3IgKG0gPSAwOyBtIDwgZFsyXSAvIGRbM107IG0rKykge1xuICAgICAgICAgICAgICAgIGZvciAoayA9IDA7IGsgPCBkWzFdIC8gZFsyXTsgaysrKSB7XG4gICAgICAgICAgICAgICAgICBsID0gaSAqIGRbMF0gKyBqICogZFsxXSArIGsgKiBkWzJdICsgbSAqIGRbM107XG4gICAgICAgICAgICAgICAgICBpZiAobCA+PSB3KWJyZWFrO1xuICAgICAgICAgICAgICAgICAgcHVzaCgyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5fZWxlbWVudHMgPSBfZGVsO1xuICAgIHRoaXMuX2xhYmVscyA9IF9sYWJlbHM7XG4gICAgX2N0eC5zdHJva2UoKTtcbiAgfVxufSk7XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLlN0YXRpY0NhbnZhcy5wcm90b3R5cGUse1xuICBndWlkbGluZXNFbmFibGVkOiBmYWxzZSxcbiAgY3JlYXRlR3VpZGxpbmU6IGZ1bmN0aW9uKGRhdGEpe1xuICAgIGlmKGRhdGEueSAhPT0gdW5kZWZpbmVkKXtcbiAgICAgIGlmKGZhYnJpYy5HdWlkbGluZS5wcm90b3R5cGUud2hvbGVDb29yZGluYXRlcyl7XG4gICAgICAgIGRhdGEueSA9IGRhdGEueSAmJiBNYXRoLnJvdW5kKGRhdGEueSk7XG4gICAgICB9XG4gICAgICBpZighZmFicmljLnV0aWwub2JqZWN0LmZpbmRXaGVyZSh0aGlzLmd1aWRsaW5lcyx7eTogZGF0YS55fSkpe1xuICAgICAgICB2YXIgZ2wgPSBuZXcgZmFicmljLkd1aWRsaW5lKHt5OiBkYXRhLnl9KTtcbiAgICAgICAgdGhpcy5hZGQoZ2wpO1xuICAgICAgfVxuICAgIH1lbHNlIGlmKGRhdGEueCAhPT0gdW5kZWZpbmVkKXtcbiAgICAgIGlmKGZhYnJpYy5HdWlkbGluZS5wcm90b3R5cGUud2hvbGVDb29yZGluYXRlcyl7XG4gICAgICAgIGRhdGEueCA9IGRhdGEueCAmJiBNYXRoLnJvdW5kKGRhdGEueCk7XG4gICAgICB9XG4gICAgICBpZighZmFicmljLnV0aWwub2JqZWN0LmZpbmRXaGVyZSh0aGlzLmd1aWRsaW5lcyx7eDogZGF0YS54fSkpe1xuICAgICAgICB2YXIgZ2wgPSBuZXcgZmFicmljLkd1aWRsaW5lKHt4OiBkYXRhLnh9KTtcbiAgICAgICAgdGhpcy5hZGQoZ2wpO1xuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgc2V0R3VpZGxpbmVzOiBmdW5jdGlvbihndWlkbGluZXMpe1xuICAgIHRoaXMuZ3VpZGxpbmVzID0gZ3VpZGxpbmVzO1xuICAgIGlmKGd1aWRsaW5lcyAmJiB0aGlzLmd1aWRsaW5lc0VuYWJsZWQpe1xuICAgICAgLy8gdGhpcy5ndWlkbGluZXMgPSBbXTtcbiAgICAgIGZvcih2YXIgaSBpbiBndWlkbGluZXMpe1xuICAgICAgICB0aGlzLmNyZWF0ZUd1aWRsaW5lKGd1aWRsaW5lc1tpXSlcbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIHNldFJ1bGVyczogZnVuY3Rpb24odmFsdWUpe1xuICAgIGlmKCF2YWx1ZSl7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMucnVsZXJzID0gdHJ1ZTtcbiAgICB0aGlzLnZSdWxlciA9IG5ldyBmYWJyaWMuUnVsZXIoe1xuICAgICAgY2FudmFzOiB0aGlzLFxuICAgICAgdHlwZTogXCJ2ZXJ0aWNhbFwiXG4gICAgfSk7XG4gICAgdGhpcy5oUnVsZXIgPSBuZXcgZmFicmljLlJ1bGVyKHtcbiAgICAgIGNhbnZhczogdGhpcyxcbiAgICAgIHR5cGU6IFwiaG9yaXpvbnRhbFwiXG4gICAgfSk7XG5cbiAgICB0aGlzLmhSdWxlci5jYW52YXNFbGVtZW50LnN0eWxlLnBvc2l0aW9uID0gXCJhYnNvbHV0ZVwiO1xuICAgIHRoaXMuaFJ1bGVyLmNhbnZhc0VsZW1lbnQuc3R5bGUubGVmdCA9IDA7XG4gICAgdGhpcy5oUnVsZXIuY2FudmFzRWxlbWVudC5zdHlsZS5ib3R0b20gPSBcIjEwMCVcIjtcbiAgICB0aGlzLnZSdWxlci5jYW52YXNFbGVtZW50LnN0eWxlLnBvc2l0aW9uID0gXCJhYnNvbHV0ZVwiO1xuICAgIHRoaXMudlJ1bGVyLmNhbnZhc0VsZW1lbnQuc3R5bGUudG9wID0gMDtcbiAgICB0aGlzLnZSdWxlci5jYW52YXNFbGVtZW50LnN0eWxlLnJpZ2h0ID0gXCIxMDAlXCI7XG5cblxuICAgIHRoaXMuZ3VpZGxpbmVzID0gW107XG5cblxuICAgIHZhciBfY2FudmFzID0gdGhpcztcblxuICAgIHRoaXMub24oJ3ZpZXdwb3J0OnNjYWxlZCcsIGZ1bmN0aW9uKCl7XG5cbiAgICAgIHRoaXMuZ3VpZGxpbmVzLmZvckVhY2goZnVuY3Rpb24oZ2wpe1xuICAgICAgICBpZihnbC54KXtcbiAgICAgICAgICBnbC53aWR0aCA9IE1hdGguY2VpbCgxMCAvIGdsLmNhbnZhcy52aWV3cG9ydFRyYW5zZm9ybVswXSk7XG4gICAgICAgICAgaWYoZ2wud2lkdGggJSAyKXtcbiAgICAgICAgICAgIGdsLndpZHRoKys7XG4gICAgICAgICAgfVxuICAgICAgICAgIGdsLmxlZnQgPSBnbC54IC0gZ2wud2lkdGgvMjtcbiAgICAgICAgfVxuICAgICAgICBpZihnbC55KXtcbiAgICAgICAgICBnbC5oZWlnaHQgPSBNYXRoLmNlaWwoMTAgLyBnbC5jYW52YXMudmlld3BvcnRUcmFuc2Zvcm1bMF0pO1xuICAgICAgICAgIGlmKGdsLmhlaWdodCAlIDIpe1xuICAgICAgICAgICAgZ2wuaGVpZ2h0Kys7XG4gICAgICAgICAgfVxuICAgICAgICAgIGdsLnRvcCA9IGdsLnkgLSBnbC5oZWlnaHQvMjtcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9KTtcblxuXG4gICAgdGhpcy5oUnVsZXIuY2FudmFzRWxlbWVudC5vbmNsaWNrICA9IGZ1bmN0aW9uKGUpe1xuICAgICAgdmFyIHBvaW50ZXIgPSBfY2FudmFzLmdldFBvaW50ZXIoZSk7XG4gICAgICBfY2FudmFzLmNyZWF0ZUd1aWRsaW5lKHt4IDogcG9pbnRlci54IH0pXG4gICAgfTtcblxuXG4gICAgdGhpcy52UnVsZXIuY2FudmFzRWxlbWVudC5vbmNsaWNrICA9IGZ1bmN0aW9uKGUpe1xuICAgICAgdmFyIHBvaW50ZXIgPSBfY2FudmFzLmdldFBvaW50ZXIoZSk7XG5cbiAgICAgIF9jYW52YXMuY3JlYXRlR3VpZGxpbmUoe3kgOiBwb2ludGVyLnkgfSlcbiAgICB9O1xuICB9XG59KTtcblxuLypcbmZhYnJpYy5TbGlkZUNhbnZhcy5hZGRQbHVnaW4oXCJzYXZlcnNcIixmdW5jdGlvbihwcm9wZXJ0aWVzVG9JbmNsdWRlLCBfZGF0YSl7XG4gIGlmKHByb3BlcnRpZXNUb0luY2x1ZGUuaW5kZXhPZignZ3VpZGxpbmVzJykgIT09IC0xICYmIHRoaXMuZ3VpZGxpbmVzKSB7XG4gICAgX2RhdGEuZ3VpZGxpbmVzID0gW107XG4gICAgdGhpcy5ndWlkbGluZXMuZm9yRWFjaChmdW5jdGlvbihfZ2wpe1xuICAgICAgaWYoX2dsLngpe1xuICAgICAgICBfZGF0YS5ndWlkbGluZXMucHVzaCh7eCA6IF9nbC54IH0pXG4gICAgICB9XG4gICAgICBpZihfZ2wueSl7XG4gICAgICAgIF9kYXRhLmd1aWRsaW5lcy5wdXNoKHt5IDogX2dsLnkgfSlcbiAgICAgIH1cbiAgICB9KVxuICB9XG59KTsqL1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9tb2R1bGVzL3J1bGVyLmpzIiwiJ3VzZSBzdHJpY3QnO1xuXG5cbi8vdmFyIF9zZXRfYmFja2dyb3VuZF9pbWFnZV9vdmVyd3JpdHRlbiA9IGZhYnJpYy5DYW52YXMucHJvdG90eXBlLnNldEJhY2tncm91bmRJbWFnZTtcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuU3RhdGljQ2FudmFzLnByb3RvdHlwZSwge1xuICAvKipcbiAgICogYmFja2dyb3VuZFBvc2l0aW9uXG4gICAqIEB2YWx1ZXMgbWFudWFsIHwgY292ZXIgfCBmaXRcbiAgICovXG4gIGJhY2tncm91bmRQb3NpdGlvbjogJ21hbnVhbCcsXG4gIHNldEJhY2tncm91bmRQb3NpdGlvbjogZnVuY3Rpb24gKHNyYykge1xuICAgIHRoaXMuYmFja2dyb3VuZFBvc2l0aW9uID0gc3JjO1xuICAgIHRoaXMuX3VwZGF0ZV9iYWNrZ3JvdW5kX2ltYWdlKCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG4gIG9mZnNldHM6IHtcbiAgICBsZWZ0OiAwLFxuICAgIHJpZ2h0OiAwLFxuICAgIGJvdHRvbTogMCxcbiAgICB0b3A6IDBcbiAgfSxcblxuICAvLyBzZXRCYWNrZ3JvdW5kSW1hZ2U6IGZ1bmN0aW9uIChzcmMsIGNhbGxiYWNrLCBvcHRpb25zKSB7XG4gIC8vXG4gIC8vICAgX3NldF9iYWNrZ3JvdW5kX2ltYWdlX292ZXJ3cml0dGVuLmNhbGwodGhpcywgc3JjLCBmdW5jdGlvbiAoKSB7XG4gIC8vICAgICB0aGlzLl91cGRhdGVfYmFja2dyb3VuZF9pbWFnZSgpO1xuICAvLyAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2sodGhpcy5iYWNrZ3JvdW5kSW1hZ2UpO1xuICAvLyAgIH0uYmluZCh0aGlzKSwgb3B0aW9ucyk7XG4gIC8vICAgcmV0dXJuIHRoaXM7XG4gIC8vIH0sXG4gIGZpbGxCYWNrZ3JvdW5kQ29sb3JPdmVyQ2FudmFzOiBmYWxzZSxcbiAgX3JlbmRlckJhY2tncm91bmRPck92ZXJsYXk6IGZ1bmN0aW9uKGN0eCwgcHJvcGVydHkpIHtcbiAgICB2YXIgb2JqZWN0ID0gdGhpc1twcm9wZXJ0eSArICdDb2xvciddO1xuICAgIGlmIChvYmplY3QpIHtcbiAgICAgIGN0eC5maWxsU3R5bGUgPSBvYmplY3QudG9MaXZlXG4gICAgICAgID8gb2JqZWN0LnRvTGl2ZShjdHgpXG4gICAgICAgIDogb2JqZWN0O1xuXG4gICAgICBpZighdGhpcy5maWxsQmFja2dyb3VuZENvbG9yT3ZlckNhbnZhcyl7XG4gICAgICAgIC8vdG9kbyBkbyEhIVxuICAgICAgICBjdHguZmlsbFJlY3QoXG4gICAgICAgICAgb2JqZWN0Lm9mZnNldFh8fCAgdGhpcy52aWV3cG9ydFRyYW5zZm9ybVs0XSAqIHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bMF0sXG4gICAgICAgICAgb2JqZWN0Lm9mZnNldFl8fCAgdGhpcy52aWV3cG9ydFRyYW5zZm9ybVs1XSAqIHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bMF0sXG4gICAgICAgICAgdGhpcy53aWR0aCAqdGhpcy52aWV3cG9ydFRyYW5zZm9ybVswXSxcbiAgICAgICAgICB0aGlzLmhlaWdodCAqIHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bMF0pO1xuICAgICAgfWVsc2V7XG4gICAgICAgIGN0eC5maWxsUmVjdChcblxuICAgICAgICAgIG9iamVjdC5vZmZzZXRYIHx8IDAsXG4gICAgICAgICAgb2JqZWN0Lm9mZnNldFkgfHwgMCxcbiAgICAgICAgICB0aGlzLm9yaWdpbmFsV2lkdGggLFxuICAgICAgICAgIHRoaXMub3JpZ2luYWxIZWlnaHQpO1xuICAgICAgfVxuICAgIH1cbiAgICBvYmplY3QgPSB0aGlzW3Byb3BlcnR5ICsgJ0ltYWdlJ107XG4gICAgaWYob2JqZWN0ICYmIG9iamVjdC5jb25zdHJ1Y3RvciAhPT0gU3RyaW5nICYmICBvYmplY3QuY29uc3RydWN0b3IgIT09IE9iamVjdCl7XG4gICAgICAgIG9iamVjdC5yZW5kZXIoY3R4KTtcbiAgICB9XG4gIH0sXG4gIGdldEltYWdlRGF0YTogZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICBvcHRpb25zID0gZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCh7XG4gICAgICBjbGlwcGVkX2FyZWE6IGZhbHNlLFxuICAgICAgY2xpcHBlZF9hcmVhX29ubHk6IGZhbHNlLFxuICAgICAgZHJhd19iYWNrZ3JvdW5kOiB0cnVlLFxuICAgICAgZm9ybWF0OiAncG5nJyxcbiAgICAgIHF1YWxpdHk6IDAuOFxuICAgIH0sIG9wdGlvbnMgfHwge30pO1xuXG4gICAgdmFyIHNpemU7XG4gICAgaWYgKG9wdGlvbnMuY2xpcHBlZF9hcmVhKSB7XG4gICAgICBzaXplID0gb3B0aW9ucy5jbGlwcGVkX2FyZWEuZ2V0Qm91bmRpbmdSZWN0KCk7XG4gICAgICB2YXIgX3pvb20gPSB0aGlzLmdldFpvb20oKTtcbiAgICAgIHNpemUubGVmdCAgIC89IF96b29tO1xuICAgICAgc2l6ZS50b3AgICAgLz0gX3pvb207XG4gICAgICBzaXplLndpZHRoICAvPSBfem9vbTtcbiAgICAgIHNpemUuaGVpZ2h0IC89IF96b29tO1xuICAgICAgZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChvcHRpb25zLCBzaXplKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2l6ZSA9IHtcbiAgICAgICAgd2lkdGg6IG9wdGlvbnMud2lkdGggfHwgdGhpcy5vcmlnaW5hbFdpZHRoIHx8IHRoaXMud2lkdGgsXG4gICAgICAgIGhlaWdodDogb3B0aW9ucy5oZWlnaHQgfHwgdGhpcy5vcmlnaW5hbEhlaWdodCB8fCB0aGlzLmhlaWdodCxcbiAgICAgIH07XG5cbiAgICAgIGlmIChvcHRpb25zLmNsaXBwZWRfYXJlYV9vbmx5KSB7XG4gICAgICAgIHNpemUud2lkdGggLT0gdGhpcy5vZmZzZXRzLmxlZnQgKyB0aGlzLm9mZnNldHMucmlnaHQ7XG4gICAgICAgIHNpemUuaGVpZ2h0IC09IHRoaXMub2Zmc2V0cy50b3AgKyB0aGlzLm9mZnNldHMuYm90dG9tO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAob3B0aW9ucy56b29tKSB7XG4gICAgICBzaXplLndpZHRoICo9IG9wdGlvbnMuem9vbTtcbiAgICAgIHNpemUuaGVpZ2h0ICo9IG9wdGlvbnMuem9vbTtcbiAgICB9XG5cbiAgICB2YXIgY2FudmFzID0gZmFicmljLnV0aWwuY3JlYXRlQ2FudmFzRWxlbWVudCgpO1xuICAgIGNhbnZhcy53aWR0aCA9IHNpemUud2lkdGg7XG4gICAgY2FudmFzLmhlaWdodCA9IHNpemUuaGVpZ2h0O1xuXG4gICAgb3B0aW9ucy5sZWZ0ID0gTWF0aC5mbG9vcihvcHRpb25zLmxlZnQpO1xuICAgIG9wdGlvbnMudG9wID0gTWF0aC5mbG9vcihvcHRpb25zLnRvcCk7XG4gICAgb3B0aW9ucy5oZWlnaHQgPSBNYXRoLmNlaWwob3B0aW9ucy5oZWlnaHQpO1xuICAgIG9wdGlvbnMud2lkdGggPSBNYXRoLmNlaWwob3B0aW9ucy53aWR0aCk7XG5cbiAgICB0aGlzLnJlbmRlclRodW1iKGNhbnZhcywgb3B0aW9ucyk7XG5cbiAgICB2YXIgc3JjID0gY2FudmFzLnRvRGF0YVVSTChvcHRpb25zKTtcblxuICAgIHZhciBibG9iID0gZmFicmljLnV0aWwuZGF0YVVSSXRvQmxvYihzcmMsICdpbWFnZS8nICsgb3B0aW9ucy5mb3JtYXQpO1xuICAgIHZhciBvYmplY3RVUkwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpO1xuICAgIHJldHVybiB7XG4gICAgICBkYXRhVVJMOiBzcmMsXG4gICAgICBibG9iOiBibG9iLFxuICAgICAgdXJsOiBvYmplY3RVUkwsXG4gICAgICBjYW52YXM6IGNhbnZhc1xuICAgIH07XG4gIH0sXG4gIGdldE9yaWdpbmFsU2l6ZTogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB7XG4gICAgICB3aWR0aDogdGhpcy5vcmlnaW5hbFdpZHRoLFxuICAgICAgaGVpZ2h0OiB0aGlzLm9yaWdpbmFsSGVpZ2h0XG4gICAgfVxuICB9LFxuXG5cbiAgLy8gc2V0T2Zmc2V0czogZnVuY3Rpb24gKF9vZmZzZXRzKSB7XG4gIC8vICAgdGhpcy5vZmZzZXRzID0gX29mZnNldHMgfHwgZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCh7fSwgZmFicmljLlNsaWRlQ2FudmFzLnByb3RvdHlwZS5vZmZzZXRzKTtcbiAgLy8gICAvL3RoaXMuX3VwZGF0ZV9jbGlwX3JlY3QoKTtcbiAgLy8gICByZXR1cm4gdGhpcztcbiAgLy8gfSxcbiAgZ2V0UmVjdDogZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICB2YXIgcmVjdCA9IHt9O1xuXG4gICAgdmFyIF93ID0gdGhpcy5vcmlnaW5hbFdpZHRoIHx8IHRoaXMud2lkdGg7IC8vdGhpcy5vcmlnaW5hbFdpZHRoXG4gICAgdmFyIF9mbGV4QXJyYXkgPSBmYWJyaWMudXRpbC5mbGV4KF93ICwgW3t2YWx1ZTogb3B0aW9ucy5sZWZ0LCBmbGV4OiAwfSx7dmFsdWU6IG9wdGlvbnMud2lkdGgsIGZsZXg6IDF9LHt2YWx1ZTogb3B0aW9ucy5yaWdodCwgZmxleDogMH1dICk7XG4gICAgcmVjdC5sZWZ0ID0gX2ZsZXhBcnJheVswXTtcbiAgICByZWN0LndpZHRoID0gX2ZsZXhBcnJheVsxXTtcbiAgICByZWN0LnJpZ2h0ID0gX2ZsZXhBcnJheVsyXTtcblxuICAgIHZhciBfaCA9IHRoaXMub3JpZ2luYWxIZWlnaHR8fCB0aGlzLmhlaWdodDsgICAvL3RoaXMub3JpZ2luYWxIZWlnaHRcbiAgICB2YXIgX2ZsZXhBcnJheSA9IGZhYnJpYy51dGlsLmZsZXgoX2ggLCBbe3ZhbHVlOiBvcHRpb25zLnRvcCwgZmxleDogMH0se3ZhbHVlOiBvcHRpb25zLmhlaWdodCwgZmxleDogMX0se3ZhbHVlOiBvcHRpb25zLmJvdHRvbSwgZmxleDogMH1dICk7XG4gICAgcmVjdC50b3AgPSBfZmxleEFycmF5WzBdO1xuICAgIHJlY3QuaGVpZ2h0ID0gX2ZsZXhBcnJheVsxXTtcbiAgICByZWN0LmJvdHRvbSA9IF9mbGV4QXJyYXlbMl07XG5cbiAgICByZXR1cm4gcmVjdDtcbiAgfSxcbn0pO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9tb2R1bGVzL3JlbmRlci5qcyIsImZhYnJpYy51dGlsLmNyZWF0ZVRodW1iID0gZnVuY3Rpb24oc2xpZGUsICRlbCl7XG5cbiAgdmFyIF9jYW52YXMgPSBzbGlkZS5jYW52YXMsXG4gICAgICBmaXJzdERyYXcgPSB0cnVlLFxuICAgICAgbW9kaWZpZWQsXG4gICAgICBfdyA9ICskZWwuZ2V0QXR0cmlidXRlKFwid2lkdGhcIiksXG4gICAgICBfaCA9ICskZWwuZ2V0QXR0cmlidXRlKFwiaGVpZ2h0XCIpO1xuXG4gIGlmIChfaCkge1xuICAgICRlbC5zdHlsZS5oZWlnaHQgPSAkZWwuaGVpZ2h0O1xuICB9XG5cbiAgZnVuY3Rpb24gcmVuZGVyVGh1bWIoKSB7XG4gICAgaWYgKF9jYW52YXMucHJvY2Vzc2luZyB8fCAhX2NhbnZhcy5sb2FkZWQpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgX2NhbnZhcy5yZW5kZXJUaHVtYigkZWwpO1xuICAgIG1vZGlmaWVkID0gX2NhbnZhcy5tb2RpZmllZDtcbiAgfVxuXG4gIGZ1bmN0aW9uIGZvcmNlUmVuZGVyVGh1bWIoKSB7XG4gICAgaWYgKHRoaXMuY2FudmFzKSB7XG4gICAgICBpZiAodGhpcy5jYW52YXMubG9hZGVkKSB7XG4gICAgICAgIHRoaXMuY2FudmFzLnJlbmRlclRodW1iKCRlbCk7XG4gICAgICB9XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChmaXJzdERyYXcgJiYgdGhpcy5kYXRhLnRodW1iKSB7XG4gICAgICB2YXIgaW1nID0gbmV3IEltYWdlKCk7XG4gICAgICBpbWcub25sb2FkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgY3R4ID0gJGVsLmdldENvbnRleHQoXCIyZFwiKTtcbiAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCAkZWwud2lkdGgsICRlbC5oZWlnaHQpO1xuICAgICAgICBjdHguZHJhd0ltYWdlKGltZywgMCwgMCwgJGVsLndpZHRoLCAkZWwuaGVpZ2h0KTtcbiAgICAgICAgbW9kaWZpZWQgPSB0aGlzLm1vZGlmaWVkO1xuICAgICAgfTtcbiAgICAgIGltZy5zcmMgPSB0aGlzLmRhdGEudGh1bWI7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKGF0dHJzLmZvcmNlICE9PSBcInRydWVcIikgcmV0dXJuO1xuICAgIHZhciBjYW52YXMgPSBuZXcgZmFicmljLlNsaWRlQ2FudmFzKG51bGwsIHRoaXMuZGF0YSwgZnVuY3Rpb24gKCkge1xuICAgICAgY2FudmFzLnJlbmRlclRodW1iKCRlbCk7XG4gICAgICAvL21vZGlmaWVkID0gc2xpZGUubW9kaWZpZWQ7XG4gICAgfSk7XG4gIH1cblxuXG4gIGZ1bmN0aW9uIHNjYWxlVGh1bWIoKSB7XG5cbiAgICB2YXIgX2NvbnRhaW5lciA9IHtcbiAgICAgIHdpZHRoOiBfdyxcbiAgICAgIGhlaWdodDogX2gsXG4gICAgfTtcblxuICAgIHZhciBzaXplID0ge1xuICAgICAgd2lkdGg6IHNsaWRlLmNhbnZhcy5vcmlnaW5hbFdpZHRoIHx8IHNsaWRlLmNhbnZhcy53aWR0aCxcbiAgICAgIGhlaWdodDogc2xpZGUuY2FudmFzLm9yaWdpbmFsSGVpZ2h0IHx8IHNsaWRlLmNhbnZhcy5oZWlnaHRcbiAgICB9O1xuXG4gICAgdmFyIF9maXRTaXplID0gZmFicmljLnV0aWwuZ2V0UHJvcG9ydGlvbnMoIHNpemUsX2NvbnRhaW5lcixcImZpdFwiKTtcblxuICAgICRlbC53aWR0aCA9IF9maXRTaXplLndpZHRoO1xuICAgICRlbC5oZWlnaHQgPSBfZml0U2l6ZS5oZWlnaHQ7XG5cblxuICAgICRlbC5zdHlsZS53aWR0aCA9IF9maXRTaXplLndpZHRoICsgJ3B4JztcbiAgICAkZWwuc3R5bGUuaGVpZ2h0ID0gX2ZpdFNpemUuaGVpZ2h0ICArICdweCc7XG4gICAgcmVuZGVyVGh1bWIoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGNhbnZhc0NoYW5nZWQoKSB7XG4gICAgLy8gX2NhbnZhcyAmJiBfY2FudmFzLm9mZignYWZ0ZXI6cmVuZGVyJywgcmVuZGVyVGh1bWIpO1xuICAgIC8vIGlmICh0aGlzLmNhbnZhcykge1xuICAgICAgLy8gX2NhbnZhcyA9IHNjb3BlLmZmVGh1bWIuY2FudmFzO1xuICAgICAgdGhpcy5jYW52YXMub24oJ2FmdGVyOnJlbmRlcicsIHJlbmRlclRodW1iKTtcbiAgICAgIHRoaXMuY2FudmFzLm9uKFwiZGltZW5zaW9uczptb2RpZmllZFwiLCBzY2FsZVRodW1iKTtcbiAgICAgIHRoaXMuY2FudmFzLm9uKFwibG9hZGluZzplbmRcIiwgc2NhbGVUaHVtYik7XG4gICAgLy8gfVxuICB9XG5cblxuICAkZWwuc2V0QXR0cmlidXRlKFwidGl0bGVcIiwgc2xpZGUudGl0bGUpO1xuICBzbGlkZS5vbignY2FudmFzOmNoYW5nZWQnLCBjYW52YXNDaGFuZ2VkKTtcbiAgc2xpZGUub24oJ21vZGlmaWVkJywgZm9yY2VSZW5kZXJUaHVtYik7XG5cbiAgc2NhbGVUaHVtYi5jYWxsKHNsaWRlKTtcbiAgZm9yY2VSZW5kZXJUaHVtYi5jYWxsKHNsaWRlKTtcbiAgY2FudmFzQ2hhbmdlZC5jYWxsKHNsaWRlKTtcblxufTtcblxuXG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLlN0YXRpY0NhbnZhcy5wcm90b3R5cGUsIHtcbiAgcmVuZGVyVGh1bWI6IGZ1bmN0aW9uIChjYW52YXMsIG9wdGlvbnMpIHtcbiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7XG4gICAgICAgIG9iamVjdHM6IHRydWUsXG4gICAgICAgIGNsaXBwZWRfYXJlYV9vbmx5OiBmYWxzZSxcbiAgICAgICAgZHJhd19iYWNrZ3JvdW5kOiB0cnVlXG4gICAgICB9O1xuXG4gICAgaWYgKG9wdGlvbnMuem9vbSkge1xuICAgICAgdmFyIF96b29tID0gb3B0aW9ucy56b29tO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoY2FudmFzLndpZHRoKSB7XG4gICAgICAgIHZhciBfem9vbSA9IGNhbnZhcy53aWR0aCAvICh0aGlzLm9yaWdpbmFsV2lkdGggfHwgdGhpcy53aWR0aClcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciBfem9vbSA9IDE7XG4gICAgICB9XG4gICAgfVxuICAgIHZhciBfb2xkX1NjYWxlID0gdGhpcy52aWV3cG9ydFRyYW5zZm9ybVswXTtcbiAgICB2YXIgb2xkX3ggPSB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzRdO1xuICAgIHZhciBvbGRfeSA9IHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bNV07XG4gICAgdGhpcy52aWV3cG9ydFRyYW5zZm9ybVs0XSA9IHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bNV0gPSAwO1xuICAgIHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bMF0gPSB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzNdID0gMTtcblxuICAgIHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bMF0gPSB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzNdID0gX3pvb207XG4gICAgLy90aGlzLl91cGRhdGVfY2xpcF9yZWN0KCk7XG5cbiAgICBpZiAodGhpcy5jbGlwUmVjdCkge1xuICAgICAgdGhpcy5jbGlwUmVjdC5zZXRPcGFjaXR5KDApO1xuICAgIH1cblxuICAgIHZhciBzaXplID0ge1xuICAgICAgd2lkdGg6IHRoaXMub3JpZ2luYWxXaWR0aCB8fCB0aGlzLndpZHRoLFxuICAgICAgaGVpZ2h0OiB0aGlzLm9yaWdpbmFsSGVpZ2h0IHx8IHRoaXMuaGVpZ2h0XG4gICAgfTtcbiAgICBzaXplLndpZHRoID0gTWF0aC5jZWlsKHNpemUud2lkdGggKiBfem9vbSk7XG4gICAgc2l6ZS5oZWlnaHQgPSBNYXRoLmNlaWwoc2l6ZS5oZWlnaHQgKiBfem9vbSk7XG5cbiAgICB2YXIgX2NhbnZhcyA9IGZhYnJpYy51dGlsLmNyZWF0ZUNhbnZhc0VsZW1lbnQoKTtcbiAgICBfY2FudmFzLndpZHRoID0gc2l6ZS53aWR0aDtcbiAgICBfY2FudmFzLmhlaWdodCA9IHNpemUuaGVpZ2h0O1xuXG4gICAgdmFyIGNhbnZhc1RvRHJhd09uID0gX2NhbnZhcy5nZXRDb250ZXh0KCcyZCcpLCBvYmpzVG9SZW5kZXI7XG5cbiAgICB0aGlzLmNsZWFyQ29udGV4dChjYW52YXNUb0RyYXdPbik7XG4gICAgY2FudmFzVG9EcmF3T24uc2F2ZSgpO1xuICAgIGNhbnZhc1RvRHJhd09uLnRyYW5zZm9ybS5hcHBseShjYW52YXNUb0RyYXdPbiwgdGhpcy52aWV3cG9ydFRyYW5zZm9ybSk7XG5cbiAgICBpZiAob3B0aW9ucy5kcmF3X2JhY2tncm91bmQpIHtcbiAgICAgIHRoaXMuX3JlbmRlckJhY2tncm91bmQoY2FudmFzVG9EcmF3T24pO1xuICAgICAgLy9pZiAodGhpcy5fYmFja2dyb3VuZExheWVyKSB7XG4gICAgICAvLyAgdGhpcy5fcmVuZGVyT2JqZWN0cyhjYW52YXNUb0RyYXdPbiwgdGhpcy5fYmFja2dyb3VuZExheWVyKTtcbiAgICAgIC8vfVxuICAgIH1cblxuICAgIGlmICghb3B0aW9ucy5jbGlwcGVkX2FyZWFfb25seSAmJiB0aGlzLmNsaXBUbykge1xuICAgICAgZmFicmljLnV0aWwuY2xpcENvbnRleHQodGhpcywgY2FudmFzVG9EcmF3T24pO1xuICAgIH1cblxuICAgIHZhciBfb2JqZWN0cztcbiAgICBpZiAob3B0aW9ucy5vYmplY3RzICYmIG9wdGlvbnMub2JqZWN0cy5jb25zdHJ1Y3RvciA9PT0gQXJyYXkpIHtcbiAgICAgIF9vYmplY3RzID0gb3B0aW9ucy5vYmplY3RzO1xuICAgIH0gZWxzZSB7XG4gICAgICBfb2JqZWN0cyA9IG9wdGlvbnMub2JqZWN0cyAhPT0gZmFsc2UgPyB0aGlzLl9vYmplY3RzIDogW107XG4gICAgfVxuICAgIGlmIChvcHRpb25zLmNsaXBwZWRfYXJlYSkge1xuICAgICAgX29iamVjdHMgPSBmYWJyaWMudXRpbC5vYmplY3QuY2xvbmUoX29iamVjdHMpO1xuICAgICAgZm9yICh2YXIgaSA9IF9vYmplY3RzLmxlbmd0aDsgaS0tOykge1xuICAgICAgICBpZiAoX29iamVjdHNbaV0uY2xpcFRvICE9PSBvcHRpb25zLmNsaXBwZWRfYXJlYSkge1xuICAgICAgICAgIF9vYmplY3RzLnNwbGljZShpLCAxKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICAvLyBpZiAoZmFicmljLnZlcnNpb24gPj0gMS42KSB7XG4gICAgdGhpcy5fcmVuZGVyT2JqZWN0cyhjYW52YXNUb0RyYXdPbiwgX29iamVjdHMpO1xuICAgIC8vIH0gZWxzZSB7XG4gICAgLy8gICBmb3IgKHZhciBpID0gMCwgbGVuZ3RoID0gX29iamVjdHMubGVuZ3RoOyBpIDwgbGVuZ3RoOyArK2kpIHtcbiAgICAvLyAgICAgdGhpcy5fZHJhdyhjYW52YXNUb0RyYXdPbiwgX29iamVjdHNbaV0pO1xuICAgIC8vICAgfVxuICAgIC8vIH1cblxuXG4gICAgY2FudmFzVG9EcmF3T24ucmVzdG9yZSgpO1xuICAgIGlmICghb3B0aW9ucy5jbGlwcGVkX2FyZWFfb25seSAmJiB0aGlzLmNsaXBUbykge1xuICAgICAgY2FudmFzVG9EcmF3T24ucmVzdG9yZSgpO1xuICAgIH1cbiAgICB0aGlzLl9yZW5kZXJPdmVybGF5KGNhbnZhc1RvRHJhd09uKTtcbiAgICBjYW52YXNUb0RyYXdPbi5yZXN0b3JlKCk7XG4gICAgaWYgKHRoaXMuY2xpcFJlY3QpIHtcbiAgICAgIHRoaXMuY2xpcFJlY3Quc2V0T3BhY2l0eSgxKTtcbiAgICB9XG4gICAgdmFyIGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xuICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTtcbiAgICBpZiAob3B0aW9ucy5jbGlwcGVkX2FyZWFfb25seSAmJiB0aGlzLmNsaXBSZWN0KSB7XG4gICAgICB2YXIgX3JlY3QgPSB7XG4gICAgICAgIGxlZnQ6IHRoaXMuY2xpcFJlY3QubGVmdCAqIF96b29tLFxuICAgICAgICB0b3A6IHRoaXMuY2xpcFJlY3QudG9wICogX3pvb20sXG4gICAgICAgIHdpZHRoOiB0aGlzLmNsaXBSZWN0LndpZHRoICogX3pvb20sXG4gICAgICAgIGhlaWdodDogdGhpcy5jbGlwUmVjdC5oZWlnaHQgKiBfem9vbVxuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgdmFyIF9yZWN0ID0ge1xuICAgICAgICBsZWZ0OiBvcHRpb25zLmxlZnQgKiBfem9vbSB8fCAwLFxuICAgICAgICB0b3A6IG9wdGlvbnMudG9wICogX3pvb20gfHwgMCxcbiAgICAgICAgd2lkdGg6IG9wdGlvbnMud2lkdGggKiBfem9vbSB8fCBzaXplLndpZHRoLFxuICAgICAgICBoZWlnaHQ6IG9wdGlvbnMuaGVpZ2h0ICogX3pvb20gfHwgc2l6ZS5oZWlnaHRcbiAgICAgIH07XG4gICAgfVxuICAgIGlmIChvcHRpb25zLmFuZ2xlKSB7XG4gICAgICBjdHgucm90YXRlKC1vcHRpb25zLmFuZ2xlICogTWF0aC5QSSAvIDE4MCk7XG4gICAgICBjdHguZHJhd0ltYWdlKF9jYW52YXMsXG4gICAgICAgIDAsIDAsIF9yZWN0LndpZHRoICsgX3JlY3QubGVmdCArIF9jYW52YXMud2lkdGgsIF9yZWN0LmhlaWdodCArIF9yZWN0LnRvcCArIF9jYW52YXMuaGVpZ2h0LFxuICAgICAgICAtX3JlY3QubGVmdCwgLV9yZWN0LnRvcCwgY2FudmFzLndpZHRoICsgX3JlY3QubGVmdCArIF9jYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQgKyBfcmVjdC50b3AgKyBfY2FudmFzLmhlaWdodCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGN0eC5kcmF3SW1hZ2UoX2NhbnZhcywgX3JlY3QubGVmdCwgX3JlY3QudG9wLCBfcmVjdC53aWR0aCwgX3JlY3QuaGVpZ2h0LCAwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpO1xuICAgIH1cblxuICAgIHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bMF0gPSB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzNdID0gX29sZF9TY2FsZTtcbiAgICAvLyB0aGlzLl91cGRhdGVfYmFja2dyb3VuZF9pbWFnZSgpO1xuICAgIC8vdGhpcy5fdXBkYXRlX2NsaXBfcmVjdCgpO1xuXG4gICAgdGhpcy52aWV3cG9ydFRyYW5zZm9ybVs0XSA9IG9sZF94O1xuICAgIHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bNV0gPSBvbGRfeTtcblxuXG4gICAgcmV0dXJuIGNhbnZhcztcbiAgfVxufSk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL21vZHVsZXMvdGh1bWIuanMiLCIndXNlIHN0cmljdCc7XG5cblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuQ2FudmFzLnByb3RvdHlwZSwge1xuICAgLy8gZW5hYmxlQ2xpcEFyZWFab29taW5nOiBmdW5jdGlvbigpe1xuICAgICAgLy90b2RvXG4gICAgICAvLyB0aGlzLm9uKCd2aWV3cG9ydDpzY2FsZWQnLCBmdW5jdGlvbigpe1xuICAgICAgLy8gICBpZiAoIXRoaXMubGF5ZXIoXCJiYWNrZ3JvdW5kXCIpLm9iamVjdHMpIHJldHVybjtcbiAgICAgIC8vICAgdGhpcy5fYmFja2dyb3VuZExheWVyWzBdLnNldENvb3JkcygpO1xuICAgICAgLy8gfSk7XG4gICAvLyB9LFxuICAgIF9mYWJyaWNfY2xpcF9mdW5jdGlvbjogZnVuY3Rpb24gKGN0eDIpIHtcblxuICAgICAgdmFyIGNsaXBSZWN0ID0gdGhpcy5jbGlwUmVjdDtcbiAgICAgIGN0eDIuc2F2ZSgpO1xuICAgICAgY2xpcFJlY3QucmVuZGVyKGN0eDIpO1xuICAgICAgY3R4Mi5yZXN0b3JlKCk7XG5cbiAgICB9XG4gIH0pO1xuXG5mYWJyaWMuT2JqZWN0LnByb3RvdHlwZS5zZXRDbGlwVG8gPSBmdW5jdGlvbih2YWwpIHtcbiAgaWYgKHR5cGVvZiB2YWwgIT09ICdzdHJpbmcnKSB7XG4gICAgdGhpcy5jbGlwVG8gPSB2YWw7XG4gIH1cblxuICB2YXIgZnVuY3Rpb25Cb2R5ID0gZmFicmljLnV0aWwuZ2V0RnVuY3Rpb25Cb2R5KHZhbCk7XG4gIGlmICh0eXBlb2YgZnVuY3Rpb25Cb2R5ICE9PSAndW5kZWZpbmVkJykge1xuICAgIHRoaXMuY2xpcFRvID0gbmV3IEZ1bmN0aW9uKCdjdHgnLCBmdW5jdGlvbkJvZHkpO1xuICB9XG59O1xuXG4vKipcbiAqIEBwcml2YXRlXG4gKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdIE9wdGlvbnMgb2JqZWN0XG4gKi9cbmZhYnJpYy5PYmplY3QucHJvdG90eXBlLl9pbml0Q2xpcHBpbmcgPSBmdW5jdGlvbiAob3B0aW9ucykge1xuICBpZiAoIW9wdGlvbnMuY2xpcFRvIHx8IHR5cGVvZiBvcHRpb25zLmNsaXBUbyAhPT0gJ3N0cmluZycpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgaWYgKG9wdGlvbnMuY2xpcFRvWzBdID09ICcjJykge1xuICAgIC8vICB2YXIgX2lkID0gb3B0aW9ucy5jbGlwVG9bMF0uc3Vic3RyaW5nKDEpO1xuICAgIHRoaXMuY2xpcFRvID0gb3B0aW9ucy5jbGlwVG87XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIGZ1bmN0aW9uQm9keSA9IGZhYnJpYy51dGlsLmdldEZ1bmN0aW9uQm9keShvcHRpb25zLmNsaXBUbyk7XG4gIGlmICh0eXBlb2YgZnVuY3Rpb25Cb2R5ICE9PSAndW5kZWZpbmVkJykge1xuICAgIHRoaXMuY2xpcFRvID0gbmV3IEZ1bmN0aW9uKCdjdHgnLCBmdW5jdGlvbkJvZHkpO1xuICB9XG59O1xuZmFicmljLk9iamVjdC5wcm90b3R5cGUuZ2V0Q2xpcFRvID0gZnVuY3Rpb24gKCkge1xuICByZXR1cm4gXCIjXCIgKyB0aGlzLmNsaXBUby5pZDtcbn07XG5cbmZhYnJpYy51dGlsLmNsaXBDb250ZXh0ID0gZnVuY3Rpb24gKHJlY2VpdmVyLCBjdHgpIHtcblxuICBpZiAocmVjZWl2ZXIuY2xpcFRvLmNvbnN0cnVjdG9yID09PSBTdHJpbmcpIHtcbiAgICBpZiAocmVjZWl2ZXIuY2xpcFRvID09PSBcImNhbnZhc1wiKSB7XG4gICAgICByZWNlaXZlci5jbGlwVG8gPSByZWNlaXZlci5jYW52YXM7XG4gICAgfVxuICAgIGVsc2V7XG5cbiAgICAgIHZhciBfaWQgPSByZWNlaXZlci5jbGlwVG8uc3Vic3RyaW5nKDEpO1xuXG4gICAgICB2YXIgX2NsaXBDdHggPSByZWNlaXZlci5jYW52YXMuZ2V0T2JqZWN0QnlJRChfaWQpO1xuICAgICAgaWYoX2NsaXBDdHgpe1xuICAgICAgICByZWNlaXZlci5jbGlwVG8gPSBfY2xpcEN0eDtcbiAgICAgIH1lbHNle1xuICAgICAgICBjb25zb2xlLndhcm4oXCJlcnJvcjogY2xpcFRvIG5vdCBmb3VuZFwiICsgcmVjZWl2ZXIuY2xpcFRvKTtcbiAgICAgICAgZGVsZXRlIHJlY2VpdmVyLmNsaXBUbztcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG5cblxuICBjdHguc2F2ZSgpO1xuICBjdHguYmVnaW5QYXRoKCk7XG5cbiAgaWYgKHJlY2VpdmVyLmNsaXBUby5jb25zdHJ1Y3RvciA9PT0gRnVuY3Rpb24pIHtcbiAgICByZWNlaXZlci5jbGlwVG8oY3R4KTtcbiAgfSBlbHNlIHtcbiAgICBmYWJyaWMudXRpbC5fY2xpcFRvT2JqZWN0KHJlY2VpdmVyLCBjdHgpO1xuICAgIGN0eC5jbGlwKCk7XG4gIH1cblxufTtcblxuZmFicmljLnV0aWwuX2NsaXBUb09iamVjdCA9IGZ1bmN0aW9uIChyZWNlaXZlciwgY3R4KSB7XG4gIGN0eC5zYXZlKCk7XG4gIGN0eC5iZWdpblBhdGgoKTtcblxuICB2YXIgZnJvbUxlZnQgPSBmYWxzZTtcbiAgdmFyIGNlbnRlciA9IGZyb21MZWZ0ID8gcmVjZWl2ZXIuX2dldExlZnRUb3BDb29yZHMoKSA6IHJlY2VpdmVyLmdldENlbnRlclBvaW50KCk7XG4gIGN0eC50cmFuc2Zvcm0oMSwgTWF0aC50YW4oZmFicmljLnV0aWwuZGVncmVlc1RvUmFkaWFucygtcmVjZWl2ZXIuc2tld1kpKSwgMCwgMSwgMCwgMCk7XG4gIGN0eC50cmFuc2Zvcm0oMSwgMCwgTWF0aC50YW4oZmFicmljLnV0aWwuZGVncmVlc1RvUmFkaWFucygtcmVjZWl2ZXIuc2tld1gpKSwgMSwgMCwgMCk7XG4gIGN0eC5zY2FsZShcbiAgICAoMSAvIHJlY2VpdmVyLnNjYWxlWCkgKiAocmVjZWl2ZXIuZmxpcFggPyAtMSA6IDEpLFxuICAgICgxIC8gcmVjZWl2ZXIuc2NhbGVZKSAqIChyZWNlaXZlci5mbGlwWSA/IC0xIDogMSlcbiAgKTtcbiAgY3R4LnJvdGF0ZShmYWJyaWMudXRpbC5kZWdyZWVzVG9SYWRpYW5zKC1yZWNlaXZlci5hbmdsZSkpO1xuICBjdHgudHJhbnNsYXRlKC1jZW50ZXIueCwgLWNlbnRlci55KTtcblxuXG4gIGlmIChyZWNlaXZlci5jbGlwVG8ucG9pbnRzKSB7XG4gICAgdmFyIHBzID0gcmVjZWl2ZXIuY2xpcFRvLnBvaW50cztcbiAgICBjdHgubW92ZVRvKHBzWzBdLngsIHBzWzBdLnkpO1xuICAgIGZvciAodmFyIGogPSAxOyBqIDwgcHMubGVuZ3RoOyBqKyspIHtcbiAgICAgIGN0eC5saW5lVG8ocHNbal0ueCwgcHNbal0ueSk7XG4gICAgfVxuICAgIC8vY3R4LnN0cm9rZSgpO1xuICB9IGVsc2UgaWYgKHJlY2VpdmVyLmNsaXBUby50eXBlID09IFwicGF0aFwiKSB7XG5cbiAgICBjdHguZ2xvYmFsQWxwaGEgPSAwO1xuICAgIHJlY2VpdmVyLmNsaXBUby50cmFuc2Zvcm0oY3R4KTtcbiAgICByZWNlaXZlci5jbGlwVG8uX3JlbmRlcihjdHgpO1xuICB9IGVsc2UgaWYgKHJlY2VpdmVyLmNsaXBUby50eXBlID09IFwic2xpZGUtY2FudmFzXCIpIHtcbiAgICBjdHgucmVjdCgwLDAsIHJlY2VpdmVyLmNsaXBUby53aWR0aCwgcmVjZWl2ZXIuY2xpcFRvLmhlaWdodCk7XG4gIH1lbHNlIHtcbiAgICBjdHgudHJhbnNsYXRlKHJlY2VpdmVyLmNsaXBUby5sZWZ0LCByZWNlaXZlci5jbGlwVG8udG9wKTtcbiAgICBjdHgucm90YXRlKC0ocmVjZWl2ZXIuY2xpcFRvLmFuZ2xlICogLTEpICogTWF0aC5QSSAvIDE4MCk7XG4gICAgY3R4LnJlY3QoMCwwLCByZWNlaXZlci5jbGlwVG8ud2lkdGgsIHJlY2VpdmVyLmNsaXBUby5oZWlnaHQpO1xuICB9XG5cbiAgY3R4LmNsb3NlUGF0aCgpO1xuICBjdHgucmVzdG9yZSgpO1xufTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvbW9kdWxlcy9jbGlwVG8uanMiLCJyZXF1aXJlKFwiLi9zbGlkZS5hcmVhc1wiKTtcbnJlcXVpcmUoXCIuL2dyb3Vwc1wiKTtcblxuLy8gdG9kbyDRjdGC0L4g0YPQsdGA0LDRgtGMXG4vL2ZhYnJpYy5tb3ZlbWVudHNMaW1pdHNFYXN5ID0gZmFsc2U7XG52YXIgX3RvT2JqZWN0X292ZXJ3cml0dGVuID0gZmFicmljLk9iamVjdC5wcm90b3R5cGUudG9PYmplY3Q7XG4vL3RvZG8gdXNlIGV2ZW50IFwiYmVmb3JlOm9iamVjdFwiO1xuXG5mYWJyaWMuT2JqZWN0LnByb3RvdHlwZS50b09iamVjdCA9IGZ1bmN0aW9uIChwcm9wZXJ0aWVzVG9JbmNsdWRlKSB7XG4gIHZhciBvYmogPSBfdG9PYmplY3Rfb3ZlcndyaXR0ZW4uY2FsbCh0aGlzLHByb3BlcnRpZXNUb0luY2x1ZGUpO1xuICB2YXIgX3N0b3JlQWxsID0gdGhpcy5zdG9yZVByb3BlcnRpZXMuaW5kZXhPZihcIipcIikgIT0gLTE7XG4gIGlmICh0aGlzLmNsaXBUbyAmJiB0aGlzLmNsaXBUby5pZCAmJiAoX3N0b3JlQWxsIHx8IHRoaXMuc3RvcmVQcm9wZXJ0aWVzLmluZGV4T2YoXCJjbGlwVG9cIikgIT0gLTEpKSB7XG4gICAgb2JqLmNsaXBUbyA9ICcjJyArIHRoaXMuY2xpcFRvLmlkXG4gIH1cbiAgaWYgKCB0aGlzLm1vdmVtZW50TGltaXRzICYmICAoX3N0b3JlQWxsIHx8IHRoaXMuc3RvcmVQcm9wZXJ0aWVzLmluZGV4T2YoXCJtb3ZlbWVudExpbWl0c1wiKSAhPSAtMSkpIHtcbiAgICBvYmoubW92ZW1lbnRMaW1pdHMgPSB0aGlzLm1vdmVtZW50TGltaXRzLmlkID8gJyMnICsgdGhpcy5tb3ZlbWVudExpbWl0cy5pZCA6IHRoaXMubW92ZW1lbnRMaW1pdHM7XG4gIH1cbiAgcmV0dXJuIG9iajtcbn07XG5cbnZhciBfc2NhbGVPYmplY3Rfb3ZlcndyaXR0ZW4gPSBmYWJyaWMuQ2FudmFzLnByb3RvdHlwZS5fc2NhbGVPYmplY3Q7XG5cblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuT2JqZWN0LnByb3RvdHlwZSwge1xuICBzZXRXaG9sZUNvb3JkaW5hdGVzOiBmdW5jdGlvbih2YWwpe1xuICAgIHRoaXMud2hvbGVDb29yZGluYXRlcyA9IHZhbDtcbiAgICB0aGlzLm9uKFwiYWRkZWQgbW9kaWZpZWRcIixmdW5jdGlvbigpe1xuICAgICAgaWYodGhpcy53aG9sZUNvb3JkaW5hdGVzKXtcbiAgICAgICAgdGhpcy5zZXQoe1xuICAgICAgICAgIGxlZnQ6IE1hdGgucm91bmQodGhpcy5sZWZ0KSxcbiAgICAgICAgICB0b3A6IE1hdGgucm91bmQodGhpcy50b3ApLFxuICAgICAgICAgIHdpZHRoOiBNYXRoLnJvdW5kKHRoaXMud2lkdGgpLFxuICAgICAgICAgIGhlaWdodDogTWF0aC5yb3VuZCh0aGlzLmhlaWdodClcbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICB9LHRydWUpXG4gIH0sXG4gIC8vIHNldFRvcDogZnVuY3Rpb24odmFsKXtcbiAgLy8gICBpZih0aGlzLndob2xlQ29vcmRpbmF0ZXMpe1xuICAvLyAgICAgdmFsID0gTWF0aC5yb3VuZCh2YWwpO1xuICAvLyAgIH1cbiAgLy8gICB0aGlzLnRvcCA9IHZhbDtcbiAgLy8gfSxcbiAgLy8gc2V0TGVmdDogZnVuY3Rpb24odmFsKXtcbiAgLy8gICBpZih0aGlzLndob2xlQ29vcmRpbmF0ZXMpe1xuICAvLyAgICAgdmFsID0gTWF0aC5yb3VuZCh2YWwpO1xuICAvLyAgIH1cbiAgLy8gICB0aGlzLmxlZnQgPSB2YWw7XG4gIC8vIH0sXG4gIC8vIHNldFdpZHRoOiBmdW5jdGlvbih3KXtcbiAgLy8gICBpZih0aGlzLndob2xlQ29vcmRpbmF0ZXMpe1xuICAvLyAgICAgdyA9IE1hdGgucm91bmQodyk7XG4gIC8vICAgfVxuICAvLyAgIHRoaXMud2lkdGggPSB3O1xuICAvLyB9LFxuICAvLyBzZXRIZWlnaHQ6IGZ1bmN0aW9uKGgpe1xuICAvLyAgIGlmKHRoaXMud2hvbGVDb29yZGluYXRlcyl7XG4gIC8vICAgICBoID0gTWF0aC5yb3VuZChoKTtcbiAgLy8gICB9XG4gIC8vICAgdGhpcy5oZWlnaHQgPSBoO1xuICAvLyB9LFxuICAvLyBzcGVjaWFsUHJvcGVydGllczogZmFicmljLk9iamVjdC5wcm90b3R5cGUuc3BlY2lhbFByb3BlcnRpZXMuY29uY2F0KFtcIm1vdmVtZW50TGltaXRzXCJdKSxcblxuICBzZXRBY3RpdmU6IGZ1bmN0aW9uKHZhbHVlKXtcbiAgICBpZighdGhpcy5jYW52YXMpe1xuICAgICAgdGhpcy5vbihcImFkZGVkXCIsZnVuY3Rpb24oKXtcbiAgICAgICAgdGhpcy5jYW52YXMuc2V0QWN0aXZlT2JqZWN0KHRoaXMpO1xuICAgICAgfSlcbiAgICB9XG5cbiAgICB0aGlzLmFjdGl2ZSA9IHZhbHVlO1xuXG4gIH0sXG4gIHNldFBvc2l0aW9uOiBmdW5jdGlvbihfcG9zaXRpb24pe1xuICAgIGlmKF9wb3NpdGlvbiA9PT0gXCJjZW50ZXJcIikge1xuICAgICAgdGhpcy5vbihcImFkZGVkXCIsZnVuY3Rpb24oKXtcbiAgICAgICAgdGhpcy5jYW52YXMuZml0T2JqZWN0KHRoaXMpO1xuICAgICAgfSlcbiAgICB9XG4gIH0sXG5cbiAgc2V0TW92ZW1lbnRMaW1pdHM6IGZ1bmN0aW9uICh2YWwpIHtcblxuXG4gICAgaWYoIXRoaXMubW92ZW1lbnRMaW1pdHMpe1xuICAgICAgdGhpcy5vbih7XG4gICAgICAgIGFkZGVkOiBmdW5jdGlvbigpe1xuICAgICAgICAgIGlmKCB0aGlzLmNhbnZhcy5pbnRlcmFjdGl2ZSl7XG4gICAgICAgICAgICB0aGlzLmNhbnZhcy5fY2hlY2tfb2JqZWN0X3Bvc2l0aW9uKHRoaXMpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgcm90YXRlZDogZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgdmFyIHRhcmdldCA9IHRoaXM7XG5cbiAgICAgICAgICBpZiAodGFyZ2V0LnJlc2l6YWJsZSkge1xuICAgICAgICAgICAgaWYgKHBvcy5sZWZ0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgaWYgKHRhcmdldC5sZWZ0IDwgcG9zLmxlZnQpIHtcbiAgICAgICAgICAgICAgICB0YXJnZXQud2lkdGggKz0gdGFyZ2V0LmxlZnQgLSBwb3MubGVmdDtcbiAgICAgICAgICAgICAgICB0YXJnZXQubGVmdCA9IHBvcy5sZWZ0O1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRhcmdldC53aWR0aCAtPSB0YXJnZXQubGVmdCAtIHBvcy5sZWZ0O1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocG9zLnRvcCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgIGlmICh0YXJnZXQudG9wIDwgcG9zLnRvcCkge1xuICAgICAgICAgICAgICAgIHRhcmdldC5oZWlnaHQgKz0gdGFyZ2V0LnRvcCAtIHBvcy50b3A7XG4gICAgICAgICAgICAgICAgdGFyZ2V0LnRvcCA9IHBvcy50b3A7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGFyZ2V0LmhlaWdodCAtPSB0YXJnZXQudG9wIC0gcG9zLnRvcDtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICB0aGlzLmNhbnZhcy5fY2hlY2tfb2JqZWN0X3Bvc2l0aW9uKHRoaXMpXG4gICAgICAgIH0sXG4gICAgICAgIG1vZGlmaWVkOiBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICB0aGlzLmNhbnZhcy5fY2hlY2tfb2JqZWN0X2FmdGVyX21vZGlmaWVkKHRoaXMpXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgICB0aGlzLm1vdmVtZW50TGltaXRzID0gdmFsO1xuXG4gICAvKiBpZih0aGlzLmNhbnZhcyl7XG4gICAgICB0aGlzLl9zZXRNb3ZlbWVudExpbWl0c1N0cmluZygpO1xuICAgIH0qL1xuXG4gIH1cbn0pO1xuXG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLlN0YXRpY0NhbnZhcy5wcm90b3R5cGUsIHtcbiAgZml0T2JqZWN0OiBmdW5jdGlvbiAoZWwpIHtcbiAgICB2YXIgX3JlY3QsIG1heFNpemUsIG8gPSB0aGlzLm9mZnNldHM7XG5cbiAgICBpZighZWwubW92ZW1lbnRMaW1pdHMgfHwgZWwubW92ZW1lbnRMaW1pdHMgPT0gXCJjYW52YXNcIil7XG4gICAgICB2YXIgX3pvb20gPSB0aGlzLmdldFpvb20oKTtcbiAgICAgIHZhciBfdyA9IHRoaXMub3JpZ2luYWxXaWR0aCB8fCB0aGlzLndpZHRoIC8gX3pvb207XG4gICAgICB2YXIgX2ggPSB0aGlzLm9yaWdpbmFsSGVpZ2h0IHx8IHRoaXMuaGVpZ2h0IC8gX3pvb207XG4gICAgICBfcmVjdCA9IHtcbiAgICAgICAgd2lkdGg6IG8gPyAoX3cgLSBvLmxlZnQgLSBvLnJpZ2h0KSA6IF93LFxuICAgICAgICBoZWlnaHQ6IG8gPyhfaCAtIG8udG9wIC0gby5ib3R0b20pIDogX2hcbiAgICAgIH07XG4gICAgICAvKiBvZmZzZXRzID0ge1xuICAgICAgIGxlZnQ6IG8gJiYgby50b3AgfHwwICxcbiAgICAgICB0b3A6ICBvICYmICBvLmxlZnQgfHwwXG4gICAgICAgfSovXG4gICAgfWVsc2UgaWYoZWwubW92ZW1lbnRMaW1pdHMuY29uc3RydWN0b3IgIT09IEZ1bmN0aW9uKXtcbiAgICAgIHZhciBsaW0gPSBlbC5tb3ZlbWVudExpbWl0cztcbiAgICAgIF9yZWN0ID0ge1xuICAgICAgICBsZWZ0OiAgIGxpbS5sZWZ0ICogbGltLnNjYWxlWCxcbiAgICAgICAgd2lkdGg6ICBsaW0ud2lkdGggKiBsaW0uc2NhbGVYICxcbiAgICAgICAgdG9wOiAgICBsaW0udG9wICogbGltLnNjYWxlWSxcbiAgICAgICAgaGVpZ2h0OiBsaW0uaGVpZ2h0ICogbGltLnNjYWxlWVxuICAgICAgfTtcbiAgICAgIC8vbWF4U2l6ZSA9IF9yZWN0O1xuICAgICAgLy8gb2Zmc2V0cyA9IGxpbTtcbiAgICB9XG4gICAgbWF4U2l6ZSA9IHtcbiAgICAgIHdpZHRoOiBfcmVjdC53aWR0aCAqIHRoaXMuZml0SW5kZXgsXG4gICAgICBoZWlnaHQ6IF9yZWN0LmhlaWdodCAqIHRoaXMuZml0SW5kZXhcbiAgICB9O1xuICAgIHZhciBzaXplID0gZmFicmljLnV0aWwuZ2V0UHJvcG9ydGlvbnMoZWwsIG1heFNpemUsICdmaXQnKTtcblxuICAgIGlmKGVsLnJlc2l6YWJsZSl7XG4gICAgICBlbC5zZXRPcHRpb25zKHtcbiAgICAgICAgd2lkdGg6IGVsLndpZHRoICogc2l6ZS5zY2FsZSxcbiAgICAgICAgaGVpZ2h0OiBlbC5oZWlnaHQgKiBzaXplLnNjYWxlXG4gICAgICB9KTtcbiAgICAgIGVsLnVwZGF0ZUVsZW1lbnQoKTtcbiAgICB9ZWxzZXtcbiAgICAgIGVsLnNldE9wdGlvbnMoe1xuICAgICAgICBzY2FsZVg6IHNpemUuc2NhbGUsXG4gICAgICAgIHNjYWxlWTogc2l6ZS5zY2FsZVxuICAgICAgfSk7XG4gICAgfVxuICAgIHRoaXMuY2VudGVyT2JqZWN0KGVsKTtcbiAgICBlbC5zZXRDb29yZHMoKTtcbiAgfSxcbiAgLy9maXggZ2V0Y2VudGVyIGZ1bmN0aW9uXG4gIGNlbnRlck9iamVjdDogZnVuY3Rpb24gKG9iamVjdCkge1xuICAgIHZhciBjZW50ZXI7XG4gICAgaWYgKG9iamVjdC5tb3ZlbWVudExpbWl0cykge1xuXG4gICAgICBjZW50ZXIgPSB0aGlzLl9nZXRNb3ZlbWVudHNMaW1pdHNDZW50ZXIob2JqZWN0Lm1vdmVtZW50TGltaXRzKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY2VudGVyID0gdGhpcy5nZXRDZW50ZXIoKTtcbiAgICB9XG4gICAgdGhpcy5fY2VudGVyT2JqZWN0KG9iamVjdCwgbmV3IGZhYnJpYy5Qb2ludChjZW50ZXIubGVmdCwgY2VudGVyLnRvcCkpO1xuICAgIHRoaXMucmVuZGVyQWxsKCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG4gIGdldENlbnRlcjogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB7XG4gICAgICB0b3A6IHRoaXMub3JpZ2luYWxIZWlnaHQgLyAyIC8gdGhpcy5nZXRab29tKCksXG4gICAgICBsZWZ0OiB0aGlzLm9yaWdpbmFsV2lkdGggLyAyIC8gdGhpcy5nZXRab29tKClcbiAgICB9O1xuICB9LFxuXG4gIG1vdmVtZW50TGltaXRzOiB7XG4gICAgbGVmdDogZmFsc2UsXG4gICAgdG9wOiBmYWxzZSxcbiAgICByaWdodDogZmFsc2UsXG4gICAgYm90dG9tOiBmYWxzZVxuICB9LFxuICBzZXRNb3ZlbWVudExpbWl0czogZnVuY3Rpb24gKF9vZmZzZXRzKSB7XG4gICAgdGhpcy5tb3ZlbWVudExpbWl0cyA9IF9vZmZzZXRzO1xuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG4gIC8vY29udGVudCDRhdC+0YLRjyDQsdGLICDQv9C40LrRgdC10LvRjCDQvtCx0YrQtdC60YLQsCDQtNC+0LvQttC10L0g0LHRi9GC0Ywg0LLQvdGD0YLRgNC4INC30L7QvdGLXG4gIC8vZml0INC30L7QvdCwINC00L7Qu9C20L3QviDQv9C+0LvQvdC+0YHRgtGM0Y4g0L3QsNGF0L7QtNC40YLRgdGPINCy0L3Rg9GC0YDQuCDQvtCx0YrQtdC60YLQsFxuICBtb3ZlbWVudExpbWl0TW9kZTogXCJmaXRcIixcbiAgX2dldE1vdmVtZW50c0xpbWl0c0NlbnRlcjogZnVuY3Rpb24obW92ZW1lbnRMaW1pdHMpe1xuXG4gICAgdmFyIG8gPSB0aGlzLm9mZnNldHM7XG4gICAgaWYgKG1vdmVtZW50TGltaXRzID09PSAnY2FudmFzJykge1xuICAgICAgdmFyIF93ID0gdGhpcy5vcmlnaW5hbFdpZHRoIHx8IHRoaXMud2lkdGg7XG4gICAgICB2YXIgX2ggPSB0aGlzLm9yaWdpbmFsSGVpZ2h0IHx8IHRoaXMuaGVpZ2h0O1xuICAgICAgcmV0dXJuIHt0b3A6IG8udG9wICsgKF9oIC0gby50b3AgLSBvLmJvdHRvbSkgLzIgICwgbGVmdDogIG8ubGVmdCArIChfdyAtIG8ubGVmdCAtIG8ucmlnaHQpIC8yfTtcbiAgICB9ZWxzZXtcbiAgICAgIHZhciBvYmogPSB0aGlzLmdldE9iamVjdEJ5SUQobW92ZW1lbnRMaW1pdHMuc3Vic3RyKDEpKTtcbiAgICAgIHZhciBfeHkgPSBvYmouZ2V0Q2VudGVyUG9pbnQoKTtcbiAgICAgIHJldHVybiB7dG9wOiBfeHkueSwgbGVmdDogX3h5Lnh9O1xuICAgIH1cbiAgfSxcbiAgX2dldE1vdmVtZW50c0xpbWl0c1JlY3Q6IGZ1bmN0aW9uKG1vdmVtZW50TGltaXRzKXtcblxuICAgIHZhciBvID0gdGhpcy5vZmZzZXRzO1xuICAgIHZhciBfdyA9IHRoaXMub3JpZ2luYWxXaWR0aCB8fCB0aGlzLndpZHRoO1xuICAgIHZhciBfaCA9IHRoaXMub3JpZ2luYWxIZWlnaHQgfHwgdGhpcy5oZWlnaHQ7XG5cbiAgICBpZihtb3ZlbWVudExpbWl0cy5jb25zdHJ1Y3RvciAhPT0gU3RyaW5nKXtcbiAgICAgIHJldHVybiBtb3ZlbWVudExpbWl0cztcbiAgICB9XG5cbiAgICB2YXIgc2NhbGUgPSB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzBdO1xuXG4gICAgaWYgKG1vdmVtZW50TGltaXRzID09PSAnY2FudmFzJykge1xuXG4gICAgICB2YXIgcmVjdCA9IHtcbiAgICAgICAgbGVmdDogby5sZWZ0LFxuICAgICAgICB0b3A6IG8udG9wLFxuICAgICAgICB3aWR0aDogX3cgLSBvLmxlZnQgLSBvLnJpZ2h0LFxuICAgICAgICBoZWlnaHQ6IF9oIC0gby50b3AgLSBvLmJvdHRvbSxcbiAgICAgICAgcmlnaHQ6IG8ucmlnaHQsXG4gICAgICAgIGJvdHRvbTogby5ib3R0b21cbiAgICAgIH1cblxuICAgICAgcmVjdC53aWR0aCAqPSBzY2FsZTtcbiAgICAgIHJlY3QuaGVpZ2h0ICo9IHNjYWxlO1xuICAgICAgcmV0dXJuIHJlY3Q7XG4gICAgfWVsc2V7XG4gICAgICB2YXIgb2JqID0gdGhpcy5nZXRPYmplY3RCeUlEKG1vdmVtZW50TGltaXRzLnN1YnN0cigxKSk7XG4gICAgICB2YXIgX3N0cm9rZV93aWR0aCA9IG9iai5zdHJva2VXaWR0aDtcbiAgICAgIG9iai5zdHJva2VXaWR0aCA9IDA7XG5cbiAgICAgIG9iai5zZXRDb29yZHMoKTtcbiAgICAgIHZhciByZWN0ID0gb2JqLmdldEJvdW5kaW5nUmVjdCgpO1xuXG4gICAgICBvYmouc3Ryb2tlV2lkdGggPSBfc3Ryb2tlX3dpZHRoO1xuXG5cbiAgICAgIHJlY3QubGVmdCAvPSBzY2FsZTtcbiAgICAgIHJlY3QudG9wIC89IHNjYWxlO1xuICAgICAgcmVjdC53aWR0aCAvPSBzY2FsZTtcbiAgICAgIHJlY3QuaGVpZ2h0IC89IHNjYWxlO1xuICAgICAgcmVjdC5sZWZ0IC09IHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bNF0gLyBzY2FsZTtcbiAgICAgIHJlY3QudG9wIC09IHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bNV0gLyBzY2FsZTtcblxuICAgICAgLy9yZWN0LmxlZnQgICArPSBzdyAvMjtcbiAgICAgIC8vcmVjdC50b3AgICAgKz0gc3cgLzI7XG4gICAgICAvL3JlY3Qud2lkdGggIC09IHN3O1xuICAgICAgLy9yZWN0LmhlaWdodCAtPSBzdztcblxuICAgICAgcmVjdC5yaWdodCA9IF93IC0gKHJlY3QubGVmdCArIHJlY3Qud2lkdGgpO1xuICAgICAgcmVjdC5ib3R0b20gPSBfaCAtIChyZWN0LnRvcCArIHJlY3QuaGVpZ2h0KTtcblxuICAgICAgcmV0dXJuIHJlY3Q7XG4gICAgfVxuICB9LFxuICBjb250ZW50T2Zmc2V0cyA6IDUsXG4gIGdldEZpeGVkUG9zaXRpb246IGZ1bmN0aW9uICh0YXJnZXQsIHgsIHkpIHtcblxuICAgIHZhciBfdyA9IHRoaXMub3JpZ2luYWxXaWR0aCB8fCB0aGlzLndpZHRoO1xuICAgIHZhciBfaCA9IHRoaXMub3JpZ2luYWxIZWlnaHQgfHwgdGhpcy5oZWlnaHQ7XG5cblxuICAgIGlmICh4ID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHggPSB0YXJnZXQubGVmdDtcbiAgICB9XG4gICAgaWYgKHkgPT09IHVuZGVmaW5lZCkge1xuICAgICAgeSA9IHRhcmdldC50b3A7XG4gICAgfVxuICAgIHZhciBzY2FsZSA9IHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bMF07XG4gICAgdGFyZ2V0LnNldENvb3JkcygpO1xuICAgIHZhciBib3VuZHMgPSB0YXJnZXQuZ2V0Qm91bmRpbmdSZWN0KCk7XG4gICAgYm91bmRzLmxlZnQgLz0gc2NhbGU7XG4gICAgYm91bmRzLnRvcCAvPSBzY2FsZTtcbiAgICBib3VuZHMud2lkdGggLz0gc2NhbGU7XG4gICAgYm91bmRzLmhlaWdodCAvPSBzY2FsZTtcblxuICAgIGJvdW5kcy5sZWZ0IC09IHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bNF0gLyBzY2FsZTtcbiAgICBib3VuZHMudG9wIC09IHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bNV0gLyBzY2FsZTtcbiAgICBib3VuZHMucmlnaHQgPSBfdyAtIChib3VuZHMubGVmdCArIGJvdW5kcy53aWR0aCk7XG4gICAgYm91bmRzLmJvdHRvbSA9IF9oIC0gKGJvdW5kcy50b3AgKyBib3VuZHMuaGVpZ2h0KTtcblxuXG4gICAgdmFyIGxpbWl0cyA9IHRoaXMuX2dldE1vdmVtZW50c0xpbWl0c1JlY3QodGFyZ2V0Lm1vdmVtZW50TGltaXRzIHx8IHRoaXMubW92ZW1lbnRMaW1pdHMpO1xuICAgIC8vIHZhciBsaW1pdHMgPSByZWN0IHx8IHRoaXMubW92ZW1lbnRMaW1pdHM7XG5cbiAgICB2YXIgbmV3UG9zID0ge307XG4gICAgdmFyIF9sID0gbGltaXRzLmxlZnQsIF9yID0gbGltaXRzLnJpZ2h0O1xuICAgIHZhciBfdCA9IGxpbWl0cy50b3AsIF9iID0gbGltaXRzLmJvdHRvbTtcblxuICAgIGlmICh0YXJnZXQubW92ZW1lbnRMaW1pdE1vZGUgPT09IFwiY29udGVudFwiKSB7XG4gICAgICBfbCAtPSBib3VuZHMud2lkdGggLSB0aGlzLmNvbnRlbnRPZmZzZXRzXG4gICAgICBfciAtPSBib3VuZHMud2lkdGggLSB0aGlzLmNvbnRlbnRPZmZzZXRzXG4gICAgICBfdCAtPSBib3VuZHMuaGVpZ2h0IC0gdGhpcy5jb250ZW50T2Zmc2V0c1xuICAgICAgX2IgLT0gYm91bmRzLmhlaWdodCAtIHRoaXMuY29udGVudE9mZnNldHNcbiAgICB9XG5cbiAgICBpZiAodGFyZ2V0Lm1vdmVtZW50TGltaXRNb2RlID09PSBcImZpdFwiICYmICF0YXJnZXQucmVzaXphYmxlKSB7XG4gICAgICBpZiAoX2wgIT09IGZhbHNlICYmIF9yICE9PSBmYWxzZSkge1xuICAgICAgICB2YXIgX3cgPSBfdyAtIF9sIC0gX3I7XG4gICAgICAgIGlmIChib3VuZHMud2lkdGggPiBfdykge1xuICAgICAgICAgIHZhciBfYXNwID0gX3cgLyBib3VuZHMud2lkdGg7XG4gICAgICAgICAgbmV3UG9zLnNjYWxlWCA9IF9hc3A7XG4gICAgICAgICAgbmV3UG9zLnNjYWxlWSA9IF9hc3A7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKF90ICE9PSBmYWxzZSAmJiBfYiAhPT0gZmFsc2UpIHtcbiAgICAgICAgdmFyIF9oID0gX2ggLSBfdCAtIF9iO1xuICAgICAgICBpZiAoYm91bmRzLmhlaWdodCA+IF9oKSB7XG4gICAgICAgICAgdmFyIF9hc3AgPSBfaCAvIGJvdW5kcy5oZWlnaHQ7XG4gICAgICAgICAgdGFyZ2V0LnNjYWxlWCAqPSBfYXNwO1xuICAgICAgICAgIHRhcmdldC5zY2FsZVkgKj0gX2FzcDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmICh0YXJnZXQubW92ZW1lbnRMaW1pdE1vZGUgPT09IFwiZml0XCIgfHwgdGFyZ2V0Lm1vdmVtZW50TGltaXRNb2RlID09PSBcImNvbnRlbnRcIikge1xuXG4gICAgICBpZiAoX2wgIT09IGZhbHNlKSB7XG4gICAgICAgIHZhciBfZGlmZiA9IF9sIC0gYm91bmRzLmxlZnQ7XG4gICAgICAgIGlmIChfZGlmZiA+IDApIHtcbiAgICAgICAgICBuZXdQb3MubGVmdCA9IHggKyBfZGlmZjtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAoIW5ld1Bvcy5sZWZ0ICYmIF9yICE9PSBmYWxzZSkge1xuICAgICAgICB2YXIgX2RpZmYgPSBfciAtIGJvdW5kcy5yaWdodDtcbiAgICAgICAgaWYgKF9kaWZmID4gMCkge1xuICAgICAgICAgIG5ld1Bvcy5sZWZ0ID0geCAtIF9kaWZmO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmIChfdCAhPT0gZmFsc2UpIHtcbiAgICAgICAgdmFyIF9kaWZmID0gX3QgLSBib3VuZHMudG9wO1xuICAgICAgICBpZiAoX2RpZmYgPiAwKSB7XG4gICAgICAgICAgbmV3UG9zLnRvcCA9IHkgKyBfZGlmZjtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAoIW5ld1Bvcy50b3AgJiYgX2IgIT09IGZhbHNlKSB7XG4gICAgICAgIHZhciBfZGlmZiA9IF9iIC0gYm91bmRzLmJvdHRvbTtcbiAgICAgICAgaWYgKF9kaWZmID4gMCkge1xuICAgICAgICAgIG5ld1Bvcy50b3AgPSB5IC0gX2RpZmY7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgIH1cblxuICAgIHJldHVybiBuZXdQb3M7XG4gIH0sXG5cblxuICAvLyBfcmVzdG9yZU9yaWdpblhZTmF0aXZlOiBfcmVzdG9yZU9yaWdpblhZTmF0aXZlLFxuICAvLyBfcmVzdG9yZU9yaWdpblhZOiBmdW5jdGlvbiAodGFyZ2V0KSB7XG4gIC8vICAgdGhpcy5fcmVzdG9yZU9yaWdpblhZTmF0aXZlKHRhcmdldCk7XG4gIC8vXG4gIC8vICAgLy8gaWYgKHRhcmdldC53aG9sZUNvb3JkaW5hdGVzKSB7XG4gIC8vICAgLy8gICB0YXJnZXQubGVmdCA9IE1hdGgucm91bmQodGFyZ2V0LmxlZnQpO1xuICAvLyAgIC8vICAgdGFyZ2V0LnRvcCA9IE1hdGgucm91bmQodGFyZ2V0LnRvcCk7XG4gIC8vICAgLy8gfVxuICAvLyB9LFxuXG4gIC8qKlxuICAgKiBTZXRzIHRoZSBwb3NpdGlvbiBvZiB0aGUgb2JqZWN0IHRha2luZyBpbnRvIGNvbnNpZGVyYXRpb24gdGhlIG9iamVjdCdzIG9yaWdpblxuICAgKiBAcGFyYW0ge2ZhYnJpYy5Qb2ludH0gcG9zIFRoZSBuZXcgcG9zaXRpb24gb2YgdGhlIG9iamVjdFxuICAgKiBAcGFyYW0ge1N0cmluZ30gb3JpZ2luWCBIb3Jpem9udGFsIG9yaWdpbjogJ2xlZnQnLCAnY2VudGVyJyBvciAncmlnaHQnXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBvcmlnaW5ZIFZlcnRpY2FsIG9yaWdpbjogJ3RvcCcsICdjZW50ZXInIG9yICdib3R0b20nXG4gICAqIEByZXR1cm4ge3ZvaWR9XG4gICAqL1xuICBzZXRQb3NpdGlvbkJ5T3JpZ2luOiBmdW5jdGlvbiAocG9zLCBvcmlnaW5YLCBvcmlnaW5ZKSB7XG4gICAgdmFyIGNlbnRlciA9IHRoaXMudHJhbnNsYXRlVG9DZW50ZXJQb2ludChwb3MsIG9yaWdpblgsIG9yaWdpblkpLFxuICAgICAgcG9zaXRpb24gPSB0aGlzLnRyYW5zbGF0ZVRvT3JpZ2luUG9pbnQoY2VudGVyLCB0aGlzLm9yaWdpblgsIHRoaXMub3JpZ2luWSk7XG5cbiAgICAvLyBpZiAodGhpcy53aG9sZUNvb3JkaW5hdGVzKSB7XG4gICAgLy8gICBwb3NpdGlvbi54ID0gTWF0aC5yb3VuZChwb3NpdGlvbi54KTtcbiAgICAvLyAgIHBvc2l0aW9uLnkgPSBNYXRoLnJvdW5kKHBvc2l0aW9uLnkpO1xuICAgIC8vIH1cbiAgICB0aGlzLnNldCgnbGVmdCcsIHBvc2l0aW9uLngpO1xuICAgIHRoaXMuc2V0KCd0b3AnLCBwb3NpdGlvbi55KTtcbiAgfVxufSk7XG5cbnZhciBfdHJhbnNsYXRlT2JqZWN0X292ZXJ3cml0dGVuID0gZmFicmljLkNhbnZhcy5wcm90b3R5cGUuX3RyYW5zbGF0ZU9iamVjdDtcbnZhciBfYmVmb3JlU2NhbGVUcmFuc2Zvcm1fb3ZlcndyaXR0ZW4gPSBmYWJyaWMuQ2FudmFzLnByb3RvdHlwZS5fYmVmb3JlU2NhbGVUcmFuc2Zvcm07XG52YXIgX2JlZm9yZVRyYW5zZm9ybV9vdmVyd3JpdHRlbiA9IGZhYnJpYy5DYW52YXMucHJvdG90eXBlLl9iZWZvcmVUcmFuc2Zvcm07XG52YXIgX3Jlc3RvcmVPcmlnaW5YWU5hdGl2ZSA9IGZhYnJpYy5DYW52YXMucHJvdG90eXBlLl9yZXN0b3JlT3JpZ2luWFk7XG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUsIHtcbiAgX2JlZm9yZVNjYWxlVHJhbnNmb3JtX292ZXJ3cml0dGVuOiBfYmVmb3JlU2NhbGVUcmFuc2Zvcm1fb3ZlcndyaXR0ZW4sXG4gIF9iZWZvcmVTY2FsZVRyYW5zZm9ybTogZnVuY3Rpb24gKGUsIHRyYW5zZm9ybSkge1xuICAgIHRoaXMuX2JlZm9yZVNjYWxlVHJhbnNmb3JtX292ZXJ3cml0dGVuKGUsIHRyYW5zZm9ybSk7XG4gICAgaWYgKCF0aGlzLl9jdXJyZW50VHJhbnNmb3JtLm9yaWdpbmFsLm9Db29yZHMpIHtcbiAgICAgIHRoaXMuX2N1cnJlbnRUcmFuc2Zvcm0ub3JpZ2luYWwub0Nvb3JkcyA9IGZhYnJpYy51dGlsLm9iamVjdC5jbG9uZURlZXAodGhpcy5fY3VycmVudFRyYW5zZm9ybS50YXJnZXQub0Nvb3Jkcyk7XG4gICAgfVxuICB9LFxuICBnZXRGaXhlZFBvc2l0aW9uRWFzeTogZnVuY3Rpb24gKHRhcmdldCwgeCwgeSkge1xuICAgIHZhciBfdyA9IHRoaXMub3JpZ2luYWxXaWR0aCB8fCB0aGlzLndpZHRoO1xuICAgIHZhciBfaCA9IHRoaXMub3JpZ2luYWxIZWlnaHQgfHwgdGhpcy5oZWlnaHQ7XG5cbiAgICBpZiAoeCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICB4ID0gdGFyZ2V0LmxlZnQ7XG4gICAgfVxuICAgIGlmICh5ID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHkgPSB0YXJnZXQudG9wO1xuICAgIH1cbiAgICB2YXIgc2NhbGUgPSB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzBdO1xuICAgIHRhcmdldC5zZXRDb29yZHMoKTtcbiAgICB0YXJnZXQucmlnaHQgPSBfdyAtICh0YXJnZXQubGVmdCArIHRhcmdldC53aWR0aCk7XG4gICAgdGFyZ2V0LmJvdHRvbSA9IF9oIC0gKHRhcmdldC50b3AgKyB0YXJnZXQuaGVpZ2h0KTtcblxuICAgIHZhciBfZGlmZiwgX2FzcCwgcmVjdDtcbiAgICB2YXIgbmV3UG9zID0ge1xuICAgICAgbGVmdDogeCxcbiAgICAgIHRvcDogeSxcbiAgICAgIHdpZHRoOiB0YXJnZXQud2lkdGgsXG4gICAgICBoZWlnaHQ6IHRhcmdldC5oZWlnaHRcbiAgICB9O1xuXG4gICAgaWYgKHRhcmdldC53aWR0aCA+IF93KSB7XG4gICAgICBuZXdQb3Mud2lkdGggPSBfdztcbiAgICB9XG4gICAgaWYgKHRhcmdldC5oZWlnaHQgPiBfaCkge1xuICAgICAgbmV3UG9zLmhlaWdodCA9IF9oO1xuICAgIH1cbiAgICBpZiAodGFyZ2V0LmxlZnQgPCAwKSB7XG4gICAgICBuZXdQb3Mud2lkdGggKz0gdGFyZ2V0LmxlZnQ7XG4gICAgICBuZXdQb3MubGVmdCAtPSB0YXJnZXQubGVmdDtcbiAgICB9XG4gICAgaWYgKHRhcmdldC5yaWdodCA8IDApIHtcbiAgICAgIG5ld1Bvcy53aWR0aCArPSB0YXJnZXQucmlnaHQ7XG4gICAgfVxuICAgIGlmICh0YXJnZXQudG9wIDwgMCkge1xuICAgICAgbmV3UG9zLmhlaWdodCArPSB0YXJnZXQudG9wO1xuICAgIH1cbiAgICBpZiAodGFyZ2V0LmJvdHRvbSA8IDApIHtcbiAgICAgIG5ld1Bvcy5oZWlnaHQgKz0gdGFyZ2V0LmJvdHRvbTtcbiAgICB9XG4gICAgcmV0dXJuIG5ld1BvcztcbiAgfSxcbiAgLyoqXG4gICAqINGE0YPQvdC60YbQuNGOINC80L7QttC90L4g0LLRi9C30LLQsNGC0Ywg0YEg0LXQstC10L3RgtC+0LwgICdhZnRlcjpyZW5kZXInLiDQn9C+0LfQstC+0LvRj9C10YIg0L7RgtC+0LHRgNCw0LbQsNGC0Ywg0LLRi9GH0LjRgdC70LXQvdC40Y8g0L/QtdGA0LXRgdC10YfQtdC90LjQuSDQuNC30LzQtdC90Y/QtdC80L7Qs9C+INC+0LHRitC10LrRgtCwINGBINGA0LDQvNC60L7QuS4g0LLRi9C00LXQu9GP0LXRgiDQutGA0LDRgdC90YvQvNC4INC70LjQuNC90LjRj9C4XG4gICAqIEBwcml2YXRlXG4gICAqIEBleGFtcGxlXG4gICAqICBldmVudExpc3RlbmVycyA6IHtcbiAgICBDYW52YXM6IHtcbiAgICAgICdiZWZvcmU6cmVuZGVyJzogZnVuY3Rpb24oKXtcbiAgICAgICAgdGhpcy5jbGVhckNvbnRleHQodGhpcy5jb250ZXh0VG9wKTtcbiAgICAgIH0sXG4gICAgICAnYWZ0ZXI6cmVuZGVyJzogZnVuY3Rpb24oKXtcbiAgICAgICAgdGhpcy5fZGVidWdfaW50ZXJzZWN0aW9ucygpXG4gICAgICB9XG4gICAgfVxuICB9XG4gICAqL1xuICBkcmF3SW50ZXJlc3Rpb25MaW5lczogZnVuY3Rpb24oKXtcbiAgICB2YXIgdHIgPSB0aGlzLl9jdXJyZW50VHJhbnNmb3JtO1xuICAgIGlmICh0ciAmJiB0ci5faW50ZXJzZWN0aW9ucykge1xuICAgICAgdmFyIGN0eCA9IHRoaXMuY29udGV4dFRvcDtcbiAgICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICAgIGN0eC5zdHJva2VTdHlsZSA9IFwicmVkXCI7XG4gICAgICBmb3IodmFyIGkgaW4gdHIuX2ludGVyc2VjdGlvbnMpe1xuICAgICAgICB2YXIgX2Nvb3JkID0gdHIuX2ludGVyc2VjdGlvbnNbaV07XG4gICAgICAgIGN0eC5tb3ZlVG8oX2Nvb3JkLnggKyA1LCBfY29vcmQueSk7XG4gICAgICAgIGN0eC5hcmMoX2Nvb3JkLngsIF9jb29yZC55LCA1LCAwLCAyICogTWF0aC5QSSk7XG4gICAgICB9XG4gICAgICBmb3IodmFyIGkgaW4gdHIubGluZXMpe1xuICAgICAgICB2YXIgX2wgPSB0ci5saW5lc1tpXTtcbiAgICAgICAgY3R4Lm1vdmVUbyhfbFswXS54LF9sWzBdLnkpO1xuICAgICAgICBjdHgubGluZVRvKF9sWzFdLngsX2xbMV0ueSk7XG4gICAgICB9XG4gICAgICBmb3IodmFyIGkgaW4gdHIubWxMaW5lcyl7XG4gICAgICAgIHZhciBfbCA9IHRyLm1sTGluZXNbaV07XG4gICAgICAgIGN0eC5tb3ZlVG8oX2xbMF0ueCxfbFswXS55KTtcbiAgICAgICAgY3R4LmxpbmVUbyhfbFsxXS54LF9sWzFdLnkpO1xuICAgICAgfVxuICAgICAgY3R4LnN0cm9rZSgpO1xuICAgIH1cbiAgfSxcbiAgX3NjYWxlT2JqZWN0RWFzeTogZnVuY3Rpb24gKHgsIHksIGJ5KSB7XG4gICAgLy9fc2NhbGVPYmplY3Rfb3ZlcndyaXR0ZW4uY2FsbCh0aGlzLCB4LCB5LCBieSk7XG4gICAgdmFyIHRyID0gdGhpcy5fY3VycmVudFRyYW5zZm9ybSxcbiAgICAgIHRhcmdldCA9IHRyLnRhcmdldCxcbiAgICAgIGNvcm5lciA9IHRyLmNvcm5lcjtcbiAgICBpZighdGFyZ2V0Lm1vdmVtZW50TGltaXRzKXtcbiAgICAgIHJldHVybiBfc2NhbGVPYmplY3Rfb3ZlcndyaXR0ZW4uY2FsbCh0aGlzLCB4LHksIGJ5KTtcbiAgICB9XG5cblxuICAgIGlmICh0YXJnZXQubW92ZW1lbnRMaW1pdE1vZGUgIT09ICdmaXQnKXJldHVybjtcbiAgICB4ID0gTWF0aC5taW4odGFyZ2V0Lm1vdmVtZW50TGltaXRzLndpZHRoLCBNYXRoLm1heCgwLHgpKTtcbiAgICB5ID0gTWF0aC5taW4odGFyZ2V0Lm1vdmVtZW50TGltaXRzLmhlaWdodCwgTWF0aC5tYXgoMCx5KSk7XG4gICAgX3NjYWxlT2JqZWN0X292ZXJ3cml0dGVuLmNhbGwodGhpcywgeCx5LCBieSk7XG4gIH0sXG4gIC8qKlxuICAgKiBTY2FsZXMgb2JqZWN0IGJ5IGludm9raW5nIGl0cyBzY2FsZVgvc2NhbGVZIG1ldGhvZHNcbiAgICogQHByaXZhdGVcbiAgICogQHBhcmFtIHtOdW1iZXJ9IHggcG9pbnRlcidzIHggY29vcmRpbmF0ZVxuICAgKiBAcGFyYW0ge051bWJlcn0geSBwb2ludGVyJ3MgeSBjb29yZGluYXRlXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBieSBFaXRoZXIgJ3gnIG9yICd5JyAtIHNwZWNpZmllcyBkaW1lbnNpb24gY29uc3RyYWludCBieSB3aGljaCB0byBzY2FsZSBhbiBvYmplY3QuXG4gICAqICAgICAgICAgICAgICAgICAgICBXaGVuIG5vdCBwcm92aWRlZCwgYW4gb2JqZWN0IGlzIHNjYWxlZCBieSBib3RoIGRpbWVuc2lvbnMgZXF1YWxseVxuICAgKi9cbiAgX3NjYWxlT2JqZWN0OiBmdW5jdGlvbiAoeCwgeSwgYnkpIHtcbiAgICB2YXIgX3NjYWxlZCA9IF9zY2FsZU9iamVjdF9vdmVyd3JpdHRlbi5jYWxsKHRoaXMsIHgsIHksIGJ5KTtcblxuICAgIHZhciB0ciA9IHRoaXMuX2N1cnJlbnRUcmFuc2Zvcm0sXG4gICAgICB0YXJnZXQgPSB0ci50YXJnZXQsXG4gICAgICBjb3JuZXIgPSB0ci5jb3JuZXI7XG4gICAgdmFyIF92ID0gdGhpcy52aWV3cG9ydFRyYW5zZm9ybTtcblxuICAgIGlmICghdGFyZ2V0Lm1vdmVtZW50TGltaXRzIHx8IHRhcmdldC5tb3ZlbWVudExpbWl0TW9kZSAhPT0gXCJmaXRcIil7XG4gICAgICByZXR1cm4gX3NjYWxlZDtcbiAgICB9XG4gICAgdGFyZ2V0LnNldENvb3JkcygpO1xuXG4gICAgdmFyIF9zY2FsZSA9IHRoaXMuZ2V0Wm9vbSgpO1xuXG4gICAgaWYodGFyZ2V0Lm1vdmVtZW50TGltaXRzID09IHRoaXMpe1xuICAgICAgdmFyIF93ID0gdGhpcy5vcmlnaW5hbFdpZHRoIHx8IHRoaXMud2lkdGg7XG4gICAgICB2YXIgX2ggPSB0aGlzLm9yaWdpbmFsSGVpZ2h0IHx8IHRoaXMuaGVpZ2h0O1xuICAgICAgdmFyIF9sID0gdGhpcy52aWV3cG9ydFRyYW5zZm9ybVs0XSA7XG4gICAgICB2YXIgX3QgPSB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzVdIDtcbiAgICAgIF93ICo9IF9zY2FsZTtcbiAgICAgIF9oICo9IF9zY2FsZTtcbiAgICAgIHZhciBfcmMgPSB7XG4gICAgICAgIHRsOiB7eDogX2wsIHk6IF90fSxcbiAgICAgICAgdHI6IHt4OiBfbCArIF93LCB5OiBfdH0sXG4gICAgICAgIGJsOiB7eDogX2wsIHk6IF90ICsgX2h9LFxuICAgICAgICBicjoge3g6IF9sICsgX3csIHk6IF90ICsgX2h9XG4gICAgICB9XG4gICAgfWVsc2V7XG4gICAgICB0YXJnZXQubW92ZW1lbnRMaW1pdHMuc2V0Q29vcmRzKCk7XG4gICAgICB2YXIgX3JjID0gdGFyZ2V0Lm1vdmVtZW50TGltaXRzLm9Db29yZHM7XG4gICAgfVxuXG5cbiAgICBpZiAoIXRyLnBvaW50ZXJPZmZzZXQpIHtcbiAgICAgIHRyLnBvaW50ZXJPZmZzZXQgPSB7XG4gICAgICAgIHg6IHggKiBfdlswXSAtIHRhcmdldC5vQ29vcmRzW2Nvcm5lcl0ueCxcbiAgICAgICAgeTogeSAqIF92WzNdIC0gdGFyZ2V0Lm9Db29yZHNbY29ybmVyXS55XG4gICAgICB9XG5cbiAgICAgIHRyLnBvaW50Q2VudGVyID0gdGFyZ2V0LmdldENlbnRlclBvaW50KCk7XG4gICAgICB0ci5wb2ludENlbnRlci54ICo9IF9zY2FsZTtcbiAgICAgIHRyLnBvaW50Q2VudGVyLnkgKj0gX3NjYWxlO1xuICAgICAgdHIucG9pbnRPcmlnaW5hbCA9IHRyLm9yaWdpbmFsLm9Db29yZHNbY29ybmVyXTtcbiAgICB9XG5cbiAgICB0ci5wb2ludFRyYW5mb3JtZWQgPSB0YXJnZXQub0Nvb3Jkc1tjb3JuZXJdO1xuXG4gICAgdHIubWxMaW5lcyA9IFtdO1xuICAgIHRyLmxpbmVzID0gW107XG4gICAgZnVuY3Rpb24gX2ludGVyc2VjdGlvbihjb3JuZXIsIGNvb3JkaW5hdGUpIHtcbiAgICAgIHZhciBfb2M7XG4gICAgICBpZiAoY29vcmRpbmF0ZSA9PSBcInhcIiAmJiBjb3JuZXJbMF0gIT0gXCJtXCIpIHtcbiAgICAgICAgX29jID0gdHIub3JpZ2luYWwub0Nvb3Jkc1tcIm1cIiArIGNvcm5lclswXV07XG4gICAgICB9IGVsc2UgaWYgKGNvb3JkaW5hdGUgPT0gXCJ5XCIgJiYgY29ybmVyWzBdICE9IFwibVwiKSB7XG4gICAgICAgIF9vYyA9IHRyLm9yaWdpbmFsLm9Db29yZHNbXCJtXCIgKyBjb3JuZXJbMV1dO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgX29jID0gdHIucG9pbnRDZW50ZXI7XG4gICAgICAgIF9vYyA9IHtcbiAgICAgICAgICB4OiBfb2MueCArIF92WzRdLFxuICAgICAgICAgIHk6IF9vYy55ICsgX3ZbNV1cbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIHZhciBfdGMgPSB0YXJnZXQub0Nvb3Jkc1tjb3JuZXJdO1xuXG4gICAgICB0ci5saW5lcy5wdXNoKFtfb2MsIF90Y10pO1xuICAgICAgdHIubWxMaW5lcy5wdXNoKFtfcmMudGwsIF9yYy50cl0pO1xuICAgICAgdHIubWxMaW5lcy5wdXNoKFtfcmMudHIsIF9yYy5icl0pO1xuICAgICAgdHIubWxMaW5lcy5wdXNoKFtfcmMuYnIsIF9yYy5ibF0pO1xuICAgICAgdHIubWxMaW5lcy5wdXNoKFtfcmMuYmwsIF9yYy50bF0pO1xuXG4gICAgICB2YXIgaW50ZXJzID0gZmFicmljLkludGVyc2VjdGlvbi5pbnRlcnNlY3RMaW5lUG9seWdvbihfb2MsIF90YywgW19yYy50bCwgX3JjLnRyLCBfcmMuYnIsIF9yYy5ibF0pO1xuICAgICAgaWYgKCFpbnRlcnMucG9pbnRzLmxlbmd0aCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBpbnRlcnMucG9pbnRzWzBdLmNvb3JkaW5hdGUgPSBjb29yZGluYXRlO1xuICAgICAgdHIuX2ludGVyc2VjdGlvbnMucHVzaChpbnRlcnMucG9pbnRzWzBdKVxuXG4vLyAgICAgICAgIGlmIChjb29yZGluYXRlKSB7XG4vLyAgICAgICAgICAgdmFyIHAxID0gaW50ZXJzLnBvaW50c1swXTtcblxuLy8gICAgICAgICAgIHZhciBjb3JuZXIyO1xuLy8gICAgICAgICAgIGlmIChjb29yZGluYXRlID09IFwieFwiKSB7XG4vLyAgICAgICAgICAgICBjb3JuZXIyID0gKGNvcm5lclswXSA9PSBcInRcIiA/IFwiYlwiIDogXCJ0XCIpICsgY29ybmVyWzFdO1xuLy8gICAgICAgICAgIH0gZWxzZSB7XG4vLyAgICAgICAgICAgICBjb3JuZXIyID0gY29ybmVyWzBdICsgKGNvcm5lclsxXSA9PSBcImxcIiA/IFwiclwiIDogXCJsXCIpO1xuLy8gICAgICAgICAgIH1cbi8vICAgICAgICAgICB2YXIgX3AyID0gdGFyZ2V0Lm9Db29yZHNbY29ybmVyMl07XG4vLyAgICAgICAgICAgdmFyIF9kaWZmID0ge3g6IF90Yy54IC0gcDEueCwgeTogX3RjLnkgLSBwMS55fTtcblxuLy8gICAgICAgICAgIHZhciBwMiA9IHtcbi8vICAgICAgICAgICAgIHg6IF9wMi54IC0gX2RpZmYueCxcbi8vICAgICAgICAgICAgIHk6IF9wMi55IC0gX2RpZmYueVxuLy8gICAgICAgICAgIH07XG5cbi8vICAgICAgICAgICB2YXIgaXRzID0gZmFicmljLkludGVyc2VjdGlvbi5pbnRlcnNlY3RMaW5lTGluZSh0ci5wb2ludENlbnRlciwgdHIucG9pbnRUcmFuZm9ybWVkLCBwMSwgcDIpO1xuLy8gICAgICAgICAgIGlmICghaXRzLnBvaW50c1swXSkge1xuLy8gICAgICAgICAgICAgcmV0dXJuO1xuLy8gICAgICAgICAgIH1cbi8vICAgICAgICAgICB0ci5faW50ZXJzZWN0aW9ucy5wdXNoKGl0cy5wb2ludHNbMF0pO1xuLy8gICAgICAgICB9IGVsc2Uge1xuLy8gICAgICAgICAgIHRyLl9pbnRlcnNlY3Rpb25zLnB1c2goaW50ZXJzLnBvaW50c1swXSk7XG4vLyAgICAgICAgIH1cblxuXG4gICAgICAvL1xuICAgICAgLy9pZihpbnRlcnMucG9pbnRzLmxlbmd0aCl7XG4gICAgICAvLyAgX3NjYWxlT2JqZWN0X292ZXJ3cml0dGVuLmNhbGwodGhpcywgaW50ZXJzLnBvaW50c1swXS54LCAgaW50ZXJzLnBvaW50c1swXS55LCBieSk7XG4gICAgICAvLyAgdGFyZ2V0LnNldENvb3JkcygpO1xuICAgICAgLy99ZWxzZXtcbiAgICAgIC8vICBfc2NhbGVPYmplY3Rfb3ZlcndyaXR0ZW4uY2FsbCh0aGlzLCB4LCB5LCBieSk7XG4gICAgICAvL31cbiAgICB9XG5cblxuICAgIHRyLl9pbnRlcnNlY3Rpb24gPSBudWxsO1xuICAgIHRyLl9pbnRlcnNlY3Rpb25zID0gW107XG4gICAgc3dpdGNoIChjb3JuZXIpIHtcbiAgICAgIGNhc2UgXCJ0bFwiOlxuICAgICAgICBfaW50ZXJzZWN0aW9uKFwidGxcIik7XG4gICAgICAgIF9pbnRlcnNlY3Rpb24oXCJibFwiLCBcInhcIik7XG4gICAgICAgIF9pbnRlcnNlY3Rpb24oXCJ0clwiLCBcInlcIik7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcInRyXCI6XG4gICAgICAgIF9pbnRlcnNlY3Rpb24oXCJ0clwiKTtcbiAgICAgICAgX2ludGVyc2VjdGlvbihcInRsXCIsIFwieVwiKTtcbiAgICAgICAgX2ludGVyc2VjdGlvbihcImJyXCIsIFwieFwiKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwiYnJcIjpcbiAgICAgICAgX2ludGVyc2VjdGlvbihcImJyXCIpO1xuICAgICAgICBfaW50ZXJzZWN0aW9uKFwidHJcIiwgXCJ4XCIpO1xuICAgICAgICBfaW50ZXJzZWN0aW9uKFwiYmxcIiwgXCJ5XCIpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJibFwiOlxuICAgICAgICBfaW50ZXJzZWN0aW9uKFwiYmxcIik7XG4gICAgICAgIF9pbnRlcnNlY3Rpb24oXCJ0bFwiLCBcInhcIik7XG4gICAgICAgIF9pbnRlcnNlY3Rpb24oXCJiclwiLCBcInlcIik7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcIm10XCI6XG4gICAgICAgIF9pbnRlcnNlY3Rpb24oXCJtdFwiKTtcbiAgICAgICAgX2ludGVyc2VjdGlvbihcInRsXCIsIFwieVwiKTtcbiAgICAgICAgX2ludGVyc2VjdGlvbihcInRyXCIsIFwieVwiKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwibWJcIjpcbiAgICAgICAgX2ludGVyc2VjdGlvbihcIm1iXCIpO1xuICAgICAgICBfaW50ZXJzZWN0aW9uKFwiYmxcIiwgXCJ5XCIpO1xuICAgICAgICBfaW50ZXJzZWN0aW9uKFwiYnJcIiwgXCJ5XCIpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJtclwiOlxuICAgICAgICBfaW50ZXJzZWN0aW9uKFwibXJcIik7XG4gICAgICAgIF9pbnRlcnNlY3Rpb24oXCJ0clwiLCBcInhcIik7XG4gICAgICAgIF9pbnRlcnNlY3Rpb24oXCJiclwiLCBcInhcIik7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcIm1sXCI6XG4gICAgICAgIF9pbnRlcnNlY3Rpb24oXCJtbFwiKTtcbiAgICAgICAgX2ludGVyc2VjdGlvbihcInRsXCIsIFwieFwiKTtcbiAgICAgICAgX2ludGVyc2VjdGlvbihcImJsXCIsIFwieFwiKTtcbiAgICB9XG5cbiAgICBpZiAoIXRyLl9pbnRlcnNlY3Rpb25zLmxlbmd0aCkge1xuICAgICAgcmV0dXJuIF9zY2FsZWQ7XG4gICAgfVxuXG5cbiAgICB2YXIgX25ld1hZID0gdHIuX2ludGVyc2VjdGlvbnNbMF07XG4gICAgdmFyIF9sID0gdHIuX2ludGVyc2VjdGlvbnNbMF0uZGlzdGFuY2VGcm9tKHRyLnBvaW50T3JpZ2luYWwpO1xuXG4gICAgZm9yICh2YXIgaSA9IDE7IGkgPCB0ci5faW50ZXJzZWN0aW9ucy5sZW5ndGg7IGkrKykge1xuICAgICAgdmFyIF9sMiA9IHRyLl9pbnRlcnNlY3Rpb25zW2ldLmRpc3RhbmNlRnJvbSh0ci5wb2ludE9yaWdpbmFsKTtcbiAgICAgIGlmIChfbDIgPCBfbCkge1xuICAgICAgICBfbmV3WFkgPSB0ci5faW50ZXJzZWN0aW9uc1tpXTtcbiAgICAgICAgX2wgPSBfbDI7XG4gICAgICB9XG4gICAgfVxuICAgIHRyLl9pbnRlcnNlY3Rpb24gPSBfbmV3WFk7XG5cblxuICAgIGlmIChieSA9PSBcImVxdWFsbHlcIikge1xuICAgICAgLy9ieSA9IGZhbHNlO1xuXG4gICAgICB2YXIgX2RpZmYyID0ge3g6IF9uZXdYWS54IC0gdHIucG9pbnRDZW50ZXIueCwgeTogX25ld1hZLnkgLSB0ci5wb2ludENlbnRlci55fTtcbiAgICAgIHZhciBfbCA9IE1hdGguc3FydChfZGlmZjIueCAqIF9kaWZmMi54ICsgX2RpZmYyLnkgKiBfZGlmZjIueSk7XG5cbiAgICAgIF9uZXdYWS54IC09IF9kaWZmMi54IC8gX2wgKiB0YXJnZXQuc3Ryb2tlV2lkdGg7XG4gICAgICBfbmV3WFkueSAtPSBfZGlmZjIueSAvIF9sICogdGFyZ2V0LnN0cm9rZVdpZHRoO1xuICAgICAgLy8gc2NydCh4KnggKyB5KnkpID0gYXRyb2tld2lkdGhcbiAgICAgIHZhciBhID0gMTtcbiAgICB9XG4gICAgLy9yZXR1cm4gX3NjYWxlT2JqZWN0X292ZXJ3cml0dGVuLmNhbGwodGhpcywgeCwgeSwgYnkpO1xuICAgIHZhciBfX3ggPSAoX25ld1hZLnggKyB0ci5wb2ludGVyT2Zmc2V0LnggKSAvIF92WzBdO1xuICAgIHZhciBfX3kgPSAoX25ld1hZLnkgKyB0ci5wb2ludGVyT2Zmc2V0LnkgKSAvIF92WzNdO1xuICAgIHJldHVybiBfc2NhbGVPYmplY3Rfb3ZlcndyaXR0ZW4uY2FsbCh0aGlzLCBfX3gsIF9feSwgYnkpO1xuXG4gICAgLy9cbiAgICAvL2lmIChjb3JuZXIgPT0gXCJiclwiIHx8IGNvcm5lciA9PSBcInRyXCIgfHwgY29ybmVyID09IFwibXJcIikge1xuICAgIC8vICBpZiAoeCA8IHRhcmdldC5tb3ZlbWVudFhNYXhMaW1pdCkge1xuICAgIC8vICAgIHggPSB0YXJnZXQubW92ZW1lbnRYTWF4TGltaXQ7XG4gICAgLy8gIH1cbiAgICAvL31cbiAgICAvL2lmIChjb3JuZXIgPT0gXCJibFwiIHx8IGNvcm5lciA9PSBcInRsXCIgfHwgY29ybmVyID09IFwibWxcIikge1xuICAgIC8vICBpZiAoeCA+IHRhcmdldC5tb3ZlbWVudFhNaW5MaW1pdCkge1xuICAgIC8vICAgIHggPSB0YXJnZXQubW92ZW1lbnRYTWluTGltaXQ7XG4gICAgLy8gIH1cbiAgICAvL31cbiAgICAvL2lmIChjb3JuZXIgPT0gXCJibFwiIHx8IGNvcm5lciA9PSBcImJyXCIgfHwgY29ybmVyID09IFwibWJcIikge1xuICAgIC8vICBpZiAoeSA8IHRhcmdldC5tb3ZlbWVudFlNYXhMaW1pdCkge1xuICAgIC8vICAgIHkgPSB0YXJnZXQubW92ZW1lbnRZTWF4TGltaXQ7XG4gICAgLy8gIH1cbiAgICAvL31cbiAgICAvL2lmIChjb3JuZXIgPT0gXCJ0bFwiIHx8IGNvcm5lciA9PSBcInRyXCIgfHwgY29ybmVyID09IFwibXRcIikge1xuICAgIC8vICBpZiAoeSA+IHRhcmdldC5tb3ZlbWVudFlNaW5MaW1pdCkge1xuICAgIC8vICAgIHkgPSB0YXJnZXQubW92ZW1lbnRZTWluTGltaXQ7XG4gICAgLy8gIH1cbiAgICAvL31cbiAgICAvL1xuICAgIC8vX3NjYWxlT2JqZWN0X292ZXJ3cml0dGVuLmNhbGwodGhpcywgeCwgeSwgYnkpO1xuICB9LFxuICBtb3ZlbWVudExpbWl0c09uQWRkQWN0aW9uOiAndHJhbnNsYXRlJyxcbiAgX2NoZWNrX29iamVjdF9hZnRlcl9tb2RpZmllZDogZnVuY3Rpb24gKHRhcmdldCkge1xuICAgIGlmICghdGhpcy5fY3VycmVudFRyYW5zZm9ybSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB2YXIgcG9zID0gdGhpcy5nZXRGaXhlZFBvc2l0aW9uKHRhcmdldCwgdGFyZ2V0LmxlZnQsIHRhcmdldC50b3ApO1xuXG4gICAgc3dpdGNoICh0aGlzLl9jdXJyZW50VHJhbnNmb3JtLmNvcm5lcikge1xuICAgICAgY2FzZSBcIm10clwiOlxuICAgICAgICBpZiAocG9zLmxlZnQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIHRhcmdldC5zZXQoJ2xlZnQnLCBwb3MubGVmdCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHBvcy50b3ApIHtcbiAgICAgICAgICB0YXJnZXQuc2V0KCd0b3AnLCBwb3MudG9wKTtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJtclwiOlxuICAgICAgY2FzZSBcImJyXCI6XG4gICAgICAgIGlmIChwb3MubGVmdCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgdmFyIF9sZGlmZiA9IHRhcmdldC5sZWZ0IC0gcG9zLmxlZnQ7XG5cbiAgICAgICAgfVxuICAgICAgICBpZiAocG9zLnRvcCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgdmFyIF90ZGlmZiA9IHRhcmdldC50b3AgLSBwb3MudG9wO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKF9sZGlmZiAmJiAoIV90ZGlmZiB8fCBNYXRoLmFicyhfbGRpZmYpID4gTWF0aC5hYnMoX3RkaWZmKSkpIHtcbiAgICAgICAgICBpZiAoX2xkaWZmIDwgMCkge1xuICAgICAgICAgICAgdGFyZ2V0LndpZHRoICs9IF9sZGlmZjtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGFyZ2V0LndpZHRoIC09IF9sZGlmZjtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoX3RkaWZmKSB7XG4gICAgICAgICAgaWYgKF90ZGlmZiA8IDApIHtcbiAgICAgICAgICAgIHRhcmdldC53aWR0aCArPSBfdGRpZmY7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRhcmdldC53aWR0aCAtPSBfdGRpZmY7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAvL2NvbnNvbGUubG9nKHBvcyxfbGRpZmYsX3RkaWZmKVxuICAgIH1cbiAgICAvLyB0aGlzLl9jaGVja19vYmplY3RfcG9zaXRpb24odGFyZ2V0KVxuICB9LFxuICBfY2hlY2tfb2JqZWN0X3Bvc2l0aW9uOiBmdW5jdGlvbiAodGFyZ2V0KSB7XG5cbiAgICB2YXIgcG9zID0gdGhpcy5nZXRGaXhlZFBvc2l0aW9uKHRhcmdldCwgdGFyZ2V0LmxlZnQsIHRhcmdldC50b3ApO1xuICAgIGlmICh0aGlzLm1vdmVtZW50TGltaXRzT25BZGRBY3Rpb24gPT0gJ3RyYW5zbGF0ZScpIHtcbiAgICAgIGlmIChwb3MubGVmdCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHRhcmdldC5zZXQoJ2xlZnQnLCBwb3MubGVmdCk7XG4gICAgICB9XG4gICAgICBpZiAocG9zLnRvcCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHRhcmdldC5zZXQoJ3RvcCcsIHBvcy50b3ApO1xuICAgICAgfVxuICAgIH1lbHNle1xuXG4gICAgICBpZiAocG9zLmxlZnQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBpZiAodGFyZ2V0LmxlZnQgPCBwb3MubGVmdCkge1xuICAgICAgICAgIHRhcmdldC53aWR0aCArPSB0YXJnZXQubGVmdCAtIHBvcy5sZWZ0O1xuICAgICAgICAgIHRhcmdldC5sZWZ0ID0gcG9zLmxlZnQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGFyZ2V0LndpZHRoIC09IHRhcmdldC5sZWZ0IC0gcG9zLmxlZnQ7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChwb3MudG9wICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgaWYgKHRhcmdldC50b3AgPCBwb3MudG9wKSB7XG4gICAgICAgICAgdGFyZ2V0LmhlaWdodCArPSB0YXJnZXQudG9wIC0gcG9zLnRvcDtcbiAgICAgICAgICB0YXJnZXQudG9wID0gcG9zLnRvcDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0YXJnZXQuaGVpZ2h0IC09IHRhcmdldC50b3AgLSBwb3MudG9wO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG5cbiAgICBpZiAocG9zLnNjYWxlWCkge1xuICAgICAgdGFyZ2V0LnNjYWxlWCA9IHRhcmdldC5zY2FsZVggKj0gcG9zLnNjYWxlWDtcbiAgICB9XG4gICAgaWYgKHBvcy5zY2FsZVkpIHtcbiAgICAgIHRhcmdldC5zY2FsZVkgPSB0YXJnZXQuc2NhbGVZICo9IHBvcy5zY2FsZVk7XG4gICAgfVxuXG4gICAgdGFyZ2V0LnNldENvb3JkcygpO1xuXG4gICAgdGhpcy5yZW5kZXJBbGwoKTtcbiAgICAvLyBpZih0YXJnZXQud2hvbGVDb29yZGluYXRlcyl7XG4gICAgLy8gICB0YXJnZXQudG9wID0gTWF0aC5yb3VuZCh0YXJnZXQudG9wKTtcbiAgICAvLyAgIHRhcmdldC5sZWZ0ID0gTWF0aC5yb3VuZCh0YXJnZXQubGVmdCk7XG4gICAgLy8gICB0YXJnZXQuaGVpZ2h0ID0gTWF0aC5yb3VuZCh0YXJnZXQuaGVpZ2h0KTtcbiAgICAvLyAgIHRhcmdldC53aWR0aCA9IE1hdGgucm91bmQodGFyZ2V0LndpZHRoKTtcbiAgICAvLyB9XG4gIH0sXG4gIF90cmFuc2xhdGVPYmplY3Q6IGZ1bmN0aW9uICh4LCB5LCBsaW1pdHMpIHtcbiAgICB2YXIgdGFyZ2V0ID0gdGhpcy5fY3VycmVudFRyYW5zZm9ybS50YXJnZXQ7XG4gICAgaWYodGFyZ2V0LmJlZm9yZVRyYW5zbGF0ZSl7XG4gICAgICB2YXIgX3BvaW50ID0gdGFyZ2V0LmJlZm9yZVRyYW5zbGF0ZSh4LCB5KTtcbiAgICAgIGlmKCFfcG9pbnQpcmV0dXJuIGZhbHNlO1xuICAgICAgeCA9IF9wb2ludC54O1xuICAgICAgeSA9IF9wb2ludC55O1xuICAgIH1cbiAgICB2YXIgX3RyYW5zbGF0ZWQgPSBfdHJhbnNsYXRlT2JqZWN0X292ZXJ3cml0dGVuLmNhbGwodGhpcywgeCwgeSwgbGltaXRzKTtcblxuICAgIGlmKHRoaXMubW92ZW1lbnRMaW1pdHMpe1xuXG4gICAgICB2YXIgcG9zID0gdGhpcy5nZXRGaXhlZFBvc2l0aW9uKHRhcmdldCwgeCwgeSk7XG5cbiAgICAgIGlmIChwb3Muc2NhbGVYKSB7XG4gICAgICAgIHRhcmdldC5zY2FsZVggPSB0aGlzLl9jdXJyZW50VHJhbnNmb3JtLnNjYWxlWCAqPSBwb3Muc2NhbGVYO1xuICAgICAgfVxuICAgICAgaWYgKHBvcy5zY2FsZVkpIHtcbiAgICAgICAgdGFyZ2V0LnNjYWxlWSA9IHRoaXMuX2N1cnJlbnRUcmFuc2Zvcm0uc2NhbGVZICo9IHBvcy5zY2FsZVk7XG4gICAgICB9XG5cbiAgICAgIGlmIChwb3MudG9wICE9PSB1bmRlZmluZWQgfHwgcG9zLmxlZnQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBfdHJhbnNsYXRlZCA9IF90cmFuc2xhdGVPYmplY3Rfb3ZlcndyaXR0ZW4uY2FsbCh0aGlzLFxuICAgICAgICAgIHBvcy5sZWZ0ICE9PSB1bmRlZmluZWQgPyBwb3MubGVmdCA6IHgsXG4gICAgICAgICAgcG9zLnRvcCAhPT0gdW5kZWZpbmVkID8gcG9zLnRvcCA6IHkpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gX3RyYW5zbGF0ZWQgfHwgcG9zLnNjYWxlWCB8fCBwb3Muc2NhbGVZO1xuXG5cblxuICAgIC8qIGlmICghdGFyZ2V0LmdldCgnbG9ja01vdmVtZW50WCcpKSB7XG4gICAgIHZhciBfdmFsID0geCAtIHRoaXMuX2N1cnJlbnRUcmFuc2Zvcm0ub2Zmc2V0WDtcblxuICAgICAvL2xlZnQgb2Zmc2V0XG4gICAgIHZhciBsaW0gPSB0aGlzLm1vdmVtZW50TGltaXRzLm1pblguY29uc3RydWN0b3IgPT0gTnVtYmVyID8gdGhpcy5tb3ZlbWVudExpbWl0cy5taW5YIDogLWJvdW5kcy53aWR0aCArIDE7XG4gICAgIGlmKHRhcmdldC5tb3ZlbWVudFhNaW5MaW1pdCAmJiB0YXJnZXQubW92ZW1lbnRYTWluTGltaXQuY29uc3RydWN0b3IgPT0gTnVtYmVyICYmIHRhcmdldC5tb3ZlbWVudFhNaW5MaW1pdCA+IGxpbSApe1xuICAgICBsaW0gPSB0YXJnZXQubW92ZW1lbnRYTWluTGltaXQgO1xuICAgICB9XG5cbiAgICAgX3ZhbCA9IE1hdGgubWluKGxpbSwgX3ZhbCk7XG5cbiAgICAgLy9yaWdodCBvZmZzZXRcbiAgICAgdmFyIGxpbSA9IHRoaXMubW92ZW1lbnRMaW1pdHMubWF4WC5jb25zdHJ1Y3RvciA9PSBOdW1iZXIgPyB0aGlzLm1vdmVtZW50TGltaXRzLm1heFggOiB0aGlzLndpZHRoICsgYm91bmRzLndpZHRoIC0gMTtcbiAgICAgaWYodGFyZ2V0Lm1vdmVtZW50WE1heExpbWl0ICYmIHRhcmdldC5tb3ZlbWVudFhNYXhMaW1pdC5jb25zdHJ1Y3RvciA9PSBOdW1iZXIgJiYgdGFyZ2V0Lm1vdmVtZW50WE1heExpbWl0ID4gbGltICl7XG4gICAgIGxpbSA9IHRhcmdldC5tb3ZlbWVudFhNYXhMaW1pdCA7XG4gICAgIH1cbiAgICAgX3ZhbCA9IE1hdGgubWF4KGxpbSAgLSB0YXJnZXQud2lkdGggKiB0YXJnZXQuc2NhbGVYLCBfdmFsKTtcbiAgICAgdGFyZ2V0LnNldCgnbGVmdCcsIF92YWwpO1xuICAgICB9XG4gICAgIGlmICghdGFyZ2V0LmdldCgnbG9ja01vdmVtZW50WScpKSB7XG4gICAgIHZhciBfdmFsID0geSAtIHRoaXMuX2N1cnJlbnRUcmFuc2Zvcm0ub2Zmc2V0WTtcbiAgICAgaWYodGFyZ2V0Lm1vdmVtZW50WU1pbkxpbWl0ICE9PSB1bmRlZmluZWQpXG4gICAgIF92YWwgPSBNYXRoLm1pbih0YXJnZXQubW92ZW1lbnRZTWluTGltaXQsIF92YWwpO1xuICAgICBpZih0YXJnZXQubW92ZW1lbnRZTWF4TGltaXQgIT09IHVuZGVmaW5lZClcbiAgICAgX3ZhbCA9IE1hdGgubWF4KHRhcmdldC5tb3ZlbWVudFlNYXhMaW1pdCAgLSB0YXJnZXQuaGVpZ2h0LCBfdmFsKTtcblxuICAgICB0YXJnZXQuc2V0KCd0b3AnLCBfdmFsKTtcbiAgICAgfVxuICAgICAqL1xuICAgIC8vbW92ZW1lbnRMaW1pdHMgPXtcbiAgICAvLyAgICB4bWluOiAwLFxuICAgIC8vICAgIHhtYXg6IDAsXG4gICAgLy8gICAgeW1pbjogMCxcbiAgICAvLyAgICB5bWF4OiAwXG4gICAgLy99O1xuXG4gIH0sXG5cbiAgX2JlZm9yZVRyYW5zZm9ybTogZnVuY3Rpb24gKGUsIHRhcmdldCkge1xuICAgIHRhcmdldCAmJiB0YXJnZXQuX2JlZm9yZVRyYW5zZm9ybSA/XG4gICAgICB0YXJnZXQuX2JlZm9yZVRyYW5zZm9ybShlKSA6XG4gICAgICBfYmVmb3JlVHJhbnNmb3JtX292ZXJ3cml0dGVuLmNhbGwodGhpcywgZSwgdGFyZ2V0KTtcbiAgfSxcbiAgX2JlZm9yZVRyYW5zZm9ybU5hdGl2ZTogX2JlZm9yZVRyYW5zZm9ybV9vdmVyd3JpdHRlbixcbiAgLyoqXG4gICAqIFRyYW5zbGF0ZXMgb2JqZWN0IGJ5IFwic2V0dGluZ1wiIGl0cyBsZWZ0L3RvcFxuICAgKiBAcHJpdmF0ZVxuICAgKiBAcGFyYW0ge051bWJlcn0geCBwb2ludGVyJ3MgeCBjb29yZGluYXRlXG4gICAqIEBwYXJhbSB7TnVtYmVyfSB5IHBvaW50ZXIncyB5IGNvb3JkaW5hdGVcbiAgICogQHJldHVybiB7Qm9vbGVhbn0gdHJ1ZSBpZiB0aGUgdHJhbnNsYXRpb24gb2NjdXJyZWRcbiAgICovXG4gLyogX3RyYW5zbGF0ZU9iamVjdDogZnVuY3Rpb24gKHgsIHkpIHtcbiAgICB2YXIgdHJhbnNmb3JtID0gdGhpcy5fY3VycmVudFRyYW5zZm9ybSxcbiAgICAgIHRhcmdldCA9IHRyYW5zZm9ybS50YXJnZXQsXG4gICAgICBuZXdMZWZ0ID0geCAtIHRyYW5zZm9ybS5vZmZzZXRYLFxuICAgICAgbmV3VG9wID0geSAtIHRyYW5zZm9ybS5vZmZzZXRZLFxuICAgICAgbW92ZVggPSAhdGFyZ2V0LmdldCgnbG9ja01vdmVtZW50WCcpICYmIHRhcmdldC5sZWZ0ICE9PSBuZXdMZWZ0LFxuICAgICAgbW92ZVkgPSAhdGFyZ2V0LmdldCgnbG9ja01vdmVtZW50WScpICYmIHRhcmdldC50b3AgIT09IG5ld1RvcDtcblxuXG4gICAgLy9yb3VuZCBjb29yZGluYXRlc1xuICAgIC8vIGlmICh0YXJnZXQud2hvbGVDb29yZGluYXRlcykge1xuICAgIC8vICAgbmV3TGVmdCA9IE1hdGgucm91bmQobmV3TGVmdCk7XG4gICAgLy8gICBuZXdUb3AgPSBNYXRoLnJvdW5kKG5ld1RvcCk7XG4gICAgLy8gfVxuXG4gICAgbW92ZVggJiYgdGFyZ2V0LnNldCgnbGVmdCcsIG5ld0xlZnQpO1xuICAgIG1vdmVZICYmIHRhcmdldC5zZXQoJ3RvcCcsIG5ld1RvcCk7XG4gICAgcmV0dXJuIG1vdmVYIHx8IG1vdmVZO1xuICB9Ki9cbn0pO1xuXG4vL2ZhYnJpYy5TbGlkZUNhbnZhcy5hZGRQbHVnaW4oXCJsb2FkZXJzXCIsZnVuY3Rpb24oKXtcbi8vICAgIHRoaXMuaW5pdE1vdmVtZW50TGltaXRzKCk7XG4vL30pO1xuXG4vL3RvZG9cbmZhYnJpYy5SZWN0LnByb3RvdHlwZS5zdGF0ZVByb3BlcnRpZXMgICA9IGZhYnJpYy5SZWN0LnByb3RvdHlwZS5zdGF0ZVByb3BlcnRpZXMuY29uY2F0KFtcIm1vdmVtZW50TGltaXRzXCIsXCJjbGlwVG9cIl0pO1xuZmFicmljLk9iamVjdC5wcm90b3R5cGUuc3RhdGVQcm9wZXJ0aWVzID0gZmFicmljLk9iamVjdC5wcm90b3R5cGUuc3RhdGVQcm9wZXJ0aWVzLmNvbmNhdChbXCJtb3ZlbWVudExpbWl0c1wiLFwiY2xpcFRvXCJdKTtcbmZhYnJpYy5JVGV4dC5wcm90b3R5cGUuc3RhdGVQcm9wZXJ0aWVzICA9IGZhYnJpYy5JVGV4dC5wcm90b3R5cGUuc3RhdGVQcm9wZXJ0aWVzLmNvbmNhdChbXCJtb3ZlbWVudExpbWl0c1wiLFwiY2xpcFRvXCJdKTtcbmZhYnJpYy5JbWFnZS5wcm90b3R5cGUuc3RhdGVQcm9wZXJ0aWVzICA9IGZhYnJpYy5JbWFnZS5wcm90b3R5cGUuc3RhdGVQcm9wZXJ0aWVzLmNvbmNhdChbXCJtb3ZlbWVudExpbWl0c1wiLFwiY2xpcFRvXCJdKTtcblxuXG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL21vZHVsZXMvbW92ZW1lbnRMaW1pdHMuanMiLCIndXNlIHN0cmljdCc7XG5cblxuLy8gZmFicmljLnJlcXVpcmUoJ1NsaWRlR3JvdXAnLFsnU2xpZGVPYmplY3QnXSwgZnVuY3Rpb24oKSB7XG52YXIgX09CSiA9IGZhYnJpYy5PYmplY3QucHJvdG90eXBlO1xudmFyIF9oYW5kbGVHcm91cGluZ19vdmVyd3JpdHRlbiA9IGZhYnJpYy5DYW52YXMucHJvdG90eXBlLl9oYW5kbGVHcm91cGluZztcbmZhYnJpYy5PYmplY3QucHJvdG90eXBlLmdyb3VwYWJsZSA9IHRydWU7XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLkNhbnZhcy5wcm90b3R5cGUsIHtcbiAgLyoqXG4gICAqIERlYWN0aXZhdGVzIGFsbCBvYmplY3RzIGFuZCBkaXNwYXRjaGVzIGFwcHJvcHJpYXRlIGV2ZW50c1xuICAgKiBAcmV0dXJuIHtmYWJyaWMuQ2FudmFzfSB0aGlzQXJnXG4gICAqIEBjaGFpbmFibGVcbiAgICovXG4gIGRlYWN0aXZhdGVBbGxXaXRoRGlzcGF0Y2g6IGZ1bmN0aW9uIChlKSB7XG4gICAgdmFyIGFjdGl2ZUdyb3VwID0gdGhpcy5nZXRBY3RpdmVHcm91cCgpLFxuICAgICAgYWN0aXZlT2JqZWN0ID0gdGhpcy5nZXRBY3RpdmVPYmplY3QoKTtcbiAgICB2YXIgX3RhcmdldCA9IGFjdGl2ZU9iamVjdCB8fCBhY3RpdmVHcm91cDtcbiAgICBpZiAoX3RhcmdldCkge1xuICAgICAgdGhpcy5maXJlKCdiZWZvcmU6c2VsZWN0aW9uOmNsZWFyZWQnLCB7IHRhcmdldDogX3RhcmdldCwgZTogZSB9KTtcbiAgICB9XG4gICAgdGhpcy5kZWFjdGl2YXRlQWxsKCk7XG4gICAgaWYgKF90YXJnZXQpIHtcbiAgICAgIHRoaXMuZmlyZSgnc2VsZWN0aW9uOmNsZWFyZWQnLCB7IGU6IGUsIHRhcmdldDogX3RhcmdldCB9KTtcbiAgICAgIF90YXJnZXQuZmlyZSgnZGVzZWxlY3RlZCcpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfSxcblxuICAvKipcbiAgICogRGl2aWRlcyBvYmplY3RzIGluIHR3byBncm91cHMsIG9uZSB0byByZW5kZXIgaW1tZWRpYXRlbHlcbiAgICogYW5kIG9uZSB0byByZW5kZXIgYXMgYWN0aXZlR3JvdXAuXG4gICAqIHJldHVybiBvYmplY3RzIHRvIHJlbmRlciBpbW1lZGlhdGVseSBhbmQgcHVzaGVzIHRoZSBvdGhlciBpbiB0aGUgYWN0aXZlR3JvdXAuXG4gICAqL1xuICBfY2hvb3NlT2JqZWN0c1RvUmVuZGVyOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgYWN0aXZlR3JvdXAgPSB0aGlzLmdldEFjdGl2ZUdyb3VwKCksXG4gICAgICBhY3RpdmVPYmplY3QgPSB0aGlzLmdldEFjdGl2ZU9iamVjdCgpLFxuICAgICAgb2JqZWN0LCBvYmpzVG9SZW5kZXIgPSBbIF0sIGFjdGl2ZUdyb3VwT2JqZWN0cyA9IFsgXTtcblxuICAgIGlmIChhY3RpdmVHcm91cCAmJiAhdGhpcy5wcmVzZXJ2ZU9iamVjdFN0YWNraW5nKSB7XG4gICAgICBmb3IgKHZhciBpID0gMCwgbGVuZ3RoID0gdGhpcy5fb2JqZWN0cy5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgICBvYmplY3QgPSB0aGlzLl9vYmplY3RzW2ldO1xuICAgICAgICBpZiAoIWFjdGl2ZUdyb3VwLmNvbnRhaW5zKG9iamVjdCkpIHtcbiAgICAgICAgICBpZighb2JqZWN0LmhpZGRlbkFjdGl2ZSl7XG4gICAgICAgICAgICBvYmpzVG9SZW5kZXIucHVzaChvYmplY3QpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICBhY3RpdmVHcm91cE9iamVjdHMucHVzaChvYmplY3QpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoYWN0aXZlR3JvdXApIHtcbiAgICAgICAgLy8gYWN0aXZlR3JvdXAuX3NldCgnX29iamVjdHMnLCBhY3RpdmVHcm91cE9iamVjdHMpO1xuICAgICAgICBvYmpzVG9SZW5kZXIucHVzaChhY3RpdmVHcm91cCk7XG4gICAgICB9XG4gICAgICBhY3RpdmVPYmplY3QgJiYgb2Jqc1RvUmVuZGVyLnB1c2goYWN0aXZlT2JqZWN0KTtcbiAgICAgIC8vIGFjdGl2ZUdyb3VwLl9zZXQoJ19vYmplY3RzJywgYWN0aXZlR3JvdXBPYmplY3RzKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICBvYmpzVG9SZW5kZXIgPSB0aGlzLl9vYmplY3RzO1xuICAgIH1cbiAgICByZXR1cm4gb2Jqc1RvUmVuZGVyO1xuICB9LFxuICAvKipcbiAgICogYWRkaW5nIGJlZm9yZTpzZWxlY3Rpb246Y3JlYXRlZCBldmVudFxuICAgKiBAcHJpdmF0ZVxuICAgKiBAcGFyYW0ge0V2ZW50fSBlIEV2ZW50IG9iamVjdFxuICAgKiBAcGFyYW0ge2ZhYnJpYy5PYmplY3R9IHRhcmdldFxuICAgKi9cbiAgX2hhbmRsZUdyb3VwaW5nOiBmdW5jdGlvbiAoZSwgdGFyZ2V0KSB7XG4gICAgdGhpcy5maXJlKFwiYmVmb3JlOnNlbGVjdGlvbjpjcmVhdGVkXCIpO1xuICAgIF9oYW5kbGVHcm91cGluZ19vdmVyd3JpdHRlbi5jYWxsKHRoaXMsIGUsIHRhcmdldCk7XG4gIH0sXG4gIC8qKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAcGFyYW0ge0V2ZW50fSBlIG1vdXNlIGV2ZW50XG4gICAqL1xuICBfZ3JvdXBTZWxlY3RlZE9iamVjdHM6IGZ1bmN0aW9uIChlKSB7XG5cbiAgICB2YXIgZ3JvdXAgPSB0aGlzLl9jb2xsZWN0T2JqZWN0cygpO1xuXG4gICAgZ3JvdXAgPSBmYWJyaWMudXRpbC5vYmplY3QuZmlsdGVyKGdyb3VwLHtncm91cGFibGU6IHRydWV9KTtcblxuICAgIC8vIGRvIG5vdCBjcmVhdGUgZ3JvdXAgZm9yIDEgZWxlbWVudCBvbmx5XG4gICAgaWYgKGdyb3VwLmxlbmd0aCA9PT0gMSkge1xuICAgICAgdGhpcy5zZXRBY3RpdmVPYmplY3QoZ3JvdXBbMF0sIGUpO1xuICAgIH1cbiAgICBlbHNlIGlmIChncm91cC5sZW5ndGggPiAxKSB7XG4gICAgICBncm91cCA9IG5ldyBmYWJyaWMuR3JvdXAoZ3JvdXAucmV2ZXJzZSgpLCB7XG4gICAgICAgIGNhbnZhczogdGhpc1xuICAgICAgfSk7XG4gICAgICBncm91cC5hZGRXaXRoVXBkYXRlKCk7XG4gICAgICB0aGlzLnNldEFjdGl2ZUdyb3VwKGdyb3VwLCBlKTtcbiAgICAgIGdyb3VwLnNhdmVDb29yZHMoKTtcbiAgICAgIHRoaXMuZmlyZSgnc2VsZWN0aW9uOmNyZWF0ZWQnLCB7IHRhcmdldDogZ3JvdXAgfSk7XG4gICAgICB0aGlzLnJlbmRlckFsbCgpO1xuICAgIH1cbiAgfVxufSk7XG5cbl9PQkouY2xvbmVTeW5jID0gZnVuY3Rpb24oKXtcbiAgdmFyIF9rbGFzcyA9IGZhYnJpY1tmYWJyaWMudXRpbC5zdHJpbmcuY2FtZWxpemUoZmFicmljLnV0aWwuc3RyaW5nLmNhcGl0YWxpemUodGhpcy50eXBlKSldO1xuICBpZihfa2xhc3MuYXN5bmMpe1xuICAgIHZhciBfb2JqID0gbmV3IF9rbGFzcy5mcm9tT2JqZWN0KHRoaXMsZnVuY3Rpb24oKXtcblxuICAgIH0pO1xuICB9ZWxzZXtcbiAgICB2YXIgX29iaiA9IHRoaXMuY2xvbmUoKTtcbiAgfVxuICBfb2JqLmNhbnZhcyA9IHRoaXMuY2FudmFzO1xuICByZXR1cm4gX29iajtcbn07XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLkdyb3VwLnByb3RvdHlwZSwge1xuICBncm91cFNlbGVjdGFibGU6IHRydWUsXG4gIGNsb25lU3luYzogZnVuY3Rpb24oKSB7XG4gICAgdmFyIF9jbG9uZWRPYmplY3RzID0gdGhpcy5fb2JqZWN0cy5tYXAoZnVuY3Rpb24ob2JqZWN0KXtcbiAgICAgIHJldHVybiBvYmplY3QuY2xvbmVTeW5jKCk7XG4gICAgfSk7XG5cblxuICAgIHZhciBvYmplY3QgPSB0aGlzLnRvT2JqZWN0KCk7XG4gICAgZGVsZXRlIG9iamVjdC5vYmplY3RzO1xuXG4gICAgcmV0dXJuIG5ldyBmYWJyaWMuR3JvdXAoX2Nsb25lZE9iamVjdHMsIG9iamVjdCwgdHJ1ZSk7XG5cbiAgICAvLyBmYWJyaWMudXRpbC5lbmxpdmVuT2JqZWN0cyhvYmplY3Qub2JqZWN0cywgZnVuY3Rpb24gKGVubGl2ZW5lZE9iamVjdHMpIHtcbiAgICAvLyAgIGRlbGV0ZSBvYmplY3Qub2JqZWN0cztcbiAgICAvLyAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKG5ldyBmYWJyaWMuR3JvdXAoZW5saXZlbmVkT2JqZWN0cywgb2JqZWN0LCB0cnVlKSk7XG4gICAgLy8gfSk7XG4gIH0sXG4gIF9jYWxjQm91bmRzIDogZnVuY3Rpb24gKG9ubHlXaWR0aEhlaWdodCkge1xuICAgIHZhciBhWCA9IFtdLFxuICAgICAgYVkgPSBbXSxcbiAgICAgIG8sIHByb3AsXG4gICAgICBwcm9wcyA9IFsndHInLCAnYnInLCAnYmwnLCAndGwnXTtcblxuICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB0aGlzLl9vYmplY3RzLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7XG4gICAgICBvID0gdGhpcy5fb2JqZWN0c1tpXTtcbiAgICAgIGlmIChvLm5vdFNlbGVjdGFibGVJblRoZUdyb3VwKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgby5zZXRDb29yZHMoKTtcbiAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgcHJvcHMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgcHJvcCA9IHByb3BzW2pdO1xuICAgICAgICBhWC5wdXNoKG8ub0Nvb3Jkc1twcm9wXS54KTtcbiAgICAgICAgYVkucHVzaChvLm9Db29yZHNbcHJvcF0ueSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5zZXQodGhpcy5fZ2V0Qm91bmRzKGFYLCBhWSwgb25seVdpZHRoSGVpZ2h0KSk7XG4gIH0sXG4gIGluaXRpYWxpemVfb3ZlcndyaXR0ZW46IGZhYnJpYy5Hcm91cC5wcm90b3R5cGUuaW5pdGlhbGl6ZSxcbiAgaXNTZWxlY3Rpb25Hcm91cDogZnVuY3Rpb24oKXtcbiAgICByZXR1cm4gdGhpcy5jYW52YXMuX29iamVjdHMuaW5kZXhPZih0aGlzKSA9PT0gLTFcbiAgfSxcbiAgLy9jbG9uZTogZnVuY3Rpb24oY2FsbGJhY2spe1xuICAvLyAgaWYoY2FsbGJhY2sgPT09IHRydWUgfHwgY2FsbGJhY2suY29uc3RydWN0b3IgPT09IE9iamVjdCl7XG4gIC8vICAgIHZhciBfZnJhbWUgPSBuZXcgZmFicmljLkdyb3VwKHRoaXMpO1xuICAvLyAgICBpZihjYWxsYmFjay5jb25zdHJ1Y3RvciA9PT0gT2JqZWN0KXtcbiAgLy8gICAgICBfZnJhbWUuc2V0KGNhbGxiYWNrKTtcbiAgLy8gICAgICByZXR1cm4gX2ZyYW1lO1xuICAvLyAgICB9XG4gIC8vICB9XG4gIC8vICByZXR1cm4gdGhpcy5jYWxsU3VwZXIoJ2Nsb25lJyxjYWxsYmFjayk7XG4gIC8vfSxcbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24ob2JqZWN0cyxvcHRpb25zKXtcbiAgICBpZihvYmplY3RzLmNvbnN0cnVjdG9yICE9IEFycmF5KXtcbiAgICAgIHZhciBlbCA9IG9iamVjdHM7XG4gICAgICBvcHRpb25zID0gZWwudG9PYmplY3QoKTtcbiAgICAgIG9iamVjdHMgPSBbXTtcbiAgICAgIGZvcih2YXIgaSBpbiBlbC5fb2JqZWN0cyl7XG4gICAgICAgIG9iamVjdHMucHVzaChlbC5fb2JqZWN0c1tpXS5jbG9uZVN5bmMoKSlcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLmluaXRpYWxpemVfb3ZlcndyaXR0ZW4ob2JqZWN0cyxvcHRpb25zKTtcbiAgICBpZih0aGlzLnR5cGUgPT0gJ2dyb3VwJyl7XG4gICAgICB0aGlzLm9uKFwiZGJsY2xpY2tcIiwgZnVuY3Rpb24oKXtcbiAgICAgICAgaWYodGhpcy5jYW52YXMuX29iamVjdHMuaW5kZXhPZih0aGlzKSA9PT0gLTEpe1xuICAgICAgICAgIHRoaXMuZ3JvdXBTZWxlY3RlZEVsZW1lbnRzKCk7XG4gICAgICAgIH1lbHNle1xuICAgICAgICAgIHRoaXMudW5ncm91cCgpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH0sXG4gIHVuZ3JvdXAgOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmNhbnZhcy5kaXNjYXJkQWN0aXZlR3JvdXAoKTtcbiAgICB0aGlzLl9yZXN0b3JlT2JqZWN0c1N0YXRlKCk7XG4gICAgdGhpcy5jYW52YXMucmVtb3ZlKHRoaXMpO1xuICAgIGZvcih2YXIgaSBpbiB0aGlzLl9vYmplY3RzKXtcbiAgICAgIHRoaXMuY2FudmFzLmFkZCh0aGlzLl9vYmplY3RzW2ldKTtcbiAgICAgIHRoaXMuX29iamVjdHNbaV0uY2xpcFRvID0gdGhpcy5jbGlwVG87XG4gICAgICAvL3RoaXMuX29iamVjdHNbaV0uYWN0aXZlID0gdHJ1ZTtcbiAgICB9XG4gICAgdmFyIGdyb3VwID0gbmV3IGZhYnJpYy5Hcm91cCh0aGlzLl9vYmplY3RzLCB7XG4gICAgICBjYW52YXM6IHRoaXMuY2FudmFzXG4gICAgfSk7XG4gICAgZ3JvdXAuYWRkV2l0aFVwZGF0ZSgpO1xuICAgIHRoaXMuY2FudmFzLnNldEFjdGl2ZUdyb3VwKGdyb3VwKTtcbiAgICBncm91cC5zYXZlQ29vcmRzKCk7XG4gICAgdGhpcy5jYW52YXMuZmlyZSgnc2VsZWN0aW9uOmNyZWF0ZWQnLCB7IHRhcmdldDogZ3JvdXAgfSk7XG4gICAgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG5cbiAgICAvL3ZhciBfZ3JvdXAgPSBuZXcgZmFicmljLkdyb3VwKHRoaXMuX29iamVjdHMpO1xuICAgIC8vX2dyb3VwLmNhbnZhcyA9IHRoaXMuY2FudmFzO1xuICAgIC8vdGhpcy5jYW52YXMuc2V0QWN0aXZlT2JqZWN0KF9ncm91cCk7XG4gIH0sXG5cbiAgZ3JvdXBTZWxlY3RlZEVsZW1lbnRzOiBmdW5jdGlvbigpe1xuXG5cblxuICAgIHZhciBlbCA9IHRoaXMuY2xvbmVTeW5jKCk7XG4gICAgdGhpcy5jYW52YXMuYWRkKGVsKTtcbiAgICB0aGlzLmNhbnZhcy5kaXNjYXJkQWN0aXZlR3JvdXAoKTtcbiAgICB0aGlzLmNhbnZhcy5zZXRBY3RpdmVPYmplY3QoZWwpO1xuXG4gICAgZm9yKHZhciBpIGluIHRoaXMuX29iamVjdHMpe1xuICAgICAgdGhpcy5jYW52YXMucmVtb3ZlKHRoaXMuX29iamVjdHNbaV0ub3JpZ2luYWxPYmplY3QpO1xuICAgIH1cblxuXG4gIH0sXG4gIGFjdGlvbnM6IHtcblxuICAgIG9iamVjdFJlbW92ZToge1xuICAgICAgY2xhc3NOYW1lOiAgJ2ZhIGZhLXRyYXNoJyxcbiAgICAgIHRpdGxlOiAgICAgICdEZWxldGUnLFxuICAgICAga2V5OiAgICAgICAgXCJEZWxldGVcIixcbiAgICAgIGFjdGlvbjogICAgIGZ1bmN0aW9uKCl7XG4gICAgICAgIGlmKHRoaXMuaXNTZWxlY3Rpb25Hcm91cCgpKXtcbiAgICAgICAgICBmb3IodmFyIGkgaW4gdGhpcy5fb2JqZWN0cyl7XG4gICAgICAgICAgICB2YXIgX29iaiA9IHRoaXMuX29iamVjdHNbaV07XG4gICAgICAgICAgICB0aGlzLmNhbnZhcy5yZW1vdmUoX29iai5vcmlnaW5hbE9iamVjdCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHRoaXMuY2FudmFzLmRpc2NhcmRBY3RpdmVHcm91cCgpO1xuICAgICAgICAgIHRoaXMuY2FudmFzLmRpc2NhcmRBY3RpdmVPYmplY3QoKTtcbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgdGhpcy5jYW52YXMucmVtb3ZlKHRoaXMpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgICAgfVxuICAgIH0sXG4gICAgb2JqZWN0RHVwbGljYXRlOiB7XG4gICAgICBjbGFzc05hbWU6ICAnZmEgZmEtY2xvbmUnLFxuICAgICAgaW5zZXJ0OiAgICAgJ2R1cGxpY2F0ZVRvb2wnLFxuICAgICAgdGl0bGU6ICAgICAgJ0R1cGxpY2F0ZScsXG4gICAgICBhY3Rpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYodGhpcy5pc1NlbGVjdGlvbkdyb3VwKCkpe1xuICAgICAgICAgIHRoaXMuY2FudmFzLmZpcmUoJ2JlZm9yZTpzZWxlY3Rpb246Y2xlYXJlZCcsIHsgdGFyZ2V0OiB0aGlzLCBlOiBudWxsIH0pO1xuICAgICAgICAgIHRoaXMuY2FudmFzLmRpc2NhcmRBY3RpdmVHcm91cCgpO1xuICAgICAgICAgIHRoaXMuZHVwbGljYXRlKGZ1bmN0aW9uKGVsKXtcbiAgICAgICAgICAgIGVsLnVuZ3JvdXAoKTtcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICB0aGlzLmR1cGxpY2F0ZSgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcbiAgICBncm91cFNlbGVjdGVkRWxlbWVudHM6IHtcbiAgICAgIHRpdGxlOiAn0LPRgNGD0L/Qv9CwJyxcbiAgICAgIGNsYXNzTmFtZTogJ2ZhIGZhLW9iamVjdC1ncm91cCcsXG4gICAgICB2aXNpYmxlOiBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gdGhpcy5pc1NlbGVjdGlvbkdyb3VwKCk7XG4gICAgICB9LFxuICAgICAgYWN0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuZ3JvdXBTZWxlY3RlZEVsZW1lbnRzKCk7XG4gICAgICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgICAgfVxuICAgICAgLy92aXNpYmxlOiBJREUuZ3JvdXBBdmFpbGFibGVcbiAgICB9LFxuICAgIHVuZ3JvdXA6IHtcbiAgICAgIHRpdGxlOiAn0LPRgNGD0L/Qv9CwJyxcbiAgICAgIGNsYXNzTmFtZTogJ2ZhIGZhLW9iamVjdC11bmdyb3VwJyxcbiAgICAgIHZpc2libGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiB0aGlzLmNhbnZhcy5fb2JqZWN0cy5pbmRleE9mKHRoaXMpICE9PSAtMVxuICAgICAgfSxcbiAgICAgIGFjdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnVuZ3JvdXAoKTtcbiAgICAgICAgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gICAgICB9XG4gICAgfVxuICB9XG59KTtcblxuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUse1xuICBldmVudExpc3RlbmVyczogZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZEFycmF5c09iamVjdChmYWJyaWMuU2xpZGVDYW52YXMucHJvdG90eXBlLmV2ZW50TGlzdGVuZXJzLCB7XG4gICAgJ3NlbGVjdGlvbjpjcmVhdGVkJzogZnVuY3Rpb24oZXZlbnQpe1xuICAgICAgdGhpcy5fb25TZWxlY3Rpb25DcmVhdGVkKGV2ZW50KTtcbiAgICB9XG4gIH0pLFxuICBfb25TZWxlY3Rpb25Nb2RpZmllZDogZnVuY3Rpb24gKCkge1xuICAgIGZvciAodmFyIGkgaW4gdGhpcy5fb2JqZWN0cykge1xuICAgICAgdmFyIGNvcHkgPSB0aGlzLl9vYmplY3RzW2ldLmNsb25lU3luYygpO1xuICAgICAgY29weS5ncm91cCA9IHRoaXM7XG4gICAgICB0aGlzLl9yZXN0b3JlT2JqZWN0U3RhdGUoY29weSk7XG4gICAgICB0aGlzLl9vYmplY3RzW2ldLm9yaWdpbmFsT2JqZWN0LnNldCh7XG4gICAgICAgIGNsaXBUbzogY29weS5jbGlwVG8sXG4gICAgICAgIG1vdmVtZW50TGltaXRzOiBjb3B5Lm1vdmVtZW50TGltaXRzLFxuICAgICAgICBsZWZ0OiBjb3B5LmxlZnQsXG4gICAgICAgIHRvcDogY29weS50b3AsXG4gICAgICAgIGFuZ2xlOiBjb3B5LmFuZ2xlLFxuICAgICAgICBzY2FsZVg6IGNvcHkuc2NhbGVYLFxuICAgICAgICBzY2FsZVk6IGNvcHkuc2NhbGVZLFxuICAgICAgICBza2V3WDogY29weS5za2V3WCxcbiAgICAgICAgc2tld1k6IGNvcHkuc2tld1ksXG4gICAgICAgIHdpZHRoOiBjb3B5LndpZHRoLFxuICAgICAgICBoZWlnaHQ6IGNvcHkuaGVpZ2h0XG4gICAgICB9KTtcbiAgICB9XG4gIH0sXG4gIF9vblNlbGVjdGlvbkRlc2VsZWN0ZWQ6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgZm9yICh2YXIgaSBpbiB0aGlzLl9vYmplY3RzKSB7XG4gICAgICB2YXIgX29iaiA9IHRoaXMuX29iamVjdHNbaV07XG4gICAgICBfb2JqLm9yaWdpbmFsT2JqZWN0LnNldENvb3JkcygpO1xuICAgICAgX29iai5vcmlnaW5hbE9iamVjdC5ldmVudGVkID0gdHJ1ZTtcbiAgICAgIGRlbGV0ZSBfb2JqLm9yaWdpbmFsT2JqZWN0LmhpZGRlbkFjdGl2ZTtcbiAgICB9XG4gIH0sXG4gIF9vblNlbGVjdGlvbkNyZWF0ZWQ6IGZ1bmN0aW9uIChlbCkge1xuXG4gICAgdmFyIGdyb3VwICA9IGVsLnRhcmdldDtcblxuICAgIHZhciBvcmlnaW5hbE9iamVjdHMgPSBbXVxuICAgIGZvcih2YXIgaSBpbiBncm91cC5fb2JqZWN0cyl7XG4gICAgICB2YXIgX29iaiA9IGdyb3VwLl9vYmplY3RzW2ldO1xuICAgICAgb3JpZ2luYWxPYmplY3RzLnB1c2goX29iai5vcmlnaW5hbE9iamVjdCB8fCBfb2JqKVxuICAgIH1cblxuICAgIGdyb3VwLmRlc3Ryb3koKTtcbiAgICBncm91cC5fb2JqZWN0cyA9IFtdO1xuXG4gICAgdmFyIF9jbGlwVG8gPSBvcmlnaW5hbE9iamVjdHNbMF0uY2xpcFRvO1xuXG4gICAgZm9yICh2YXIgaSBpbiBvcmlnaW5hbE9iamVjdHMpIHtcbiAgICAgIHZhciBvcmlnaW5hbCA9IG9yaWdpbmFsT2JqZWN0c1tpXTtcblxuICAgICAgaWYgKF9jbGlwVG8gIT0gb3JpZ2luYWwuY2xpcFRvKSB7XG4gICAgICAgIF9jbGlwVG8gPSBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgdmFyIF9vYmogPSBvcmlnaW5hbC5jbG9uZVN5bmMoKTtcblxuICAgICAgX29iai5zZXQoe1xuICAgICAgICBjbGlwVG86IG51bGwsXG4gICAgICAgIG9yaWdpbmFsT2JqZWN0OiBvcmlnaW5hbFxuICAgICAgfSk7XG4gICAgICBvcmlnaW5hbC5zZXQoe1xuICAgICAgICBhY3RpdmU6ZmFsc2UsXG4gICAgICAgIGV2ZW50ZWQ6IGZhbHNlLFxuICAgICAgICBoaWRkZW5BY3RpdmU6IHRydWVcbiAgICAgIH0pO1xuXG4gICAgICBncm91cC5hZGRXaXRoVXBkYXRlKF9vYmopO1xuICAgICAgZ3JvdXAuc2V0Q29vcmRzKCk7XG4gICAgfVxuXG4gICAgZ3JvdXAuY2xpcFRvID0gIF9jbGlwVG87XG5cbiAgICBncm91cC5vbih7XG4gICAgICBcIm1vZGlmaWVkXCI6IHRoaXMuX29uU2VsZWN0aW9uTW9kaWZpZWQsXG4gICAgICAnZGVzZWxlY3RlZCc6IHRoaXMuX29uU2VsZWN0aW9uRGVzZWxlY3RlZFxuICAgIH0pO1xuXG4gIH1cbn0pO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9tb2R1bGVzL2dyb3Vwcy5qcyIsIid1c2Ugc3RyaWN0JztcblxudmFyIEhpc3RvcnkgPSByZXF1aXJlKCcuLy4uL3BsdWdpbnMvaGlzdG9yeScpO1xuXG5IaXN0b3J5LnByb3RvdHlwZS5pbnNlcnRSZWNvcmRzID0gZmFsc2U7XG5IaXN0b3J5LnByb3RvdHlwZS5hY3Rpb25zID0ge1xuICB1bmRvOiB7XG4gICAga2V5Q29kZTogJ3onLFxuICAgIGN0cmxLZXk6ICB0cnVlLFxuICAgIG9ic2VydmU6ICdjaGFuZ2VkJyxcbiAgICBjbGFzc05hbWU6ICdmYSBmYS11bmRvJyxcbiAgICB0aXRsZTogJ3VuZG8nLFxuICAgIGVuYWJsZWQ6ICdjYW5VbmRvJyxcbiAgICBhY3Rpb246IGZ1bmN0aW9uKCl7XG4gICAgICB0aGlzLnVuZG8oKTtcbiAgICB9XG4gIH0sXG4gIHJlY29yZHM6IHtcbiAgICB0aXRsZTogICAgICAgICAgXCJyZWNvcmRzXCIsXG4gICAgaXRlbUNsYXNzTmFtZTogIFwiZmlsdGVycy1zZWxlY3RvclwiLFxuICAgIGNsYXNzTmFtZTogICAgICBcImZhIGZhLWhpc3RvcnlcIixcbiAgICB0eXBlOiAgICAgICAgICAgXCJzZWxlY3RcIixcbiAgICB0ZW1wbGF0ZVNlbGVjdGlvbjogZnVuY3Rpb24oc3RhdGUsIGNvbnRhaW5lcikge1xuICAgICAgaWYgKHN0YXRlLmFueSkge1xuICAgICAgICByZXR1cm4gc3RhdGUudGV4dDtcbiAgICAgIH1cbiAgICAgIHJldHVybiAkKCc8c3Bhbj4nICsgc3RhdGUuaWQgKyBcIjpcIiArIHN0YXRlLnR5cGUgKyAnPC9zcGFuPicpO1xuICAgIH0sXG4gICAgdGVtcGxhdGVSZXN1bHQ6IGZ1bmN0aW9uKHN0YXRlLCBjb250YWluZXIsZGF0YSkge1xuICAgICAgaWYoIXN0YXRlLnR5cGUpcmV0dXJuO1xuICAgICAgdmFyIF9rZXlzID0gc3RhdGUub3JpZ2luYWxTdGF0ZSAmJiBPYmplY3Qua2V5cyhzdGF0ZS5vcmlnaW5hbFN0YXRlKS5qb2luKCcsJykgfHwgJyc7XG4gICAgICB2YXIgdHlwZSA9IHN0YXRlLm9iamVjdCAmJiBzdGF0ZS5vYmplY3QudHlwZSB8fCAnJztcbiAgICAgIHJldHVybiAkKFwiPHNwYW4+e2lkfTp7dHlwZX0oe290eXBlfSB7a2V5c30pPC9zcGFuPlwiLmZvcm1hdChmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKHtrZXlzIDogX2tleXMsIG90eXBlOiB0eXBlfSxzdGF0ZSkpKTtcbiAgICAgIC8vIGlmKHN0YXRlLmlkICE9IFwibm9uZVwiKXtcbiAgICAgIC8vICAgdmFyICRjYW52YXMgPSAkKCc8Y2FudmFzPicpO1xuICAgICAgLy8gICAkZWwucHJlcGVuZCgkY2FudmFzKTtcbiAgICAgIC8vIH1cbiAgICAgIC8vIHJldHVybiAkZWw7XG4gICAgfSxcbiAgICB2YWx1ZTogICAgICB7XG4gICAgICBvYnNlcnZlOiAnY2hhbmdlZCcsXG4gICAgICBzZXQgOiBmdW5jdGlvbih2YWwsZmlsdGVyc0RhdGEpe1xuICAgICAgICB0aGlzLmdvdG8odmFsKTtcbiAgICAgIH0sXG4gICAgICBnZXQ6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiB0aGlzLnJlY29yZHNbdGhpcy5jdXJyZW50XS5pZDtcbiAgICAgIH0sXG4gICAgICBvcHRpb25zOiBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gdGhpcy5yZWNvcmRzO1xuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgcmVkbzoge1xuICAgIGtleUNvZGU6ICd5JyxcbiAgICBjdHJsS2V5OiAgdHJ1ZSxcbiAgICBvYnNlcnZlOiAnY2hhbmdlZCcsXG4gICAgY2xhc3NOYW1lOiAnZmEgZmEtcmVwZWF0JyxcbiAgICB0aXRsZTogJ3JlZG8nLFxuICAgIGVuYWJsZWQ6ICdjYW5SZWRvJyxcbiAgICBhY3Rpb246IGZ1bmN0aW9uKCl7XG4gICAgICB0aGlzLnJlZG8oKTtcbiAgICB9XG4gIH1cbn07XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLlNsaWRlQ2FudmFzLnByb3RvdHlwZS5hY3Rpb25zLCB7XG4gIGhpc3Rvcnk6IHtcbiAgICB0aXRsZTogJ2hpc3RvcnknLFxuICAgIHR5cGU6ICdtZW51JyxcbiAgICB0YXJnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLmhpc3Rvcnk7XG4gICAgfSxcbiAgICBtZW51OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5hY3Rpb25zO1xuICAgIH1cbiAgfVxufSk7XG5cblxuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5DYW52YXMucHJvdG90eXBlLCB7XG4gIGluc2VydEhpc3Rvcnk6IGZhbHNlLFxuICBvbk9iamVjdE1vZGlmaWVkOiBmdW5jdGlvbiAoZSkge1xuICAgIGlmICghdGhpcy5oaXN0b3J5LmVuYWJsZWQgfHwgdGhpcy5wcm9jZXNzaW5nIHx8IHRoaXMuaGlzdG9yeS5wcm9jZXNzaW5nKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHZhciBfY2FudmFzID0gZS50YXJnZXQuY2FudmFzIHx8IGUudGFyZ2V0LndyYXBwZXJFbCAmJiBlLnRhcmdldDtcblxuICAgIHRoaXMuaGlzdG9yeS5hZGQoe1xuICAgICAgY2FudmFzOiAgZS50YXJnZXQuY2FudmFzLm9yaWdpbmFsU2xpZGUgfHwgZS50YXJnZXQuY2FudmFzLFxuICAgICAgb3JpZ2luYWxTdGF0ZTogIGUuc3RhdGVzLm9yaWdpbmFsLFxuICAgICAgbW9kaWZpZWRTdGF0ZTogIGUuc3RhdGVzLm1vZGlmaWVkLFxuICAgICAgb2JqZWN0OiBlLnRhcmdldCxcbiAgICAgIHR5cGU6ICdvYmplY3Q6bW9kaWZpZWQnLFxuICAgICAgdW5kbzogZnVuY3Rpb24gKF9hY3Rpb24pIHtcbiAgICAgICAgX2FjdGlvbi5vYmplY3Quc2V0KF9hY3Rpb24ub3JpZ2luYWxTdGF0ZSk7XG4gICAgICAgIGlmKF9hY3Rpb24uY2FudmFzLm1pcnJvclNsaWRlID09IHRoaXMuY2FudmFzKXtcbiAgICAgICAgICBfYWN0aW9uLm9iamVjdC5zZXRDb29yZHMoKTtcbiAgICAgICAgICB2YXIgX2NhbnZhcyA9IHRoaXMuY2FudmFzIHx8IHRoaXM7XG4gICAgICAgICAgX2NhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICAgICAgfVxuICAgICAgICBfYWN0aW9uLmNhbnZhcy5maXJlKCdvYmplY3Q6bW9kaWZpZWQnLCB7IHRhcmdldDogX2FjdGlvbi5vYmplY3QgfSk7XG4gICAgICAgIF9hY3Rpb24ub2JqZWN0LmZpcmUoJ21vZGlmaWVkJyk7XG4gICAgICAgIF9hY3Rpb24uY2FudmFzLnJlbmRlckFsbCgpO1xuICAgICAgfSxcbiAgICAgIHJlZG86IGZ1bmN0aW9uIChfYWN0aW9uKSB7XG4gICAgICAgIF9hY3Rpb24ub2JqZWN0LnNldChfYWN0aW9uLm1vZGlmaWVkU3RhdGUpO1xuICAgICAgICBfYWN0aW9uLm9iamVjdC5zZXRDb29yZHMoKTtcbiAgICAgICAgaWYoX2FjdGlvbi5jYW52YXMubWlycm9yU2xpZGUgPT0gdGhpcy5jYW52YXMpe1xuICAgICAgICAgIF9hY3Rpb24ub2JqZWN0LnNldENvb3JkcygpO1xuICAgICAgICAgIHZhciBfY2FudmFzID0gdGhpcy5jYW52YXMgfHwgdGhpcztcbiAgICAgICAgICBfY2FudmFzLnJlbmRlckFsbCgpO1xuICAgICAgICB9XG4gICAgICAgIF9hY3Rpb24uY2FudmFzLmZpcmUoJ29iamVjdDptb2RpZmllZCcsIHsgdGFyZ2V0OiBfYWN0aW9uLm9iamVjdCB9KTtcbiAgICAgICAgX2FjdGlvbi5vYmplY3QuZmlyZSgnbW9kaWZpZWQnKTtcbiAgICAgICAgX2FjdGlvbi5jYW52YXMucmVuZGVyQWxsKCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0sXG4gIGNsZWFySGlzdG9yeTogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuaGlzdG9yeS5jbGVhcigpO1xuICB9LFxuICBkaXNhYmxlSGlzdG9yeTogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuaGlzdG9yeS5lbmFibGVkID0gZmFsc2U7XG4gIH0sXG4gIF9hZGRfb2JqZWN0X2hpc3RvcnlfYWN0aW9uOiBmdW5jdGlvbiAoX2FjdGlvbikge1xuICAgIHZhciBfY2FudmFzID0gdGhpcy5jYW52YXMgfHwgdGhpcztcbiAgICBpZih0aGlzLmNhbnZhcyAmJiBfYWN0aW9uLmNhbnZhcy5taXJyb3JTbGlkZSA9PSB0aGlzLmNhbnZhcyl7XG4gICAgICBfY2FudmFzLmFkZChfYWN0aW9uLm9iamVjdCk7XG4gICAgICBfY2FudmFzLnNldEFjdGl2ZU9iamVjdChfYWN0aW9uLm9iamVjdCk7XG4gICAgICBfY2FudmFzLnJlbmRlckFsbCgpO1xuICAgIH1lbHNle1xuICAgICAgX2FjdGlvbi5jYW52YXMuYWRkKF9hY3Rpb24ub2JqZWN0KTtcbiAgICB9XG4gICAgX2FjdGlvbi5jYW52YXMucmVuZGVyQWxsKCk7XG4gIH0sXG5cbiAgX3JlbW92ZV9vYmplY3RfaGlzdG9yeV9hY3Rpb246IGZ1bmN0aW9uIChfYWN0aW9uKSB7XG4gICAgX2FjdGlvbi5jYW52YXMucmVtb3ZlKF9hY3Rpb24ub2JqZWN0KTtcbiAgICBfYWN0aW9uLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICBpZih0aGlzLmNhbnZhcyAmJiBfYWN0aW9uLmNhbnZhcy5taXJyb3JTbGlkZSA9PSB0aGlzLmNhbnZhcyl7XG4gICAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICB9XG4gIH0sXG5cbiAgb25PYmplY3RSZW1vdmVkOiBmdW5jdGlvbiAoZSkge1xuICAgIGlmICghdGhpcy5oaXN0b3J5LmVuYWJsZWQgfHwgdGhpcy5wcm9jZXNzaW5nIHx8IHRoaXMuaGlzdG9yeS5wcm9jZXNzaW5nKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHRoaXMuaGlzdG9yeS5hZGQoe1xuICAgICAgY2FudmFzOiBlLnRhcmdldC5jYW52YXMub3JpZ2luYWxTbGlkZSB8fCBlLnRhcmdldC5jYW52YXMsXG4gICAgICBvYmplY3Q6IGUudGFyZ2V0LFxuICAgICAgdHlwZTogJ29iamVjdDpyZW1vdmVkJyxcbiAgICAgIHJlZG86IHRoaXMuX3JlbW92ZV9vYmplY3RfaGlzdG9yeV9hY3Rpb24sXG4gICAgICB1bmRvOiB0aGlzLl9hZGRfb2JqZWN0X2hpc3RvcnlfYWN0aW9uXG4gICAgfSk7XG4gIH0sXG4gIG9uRHJhd0FmdGVyOiBmdW5jdGlvbihldmVudCl7XG4gICAgaWYgKCF0aGlzLmhpc3RvcnkuZW5hYmxlZCB8fCB0aGlzLnByb2Nlc3NpbmcgfHwgdGhpcy5oaXN0b3J5LnByb2Nlc3NpbmcpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgdGhpcy5oaXN0b3J5LmFkZCh0aGlzLmZyZWVEcmF3aW5nQnJ1c2guZ2V0SGlzdG9yeVJlY29yZChldmVudCkpXG4gIH0sXG4gIG9uT2JqZWN0QWRkZWQ6IGZ1bmN0aW9uIChlKSB7XG4gICAgaWYgKCF0aGlzLmhpc3RvcnkuZW5hYmxlZCB8fCB0aGlzLnByb2Nlc3NpbmcgfHwgdGhpcy5oaXN0b3J5LnByb2Nlc3NpbmcpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgdGhpcy5oaXN0b3J5LmFkZCh7XG4gICAgICBjYW52YXM6ICBlLnRhcmdldC5jYW52YXMub3JpZ2luYWxTbGlkZSB8fCBlLnRhcmdldC5jYW52YXMsXG4gICAgICBvYmplY3Q6IGUudGFyZ2V0LFxuICAgICAgdHlwZTogJ29iamVjdDphZGRlZCcsXG4gICAgICB1bmRvOiB0aGlzLl9yZW1vdmVfb2JqZWN0X2hpc3RvcnlfYWN0aW9uLFxuICAgICAgcmVkbzogdGhpcy5fYWRkX29iamVjdF9oaXN0b3J5X2FjdGlvblxuICAgIH0pO1xuICB9LFxuICBpbml0SGlzdG9yeTogZnVuY3Rpb24gKGhpc3RvcnkpIHtcbiAgICBpZighaGlzdG9yeSl7XG4gICAgICBoaXN0b3J5ID0gbmV3IEhpc3RvcnkodGhpcyk7XG4gICAgICBoaXN0b3J5LmFwcGxpY2F0aW9uID0gdGhpcy5hcHBsaWNhdGlvbjtcbiAgICB9XG5cbiAgICB0aGlzLmhpc3RvcnkgPSBoaXN0b3J5O1xuICAgIHRoaXMub24oe1xuICAgICAgJ2xvYWRpbmc6YmVnaW4nOiAgICB0aGlzLmNsZWFySGlzdG9yeSxcbiAgICAgICdkcmF3OmFmdGVyJzogICAgICAgdGhpcy5vbkRyYXdBZnRlcixcbiAgICAgICdvYmplY3Q6bW9kaWZpZWQnOiAgdGhpcy5vbk9iamVjdE1vZGlmaWVkLFxuICAgICAgJ29iamVjdDphZGRlZCc6ICAgICB0aGlzLm9uT2JqZWN0QWRkZWQsXG4gICAgICAnb2JqZWN0OnJlbW92ZWQnOiAgIHRoaXMub25PYmplY3RSZW1vdmVkXG4gICAgfSk7XG5cbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgIHRoaXMuaGlzdG9yeS5vbignY2hhbmdlZCcsIGZ1bmN0aW9uKGUpe1xuICAgICAgaWYodGhpcy5hY3RpdmVBY3Rpb24uY2FudmFzKXtcbiAgICAgICAgdGhpcy5hY3RpdmVBY3Rpb24uY2FudmFzLm1vbWVudCA9IGUuYWN0aW9uLm1vbWVudDtcbiAgICAgIH1cbiAgICB9KTtcbiAgICB2YXIgcHJvdG8gPSB0aGlzLmFwcGxpY2F0aW9uLnByb3RvdHlwZXMuSGlzdG9yeTtcbiAgICBpZihwcm90byl7XG4gICAgICBpZihwcm90by5ldmVudExpc3RlbmVycyl7XG4gICAgICAgIGhpc3Rvcnkub24ocHJvdG8uZXZlbnRMaXN0ZW5lcnMpO1xuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgZW5hYmxlSGlzdG9yeTogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuaGlzdG9yeS5lbmFibGVkID0gdHJ1ZTtcbiAgfVxufSk7XG5cbmZhYnJpYy5ISVNUT1JZX09QVElPTlMgPSB7XG4gIElORElWSURVQUw6IDAsXG4gIFNIQVJFRDogMVxufTtcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuQXBwbGljYXRpb24ucHJvdG90eXBlLCB7XG4gIGhpc3Rvcnk6IHRydWUsXG4gIHNldEhpc3Rvcnk6IGZ1bmN0aW9uKGhpc3RvcnlPcHRpb24pe1xuXG4gICAgaWYoaGlzdG9yeU9wdGlvbiA9PT0gZmFicmljLkhJU1RPUllfT1BUSU9OUy5TSEFSRUQpe1xuICAgICAgdGhpcy5oaXN0b3J5ID0gbmV3IEhpc3RvcnkodGhpcyk7XG4gICAgICB0aGlzLmVuYWJsZUhpc3RvcnkoKTtcblxuICAgICAgdGhpcy5vbihcInJlYWR5XCIsZnVuY3Rpb24oKXtcbiAgICAgICAgaWYgKHRoaXMuY2FudmFzKSB7XG4gICAgICAgICAgdGhpcy5jYW52YXMuaW5pdEhpc3RvcnkodGhpcy5oaXN0b3J5KTtcbiAgICAgICAgfVxuICAgICAgfSlcblxuICAgIH1cbiAgICBpZihoaXN0b3J5T3B0aW9uID09PSBmYWJyaWMuSElTVE9SWV9PUFRJT05TLklORElWSURVQUwpe1xuICAgICAgLy90b2RvIHVuc3VwcG9ydGVkXG4gICAgfVxuXG4gIH0sXG4gIGFjdGlvbnM6IGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLkFwcGxpY2F0aW9uLnByb3RvdHlwZS5hY3Rpb25zLHtcbiAgICBoaXN0b3J5OiB7XG4gICAgICBpbnNlcnQ6ICdoaXN0b3J5VG9vbHMnLFxuICAgICAgdGl0bGU6ICdoaXN0b3J5JyxcbiAgICAgIHR5cGU6ICdtZW51JyxcbiAgICAgIHRhcmdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5oaXN0b3J5O1xuICAgICAgfSxcbiAgICAgIG1lbnU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYWN0aW9ucztcbiAgICAgIH1cbiAgICB9XG4gIH0pLFxuICBfZGVmYXVsdF9ldmVudF9saXN0ZW5lcnMgOiB7XG4gICAgXCJzbGlkZTpjaGFuZ2U6YmVnaW5cIiA6IGZ1bmN0aW9uKCl7XG4gICAgICB0aGlzLnByb2Nlc3NpbmcgPSB0cnVlIDtcbiAgICAgIGlmKHRoaXMuaGlzdG9yeSl7XG4gICAgICAgIHRoaXMuaGlzdG9yeS5wcm9jZXNzaW5nID0gdHJ1ZSA7XG4gICAgICB9XG4gICAgfSxcbiAgICBcInNsaWRlOmNoYW5nZWRcIiA6IGZ1bmN0aW9uKCl7XG4gICAgICB0aGlzLnByb2Nlc3NpbmcgPSBmYWxzZTtcbiAgICAgIGlmKHRoaXMuaGlzdG9yeSl7XG4gICAgICAgIHRoaXMuaGlzdG9yeS5wcm9jZXNzaW5nID0gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuICB9LFxuICBoaXN0b3J5VG9vbHM6IGZhbHNlLFxuICBlbmFibGVIaXN0b3J5OiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5oaXN0b3J5LmVuYWJsZWQgPSB0cnVlO1xuICB9XG59KTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvbW9kdWxlcy9oaXN0b3J5LmpzIiwiXG52YXIgdXRpbHMgPSByZXF1aXJlKCcuLy4uL3V0aWwvdXRpbC5qcycpO1xudXRpbHMub2JqZWN0ID0gcmVxdWlyZSgnLi8uLi91dGlsL29iamVjdC5qcycpO1xuXG5cbi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxuICoqIERQSGlzdG9yeVxuICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuXG5cbnZhciBEUEhpc3RvcnkgPSBmdW5jdGlvbiAocGFyZW50LCBpbml0QWN0aW9uKSB7XG4gICAgdGhpcy5wYXJlbnQgPSBwYXJlbnQ7XG4gICAgdGhpcy5jbGVhcihpbml0QWN0aW9uKTtcbn07XG5cbkRQSGlzdG9yeS5wcm90b3R5cGUuc2V0UmVjb3JkcyA9IGZ1bmN0aW9uIChyZWNvcmRzLGN1cnJlbnQpIHtcbiAgdGhpcy5jYW5VbmRvID0gcmVjb3Jkcy5sZW5ndGg7XG4gIHRoaXMuY2FuUmVkbyA9IGZhbHNlO1xuXG4gIGlmKCFyZWNvcmRzLmxlbmd0aCl7XG4gICAgcmVjb3JkcyA9IFt7XG4gICAgICB0eXBlOiAnaW5pdGlhbGl6ZWQnLFxuICAgICAgaWQ6IDAsXG4gICAgICB0ZXh0IDogJ2luaXRpYWxpemVkJ1xuICAgIH1dXG4gIH1cbiAgdGhpcy5yZWNvcmRzID0gcmVjb3JkcztcbiAgdGhpcy5sZW5ndGggPSB0aGlzLnJlY29yZHMubGVuZ3RoIDtcbiAgdGhpcy5jdXJyZW50ID0gY3VycmVudCA9PT0gdW5kZWZpbmVkID8gcmVjb3Jkcy5sZW5ndGggLSAxIDogY3VycmVudDtcbiAgdGhpcy5hY3RpdmVBY3Rpb24gPSB0aGlzLnJlY29yZHNbdGhpcy5jdXJyZW50XTtcbiAgdGhpcy5maXJlKFwiY2hhbmdlZFwiLHthY3Rpb246IHRoaXMuYWN0aXZlQWN0aW9ufSk7XG4gIHJldHVybiB0aGlzO1xufTtcblxuRFBIaXN0b3J5LnByb3RvdHlwZS5yZXN0b3JlID0gZnVuY3Rpb24gKCkge1xuICB0aGlzLnNldFJlY29yZHModGhpcy5zYXZlZC5yZWNvcmRzLHRoaXMuc2F2ZWQuY3VycmVudCk7XG4gIHJldHVybiB0aGlzO1xufTtcblxuRFBIaXN0b3J5LnByb3RvdHlwZS5zYXZlID0gZnVuY3Rpb24gKCkge1xuICB0aGlzLnNhdmVkID0ge1xuICAgIGN1cnJlbnQ6IHRoaXMuY3VycmVudCxcbiAgICByZWNvcmRzOiB1dGlscy5vYmplY3QuY2xvbmVEZWVwKHRoaXMucmVjb3JkcylcbiAgfVxuICByZXR1cm4gdGhpcztcbn07XG5cbkRQSGlzdG9yeS5wcm90b3R5cGUuY2xlYXIgPSBmdW5jdGlvbiAoaW5pdEFjdGlvbikge1xuICAgIGlmIChpbml0QWN0aW9uKSB7XG4gICAgICAgIGluaXRBY3Rpb24uaWQgPSAwO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGluaXRBY3Rpb24gPSB7XG4gICAgICAgICAgICB0eXBlOiAnaW5pdGlhbGl6ZWQnLFxuICAgICAgICAgICAgaWQ6IDAsXG4gICAgICAgICAgdGV4dCA6ICdpbml0aWFsaXplZCdcbiAgICAgICAgfVxuICAgIH1cbiAgICB0aGlzLnJlY29yZHMgPSBbaW5pdEFjdGlvbl07XG4gICAgdGhpcy5jdXJyZW50ID0gMDtcbiAgICB0aGlzLmNhblVuZG8gPSBmYWxzZTtcbiAgICB0aGlzLmNhblJlZG8gPSBmYWxzZTtcbiAgICB0aGlzLmFjdGl2ZUFjdGlvbiA9IHRoaXMucmVjb3Jkc1t0aGlzLmN1cnJlbnRdO1xuICB0aGlzLmZpcmUoXCJjaGFuZ2VkXCIse2FjdGlvbjogdGhpcy5hY3RpdmVBY3Rpb259KTtcbiAgcmV0dXJuIHRoaXM7XG59O1xuXG5cbkRQSGlzdG9yeS5wcm90b3R5cGUuYWRkID0gZnVuY3Rpb24oYWN0aW9uKXtcblxuXG4gICAgaWYgKCF0aGlzLmVuYWJsZWQgfHwgdGhpcy5wcm9jZXNzaW5nKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgYWN0aW9uLm1vbWVudCA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICAgIHRoaXMuY2FuVW5kbyA9IHRydWU7XG4gICAgdGhpcy5jYW5SZWRvID0gZmFsc2U7XG4gICAgdGhpcy5yZWNvcmRzLnNwbGljZSh0aGlzLmN1cnJlbnQrIDEpO1xuICAgIHRoaXMucmVjb3Jkcy5wdXNoKGFjdGlvbik7XG4gICAgdGhpcy5sZW5ndGggPSB0aGlzLnJlY29yZHMubGVuZ3RoO1xuICAgIGFjdGlvbi5pZCA9IHRoaXMubGVuZ3RoIC0gMTtcbiAgICBhY3Rpb24udGV4dCA9IGFjdGlvbi50eXBlIHx8IGFjdGlvbi50ZXh0O1xuICAgIHRoaXMuY3VycmVudCA9IHRoaXMubGVuZ3RoIC0gMTtcblxuICB0aGlzLmFjdGl2ZUFjdGlvbiA9IHRoaXMucmVjb3Jkc1t0aGlzLmN1cnJlbnRdO1xuICB0aGlzLmZpcmUoXCJjaGFuZ2VkXCIse2FjdGlvbjogYWN0aW9ufSk7XG4gIHJldHVybiB0aGlzO1xufTtcbkRQSGlzdG9yeS5wcm90b3R5cGUuZGlzYWJsZSA9IGZ1bmN0aW9uKCl7XG4gIHRoaXMuZW5hYmxlZCA9IGZhbHNlO1xuICByZXR1cm4gdGhpcztcbn07XG5EUEhpc3RvcnkucHJvdG90eXBlLmVuYWJsZSA9IGZ1bmN0aW9uKCl7XG4gIHRoaXMuZW5hYmxlZCA9IHRydWU7XG4gIHJldHVybiB0aGlzO1xufTtcbkRQSGlzdG9yeS5wcm90b3R5cGUudW5kbyA9IGZ1bmN0aW9uKG5vRmlyZSl7XG4gICAgdGhpcy5jYW5SZWRvID0gdHJ1ZTtcbiAgICB2YXIgX2FjdGlvbiA9IHRoaXMucmVjb3Jkc1t0aGlzLmN1cnJlbnRdO1xuICAgIHRoaXMuY3VycmVudC0tO1xuICB0aGlzLnByb2Nlc3NpbmcgPSB0cnVlO1xuICAgIF9hY3Rpb24udW5kby5jYWxsKHRoaXMucGFyZW50LF9hY3Rpb24pO1xuICB0aGlzLnByb2Nlc3NpbmcgPSBmYWxzZTtcbiAgICBpZih0aGlzLmN1cnJlbnQgPT0gMCl7XG4gICAgICAgIHRoaXMuY2FuVW5kbyA9IGZhbHNlO1xuICAgIH1cbiAgICBpZighbm9GaXJlKXtcbiAgICAgIHRoaXMuYWN0aXZlQWN0aW9uID0gdGhpcy5yZWNvcmRzW3RoaXMuY3VycmVudF07XG4gICAgICB0aGlzLmZpcmUoXCJjaGFuZ2VkXCIse2FjdGlvbjogX2FjdGlvbn0pO1xuICAgIH1cbiAgcmV0dXJuIHRoaXM7XG59O1xuXG5EUEhpc3RvcnkucHJvdG90eXBlLmdvdG8gPSBmdW5jdGlvbihpbmRleCl7XG4gICAgaWYoaW5kZXggPT0gdGhpcy5jdXJyZW50KXJldHVybjtcbiAgICBpZihpbmRleCA8IHRoaXMuY3VycmVudCl7XG4gICAgICAgIGZvcih2YXIgaSA9IHRoaXMuY3VycmVudCAtIGluZGV4IDtpLS07ICl7XG4gICAgICAgICAgICB0aGlzLnVuZG8odHJ1ZSk7XG4gICAgICAgIH1cbiAgICB9aWYoaW5kZXggPiB0aGlzLmN1cnJlbnQpe1xuICAgICAgICBmb3IodmFyIGkgPSBpbmRleCAtIHRoaXMuY3VycmVudCA7aS0tOyApe1xuICAgICAgICAgICAgdGhpcy5yZWRvKHRydWUpO1xuICAgICAgICB9XG4gICAgfVxuICB0aGlzLmFjdGl2ZUFjdGlvbiA9IHRoaXMucmVjb3Jkc1t0aGlzLmN1cnJlbnRdO1xuICB0aGlzLmZpcmUoXCJjaGFuZ2VkXCIse2FjdGlvbjogdGhpcy5hY3RpdmVBY3Rpb259KTtcbiAgcmV0dXJuIHRoaXM7XG59O1xuXG5EUEhpc3RvcnkucHJvdG90eXBlLnJlZG8gPSBmdW5jdGlvbihub0ZpcmUpe1xuICAgIGlmKHRoaXMuY3VycmVudCA9PSB0aGlzLmxlbmd0aCAtIDEpe1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICB0aGlzLnByb2Nlc3NpbmcgPSB0cnVlO1xuICAgIHRoaXMuY2FuVW5kbyA9IHRydWU7XG4gICAgdGhpcy5jdXJyZW50Kys7XG4gICAgdmFyIF9hY3Rpb24gPSB0aGlzLnJlY29yZHNbdGhpcy5jdXJyZW50XTtcblxuICAgIF9hY3Rpb24ucmVkby5jYWxsKHRoaXMucGFyZW50LF9hY3Rpb24pO1xuXG4gICAgaWYodGhpcy5jdXJyZW50ID09IHRoaXMubGVuZ3RoIC0gMSl7XG4gICAgICAgIHRoaXMuY2FuUmVkbyA9IGZhbHNlO1xuICAgIH1cbiAgdGhpcy5wcm9jZXNzaW5nID0gZmFsc2U7XG4gIGlmKCFub0ZpcmUpIHtcbiAgICB0aGlzLmFjdGl2ZUFjdGlvbiA9IHRoaXMucmVjb3Jkc1t0aGlzLmN1cnJlbnRdO1xuICAgIHRoaXMuZmlyZShcImNoYW5nZWRcIix7YWN0aW9uOiBfYWN0aW9ufSk7XG4gIH1cbiAgcmV0dXJuIHRoaXM7XG59O1xudXRpbHMub2JzZXJ2YWJsZShEUEhpc3RvcnkucHJvdG90eXBlKTtcbm1vZHVsZS5leHBvcnRzID0gRFBIaXN0b3J5O1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9wbHVnaW5zL2hpc3RvcnkuanMiLCIndXNlIHN0cmljdCc7XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vL21vZHVsZSByZXNwb25zaXZlIGJvcmRlcnMvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuT2JqZWN0LnByb3RvdHlwZSwge1xuICByZXNwb25zaXZlQm9yZGVyczogZmFsc2Vcbn0pO1xuXG5pZighZmFicmljLlNsaWRlQ2FudmFzLnByb3RvdHlwZS5fZGVmYXVsdF9ldmVudF9saXN0ZW5lcnMpe1xuICBmYWJyaWMuU2xpZGVDYW52YXMucHJvdG90eXBlLl9kZWZhdWx0X2V2ZW50X2xpc3RlbmVycyA9IHt9O1xufTtcblxuZmFicmljLk9iamVjdC5wcm90b3R5cGUudXBkYXRlUmVzcG9uc2l2ZUJvcmRlciA9IGZ1bmN0aW9uKCl7XG4gIGlmKHRoaXMucmVzcG9uc2l2ZUJvcmRlcnMpe1xuICAgIGlmKCF0aGlzLm9yaWdpbmFsU3Ryb2tlV2lkdGgpe1xuICAgICAgdGhpcy5vcmlnaW5hbFN0cm9rZVdpZHRoID0gdGhpcy5zdHJva2VXaWR0aDtcbiAgICB9XG4gICAgdGhpcy5zdHJva2VXaWR0aCA9IHRoaXMuY2FudmFzID8gdGhpcy5vcmlnaW5hbFN0cm9rZVdpZHRoIC8gdGhpcy5jYW52YXMudmlld3BvcnRUcmFuc2Zvcm1bMF0gOiAwO1xuICB9XG59O1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUsIHtcbiAgX2RlZmF1bHRfZXZlbnRfbGlzdGVuZXJzOiB7XG4gICAgXCJkaW1lbnNpb25zOm1vZGlmaWVkXCI6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuY2VudGVyQW5kWm9vbU91dCgpO1xuICAgIH0sXG4gICAgJ3ZpZXdwb3J0OnNjYWxlZCc6IGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmICh0aGlzLmJhY2tncm91bmRJbWFnZSkge1xuICAgICAgICB0aGlzLmJhY2tncm91bmRJbWFnZS51cGRhdGVSZXNwb25zaXZlQm9yZGVyKCk7XG4gICAgICB9XG4gICAgICBmb3IgKHZhciBpIGluIHRoaXMuX29iamVjdHMpIHtcbiAgICAgICAgdGhpcy5fb2JqZWN0c1tpXS51cGRhdGVSZXNwb25zaXZlQm9yZGVyKCk7XG4gICAgICB9XG4gICAgfSxcbiAgICBcImJhY2tncm91bmQtaW1hZ2U6bG9hZGVkXCI6IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgaWYgKHRoaXMuYXV0b0NlbnRlckFuZFpvb21PdXRFbmFibGVkKSB7XG4gICAgICAgIHRoaXMuY2VudGVyQW5kWm9vbU91dCgpO1xuICAgICAgfVxuICAgIH0sXG4gICAgXCJsb2FkaW5nOmVuZFwiOiBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgIGlmICh0aGlzLmF1dG9DZW50ZXJBbmRab29tT3V0RW5hYmxlZCAmJiAodGhpcy5vcmlnaW5hbEhlaWdodCB8fCB0aGlzLm9yaWdpbmFsV2lkdGgpKSB7XG4gICAgICAgIHRoaXMuY2VudGVyQW5kWm9vbU91dCgpO1xuICAgICAgfVxuICAgIH0sXG4gICAgXCJvYmplY3Q6YWRkZWRcIjogZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICBldmVudC50YXJnZXQudXBkYXRlUmVzcG9uc2l2ZUJvcmRlcigpXG4gICAgfVxuICB9XG59KTtcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuXG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLlNsaWRlQ2FudmFzLnByb3RvdHlwZSwge1xuICB6b29tQ3RybEtleTogdHJ1ZSxcbiAgbW91c2VXaGVlbEVuYWJsZWQgOiBmYWxzZSxcbiAgX3NldFpvb21OYXRpdmUgIDogZmFicmljLkNhbnZhcy5wcm90b3R5cGUuc2V0Wm9vbSxcbiAgX3pvb21Ub1BvaW50TmF0aXZlICA6IGZhYnJpYy5DYW52YXMucHJvdG90eXBlLnpvb21Ub1BvaW50LFxuICBjaGFuZ2VEaW1lbnNpb25Pblpvb206IGZhbHNlLFxuICBkcmF3Wm9vbUFyZWEgOiBmdW5jdGlvbihfY3R4LGxlZnQsIHRvcCAsd2lkdGgsIGhlaWdodCApe1xuICAgIF9jdHguc2F2ZSgpO1xuICAgIF9jdHgudHJhbnNsYXRlKGxlZnQgfHwgMCwgdG9wIHx8IDApO1xuICAgIHZhciBfc2NhbGUgPSB0aGlzLmdldFpvb20oKTtcbiAgICB2YXIgX3NpemUgPSBmYWJyaWMudXRpbC5nZXRQcm9wb3J0aW9ucyh0aGlzLmJhY2tncm91bmRJbWFnZSwge3dpZHRoOiB3aWR0aCB8fCAxMDAsIGhlaWdodDogaGVpZ2h0IHx8IDEwMH0pO1xuICAgIF9jdHguZ2xvYmFsQWxwaGEgPSAwLjU7XG4gICAgX2N0eC5maWxsUmVjdCgwLDAsX3NpemUud2lkdGgsIF9zaXplLmhlaWdodCk7XG4gICAgX2N0eC5zdHJva2VTdHlsZSA9IFwicmVkXCI7XG5cbiAgICB2YXIgdiA9IHRoaXMudmlld3BvcnRUcmFuc2Zvcm07XG5cbiAgICB2YXIgeDEgPSAtdls0XSAqIF9zaXplLnNjYWxlIC8gX3NjYWxlO1xuICAgIHZhciB5MSA9IC12WzVdICogX3NpemUuc2NhbGUgLyBfc2NhbGU7XG4gICAgdmFyIHgyID0geDEgKyB0aGlzLndpZHRoICogX3NpemUuc2NhbGUgLyBfc2NhbGU7XG4gICAgdmFyIHkyID0geTEgKyB0aGlzLmhlaWdodCAqIF9zaXplLnNjYWxlIC8gX3NjYWxlO1xuXG4gICAgeDEgPSBNYXRoLm1heCh4MSwwKTtcbiAgICB5MSA9IE1hdGgubWF4KHkxLDApO1xuICAgIHgyID0gTWF0aC5taW4oeDIsX3NpemUud2lkdGgpO1xuICAgIHkyID0gTWF0aC5taW4oeTIsX3NpemUuaGVpZ2h0KTtcblxuICAgIF9jdHguZ2xvYmFsQWxwaGEgPSAxO1xuICAgIF9jdHguYmVnaW5QYXRoKCk7XG4gICAgX2N0eC5tb3ZlVG8oeDEseTEpO1xuICAgIF9jdHgubGluZVRvKHgyLHkxKTtcbiAgICBfY3R4LmxpbmVUbyh4Mix5Mik7XG4gICAgX2N0eC5saW5lVG8oeDEseTIpO1xuICAgIF9jdHgubGluZVRvKHgxLHkxKTtcblxuICAgIF9jdHguZmlsbCgpO1xuICAgIF9jdHguY2xpcCgpO1xuICAgIC8vIF9jdHguZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gXCJzb3VyY2UtaW5cIjtcbiAgICBfY3R4LmRyYXdJbWFnZSh0aGlzLmJhY2tncm91bmRJbWFnZS5fZWxlbWVudCwwLDAsX3NpemUud2lkdGgsIF9zaXplLmhlaWdodClcbiAgICAvLyBfY3R4Lmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9IFwic291cmNlLW92ZXJcIjtcbiAgICAvLyBfY3R4LmRyYXdJbWFnZSh0aGlzLmJhY2tncm91bmRJbWFnZS5fZWxlbWVudCwwLDAsX3NpemUud2lkdGgsIF9zaXplLmhlaWdodClcbiAgICBfY3R4LnN0cm9rZSgpO1xuICAgIF9jdHguc3Ryb2tlUmVjdCgwLDAsX3NpemUud2lkdGgsIF9zaXplLmhlaWdodCk7XG4gICAgX2N0eC5yZXN0b3JlKCk7XG4gIH0sXG4gIHNldFpvb206IGZ1bmN0aW9uIChfc2NhbGUpe1xuICAgIGlmKHRoaXMuY2hhbmdlRGltZW5zaW9uT25ab29tKXtcbiAgICAgIHZhciBfdyA9IE1hdGgucm91bmQodGhpcy5vcmlnaW5hbFdpZHRoICogX3NjYWxlKTtcbiAgICAgIHZhciBfaCA9IE1hdGgucm91bmQodGhpcy5vcmlnaW5hbEhlaWdodCAqIF9zY2FsZSk7XG4gICAgICB0aGlzLnNldERpbWVuc2lvbnMoe1xuICAgICAgICB3aWR0aDogX3csXG4gICAgICAgIGhlaWdodDogX2hcbiAgICAgIH0pO1xuICAgIH1cbiAgICB0aGlzLl96b29tVG9Qb2ludE5hdGl2ZSggbmV3IGZhYnJpYy5Qb2ludCgwLCAwKSwgX3NjYWxlKVxuICAgIC8vICB0aGlzLl9zZXRab29tTmF0aXZlKF9zY2FsZSk7XG4gICAgdGhpcy5maXJlKCd2aWV3cG9ydDpzY2FsZWQnLCB7c2NhbGU6IF9zY2FsZX0pO1xuICB9LFxuICB6b29tVG9Qb2ludDogZnVuY3Rpb24ocG9pbnQsIG5ld1pvb20pe1xuICAgIHZhciBfbWF4ID0gIHRoaXMuZ2V0TWF4Wm9vbSgpO1xuICAgIHZhciBfbWluID0gIHRoaXMuZ2V0TWluWm9vbSgpLnNjYWxlO1xuICAgIGlmKG5ld1pvb20gPiBfbWF4KXtcbiAgICAgIG5ld1pvb20gPSBfbWF4O1xuICAgIH1cbiAgICBpZihuZXdab29tIDwgX21pbil7XG4gICAgICBuZXdab29tID0gX21pbjtcbiAgICB9XG4gICAgdGhpcy5fem9vbVRvUG9pbnROYXRpdmUoIHBvaW50LCBuZXdab29tKTtcbiAgICBmb3IgKHZhciBpIGluIHRoaXMuX29iamVjdHMpIHtcbiAgICAgIHRoaXMuX29iamVjdHNbaV0uc2V0Q29vcmRzKCk7XG4gICAgfVxuICAgIHRoaXMuZmlyZSgndmlld3BvcnQ6c2NhbGVkJywge3NjYWxlOiBuZXdab29tfSk7XG4gIH0sXG4gIHJlc2V0Vmlld3BvcnQ6IGZ1bmN0aW9uICgpIHtcbiAgICBfY2FudmFzLnZpZXdwb3J0VHJhbnNmb3JtWzBdID0gMTtcbiAgICBfY2FudmFzLnZpZXdwb3J0VHJhbnNmb3JtWzNdID0gMTtcbiAgICBfY2FudmFzLnZpZXdwb3J0VHJhbnNmb3JtWzRdID0gMDtcbiAgICBfY2FudmFzLnZpZXdwb3J0VHJhbnNmb3JtWzVdID0gMDtcbiAgICBfY2FudmFzLnJlbmRlckFsbCgpO1xuICAgIGZvciAodmFyIGkgaW4gdGhpcy5fb2JqZWN0cykge1xuICAgICAgdGhpcy5fb2JqZWN0c1tpXS5zZXRDb29yZHMoKTtcbiAgICB9XG4gIH0sXG4gIHpvb21Ub1BvaW50RW5hYmxlZDogdHJ1ZSxcbiAgbWluWm9vbUZhY3RvcjogMSxcbiAgbWF4Wm9vbTogMjAsXG4gIGF1dG9DZW50ZXJBbmRab29tT3V0RW5hYmxlZDogZmFsc2UsXG4gIGdldE1heFpvb206IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5tYXhab29tO1xuICB9LFxuICBnZXRNaW5ab29tOiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIF9jb250YWluZXJTaXplID0ge1xuICAgICAgd2lkdGg6ICQodGhpcy53cmFwcGVyRWwpLndpZHRoKCksXG4gICAgICBoZWlnaHQ6ICQodGhpcy53cmFwcGVyRWwpLmhlaWdodCgpXG4gICAgfTtcbiAgICB2YXIgX2JnU2l6ZSA9IHtcbiAgICAgIHdpZHRoOiB0aGlzLm9yaWdpbmFsV2lkdGgsXG4gICAgICBoZWlnaHQ6IHRoaXMub3JpZ2luYWxIZWlnaHRcbiAgICB9O1xuICAgIHZhciBfbWF4U2l6ZSA9IHtcbiAgICAgIHdpZHRoOiBfY29udGFpbmVyU2l6ZS53aWR0aCAqIHRoaXMubWluWm9vbUZhY3RvcixcbiAgICAgIGhlaWdodDogX2NvbnRhaW5lclNpemUuaGVpZ2h0ICogdGhpcy5taW5ab29tRmFjdG9yXG4gICAgfTtcblxuICAgIHJldHVybiBmYWJyaWMudXRpbC5nZXRQcm9wb3J0aW9ucyhfYmdTaXplLCBfbWF4U2l6ZSwgJ2ZpdCcpO1xuICB9LFxuICBjZW50ZXJBbmRab29tT3V0OiBmdW5jdGlvbiAoKSB7XG5cbiAgICBpZih0aGlzLnZpcnR1YWwpe1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB2YXIgb3B0aW9ucyA9IHRoaXMuZ2V0TWluWm9vbSgpO1xuXG4gICAgdmFyIF9jb250YWluZXJTaXplID0ge1xuICAgICAgd2lkdGg6ICQodGhpcy53cmFwcGVyRWwpLndpZHRoKCksXG4gICAgICBoZWlnaHQ6ICQodGhpcy53cmFwcGVyRWwpLmhlaWdodCgpXG4gICAgfTtcblxuICAgIHZhciB2cHQgPSB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtLnNsaWNlKDApO1xuICAgIHZwdFswXSA9IG9wdGlvbnMuc2NhbGU7XG4gICAgdnB0WzNdID0gb3B0aW9ucy5zY2FsZTtcbiAgICB2cHRbNF0gPSAoX2NvbnRhaW5lclNpemUud2lkdGggLSBvcHRpb25zLndpZHRoICkgLyAyO1xuICAgIHZwdFs1XSA9IChfY29udGFpbmVyU2l6ZS5oZWlnaHQgLSBvcHRpb25zLmhlaWdodCkgLyAyO1xuXG4gICAgdGhpcy5zZXRWaWV3cG9ydFRyYW5zZm9ybSh2cHQpO1xuXG5cbiAgICB0aGlzLl91cGRhdGVfYmFja2dyb3VuZF9pbWFnZSgpO1xuICAgIC8vIHRoaXMuZmlyZShcInZpZXdwb3J0OnNjYWxlZFwiLHtzY2FsZTogb3B0aW9ucy5zY2FsZX0pXG4gICAgLy90aGlzLnJlbmRlckFsbCgpO1xuICB9LFxuICBjZW50ZXJPbk9iamVjdDogZnVuY3Rpb24odGFnKXtcbiAgICB2YXIgYnIgPSB0YWcuZ2V0Qm91bmRpbmdSZWN0KCk7XG4gICAgdmFyIGN0ID0gdGhpcy52aWV3cG9ydFRyYW5zZm9ybTtcbiAgICBici53aWR0aCAvPSBjdFswXTtcbiAgICBici5oZWlnaHQgLz0gY3RbM107XG4gICAgdmFyIHNpemUgPSB7XG4gICAgICB3aWR0aDogYnIud2lkdGggKiAxLjEsXG4gICAgICBoZWlnaHQ6IGJyLmhlaWdodCAqIDEuMVxuICAgIH07XG5cbiAgICB2YXIgcHJvcCA9IGZhYnJpYy51dGlsLmdldFByb3BvcnRpb25zKHNpemUsdGhpcyk7XG4gICAgdmFyIF93ID0gKHRoaXMud2lkdGggLyBwcm9wLnNjYWxlIC0gc2l6ZS53aWR0aCApIC8gMjtcbiAgICB2YXIgX2ggPSAodGhpcy5oZWlnaHQgLyBwcm9wLnNjYWxlIC0gc2l6ZS5oZWlnaHQpIC8gMjtcbiAgICB2YXIgX2wgPSAoYnIubGVmdCAgLSBjdFs0XSkgLyBjdFswXTtcbiAgICB2YXIgX3QgPSAoYnIudG9wIC0gY3RbNV0pIC8gY3RbM107XG5cbiAgICB2YXIgeDEgPSBbXG4gICAgICBwcm9wLnNjYWxlLFxuICAgICAgMCwwLFxuICAgICAgcHJvcC5zY2FsZSxcbiAgICAgIC0gdGFnLmxlZnQgKiBwcm9wLnNjYWxlICsgKHRhZy53aWR0aCAqIDAuMDUgKyBfdykgKiBwcm9wLnNjYWxlLFxuICAgICAgLSB0YWcudG9wICogcHJvcC5zY2FsZSArICh0YWcuaGVpZ2h0ICogMC4wNSArIF9oICkqIHByb3Auc2NhbGVcbiAgICBdO1xuICAgIHZhciB4MiA9IFtcbiAgICAgIHByb3Auc2NhbGUsXG4gICAgICAwLDAsXG4gICAgICBwcm9wLnNjYWxlLFxuICAgICAgLSBfbCAgKiBwcm9wLnNjYWxlICsgKGJyLndpZHRoICogMC4wNSArIF93KSAqIHByb3Auc2NhbGUsXG4gICAgICAtIF90ICAqIHByb3Auc2NhbGUgKyAoYnIuaGVpZ2h0ICogMC4wNSArIF9oICkqIHByb3Auc2NhbGVcbiAgICBdO1xuXG4gICAgdGhpcy5zZXRWaWV3cG9ydFRyYW5zZm9ybSh4Mik7XG4gICAgdGhpcy5maXJlKFwidmlld3BvcnQ6c2NhbGVkXCIse3NjYWxlOiBwcm9wLnNjYWxlfSlcbiAgICB0aGlzLnJlbmRlckFsbCgpO1xuICB9LFxuXG4gIF9fb25Nb3VzZVdoZWVsOiBmdW5jdGlvbiAoZXZlbnQpIHtcblxuICAgIGlmKCF0aGlzLm1vdXNlV2hlZWxFbmFibGVkIHx8IHRoaXMuem9vbUN0cmxLZXkgJiYgIWV2ZW50LmN0cmxLZXkpe1xuICAgICAgcmV0dXJuO1xuICAgIH1cbi8vRmluZCBuZWFyZXN0IHBvaW50LCB0aGF0IGlzIGluc2lkZSBpbWFnZSBFTkRcbiAgICB2YXIgem9vbVN0ZXA7Ly8gPSAwLjEgKiBldmVudC5kZWx0YVk7XG4gICAgaWYgKGV2ZW50LmRlbHRhWSA8IDApIHtcbiAgICAgIHpvb21TdGVwID0gMS4xO1xuICAgIH0gZWxzZSB7XG4gICAgICB6b29tU3RlcCA9IDAuOTtcbiAgICB9XG5cbiAgICB2YXIgbmV3Wm9vbSA9IHRoaXMuZ2V0Wm9vbSgpICogem9vbVN0ZXA7XG4gICAgdmFyIG1pblpvb20gPSB0aGlzLmdldE1pblpvb20oKS5zY2FsZTtcblxuXG4gICAgaWYodGhpcy56b29tVG9Qb2ludEVuYWJsZWQpe1xuICAgICAgdmFyIHBvaW50ID0gbmV3IGZhYnJpYy5Qb2ludChldmVudC5vZmZzZXRYLCBldmVudC5vZmZzZXRZKTtcbiAgICAgIHZhciBfeCA9IHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bNF07XG4gICAgICB2YXIgX3kgPSB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzVdO1xuXG4gICAgICAvLyBGaW5kIG5lYXJlc3QgcG9pbnQsIHRoYXQgaXMgaW5zaWRlIGltYWdlIEJFR0lOXG4gICAgICAvLyBJdCBpcyBuZWVkZWQgdG8gcHJldmVudCBjYW52YXMgdG8gem9vbSBvdXRzaWRlIGltYWdlXG4gICAgICB2YXIgX3cgPSB0aGlzLm9yaWdpbmFsV2lkdGggKiB0aGlzLmdldFpvb20oKSArIF94O1xuICAgICAgdmFyIF9oID0gdGhpcy5vcmlnaW5hbEhlaWdodCAqIHRoaXMuZ2V0Wm9vbSgpICsgX3k7XG5cblxuICAgICAgaWYgKHBvaW50LnggPCBfeCkge1xuICAgICAgICBwb2ludC54ID0gX3g7XG4gICAgICB9XG4gICAgICBpZiAocG9pbnQueSA8IF95KSB7XG4gICAgICAgIHBvaW50LnkgPSBfeTtcbiAgICAgIH1cbiAgICAgIGlmIChwb2ludC54ID4gX3cpIHtcbiAgICAgICAgcG9pbnQueCA9IF93O1xuICAgICAgfVxuICAgICAgaWYgKHBvaW50LnkgPiBfaCkge1xuICAgICAgICBwb2ludC55ID0gX2g7XG4gICAgICB9XG4gICAgICBpZiAobWluWm9vbSA+IG5ld1pvb20pIHtcbiAgICAgICAgaWYodGhpcy5hdXRvQ2VudGVyQW5kWm9vbU91dEVuYWJsZWQpe1xuICAgICAgICAgIHRoaXMuY2VudGVyQW5kWm9vbU91dCgpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnpvb21Ub1BvaW50KHBvaW50LCBuZXdab29tKTtcbiAgICAgIH1cbiAgICB9ZWxzZXtcbiAgICAgIHRoaXMuc2V0Wm9vbShuZXdab29tKTtcbiAgICB9XG5cblxuXG5cbiAgICBmb3IgKHZhciBpIGluIHRoaXMuX29iamVjdHMpIHtcbiAgICAgIHRoaXMuX29iamVjdHNbaV0uc2V0Q29vcmRzKCk7XG4gICAgfVxuICAgIHRoaXMucmVuZGVyQWxsKCk7XG4gICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICByZXR1cm4gZmFsc2U7IC8vcHJldmVudGluZyBzY3JvbGwgcGFnZVxuICB9LFxuICBzY2FsZUZhY3RvcjogMS4xLFxuICBnZXRPcmlnbmFsQ2VudGVyIDogZnVuY3Rpb24oKXtcbiAgICB2YXIgcG9pbnQgPSB0aGlzLmdldENlbnRlcigpO1xuICAgIHBvaW50LmxlZnQgKz0gdGhpcy52aWV3cG9ydFRyYW5zZm9ybVs0XSA7XG4gICAgcG9pbnQudG9wICs9IHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bNV07XG4gICAgcmV0dXJuIHBvaW50O1xuICB9XG59KTtcblxuXG5cblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuU2xpZGVDYW52YXMucHJvdG90eXBlLmFjdGlvbnMsIHtcbiAgem9vbU91dDoge1xuICAgIGNsYXNzTmFtZTogJ2ZhIGZhLXNlYXJjaC1taW51cycsXG4gICAgdGl0bGU6ICd6b29tLW91dCcsXG4gICAgYWN0aW9uOiBmdW5jdGlvbiAobSkge1xuICAgICAgdmFyIHBvaW50ID0gdGhpcy5nZXRPcmlnbmFsQ2VudGVyKCk7XG4gICAgICB2YXIgc2NhbGVWYWx1ZSA9IHRoaXMuZ2V0Wm9vbSgpIC8gdGhpcy5zY2FsZUZhY3RvcjtcbiAgICAgIHRoaXMuem9vbVRvUG9pbnQoe3g6IHBvaW50LmxlZnQsIHk6IHBvaW50LnRvcH0sc2NhbGVWYWx1ZSk7XG4gICAgfVxuICB9LFxuICB6b29tTnVtYmVyOiB7XG4gICAgdHlwZTogJ251bWJlcicsXG4gICAgdmFsdWU6IHtcbiAgICAgIG1pbjogIGZ1bmN0aW9uKCl7cmV0dXJuIDAuMDF9LFxuICAgICAgbWF4OiAgZnVuY3Rpb24oKXtyZXR1cm4gMTB9LFxuICAgICAgc2V0OiBmdW5jdGlvbiAodmFsKSB7XG4gICAgICAgIHRoaXMuc2V0Wm9vbSh2YWwpXG4gICAgICB9LFxuICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldFpvb20oKVxuICAgICAgfSxcbiAgICAgIG9ic2VydmU6IFwidmlld3BvcnQ6c2NhbGVkXCJcbiAgICB9XG4gIH0sXG4gIHpvb21Jbjoge1xuICAgIGNsYXNzTmFtZTogJ2ZhIGZhLXNlYXJjaC1wbHVzJyxcbiAgICB0aXRsZTogJ3pvb20taW4nLFxuICAgIGFjdGlvbjogZnVuY3Rpb24gKG0pIHtcbiAgICAgIHZhciBwb2ludCA9IHRoaXMuZ2V0T3JpZ25hbENlbnRlcigpO1xuICAgICAgdmFyIHNjYWxlVmFsdWUgPSB0aGlzLmdldFpvb20oKSAqIHRoaXMuc2NhbGVGYWN0b3I7XG4gICAgICB0aGlzLnpvb21Ub1BvaW50KHt4OiBwb2ludC5sZWZ0LCB5OiBwb2ludC50b3B9LHNjYWxlVmFsdWUpO1xuICAgIH1cbiAgfVxuICAvLyB6b29tOiB7XG4gIC8vICAgdGl0bGU6IFwiem9vbVwiLFxuICAvLyAgIG1lbnU6IHpvb21PdXRcbiAgLy8gfVxufSk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL21vZHVsZXMvem9vbS5qcyIsIi8qKlxuKiBJbnRlcmFjdGl2ZU1vZGUgbWl4aW4uIEFsbG93IHRvIHN3aXRjaCBiZXR3ZWVuIHBhbi9lZGl0L2RyYXdpbmcgY2FudmFzIG1vZGVzLlxuKi9cblxuJ3VzZSBzdHJpY3QnO1xuXG5cbnZhciBfbW91c2VfZG93bl9vdmVyd3JpdHRlbiA9IGZhYnJpYy5DYW52YXMucHJvdG90eXBlLl9vbk1vdXNlRG93bjtcbnZhciBfbW91c2VfdXBfb3ZlcndyaXR0ZW4gPSBmYWJyaWMuQ2FudmFzLnByb3RvdHlwZS5fb25Nb3VzZVVwO1xudmFyIF9tb3VzZV9tb3ZlX292ZXJ3cml0dGVuID0gZmFicmljLkNhbnZhcy5wcm90b3R5cGUuX29uTW91c2VNb3ZlO1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUsIHtcbiAgX2luaXRFdmVudExpc3RlbmVyc19vdmVyd3JpdHRlbjogZmFicmljLkNhbnZhcy5wcm90b3R5cGUuX2luaXRFdmVudExpc3RlbmVycyxcbiAgX2luaXRFdmVudExpc3RlbmVyczogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuX2luaXRFdmVudExpc3RlbmVyc19vdmVyd3JpdHRlbigpO1xuICAgIHRoaXMuX19fb25LZXlEb3duID0gdGhpcy5fb25LZXlEb3duLmJpbmQodGhpcyk7XG4gICAgZmFicmljLnV0aWwuYWRkTGlzdGVuZXIoZmFicmljLndpbmRvdywgJ2tleWRvd24nLCB0aGlzLl9fX29uS2V5RG93bik7XG4gIH0sXG4gIF9yZW1vdmVMaXN0ZW5lcnNfb3ZlcndyaXR0ZW46IGZhYnJpYy5DYW52YXMucHJvdG90eXBlLnJlbW92ZUxpc3RlbmVycyxcbiAgcmVtb3ZlTGlzdGVuZXJzOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5fcmVtb3ZlTGlzdGVuZXJzX292ZXJ3cml0dGVuKCk7XG4gICAgZmFicmljLnV0aWwucmVtb3ZlTGlzdGVuZXIoZmFicmljLndpbmRvdywgJ2tleWRvd24nLCB0aGlzLl9fX29uS2V5RG93bik7XG4gIH0sXG4gIF9vbktleURvd246IGZ1bmN0aW9uIChlKSB7XG4gICAgcmV0dXJuIHRoaXMuX2FwcGx5TWl4ZWRNb2RlKGUpO1xuICB9LFxuICBnZXRJbnRlcmFjdGl2ZU1vZGU6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5pbnRlcmFjdGl2ZU1vZGU7XG4gIH0sXG4gIHNldEludGVyYWN0aXZlTW9kZTogZnVuY3Rpb24gKHRvb2wpIHtcbiAgICAvL3RvZG8gY2hlY2t0aGlzIG91dFxuICAgIC8vIGlmICh0b29sID09PSAnaGFuZCcpIHtcbiAgICAvLyAgIHRoaXMuc2V0Q3Vyc29yKCdwb2ludGVyJyk7XG4gICAgLy8gfVxuICAgIHRoaXMuaXNEcmF3aW5nTW9kZSA9ICh0b29sID09PSAnZHJhdycpO1xuICAgIHRoaXMuaXNIYW5kTW9kZSA9ICh0b29sID09PSAnaGFuZCcpO1xuICAgIHRoaXMuaW50ZXJhY3RpdmUgPSAodG9vbCAhPT0gJ2Rpc2FibGVkJyk7XG4gICAgdGhpcy5pc01peGVkTW9kZSA9ICh0b29sID09PSAnbWl4ZWQnKTtcblxuICAgIGlmICghdGhpcy5pbnRlcmFjdGl2ZSkge1xuICAgICAgdGhpcy51cHBlckNhbnZhc0VsLnN0eWxlLmN1cnNvciA9ICdkZWZhdWx0JztcbiAgICB9XG4gICAgdGhpcy5pbnRlcmFjdGl2ZU1vZGUgPSB0b29sO1xuICB9LFxuXG4gIC8qKlxuICAgKiAgY3VycmVudCBtb2RlXG4gICAqICBAdmFsdWVzIGRlZmF1bHQgfCBoYW5kIHwgc2VsZWN0aW9uXG4gICAqICBAY29tbWVudFxuICAgKiAgICAgIGhhbmQgICAgICAtIG1vdmluZyBjYW52YXNcbiAgICogICAgICBkcmF3IC0gZHJhd2luZyByZWFjdGFuZ2xlc1xuICAgKiAgICAgIHNlbGVjdGlvbiAtIGRlZmF1bHQgYmVoYXZpb3JcbiAgICovXG4gIGludGVyYWN0aXZlTW9kZTogJ2RlZmF1bHQnLFxuXG4gIGlzSGFuZE1vZGU6IGZhbHNlLFxuICBfaGFuZE1vZGVDdXJzb3JNb3ZlOiBmYWxzZSxcbiAgX2hhbmRNb2RlQ3Vyc29yRG93bjogZmFsc2UsXG4gIF9oYW5kTW9kZUN1cnNvclBvc2l0aW9uOiB7eDogMCwgeTogMH0sXG4gIF9oYW5kTW9kZU1vdXNlTW92ZTogZnVuY3Rpb24gKGUpIHtcbiAgICBpZiAodGhpcy5faGFuZE1vZGVDdXJzb3JEb3duID09PSB0cnVlKSB7XG5cbiAgICAgIGlmIChlLnBhZ2VZID09PSB0aGlzLl9oYW5kTW9kZUN1cnNvclBvc2l0aW9uLnkgJiYgZS5wYWdlWCA9PT0gdGhpcy5faGFuZE1vZGVDdXJzb3JQb3NpdGlvbi54KSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgdGhpcy5faGFuZE1vZGVDdXJzb3JNb3ZlID0gdHJ1ZTtcblxuICAgICAgdmFyIHNjcm9sbCA9IHt4OiB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzRdLCB5OiB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzVdfTtcblxuICAgICAgdmFyIG5ld1Njcm9sbCA9IHtcbiAgICAgICAgeDogc2Nyb2xsLnggLSAodGhpcy5faGFuZE1vZGVDdXJzb3JQb3NpdGlvbi54IC0gZS5wYWdlWCksXG4gICAgICAgIHk6IHNjcm9sbC55IC0gKHRoaXMuX2hhbmRNb2RlQ3Vyc29yUG9zaXRpb24ueSAtIGUucGFnZVkpXG4gICAgICB9O1xuXG4gICAgICB2YXIgZGltcyA9IHtcbiAgICAgICAgd2lkdGg6IHRoaXMuc2l6ZS53aWR0aCAqIHRoaXMuem9vbSAtIHRoaXMubG93ZXJDYW52YXNFbC53aWR0aCxcbiAgICAgICAgaGVpZ2h0OiB0aGlzLnNpemUuaGVpZ2h0ICogdGhpcy56b29tIC0gdGhpcy5sb3dlckNhbnZhc0VsLmhlaWdodFxuICAgICAgfTtcbiAgICAgIC8qICB0b2RvIG5lZWQgdG8gYWRkIHNvbWUgcmVzdHJpY3Rpb25zIGxhdGVyXG4gICAgICAgLy9NYXRoLm1heChNYXRoLm1pbigwLG5ld1Njcm9sbC54KSwtZGltcy53aWR0aCk7XG4gICAgICAgLy9NYXRoLm1heChNYXRoLm1pbigwLG5ld1Njcm9sbC55KSwtZGltcy5oZWlnaHQpO1xuICAgICAgICovXG4gICAgICB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzRdID0gbmV3U2Nyb2xsLng7XG4gICAgICB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzVdID0gbmV3U2Nyb2xsLnk7XG5cbiAgICAgIHRoaXMuZmlyZSgndmlld3BvcnQ6dHJhbnNsYXRlJyk7XG5cbiAgICAgIHRoaXMucmVuZGVyQWxsKCk7XG4gICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gdGhpcy5fb2JqZWN0cy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICB0aGlzLl9vYmplY3RzW2ldLnNldENvb3JkcygpO1xuICAgICAgfVxuXG4gICAgICB0aGlzLl9oYW5kTW9kZUN1cnNvclBvc2l0aW9uLnkgPSBlLnBhZ2VZO1xuICAgICAgdGhpcy5faGFuZE1vZGVDdXJzb3JQb3NpdGlvbi54ID0gZS5wYWdlWDtcbiAgICB9XG4gIH0sXG4gIF9oYW5kTW9kZU1vdXNlVXA6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLl9oYW5kTW9kZUN1cnNvckRvd24gPSBmYWxzZTtcbiAgICBpZiAoIXRoaXMuX2hhbmRNb2RlQ3Vyc29yTW92ZSkge1xuXG4gICAgfVxuICB9LFxuICBfaGFuZE1vZGVNb3VzZURvd246IGZ1bmN0aW9uIChlKSB7XG5cbiAgICB0aGlzLl9oYW5kTW9kZUN1cnNvck1vdmUgPSBmYWxzZTtcbiAgICB0aGlzLl9oYW5kTW9kZUN1cnNvckRvd24gPSB0cnVlO1xuICAgIHRoaXMuX2hhbmRNb2RlQ3Vyc29yUG9zaXRpb24gPSB7XG4gICAgICB5OiBlLnBhZ2VZLFxuICAgICAgeDogZS5wYWdlWFxuICAgIH07XG4gIH0sXG4gIGhhbmRNb2RlRW5hYmxlZDogZmFsc2UsXG4gIGhhbmRNb2RlS2V5OiBcIkFsdFwiLFxuICBfYXBwbHlNaXhlZE1vZGU6IGZ1bmN0aW9uIChlKSB7XG4gICAgdGhpcy5fY3VycmVudF90YXJnZXQgPSB0aGlzLmZpbmRUYXJnZXQoZSk7XG5cbiAgICBpZiAodGhpcy5oYW5kTW9kZUVuYWJsZWQgJiYgZS5hbHRLZXkgfHwgZS5rZXkgPT09IHRoaXMuaGFuZE1vZGVLZXkpIHtcbiAgICAgIC8vaWYgc2hpZnQgdXNlIGhhbmQgbW9kZVxuICAgICAgaWYgKCF0aGlzLmlzSGFuZE1vZGUpIHtcbiAgICAgICAgdGhpcy5pc0hhbmRNb2RlID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5pc0RyYXdpbmdNb2RlID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc2V0Q3Vyc29yKCdwb2ludGVyJyk7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmICh0aGlzLmlzTWl4ZWRNb2RlICYmICF0aGlzLl9pc0N1cnJlbnRseURyYXdpbmcgJiYgIXRoaXMuX2N1cnJlbnRUcmFuc2Zvcm0pIHtcblxuICAgICAgdGhpcy5pc0hhbmRNb2RlID0gZmFsc2U7XG5cbiAgICAgIGlmICh0aGlzLl9jdXJyZW50X3RhcmdldCkge1xuICAgICAgICBpZiAodGhpcy5mcmVlRHJhd2luZ0JydXNoICYmIHRoaXMuX2N1cnJlbnRfdGFyZ2V0LmFsbG93RHJhd2luZykge1xuICAgICAgICAgIHZhciBjb3JuZXIgPSB0aGlzLl9jdXJyZW50X3RhcmdldC5fZmluZFRhcmdldENvcm5lcih0aGlzLmdldFBvaW50ZXIoZSwgdHJ1ZSkpO1xuICAgICAgICAgIGlmICghY29ybmVyKSB7XG4gICAgICAgICAgICB0aGlzLmlzRHJhd2luZ01vZGUgPSB0cnVlO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmlzRHJhd2luZ01vZGUgPSBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5pc0RyYXdpbmdNb2RlKSB7XG4gICAgICAgICAgdGhpcy5pc0RyYXdpbmdNb2RlID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmICh0aGlzLmZyZWVEcmF3aW5nQnJ1c2ggJiYgIXRoaXMuaXNEcmF3aW5nTW9kZSkge1xuICAgICAgICAgIHRoaXMuc2V0Q3Vyc29yKHRoaXMuZnJlZURyYXdpbmdDdXJzb3IpO1xuICAgICAgICAgIHRoaXMuaXNEcmF3aW5nTW9kZSA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5pc0hhbmRNb2RlID0gZmFsc2U7XG4gICAgfVxuXG4gIH0sXG4gIF9vbk1vdXNlTW92ZTogZnVuY3Rpb24gKGUpIHtcbiAgICBpZiAoIXRoaXMuaW50ZXJhY3RpdmUpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLl9hcHBseU1peGVkTW9kZShlKTtcblxuICAgIGlmICh0aGlzLmlzSGFuZE1vZGUpIHtcblxuICAgICAgaWYgKHRoaXMuX2N1cnJlbnRfdGFyZ2V0ICYmIHRoaXMuX2N1cnJlbnRfdGFyZ2V0LnNlbGVjdGFibGVfb3ZlcndyaXR0ZW4pIHtcbiAgICAgICAgdGhpcy5fY3VycmVudF90YXJnZXQuc2VsZWN0YWJsZSA9IHRydWU7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLl9oYW5kTW9kZUFjdGl2ZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5faGFuZE1vZGVNb3VzZU1vdmUoZSk7XG4gICAgICB9XG4gICAgICB0aGlzLmZpcmUoJ21vdXNlOm1vdmUnLCB7dGFyZ2V0OiB0aGlzLl9jdXJyZW50X3RhcmdldCwgZTogZX0pO1xuICAgICAgdGhpcy5fY3VycmVudF90YXJnZXQgJiYgdGhpcy5fY3VycmVudF90YXJnZXQuZmlyZSgnbW91c2Vtb3ZlJywge2U6IGV9KTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gX21vdXNlX21vdmVfb3ZlcndyaXR0ZW4uY2FsbCh0aGlzLCBlKTtcbiAgICB9XG4gIH0sIC8qKlxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgX29uU2NhbGU6IGZ1bmN0aW9uIChlLCB0cmFuc2Zvcm0sIHgsIHkpIHtcblxuICAgIHZhciB1c2VVbmlTY2FsZSA9IGUuc2hpZnRLZXkgXiB0aGlzLnNoaWZ0SW52ZXJ0ZWQ7XG4gICAgLy8gcm90YXRlIG9iamVjdCBvbmx5IGlmIHNoaWZ0IGtleSBpcyBub3QgcHJlc3NlZFxuICAgIC8vIGFuZCBpZiBpdCBpcyBub3QgYSBncm91cCB3ZSBhcmUgdHJhbnNmb3JtaW5nXG4gICAgaWYgKCh1c2VVbmlTY2FsZSB8fCB0aGlzLnVuaVNjYWxlVHJhbnNmb3JtKSAmJiAhdHJhbnNmb3JtLnRhcmdldC5nZXQoJ2xvY2tVbmlTY2FsaW5nJykpIHtcbiAgICAgIHRyYW5zZm9ybS5jdXJyZW50QWN0aW9uID0gJ3NjYWxlJztcbiAgICAgIHJldHVybiB0aGlzLl9zY2FsZU9iamVjdCh4LCB5KTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAvLyBTd2l0Y2ggZnJvbSBhIG5vcm1hbCByZXNpemUgdG8gcHJvcG9ydGlvbmFsXG4gICAgICBpZiAoIXRyYW5zZm9ybS5yZXNldCAmJiB0cmFuc2Zvcm0uY3VycmVudEFjdGlvbiA9PT0gJ3NjYWxlJykge1xuICAgICAgICB0aGlzLl9yZXNldEN1cnJlbnRUcmFuc2Zvcm0oZSk7XG4gICAgICB9XG5cbiAgICAgIHRyYW5zZm9ybS5jdXJyZW50QWN0aW9uID0gJ3NjYWxlRXF1YWxseSc7XG4gICAgICByZXR1cm4gdGhpcy5fc2NhbGVPYmplY3QoeCwgeSwgJ2VxdWFsbHknKTtcbiAgICB9XG4gIH0sXG4gIHNoaWZ0SW52ZXJ0ZWQ6IGZhbHNlLFxuICBfc2V0Q3Vyc29yRnJvbUV2ZW50X292ZXJ3cml0dGVuOiBmYWJyaWMuQ2FudmFzLnByb3RvdHlwZS5fc2V0Q3Vyc29yRnJvbUV2ZW50LFxuICBfc2V0Q3Vyc29yRnJvbUV2ZW50OiBmdW5jdGlvbiAoZSwgdGFyZ2V0KSB7XG4gICAgaWYgKHRoaXMuaXNIYW5kTW9kZSkge1xuICAgICAgdGhpcy5zZXRDdXJzb3IoJ3BvaW50ZXInKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fc2V0Q3Vyc29yRnJvbUV2ZW50X292ZXJ3cml0dGVuKGUsIHRhcmdldCk7XG4gICAgfVxuICB9LFxuICBfb25Nb3VzZURvd246IGZ1bmN0aW9uIChlKSB7XG4gICAgaWYgKCF0aGlzLmludGVyYWN0aXZlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cbiAgICB0aGlzLl9hcHBseU1peGVkTW9kZShlKTtcbiAgICBpZiAodGhpcy5pc0hhbmRNb2RlICYmIHRoaXMuX2N1cnJlbnRfdGFyZ2V0KSB7XG4gICAgICB0aGlzLl9jdXJyZW50X3RhcmdldC5zZWxlY3RhYmxlX292ZXJ3cml0dGVuID0gdGhpcy5fY3VycmVudF90YXJnZXQuc2VsZWN0YWJsZTtcbiAgICAgIHRoaXMuX2N1cnJlbnRfdGFyZ2V0LnNlbGVjdGFibGUgPSBmYWxzZTtcbiAgICB9XG5cbiAgICBfbW91c2VfZG93bl9vdmVyd3JpdHRlbi5jYWxsKHRoaXMsIGUpO1xuXG5cbiAgICBpZiAodGhpcy5pc0hhbmRNb2RlKSB7XG5cbiAgICAgIGlmICh0aGlzLl9jdXJyZW50X3RhcmdldCAmJiB0aGlzLl9jdXJyZW50X3RhcmdldC5zZWxlY3RhYmxlX292ZXJ3cml0dGVuKSB7XG4gICAgICAgIHRoaXMuX2N1cnJlbnRfdGFyZ2V0LnNlbGVjdGFibGUgPSB0cnVlO1xuICAgICAgfVxuICAgICAgdGhpcy5faGFuZE1vZGVBY3RpdmUgPSB0cnVlO1xuICAgICAgdGhpcy5faGFuZE1vZGVNb3VzZURvd24oZSk7XG4gICAgfVxuICB9LFxuXG4gIF9vbk1vdXNlVXA6IGZ1bmN0aW9uIChlKSB7XG4gICAgaWYgKCF0aGlzLmludGVyYWN0aXZlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIF9tb3VzZV91cF9vdmVyd3JpdHRlbi5jYWxsKHRoaXMsIGUpO1xuXG4gICAgaWYgKHRoaXMuaXNIYW5kTW9kZSkge1xuICAgICAgdGhpcy5faGFuZE1vZGVBY3RpdmUgPSBmYWxzZTtcbiAgICB9XG4gIH1cbn0pO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9tb2R1bGVzL2ludGVyYWN0aXZlTW9kZS5qcyIsIid1c2Ugc3RyaWN0JztcblxuXG4vKipcbiAgICogRHJhdyBDU1MzIGJvcmRlciBpbWFnZSBvbiBjYW52YXMuXG4gICAqIEBwYXJhbSBjYW52YXMgICAge0hUTUxDYW52YXNFbGVtZW50fVxuICAgKiBAcGFyYW0gaW1nICAgICAgIHtIVE1MSW1hZ2VFbGVtZW50fSBib3JkZXItaW1hZ2Utc291cmNlIGltYWdlXG4gICAqIEBwYXJhbSBvcHRpb25zICAge09iamVjdH1cbiAgICogICAgICBzbGljZSB7QXJyYXl9IGJvcmRlci1pbWFnZS1zbGljZSB2YWx1ZXNcbiAgICogICAgICB3aWR0aCB7QXJyYXl9IGJvcmRlci1pbWFnZS13aWR0aCB2YWx1ZXNcbiAgICogICAgICBvdXRzZXQge0FycmF5fSBib3JkZXItaW1hZ2Utb3V0c2V0IHZhbHVlc1xuICAgKiAgICAgIHJlcGVhdCB7QXJyYXl9IGJvcmRlci1pbWFnZS1yZXBlYXQgdmFsdWVzXG4gICAqIEBwYXJhbSBzaXplICAgICAge09iamVjdH1cbiAgICovXG4gICBmYWJyaWMudXRpbC5kcmF3Qm9yZGVySW1hZ2UgID0gZnVuY3Rpb24oY2FudmFzLCBpbWcsIG9wdGlvbnMpe1xuXG5cbiAgICB2YXIgb3B0aW9ucyA9IGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoe1xuICAgICAgXCJzbGljZVwiOiAgICAgICAgWzI1LDI1LDI1LDI1XSxcbiAgICAgIFwid2lkdGhcIjogICAgICAgIFsyNSwyNSwyNSwyNV0sXG4gICAgICBcImZpbGxcIjogICAgICAgICBmYWxzZSxcbiAgICAgIFwicmVwZWF0XCI6ICAgICAgIFtcInJvdW5kXCIsXCJyb3VuZFwiXSxcbiAgICAgIFwib3V0c2V0X3ZhbHVlc1wiXHQ6IFswLCAwLCAwLCAwXSxcbiAgICAgIFwic2xpY2VfdW5pdHNcIiAgIDogWzAsIDAsIDAsIDBdLFxuICAgICAgXCJ3aWR0aF91bml0c1wiXHQ6IFswLCAwLCAwLCAwXSxcbiAgICAgIFwib3V0c2V0X3VuaXRzXCJcdDogWzAsIDAsIDAsIDBdLFxuICAgICAgXCJzaXplXCJcdFx0XHQ6IFtjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHRdXG4gICAgfSxvcHRpb25zKVxuXG5cbiAgICB2YXIgdyA9IGltZy53aWR0aDtcbiAgICB2YXIgaCA9IGltZy5oZWlnaHQ7XG5cbiAgICB2YXIgY3R4ID0gY2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcbiAgICB2YXIgc2xpY2UgPSBvcHRpb25zLnNsaWNlO1xuICAgIHZhciB3aWR0aCA9IG9wdGlvbnMud2lkdGg7XG5cbiAgICB2YXIgdzIgPSBvcHRpb25zLnNpemVbMF07XG4gICAgdmFyIGgyID0gb3B0aW9ucy5zaXplWzFdO1xuXG5cbiAgICBpZihvcHRpb25zLnNsaWNlX3VuaXRzWzBdID09IDEpc2xpY2VbMF0gKj0gIGggLyAxMDA7XG4gICAgaWYob3B0aW9ucy5zbGljZV91bml0c1sxXSA9PSAxKXNsaWNlWzFdICo9ICB3IC8gMTAwO1xuICAgIGlmKG9wdGlvbnMuc2xpY2VfdW5pdHNbMl0gPT0gMSlzbGljZVsyXSAqPSAgaCAvIDEwMDtcbiAgICBpZihvcHRpb25zLnNsaWNlX3VuaXRzWzNdID09IDEpc2xpY2VbM10gKj0gIHcgLyAxMDA7XG5cbiAgICBpZihvcHRpb25zLndpZHRoX3VuaXRzWzBdID09IDEpd2lkdGhbMF0gKj0gaDIgLyAxMDA7XG4gICAgaWYob3B0aW9ucy53aWR0aF91bml0c1sxXSA9PSAxKXdpZHRoWzFdICo9IHcyIC8gMTAwO1xuICAgIGlmKG9wdGlvbnMud2lkdGhfdW5pdHNbMl0gPT0gMSl3aWR0aFsyXSAqPSBoMiAvIDEwMDtcbiAgICBpZihvcHRpb25zLndpZHRoX3VuaXRzWzNdID09IDEpd2lkdGhbM10gKj0gdzIgLyAxMDA7XG5cblxuICAgIGZ1bmN0aW9uIGRyYXdTaWRlKHNpZGUsc2xpY2VPZmZzZXQsc2xpY2VXaWR0aCwgZHJhd09mZnNldCxkcmF3V2lkdGgpe1xuICAgICAgdmFyIGQ7XG4gICAgICBpZihzaWRlID09IDApIHtcbiAgICAgICAgZCA9IFtzbGljZVszXSArIHNsaWNlT2Zmc2V0LCAwLCBzbGljZVdpZHRoLCAgc2xpY2VbMF0sXG4gICAgICAgICAgd2lkdGhbM10gKyBkcmF3T2Zmc2V0LCAwLCBkcmF3V2lkdGgsICB3aWR0aFswXV1cbiAgICAgIH1cbiAgICAgIGlmKHNpZGUgPT0gMil7XG4gICAgICAgIGQgPSBbc2xpY2VbM10gKyBzbGljZU9mZnNldCwgaCAtIHNsaWNlWzJdICxzbGljZVdpZHRoLCAgc2xpY2VbMl0sXG4gICAgICAgICAgd2lkdGhbM10gKyBkcmF3T2Zmc2V0LCBoMiAtIHdpZHRoWzJdLGRyYXdXaWR0aCwgd2lkdGhbMl1dXG4gICAgICB9XG4gICAgICBpZihzaWRlID09IDEpIHtcbiAgICAgICAgZCA9IFsgdyAtIHNsaWNlWzFdLCBzbGljZVswXSArIHNsaWNlT2Zmc2V0LCAgc2xpY2VbMV0sIHNsaWNlV2lkdGgsXG4gICAgICAgICAgdzIgLSB3aWR0aFsxXSwgd2lkdGhbMF0gKyBkcmF3T2Zmc2V0LHdpZHRoWzFdLCBkcmF3V2lkdGhdO1xuICAgICAgfVxuICAgICAgaWYoc2lkZSA9PSAzKSB7XG4gICAgICAgIGQgPSBbIDAsIHNsaWNlWzBdICsgc2xpY2VPZmZzZXQsICBzbGljZVszXSwgc2xpY2VXaWR0aCxcbiAgICAgICAgICAwLCB3aWR0aFswXSArIGRyYXdPZmZzZXQsIHdpZHRoWzNdLGRyYXdXaWR0aF07XG4gICAgICB9XG4gICAgICBjdHguZHJhd0ltYWdlKGltZyxkWzBdLGRbMV0sZFsyXSxkWzNdLGRbNF0sZFs1XSxkWzZdLGRbN10pXG4gICAgfVxuXG5cbiAgICBmdW5jdGlvbiBfZHJhd19ib3JkZXJfc2lkZShzaWRlKXtcbiAgICAgIHZhciBfdG9wX3dpZHRoLCBfdG9wX3NsaWNlLCByZXBlYXQ7XG4gICAgICBpZihzaWRlID09IDAgfHwgc2lkZSA9PSAyKXtcbiAgICAgICAgX3RvcF93aWR0aCA9IHcyIC0gd2lkdGhbMV0tIHdpZHRoWzNdO1xuICAgICAgICBfdG9wX3NsaWNlICA9ICB3IC0gc2xpY2VbMV0gLSBzbGljZVszXTtcbiAgICAgICAgcmVwZWF0ID0gb3B0aW9ucy5yZXBlYXRbMF07XG4gICAgICB9ZWxzZXtcbiAgICAgICAgX3RvcF93aWR0aCA9IGgyIC0gd2lkdGhbMF0tIHdpZHRoWzJdO1xuICAgICAgICBfdG9wX3NsaWNlICA9ICBoIC0gc2xpY2VbMF0gLSBzbGljZVsyXTtcbiAgICAgICAgcmVwZWF0ID0gb3B0aW9ucy5yZXBlYXRbMV07XG4gICAgICB9XG5cblxuICAgICAgaWYocmVwZWF0ID09IFwic3RyZXRjaFwiKXtcbiAgICAgICAgcmV0dXJuIGRyYXdTaWRlKHNpZGUsIDAsICBfdG9wX3NsaWNlICwgIDAsICAgICBfdG9wX3dpZHRoKTtcbiAgICAgIH1cblxuICAgICAgdmFyIF9hc3BlY3QgPSAgIHNsaWNlW3NpZGVdIC8gd2lkdGhbc2lkZV07XG4gICAgICB2YXIgX29uZV93aWR0aCA9ICBfdG9wX3NsaWNlICogIHdpZHRoW3NpZGVdIC8gc2xpY2Vbc2lkZV0gO1xuICAgICAgdmFyIGNvdW50ID0gMTtcbiAgICAgIHZhciBfbGVmdCA9IDA7XG5cbiAgICAgIGlmKHJlcGVhdCA9PSBcInJlcGVhdFwiKXtcblxuICAgICAgICB2YXIgX3Jlc3QgPSBfb25lX3dpZHRoIC0gX3RvcF93aWR0aCAlIF9vbmVfd2lkdGggLyAyO1xuICAgICAgICB2YXIgX3Jlc3RfYXNwZWN0ICA9IF9hc3BlY3QgKiBfcmVzdDtcbiAgICAgICAgY291bnQgPSAgTWF0aC5mbG9vcihfdG9wX3dpZHRoIC8gX29uZV93aWR0aCk7XG5cblxuICAgICAgICBpZihfcmVzdCA+IDApe1xuICAgICAgICAgIGRyYXdTaWRlKHNpZGUsIF9yZXN0X2FzcGVjdCAsICBfdG9wX3NsaWNlIC0gX3Jlc3RfYXNwZWN0LCAgMCwgICAgIF9vbmVfd2lkdGggLSBfcmVzdClcbiAgICAgICAgfVxuXG4gICAgICAgIF9sZWZ0ID0gIF9vbmVfd2lkdGggLSBfcmVzdDtcblxuICAgICAgICBmb3IodmFyIGkgPSAwIDsgaTwgY291bnQ7aSArKyl7XG4gICAgICAgICAgZHJhd1NpZGUoIHNpZGUsMCwgICBfdG9wX3NsaWNlICwgIF9sZWZ0LCAgICAgX29uZV93aWR0aCk7XG4gICAgICAgICAgX2xlZnQgKz1fb25lX3dpZHRoO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYoX3Jlc3QgPiAwKXtcbiAgICAgICAgICBkcmF3U2lkZShzaWRlLCAgMCAsICAgIF90b3Bfc2xpY2UgLSBfcmVzdF9hc3BlY3QsICBfbGVmdCwgICAgX29uZV93aWR0aCAtIF9yZXN0ICk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmKHJlcGVhdCA9PSBcInJvdW5kXCIpe1xuXG4gICAgICAgIF9sZWZ0ID0gMDtcbiAgICAgICAgY291bnQgPSAgTWF0aC5tYXgoMSxNYXRoLnJvdW5kKF90b3Bfd2lkdGggLyBfb25lX3dpZHRoKSk7XG4gICAgICAgIF9vbmVfd2lkdGggPSBfdG9wX3dpZHRoIC8gY291bnQ7XG5cbiAgICAgICAgd2hpbGUoX2xlZnQgPCBfdG9wX3dpZHRoKXtcbiAgICAgICAgICBkcmF3U2lkZShzaWRlLDAsICAgICBfdG9wX3NsaWNlICwgIF9sZWZ0LCAgICAgX29uZV93aWR0aCApO1xuICAgICAgICAgIF9sZWZ0ICs9X29uZV93aWR0aDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIF9kcmF3X2JvcmRlcl9zaWRlKDApO1xuICAgIF9kcmF3X2JvcmRlcl9zaWRlKDIpO1xuICAgIF9kcmF3X2JvcmRlcl9zaWRlKDEpO1xuICAgIF9kcmF3X2JvcmRlcl9zaWRlKDMpO1xuXG4gIC8vdG9wIGxlZnRcbiAgICBjdHguZHJhd0ltYWdlKGltZywgMCwgMCwgc2xpY2VbM10sIHNsaWNlWzBdLCAwLCAwLCB3aWR0aFszXSwgd2lkdGhbMF0pO1xuICAvL3RvcCByaWdodFxuICAgIGN0eC5kcmF3SW1hZ2UoaW1nLCB3IC0gc2xpY2VbMV0sIDAsIHNsaWNlWzFdLCBzbGljZVswXSxcbiAgICAgIHcyIC0gd2lkdGhbMV0sIDAsIHdpZHRoWzFdLCB3aWR0aFswXSk7XG4gIC8vYm90dG9tIGxlZnRcbiAgICBjdHguZHJhd0ltYWdlKGltZywgMCwgaCAtIHNsaWNlWzJdLCBzbGljZVszXSwgc2xpY2VbMl0sXG4gICAgICAwLCBoMiAtIHdpZHRoWzJdLCB3aWR0aFszXSwgd2lkdGhbMl0pO1xuXG4gIC8vYm90dG9tIHJpZ2h0XG4gICAgY3R4LmRyYXdJbWFnZShpbWcsIHcgLSBzbGljZVsxXSwgaCAtIHNsaWNlWzJdLCBzbGljZVsxXSwgc2xpY2VbMl0sXG4gICAgICB3MiAtIHdpZHRoWzFdLCBoMiAtIHdpZHRoWzJdLCB3aWR0aFsxXSwgd2lkdGhbMl0pO1xuXG4gIH1cblxuICAvKlxuICAgdmFyIEZyYW1lID0gZnVuY3Rpb24ocHJvamVjdCxkYXRhKXtcblxuICAgaWYoZGF0YS5ib3JkZXJfaW1hZ2Upe1xuICAgZGF0YS5ib3JkZXJfaW1hZ2UgPSBtaXhpbigge1xuICAgXCJzbGljZVwiOiAgICAgICAgICBbMjUsMjUsMjUsMjVdLFxuICAgXCJ3aWR0aFwiOiAgICAgICAgICBbMjUsMjUsMjUsMjVdLFxuICAgXCJmaWxsXCI6ICAgICAgICAgICBmYWxzZSxcbiAgIFwicmVwZWF0XCI6ICAgICAgICAgW1wicm91bmRcIixcInJvdW5kXCJdLFxuICAgXCJvdXRzZXRcIlx0OiAgICAgWzAsIDAsIDAsIDBdLFxuICAgXCJzbGljZV91bml0c1wiICAgOiBbMCwgMCwgMCwgMF0sXG4gICBcIndpZHRoX3VuaXRzXCJcdDogWzAsIDAsIDAsIDBdLFxuICAgXCJvdXRzZXRfdW5pdHNcIlx0OiBbMCwgMCwgMCwgMF1cbiAgIH0sIGRhdGEuYm9yZGVyX2ltYWdlKVxuICAgfVxuXG5cbiAgIHRoaXMuc3VwZXJjbGFzcy5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMscHJvamVjdCxkYXRhKTtcbiAgIHRoaXMuX2FkZF9yb290KFwibWFza1wiKTtcbiAgIHRoaXMuX2FkZF9yb290KFwiaW1hZ2VcIik7XG4gICB0aGlzLmV4YW1wbGUgPSB0aGlzLl9nZXRfZXhhbXBsZSgpO1xuXG4gICB9OyovXG4gIGZhYnJpYy51dGlsLmdldE9mZnNldHNDbGlwUGF0aCA9IGZ1bmN0aW9uKG8pIHtcblxuICAgIHJldHVybiBbJ00nLCBvWzNdLCBvWzBdLCAnTCcsIDEwMCAtIG9bMV0sIG9bMF0sICdMJywgMTAwIC0gb1sxXSwgMTAwIC0gb1syXSwgJ0wnLCBvWzNdLCAxMDAgLSBvWzJdLCAneiddLmpvaW4oXCIgXCIpO1xuICB9O1xuXG4gIGZhYnJpYy51dGlsLmdldFJhZGl1c0NsaXBQYXRoID0gZnVuY3Rpb24ocmFkaXVzLHJhZGl1c191bml0cywgd2lkdGgsaGVpZ2h0KSB7XG5cbiAgdmFyIGJyICA9IHJhZGl1cztcbiAgdmFyIGJydSA9IHJhZGl1c191bml0cyB8fCBbMSwxLDEsMSwxLDEsMSwxXTtcblxuXG5cbiAgdmFyIHMgPSB7XG4gICAgXCJ0b3AtbGVmdC1oXCI6ICAgICBiclswXSAqIChicnVbMF0gPyBoZWlnaHQgLyAxMDAgOiAxKSxcbiAgICBcInRvcC1sZWZ0LXdcIjogICAgIGJyWzFdICogKGJydVsxXSA/IHdpZHRoIC8gMTAwIDogMSksXG4gICAgXCJ0b3AtcmlnaHQtaFwiOiAgICBiclsyXSAqIChicnVbMl0gPyBoZWlnaHQgLyAxMDAgOiAxKSxcbiAgICBcInRvcC1yaWdodC13XCI6ICAgIGJyWzNdICogKGJydVszXSA/IHdpZHRoIC8gMTAwIDogMSksXG4gICAgXCJib3R0b20tcmlnaHQtd1wiOiBicls0XSAqIChicnVbNF0gPyB3aWR0aCAvIDEwMCA6IDEpLFxuICAgIFwiYm90dG9tLXJpZ2h0LWhcIjogYnJbNV0gKiAoYnJ1WzVdID8gaGVpZ2h0IC8gMTAwIDogMSksXG4gICAgXCJib3R0b20tbGVmdC13XCI6ICBicls2XSAqIChicnVbNl0gPyB3aWR0aCAvIDEwMCA6IDEpLFxuICAgIFwiYm90dG9tLWxlZnQtaFwiOiAgYnJbN10gKiAoYnJ1WzddID8gaGVpZ2h0IC8gMTAwIDogMSlcbiAgfTtcblxuICByZXR1cm4gW1xuICAgIFwiTVwiLCAwLCBzW1widG9wLWxlZnQtaFwiXSxcbiAgICBcIkNcIiwgMCwgc1tcInRvcC1sZWZ0LWhcIl0sIDAsIDAsIHNbXCJ0b3AtbGVmdC13XCJdLCAwLFxuICAgIFwiSFwiLCB3aWR0aCAtIHNbXCJ0b3AtcmlnaHQtd1wiXSxcbiAgICBcIkNcIiwgd2lkdGggLSBzW1widG9wLXJpZ2h0LXdcIl0sIDAsIHdpZHRoLCAwLCB3aWR0aCwgc1tcInRvcC1yaWdodC1oXCJdLFxuICAgIFwiVlwiLCBoZWlnaHQgLSBzW1wiYm90dG9tLXJpZ2h0LWhcIl0sXG4gICAgXCJDXCIsIHdpZHRoLCBoZWlnaHQgLSBzW1wiYm90dG9tLXJpZ2h0LWhcIl0sIHdpZHRoLCBoZWlnaHQsIHdpZHRoIC0gc1tcImJvdHRvbS1yaWdodC13XCJdLCBoZWlnaHQsXG4gICAgXCJIXCIsIHNbXCJib3R0b20tbGVmdC13XCJdLFxuICAgIFwiQ1wiLCBzW1wiYm90dG9tLWxlZnQtd1wiXSwgaGVpZ2h0LCAwLCBoZWlnaHQsIDAsIGhlaWdodCAtIHNbXCJib3R0b20tbGVmdC1oXCJdLFxuICAgIFwiWlwiXG4gIF0uam9pbihcIiBcIik7XG59O1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9tb2R1bGVzL2JvcmRlckltYWdlLmpzIiwiXG5pZih0eXBlb2Ygc2F2ZUFzID09IFwidW5kZWZpbmVkXCIpe1xuICBmYWJyaWMuc2F2ZUFzICA9IHJlcXVpcmUoXCIuLy4uLy4uL3BsdWdpbnMvc2F2ZUFzLmpzXCIpLnNhdmVBcztcbn1lbHNle1xuICBmYWJyaWMuc2F2ZUFzID0gc2F2ZUFzO1xufVxuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUsIHtcbiAgaW5zZXJ0UmVuZGVyQXJlYTogZmFsc2UsXG4gIGluc2VydFJlbmRlckZ1bGw6IGZhbHNlLFxufSk7XG5cblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuU2xpZGVDYW52YXMucHJvdG90eXBlLmFjdGlvbnMsIHtcbiAgcmVuZGVyQXJlYToge1xuICAgIGNsYXNzTmFtZTogJ2ZhIGZhLWRvd25sb2FkJyxcbiAgICB0aXRsZTogJ2Rvd25sb2FkJyxcbiAgICBhY3Rpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgIGZhYnJpYy5zYXZlQXModGhpcy5nZXRJbWFnZURhdGEoe1xuICAgICAgICBjbGlwcGVkX2FyZWE6IHRoaXMuYWN0aXZlQXJlYSxcbiAgICAgICAgem9vbTogdGhpcy5kb3RzUGVyVW5pdCxcbiAgICAgICAgY2xpcHBlZF9hcmVhX29ubHk6IHRydWUsXG4gICAgICAgIGRyYXdfYmFja2dyb3VuZDogdHJ1ZVxuICAgICAgfSkuYmxvYiwgdGhpcy50aXRsZSk7XG4gICAgfVxuICB9LFxuICByZW5kZXJGdWxsOiB7XG4gICAgdGl0bGU6ICdkb3dubG9hZCB3aXRoIGJhY2tncm91bmQnLFxuICAgIGFjdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgZmFicmljLnNhdmVBcyh0aGlzLmdldEltYWdlRGF0YSh7XG4gICAgICAgIHpvb206IHRoaXMuZG90c1BlclVuaXQsXG4gICAgICAgIGNsaXBwZWRfYXJlYV9vbmx5OiBmYWxzZSxcbiAgICAgICAgZHJhd19iYWNrZ3JvdW5kOiB0cnVlXG4gICAgICB9KS5ibG9iLCB0aGlzLnRpdGxlKTtcbiAgICB9XG4gIH1cbn0pO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9tb2R1bGVzL3NhdmVBcy5qcyIsIi8qIEZpbGVTYXZlci5qc1xuICogQSBzYXZlQXMoKSBGaWxlU2F2ZXIgaW1wbGVtZW50YXRpb24uXG4gKiAxLjEuMjAxNTA3MTZcbiAqXG4gKiBCeSBFbGkgR3JleSwgaHR0cDovL2VsaWdyZXkuY29tXG4gKiBMaWNlbnNlOiBYMTEvTUlUXG4gKiAgIFNlZSBodHRwczovL2dpdGh1Yi5jb20vZWxpZ3JleS9GaWxlU2F2ZXIuanMvYmxvYi9tYXN0ZXIvTElDRU5TRS5tZFxuICovXG5cbi8qZ2xvYmFsIHNlbGYgKi9cbi8qanNsaW50IGJpdHdpc2U6IHRydWUsIGluZGVudDogNCwgbGF4YnJlYWs6IHRydWUsIGxheGNvbW1hOiB0cnVlLCBzbWFydHRhYnM6IHRydWUsIHBsdXNwbHVzOiB0cnVlICovXG5cbi8qISBAc291cmNlIGh0dHA6Ly9wdXJsLmVsaWdyZXkuY29tL2dpdGh1Yi9GaWxlU2F2ZXIuanMvYmxvYi9tYXN0ZXIvRmlsZVNhdmVyLmpzICovXG5cblxuXG52YXIgaXNMaWtlbHlOb2RlID0gdHlwZW9mIEJ1ZmZlciAhPT0gJ3VuZGVmaW5lZCcgJiYgdHlwZW9mIHdpbmRvdyA9PT0gJ3VuZGVmaW5lZCc7XG5cblxuXG52YXIgc2F2ZUFzID0gIWlzTGlrZWx5Tm9kZSAmJiAgKGZ1bmN0aW9uKHZpZXcpIHtcbiAgICAgICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgICAgIC8vIElFIDwxMCBpcyBleHBsaWNpdGx5IHVuc3VwcG9ydGVkXG4gICAgICAgIGlmICh0eXBlb2YgbmF2aWdhdG9yICE9PSBcInVuZGVmaW5lZFwiICYmIC9NU0lFIFsxLTldXFwuLy50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdmFyXG4gICAgICAgICAgICBkb2MgPSB2aWV3LmRvY3VtZW50XG4gICAgICAgIC8vIG9ubHkgZ2V0IFVSTCB3aGVuIG5lY2Vzc2FyeSBpbiBjYXNlIEJsb2IuanMgaGFzbid0IG92ZXJyaWRkZW4gaXQgeWV0XG4gICAgICAgICAgICAsIGdldF9VUkwgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdmlldy5VUkwgfHwgdmlldy53ZWJraXRVUkwgfHwgdmlldztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICwgc2F2ZV9saW5rID0gZG9jLmNyZWF0ZUVsZW1lbnROUyhcImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWxcIiwgXCJhXCIpXG4gICAgICAgICAgICAsIGNhbl91c2Vfc2F2ZV9saW5rID0gXCJkb3dubG9hZFwiIGluIHNhdmVfbGlua1xuICAgICAgICAgICAgLCBjbGljayA9IGZ1bmN0aW9uKG5vZGUpIHtcbiAgICAgICAgICAgICAgICB2YXIgZXZlbnQgPSBuZXcgTW91c2VFdmVudChcImNsaWNrXCIpO1xuICAgICAgICAgICAgICAgIG5vZGUuZGlzcGF0Y2hFdmVudChldmVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAsIHdlYmtpdF9yZXFfZnMgPSB2aWV3LndlYmtpdFJlcXVlc3RGaWxlU3lzdGVtXG4gICAgICAgICAgICAsIHJlcV9mcyA9IHZpZXcucmVxdWVzdEZpbGVTeXN0ZW0gfHwgd2Via2l0X3JlcV9mcyB8fCB2aWV3Lm1velJlcXVlc3RGaWxlU3lzdGVtXG4gICAgICAgICAgICAsIHRocm93X291dHNpZGUgPSBmdW5jdGlvbihleCkge1xuICAgICAgICAgICAgICAgICh2aWV3LnNldEltbWVkaWF0ZSB8fCB2aWV3LnNldFRpbWVvdXQpKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBleDtcbiAgICAgICAgICAgICAgICB9LCAwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICwgZm9yY2Vfc2F2ZWFibGVfdHlwZSA9IFwiYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtXCJcbiAgICAgICAgICAgICwgZnNfbWluX3NpemUgPSAwXG4gICAgICAgIC8vIFNlZSBodHRwczovL2NvZGUuZ29vZ2xlLmNvbS9wL2Nocm9taXVtL2lzc3Vlcy9kZXRhaWw/aWQ9Mzc1Mjk3I2M3IGFuZFxuICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vZWxpZ3JleS9GaWxlU2F2ZXIuanMvY29tbWl0LzQ4NTkzMGEjY29tbWl0Y29tbWVudC04NzY4MDQ3XG4gICAgICAgIC8vIGZvciB0aGUgcmVhc29uaW5nIGJlaGluZCB0aGUgdGltZW91dCBhbmQgcmV2b2NhdGlvbiBmbG93XG4gICAgICAgICAgICAsIGFyYml0cmFyeV9yZXZva2VfdGltZW91dCA9IDUwMCAvLyBpbiBtc1xuICAgICAgICAgICAgLCByZXZva2UgPSBmdW5jdGlvbihmaWxlKSB7XG4gICAgICAgICAgICAgICAgdmFyIHJldm9rZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBmaWxlID09PSBcInN0cmluZ1wiKSB7IC8vIGZpbGUgaXMgYW4gb2JqZWN0IFVSTFxuICAgICAgICAgICAgICAgICAgICAgICAgZ2V0X1VSTCgpLnJldm9rZU9iamVjdFVSTChmaWxlKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsgLy8gZmlsZSBpcyBhIEZpbGVcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGlmICh2aWV3LmNocm9tZSkge1xuICAgICAgICAgICAgICAgICAgICByZXZva2VyKCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChyZXZva2VyLCBhcmJpdHJhcnlfcmV2b2tlX3RpbWVvdXQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICwgZGlzcGF0Y2ggPSBmdW5jdGlvbihmaWxlc2F2ZXIsIGV2ZW50X3R5cGVzLCBldmVudCkge1xuICAgICAgICAgICAgICAgIGV2ZW50X3R5cGVzID0gW10uY29uY2F0KGV2ZW50X3R5cGVzKTtcbiAgICAgICAgICAgICAgICB2YXIgaSA9IGV2ZW50X3R5cGVzLmxlbmd0aDtcbiAgICAgICAgICAgICAgICB3aGlsZSAoaS0tKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBsaXN0ZW5lciA9IGZpbGVzYXZlcltcIm9uXCIgKyBldmVudF90eXBlc1tpXV07XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgbGlzdGVuZXIgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaXN0ZW5lci5jYWxsKGZpbGVzYXZlciwgZXZlbnQgfHwgZmlsZXNhdmVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGV4KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3dfb3V0c2lkZShleCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAsIGF1dG9fYm9tID0gZnVuY3Rpb24oYmxvYikge1xuICAgICAgICAgICAgICAgIC8vIHByZXBlbmQgQk9NIGZvciBVVEYtOCBYTUwgYW5kIHRleHQvKiB0eXBlcyAoaW5jbHVkaW5nIEhUTUwpXG4gICAgICAgICAgICAgICAgaWYgKC9eXFxzKig/OnRleHRcXC9cXFMqfGFwcGxpY2F0aW9uXFwveG1sfFxcUypcXC9cXFMqXFwreG1sKVxccyo7LipjaGFyc2V0XFxzKj1cXHMqdXRmLTgvaS50ZXN0KGJsb2IudHlwZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBCbG9iKFtcIlxcdWZlZmZcIiwgYmxvYl0sIHt0eXBlOiBibG9iLnR5cGV9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIGJsb2I7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAsIEZpbGVTYXZlciA9IGZ1bmN0aW9uKGJsb2IsIG5hbWUsIG5vX2F1dG9fYm9tKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFub19hdXRvX2JvbSkge1xuICAgICAgICAgICAgICAgICAgICBibG9iID0gYXV0b19ib20oYmxvYik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIEZpcnN0IHRyeSBhLmRvd25sb2FkLCB0aGVuIHdlYiBmaWxlc3lzdGVtLCB0aGVuIG9iamVjdCBVUkxzXG4gICAgICAgICAgICAgICAgdmFyXG4gICAgICAgICAgICAgICAgICAgIGZpbGVzYXZlciA9IHRoaXNcbiAgICAgICAgICAgICAgICAgICAgLCB0eXBlID0gYmxvYi50eXBlXG4gICAgICAgICAgICAgICAgICAgICwgYmxvYl9jaGFuZ2VkID0gZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgLCBvYmplY3RfdXJsXG4gICAgICAgICAgICAgICAgICAgICwgdGFyZ2V0X3ZpZXdcbiAgICAgICAgICAgICAgICAgICAgLCBkaXNwYXRjaF9hbGwgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BhdGNoKGZpbGVzYXZlciwgXCJ3cml0ZXN0YXJ0IHByb2dyZXNzIHdyaXRlIHdyaXRlZW5kXCIuc3BsaXQoXCIgXCIpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIG9uIGFueSBmaWxlc3lzIGVycm9ycyByZXZlcnQgdG8gc2F2aW5nIHdpdGggb2JqZWN0IFVSTHNcbiAgICAgICAgICAgICAgICAgICAgLCBmc19lcnJvciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gZG9uJ3QgY3JlYXRlIG1vcmUgb2JqZWN0IFVSTHMgdGhhbiBuZWVkZWRcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChibG9iX2NoYW5nZWQgfHwgIW9iamVjdF91cmwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmplY3RfdXJsID0gZ2V0X1VSTCgpLmNyZWF0ZU9iamVjdFVSTChibG9iKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0YXJnZXRfdmlldykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldF92aWV3LmxvY2F0aW9uLmhyZWYgPSBvYmplY3RfdXJsO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbmV3X3RhYiA9IHZpZXcub3BlbihvYmplY3RfdXJsLCBcIl9ibGFua1wiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobmV3X3RhYiA9PSB1bmRlZmluZWQgJiYgdHlwZW9mIHNhZmFyaSAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL0FwcGxlIGRvIG5vdCBhbGxvdyB3aW5kb3cub3Blbiwgc2VlIGh0dHA6Ly9iaXQubHkvMWtaZmZSSVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2aWV3LmxvY2F0aW9uLmhyZWYgPSBvYmplY3RfdXJsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsZXNhdmVyLnJlYWR5U3RhdGUgPSBmaWxlc2F2ZXIuRE9ORTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BhdGNoX2FsbCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV2b2tlKG9iamVjdF91cmwpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICwgYWJvcnRhYmxlID0gZnVuY3Rpb24oZnVuYykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmaWxlc2F2ZXIucmVhZHlTdGF0ZSAhPT0gZmlsZXNhdmVyLkRPTkUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZ1bmMuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICwgY3JlYXRlX2lmX25vdF9mb3VuZCA9IHtjcmVhdGU6IHRydWUsIGV4Y2x1c2l2ZTogZmFsc2V9XG4gICAgICAgICAgICAgICAgICAgICwgc2xpY2VcbiAgICAgICAgICAgICAgICAgICAgO1xuICAgICAgICAgICAgICAgIGZpbGVzYXZlci5yZWFkeVN0YXRlID0gZmlsZXNhdmVyLklOSVQ7XG4gICAgICAgICAgICAgICAgaWYgKCFuYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgIG5hbWUgPSBcImRvd25sb2FkXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChjYW5fdXNlX3NhdmVfbGluaykge1xuICAgICAgICAgICAgICAgICAgICBvYmplY3RfdXJsID0gZ2V0X1VSTCgpLmNyZWF0ZU9iamVjdFVSTChibG9iKTtcbiAgICAgICAgICAgICAgICAgICAgc2F2ZV9saW5rLmhyZWYgPSBvYmplY3RfdXJsO1xuICAgICAgICAgICAgICAgICAgICBzYXZlX2xpbmsuZG93bmxvYWQgPSBuYW1lO1xuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2xpY2soc2F2ZV9saW5rKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BhdGNoX2FsbCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV2b2tlKG9iamVjdF91cmwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZmlsZXNhdmVyLnJlYWR5U3RhdGUgPSBmaWxlc2F2ZXIuRE9ORTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gT2JqZWN0IGFuZCB3ZWIgZmlsZXN5c3RlbSBVUkxzIGhhdmUgYSBwcm9ibGVtIHNhdmluZyBpbiBHb29nbGUgQ2hyb21lIHdoZW5cbiAgICAgICAgICAgICAgICAvLyB2aWV3ZWQgaW4gYSB0YWIsIHNvIEkgZm9yY2Ugc2F2ZSB3aXRoIGFwcGxpY2F0aW9uL29jdGV0LXN0cmVhbVxuICAgICAgICAgICAgICAgIC8vIGh0dHA6Ly9jb2RlLmdvb2dsZS5jb20vcC9jaHJvbWl1bS9pc3N1ZXMvZGV0YWlsP2lkPTkxMTU4XG4gICAgICAgICAgICAgICAgLy8gVXBkYXRlOiBHb29nbGUgZXJyYW50bHkgY2xvc2VkIDkxMTU4LCBJIHN1Ym1pdHRlZCBpdCBhZ2FpbjpcbiAgICAgICAgICAgICAgICAvLyBodHRwczovL2NvZGUuZ29vZ2xlLmNvbS9wL2Nocm9taXVtL2lzc3Vlcy9kZXRhaWw/aWQ9Mzg5NjQyXG4gICAgICAgICAgICAgICAgaWYgKHZpZXcuY2hyb21lICYmIHR5cGUgJiYgdHlwZSAhPT0gZm9yY2Vfc2F2ZWFibGVfdHlwZSkge1xuICAgICAgICAgICAgICAgICAgICBzbGljZSA9IGJsb2Iuc2xpY2UgfHwgYmxvYi53ZWJraXRTbGljZTtcbiAgICAgICAgICAgICAgICAgICAgYmxvYiA9IHNsaWNlLmNhbGwoYmxvYiwgMCwgYmxvYi5zaXplLCBmb3JjZV9zYXZlYWJsZV90eXBlKTtcbiAgICAgICAgICAgICAgICAgICAgYmxvYl9jaGFuZ2VkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gU2luY2UgSSBjYW4ndCBiZSBzdXJlIHRoYXQgdGhlIGd1ZXNzZWQgbWVkaWEgdHlwZSB3aWxsIHRyaWdnZXIgYSBkb3dubG9hZFxuICAgICAgICAgICAgICAgIC8vIGluIFdlYktpdCwgSSBhcHBlbmQgLmRvd25sb2FkIHRvIHRoZSBmaWxlbmFtZS5cbiAgICAgICAgICAgICAgICAvLyBodHRwczovL2J1Z3Mud2Via2l0Lm9yZy9zaG93X2J1Zy5jZ2k/aWQ9NjU0NDBcbiAgICAgICAgICAgICAgICBpZiAod2Via2l0X3JlcV9mcyAmJiBuYW1lICE9PSBcImRvd25sb2FkXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZSArPSBcIi5kb3dubG9hZFwiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAodHlwZSA9PT0gZm9yY2Vfc2F2ZWFibGVfdHlwZSB8fCB3ZWJraXRfcmVxX2ZzKSB7XG4gICAgICAgICAgICAgICAgICAgIHRhcmdldF92aWV3ID0gdmlldztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKCFyZXFfZnMpIHtcbiAgICAgICAgICAgICAgICAgICAgZnNfZXJyb3IoKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBmc19taW5fc2l6ZSArPSBibG9iLnNpemU7XG4gICAgICAgICAgICAgICAgcmVxX2ZzKHZpZXcuVEVNUE9SQVJZLCBmc19taW5fc2l6ZSwgYWJvcnRhYmxlKGZ1bmN0aW9uKGZzKSB7XG4gICAgICAgICAgICAgICAgICAgIGZzLnJvb3QuZ2V0RGlyZWN0b3J5KFwic2F2ZWRcIiwgY3JlYXRlX2lmX25vdF9mb3VuZCwgYWJvcnRhYmxlKGZ1bmN0aW9uKGRpcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNhdmUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXIuZ2V0RmlsZShuYW1lLCBjcmVhdGVfaWZfbm90X2ZvdW5kLCBhYm9ydGFibGUoZnVuY3Rpb24oZmlsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlLmNyZWF0ZVdyaXRlcihhYm9ydGFibGUoZnVuY3Rpb24od3JpdGVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXIub253cml0ZWVuZCA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0X3ZpZXcubG9jYXRpb24uaHJlZiA9IGZpbGUudG9VUkwoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlc2F2ZXIucmVhZHlTdGF0ZSA9IGZpbGVzYXZlci5ET05FO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BhdGNoKGZpbGVzYXZlciwgXCJ3cml0ZWVuZFwiLCBldmVudCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV2b2tlKGZpbGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlci5vbmVycm9yID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGVycm9yID0gd3JpdGVyLmVycm9yO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlcnJvci5jb2RlICE9PSBlcnJvci5BQk9SVF9FUlIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnNfZXJyb3IoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ3cml0ZXN0YXJ0IHByb2dyZXNzIHdyaXRlIGFib3J0XCIuc3BsaXQoXCIgXCIpLmZvckVhY2goZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXJbXCJvblwiICsgZXZlbnRdID0gZmlsZXNhdmVyW1wib25cIiArIGV2ZW50XTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVyLndyaXRlKGJsb2IpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZXNhdmVyLmFib3J0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVyLmFib3J0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZXNhdmVyLnJlYWR5U3RhdGUgPSBmaWxlc2F2ZXIuRE9ORTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlc2F2ZXIucmVhZHlTdGF0ZSA9IGZpbGVzYXZlci5XUklUSU5HO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwgZnNfZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBmc19lcnJvcik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgZGlyLmdldEZpbGUobmFtZSwge2NyZWF0ZTogZmFsc2V9LCBhYm9ydGFibGUoZnVuY3Rpb24oZmlsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRlbGV0ZSBmaWxlIGlmIGl0IGFscmVhZHkgZXhpc3RzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYXZlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KSwgYWJvcnRhYmxlKGZ1bmN0aW9uKGV4KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGV4LmNvZGUgPT09IGV4Lk5PVF9GT1VORF9FUlIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2F2ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZzX2Vycm9yKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICAgICAgICB9KSwgZnNfZXJyb3IpO1xuICAgICAgICAgICAgICAgIH0pLCBmc19lcnJvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAsIEZTX3Byb3RvID0gRmlsZVNhdmVyLnByb3RvdHlwZVxuICAgICAgICAgICAgLCBzYXZlQXMgPSBmdW5jdGlvbihibG9iLCBuYW1lLCBub19hdXRvX2JvbSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgRmlsZVNhdmVyKGJsb2IsIG5hbWUsIG5vX2F1dG9fYm9tKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIDtcbiAgICAgICAgLy8gSUUgMTArIChuYXRpdmUgc2F2ZUFzKVxuICAgICAgICBpZiAodHlwZW9mIG5hdmlnYXRvciAhPT0gXCJ1bmRlZmluZWRcIiAmJiBuYXZpZ2F0b3IubXNTYXZlT3JPcGVuQmxvYikge1xuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGJsb2IsIG5hbWUsIG5vX2F1dG9fYm9tKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFub19hdXRvX2JvbSkge1xuICAgICAgICAgICAgICAgICAgICBibG9iID0gYXV0b19ib20oYmxvYik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBuYXZpZ2F0b3IubXNTYXZlT3JPcGVuQmxvYihibG9iLCBuYW1lIHx8IFwiZG93bmxvYWRcIik7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG5cbiAgICAgICAgRlNfcHJvdG8uYWJvcnQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciBmaWxlc2F2ZXIgPSB0aGlzO1xuICAgICAgICAgICAgZmlsZXNhdmVyLnJlYWR5U3RhdGUgPSBmaWxlc2F2ZXIuRE9ORTtcbiAgICAgICAgICAgIGRpc3BhdGNoKGZpbGVzYXZlciwgXCJhYm9ydFwiKTtcbiAgICAgICAgfTtcbiAgICAgICAgRlNfcHJvdG8ucmVhZHlTdGF0ZSA9IEZTX3Byb3RvLklOSVQgPSAwO1xuICAgICAgICBGU19wcm90by5XUklUSU5HID0gMTtcbiAgICAgICAgRlNfcHJvdG8uRE9ORSA9IDI7XG5cbiAgICAgICAgRlNfcHJvdG8uZXJyb3IgPVxuICAgICAgICAgICAgRlNfcHJvdG8ub253cml0ZXN0YXJ0ID1cbiAgICAgICAgICAgICAgICBGU19wcm90by5vbnByb2dyZXNzID1cbiAgICAgICAgICAgICAgICAgICAgRlNfcHJvdG8ub253cml0ZSA9XG4gICAgICAgICAgICAgICAgICAgICAgICBGU19wcm90by5vbmFib3J0ID1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBGU19wcm90by5vbmVycm9yID1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRlNfcHJvdG8ub253cml0ZWVuZCA9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBudWxsO1xuXG4gICAgICAgIHJldHVybiBzYXZlQXM7XG4gICAgfShcbiAgICAgICAgdHlwZW9mIHNlbGYgIT09IFwidW5kZWZpbmVkXCIgJiYgc2VsZlxuICAgICAgICB8fCB0eXBlb2Ygd2luZG93ICE9PSBcInVuZGVmaW5lZFwiICYmIHdpbmRvd1xuICAgICAgICB8fCB0aGlzLmNvbnRlbnRcbiAgICApKTtcbi8vIGBzZWxmYCBpcyB1bmRlZmluZWQgaW4gRmlyZWZveCBmb3IgQW5kcm9pZCBjb250ZW50IHNjcmlwdCBjb250ZXh0XG4vLyB3aGlsZSBgdGhpc2AgaXMgbnNJQ29udGVudEZyYW1lTWVzc2FnZU1hbmFnZXJcbi8vIHdpdGggYW4gYXR0cmlidXRlIGBjb250ZW50YCB0aGF0IGNvcnJlc3BvbmRzIHRvIHRoZSB3aW5kb3dcblxuaWYgKHR5cGVvZiBtb2R1bGUgIT09IFwidW5kZWZpbmVkXCIgJiYgbW9kdWxlLmV4cG9ydHMpIHtcbiAgICBtb2R1bGUuZXhwb3J0cy5zYXZlQXMgPSBzYXZlQXM7XG59IGVsc2UgaWYgKCh0eXBlb2YgZGVmaW5lICE9PSBcInVuZGVmaW5lZFwiICYmIGRlZmluZSAhPT0gbnVsbCkgJiYgKGRlZmluZS5hbWQgIT0gbnVsbCkpIHtcbiAgICBkZWZpbmUoW10sIGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gc2F2ZUFzO1xuICAgIH0pO1xufVxuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHBsdWdpbnMvc2F2ZUFzLmpzIiwibW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbigpIHtcclxuXHR0aHJvdyBuZXcgRXJyb3IoXCJkZWZpbmUgY2Fubm90IGJlIHVzZWQgaW5kaXJlY3RcIik7XHJcbn07XHJcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4uL25vZGVfbW9kdWxlcy93ZWJwYWNrL2J1aWxkaW4vYW1kLWRlZmluZS5qc1xuLy8gbW9kdWxlIGlkID0gNjFcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiLyogZ2xvYmFscyBfX3dlYnBhY2tfYW1kX29wdGlvbnNfXyAqL1xyXG5tb2R1bGUuZXhwb3J0cyA9IF9fd2VicGFja19hbWRfb3B0aW9uc19fO1xyXG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuLi9ub2RlX21vZHVsZXMvd2VicGFjay9idWlsZGluL2FtZC1vcHRpb25zLmpzXG4vLyBtb2R1bGUgaWQgPSA2MlxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCJmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5CYXNlQnJ1c2gucHJvdG90eXBlLCB7XG4gIHVzZURyYXdpbmdDb2xvcjogdHJ1ZSxcbiAgc2V0T3B0aW9uczogZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICBmb3IgKHZhciBwcm9wIGluIG9wdGlvbnMpIHtcbiAgICAgIHRoaXNbcHJvcF0gPSBvcHRpb25zW3Byb3BdO1xuICAgIH1cbiAgfSxcbiAgdHlwZTogXCJiYXNlLWJydXNoXCIsXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uIChjYW52YXMsIG9wdGlvbnMpIHtcbiAgICB0aGlzLmNhbnZhcyA9IGNhbnZhcztcbiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgICBpZih0aGlzLmNhbnZhcy5hcHBsaWNhdGlvbikge1xuICAgICAgdGhpcy5jYW52YXMuYXBwbGljYXRpb24uZmlyZShcImVudGl0eTpjcmVhdGVkXCIsIHt0YXJnZXQ6IHRoaXMsIG9wdGlvbnM6IG9wdGlvbnN9KVxuICAgIH1cbiAgICB0aGlzLnNldE9wdGlvbnMob3B0aW9ucyk7XG4gIH0sXG4gIGNvbnZlcnRDb2xvcjogZnVuY3Rpb24gKGNvbG9yLCB0eXBlKSB7XG4gICAgdHlwZSA9IHR5cGUgfHwgXCJuYW1lXCI7XG4gICAgaWYgKGNvbG9yIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgIGlmICh0eXBlID09IFwic291cmNlXCIpIHtcbiAgICAgICAgcmV0dXJuIGNvbG9yO1xuICAgICAgfVxuICAgICAgY29sb3IgPSBcIiNcIiArIGZhYnJpYy5Db2xvci5mcm9tU291cmNlKGNvbG9yKS50b0hleCgpO1xuICAgIH1cbiAgICBpZiAodHlwZSA9PSBcImhleFwiIHx8IHR5cGUgPT0gXCJzb3VyY2VcIikge1xuICAgICAgaWYgKGZhYnJpYy5Db2xvci5jb2xvck5hbWVNYXBbY29sb3JdKSB7XG4gICAgICAgIGNvbG9yID0gZmFicmljLkNvbG9yLmNvbG9yTmFtZU1hcFtjb2xvcl07XG4gICAgICB9XG4gICAgICBpZiAodHlwZSA9PSBcInNvdXJjZVwiKSB7XG4gICAgICAgIGlmIChjb2xvciA9PSBcInRyYW5zcGFyZW50XCIpIHtcbiAgICAgICAgICByZXR1cm4gWzAsIDAsIDAsIDBdO1xuICAgICAgICB9XG4gICAgICAgIHZhciBfc291cmNlID0gZmFicmljLkNvbG9yLmZyb21IZXgoY29sb3IpLmdldFNvdXJjZSgpXG4gICAgICAgIF9zb3VyY2VbM10gKj0gMjU1O1xuICAgICAgICByZXR1cm4gX3NvdXJjZTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGNvbG9yO1xuICB9LFxuICBnZXRDb2xvcjogZnVuY3Rpb24gKHR5cGUpIHtcbiAgICB2YXIgY29sb3IgPSB0aGlzLnVzZURyYXdpbmdDb2xvciAmJiB0aGlzLmNhbnZhcy5kcmF3aW5nQ29sb3IgfHwgdGhpcy5jb2xvcjtcbiAgICByZXR1cm4gdGhpcy5jb252ZXJ0Q29sb3IoY29sb3IsIHR5cGUpO1xuICB9XG59KTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvYnJ1c2hlcy9CYXNlQnJ1c2guanMiLCJcblxuZmFicmljLlBlbmNpbEJydXNoLnByb3RvdHlwZS5pbml0aWFsaXplID0gZnVuY3Rpb24oY2FudmFzKSB7XG4gIHRoaXMuY2FsbFN1cGVyKCdpbml0aWFsaXplJywgY2FudmFzKTtcbiAgdGhpcy5fcG9pbnRzID0gWyBdO1xufTtcbmZhYnJpYy5QZW5jaWxCcnVzaC5wcm90b3R5cGUudHlwZSA9ICdwZW5jaWwtYnJ1c2gnO1xuXG5mYWJyaWMuUGVuY2lsQnJ1c2gucHJvdG90eXBlLl9yZW5kZXIgPSBmdW5jdGlvbigpIHtcbiAgdmFyIGN0eCAgPSB0aGlzLmNhbnZhcy5jb250ZXh0VG9wLCB2ID0gdGhpcy5jYW52YXMudmlld3BvcnRUcmFuc2Zvcm0sIHAxID0gdGhpcy5fcG9pbnRzWzBdLCBwMiA9IHRoaXMuX3BvaW50c1sxXTtcbiAgY3R4LnNhdmUoKTtcbiAgY3R4LnRyYW5zZm9ybSh2WzBdLCB2WzFdLCB2WzJdLCB2WzNdLCB2WzRdLCB2WzVdKTtcbiAgY3R4LmJlZ2luUGF0aCgpO1xuICBjdHgubGluZVdpZHRoID0gMSAvIHRoaXMuY2FudmFzLnZpZXdwb3J0VHJhbnNmb3JtWzBdO1xuICBpZiAodGhpcy5fcG9pbnRzLmxlbmd0aCA9PT0gMiAmJiBwMS54ID09PSBwMi54ICYmIHAxLnkgPT09IHAyLnkpIHtcbiAgICBwMS54IC09IDAuNSAvIHRoaXMuY2FudmFzLnZpZXdwb3J0VHJhbnNmb3JtWzBdO1xuICAgIHAyLnggKz0gMC41IC8gdGhpcy5jYW52YXMudmlld3BvcnRUcmFuc2Zvcm1bMF07XG4gIH1cbiAgY3R4Lm1vdmVUbyhwMS54LCBwMS55KTtcbiAgZm9yICh2YXIgaSA9IDEsIGxlbiA9IHRoaXMuX3BvaW50cy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgIHZhciBtaWRQb2ludCA9IHAxLm1pZFBvaW50RnJvbShwMik7XG4gICAgY3R4LnF1YWRyYXRpY0N1cnZlVG8ocDEueCwgcDEueSwgbWlkUG9pbnQueCwgbWlkUG9pbnQueSk7XG4gICAgcDEgPSB0aGlzLl9wb2ludHNbaV07XG4gICAgcDIgPSB0aGlzLl9wb2ludHNbaSArIDFdO1xuICB9XG4gIGN0eC5saW5lVG8ocDEueCwgcDEueSk7XG4gIGN0eC5zdHJva2UoKTtcbiAgY3R4LnJlc3RvcmUoKTtcbn07XG5cbmZhYnJpYy5QZW5jaWxCcnVzaC5wcm90b3R5cGUuY3JlYXRlUGF0aCA9IGZ1bmN0aW9uKHBhdGhEYXRhKSB7XG4gIHZhciBwYXRoID0gbmV3IGZhYnJpYy5QYXRoKHBhdGhEYXRhLCB7XG4gICAgc3Ryb2tlOiB0aGlzLmdldENvbG9yKCksXG4gICAgc3Ryb2tlV2lkdGg6IHRoaXMud2lkdGgsXG4gICAgYXBwbGljYXRpb246IHRoaXMuY2FudmFzLmFwcGxpY2F0aW9uXG4gIH0pO1xuICBpZiAodGhpcy5zaGFkb3cpIHtcbiAgICB0aGlzLnNoYWRvdy5hZmZlY3RTdHJva2UgPSB0cnVlO1xuICAgIHBhdGguc2V0U2hhZG93KHRoaXMuc2hhZG93KTtcbiAgfVxuICByZXR1cm4gcGF0aDtcbn07XG5mYWJyaWMuUGVuY2lsQnJ1c2gucHJvdG90eXBlLm1pbkxlbmd0aCA9IDM7XG5cbmZhYnJpYy5QZW5jaWxCcnVzaC5wcm90b3R5cGUuYWNjdXJhY3kgPSAwO1xuZmFicmljLlBlbmNpbEJydXNoLnByb3RvdHlwZS5fZmluYWxpemVBbmRBZGRQYXRoID0gZnVuY3Rpb24oKSB7XG4gIGlmKHRoaXMuX3BvaW50cy5sZW5ndGggPCAyKXJldHVybjtcbiAgdmFyIGN0eCA9IHRoaXMuY2FudmFzLmNvbnRleHRUb3A7XG4gIGN0eC5jbG9zZVBhdGgoKTtcbiAgdGhpcy5jYW52YXMuY2xlYXJDb250ZXh0KHRoaXMuY2FudmFzLmNvbnRleHRUb3ApO1xuICBpZih0aGlzLmFjY3VyYWN5KXtcbiAgICBmb3IodmFyIGkgaW4gdGhpcy5fcG9pbnRzKXtcbiAgICAgIHRoaXMuX3BvaW50c1tpXS54ID0gK3RoaXMuX3BvaW50c1tpXS54LnRvRml4ZWQodGhpcy5hY2N1cmFjeSk7XG4gICAgICB0aGlzLl9wb2ludHNbaV0ueSA9ICt0aGlzLl9wb2ludHNbaV0ueS50b0ZpeGVkKHRoaXMuYWNjdXJhY3kpO1xuICAgIH1cbiAgICBmb3IoaSA9IHRoaXMuX3BvaW50cy5sZW5ndGggLSAxOyBpLS07ICl7XG4gICAgICBpZih0aGlzLl9wb2ludHNbaV0ueCA9PSB0aGlzLl9wb2ludHNbaSArIDFdLnggJiYgIHRoaXMuX3BvaW50c1tpXS55ID09IHRoaXMuX3BvaW50c1tpICsgMV0ueSl7XG4gICAgICAgIHRoaXMuX3BvaW50cy5zcGxpY2UoaSwxKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgaWYodGhpcy5fcG9pbnRzLmxlbmd0aCA8IDIpcmV0dXJuO1xuICB2YXIgcGF0aERhdGEgPSB0aGlzLmNvbnZlcnRQb2ludHNUb1NWR1BhdGgodGhpcy5fcG9pbnRzKS5qb2luKCcnKTtcbiAgaWYgKHRoaXMuX3BvaW50cy5sZW5ndGggPCB0aGlzLm1pbkxlbmd0aCB8fCBwYXRoRGF0YSA9PT0gJ00gMCAwIFEgMCAwIDAgMCBMIDAgMCcpIHtcbiAgICByZXR1cm4gdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gIH1cbiAgdmFyIHBhdGggPSB0aGlzLmNyZWF0ZVBhdGgocGF0aERhdGEpO1xuICB0aGlzLmNhbnZhcy5hZGQocGF0aCk7XG4gIHBhdGguc2V0Q29vcmRzKCk7XG4gIHRoaXMuX3Jlc2V0U2hhZG93KCk7XG4gIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICB0aGlzLmNhbnZhcy5maXJlKCdwYXRoOmNyZWF0ZWQnLCB7IHBhdGg6IHBhdGggfSk7XG59O1xuXG5cbmZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUuZHJhd2luZ1Rvb2xzLlBlbmNpbEJydXNoID0ge1xuICBjbGFzc05hbWU6ICdmYSBmYS1wZW5jaWwnLFxuICB0aXRsZTogJ1BlbmNpbCBCcnVzaCdcbn07XG5mYWJyaWMuU2xpZGVDYW52YXMucHJvdG90eXBlLmFjdGl2ZURyYXdpbmdUb29scy5wdXNoKFwiUGVuY2lsQnJ1c2hcIik7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2JydXNoZXMvUGVuY2lsQnJ1c2guanMiLCIndXNlIHN0cmljdCc7XG5cblxuLyoqXG4gKiBQZW5jaWxCcnVzaCBjbGFzc1xuICogQGNsYXNzIGZhYnJpYy5SZWN0YW5nbGVCcnVzaFxuICogQGV4dGVuZHMgZmFicmljLkJhc2VCcnVzaFxuICovXG5mYWJyaWMuUmVjdGFuZ2xlQnJ1c2ggPSBmYWJyaWMudXRpbC5jcmVhdGVDbGFzcyhmYWJyaWMuQmFzZUJydXNoLCAvKiogQGxlbmRzIGZhYnJpYy5SZWN0YW5nbGVCcnVzaC5wcm90b3R5cGUgKi8ge1xuICByZXN1bHRPYmplY3RUeXBlOiBcIlJlY3RcIixcbiAgdHlwZTogXCJyZWN0YW5nbGUtYnJ1c2hcIixcbiAgLyoqXG4gICAqIENvbnN0cnVjdG9yXG4gICAqIEBwYXJhbSB7ZmFicmljLkNhbnZhc30gY2FudmFzXG4gICAqIEByZXR1cm4ge2ZhYnJpYy5SZWN0YW5nbGVCcnVzaH0gSW5zdGFuY2Ugb2YgYSBwZW5jaWwgYnJ1c2hcbiAgICovXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uIChjYW52YXMpIHtcbiAgICB0aGlzLmNhbGxTdXBlcignaW5pdGlhbGl6ZScsIGNhbnZhcyk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIElub3Zva2VkIG9uIG1vdXNlIGRvd25cbiAgICogQHBhcmFtIHtPYmplY3R9IHBvaW50ZXJcbiAgICovXG4gIG9uTW91c2VEb3duOiBmdW5jdGlvbiAocG9pbnRlcikge1xuICAgIC8vcHJlcGFyZSBmb3IgZHJhd2luZ1xuICAgIGRlbGV0ZSB0aGlzLnAyO1xuXG4gICAgdGhpcy5wMSA9IG5ldyBmYWJyaWMuUG9pbnQocG9pbnRlci54LCBwb2ludGVyLnkpO1xuICAgIHRoaXMuX3NldEJydXNoU3R5bGVzKCk7XG4gICAgdGhpcy5fc2V0U2hhZG93KCk7XG4gICAgdGhpcy5jYW52YXMuY29udGV4dFRvcC5tb3ZlVG8odGhpcy5wMS54LCB0aGlzLnAxLnkpO1xuICAgIHRoaXMuX3JlbmRlcigpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBJbm92b2tlZCBvbiBtb3VzZSBtb3ZlXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBwb2ludGVyXG4gICAqL1xuICBvbk1vdXNlTW92ZTogZnVuY3Rpb24gKHBvaW50ZXIpIHtcblxuICAgIHRoaXMucDIgPSBuZXcgZmFicmljLlBvaW50KHBvaW50ZXIueCwgcG9pbnRlci55KTtcblxuICAgIGlmKHRoaXMuZHJhd2luZ09iamVjdCl7XG4gICAgICB2YXIgX3JlY3QgPSB0aGlzLl9nZXRSZWN0KCk7XG4gICAgICB0aGlzLmRyYXdpbmdPYmplY3Quc2V0KF9yZWN0KTtcbiAgICAgIHRoaXMuZHJhd2luZ09iamVjdC5maXJlKFwic2NhbGluZ1wiKTtcbiAgICB9ZWxzZXtcblxuICAgICAgaWYgKHRoaXMucDEueCA9PT0gdGhpcy5wMi54ICYmIHRoaXMucDEueSA9PT0gdGhpcy5wMi55KSB7XG4gICAgICAgIGRlbGV0ZSB0aGlzLnAyO1xuICAgICAgfSBlbHNlIHtcblxuICAgICAgICBpZih0aGlzLnJlc3VsdE9iamVjdFR5cGUpe1xuICAgICAgICAgIHZhciBfcmVjdCA9IHRoaXMuX2dldFJlY3QoKTtcbiAgICAgICAgICB0aGlzLmRyYXdpbmdPYmplY3QgPSB0aGlzLl9jcmVhdGVSZWN0YW5nbGUoX3JlY3QpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHRoaXMuY2FudmFzLnJlbmRlckxheWVyKFwibG93ZXJcIik7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEludm9rZWQgb24gbW91c2UgdXBcbiAgICovXG4gIG9uTW91c2VVcDogZnVuY3Rpb24gKCkge1xuICAgIGlmKHRoaXMuZHJhd2luZ09iamVjdCl7XG4gICAgICB2YXIgX3JlY3QgPSB0aGlzLl9nZXRSZWN0KCk7XG4gICAgICB2YXIgX3JlY3QyID0gdGhpcy5fY2hlY2tSZWN0YW5nbGUoX3JlY3QpO1xuXG4gICAgICB0aGlzLmNhbnZhcy5sYXllcnMubG93ZXIub2JqZWN0cy5zcGxpY2UodGhpcy5jYW52YXMubGF5ZXJzLmxvd2VyLm9iamVjdHMuaW5kZXhPZih0aGlzLmRyYXdpbmdPYmplY3QpLCAxKTtcblxuICAgICAgdGhpcy5kcmF3aW5nT2JqZWN0LnNldChfcmVjdDIpO1xuICAgICAgdGhpcy5jYW52YXMuYWRkKHRoaXMuZHJhd2luZ09iamVjdCk7XG4gICAgICB0aGlzLmNhbnZhcy5zZXRBY3RpdmVPYmplY3QodGhpcy5kcmF3aW5nT2JqZWN0KTtcbiAgICAgIHRoaXMuZHJhd2luZ09iamVjdC5zZXRDb29yZHMoKTtcbiAgICAgIGRlbGV0ZSB0aGlzLmRyYXdpbmdPYmplY3Q7XG4gICAgfVxuICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgIC8vIHRoaXMuX2ZpbmFsaXplQW5kQWRkUGF0aCgpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBEcmF3IGEgc21vb3RoIHBhdGggb24gdGhlIHRvcENhbnZhcyB1c2luZyBxdWFkcmF0aWNDdXJ2ZVRvXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBfcmVuZGVyOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5jYW52YXMuZmlyZShcImJlZm9yZTpicnVzaDpyZW5kZXJcIix7dGFyZ2V0OiB0aGlzfSlcbiAgICBpZiAoIXRoaXMucDIpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdmFyIGN0eCA9IHRoaXMuY2FudmFzLmNvbnRleHRUb3AsXG4gICAgICB2ID0gdGhpcy5jYW52YXMudmlld3BvcnRUcmFuc2Zvcm0sXG4gICAgICBwMSA9IHRoaXMucDEsXG4gICAgICBwMiA9IHRoaXMucDI7XG5cbiAgICBjdHguc2F2ZSgpO1xuICAgIGN0eC50cmFuc2Zvcm0odlswXSwgdlsxXSwgdlsyXSwgdlszXSwgdls0XSwgdls1XSk7XG4gICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgIGlmKHRoaXMuYXBwbGljYXRpb24pe1xuICAgICAgdmFyIF9rbGFzc19wcm90byA9IHRoaXMuYXBwbGljYXRpb24uZ2V0RGVmYXVsdFByb3BlcnRpZXMoZmFicmljW3RoaXMucmVzdWx0T2JqZWN0VHlwZV0ucHJvdG90eXBlKSB8fCB7fTtcbiAgICAgIGN0eC5saW5lV2lkdGggPSBfa2xhc3NfcHJvdG8uc3Ryb2tlV2lkdGg7XG4gICAgICBjdHguc3Ryb2tlU3R5bGUgPSBfa2xhc3NfcHJvdG8uc3Ryb2tlO1xuICAgICAgY3R4LmZpbGxTdHlsZSA9IF9rbGFzc19wcm90by5maWxsO1xuICAgIH1cblxuICAgIHZhciBfcmVjdCA9IHRoaXMuX2dldFJlY3QoKTtcbiAgICBjdHgucmVjdChfcmVjdC5sZWZ0LCBfcmVjdC50b3AsIF9yZWN0LndpZHRoLCBfcmVjdC5oZWlnaHQpO1xuXG4gICAgY3R4LmZpbGwoKTtcbiAgICBjdHguc3Ryb2tlKCk7XG4gICAgY3R4LnJlc3RvcmUoKTtcbiAgICB0aGlzLmNhbnZhcy5maXJlKFwiYnJ1c2g6cmVuZGVyXCIse3RhcmdldDogdGhpc30pXG4gIH0sXG4gIF9nZXRSZWN0OiBmdW5jdGlvbiAoKSB7XG5cbiAgICB2YXIgeDEsIHgyLCB5MSwgeTI7XG4gICAgaWYgKHRoaXMucDEueCA8IHRoaXMucDIueCkge1xuICAgICAgeDEgPSB0aGlzLnAxLngsIHgyID0gdGhpcy5wMi54O1xuICAgIH0gZWxzZSB7XG4gICAgICB4MiA9IHRoaXMucDEueCwgeDEgPSB0aGlzLnAyLng7XG4gICAgfVxuICAgIGlmICh0aGlzLnAxLnkgPCB0aGlzLnAyLnkpIHtcbiAgICAgIHkxID0gdGhpcy5wMS55LCB5MiA9IHRoaXMucDIueTtcbiAgICB9IGVsc2Uge1xuICAgICAgeTIgPSB0aGlzLnAxLnksIHkxID0gdGhpcy5wMi55O1xuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgbGVmdDogeDEsXG4gICAgICB0b3A6IHkxLFxuICAgICAgd2lkdGg6IHgyIC0geDEsXG4gICAgICBoZWlnaHQ6IHkyIC0geTFcbiAgICB9O1xuICB9LFxuICBkcmF3aW5nTGltaXRzOiBudWxsLCAvKntcbiAgIGxlZnQ6IDAsXG4gICB3aWR0aDogMCxcbiAgIGhlaWdodDogMCxcbiAgIHRvcDogMFxuICAgfSwqL1xuICBtaW5IZWlnaHQ6IDUwLFxuICBtaW5XaWR0aDogNTAsXG4gIF9jaGVja1JlY3RhbmdsZTogZnVuY3Rpb24oX3JlY3Qpe1xuXG5cbiAgICB2YXIgZGwgPSB0aGlzLmRyYXdpbmdMaW1pdHM7XG4gICAgaWYoZGwgJiYgZGwgPT0gXCJiYWNrZ3JvdW5kSW1hZ2VcIil7XG4gICAgICBkbD0gdGhpcy5jYW52YXMuYmFja2dyb3VuZEltYWdlO1xuICAgIH1cblxuICAgIF9yZWN0ID0ge1xuICAgICAgbGVmdDogX3JlY3QubGVmdCxcbiAgICAgIHRvcDogX3JlY3QudG9wLFxuICAgICAgd2lkdGg6IF9yZWN0LndpZHRoLFxuICAgICAgaGVpZ2h0OiBfcmVjdC5oZWlnaHQsXG4gICAgfTtcblxuICAgIC8vIF9yZWN0LmxlZnQgIC09IGZhYnJpYy5SZWN0LnByb3RvdHlwZS5zdHJva2VXaWR0aCAvIDI7XG4gICAgLy8gX3JlY3QudG9wICAgLT0gZmFicmljLlJlY3QucHJvdG90eXBlLnN0cm9rZVdpZHRoIC8gMjtcblxuICAgIGlmKGRsKXtcbiAgICAgIGlmKF9yZWN0LmxlZnQgKyBfcmVjdC53aWR0aCA8IGRsLmxlZnQgfHxcbiAgICAgICAgX3JlY3QudG9wICArIF9yZWN0LmhlaWdodCA8IGRsLnRvcCB8fFxuICAgICAgICBfcmVjdC5sZWZ0ID4gZGwud2lkdGggfHxcbiAgICAgICAgX3JlY3QudG9wID4gZGwuaGVpZ2h0KXtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuXG4gICAgICBpZihfcmVjdC50b3AgPCBkbC50b3Ape1xuICAgICAgICBfcmVjdC5oZWlnaHQgKz1fcmVjdC50b3AgO1xuICAgICAgICBfcmVjdC50b3AgPSBkbC50b3A7XG4gICAgICB9XG4gICAgICBpZihfcmVjdC5sZWZ0IDwgZGwubGVmdCl7XG4gICAgICAgIF9yZWN0LndpZHRoICs9IF9yZWN0LmxlZnQ7XG4gICAgICAgIF9yZWN0LmxlZnQgPSBkbC5sZWZ0O1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmKHRoaXMubWluV2lkdGggJiYgX3JlY3Qud2lkdGggPCB0aGlzLm1pbldpZHRoKXtcbiAgICAgIF9yZWN0LndpZHRoID0gdGhpcy5taW5XaWR0aDtcbiAgICB9XG4gICAgaWYodGhpcy5taW5IZWlnaHQgJiYgX3JlY3QuaGVpZ2h0IDwgdGhpcy5taW5IZWlnaHQpe1xuICAgICAgX3JlY3QuaGVpZ2h0ID0gdGhpcy5taW5IZWlnaHQ7XG4gICAgfVxuXG5cbiAgICBpZihkbCkge1xuICAgICAgdmFyIF94ZGlmZiA9IF9yZWN0LmxlZnQgKyBfcmVjdC53aWR0aCAtIGRsLndpZHRoO1xuICAgICAgaWYgKF94ZGlmZiA+IDApIHtcbiAgICAgICAgX3JlY3Qud2lkdGggLT0gX3hkaWZmO1xuICAgICAgICBpZiAodGhpcy5taW5XaWR0aCAmJiBfcmVjdC53aWR0aCA8IHRoaXMubWluV2lkdGgpIHtcbiAgICAgICAgICBfcmVjdC5sZWZ0IC09IHRoaXMubWluV2lkdGggLSBfcmVjdC53aWR0aDtcbiAgICAgICAgICBfcmVjdC53aWR0aCA9IHRoaXMubWluV2lkdGg7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHZhciBfeWRpZmYgPSBfcmVjdC50b3AgKyBfcmVjdC5oZWlnaHQgLSBkbC5oZWlnaHQ7XG4gICAgICBpZiAoX3lkaWZmID4gMCkge1xuICAgICAgICBfcmVjdC5oZWlnaHQgLT0gX3lkaWZmO1xuICAgICAgICBpZiAodGhpcy5taW5IZWlnaHQgJiYgX3JlY3QuaGVpZ2h0IDwgdGhpcy5taW5IZWlnaHQpIHtcbiAgICAgICAgICBfcmVjdC50b3AgLT0gdGhpcy5taW5IZWlnaHQgLSBfcmVjdC5oZWlnaHQ7XG4gICAgICAgICAgX3JlY3QuaGVpZ2h0ID0gdGhpcy5taW5IZWlnaHQ7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIF9yZWN0O1xuICB9LFxuICBfY3JlYXRlUmVjdGFuZ2xlOiBmdW5jdGlvbihyZWN0KXtcbiAgICB0aGlzLmNhbnZhcy5zZXRBY3RpdmVPYmplY3QoZmFsc2UpO1xuICAgIHJlY3QuYWN0aXZlID0gdHJ1ZTtcbiAgICByZWN0LmFwcGxpY2F0aW9uID0gdGhpcy5hcHBsaWNhdGlvbjtcbiAgICByZWN0LmNhbnZhcyA9IHRoaXMuY2FudmFzO1xuICAgIHZhciBfb2JqZWN0ID0gZmFicmljLnV0aWwuY3JlYXRlT2JqZWN0KHRoaXMucmVzdWx0T2JqZWN0VHlwZSxyZWN0KTtcbiAgICB0aGlzLmNhbnZhcy5sYXllcnMubG93ZXIub2JqZWN0cy5wdXNoKF9vYmplY3QpO1xuICAgIF9vYmplY3QudXBkYXRlUmVzcG9uc2l2ZUJvcmRlcigpO1xuICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgIHJldHVybiBfb2JqZWN0O1xuICB9XG5cbiAgLyoqXG4gICAqIE9uIG1vdXNldXAgYWZ0ZXIgZHJhd2luZyB0aGUgcGF0aCBvbiBjb250ZXh0VG9wIGNhbnZhc1xuICAgKiB3ZSB1c2UgdGhlIHBvaW50cyBjYXB0dXJlZCB0byBjcmVhdGUgYW4gbmV3IGZhYnJpYyByZWN0IG9iamVjdFxuICAgKiBhbmQgYWRkIGl0IHRvIHRoZSBmYWJyaWMgY2FudmFzLlxuICAgKi9cbiAgLy8gX2ZpbmFsaXplQW5kQWRkUGF0aDogZnVuY3Rpb24gKCkge1xuICAvL1xuICAvLyAgIGlmICghdGhpcy5wMikge1xuICAvLyAgICAgcmV0dXJuIGZhbHNlO1xuICAvLyAgIH1cbiAgLy8gICB2YXIgY3R4ID0gdGhpcy5jYW52YXMuY29udGV4dFRvcDtcbiAgLy8gICBjdHguY2xvc2VQYXRoKCk7XG4gIC8vXG4gIC8vXG4gIC8vICAgdGhpcy5jYW52YXMuY2xlYXJDb250ZXh0KHRoaXMuY2FudmFzLmNvbnRleHRUb3ApO1xuICAvLyAgIHRoaXMuX3Jlc2V0U2hhZG93KCk7XG4gIC8vXG4gIC8vICAgLy8gdmFyIF9yZWN0ID0gdGhpcy5fZ2V0UmVjdCgpO1xuICAvLyAgIHZhciBfcmVjdDIgPSB0aGlzLl9jaGVja1JlY3RhbmdsZShfcmVjdCk7XG4gIC8vICAgaWYoX3JlY3QyKXtcbiAgLy8gICAgIC8vIGlmKHRoaXMucmVzdWx0T2JqZWN0VHlwZSl7XG4gIC8vICAgICAvLyAgIHRoaXMuX2NyZWF0ZVJlY3RhbmdsZShfcmVjdDIpO1xuICAvLyAgICAgLy8gfVxuICAvLyAgICAgdGhpcy5jYW52YXMuZmlyZSgncmVjdDpjcmVhdGVkJywge3JlY3Q6IF9yZWN0Miwgb3JpZ2luYWw6IF9yZWN0fSk7XG4gIC8vICAgfWVsc2V7XG4gIC8vICAgICB0aGlzLmNhbnZhcy5maXJlKCdyZWN0OnJlamVjdGVkJywge3JlY3Q6IF9yZWN0fSk7XG4gIC8vICAgfVxuICAvLyAgIHRoaXMuY2FudmFzLnJlbmRlckxheWVyKHRoaXMubGF5ZXJzLmxvd2VyKTtcbiAgLy8gfVxufSk7XG5cblxuZmFicmljLlNsaWRlQ2FudmFzLnByb3RvdHlwZS5kcmF3aW5nVG9vbHMuUmVjdGFuZ2xlQnJ1c2ggPSB7XG4gIGNsYXNzTmFtZTogJ2ZhIGZhLXBlbmNpbC1zcXVhcmUnLFxuICB0aXRsZTogJ3NlbGVjdC1icnVzaCdcbn07XG5mYWJyaWMuU2xpZGVDYW52YXMucHJvdG90eXBlLmFjdGl2ZURyYXdpbmdUb29scy5wdXNoKFwiUmVjdGFuZ2xlQnJ1c2hcIik7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2JydXNoZXMvUmVjdGFuZ2xlQnJ1c2guanMiLCIndXNlIHN0cmljdCc7XG5cblxuICAvKipcbiAgICogUGVuY2lsQnJ1c2ggY2xhc3NcbiAgICogQGNsYXNzIGZhYnJpYy5SZWN0YW5nbGVCcnVzaFxuICAgKiBAZXh0ZW5kcyBmYWJyaWMuQmFzZUJydXNoXG4gICAqL1xuICBmYWJyaWMuUG9seWdvbkJydXNoID0gZmFicmljLnV0aWwuY3JlYXRlQ2xhc3MoZmFicmljLkJhc2VCcnVzaCwgLyoqIEBsZW5kcyBmYWJyaWMuUmVjdGFuZ2xlQnJ1c2gucHJvdG90eXBlICovIHtcbiAgICByZXN1bHRPYmplY3RUeXBlOiBcIlBvbHlsaW5lXCIsXG4gICAgdHlwZTogXCJwb2x5Z29uLWJydXNoXCIsXG4gICAgdmlydHVhbE9iamVjdDogZmFsc2UsXG4gICAgbWF4aW11bVBvaW50cyA6IDAsXG4gICAgaW5kaXZpZHVhbERyYXdpbmc6IHRydWUsXG4gICAgLyoqXG4gICAgICogQ29uc3RydWN0b3JcbiAgICAgKiBAcGFyYW0ge2ZhYnJpYy5DYW52YXN9IGNhbnZhc1xuICAgICAqIEByZXR1cm4ge2ZhYnJpYy5SZWN0YW5nbGVCcnVzaH0gSW5zdGFuY2Ugb2YgYSBwZW5jaWwgYnJ1c2hcbiAgICAgKi9cbiAgICBpbml0aWFsaXplOiBmdW5jdGlvbiAoY2FudmFzKSB7XG4gICAgICB0aGlzLmNhbGxTdXBlcignaW5pdGlhbGl6ZScsIGNhbnZhcyk7XG4gICAgICB0aGlzLnJlc2V0KCk7XG4gICAgfSxcbiAgICAvKipcbiAgICAgKiBJbm92b2tlZCBvbiBtb3VzZSBkb3duXG4gICAgICogQHBhcmFtIHtPYmplY3R9IHBvaW50ZXJcbiAgICAgKi9cbiAgICBvbk1vdXNlRG93bjogZnVuY3Rpb24gKHBvaW50ZXIpIHtcblxuXG4gICAgICBpZih0aGlzLmluZGl2aWR1YWxEcmF3aW5nIHx8ICF0aGlzLnRhcmdldCl7XG4gICAgICAgIHZhciBfcG9pbnQgPSB7eDogcG9pbnRlci54LCB5OiBwb2ludGVyLnl9O1xuICAgICAgICB0aGlzLnBvaW50cy5wdXNoKF9wb2ludCk7XG4gICAgICAgIGlmKCF0aGlzLnZpcnR1YWxPYmplY3Qpe1xuICAgICAgICAgIHRoaXMudGFyZ2V0ID0gdGhpcy5jYW52YXMuY3JlYXRlT2JqZWN0KFxuICAgICAgICAgICAgZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCh7fSxcbiAgICAgICAgICAgICAgdGhpcy5yZXN1bHRPYmplY3RQcm9wZXJ0aWVzLCB7XG4gICAgICAgICAgICAgICAgdHlwZTogdGhpcy5yZXN1bHRPYmplY3RUeXBlLFxuICAgICAgICAgICAgICAgIHBvaW50czogW19wb2ludF0sXG4gICAgICAgICAgICAgICAgYWN0aXZlOiB0cnVlXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIClcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9ZWxzZXtcbiAgICAgICAgdGhpcy5fY3JlYXRlX2FjdGl2ZV9wb2ludChwb2ludGVyKTtcbiAgICAgIH1cblxuICAgICAgaWYodGhpcy52aXJ0dWFsT2JqZWN0KSB7XG4gICAgICAgIHRoaXMuX3NldEJydXNoU3R5bGVzKCk7XG4gICAgICAgIHRoaXMuX3NldFNoYWRvdygpO1xuICAgICAgICB0aGlzLl9yZW5kZXIoKTtcbiAgICAgIH1lbHNle1xuICAgICAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgX2NyZWF0ZV9hY3RpdmVfcG9pbnQ6IGZ1bmN0aW9uIChwb2ludGVyKSB7XG4gICAgICB2YXIgX3BvaW50ID0ge3g6IHBvaW50ZXIueCwgeTogcG9pbnRlci55fTtcbiAgICAgIHRoaXMuYWN0aXZlUG9pbnQgPSAgX3BvaW50O1xuICAgICAgdGhpcy5hY3RpdmVUYXJnZXRQb2ludCA9ICB7eDogcG9pbnRlci54IC0gdGhpcy50YXJnZXQubGVmdCwgeSA6IHBvaW50ZXIueSAtIHRoaXMudGFyZ2V0LnRvcH07XG4gICAgICB0aGlzLnBvaW50cy5wdXNoKHRoaXMuYWN0aXZlUG9pbnQpO1xuICAgICAgdGhpcy50YXJnZXQuYWRkUG9pbnQodGhpcy5hY3RpdmVUYXJnZXRQb2ludCk7XG4gICAgfSxcbiAgICAvKipcbiAgICAgKiBJbm92b2tlZCBvbiBtb3VzZSBtb3ZlXG4gICAgICogQHBhcmFtIHtPYmplY3R9IHBvaW50ZXJcbiAgICAgKi9cbiAgICBvbk1vdXNlTW92ZTogZnVuY3Rpb24gKHBvaW50ZXIpIHtcblxuXG4gICAgICB2YXIgX3AgPSAge3g6IHBvaW50ZXIueCAtIHRoaXMudGFyZ2V0LmxlZnQsIHkgOiBwb2ludGVyLnkgLSB0aGlzLnRhcmdldC50b3B9O1xuXG5cbiAgICAgIGlmKHRoaXMuYWN0aXZlUG9pbnQpe1xuICAgICAgICB0aGlzLmFjdGl2ZVBvaW50LnggPSBwb2ludGVyLng7XG4gICAgICAgIHRoaXMuYWN0aXZlUG9pbnQueSA9IHBvaW50ZXIueTtcbiAgICAgICAgdmFyIF9vcmRlciA9IHRoaXMudGFyZ2V0LnBvaW50cy5sZW5ndGggO1xuXG4gICAgICAgIHRoaXMudGFyZ2V0LnNldFBvaW50KFwicFwiICsgX29yZGVyLCB7XG4gICAgICAgICAgeCA6IHBvaW50ZXIueCAtIHRoaXMudGFyZ2V0LmxlZnQsXG4gICAgICAgICAgeSA6IHBvaW50ZXIueSAtIHRoaXMudGFyZ2V0LnRvcFxuICAgICAgICB9KTtcbiAgICAgIH1lbHNle1xuICAgICAgICB2YXIgX2Rpc3QgPSBmYWJyaWMuUG9pbnQucHJvdG90eXBlLmRpc3RhbmNlRnJvbS5jYWxsKHRoaXMucG9pbnRzWzBdLF9wKVxuICAgICAgICBpZihfZGlzdCA+IDEwKXtcbiAgICAgICAgICB0aGlzLl9jcmVhdGVfYWN0aXZlX3BvaW50KHBvaW50ZXIpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICB9LFxuICAgIHJlc2V0OiBmdW5jdGlvbigpe1xuICAgICAgdGhpcy5wb2ludHMgPSBbXTtcbiAgICAgIHRoaXMudGFyZ2V0ID0gbnVsbDtcbiAgICAgIHRoaXMuYWN0aXZlUG9pbnQgPSBudWxsO1xuICAgICAgdGhpcy5hY3RpdmVUYXJnZXRQb2ludCA9IG51bGw7XG4gICAgfSxcbiAgICAvKipcbiAgICAgKiBJbnZva2VkIG9uIG1vdXNlIHVwXG4gICAgICovXG4gICAgb25Nb3VzZVVwOiBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLnRhcmdldC51cGRhdGVCYm94KCk7XG4gICAgICBpZih0aGlzLnBvaW50cy5sZW5ndGggPT0gdGhpcy5tYXhpbXVtUG9pbnRzKXtcbiAgICAgICAgdGhpcy5yZXNldCgpO1xuICAgICAgfVxuICAgICAgdGhpcy5hY3RpdmVQb2ludCA9IG51bGw7XG4gICAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogRHJhdyBhIHNtb290aCBwYXRoIG9uIHRoZSB0b3BDYW52YXMgdXNpbmcgcXVhZHJhdGljQ3VydmVUb1xuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX3JlbmRlcjogZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5jYW52YXMuZmlyZShcImJlZm9yZTpicnVzaDpyZW5kZXJcIix7dGFyZ2V0OiB0aGlzfSk7XG5cbiAgICAgIHZhciBjdHggPSB0aGlzLmNhbnZhcy5jb250ZXh0VG9wLFxuICAgICAgICB2ID0gdGhpcy5jYW52YXMudmlld3BvcnRUcmFuc2Zvcm07XG5cbiAgICAgIGN0eC5zYXZlKCk7XG4gICAgICBjdHgudHJhbnNmb3JtKHZbMF0sIHZbMV0sIHZbMl0sIHZbM10sIHZbNF0sIHZbNV0pO1xuXG4gICAgICB2YXIgX2tsYXNzX3Byb3RvID0gZmFicmljW3RoaXMucmVzdWx0T2JqZWN0VHlwZV0ucHJvdG90eXBlO1xuXG4gICAgICBjdHgubGluZVdpZHRoID0gX2tsYXNzX3Byb3RvLnN0cm9rZVdpZHRoO1xuICAgICAgY3R4LnN0cm9rZVN0eWxlID0gX2tsYXNzX3Byb3RvLnN0cm9rZTtcbiAgICAgIGN0eC5maWxsU3R5bGUgPSBfa2xhc3NfcHJvdG8uZmlsbDtcblxuICAgICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgICAgY3R4Lm1vdmVUbyh0aGlzLnBvaW50c1swXS54LHRoaXMucG9pbnRzWzBdLnkpO1xuICAgICAgZm9yKHZhciBpID0gMTsgaSA8IHRoaXMucG9pbnRzLmxlbmd0aDsgaSsrKXtcbiAgICAgICAgY3R4LmxpbmVUbyh0aGlzLnBvaW50c1tpXS54LHRoaXMucG9pbnRzW2ldLnkpXG4gICAgICB9XG4gICAgICBjdHguY2xvc2VQYXRoKCk7XG4gICAgICBjdHguZmlsbCgpO1xuICAgICAgY3R4LnN0cm9rZSgpO1xuICAgICAgY3R4LnJlc3RvcmUoKTtcbiAgICAgIHRoaXMuY2FudmFzLmZpcmUoXCJicnVzaDpyZW5kZXJcIix7dGFyZ2V0OiB0aGlzfSlcbiAgICB9LFxuICAgIGRyYXdpbmdMaW1pdHM6IG51bGwsIC8qe1xuICAgICAgbGVmdDogMCxcbiAgICAgIHdpZHRoOiAwLFxuICAgICAgaGVpZ2h0OiAwLFxuICAgICAgdG9wOiAwXG4gICAgfSwqL1xuICAgIG1pbkhlaWdodDogNTAsXG4gICAgbWluV2lkdGg6IDUwLFxuICAgIF9jaGVja1JlY3RhbmdsZTogZnVuY3Rpb24oX3JlY3Qpe1xuXG5cbiAgICAgIHZhciBkbCA9IHRoaXMuZHJhd2luZ0xpbWl0cztcbiAgICAgIGlmKGRsICYmIGRsID09IFwiYmFja2dyb3VuZEltYWdlXCIpe1xuICAgICAgICBkbD0gdGhpcy5jYW52YXMuYmFja2dyb3VuZEltYWdlO1xuICAgICAgfVxuXG4gICAgICBfcmVjdCA9IHtcbiAgICAgICAgbGVmdDogX3JlY3QubGVmdCxcbiAgICAgICAgdG9wOiBfcmVjdC50b3AsXG4gICAgICAgIHdpZHRoOiBfcmVjdC53aWR0aCxcbiAgICAgICAgaGVpZ2h0OiBfcmVjdC5oZWlnaHQsXG4gICAgICB9O1xuXG4gICAgICBfcmVjdC5sZWZ0ICAtPSBmYWJyaWMuUmVjdC5wcm90b3R5cGUuc3Ryb2tlV2lkdGggLyAyO1xuICAgICAgX3JlY3QudG9wICAgLT0gZmFicmljLlJlY3QucHJvdG90eXBlLnN0cm9rZVdpZHRoIC8gMjtcblxuICAgICAgaWYoZGwpe1xuICAgICAgICBpZihfcmVjdC5sZWZ0ICsgX3JlY3Qud2lkdGggPCBkbC5sZWZ0IHx8XG4gICAgICAgICAgX3JlY3QudG9wICArIF9yZWN0LmhlaWdodCA8IGRsLnRvcCB8fFxuICAgICAgICAgIF9yZWN0LmxlZnQgPiBkbC53aWR0aCB8fFxuICAgICAgICAgIF9yZWN0LnRvcCA+IGRsLmhlaWdodCl7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYoX3JlY3QudG9wIDwgZGwudG9wKXtcbiAgICAgICAgICBfcmVjdC5oZWlnaHQgKz1fcmVjdC50b3AgO1xuICAgICAgICAgIF9yZWN0LnRvcCA9IGRsLnRvcDtcbiAgICAgICAgfVxuICAgICAgICBpZihfcmVjdC5sZWZ0IDwgZGwubGVmdCl7XG4gICAgICAgICAgX3JlY3Qud2lkdGggKz0gX3JlY3QubGVmdDtcbiAgICAgICAgICBfcmVjdC5sZWZ0ID0gZGwubGVmdDtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZih0aGlzLm1pbldpZHRoICYmIF9yZWN0LndpZHRoIDwgdGhpcy5taW5XaWR0aCl7XG4gICAgICAgIF9yZWN0LndpZHRoID0gdGhpcy5taW5XaWR0aDtcbiAgICAgIH1cbiAgICAgIGlmKHRoaXMubWluSGVpZ2h0ICYmIF9yZWN0LmhlaWdodCA8IHRoaXMubWluSGVpZ2h0KXtcbiAgICAgICAgX3JlY3QuaGVpZ2h0ID0gdGhpcy5taW5IZWlnaHQ7XG4gICAgICB9XG5cblxuICAgICAgaWYoZGwpIHtcbiAgICAgICAgdmFyIF94ZGlmZiA9IF9yZWN0LmxlZnQgKyBfcmVjdC53aWR0aCAtIGRsLndpZHRoO1xuICAgICAgICBpZiAoX3hkaWZmID4gMCkge1xuICAgICAgICAgIF9yZWN0LndpZHRoIC09IF94ZGlmZjtcbiAgICAgICAgICBpZiAodGhpcy5taW5XaWR0aCAmJiBfcmVjdC53aWR0aCA8IHRoaXMubWluV2lkdGgpIHtcbiAgICAgICAgICAgIF9yZWN0LmxlZnQgLT0gdGhpcy5taW5XaWR0aCAtIF9yZWN0LndpZHRoO1xuICAgICAgICAgICAgX3JlY3Qud2lkdGggPSB0aGlzLm1pbldpZHRoO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB2YXIgX3lkaWZmID0gX3JlY3QudG9wICsgX3JlY3QuaGVpZ2h0IC0gZGwuaGVpZ2h0O1xuICAgICAgICBpZiAoX3lkaWZmID4gMCkge1xuICAgICAgICAgIF9yZWN0LmhlaWdodCAtPSBfeWRpZmY7XG4gICAgICAgICAgaWYgKHRoaXMubWluSGVpZ2h0ICYmIF9yZWN0LmhlaWdodCA8IHRoaXMubWluSGVpZ2h0KSB7XG4gICAgICAgICAgICBfcmVjdC50b3AgLT0gdGhpcy5taW5IZWlnaHQgLSBfcmVjdC5oZWlnaHQ7XG4gICAgICAgICAgICBfcmVjdC5oZWlnaHQgPSB0aGlzLm1pbkhlaWdodDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBfcmVjdDtcbiAgICB9LFxuICAgIHJlc3VsdE9iamVjdFByb3BlcnRpZXM6IHt9XG4gIH0pO1xuXG5cbmZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUuZHJhd2luZ1Rvb2xzLlBvbHlnb25CcnVzaCA9IHtcbiAgaWNvbjogJ2RhdGE6aW1hZ2UvcG5nO2Jhc2U2NCwnKyByZXF1aXJlKCdiYXNlNjQtbG9hZGVyIS4vLi4vbWVkaWEvcG9seWdvbi5wbmcnKSxcbiAgdGl0bGU6ICdQb2x5Z29uIEJydXNoJ1xufTtcbmZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUuYWN0aXZlRHJhd2luZ1Rvb2xzLnB1c2goXCJQb2x5Z29uQnJ1c2hcIik7XG5cblxuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9icnVzaGVzL1BvbHlnb25CcnVzaC5qcyIsIm1vZHVsZS5leHBvcnRzID0gXCJpVkJPUncwS0dnb0FBQUFOU1VoRVVnQUFBRUFBQUFCQUNBWUFBQUNxYVhIZUFBQUFCSE5DU1ZRSUNBZ0lmQWhraUFBQUFBbHdTRmx6QUFBTmxBQUFEWlFCRUxEL2ZBQUFBQmwwUlZoMFUyOW1kSGRoY21VQWQzZDNMbWx1YTNOallYQmxMbTl5WjV2dVBCb0FBQVhQU1VSQlZIaWM1ZHQveUY1bEdRZnd6N1U1NTVhYXRwRW9wazZ5TGJhMTZJZWdEQ2swQzBrRDJ3b0pEWnI5SWJVZzB6WWkreU1TUXZ0RmhoRzFhT0kvT2YvUUxMRWdjZ2d6emNwQmMxQ1Qyb3FzWE5ocXN6bmJydjY0N3hmZlBYdWY3WG1lYzU3ejdwMWZ1RG1jYys0ZjEvVzlyM09mKzF6WGRTSXp2Um9RRWZQeHVjejgvR0hYWHcwRVJNUkMvQVJ6TS9PdGsrL05taDZSdWtORVhJZ3R1SGlxK3ljMEFSSHhOa1g1aS9yVk9XRUppSWdyc1JsbjRZbCs5VTVJQWlMaWV2d1lwK0piK0ZpL3VpY2NBUkd4RGhzeFIxbjExK0pRdi9vbmRTWFl1QkVScy9BTnJNWC9jR05tYmp4V3V4T0NnSWlZaTN1eEN2dXdLak1mR2FUdGpDY2dJczdBZzdnTXorT3F6SHhxMFBZem1vQ0lPQmVQWUNtZXhmc3ljOGN3ZlJ5eENFYkU0b2g0YlRzaWpnOFJzUlNQSzhyL0dwY09xenhUVzhEVnVETWkvb3h0K0YwdDIvQk1acjQ0c3RRdElTSXVVOHorRFB4VWVlYjNqdFJaWmg1V2NCcitoWnlpSE1RT1BJRGJjUjJXNCtUZWZzWlZsSVZ1ZjVYbkhzd1pvTTJTV3YvcEkrNzFhZkRsMnVBcDNJd055bTdxUDMySWVSblA0RDU4QVIvRVlzeHVXZm0xZFJLeXloZ0R0aHVhZ0xQeEVnN2czRW5YQTR2d2ZxeFhYajIvblRRanZXVS9ucTcxMXRkMml3WVZ2R2ZjaVVrNWlMVkR0aCtPZ05wb1EyMzBsUUVHbUYxbi9OcHFBZmNwYThiTGZZalpXeTNxKzlYQ3JzUTVmZnFlVTAxOWd0RFZJMWhPWHdMNitnTWk0czFWaWIxNFEyYnVtYkxpVVJBUkoxZGlsbUpaTFV0eG9hbTM0Uzk0WmVIZHBqeFc2eXBCZS9DQnpOdzhnaHhMc0IxYnM4Y2ZjQ3ptZnFRd3Q3N2xaM2tlM280YmNBY2V4azVUVzB2aUwxamVZTHpoTGFBeXR4S1A0VGxja0prSGhtVi9HRVRFNllxRlRMYVllYmd1TTNjMTZIYzBDNmprUEs2d3Q2Wk5LK2l5T0lvRkRQSTVmRWM5M2hJUk1lb3NISzhZaElBSDhYdUZ4YXZISzA3M09DWUJtWGtJWDYybnQ0NVhuTzR4cUVmb0h2d2RLeVBpa2pISzB6a0dJaUF6OStPdWV2clo4WW5UUFlieENkNnRiSXF1aVlnM2pVbWV6akV3QVpuNUFyNVgyOXd5Tm9rNnhyQmU0YThyRHNjYkl1S3NNY2pUT1lZaW9PN0dmb2k1K05SWUpPb1lvOFFGN3F6SG15TGkxRGFGbVE0TVRVQm1ic1hQY0NadWJGMmlqakZxWkdoaWUvenBpSmpSbnVXUkNNak1uK00zT0E4ZmJsV2lqdEVrTmppeEZzem83WEVUQWpiaFQxaFJROUV6RWlNVGtKa0g4YlY2T21PM3gwM0Q0eHZ3VDF4ZXN6Rm1IQm9Sa0NWS2RIYzluWkZyUVJzSkVuZmh2MWdkRVJlMDBGK25hRXhBWmo2UEh5aXhnWnViOWpjbUxPcDdweVduNHh1VmlNMCtMRGdPbktCemNBVytpVDk2eGIwK2VHUm9oRUUzMVVGdW15YWxYNGVQS0I5cmV4d2VWL2lENHRhN2RKd0VYRndIK3dmbWRhVDBSZmdNSGxVKzB5ZEhzUjlUWHM5TGp0cEh5d0k5V2dXNGFVd0t6OFpLNVZ0a2U4OHMveHYzSzlHbWhRUDMyYktBVjAweXVWa3Q5WG1ha2hPd0VidDdsTjZwNUFHKzE0ZzVDbTBURUVwZ001V3NqVkg3T1ErZlVQSi9YcHFrOENFOGlkdXdvaFdaMnlTZ0N2L1JLdXdUUXhMM1RueFJ5U2VZUE1zdjRpRjhIR2UzTG0rTGlpL0dHc1Z4T2lIODdWaldwLzQ4SldIaU8vaHJqOUxQNGJ1NEJ2UGJWcnBWQXFyaTkxZno3QmZlL2lYZW9pUXVyMUhDYmZ0NjZtekZsK3JiWktnTWtpYWwwUThUTlQ2d0JRdVViSkJmNFJkS2J0Rnl2QnVYNEJUbDFUU3JtanNsL1dhemtvUHdVR2J1SEZtUUptZzQreE1MM3IxNFRaODZjNVVjM29tWjNvVFZPTDJyV1I3TEk2RHNyeE83REdDeVNrNVE0b3JwVm5weWFmSXhOQkVZMlpXRFBVZlAxdU9aRGNac0h3MHM0Q1Fsb2ZLZ1k4d3EzcUhFRlEvaC9PbWU5VlllZ2FyWUp4V3pQcUNrdkYydjVoWGk5ZmdRdmwyVkh5amxia1lSVUJXOTFaR0prbjh6OVd2eFhkT3RjRzlwNWIvQmlEaEhjWWE4Ui9FTnpGZDhoVThxaTkvQ2FpM2JNbk5aNHdGYlJPcy9UdFpFcWdXWnVidm4yZzRsUWZMOGJKRHkxalphLzJrcUMzYjNYbE4yZzdDaTdUR2JZRHIrR2p0bEdzYnNpMDRJcVAvMVhGNVB0M2N4NXFEb3lnTFdLUnVuTFVvUzlIR0RyZ2pZbzRUUlZtWGJxMjVEL0I5UExmbzNFTUVaaXdBQUFBQkpSVTVFcmtKZ2dnPT1cIlxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4uL25vZGVfbW9kdWxlcy9iYXNlNjQtbG9hZGVyIS4vbWVkaWEvcG9seWdvbi5wbmdcbi8vIG1vZHVsZSBpZCA9IDY3XG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIid1c2Ugc3RyaWN0JztcblxuXG4gIC8qKlxuICAgKiBQZW5jaWxCcnVzaCBjbGFzc1xuICAgKiBAY2xhc3MgZmFicmljLlBlbmNpbEJydXNoXG4gICAqIEBleHRlbmRzIGZhYnJpYy5CYXNlQnJ1c2hcbiAgICovXG4gIGZhYnJpYy5QYWludFBlbkJydXNoID0gZmFicmljLnV0aWwuY3JlYXRlQ2xhc3MoZmFicmljLkJhc2VCcnVzaCwgLyoqIEBsZW5kcyBmYWJyaWMuUGVuY2lsQnJ1c2gucHJvdG90eXBlICovIHtcbiAgICB0eXBlOiAncGFpbnQtcGVuLWJydXNoJyxcblxuICAgIC8qKlxuICAgICAqIENvbnN0cnVjdG9yXG4gICAgICogQHBhcmFtIHtmYWJyaWMuQ2FudmFzfSBjYW52YXNcbiAgICAgKiBAcmV0dXJuIHtmYWJyaWMuUGVuY2lsQnJ1c2h9IEluc3RhbmNlIG9mIGEgcGVuY2lsIGJydXNoXG4gICAgICovXG4gICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oY2FudmFzKSB7XG4gICAgICB0aGlzLmNhbGxTdXBlcignaW5pdGlhbGl6ZScsIGNhbnZhcyk7XG4gICAgICB0aGlzLl9wb2ludHMgPSBbXTtcbiAgICB9LFxuICAgIGdldFRhcmdldDogZnVuY3Rpb24oKXtcbiAgICAgIHJldHVybiB0aGlzLmNhbnZhcy5kcmF3aW5nQ29udGV4dDtcbiAgICB9LFxuICAgIC8qKlxuICAgICAqIElub3Zva2VkIG9uIG1vdXNlIGRvd25cbiAgICAgKiBAcGFyYW0ge09iamVjdH0gcG9pbnRlclxuICAgICAqL1xuICAgIG9uTW91c2VEb3duOiBmdW5jdGlvbihwb2ludGVyKSB7XG4gICAgICB0aGlzLl9yZXNldCgpO1xuICAgICAgdGhpcy5fZmlsbChwb2ludGVyKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogSW5vdm9rZWQgb24gbW91c2UgbW92ZVxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBwb2ludGVyXG4gICAgICovXG4gICAgb25Nb3VzZU1vdmU6IGZ1bmN0aW9uKHBvaW50ZXIpIHtcbiAgICAgIHRoaXMuX2ZpbGwocG9pbnRlcik7XG4gICAgfSxcbiAgICAvKipcbiAgICAgKiBJbnZva2VkIG9uIG1vdXNlIHVwXG4gICAgICovXG4gICAgb25Nb3VzZVVwOiBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMuY2FudmFzLmZpcmUoXCJkcmF3OmFmdGVyXCIse1xuICAgICAgICB0YXJnZXQ6IHRoaXMuZ2V0VGFyZ2V0KCkgLFxuICAgICAgICBwb2ludHM6IHRoaXMuX3BvaW50cy5zbGljZSgpICxcbiAgICAgICAgY29sb3I6IHRoaXMuZ2V0Q29sb3IoJ3NvdXJjZScpXG4gICAgICB9KTtcbiAgICB9LFxuICAgIF9maWxsOiBmdW5jdGlvbihwb2ludGVyKXtcbiAgICAgIHBvaW50ZXIgPSB7XG4gICAgICAgIHg6IE1hdGguZmxvb3IocG9pbnRlci54KSxcbiAgICAgICAgeTogTWF0aC5mbG9vcihwb2ludGVyLnkpXG4gICAgICB9O1xuXG4gICAgICBpZihfLmZpbmRXaGVyZSh0aGlzLl9wb2ludHMscG9pbnRlcikpe1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8vIHRoaXMuZ2V0VGFyZ2V0KCkuZmlsbFJlY3QocG9pbnRlci54ICwgcG9pbnRlci55ICAsMSwxKTtcbiAgICAgIHZhciBfZGF0YSA9IHRoaXMuZ2V0VGFyZ2V0KCkuZ2V0SW1hZ2VEYXRhKHBvaW50ZXIueCAsIHBvaW50ZXIueSAgLDEsMSk7XG4gICAgICBwb2ludGVyLmNvbG9yID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoX2RhdGEuZGF0YSk7XG4gICAgICB0aGlzLl9wb2ludHMucHVzaChwb2ludGVyKTtcbiAgICAgIHZhciBfY29sb3IgPSB0aGlzLmdldENvbG9yKCdzb3VyY2UnKTtcblxuXG5cblxuICAgICAgX2RhdGEuZGF0YVswXSA9IF9jb2xvclswXTtcbiAgICAgIF9kYXRhLmRhdGFbMV0gPSBfY29sb3JbMV07XG4gICAgICBfZGF0YS5kYXRhWzJdID0gX2NvbG9yWzJdO1xuICAgICAgX2RhdGEuZGF0YVszXSA9IF9jb2xvclszXTtcblxuICAgICAgdGhpcy5nZXRUYXJnZXQoKS5wdXRJbWFnZURhdGEoX2RhdGEsIHBvaW50ZXIueCAsIHBvaW50ZXIueSk7XG4gICAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICB9LFxuICAgIHVuZG9QYWludEFjdGlvbjogZnVuY3Rpb24oX2FjdGlvbil7XG4gICAgICB2YXIgY3R4ID0gX2FjdGlvbi5vYmplY3Q7XG4gICAgICBmb3IodmFyIGkgaW4gX2FjdGlvbi5wb2ludHMpe1xuICAgICAgICB2YXIgX3AgID1fYWN0aW9uLnBvaW50c1tpXSwgX2MgPSBfYWN0aW9uLmJydXNoLmdldEFjdGlvbkNvbG9yKF9wLmNvbG9yKTtcbiAgICAgICAgaWYoX2NbM10gPT0gMCkge1xuICAgICAgICAgIGN0eC5jbGVhclJlY3QoX3AueCxfcC55ICAsMSwxKTtcbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgY3R4LmZpbGxTdHlsZSA9IFwicmdiYShcIiArIF9jWzBdICsgXCIsXCIgKyBfY1sxXSArIFwiLFwiICsgX2NbMl0gKyBcIixcIiArIF9jWzNdICsgIFwiKVwiO1xuICAgICAgICAgIGN0eC5maWxsUmVjdChfcC54LF9wLnkgICwxLDEpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBfYWN0aW9uLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICB9LFxuICAgIHJlZG9QYWludEFjdGlvbjogZnVuY3Rpb24oX2FjdGlvbil7XG5cbiAgICAgIHZhciBjdHggPSBfYWN0aW9uLm9iamVjdCwgX2MgPSBfYWN0aW9uLmJydXNoLmdldEFjdGlvbkNvbG9yKF9hY3Rpb24uY29sb3IpO1xuICAgICAgdmFyIHB0cyA9IF9hY3Rpb24ucG9pbnRzO1xuICAgICAgaWYoX2NbM10gPT0gMCkge1xuICAgICAgICBmb3IodmFyIGkgaW4gcHRzKXtcbiAgICAgICAgICBjdHguY2xlYXJSZWN0KHB0c1tpXS54LHB0c1tpXS55ICAsMSwxKTtcbiAgICAgICAgfVxuICAgICAgfWVsc2V7XG4gICAgICAgIGN0eC5maWxsU3R5bGUgPSBcInJnYmEoXCIgKyBfY1swXSArIFwiLFwiICsgX2NbMV0gKyBcIixcIiArIF9jWzJdICsgXCIsXCIgKyBfY1szXSArIFwiKVwiO1xuICAgICAgICBmb3IodmFyIGkgaW4gcHRzKXtcbiAgICAgICAgICBjdHguZmlsbFJlY3QocHRzW2ldLngscHRzW2ldLnkgLDEsMSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIF9hY3Rpb24uY2FudmFzLnJlbmRlckFsbCgpO1xuICAgIH0sXG4gICAgLyoqXG4gICAgICogQ2xlYXIgcG9pbnRzIGFycmF5IGFuZCBzZXQgY29udGV4dFRvcCBjYW52YXMgc3R5bGUuXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfcmVzZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5fcG9pbnRzLmxlbmd0aCA9IDA7XG4gICAgICB0aGlzLmdldFRhcmdldCgpLmZpbGxTdHlsZSA9IHRoaXMuY29sb3I7XG4gICAgfSxcbiAgICBnZXRIaXN0b3J5UmVjb3JkOiBmdW5jdGlvbihldmVudCl7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGNhbnZhczogICB0aGlzLmNhbnZhcyxcbiAgICAgICAgdHlwZTogICAgIFwiZHJhdzpwZW5cIixcbiAgICAgICAgb2JqZWN0OiAgIGV2ZW50LnRhcmdldCAsXG4gICAgICAgIHBvaW50czogICBldmVudC5wb2ludHMgLFxuICAgICAgICBicnVzaDogICB0aGlzLFxuICAgICAgICBjb2xvcjogICAgZXZlbnQuY29sb3IsXG4gICAgICAgIHVuZG86ICAgICB0aGlzLnVuZG9QYWludEFjdGlvbixcbiAgICAgICAgcmVkbzogICAgIHRoaXMucmVkb1BhaW50QWN0aW9uXG4gICAgICB9XG4gICAgfVxuICB9KTtcblxuZmFicmljLlNsaWRlQ2FudmFzLnByb3RvdHlwZS5kcmF3aW5nVG9vbHMuUGFpbnRQZW5CcnVzaCA9IHtcbiAgY2xhc3NOYW1lOiAnZmEgZmEtcGFpbnQtYnJ1c2gnLFxuICB0aXRsZTogJ1BlbiBCcnVzaCdcbn07XG5mYWJyaWMuU2xpZGVDYW52YXMucHJvdG90eXBlLmFjdGl2ZURyYXdpbmdUb29scy5wdXNoKFwiUGFpbnRQZW5CcnVzaFwiKTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvYnJ1c2hlcy9QYWludFBlbkJydXNoLmpzIiwiJ3VzZSBzdHJpY3QnO1xuXG5cbmZhYnJpYy5NYWdpY1dhbmQgPSByZXF1aXJlKCcuLi9wbHVnaW5zL21hZ2ljd2FuZCcpO1xuXG4gIC8qKlxuICAgKiBQZW5jaWxCcnVzaCBjbGFzc1xuICAgKiBAY2xhc3MgZmFicmljLlBlbmNpbEJydXNoXG4gICAqIEBleHRlbmRzIGZhYnJpYy5CYXNlQnJ1c2hcbiAgICovXG4gIGZhYnJpYy5QYWludEJ1Y2tldEJydXNoID0gZmFicmljLnV0aWwuY3JlYXRlQ2xhc3MoZmFicmljLkJhc2VCcnVzaCwgLyoqIEBsZW5kcyBmYWJyaWMuUGVuY2lsQnJ1c2gucHJvdG90eXBlICovIHtcbiAgICB0eXBlOiAncGFpbnQtYnVja2V0LWJydXNoJyxcbiAgICAvKipcbiAgICAgKiBDb25zdHJ1Y3RvclxuICAgICAqIEBwYXJhbSB7ZmFicmljLkNhbnZhc30gY2FudmFzXG4gICAgICogQHJldHVybiB7ZmFicmljLlBlbmNpbEJydXNofSBJbnN0YW5jZSBvZiBhIHBlbmNpbCBicnVzaFxuICAgICAqL1xuICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uKGNhbnZhcykge1xuICAgICAgdGhpcy5jYWxsU3VwZXIoJ2luaXRpYWxpemUnLCBjYW52YXMpO1xuICAgICAgdGhpcy5fcG9pbnRzID0gW107XG4gICAgfSxcbiAgICBnZXRUYXJnZXQ6IGZ1bmN0aW9uKCl7XG4gICAgICByZXR1cm4gdGhpcy5jYW52YXMuZHJhd2luZ0NvbnRleHQ7XG4gICAgfSxcbiAgICBvbk1vdXNlVXA6IGZ1bmN0aW9uKCkge30sXG4gICAgb25Nb3VzZU1vdmU6IGZ1bmN0aW9uKCkge30sXG4gICAgb25Nb3VzZURvd246IGZ1bmN0aW9uKHBvaW50ZXIpIHtcbiAgICAgIHRoaXMuX2ZpbGwocG9pbnRlcik7XG4gICAgfSxcbiAgICBfZmlsbDogZnVuY3Rpb24ocG9pbnRlcil7XG4gICAgICBwb2ludGVyID0ge1xuICAgICAgICB4OiBNYXRoLmZsb29yKHBvaW50ZXIueCksXG4gICAgICAgIHk6IE1hdGguZmxvb3IocG9pbnRlci55KVxuICAgICAgfTtcblxuICAgICAgdmFyIGluZm8gPSB0aGlzLmdldFRhcmdldCgpLmdldEltYWdlRGF0YSgwLDAsdGhpcy5nZXRUYXJnZXQoKS5jYW52YXMud2lkdGgsdGhpcy5nZXRUYXJnZXQoKS5jYW52YXMuaGVpZ2h0KTtcblxuICAgICAgZmFicmljLk1hZ2ljV2FuZC5mbG9vZEZpbGwoaW5mbywgcG9pbnRlci54ICwgcG9pbnRlci55LCAxLHt9LG51bGwsZnVuY3Rpb24obWFzayl7XG4gICAgICAgIHZhciBfY29sb3IgPSB0aGlzLmdldENvbG9yKCdzb3VyY2UnKTtcbiAgICAgICAgdmFyIF90YXJnZXQgPSB0aGlzLmdldFRhcmdldCgpO1xuICAgICAgICB2YXIgX3cgPSBtYXNrLmJvdW5kcy5tYXhYIC0gbWFzay5ib3VuZHMubWluWCArIDEsIF9oID0gbWFzay5ib3VuZHMubWF4WSAtIG1hc2suYm91bmRzLm1pblkgKyAxO1xuICAgICAgICB2YXIgb2xkSW1hZ2VEYXRhID0gX3RhcmdldC5nZXRJbWFnZURhdGEoIG1hc2suYm91bmRzLm1pblgsbWFzay5ib3VuZHMubWluWSxfdywgX2gpO1xuXG4gICAgICAgIG1hc2sucmVuZGVyKF90YXJnZXQse1xuICAgICAgICAgIGludGVyc2VjdGlvbkNvbG9yIDogX2NvbG9yLFxuICAgICAgICAgIGZpbGwgOiBfY29sb3IsXG4gICAgICAgICAgY2FjaGU6IGZhbHNlLFxuICAgICAgICAgIGxlZnQgOiBtYXNrLmJvdW5kcy5taW5YLFxuICAgICAgICAgIHRvcCA6IG1hc2suYm91bmRzLm1pbllcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5jYW52YXMuZmlyZShcImRyYXc6YWZ0ZXJcIix7XG4gICAgICAgICAgdGFyZ2V0OiB0aGlzLmdldFRhcmdldCgpICxcbiAgICAgICAgICByZWRvOiBfdGFyZ2V0LmdldEltYWdlRGF0YSggbWFzay5ib3VuZHMubWluWCxtYXNrLmJvdW5kcy5taW5ZLF93LCBfaCksXG4gICAgICAgICAgdW5kbzogb2xkSW1hZ2VEYXRhICxcbiAgICAgICAgICBsZWZ0IDogbWFzay5ib3VuZHMubWluWCxcbiAgICAgICAgICB0b3AgOiBtYXNrLmJvdW5kcy5taW5ZLFxuICAgICAgICAgIGNvbG9yOiB0aGlzLmdldENvbG9yKCkuc2xpY2UoKVxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgfSxcbiAgICBnZXRIaXN0b3J5UmVjb3JkOiBmdW5jdGlvbihldmVudCkge1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBjYW52YXM6ICAgdGhpcy5jYW52YXMsXG4gICAgICAgIG9iamVjdDogICBldmVudC50YXJnZXQgLFxuICAgICAgICB0eXBlOiAgICAgXCJkcmF3OmJ1Y2tldFwiLFxuICAgICAgICBsZWZ0OiAgICAgZXZlbnQubGVmdCAsXG4gICAgICAgIHRvcDogICAgICBldmVudC50b3AgLFxuICAgICAgICB1bmRvRGF0YTogZXZlbnQudW5kbyxcbiAgICAgICAgcmVkb0RhdGE6IGV2ZW50LnJlZG8sXG4gICAgICAgIGNvbG9yOiAgICB0aGlzLmNvbnZlcnRDb2xvcihldmVudC5jb2xvcixcInNvdXJjZVwiICApLFxuICAgICAgICB1bmRvOiBmdW5jdGlvbihfYWN0aW9uKXtcbiAgICAgICAgICBfYWN0aW9uLm9iamVjdC5wdXRJbWFnZURhdGEoX2FjdGlvbi51bmRvRGF0YSwgX2FjdGlvbi5sZWZ0LF9hY3Rpb24udG9wKTtcbiAgICAgICAgICBfYWN0aW9uLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICAgICAgfSxcbiAgICAgICAgcmVkbzogZnVuY3Rpb24oX2FjdGlvbil7XG4gICAgICAgICAgX2FjdGlvbi5vYmplY3QucHV0SW1hZ2VEYXRhKF9hY3Rpb24ucmVkb0RhdGEsIF9hY3Rpb24ubGVmdCxfYWN0aW9uLnRvcCk7XG4gICAgICAgICAgX2FjdGlvbi5jYW52YXMucmVuZGVyQWxsKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuXG5mYWJyaWMuU2xpZGVDYW52YXMucHJvdG90eXBlLmRyYXdpbmdUb29scy5QYWludEJ1Y2tldEJydXNoID0ge1xuICBpY29uOiAgJ2RhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsJyArIHJlcXVpcmUoJ2Jhc2U2NC1sb2FkZXIhLi8uLi9tZWRpYS9wYWludC1idWNrZXQuc3ZnJyksXG4gIHRpdGxlOiAnQnVja2V0IEJydXNoJ1xufTtcbmZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUuYWN0aXZlRHJhd2luZ1Rvb2xzLnB1c2goXCJQYWludEJ1Y2tldEJydXNoXCIpO1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9icnVzaGVzL1BhaW50QnVja2V0QnJ1c2guanMiLCJtb2R1bGUuZXhwb3J0cyA9IFwiUEhOMlp5QjRiV3h1Y3owaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNQzl6ZG1jaUlIZHBaSFJvUFNJeU5DSWdhR1ZwWjJoMFBTSXlOQ0lnZG1sbGQwSnZlRDBpTUNBd0lESTBJREkwSWo0OGNHRjBhQ0JrUFNKTk1qRXVNVFF6SURrdU5qWTNZeTB1TnpNekxURXVNemt5TFRFdU9URTBMVE11TURVdE15NDJNVGN0TkM0M05UTXRNaTQ1TnpjdE1pNDVOemd0TlM0ME56Z3RNeTQ1TVRRdE5pNDNPRFV0TXk0NU1UUXRMalF4TkNBd0xTNDNNRGd1TURrMExTNDROaTR5TkRac0xURXVNell4SURFdU16WmpMVEV1T0RrNUxTNHlNell0TXk0ME1pNHhNRFl0TkM0eU9UUXVPVGd6TFM0NE56WXVPRGMxTFRFdU1UWTBJREl1TVRVNUxTNDNPVElnTXk0MU1qTXVORGt5SURFdU9EQTJJREl1TXpBMUlEUXVNRFE1SURVdU9UQTFJRFV1TXpjMUxqQXpPQzR6TWpNdU1UVTNMall6T0M0ME1EVXVPRGcxTGpVNE9DNDFPRGdnTVM0MU16VXVOVGcySURJdU1USXhJREJ6TGpVNE9DMHhMalV6TXk0d01ESXRNaTR4TVRsakxTNDFPRGd0TGpVNE55MHhMalV6TnkwdU5UZzRMVEl1TVRJekxTNHdNREZzTFM0eE55NHlOVFpqTFRJdU1ETXhMUzQzTmpVdE15NHpPVFV0TVM0NE1qZ3ROQzR5TXpJdE1pNDViRE11T0RjNUxUTXVPRGMxWXk0ME9UWWdNaTQzTXlBMkxqUXpNaUE0TGpZM05pQTVMakUzT0NBNUxqRTNPR3d0Tnk0eE1UVWdOeTR4TURkakxTNHlNelF1TVRVekxUSXVOems0TFM0ek1UWXROaTR4TlRZdE15NDJOelV0TXk0ek9UTXRNeTR6T1RNdE15NHhOelV0TlM0eU56RXRNeTR3TWpjdE5TNDBPVGhzTVM0NE5Ua3RNUzQ0TlRaakxTNDBNemt0TGpNMU9TMHVPVEkxTFRFdU1UQXpMVEV1TVRReExURXVOamc1YkMweUxqRXpOQ0F5TGpFek1XTXRMalEwTlM0ME5EWXRMalk0TlNBeExqQTJOQzB1TmpnMUlERXVPRElnTUNBeExqWXpOQ0F4TGpFeU1TQXpMamt4TlNBekxqY3hNeUEyTGpVd05pQXlMamMyTkNBeUxqYzJOQ0ExTGpVNElEUXVNalF6SURjdU5ETXlJRFF1TWpRekxqWTBPQ0F3SURFdU1UZ3RMakU1TlNBeExqVTBOeTB1TlRZeWJEZ3VNRGcyTFRndU1EYzRZeTQ1TVM0NE56UXRMamMzT0NBekxqVXpPQzB1TnpjNElEUXVOalE0SURBZ01TNHhNRFF1T0RrMklERXVPVGs1SURJZ01TNDVPVGtnTVM0eE1EVWdNQ0F5TFM0NE9UWWdNaTB5SURBdE15NHhPRFF0TVM0ME1qVXROaTQ0TVMweUxqZzFOeTA1TGpNMGVtMHRNVFl1TWpBNUxUVXVNemN4WXk0MU1qY3RMalV6SURFdU5EY3hMUzQzT1RFZ01pNDJOVFl0TGpjMk1Xd3RNeTR5TURrZ015NHlNRFpqTFM0eU16WXRMamszT0MwdU1EUTVMVEV1T0RRMUxqVTFNeTB5TGpRME5YcHRPUzR5T1RJZ05DNHdOemxzTFM0d015MHVNREk1WXkweExqSTVNaTB4TGpJNU1pMHpMamd3TXkwMExqTTFOaTB6TGpBNU5pMDFMakEyTXk0M01UVXRMamN4TlNBekxqUTRPQ0F4TGpVeU1TQTFMakEyTWlBekxqQTVOaTQ0TmpJdU9EWXlJREl1TURnNElESXVNalEzSURJdU9UTTNJRE11TkRVNExURXVOekUzTFRFdU1EYzBMVE11TkRreExURXVORFk1TFRRdU9EY3pMVEV1TkRZeWVpSXZQand2YzNablBnPT1cIlxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4uL25vZGVfbW9kdWxlcy9iYXNlNjQtbG9hZGVyIS4vbWVkaWEvcGFpbnQtYnVja2V0LnN2Z1xuLy8gbW9kdWxlIGlkID0gNzBcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiJ3VzZSBzdHJpY3QnO1xuXG5mYWJyaWMuUG9pbnRzQnJ1c2ggPSBmYWJyaWMudXRpbC5jcmVhdGVDbGFzcyhmYWJyaWMuQmFzZUJydXNoLCB7XG4gIHR5cGU6IFwicG9pbnRzLWJydXNoXCIsXG4gIG1heGltdW1Qb2ludHMgOiAwLFxuICBpbml0aWFsaXplOiBmdW5jdGlvbiAoY2FudmFzKSB7XG4gICAgdGhpcy5jYWxsU3VwZXIoJ2luaXRpYWxpemUnLCBjYW52YXMpO1xuICAgIHRoaXMucmVzZXQoKTtcbiAgfSxcbiAgY3VycmVudFBvaW50IDogMSxcbiAgZ2V0UG9pbnRzOiBmdW5jdGlvbigpe1xuICAgIHJldHVybiBmYWJyaWMudXRpbC5vYmplY3Qud2hlcmUodGhpcy5jYW52YXMuX29iamVjdHMse3R5cGU6IFwibWF0ZXJpYWwtcG9pbnRcIn0pO1xuICB9LFxuICBjaGVja1Bvc2l0aW9uOiBudWxsLFxuICBvbk1vdXNlRG93bjogZnVuY3Rpb24gKHBvaW50ZXIpIHtcblxuICB9LFxuICBvbk1vdXNlTW92ZTogZnVuY3Rpb24gKHBvaW50ZXIpIHtcbiAgfSxcbiAgcmVzZXQ6IGZ1bmN0aW9uKCl7XG4gIH0sXG4gIG9uTW91c2VVcDogZnVuY3Rpb24gKHBvaW50ZXIpIHtcbiAgICB2YXIgX3BvaW50cyA9IHRoaXMuZ2V0UG9pbnRzKCk7XG5cbiAgICB2YXIgcG9zID0ge1xuICAgICAgbGVmdDogcG9pbnRlci54IC0wLjUsXG4gICAgICB0b3A6IHBvaW50ZXIueSAgLTAuNSxcbiAgICB9O1xuXG4gICAgdmFyIF9jb3JyZWN0ID0gdGhpcy5jaGVja1Bvc2l0aW9uID8gdGhpcy5jaGVja1Bvc2l0aW9uKHBvaW50ZXIpIDogdHJ1ZSA7XG5cbiAgICBpZighX2NvcnJlY3Qpe1xuICAgICAgdGhpcy5jYW52YXMuZmlyZShcInBvaW50OnJlamVjdGVkXCIse3BvaW50IDogcG9pbnRlcn0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmKHRoaXMubWF4aW11bVBvaW50cyAmJiBfcG9pbnRzLmxlbmd0aCA+PSB0aGlzLm1heGltdW1Qb2ludHMpe1xuICAgICAgaWYodGhpcy5jdXJyZW50UG9pbnQgPiB0aGlzLm1heGltdW1Qb2ludHMpe1xuICAgICAgICB0aGlzLmN1cnJlbnRQb2ludCA9IDE7XG4gICAgICB9XG4gICAgICBpZih0aGlzLndob2xlQ29vcmRpbmF0ZXMpe1xuICAgICAgICBwb2ludGVyLnggPSBNYXRoLnJvdW5kKHBvaW50ZXIueCkgKyAwLjU7XG4gICAgICAgIHBvaW50ZXIueSA9IE1hdGgucm91bmQocG9pbnRlci55KSAgKyAwLjU7XG4gICAgICB9XG5cbiAgICAgIHZhciBfb2JqID0gZmFicmljLnV0aWwub2JqZWN0LmZpbmRXaGVyZShfcG9pbnRzLHtudW1iZXIgOiB0aGlzLmN1cnJlbnRQb2ludCsrfSk7XG5cbiAgICAgIHZhciBzdGF0ZXMgPSB7XG4gICAgICAgIG9yaWdpbmFsIDoge1xuICAgICAgICAgIGxlZnQ6IF9vYmoubGVmdCxcbiAgICAgICAgICB0b3A6IF9vYmoudG9wXG4gICAgICAgIH0sXG4gICAgICAgIG1vZGlmaWVkOiAge1xuICAgICAgICAgIGxlZnQ6IHBvaW50ZXIueCAtIDAuNSxcbiAgICAgICAgICB0b3A6IHBvaW50ZXIueSAtIDAuNVxuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICBfb2JqLnNldChzdGF0ZXMubW9kaWZpZWQpLnNldENvb3JkcygpLmZpcmUoXCJtb2RpZmllZFwiLHtzdGF0ZXM6IHN0YXRlc30pO1xuICAgICAgdGhpcy5jYW52YXMuZmlyZShcIm9iamVjdDptb2RpZmllZFwiLHt0YXJnZXQgOiBfb2JqLCBzdGF0ZXM6IHN0YXRlc30pO1xuICAgICAgdGhpcy5jYW52YXMuc2V0QWN0aXZlT2JqZWN0KF9vYmopO1xuICAgICAgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gICAgICByZXR1cm47XG4gICAgfWVsc2V7XG4gICAgICB0aGlzLmN1cnJlbnRQb2ludCA9IDE7XG4gICAgICB3aGlsZShmYWJyaWMudXRpbC5vYmplY3QuZmluZFdoZXJlKF9wb2ludHMse251bWJlciA6IHRoaXMuY3VycmVudFBvaW50fSkpe1xuICAgICAgICB0aGlzLmN1cnJlbnRQb2ludCsrO1xuICAgICAgfVxuICAgIH1cblxuICAgIHZhciBfb2JqID0gbmV3IGZhYnJpYy5NYXRlcmlhbFBvaW50KHtcbiAgICAgIG51bWJlcjogdGhpcy5jdXJyZW50UG9pbnQgLFxuICAgICAgYXBwbGljYXRpb246IHRoaXMuY2FudmFzLmFwcGxpY2F0aW9uLFxuICAgICAgbGVmdDogcG9zLmxlZnQsXG4gICAgICB0b3A6IHBvcy50b3BcbiAgICB9KTtcblxuICAgIHRoaXMuY3VycmVudFBvaW50Kys7XG4gICAgdGhpcy5jYW52YXMuYWRkKF9vYmopO1xuICAgIHRoaXMuY2FudmFzLmZpcmUoXCJwb2ludDpjcmVhdGVkXCIse3BvaW50IDogX29ian0pXG4gICAgdGhpcy5jYW52YXMuc2V0QWN0aXZlT2JqZWN0KF9vYmopO1xuICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICB9LFxuICBfcmVuZGVyOiBmdW5jdGlvbiAoKSB7XG4gIH1cbn0pO1xuXG5mYWJyaWMuU2xpZGVDYW52YXMucHJvdG90eXBlLmRyYXdpbmdUb29scy5Qb2ludHNCcnVzaCA9IHtcbiAgY2xhc3NOYW1lOiAnZmEgZmEtY2lyY2xlLW8nLFxuICB0aXRsZTogJ1BvaW50cyBCcnVzaCdcbn07XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL2JydXNoZXMvUG9pbnRzQnJ1c2guanMiLCIndXNlIHN0cmljdCc7XG5cbnZhciBwYXRoX2luaXRpYWxpemVfb3ZlcndyaXR0ZW4gPSBmYWJyaWMuUGF0aC5wcm90b3R5cGUuaW5pdGlhbGl6ZTtcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuUGF0aC5wcm90b3R5cGUsIHtcbiAgYWNjdXJhY3k6IC0xLFxuICBpbml0aWFsaXplOiBmdW5jdGlvbiAocGF0aCwgb3B0aW9ucykge1xuICAgIHRoaXMuY2FsbFN1cGVyKCdpbml0aWFsaXplJywgb3B0aW9ucyk7XG4gICAgcGF0aF9pbml0aWFsaXplX292ZXJ3cml0dGVuLmNhbGwodGhpcywgcGF0aCwgb3B0aW9ucyk7XG5cbiAgICBpZih0aGlzLmFjY3VyYWN5ICE9IC0xKXtcbiAgICAgIHRoaXMuX3NldF9hY2N1cmFjeSh0aGlzLmFjY3VyYWN5LCB0aGlzLnBhdGgpO1xuICAgIH1cbiAgfSxcbiAgdHJhbnNsYXRlOiBmdW5jdGlvbiAocGF0aCwgdHJhbnNsYXRlWCwgdHJhbnNsYXRlWSkge1xuICAgIHZhciBjdXJyZW50O1xuICAgIC8vaWYodGhpcy5wYXRoWzBdWzBdID09PSBcIm1cIil7XG4gICAgLy8gIHJldHVybjtcbiAgICAvL31cbiAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gcGF0aC5sZW5ndGg7IGkgPCBsZW47ICsraSkge1xuXG4gICAgICBjdXJyZW50ID0gcGF0aFtpXTtcblxuICAgICAgc3dpdGNoIChjdXJyZW50WzBdKSB7IC8vIGZpcnN0IGxldHRlclxuICAgICAgICBjYXNlICdMJzogLy8gbGluZXRvLCBhYnNvbHV0ZVxuICAgICAgICAgIGN1cnJlbnRbMV0gKz0gdHJhbnNsYXRlWDtcbiAgICAgICAgICBjdXJyZW50WzJdICs9IHRyYW5zbGF0ZVk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ0gnOlxuICAgICAgICAgIGN1cnJlbnRbMV0gKz0gdHJhbnNsYXRlWDtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnVic6IC8vIHZlcmljYWwgbGluZXRvLCBhYnNvbHV0ZVxuICAgICAgICAgIGN1cnJlbnRbMV0gKz0gdHJhbnNsYXRlWTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnTSc6XG4gICAgICAgICAgY3VycmVudFsxXSArPSB0cmFuc2xhdGVYO1xuICAgICAgICAgIGN1cnJlbnRbMl0gKz0gdHJhbnNsYXRlWTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnQyc6XG4gICAgICAgICAgY3VycmVudFsxXSArPSB0cmFuc2xhdGVYO1xuICAgICAgICAgIGN1cnJlbnRbMl0gKz0gdHJhbnNsYXRlWTtcbiAgICAgICAgICBjdXJyZW50WzNdICs9IHRyYW5zbGF0ZVg7XG4gICAgICAgICAgY3VycmVudFs0XSArPSB0cmFuc2xhdGVZO1xuICAgICAgICAgIGN1cnJlbnRbNV0gKz0gdHJhbnNsYXRlWDtcbiAgICAgICAgICBjdXJyZW50WzZdICs9IHRyYW5zbGF0ZVk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ1MnOlxuICAgICAgICAgIGN1cnJlbnRbMV0gKz0gdHJhbnNsYXRlWDtcbiAgICAgICAgICBjdXJyZW50WzJdICs9IHRyYW5zbGF0ZVk7XG4gICAgICAgICAgY3VycmVudFszXSArPSB0cmFuc2xhdGVYO1xuICAgICAgICAgIGN1cnJlbnRbNF0gKz0gdHJhbnNsYXRlWTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnUSc6IC8vIHF1YWRyYXRpY0N1cnZlVG8sIGFic29sdXRlXG4gICAgICAgICAgY3VycmVudFsxXSArPSB0cmFuc2xhdGVYO1xuICAgICAgICAgIGN1cnJlbnRbMl0gKz0gdHJhbnNsYXRlWTtcbiAgICAgICAgICBjdXJyZW50WzNdICs9IHRyYW5zbGF0ZVg7XG4gICAgICAgICAgY3VycmVudFs0XSArPSB0cmFuc2xhdGVZO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdUJzpcbiAgICAgICAgICBjdXJyZW50WzFdICs9IHRyYW5zbGF0ZVg7XG4gICAgICAgICAgY3VycmVudFsyXSArPSB0cmFuc2xhdGVZO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdBJzpcbiAgICAgICAgICBjdXJyZW50WzFdICs9IHRyYW5zbGF0ZVg7Ly90b2RvPz9cbiAgICAgICAgICBjdXJyZW50WzJdICs9IHRyYW5zbGF0ZVk7Ly90b2RvID8/XG4gICAgICAgICAgY3VycmVudFs2XSArPSB0cmFuc2xhdGVYO1xuICAgICAgICAgIGN1cnJlbnRbN10gKz0gdHJhbnNsYXRlWTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIF9zZXRfYWNjdXJhY3k6IGZ1bmN0aW9uIChhY2N1cmFjeSwgcGF0aCkge1xuICAgIGZvciAodmFyIGkgPTAgOyBpIDwgcGF0aC5sZW5ndGg7IGkrKykge1xuICAgICAgZm9yICh2YXIgaiA9IDE7IGogPCBwYXRoW2ldLmxlbmd0aDsgaisrKSB7XG4gICAgICAgIHBhdGhbaV1bal0gPSArcGF0aFtpXVtqXS50b0ZpeGVkKHRoaXMuYWNjdXJhY3kpO1xuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgc2V0QWNjdXJhY3k6IGZ1bmN0aW9uIChhY2N1cmFjeSkge1xuICAgIHRoaXMuYWNjdXJhY3kgPSBhY2N1cmFjeTtcbiAgICBpZighdGhpcy5fcG9pbnRzKXJldHVybjtcbiAgICB0aGlzLl9zZXRfYWNjdXJhY3koYWNjdXJhY3ksIHRoaXMucGF0aCk7XG4gIH0sXG4gIHN0b3JlUGF0aEFzU3RyaW5nOiBmYWxzZSxcbiAgX3RvT2JqZWN0X292ZXJ3cml0dGVuOiBmYWJyaWMuUGF0aC5wcm90b3R5cGUudG9PYmplY3QsXG4vL3RvZG8gdXNlIGV2ZW50IFwiYmVmb3JlOm9iamVjdFwiO1xuICB0b09iamVjdDogZnVuY3Rpb24gKHByb3BlcnRpZXNUb0luY2x1ZGUpIHtcblxuICAgIGlmKHRoaXMuYWNjdXJhY3kgIT09IC0xKXtcbiAgICAgIHRoaXMuX3NldF9hY2N1cmFjeSh0aGlzLmFjY3VyYWN5LHRoaXMucGF0aCk7XG4gICAgICB0aGlzLmxlZnQgPSArdGhpcy5sZWZ0LnRvRml4ZWQodGhpcy5hY2N1cmFjeSk7XG4gICAgICB0aGlzLnRvcCAgPSArdGhpcy50b3AudG9GaXhlZCh0aGlzLmFjY3VyYWN5KTtcbiAgICAgIHRoaXMucGF0aE9mZnNldC54ID0gK3RoaXMucGF0aE9mZnNldC54LnRvRml4ZWQodGhpcy5hY2N1cmFjeSk7XG4gICAgICB0aGlzLnBhdGhPZmZzZXQueSA9ICt0aGlzLnBhdGhPZmZzZXQueS50b0ZpeGVkKHRoaXMuYWNjdXJhY3kpO1xuICAgIH1cblxuICAgIHZhciBfb2JqID0gdGhpcy5fdG9PYmplY3Rfb3ZlcndyaXR0ZW4ocHJvcGVydGllc1RvSW5jbHVkZSk7XG5cbiAgICBpZiAodGhpcy5zdG9yZVByb3BlcnRpZXMuaW5kZXhPZihcIipcIikgPT0gLTEpIHtcblxuICAgICAgaWYgKF9vYmoucGF0aE9mZnNldCAmJiB0aGlzLnN0b3JlUHJvcGVydGllcy5pbmRleE9mKFwicGF0aE9mZnNldFwiKSA9PSAtMSkge1xuICAgICAgICB0aGlzLnRyYW5zbGF0ZShfb2JqLnBhdGgsIF9vYmoucGF0aE9mZnNldC54LCBfb2JqLnBhdGhPZmZzZXQueSlcbiAgICAgICAgdGhpcy5fc2V0X2FjY3VyYWN5KHRoaXMuYWNjdXJhY3ksX29iai5wYXRoKTtcbiAgICAgIH1cblxuICAgICAgZm9yICh2YXIgaSBpbiBfb2JqKSB7XG4gICAgICAgIGlmICh0aGlzLnN0b3JlUHJvcGVydGllcy5pbmRleE9mKGkpID09IC0xKSB7XG4gICAgICAgICAgZGVsZXRlIF9vYmpbaV07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGNvbnNvbGUubG9nKFwiISEhXCIpXG4gICAgfVxuICAgIGlmICh0aGlzLnN0b3JlUGF0aEFzU3RyaW5nKSB7XG4gICAgICBfb2JqLnBhdGggPSBfb2JqLnBhdGguam9pbignJylcbiAgICB9XG4gICAgcmV0dXJuIF9vYmo7XG4gIH1cbn0pO1xuXG4vKipcbiAqIENyZWF0ZXMgYW4gaW5zdGFuY2Ugb2YgZmFicmljLlBhdGggZnJvbSBhbiBvYmplY3RcbiAqIEBzdGF0aWNcbiAqIEBtZW1iZXJPZiBmYWJyaWMuUGF0aFxuICogQHBhcmFtIHtPYmplY3R9IG9iamVjdFxuICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgdG8gaW52b2tlIHdoZW4gYW4gZmFicmljLlBhdGggaW5zdGFuY2UgaXMgY3JlYXRlZFxuICovXG5mYWJyaWMuUGF0aC5mcm9tT2JqZWN0ID0gZnVuY3Rpb24gKG9iamVjdCwgY2FsbGJhY2spIHtcbiAgLyogaWYgKHR5cGVvZiBvYmplY3QucGF0aCA9PT0gJ3N0cmluZycpIHtcbiAgIGZhYnJpYy5sb2FkU1ZHRnJvbVVSTChvYmplY3QucGF0aCwgZnVuY3Rpb24gKGVsZW1lbnRzKSB7XG4gICB2YXIgcGF0aCA9IGVsZW1lbnRzWzBdLFxuICAgcGF0aFVybCA9IG9iamVjdC5wYXRoO1xuXG4gICBkZWxldGUgb2JqZWN0LnBhdGg7XG5cbiAgIGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQocGF0aCwgb2JqZWN0KTtcbiAgIHBhdGguc2V0U291cmNlUGF0aChwYXRoVXJsKTtcblxuICAgY2FsbGJhY2socGF0aCk7XG4gICB9KTtcbiAgIH1cbiAgIGVsc2UgeyovXG5cbiAgdmFyIF9zY2FsZWQgPSBvYmplY3Quc2NhbGVYIHx8IG9iamVjdC5zY2FsZVk7XG5cbiAgdmFyIHBhdGggPSBuZXcgZmFicmljLlBhdGgob2JqZWN0LnBhdGgsIG9iamVjdCk7XG5cbiAgaWYoIV9zY2FsZWQpe1xuICAgIGlmKG9iamVjdC53aWR0aCl7XG4gICAgICBwYXRoLnNjYWxlWCA9IG9iamVjdC53aWR0aCAvIHBhdGgud2lkdGg7XG4gICAgfVxuICAgIGlmKG9iamVjdC5oZWlnaHQpe1xuICAgICAgcGF0aC5zY2FsZVkgPSBvYmplY3QuaGVpZ2h0IC8gcGF0aC5oZWlnaHQ7XG4gICAgfVxuICB9XG5cbiAgY2FsbGJhY2sgJiYgY2FsbGJhY2socGF0aCk7XG4gIHJldHVybiBwYXRoO1xuICAvLyB9XG59O1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9zaGFwZXMvcGF0aC5qcyIsIid1c2Ugc3RyaWN0JztcblxucmVxdWlyZShcIi4uL21peGlucy9zdHJva2VNaXhpblwiKTtcbnJlcXVpcmUoXCIuLi9taXhpbnMvY2FjaGVNaXhpblwiKTtcbnJlcXVpcmUoXCIuLi9zaGFwZXMvUGF0aEdyb3VwXCIpO1xucmVxdWlyZShcIi4uL21peGlucy9wcm9wb3J0aWFuYWxTaXplTWl4aW5cIik7XG5yZXF1aXJlKFwiLi4vbW9kdWxlcy9yZXNpemFibGVcIik7XG5cbi8qKlxuICogQGF1dGhvciBEZW5pcyBQb25vbWFyZXZcbiAqIEBlbWFpbCBkZW4ucG9ub21hcmV2QGdtYWlsLmNvbVxuICovXG5mYWJyaWMuQ2xpcGFydCA9IGZhYnJpYy51dGlsLmNyZWF0ZUNsYXNzKFxuICBmYWJyaWMuR3JvdXAsXG4gIGZhYnJpYy5TdHJva2VNaXhpbixcbiAgZmFicmljLkNhY2hlTWl4aW4sXG4gIGZhYnJpYy5JbWFnZU1peGluLCB7XG4gICAgdHlwZTogJ2NsaXBhcnQnLFxuICAgIGNvbG9yczogbnVsbCxcbiAgICBmb3JtYXQ6ICdzdmcnLFxuICAgIHJlc2l6YWJsZTogdHJ1ZSxcbiAgICBwcm9jZXNzaW5nOiBmYWxzZSxcbiAgICBzdGF0ZVByb3BlcnRpZXM6IGZhYnJpYy5Hcm91cC5wcm90b3R5cGUuc3RhdGVQcm9wZXJ0aWVzLmNvbmNhdChbXCJjb2xvcnNcIl0pLFxuICAgIG9wdGlvbnNPcmRlcjogW1wiKlwiLFwiY29sb3JzXCIsXCJlbGVtZW50XCIsXCJ0b29sc1wiXSxcbiAgICBnZXRPcmlnaW5hbFNpemU6IGZ1bmN0aW9uKCl7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB3aWR0aDogdGhpcy5lbGVtZW50LndpZHRoLFxuICAgICAgICBoZWlnaHQ6IHRoaXMuZWxlbWVudC5oZWlnaHRcbiAgICAgIH1cbiAgICB9LFxuICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICBvcHRpb25zIHx8ICggb3B0aW9ucyA9IHt9KTtcblxuICAgICAgaWYgKG9wdGlvbnMuY29uc3RydWN0b3IgIT0gT2JqZWN0KSB7XG5cbiAgICAgICAgdmFyIF9vYmogPSBvcHRpb25zLnRvT2JqZWN0KCk7XG4gICAgICAgIGlmIChvcHRpb25zLmVsZW1lbnQpIHtcbiAgICAgICAgICBfb2JqLmVsZW1lbnQgPSBvcHRpb25zLmVsZW1lbnQuY2xvbmVTeW5jKCk7XG4gICAgICAgICAgX29iai5lbGVtZW50LmNsaXBUbyA9IF9vYmouX2ZhYnJpY19zaGFwZTtcbiAgICAgICAgfVxuICAgICAgICBfb2JqLnNoYXBlID0gb3B0aW9ucy5zaGFwZTtcbiAgICAgICAgb3B0aW9ucyA9IF9vYmo7XG4gICAgICB9XG5cbiAgICAgIHRoaXMub24oe1xuICAgICAgICBcInNjYWxpbmdcIjogdGhpcy51cGRhdGVFbGVtZW50XG4gICAgICB9KTtcblxuICAgICAgdGhpcy5pbml0U2hhcGUob3B0aW9ucyk7XG4gICAgICB0aGlzLl9mYWJyaWNfc2hhcGUuc2V0KHtcbiAgICAgICAgb3BhY2l0eTogMCxcbiAgICAgICAgb3JpZ2luWCA6ICdjZW50ZXInLFxuICAgICAgICBvcmlnaW5ZIDogJ2NlbnRlcicsXG4gICAgICB9KTtcblxuICAgICAgdGhpcy5jYWxsU3VwZXIoJ2luaXRpYWxpemUnLCBbdGhpcy5fZmFicmljX3NoYXBlXSwgb3B0aW9ucyk7XG4gICAgICB0aGlzLl9zZXRXaWR0aEhlaWdodChvcHRpb25zKTtcbiAgICB9LFxuICAgIHNldFNoYXBlOiBmdW5jdGlvbihlbCxjYil7XG5cbiAgICAgIGVsID0gIGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoe1xuICAgICAgICBzdHJva2VXaWR0aEZ1bGw6IHRoaXMuc2hhcGUuc3Ryb2tlV2lkdGhGdWxsLFxuICAgICAgICBzdHJva2VXaWR0aEVtcHR5OiB0aGlzLnNoYXBlLnN0cm9rZVdpZHRoRW1wdHksXG4gICAgICAgIHN0cm9rZVdpZHRoQWN0aXZlOiB0aGlzLnNoYXBlLnN0cm9rZVdpZHRoQWN0aXZlLFxuICAgICAgICBkYXNoQXJyYXkgOiB0aGlzLnNoYXBlLmRhc2hBcnJheSxcbiAgICAgICAgc3Ryb2tlRW1wdHk6ICB0aGlzLnNoYXBlLnN0cm9rZUVtcHR5LFxuICAgICAgICBzdHJva2VGdWxsOiAgdGhpcy5zaGFwZS5zdHJva2VGdWxsLFxuICAgICAgICBzdHJva2VBY3RpdmU6dGhpcy5zaGFwZS5zdHJva2VBY3RpdmVcbiAgICAgIH0sZWwpO1xuXG4gICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgaWYoZWwgJiYgZWwuc3JjICYmICFlbC5wYXRocyl7XG4gICAgICAgIGZhYnJpYy5sb2FkU1ZHRnJvbVVSTChlbC5zcmMsZnVuY3Rpb24ocGF0aHMsb3B0aW9ucykge1xuICAgICAgICAgIGVsLnBhdGhzICA9IHBhdGhzO1xuICAgICAgICAgIGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZWwsb3B0aW9ucyk7XG4gICAgICAgICAgX3RoaXMuX3NldF9zaGFwZShlbCk7XG4gICAgICAgICAgX3RoaXMuYWRkKF90aGlzLl9mYWJyaWNfc2hhcGUpXG4gICAgICAgICAgX3RoaXMuX2FwcGx5X3NoYXBlKCk7XG4gICAgICAgICAgY2IgJiYgY2IoKTtcbiAgICAgICAgfSlcbiAgICAgIH1lbHNle1xuICAgICAgICBfdGhpcy5fc2V0X3NoYXBlKGVsKTtcbiAgICAgICAgX3RoaXMuYWRkKF90aGlzLl9mYWJyaWNfc2hhcGUpO1xuICAgICAgICBfdGhpcy5fYXBwbHlfc2hhcGUoKTtcbiAgICAgICAgY2IgJiYgY2IoKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIHNldEVsZW1lbnQ6IGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICBpZih0aGlzLmVsZW1lbnQpe1xuICAgICAgICB0aGlzLnJlbW92ZSh0aGlzLmVsZW1lbnQpO1xuICAgICAgfVxuICAgICAgaWYoIWVsZW1lbnQpe1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBlbGVtZW50LnNldCh7XG4gICAgICAgIG9yaWdpblggOiAnY2VudGVyJyxcbiAgICAgICAgb3JpZ2luWSA6ICdjZW50ZXInXG4gICAgICB9KTtcbiAgICAgIHRoaXMuYWRkKGVsZW1lbnQpO1xuICAgICAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDtcbiAgICAgIGlmICh0aGlzLmZvcm1hdCA9PT0gJ3BuZycgfHwgdGhpcy5mb3JtYXQgPT09ICdpbWFnZS9wbmcnIHx8IHRoaXMuZm9ybWF0ID09PSAnanBlZycgfHwgdGhpcy5mb3JtYXQgPT09ICdpbWFnZS9qcGVnJykge1xuICAgICAgICB0aGlzLl9jYWNoZSA9IHRoaXMuZWxlbWVudC5fZWxlbWVudDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuX2luaXRfY29sb3JfYXJyYXkoKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuZGlydHkgPSB0cnVlO1xuICAgICAgdGhpcy5jYW52YXMgJiYgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gICAgfSxcbiAgICB1cGRhdGVFbGVtZW50OiBmdW5jdGlvbiAoKSB7XG4gICAgICBpZih0aGlzLmVsZW1lbnQpe1xuICAgICAgICB0aGlzLmVsZW1lbnQuc2NhbGVYID0gdGhpcy53aWR0aCAvIHRoaXMuZWxlbWVudC53aWR0aDtcbiAgICAgICAgdGhpcy5lbGVtZW50LnNjYWxlWSA9IHRoaXMuaGVpZ2h0IC8gdGhpcy5lbGVtZW50LmhlaWdodDtcbiAgICAgIH1cbiAgICAgIGlmKHRoaXMuX2ZhYnJpY19zaGFwZSl7XG4gICAgICAgIHRoaXMuX2ZhYnJpY19zaGFwZS5zZXQoe1xuICAgICAgICAgIHdpZHRoOiB0aGlzLndpZHRoLFxuICAgICAgICAgIGhlaWdodDogdGhpcy5oZWlnaHRcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICB0aGlzLmRpcnR5ID0gdHJ1ZTtcbiAgICB9LFxuICAgIF9yZW5kZXI6IGZ1bmN0aW9uIChjdHgpIHtcbiAgICAgIGN0eC5zYXZlKCk7XG4gICAgICBjdHguc2NhbGUodGhpcy5lbGVtZW50LnNjYWxlWCx0aGlzLmVsZW1lbnQuc2NhbGVZKVxuICAgICAgZm9yICh2YXIgaSA9IDAsIGwgPSB0aGlzLmVsZW1lbnQucGF0aHMubGVuZ3RoOyBpIDwgbDsgKytpKSB7XG4gICAgICAgIHRoaXMuZWxlbWVudC5wYXRoc1tpXS5yZW5kZXIoY3R4LCB0cnVlKTtcbiAgICAgIH1cbiAgICAgIGN0eC5yZXN0b3JlKCk7XG4gICAgfSxcbiAgICAvKipcbiAgICAgKiDQutC+0LHRitC10LrRgiDQs9C+0YLQvtCy0LjRgtGB0Y8g0Log0LfQsNC80LXQvdGDINGE0L7RgtC+XG4gICAgICovXG4gICAgYWN0aXZhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuX2FjdGl2YXRlZCA9IHRydWU7XG4gICAgICB0aGlzLl9mYWJyaWNfc2hhcGUuc2V0T3BhY2l0eSgxKTtcbiAgICAgIHRoaXMudXBkYXRlU3Ryb2tlKCk7XG4gICAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICB9LFxuICAgIC8qKlxuICAgICAqINC60L7QsdGK0LXQutGCINC90LUg0LPQvtGC0L7QstC40YLRgdGPINC6INC30LDQvNC10L3RgyDRhNC+0YLQvlxuICAgICAqL1xuICAgIGRlYWN0aXZhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuX2FjdGl2YXRlZCA9IGZhbHNlO1xuICAgICAgdGhpcy51cGRhdGVTdHJva2UoKTtcbiAgICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgIH0sXG4gICAgX2luaXRfY29sb3JfYXJyYXk6IGZ1bmN0aW9uICgpIHtcblxuICAgICAgdGhpcy5wcm9jZXNzaW5nID0gdHJ1ZTtcbiAgICAgIHRoaXMuX2NvbG9ycyA9IHRoaXMuZWxlbWVudC5leHRyYWN0Q29sb3JzKCk7XG5cbiAgICAgIHRoaXMuY29sb3JzID0gdGhpcy5jb2xvcnMgfHwge307XG5cbiAgICAgIGZvciAodmFyIF9jb2xvciBpbiB0aGlzLmNvbG9ycykge1xuICAgICAgICB0aGlzLnNldENsaXBhcnRDb2xvcihfY29sb3IsIHRoaXMuY29sb3JzW19jb2xvcl0sdHJ1ZSlcbiAgICAgIH1cbiAgICB9LFxuICAgIHNldERhdGE6IGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgdGhpcy5zZXRTcmMoZGF0YS5zcmMpXG4gICAgfSxcbiAgICBzZXRTcmM6IGZ1bmN0aW9uKHNyYyl7XG4gICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgZmFicmljLlBhdGhHcm91cC5mcm9tVVJMKHNyYywgZnVuY3Rpb24gKGVsKSB7XG4gICAgICAgIF90aGlzLnNldEVsZW1lbnQoZWwpO1xuICAgICAgICBfdGhpcy5tYWtlQWN0aW9ucygpO1xuICAgICAgLy8gIF90aGlzLmNhbnZhcy5jcmVhdGVGbG9hdGVkTWVudShfdGhpcy5hcHBsaWNhdGlvbi5vYmplY3RzVG9vbGJhck9wdGlvbnMpO1xuICAgICAgfSx7XG4gICAgICAgIHdpZHRoOiB0aGlzLndpZHRoLFxuICAgICAgICBoZWlnaHQ6IHRoaXMuaGVpZ2h0XG4gICAgICB9KTtcbiAgICB9LFxuICAgIC8vIHJlbmRlcjogZnVuY3Rpb24gKGN0eCkge1xuICAgIC8vICAgLy8gdmFyIHggPSBub1RyYW5zZm9ybSA/IDAgOiAtIHRoaXMud2lkdGggKiB0aGlzLnNjYWxlWCAvIDIsXG4gICAgLy8gICAvLyAgIHkgPSBub1RyYW5zZm9ybSA/IDAgOiAtIHRoaXMuaGVpZ2h0ICogdGhpcy5zY2FsZVkgLyAyO1xuICAgIC8vICAgLy9cbiAgICAvLyAgIC8vIGN0eC5zYXZlKCk7XG4gICAgLy8gICAvLyBjdHgudHJhbnNsYXRlKHgseSk7XG4gICAgLy8gICBmYWJyaWMuR3JvdXAucHJvdG90eXBlLnJlbmRlci5hcHBseSh0aGlzLGFyZ3VtZW50cylcbiAgICAvLyAgIC8vIGN0eC5yZXN0b3JlKCk7XG4gICAgLy8gfSxcbiAgICBzZXRDbGlwYXJ0Q29sb3I6IGZ1bmN0aW9uIChrZXksIHZhbHVlLCBwcmV2ZW50Q2FjaGVVcGRhdGUpIHtcblxuICAgICAgaWYgKCF2YWx1ZSkge1xuICAgICAgICB2YWx1ZSA9IGtleTtcbiAgICAgICAgZGVsZXRlIHRoaXMuY29sb3JzW2tleV07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmNvbG9yc1trZXldID0gdmFsdWU7XG4gICAgICB9XG4gICAgICB2YXIgX2NvbG9ycyA9IHRoaXMuX2NvbG9yc1trZXldO1xuICAgICAgZm9yICh2YXIgaSBpbiBfY29sb3JzKSB7XG4gICAgICAgIGlmIChfY29sb3JzW2ldLmNvbG9yKSB7XG4gICAgICAgICAgX2NvbG9yc1tpXS5jb2xvci5maWxsID0gdmFsdWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKF9jb2xvcnNbaV0uc3RvcCkge1xuICAgICAgICAgIF9jb2xvcnNbaV0uc3RvcC5jb2xvciA9IHZhbHVlO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHRoaXMuZGlydHkgPSB0cnVlO1xuICAgICAgdGhpcy5jYW52YXMgJiYgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gICAgfSxcbiAgICBnZXRTcmM6IGZ1bmN0aW9uKCl7XG4gICAgICByZXR1cm4gdGhpcy5zcmMgfHwgdGhpcy5lbGVtZW50LnNyYztcbiAgICB9LFxuICAgIHRvT2JqZWN0OiBmdW5jdGlvbiAocHJvcGVydGllc1RvSW5jbHVkZSkge1xuICAgICAgdmFyIG9iaiA9IGZhYnJpYy5PYmplY3QucHJvdG90eXBlLnRvT2JqZWN0LmNhbGwodGhpcyk7XG4gICAgICBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKG9iaix7XG4gICAgICAgIHNyYzogdGhpcy5zcmMgfHwgdGhpcy5lbGVtZW50LnNyYyxcbiAgICAgICAgY29sb3JzOiB0aGlzLmNvbG9yc1xuICAgICAgfSlcbiAgICAgIHJldHVybiBvYmo7XG4gICAgfSxcbiAgICBhY3Rpb25zOiAge1xuICAgICAgc291cmNlOiB7XG4gICAgICAgIHR5cGU6ICdlZmZlY3QnLFxuICAgICAgICBjbGFzc05hbWU6ICdmYSBmYS1maWxlLWltYWdlLW8nLFxuICAgICAgICB0aXRsZTogXCJzb3VyY2VcIixcbiAgICAgICAgYWN0aW9uUGFyYW1ldGVyczogZnVuY3Rpb24gKCRlbGVtZW50LCBkYXRhKSB7XG4gICAgICAgICAgdGhpcy5hcHBsaWNhdGlvbi5jcmVhdGVFbGVtZW50c0xpc3QoJGVsZW1lbnQsIHRoaXMuYXBwbGljYXRpb24uZ2V0TGlicmFyeUVsZW1lbnRzKHtjYXRlZ29yeTogXCJjbGlwYXJ0XCJ9KSApO1xuICAgICAgICAvLyAgZGF0YS50YXJnZXQuYXBwbGljYXRpb24uY3JlYXRlR2FsbGVyeShkYXRhLnRhcmdldCwgJGVsLCBkYXRhKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGNvbG9yczoge1xuICAgICAgICB0eXBlOiAnbWVudScsXG4gICAgICAgIHRpdGxlOiAnY29sb3IgbWVudScsXG4gICAgICAgIG1lbnU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICB2YXIgX21lbnUgPSBbXTtcbiAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gdGhpcy5fY29sb3JzKSB7XG4gICAgICAgICAgICBfbWVudS5wdXNoKHtcbiAgICAgICAgICAgICAgdGl0bGU6IFwiQ29sb3IgKFwiICsga2V5ICsgXCIpXCIsXG4gICAgICAgICAgICAgIHZhbHVlOiB7XG4gICAgICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiBrZXksXG4gICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuY29sb3JzW2tleV0gfHwga2V5LFxuICAgICAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29sb3JzW2tleV0gfHwga2V5O1xuICAgICAgICAgICAgICAgIH0uYmluZCh0aGlzLCBrZXkpLFxuICAgICAgICAgICAgICAgIHNldDogdGhpcy5zZXRDbGlwYXJ0Q29sb3IuYmluZCh0aGlzLCBrZXkpXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIHR5cGU6IFwiY29sb3JcIlxuICAgICAgICAgICAgfSlcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIF9tZW51O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG4pO1xuXG5mYWJyaWMuQ2xpcGFydC5hc3luYyA9IHRydWU7XG5cbi8qKlxuICogQ3JlYXRlcyBmYWJyaWMuUGF0aEdyb3VwIGluc3RhbmNlIGZyb20gYW4gb2JqZWN0IHJlcHJlc2VudGF0aW9uXG4gKiBAc3RhdGljXG4gKiBAbWVtYmVyT2YgZmFicmljLlBhdGhHcm91cFxuICogQHBhcmFtIHtPYmplY3R9IG9iamVjdCBPYmplY3QgdG8gY3JlYXRlIGFuIGluc3RhbmNlIGZyb21cbiAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIHRvIGludm9rZSB3aGVuIGFuIGZhYnJpYy5QYXRoR3JvdXAgaW5zdGFuY2UgaXMgY3JlYXRlZFxuICovXG5mYWJyaWMuQ2xpcGFydC5mcm9tT2JqZWN0ID0gZnVuY3Rpb24gKG9iamVjdCwgY2FsbGJhY2spIHtcbiAgaWYgKHR5cGVvZiBvYmplY3Quc3JjID09PSAnc3RyaW5nJykge1xuICAgIGlmIChvYmplY3QuZm9ybWF0ID09PSAncG5nJyB8fCBvYmplY3QuZm9ybWF0ID09PSBcImltYWdlL3BuZ1wiIHx8IG9iamVjdC5mb3JtYXQgPT09ICdqcGVnJyB8fCBvYmplY3QuZm9ybWF0ID09PSBcImltYWdlL2pwZWdcIikge1xuICAgICAgZmFicmljLkltYWdlLmZyb21VUkwob2JqZWN0LnNyYywgZnVuY3Rpb24gKGVsKSB7XG4gICAgICAgIG9iamVjdC5lbGVtZW50ID0gZWw7XG4gICAgICAgIG9iamVjdC5lbGVtZW50LnNyYyA9IG9iamVjdC5zcmM7XG4gICAgICAgIGNhbGxiYWNrKG5ldyBmYWJyaWMuQ2xpcGFydChvYmplY3QpKTtcbiAgICAgIH0sIHtcbiAgICAgICAgd2lkdGg6IG9iamVjdC53aWR0aCB8fCBmYWJyaWMuQ2xpcGFydC5wcm90b3R5cGUud2lkdGgsXG4gICAgICAgIGhlaWdodDogb2JqZWN0LmhlaWdodCB8fCBmYWJyaWMuQ2xpcGFydC5wcm90b3R5cGUuaGVpZ2h0XG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgZmFicmljLlBhdGhHcm91cC5mcm9tVVJMKG9iamVjdC5zcmMsIGZ1bmN0aW9uIChlbCkge1xuICAgICAgICBvYmplY3QuZWxlbWVudCA9IGVsO1xuICAgICAgICBvYmplY3QuZWxlbWVudC5zcmMgPSBvYmplY3Quc3JjO1xuICAgICAgICBkZWxldGUgb2JqZWN0LnNyYztcbiAgICAgICAgY2FsbGJhY2sobmV3IGZhYnJpYy5DbGlwYXJ0KG9iamVjdCkpO1xuICAgICAgfSwge1xuICAgICAgICB3aWR0aDogb2JqZWN0LndpZHRoIHx8IGZhYnJpYy5DbGlwYXJ0LnByb3RvdHlwZS53aWR0aCxcbiAgICAgICAgaGVpZ2h0OiBvYmplY3QuaGVpZ2h0IHx8IGZhYnJpYy5DbGlwYXJ0LnByb3RvdHlwZS5oZWlnaHRcbiAgICAgIH0pO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gbmV3IGZhYnJpYy5DbGlwYXJ0KG9iamVjdCk7XG4gIH1cbn07XG5cbmZhYnJpYy51dGlsLmNyZWF0ZUFjY2Vzc29ycyhmYWJyaWMuQ2xpcGFydCk7XG5cbmlmIChmYWJyaWMub2JqZWN0c0xpYnJhcnkpIHtcbiAgZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMub2JqZWN0c0xpYnJhcnksIHtcbiAgICBjbGlwYXJ0OiB7XG4gICAgICBcIndpZHRoXCI6IGZ1bmN0aW9uICh3LCBoKSB7XG4gICAgICAgIHZhciBfYXNwID0gTWF0aC5taW4oMjg1IC8gMzY1LCB3IC8gaCk7XG4gICAgICAgIHJldHVybiB3O1xuICAgICAgfSxcbiAgICAgIFwiaGVpZ2h0XCI6IGZ1bmN0aW9uICh3LCBoKSB7XG4gICAgICAgIHZhciBfYXNwID0gTWF0aC5taW4oMjg1IC8gMzY1LCB3IC8gaCk7XG4gICAgICAgIHJldHVybiBoO1xuICAgICAgfSxcbiAgICAgIFwidHlwZVwiOiBcImNsaXBhcnRcIixcbiAgICAgIFwic3JjXCI6IFwiZGF0YTppbWFnZS9zdmcreG1sO3V0Zjg7YmFzZTY0LFBEOTRiV3dnZG1WeWMybHZiajBpTVM0d0lpQmxibU52WkdsdVp6MGlhWE52TFRnNE5Ua3RNU0kvUGdvOElTMHRJRWRsYm1WeVlYUnZjam9nUVdSdlltVWdTV3hzZFhOMGNtRjBiM0lnTVRrdU1DNHdMQ0JUVmtjZ1JYaHdiM0owSUZCc2RXY3RTVzRnTGlCVFZrY2dWbVZ5YzJsdmJqb2dOaTR3TUNCQ2RXbHNaQ0F3S1NBZ0xTMCtDanh6ZG1jZ2VHMXNibk05SW1oMGRIQTZMeTkzZDNjdWR6TXViM0puTHpJd01EQXZjM1puSWlCNGJXeHVjenA0YkdsdWF6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNVGs1T1M5NGJHbHVheUlnZG1WeWMybHZiajBpTVM0eElpQnBaRDBpVEdGNVpYSmZNU0lnZUQwaU1IQjRJaUI1UFNJd2NIZ2lJSFpwWlhkQ2IzZzlJakFnTUNBMU1USWdOVEV5SWlCemRIbHNaVDBpWlc1aFlteGxMV0poWTJ0bmNtOTFibVE2Ym1WM0lEQWdNQ0ExTVRJZ05URXlPeUlnZUcxc09uTndZV05sUFNKd2NtVnpaWEoyWlNJZ2QybGtkR2c5SWpVeE1uQjRJaUJvWldsbmFIUTlJalV4TW5CNElqNEtQR2MrQ2drOGNHRjBhQ0J6ZEhsc1pUMGlabWxzYkRvalJrWTRRelEyT3lJZ1pEMGlUVEUyTXk0eE9Ea3NOamN1TVRRNFF6RXlPUzQyTVRZc05qY3VNVFE0TERFeU1TNHlNaklzTUN3M09TNHlOVFVzTUVNMU1pNDNNVE1zTUN3eU9DNDRPVFFzTVRZdU56ZzNMREk0TGpnNU5DdzFNQzR6TmpFZ0lDQnpOVGd1TnpVMExEVXdMak0yTVN3ME1TNDVOamNzTVRBNUxqRXhOVXd4TmpNdU1UZzVMRFkzTGpFME9Ib2lMejRLQ1R4d1lYUm9JSE4wZVd4bFBTSm1hV3hzT2lOR1JqaERORFk3SWlCa1BTSk5NelEzTGpnME5TdzJOeTR4TkRoRE16Z3hMalF4T1N3Mk55NHhORGdzTXpnNUxqZ3hNaXd3TERRek1TNDNPQ3d3WXpJMkxqVTBNaXd3TERVd0xqTTJNU3d4Tmk0M09EY3NOVEF1TXpZeExEVXdMak0yTVNBZ0lITXROVGd1TnpVMExEVXdMak0yTVMwME1TNDVOamNzTVRBNUxqRXhOVXd6TkRjdU9EUTFMRFkzTGpFME9Ib2lMejRLUEM5blBnbzhaejRLQ1R4d1lYUm9JSE4wZVd4bFBTSm1hV3hzT2lOR1JrVkNSREk3SWlCa1BTSk5Nek14TGpVME1TdzBOakV1TmpNNVF6TXpNUzQxTkRFc05EZzVMalExTXl3ek1URXVOakkyTERVeE1pd3lOVFlzTlRFeWN5MDNOUzQxTkRFdE1qSXVOVFEzTFRjMUxqVTBNUzAxTUM0ek5qRjJMVGd1TXpremFERTFNQzQxT1RrZ0lDQk1Nek14TGpVME1TdzBOakV1TmpNNWVpSXZQZ29KUEhCaGRHZ2djM1I1YkdVOUltWnBiR3c2STBaR1JVSkVNanNpSUdROUlrMDBOVGt1TXpZNExERTRNaTQ1TVdNek5DNDBORFlzTlRZdU16QXpMRFF3TGpBME1pd3hNREl1TkRZM0xEUXdMakEwTWl3eE1ESXVORFkzYUMweE5pNDNPRGNnSUNCak1Dd3dMREUyTGpjNE55dzBNUzQwTkRNc01UWXVOemczTERZM0xqRTBPR3d0TWpVdU1UZ3RPQzR6T1ROak1Dd3dMREUyTGpjNE55d3pOeTQzTnl3eE5pNDNPRGNzTmpjdU1UUTRZekFzTUM0MU1qVXRNalV1TVRndE9DNHpPVE10TWpVdU1UZ3RPQzR6T1RNZ0lDQnpNVEl1TlRrc01qZ3VNekk0TERndU16a3pMRFF4TGprMk4yTXRNQzR4TlRRc01DNDFNREV0TWpVdU1UZ3RPQzR6T1RNdE1qVXVNVGd0T0M0ek9UTnpOeTR6TkRRc01Ua3VOVGcxTERBc016TXVOVGMwYkMwME1TNDVOamN0TVRZdU56ZzNJQ0FnWXpBc01DMDNMamcwTml3eU5TNDJPREV0T0M0ek9UTXNNalV1TVRoakxURTRMak0yTVMweE5pNDNPRGN0TkRFdU9UWTNMVEkxTGpFNExUUXhMamsyTnkweU5TNHhPRWd4TlRVdU1qYzVZekFzTUMweU15NDJNRGNzT0M0ek9UTXROREV1T1RZM0xESTFMakU0SUNBZ1l5MHdMalUwT0N3d0xqVXRPQzR6T1RNdE1qVXVNVGd0T0M0ek9UTXRNalV1TVRoc0xUUXhMamsyTnl3eE5pNDNPRGRqTFRjdU16UTBMVEV6TGprNE9Td3dMVE16TGpVM05Dd3dMVE16TGpVM05ITXRNalV1TURJMkxEZ3VPRGsxTFRJMUxqRTRMRGd1TXpreklDQWdZeTAwTGpFNU55MHhNeTQyTXprc09DNHpPVE10TkRFdU9UWTNMRGd1TXprekxUUXhMamsyTjNNdE1qVXVNVGdzT0M0NU1UZ3RNalV1TVRnc09DNHpPVE5qTUMweU9TNHpOemNzTVRZdU56ZzNMVFkzTGpFME9Dd3hOaTQzT0RjdE5qY3VNVFE0YkMweU5TNHhPQ3c0TGpNNU15QWdJR013TFRJMUxqY3dOU3d4Tmk0M09EY3ROamN1TVRRNExERTJMamM0TnkwMk55NHhORGhJTVRJdU5UbGpNQ3d3TERVdU5UazFMVFEyTGpFMk5DdzBNQzR3TkRJdE1UQXlMalEyTjBnME5Ua3VNelk0ZWlJdlBnbzhMMmMrQ2p4bGJHeHBjSE5sSUhOMGVXeGxQU0ptYVd4c09pTkdSa0UxTkVJN0lpQmplRDBpTWpVMUxqVXhOeUlnWTNrOUlqSXpNQzQ0TWlJZ2NuZzlJakl3T1M0NE16WWlJSEo1UFNJeE9UY3VNalEySWk4K0NqeG5QZ29KQ2drSlBHVnNiR2x3YzJVZ2RISmhibk5tYjNKdFBTSnRZWFJ5YVhnb0xUQXVOakEwTWlBdE1DNDNPVFk0SURBdU56azJPQ0F0TUM0Mk1EUXlJRFl6TGprME56VWdORGs1TGpnNU1qWXBJaUJ6ZEhsc1pUMGlabWxzYkRvalJrWkZRa1F5T3lJZ1kzZzlJakUxTmk0eE1qTWlJR041UFNJeU16UXVNRFkxSWlCeWVEMGlNemN1TnpZNUlpQnllVDBpTkRZdU1UWXpJaTgrQ2drS0NRazhaV3hzYVhCelpTQjBjbUZ1YzJadmNtMDlJbTFoZEhKcGVDZ3RNQzQyTURReUlEQXVOemsyT0NBdE1DNDNPVFk0SUMwd0xqWXdORElnTnpVMUxqa3lNRFFnT1RJdU56QXpNU2tpSUhOMGVXeGxQU0ptYVd4c09pTkdSa1ZDUkRJN0lpQmplRDBpTXpVMExqa3pOeUlnWTNrOUlqSXpOQzR3T0RZaUlISjRQU0l6Tnk0M05qa2lJSEo1UFNJME5pNHhOak1pTHo0S1BDOW5QZ284Y0dGMGFDQnpkSGxzWlQwaVptbHNiRG9qUmtZNFF6UTJPeUlnWkQwaVRUSTFOUzQxTWpRc01qWXdMakU1TjJndE1DNHdNVE5qTFRJNExqY3hNU3d3TFRVMUxqQTBOU3d4T0M0eU5qZ3ROamd1TlRNMkxEUTNMalV4TVNBZ1l5MHhPQzR4TmpNc016a3VNemMwTFRRd0xqVTNNeXc1TVM0NU9UWXROREF1TlRjekxERXhNUzQ1TmpSb01qRTRMakl5T1dNd0xURTVMamsyTnkweU1pNDBNRGt0TnpJdU5Ua3ROREF1TlRjekxURXhNUzQ1TmpRZ0lFTXpNVEF1TlRZNUxESTNPQzQwTmpRc01qZzBMakl6TkN3eU5qQXVNVGszTERJMU5TNDFNalFzTWpZd0xqRTVOM29pTHo0S1BIQmhkR2dnYzNSNWJHVTlJbVpwYkd3NkkwWkdSRVZDTnpzaUlHUTlJazB6TURRdU56azFMRE0yT1M0ek1URmpMVEU1TGpNNU15d3dMVE0yTGpnMU5TdzJMVFE1TGpJM09Dd3hOUzQxT0RoakxURXlMalF5TWkwNUxqVTRPQzB5T1M0NE9EVXRNVFV1TlRnNExUUTVMakkzT0MweE5TNDFPRGdnSUdNdE16Y3VOamd5TERBdE5qZ3VNak1zTWpJdU5UUTNMVFk0TGpJekxEVXdMak0yTVhNek1DNDFORGdzTlRBdU16WXhMRFk0TGpJekxEVXdMak0yTVdNeE5TNDNNamdzTUN3ek1DNHhPRGN0TXk0NU5EY3NOREV1TnpFMkxURXdMalUxTkNBZ1l6UXVOelkwTFRJdU56TXNNVEF1TXpVM0xUSXVOek1zTVRVdU1USXlMREJqTVRFdU5USTVMRFl1TmpBM0xESTFMams0T0N3eE1DNDFOVFFzTkRFdU56RTJMREV3TGpVMU5HTXpOeTQyT0RJc01DdzJPQzR5TXkweU1pNDFORGNzTmpndU1qTXROVEF1TXpZeElDQlRNelF5TGpRM09Dd3pOamt1TXpFeExETXdOQzQzT1RVc016WTVMak14TVhvaUx6NEtQR2MrQ2drOGNHRjBhQ0J6ZEhsc1pUMGlabWxzYkRvak5EWTBOalUxT3lJZ1pEMGlUVEl4TlM0ek5EUXNNemMwTGprNU1Xd3pNeTQwT0N3ME5DNHlNekpqTXk0ek5UZ3NOQzQwTXpjc01UQXVNREkyTERRdU5ETTNMREV6TGpNNE5Dd3diRE16TGpRNExUUTBMakl6TWlBZ0lHTTBMakU0TkMwMUxqVXlPQ3d3TGpJME1TMHhNeTQwTlRrdE5pNDJPVE10TVRNdU5EVTVhQzAwTGpWakxUSXVOVElzTUMwMUxqQXlOaXd3TGpNM09DMDNMalF6TWl3eExqRXlNbXd0TVRRdU1URTJMRFF1TXpZeFl5MDBMamcwTWl3eExqUTVOaTB4TUM0d01qTXNNUzQwT1RZdE1UUXVPRFkxTERBZ0lDQnNMVEUwTGpFeE5pMDBMak0yTVdNdE1pNDBNRGd0TUM0M05EUXROQzQ1TVRNdE1TNHhNakl0Tnk0ME16SXRNUzR4TWpKb0xUUXVORGs1UXpJeE5TNHhNRE1zTXpZeExqVXpNaXd5TVRFdU1UWXNNelk1TGpRMk15d3lNVFV1TXpRMExETTNOQzQ1T1RGNklpOCtDZ2s4WTJseVkyeGxJSE4wZVd4bFBTSm1hV3hzT2lNME5qUTJOVFU3SWlCamVEMGlNVFUwTGpjNU5pSWdZM2s5SWpJek5TNHdNVFlpSUhJOUlqRTJMamM0TnlJdlBnb0pQR05wY21Oc1pTQnpkSGxzWlQwaVptbHNiRG9qTkRZME5qVTFPeUlnWTNnOUlqTTFOaTR5TXpraUlHTjVQU0l5TXpVdU1ERTJJaUJ5UFNJeE5pNDNPRGNpTHo0S0NUeHdZWFJvSUhOMGVXeGxQU0ptYVd4c09pTTBOalEyTlRVN0lpQmtQU0pOTnpjdU16VTRMRE16TlM0d01ERnNORFl1TWpBMkxUTTNMamd3TldNMExqQXhNaTB6TGpJNE15d3hMakV5TXkwNUxqYzJNUzAwTGpBd01TMDRMamsyT1d3dE5qRXVORGM0TERrdU5TQWdJRU0yTXk0eE1qTXNNekV3TGpnMkxEWTVMall4T0N3ek1qTXVNek14TERjM0xqTTFPQ3d6TXpVdU1EQXhlaUl2UGdvSlBIQmhkR2dnYzNSNWJHVTlJbVpwYkd3Nkl6UTJORFkxTlRzaUlHUTlJazB4TWpFdU5Ea3pMRE00TWk0MU56ZHNNalV1TURVeUxUWTJMamd3TjJNeExqa3lNaTAxTGpFeU5TMDBMalE1TkMwNUxqSTFOaTA0TGpNMk5DMDFMak00Tld3dE5EVXVNVGd6TERRMUxqRTRNeUFnSUVNeE1ERXVOVFUxTERNMk5TNDBNRFlzTVRFeExqQTVPQ3d6TnpRdU5EVTFMREV5TVM0ME9UTXNNemd5TGpVM04zb2lMejRLQ1R4d1lYUm9JSE4wZVd4bFBTSm1hV3hzT2lNME5qUTJOVFU3SWlCa1BTSk5NakkyTGpRd05Td3hNRGt1TVRRNWJDMDJMall6TXkwM01pNDJOamRqTFRndU1UQTJMREV1TXpBNExURTJMakExTWl3ekxqQTBOQzB5TXk0NE1URXNOUzR5TURGc01qRXVOVE15TERZNUxqSXpPU0FnSUVNeU1Ua3VNVElzTVRFMkxqRTFOeXd5TWpZdU9UQXpMREV4TkM0Mk1Ea3NNakkyTGpRd05Td3hNRGt1TVRRNWVpSXZQZ29KUEhCaGRHZ2djM1I1YkdVOUltWnBiR3c2SXpRMk5EWTFOVHNpSUdROUlrMHlPVEV1TWpZekxETTJMalE0TW13dE5pNDJNek1zTnpJdU5qWTNZeTB3TGpRNU9DdzFMalEyTERjdU1qZzBMRGN1TURBM0xEZ3VPVEV6TERFdU56Y3liREl4TGpVek1pMDJPUzR5TXprZ0lDQkRNekEzTGpNeE5Td3pPUzQxTWpjc01qazVMak0yT1N3ek55NDNPU3d5T1RFdU1qWXpMRE0yTGpRNE1ub2lMejRLQ1R4d1lYUm9JSE4wZVd4bFBTSm1hV3hzT2lNME5qUTJOVFU3SWlCa1BTSk5Nek0zTGpNNE55dzBPUzR4TlRac0xUSXdMalV3T1N3ME55NDBORGxqTFRJdU1UTTNMRFF1T1RRMkxEUXVOVFE1TERndU9EWTRMRGN1T0RJekxEUXVOVGc0YkRNeUxqY3pMVFF5TGpjNU1TQWdJRU16TlRBdU9UUTJMRFUxTGpBeExETTBOQzR5TnpFc05URXVPU3d6TXpjdU16ZzNMRFE1TGpFMU5ub2lMejRLQ1R4d1lYUm9JSE4wZVd4bFBTSm1hV3hzT2lNME5qUTJOVFU3SWlCa1BTSk5NVGswTGpFMU55dzVOaTQyTURWc0xUSXdMalV3T1MwME55NDBORGxqTFRZdU9EZzBMREl1TnpRMUxURXpMalUxT1N3MUxqZzFNeTB5TUM0d05EUXNPUzR5TkRkc016SXVOek1zTkRJdU56a2dJQ0JETVRnNUxqWXdPQ3d4TURVdU5EY3pMREU1Tmk0eU9UVXNNVEF4TGpVMU1Td3hPVFF1TVRVM0xEazJMall3TlhvaUx6NEtDVHh3WVhSb0lITjBlV3hsUFNKbWFXeHNPaU0wTmpRMk5UVTdJaUJrUFNKTk1qY3lMakl5TkN3ek5DNHlOVE5qTFRVdU5URTRMVEF1TkRBNExURXhMakEzTnkwd0xqWTNPUzB4Tmk0M01EY3RNQzQyTnpsakxUVXVOak1zTUMweE1TNHhPRGtzTUM0eU56RXRNVFl1TnpBM0xEQXVOamM1SUNBZ2JERXlMakUyT1N3eE1ETXVORFJqTUM0Mk16TXNOUzR6T0N3NExqUTBNaXcxTGpNNExEa3VNRGMxTERCTU1qY3lMakl5TkN3ek5DNHlOVE42SWk4K0NnazhjR0YwYUNCemRIbHNaVDBpWm1sc2JEb2pORFkwTmpVMU95SWdaRDBpVFRRek5DNDROamdzTXpNMUxqQXdNV3d0TkRZdU1qQTJMVE0zTGpnd05XTXROQzR3TVRJdE15NHlPRE10TVM0eE1qTXRPUzQzTmpFc05DNHdNREV0T0M0NU5qbHNOakV1TkRjNExEa3VOU0FnSUVNME5Ea3VNVEEwTERNeE1DNDROaXcwTkRJdU5qQTRMRE15TXk0ek16RXNORE0wTGpnMk9Dd3pNelV1TURBeGVpSXZQZ29KUEhCaGRHZ2djM1I1YkdVOUltWnBiR3c2SXpRMk5EWTFOVHNpSUdROUlrMHpPVEF1TnpNekxETTRNaTQxTnpkc0xUSTFMakExTWkwMk5pNDRNRGRqTFRFdU9USXlMVFV1TVRJMUxEUXVORGswTFRrdU1qVTJMRGd1TXpZMExUVXVNemcxYkRRMUxqRTRNeXcwTlM0eE9ETWdJQ0JETkRFd0xqWTNNU3d6TmpVdU5EQTJMRFF3TVM0eE1qa3NNemMwTGpRMU5Td3pPVEF1TnpNekxETTRNaTQxTnpkNklpOCtDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BDOXpkbWMrQ2c9PVwiXG4gICAgfVxuICB9KTtcbn1cblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvc2hhcGVzL2NsaXBhcnQuanMiLCJmYWJyaWMuU3Ryb2tlTWl4aW4gPSB7XG4gIHNoYXBlOiB7XG4gICAgc3Ryb2tlV2lkdGhGdWxsOiAwLFxuICAgIHN0cm9rZVdpZHRoRW1wdHk6IDIsXG4gICAgc3Ryb2tlV2lkdGhBY3RpdmU6IDIsXG4gICAgc3Ryb2tlRGFzaEFycmF5IDogWzUsNV0sXG4gICAgZmlsbDogXCJ0cmFuc3BhcmVudFwiLFxuICAgIHN0cm9rZUVtcHR5OiAgXCJyZWRcIixcbiAgICBzdHJva2VGdWxsOiAgIFwicmVkXCIsXG4gICAgc3Ryb2tlQWN0aXZlOiBcImdyZWVuXCJcbiAgfSxcbiAgc2V0U2hhcGU6IGZ1bmN0aW9uKGVsLGNiKXtcblxuICAgIGVsID0gIGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoe1xuICAgICAgc3Ryb2tlV2lkdGhGdWxsOiB0aGlzLnNoYXBlLnN0cm9rZVdpZHRoRnVsbCxcbiAgICAgIHN0cm9rZVdpZHRoRW1wdHk6IHRoaXMuc2hhcGUuc3Ryb2tlV2lkdGhFbXB0eSxcbiAgICAgIHN0cm9rZVdpZHRoQWN0aXZlOiB0aGlzLnNoYXBlLnN0cm9rZVdpZHRoQWN0aXZlLFxuICAgICAgZGFzaEFycmF5IDogdGhpcy5zaGFwZS5kYXNoQXJyYXksXG4gICAgICBzdHJva2VFbXB0eTogIHRoaXMuc2hhcGUuc3Ryb2tlRW1wdHksXG4gICAgICBzdHJva2VGdWxsOiAgdGhpcy5zaGFwZS5zdHJva2VGdWxsLFxuICAgICAgc3Ryb2tlQWN0aXZlOnRoaXMuc2hhcGUuc3Ryb2tlQWN0aXZlXG4gICAgfSxlbCk7XG5cblxuICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgaWYoZWwgJiYgZWwuc3JjICYmICFlbC5wYXRocyl7XG4gICAgICBmYWJyaWMubG9hZFNWR0Zyb21VUkwoZWwuc3JjLGZ1bmN0aW9uKHBhdGhzLG9wdGlvbnMpIHtcbiAgICAgICAgZWwucGF0aHMgID0gcGF0aHM7XG4gICAgICAgIGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZWwsb3B0aW9ucyk7XG4gICAgICAgIF90aGlzLl9zZXRfc2hhcGUoZWwpO1xuICAgICAgICBfdGhpcy5hZGQoX3RoaXMuX2ZhYnJpY19zaGFwZSlcbiAgICAgICAgX3RoaXMuX2FwcGx5X3NoYXBlKCk7XG4gICAgICAgIGNiICYmIGNiKCk7XG4gICAgICB9KVxuICAgIH1lbHNle1xuICAgICAgX3RoaXMuX3NldF9zaGFwZShlbCk7XG4gICAgICBfdGhpcy5hZGQoX3RoaXMuX2ZhYnJpY19zaGFwZSk7XG4gICAgICBfdGhpcy5fYXBwbHlfc2hhcGUoKTtcbiAgICAgIGNiICYmIGNiKCk7XG4gICAgfVxuICB9LFxuICBpbml0U2hhcGU6IGZ1bmN0aW9uKG9wdGlvbnMpe1xuXG4gICAgdmFyIF9zaGFwZU9wdGlvbnMgPSBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKG9wdGlvbnMuc2hhcGUgfHwge30gLCB0aGlzLnNoYXBlKTtcblxuICAgIHRoaXMuX2ZhYnJpY19zaGFwZSA9ICBuZXcgZmFicmljLlJlY3QoZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCh7fSxfc2hhcGVPcHRpb25zLHtcbiAgICAgIHdpZHRoOiAgICAgICAgICAgIG9wdGlvbnMud2lkdGgsXG4gICAgICBoZWlnaHQ6ICAgICAgICAgICBvcHRpb25zLmhlaWdodCxcbiAgICAgIHN0cm9rZTogICAgICAgICAgIF9zaGFwZU9wdGlvbnMuc3Ryb2tlRW1wdHksXG4gICAgICBzdHJva2VXaWR0aDogICAgICBfc2hhcGVPcHRpb25zLnN0cm9rZVdpZHRoRW1wdHlcbiAgICB9KSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIO+/ve+/ve+/ve+/ve+/ve+/ve+/ve+/ve+/ve+/ve+/ve+/ve+/ve+/vSDvv73vv73vv73vv73vv70g77+977+9IO+/ve+/ve+/ve+/ve+/ve+/ve+/vSDvv73vv73vv73vv73vv73vv73vv70g77+977+977+977+9XG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBfYXBwbHlfc2hhcGU6IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgc2hhcGUgPSB0aGlzLnNoYXBlO1xuXG4gICAgdmFyIF9vZmYgPSBzaGFwZSAmJiBzaGFwZS5vZmZzZXRzO1xuXG4gICAgaWYgKCFfb2ZmKSB7XG4gICAgICBfb2ZmID0gWzAsIDAsIDAsIDBdO1xuICAgIH1cblxuICAgIHZhciBfb2ZmX3VuaXRzID0gc2hhcGUgJiYgc2hhcGUub2Zmc2V0c191bml0cztcblxuICAgIGlmICghX29mZl91bml0cykge1xuICAgICAgLy9pZiAoZnJhbWUuYm9yZGVyX2ltYWdlKSB7dG9kb1xuICAgICAgLy8gICAgX29mZl91bml0cyA9IGZyYW1lLmJvcmRlcl9pbWFnZS53aWR0aF91bml0cyB8fCBbMCwgMCwgMCwgMF07XG4gICAgICAvL30gZWxzZSB7XG4gICAgICBfb2ZmX3VuaXRzID0gWzEsIDEsIDEsIDFdO1xuICAgICAgLy99XG4gICAgfVxuXG4gICAgLyplbHNlIGlmKHNoYXBlLm9mZnNldHMgJiYgc2hhcGUub2Zmc2V0c191bml0cyl7XG4gICAgIHZhciBzID0gdGhpcy5zbGlkZS5zY2FsZVZhbHVlO1xuICAgICB0aGlzLl9mYWJyaWNfc2hhcGUgPSBuZXcgZmFicmljLlJlY3Qoe1xuICAgICBvcmlnaW5YOiAnY2VudGVyJyxcbiAgICAgb3JpZ2luWTogJ2NlbnRlcicsXG4gICAgIHdpZHRoOiAgKHRoaXMuZGF0YS5nZW9tZXRyeS53aWR0aCAtIHNoYXBlLm9mZnNldHNbM10gLSBzaGFwZS5vZmZzZXRzWzFdKSAqIHMsXG4gICAgIGhlaWdodDogKHRoaXMuZGF0YS5nZW9tZXRyeS5oZWlnaHQgLXNoYXBlLm9mZnNldHNbMF0gLSBzaGFwZS5vZmZzZXRzWzJdKSAqIHNcbiAgICAgfSk7Ki9cblxuICAgIF9vZmYgPSB7XG4gICAgICB0b3A6ICAgX29mZlswXSAqIChfb2ZmX3VuaXRzWzBdID8gdGhpcy5oZWlnaHQgLyAxMDAgOiAxKSB8fCAwLFxuICAgICAgcmlnaHQ6IF9vZmZbMV0gKiAoX29mZl91bml0c1sxXSA/IHRoaXMud2lkdGggLyAxMDAgOiAxKSB8fCAwLFxuICAgICAgYm90dG9tOl9vZmZbMl0gKiAoX29mZl91bml0c1syXSA/IHRoaXMuaGVpZ2h0IC8gMTAwIDogMSkgfHwgMCxcbiAgICAgIGxlZnQ6ICBfb2ZmWzNdICogKF9vZmZfdW5pdHNbM10gPyB0aGlzLndpZHRoIC8gMTAwIDogMSkgfHwgMFxuICAgIH07XG5cblxuICAgIHZhciBfdyA9ICh0aGlzLndpZHRoIC0gX29mZi5sZWZ0IC0gX29mZi5yaWdodCApOy8vICp0aGlzLnNsaWRlLnNjYWxlVmFsdWU7XG4gICAgdmFyIF9oID0gKHRoaXMuaGVpZ2h0IC0gX29mZi50b3AgLSBfb2ZmLmJvdHRvbSk7Ly8gKnRoaXMuc2xpZGUuc2NhbGVWYWx1ZTtcblxuXG4gICAgLy9pZih0aGlzLnJlc291cmNlcy5mcmFtZS5kYXRhLnNoYXBlICYmIHRoaXMucmVzb3VyY2VzLmZyYW1lLmRhdGEuc2hhcGUucmFkaXVzKXtcbiAgICAvL1xuICAgIC8vICAgIHRoaXMuX2ZhYnJpY19zaGFwZS5zZXQoe1xuICAgIC8vICAgICAgICBsZWZ0OiAtdGhpcy53aWR0aC8yICArIF9vZmYubGVmdCAsXG4gICAgLy8gICAgICAgIHRvcDogIC10aGlzLmhlaWdodC8yICsgX29mZi50b3AgLFxuICAgIC8vICAgICAgICB3aWR0aDogX3cgLSBfb2ZmLmxlZnQgLV9vZmYucmlnaHQsXG4gICAgLy8gICAgICAgIGhlaWdodDogIF9oIC0gX29mZi50b3AgLV9vZmYuYm90dG9tLFxuICAgIC8vICAgICAgICBzY2FsZVg6ICAxLFxuICAgIC8vICAgICAgICBzY2FsZVk6ICAxXG4gICAgLy8gICAgfSk7XG4gICAgLy99ZWxzZXtcblxuXG4gICAgaWYodGhpcy5zaGFwZS5wYXRoIHx8IHRoaXMuc2hhcGUucGF0aHMgfHwgdGhpcy5zaGFwZS5vZmZzZXRzKXtcbiAgICAgIHZhciBfc3cgPSB0aGlzLnNoYXBlLndpZHRoIHx8IHRoaXMuX2ZhYnJpY19zaGFwZS53aWR0aDtcbiAgICAgIHZhciBfc2ggPSB0aGlzLnNoYXBlLmhlaWdodCB8fCB0aGlzLl9mYWJyaWNfc2hhcGUuaGVpZ2h0O1xuXG4gICAgICBpZih0aGlzLl9mYWJyaWNfc2hhcGUuc3Ryb2tlV2lkdGgpe1xuICAgICAgICBfc3cgKz0gdGhpcy5fZmFicmljX3NoYXBlLnN0cm9rZVdpZHRoIDtcbiAgICAgICAgX3NoICs9IHRoaXMuX2ZhYnJpY19zaGFwZS5zdHJva2VXaWR0aCA7XG4gICAgICB9XG5cbiAgICAgIHZhciBvcHRpb25zID0ge1xuICAgICAgICBsZWZ0OiAgIC10aGlzLndpZHRoIC8gMiArIF9vZmYubGVmdCxcbiAgICAgICAgdG9wOiAgICAtdGhpcy5oZWlnaHQgLyAyICsgX29mZi50b3AsXG4gICAgICAgIHNjYWxlWDogX3cgLyAxMDAgLyAoX3N3IC8gMTAwKSwvLyAqIChzaGFwZS5zY2FsZVggfHwgMSksXG4gICAgICAgIHNjYWxlWTogX2ggLyAxMDAgLyAoX3NoIC8gMTAwKSwvLyAqIChzaGFwZS5zY2FsZVkgfHwgMSlcbiAgICAgICAgYW5nbGU6IDBcbiAgICAgIH07XG4gICAgfWVsc2V7XG4gICAgICB2YXIgb3B0aW9ucyA9IHtcbiAgICAgICAgbGVmdDogICAtdGhpcy53aWR0aCAvIDIgKyBfb2ZmLmxlZnQsXG4gICAgICAgIHRvcDogICAgLXRoaXMuaGVpZ2h0IC8gMiArIF9vZmYudG9wLFxuICAgICAgICB3aWR0aDogICAgX3csLy8gKiAoc2hhcGUuc2NhbGVYIHx8IDEpLFxuICAgICAgICBoZWlnaHQ6ICAgX2gsLy8gKiAoc2hhcGUuc2NhbGVZIHx8IDEpXG4gICAgICAgIGFuZ2xlOiAwXG4gICAgICB9O1xuICAgIH1cblxuICAgIHRoaXMuX2ZhYnJpY19zaGFwZS5zZXQob3B0aW9ucyk7XG5cbiAgICB0aGlzLnVwZGF0ZVN0cm9rZSgpO1xuICAgIHRoaXMuY2FudmFzICYmIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICB9LFxuICBfc2V0X3NoYXBlOiBmdW5jdGlvbiAoc2hhcGUpIHtcblxuICAgIGlmKHRoaXMuX2ZhYnJpY19zaGFwZSl7XG4gICAgICB0aGlzLnJlbW92ZSh0aGlzLl9mYWJyaWNfc2hhcGUpO1xuICAgICAgZGVsZXRlIHRoaXMuX2ZhYnJpY19zaGFwZTtcbiAgICB9XG4gICAgdmFyIF9mYWJyaWNfc2hhcGU7XG4gICAgdmFyIF9vcHRpb25zID0ge1xuICAgICAgZmlsbDogICAgICAgICAgICAgXCJ0cmFuc3BhcmVudFwiLFxuICAgICAgc3Ryb2tlRGFzaEFycmF5IDogdGhpcy5zaGFwZS5kYXNoQXJyYXksXG4gICAgfTtcblxuICAgIHRoaXMuc2hhcGUgPSBzaGFwZTtcblxuICAgIGlmKCFzaGFwZSl7XG4gICAgICBfZmFicmljX3NoYXBlID0gbmV3IGZhYnJpYy5SZWN0KHtcbiAgICAgICAgd2lkdGg6IHRoaXMud2lkdGgsXG4gICAgICAgIGhlaWdodDogdGhpcy5oZWlnaHRcbiAgICAgIH0pO1xuICAgICAgX2ZhYnJpY19zaGFwZS5zZXQoX29wdGlvbnMpXG4gICAgfWVsc2UgaWYgKHNoYXBlLnBhdGhzKSB7XG5cbiAgICAgIGZvcih2YXIgaSBpbiBzaGFwZS5wYXRocyl7XG4gICAgICAgIHNoYXBlLnBhdGhzW2ldLnNldChfb3B0aW9ucylcbiAgICAgIH1cblxuICAgICAgX2ZhYnJpY19zaGFwZSA9IGZhYnJpYy51dGlsLmdyb3VwU1ZHRWxlbWVudHMoc2hhcGUucGF0aHMsIHNoYXBlKTtcbiAgICAgIC8vdGhpcy5fb2JqZWN0cy51bnNoaWZ0KHRoaXMuX29iamVjdHMucG9wKCkpO1xuICAgIH1lbHNlIHtcbiAgICAgIHZhciBwYXRoO1xuXG4gICAgICBpZiAoc2hhcGUucmFkaXVzKSB7XG4gICAgICAgIHBhdGggPSBmYWJyaWMudXRpbC5nZXRSYWRpdXNDbGlwUGF0aChzaGFwZS5yYWRpdXMsIHNoYXBlLnJhZGl1c191bml0cywgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpO1xuICAgICAgICBfZmFicmljX3NoYXBlID0gbmV3IGZhYnJpYy5QYXRoKHBhdGgsIF9vcHRpb25zKTtcbiAgICAgIH0gZWxzZSBpZiAoc2hhcGUucGF0aCkge1xuICAgICAgICBfZmFicmljX3NoYXBlID0gbmV3IGZhYnJpYy5QYXRoKHNoYXBlLnBhdGgsIF9vcHRpb25zKTtcbiAgICAgICAgLy99IGVsc2UgaWYoc2hhcGUub2Zmc2V0cyl7XG4gICAgICAgIC8vICBwYXRoID0gZmFicmljLnV0aWwuZ2V0T2Zmc2V0c0NsaXBQYXRoKHNoYXBlLm9mZnNldHMsIHNoYXBlLm9mZnNldHNfdW5pdHMpXG4gICAgICB9ZWxzZXtcbiAgICAgICAgcGF0aCA9ICAnTSAwIDAgTCB7d2lkdGh9IDAgTCB7d2lkdGh9IHtoZWlnaHR9IEwgMCB7aGVpZ2h0fSB6Jy5mb3JtYXQoZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCh7XG4gICAgICAgICAgd2lkdGg6ICAgICAgICAgICAgMTAwLFxuICAgICAgICAgIGhlaWdodDogICAgICAgICAgIDEwMFxuICAgICAgICB9LHNoYXBlKSk7XG5cbiAgICAgICAgX2ZhYnJpY19zaGFwZSA9IG5ldyBmYWJyaWMuUGF0aChwYXRoLCBfb3B0aW9ucyk7XG4gICAgICAgIC8vXG4gICAgICAgIC8vX2ZhYnJpY19zaGFwZSA9ICBuZXcgZmFicmljLlJlY3QoZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCh7XG4gICAgICAgIC8vICB3aWR0aDogICAgICAgICAgICAxMDAsXG4gICAgICAgIC8vICBoZWlnaHQ6ICAgICAgICAgICAxMDBcbiAgICAgICAgLy99LHNoYXBlKSk7XG5cbiAgICAgIH1cbiAgICB9XG5cblxuICAgIF9mYWJyaWNfc2hhcGUuc2V0KHtcbiAgICAgIHNjYWxlWDogdGhpcy53aWR0aCAgLyBfZmFicmljX3NoYXBlLndpZHRoLFxuICAgICAgc2NhbGVZOiB0aGlzLmhlaWdodCAvIF9mYWJyaWNfc2hhcGUuaGVpZ2h0LFxuICAgICAgcGVyUGl4ZWxUYXJnZXRGaW5kOiB0cnVlLFxuICAgICAgc2VsZWN0YWJsZTogZmFsc2UsXG4gICAgICBvcmlnaW5YOiBcImxlZnRcIixcbiAgICAgIG9yaWdpblk6IFwidG9wXCJcbiAgICB9KTtcblxuXG5cbiAgICB0aGlzLl9mYWJyaWNfc2hhcGUgPSAgX2ZhYnJpY19zaGFwZTtcblxuXG4gICAgaWYodGhpcy5lbGVtZW50KXtcbiAgICAgIHRoaXMuZWxlbWVudC5jbGlwVG8gPSB0aGlzLl9mYWJyaWNfc2hhcGU7XG4gICAgfVxuXG5cbiAgICB0aGlzLnVwZGF0ZVN0cm9rZSgpO1xuXG4gIH0sXG5cbiAgdXBkYXRlU3Ryb2tlOiBmdW5jdGlvbigpe1xuXG4gICAgdmFyIF9zdHJva2UgPSB0aGlzLnNoYXBlLnN0cm9rZTtcbiAgICB2YXIgX3N3ID0gMDtcbiAgICBpZigodGhpcy5fYWN0aXZhdGVkIHx8IHRoaXMuX2NsaXBtb2RlICkmJiB0aGlzLnNoYXBlLnN0cm9rZVdpZHRoQWN0aXZlKXtcbiAgICAgIF9zdyA9IHRoaXMuc2hhcGUuc3Ryb2tlV2lkdGhBY3RpdmVcbiAgICB9ZWxzZSBpZih0aGlzLmVsZW1lbnQgJiYgdGhpcy5zaGFwZS5zdHJva2VXaWR0aEZ1bGwpe1xuICAgICAgX3N3ID0gdGhpcy5zaGFwZS5zdHJva2VXaWR0aEZ1bGw7XG4gICAgfWVsc2UgaWYoIXRoaXMuZWxlbWVudCAmJiB0aGlzLnNoYXBlLnN0cm9rZVdpZHRoRW1wdHkpe1xuICAgICAgX3N3ID0gdGhpcy5zaGFwZS5zdHJva2VXaWR0aEVtcHR5O1xuICAgIH1cbiAgICBpZigodGhpcy5fYWN0aXZhdGVkIHx8IHRoaXMuX2NsaXBtb2RlKSAmJiB0aGlzLnNoYXBlLnN0cm9rZUFjdGl2ZSl7XG4gICAgICBfc3Ryb2tlID0gdGhpcy5zaGFwZS5zdHJva2VBY3RpdmVcbiAgICB9ZWxzZSBpZih0aGlzLmVsZW1lbnQgJiYgdGhpcy5zaGFwZS5zdHJva2VGdWxsKXtcbiAgICAgIF9zdHJva2UgPSB0aGlzLnNoYXBlLnN0cm9rZUZ1bGw7XG4gICAgfWVsc2UgaWYoIXRoaXMuZWxlbWVudCAmJiB0aGlzLnNoYXBlLnN0cm9rZUVtcHR5KXtcbiAgICAgIF9zdHJva2UgPSB0aGlzLnNoYXBlLnN0cm9rZUVtcHR5O1xuICAgIH1cblxuXG4gICAgdmFyIF9zdHJva2VXaWR0aCA9IF9zdyAvIE1hdGgubWF4KHRoaXMuX2ZhYnJpY19zaGFwZS5zY2FsZVgsdGhpcy5fZmFicmljX3NoYXBlLnNjYWxlWSk7XG5cbiAgICBpZih0aGlzLnNoYXBlKXtcbiAgICAgIGlmKHRoaXMuc2hhcGUucGF0aHMgKXtcbiAgICAgICAgZm9yKHZhciBpIGluIHRoaXMuX2ZhYnJpY19zaGFwZS5wYXRocyl7XG4gICAgICAgICAgdGhpcy5fZmFicmljX3NoYXBlLnBhdGhzW2ldLnNldFN0cm9rZVdpZHRoKF9zdHJva2VXaWR0aClcbiAgICAgICAgICB0aGlzLl9mYWJyaWNfc2hhcGUucGF0aHNbaV0uc2V0U3Ryb2tlKF9zdHJva2UpXG4gICAgICAgIH1cbiAgICAgIH1lbHNle1xuICAgICAgICB0aGlzLl9mYWJyaWNfc2hhcGUuc2V0U3Ryb2tlV2lkdGgoX3N0cm9rZVdpZHRoKVxuICAgICAgICB0aGlzLl9mYWJyaWNfc2hhcGUuc2V0U3Ryb2tlKF9zdHJva2UpXG4gICAgICB9XG4gICAgfVxuICB9LFxuICAvKipcbiAgICog0LrQvtCx0YrQtdC60YIg0LPQvtGC0L7QstC40YLRgdGPINC6INC30LDQvNC10L3RgyDRhNC+0YLQvlxuICAgKi9cbiAgYWN0aXZhdGU6IGZ1bmN0aW9uKCl7XG4gICAgdGhpcy5fYWN0aXZhdGVkID0gdHJ1ZTtcbiAgICB0aGlzLl9mYWJyaWNfc2hhcGUuc2V0T3BhY2l0eSgxKTtcbiAgICB0aGlzLnVwZGF0ZVN0cm9rZSgpO1xuICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICB9LFxuICAvKipcbiAgICog0LrQvtCx0YrQtdC60YIg0L3QtSDQs9C+0YLQvtCy0LjRgtGB0Y8g0Log0LfQsNC80LXQvdGDINGE0L7RgtC+XG4gICAqL1xuICBkZWFjdGl2YXRlOiBmdW5jdGlvbigpe1xuICAgIHRoaXMuX2FjdGl2YXRlZCA9IGZhbHNlO1xuICAgIHRoaXMudXBkYXRlU3Ryb2tlKCk7XG4gICAgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gIH0sXG59XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL21peGlucy9zdHJva2VNaXhpbi5qcyIsIlxuZmFicmljLkNhY2hlTWl4aW4gPSB7XG4gIGNhY2hpbmc6IHRydWUsXG4gIGRpcnR5OiB0cnVlLFxuICByZW5kZXI6IGZ1bmN0aW9uICggY3R4KSB7XG5cbiAgICBjdHguc2F2ZSgpO1xuICAgIGlmICh0aGlzLnRyYW5zZm9ybU1hdHJpeCkge1xuICAgICAgY3R4LnRyYW5zZm9ybS5hcHBseShjdHgsIHRoaXMudHJhbnNmb3JtTWF0cml4KTtcbiAgICB9XG4gICAgdGhpcy50cmFuc2Zvcm0oY3R4KTtcblxuICAgIHRoaXMuX3NldFNoYWRvdyhjdHgpO1xuICAgIHRoaXMuY2xpcFRvICYmIGZhYnJpYy51dGlsLmNsaXBDb250ZXh0KHRoaXMsIGN0eCk7XG5cbiAgICBjdHgudHJhbnNsYXRlKC10aGlzLndpZHRoIC8gMiwgLXRoaXMuaGVpZ2h0IC8gMik7XG5cbiAgICBpZiAodGhpcy5jYWNoaW5nKSB7XG4gICAgICBpZih0aGlzLmRpcnR5ICkge1xuXG4gICAgICAgIGlmKCF0aGlzLl9jYWNoZSl7XG4gICAgICAgICAgdGhpcy5fY2FjaGUgPSBmYWJyaWMudXRpbC5jcmVhdGVDYW52YXNFbGVtZW50V2l0aFNpemUodGhpcyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5lbGVtZW50KSB7XG4gICAgICAgICAgdGhpcy5fY2FjaGUud2lkdGggPSB0aGlzLndpZHRoO1xuICAgICAgICAgIHRoaXMuX2NhY2hlLmhlaWdodCA9IHRoaXMuaGVpZ2h0O1xuICAgICAgICAgIHZhciBjYWNoZUN0eCA9IHRoaXMuX2NhY2hlLmdldENvbnRleHQoXCIyZFwiKTtcbiAgICAgICAgICBjYWNoZUN0eC5jbGVhclJlY3QoMCwgMCwgdGhpcy5fY2FjaGUud2lkdGgsIHRoaXMuX2NhY2hlLmhlaWdodClcbiAgICAgICAgICB0aGlzLl9yZW5kZXIoY2FjaGVDdHgpO1xuICAgICAgICAgIHRoaXMuZGlydHkgPSBmYWxzZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLl9jYWNoZSA9IG51bGw7XG4gICAgICAgICAgdGhpcy5kaXJ0eSA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmKHRoaXMuX2NhY2hlKXtcbiAgICAgICAgY3R4LmRyYXdJbWFnZSh0aGlzLl9jYWNoZSwgMCwgMCwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQsMCwgMCwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpO1xuICAgICAgfVxuICAgIH1lbHNle1xuICAgICAgdGhpcy5fcmVuZGVyKGN0eCk7XG4gICAgfVxuXG4gICAgdGhpcy5jbGlwVG8gJiYgY3R4LnJlc3RvcmUoKTtcbiAgICBjdHgucmVzdG9yZSgpO1xuICB9XG5cbn07XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL21peGlucy9jYWNoZU1peGluLmpzIiwiXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5QYXRoR3JvdXAucHJvdG90eXBlLHtcbiAgaW5pdGlhbGl6ZV9vdmVyd3JpdHRlbjogZmFicmljLlBhdGhHcm91cC5wcm90b3R5cGUuaW5pdGlhbGl6ZSxcbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24ocGF0aHMsIG9wdGlvbnMpe1xuXG4gICAgaWYocGF0aHMuY29uc3RydWN0b3IgIT0gQXJyYXkpe1xuICAgICAgb3B0aW9ucyA9IHBhdGhzLnRvT2JqZWN0KCk7XG4gICAgICBkZWxldGUgb3B0aW9ucy5wYXRocztcbiAgICAgIHBhdGhzID0gcGF0aHMucGF0aHM7XG4gICAgfVxuXG4gICAgdGhpcy5pbml0aWFsaXplX292ZXJ3cml0dGVuKHBhdGhzLCBvcHRpb25zKTtcbiAgfSxcbiAgZXh0cmFjdENvbG9yczogZnVuY3Rpb24gKCkge1xuICAgIHZhciBfY29sb3JzID0ge307XG4gICAgdmFyIF9wYXRocyA9IHRoaXMucGF0aHM7XG4gICAgZm9yICh2YXIgaSBpbiBfcGF0aHMpIHtcbiAgICAgIGlmIChfcGF0aHNbaV0uZmlsbC50eXBlKSB7XG4gICAgICAgIGZvciAodmFyIGogaW4gX3BhdGhzW2ldLmZpbGwuY29sb3JTdG9wcykge1xuICAgICAgICAgIHZhciBfY29sb3IgPSBfcGF0aHNbaV0uZmlsbC5jb2xvclN0b3BzW2pdLmNvbG9yO1xuICAgICAgICAgIGlmICghX2NvbG9yc1tfY29sb3JdKSBfY29sb3JzW19jb2xvcl0gPSBbXTtcbiAgICAgICAgICBfY29sb3JzW19jb2xvcl0ucHVzaCh7b2JqZWN0OiBfcGF0aHNbaV0sIHN0b3A6IF9wYXRoc1tpXS5maWxsLmNvbG9yU3RvcHNbal19KTtcbiAgICAgICAgfVxuXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgX2NvbG9yID0gX3BhdGhzW2ldLmZpbGw7XG4gICAgICAgIGlmICghX2NvbG9yc1tfY29sb3JdKSBfY29sb3JzW19jb2xvcl0gPSBbXTtcbiAgICAgICAgX2NvbG9yc1tfY29sb3JdLnB1c2goe29iamVjdDogX3BhdGhzW2ldLCBjb2xvcjogX3BhdGhzW2ldfSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBfY29sb3JzO1xuICB9XG59KVxuXG5mYWJyaWMuUGF0aEdyb3VwLmZyb21FbGVtZW50cyA9IGZ1bmN0aW9uIChlbGVtZW50cywgb2JqZWN0LCB1cmwpIHtcbiAgdmFyIF9vcHRpb25zID0ge1xuICAgIHRvQmVQYXJzZWQ6IHRydWUsXG4gICAgLy9vcmlnaW5YOiBcImNlbnRlclwiLFxuICAgIC8vb3JpZ2luWTogXCJjZW50ZXJcIlxuICB9O1xuXG4gIC8v0YHQvNC10YnQsNC10Lwg0Y3Qu9C10LzQtdC90YLRiyDRgtCw0LosINGH0YLQvtCx0Ysg0LjRhSDQutC+0L7RgNC40L3QsNGC0Ysg0L3QsNGH0LjQvdCw0LvQuNGB0Ywg0L7RgiAwLjBcbiAgaWYgKGVsZW1lbnRzLmxlbmd0aCkge1xuXG4gICAgdmFyIG1pblggPSBJbmZpbml0eSxcbiAgICAgIG1pblkgPSBJbmZpbml0eTtcbiAgICBmb3IgKHZhciBpIGluIGVsZW1lbnRzKSB7XG4gICAgICBtaW5YID0gTWF0aC5taW4oZWxlbWVudHNbaV0ubGVmdCwgbWluWCk7XG4gICAgICBtaW5ZID0gTWF0aC5taW4oZWxlbWVudHNbaV0udG9wLCBtaW5ZKTtcbiAgICB9XG5cblxuICAgIG1pblggPSBNYXRoLm1heChtaW5YLCAwKTtcbiAgICBtaW5ZID0gTWF0aC5tYXgobWluWSwgMCk7XG4gICAgLyogZm9yICh2YXIgaSBpbiBlbGVtZW50cykge1xuICAgICBlbGVtZW50c1tpXS50cmFuc2xhdGUoLW1pblgsIC1taW5ZKTtcbiAgICAgZWxlbWVudHNbaV0ubGVmdCAtPSBtaW5YO1xuICAgICBlbGVtZW50c1tpXS5wYXRoT2Zmc2V0LnggLT0gbWluWDtcbiAgICAgZWxlbWVudHNbaV0udG9wIC09IG1pblk7XG4gICAgIGVsZW1lbnRzW2ldLnBhdGhPZmZzZXQueSAtPSBtaW5ZO1xuICAgICB9Ki9cbiAgfVxuXG4gIHZhciBlbCA9IGZhYnJpYy51dGlsLmdyb3VwU1ZHRWxlbWVudHMoZWxlbWVudHMsIF9vcHRpb25zLCB1cmwpO1xuXG4gIHZhciBzY2FsZVggPSBvYmplY3Qud2lkdGggPyBvYmplY3Qud2lkdGggLyBlbC53aWR0aCA6IG51bGwsXG4gICAgc2NhbGVZID0gb2JqZWN0LmhlaWdodCA/IG9iamVjdC5oZWlnaHQgLyBlbC5oZWlnaHQgOiBudWxsO1xuICBpZiAoc2NhbGVYICYmICFzY2FsZVkpIHtcbiAgICBzY2FsZVkgPSBzY2FsZVg7XG4gIH1cbiAgaWYgKHNjYWxlWSAmJiAhc2NhbGVYKSB7XG4gICAgc2NhbGVYID0gc2NhbGVZO1xuICB9XG4gIGlmICghc2NhbGVZICYmICFzY2FsZVgpIHtcbiAgICBzY2FsZVggPSBzY2FsZVkgPSAxO1xuICB9XG5cbiAgZGVsZXRlIG9iamVjdC5oZWlnaHQ7XG4gIGRlbGV0ZSBvYmplY3Qud2lkdGg7XG4gIGVsLnNldChmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKG9iamVjdCwge1xuICAgIC8vbGVmdDogMCwgdG9wOiAwLFxuICAgIHNjYWxlWDogc2NhbGVYLFxuICAgIHNjYWxlWTogc2NhbGVZXG4gIH0pKTtcbiAgZWwuc2V0TGVmdChvYmplY3QubGVmdCk7XG4gIGVsLnNldFRvcChvYmplY3QudG9wKTtcbiAgcmV0dXJuIGVsO1xufTtcblxuLy8gZmFicmljLlBhdGhHcm91cC5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24oY3R4LG5vVHJhbnNmb3JtKSB7XG4vLyAgIGlmICghdGhpcy52aXNpYmxlKSB7XG4vLyAgICAgcmV0dXJuO1xuLy8gICB9XG4vLyAgIHZhciB4ID0gbm9UcmFuc2Zvcm0gPyAwIDogLSB0aGlzLndpZHRoICogdGhpcy5zY2FsZVggLyAyLFxuLy8gICAgIHkgPSBub1RyYW5zZm9ybSA/IDAgOiAtIHRoaXMuaGVpZ2h0ICogdGhpcy5zY2FsZVkgLyAyO1xuLy9cbi8vICAgY3R4LnNhdmUoKTtcbi8vICAgY3R4LnRyYW5zbGF0ZSh4LHkpO1xuLy9cbi8vICAgaWYgKHRoaXMudHJhbnNmb3JtTWF0cml4KSB7XG4vLyAgICAgY3R4LnRyYW5zZm9ybS5hcHBseShjdHgsIHRoaXMudHJhbnNmb3JtTWF0cml4KTtcbi8vICAgfVxuLy8gICB0aGlzLnRyYW5zZm9ybShjdHgpO1xuLy9cbi8vICAgdGhpcy5fc2V0U2hhZG93KGN0eCk7XG4vLyAgIHRoaXMuY2xpcFRvICYmIGZhYnJpYy51dGlsLmNsaXBDb250ZXh0KHRoaXMsIGN0eCk7XG4vLyAgIGN0eC50cmFuc2xhdGUoLXRoaXMud2lkdGgvMiwgLXRoaXMuaGVpZ2h0LzIpO1xuLy8gICBmb3IgKHZhciBpID0gMCwgbCA9IHRoaXMucGF0aHMubGVuZ3RoOyBpIDwgbDsgKytpKSB7XG4vLyAgICAgdGhpcy5wYXRoc1tpXS5yZW5kZXIoY3R4LCB0cnVlKTtcbi8vICAgfVxuLy8gICB0aGlzLmNsaXBUbyAmJiBjdHgucmVzdG9yZSgpO1xuLy8gICBjdHgucmVzdG9yZSgpO1xuLy8gfVxuXG5cblxuXG5cblxuZmFicmljLlBhdGhHcm91cC5mcm9tVVJMID0gZnVuY3Rpb24gKHVybCwgY2FsbGJhY2ssIG9iamVjdCkge1xuXG4gIGZhYnJpYy5sb2FkU1ZHRnJvbVVSTCh1cmwsZnVuY3Rpb24oZWxzKXtcblxuICAgIHZhciBlbCA9IG5ldyBmYWJyaWMuUGF0aEdyb3VwKGVscywge3RvQmVQYXJzZWQ6dHJ1ZX0pO1xuXG4gICAgLy8gLy/RgdC80LXRidCw0LXQvCDRjdC70LXQvNC10L3RgtGLINGC0LDQuiwg0YfRgtC+0LHRiyDQuNGFINC60L7QvtGA0LjQvdCw0YLRiyDQvdCw0YfQuNC90LDQu9C40YHRjCDQvtGCIDAuMFxuICAgIC8vIGlmIChlbC5wYXRocy5sZW5ndGgpIHtcbiAgICAvL1xuICAgIC8vICAgdmFyIG1pblggPSBJbmZpbml0eSxcbiAgICAvLyAgICAgbWluWSA9IEluZmluaXR5O1xuICAgIC8vICAgdmFyIG1heFggPSAtSW5maW5pdHksXG4gICAgLy8gICAgIG1heFkgPSAtSW5maW5pdHk7XG4gICAgLy9cbiAgICAvLyAgIGZvciAodmFyIGkgaW4gZWwucGF0aHMpIHtcbiAgICAvLyAgICAgdmFyIF9wID0gZWwucGF0aHNbaV07XG4gICAgLy8gICAgIG1pblggPSBNYXRoLm1pbihfcC5sZWZ0LCBtaW5YKTtcbiAgICAvLyAgICAgbWluWSA9IE1hdGgubWluKF9wLnRvcCwgbWluWSk7XG4gICAgLy8gICAgIG1heFggPSBNYXRoLm1heChfcC5sZWZ0ICsgX3Aud2lkdGgsIG1heFgpO1xuICAgIC8vICAgICBtYXhZID0gTWF0aC5tYXgoX3AudG9wICsgX3AuaGVpZ2h0LCBtYXhZKTtcbiAgICAvLyAgIH1cbiAgICAvL1xuICAgIC8vICAgdmFyIF9XID0gbWF4WCAtIG1pblg7XG4gICAgLy8gICB2YXIgX0ggPSBtYXhZIC0gbWluWTtcbiAgICAvLyAgIC8vXG4gICAgLy8gICAvL1xuICAgIC8vICAgLy8gbWluWCA9IE1hdGgubWF4KG1pblgsIDApO1xuICAgIC8vICAgLy8gbWluWSA9IE1hdGgubWF4KG1pblksIDApO1xuICAgIC8vICAgLyogZm9yICh2YXIgaSBpbiBlbGVtZW50cykge1xuICAgIC8vICAgIGVsZW1lbnRzW2ldLnRyYW5zbGF0ZSgtbWluWCwgLW1pblkpO1xuICAgIC8vICAgIGVsZW1lbnRzW2ldLmxlZnQgLT0gbWluWDtcbiAgICAvLyAgICBlbGVtZW50c1tpXS5wYXRoT2Zmc2V0LnggLT0gbWluWDtcbiAgICAvLyAgICBlbGVtZW50c1tpXS50b3AgLT0gbWluWTtcbiAgICAvLyAgICBlbGVtZW50c1tpXS5wYXRoT2Zmc2V0LnkgLT0gbWluWTtcbiAgICAvLyAgICB9Ki9cbiAgICAvLyB9ZWxzZXtcbiAgICAvLyAgIF9XID0gMTtcbiAgICAvLyAgIF9IID0gMTtcbiAgICAvLyB9XG5cbiAgICB2YXIgc2NhbGVYID0gb2JqZWN0LndpZHRoID8gb2JqZWN0LndpZHRoIC8gZWwud2lkdGggOiBudWxsLFxuICAgICAgc2NhbGVZID0gb2JqZWN0LmhlaWdodCA/IG9iamVjdC5oZWlnaHQgLyBlbC5oZWlnaHQgOiBudWxsO1xuICAgIGlmIChzY2FsZVggJiYgIXNjYWxlWSkge1xuICAgICAgc2NhbGVZID0gc2NhbGVYO1xuICAgIH1cbiAgICBpZiAoc2NhbGVZICYmICFzY2FsZVgpIHtcbiAgICAgIHNjYWxlWCA9IHNjYWxlWTtcbiAgICB9XG4gICAgaWYgKCFzY2FsZVkgJiYgIXNjYWxlWCkge1xuICAgICAgc2NhbGVYID0gc2NhbGVZID0gMTtcbiAgICB9XG4gICAgLy8gY29uc29sZS5sb2cob2JqZWN0LndpZHRoLGVsLndpZHRoLG9iamVjdC5oZWlnaHQsZWwuaGVpZ2h0KVxuICAgIC8vIGNvbnNvbGUubG9nKGVsKTtcbiAgICBlbC5zZXQoIHtcbiAgICAgIHNjYWxlWDogc2NhbGVYICxcbiAgICAgIHNjYWxlWTogc2NhbGVZXG4gICAgfSk7XG5cbiAgICBjYWxsYmFjayhlbCk7XG4gIH0pO1xuXG4gIC8vIGZhYnJpYy5sb2FkU1ZHRnJvbVVSTCh1cmwsZnVuY3Rpb24oZWxzKXtcbiAgLy8gICBjYWxsYmFjayhmYWJyaWMuUGF0aEdyb3VwLmZyb21FbGVtZW50cyhlbHMsIG9iamVjdCkpO1xuICAvLyB9KTtcbn07XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL3NoYXBlcy9QYXRoR3JvdXAuanMiLCIndXNlIHN0cmljdCc7XG5cblxudmFyIF9zZXRfb2JqZWN0X3NjYWxlX292ZXJ3cml0dGVuID0gZmFicmljLkNhbnZhcy5wcm90b3R5cGUuX3NldE9iamVjdFNjYWxlO1xudmFyIF9zZXR1cF9jdXJyZW50X3RyYW5zZm9ybSA9IGZhYnJpYy5DYW52YXMucHJvdG90eXBlLl9zZXR1cEN1cnJlbnRUcmFuc2Zvcm07XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLkNhbnZhcy5wcm90b3R5cGUsIHtcbiAgX3NldHVwQ3VycmVudFNjYWxlVHJhbnNmb3JtOiBfc2V0dXBfY3VycmVudF90cmFuc2Zvcm0sXG4gIF9zZXR1cEN1cnJlbnRUcmFuc2Zvcm06IGZ1bmN0aW9uIChlLCB0YXJnZXQpIHtcbiAgICBpZiAoIXRhcmdldClyZXR1cm47XG4gICAgaWYgKHRhcmdldC5zZXR1cEN1cnJlbnRUcmFuc2Zvcm0pIHtcbiAgICAgIHJldHVybiB0YXJnZXQuc2V0dXBDdXJyZW50VHJhbnNmb3JtKGUpO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAodGFyZ2V0LnJlc2l6YWJsZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5fc2V0dXBDdXJyZW50UmVzaXplVHJhbnNmb3JtKGUsIHRhcmdldCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gdGhpcy5fc2V0dXBDdXJyZW50U2NhbGVUcmFuc2Zvcm0uY2FsbCh0aGlzLCBlLCB0YXJnZXQpO1xuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgX3NldE9iamVjdFNjYWxlOiBmdW5jdGlvbiAobG9jYWxNb3VzZSwgdHJhbnNmb3JtLCBsb2NrU2NhbGluZ1gsIGxvY2tTY2FsaW5nWSwgYnksIGxvY2tTY2FsaW5nRmxpcCwgX2RpbSkge1xuXG4gICAgdmFyIHQgPSB0cmFuc2Zvcm0udGFyZ2V0O1xuXG4gICAgaWYgKCFfZGltKSB7XG4gICAgICB2YXIgc3Ryb2tlV2lkdGggPSB0LnN0cm9rZSA/IHQuc3Ryb2tlV2lkdGggOiAwO1xuICAgICAgX2RpbSA9IHtcbiAgICAgICAgeDogKHQud2lkdGggKyAoc3Ryb2tlV2lkdGggLyAyKSksXG4gICAgICAgIHk6ICh0LmhlaWdodCArIChzdHJva2VXaWR0aCAvIDIpKVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmICh0LnNldE9iamVjdFNjYWxlKSB7XG4gICAgICByZXR1cm4gdC5zZXRPYmplY3RTY2FsZShsb2NhbE1vdXNlLCB0cmFuc2Zvcm0sXG4gICAgICAgIGxvY2tTY2FsaW5nWCwgbG9ja1NjYWxpbmdZLCBieSwgbG9ja1NjYWxpbmdGbGlwLCBfZGltKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICBpZiAodC5yZXNpemFibGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3NldE9iamVjdFNpemUobG9jYWxNb3VzZSwgdHJhbnNmb3JtLFxuICAgICAgICAgIGxvY2tTY2FsaW5nWCwgbG9ja1NjYWxpbmdZLCBieSwgbG9ja1NjYWxpbmdGbGlwLCBfZGltKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBfc2V0X29iamVjdF9zY2FsZV9vdmVyd3JpdHRlbi5jYWxsKHRoaXMsIGxvY2FsTW91c2UsIHRyYW5zZm9ybSxcbiAgICAgICAgICBsb2NrU2NhbGluZ1gsIGxvY2tTY2FsaW5nWSwgYnksIGxvY2tTY2FsaW5nRmxpcCwgX2RpbSk7XG4gICAgICB9XG4gICAgfVxuICB9LFxuICBfc2V0T2JqZWN0U2l6ZTogZnVuY3Rpb24gKGxvY2FsTW91c2UsIHRyYW5zZm9ybSwgbG9ja1NjYWxpbmdYLCBsb2NrU2NhbGluZ1ksIGJ5LCBsb2NrU2NhbGluZ0ZsaXAsIF9kaW0pIHtcblxuICAgIHZhciB0YXJnZXQgPSB0cmFuc2Zvcm0udGFyZ2V0LCBmb3JiaWRTY2FsaW5nWCA9IGZhbHNlLCBmb3JiaWRTY2FsaW5nWSA9IGZhbHNlO1xuICAgIHZhciBfc3Ryb2tlID0gdHJhbnNmb3JtLnRhcmdldC5zdHJva2VXaWR0aCB8fCAwO1xuICAgIHRyYW5zZm9ybS5uZXdXaWR0aCA9IHRoaXMud2lkdGggKiAoKGxvY2FsTW91c2UueCAvIHRyYW5zZm9ybS5zY2FsZVgpIC8gKHRoaXMud2lkdGggKyBfc3Ryb2tlKSk7XG4gICAgdHJhbnNmb3JtLm5ld0hlaWdodCA9IHRoaXMuaGVpZ2h0ICogKChsb2NhbE1vdXNlLnkgLyB0cmFuc2Zvcm0uc2NhbGVZKSAvICh0aGlzLmhlaWdodCArIF9zdHJva2UpKTtcblxuICAgIGlmKHRoaXMud2hvbGVDb29yZGluYXRlcyB8fCB0YXJnZXQud2hvbGVDb29yZGluYXRlcyl7XG4gICAgICB0cmFuc2Zvcm0ubmV3V2lkdGggPSBNYXRoLnJvdW5kKHRyYW5zZm9ybS5uZXdXaWR0aCk7XG4gICAgICB0cmFuc2Zvcm0ubmV3SGVpZ2h0ID0gTWF0aC5yb3VuZCh0cmFuc2Zvcm0ubmV3SGVpZ2h0KTtcbiAgICB9XG4gICAgaWYodHJhbnNmb3JtLm5ld0hlaWdodCA8IDAgKXtcbiAgICAgIHRhcmdldC50b3AgPSB0cmFuc2Zvcm0udG9wIC0gdHJhbnNmb3JtLm5ld0hlaWdodDtcbiAgICB9XG4gICAgaWYgKHRhcmdldC5taW5XaWR0aCAmJiB0cmFuc2Zvcm0ubmV3V2lkdGggPD0gdGFyZ2V0Lm1pbldpZHRoKSB7XG4gICAgICB0cmFuc2Zvcm0ubmV3V2lkdGggPSB0YXJnZXQubWluV2lkdGg7XG4gICAgfVxuICAgIGlmICh0YXJnZXQubWluSGVpZ2h0ICYmIHRyYW5zZm9ybS5uZXdIZWlnaHQgPD0gdGFyZ2V0Lm1pbkhlaWdodCkge1xuICAgICAgdHJhbnNmb3JtLm5ld0hlaWdodCA9IHRhcmdldC5taW5IZWlnaHQ7XG4gICAgfVxuICAgIGlmIChsb2NrU2NhbGluZ0ZsaXAgJiYgdHJhbnNmb3JtLm5ld1dpZHRoIDwgdGFyZ2V0LndpZHRoKSB7XG4gICAgICBmb3JiaWRTY2FsaW5nWCA9IHRydWU7XG4gICAgfVxuICAgIGlmIChsb2NrU2NhbGluZ0ZsaXAgJiYgdHJhbnNmb3JtLm5ld0hlaWdodCA8IHRhcmdldC5oZWlnaHQpIHtcbiAgICAgIGZvcmJpZFNjYWxpbmdZID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBpZiAoYnkgPT09ICdlcXVhbGx5Jykge1xuICAgICAgZm9yYmlkU2NhbGluZ1ggfHwgZm9yYmlkU2NhbGluZ1kgfHwgdGhpcy5fcmVzaXplT2JqZWN0RXF1YWxseShsb2NhbE1vdXNlLCB0YXJnZXQsIHRyYW5zZm9ybSwgX2RpbSk7XG4gICAgfVxuICAgIGVsc2UgaWYgKCFieSkge1xuICAgICAgZm9yYmlkU2NhbGluZ1ggfHwgdGFyZ2V0LnNldFdpZHRoKHRyYW5zZm9ybS5uZXdXaWR0aCk7XG4gICAgICBmb3JiaWRTY2FsaW5nWSB8fCB0YXJnZXQuc2V0SGVpZ2h0KHRyYW5zZm9ybS5uZXdIZWlnaHQpO1xuICAgIH1cbiAgICBlbHNlIGlmIChieSA9PT0gJ3gnICYmICF0YXJnZXQuZ2V0KCdsb2NrVW5pU2NhbGluZycpKSB7XG4gICAgICBmb3JiaWRTY2FsaW5nWCB8fCB0YXJnZXQuc2V0V2lkdGgodHJhbnNmb3JtLm5ld1dpZHRoKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoYnkgPT09ICd5JyAmJiAhdGFyZ2V0LmdldCgnbG9ja1VuaVNjYWxpbmcnKSkge1xuICAgICAgZm9yYmlkU2NhbGluZ1kgfHwgdGFyZ2V0LnNldEhlaWdodCh0cmFuc2Zvcm0ubmV3SGVpZ2h0KTtcbiAgICB9XG4gICAgcmV0dXJuICFmb3JiaWRTY2FsaW5nWCAmJiAhZm9yYmlkU2NhbGluZ1k7XG4gICAgLy90cmFuc2Zvcm0ubmV3V2lkdGggLT0gX3N0cm9rZTtcbiAgICAvL3RyYW5zZm9ybS5uZXdIZWlnaHQgLT0gX3N0cm9rZTtcbiAgfSxcbiAgX3NldHVwQ3VycmVudFJlc2l6ZVRyYW5zZm9ybTogZnVuY3Rpb24gKGUsIHRhcmdldCkge1xuICAgIHRoaXMuX3NldHVwQ3VycmVudFNjYWxlVHJhbnNmb3JtKGUsIHRhcmdldCk7XG4gICAgdGhpcy5fY3VycmVudFRyYW5zZm9ybS5vcmlnaW5hbC5oZWlnaHQgPSB0YXJnZXQuaGVpZ2h0O1xuICAgIHRoaXMuX2N1cnJlbnRUcmFuc2Zvcm0ub3JpZ2luYWwud2lkdGggPSB0YXJnZXQud2lkdGg7XG4gIH0sXG4gIF9yZXNpemVPYmplY3RFcXVhbGx5OiBmdW5jdGlvbiAobG9jYWxNb3VzZSwgdGFyZ2V0LCB0cmFuc2Zvcm0sIF9kaW0pIHtcblxuICAgIHZhciBkaXN0ID0gbG9jYWxNb3VzZS55ICsgbG9jYWxNb3VzZS54LFxuICAgICAgbGFzdERpc3QgPSBfZGltLnkgKiB0cmFuc2Zvcm0ub3JpZ2luYWwuaGVpZ2h0IC8gdGFyZ2V0LmhlaWdodCArXG4gICAgICAgIF9kaW0ueCAqIHRyYW5zZm9ybS5vcmlnaW5hbC53aWR0aCAvIHRhcmdldC53aWR0aDtcblxuICAgIHRyYW5zZm9ybS5uZXdXaWR0aCA9IHRyYW5zZm9ybS5vcmlnaW5hbC53aWR0aCAqIGRpc3QgLyBsYXN0RGlzdDtcbiAgICB0cmFuc2Zvcm0ubmV3SGVpZ2h0ID0gdHJhbnNmb3JtLm9yaWdpbmFsLmhlaWdodCAqIGRpc3QgLyBsYXN0RGlzdDtcblxuICAgIHZhciByYXRpbyA9IHRyYW5zZm9ybS5vcmlnaW5hbC5oZWlnaHQgLyB0cmFuc2Zvcm0ub3JpZ2luYWwud2lkdGg7XG4gICAgaWYgKHJhdGlvID4gMSkge1xuICAgICAgaWYgKHRhcmdldC5taW5XaWR0aCAmJiB0cmFuc2Zvcm0ubmV3V2lkdGggPD0gdGFyZ2V0Lm1pbldpZHRoKSB7XG4gICAgICAgIHRyYW5zZm9ybS5uZXdXaWR0aCA9IHRhcmdldC5taW5XaWR0aDtcbiAgICAgICAgdHJhbnNmb3JtLm5ld0hlaWdodCA9IHRhcmdldC5taW5IZWlnaHQgKiByYXRpbztcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHRhcmdldC5taW5IZWlnaHQgJiYgdHJhbnNmb3JtLm5ld0hlaWdodCA8PSB0YXJnZXQubWluSGVpZ2h0KSB7XG4gICAgICAgIHRyYW5zZm9ybS5uZXdIZWlnaHQgPSB0YXJnZXQubWluSGVpZ2h0O1xuICAgICAgICB0cmFuc2Zvcm0ubmV3V2lkdGggPSB0YXJnZXQubWluV2lkdGggLyByYXRpbztcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0YXJnZXQuc2V0V2lkdGgodHJhbnNmb3JtLm5ld1dpZHRoKTtcbiAgICB0YXJnZXQuc2V0SGVpZ2h0KHRyYW5zZm9ybS5uZXdIZWlnaHQpO1xuICB9XG59KTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvbW9kdWxlcy9yZXNpemFibGUuanMiLCIndXNlIHN0cmljdCc7XG5cblxucmVxdWlyZShcIi4uL21vZHVsZXMvcGF0aGZpbmRlclwiKTtcbi8vZmFicmljLnJlcXVpcmUoXCJTbGlkZUltYWdlXCIsW1wiU2xpZGVPYmplY3RcIi8qLFwiUGF0aGZpbmRlclwiKi9dLGZ1bmN0aW9uKCkge1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5JbWFnZS5wcm90b3R5cGUsIHtcbiAgY29udGVudE9mZnNldHM6IG51bGwsXG4gIC8qKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAcGFyYW0ge0NhbnZhc1JlbmRlcmluZ0NvbnRleHQyRH0gY3R4IENvbnRleHQgdG8gcmVuZGVyIG9uXG4gICAqIEBwYXJhbSB7Qm9vbGVhbn0gbm9UcmFuc2Zvcm1cbiAgICovXG4gIF9yZW5kZXI6IGZ1bmN0aW9uIChjdHgsIG5vVHJhbnNmb3JtKSB7XG4gICAgdmFyIHgsIHksIGltYWdlTWFyZ2lucyA9IHRoaXMuX2ZpbmRNYXJnaW5zKCksIGVsZW1lbnRUb0RyYXc7XG5cbiAgICB4ID0gKG5vVHJhbnNmb3JtID8gdGhpcy5sZWZ0IDogLXRoaXMud2lkdGggLyAyKTtcbiAgICB5ID0gKG5vVHJhbnNmb3JtID8gdGhpcy50b3AgOiAtdGhpcy5oZWlnaHQgLyAyKTtcblxuICAgIGlmICh0aGlzLm1lZXRPclNsaWNlID09PSAnc2xpY2UnKSB7XG4gICAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgICBjdHgucmVjdCh4LCB5LCB0aGlzLndpZHRoLCB0aGlzLmhlaWdodCk7XG4gICAgICBjdHguY2xpcCgpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmlzTW92aW5nID09PSBmYWxzZSAmJiB0aGlzLnJlc2l6ZUZpbHRlcnMubGVuZ3RoICYmIHRoaXMuX25lZWRzUmVzaXplKCkpIHtcbiAgICAgIHRoaXMuX2xhc3RTY2FsZVggPSB0aGlzLnNjYWxlWDtcbiAgICAgIHRoaXMuX2xhc3RTY2FsZVkgPSB0aGlzLnNjYWxlWTtcbiAgICAgIGVsZW1lbnRUb0RyYXcgPSB0aGlzLmFwcGx5RmlsdGVycyhudWxsLCB0aGlzLnJlc2l6ZUZpbHRlcnMsIHRoaXMuX2ZpbHRlcmVkRWwgfHwgdGhpcy5fb3JpZ2luYWxFbGVtZW50LCB0cnVlKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICBlbGVtZW50VG9EcmF3ID0gdGhpcy5fZWxlbWVudDtcbiAgICB9XG4gICAgdGhpcy5fcmVuZGVyRmlsbChjdHgpO1xuICAgIGVsZW1lbnRUb0RyYXcgJiYgY3R4LmRyYXdJbWFnZShlbGVtZW50VG9EcmF3LFxuICAgICAgeCArIGltYWdlTWFyZ2lucy5tYXJnaW5YLFxuICAgICAgeSArIGltYWdlTWFyZ2lucy5tYXJnaW5ZLFxuICAgICAgaW1hZ2VNYXJnaW5zLndpZHRoLFxuICAgICAgaW1hZ2VNYXJnaW5zLmhlaWdodFxuICAgICk7XG5cbiAgICB0aGlzLl9zdHJva2UoY3R4KTtcbiAgICB0aGlzLl9yZW5kZXJTdHJva2UoY3R4KTtcbiAgfSxcbiAgaW1hZ2VUb29sczogZmFsc2UsXG4gIHBob3Rvc2hvcFRvb2xzOiBmYWxzZSxcbiAgY2xvbmVTeW5jOiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIF9vYmplY3QgPSB0aGlzLnRvT2JqZWN0KCk7XG4gICAgZGVsZXRlIF9vYmplY3QuZmlsdGVycztcbiAgICB2YXIgY2xvbmUgPSBuZXcgZmFicmljLkltYWdlKHRoaXMuX2VsZW1lbnQsIF9vYmplY3QpO1xuICAgIGNsb25lLl9maWx0ZXJlZEVsID0gdGhpcy5fZmlsdGVyZWRFbDtcbiAgICBjbG9uZS5maWx0ZXJzID0gdGhpcy5maWx0ZXJzO1xuICAgIHJldHVybiBjbG9uZTtcbiAgfSxcbiAgcmV2ZXJ0Q2hhbmdlczogZnVuY3Rpb24gKCkge1xuICAgIHZhciBwYXRoZmluZGVyID0gdGhpcy5jYW52YXMuZ2V0UGF0aGZpbmRlcigpO1xuICAgIGlmIChwYXRoZmluZGVyLnRhcmdldCAmJiBwYXRoZmluZGVyLnRhcmdldCA9PSB0aGlzKSB7XG4gICAgICBwYXRoZmluZGVyLmhpZGUoKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5fZWxlbWVudCA9PSB0aGlzLl9vcmlnaW5hbEVsZW1lbnQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmZpbHRlcnMubGVuZ3RoID0gMDtcbiAgICBpZiAodGhpcy5fZmlsdGVyZWRFbCkge1xuICAgICAgZGVsZXRlIHRoaXMuX2ZpbHRlcmVkRWw7XG4gICAgfVxuICAgIGRlbGV0ZSB0aGlzLl9lZGl0ZWQ7XG4gICAgdGhpcy5fZWxlbWVudCA9IHRoaXMuX29yaWdpbmFsRWxlbWVudDtcblxuICAgIHRoaXMuZmlyZShcImNvbnRlbnQ6bW9kaWZpZWRcIiwge1xuICAgICAgYm91bmRzOiB7bWluWDogMCwgbWluWTogMCwgbWF4WDogdGhpcy5fZWxlbWVudC53aWR0aCwgbWF4WTogdGhpcy5fZWxlbWVudC5oZWlnaHR9XG4gICAgfSk7XG5cblxuICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICB9LFxuICBleHRyYWN0Q29sb3JzOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgX2NvbG9ycyA9IGZhYnJpYy5NYWdpY1dhbmQuZXh0cmFjdENvbG9ycyh0aGlzLl9lbGVtZW50KTtcbiAgICB2YXIgY29sb3JzID0ge307XG4gICAgZm9yKHZhciBpIGluIF9jb2xvcnMpe1xuICAgICAgdmFyIF9zdHIgPSBcInJnYihcIiArIF9jb2xvcnNbaV0uam9pbihcIixcIikgKyBcIilcIjtcbiAgICAgIGNvbG9yc1tfc3RyXSA9IHt9O1xuICAgIH1cbiAgICByZXR1cm4gY29sb3JzO1xuICB9LFxuICBhY3Rpb25zOiBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKCBmYWJyaWMuSW1hZ2UucHJvdG90eXBlLmFjdGlvbnMsIHtcbiAgICBwaG90b3Nob3BUb29sczoge1xuICAgICAgdHlwZTogJ2VmZmVjdCcsXG4gICAgICBlZmZlY3RUcGw6ICc8ZGl2IGlkPVwiZWRpdG9yLXRvb2xzXCIgY2xhc3M9XCJpbmxpbmUtYWN0aW9ucyBjb21wYWN0XCI+PC9kaXY+JyArXG4gICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwiY2hlY2tib2FyZFwiID48ZGl2IGlkPVwicGF0aGZpbmRlclwiPjwvZGl2PjwvZGl2PicsXG4gICAgICBjbGFzc05hbWU6ICdmYSBmYS1wZW5jaWwtc3F1YXJlLW8nLFxuICAgICAgdGl0bGU6IFwiYWR2YW5jZWQgdG9vbHNcIixcbiAgICAgIGFjdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgcGF0aGZpbmRlciA9IHRoaXMuY2FudmFzLmdldFBhdGhmaW5kZXIoKTtcbiAgICAgICAgcGF0aGZpbmRlci50YXJnZXQgPSB0aGlzO1xuICAgICAgICBwYXRoZmluZGVyLnNldFBpY3R1cmUodGhpcy5fZWxlbWVudCk7XG4gICAgICAgIHBhdGhmaW5kZXIuc2hvdygpO1xuICAgICAgfSxcbiAgICAgIGFjdGlvblBhcmFtZXRlcnM6IGZ1bmN0aW9uIChlbCwgZGF0YSkge1xuXG4gICAgICAgIHZhciBwYXRoZmluZGVyID0gdGhpcy5jYW52YXMuZ2V0UGF0aGZpbmRlcigpO1xuICAgICAgICBwYXRoZmluZGVyLmNhbnZhcyA9IHRoaXMuY2FudmFzO1xuXG4gICAgICAgIG5ldyBmYWJyaWMuVG9vbGJhcihwYXRoZmluZGVyLCAnZWRpdG9yLXRvb2xzJyk7XG5cblxuICAgICAgICBwYXRoZmluZGVyLnNldENvbnRhaW5lcigncGF0aGZpbmRlcicpO1xuXG4gICAgICAgIC8vIGlmIChwYXRoZmluZGVyLnRhcmdldClwYXRoZmluZGVyLmhpZGUoKTtcbiAgICAgICAgcGF0aGZpbmRlci50YXJnZXQgPSB0aGlzO1xuICAgICAgICBwYXRoZmluZGVyLnNldFBpY3R1cmUodGhpcy5fZWxlbWVudCk7XG4gICAgICAgIHBhdGhmaW5kZXIuc2hvdygpO1xuICAgICAgfVxuICAgIH0sXG4gICAgcmV2ZXJ0Q2hhbmdlczoge1xuICAgICAgY2xhc3NOYW1lOiAnZmEgZmEtaGlzdG9yeScsXG4gICAgICB0aXRsZTogXCJyZXZlcnQgdG8gb3JpZ25hbCBpbWFnZVwiLFxuICAgICAgYWN0aW9uOiBcInJldmVydENoYW5nZXNcIixcbiAgICAgIG9ic2VydmU6IFwiY29udGVudDptb2RpZmllZFwiLFxuICAgICAgdmlzaWJsZTogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gISF0aGlzLl9maWx0ZXJlZEVsIHx8IHRoaXMuX2VkaXRlZDtcbiAgICAgIH1cbiAgICB9XG4gIH0pXG59KTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvc2hhcGVzL2ltYWdlLnBob3Rvc2hvcC10b29scy5qcyIsIid1c2Ugc3RyaWN0JztcblxuZmFicmljLk1hZ2ljV2FuZCA9IHJlcXVpcmUoJy4uL3BsdWdpbnMvbWFnaWN3YW5kJyk7XG5cbnZhciBNYWdpY1dhbmQgPSBmYWJyaWMuTWFnaWNXYW5kIDtcblxuLyoqXG4gKiBQYXRoZmluZGVyIChQYXRoZmluZGVyKSBJbnRlcmZhY2UgZm9yIE1hZ2ljV2FuZCBzZWxlY3Rpb24gdG9vbFxuICogQHBhcmFtIG9wdGlvbnNcbiAqIEBjb25zdHJ1Y3RvclxuICovXG5mdW5jdGlvbiBQYXRoZmluZGVyKG9wdGlvbnMpIHtcbiAgdGhpcy5pbml0aWFsaXplKG9wdGlvbnMpO1xufVxuXG5QYXRoZmluZGVyLnByb3RvdHlwZSA9IHtcbiAgdHlwZTogJ3BhdGhmaW5kZXInLFxuICBrZWVwT2xkU2VsZWN0aW9uOiB0cnVlLFxuICBhbHBoYUNoYW5uZWw6IHRydWUsXG4gIHBhdGhmaW5kZXJNb2RlOiAnbmV3JyxcbiAgc2VsZWN0aW9uVG9vbDogJ21hZ2ljJyxcbiAgYWRqYWNlbnRQaXhlbHM6IHRydWUsXG4gIGFzeW5jOiBmYWxzZSxcbiAgcGF0aGZpbmRlclRvb2xzOiBmYWxzZSxcbiAgYmx1clJhZGl1czogMCxcbiAgaGF0Y2hMZW5ndGg6IDQsXG4gIGNvbG9yVGhyZXNob2xkOiAxNSxcbiAgc2ltcGxpZnlUb2xlcmFudDogMCxcbiAgc2ltcGxpZnlDb3VudDogMzAsXG4gIGhhdGNoT2Zmc2V0OiAwLFxuICBpbWFnZUluZm86IG51bGwsXG4gIG1hc2s6IG51bGwsXG4gIGRvd25Qb2ludDogbnVsbCxcbiAgYWxsb3dEcmF3OiBmYWxzZSxcbiAgc2hhcGVTZWxlY3Rpb25Ub29sczogZmFsc2UsXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uIChvcHRpb25zKSB7XG5cbiAgICBvcHRpb25zLmFwcGxpY2F0aW9uICYmIG9wdGlvbnMuYXBwbGljYXRpb24uZmlyZSgnZW50aXR5OmNyZWF0ZWQnLHt0YXJnZXQgOiB0aGlzLG9wdGlvbnMgOiBvcHRpb25zfSlcblxuICAgIGZvciAodmFyIGkgaW4gb3B0aW9ucykge1xuICAgICAgdGhpc1tpXSA9IG9wdGlvbnNbaV07XG4gICAgfVxuICB9LFxuICBhc3luY3Jvbm91czogZnVuY3Rpb24gKGNiKSB7XG4gICAgaWYgKHRoaXMuYXN5bmMpIHtcbiAgICAgIHNldFRpbWVvdXQoY2IpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjYigpO1xuICAgIH1cbiAgfSxcbiAgZmlsbFdpdGhDdXJyZW50Q29sb3I6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmZpbGwodGhpcy5jb2xvcik7XG4gIH0sXG4gIGNsZWFyTWVtb3J5OiBmdW5jdGlvbiAoKSB7XG4gICAgZGVsZXRlIHRoaXMucmVzdWx0Q2FudmFzO1xuICAgIGRlbGV0ZSB0aGlzLmVkaXRlZEltYWdlQ2FudmFzO1xuICAgIGRlbGV0ZSB0aGlzLnRlc3RfcGljdHVyZTtcbiAgICBkZWxldGUgdGhpcy5tYXNrO1xuICB9LFxuICBoaWRlOiBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKHRoaXMuZWRpdGVkSW1hZ2VDYW52YXMpIHtcbiAgICAgIHRoaXMuZWRpdGVkSW1hZ2VDYW52YXMucmVtb3ZlKCk7XG4gICAgICB0aGlzLnJlc3VsdENhbnZhcy5yZW1vdmUoKTtcbiAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5pbnRlcnZhbCk7XG4gICAgICB0aGlzLmNsZWFyTWVtb3J5KCk7XG4gICAgICB0aGlzLmZpcmUoJ2hpZGRlbicpO1xuICAgIH1cbiAgfSxcbiAgc2V0Q29udGFpbmVyOiBmdW5jdGlvbiAoY29udGFpbmVyKSB7XG4gICAgaWYgKGNvbnRhaW5lci5jb25zdHJ1Y3RvciA9PT0gU3RyaW5nKSB7XG4gICAgICBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjb250YWluZXIpO1xuICAgIH1cbiAgICB0aGlzLmNvbnRhaW5lciA9IGNvbnRhaW5lcjtcblxuICAgIHRoaXMudGVzdF9waWN0dXJlID0gbmV3IEltYWdlKCk7XG4gICAgdGhpcy50ZXN0X3BpY3R1cmUub25sb2FkID0gdGhpcy5pbml0Q2FudmFzLmJpbmQodGhpcyk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG4gIGdldFNlbGVjdGlvblRvb2w6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5zZWxlY3Rpb25Ub29sO1xuICB9LFxuICBzZXRTZWxlY3Rpb25Ub29sOiBmdW5jdGlvbiAodG9vbCkge1xuICAgIHRoaXMuc2VsZWN0aW9uVG9vbCA9IHRvb2w7XG4gICAgdGhpcy5kb3duUG9pbnQgPSBmYWxzZSA7XG4gICAgdGhpcy5maXJlKCd0b29sOmNoYW5nZWQnLCB0b29sKTtcbiAgfSxcbiAgZ2V0VGhyZXNob2xkOiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMuY29sb3JUaHJlc2hvbGQ7XG4gIH0sXG4gIHNldFRocmVzaG9sZDogZnVuY3Rpb24gKHRocmVzKSB7XG4gICAgaWYodGhyZXMgIT09IHVuZGVmaW5lZCl7XG4gICAgICB0aGlzLmNvbG9yVGhyZXNob2xkID0gdGhyZXM7XG4gICAgfVxuICAgIGlmICh0aGlzLmRvd25Qb2ludCkge1xuICAgICAgdGhpcy5kcmF3TWFzayh0aGlzLmRvd25Qb2ludC54LCB0aGlzLmRvd25Qb2ludC55LCB0aGlzLmFkamFjZW50UGl4ZWxzKTtcbiAgICB9XG4gICAgdGhpcy5maXJlKCd0aHJlc2hvbGQ6Y2hhbmdlZCcsIHt0aHJlc2hvbGQ6IHRoaXMuY29sb3JUaHJlc2hvbGR9KTtcbiAgfSxcbiAgc2V0UGljdHVyZTogZnVuY3Rpb24gKGltZykge1xuICAgIHRoaXMuc2V0SW1hZ2UoaW1nKTtcbiAgICB2YXIgY3ZzID0gZmFicmljLnV0aWwuY3JlYXRlQ2FudmFzRWxlbWVudCgpO1xuXG4gICAgY3ZzLm9ubW91c2V1cCA9IHRoaXMub25Nb3VzZVVwLmJpbmQodGhpcyk7XG4gICAgY3ZzLm9ubW91c2Vkb3duID0gdGhpcy5vbk1vdXNlRG93bi5iaW5kKHRoaXMpO1xuICAgIGN2cy5vbm1vdXNlbW92ZSA9IHRoaXMub25Nb3VzZU1vdmUuYmluZCh0aGlzKTtcbiAgICBjdnMub25jb250ZXh0bWVudSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9O1xuICAgIHRoaXMuaW5pdENhbnZhcyhjdnMpO1xuICB9LFxuICBsb2FkOiBmdW5jdGlvbiAoZmlsZSkge1xuICAgIGlmICghZmlsZSlyZXR1cm47XG5cbiAgICBpZiAoZmlsZS5jb25zdHJ1Y3RvciA9PT0gU3RyaW5nKSB7XG4gICAgICBQYXRoZmluZGVyLnRlc3RfcGljdHVyZS5zZXRBdHRyaWJ1dGUoJ3NyYycsZmlsZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHZhciByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xuICAgICAgcmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHRoaXMudGVzdF9waWN0dXJlLnNldEF0dHJpYnV0ZSgnc3JjJywgZS50YXJnZXQucmVzdWx0KTtcbiAgICAgIH0uYmluZCh0aGlzKTtcbiAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUpO1xuICAgIH1cbiAgfSxcbiAgaW5pdENhbnZhczogZnVuY3Rpb24gKGN2cykge1xuICAgIHZhciBpbWcgPSB0aGlzLmVkaXRlZEltYWdlQ2FudmFzO1xuICAgIGlmKHRoaXMucmVzdWx0Q2FudmFzKXtcbiAgICAgICQodGhpcy5yZXN1bHRDYW52YXMpLnJlbW92ZSgpXG4gICAgfVxuICAgIHRoaXMucmVzdWx0Q2FudmFzID0gY3ZzO1xuICAgIHRoaXMuY3JlYXRlU2VsZWN0aW9uRHJhd0NhbnZhcygpO1xuXG5cbiAgICB0aGlzLmNvbnRleHQgPSBjdnMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICBjdnMud2lkdGggPSBpbWcud2lkdGg7XG4gICAgY3ZzLmhlaWdodCA9IGltZy5oZWlnaHQ7XG4gICAgLy90aGlzLnNldEltYWdlKGltZyk7XG4gIH0sXG4gIHNldEltYWdlOiBmdW5jdGlvbiAoaW1nKSB7XG4gICAgdGhpcy5fdGVzdF90b2RvX2ltZyA9IGltZztcbiAgICAvL3RoaXMubWFzayA9IG51bGw7Ly9NYWdpY1dhbmQuY3JlYXRlTWFzayhpbWcud2lkdGgsaW1nLmhlaWdodCk7XG4gICAgdGhpcy5lZGl0ZWRJbWFnZUNhbnZhcyA9IGZhYnJpYy51dGlsLmNyZWF0ZUNhbnZhc0VsZW1lbnQoKTtcbiAgICB0aGlzLmVkaXRlZEltYWdlQ2FudmFzLndpZHRoID0gaW1nLndpZHRoO1xuICAgIHRoaXMuZWRpdGVkSW1hZ2VDYW52YXMuaGVpZ2h0ID0gaW1nLmhlaWdodDtcbiAgICB0aGlzLmVkaXRlZEltYWdlQ2FudmFzLmdldENvbnRleHQoJzJkJykuZHJhd0ltYWdlKGltZywgMCwgMCk7XG4gICAgdGhpcy5pbml0Q2FudmFzKGZhYnJpYy51dGlsLmNyZWF0ZUNhbnZhc0VsZW1lbnQoKSlcbiAgfSxcbiAgZ2V0SW5mbzogZnVuY3Rpb24gKCkge1xuXG4gICAgdmFyIGN0eCA9IHRoaXMuZWRpdGVkSW1hZ2VDYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICB2YXIgaW1hZ2VJbmZvID0gY3R4LmdldEltYWdlRGF0YSgwLCAwLCB0aGlzLmVkaXRlZEltYWdlQ2FudmFzLndpZHRoLCB0aGlzLmVkaXRlZEltYWdlQ2FudmFzLmhlaWdodCk7XG4gICAgaW1hZ2VJbmZvLmJ5dGVzID0gNDtcbiAgICByZXR1cm4gaW1hZ2VJbmZvO1xuICB9LFxuICBnZXRNb3VzZVBvc2l0aW9uOiBmdW5jdGlvbiAoZSkge1xuICAgIHZhciBzY2FsZSA9IHRoaXMucmVzdWx0Q2FudmFzLndpZHRoIC8gJCh0aGlzLnJlc3VsdENhbnZhcykud2lkdGgoKTtcbiAgICB2YXIgdGFyZ2V0ID0gZS50YXJnZXQgfHwgZS5zcmNFbGVtZW50LFxuICAgICAgcmVjdCA9IHRhcmdldC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSxcbiAgICAgIG9mZnNldFggPSBlLmNsaWVudFggLSByZWN0LmxlZnQsXG4gICAgICBvZmZzZXRZID0gZS5jbGllbnRZIC0gcmVjdC50b3A7XG4gICAgcmV0dXJuIHt4OiBNYXRoLnJvdW5kKG9mZnNldFggKiBzY2FsZSksIHk6IE1hdGgucm91bmQob2Zmc2V0WSAqIHNjYWxlKX07XG4gIH0sXG4gIHJhZGl1czogMjAsXG4gIHJlc2V0U2VsZWN0aW9uRHJhd0NhbnZhczogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuc2VsZWN0aW9uRHJhd0NvbnRleHQuZmlsbFN0eWxlID0gXCJibGFja1wiO1xuICAgIC8vdGhpcy5zZWxlY3Rpb25EcmF3Q29udGV4dCgwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpO1xuICAgIHRoaXMuc2VsZWN0aW9uRHJhd0NvbnRleHQuZmlsbFJlY3QoMCwwLHRoaXMuc2VsZWN0aW9uRHJhd0NhbnZhcy53aWR0aCx0aGlzLnNlbGVjdGlvbkRyYXdDYW52YXMuaGVpZ2h0KTtcbiAgICB0aGlzLnNlbGVjdGlvbkRyYXdDb250ZXh0LmZpbGxTdHlsZSA9IFwid2hpdGVcIjtcbiAgICB0aGlzLnNlbGVjdGlvbkRyYXdDb250ZXh0LnN0cm9rZVN0eWxlID0gXCJ3aGl0ZVwiO1xuICB9LFxuICBjcmVhdGVTZWxlY3Rpb25EcmF3Q2FudmFzOiBmdW5jdGlvbiAoKSB7XG5cbiAgICBpZih0aGlzLnNlbGVjdGlvbkRyYXdDYW52YXMgKXtcbiAgICAgICQodGhpcy5zZWxlY3Rpb25EcmF3Q2FudmFzICkucmVtb3ZlKCk7XG4gICAgfVxuICAgIHRoaXMuc2VsZWN0aW9uRHJhd0NhbnZhcyA9IGZhYnJpYy51dGlsLmNyZWF0ZUNhbnZhc0VsZW1lbnQoKTtcbiAgICB0aGlzLnNlbGVjdGlvbkRyYXdDYW52YXMud2lkdGggID0gdGhpcy5yZXN1bHRDYW52YXMud2lkdGg7XG4gICAgdGhpcy5zZWxlY3Rpb25EcmF3Q2FudmFzLmhlaWdodCA9IHRoaXMucmVzdWx0Q2FudmFzLmhlaWdodDtcbiAgICB0aGlzLnNlbGVjdGlvbkRyYXdDb250ZXh0ID0gdGhpcy5zZWxlY3Rpb25EcmF3Q2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcbiAgICB0aGlzLnJlc2V0U2VsZWN0aW9uRHJhd0NhbnZhcygpO1xuICB9LFxuICBfb25Nb3VzZURvd246IGZ1bmN0aW9uIChwb2ludCkge1xuICAgIHBvaW50LnggPSBNYXRoLm1pbihNYXRoLm1heCgwLCBwYXJzZUludChwb2ludC54KSksIHRoaXMucmVzdWx0Q2FudmFzLndpZHRoIC0gMSk7XG4gICAgcG9pbnQueSA9IE1hdGgubWluKE1hdGgubWF4KDAsIHBhcnNlSW50KHBvaW50LnkpKSwgdGhpcy5yZXN1bHRDYW52YXMuaGVpZ2h0IC0gMSk7XG4gICAgdGhpcy5hbGxvd0RyYXcgPSB0cnVlO1xuICAgIHRoaXMuZHJhd2luZ1Rvb2xzW3RoaXMuc2VsZWN0aW9uVG9vbF0ubW91c2VEb3duLmNhbGwodGhpcyxwb2ludCk7XG4gIH0sXG4gIG9uTW91c2VEb3duOiBmdW5jdGlvbiAoZSkge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIHRoaXMuX29uTW91c2VEb3duKHRoaXMuZ2V0TW91c2VQb3NpdGlvbihlKSk7XG5cbiAgfSxcbiAgX29uTW91c2VNb3ZlOiBmdW5jdGlvbiAocCkge1xuICAgIHAueCA9IE1hdGgubWluKE1hdGgubWF4KDAsIHBhcnNlSW50KHAueCkpLCB0aGlzLnJlc3VsdENhbnZhcy53aWR0aCAtIDEpO1xuICAgIHAueSA9IE1hdGgubWluKE1hdGgubWF4KDAsIHBhcnNlSW50KHAueSkpLCB0aGlzLnJlc3VsdENhbnZhcy5oZWlnaHQgLSAxKTtcbiAgICB0aGlzLmRyYXdpbmdUb29sc1t0aGlzLnNlbGVjdGlvblRvb2xdLm1vdXNlTW92ZS5jYWxsKHRoaXMscCk7XG4gIH0sXG4gIG9uTW91c2VNb3ZlOiBmdW5jdGlvbiAoZSkge1xuICAgIHZhciBwID0gdGhpcy5nZXRNb3VzZVBvc2l0aW9uKGUpO1xuICAgIHRoaXMuX29uTW91c2VNb3ZlKHApO1xuICB9LFxuICBjb2xvcjogWzI1NSwgMCwgMCwgMjU1XSxcbiAgb25Nb3VzZVVwOiBmdW5jdGlvbiAoZSkge1xuICAgIHRoaXMuYWxsb3dEcmF3ID0gZmFsc2U7XG4gICAgdGhpcy5kcmF3aW5nVG9vbHNbdGhpcy5zZWxlY3Rpb25Ub29sXS5tb3VzZVVwLmNhbGwodGhpcyxlKTtcbiAgfSxcbiAgYXBwbHlNYXNrOiBmdW5jdGlvbiAoY2FudmFzLCBsZWZ0LCB0b3ApIHtcbiAgICBpZiAoY2FudmFzLndpZHRoID09PSAwIHx8IGNhbnZhcy5oZWlnaHQgPT09IDApIHtcbiAgICAgIGRlbGV0ZSB0aGlzLm1hc2s7XG4gICAgICB0aGlzLnJlbmRlcigpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB2YXIgaW5mbyA9IHRoaXMuZ2V0SW5mbygpLFxuICAgICAgbWFzayA9IE1hZ2ljV2FuZC5tYXNrU2VsZWN0aW9uKGNhbnZhcyxsZWZ0LHRvcCkgO1xuXG4gICAgdGhpcy5tYXNrID0gbWFzaztcbiAgICB0aGlzLmZpcmUoJ3NlbGVjdGlvbjpjaGFuZ2VkJywge21hc2s6IG1hc2ssIHRhcmdldDogdGhpcy50YXJnZXR9KTtcbiAgfSxcbiAgc2V0UGF0aGZpbmRlck1vZGU6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgIHRoaXMucGF0aGZpbmRlck1vZGUgPSB2YWx1ZTtcbiAgfSxcbiAgZ2V0UGF0aGZpbmRlck1vZGU6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5wYXRoZmluZGVyTW9kZTtcbiAgfSxcbiAgbW9kaWZ5U2VsZWN0aW9uOiBmdW5jdGlvbiAobWFzaywgcGF0aGZpbmRlck1vZGUsIG5vRXZlbnRzKSB7XG4gICAgdGhpcy5zaG91bGRNb2RpZnkgPSBmYWxzZTtcbiAgICBpZih0aGlzLnNlbGVjdGlvbk9iamVjdCl7XG4gICAgICB0aGlzLnNlbGVjdGlvbk9iamVjdC5yZW1vdmUoKTtcbiAgICB9XG4gICAgdGhpcy5kb3duUG9pbnQgPSBmYWxzZTtcbiAgICBpZiAobWFzayA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICBtYXNrID0gdGhpcy5tYXNrO1xuICAgIH1cbiAgICBpZiAocGF0aGZpbmRlck1vZGUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgcGF0aGZpbmRlck1vZGUgPSB0aGlzLnBhdGhmaW5kZXJNb2RlO1xuICAgIH1cbiAgICBpZiAocGF0aGZpbmRlck1vZGUgIT09ICduZXcnICYmIHRoaXMub2xkTWFzaykge1xuICAgICAgbWFzayA9IE1hZ2ljV2FuZFtwYXRoZmluZGVyTW9kZV0obWFzaywgdGhpcy5vbGRNYXNrKTtcbiAgICB9XG4gICAgaWYgKHRoaXMuYmx1clJhZGl1cykge1xuICAgICAgbWFzayA9IE1hZ2ljV2FuZC5nYXVzc0JsdXJPbmx5Qm9yZGVyKG1hc2ssIHRoaXMuYmx1clJhZGl1cyk7XG4gICAgfVxuICAgIC8vaWYgKHBhdGhmaW5kZXJNb2RlICE9PSAnbmV3JyAmJiB0aGlzLm9sZE1hc2sgfHwgdGhpcy5ibHVyUmFkaXVzKSB7XG4gICAgLy8gIG1hc2suY2FjaGVJbmQgPSBNYWdpY1dhbmQuZ2V0Qm9yZGVySW5kaWNlcyhtYXNrKTtcbiAgICAvL31cblxuICAgIGlmKG1hc2sgJiYgbWFzay5jb3VudCAmJiB0aGlzLmtlZXBPbGRTZWxlY3Rpb24pe1xuICAgICAgbWFzay5tYWtlQ2FjaGUoKTtcbiAgICAgIHRoaXMub2xkTWFzayA9IG1hc2s7XG4gICAgfWVsc2V7XG4gICAgICBkZWxldGUgdGhpcy5vbGRNYXNrIDtcbiAgICB9XG5cblxuICAgIHRoaXMubWFzayA9IE1hZ2ljV2FuZC5jcmVhdGVNYXNrKHRoaXMuZWRpdGVkSW1hZ2VDYW52YXMud2lkdGgsIHRoaXMuZWRpdGVkSW1hZ2VDYW52YXMuaGVpZ2h0KTtcbiAgICBpZiAoIW5vRXZlbnRzKSB7XG4gICAgICB0aGlzLmZpcmUoJ3NlbGVjdGlvbjpjaGFuZ2VkJywge21hc2s6IG1hc2ssIHRhcmdldDogdGhpcy50YXJnZXR9KTtcbiAgICB9XG4gICAgdGhpcy5yZW5kZXIoKTtcbiAgfSxcbiAgY3JlYXRlU2VsZWN0aW9uOiBmdW5jdGlvbiAobWFzaykge1xuICAgIGlmICh0aGlzLnNob3VsZE1vZGlmeSkge1xuICAgICAgdGhpcy5tb2RpZnlTZWxlY3Rpb24oKTtcbiAgICB9XG5cbiAgICB0aGlzLm1hc2sgPSBtYXNrIHx8IE1hZ2ljV2FuZC5jcmVhdGVNYXNrKHRoaXMuZWRpdGVkSW1hZ2VDYW52YXMud2lkdGgsIHRoaXMuZWRpdGVkSW1hZ2VDYW52YXMuaGVpZ2h0KTtcbiAgICB0aGlzLnJlbmRlcigpO1xuICB9LFxuICBzZXRTZWxlY3Rpb246IGZ1bmN0aW9uIChtYXNrKSB7XG4gICAgdGhpcy5tYXNrID0gbWFzaztcbiAgICB0aGlzLnJlbmRlcigpO1xuICAgIHRoaXMuZmlyZSgnc2VsZWN0aW9uOmNoYW5nZWQnLCB7bWFzazogbWFzaywgdGFyZ2V0OiB0aGlzLnRhcmdldH0pO1xuICB9LFxuICBmaWxsOiBmdW5jdGlvbiAoY29sb3IsIGNhbGxiYWNrKSB7XG4gICAgdGhpcy5hc3luY3Jvbm91cyhmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLl9maWxsKGNvbG9yLCBmYWxzZSk7XG4gICAgICBjYWxsYmFjayAmJiBjYWxsYmFjay5jYWxsKHRoaXMpO1xuICAgIH0uYmluZCh0aGlzKSwgMCk7XG4gIH0sXG4gIF9maWxsOiBmdW5jdGlvbiAoY29sb3IsIGludmVydCwgY2FudmFzKSB7XG5cblxuICAgIGlmICghdGhpcy5tYXNrKSByZXR1cm47XG5cblxuICAgIGNhbnZhcyA9IGNhbnZhcyB8fCB0aGlzLmVkaXRlZEltYWdlQ2FudmFzO1xuICAgIHZhciBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsvL2IubWluWCwgYi5taW5ZLCBiLm1heFggLSBiLm1pblgsIGIubWF4WSAtIGIubWluWSk7XG5cbiAgICBNYWdpY1dhbmQuZmlsbE1hc2soY3R4LCB0aGlzLm1hc2ssIGNvbG9yKTtcblxuICAgIHRoaXMuZmlyZSgnaW1hZ2U6Y2hhbmdlZCcsIHRoaXMuZWRpdGVkSW1hZ2VDYW52YXMpO1xuICB9LFxuICBoYXRjaFRpY2s6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmhhdGNoT2Zmc2V0ID0gKHRoaXMuaGF0Y2hPZmZzZXQgKyAxKSAlICh0aGlzLmhhdGNoTGVuZ3RoICogMik7XG4gICAgdGhpcy5yZW5kZXIodHJ1ZSk7XG4gIH0sXG4gIHNob3c6IGZ1bmN0aW9uICgpIHtcbiAgICB3aGlsZSAodGhpcy5jb250YWluZXIubGFzdENoaWxkKSB7XG4gICAgICB0aGlzLmNvbnRhaW5lci5yZW1vdmVDaGlsZCh0aGlzLmNvbnRhaW5lci5sYXN0Q2hpbGQpO1xuICAgIH1cbiAgICB0aGlzLmNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzLmVkaXRlZEltYWdlQ2FudmFzKTtcbiAgICB0aGlzLmNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzLnJlc3VsdENhbnZhcyk7XG4gICAgdGhpcy5pbnRlcnZhbCA9IHNldEludGVydmFsKHRoaXMuaGF0Y2hUaWNrLmJpbmQodGhpcyksIDMwMCk7XG5cbiAgICB0aGlzLmZpcmUoJ3Nob3cnKTtcbiAgfSxcbiAgY2xlYXI6IGZ1bmN0aW9uIChpbnZlcnQsIGNhbnZhcywgY2FsbGJhY2spIHtcbiAgICB0aGlzLmFzeW5jcm9ub3VzKGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuX2ZpbGwoWzAsIDAsIDAsIDBdLCBpbnZlcnQsIGNhbnZhcyk7XG4gICAgICBjYWxsYmFjayAmJiBjYWxsYmFjay5jYWxsKHRoaXMpO1xuICAgIH0uYmluZCh0aGlzKSwgMCk7XG4gIH0sXG4gIHJlbmRlcjogZnVuY3Rpb24gKG5vQm9yZGVyKSB7XG4gICAgaWYgKCF0aGlzLmNvbnRleHQgfHwgIXRoaXMubWFzaylyZXR1cm47XG5cbiAgICB2YXIgY3R4ID0gdGhpcy5jb250ZXh0O1xuICAgIGlmICghbm9Cb3JkZXIpIHtcbiAgICAgIHRoaXMubWFzay5jYWNoZUluZCA9IE1hZ2ljV2FuZC5nZXRCb3JkZXJJbmRpY2VzKHRoaXMubWFzayk7XG4gICAgfVxuICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgdGhpcy5tYXNrLndpZHRoLCB0aGlzLm1hc2suaGVpZ2h0KTtcblxuICAgIHZhciBfbmV3X2NvbG9yID0gKCF0aGlzLm9sZE1hc2sgfHwgdGhpcy5wYXRoZmluZGVyTW9kZSA9PSBcIm5ld1wiIHx8IHRoaXMucGF0aGZpbmRlck1vZGUgPT0gXCJhZGRcInx8IHRoaXMucGF0aGZpbmRlck1vZGUgPT0gXCJleGNsdWRlXCIpXG4gICAgICA/IHRoaXMubmV3TWFza0NvbG9yIDogdGhpcy5yZW1vdmVkTWFza0NvbG9yO1xuXG4gICAgdmFyIF9pbnRlcnNlY3Rpb25fY29sb3I7XG4gICAgaWYodGhpcy5wYXRoZmluZGVyTW9kZSA9PSBcImFkZFwiIHx8IHRoaXMucGF0aGZpbmRlck1vZGUgPT0gXCJuZXdcInx8IHRoaXMucGF0aGZpbmRlck1vZGUgPT0gXCJpbnRlcnNlY3RcIil7XG4gICAgICBfaW50ZXJzZWN0aW9uX2NvbG9yID0gdGhpcy5uZXdNYXNrQ29sb3I7XG4gICAgfWVsc2V7XG4gICAgICBfaW50ZXJzZWN0aW9uX2NvbG9yID0gdGhpcy5yZW1vdmVkTWFza0NvbG9yIDsvL2ludGVyc2VjdGlvblJlbW92ZWRNYXNrQ29sb3I7XG4gICAgfVxuICAgIHZhciBfb2xkX2NvbG9yO1xuICAgIGlmKHRoaXMucGF0aGZpbmRlck1vZGUgPT0gXCJleGNsdWRlXCIgfHwgdGhpcy5wYXRoZmluZGVyTW9kZSA9PSBcInN1YnN0cmFjdFwifHwgdGhpcy5wYXRoZmluZGVyTW9kZSA9PSBcImFkZFwiKXtcbiAgICAgIF9vbGRfY29sb3IgPSB0aGlzLm5ld01hc2tDb2xvcjtcbiAgICB9ZWxzZXtcbiAgICAgIF9vbGRfY29sb3IgPSB0aGlzLnJlbW92ZWRNYXNrQ29sb3I7XG4gICAgfVxuXG4gICAgdGhpcy5vbGRNYXNrICYmIHRoaXMub2xkTWFzay5yZW5kZXIoY3R4LHtcbiAgICAgIGZpbGw6IF9vbGRfY29sb3JcbiAgICB9KTtcblxuXG4gICAgdGhpcy5tYXNrLnJlbmRlcihjdHgse1xuICAgICAgZmlsbDogX25ld19jb2xvcixcbiAgICAgIGludGVyc2VjdGlvbkNvbG9yIDogX2ludGVyc2VjdGlvbl9jb2xvcixcbiAgICAgIG91dGVySW50ZXJzZWN0aW9uQ29sb3IgOiBfb2xkX2NvbG9yLFxuICAgICAgLy8gb3V0ZXJGaWxsIDogXCJyZ2JhKDAsMCwwLDAuNSlcIlxuICAgIH0pO1xuXG4gICAgaWYodGhpcy5yZW5kZXJCb3JkZXIpe1xuICAgICAgdGhpcy5vbGRNYXNrICYmIHRoaXMub2xkTWFzay5yZW5kZXJCb3JkZXIoY3R4LHt9KTtcblxuICAgICAgdGhpcy5tYXNrLnJlbmRlckJvcmRlcihjdHgse1xuICAgICAgICBoYXRjaE9mZnNldDogdGhpcy5oYXRjaE9mZnNldFxuICAgICAgfSk7XG4gICAgfVxuXG4gIH0sXG4gIHJlbmRlckJvcmRlcjogdHJ1ZSxcbiAgaW50ZXJzZWN0aW9uUmVtb3ZlZE1hc2tDb2xvcjogJyNmZmFhYWEnLFxuICByZW1vdmVkTWFza0NvbG9yOiAnI2FhYWFmZicsXG4gIG5ld01hc2tDb2xvcjogICcjYWFGRmFhJyAsXG4gIHJlbmRlck1hc2s6IGZ1bmN0aW9uIChjdHgsIG1hc2ssIGNvbG9yLCBsZWZ0LCB0b3ApIHtcbiAgICBtYXNrID0gbWFzayB8fCB0aGlzLm1hc2s7XG4gICAgbWFzayAmJiBtYXNrLnJlbmRlcihjdHgse1xuICAgICAgaW50ZXJzZWN0aW9uQ29sb3I6ICcjZmZmJyxcbiAgICAgIG91dGVySW50ZXJzZWN0aW9uQ29sb3I6ICcjMDAwJyxcbiAgICAgIGZpbGwgOmNvbG9yIHx8ICcjZmZmJyxcbiAgICAgIGxlZnQgOiBsZWZ0LFxuICAgICAgdG9wIDogdG9wXG4gICAgfSlcbiAgfSxcbiAgZ2V0Q29udG91cnM6IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAoIXRoaXMuX19jcykge1xuICAgICAgdGhpcy5fX2NzID0gTWFnaWNXYW5kLnRyYWNlQ29udG91cnModGhpcy5tYXNrKTtcbiAgICAgIHRoaXMuX19jcyA9IE1hZ2ljV2FuZC5zaW1wbGlmeUNvbnRvdXJzKHRoaXMuX19jcywgdGhpcy5zaW1wbGlmeVRvbGVyYW50LCB0aGlzLnNpbXBsaWZ5Q291bnQpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5fX2NzO1xuICB9LFxuICB0cmFjZUlubmVyOiBmdW5jdGlvbiAoY3R4KSB7XG5cbiAgICB2YXIgY3MgPSB0aGlzLmdldENvbnRvdXJzKCk7XG4gICAgdmFyIGN0eCA9IGN0eCB8fCB0aGlzLmNvbnRleHQ7XG4gICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY3MubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmICghY3NbaV0uaW5uZXIpIGNvbnRpbnVlO1xuICAgICAgdmFyIHBzID0gY3NbaV0ucG9pbnRzO1xuICAgICAgY3R4Lm1vdmVUbyhwc1swXS54LCBwc1swXS55KTtcbiAgICAgIGZvciAodmFyIGogPSAxOyBqIDwgcHMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgY3R4LmxpbmVUbyhwc1tqXS54LCBwc1tqXS55KTtcbiAgICAgIH1cbiAgICB9XG4gICAgY3R4LnN0cm9rZSgpO1xuICB9LFxuICBnZXRDb2xvcjogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiAncmdiYSgnICsgdGhpcy5jb2xvci5qb2luKCcsICcpICsgJyknO1xuICB9LFxuICBzZXRDb2xvcjogZnVuY3Rpb24gKGNvbG9yKSB7XG4gICAgdmFyIF9hcnIgPSBjb2xvci5zdWJzdHJpbmcoY29sb3IuaW5kZXhPZignKCcpICsgMSwgY29sb3IubGVuZ3RoIC0gMSkuc3BsaXQoJywgJyk7XG4gICAgZm9yICh2YXIgaSBpbiBfYXJyKSB7XG4gICAgICBfYXJyW2ldID0gcGFyc2VGbG9hdChfYXJyW2ldKTtcbiAgICB9XG4gICAgX2FyclszXSA9IE1hdGgucm91bmQoX2FyclszXSAqIDI1NSk7XG4gICAgdGhpcy5jb2xvciA9IF9hcnI7XG4gIH0sXG4gIHRyYWNlOiBmdW5jdGlvbiAoY3R4KSB7XG4gICAgdmFyIGluZm8gPSB0aGlzLmdldEluZm8oKTtcbiAgICB2YXIgY3MgPSBNYWdpY1dhbmQudHJhY2VDb250b3Vycyh0aGlzLm1hc2spO1xuICAgIGNzID0gTWFnaWNXYW5kLnNpbXBsaWZ5Q29udG91cnMoY3MsIHRoaXMuc2ltcGxpZnlUb2xlcmFudCwgdGhpcy5zaW1wbGlmeUNvdW50KTtcblxuICAgIC8vIGRyYXcgY29udG91cnNcbiAgICB2YXIgY3R4ID0gY3R4IHx8IHRoaXMuY29udGV4dDtcbiAgICBjdHguY2xlYXJSZWN0KDAsIDAsIGluZm8ud2lkdGgsIGluZm8uaGVpZ2h0KTtcbiAgICAvL2lubmVyXG4gICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY3MubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmICghY3NbaV0uaW5uZXIpIGNvbnRpbnVlO1xuICAgICAgdmFyIHBzID0gY3NbaV0ucG9pbnRzO1xuICAgICAgY3R4Lm1vdmVUbyhwc1swXS54LCBwc1swXS55KTtcbiAgICAgIGZvciAodmFyIGogPSAxOyBqIDwgcHMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgY3R4LmxpbmVUbyhwc1tqXS54LCBwc1tqXS55KTtcbiAgICAgIH1cbiAgICB9XG4gICAgY3R4LnN0cm9rZVN0eWxlID0gJ3JlZCc7XG4gICAgY3R4LnN0cm9rZSgpO1xuICAgIC8vb3V0ZXJcbiAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjcy5sZW5ndGg7IGkrKykge1xuICAgICAgaWYgKGNzW2ldLmlubmVyKSBjb250aW51ZTtcbiAgICAgIHZhciBwcyA9IGNzW2ldLnBvaW50cztcbiAgICAgIGN0eC5tb3ZlVG8ocHNbMF0ueCwgcHNbMF0ueSk7XG4gICAgICBmb3IgKHZhciBqID0gMTsgaiA8IHBzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgIGN0eC5saW5lVG8ocHNbal0ueCwgcHNbal0ueSk7XG4gICAgICB9XG4gICAgfVxuICAgIGN0eC5zdHJva2VTdHlsZSA9ICdibHVlJztcbiAgICBjdHguc3Ryb2tlKCk7XG4gIH0sXG4gIHJlbW92ZU5vaXNlOiBmdW5jdGlvbiAodGhyZXNob2xkKSB7XG5cbiAgICBpZighdGhpcy5tYXNrIHx8ICF0aGlzLm1hc2suY291bnQpcmV0dXJuO1xuICAgIHRoaXMuY3JlYXRlU2VsZWN0aW9uRHJhd0NhbnZhcygpO1xuICAgIC8vdGhpcy5yZW5kZXJNYXNrKHRoaXMuc2VsZWN0aW9uRHJhd0NvbnRleHQsIHRoaXMubWFzayk7XG5cbiAgICB2YXIgY3MgPSBNYWdpY1dhbmQudHJhY2VDb250b3Vycyh0aGlzLm1hc2spO1xuICAgIGNzID0gTWFnaWNXYW5kLnNpbXBsaWZ5Q29udG91cnMoY3MsIHRoaXMuc2ltcGxpZnlUb2xlcmFudCwgdGhpcy5zaW1wbGlmeUNvdW50KTtcblxuICAgIHZhciBjdHggPSB0aGlzLnNlbGVjdGlvbkRyYXdDb250ZXh0LCB2ID0gdGhpcy5jYW52YXMudmlld3BvcnRUcmFuc2Zvcm07XG5cbiAgICAvLyAgY3MgPSBNYWdpY1dhbmQuc2ltcGxpZnlDb250b3VycyhjcywgdGhpcy5zaW1wbGlmeVRvbGVyYW50LCB0aGlzLnNpbXBsaWZ5Q291bnQpO1xuXG4gICAgY3R4LnNhdmUoKTtcbiAgICBjdHgudHJhbnNsYXRlKDAuNSwwLjUpO1xuICAgIGN0eC5maWxsU3R5bGU9IFwiI2ZmZlwiO1xuICAgIC8vY3R4LmZpbGxTdHlsZT0gXCIjMGYwXCI7XG4gICAgY3R4LnN0cm9rZVN0eWxlPSBcIiNmZmZcIjtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAoIWNzW2ldLmlubmVyICYmIGNzW2ldLnBvaW50cy5sZW5ndGggPiB0aHJlc2hvbGQpIHtcbiAgICAgICAgdmFyIHBzID0gY3NbaV0ucG9pbnRzO1xuICAgICAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgICAgIGN0eC5tb3ZlVG8ocHNbMF0ueCwgcHNbMF0ueSk7XG4gICAgICAgIGZvciAodmFyIGogPSAxOyBqIDwgcHMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICBjdHgubGluZVRvKHBzW2pdLngsIHBzW2pdLnkpO1xuICAgICAgICB9XG4gICAgICAgIGN0eC5jbG9zZVBhdGgoKTtcbiAgICAgICAgY3R4LmZpbGwoKTtcbiAgICAgIH1cblxuICAgIH1cbiAgICB0aGlzLm1hc2sgPSBNYWdpY1dhbmQubWFza1NlbGVjdGlvbiggdGhpcy5zZWxlY3Rpb25EcmF3Q2FudmFzKTtcbiAgICB0aGlzLnNldFNlbGVjdGlvbih0aGlzLm1hc2spO1xuXG4gICAgY3R4LnJlc3RvcmUoKTtcbiAgfSxcblxuICB0b29sczogW1xuICAgIFwiYWRqYWNlbnRQaXhlbHNcIixcbiAgICBcInBhdGhmaW5kZXJSYWRpdXNcIixcbiAgICBcInBhdGhmaW5kZXJUaHJlc2hvbGRcIixcbiAgICBcInNlbGVjdGlvblRvb2xcIixcbiAgICBcInBhdGhmaW5kZXJcIixcbiAgICBcImZpbGxXaXRoQ3VycmVudENvbG9yXCIsXG4gICAgXCJjbGVhclwiLFxuICAgIFwicGF0aGZpbmRlckNvbG9yXCJcbiAgXSxcbiAgYWN0aW9ucyA6IHtcblxuICAgIGNhbmNlbFNlbGVjdGlvbjoge1xuICAgICAgdmlzaWJsZTogZmFsc2UsXG4gICAgICBrZXk6ICAnRXNjYXBlJyxcbiAgICAgIGFjdGlvbjogZnVuY3Rpb24oKXtcbiAgICAgICAgZGVsZXRlIHRoaXMuc2hvdWxkTW9kaWZ5O1xuICAgICAgICB0aGlzLm1hc2sgPSBNYWdpY1dhbmQuY3JlYXRlTWFzayh0aGlzLmVkaXRlZEltYWdlQ2FudmFzLndpZHRoLCB0aGlzLmVkaXRlZEltYWdlQ2FudmFzLmhlaWdodCk7XG4gICAgICB9XG4gICAgfSxcbiAgICBtb2RpZnlTZWxlY3Rpb246IHtcbiAgICAgIHZpc2libGU6IGZhbHNlLFxuICAgICAga2V5OiAgJ0VudGVyJyxcbiAgICAgIGFjdGlvbjogZnVuY3Rpb24oKXtcbiAgICAgICAgaWYodGhpcy5zaG91bGRNb2RpZnkpe1xuICAgICAgICAgIHRoaXMubW9kaWZ5U2VsZWN0aW9uKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuICAgIGFkamFjZW50UGl4ZWxzOiB7XG4gICAgICBjbGFzc05hbWU6ICdidXR0b24tYWRqYWNlbnQnLFxuICAgICAgdGl0bGU6ICdzZWxldCBhbGwnLFxuICAgICAgdHlwZTogJ2NoZWNrYm94JyxcbiAgICAgIHZhbHVlOiAnYWRqYWNlbnRQaXhlbHMnLFxuICAgICAgdmlzaWJsZTogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zZWxlY3Rpb25Ub29sID09PSAnbWFnaWMnO1xuICAgICAgfSxcbiAgICAgIG9ic2VydmU6ICd0b29sOmNoYW5nZWQnXG4gICAgfSxcbiAgICBwYXRoZmluZGVyUmFkaXVzOiB7XG4gICAgICB0aXRsZTogJ3JhZGl1cycsXG4gICAgICB0eXBlOiAncmFuZ2UnLFxuICAgICAgdmFsdWU6IHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMucmFkaXVzXG4gICAgICAgIH0sXG4gICAgICAgIHNldDogZnVuY3Rpb24gKHZhbCkge1xuICAgICAgICAgIHRoaXMucmFkaXVzID0gdmFsO1xuICAgICAgICB9LFxuICAgICAgICBtaW46IDEsXG4gICAgICAgIG1heDogMjU1XG4gICAgICB9LFxuICAgICAgdmlzaWJsZTogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zZWxlY3Rpb25Ub29sID09PSAnYnJ1c2gnO1xuICAgICAgfSxcbiAgICAgIG9ic2VydmU6ICd0b29sOmNoYW5nZWQnXG4gICAgfSxcbiAgICBwYXRoZmluZGVyVGhyZXNob2xkOiB7XG4gICAgICB0aXRsZTogJ1RocmVzaG9sZCcsXG4gICAgICB0eXBlOiAncmFuZ2UnLFxuICAgICAgdmFsdWU6IHtcbiAgICAgICAgb2JzZXJ2ZTogJ3RocmVzaG9sZDpjaGFuZ2VkJyxcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuY29sb3JUaHJlc2hvbGRcbiAgICAgICAgfSxcbiAgICAgICAgc2V0OiBmdW5jdGlvbiAodmFsKSB7XG4gICAgICAgICAgdGhpcy5zZXRUaHJlc2hvbGQodmFsKTtcbiAgICAgICAgfSxcbiAgICAgICAgbWluOiAwLFxuICAgICAgICBtYXg6IDI1NVxuICAgICAgfSxcbiAgICAgIHZpc2libGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0aW9uVG9vbCA9PT0gJ21hZ2ljJztcbiAgICAgIH0sXG4gICAgICBvYnNlcnZlOiAndG9vbDpjaGFuZ2VkJ1xuICAgIH0sXG4gICAgc2VsZWN0aW9uVG9vbDoge1xuICAgICAgdGl0bGU6ICdzZWxlY3Rpb24tdG9vbCcsXG4gICAgICB0eXBlOiAnb3B0aW9ucycsXG4gICAgICB2YWx1ZTogJ3NlbGVjdGlvblRvb2wnLFxuICAgICAgbWVudToge1xuICAgICAgICBzZWxlY3Rpb25Ub29sQnJ1c2g6IHtcbiAgICAgICAgICBjbGFzc05hbWU6ICdmYSBmYS1wYWludC1icnVzaCcsXG4gICAgICAgICAgdGl0bGU6ICdzZWxlY3QtYnJ1c2gnLFxuICAgICAgICAgIG9wdGlvbjogJ2JydXNoJ1xuICAgICAgICB9LFxuICAgICAgICBzZWxlY3Rpb25Ub29sUmVjdGFuZ2xlOiB7XG4gICAgICAgICAgY2xhc3NOYW1lOiAnZmEgZmEtc3F1YXJlJyxcbiAgICAgICAgICB0aXRsZTogJ3NlbGVjdC1yZWN0YW5nbGUnLFxuICAgICAgICAgIG9wdGlvbjogJ3JlY3RhbmdsZSdcbiAgICAgICAgfSxcbiAgICAgICAgc2VsZWN0aW9uRWxsaXB0aWNhbDoge1xuICAgICAgICAgIGNsYXNzTmFtZTogJ2ZhIGZhLWNpcmNsZScsXG4gICAgICAgICAgdGl0bGU6ICdzZWxlY3QtY2lyY2xlJyxcbiAgICAgICAgICBvcHRpb246ICdjaXJjbGUnXG4gICAgICAgIH0sXG4gICAgICAgIHNlbGVjdGlvblRvb2xNYWdpYzoge1xuICAgICAgICAgIGNsYXNzTmFtZTogJ2ZhIGZhLW1hZ2ljJyxcbiAgICAgICAgICB0aXRsZTogJ3NlbGVjdC1tYWdpYycsXG4gICAgICAgICAgb3B0aW9uOiAnbWFnaWMnXG4gICAgICAgIH0sXG4gICAgICAgIHNlbGVjdGlvblRvb2xMYXNzbzoge1xuICAgICAgICAgIHVzZTogJ3NoYXBlU2VsZWN0aW9uVG9vbHMnLFxuICAgICAgICAgIHRpdGxlOiAnc2VsZWN0LWxhc3NvJyxcbiAgICAgICAgICBvcHRpb246ICdsYXNzbycsXG4gICAgICAgICAgaWNvbjogJ2RhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsJysgcmVxdWlyZSgnYmFzZTY0LWxvYWRlciEuLy4uL21lZGlhL2xhc3NvLnN2ZycpXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuICAgIHBhdGhmaW5kZXI6IHtcbiAgICAgIHRpdGxlOiAncGF0aGZpbmRlcicsXG4gICAgICB0eXBlOiAnb3B0aW9ucycsXG4gICAgICB2YWx1ZTogJ3BhdGhmaW5kZXJNb2RlJyxcbiAgICAgIG1lbnU6IHtcbiAgICAgICAgcGF0aGZpbmRlck5ldzoge1xuICAgICAgICAgIHRpdGxlOiAncGF0aGZpbmRlci1uZXcnLFxuICAgICAgICAgIG9wdGlvbjogJ25ldydcbiAgICAgICAgfSxcbiAgICAgICAgcGF0aGZpbmRlckV4Y2x1ZGU6IHtcbiAgICAgICAgICB0aXRsZTogJ3BhdGhmaW5kZXItZXhjbHVkZScsXG4gICAgICAgICAgb3B0aW9uOiAnZXhjbHVkZSdcbiAgICAgICAgfSxcbiAgICAgICAgcGF0aGZpbmRlclN1YnN0cmFjdDoge1xuICAgICAgICAgIHRpdGxlOiAncGF0aGZpbmRlci1zdWJzdHJhY3QnLFxuICAgICAgICAgIG9wdGlvbjogJ3N1YnN0cmFjdCdcbiAgICAgICAgfSxcbiAgICAgICAgcGF0aGZpbmRlckFkZDoge1xuICAgICAgICAgIHRpdGxlOiAncGF0aGZpbmRlci1hZGQnLFxuICAgICAgICAgIG9wdGlvbjogJ2FkZCdcbiAgICAgICAgfSxcbiAgICAgICAgcGF0aGZpbmRlckludGVyc2VjdDoge1xuICAgICAgICAgIHRpdGxlOiAncGF0aGZpbmRlci1pbnRlcnNlY3QnLFxuICAgICAgICAgIG9wdGlvbjogJ2ludGVyc2VjdCdcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG4gICAgZmlsbFdpdGhDdXJyZW50Q29sb3I6IHtcbiAgICAgIHRpdGxlOiAnZmlsbFdpdGhDdXJyZW50Q29sb3InLFxuICAgICAgY2xhc3NOYW1lOiAnZmEgZmEtcGFpbnQtYnJ1c2gnXG4gICAgfSxcbiAgICBjbGVhcjoge1xuICAgICAgY2xhc3NOYW1lOiAnZmEgZmEtZXJhc2VyJyxcbiAgICAgIGlkOiAgICAgJ1BhdGhmaW5kZXItY2xlYXInLFxuICAgICAgdGl0bGU6ICAnY2xlYXInXG4gICAgfSxcbiAgICBwYXRoZmluZGVyQ29sb3I6IHtcbiAgICAgIHRpdGxlOiAgJ2NvbG9yJyxcbiAgICAgIHR5cGU6ICAgJ2NvbG9yJyxcbiAgICAgIHZhbHVlOiAgJ2NvbG9yJ1xuICAgIH1cbiAgfVxufTtcblxuZmFicmljLnV0aWwub2JzZXJ2YWJsZShQYXRoZmluZGVyLnByb3RvdHlwZSk7XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoUGF0aGZpbmRlci5wcm90b3R5cGUsIGZhYnJpYy5Ub29sc01peGluLCB7XG4gIHNlbGVjdEJhY2tncm91bmQ6IGZ1bmN0aW9uIChmcm9tQ29ybmVycykge1xuICAgIHZhciBpbmZvID0gdGhpcy5nZXRJbmZvKCksIG1hc2s7XG5cbiAgICBpZiAoZnJvbUNvcm5lcnMpIHtcbiAgICAgIHZhciBtYXNrMSA9IE1hZ2ljV2FuZC5zZWxlY3RCYWNrZ3JvdW5kKGluZm8sIFsyNTUsIDI1NSwgMjU1LCBmYWxzZV0sIHRoaXMuY29sb3JUaHJlc2hvbGQpO1xuICAgICAgdmFyIG1hc2syID0gTWFnaWNXYW5kLnNlbGVjdEJhY2tncm91bmQoaW5mbywgW2ZhbHNlLCBmYWxzZSwgZmFsc2UsIDBdLCB0aGlzLmNvbG9yVGhyZXNob2xkKTtcbiAgICAgIG1hc2sgPSBNYWdpY1dhbmQuYWRkKG1hc2sxLCBtYXNrMik7XG4gICAgfSBlbHNlIHtcbiAgICAgIG1hc2sgPSBNYWdpY1dhbmQuc2VsZWN0QWxsQnlDb2xvcihpbmZvLCBbMjU1LCAyNTUsIDI1NSwgMjU1XSwgdGhpcy5jb2xvclRocmVzaG9sZCk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuYmx1clJhZGl1cykge1xuICAgICAgbWFzayA9IE1hZ2ljV2FuZC5nYXVzc0JsdXJPbmx5Qm9yZGVyKG1hc2ssIHRoaXMuYmx1clJhZGl1cyk7XG4gICAgfVxuICAgIHRoaXMuc2V0U2VsZWN0aW9uKG1hc2spO1xuICB9LFxuICBjb2xvclNlbGVjdGlvbjogZnVuY3Rpb24gKGNvbG9ycywgdGhyZXNob2xkKSB7XG4gICAgdmFyIGluZm8gPSB0aGlzLmdldEluZm8oKSwgbWFzazIsXG4gICAgICBtYXNrID0gTWFnaWNXYW5kLmNyZWF0ZU1hc2soaW5mby53aWR0aCwgaW5mby5oZWlnaHQpO1xuICAgIGZvciAodmFyIGkgaW4gY29sb3JzKSB7XG4gICAgICB2YXIgX2NvbG9yID0gbmV3IGZhYnJpYy5Db2xvcihjb2xvcnNbaV0pLl9zb3VyY2U7XG4gICAgICBfY29sb3JbM10gPSBNYXRoLnJvdW5kKF9jb2xvclszXSAqIDI1NSk7XG4gICAgICBtYXNrMiA9IE1hZ2ljV2FuZC5zZWxlY3RBbGxCeUNvbG9yKGluZm8sIF9jb2xvciwgdGhyZXNob2xkW2ldKVxuICAgICAgbWFzayA9IE1hZ2ljV2FuZC5hZGQobWFzaywgbWFzazIpO1xuICAgIH1cbiAgICBkZWxldGUgdGhpcy5vbGRNYXNrO1xuICAgIHRoaXMubW9kaWZ5U2VsZWN0aW9uKG1hc2spO1xuICB9LFxuICBzbWFydFNlbGVjdGlvbjogZnVuY3Rpb24gKHRocmVzaG9sZCkge1xuICAgIHZhciBpbmZvID0gdGhpcy5nZXRJbmZvKCksIG1hc2s7XG4gICAgbWFzayA9IE1hZ2ljV2FuZC5zZWxlY3RCYWNrZ3JvdW5kKGluZm8sIG51bGwsIHRocmVzaG9sZCB8fCB0aGlzLmNvbG9yVGhyZXNob2xkKTtcbiAgICBtYXNrID0gTWFnaWNXYW5kLmludmVydE1hc2sobWFzayk7XG4gICAgZGVsZXRlIHRoaXMub2xkTWFzaztcbiAgICB0aGlzLm1vZGlmeVNlbGVjdGlvbihtYXNrKTtcbiAgfVxufSk7XG5cblxuUGF0aGZpbmRlci5wcm90b3R5cGUuZHJhd2luZ1Rvb2xzID0ge1xuICBicnVzaDoge1xuICAgIG1vdXNlVXA6IGZ1bmN0aW9uKCl7XG4gICAgICB0aGlzLm1vZGlmeVNlbGVjdGlvbigpO1xuICAgICAgdGhpcy5yZXNldFNlbGVjdGlvbkRyYXdDYW52YXMoKTtcbiAgICB9LFxuICAgIG1vdXNlTW92ZTogZnVuY3Rpb24ocCl7XG4gICAgICBpZiAoIXRoaXMuYWxsb3dEcmF3KSByZXR1cm47XG4gICAgICB0aGlzLmRyYXdDaXJjbGUocC54LCBwLnksIHRoaXMucmFkaXVzKTtcbiAgICB9LFxuICAgIG1vdXNlRG93bjogZnVuY3Rpb24ocG9pbnQpe1xuICAgICAgdGhpcy5jcmVhdGVTZWxlY3Rpb24oKTtcbiAgICAgIHRoaXMuZG93blBvaW50ID0gcG9pbnQ7XG4gICAgICB0aGlzLmNyZWF0ZVNlbGVjdGlvbkRyYXdDYW52YXMoKTtcbiAgICAgIHRoaXMuZHJhd0NpcmNsZShwb2ludC54LCBwb2ludC55LCB0aGlzLnJhZGl1cyk7XG4gICAgfSxcbiAgICB1dGlsczoge1xuICAgICAgZHJhd0NpcmNsZTogZnVuY3Rpb24gKHgsIHksIHIpIHtcbiAgICAgICAgdmFyIGN0eCA9IHRoaXMuc2VsZWN0aW9uRHJhd0NvbnRleHQsXG4gICAgICAgICAgdiA9IHRoaXMuY2FudmFzLnZpZXdwb3J0VHJhbnNmb3JtO1xuICAgICAgICBjdHguc2F2ZSgpO1xuICAgICAgICAvLyAgY3R4LnRyYW5zZm9ybSh2WzBdLCB2WzFdLCB2WzJdLCB2WzNdLCB2WzRdLCB2WzVdKTtcbiAgICAgICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgICAgICBjdHguYXJjKHgsIHksIHRoaXMucmFkaXVzLCAwLCBNYXRoLlBJICogMiwgZmFsc2UpO1xuICAgICAgICBjdHguY2xvc2VQYXRoKCk7XG4gICAgICAgIGN0eC5maWxsKCk7XG4gICAgICAgIGN0eC5yZXN0b3JlKCk7XG4gICAgICAgIE1hZ2ljV2FuZC5tYXNrU2VsZWN0aW9uKCB0aGlzLnNlbGVjdGlvbkRyYXdDYW52YXMsIDAsMCwgdGhpcy5tYXNrLCAnYWRkJyk7XG4gICAgICAgIHRoaXMuc2V0U2VsZWN0aW9uKHRoaXMubWFzayk7XG4gICAgICB9XG4gICAgfVxuICB9LFxuICBtYWdpYzoge1xuICAgIG1vdXNlVXA6IGZ1bmN0aW9uKCl7XG4gICAgICB0aGlzLnNob3VsZE1vZGlmeSA9IHRydWU7XG4gICAgfSxcbiAgICBtb3VzZU1vdmU6IGZ1bmN0aW9uIChwKXtcbiAgICAgIGlmICghdGhpcy5hbGxvd0RyYXcpIHJldHVybjtcbiAgICAgIHZhciBkaXN0ID0gcC54IC0gdGhpcy5kb3duUG9pbnQueDtcblxuICAgICAgdmFyIHZhbCA9IHRoaXMuX2luaXRfdGhyZXMgKyBkaXN0O1xuICAgICAgdmFyIHRocmVzID0gTWF0aC5taW4oTWF0aC5tYXgodmFsLCAxKSwgMjU1KTtcbiAgICAgIGlmICh0aHJlcyAhPSB0aGlzLmNvbG9yVGhyZXNob2xkKSB7XG4gICAgICAgIHRoaXMuc2V0VGhyZXNob2xkKHRocmVzKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIG1vdXNlRG93bjogZnVuY3Rpb24gKHBvaW50KXtcbiAgICAgIGlmICh0aGlzLnNob3VsZE1vZGlmeSkge1xuICAgICAgICB0aGlzLm1vZGlmeVNlbGVjdGlvbigpO1xuICAgICAgfVxuICAgICAgdGhpcy5kb3duUG9pbnQgPSBwb2ludDtcbiAgICAgIHRoaXMuY29sb3JUaHJlc2hvbGQgPSAxNTtcbiAgICAgIHRoaXMuZmlyZSgndGhyZXNob2xkOmNoYW5nZWQnLCB7dGhyZXNob2xkOiB0aGlzLmNvbG9yVGhyZXNob2xkfSk7XG4gICAgICB0aGlzLl9pbml0X3RocmVzID0gdGhpcy5jb2xvclRocmVzaG9sZDtcbiAgICAgIHRoaXMuZHJhd01hc2sodGhpcy5kb3duUG9pbnQueCwgdGhpcy5kb3duUG9pbnQueSwgdGhpcy5hZGphY2VudFBpeGVscyk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSxcbiAgICB1dGlsczp7XG4gICAgICBkcmF3TWFzazogZnVuY3Rpb24gKHgsIHksIGFkamFjZW50UGl4ZWxzKSB7XG4gICAgICAgIHRoaXMuYXN5bmNyb25vdXModGhpcy5fZHJhd01hc2suYmluZCh0aGlzLCB4LCB5LCBhZGphY2VudFBpeGVscyksIDApO1xuICAgICAgfSxcbiAgICAgIF9kcmF3TWFzazogZnVuY3Rpb24gKHgsIHksIGFkamFjZW50UGl4ZWxzKSB7XG4gICAgICAgIE1hZ2ljV2FuZC5hbHBoYUNoYW5uZWwgPSB0aGlzLmFscGhhQ2hhbm5lbDtcbiAgICAgICAgdmFyIGluZm8gPSB0aGlzLmdldEluZm8oKSwgbWFzaztcbiAgICAgICAgaWYgKGFkamFjZW50UGl4ZWxzKSB7XG4gICAgICAgICAgTWFnaWNXYW5kLmZsb29kRmlsbChpbmZvLCB4LCB5LCB0aGlzLmNvbG9yVGhyZXNob2xkLHt9LG51bGwsZnVuY3Rpb24obWFzayl7XG4gICAgICAgICAgICB0aGlzLnNldFNlbGVjdGlvbihtYXNrKTtcbiAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG1hc2sgPSBNYWdpY1dhbmQuc2VsZWN0QWxsKGluZm8sIHgsIHksIHRoaXMuY29sb3JUaHJlc2hvbGQpO1xuICAgICAgICAgIHRoaXMuc2V0U2VsZWN0aW9uKG1hc2spO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9LFxuICByZWN0YW5nbGU6IHtcbiAgICBtb3VzZURvd246IGZ1bmN0aW9uKHBvaW50KSB7XG4gICAgICBpZiAodGhpcy5zaG91bGRNb2RpZnkpIHtcbiAgICAgICAgdGhpcy5tb2RpZnlTZWxlY3Rpb24oKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuZG93blBvaW50ID0gcG9pbnQ7XG4gICAgICB0aGlzLnNob3VsZE1vZGlmeSA9IHRydWU7XG4gICAgfSxcbiAgICBtb3VzZVVwOiBmdW5jdGlvbigpe1xuICAgICAgLy90aGlzLm1vZGlmeVNlbGVjdGlvbigpO1xuICAgICAgLy90aGlzLnJlc2V0U2VsZWN0aW9uRHJhd0NhbnZhcygpO1xuICAgIH0sXG4gICAgbW91c2VNb3ZlOiBmdW5jdGlvbihwKXtcbiAgICAgIGlmICghdGhpcy5hbGxvd0RyYXcpIHJldHVybjtcbiAgICAgIHRoaXMuZHJhd1JlY3RhbmdsZSh0aGlzLmRvd25Qb2ludC54LCB0aGlzLmRvd25Qb2ludC55LCBwLngsIHAueSk7XG4gICAgfSxcbiAgICB1dGlsczp7XG4gICAgICBkcmF3UmVjdGFuZ2xlOiBmdW5jdGlvbiAoeCwgeSwgeDIsIHkyKSB7XG4gICAgICAgIHZhciBpbmZvID0gdGhpcy5nZXRJbmZvKCksXG4gICAgICAgICAgbWFzayA9IE1hZ2ljV2FuZC5zZWxlY3RSZWN0YW5nbGUoaW5mbywgeCwgeSwgeDIsIHkyKTtcbiAgICAgICAgdGhpcy5zZXRTZWxlY3Rpb24obWFzayk7XG4gICAgICB9XG4gICAgfVxuICB9LFxuICBjaXJjbGU6IHtcbiAgICBtb3VzZURvd246IGZ1bmN0aW9uKHBvaW50KSB7XG4gICAgICBpZiAodGhpcy5zaG91bGRNb2RpZnkpIHtcbiAgICAgICAgdGhpcy5tb2RpZnlTZWxlY3Rpb24oKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuZG93blBvaW50ID0gcG9pbnQ7XG4gICAgICB0aGlzLmNyZWF0ZVNlbGVjdGlvbkRyYXdDYW52YXMoKTtcbiAgICAgIHRoaXMuc2VsZWN0aW9uT2JqZWN0ID0gbmV3IGZhYnJpYy5FbGxpcHNlKHtcbiAgICAgICAgbGVmdDogcG9pbnQueCArIHRoaXMudGFyZ2V0LmxlZnQsXG4gICAgICAgIHRvcDogIHBvaW50LnkgKyB0aGlzLnRhcmdldC50b3AsXG4gICAgICAgIHJ4OjEsXG4gICAgICAgIHJ5OjEsXG4gICAgICAgIGhhc0JvcmRlcnM6IGZhbHNlLFxuICAgICAgICBvcmlnaW5YOiAnY2VudGVyJyxcbiAgICAgICAgb3JpZ2luWTogJ2NlbnRlcicsXG4gICAgICAgIHN0cm9rZVdpZHRoOiAxLFxuICAgICAgICBmaWxsOiAndHJhbnNwYXJlbnQnLFxuICAgICAgICBzdHJva2U6ICd0cmFuc3BhcmVudCdcbiAgICAgIH0pO1xuICAgICAgdGhpcy5jYW52YXMuYWRkKHRoaXMuc2VsZWN0aW9uT2JqZWN0KTtcbiAgICAgIHRoaXMudXBkYXRlU2hhcGUoKTtcbiAgICB9LFxuICAgIG1vdXNlVXA6IGZ1bmN0aW9uKCl7XG4gICAgICB0aGlzLmNhbnZhcy5zZXRJbnRlcmFjdGl2ZU1vZGUoXCJtaXhlZFwiKTtcbiAgICAgIHRoaXMuc2VsZWN0aW9uT2JqZWN0LnNldENvb3JkcygpO1xuICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgIHRoaXMuc2VsZWN0aW9uT2JqZWN0Lm9uKCdzY2FsaW5nIG1vdmluZyByb3RhdGluZycsZnVuY3Rpb24oKXtcbiAgICAgICAgX3RoaXMudXBkYXRlU2hhcGUoKTtcbiAgICAgIH0pO1xuICAgICAgdGhpcy5jYW52YXMuc2V0QWN0aXZlT2JqZWN0KHRoaXMuc2VsZWN0aW9uT2JqZWN0KTtcbiAgICAgIHRoaXMuc2hvdWxkTW9kaWZ5ID0gdHJ1ZTtcbiAgICAgIC8vICB0aGlzLm1vZGlmeVNlbGVjdGlvbigpO1xuICAgICAgLy8gIHRoaXMucmVzZXRTZWxlY3Rpb25EcmF3Q2FudmFzKCk7XG4gICAgfSxcbiAgICBtb3VzZU1vdmU6IGZ1bmN0aW9uKHApe1xuICAgICAgaWYgKCF0aGlzLmFsbG93RHJhdykgcmV0dXJuO1xuICAgICAgdGhpcy5zZWxlY3Rpb25PYmplY3Quc2V0KHtcbiAgICAgICAgcng6IE1hdGguYWJzKChwLnggKyB0aGlzLnRhcmdldC5sZWZ0IC0gIHRoaXMuc2VsZWN0aW9uT2JqZWN0LmdldCgnbGVmdCcpKSkgLFxuICAgICAgICByeTogTWF0aC5hYnMoKHAueSArIHRoaXMudGFyZ2V0LnRvcCAgLSB0aGlzLnNlbGVjdGlvbk9iamVjdC5nZXQoJ3RvcCcpKSlcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLnVwZGF0ZVNoYXBlKCk7XG5cbiAgICB9LFxuICAgIHV0aWxzOntcbiAgICAgIHVwZGF0ZVNoYXBlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMucmVzZXRTZWxlY3Rpb25EcmF3Q2FudmFzKCk7XG4gICAgICAgIHRoaXMuc2VsZWN0aW9uT2JqZWN0LmZpbGwgPSAnd2hpdGUnO1xuICAgICAgICB0aGlzLnNlbGVjdGlvbkRyYXdDb250ZXh0LnNhdmUoKTtcbiAgICAgICAgdGhpcy5zZWxlY3Rpb25EcmF3Q29udGV4dC50cmFuc2xhdGUoLXRoaXMudGFyZ2V0LmxlZnQsIC0gdGhpcy50YXJnZXQudG9wKTtcbiAgICAgICAgdGhpcy5zZWxlY3Rpb25PYmplY3QucmVuZGVyKHRoaXMuc2VsZWN0aW9uRHJhd0NvbnRleHQpO1xuICAgICAgICB0aGlzLnNlbGVjdGlvbkRyYXdDb250ZXh0LnJlc3RvcmUoKTtcbiAgICAgICAgdGhpcy5zZWxlY3Rpb25PYmplY3QuZmlsbCA9ICd0cmFuc3BhcmVudCc7XG4gICAgICAgIHRoaXMubWFzayA9IE1hZ2ljV2FuZC5tYXNrU2VsZWN0aW9uKCB0aGlzLnNlbGVjdGlvbkRyYXdDYW52YXMpO1xuICAgICAgICB0aGlzLnNldFNlbGVjdGlvbih0aGlzLm1hc2spO1xuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgbGFzc286IHtcbiAgICBtb3VzZVVwOiBmdW5jdGlvbigpe1xuICAgICAgaWYodGhpcy5yZWFkeVRvQ2xvc2VQYXRoKSB7XG4gICAgICAgIHRoaXMuX2Nsb3NlUGF0aCgpO1xuICAgICAgfVxuICAgIH0sXG4gICAgbW91c2VNb3ZlOiBmdW5jdGlvbihwKXtcbiAgICAgIGlmICghdGhpcy5hbGxvd0RyYXcpIHJldHVybjtcbiAgICAgIHRoaXMuZHJhd0xpbmUodGhpcy5fbGFzdF9wb2ludCwgcClcbiAgICAgIHRoaXMuX3BvaW50cy5wdXNoKHApO1xuICAgICAgdGhpcy5fbGFzdF9wb2ludCA9IHA7XG4gICAgfSxcbiAgICBtb3VzZURvd246IGZ1bmN0aW9uKHBvaW50KXtcbiAgICAgIGlmKCF0aGlzLmRvd25Qb2ludCl7XG4gICAgICAgIHRoaXMuY3JlYXRlU2VsZWN0aW9uKCk7XG4gICAgICAgIHRoaXMuY3JlYXRlU2VsZWN0aW9uRHJhd0NhbnZhcygpO1xuICAgICAgICB0aGlzLl9wYXRoX291dCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmRvd25Qb2ludCA9IHBvaW50O1xuICAgICAgICB0aGlzLl9wb2ludHMgPSBbXTtcbiAgICAgICAgdGhpcy5zZWxlY3Rpb25EcmF3Q29udGV4dC5iZWdpblBhdGgoKTtcbiAgICAgICAgdGhpcy5jYW52YXMub24oJ21vdXNlOm1vdmUnLCB0aGlzLl9jaGFuZ2VDdXJzb3JPdmVyQ2xvc2VQb2ludCk7XG4gICAgICB9XG4gICAgICBpZih0aGlzLl9sYXN0X3BvaW50KXtcbiAgICAgICAgaWYodGhpcy5yZWFkeVRvQ2xvc2VQYXRoKXtcbiAgICAgICAgICB0aGlzLl9jbG9zZVBhdGgoKTtcbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgdGhpcy5kcmF3TGluZSh0aGlzLl9sYXN0X3BvaW50LCBwb2ludClcbiAgICAgICAgICB0aGlzLl9sYXN0X3BvaW50ID0gcG9pbnQ7XG4gICAgICAgICAgdGhpcy5fcG9pbnRzLnB1c2gocG9pbnQpO1xuICAgICAgICB9XG4gICAgICB9ZWxzZXtcblxuICAgICAgICB0aGlzLmRyYXdMaW5lKHt4OnBvaW50LnggLSAwLjUseTogcG9pbnQueX0sIHt4OnBvaW50LnggKyAwLjUseTogcG9pbnQueSB9KVxuICAgICAgICB0aGlzLl9sYXN0X3BvaW50ID0ge3g6cG9pbnQueCArIDAuNSx5OiBwb2ludC55IH07XG4gICAgICAgIHRoaXMuX3BvaW50cy5wdXNoKHBvaW50KTtcbiAgICAgICAgdGhpcy5zaG91bGRNb2RpZnkgPSB0cnVlO1xuICAgICAgfVxuICAgIH0sXG4gICAgdXRpbHM6IHtcbiAgICAgIGRyYXdMaW5lOiBmdW5jdGlvbiAocDEgLHAyICkge1xuICAgICAgICB2YXIgY3R4ID0gdGhpcy5zZWxlY3Rpb25EcmF3Q29udGV4dCxcbiAgICAgICAgICB2ID0gdGhpcy5jYW52YXMudmlld3BvcnRUcmFuc2Zvcm07XG4gICAgICAgIGN0eC5zYXZlKCk7XG4gICAgICAgIC8vY3R4LnRyYW5zZm9ybSh2WzBdLCB2WzFdLCB2WzJdLCB2WzNdLCB2WzRdLCB2WzVdKTtcbiAgICAgICAgY3R4Lm1vdmVUbyhwMS54LHAxLnkpO1xuICAgICAgICBjdHgubGluZVRvKHAyLngscDIueSk7XG4gICAgICAgIGN0eC5zdHJva2UoKTtcbiAgICAgICAgY3R4LnJlc3RvcmUoKTtcbiAgICAgICAgTWFnaWNXYW5kLm1hc2tTZWxlY3Rpb24odGhpcy5zZWxlY3Rpb25EcmF3Q2FudmFzLDAsMCx0aGlzLm1hc2ssJ2FkZCcpO1xuICAgICAgICB0aGlzLnNldFNlbGVjdGlvbih0aGlzLm1hc2spO1xuICAgICAgfSxcbiAgICAgIF9jbG9zZVBhdGg6ICBmdW5jdGlvbiAoZSkge1xuXG4gICAgICAgIHRoaXMuYWxsb3dEcmF3ID0gZmFsc2U7XG4gICAgICAgIHZhciBjdHggPSB0aGlzLnNlbGVjdGlvbkRyYXdDb250ZXh0O1xuICAgICAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgICAgIGN0eC5tb3ZlVG8odGhpcy5fcG9pbnRzWzBdLngsdGhpcy5fcG9pbnRzWzBdLnkpXG4gICAgICAgIGZvcih2YXIgaSA9IDEgOyBpIDwgdGhpcy5fcG9pbnRzLmxlbmd0aDtpICsrKXtcbiAgICAgICAgICBjdHgubGluZVRvKHRoaXMuX3BvaW50c1tpXS54LHRoaXMuX3BvaW50c1tpXS55KVxuICAgICAgICB9XG4gICAgICAgIGN0eC5jbG9zZVBhdGgoKTtcbiAgICAgICAgY3R4LmZpbGwoKTtcbiAgICAgICAgTWFnaWNXYW5kLm1hc2tTZWxlY3Rpb24odGhpcy5zZWxlY3Rpb25EcmF3Q2FudmFzLDAsMCx0aGlzLm1hc2ssJ2FkZCcpO1xuICAgICAgICB0aGlzLnNldFNlbGVjdGlvbih0aGlzLm1hc2spO1xuICAgICAgICB0aGlzLnJlc2V0U2VsZWN0aW9uRHJhd0NhbnZhcygpO1xuICAgICAgICB0aGlzLl9wb2ludHMgPSBbXTtcbiAgICAgICAgZGVsZXRlIHRoaXMuZG93blBvaW50O1xuICAgICAgICBkZWxldGUgdGhpcy5yZWFkeVRvQ2xvc2VQYXRoO1xuICAgICAgICBkZWxldGUgdGhpcy5fbGFzdF9wb2ludDtcbiAgICAgICAgdGhpcy5jYW52YXMub2ZmKCdtb3VzZTptb3ZlJywgdGhpcy5fY2hhbmdlQ3Vyc29yT3ZlckNsb3NlUG9pbnQpO1xuICAgICAgICB0aGlzLmNhbnZhcy5mcmVlRHJhd2luZ0N1cnNvciA9ICdjcm9zc2hhaXInO1xuICAgICAgICB0aGlzLmNhbnZhcy5zZXRDdXJzb3IodGhpcy5jYW52YXMuZnJlZURyYXdpbmdDdXJzb3IpO1xuICAgICAgICAvLyB0aGlzLmRyYXdMaW5lKHRoaXMuX2xhc3RfcG9pbnQsIHRoaXMuZG93blBvaW50KTtcbiAgICAgIH0sXG4gICAgICBfY2hhbmdlQ3Vyc29yT3ZlckNsb3NlUG9pbnQ6ICBmdW5jdGlvbiAoZSkge1xuICAgICAgICB2YXIgY2FudmFzID0gdGhpcyxcbiAgICAgICAgICBwYXRoZmluZGVyID0gY2FudmFzLnBhdGhmaW5kZXI7XG4gICAgICAgIGlmKCFwYXRoZmluZGVyLnRhcmdldClyZXR1cm47XG4gICAgICAgIHZhciBpdnQgPSBmYWJyaWMudXRpbC5pbnZlcnRUcmFuc2Zvcm0oY2FudmFzLnZpZXdwb3J0VHJhbnNmb3JtKSxcbiAgICAgICAgICBwID0gZmFicmljLnV0aWwudHJhbnNmb3JtUG9pbnQoY2FudmFzLmdldFBvaW50ZXIoZS5lLCB0cnVlKSwgaXZ0KTtcbiAgICAgICAgcC54IC09IHBhdGhmaW5kZXIudGFyZ2V0LmxlZnQ7XG4gICAgICAgIHAueSAtPSBwYXRoZmluZGVyLnRhcmdldC50b3A7XG4gICAgICAgIGlmICggcGF0aGZpbmRlci5kb3duUG9pbnQgJiYgcGF0aGZpbmRlci5kb3duUG9pbnQuZGlzdGFuY2VGcm9tKHApIDwgMTApIHtcbiAgICAgICAgICBpZighcGF0aGZpbmRlci5fcGF0aF9vdXQpe1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBwYXRoZmluZGVyLnJlYWR5VG9DbG9zZVBhdGggPSB0cnVlO1xuICAgICAgICAgIGNhbnZhcy5mcmVlRHJhd2luZ0N1cnNvciA9IGNhbnZhcy50YXJnZXRDdXJzb3I7XG4gICAgICAgICAgY2FudmFzLnNldEN1cnNvcihjYW52YXMuZnJlZURyYXdpbmdDdXJzb3IpO1xuICAgICAgICAgIC8vY29uc29sZS5sb2coY2FudmFzLmZyZWVEcmF3aW5nQ3Vyc29yKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBwYXRoZmluZGVyLl9wYXRoX291dCA9IHRydWU7XG4gICAgICAgICAgcGF0aGZpbmRlci5yZWFkeVRvQ2xvc2VQYXRoID0gZmFsc2U7XG4gICAgICAgICAgY2FudmFzLmZyZWVEcmF3aW5nQ3Vyc29yID0gJ2Nyb3NzaGFpcic7XG4gICAgICAgICAgY2FudmFzLnNldEN1cnNvcihjYW52YXMuZnJlZURyYXdpbmdDdXJzb3IpO1xuICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGNhbnZhcy5mcmVlRHJhd2luZ0N1cnNvcik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbn07XG5mb3IodmFyIGkgaW4gUGF0aGZpbmRlci5wcm90b3R5cGUuZHJhd2luZ1Rvb2xzKXtcbiAgZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChQYXRoZmluZGVyLnByb3RvdHlwZSwgUGF0aGZpbmRlci5wcm90b3R5cGUuZHJhd2luZ1Rvb2xzW2ldLnV0aWxzKVxufVxuZmFicmljLlBhdGhmaW5kZXIgPSBQYXRoZmluZGVyO1xuXG5cblxuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUsIHtcbiAgcGF0aGZpbmRlcjogZmFsc2UsXG4gIHNldFBhdGhmaW5kZXI6IGZ1bmN0aW9uICh2YWwpIHtcbiAgICBpZiAodmFsKSB7XG4gICAgICB0aGlzLnBhdGhmaW5kZXIgPSBuZXcgZmFicmljLlBhdGhmaW5kZXIoJ3BhdGhmaW5kZXInKTtcbiAgICAgIHRoaXMucGF0aGZpbmRlci5jYW52YXMgPSB0aGlzO1xuICAgIH1cbiAgfSxcbiAgZ2V0UGF0aGZpbmRlcjogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLnBhdGhmaW5kZXIgfHwgdGhpcy5hcHBsaWNhdGlvbiAmJiB0aGlzLmFwcGxpY2F0aW9uLnBhdGhmaW5kZXI7XG4gIH1cbn0pO1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5BcHBsaWNhdGlvbi5wcm90b3R5cGUsIHtcbiAgaW5pdFBhdGhmaW5kZXI6IGZ1bmN0aW9uICgpIHtcbiAgICAvL2lmKHRoaXMucGF0aGZpbmRlcil7XG5cbiAgICAgIHRoaXMucGF0aGZpbmRlciA9IG5ldyBmYWJyaWMuUGF0aGZpbmRlcih7XG4gICAgICAgIGFwcGxpY2F0aW9uOiB0aGlzXG4gICAgICB9KTtcblxuICAgICAgdGhpcy5wYXRoZmluZGVyLm9uKFwiaW1hZ2U6Y2hhbmdlZFwiLCBmdW5jdGlvbiAoaW1nKSB7XG4gICAgICAgIHZhciBkYXRhVXJsID0gaW1nLnRvRGF0YVVSTCgpO1xuICAgICAgICBpZiAoIXRoaXMudGFyZ2V0Ll9vcmlnaW5hbEVsZW1lbnQpIHtcbiAgICAgICAgICB0aGlzLnRhcmdldC5fb3JpZ2luYWxFbGVtZW50ID0gdGhpcy50YXJnZXQuX2VsZW1lbnQ7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy50YXJnZXQuX2VsZW1lbnQgPSBuZXcgSW1hZ2UoKTtcblxuICAgICAgICB0aGlzLnRhcmdldC5fZWxlbWVudC5vbmxvYWQgPSBmdW5jdGlvbigpe1xuICAgICAgICAgIHRoaXMudGFyZ2V0LmZpcmUoXCJjb250ZW50Om1vZGlmaWVkXCIpXG4gICAgICAgICAgdGhpcy50YXJnZXQuY2FudmFzICYmIHRoaXMudGFyZ2V0LmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICAgICAgfS5iaW5kKHRoaXMpO1xuXG4gICAgICAgIHRoaXMudGFyZ2V0Ll9lbGVtZW50LnNyYyA9IGRhdGFVcmw7XG4gICAgICAgIHRoaXMudGFyZ2V0Ll9lZGl0ZWQgPSB0cnVlXG4gICAgICAgIGlmKHRoaXMudGFyZ2V0LmRpcnR5ICE9PSBcInVuZGVmaW5lZFwiKXtcbiAgICAgICAgICB0aGlzLnRhcmdldC5kaXJ0eSA9IHRydWU7XG4gICAgICAgIH1cblxuXG4gICAgICB9KTtcbiAgICAvL31cbiAgfVxufSk7XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLkFwcGxpY2F0aW9uLnByb3RvdHlwZSwge1xuICBldmVudExpc3RlbmVyczogZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZEFycmF5c09iamVjdChmYWJyaWMuQXBwbGljYXRpb24ucHJvdG90eXBlLmV2ZW50TGlzdGVuZXJzLCB7XG4gICAgXCJyZWFkeVwiOiBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLmluaXRQYXRoZmluZGVyKCk7XG4gICAgfVxuICB9KVxufSk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL21vZHVsZXMvcGF0aGZpbmRlci5qcyIsIm1vZHVsZS5leHBvcnRzID0gXCJQSE4yWnlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpSUhacFpYZENiM2c5SWpBZ01DQXlNaUF5TWlJK1BHY2dkSEpoYm5ObWIzSnRQU0p0WVhSeWFYZ29MakF6T1RZMUlEQWdNQ0F1TURNNU5qVWdNUzR4TmpNZ01TNHhOak1wSWlCbWFXeHNQU0lqTkdRMFpEUmtJajQ4Y0dGMGFDQmtQU0p0TWpVd0xqSWdPREV1TmpGak9UY3VORE1nTUNBeE56a3VOelVnTkRNdU5ETWdNVGM1TGpjMUlEazBMamd6SURBZ01USXVORFE1TFRRdU9UTTBJREkwTGpRME9TMHhNeTQyTkRVZ016VXVORFkxYkRNMUxqUXdNaUF4TUM0ME1EUmpPQzQyTVRNdE1UUXVNakkzSURFekxqVXpNeTB5T1M0Mk1qa2dNVE11TlRNekxUUTFMamcyT1NBd0xUY3lMamsyTlMwNU5DNDBOaTB4TXpBdU1USXRNakUxTGpBMExURXpNQzR4TWkweE1qQXVOVGNnTUMweU1UVXVNRFFnTlRjdU1UWXRNakUxTGpBMElERXpNQzR4TWlBd0lESTJMamt4T0NBeE1pNDVNellnTlRFdU5qUXpJRE0xTGpFNUlEY3lMakUzTFRZdU9UVXhJRFF1TlRBeUxURXpMamMxTmlBeE1DNDFNREl0TVRndU9ETTJJREU0TGprNE5DMHhNQzQwTlRNZ01UY3VORFE1TFRFd0xqWTJJRE01TGpBNUxTNDJORFVnTmpRdU16VWdPUzQwTXpNZ01qTXVOemt4SURjdU1USTFJRE15TGpVNE1pQTFMalk1TXlBek5TNHlOQzB6TGpNMU5DQTJMak15TWkweE9DNHhNeUE1TGpVeE5DMHpNaTR6T0RVZ01USXVOVGsyTFRNdU5EZzJMamMxT0MwM0xqQTBJREV1TlRNeExURXdMalU0TWlBeUxqTTNNUzA1TGpRNE5DQXlMakkwTFRFMUxqTTFNeUF4TVM0M01qVXRNVE11TVRNZ01qRXVNak1nTVM0NU1ESWdPQzR4TVRFZ09TNHhOalFnTVRNdU5UazJJREUzTGpFMklERXpMalU1TmlBeExqTTBJREFnTWk0M01Ea3RMakUySURRdU1EWTRMUzQwTmpjZ015NHpNaTB1TnpreElEWXVOalUyTFRFdU5URTRJRGt1T1RNeUxUSXVNakkzSURJeExqRXhMVFF1TlRZMElEUTFMakF5TFRrdU56UXlJRFUyTGpBNExUTXdMalE0TWlBNExqUTROaTB4TlM0NU1ESWdOeTR4T1RVdE16WXVOVEUyTFRRdU1ETXROalF1T0RVdE5TNDNNalV0TVRRdU5ETTFMVFl1TXpnMUxUSTFMalUyTkMweExqazBOeTB6TXk0eElEUXVPVFkxTFRndU5EVXhJREUyTGpFMExURXlMakl3TnlBeU1pNHhPUzB4TXk0ME5qY2dNelV1TnpBMUlERTVMamt3TWlBNE1pNDROU0F6TWk0ek5UUWdNVE0xTGpVNUlETXpMamcyT1d3dE1UQXVOVEEwTFRNMUxqYzBZeTA0Tnk0NE55MDFMamMxT0MweE5UZ3VOVFl0TkRZdU5EVXRNVFU0TGpVMkxUazBMakEzTGpBd01ERXROVEV1TkNBNE1pNHpNaTA1TkM0NE15QXhOemt1TnpVdE9UUXVPRE1pTHo0OGNHRjBhQ0JrUFNKdE5EZzNMalUzSURJMk9TNDJNMnd0TWpJeUxqQTFMVFkxTGpJM1l5MHhMakV4TlMwdU16TTRMVEl1TWpRMExTNDBPREl0TXk0ek56TXRMalE0TWkwekxqRXhNeUF3TFRZdU1UVTRJREV1TWpJM0xUZ3VORE0wSURNdU5TMHpMakE1TmlBekxqQTRMVFF1TWpVNElEY3VOakV6TFRNdU1ESWdNVEV1TnpnNWJEWTFMakkzSURJeU1pNHhZekV1TXpRZ05DNDJNVE1nTlM0ek5USWdOeTQ1T0RJZ01UQXVNVFF6SURndU5TNDBOVE11TURRM0xqZzVNUzR3TmpRZ01TNHpNakl1TURZMElEUXVNekE1SURBZ09DNHpNRGN0TWk0ek16Z2dNVEF1TkRNNUxUWXVNVFl5YkRVMExqQTRMVGs0TGpBMElEazRMakF6TFRVMExqQTVZelF1TWpJMUxUSXVNekl5SURZdU5qSTVMVFl1T1RVeElEWXVNUzB4TVM0M01qY3RMalV4TkMwMExqYzROeTB6TGpnM05DMDRMamd3TlMwNExqVXdNaTB4TUM0eE56WWlMejQ4TDJjK1BDOXpkbWMrQ2c9PVwiXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi4vbm9kZV9tb2R1bGVzL2Jhc2U2NC1sb2FkZXIhLi9tZWRpYS9sYXNzby5zdmdcbi8vIG1vZHVsZSBpZCA9IDgwXG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIlxuLy8gcmVxdWlyZShcIi4uL21vZHVsZXMvcGF0aGZpbmRlclwiKTtcbnJlcXVpcmUoXCIuLi9maWx0ZXJzL3JlbW92ZVdoaXRlXCIpO1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5JbWFnZS5wcm90b3R5cGUsIHtcbiAgcmVtb3ZlV2hpdGU6IGZ1bmN0aW9uICh0aHJlc2hvbGQsIHJlbW92ZUFsbCwgY2FsbGJhY2spIHtcblxuXG4gICAgdmFyIHJ3ZiA9IF8uZmluZFdoZXJlKHRoaXMuZmlsdGVycywge3R5cGU6ICdSZW1vdmVXaGl0ZURQJ30pO1xuXG4gICAgaWYgKHJ3Zikge1xuICAgICAgcndmLm9wdGlvbnMuY29sb3JUaHJlc2hvbGQgPSB0aHJlc2hvbGQ7XG4gICAgICByd2Yub3B0aW9ucy5mcm9tQ29ybmVycyA9ICFyZW1vdmVBbGw7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJ3ZiA9IG5ldyBmYWJyaWMuSW1hZ2UuZmlsdGVycy5SZW1vdmVXaGl0ZURQKHtcbiAgICAgICAgZnJvbUNvcm5lcnM6ICFyZW1vdmVBbGwsXG4gICAgICAgIGJsdXJSYWRpdXM6IDIsXG4gICAgICAgIGNvbG9yVGhyZXNob2xkOiB0aHJlc2hvbGRcbiAgICAgIH0pO1xuICAgICAgdGhpcy5maWx0ZXJzLnB1c2gocndmKTtcbiAgICB9XG5cbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgIHRoaXMuYXBwbHlGaWx0ZXJzKGZ1bmN0aW9uICgpIHtcbiAgICAgIC8vX3RoaXMud2lkdGggPSBfdGhpcy5fZWxlbWVudC53aWR0aDtcbiAgICAgIC8vX3RoaXMuaGVpZ2h0ID0gX3RoaXMuX2VsZW1lbnQuaGVpZ2h0O1xuICAgICAgX3RoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgICAgX3RoaXMuZmlyZShcImNvbnRlbnQ6bW9kaWZpZWRcIiwge2ZpbHRlcjogcndmLCBib3VuZHM6IHJ3Zi5ib3VuZHN9KTtcbiAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKCk7XG4gICAgfSk7XG4gIH0sXG4gIHJlbW92ZVdoaXRlQWxsOiB0cnVlLFxuXG4gIGFjdGlvbnM6IGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLkltYWdlLnByb3RvdHlwZS5hY3Rpb25zLCB7XG4gICAgcmVtb3ZlV2hpdGVGcm9tQm9yZGVyczoge1xuICAgICAgdGl0bGU6ICdSZW1vdmUgQmFja2dyb3VuZCcsXG4gICAgICB0eXBlOiAnZWZmZWN0JyxcbiAgICAgIGNsYXNzTmFtZTogXCJmYSBmYS1kb3QtY2lyY2xlLW9cIixcbiAgICAgIGVmZmVjdFRwbDogJzxidXR0b24gaWQ9XCJzZWxlY3QtY29sb3JzLWFjdGlvbi1idXR0b25cIiBjbGFzcz1cImZhIGZhLWNoZWNrXCI+PC9idXR0b24+JyArXG4gICAgICAnPGlucHV0IGlkPVwic2VsZWN0LWNvbG9ycy1jaGVja2JveFwiIHR5cGU9XCJjaGVja2JveFwiPicgK1xuICAgICAgJzxpbnB1dCBpZD1cInNlbGVjdC1jb2xvcnMtdGhyZXNob2xkXCIgdHlwZT1cInJhbmdlXCIgICBtaW49XCIxXCIgbWF4PVwiMjU1XCI+JyxcbiAgICAgIGFjdGlvblBhcmFtZXRlcnM6IGZ1bmN0aW9uIChlbCwgZGF0YSkge1xuICAgICAgICB2YXJcbiAgICAgICAgICBhY3Rpb25DaGsgPSBlbC5maW5kKCcjc2VsZWN0LWNvbG9ycy1jaGVja2JveCcpLFxuICAgICAgICAgIGFjdGlvbkJ0biA9IGVsLmZpbmQoJyNzZWxlY3QtY29sb3JzLWFjdGlvbi1idXR0b24nKTtcbiAgICAgICAgZGF0YS50aHJlc2hvbGRFbCA9IGVsLmZpbmQoJyNzZWxlY3QtY29sb3JzLXRocmVzaG9sZCcpO1xuXG4gICAgICAgIGRhdGEucmVtb3ZlV2hpdGVBbGwgPSBhY3Rpb25DaGsuaXMoXCI6Y2hlY2tlZFwiKTtcbiAgICAgICAgYWN0aW9uQ2hrLmNoYW5nZShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgZGF0YS5yZW1vdmVXaGl0ZUFsbCA9IGFjdGlvbkNoay5pcyhcIjpjaGVja2VkXCIpXG4gICAgICAgIH0pO1xuICAgICAgICBhY3Rpb25CdG4uY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGRhdGEuYWN0aW9uKCk7XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoIWRhdGEuX19hY3Rpb24pIHtcblxuICAgICAgICAgIGRhdGEuX19hY3Rpb24gPSBkYXRhLmFjdGlvbjtcbiAgICAgICAgICBkYXRhLmFjdGlvbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGRhdGEuX19hY3Rpb24ocGFyc2VJbnQoZGF0YS50aHJlc2hvbGRFbC52YWwoKSksIGRhdGEucmVtb3ZlV2hpdGVBbGwpXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGFjdGlvbjogXCJyZW1vdmVXaGl0ZVwiLFxuICAgICAgaW5zZXJ0OiAnaW1hZ2VUb29scydcbiAgICB9XG4gIH0pXG59KTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyBzcmMvc2hhcGVzL2ltYWdlLnJlbW92ZS13aGl0ZS5qcyIsIid1c2Ugc3RyaWN0JztcblxuXG5mYWJyaWMuUmVtb3ZlV2hpdGVEUCA9IGZhYnJpYy5JbWFnZS5maWx0ZXJzLlJlbW92ZVdoaXRlRFAgPSAgZmFicmljLnV0aWwuY3JlYXRlQ2xhc3MoZmFicmljLkltYWdlLmZpbHRlcnMuQmFzZUZpbHRlcix7XG4gICAgdHlwZTogJ1JlbW92ZVdoaXRlRFAnLFxuICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgICAgaWYob3B0aW9ucylkZWxldGUgb3B0aW9ucy50eXBlO1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSBmYWJyaWMudXRpbC5vYmplY3QuZGVmYXVsdHMob3B0aW9ucyB8fCB7fSx7XG4gICAgICAgICAgICAgICAgZnJvbUNvcm5lcnMgOiB0cnVlLFxuICAgICAgICAgICAgICAgIGJsdXJSYWRpdXM6IDIsXG4gICAgICAgICAgICAgICAgY29sb3JUaHJlc2hvbGQ6IDMyXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5wYXRoZmluZGVyID0gbmV3IGZhYnJpYy5QYXRoZmluZGVyKHRoaXMub3B0aW9ucyk7XG4gICAgfSxcbiAgICBhcHBseVRvOiBmdW5jdGlvbihjYW52YXNFbCkge1xuXG4gICAgICAgIHZhciBwYXRoZmluZGVyID0gdGhpcy5wYXRoZmluZGVyO1xuXG4gICAgICAgIHBhdGhmaW5kZXIuY29sb3JUaHJlc2hvbGQgPSB0aGlzLm9wdGlvbnMuY29sb3JUaHJlc2hvbGQ7XG4gICAgICAgIHBhdGhmaW5kZXIuc2V0UGljdHVyZShjYW52YXNFbCk7XG4gICAgICAgIHBhdGhmaW5kZXIuc2VsZWN0QmFja2dyb3VuZCh0aGlzLm9wdGlvbnMuZnJvbUNvcm5lcnMpO1xuICAgICAgICBpZihwYXRoZmluZGVyLm1hc2suY291bnQgKSB7XG4gICAgICAgICAgcGF0aGZpbmRlci5fZmlsbChbMCwgMCwgMCwgMF0pO1xuICAgICAgICAgIHBhdGhmaW5kZXIubWFzayA9IGZhYnJpYy5NYWdpY1dhbmQuaW52ZXJ0TWFzayhwYXRoZmluZGVyLm1hc2spO1xuICAgICAgICAgIC8vdG9kbyBpbnZlcnRpbmcgbWFza1xuXG4gICAgICAgICAgaWYocGF0aGZpbmRlci5tYXNrLmNvdW50KXtcbiAgICAgICAgICAgIHZhciBfd2lkdGggPSBwYXRoZmluZGVyLm1hc2suYm91bmRzLm1heFggLSBwYXRoZmluZGVyLm1hc2suYm91bmRzLm1pblggKyAxO1xuICAgICAgICAgICAgdmFyIF9oZWlnaHQgPSBwYXRoZmluZGVyLm1hc2suYm91bmRzLm1heFkgLSBwYXRoZmluZGVyLm1hc2suYm91bmRzLm1pblkgKyAxO1xuICAgICAgICAgICAgdmFyIGN0eCA9IGNhbnZhc0VsLmdldENvbnRleHQoJzJkJyk7XG4gICAgICAgICAgICB2YXIgaW1hZ2VEYXRhID0gcGF0aGZpbmRlci5lZGl0ZWRJbWFnZUNhbnZhcy5nZXRDb250ZXh0KCcyZCcpLmdldEltYWdlRGF0YShwYXRoZmluZGVyLm1hc2suYm91bmRzLm1pblgsIHBhdGhmaW5kZXIubWFzay5ib3VuZHMubWluWSwgX3dpZHRoLCBfaGVpZ2h0KTtcbiAgICAgICAgICAgIGNhbnZhc0VsLndpZHRoICA9IF93aWR0aDtcbiAgICAgICAgICAgIGNhbnZhc0VsLmhlaWdodCA9IF9oZWlnaHQ7XG4gICAgICAgICAgICBjdHgucHV0SW1hZ2VEYXRhKGltYWdlRGF0YSwgMCwgMCk7XG4gICAgICAgICAgICB0aGlzLmJvdW5kcyA9IHBhdGhmaW5kZXIubWFzay5ib3VuZHM7XG4gICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICB2YXIgY3R4ID0gY2FudmFzRWwuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICAgICAgICAgIGNhbnZhc0VsLndpZHRoICA9IDE7XG4gICAgICAgICAgICBjYW52YXNFbC5oZWlnaHQgPSAxO1xuICAgICAgICAgICAgY3R4LmNsZWFyUmVjdCgwLDAsMSwxKTtcbiAgICAgICAgICAgIHRoaXMuYm91bmRzID0ge1xuICAgICAgICAgICAgICBtYXhYOiAwLFxuICAgICAgICAgICAgICBtYXhZOiAwLFxuICAgICAgICAgICAgICBtaW5YOiAwLFxuICAgICAgICAgICAgICBtaW5ZOiAwXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cblxuXG4gICAgICAgICAgICAvL2NsaXAgdGhlIGltYWdlXG4gICAgICAgIHBhdGhmaW5kZXIuY2xlYXJNZW1vcnkoKTtcblxuICAgIH0sXG4gICAgdG9PYmplY3Q6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCh0aGlzLmNhbGxTdXBlcigndG9PYmplY3QnKSwgdGhpcy5vcHRpb25zKTtcbiAgICB9XG59KTtcblxuZmFicmljLkltYWdlLmZpbHRlcnMuUmVtb3ZlV2hpdGVEUC5mcm9tT2JqZWN0ID0gZnVuY3Rpb24ob2JqZWN0KSB7XG4gICAgcmV0dXJuIG5ldyBmYWJyaWMuSW1hZ2UuZmlsdGVycy5SZW1vdmVXaGl0ZURQKG9iamVjdCk7XG59O1xuXG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIHNyYy9maWx0ZXJzL3JlbW92ZVdoaXRlLmpzIiwiXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbi8vIExpc3RTdHlsZVxuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5UZXh0Ym94LnByb3RvdHlwZSwge1xuICBzdGF0ZVByb3BlcnRpZXM6IGZhYnJpYy5SZWN0LnByb3RvdHlwZS5zdGF0ZVByb3BlcnRpZXMuY29uY2F0KFtcImxpc3RTdHlsZVR5cGVcIixcImxpc3RTdHlsZUZvcm1hdFwiLFwibGlzdFRleHRQYWRkaW5nXCIsXCJ0ZXh0UGFkZGluZ1wiXSksXG4gIGxpc3RTdHlsZVR5cGU6IFwibm9uZVwiLFxuICBsaXN0U3R5bGVGb3JtYXQ6IFwiTi5cIixcbiAgbGlzdFRleHRQYWRkaW5nOiA0MCxcbiAgdGV4dFBhZGRpbmc6IDAsXG4gIHNldFRleHRQYWRkaW5nOiBmdW5jdGlvbih2YWwpe1xuICAgIHRoaXMudGV4dFBhZGRpbmcgPSB2YWw7XG4gICAgdGhpcy5faW5pdERpbWVuc2lvbnMoKTtcbiAgfSxcbiAgc2V0TGlzdFN0eWxlVHlwZTogZnVuY3Rpb24odmFsKXtcbiAgICB0aGlzLmxpc3RTdHlsZVR5cGUgPSB2YWw7XG4gICAgdGhpcy5zZXRUZXh0UGFkZGluZyh2YWwgPT09IFwibm9uZVwiID8gMDogdGhpcy5saXN0VGV4dFBhZGRpbmcpO1xuICB9LFxuICAvKipcbiAgICogV3JhcHMgdGV4dCB1c2luZyB0aGUgJ3dpZHRoJyBwcm9wZXJ0eSBvZiBUZXh0Ym94LiBGaXJzdCB0aGlzIGZ1bmN0aW9uXG4gICAqIHNwbGl0cyB0ZXh0IG9uIG5ld2xpbmVzLCBzbyB3ZSBwcmVzZXJ2ZSBuZXdsaW5lcyBlbnRlcmVkIGJ5IHRoZSB1c2VyLlxuICAgKiBUaGVuIGl0IHdyYXBzIGVhY2ggbGluZSB1c2luZyB0aGUgd2lkdGggb2YgdGhlIFRleHRib3ggYnkgY2FsbGluZ1xuICAgKiBfd3JhcExpbmUoKS5cbiAgICogQHBhcmFtIHtDYW52YXNSZW5kZXJpbmdDb250ZXh0MkR9IGN0eCBDb250ZXh0IHRvIHVzZSBmb3IgbWVhc3VyZW1lbnRzXG4gICAqIEBwYXJhbSB7U3RyaW5nfSB0ZXh0IFRoZSBzdHJpbmcgb2YgdGV4dCB0aGF0IGlzIHNwbGl0IGludG8gbGluZXNcbiAgICogQHJldHVybnMge0FycmF5fSBBcnJheSBvZiBsaW5lc1xuICAgKi9cbiAgX3dyYXBUZXh0OiBmdW5jdGlvbihjdHgsIHRleHQpIHtcbiAgICB2YXIgbGluZXMgPSB0ZXh0LnNwbGl0KHRoaXMuX3JlTmV3bGluZSksIHdyYXBwZWQgPSBbXSwgaTtcblxuXG4gICAgdGhpcy5fcGFyYWdyYXBocyA9IHt9O1xuXG4gICAgZm9yIChpID0gMDsgaSA8IGxpbmVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICB0aGlzLl9wYXJhZ3JhcGhzW3dyYXBwZWQubGVuZ3RoXSA9IHRoaXMubGlzdFN0eWxlRm9ybWF0LnJlcGxhY2UoXCJOXCIsaSArIDEpXG4gICAgICB3cmFwcGVkID0gd3JhcHBlZC5jb25jYXQodGhpcy5fd3JhcExpbmUoY3R4LCBsaW5lc1tpXSwgaSkpO1xuICAgIH1cblxuICAgIHJldHVybiB3cmFwcGVkO1xuICB9LFxuXG5cbiAgLyoqXG4gICAqIFdyYXBzIGEgbGluZSBvZiB0ZXh0IHVzaW5nIHRoZSB3aWR0aCBvZiB0aGUgVGV4dGJveCBhbmQgYSBjb250ZXh0LlxuICAgKiBAcGFyYW0ge0NhbnZhc1JlbmRlcmluZ0NvbnRleHQyRH0gY3R4IENvbnRleHQgdG8gdXNlIGZvciBtZWFzdXJlbWVudHNcbiAgICogQHBhcmFtIHtTdHJpbmd9IHRleHQgVGhlIHN0cmluZyBvZiB0ZXh0IHRvIHNwbGl0IGludG8gbGluZXNcbiAgICogQHBhcmFtIHtOdW1iZXJ9IGxpbmVJbmRleFxuICAgKiBAcmV0dXJucyB7QXJyYXl9IEFycmF5IG9mIGxpbmUocykgaW50byB3aGljaCB0aGUgZ2l2ZW4gdGV4dCBpcyB3cmFwcGVkXG4gICAqIHRvLlxuICAgKi9cbiAgX3dyYXBMaW5lOiBmdW5jdGlvbihjdHgsIHRleHQsIGxpbmVJbmRleCkge1xuICAgIHZhciBsaW5lV2lkdGggICAgICAgID0gMCxcbiAgICAgIGxpbmVzICAgICAgICAgICAgPSBbXSxcbiAgICAgIGxpbmUgICAgICAgICAgICAgPSAnJyxcbiAgICAgIHdvcmRzICAgICAgICAgICAgPSB0ZXh0LnNwbGl0KCcgJyksXG4gICAgICB3b3JkICAgICAgICAgICAgID0gJycsXG4gICAgICBvZmZzZXQgICAgICAgICAgID0gMCxcbiAgICAgIGluZml4ICAgICAgICAgICAgPSAnICcsXG4gICAgICB3b3JkV2lkdGggICAgICAgID0gMCxcbiAgICAgIGluZml4V2lkdGggICAgICAgPSAwLFxuICAgICAgbGFyZ2VzdFdvcmRXaWR0aCA9IDAsXG4gICAgICBsaW5lSnVzdFN0YXJ0ZWQgPSB0cnVlLFxuICAgICAgYWRkaXRpb25hbFNwYWNlID0gdGhpcy5fZ2V0V2lkdGhPZkNoYXJTcGFjaW5nKCk7XG5cblxuXG4gICAgdmFyIF90ZXh0QXJlYVdpZHRoID0gdGhpcy53aWR0aDtcbiAgICBpZih0aGlzLnRleHRQYWRkaW5nKXtcbiAgICAgIF90ZXh0QXJlYVdpZHRoIC09IHRoaXMudGV4dFBhZGRpbmdcbiAgICB9XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB3b3Jkcy5sZW5ndGg7IGkrKykge1xuICAgICAgd29yZCA9IHdvcmRzW2ldO1xuICAgICAgd29yZFdpZHRoID0gdGhpcy5fbWVhc3VyZVRleHQoY3R4LCB3b3JkLCBsaW5lSW5kZXgsIG9mZnNldCk7XG5cbiAgICAgIG9mZnNldCArPSB3b3JkLmxlbmd0aDtcblxuICAgICAgbGluZVdpZHRoICs9IGluZml4V2lkdGggKyB3b3JkV2lkdGggLSBhZGRpdGlvbmFsU3BhY2U7XG5cbiAgICAgIGlmIChsaW5lV2lkdGggPj0gX3RleHRBcmVhV2lkdGggJiYgIWxpbmVKdXN0U3RhcnRlZCkge1xuICAgICAgICBsaW5lcy5wdXNoKGxpbmUpO1xuICAgICAgICBsaW5lID0gJyc7XG4gICAgICAgIGxpbmVXaWR0aCA9IHdvcmRXaWR0aDtcbiAgICAgICAgbGluZUp1c3RTdGFydGVkID0gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICBsaW5lV2lkdGggKz0gYWRkaXRpb25hbFNwYWNlO1xuICAgICAgfVxuXG4gICAgICBpZiAoIWxpbmVKdXN0U3RhcnRlZCkge1xuICAgICAgICBsaW5lICs9IGluZml4O1xuICAgICAgfVxuICAgICAgbGluZSArPSB3b3JkO1xuXG4gICAgICBpbmZpeFdpZHRoID0gdGhpcy5fbWVhc3VyZVRleHQoY3R4LCBpbmZpeCwgbGluZUluZGV4LCBvZmZzZXQpO1xuICAgICAgb2Zmc2V0Kys7XG4gICAgICBsaW5lSnVzdFN0YXJ0ZWQgPSBmYWxzZTtcbiAgICAgIC8vIGtlZXAgdHJhY2sgb2YgbGFyZ2VzdCB3b3JkXG4gICAgICBpZiAod29yZFdpZHRoID4gbGFyZ2VzdFdvcmRXaWR0aCkge1xuICAgICAgICBsYXJnZXN0V29yZFdpZHRoID0gd29yZFdpZHRoO1xuICAgICAgfVxuICAgIH1cblxuICAgIGkgJiYgbGluZXMucHVzaChsaW5lKTtcblxuICAgIGlmIChsYXJnZXN0V29yZFdpZHRoID4gdGhpcy5keW5hbWljTWluV2lkdGgpIHtcbiAgICAgIHRoaXMuZHluYW1pY01pbldpZHRoID0gbGFyZ2VzdFdvcmRXaWR0aCAtIGFkZGl0aW9uYWxTcGFjZTtcbiAgICB9XG5cbiAgICByZXR1cm4gbGluZXM7XG4gIH0sXG4gIC8qKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAcGFyYW0ge051bWJlcn0gbGluZVdpZHRoIFdpZHRoIG9mIHRleHQgbGluZVxuICAgKiBAcmV0dXJuIHtOdW1iZXJ9IExpbmUgbGVmdCBvZmZzZXRcbiAgICovXG4gIF9nZXRMaW5lTGVmdE9mZnNldDogZnVuY3Rpb24obGluZVdpZHRoKSB7XG4gICAgaWYgKHRoaXMudGV4dEFsaWduID09PSAnY2VudGVyJykge1xuICAgICAgcmV0dXJuICh0aGlzLndpZHRoIC0gbGluZVdpZHRoKSAvIDIgKyB0aGlzLnRleHRQYWRkaW5nLzI7XG4gICAgfVxuICAgIGlmICh0aGlzLnRleHRBbGlnbiA9PT0gJ3JpZ2h0Jykge1xuICAgICAgcmV0dXJuIHRoaXMud2lkdGggLSBsaW5lV2lkdGg7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLnRleHRQYWRkaW5nO1xuICB9LFxuICAvKipcbiAgICogQHByaXZhdGVcbiAgICogQHBhcmFtIHtDYW52YXNSZW5kZXJpbmdDb250ZXh0MkR9IGN0eCBDb250ZXh0IHRvIHJlbmRlciBvblxuICAgKiBAcGFyYW0ge1N0cmluZ30gbWV0aG9kIE1ldGhvZCBuYW1lIChcImZpbGxUZXh0XCIgb3IgXCJzdHJva2VUZXh0XCIpXG4gICAqL1xuICBfcmVuZGVyVGV4dENvbW1vbjogZnVuY3Rpb24oY3R4LCBtZXRob2QpIHtcblxuICAgIHZhciBsaW5lSGVpZ2h0cyA9IDAsIGxlZnQgPSB0aGlzLl9nZXRMZWZ0T2Zmc2V0KCksIHRvcCA9IHRoaXMuX2dldFRvcE9mZnNldCgpO1xuXG4gICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHRoaXMuX3RleHRMaW5lcy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgdmFyIGhlaWdodE9mTGluZSA9IHRoaXMuX2dldEhlaWdodE9mTGluZShjdHgsIGkpLFxuICAgICAgICBtYXhIZWlnaHQgPSBoZWlnaHRPZkxpbmUgLyB0aGlzLmxpbmVIZWlnaHQsXG4gICAgICAgIGxpbmVXaWR0aCA9IHRoaXMuX2dldExpbmVXaWR0aChjdHgsIGkpLFxuICAgICAgICBsZWZ0T2Zmc2V0ID0gdGhpcy5fZ2V0TGluZUxlZnRPZmZzZXQobGluZVdpZHRoKTtcblxuXG4gICAgICB0aGlzLl9yZW5kZXJUZXh0TGluZShcbiAgICAgICAgbWV0aG9kLFxuICAgICAgICBjdHgsXG4gICAgICAgIHRoaXMuX3RleHRMaW5lc1tpXSxcbiAgICAgICAgbGVmdCArIGxlZnRPZmZzZXQsXG4gICAgICAgIHRvcCArIGxpbmVIZWlnaHRzICsgbWF4SGVpZ2h0LFxuICAgICAgICBpXG4gICAgICApO1xuICAgICAgbGluZUhlaWdodHMgKz0gaGVpZ2h0T2ZMaW5lO1xuICAgIH1cbiAgfSxcblxuXG4gIC8qKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAcGFyYW0ge1N0cmluZ30gbWV0aG9kIE1ldGhvZCBuYW1lIChcImZpbGxUZXh0XCIgb3IgXCJzdHJva2VUZXh0XCIpXG4gICAqIEBwYXJhbSB7Q2FudmFzUmVuZGVyaW5nQ29udGV4dDJEfSBjdHggQ29udGV4dCB0byByZW5kZXIgb25cbiAgICogQHBhcmFtIHtTdHJpbmd9IGxpbmUgVGV4dCB0byByZW5kZXJcbiAgICogQHBhcmFtIHtOdW1iZXJ9IGxlZnQgTGVmdCBwb3NpdGlvbiBvZiB0ZXh0XG4gICAqIEBwYXJhbSB7TnVtYmVyfSB0b3AgVG9wIHBvc2l0aW9uIG9mIHRleHRcbiAgICogQHBhcmFtIHtOdW1iZXJ9IGxpbmVJbmRleCBJbmRleCBvZiBhIGxpbmUgaW4gYSB0ZXh0XG4gICAqL1xuICBfcmVuZGVyVGV4dExpbmU6IGZ1bmN0aW9uKG1ldGhvZCwgY3R4LCBsaW5lLCBsZWZ0LCB0b3AsIGxpbmVJbmRleCkge1xuXG5cblxuICAgIC8vIGxpZnQgdGhlIGxpbmUgYnkgcXVhcnRlciBvZiBmb250U2l6ZVxuICAgIHRvcCAtPSB0aGlzLmZvbnRTaXplICogdGhpcy5fZm9udFNpemVGcmFjdGlvbjtcblxuICAgIHN3aXRjaCh0aGlzLmxpc3RTdHlsZVR5cGUpe1xuICAgICAgY2FzZSBcImRlY2ltYWxcIjpcbiAgICAgICAgaWYoIHRoaXMuX3BhcmFncmFwaHNbbGluZUluZGV4XSl7XG4gICAgICAgICAgLy8gbGlmdCB0aGUgbGluZSBieSBxdWFydGVyIG9mIGZvbnRTaXplXG4gICAgICAgICAgdGhpcy5fcmVuZGVyQ2hhcnMobWV0aG9kLCBjdHgsIHRoaXMuX3BhcmFncmFwaHNbbGluZUluZGV4XSAsIGxlZnQgLSB0aGlzLnRleHRQYWRkaW5nICwgdG9wICAsIGxpbmVJbmRleCwgMCk7XG4gICAgICAgIH1cbiAgICB9XG5cblxuICAgIC8vIHNob3J0LWNpcmN1aXRcbiAgICB2YXIgbGluZVdpZHRoID0gdGhpcy5fZ2V0TGluZVdpZHRoKGN0eCwgbGluZUluZGV4KTtcbiAgICBpZiAodGhpcy50ZXh0QWxpZ24gIT09ICdqdXN0aWZ5JyB8fCB0aGlzLndpZHRoIDwgbGluZVdpZHRoKSB7XG5cbiAgICAgIHRoaXMuX3JlbmRlckNoYXJzKG1ldGhvZCwgY3R4LCBsaW5lLCBsZWZ0LCB0b3AsIGxpbmVJbmRleCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG5cbiAgICAvLyBzdHJldGNoIHRoZSBsaW5lXG4gICAgdmFyIHdvcmRzID0gbGluZS5zcGxpdCgvXFxzKy8pLFxuICAgICAgY2hhck9mZnNldCA9IDAsXG4gICAgICB3b3Jkc1dpZHRoID0gdGhpcy5fZ2V0V2lkdGhPZldvcmRzKGN0eCwgd29yZHMuam9pbignJyksIGxpbmVJbmRleCwgMCksXG4gICAgICB3aWR0aERpZmYgPSB0aGlzLndpZHRoIC0gd29yZHNXaWR0aCAtIHRoaXMudGV4dFBhZGRpbmcsXG4gICAgICBudW1TcGFjZXMgPSB3b3Jkcy5sZW5ndGggLSAxLFxuICAgICAgc3BhY2VXaWR0aCA9IG51bVNwYWNlcyA+IDAgPyB3aWR0aERpZmYgLyBudW1TcGFjZXMgOiAwLFxuICAgICAgbGVmdE9mZnNldCA9IDAsIHdvcmQ7XG5cbiAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gd29yZHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgIHdoaWxlIChsaW5lW2NoYXJPZmZzZXRdID09PSAnICcgJiYgY2hhck9mZnNldCA8IGxpbmUubGVuZ3RoKSB7XG4gICAgICAgIGNoYXJPZmZzZXQrKztcbiAgICAgIH1cbiAgICAgIHdvcmQgPSB3b3Jkc1tpXTtcbiAgICAgIHRoaXMuX3JlbmRlckNoYXJzKG1ldGhvZCwgY3R4LCB3b3JkLCBsZWZ0ICsgbGVmdE9mZnNldCwgdG9wLCBsaW5lSW5kZXgsIGNoYXJPZmZzZXQpO1xuICAgICAgbGVmdE9mZnNldCArPSB0aGlzLl9nZXRXaWR0aE9mV29yZHMoY3R4LCB3b3JkLCBsaW5lSW5kZXgsIGNoYXJPZmZzZXQpICsgc3BhY2VXaWR0aDtcbiAgICAgIGNoYXJPZmZzZXQgKz0gd29yZC5sZW5ndGg7XG4gICAgfVxuICB9LFxuICB0b2dnbGVMaXN0U3R5bGVUeXBlOiBmdW5jdGlvbigpe1xuICAgIHRoaXMuc2V0TGlzdFN0eWxlVHlwZSh0aGlzLmxpc3RTdHlsZVR5cGUgPT0gXCJub25lXCIgPyBcImRlY2ltYWxcIiA6IFwibm9uZVwiKTtcbiAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgfSxcbiAgYWN0aW9uczoge1xuICAgIHRvZ2dsZUxpc3RTdHlsZVR5cGU6IHtcbiAgICAgIGNsYXNzTmFtZTogJ2ZhIGZhLWxpc3Qtb2wnLFxuICAgICAgdGl0bGU6ICdvcmRlcmVkIGxpc3QnXG4gICAgfVxuICB9XG5cbn0pXG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gc3JjL3NoYXBlcy90ZXh0Ym94Lmxpc3QuanMiLCJtb2R1bGUuZXhwb3J0cyA9IFwiUEQ5NGJXd2dkbVZ5YzJsdmJqMGlNUzR3SWlCbGJtTnZaR2x1WnowaVZWUkdMVGdpSUhOMFlXNWtZV3h2Ym1VOUltNXZJajgrQ2p3aExTMGdRM0psWVhSbFpDQjNhWFJvSUVsdWEzTmpZWEJsSUNob2RIUndPaTh2ZDNkM0xtbHVhM05qWVhCbExtOXlaeThwSUMwdFBnbzhjM1puQ2lBZ0lDQjRiV3h1Y3pwcGJtdHpZMkZ3WlQwaWFIUjBjRG92TDNkM2R5NXBibXR6WTJGd1pTNXZjbWN2Ym1GdFpYTndZV05sY3k5cGJtdHpZMkZ3WlNJS0lDQWdJSGh0Ykc1ek9uSmtaajBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TVRrNU9TOHdNaTh5TWkxeVpHWXRjM2x1ZEdGNExXNXpJeUlLSUNBZ0lIaHRiRzV6UFNKb2RIUndPaTh2ZDNkM0xuY3pMbTl5Wnk4eU1EQXdMM04yWnlJS0lDQWdJSGh0Ykc1ek9uTnZaR2x3YjJScFBTSm9kSFJ3T2k4dmMyOWthWEJ2WkdrdWMyOTFjbU5sWm05eVoyVXVibVYwTDBSVVJDOXpiMlJwY0c5a2FTMHdMbVIwWkNJS0lDQWdJSGh0Ykc1ek9tTmpQU0pvZEhSd09pOHZZM0psWVhScGRtVmpiMjF0YjI1ekxtOXlaeTl1Y3lNaUNpQWdJQ0I0Yld4dWN6cDRiR2x1YXowaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1UazVPUzk0YkdsdWF5SUtJQ0FnSUhodGJHNXpPbVJqUFNKb2RIUndPaTh2Y0hWeWJDNXZjbWN2WkdNdlpXeGxiV1Z1ZEhNdk1TNHhMeUlLSUNBZ0lIaHRiRzV6T25OMlp6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lDaUFnSUNCNGJXeHVjenB1Y3pFOUltaDBkSEE2THk5emIzcHBMbUpoYVdWeWIzVm5aUzVtY2lJS0lDQWdJR2xrUFNKemRtYzBPRGc0SWdvZ0lDQWdjMjlrYVhCdlpHazZaRzlqYm1GdFpUMGlkMkZ5Ym1sdVoxOWlkWFIwYjI0dWMzWm5JZ29nSUNBZ2RtbGxkMEp2ZUQwaU1DQXdJRFF3TUNBME1EQWlDaUFnSUNCMlpYSnphVzl1UFNJeExqRWlDaUFnSUNCcGJtdHpZMkZ3WlRwMlpYSnphVzl1UFNJd0xqUTRMakFnY2prMk5UUWlDaUFnUGdvZ0lEeGtaV1p6Q2lBZ0lDQWdJR2xrUFNKa1pXWnpORGc1TUNJS0lDQWdJRDRLSUNBZ0lEeHNhVzVsWVhKSGNtRmthV1Z1ZEFvZ0lDQWdJQ0FnSUdsa1BTSnNhVzVsWVhKSGNtRmthV1Z1ZERnME1URWlDaUFnSUNBZ0lDQWdlVEk5SWpNMk55NDRPQ0lLSUNBZ0lDQWdJQ0JuY21Ga2FXVnVkRlZ1YVhSelBTSjFjMlZ5VTNCaFkyVlBibFZ6WlNJS0lDQWdJQ0FnSUNCNU1UMGlNamczTGpRNUlnb2dJQ0FnSUNBZ0lIZ3lQU0l6TVRVdU5EY2lDaUFnSUNBZ0lDQWdlREU5SWpJME1TNDBNU0lLSUNBZ0lDQWdJQ0JwYm10elkyRndaVHBqYjJ4c1pXTjBQU0poYkhkaGVYTWlDaUFnSUNBZ0lENEtJQ0FnSUNBZ1BITjBiM0FLSUNBZ0lDQWdJQ0FnSUdsa1BTSnpkRzl3TkRFMU9DSUtJQ0FnSUNBZ0lDQWdJSE4wZVd4bFBTSnpkRzl3TFdOdmJHOXlPaU5tWm1abVptWWlDaUFnSUNBZ0lDQWdJQ0J2Wm1aelpYUTlJakFpQ2lBZ0lDQWdJQzgrQ2lBZ0lDQWdJRHh6ZEc5d0NpQWdJQ0FnSUNBZ0lDQnBaRDBpYzNSdmNEUXhOakFpQ2lBZ0lDQWdJQ0FnSUNCemRIbHNaVDBpYzNSdmNDMWpiMnh2Y2pvalptWm1abVptTzNOMGIzQXRiM0JoWTJsMGVUb3dJZ29nSUNBZ0lDQWdJQ0FnYjJabWMyVjBQU0l4SWdvZ0lDQWdJQ0F2UGdvZ0lDQWdQQzlzYVc1bFlYSkhjbUZrYVdWdWRBb2dJQ0FnUGdvZ0lDQWdQR1pwYkhSbGNnb2dJQ0FnSUNBZ0lHbGtQU0ptYVd4MFpYSTJNVEkySWdvZ0lDQWdJQ0FnSUdOdmJHOXlMV2x1ZEdWeWNHOXNZWFJwYjI0dFptbHNkR1Z5Y3owaWMxSkhRaUlLSUNBZ0lDQWdJQ0JwYm10elkyRndaVHBqYjJ4c1pXTjBQU0poYkhkaGVYTWlDaUFnSUNBZ0lENEtJQ0FnSUNBZ1BHWmxSMkYxYzNOcFlXNUNiSFZ5Q2lBZ0lDQWdJQ0FnSUNCcFpEMGlabVZIWVhWemMybGhia0pzZFhJMk1USTRJZ29nSUNBZ0lDQWdJQ0FnYzNSa1JHVjJhV0YwYVc5dVBTSXdMalV6TURNMU56RXpJZ29nSUNBZ0lDQWdJQ0FnYVc1cmMyTmhjR1U2WTI5c2JHVmpkRDBpWVd4M1lYbHpJZ29nSUNBZ0lDQXZQZ29nSUNBZ1BDOW1hV3gwWlhJS0lDQWdJRDRLSUNBZ0lEeHNhVzVsWVhKSGNtRmthV1Z1ZEFvZ0lDQWdJQ0FnSUdsa1BTSnNhVzVsWVhKSGNtRmthV1Z1ZERnME1UTWlDaUFnSUNBZ0lDQWdlVEk5SWpNNU1TNDBOU0lLSUNBZ0lDQWdJQ0JuY21Ga2FXVnVkRlZ1YVhSelBTSjFjMlZ5VTNCaFkyVlBibFZ6WlNJS0lDQWdJQ0FnSUNCNU1UMGlNekF3TGpnMklnb2dJQ0FnSUNBZ0lIZ3lQU0l6TkRJaUNpQWdJQ0FnSUNBZ2VERTlJakkzTlM0Mk1TSUtJQ0FnSUNBZ0lDQnBibXR6WTJGd1pUcGpiMnhzWldOMFBTSmhiSGRoZVhNaUNpQWdJQ0FnSUQ0S0lDQWdJQ0FnUEhOMGIzQUtJQ0FnSUNBZ0lDQWdJR2xrUFNKemRHOXdOekl3TVNJS0lDQWdJQ0FnSUNBZ0lITjBlV3hsUFNKemRHOXdMV052Ykc5eU9pTTFOVEF3TURBaUNpQWdJQ0FnSUNBZ0lDQnZabVp6WlhROUlqQWlDaUFnSUNBZ0lDOCtDaUFnSUNBZ0lEeHpkRzl3Q2lBZ0lDQWdJQ0FnSUNCcFpEMGljM1J2Y0RjeU1ETWlDaUFnSUNBZ0lDQWdJQ0J6ZEhsc1pUMGljM1J2Y0MxamIyeHZjam9qWm1Zd01EQXdJZ29nSUNBZ0lDQWdJQ0FnYjJabWMyVjBQU0l4SWdvZ0lDQWdJQ0F2UGdvZ0lDQWdQQzlzYVc1bFlYSkhjbUZrYVdWdWRBb2dJQ0FnUGdvZ0lDQWdQSEpoWkdsaGJFZHlZV1JwWlc1MENpQWdJQ0FnSUNBZ2FXUTlJbkpoWkdsaGJFZHlZV1JwWlc1ME9EUXhOU0lLSUNBZ0lDQWdJQ0JuY21Ga2FXVnVkRlZ1YVhSelBTSjFjMlZ5VTNCaFkyVlBibFZ6WlNJS0lDQWdJQ0FnSUNCamVEMGlNekV5TGpjNElnb2dJQ0FnSUNBZ0lHTjVQU0l6T0RZdU5UY2lDaUFnSUNBZ0lDQWdjajBpTlRNdU1ETTJJZ29nSUNBZ0lDQWdJR2R5WVdScFpXNTBWSEpoYm5ObWIzSnRQU0p0WVhSeWFYZ29MUzQxT1RNeU55QXRMalU1TXpJM0lDNDNNVFV3TlNBdExqY3hOVEExSURJME15NHlOeUE0TkRrdU1ETXBJZ29nSUNBZ0lDQWdJR2x1YTNOallYQmxPbU52Ykd4bFkzUTlJbUZzZDJGNWN5SUtJQ0FnSUNBZ1Bnb2dJQ0FnSUNBOGMzUnZjQW9nSUNBZ0lDQWdJQ0FnYVdROUluTjBiM0EzTVRFekxUY2lDaUFnSUNBZ0lDQWdJQ0J6ZEhsc1pUMGljM1J2Y0MxamIyeHZjam9qWm1abVptWm1PM04wYjNBdGIzQmhZMmwwZVRvdU5EQTRNVFlpQ2lBZ0lDQWdJQ0FnSUNCdlptWnpaWFE5SWpBaUNpQWdJQ0FnSUM4K0NpQWdJQ0FnSUR4emRHOXdDaUFnSUNBZ0lDQWdJQ0JwWkQwaWMzUnZjRGN4TVRVdE55SUtJQ0FnSUNBZ0lDQWdJSE4wZVd4bFBTSnpkRzl3TFdOdmJHOXlPaU5tWm1abVptWTdjM1J2Y0MxdmNHRmphWFI1T2pBaUNpQWdJQ0FnSUNBZ0lDQnZabVp6WlhROUlqRWlDaUFnSUNBZ0lDOCtDaUFnSUNBOEwzSmhaR2xoYkVkeVlXUnBaVzUwQ2lBZ0lDQStDaUFnSUNBOGJHbHVaV0Z5UjNKaFpHbGxiblFLSUNBZ0lDQWdJQ0JwWkQwaWJHbHVaV0Z5UjNKaFpHbGxiblF4TURRME9TSUtJQ0FnSUNBZ0lDQjVNajBpTXpNNExqZ3lJZ29nSUNBZ0lDQWdJR2R5WVdScFpXNTBWVzVwZEhNOUluVnpaWEpUY0dGalpVOXVWWE5sSWdvZ0lDQWdJQ0FnSUhreFBTSXlPRFl1TmpjaUNpQWdJQ0FnSUNBZ1ozSmhaR2xsYm5SVWNtRnVjMlp2Y20wOUltMWhkSEpwZUNndU9UVTFNelFnTUNBd0lDNDVOVFV6TkNBeE16WXVNVElnTVRRdU1EVTFLU0lLSUNBZ0lDQWdJQ0I0TWowaU16QXdMakkzSWdvZ0lDQWdJQ0FnSUhneFBTSXlOVFV1TXpJaUNpQWdJQ0FnSUNBZ2FXNXJjMk5oY0dVNlkyOXNiR1ZqZEQwaVlXeDNZWGx6SWdvZ0lDQWdJQ0ErQ2lBZ0lDQWdJRHh6ZEc5d0NpQWdJQ0FnSUNBZ0lDQnBaRDBpYzNSdmNEUXhOVEFpQ2lBZ0lDQWdJQ0FnSUNCemRIbHNaVDBpYzNSdmNDMWpiMnh2Y2pvalptWm1abVptSWdvZ0lDQWdJQ0FnSUNBZ2IyWm1jMlYwUFNJd0lnb2dJQ0FnSUNBdlBnb2dJQ0FnSUNBOGMzUnZjQW9nSUNBZ0lDQWdJQ0FnYVdROUluTjBiM0EwTVRVeUlnb2dJQ0FnSUNBZ0lDQWdjM1I1YkdVOUluTjBiM0F0WTI5c2IzSTZJMlptWm1abVpqdHpkRzl3TFc5d1lXTnBkSGs2TUNJS0lDQWdJQ0FnSUNBZ0lHOW1abk5sZEQwaU1TSUtJQ0FnSUNBZ0x6NEtJQ0FnSUR3dmJHbHVaV0Z5UjNKaFpHbGxiblFLSUNBZ0lENEtJQ0FnSUR4bWFXeDBaWElLSUNBZ0lDQWdJQ0JwWkQwaVptbHNkR1Z5TVRFME1qZ2lDaUFnSUNBZ0lDQWdZMjlzYjNJdGFXNTBaWEp3YjJ4aGRHbHZiaTFtYVd4MFpYSnpQU0p6VWtkQ0lnb2dJQ0FnSUNBZ0lHbHVhM05qWVhCbE9tTnZiR3hsWTNROUltRnNkMkY1Y3lJS0lDQWdJQ0FnUGdvZ0lDQWdJQ0E4Wm1WSFlYVnpjMmxoYmtKc2RYSUtJQ0FnSUNBZ0lDQWdJR2xrUFNKbVpVZGhkWE56YVdGdVFteDFjakV4TkRNd0lnb2dJQ0FnSUNBZ0lDQWdjM1JrUkdWMmFXRjBhVzl1UFNJeExqSTBNelEyTnpnaUNpQWdJQ0FnSUNBZ0lDQnBibXR6WTJGd1pUcGpiMnhzWldOMFBTSmhiSGRoZVhNaUNpQWdJQ0FnSUM4K0NpQWdJQ0E4TDJacGJIUmxjZ29nSUNBZ1Bnb2dJRHd2WkdWbWN3b2dJRDRLSUNBOGMyOWthWEJ2WkdrNmJtRnRaV1IyYVdWM0NpQWdJQ0FnSUdsa1BTSmlZWE5sSWdvZ0lDQWdJQ0JpYjNKa1pYSmpiMnh2Y2owaUl6WTJOalkyTmlJS0lDQWdJQ0FnYVc1cmMyTmhjR1U2Y0dGblpYTm9ZV1J2ZHowaU1pSUtJQ0FnSUNBZ2FXNXJjMk5oY0dVNmQybHVaRzkzTFhrOUlpMDRJZ29nSUNBZ0lDQndZV2RsWTI5c2IzSTlJaU5tWm1abVptWWlDaUFnSUNBZ0lHbHVhM05qWVhCbE9uZHBibVJ2ZHkxb1pXbG5hSFE5SWprNE9DSUtJQ0FnSUNBZ2FXNXJjMk5oY0dVNmQybHVaRzkzTFcxaGVHbHRhWHBsWkQwaU1TSUtJQ0FnSUNBZ2FXNXJjMk5oY0dVNmVtOXZiVDBpTUM0M01EY3hNRFkzT0NJS0lDQWdJQ0FnYVc1cmMyTmhjR1U2ZDJsdVpHOTNMWGc5SWkwNElnb2dJQ0FnSUNCemFHOTNaM0pwWkQwaVptRnNjMlVpQ2lBZ0lDQWdJR0p2Y21SbGNtOXdZV05wZEhrOUlqRXVNQ0lLSUNBZ0lDQWdhVzVyYzJOaGNHVTZZM1Z5Y21WdWRDMXNZWGxsY2owaWJHRjVaWEl4SWdvZ0lDQWdJQ0JwYm10elkyRndaVHBqZUQwaU16QTBMamc1TkRBNUlnb2dJQ0FnSUNCcGJtdHpZMkZ3WlRwamVUMGlNelF4TGpVeU1UZzJJZ29nSUNBZ0lDQnBibXR6WTJGd1pUcDNhVzVrYjNjdGQybGtkR2c5SWpFMk9EQWlDaUFnSUNBZ0lHbHVhM05qWVhCbE9uQmhaMlZ2Y0dGamFYUjVQU0l3TGpBaUNpQWdJQ0FnSUdsdWEzTmpZWEJsT21SdlkzVnRaVzUwTFhWdWFYUnpQU0p3ZUNJS0lDQXZQZ29nSUR4bkNpQWdJQ0FnSUdsa1BTSnNZWGxsY2pFaUNpQWdJQ0FnSUdsdWEzTmpZWEJsT214aFltVnNQU0pNWVhsbGNpQXhJZ29nSUNBZ0lDQnBibXR6WTJGd1pUcG5jbTkxY0cxdlpHVTlJbXhoZVdWeUlnb2dJQ0FnSUNCMGNtRnVjMlp2Y20wOUluUnlZVzV6YkdGMFpTZ3dJQzAyTlRJdU16WXBJZ29nSUNBZ1Bnb2dJQ0FnUEdjS0lDQWdJQ0FnSUNCcFpEMGlaekV4TkRNeUlnb2dJQ0FnSUNBZ0lHbHVhM05qWVhCbE9tVjRjRzl5ZEMxNVpIQnBQU0k1TUNJS0lDQWdJQ0FnSUNCcGJtdHpZMkZ3WlRwbGVIQnZjblF0ZUdSd2FUMGlPVEFpQ2lBZ0lDQWdJQ0FnZEhKaGJuTm1iM0p0UFNKdFlYUnlhWGdvTWk0NU1EVXhJREFnTUNBeUxqa3dOVEVnTFRFd01ERXVPU0F0TnpndU9UWXhLU0lLSUNBZ0lDQWdQZ29nSUNBZ0lDQThjR0YwYUFvZ0lDQWdJQ0FnSUNBZ2FXUTlJbkJoZEdnM01qYzJJZ29nSUNBZ0lDQWdJQ0FnYzI5a2FYQnZaR2s2Y25nOUlqVXpMakF6TlRjeE15SUtJQ0FnSUNBZ0lDQWdJSE52Wkdsd2IyUnBPbko1UFNJMU15NHdNelUzTVRNaUNpQWdJQ0FnSUNBZ0lDQnpkSGxzWlQwaVptbHNiRG9qT1RrNU9UazVJZ29nSUNBZ0lDQWdJQ0FnYzI5a2FYQnZaR2s2ZEhsd1pUMGlZWEpqSWdvZ0lDQWdJQ0FnSUNBZ1pEMGliVE0xTmk0M09TQXpORFl1TVRGak1DQXlPUzR5T1RFdE1qTXVOelExSURVekxqQXpOaTAxTXk0d016WWdOVE11TURNMmN5MDFNeTR3TXpZdE1qTXVOelExTFRVekxqQXpOaTAxTXk0d016WWdNak11TnpRMUxUVXpMakF6TmlBMU15NHdNell0TlRNdU1ETTJJRFV6TGpBek5pQXlNeTQzTkRVZ05UTXVNRE0ySURVekxqQXpObm9pQ2lBZ0lDQWdJQ0FnSUNCMGNtRnVjMlp2Y20wOUltMWhkSEpwZUNndU9UY3pOVFFnTUNBd0lDNDVOek0xTkNBeE1qQXVNRGtnTFRFeUxqWXlPQ2tpQ2lBZ0lDQWdJQ0FnSUNCemIyUnBjRzlrYVRwamVUMGlNelEyTGpFeE1qRTRJZ29nSUNBZ0lDQWdJQ0FnYzI5a2FYQnZaR2s2WTNnOUlqTXdNeTQzTlNJS0lDQWdJQ0FnTHo0S0lDQWdJQ0FnUEhCaGRHZ0tJQ0FnSUNBZ0lDQWdJR2xrUFNKd1lYUm9OekkzT0NJS0lDQWdJQ0FnSUNBZ0lITnZaR2x3YjJScE9uSjRQU0kxTXk0d016VTNNVE1pQ2lBZ0lDQWdJQ0FnSUNCemIyUnBjRzlrYVRweWVUMGlOVE11TURNMU56RXpJZ29nSUNBZ0lDQWdJQ0FnYzNSNWJHVTlJbVpwYkd3NmRYSnNLQ05zYVc1bFlYSkhjbUZrYVdWdWREZzBNVEVwSWdvZ0lDQWdJQ0FnSUNBZ2MyOWthWEJ2WkdrNmRIbHdaVDBpWVhKaklnb2dJQ0FnSUNBZ0lDQWdaRDBpYlRNMU5pNDNPU0F6TkRZdU1URmpNQ0F5T1M0eU9URXRNak11TnpRMUlEVXpMakF6TmkwMU15NHdNellnTlRNdU1ETTJjeTAxTXk0d016WXRNak11TnpRMUxUVXpMakF6TmkwMU15NHdNellnTWpNdU56UTFMVFV6TGpBek5pQTFNeTR3TXpZdE5UTXVNRE0ySURVekxqQXpOaUF5TXk0M05EVWdOVE11TURNMklEVXpMakF6Tm5vaUNpQWdJQ0FnSUNBZ0lDQjBjbUZ1YzJadmNtMDlJbTFoZEhKcGVDZ3VPVFU1TmpBZ01DQXdJQzQ1TlRrMk1DQXhNalF1TXpNZ0xUY3VPREF4TkNraUNpQWdJQ0FnSUNBZ0lDQnpiMlJwY0c5a2FUcGplVDBpTXpRMkxqRXhNakU0SWdvZ0lDQWdJQ0FnSUNBZ2MyOWthWEJ2WkdrNlkzZzlJak13TXk0M05TSUtJQ0FnSUNBZ0x6NEtJQ0FnSUNBZ1BIQmhkR2dLSUNBZ0lDQWdJQ0FnSUdsa1BTSndZWFJvTnpJNE1DSUtJQ0FnSUNBZ0lDQWdJSE52Wkdsd2IyUnBPbko0UFNJMU15NHdNelUzTVRNaUNpQWdJQ0FnSUNBZ0lDQnpiMlJwY0c5a2FUcHllVDBpTlRNdU1ETTFOekV6SWdvZ0lDQWdJQ0FnSUNBZ2MzUjViR1U5SW1acGJIUmxjanAxY213b0kyWnBiSFJsY2pZeE1qWXBPMlpwYkd3NkkyVmpaV05sWXlJS0lDQWdJQ0FnSUNBZ0lITnZaR2x3YjJScE9uUjVjR1U5SW1GeVl5SUtJQ0FnSUNBZ0lDQWdJR1E5SW0wek5UWXVOemtnTXpRMkxqRXhZekFnTWprdU1qa3hMVEl6TGpjME5TQTFNeTR3TXpZdE5UTXVNRE0ySURVekxqQXpObk10TlRNdU1ETTJMVEl6TGpjME5TMDFNeTR3TXpZdE5UTXVNRE0ySURJekxqYzBOUzAxTXk0d016WWdOVE11TURNMkxUVXpMakF6TmlBMU15NHdNellnTWpNdU56UTFJRFV6TGpBek5pQTFNeTR3TXpaNklnb2dJQ0FnSUNBZ0lDQWdkSEpoYm5ObWIzSnRQU0p0WVhSeWFYZ29MamczTXpVMUlEQWdNQ0F1T0Rjek5UVWdNVFV3TGpRM0lESXhMams0TVNraUNpQWdJQ0FnSUNBZ0lDQnpiMlJwY0c5a2FUcGplVDBpTXpRMkxqRXhNakU0SWdvZ0lDQWdJQ0FnSUNBZ2MyOWthWEJ2WkdrNlkzZzlJak13TXk0M05TSUtJQ0FnSUNBZ0x6NEtJQ0FnSUNBZ1BIQmhkR2dLSUNBZ0lDQWdJQ0FnSUdsa1BTSndZWFJvTnpJNE1pSUtJQ0FnSUNBZ0lDQWdJSE52Wkdsd2IyUnBPbko0UFNJMU15NHdNelUzTVRNaUNpQWdJQ0FnSUNBZ0lDQnpiMlJwY0c5a2FUcHllVDBpTlRNdU1ETTFOekV6SWdvZ0lDQWdJQ0FnSUNBZ2MzUjViR1U5SW1acGJIUmxjanAxY213b0kyWnBiSFJsY2pZeE1qWXBPMlpwYkd3Nkl6azVPVGs1T1NJS0lDQWdJQ0FnSUNBZ0lITnZaR2x3YjJScE9uUjVjR1U5SW1GeVl5SUtJQ0FnSUNBZ0lDQWdJR1E5SW0wek5UWXVOemtnTXpRMkxqRXhZekFnTWprdU1qa3hMVEl6TGpjME5TQTFNeTR3TXpZdE5UTXVNRE0ySURVekxqQXpObk10TlRNdU1ETTJMVEl6TGpjME5TMDFNeTR3TXpZdE5UTXVNRE0ySURJekxqYzBOUzAxTXk0d016WWdOVE11TURNMkxUVXpMakF6TmlBMU15NHdNellnTWpNdU56UTFJRFV6TGpBek5pQTFNeTR3TXpaNklnb2dJQ0FnSUNBZ0lDQWdkSEpoYm5ObWIzSnRQU0p0WVhSeWFYZ29Mamd6T0RNNElEQWdNQ0F1T0RNNE16Z2dNVFl4TGpFMUlETTBMakUxTWlraUNpQWdJQ0FnSUNBZ0lDQnpiMlJwY0c5a2FUcGplVDBpTXpRMkxqRXhNakU0SWdvZ0lDQWdJQ0FnSUNBZ2MyOWthWEJ2WkdrNlkzZzlJak13TXk0M05TSUtJQ0FnSUNBZ0x6NEtJQ0FnSUNBZ1BIQmhkR2dLSUNBZ0lDQWdJQ0FnSUdsa1BTSndZWFJvTnpJNE5DSUtJQ0FnSUNBZ0lDQWdJSE52Wkdsd2IyUnBPbko0UFNJMU15NHdNelUzTVRNaUNpQWdJQ0FnSUNBZ0lDQnpiMlJwY0c5a2FUcHllVDBpTlRNdU1ETTFOekV6SWdvZ0lDQWdJQ0FnSUNBZ2MzUjViR1U5SW1acGJHdzZkWEpzS0NOc2FXNWxZWEpIY21Ga2FXVnVkRGcwTVRNcElnb2dJQ0FnSUNBZ0lDQWdjMjlrYVhCdlpHazZkSGx3WlQwaVlYSmpJZ29nSUNBZ0lDQWdJQ0FnWkQwaWJUTTFOaTQzT1NBek5EWXVNVEZqTUNBeU9TNHlPVEV0TWpNdU56UTFJRFV6TGpBek5pMDFNeTR3TXpZZ05UTXVNRE0yY3kwMU15NHdNell0TWpNdU56UTFMVFV6TGpBek5pMDFNeTR3TXpZZ01qTXVOelExTFRVekxqQXpOaUExTXk0d016WXROVE11TURNMklEVXpMakF6TmlBeU15NDNORFVnTlRNdU1ETTJJRFV6TGpBek5ub2lDaUFnSUNBZ0lDQWdJQ0IwY21GdWMyWnZjbTA5SW0xaGRISnBlQ2d1T0RBMU9EY2dNQ0F3SUM0NE1EVTROeUF4TnpFdU1ETWdORFV1TkRBMUtTSUtJQ0FnSUNBZ0lDQWdJSE52Wkdsd2IyUnBPbU41UFNJek5EWXVNVEV5TVRnaUNpQWdJQ0FnSUNBZ0lDQnpiMlJwY0c5a2FUcGplRDBpTXpBekxqYzFJZ29nSUNBZ0lDQXZQZ29nSUNBZ0lDQThjR0YwYUFvZ0lDQWdJQ0FnSUNBZ2FXUTlJbkJoZEdnM01qZzJJZ29nSUNBZ0lDQWdJQ0FnYzI5a2FYQnZaR2s2Y25nOUlqVXpMakF6TlRjeE15SUtJQ0FnSUNBZ0lDQWdJSE52Wkdsd2IyUnBPbko1UFNJMU15NHdNelUzTVRNaUNpQWdJQ0FnSUNBZ0lDQnpkSGxzWlQwaVptbHNiRHAxY213b0kzSmhaR2xoYkVkeVlXUnBaVzUwT0RReE5Ta2lDaUFnSUNBZ0lDQWdJQ0J6YjJScGNHOWthVHAwZVhCbFBTSmhjbU1pQ2lBZ0lDQWdJQ0FnSUNCa1BTSnRNelUyTGpjNUlETTBOaTR4TVdNd0lESTVMakk1TVMweU15NDNORFVnTlRNdU1ETTJMVFV6TGpBek5pQTFNeTR3TXpaekxUVXpMakF6TmkweU15NDNORFV0TlRNdU1ETTJMVFV6TGpBek5pQXlNeTQzTkRVdE5UTXVNRE0ySURVekxqQXpOaTAxTXk0d016WWdOVE11TURNMklESXpMamMwTlNBMU15NHdNellnTlRNdU1ETTJlaUlLSUNBZ0lDQWdJQ0FnSUhSeVlXNXpabTl5YlQwaWJXRjBjbWw0S0M0M05UZ3lOU0F3SURBZ0xqYzFPREkxSURFNE5pNDNOU0EyTXk0NU1EWXBJZ29nSUNBZ0lDQWdJQ0FnYzI5a2FYQnZaR2s2WTNrOUlqTTBOaTR4TVRJeE9DSUtJQ0FnSUNBZ0lDQWdJSE52Wkdsd2IyUnBPbU40UFNJek1ETXVOelVpQ2lBZ0lDQWdJQzgrQ2lBZ0lDQWdJRHh3WVhSb0NpQWdJQ0FnSUNBZ0lDQnBaRDBpY0dGMGFEY3lPRGdpQ2lBZ0lDQWdJQ0FnSUNCemRIbHNaVDBpYjNCaFkybDBlVG91TXpFM056RTdabWxzYkRwMWNtd29JMnhwYm1WaGNrZHlZV1JwWlc1ME1UQTBORGtwSWdvZ0lDQWdJQ0FnSUNBZ2FXNXJjMk5oY0dVNlkyOXVibVZqZEc5eUxXTjFjblpoZEhWeVpUMGlNQ0lLSUNBZ0lDQWdJQ0FnSUdROUltMDBNVFF1T0NBeU9EUXVNVFZqTFRFekxqTXpNU0F3TGpNd01EWTVMVEkyTGpFNE5pQTNMak0xT0Mwek15NHpNellnTVRrdU56UXlMVGN1Tmprd015QXhNeTR6TWkwMkxqY3hNemtnTWprdU1qWTJJREV1TVRVME5TQTBNUzR6TXpFZ01DNDROVE13TmkweU5pNDFNeklnTWpFdU1UTXlMVFEyTGpVeE5TQTBOaTR6TWpRdE5EVXVNRFUwSURndU1qVTRPU0F3TGpRM09UQTNJREUyTGpBMU5DQXpMakl3TURFZ01qSXVPRFU1SURjdU5Ua3dPQzB6TGpJMU56Z3ROeTQwTkRrNExUZ3VPREUzTVMweE15NDVOVE10TVRZdU16azBMVEU0TGpNeU55MDJMalE0TmpjdE15NDNORFV4TFRFekxqWXlOUzAxTGpRek9UTXRNakF1TmpBNExUVXVNamd4T0hvaUNpQWdJQ0FnSUM4K0NpQWdJQ0FnSUR4d1lYUm9DaUFnSUNBZ0lDQWdJQ0JwWkQwaWNtVmpkRGN6TnpBaUNpQWdJQ0FnSUNBZ0lDQmtQU0p0TkRBeUxqZzRJRE13TUM0d09TMHhNUzQxT0RFZ01URXVOVGd4SURFekxqSTVOU0F4TXk0eU9UVXRNVE11TWprMUlERXpMakk0TVNBeE1TNDFPREVnTVRFdU5UZ3hJREV6TGpJNE1TMHhNeTR5T1RVZ01UTXVNamsxSURFekxqSTVOU0F4TVM0MU9ERXRNVEV1TlRneExURXpMakk0TVMweE15NHlPREVnTVRNdU1qZ3hMVEV6TGpJNU5TMHhNUzQxT0RFdE1URXVOVGd4TFRFekxqSTVOU0F4TXk0eU9ERXRNVE11TWpneExURXpMakk0TVhvaUNpQWdJQ0FnSUNBZ0lDQnpkSGxzWlQwaVptbHNkR1Z5T25WeWJDZ2pabWxzZEdWeU1URTBNamdwTzJacGJHdzZJekZoTVdFeFlTSUtJQ0FnSUNBZ0lDQWdJR2x1YTNOallYQmxPbU52Ym01bFkzUnZjaTFqZFhKMllYUjFjbVU5SWpBaUNpQWdJQ0FnSUM4K0NpQWdJQ0FnSUR4d1lYUm9DaUFnSUNBZ0lDQWdJQ0JwWkQwaWNHRjBhREV3TkRVM0lnb2dJQ0FnSUNBZ0lDQWdjM1I1YkdVOUltWnBiR3c2STJabVptWm1aaUlLSUNBZ0lDQWdJQ0FnSUdsdWEzTmpZWEJsT21OdmJtNWxZM1J2Y2kxamRYSjJZWFIxY21VOUlqQWlDaUFnSUNBZ0lDQWdJQ0JrUFNKdE5EQXpMalExSURNd01TNHhOUzB4TVM0d09EY2dNVEV1TURnM0lERXlMamN5T0NBeE1pNDNNamd0TVRJdU56STRJREV5TGpjeE5DQXhNUzR3T0RjZ01URXVNRGczSURFeUxqY3hOQzB4TWk0M01qZ2dNVEl1TnpJNElERXlMamN5T0NBeE1TNHdPRGN0TVRFdU1EZzNMVEV5TGpjeE5DMHhNaTQzTVRRZ01USXVOekUwTFRFeUxqY3lPQzB4TVM0d09EY3RNVEV1TURnM0xURXlMamN5T0NBeE1pNDNNVFF0TVRJdU56RTBMVEV5TGpjeE5Ib2lDaUFnSUNBZ0lDOCtDaUFnSUNBOEwyY0tJQ0FnSUQ0S0lDQThMMmNLSUNBK0NpQWdQRzFsZEdGa1lYUmhDaUFnSUNBK0NpQWdJQ0E4Y21SbU9sSkVSZ29nSUNBZ0lDQStDaUFnSUNBZ0lEeGpZenBYYjNKckNpQWdJQ0FnSUNBZ1Bnb2dJQ0FnSUNBZ0lEeGtZenBtYjNKdFlYUUtJQ0FnSUNBZ0lDQWdJRDVwYldGblpTOXpkbWNyZUcxc1BDOWtZenBtYjNKdFlYUUtJQ0FnSUNBZ0lDQStDaUFnSUNBZ0lDQWdQR1JqT25SNWNHVUtJQ0FnSUNBZ0lDQWdJQ0FnY21SbU9uSmxjMjkxY21ObFBTSm9kSFJ3T2k4dmNIVnliQzV2Y21jdlpHTXZaR050YVhSNWNHVXZVM1JwYkd4SmJXRm5aU0lLSUNBZ0lDQWdJQ0F2UGdvZ0lDQWdJQ0FnSUR4all6cHNhV05sYm5ObENpQWdJQ0FnSUNBZ0lDQWdJSEprWmpweVpYTnZkWEpqWlQwaWFIUjBjRG92TDJOeVpXRjBhWFpsWTI5dGJXOXVjeTV2Y21jdmJHbGpaVzV6WlhNdmNIVmliR2xqWkc5dFlXbHVMeUlLSUNBZ0lDQWdJQ0F2UGdvZ0lDQWdJQ0FnSUR4a1l6cHdkV0pzYVhOb1pYSUtJQ0FnSUNBZ0lDQWdJRDRLSUNBZ0lDQWdJQ0FnSUR4all6cEJaMlZ1ZEFvZ0lDQWdJQ0FnSUNBZ0lDQWdJSEprWmpwaFltOTFkRDBpYUhSMGNEb3ZMMjl3Wlc1amJHbHdZWEowTG05eVp5OGlDaUFnSUNBZ0lDQWdJQ0FnSUQ0S0lDQWdJQ0FnSUNBZ0lDQWdQR1JqT25ScGRHeGxDaUFnSUNBZ0lDQWdJQ0FnSUNBZ1BrOXdaVzVqYkdsd1lYSjBQQzlrWXpwMGFYUnNaUW9nSUNBZ0lDQWdJQ0FnSUNBK0NpQWdJQ0FnSUNBZ0lDQThMMk5qT2tGblpXNTBDaUFnSUNBZ0lDQWdJQ0ErQ2lBZ0lDQWdJQ0FnUEM5a1l6cHdkV0pzYVhOb1pYSUtJQ0FnSUNBZ0lDQStDaUFnSUNBZ0lDQWdQR1JqT25ScGRHeGxDaUFnSUNBZ0lDQWdJQ0ErWlhKeWIzSWdZblYwZEc5dVBDOWtZenAwYVhSc1pRb2dJQ0FnSUNBZ0lENEtJQ0FnSUNBZ0lDQThaR002WkdGMFpRb2dJQ0FnSUNBZ0lDQWdQakl3TVRFdE1ESXRNalJVTVRjNk5EVTZORFU4TDJSak9tUmhkR1VLSUNBZ0lDQWdJQ0ErQ2lBZ0lDQWdJQ0FnUEdSak9tUmxjMk55YVhCMGFXOXVDaUFnSUNBZ0lDQWdMejRLSUNBZ0lDQWdJQ0E4WkdNNmMyOTFjbU5sQ2lBZ0lDQWdJQ0FnSUNBK2FIUjBjSE02THk5dmNHVnVZMnhwY0dGeWRDNXZjbWN2WkdWMFlXbHNMekV5TWpReU5TOWxjbkp2Y2kxaWRYUjBiMjR0WW5rdGNtbGpZWEprYjIxaGFXRThMMlJqT25OdmRYSmpaUW9nSUNBZ0lDQWdJRDRLSUNBZ0lDQWdJQ0E4WkdNNlkzSmxZWFJ2Y2dvZ0lDQWdJQ0FnSUNBZ1Bnb2dJQ0FnSUNBZ0lDQWdQR05qT2tGblpXNTBDaUFnSUNBZ0lDQWdJQ0FnSUQ0S0lDQWdJQ0FnSUNBZ0lDQWdQR1JqT25ScGRHeGxDaUFnSUNBZ0lDQWdJQ0FnSUNBZ1BuSnBZMkZ5Wkc5dFlXbGhQQzlrWXpwMGFYUnNaUW9nSUNBZ0lDQWdJQ0FnSUNBK0NpQWdJQ0FnSUNBZ0lDQThMMk5qT2tGblpXNTBDaUFnSUNBZ0lDQWdJQ0ErQ2lBZ0lDQWdJQ0FnUEM5a1l6cGpjbVZoZEc5eUNpQWdJQ0FnSUNBZ1Bnb2dJQ0FnSUNBZ0lEeGtZenB6ZFdKcVpXTjBDaUFnSUNBZ0lDQWdJQ0ErQ2lBZ0lDQWdJQ0FnSUNBOGNtUm1Pa0poWndvZ0lDQWdJQ0FnSUNBZ0lDQStDaUFnSUNBZ0lDQWdJQ0FnSUR4eVpHWTZiR2tLSUNBZ0lDQWdJQ0FnSUNBZ0lDQStZblYwZEc5dVBDOXlaR1k2YkdrS0lDQWdJQ0FnSUNBZ0lDQWdQZ29nSUNBZ0lDQWdJQ0FnSUNBOGNtUm1PbXhwQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdQbU5oYm1ObGJEd3ZjbVJtT214cENpQWdJQ0FnSUNBZ0lDQWdJRDRLSUNBZ0lDQWdJQ0FnSUNBZ1BISmtaanBzYVFvZ0lDQWdJQ0FnSUNBZ0lDQWdJRDVqYVhKamJHVThMM0prWmpwc2FRb2dJQ0FnSUNBZ0lDQWdJQ0ErQ2lBZ0lDQWdJQ0FnSUNBZ0lEeHlaR1k2YkdrS0lDQWdJQ0FnSUNBZ0lDQWdJQ0ErWkdWc1pYUmxQQzl5WkdZNmJHa0tJQ0FnSUNBZ0lDQWdJQ0FnUGdvZ0lDQWdJQ0FnSUNBZ0lDQThjbVJtT214cENpQWdJQ0FnSUNBZ0lDQWdJQ0FnUG5KbFpEd3ZjbVJtT214cENpQWdJQ0FnSUNBZ0lDQWdJRDRLSUNBZ0lDQWdJQ0FnSUNBZ1BISmtaanBzYVFvZ0lDQWdJQ0FnSUNBZ0lDQWdJRDV5YjNWdVpEd3ZjbVJtT214cENpQWdJQ0FnSUNBZ0lDQWdJRDRLSUNBZ0lDQWdJQ0FnSUR3dmNtUm1Pa0poWndvZ0lDQWdJQ0FnSUNBZ1Bnb2dJQ0FnSUNBZ0lEd3ZaR002YzNWaWFtVmpkQW9nSUNBZ0lDQWdJRDRLSUNBZ0lDQWdQQzlqWXpwWGIzSnJDaUFnSUNBZ0lENEtJQ0FnSUNBZ1BHTmpPa3hwWTJWdWMyVUtJQ0FnSUNBZ0lDQWdJSEprWmpwaFltOTFkRDBpYUhSMGNEb3ZMMk55WldGMGFYWmxZMjl0Ylc5dWN5NXZjbWN2YkdsalpXNXpaWE12Y0hWaWJHbGpaRzl0WVdsdUx5SUtJQ0FnSUNBZ0lDQStDaUFnSUNBZ0lDQWdQR05qT25CbGNtMXBkSE1LSUNBZ0lDQWdJQ0FnSUNBZ2NtUm1PbkpsYzI5MWNtTmxQU0pvZEhSd09pOHZZM0psWVhScGRtVmpiMjF0YjI1ekxtOXlaeTl1Y3lOU1pYQnliMlIxWTNScGIyNGlDaUFnSUNBZ0lDQWdMejRLSUNBZ0lDQWdJQ0E4WTJNNmNHVnliV2wwY3dvZ0lDQWdJQ0FnSUNBZ0lDQnlaR1k2Y21WemIzVnlZMlU5SW1oMGRIQTZMeTlqY21WaGRHbDJaV052YlcxdmJuTXViM0puTDI1ekkwUnBjM1J5YVdKMWRHbHZiaUlLSUNBZ0lDQWdJQ0F2UGdvZ0lDQWdJQ0FnSUR4all6cHdaWEp0YVhSekNpQWdJQ0FnSUNBZ0lDQWdJSEprWmpweVpYTnZkWEpqWlQwaWFIUjBjRG92TDJOeVpXRjBhWFpsWTI5dGJXOXVjeTV2Y21jdmJuTWpSR1Z5YVhaaGRHbDJaVmR2Y210eklnb2dJQ0FnSUNBZ0lDOCtDaUFnSUNBZ0lEd3ZZMk02VEdsalpXNXpaUW9nSUNBZ0lDQStDaUFnSUNBOEwzSmtaanBTUkVZS0lDQWdJRDRLSUNBOEwyMWxkR0ZrWVhSaENpQWdQZ284TDNOMlp3bytDZz09XCJcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuLi9ub2RlX21vZHVsZXMvYmFzZTY0LWxvYWRlciEuL21lZGlhL2Vycm9yLWJ1dHRvbi5zdmdcbi8vIG1vZHVsZSBpZCA9IDg0XG4vLyBtb2R1bGUgY2h1bmtzID0gMCJdLCJtYXBwaW5ncyI6Ijs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0E7Ozs7QUM3REE7Ozs7Ozs7OztBQ0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7Ozs7Ozs7Ozs7Ozs7OztBQWtCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVRBO0FBV0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFLQTtBQUNBO0FBQ0E7QUFQQTtBQUFBO0FBQUE7QUFDQTtBQVdBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUZBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVpBO0FBY0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVhBO0FBYUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQXBCQTtBQXNCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVBBO0FBU0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQWhCQTtBQWtCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQWZBO0FBaUJBO0FBQ0E7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBbkJBO0FBcUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFQQTtBQTlGQTtBQTZHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBQ0E7QUFGQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFwV0E7QUFzV0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTs7Ozs7Ozs7Ozs7O0FDNXZCQTtBQUNBOzs7Ozs7Ozs7OztBQVdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQW9EQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUE1TkE7QUE4TkE7Ozs7Ozs7Ozs7O0FDOU5BO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7OztBQVdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBVEE7QUFXQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUE3RUE7QUErRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBWEE7QUFhQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFSQTtBQVVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQS9RQTtBQWlSQTs7Ozs7Ozs7O0FDblJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFuQkE7Ozs7Ozs7Ozs7O0FDQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUE5R0E7QUFnSEE7QUFDQTtBQUNBOzs7Ozs7Ozs7QUNsSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQURBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUE5VEE7QUFDQTtBQWdVQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FBSUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQURBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBREE7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUxBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFNQTtBQVBBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQU9BO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFqTEE7QUFtTEE7Ozs7Ozs7Ozs7QUNyZkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUExQ0E7QUFDQTtBQTRDQTtBQUNBO0FBQ0E7Ozs7Ozs7O0FDL0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQURBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQU5BO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFSQTtBQVVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQUFBO0FBQUE7QUFDQTtBQURBO0FBS0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQVBBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUxBO0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7OztBQWdCQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7OztBQWVBO0FBQ0E7Ozs7O0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUxBO0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7QUFhQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBNVNBO0FBQ0E7QUE4U0E7QUFDQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBYkE7QUFKQTs7Ozs7OztBQ2pUQTs7Ozs7Ozs7O0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTEE7QUFRQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBOzs7Ozs7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBR0E7QUFDQTtBQUNBO0FBRUE7Ozs7Ozs7Ozs7O0FBV0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFDQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQUNBO0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFSQTtBQVVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBRUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFSQTtBQVVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFDQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQUE7QUFBQTtBQUNBO0FBR0E7QUFBQTtBQUFBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQUNBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQU1BO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFEQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7O0FBU0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7O0FBU0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQUNBO0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBQ0E7QUFNQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQUNBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFDQTtBQU1BO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBQ0E7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFDQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7QUFRQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUZBO0FBQUE7QUFJQTtBQUpBO0FBS0E7QUFMQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBYUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBREE7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUF4QkE7QUEyQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFMQTtBQVlBO0FBQ0E7QUFDQTs7Ozs7O0FBTUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQVdBO0FBWEE7QUFZQTtBQVpBO0FBQUE7QUFBQTtBQUNBO0FBZ0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBZkE7QUFrQkE7QUFDQTtBQUVBO0FBREE7QUFNQTtBQURBO0FBTUE7QUFEQTtBQU1BO0FBREE7QUFJQTtBQUNBO0FBREE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7OztBQVNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFEQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUhBO0FBQUE7QUFLQTtBQUxBO0FBTUE7QUFOQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBY0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBREE7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQUNBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7Ozs7QUFJQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQVNBO0FBVEE7QUFBQTtBQVdBO0FBWEE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQWdCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQWhCQTtBQW1CQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQVFBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFRQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBUUE7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFMQTtBQU9BO0FBQ0E7QUFDQTs7OztBQUlBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUtBO0FBTEE7QUFDQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQWZBO0FBa0JBO0FBQ0E7QUFDQTtBQURBO0FBS0E7QUFEQTtBQUtBO0FBQ0E7QUFEQTtBQUtBO0FBQ0E7QUFEQTtBQUtBO0FBQ0E7QUFDQTs7OztBQUlBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFRQTtBQVJBO0FBQ0E7QUFVQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBSkE7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7QUFDQTtBQUNBOzs7OztBQUtBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFXQTtBQVhBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQVlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQXJFQTtBQXdFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBOzs7Ozs7OztBQVFBO0FBQ0E7QUFBQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7OztBQ3BwREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7Ozs7QUFJQTtBQUNBOzs7QUFHQTtBQUpBO0FBTUE7QUFDQTtBQUNBOzs7Ozs7Ozs7O0FDM0VBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FBTUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7Ozs7O0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7OztBQWFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7Ozs7O0FBZ0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFoUEE7QUFDQTtBQWtQQTs7Ozs7O0FDbGFBOzs7Ozs7Ozs7QUNFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBNUJBOzs7Ozs7Ozs7QUNEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFoRkE7QUFDQTtBQWtGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUdBO0FBRUE7QUFLQTtBQUVBO0FBR0E7QUFFQTtBQUdBO0FBQ0E7QUFDQTtBQUdBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBR0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQXhIQTs7Ozs7Ozs7Ozs7QUNqRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFYQTtBQWFBO0FBQ0E7QUFFQTtBQUNBO0FBREE7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBMUNBO0FBQ0E7QUE0Q0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUE5Q0E7QUFDQTtBQWdEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUxBO0FBT0E7QUFDQTtBQUNBOzs7OztBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7O0FBZUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUEvRUE7QUFDQTtBQWlGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQWxCQTtBQW9CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTs7Ozs7Ozs7QUNoY0E7QUFDQTtBQUVBOzs7Ozs7OztBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUxBO0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7O0FDOUZBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUF5Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBSkE7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTs7Ozs7Ozs7Ozs7O0FBWUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQTdCQTtBQWdDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBR0E7QUFDQTtBQUtBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFEQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFUQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBVUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFOQTtBQURBO0FBMUxBO0FBQ0E7QUFxTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7QUN6UEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBNkVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBeUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTEE7QUFPQTtBQXhIQTtBQUNBO0FBNEhBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTs7O0FBR0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUxBO0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFyQkE7QUFoSUE7QUF3SkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQURBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTEE7QUFSQTtBQUNBO0FBZ0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVJBO0FBQ0E7QUFVQTs7Ozs7Ozs7OztBQ3hZQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUEyQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFBQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBTEE7QUFNQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUEvUkE7QUFDQTtBQWtTQTtBQUNBO0FBQ0E7Ozs7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7O0FBY0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7QUFVQTs7OztBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVhBO0FBMUZBOzs7Ozs7Ozs7O0FDaFVBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQXdDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBREE7QUFKQTtBQVFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBeEJBO0FBcEdBOzs7Ozs7OztBQ3hDQTtBQUNBOzs7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFqRkE7QUFDQTtBQXFGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQU5BO0FBUUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVpBO0FBY0E7QUFoREE7QUFIQTtBQXNEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFWQTtBQUhBO0FBZ0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFWQTtBQUhBO0FBakJBO0FBSEE7QUFzQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQWZBO0FBSEE7QUFxQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFmQTtBQUhBO0FBdEJBO0FBSEE7QUFnREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFOQTtBQVFBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQWpMQTtBQTdCQTs7Ozs7Ozs7OztBQ2pHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVRBO0FBV0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQW9CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTEE7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFMQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFoQkE7QUFMQTtBQTRCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBUEE7QUFTQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFNQTs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBa0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUxBO0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFOQTtBQXJIQTtBQTlVQTtBQUNBO0FBZ2RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBREE7QUF0Q0E7Ozs7Ozs7Ozs7QUNuZEE7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBZEE7Ozs7Ozs7Ozs7QUNEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFOQTtBQURBO0FBL0VBO0FBQ0E7QUEwRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7QUNqS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVBBO0FBU0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBOUJBOzs7Ozs7Ozs7O0FDVkE7Ozs7Ozs7QUFPQTtBQUNBOzs7QUFHQTtBQUNBOzs7Ozs7Ozs7QUFTQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFYQTtBQURBO0FBZUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFsRkE7QUFDQTtBQW9GQTtBQUNBO0FBQ0E7QUFGQTtBQUlBOzs7Ozs7OztBQ2hHQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTs7Ozs7OztBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQWpEQTtBQW1EQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFDQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFoQkE7QUFrQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQU5BO0FBL0ZBO0FBQ0E7QUF3R0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQUNBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVRBO0FBV0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBVEE7QUFXQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFFQTtBQUNBO0FBdkZBOzs7Ozs7Ozs7O0FDdkxBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFDQTtBQUdBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQXBCQTtBQUNBO0FBc0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQXhDQTs7Ozs7Ozs7Ozs7QUNsQkE7Ozs7Ozs7Ozs7O0FBYUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBbkJBO0FBREE7QUFDQTtBQXVCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQXRGQTtBQXlGQTtBQTVGQTtBQUNBO0FBOEZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFTQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBb0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFLQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBS0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFTQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFEQTtBQUdBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBS0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBTkE7QUFBQTtBQUNBO0FBQ0E7QUFRQTtBQUNBO0FBWEE7QUFBQTtBQUNBO0FBQ0E7QUFhQTtBQUNBO0FBaEJBO0FBQUE7QUFDQTtBQUNBO0FBa0JBO0FBQ0E7QUFyQkE7QUFBQTtBQUNBO0FBd0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBQ0E7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQXpFQTtBQUNBO0FBMkVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBSEE7QUFBQTtBQUNBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFNQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFkQTtBQUFBO0FBQ0E7QUFDQTtBQWdCQTtBQUNBO0FBbkJBO0FBQUE7QUFDQTtBQXNCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQTFFQTtBQUNBO0FBNEVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTEE7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBUEE7QUFTQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFkQTtBQWdCQTtBQUNBO0FBQ0E7QUFDQTtBQW5CQTtBQXFCQTtBQUNBO0FBQ0E7QUF2QkE7QUF5QkE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQTlCQTtBQWdDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQXpDQTtBQTJDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBL0NBO0FBaURBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBMUdBO0FBNEdBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBUkE7QUFVQTtBQUNBO0FBekhBO0FBMkhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUEvSEE7QUFpSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7Ozs7Ozs7OztBQ25wQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFpQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU1BO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBQ0E7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQXZCQTs7Ozs7Ozs7Ozs7QUMzQkE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQTBCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQU5BO0FBQ0E7QUFRQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBbElBO0FBb0lBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7O0FDM0xBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFaQTtBQWNBO0FBQ0E7QUFsQkE7QUFDQTtBQTBCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQWZBOzs7Ozs7Ozs7QUN6Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFSQTtBQVVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBVEE7QUFXQTtBQUNBO0FBQ0E7QUFDQTtBQWhDQTs7Ozs7Ozs7O0FDSkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBakNBOzs7Ozs7O0FDWEE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUZBO0FBQ0E7QUFJQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFDQTtBQUlBO0FBQ0E7QUFPQTtBQUNBO0FBQ0E7QUFEQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQURBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQWxRQTs7Ozs7Ozs7QUNUQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQW9CQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUtBO0FBWEE7QUFhQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFLQTtBQVpBO0FBY0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUtBO0FBWEE7QUFhQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUdBO0FBQ0E7QUFEQTtBQUdBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQURBO0FBR0E7QUFDQTtBQURBO0FBR0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFGQTtBQU1BO0FBUEE7QUFTQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFGQTtBQWpDQTtBQUNBO0FBa0RBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVVBO0FBQ0E7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7O0FBZUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQURBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQU1BO0FBM0NBO0FBdEJBO0FBREE7QUF2R0E7QUFDQTtBQThLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7OztBQ3JhQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFEQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFnQkE7QUFDQTtBQWxCQTtBQS9DQTtBQUNBO0FBcUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQXhEQTs7Ozs7Ozs7OztBQ2xGQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBOzs7Ozs7Ozs7QUNoQkE7Ozs7OztBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQWtDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTEE7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVBBO0FBQ0E7QUFTQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQW5CQTtBQXFCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFWQTtBQVlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVJBO0FBVUE7QUFDQTtBQXJMQTs7Ozs7Ozs7QUNaQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFUQTtBQVdBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVlBO0FBakJBO0FBbUJBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUpBO0FBTUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUZBO0FBekRBO0FBQ0E7QUE4REE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFvQkE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFuQ0E7QUFxQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7QUN0SEE7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUF6QkE7QUFDQTtBQTJCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7QUNqRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQXhCQTtBQUNBO0FBNkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7Ozs7Ozs7O0FDMVBBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFGQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBRkE7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFJQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQU5BO0FBUUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVJBO0FBREE7QUFkQTs7Ozs7Ozs7OztBQ25JQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBN0JBO0FBQ0E7QUFnQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUNyREE7Ozs7Ozs7QUNBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVJBO0FBQ0E7QUFVQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBNUdBOzs7Ozs7OztBQ0ZBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQXZDQTtBQTBDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUF6RkE7QUFDQTtBQTJGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQWpJQTtBQUNBO0FBbUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUZBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUF6RkE7QUFDQTtBQTJGQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FDL1RBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7OztBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQUNBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUtBO0FBQ0E7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTEE7QUFDQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBNUlBOzs7Ozs7Ozs7O0FDTEE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUZBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUE3SEE7Ozs7Ozs7O0FDN0ZBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFmQTtBQUNBO0FBaUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7O0FDaElBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQS9CQTtBQWlDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBSUE7QUF0R0E7QUFDQTtBQXlHQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7Ozs7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQU5BO0FBQ0E7QUFRQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O0FBT0E7QUFDQTtBQUFBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQWxSQTtBQUNBO0FBb1JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBQ0E7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7O0FBZUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7OztBQVFBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUF2Q0E7QUFDQTtBQXlDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBaENBO0FBa0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUE2QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7Ozs7Ozs7QUFPQTs7Ozs7Ozs7Ozs7Ozs7Ozs7QUF4ZkE7QUFDQTtBQTRnQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7OztBQy82QkE7QUFDQTtBQUVBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FBS0E7QUFDQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FBS0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBREE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQXpGQTtBQUNBO0FBMkZBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQURBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQWhCQTtBQWtCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBaEJBO0FBa0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFWQTtBQVlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBVEE7QUFsREE7QUFoSEE7QUFDQTtBQWdMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBWEE7QUFhQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFLQTtBQS9FQTs7Ozs7Ozs7QUNsU0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFUQTtBQVdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVZBO0FBdEJBO0FBbUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBVEE7QUEvQ0E7QUFDQTtBQTJEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVJBO0FBREE7QUFDQTtBQWNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBNUJBO0FBOEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTEE7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTEE7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTEE7QUFDQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBN0hBO0FBQ0E7QUErSEE7QUFDQTtBQUNBO0FBRkE7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFUQTtBQURBO0FBYUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFaQTtBQWNBO0FBQ0E7QUFDQTtBQUNBO0FBbERBOzs7Ozs7Ozs7O0FDcE5BO0FBQ0E7QUFDQTtBQUVBOzs7O0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OztBQ3ZKQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBeEJBO0FBREE7QUFDQTtBQTZCQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFGQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFPQTtBQUNBO0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBM09BO0FBQ0E7QUFnUEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBUEE7QUFTQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVRBO0FBRkE7QUFjQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFaQTs7Ozs7Ozs7QUNsVUE7Ozs7QUFJQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7OztBQVFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBRkE7QUFJQTs7OztBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQXRPQTs7Ozs7Ozs7QUNYQTtBQUNBO0FBRUE7Ozs7Ozs7Ozs7OztBQVdBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVRBO0FBQ0E7QUFZQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUdBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQXVCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVJBO0FBQ0E7QUFVQTtBQVdBOzs7Ozs7Ozs7O0FDL01BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBQ0E7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7QUFWQTtBQVlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQVJBO0FBYkE7Ozs7Ozs7Ozs7QUNiQTs7Ozs7Ozs7O0FBU0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFGQTtBQUFBO0FBSUE7QUFDQTtBQUxBO0FBQUE7QUFBQTtBQVNBO0FBQ0E7QUFDQTtBQVhBO0FBQUE7QUFBQTtBQWVBO0FBQ0E7QUFDQTtBQUNBO0FBbEJBO0FBQUE7QUFxQkE7QUFDQTtBQUNBO0FBdkJBO0FBQUE7QUFBQTtBQUFBO0FBMEJBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQXRDQTtBQXdDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQXBEQTtBQXNEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUEzREE7QUE2REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFPQTtBQUNBO0FBQ0E7QUFUQTtBQUFBO0FBV0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQTNCQTtBQTZCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFsQ0E7QUFBQTtBQXNDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBekxBO0FBQUE7QUE0TEE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVFBO0FBQ0E7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7Ozs7OztBQ3JRQTtBQUNBO0FBQ0E7Ozs7Ozs7QUNGQTtBQUNBOzs7Ozs7Ozs7OztBQ0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBMUNBOzs7Ozs7Ozs7O0FDRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRkE7QUFJQTs7Ozs7Ozs7QUMvRUE7QUFDQTtBQUVBOzs7Ozs7QUFLQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7QUFDQTs7Ozs7O0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBQ0E7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUE5T0E7QUFDQTtBQWlQQTtBQUNBO0FBQ0E7QUFGQTtBQUlBOzs7Ozs7OztBQzlQQTtBQUNBO0FBRUE7Ozs7OztBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUFJQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUhBO0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUFJQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQUNBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUEzTUE7QUFDQTtBQThNQTtBQUNBO0FBQ0E7QUFGQTtBQUlBOzs7Ozs7O0FDM05BOzs7Ozs7O0FDQUE7QUFDQTtBQUVBOzs7Ozs7QUFLQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FBSUE7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVJBO0FBVUE7QUFySEE7QUFDQTtBQXVIQTtBQUNBO0FBQ0E7QUFGQTtBQUlBOzs7Ozs7OztBQ3BJQTtBQUNBO0FBRUE7QUFDQTtBQUNBOzs7OztBQUtBO0FBQ0E7QUFDQTs7Ozs7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFMQTtBQUNBO0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFOQTtBQUNBO0FBUUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFoQkE7QUFrQkE7QUF6RUE7QUFDQTtBQTJFQTtBQUNBO0FBQ0E7QUFGQTtBQUlBOzs7Ozs7O0FDMUZBOzs7Ozs7O0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBRkE7QUFMQTtBQUNBO0FBVUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBQ0E7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQWpGQTtBQUNBO0FBb0ZBO0FBQ0E7QUFDQTtBQUZBOzs7Ozs7OztBQ3ZGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQTNDQTtBQTZDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUEvR0E7QUFDQTtBQWlIQTs7Ozs7OztBQU9BO0FBQ0E7Ozs7Ozs7Ozs7OztBQWVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7O0FDN0pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQUlBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQURBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBUEE7QUFDQTtBQVNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFQQTtBQVNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQU5BO0FBUUE7QUFWQTtBQVlBO0FBQ0E7QUFDQTtBQXBCQTtBQVZBO0FBcE1BO0FBQ0E7QUF1T0E7QUFDQTtBQUNBOzs7Ozs7O0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBVkE7QUFEQTtBQWNBOzs7Ozs7Ozs7O0FDN1NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBUkE7QUFVQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVBBO0FBQ0E7QUFVQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFNQTtBQUNBO0FBQ0E7Ozs7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7QUFTQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFDQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFMQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTEE7QUFPQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQU5BO0FBQ0E7QUFVQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7OztBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUE3UUE7Ozs7Ozs7Ozs7QUNDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBOUNBOzs7Ozs7Ozs7O0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBOUJBO0FBQ0E7QUFnQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBQ0E7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTs7Ozs7OztBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7O0FDdkxBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFqSEE7Ozs7Ozs7O0FDTkE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7QUFLQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFEQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUExQkE7QUE0QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVBBO0FBN0JBO0FBakZBOzs7Ozs7OztBQ05BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBREE7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFKQTtBQUNBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQURBO0FBR0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUxBO0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBVUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTkE7QUFRQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBUEE7QUFTQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFSQTtBQVVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQVJBO0FBVUE7QUFDQTtBQUNBO0FBQ0E7QUFoQkE7QUFrQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFUQTtBQVdBO0FBQ0E7QUFDQTtBQUNBO0FBakJBO0FBbUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBckJBO0FBSkE7QUFpQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUZBO0FBSUE7QUFDQTtBQUNBO0FBRkE7QUFqQkE7QUFKQTtBQTJCQTtBQUNBO0FBQ0E7QUFGQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBdklBO0FBdGRBO0FBQ0E7QUFvbUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFuQ0E7QUFDQTtBQXNDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFiQTtBQWZBO0FBK0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQWZBO0FBekJBO0FBMkNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFFQTtBQUNBO0FBTEE7QUFoQkE7QUF3QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBVkE7QUFZQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFDQTtBQUlBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFYQTtBQTVDQTtBQTBEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBRUE7QUFDQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBM0RBO0FBdENBO0FBN0pBO0FBa1FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBVkE7QUFDQTtBQVlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQURBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBN0JBO0FBQ0E7QUErQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBREE7Ozs7Ozs7QUNwOUJBOzs7Ozs7Ozs7QUNDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFBQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBN0JBO0FBREE7QUE3QkE7Ozs7Ozs7O0FDSkE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFIQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBTUE7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBdERBO0FBQ0E7QUF3REE7QUFDQTtBQUNBOzs7Ozs7Ozs7O0FDN0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7O0FBU0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7Ozs7Ozs7O0FBUUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQWNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FBS0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBS0E7QUFRQTtBQUNBO0FBQ0E7QUFDQTtBQUVBOzs7Ozs7Ozs7QUFTQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTEE7QUFDQTtBQVFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUZBO0FBREE7QUFDQTtBQS9NQTs7Ozs7OztBQ0pBOzs7QSIsInNvdXJjZVJvb3QiOiIifQ==