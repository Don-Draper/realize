/*! Fiera.js Copyright 2016, www.homeTLT.ru (Denis Ponomarev <ponomarevtlt@gmail.com>) */
var fiera =
/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// identity function for calling harmony imports with the correct context
/******/ 	__webpack_require__.i = function(value) { return value; };
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, {
/******/ 				configurable: false,
/******/ 				enumerable: true,
/******/ 				get: getter
/******/ 			});
/******/ 		}
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = 67);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ (function(module, exports) {

module.exports = fabric;

/***/ }),
/* 1 */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(fabric) {
var utils = __webpack_require__(3);
utils.object = __webpack_require__(2);
utils.compile = __webpack_require__(5);

function capitalize(string, firstLetterOnly) {
  return string.charAt(0).toUpperCase() +
    (firstLetterOnly ? string.slice(1) : string.slice(1).toLowerCase());
}

function toDashed (str) {
  return str.replace(/([a-z])([A-Z])/g, '$1-$2').toLowerCase();
}


var Toolbar = function(PARENT, el, options, menu){
  this.initialize(PARENT, el, options, menu)
};


Toolbar._getKeyString = function (config) {
  var string = "";

  if (config.ctrlKey)string += "Ctrl + ";
  if (config.altKey)string += "Alt + ";
  if (config.shiftKey)string += "Shift + ";

  var _code = config.key;
  if(_code){
    string += config.key;
  }
  return string;
};

Toolbar.makeActions = function (actions, PARENT) {
    var result = {};
    for (var i in actions) {
      actions[i].id = i;
      var _action = this.makeAction(actions[i], PARENT);
      if(_action){
        result[i] = _action;
      }
    }
    return result;
};

Toolbar.makeAction = function (_ORIGINAL, parent) {

  if (_ORIGINAL.constructor === Function) {
    _ORIGINAL = _ORIGINAL.call(parent);
  }

  var target;

  if (_ORIGINAL.target && _ORIGINAL.target.constructor === Function) {
    target = _ORIGINAL.target.call(parent);
  } else {
    target = _ORIGINAL.target || parent;
  }

  var ___target = _ORIGINAL.target;
  var ___parent = _ORIGINAL.parent;
  delete _ORIGINAL.parent;
  delete _ORIGINAL.target;
  var RES = utils.object.cloneDeep(_ORIGINAL);
  _ORIGINAL.parent = ___parent;
  _ORIGINAL.target = ___target;


  RES.parent = ___parent;
  RES.target = target;
  RES.id = toDashed(_ORIGINAL.id);


  function createGetter(property,useParent) {
    if (property.constructor === Function) {
      return property;
    }
    if (property.constructor === String) {
      var negative = false;
      if (property[0] === "!") {
        property = property.substr(1);
        negative = true;
      }
      if(useParent){
        return function () {
          return this && !!this[property] ^ negative;
        }
      }else{
        return function () {
          return this && !!this[property] ^ negative;
        }
      }
    }
    return null;
  }


  /*var _insert = _ORIGINAL.insert;
  if (!_insert || _insert.constructor == String) {

    if(_ORIGINAL.parent){
      var insertproperty = fabric.util.string.capitalize(fabric.util.string.camelize(_ORIGINAL.parent.id))
    }else{
      var insertproperty = _insert || "insert" + fabric.util.string.capitalize(id,true);
    }

    if(target[insertproperty] !== undefined){
      _insert = target[insertproperty]// createGetter(insertproperty,true)()
    }else{
      _insert = true;
    }
  }

  if(!_insert)return;*/

  if (!RES.type) {
    if (RES.menu) {
      RES.type = "menu";
    }else{
      RES.type = "button";
    }
  }
  if (!RES.action) {
    if(RES.type === "button"){
      RES.action = _ORIGINAL.id;
    }
  }


  if (RES.action) {
    if (RES.action.constructor === String) {
      RES.action = target[RES.action];
    }
    //RES = RES.action.bind(target);
    //RES.action = RES.action.bind(target);
    //_.extend(RES, _act);
    //arguments for action function
    if (_ORIGINAL.args) {
      RES._action = RES.action.bind(target, _ORIGINAL.args);
    } else {
      RES._action = RES.action.bind(target);
    }
    RES.action = function(){
      if(RES.disabled)return;
      RES._action.apply(this,arguments);
    }
  }


  if (_ORIGINAL.menu && _ORIGINAL.menu.constructor === Function) {
    RES.menu = _ORIGINAL.menu.bind(target);
  }
  if (_ORIGINAL.active) {
    RES.active = createGetter(_ORIGINAL.active).bind(target);
  }
  if (_ORIGINAL.visible) {
    RES.visible = createGetter(_ORIGINAL.visible).bind(target);
  }
  if (_ORIGINAL.enabled) {
    RES.enabled = createGetter(_ORIGINAL.enabled).bind(target);
  }
  if (!_ORIGINAL.value) {
    switch(_ORIGINAL.type){
      case "color":
      case "text":
      case "number":
      case "range":
      case "label":
      case "select":
      case "checkbox":
        _ORIGINAL.value = _ORIGINAL.id;
      // console.log(id, _ORIGINAL);
    }
  }
  if (_ORIGINAL.value) {
    var _set, _get, _options;
    if (_ORIGINAL.value.constructor === String) {

      var setFunctionName = "set" + capitalize(_ORIGINAL.value, true),
        getFunctionName = "get" + capitalize(_ORIGINAL.value, true),
        minName = "min" + capitalize(_ORIGINAL.value, true),
        maxName = "max" + capitalize(_ORIGINAL.value, true),
        setFoo = function(val){
          target[setFunctionName](val);
          // todo self.setFunctionCallback(target);
        },
        getFoo = target[getFunctionName],
        minFoo = target[minName],
        maxFoo = target[maxName];

      _set = setFoo || (_ORIGINAL.args ?
          function (val, args) {
            this[_ORIGINAL.value][args] = val;
          } :
          function (val) {
            this[_ORIGINAL.value] = val;
          });

      _get = getFoo || (_ORIGINAL.args ?
          function (args) {
            return this[_ORIGINAL.value][args];
          } :
          function () {
            return this[_ORIGINAL.value];
          });


      RES.value = {
        min: minFoo,
        max: maxFoo
      }

    } else {
      _set = _ORIGINAL.value.set;
      _get = _ORIGINAL.value.get;
      _options = _ORIGINAL.value.options;
    }

    if(RES.value.min !== undefined && RES.value.min.constructor === String){
      RES.value.min = target[RES.value.min];
    }
    if(RES.value.max !== undefined && RES.value.max.constructor === String){
      RES.value.max = target[RES.value.max];
    }
    if(RES.value.step !== undefined && RES.value.step.constructor === String){
      RES.value.step = target[RES.value.step];
    }
    var _min = RES.value.min, _max = RES.value.max, _step = RES.value.step;

    if (_set) {
      RES.value.set = ( _ORIGINAL.args ? _set.bind(target, _ORIGINAL.args) : _set.bind(target));
    }
    if (_get) {
      RES.value.get = ( _ORIGINAL.args ? _get.bind(target, _ORIGINAL.args) : _get.bind(target));
    }
    if (_min && _min.constructor === Function) {
      RES.value.min = ( _ORIGINAL.args ? _min.bind(target, _ORIGINAL.args) : _min.bind(target));
    }
    if (_max && _max.constructor === Function) {
      RES.value.max = ( _ORIGINAL.args ? _max.bind(target, _ORIGINAL.args) : _max.bind(target));
    }
    if (_step && _step.constructor === Function) {
      RES.value.step = ( _ORIGINAL.args ? _step.bind(target, _ORIGINAL.args) : _step.bind(target));
    }
    if (_options) {
      RES.value.options = ( _ORIGINAL.args ? _options.bind(target, _ORIGINAL.args) : _options.bind(target));
    }
  }

  if (_ORIGINAL.data) {
    RES.data = _ORIGINAL.data.call(target);
  }
  if (RES.menu) {
    if (_ORIGINAL.menu.constructor === Function){
      RES.menu =  _ORIGINAL.menu.call(target);
    }
    if (RES.type === "options") {
      for (var i in RES.menu) {
        RES.menu[i].parent = RES;
        RES.menu[i].type = "option";
        if(!RES.menu[i].title){
          RES.menu[i].title = i;
        }
        if(!RES.menu[i].option) {
          RES.menu[i].option = i;
        }
      }
    }
    for (var i in RES.menu) {
      if(RES.menu[i].constructor === String){
        RES.menu[i] = fabric.util.object.clone(RES.target.actions[RES.menu[i]]);
        RES.menu[i].parent = RES;
      }
      if(!RES.menu[i].id){
        RES.menu[i].id = i;
      }
      RES.menu[i] = Toolbar.makeAction(RES.menu[i], target);
      if(!RES.menu[i]){
        delete RES.menu[i];
      }
    }
  }



  if (_ORIGINAL.keyboard !== false && (_ORIGINAL.key || _ORIGINAL.shiftKey || _ORIGINAL.altKey || _ORIGINAL.ctrlKey || _ORIGINAL.metaKey)) {
    if(_ORIGINAL.keyCode && _ORIGINAL.keyCode.constructor === String){
      RES.keyCode = _ORIGINAL.keyCode.toUpperCase().charCodeAt(0);
      RES.key = String.fromCharCode(RES.keyCode);
    }
    RES.keyboard = true
  };

  return RES;
};

Toolbar.getButtons = function (actions) {
  var _buttons = [];
  for(var i in actions){
    var action = actions[i];
    if(action.keyboard){
      action.title += " (" + Toolbar._getKeyString(action) + ")";
      _buttons.push(action);
    }
    if (actions.menu) {
      _buttons = _buttons.concat(Toolbar.getButtons(actions.menu));
    }
  };

  return _buttons;
};
Toolbar.initKeys = function (actions) {

  var buttons = Toolbar.getButtons(actions);

  var self = this;
  $("body").on( "keydown",function (e) {
    for (var i in buttons) {
      var _config = buttons[i];

      if(_config.enabled && !_config.enabled()){
        continue;
      }
      if(_config.disabled || _config.disabled){
        continue;
      }
      if ((!_config.disabled && !_config.hidden) &&
        (_config.keyCode == e.keyCode || _config.key == e.key) &&
        (_config.ctrlKey === undefined || _config.ctrlKey == e.ctrlKey ) &&
        (_config.altKey === undefined || _config.altKey == e.altKey ) &&
        (_config.shiftKey === undefined || _config.shiftKey == e.shiftKey ) &&
        (_config.metaKey === undefined || _config.metaKey == e.metaKey )) {

        e.preventDefault();
        e.stopPropagation();
        if (_config.option !== undefined) {
          _config.action.call(_config.target, _config.option, e)
        } else {
          _config.action.call(_config.target, e)
        }
      }
    }
  });

  //$(window).on("mousewheel", function (event) {
  //  for (var i in self.buttons) {
  //    var data = self.buttons[i];
  //    if (!data.mousewheel)continue;
  //    if (!data.ctrlKey || data.ctrlKey && event.ctrlKey) {
  //      if (event.deltaY > 0 && data.mousewheel == ">") {
  //        data.action.call(target, data.option || event, event)
  //      }
  //      if (event.deltaY < 0 && data.mousewheel == "<") {
  //        data.action.call(target, data.option || event, event)
  //      }
  //      event.preventDefault();
  //      event.stopPropagation();
  //      return false;
  //    }
  //  }
  //});

};

Toolbar.prototype = {

  // setFunctionCallback: function(){},
  tools: {

    "label": {
      scope: function (data, options) {
        return {
          getValue: data.value.get,
          valueCurrent: data.value.get()
        }
      },
      template: '<div class="object-menu-item object-menu-label" title="{title}">',
      render: function ($item, data, options, tool, val) {
        var scope = fabric.util.object.defaults(tool.scope.call(this, data, options),data);
        $item.html(data.template.format(data.value.get()));
        utils.compile.compileElement($item,scope);
      }
    },
    "number": {
      scope: function (data, options) {
        return {
          getInputValue: function(){
            return parseFloat(data.$item.find("input").val());
          },
          getValue: data.value.get,
          setValue: data.value.set,
          minValue: data.value.min && data.value.min(),
          maxValue: data.value.max && data.value.max(),
          valueCurrent: data.value.get(),
          onchange: function (e) {
            data.value.set(parseFloat($(e.target).val()));
          }
        }
      },
      template: '<div class="object-menu-item object-menu-number" title="{title}">' +
      '<input type="number" min="{minValue}" max="{maxValue}" value="{valueCurrent}" onchange="onchange(event)">',
      render: function ($item, data, options, tool, val) {
        $item.find("input").val(data.value.get());
      }
    },
    "range": {
      scope: function (data, options) {
        return {
          minValue: data.value.min ? typeof data.value.min == "function" ? data.value.min() : data.value.min: 0,
          maxValue: data.value.max ? typeof data.value.max == "function" ? data.value.max() : data.value.max: 1,
          valueStep: data.value.step ? typeof data.value.step == "function" ? data.value.step() : data.value.step: 0.1,
          valueCurrent: data.value.get(),
          onchange: function (e) {
            data.value.set(parseFloat($(e.target).val()));
          }
        }
      },
      template: '<div class="object-menu-item object-menu-range" title="{title}">' +
      '<input type="range" step="{valueStep}" min="{minValue}" max="{maxValue}" value="{valueCurrent}" onchange="onchange(event)">',
      render: function ($item, data, options, tool, val) {
        $item.find("input").val(data.value.get());
      }
    },
    "checkbox": {
      scope: function (data, options) {
        return {
          onchange: function (e) {
            data.value.set(e.target.checked)
          },
          valueCurrent: data.value.get()
        }
      },
      template:
      '<div class="object-menu-item object-menu-checkbox" title="{title}">' +
      '<input type="checkbox" onchange="onchange(event)" dp-checked="{valueCurrent}" id="checkbox-{id}">' +
      '<label for="checkbox-{id}"  class="btn button-{id} {className}">',
      render: function ($item, data, options, tool, val) {
        $item.find("input").val(val);
      }
    },
    "menu": {
      template:
        '<div class="object-menu-item object-menu-menu" title="{title}">' +
        '<label dp-if="title" for="button-{id}">{title}</label>' +
        '<button class="btn button-menu-trigger button-{id} {className}" id="button-{id}"/>' +
        '<div class="object-menu submenu" transclude/>',
      post: function ($item, data, options, transclude) {
        //$item.find(".button-menu-trigger").click(function () {
        //  $item.find(".object-menu").toggle();
        //})
        if (data.hovered) {
          $item.addClass("hovered");
          this.toggleByHover($item, transclude, null, data)
        }
        if (data.toggled) {
          $item.addClass("toggled");
          this.toggleByButton($item, transclude)
        };
        this.generateMenu(data.target, transclude, options, data.menu);
      }
    },
    "button": {
      scope: function (data, options) {
        return {
          buttonsTitle: options.buttons && options.buttons.title || false,
          buttonscClassName: (options.buttons && options.buttons.className || '')
        }
      },
      template:
      '<div class="object-menu-item" title="{title}">' +
      '<button class="btn button-{id} {className} {buttonscClassName}"  onclick="!disabled && option ? action(option) : action()">' +
      '<img dp-if="icon" dp-src="icon">' +
      '<span dp-include="svg" dp-if="svg"></span>' +
      '<span dp-if="buttonsTitle" class="button-title">{title}</span>'
    }
  },
  initialize: function(PARENT, el, options, menu){
    this.buttons = [];
    //todo это не совсем хорошо. нельзя создать улбраы с разными конфигами кнопок
    // this.tools = utils.object.cloneDeep(this.tools);

    if (options) {
      if (options.button) {
        utils.object.extend(this.tools.button, options.button);
      }
    }
    if (!PARENT.generatedActions) {
      PARENT.makeActions( menu);
    }

    if(el.constructor === String){
      el = $(document.getElementById(el));
    }
    if(el.length && Object.keys(PARENT.generatedActions).length){
      this.generateMenu(PARENT, el, options, PARENT.generatedActions);
      this.onCreate();
      el.show();
    }
    Toolbar.initKeys(PARENT.generatedActions);
  },
onCreate: function () {

  },
  destroy: function (target) {
    for (var i = this.buttons.length;i--;) {
      var _config = this.buttons[i];
      if(target && _config.target != target ){
        continue;
      }
      this.buttons.splice(i,1);
    }
  },
  createInput: function ($item, data, type) {

    var target = data.target;
    var $input = $("<input>")
      .attr("type", type)
      .attr("min", data.value.min())
      .attr("max", data.value.max());

    $input.val(data.value.get());
    if (data.value.observe) {
      target.on(data.value.observe, function (val) {
        $input.val(data.value.get());
      });
    }
    $input.change(function (e) {
      data.value.set(parseFloat($input.val()))
    });
    $item.append($input);
  },
  initItem: function ($item, data) {

    if (data.active) {
      if (data.active.call(data.target, data.option)) {
        $item.addClass("active");
      }
    }

    if (data.visible !== undefined) {
      if (data.visible.constructor == Function) {
        if (!data.visible.call(data.target)) {
          $item.hide();
        }
      } else if (!data.visible) {
        $item.hide();
      }
    }

    data.disabled = false;
    if (data.enabled !== undefined) {
      if (data.enabled.constructor == Function) {
        if (!data.enabled.call(data.target)) {
          $item.attr("disabled", true);
          data.disabled = true;
        }
      }
    }

    if (data.observe) {
      //todo
      if (data.visible && data.visible.constructor == Function) {
        data.target && data.target.on(data.observe, function () {
          if (!data.visible.call(data.target)) {
            $item.hide();
            data.hidden = true;
          } else {
            $item.show();
            data.hidden = false;
          }
        });
      }

      if (data.type == "options") {
        data.target && data.target.on(data.observe, function () {
          var _val = data.value.get();
          $("[name=" + data.id + "]").prop("checked",false);
          $("[name=" + data.id + "][value=" + _val +"]").prop("checked",true);
        });
      }

      if (data.enabled && data.enabled.constructor == Function) {
        data.target && data.target.on(data.observe, function () {
          if (!data.enabled.call(data.target)) {
            $item.attr("disabled", true);
            data.disabled = true;
          } else {
            $item.removeAttr("disabled");
            data.disabled = false;
          }
        });
      }
    }
  },
  toggleByHover: function ($item, $toggleElement, foo,data) {

    var onClose;

    $toggleElement.hide();
    $item.mouseout(function () {
      $toggleElement.hide();
      onClose && onClose();
    });
    $item.mouseover(function () {
      $toggleElement.show();
      onClose = foo && foo();
    });

    $item.click(function () {
      if (data && data.immediately) {
        data.action();
      }
    });
  },
  toggleByButton: function ($item, $toggleElement, foo,data) {

    var onClose;
    var _try_hide = function (e) {
      var _parents = $(e.target).parents();
      for (var i in _parents) {
        if (_parents[i] === $item[0]) {
          return false;
        }
      }
      if ($toggleElement.css("display") !== "none") {
        $toggleElement.hide();
        onClose && onClose();
      }
    };

    $toggleElement.click(function (e) {
      e.stopPropagation();
    });
    $toggleElement.hide();
    $item.click(function () {

      if ($toggleElement.css("display") !== "none") {
        $toggleElement.hide();
        onClose && onClose();
        $(window).off("click", _try_hide);
      } else {
        $toggleElement.show();
        $(window).on("click", _try_hide);

        onClose = foo && foo();

        if(data && data.immediately){
          data.action();
        }
      }
    })
  },
  generateMenu: function (target, $el, options, menu) {

    options = options || {
        title: false
      };
    options.buttons = options.buttons || {
        className: "",
        title: false
      };

    $el.empty();

    var _this =  this;
    for (var i in menu) {
      var data = menu[i];
      if (!data || data.insert !== undefined && !data.insert) {
        continue;
      }
      data.type = data.type || "button";

      //todo непонятно зачем аргумент target в начале
      var target = data.target;

      var tool = this.tools[data.type];

      if (!tool) {
        console.warn("tool '" + data.type + "' undefined");
        continue;
      }
      var scope = data;
      if (tool.scope) {
        scope = fabric.util.object.defaults(tool.scope.call(this, data, options),data);
      }

      var $item = $(tool.template.format(scope));
      var transclude = $item.find("[transclude]");
      scope.$item = data.$item = $item;
      if(data.template){
        $item.html(data.template.format(data.value.get()));
      }

      utils.compile.compileElement($item,scope);

      if (data.value && data.value.observe) {

        target.on(data.value.observe, function (val) {

          if (tool.post) {
            tool.post.call(_this,$item, scope, options, transclude.length ? transclude : null);
          }
          if(tool.render){
            tool.render.call(_this, $item, data, options, tool, val);
          }
          //this.fire(data.type + ":render",{item: $item, data: data, options: options, tool: tool, val: val})
        });
      }

      this.initItem($item, data);

      if (tool.post) {
        tool.post.call(this,$item, scope, options, transclude.length ? transclude : null);
      }

      this.fire(data.type + ":created",{item: $item, data: data, options: options, tool: tool});

      $el.append($item);
    }
  }
};
utils.observable(Toolbar.prototype);


Toolbar.single = function(data,element){
  data.$item = element;
  data.type = data.type || "button";

  var tool = Toolbar.prototype.tools[data.type];

  Toolbar.prototype.initItem(element,data);

  if (data.value && data.value.observe) {
    data.target.on(data.value.observe, function (val) {
      tool.render( element, data, {}, tool, val)
    });
  }

  if(tool.post){
    var transclude = element.find("[transclude]");

    tool.post.call(Toolbar.prototype, element, data, {}, transclude.length ? transclude : null);
  }

  var scope = data;
  if(tool.scope){
    scope = _.defaults(data, tool.scope.call(Toolbar.prototype, data, {}));
  }

  element.eachSelf("*",function(){
    var nodes=[], values=[];
    for (var att, i = 0, atts = this.attributes, n = atts.length; i < n; i++){
      att = atts[i];
      nodes.push(att.nodeName);
      values.push(att.nodeValue);
      this.setAttribute(att.nodeName,att.nodeValue.format(scope));
    }
  });
  utils.compile.compileElement(element,scope);
};


module.exports = Toolbar;




/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 2 */
/***/ (function(module, exports) {

var utils = {
  /**
   *
   * @param arr
   * @param arr2
   * @returns {{}}
   * @example
   *    x = {a: 1 ,b: 1, c: [1,2]}
   *    y = {a: 2 ,  c : 3 , d : 1}
   *
   *    extendArraysObject(x,y) = {a: [1,2] b : [1] c : [1,2,3], d [1] }
   */
  extendArraysObject : function(arr,arr2){
    var newArray = {};

    for(var i in arr){
      if(arr[i].constructor == Array){
        newArray[i]  = [].concat(arr[i]);
      }else{
        newArray[i] = [arr[i]];
      }
    }

    for(var i in arr2){
      if(newArray[i]){
        newArray[i].push(arr2[i]);
      }else{
        newArray[i] = [arr2[i]];
      }
    }
    return newArray;
  },
  filterValues: function (array, values) {
    var new_array = [];
    for (var i in array) {
      var _new_object = {};
      for (var j in values) {
        _new_object[values[j]] = array[i][values[j]]
      }
      new_array.push(_new_object);
    }
    return new_array;
  },

  /**
   *  Тасование Фишера–Йетса,случайное тасование множества
   * @param object
   * @returns {*}
   */
  shuffle: function (object) {
    if (!object.length) return;
    var i = object.length;
    while (--i) {
      var j = Math.floor(Math.random() * (i + 1));
      var temp = object[i];
      object[i] = object[j];
      object[j] = temp;
    }

    return object; // for convenience, in case we want a reference to the array
  },
  /**
   * Dependency: underscore.js ( http://documentcloud.github.com/underscore/ )
   *
   * Mix it in with underscore.js:
   * _.mixin({deepExtend: deepExtend});
   *
   * Call it like this:
   * var myObj = utils.deepExtend(grandparent, child, grandchild, greatgrandchild)
   *
   * Notes:
   * Keep it DRY.
   * This function is especially useful if you're working with JSON config documents. It allows you to create a default
   * config document with the most common settings, then override those settings for specific cases. It accepts any
   * number of objects as arguments, giving you fine-grained control over your config document hierarchy.
   *
   * Special Features and Considerations:
   * - parentRE allows you to concatenate strings. example:
   *   var obj = utils.deepExtend({url: "www.example.com"}, {url: "http://#{_}/path/to/file.html"});
   *   console.log(obj.url);
   *   output: "http://www.example.com/path/to/file.html"
   *
   * - parentRE also acts as a placeholder, which can be useful when you need to change one value in an array, while
   *   leaving the others untouched. example:
   *   var arr = utils.deepExtend([100,    {id: 1234}, true,  "foo",  [250, 500]],
   *                          ["#{_}", "#{_}",     false, "#{_}", "#{_}"]);
   *   console.log(arr);
   *   output: [100, {id: 1234}, false, "foo", [250, 500]]
   *
   * - The previous example can also be written like this:
   *   var arr = utils.deepExtend([100,    {id:1234},   true,  "foo",  [250, 500]],
   *                          ["#{_}", {},          false, "#{_}", []]);
   *   console.log(arr);
   *   output: [100, {id: 1234}, false, "foo", [250, 500]]
   *
   * - And also like this:
   *   var arr = utils.deepExtend([100,    {id:1234},   true,  "foo",  [250, 500]],
   *                          ["#{_}", {},          false]);
   *   console.log(arr);
   *   output: [100, {id: 1234}, false, "foo", [250, 500]]
   *
   * - Array order is important. example:
   *   var arr = utils.deepExtend([1, 2, 3, 4], [1, 4, 3, 2]);
   *   console.log(arr);
   *   output: [1, 4, 3, 2]
   *
   * - You can remove an array element set in a parent object by setting the same index value to null in a child object.
   *   example:
   *   var obj = utils.deepExtend({arr: [1, 2, 3, 4]}, {arr: ["#{_}", null]});
   *   console.log(obj.arr);
   *   output: [1, 3, 4]
   *
   **/
  deepExtend: function (/*obj_1, [obj_2], [obj_N]*/) {
    if (arguments.length < 1 || typeof arguments[0] !== 'object') {
      return false;
    }

    if (arguments.length < 2) return arguments[0];

    var target = arguments[0];

    // convert arguments to array and cut off target object
    var args = Array.prototype.slice.call(arguments, 1);

    var key, val, src, clone, tmpBuf;

    args.forEach(function (obj) {
      if (typeof obj !== 'object') return;

      for (key in obj) {
        if (!(key in obj)) continue;

        src = target[key];
        val = utils.cloneDeep(obj[key]);


        if (typeof src !== 'object' || src === null) {
          target[key] = val;
        }else if (Array.isArray(val)) {
          clone = (Array.isArray(src)) ? src : [];

          val.forEach(function(item){
            clone.push(utils.cloneDeep(item));
          });

          target[key] = clone;
          //todo  если заимствуем массив , то ссохраняем значения из обоих массивов
          //target[key] = utils.deepExtend(clone, val);

        } else {
          clone = (!Array.isArray(src)) ? src : {};
          target[key] = utils.deepExtend(clone, val);
        }

      }
    });

    return target;
  },
  cloneDeep: function (val) {

    if (typeof val === 'undefined') {
      return undefined;
    }

    if (val === null) {
      return null;
    } else if (val instanceof Date) {
      return new Date(val.getTime());
    } else if (val instanceof RegExp) {
      return new RegExp(val);
    }

    if(val.cloneSync){
      return val.cloneSync();
    }else if(val.constructor == Object){
      return utils.deepExtend({}, val);
    }else if(val.constructor == Array){
      var clone = [];
      for(var i =0 ;i < val.length; i++){
        clone.push(utils.cloneDeep(val[i]));
      }
      return clone;
    }else{
      return val;
    }
  },
  rearrange: function (object, keys) {
    var _newOrder = {};
    for (var i in keys) {
      if(object[keys[i]] !== undefined){
        _newOrder[keys[i]] = object[keys[i]]
      }
    }
    // for (i in object) {
    //   delete object[i];
    // }
    // for (i in _newOrder) {
    //   object[i] = _newOrder[i];
    // }
    return _newOrder;
  },
  sortBy: _.sortBy,
  defaults: _.defaults,
  where: _.where,
  findWhere: _.findWhere,
  filter: _.filter,
  pick: _.pick,
  extend: function (destination) {
    // JScript DontEnum bug is not taken care of
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];
      for (var property in source) {
        destination[property] = source[property];
      }
    }
    return destination;
  }
};
module.exports =  utils;


/***/ }),
/* 3 */
/***/ (function(module, exports, __webpack_require__) {

var objectUtils = __webpack_require__(2)

var utils = {
  /**
   * will divide total width for every object in columnts array
   *
   *
   * @example
   *     var _flexArray = fabric.util.flex(200 , [{flex: 0},{value: 100, flex: 1},{flex: 0}] );
   * @param total
   * @param columns
   * @returns {Array}
   * @example [50,100,50]
   */
  flex: function (total,columns){
    var _return = [];
    var split = 0;
    columns.forEach(function(column, index){
      if(column.value === undefined){
        split++;
      }else{
        total -= column.value;
      }
    });
    var _w = total / split;
    columns.forEach(function(column){
      _return.push(column.value === undefined ? _w :  column.value );
    });
    return _return;
  },
  worker: function (foo) {
    if (window.Worker) {
      var str = foo.toString();
      var eventArg = str.substring(str.indexOf("(") + 1,str.indexOf(","));
      var postMessageArg = str.substring(str.indexOf(",") + 1,str.indexOf(")"));
      var _functionBody = str.substring(str.indexOf("{") + 1);
      str = "onmessage=function(" + eventArg + "){" + postMessageArg + "= postMessage;" + _functionBody;
      var blob = new Blob([str]);
      //"onmessage = function(e) { postMessage('msg from worker'); }"]);
      var blobURL = window.URL.createObjectURL(blob);
      return new Worker(blobURL);
    } else {
      var worker = {
        terminate: function () {
        },
        postMessage: function (data) {
          setTimeout(function () {
            foo({data: data}, function (responseData) {
              worker.onmessage && worker.onmessage({data: responseData});
            })
          });
        }
      };
      return worker;
    }
  },
  observable: function (obj) {
    _.extend(obj, {

      fire: function fire(eventName, options) {
        if (!this.__eventListeners) {
          return;
        }
        var listenersForEvent = this.__eventListeners[eventName];
        if (!listenersForEvent) {
          return;
        }
        for (var i = 0, len = listenersForEvent.length; i < len; i++) {
          listenersForEvent[i].call(this, options || {});
        }
        return this;
      },
      on: function (eventName, handler) {
        if (eventName.constructor == Object) {
          for (var i in eventName) {
            this.on(i, eventName[i])
          }
          return this;
        }
        var events = eventName.split(" ");
        for (var i in events) {
          this.observe(events[i], handler)
        }
        return this;
      },
      observe: function (eventName, handler) {
        if (!this.__eventListeners) {
          this.__eventListeners = {};
        }
        if (arguments.length === 1) {
          for (var prop in eventName) {
            this.on(prop, eventName[prop]);
          }
        }
        else {
          if (!this.__eventListeners[eventName]) {
            this.__eventListeners[eventName] = [];
          }
          this.__eventListeners[eventName].push(handler);
        }
        return this;
      },
      off: function stopObserving(eventName, handler) {
        function _removeEventListener(eventName, handler) {
          if (!this.__eventListeners[eventName]) {
            return;
          }

          if (handler) {
            var idx = this.__eventListeners[eventName].indexOf(handler);
            if (idx !== -1) {
              this.__eventListeners[eventName].splice(idx, 1);
            }
          }
          else {
            this.__eventListeners[eventName].length = 0;
          }
        }

        if (!this.__eventListeners) {
          return;
        }
        if (arguments.length === 0) {
          this.__eventListeners = {};
        }
        else if (arguments.length === 1 && typeof arguments[0] === 'object') {
          for (var prop in eventName) {
            _removeEventListener.call(this, prop, eventName[prop]);
          }
        }
        else {
          _removeEventListener.call(this, eventName, handler);
        }
        return this;
      }
    })
  },
  inOrder: function (array, foo, callback) {
    var _index = 0;
    function _inOrderIndex() {
      if (++_index < array.length) {
        foo(array[_index], _index, _inOrderIndex)
      } else {
        callback && callback();
      }
    }
    foo(array[_index], _index, _inOrderIndex)
  },
  /**
   * возвращает объект с ключами строки url
   * @returns {{}}
   */
  queryString: function (query) {
    if(query) {
      query = query.substr(query.indexOf("?") + 1) ;
    }else{
      query = window.location.search.substring(1);
    }
    var obj = {};
    var _length = 0;
    if (!query)return obj;
    var vars = query.split("&");
    for (var i = 0; i < vars.length; i++) {
      var pair = vars[i].split("=");
      var _vname = pair[0], val = pair[1];
      if (typeof obj[_vname] === "undefined") {
        obj[_vname] = val || "";
        Object.defineProperty(obj, _length, {value: _vname, enumerable: false});
        _length++;
        // If second entry with this name
      } else if (typeof obj[_vname] === "string") {
        var arr = [obj[_vname], val];
        obj[_vname] = arr;
        Object.defineProperty(obj, _length, {value: _vname, enumerable: false});
        _length++;
        // If third or later entry with this name
      } else {
        obj[_vname].push(val);
        Object.defineProperty(obj, _length, {value: _vname, enumerable: false});
        _length++;
      }
    }
    Object.defineProperty(obj, "length", {value: _length, enumerable: false});
    return obj;
  },
  copyValue: function (value) {
    if (value == null) {
      return null
    }
    if (value == undefined) {
      return undefined
    }
    switch (value.constructor) {
      case Object:
        return objectUtils.deepExtend({}, value);
      case Array:
        return objectUtils.deepExtend([], value);
      case String:
      case Number:
      case Boolean:
        return value;
      default:
        //console.log(value.constructor);
        return objectUtils.deepExtend({}, value);
    }
  },
  clearValue: function (value) {
    switch (value.constructor) {
      case Object:
        for (var member in value) delete value[member];
        break;
      case Array:
        value.length = 0;
        break;
      default:
        delete value;
    }
  },
  objectsDifference: function (prev, now) {
    var changes = {};
    for (var prop in now) {
      if (!prev || prev[prop] !== now[prop]) {
        if (typeof now[prop] == "object") {
          var c = utils.objectsDifference(prev[prop], now[prop]);
          if (!_.isEmpty(c)) // underscore
            changes[prop] = c;
        } else {
          changes[prop] = now[prop];
        }
      }
    }
    return changes;
  },
  splitBy: function (query, delimiter) {
    var traceQueries = [];
    var r = 0,
      f = 0,
      _p_start = 0;
    if (query == "") return [];
    for (var i = 0; i < query.length; i++) {
      var c = query[i];
      if (c == "(") {
        r++;
        f = 1;
      } else if (c == ")") {
        r--;
      }
      if (r == 0 && f == 1) f = 0;
      if (delimiter.indexOf(c) != -1 && r == 0 && f == 0) {
        traceQueries.push(query.substring(_p_start, i));
        _p_start = i + 1;
      }
    }
    traceQueries.push(query.substring(_p_start));
    return traceQueries;
  },
  queueLoad: function (total, completeCB, progressCB) {
    var loader = function (el) {
      loader.loaded.push(el);
      loader.progressCB && loader.progressCB(loader.loaded.length, loader.total, el, loader.loaded);

      if (loader.loaded.length == loader.total) {
        loader.completeCB && loader.completeCB(loader.loaded);
        loader.fire("loaded");
      }
    };
    loader.completeCB = completeCB;
    loader.progressCB = progressCB;
    loader.total = total;
    loader.loaded = [];
    utils.observable(loader);

    return loader;
  }
};
module.exports =  utils;


/***/ }),
/* 4 */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(fabric) {
var ExtCanvasMixin = {
  defaultOptions: {},
  animated: false,
  fitIndex: 0.8,
  optionsOrder: ["originalWidth","originalHeight","width","height","*"],
  /**
   * required to show video
   */
  setAnimated: function (val) {
    if(!val){
      return;
    }

    fabric.util.requestAnimFrame(function render() {
      this.renderAll();
      fabric.util.requestAnimFrame(render);
    }.bind(this));
  },
  find: function (options) {
    if (typeof options === "string"){
      options = {
        type: options
      }
    }
    return fabric.util.object.where(this._objects,options);
  },
  _update_background_image: function () {
    var photo = this.backgroundImage;
    if (!photo || photo.constructor == Object || photo.constructor == String) return;

    if (this.backgroundPosition === 'resize') {
      this.originalWidth = photo.width;
      this.originalHeight = photo.height;

    }else if (this.backgroundPosition !== 'manual') {

      var _w  =  this.originalWidth || this.width,  _h = this.originalHeight || this.height;

      if(photo._originalElement){
        var size = fabric.util.getProportions(photo._originalElement, {
          width: _w,
          height: _h
        }, this.backgroundPosition);
      }else{
        size = {
          width: _w,
          height: _h
        }
      }

      var _l ;
      if(this.backgroundImage.originX == 'center'){
        _l = _w / 2;
      }else{
        _l = (_w - size.width) / 2 ;
      }
      var _t ;
      if(this.backgroundImage.originY == 'center'){
        _t = _h / 2;
      }else{
        _t = (_h - size.height) / 2 ;
      }

      this.backgroundImage.set({
        left: _l + this.viewportTransform[4],
        top:  _t + this.viewportTransform[5],
        width: size.width,
        height: size.height
      });
    } else {
      // var _orig = this.backgroundImage.getOriginalSize();
      // this.backgroundImage.set({
      //   originX: 'left',
      //   originY: 'top',
      //   left: 0, //this.viewportTransform[4],
      //   top: 0, //this.viewportTransform[5],
      //   width: _orig.width,
      //   height: _orig.height
      // });
    }
  },
  setBackgroundImage: function (bg, callback) {
    var _bgimageLoaded = function (el){

      this.backgroundImage = el;
      this.backgroundImage.canvas = this;
      this._update_background_image();
      if(!this.originalWidth && !this.originalHeight){
        this.originalWidth = el.width;
        this.originalHeight = el.height;
      }
      this.fire("background-image:loaded",{target: el});
      callback && callback();
    }


    if (!bg) {
      this.backgroundImage = null;
      return callback();
    }
    if (bg instanceof HTMLImageElement || bg instanceof Image){

      var el = new fabric.Image(bg,{
        width: bg.naturalWidth,
        height: bg.naturalHeight
      });

      _bgimageLoaded.call(this,el);
    }
    if (bg.constructor == String) {
      bg = {
        src: bg
      }
    }
    var _proto = this.application.prototypes;
    if(_proto && _proto.SlideCanvas && _proto.SlideCanvas.backgroundImageProperties){
      fabric.util.object.extend(bg,_proto.SlideCanvas.backgroundImageProperties);
    }
    bg.application = this.application;
    bg.type = bg.type || "image";
    // bg.width = bg.naturalWidth;
    // bg.height = bg.naturalHeight;
    //
    fabric.util.createObject(bg,_bgimageLoaded.bind(this));
  },
  createObjects: function(objects,callback){

    if(this.application){
      for(var i in objects){
        if(objects[i].constructor == String){
          objects[i] = this.application.objects[objects[i]];
        }
      }
    }

    var _canvas = this;

    function success(_objects) {
      _canvas.fire("progress:complete", {objects: objects});
      for (var i in _objects) {
        _canvas.add(_objects[i].object);
      }
      _canvas.renderAll();
      callback && callback.call(_canvas)
    }

    function progress(l, t) {
      _canvas.fire("progress", { loaded : l, total : t });
      if (fabric.util.loaderDebug) {
        console.log("loaded " + l + " / " + t);
      }
    }


    var _objects = [];
    if (!objects || !objects.length) {
      this.fire("progress:complete", 0);
      success(_objects);
      return;
    }

    var queueLoadCallback = fabric.util.queueLoad(objects.length, function(){
      success(_objects)
    }, progress);

    queueLoadCallback.data = (this.title || "") + "objects";

    for (var i in objects) {
      (function (options) {
        var _object_slot = {object: null, options: options};
        _objects.push(_object_slot);

        options.application = _canvas.application;
        fabric.util.createObject(options, function (el) {
          _object_slot.object = el;
          queueLoadCallback();
        });
      }).call(this, objects[i]);
    }
  },
  /**
   * apply options for group of filtered objects
   * @param filter
   * @param options
   */
  applyOptions: function(filter,options){
    this._objects.forEach(function(_obj){
      for(var prop in filter){
        if(_obj[prop] !==  filter[prop])return;
      }
      _obj.setOptions(options);
    })
  },
  /**
   * Create Object by type and options
   * @param type
   * @param options
   * @param callback
   */
  createObject: function (type, options,callback) {
    if(typeof type !== "string"){
      callback = options;
      options = fabric.util.object.clone(type);
      type = null;
    }else{
      options = fabric.util.object.clone(options);
      options.type = type;
    }

    var _self = this;
    options.application = this.application;
   // var _active = options.active;
   // var _position = options.position;
//    delete options.active;
  //  delete options.position;


    function _add(el) {
      if(el.canvas)return;
      _self.add(el);
/*
      if(_active){
      if(_active){
        _self.setActiveObject(el);
      }*/
      callback && callback(el);
    }

    var el = fabric.util.createObject(options, _add );
    el && _add(el);
    return el;
  },
  onLoad: function (callback) {
    this.processing =false;
    this.loaded = true;
    this.fire("loading:end",{type: "slide", target: this});
    this.renderAll();
    callback && callback.call(this);
  },
  load: function (options,callback) {
    this.originalWidth = 0;
    this.originalHeight = 0;
    if (!options)return;

    if(!this.virtual){
      this.clear();
    }

    if(options.width){
      options.originalWidth = options.width;
      options.originalHeight = options.height;
    }

    this.processing = true;
    this.fire("loading:begin",{type: "slide", target: this});

    this.set(options,this.onLoad.bind(this,callback));


    //todo
    if(this.plugins){
      this.plugins.preloaders.forEach(function(preloader){
        preloader.call(this, options);
        this.onResize();
      }.bind(this));
    }


  },
  setObjects: function(objects,callback){

    this.createObjects(objects,function(){
      for(var i in this._objects){
        this._objects[i].setCoords();
      }
      callback();
    });
  },
  onResize: function(){
    var _scale = Math.min(1,800 /this.width );
    // this.setZoom(_scale);
    this.setDimensions({width: this.width,height: this.height});
  },
  getCenter: function (el) {
    return {
      top: (this.originalHeight  || this.getHeight()) / 2,
      left: (this.originalWidth || this.getWidth()) / 2
    };
  },
  setOriginalSize: function (w, h) {
    this.originalWidth = h ? w : (w.naturalWidth || w.width);
    this.originalHeight = h ? h : (w.naturalHeight || w.height);
    return this;
  }
};

fabric.util.object.extend(fabric.StaticCanvas.prototype,ExtCanvasMixin);
fabric.util.object.extend(fabric.Canvas.prototype,ExtCanvasMixin);

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 5 */
/***/ (function(module, exports, __webpack_require__) {


String.prototype.format  = function () {
  var str = this.toString();
  if (arguments.length) {
    var type = typeof arguments[0]
      , args = type == 'string' || type == 'number' ? Array.prototype.slice.call(arguments) : arguments[0]
    //
    // for (var arg in args) str = str.replace(new RegExp('\\{' + arg + '\\}', 'gi'), args[arg])

    str = str.replace(/\{([^}]*)\}/g,function(a,b){
      return utils.evalInContext(b,args)
    })
  }

  return str
};

utils = {
  extractVariables: function (str) {
    return str.match(/(?!(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$)[$A-Z\_a-z\xaa\xb5\xba\xc0-\xd6\xd8-\xf6\xf8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u08a0\u08a2-\u08ac\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097f\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58\u0c59\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d60\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f0\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191c\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19c1-\u19c7\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua697\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa80-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uabc0-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc][$A-Z\_a-z\xaa\xb5\xba\xc0-\xd6\xd8-\xf6\xf8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u08a0\u08a2-\u08ac\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097f\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58\u0c59\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d60\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f0\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191c\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19c1-\u19c7\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua697\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa80-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uabc0-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc0-9\u0300-\u036f\u0483-\u0487\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u0669\u0670\u06d6-\u06dc\u06df-\u06e4\u06e7\u06e8\u06ea-\u06ed\u06f0-\u06f9\u0711\u0730-\u074a\u07a6-\u07b0\u07c0-\u07c9\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0859-\u085b\u08e4-\u08fe\u0900-\u0903\u093a-\u093c\u093e-\u094f\u0951-\u0957\u0962\u0963\u0966-\u096f\u0981-\u0983\u09bc\u09be-\u09c4\u09c7\u09c8\u09cb-\u09cd\u09d7\u09e2\u09e3\u09e6-\u09ef\u0a01-\u0a03\u0a3c\u0a3e-\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a66-\u0a71\u0a75\u0a81-\u0a83\u0abc\u0abe-\u0ac5\u0ac7-\u0ac9\u0acb-\u0acd\u0ae2\u0ae3\u0ae6-\u0aef\u0b01-\u0b03\u0b3c\u0b3e-\u0b44\u0b47\u0b48\u0b4b-\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b66-\u0b6f\u0b82\u0bbe-\u0bc2\u0bc6-\u0bc8\u0bca-\u0bcd\u0bd7\u0be6-\u0bef\u0c01-\u0c03\u0c3e-\u0c44\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0c66-\u0c6f\u0c82\u0c83\u0cbc\u0cbe-\u0cc4\u0cc6-\u0cc8\u0cca-\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0ce6-\u0cef\u0d02\u0d03\u0d3e-\u0d44\u0d46-\u0d48\u0d4a-\u0d4d\u0d57\u0d62\u0d63\u0d66-\u0d6f\u0d82\u0d83\u0dca\u0dcf-\u0dd4\u0dd6\u0dd8-\u0ddf\u0df2\u0df3\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0e50-\u0e59\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0ed0-\u0ed9\u0f18\u0f19\u0f20-\u0f29\u0f35\u0f37\u0f39\u0f3e\u0f3f\u0f71-\u0f84\u0f86\u0f87\u0f8d-\u0f97\u0f99-\u0fbc\u0fc6\u102b-\u103e\u1040-\u1049\u1056-\u1059\u105e-\u1060\u1062-\u1064\u1067-\u106d\u1071-\u1074\u1082-\u108d\u108f-\u109d\u135d-\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b4-\u17d3\u17dd\u17e0-\u17e9\u180b-\u180d\u1810-\u1819\u18a9\u1920-\u192b\u1930-\u193b\u1946-\u194f\u19b0-\u19c0\u19c8\u19c9\u19d0-\u19d9\u1a17-\u1a1b\u1a55-\u1a5e\u1a60-\u1a7c\u1a7f-\u1a89\u1a90-\u1a99\u1b00-\u1b04\u1b34-\u1b44\u1b50-\u1b59\u1b6b-\u1b73\u1b80-\u1b82\u1ba1-\u1bad\u1bb0-\u1bb9\u1be6-\u1bf3\u1c24-\u1c37\u1c40-\u1c49\u1c50-\u1c59\u1cd0-\u1cd2\u1cd4-\u1ce8\u1ced\u1cf2-\u1cf4\u1dc0-\u1de6\u1dfc-\u1dff\u200c\u200d\u203f\u2040\u2054\u20d0-\u20dc\u20e1\u20e5-\u20f0\u2cef-\u2cf1\u2d7f\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua620-\ua629\ua66f\ua674-\ua67d\ua69f\ua6f0\ua6f1\ua802\ua806\ua80b\ua823-\ua827\ua880\ua881\ua8b4-\ua8c4\ua8d0-\ua8d9\ua8e0-\ua8f1\ua900-\ua909\ua926-\ua92d\ua947-\ua953\ua980-\ua983\ua9b3-\ua9c0\ua9d0-\ua9d9\uaa29-\uaa36\uaa43\uaa4c\uaa4d\uaa50-\uaa59\uaa7b\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uaaeb-\uaaef\uaaf5\uaaf6\uabe3-\uabea\uabec\uabed\uabf0-\uabf9\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\ufe33\ufe34\ufe4d-\ufe4f\uff10-\uff19\uff3f]*/gi);
  },
  evalInContext: function (js) {
    js = js.replace(/\s+/g, '');


    var keys = [], values = [];

    for (var i = 1; i < arguments.length; i++) {
      keys = keys.concat(Object.keys(arguments[i]));
      for (var j in arguments[i]) {
        values.push(arguments[i][j]);
      }
    }

    //
    //if(_.isCorrectVariableName(js) && keys.indexOf(js) === -1){
    //  keys.push(js);
    //  values.push(undefined);
    //}

    var arr = utils.extractVariables(js);
    //console.log(arr);
    for (var i in arr) {
      if (keys.indexOf(arr[i]) === -1) {
        keys.push(arr[i]);
        values.push(undefined);
      }
    }
    js = "var foo = function(" + keys.join(",") + "){ var __return__value = " + js + " ;return __return__value;}; foo;";
    try {
      var foo = eval(js);
      return foo.apply(this, values);
    } catch (e) {
      return undefined;
    }

  },
  compileElement: function ($item, scope) {

    function _eachSelf(el, selector, foo) {
      el.find(selector).each(foo);
      if (el.is(selector)) {
        foo.call(el[0]);
      }
    }

    //.addBack('selector')
    _eachSelf($item, "[onclick]", function () {
      var onClick = $(this).attr("onclick");
      $(this).removeAttr("onclick");
      $(this).click(function (event) {
        utils.evalInContext(onClick, scope, {event: event});
      })
    })


    _eachSelf($item, "[onchange]", function () {
      var onChange = $(this).attr("onchange");
      $(this).removeAttr("onchange");
      $(this).change(function (event) {
        utils.evalInContext(onChange, scope, {event: event});
      })
    });

    _eachSelf($item, "[dp-checked]", function () {
      var _val = $(this).attr("dp-checked");
      var val = utils.evalInContext(_val, scope);
      if (val) {
        $(this).attr("checked", "checked");
      } else {
        $(this).removeAttr("checked");
      }

    });
    _eachSelf($item, "[dp-src]", function () {
      var _val = $(this).attr("dp-src");
      var val = utils.evalInContext(_val, scope);
      if (val) {
        $(this).attr("src", val);
      }

    });
    _eachSelf($item, "[dp-if]", function () {
      var _val = $(this).attr("dp-if");
      if (_val === "false") {
        $(this).remove();
      }
      if (_val === "true") {

      } else {
        var val = utils.evalInContext(_val, scope);
        if (!val) {
          $(this).remove();
        }
      }
    });
    _eachSelf($item, "[dp-include]", function () {
      var _el = $(this);
      var _val = _el.attr("dp-include");
      var val = utils.evalInContext(_val, scope);
      _el.load(val);
    });
  },
  parseTemplate: function (tpl, scope) {
    var $item = $(tpl.format(scope));
    _.compileElement($item, scope);
    return $item;
  }
};
if(true){
  module.exports = utils;
}


/***/ }),
/* 6 */
/***/ (function(module, exports) {

module.exports = {
  resolve: function (path) {
    var chunks = path.split("/");
    var prev = 0;
    for (var i = chunks.length; i-- > 0;) {
      if (chunks[i] == "..") {
        prev++;
      } else {
        while (prev > 0) {
          chunks.splice(i, 1);
          chunks.splice(i--, 1);
          prev--;
        }
      }
    }
    return chunks.join("/");
  },
  getParentDirectoryUrl: function (url) {
    return url.substr(0, url.lastIndexOf("/") + 1);
  }
}


/***/ }),
/* 7 */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(fabric) {fabric.ImageMixin = {
  setElementFromMenu : function(data){
    this.setElement(data.image)
  },
  initProportinalSize : true,
  /**
   * @private
   * @param {Object} [options] Object with width/height properties
   */
  _setWidthHeight: function(options) {
    var _size = this.getOriginalSize();
    if('width' in options){
      this.width = options.width;
    }else{
      if(!_size.width){
        this.width = 0;
      }else{
        if(this.initProportinalSize && 'height' in options){
          this.width = (options.height  / _size.height ) * _size.width;
        } else {
          this.width = _size.width;
        }
      }
    }

    if('height' in options){
      this.height = options.height;
    }else{
      if(!_size.height){
        this.height = 0;
      }else{
        if(this.initProportinalSize && 'width' in options){
          this.height = (options.width  / _size.width ) * _size.height;
        } else {
          this.height = _size.height;
        }
      }
    }
  }
};

fabric.Application.prototype.getLibraryElements = function(options){
  return [];
}

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 8 */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(fabric) {// Magic Wand (Fuzzy Selection Tool) for Javascript
//
// The MIT License (MIT)
//
// Copyright (c) 2014, Ryasnoy Paul (ryasnoypaul@gmail.com)
//
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
//
// The above copyright notice and this permission notice shall be included in
// all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
// THE SOFTWARE.

var MagicWand = (function () {
  var lib = {};
  //var canvas = document.createElement("canvas");
  //var context = canvas.getContext("2d");

  function createCanvasElement(){
    if(typeof Canvas !== "undefined"){
      return new Canvas;
    }
    return document.createElement("canvas");
  }

  function SelectionMask(w,h,data){
    if(arguments.length == 1){
      for(var i in arguments[0] ){
        this[i] = arguments[0][i];
      }
    }else{
      this.data = new Uint8Array(data || w * h);
      this.width  = w;
      this.height = h;
      this.count  = 0;
      this.bounds = {
       minX: Infinity,
       minY: Infinity,
       maxY: -1,
       maxX: -1
      };
      // this.bounds = {
      //   minX: 0,
      //   minY: 0,
      //   maxY: h,
      //   maxX: w
      // };
    }
  }
  lib.SelectionMask = SelectionMask;


  SelectionMask.prototype.debug = function(){
    var canvas = document.createElement("canvas");
    canvas.width = this.width;
    canvas.height = this.height;
    var ctx = canvas.getContext('2d');
    this.render(ctx,{
      fill : "#fff",
      outerFill : "#000"
    });
    ctx.debug();
  };

  SelectionMask.prototype.makeCache = function(options ){
    this.cache = createCanvasElement();
    this.cache.width = this.bounds.maxX- this.bounds.minX + 1;
    this.cache.height = this.bounds.maxY- this.bounds.minY + 1;
    this.context = this.cache.getContext('2d');

    options = options || {}
    this.render(this.context,{
      fill : "#fff",
      outerFill : "#000",
      cache: false,
      left :-this.bounds.minX,
      top :-this.bounds.minY
    });

  };

  SelectionMask.prototype.add = function (mask) {
    var index, x, y;
    for (x = mask.bounds.minX; x <= mask.bounds.maxX; x++) {
      for (y = mask.bounds.minY; y <= mask.bounds.maxY; y++) {
        index = mask.width * y + x;
        if ( mask.data[index] && !this.data[index]){
          this.data[index] = 1;
          this.count++;
        }
      }
    }

    this.bounds.minX = Math.min(mask.bounds.minX, this.bounds.minX);
    this.bounds.maxX = Math.max(mask.bounds.maxX, this.bounds.maxX);
    this.bounds.minY = Math.min(mask.bounds.minY, this.bounds.minY);
    this.bounds.maxY = Math.max(mask.bounds.maxY, this.bounds.maxY);
  };
  function hexToRgb(hex) {
    // Expand shorthand form (e.g. "03F") to full form (e.g. "0033FF")
    var shorthandRegex = /^#?([a-f\d])([a-f\d])([a-f\d])$/i;
    hex = hex.replace(shorthandRegex, function(m, r, g, b) {
      return r + r + g + g + b + b;
    });

    var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
    return result ? {
      r: parseInt(result[1], 16),
      g: parseInt(result[2], 16),
      b: parseInt(result[3], 16)
    } : null;
  }

  SelectionMask.prototype.render = function(ctx,options ){
    if(!this.count)return;

    options             = options             || {};
    options.left        = options.left        || 0 ;
    options.top         = options.top         || 0 ;
    options.fill        = options.fill        || false ;// [0,0,0,0];
    options.intersectionColor = options.intersectionColor ||false ;//  [0,0,0,0];

    options.outerFill        = options.outerFill        || false ;// [0,0,0,0];
    options.outerIntersectionColor = options.outerIntersectionColor ||false ;//  [0,0,0,0];

    //if(this.cache && options.cache !== false){
    //
    //  var _ctx = this.context;
    //  _ctx.save();
    //  _ctx.globalCompositeOperation="source-in";
    //  _ctx.fillStyle= options.fill;
    //  _ctx.fillRect(0,0,this.cache.width,this.cache.height);
    //  _ctx.restore();
    //
    //  ctx.save();
    //  ctx.globalAlpha = options.opacity;
    //  ctx.drawImage(this.cache,this.bounds.minX,this.bounds.minY)
    //  ctx.restore();
    //  return;
    //}

    //todo do not use fabric here!
    function convertColor(color){
      if(color.constructor  == String ){
        if(color[0] == "#"){
          var _rgb = hexToRgb(color);
          return [_rgb.r,_rgb.g,_rgb.b,255];
        }
        color = new fabric.Color(color)._source;
        color[3] *= 255;
      }
      return color;
    }

    var _w = this.bounds.maxX - this.bounds.minX + 1;
    var _h = this.bounds.maxY - this.bounds.minY + 1;

    //var imgData = ctx.getImageData(options.left,options.top,_w,_h);
    var imgData = ctx.getImageData(this.bounds.minX,this.bounds.minY,_w,_h);

    var color  = convertColor(options.fill);
    var color2 = convertColor(options.intersectionColor);
    var color3 = convertColor(options.outerFill);
    var color4 = convertColor(options.outerIntersectionColor);

    for(var x = this.bounds.minX ; x <= this.bounds.maxX;x++ ){
      for(var y = this.bounds.minY ; y <= this.bounds.maxY; y++ ){
        var index = this.width * y + x;
        var index_small = _w * (y - (this.bounds.minY)) + x - (this.bounds.minX);

        if(this.data[index] ){
          var _color = imgData.data[index_small * 4 + 3]? color2 : color ;
          if(!_color)continue;

          imgData.data[index_small * 4 ]    = _color[0];
          imgData.data[index_small * 4 + 1] = _color[1];
          imgData.data[index_small * 4 + 2] = _color[2];
          imgData.data[index_small * 4 + 3] = _color[3];
        }else{
          var _color = imgData.data[index_small * 4 + 3]? color4 : color3 ;
          if(!_color)continue;

          imgData.data[index_small * 4 ]    = _color[0];
          imgData.data[index_small * 4 + 1] = _color[1];
          imgData.data[index_small * 4 + 2] = _color[2];
          imgData.data[index_small * 4 + 3] = _color[3];
        }
      }
    }

    // ctx.putImageData(imgData, options.left  , options.top  );
    ctx.putImageData(imgData, this.bounds.minX,this.bounds.minY  );
  };


  /**
   * get array with begin and end indices of filled 1 intervals
   * @param ctx
   * @param options
   * @returns {Array}
   */
  SelectionMask.prototype.getIntervalsArray = function (ctx, options) {
    var _newData = [];
    for (var i = 0, _val = 0; i < array.length; i++) {
      if (_val != array[i]) {
        _newData.push(i);
        _val = array[i];
      }
    }
    return _newData;
  };

  SelectionMask.prototype.renderBorder = function (ctx, options) {

    options             = options             || {};
    options.left        = options.left        || 0 ;
    options.top         = options.top         || 0 ;
    options.hatchOffset = options.hatchOffset || 0 ;
    options.hatchLength = options.hatchLength || 4 ;
    options.opacity = options.opacity || 1 ;

    var imgData = ctx.getImageData(0,0,this.width,this.height);

    if(!this.cacheInd){
      this.cacheInd = MagicWand.getBorderIndices(this);
    }

    var x, y, i, j, k,
      w = imgData.width,
      h = imgData.height;
    var res = imgData.data;

    var len = this.cacheInd.length;
    for (j = 0; j < len; j++) {
      i = this.cacheInd[j];
      x = i % w; // calc x by index
      y = (i - x) / w; // calc y by index
      k = (y * w + x) * 4;

      if ((x + y + options.hatchOffset) % (options.hatchLength * 2) < options.hatchLength) { // detect hatch color

        res[k] = 0;
        res[k + 1] = 0;
        res[k + 2] = 0;
        res[k + 3] = 255; // black, change only alpha
      } else {
        res[k] = 255; // white
        res[k + 1] = 255;
        res[k + 2] = 255;
        res[k + 3] = 255;
      }
    }
    ctx.save();
    ctx.globalAlpha = options.opacity;
    ctx.putImageData(imgData, options.left || 0 , options.top || 0 );
    ctx.restore();
  };


  lib.createMask = function (w, h,data) {
    return new SelectionMask(w,h,data);
  };

  lib.difference = function (a, b) {
    return Math.max(
      b[0] !== false ? Math.abs(b[0] - a[0]): 0,
      b[1] !== false ? Math.abs(b[1] - a[1]): 0,
      b[2] !== false ? Math.abs(b[2] - a[2]): 0,
      b[3] !== false ? Math.abs(b[3] - a[3]): 0);
  };

  lib.acceptable = function (x, y, image, visited, sampleColor, colorThreshold) {
// check whether the point has been visited
    if (visited[y * image.width + x] === 1) {
      return false;
    }
    var i = (y * image.width + x) * lib.bytes,
      color2 = [image.data[i], image.data[i + 1], image.data[i + 2], image.data[i + 3]];


    if (sampleColor[0] !== false && Math.abs(sampleColor[0] - color2[0]) > colorThreshold)return false;
    if (sampleColor[1] !== false && Math.abs(sampleColor[1] - color2[1]) > colorThreshold)return false;
    if (sampleColor[2] !== false && Math.abs(sampleColor[2] - color2[2]) >colorThreshold)return false;
    if (sampleColor[3] !== false && Math.abs(sampleColor[3] - color2[3]) > colorThreshold)return false;
    return true;
  };

  lib.selectAll = function (image, px, py, colorThreshold) {
    var i = (py * image.width + px) * lib.bytes,
      data = image.data,
      sampleColor = [data[i], data[i + 1], data[i + 2], data[i + 3]]; // start point color (sample)
    return lib.selectAllByColor(image, sampleColor, colorThreshold)
  };


  /**
   * Converts an RGB color value to HSL. Conversion formula
   * adapted from http://en.wikipedia.org/wiki/HSL_color_space.
   * Assumes r, g, and b are contained in the set [0, 255] and
   * returns h, s, and l in the set [0, 1].
   *
   * @param   Number  r       The red color value
   * @param   Number  g       The green color value
   * @param   Number  b       The blue color value
   * @return  Array           The HSL representation
   */
  lib.rgbToHsl = function(r, g, b){
    r /= 255, g /= 255, b /= 255;
    var max = Math.max(r, g, b), min = Math.min(r, g, b);
    var h, s, l = (max + min) / 2;

    if(max == min){
      h = s = 0; // achromatic
    }else{
      var d = max - min;
      s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
      switch(max){
        case r: h = (g - b) / d + (g < b ? 6 : 0); break;
        case g: h = (b - r) / d + 2; break;
        case b: h = (r - g) / d + 4; break;
      }
      h /= 6;
    }

    return [h, s, l];
  }

  lib.selectColored = function (image, options) {

    var mask = new SelectionMask(image.width, image.height);

    mask.bounds = {
      minX: image.width,
      minY: image.height,
      maxY: -1,
      maxX: -1
    };

    var x, y;
    for (y = 0; y < image.height; y++) {
      for (x = 0; x < image.width; x++) {
        var index = (y * image.width + x);
        var i = index * lib.bytes;
        //if (!image.data[i + 3]) continue;


        if (options.aMin && image.data[i + 3] < options.aMin)continue;

        var hsl = rgbToHsl(image.data[i], image.data[i + 1], image.data[i + 2]);


        if (options.sMin && hsl[1] < options.sMin)continue;
        if (options.sMax && hsl[1] > options.sMax)continue;
        if (options.bMin && hsl[2] < options.bMin)continue;
        if (options.bMax && hsl[2] > options.bMax)continue;


        mask.data[index] = 1;
        mask.count++;
        mask.bounds.minX = Math.min(mask.bounds.minX, x);
        mask.bounds.maxX = Math.max(mask.bounds.maxX, x);
        mask.bounds.minY = Math.min(mask.bounds.minY, y);
        mask.bounds.maxY = Math.max(mask.bounds.maxY, y);

      }
    }
    return mask;
  };




  lib.selectAllByColor = function (ctx, sampleColor, colorThreshold) {
    var image = _getImageData(ctx);

    var mask = new SelectionMask(image.width, image.height);

    mask.bounds = {
      minX: Infinity,
      minY: Infinity,
      maxY: -1,
      maxX: -1
    };


    var visited = new Uint8Array( image.width * image.height);
    var x, y;
    for (y = 0; y < image.height; y++) {
      for (x = 0; x < image.width; x++) {
        if(lib.acceptable(x, y, image, mask.data, sampleColor, colorThreshold)){
          MagicWand.floodFill(image, x, y, colorThreshold, {
            sampleColor:    sampleColor,
            activeMask :    mask,
            visitedPoints : visited
          });
        }
      }
    }
    return mask;
  };



  lib.drawImage = function (ctx,canvas, mask ,left, top) {

    var ctx2 = canvas.getContext('2d');


    var imgData = ctx.getImageData(0, 0, mask.width, mask.height);
    var imgDataOriginal = ctx2.getImageData(left, top, mask.width, mask.height);


    var b = mask.bounds;
    for (var x = b.minX; x <= b.maxX; x++)for (var y = b.minY; y <= b.maxY; y++) {
      var i = (y * mask.width + x);// * bytes; // point index in the image data
      if (mask.data[i]) {
        imgData.data[i * 4]     = imgDataOriginal.data[i * 4];
        imgData.data[i * 4 + 1] = imgDataOriginal.data[i * 4 + 1];
        imgData.data[i * 4 + 2] = imgDataOriginal.data[i * 4 + 2];
        imgData.data[i * 4 + 3] = imgDataOriginal.data[i * 4 + 3];
      }
    }
    ctx.putImageData(imgData,0, 0);
  };

  function _getImageData(ctx){
    if(ctx.constructor.name == "ImageData"){
      return ctx;
    }else{
      return ctx.getImageData(0, 0, ctx.canvas.width, ctx.canvas.height);
    }
  }

  lib.fillMask = function (ctx,mask, color) {
    var imgData = _getImageData(ctx);
    var b = mask.bounds;
    var w = imgData.width,
      h = imgData.height;

    for (var x = b.minX; x <= b.maxX; x++)for (var y = b.minY; y <= b.maxY; y++) {
      var i = (y * w + x);// * bytes; // point index in the image data
      if (mask.data[i]) {
        imgData.data[i * 4]     = color[0];
        imgData.data[i * 4 + 1] = color[1];
        imgData.data[i * 4 + 2] = color[2];
        imgData.data[i * 4 + 3] = color[3];
      }
    }
    if(ctx.constructor.name != "ImageData") {
      ctx.clearRect(0, 0, w, h);
      ctx.putImageData(imgData, 0, 0);
    }
  };

  lib.selectBackground = function (ctx, sampleColor, colorThreshold) {
    var image = _getImageData(ctx);

    colorThreshold = colorThreshold || 15;

    var mask = new SelectionMask(image.width, image.height);
    mask.bounds = {
      minX: Infinity,
      minY: Infinity,
      maxY: -1,
      maxX: -1
    };

    var data = image.data;

    sampleColor = sampleColor ||[data[0], data[1], data[2], data[3]]; // start point color (sample)

    var color = sampleColor;

    function add(x, y) {
      if (!lib.acceptable(x, y, image, mask.data, sampleColor, colorThreshold))return;
      if (!sampleColor) {
        var index = (y * image.width + x) * 4;
        color = [data[index], data[index + 1], data[index + 2], data[index + 3]];
      }
      var mask2 = MagicWand.floodFill(image, x, y, colorThreshold, null, color);
      mask = MagicWand.add(mask, mask2);
    }

    var x, y;

    for (x = 0; x < image.width; x++) {
      add(x, 0);
    }
    for (x = 0; x < image.width; x++) {
      add(x, image.height - 1);
    }
    for (y = 0; y < image.height; y++) {
      add(image.width - 1, y);
    }
    for (y = 0; y < image.height; y++) {
      add(0, y);
    }
    return mask;

  };

  lib.extractColors = function(mixedType,threshold) {
    threshold= threshold || 60;
    var imgData = lib.getImageData(mixedType);
    var _colors = [];
    var c1;
    for(var x = 1; x <imgData.width;x+=3){
      for(var y = 1; y <imgData.height;y+=3) {
        var iii = (x + y * imgData.width) * 4;
        var iiA = (x - 1 + y * imgData.width) * 4;
        var iiB = (x + 1 + y * imgData.width) * 4;
        var iiC = (x - 1 + (y + 1) * imgData.width) * 4;
        var iiD = (x + 1 + (y + 1) * imgData.width) * 4;
        if(imgData.data[iii + 3] < 255)continue;

        c1 = [ imgData.data[iii], imgData.data[iii + 1], imgData.data[iii + 2]];
        var cA = [ imgData.data[iiA], imgData.data[iiA + 1], imgData.data[iiA + 2]];
        var cB = [ imgData.data[iiB], imgData.data[iiB + 1], imgData.data[iiB + 2]];
        var cC = [ imgData.data[iiC], imgData.data[iiC + 1], imgData.data[iiC + 2]];
        var cD = [ imgData.data[iiD], imgData.data[iiD + 1], imgData.data[iiD + 2]];

        if(
          c1[0] != cA[0] || cA[0] != cB[0] || cB[0] != cC[0] || cC[0] != cD[0] ||
          c1[1] != cA[1] || cA[1] != cB[1] || cB[1] != cC[1] || cC[1] != cD[1] ||
          c1[2] != cA[2] || cA[2] != cB[2] || cB[2] != cC[2] || cC[2] != cD[2]
        ){
          continue;
        }

        var isNewColor = true;

        for(var i in _colors){
          if(MagicWand.difference(_colors[i], c1) < threshold){
            isNewColor = false;
            break;
          }
        }
        if(isNewColor){
          _colors.push(c1);
        }
      }
    }
    return _colors;
  };

  /**
   * image
   * canvas - черно блое изображение.
   *
   * mask- предыдущая маска. на нее будет накладывать новая
   * mode - способ наложения.
   */
  lib.maskSelection = function ( canvas, left, top, mask ,mode) {
    left = left || 0;
    top = top || 0;
    if(canvas.constructor.name == "HTMLImageElement"){

      var __canvas = createCanvasElement();
      __canvas.width = canvas.width;
      __canvas.height = canvas.height;
      var __ctx = __canvas.getContext('2d');
      __ctx.drawImage(canvas, 0, 0);
      canvas = __canvas;
    }


    var ctx = canvas.getContext('2d'),
      imgData = ctx.getImageData(0, 0, canvas.width, canvas.height),
      mask = mask || MagicWand.createMask(canvas.width, canvas.height);

    var _x1 = Math.max(0, - left),
      _y1 = Math.max(0, - top),
      _x2 = Math.min(mask.width - left,canvas.width);
    _y2 = Math.min(mask.height - top,canvas.height);

    for (var x = _x1; x < _x2; x++) {
      for (var y = _y1; y < _y2; y++) {
        var index = (canvas.width * y + x) * 4;

        if (imgData.data[index] > 20) {
          var index2 = mask.width * (y + top) + x + left;
          mask.data[index2] = 1;
          mask.count++;
        }
      }
    }
    return mask;
  },
  lib.selectRectangle = function (image, x1, y1, x2, y2) {

      var mask = new SelectionMask(image.width, image.height);
      var minX = Math.min(x1, x2);
      var maxX = Math.max(x1, x2);
      var minY = Math.min(y1, y2);
      var maxY = Math.max(y1, y2);

      var w = image.width, h = image.height;

      var data = image.data;
      for (var y = minY; y <= maxY; y++) {
        for (var x = minX; x <= maxX; x++) {
          if (data[(y * w + x) * 4 + 3]) {
            mask.data[y * w + x] = 1;
            mask.count++;
          }
        }
      }

      mask.bounds = {
        minX: minX,
        minY: minY,
        maxX: maxX,
        maxY: maxY
      };

      return mask;
    };

  lib.bytes = 4;






  lib.__floodFill = function (e,postMessage) {

    data = e.data;
    var image = data[0], px = data[1], py = data[2], colorThreshold = data[3], options = data[4];

    options = options || {};
    /*{
     visitedPointsArray,
     sampleColor,
     resultMask
     }*/

    var c, x, newY, el, xr, xl, dy, dyl, dyr, checkY,
      data = image.data, w = image.width, h = image.height, bytes = lib.bytes,
      i = py * w + px; // start point index in the mask data
    i = i * bytes; // start point index in the image data

    var visited     = options.visitedPoints || new Uint8Array( w * h), // mask of visited points
      sampleColor = options.sampleColor   || [data[i], data[i + 1], data[i + 2], data[i + 3]], // start point color (sample)
      result      = options.activeMask;

    function acceptable(x, y) {
// check whether the point has been visited
      if (visited[y * image.width + x] === 1) {
        return false;
      }
      var i = (y * image.width + x) * lib.bytes,
        color2 = [image.data[i], image.data[i + 1], image.data[i + 2], image.data[i + 3]];
      if (sampleColor[0] !== false && Math.abs(sampleColor[0] - color2[0]) > colorThreshold)return false;
      if (sampleColor[1] !== false && Math.abs(sampleColor[1] - color2[1]) > colorThreshold)return false;
      if (sampleColor[2] !== false && Math.abs(sampleColor[2] - color2[2]) > colorThreshold)return false;
      if (sampleColor[3] !== false && Math.abs(sampleColor[3] - color2[3]) > colorThreshold)return false;
      return true;
    };



    if (visited[i] === 1) return null;


    var first = true;
    var stack = [{y: py, left: px - 1, right: px + 1, dir: 1}]; // first scanning line

    var mode = 'strict';
    var _ci;
    do {
      el = stack.shift(); // get line for scanning

      checkY = false;
      for (x = el.left + 1; x < el.right; x++) {
        dy = el.y * w;

        if(mode == 'gradient' && !first) {
          _ci = (dy + x + (el.dir == -1 ? w: - w))*4;
          sampleColor = [data[_ci],data[_ci+1],data[_ci+2],data[_ci+3]];
        }
        if (!acceptable(x, el.y, image, visited, sampleColor, colorThreshold))continue;

        first = false;

        checkY = true; // if the color of the new point(x,y) is similar to the sample color need to check minmax for Y

        result.count++;

        result.data[dy + x] = 1; // mark a new point in mask
        visited[dy + x] = 1; // mark a new point as visited

        xl = x - 1;
        // walk to left side starting with the left neighbor
        while (xl > -1) {
          dyl = dy + xl;

          if(mode == 'gradient') {
            _ci = (dyl + 1)*4;
            sampleColor = [data[_ci], data[_ci + 1], data[_ci + 2], data[_ci + 3]];
          }
          if (!acceptable(xl, el.y, image, visited, sampleColor, colorThreshold)) break;

          result.count++;
          result.data[dyl] = 1;
          visited[dyl] = 1;

          xl--;
        }
        xr = x + 1;
        // walk to right side starting with the right neighbor
        while (xr < w) {
          dyr = dy + xr;

          if(mode == 'gradient') {
            _ci = (dyr - 1)*4;
            sampleColor = [data[_ci], data[_ci + 1], data[_ci + 2], data[_ci + 3]];
          }
          if (!acceptable(xr, el.y, image, visited, sampleColor, colorThreshold)){
            break;
          }

          result.count++;
          result.data[dyr] = 1;
          visited[dyr] = 1;
          xr++;
        }

        // check minmax for X
        if (xl < result.bounds.minX) result.bounds.minX = xl + 1;
        if (xr > result.bounds.maxX) result.bounds.maxX = xr - 1;

        newY = el.y - el.dir;
        if (newY >= 0 && newY < h) {
          if (xl < xr) stack.push({y: newY, left: xl, right: xr, dir: -el.dir}); // from "new left" to "new right"
          // add two scanning lines in the opposite direction (y - dir) if necessary
          // if (xl <= el.left) stack.push({y: newY, left: xl, right: el.left, dir: -el.dir}); // from "new left" to "current left"
          // if (el.right <= xr) stack.push({y: newY, left: el.right, right: xr, dir: -el.dir}); // from "current right" to "new right"
        }
        newY = el.y + el.dir;
        if (newY >= 0 && newY < h) { // add the scanning line in the direction (y + dir) if necessary
          if (xl < xr) stack.push({y: newY, left: xl, right: xr, dir: el.dir}); // from "new left" to "new right"
        }
      }
      // check minmax for Y if necessary
      if (checkY) {
        if (el.y < result.bounds.minY) result.bounds.minY = el.y;
        if (el.y > result.bounds.maxY) result.bounds.maxY = el.y;
      }
    } while (stack.length > 0);

    postMessage && postMessage(result);
    return result;
  };

  lib.extendMask = function (mask, value) {

    var mask2 = new SelectionMask(mask.width + 2, mask.height + 2);
    if(value){
      mask2.data.fill(value);
    }

    for(var y = 0;y < mask.height ; y++){
      for(var x = 0;x < mask.width ; x++){
        mask2.data[ (y + 1) * mask2.width + x + 1 ] = mask.data[y * mask.width + x ];
      }
    }
    mask2.count  = mask.count;

    if(!value) {
      mask2.bounds = {
        minX: mask.bounds.minX + 1,
        maxX: mask.bounds.maxX + 1,
        maxY: mask.bounds.maxY + 1,
        minY: mask.bounds.minY + 1
      };
    }else{
      mask2.bounds = mask.bounds;
    }

    return mask2;
  };

  /** Create a binary mask on the image by color threshold
   * Algorithm: Scanline flood fill (http://en.wikipedia.org/wiki/Flood_fill)
   * @param {Object} image: {Uint8Array} data, {int} width, {int} height, {int} bytes
   * @param {int} x of start pixel
   * @param {int} y of start pixel
   * @param {int} color threshold
   * @param {Uint8Array} mask of visited points (optional)
   * @return {Object} mask: {Uint8Array} data, {int} width, {int} height, {Object} bounds
   */
  lib.floodFill = function (image, px, py, colorThreshold, options,color,callback) {
    options = options || {};
    options.activeMask = options.activeMask  || new SelectionMask(image.width, image.height);

    return lib.__floodFill({data: [image, px, py, colorThreshold, options, color]},callback);

    /*
    var worker = _.worker(lib.__floodFill);
    worker.onmessage = function(e){
      var mask = new SelectionMask(e.data);
      callback && callback(mask);
    };
    worker.postMessage([image, px, py, colorThreshold, options]);
*/

  };

  lib.substract = function (mask, mask2) {
    var minX, maxX, minY, maxY;

    var result = new SelectionMask(mask.width, mask.height);
    var bounds = mask2.bounds;

    var minX = false, minY = mask.height, maxX = false, maxY = -1;

    for (var x = bounds.minX; x <= bounds.maxX; x++) {
      for (var y = bounds.minY; y <= bounds.maxY; y++) {
        var index = mask.width * y + x;

        if (!mask.data[index] && mask2.data[index]) {
          result.data[index] = 1;
          result.count++;
          if (result.bounds.minY > y)result.bounds.minY = y;
          if (result.bounds.maxY < y)result.bounds.maxY = y;
          if (result.bounds.minX > x)result.bounds.minX = x;
          if (result.bounds.maxX < x)result.bounds.maxX = x;
        }
      }
    }

    return result;
  }

  lib.getImageData  = function(mixedType){
    var canvas;
    if (mixedType.constructor.name == "Image" || mixedType.constructor.name == "HTMLImageElement") {
      var _canvas = createCanvasElement();
      _canvas.width = mixedType.width;
      _canvas.height = mixedType.height;
      var ctx = _canvas.getContext("2d");
      ctx.drawImage(mixedType, 0, 0);
      canvas = _canvas;
    }else{
      canvas = mixedType;
    }
    if (canvas.constructor.name == "HTMLCanvasElement" || canvas.constructor.name == "Canvas") {
      var imgData = canvas.getContext("2d").getImageData(0, 0, canvas.width, canvas.height);
    }else{
      imgData = mixedType;
    }
    return imgData;
  };

  lib.getColoredPixels = function (mixedType) {
    var imgData = lib.getImageData(mixedType);
    var data = imgData.data;
    var pixels = 0;
    for (var i = 3; i < data.length; i += 4) {
      if (data[i]) {
        pixels+= data[i] / 255;
      }
    }
    return pixels;
  };

  lib.invertMask = function (mask) {
    var result = new SelectionMask(mask.width, mask.height);
    result.bounds = {
      minX: Infinity,
      minY: Infinity,
      maxY: -1,
      maxX: -1
    };


    for (var x = 0; x < mask.width; x++) {
      for (var y = 0; y < mask.height; y++) {
        var index = mask.width * y + x;
        if (!mask.data[index]) {
          result.data[index] = 1;
          result.count++;
          if (result.bounds.minY > y)result.bounds.minY = y;
          if (result.bounds.maxY < y)result.bounds.maxY = y;
          if (result.bounds.minX > x)result.bounds.minX = x;
          if (result.bounds.maxX < x)result.bounds.maxX = x;
        }
      }
    }
    return result;
  };

  lib.exclude = function (mask, mask2) {
    var result = new SelectionMask(mask.width, mask.height);
    var bounds = {
      minX: Math.min(mask.bounds.minX, mask2.bounds.minX),
      maxX: Math.max(mask.bounds.maxX, mask2.bounds.maxX),
      minY: Math.min(mask.bounds.minY, mask2.bounds.minY),
      maxY: Math.max(mask.bounds.maxY, mask2.bounds.maxY)
    };

    var minX = false, minY = mask.height, maxX = false, maxY = -1;

    for (var x = bounds.minX; x <= bounds.maxX; x++) {
      for (var y = bounds.minY; y <= bounds.maxY; y++) {
        var index = mask2.width * y + x;

        if (mask.data[index] ^ mask2.data[index]) {
          result.data[index] = 1;
          result.count++;
          maxX = x;
          if (minY > y)minY = y;
          if (maxY < y)maxY = y;
          if (minX === false) {
            minX = x;
          }
        }
      }
    }

    result.bounds = {
      minX: minX,
      maxX: maxX,
      minY: minY,
      maxY: maxY
    }

    return result;
  };

  lib.intersect = function (mask, mask2) {
    var minX, maxX, minY, maxY;

    var result = new SelectionMask(mask.width, mask.height);
    var bounds = {
      minX: Math.max(mask.bounds.minX, mask2.bounds.minX),
      maxX: Math.min(mask.bounds.maxX, mask2.bounds.maxX),
      minY: Math.max(mask.bounds.minY, mask2.bounds.minY),
      maxY: Math.min(mask.bounds.maxY, mask2.bounds.maxY)
    };

    var minX = false, minY = mask.height, maxX = false, maxY = -1;

    for (var x = bounds.minX; x <= bounds.maxX; x++) {
      for (var y = bounds.minY; y <= bounds.maxY; y++) {
        var index = mask2.width * y + x;

        if (mask.data[index] && mask2.data[index]) {
          result.data[index] = 1;
          result.count++;
          maxX = x;
          if (minY > y)minY = y;
          if (maxY < y)maxY = y;
          if (minX === false) {
            minX = x;
          }
        }
      }
    }

    result.bounds = {
      minX: minX,
      maxX: maxX,
      minY: minY,
      maxY: maxY
    }

    return result;
  };

  lib.add = function (mask, mask2) {
    var result = new SelectionMask(mask.width, mask.height);

    result.bounds = {
      minX: Math.min(mask.bounds.minX, mask2.bounds.minX),
      maxX: Math.max(mask.bounds.maxX, mask2.bounds.maxX),
      minY: Math.min(mask.bounds.minY, mask2.bounds.minY),
      maxY: Math.max(mask.bounds.maxY, mask2.bounds.maxY)
    };

    for (var x = result.bounds.minX; x <= result.bounds.maxX; x++) {
      for (var y = result.bounds.minY; y <= result.bounds.maxY; y++) {
        var index = mask2.width * y + x;

        if (mask.data[index] || mask2.data[index]) {
          result.data[index] = 1;
          result.count++;
        }
      }
    }

    return result;
  };

  /** Apply the gauss-blur filter to binary mask
   * Algorithms: http://blog.ivank.net/fastest-gaussian-blur.html
   * http://www.librow.com/articles/article-9
   * http://elynxsdk.free.fr/ext-docs/Blur/Fast_box_blur.pdf
   * @param {Object} mask: {Uint8Array} data, {int} width, {int} height, {Object} bounds
   * @param {int} blur radius
   * @return {Object} mask: {Uint8Array} data, {int} width, {int} height, {Object} bounds
   */
  lib.gaussBlur = function (mask, radius) {

    var i, k, k1, x, y, val, start, end,
      n = radius * 2 + 1, // size of the pattern for radius-neighbors (from -r to +r with the center point)
      s2 = radius * radius,
      wg = new Float32Array(n), // weights
      total = 0, // sum of weights(used for normalization)
      w = mask.width,
      h = mask.height,
      data = mask.data,
      minX = mask.bounds.minX,
      maxX = mask.bounds.maxX,
      minY = mask.bounds.minY,
      maxY = mask.bounds.maxY,
      count = 0;

    // calc gauss weights
    for (i = 0; i < radius; i++) {
      var dsq = (radius - i) * (radius - i);
      var ww = Math.exp(-dsq / (2.0 * s2)) / (2 * Math.PI * s2);
      wg[radius + i] = wg[radius - i] = ww;
      total += 2 * ww;
    }
    // normalization weights
    for (i = 0; i < n; i++) {
      wg[i] /= total;
    }

    var result = new Uint8Array(w * h), // result mask
      endX = radius + w,
      endY = radius + h;

    //walk through all source points for blur
    for (y = minY; y < maxY + 1; y++)
      for (x = minX; x < maxX + 1; x++) {
        val = 0;
        k = y * w + x; // index of the point
        start = radius - x > 0 ? radius - x : 0;
        end = endX - x < n ? endX - x : n; // Math.min((((w - 1) - x) + radius) + 1, n);
        k1 = k - radius;
        // walk through x-neighbors
        for (i = start; i < end; i++) {
          val += data[k1 + i] * wg[i];
        }
        start = radius - y > 0 ? radius - y : 0;
        end = endY - y < n ? endY - y : n; // Math.min((((h - 1) - y) + radius) + 1, n);
        k1 = k - radius * w;
        // walk through y-neighbors
        for (i = start; i < end; i++) {
          val += data[k1 + i * w] * wg[i];
        }
        if (val > 0.5) {
          result[k] = 1;
          count++;
        } else {
          result[k] = 0;
        }
      }

    return {
      count: count,
      data: result,
      width: w,
      height: h,
      bounds: {
        minX: minX,
        minY: minY,
        maxX: maxX,
        maxY: maxY
      }
    };
  };

  /** Create a border index array of boundary points of the mask with radius-neighbors
   * @param {Object} mask: {Uint8Array} data, {int} width, {int} height, {Object} bounds
   * @param {int} radius: blur radius
   * @param {Uint8Array} visited: mask of visited points (optional)
   * @return {Array} border index array of boundary points with radius-neighbors (only points need for blur)
   */
  function createBorderForBlur(mask, radius, visited) {

    var x, i, j, y, k, k1, k2,
      w = mask.width,
      h = mask.height,
      data = mask.data,
      visitedData = new Uint8Array(data),
      minX = mask.bounds.minX,
      maxX = mask.bounds.maxX,
      minY = mask.bounds.minY,
      maxY = mask.bounds.maxY,
      len = w * h,
      temp = new Uint8Array(len), // auxiliary array to check uniqueness
      border = [], // only border points
      x0 = Math.max(minX, 1),
      x1 = Math.min(maxX, w - 2),
      y0 = Math.max(minY, 1),
      y1 = Math.min(maxY, h - 2);

    if (visited && visited.length > 0) {
      // copy visited points (only "black")
      for (k = 0; k < len; k++) {
        if (visited[k] === 1) visitedData[k] = 1;
      }
    }

    // walk through inner values except points on the boundary of the image
    for (y = y0; y < y1 + 1; y++)
      for (x = x0; x < x1 + 1; x++) {
        k = y * w + x;
        if (data[k] === 0) continue; // "white" point isn't the border
        k1 = k + w; // y + 1
        k2 = k - w; // y - 1
        // check if any neighbor with a "white" color
        if (visitedData[k + 1] === 0 || visitedData[k - 1] === 0 ||
          visitedData[k1] === 0 || visitedData[k1 + 1] === 0 || visitedData[k1 - 1] === 0 ||
          visitedData[k2] === 0 || visitedData[k2 + 1] === 0 || visitedData[k2 - 1] === 0) {
          //if (visitedData[k + 1] + visitedData[k - 1] +
          //    visitedData[k1] + visitedData[k1 + 1] + visitedData[k1 - 1] +
          //    visitedData[k2] + visitedData[k2 + 1] + visitedData[k2 - 1] == 8) continue;
          border.push(k);
        }
      }

    // walk through points on the boundary of the image if necessary
    // if the "black" point is adjacent to the boundary of the image, it is a border point
    if (minX == 0)
      for (y = minY; y < maxY + 1; y++)
        if (data[y * w] === 1)
          border.push(y * w);

    if (maxX == w - 1)
      for (y = minY; y < maxY + 1; y++)
        if (data[y * w + maxX] === 1)
          border.push(y * w + maxX);

    if (minY == 0)
      for (x = minX; x < maxX + 1; x++)
        if (data[x] === 1)
          border.push(x);

    if (maxY == h - 1)
      for (x = minX; x < maxX + 1; x++)
        if (data[maxY * w + x] === 1)
          border.push(maxY * w + x);

    var result = [], // border points with radius-neighbors
      start, end,
      endX = radius + w,
      endY = radius + h,
      n = radius * 2 + 1; // size of the pattern for radius-neighbors (from -r to +r with the center point)

    len = border.length;
    // walk through radius-neighbors of border points and add them to the result array
    for (j = 0; j < len; j++) {
      k = border[j]; // index of the border point
      temp[k] = 1; // mark border point
      result.push(k); // save the border point
      x = k % w; // calc x by index
      y = (k - x) / w; // calc y by index
      start = radius - x > 0 ? radius - x : 0;
      end = endX - x < n ? endX - x : n; // Math.min((((w - 1) - x) + radius) + 1, n);
      k1 = k - radius;
      // walk through x-neighbors
      for (i = start; i < end; i++) {
        k2 = k1 + i;
        if (temp[k2] === 0) { // check the uniqueness
          temp[k2] = 1;
          result.push(k2);
        }
      }
      start = radius - y > 0 ? radius - y : 0;
      end = endY - y < n ? endY - y : n; // Math.min((((h - 1) - y) + radius) + 1, n);
      k1 = k - radius * w;
      // walk through y-neighbors
      for (i = start; i < end; i++) {
        k2 = k1 + i * w;
        if (temp[k2] === 0) { // check the uniqueness
          temp[k2] = 1;
          result.push(k2);
        }
      }
    }

    return result;
  };

  /** Apply the gauss-blur filter ONLY to border points with radius-neighbors
   * Algorithms: http://blog.ivank.net/fastest-gaussian-blur.html
   * http://www.librow.com/articles/article-9
   * http://elynxsdk.free.fr/ext-docs/Blur/Fast_box_blur.pdf
   * @param  {Object}     mask:     {Uint8Array} data, {int} width, {int} height, {Object} bounds
   * @param  {int}        radius:   blur radius
   * @param  {Uint8Array} visited:  mask of visited points (optional)
   * @return {Object}     mask:     {Uint8Array} data, {int} width, {int} height, {Object} bounds
   */
  lib.gaussBlurOnlyBorder = function (mask, radius, visited) {

    var border = createBorderForBlur(mask, radius, visited), // get border points with radius-neighbors
      ww, dsq, i, j, k, k1, x, y, val, start, end,
      n = radius * 2 + 1, // size of the pattern for radius-neighbors (from -r to +r with center point)
      s2 = 2 * radius * radius,
      wg = new Float32Array(n), // weights
      total = 0, // sum of weights(used for normalization)
      w = mask.width,
      h = mask.height,
      data = mask.data,
      minX = mask.bounds.minX,
      maxX = mask.bounds.maxX,
      minY = mask.bounds.minY,
      maxY = mask.bounds.maxY,
      len = border.length;

    // calc gauss weights
    for (i = 0; i < radius; i++) {
      dsq = (radius - i) * (radius - i);
      ww = Math.exp(-dsq / s2) / Math.PI;
      wg[radius + i] = wg[radius - i] = ww;
      total += 2 * ww;
    }
    // normalization weights
    for (i = 0; i < n; i++) {
      wg[i] /= total;
    }

    var result = new SelectionMask(w,h,data), // copy the source mask
      endX = radius + w,
      endY = radius + h;

    //walk through all border points for blur
    for (i = 0; i < len; i++) {
      k = border[i]; // index of the border point
      val = 0;
      x = k % w; // calc x by index
      y = (k - x) / w; // calc y by index
      start = radius - x > 0 ? radius - x : 0;
      end = endX - x < n ? endX - x : n; // Math.min((((w - 1) - x) + radius) + 1, n);
      k1 = k - radius;
      // walk through x-neighbors
      for (j = start; j < end; j++) {
        val += data[k1 + j] * wg[j];
      }
      if (val > 0.5) {
        result.data[k] = 1;
        result.count++;
        // check minmax
        if (x < minX) minX = x;
        if (x > maxX) maxX = x;
        if (y < minY) minY = y;
        if (y > maxY) maxY = y;
        continue;
      }
      start = radius - y > 0 ? radius - y : 0;
      end = endY - y < n ? endY - y : n; // Math.min((((h - 1) - y) + radius) + 1, n);
      k1 = k - radius * w;
      // walk through y-neighbors
      for (j = start; j < end; j++) {
        val += data[k1 + j * w] * wg[j];
      }
      if (val > 0.5) {
        result.data[k] = 1;
        result.count++;
        // check minmax
        if (x < minX) minX = x;
        if (x > maxX) maxX = x;
        if (y < minY) minY = y;
        if (y > maxY) maxY = y;
      } else {
        result.data[k] = 0;
      }
    }
    result.bounds = {
      minX: minX,
      minY: minY,
      maxX: maxX,
      maxY: maxY
    };

    return result;
  };

  /** Create a border mask (only boundary points)
   * @param {Object} mask: {Uint8Array} data, {int} width, {int} height, {Object} bounds
   * @return {Object} border mask: {Uint8Array} data, {int} width, {int} height, {Object} offset
   */
  lib.createBorderMask = function (mask) {

    var x, y, k, k1, k2,
      w = mask.width,
      h = mask.height,
      data = mask.data,
      minX = mask.bounds.minX,
      maxX = mask.bounds.maxX,
      minY = mask.bounds.minY,
      maxY = mask.bounds.maxY,
      rw = maxX - minX + 1, // bounds size
      rh = maxY - minY + 1,
      result = new Uint8Array(rw * rh), // reduced mask (bounds size)
      x0 = Math.max(minX, 1),
      x1 = Math.min(maxX, w - 2),
      y0 = Math.max(minY, 1),
      y1 = Math.min(maxY, h - 2),
      count = 0;

    // walk through inner values except points on the boundary of the image
    for (y = y0; y < y1 + 1; y++)
      for (x = x0; x < x1 + 1; x++) {
        k = y * w + x;
        if (data[k] === 0) continue; // "white" point isn't the border
        k1 = k + w; // y + 1
        k2 = k - w; // y - 1
        // check if any neighbor with a "white" color
        if (data[k + 1] === 0 || data[k - 1] === 0 ||
          data[k1] === 0 || data[k1 + 1] === 0 || data[k1 - 1] === 0 ||
          data[k2] === 0 || data[k2 + 1] === 0 || data[k2 - 1] === 0) {
          //if (data[k + 1] + data[k - 1] +
          //    data[k1] + data[k1 + 1] + data[k1 - 1] +
          //    data[k2] + data[k2 + 1] + data[k2 - 1] == 8) continue;
          result[(y - minY) * rw + (x - minX)] = 1;
          count++;
        }
      }

    // walk through points on the boundary of the image if necessary
    // if the "black" point is adjacent to the boundary of the image, it is a border point
    if (minX == 0)
      for (y = minY; y < maxY + 1; y++)
        if (data[y * w] === 1) {
          result[(y - minY) * rw] = 1;
          count++;
        }

    if (maxX == w - 1)
      for (y = minY; y < maxY + 1; y++)
        if (data[y * w + maxX] === 1) {
          result[(y - minY) * rw + (maxX - minX)] = 1;
          count++;
        }

    if (minY == 0)
      for (x = minX; x < maxX + 1; x++)
        if (data[x] === 1) {
          result[x - minX] = 1;
          count++;
        }

    if (maxY == h - 1)
      for (x = minX; x < maxX + 1; x++)
        if (data[maxY * w + x] === 1) {
          result[(maxY - minY) * rw + (x - minX)] = 1;
          count++;
        }

    return {
      count: count,
      data: result,
      width: rw,
      height: rh,
      offset: {x: minX, y: minY}
    };
  };

  /** Create a border index array of boundary points of the mask
   * @param {Object} mask: {Uint8Array} data, {int} width, {int} height
   * @return {Array} border index array boundary points of the mask
   */
  lib.getBorderIndices = function (mask) {

    var x, y, k, k1, k2,
      w = mask.width,
      h = mask.height,
      data = mask.data,
      border = [], // only border points
      x1 = w - 1,
      y1 = h - 1;

    // walk through inner values except points on the boundary of the image
    for (y = 1; y < y1; y++)
      for (x = 1; x < x1; x++) {
        k = y * w + x;
        if (data[k] === 0) continue; // "white" point isn't the border
        k1 = k + w; // y + 1
        k2 = k - w; // y - 1
        // check if any neighbor with a "white" color
        if (data[k + 1] === 0 || data[k - 1] === 0 ||
          data[k1] === 0 || data[k1 + 1] === 0 || data[k1 - 1] === 0 ||
          data[k2] === 0 || data[k2 + 1] === 0 || data[k2 - 1] === 0) {
          //if (data[k + 1] + data[k - 1] +
          //    data[k1] + data[k1 + 1] + data[k1 - 1] +
          //    data[k2] + data[k2 + 1] + data[k2 - 1] == 8) continue;
          border.push(k);
        }
      }

    // walk through points on the boundary of the image if necessary
    // if the "black" point is adjacent to the boundary of the image, it is a border point
    for (y = 0; y < h; y++)
      if (data[y * w] === 1)
        border.push(y * w);

    for (x = 0; x < w; x++)
      if (data[x] === 1)
        border.push(x);

    k = w - 1;
    for (y = 0; y < h; y++)
      if (data[y * w + k] === 1)
        border.push(y * w + k);

    k = (h - 1) * w;
    for (x = 0; x < w; x++)
      if (data[k + x] === 1)
        border.push(k + x);

    return border;
  };

  /** Create a compressed mask with a "white" border (1px border with zero values) for the contour tracing
   * @param {Object} mask: {Uint8Array} data, {int} width, {int} height, {Object} bounds
   * @return {Object} border mask: {Uint8Array} data, {int} width, {int} height, {Object} offset
   */
  function prepareMask(mask) {
    var x, y,
      w = mask.width,
      data = mask.data,
      minX = mask.bounds.minX,
      maxX = mask.bounds.maxX,
      minY = mask.bounds.minY,
      maxY = mask.bounds.maxY,
      rw = maxX - minX + 3, // bounds size +1 px on each side (a "white" border)
      rh = maxY - minY + 3,
      result = new Uint8Array(rw * rh); // reduced mask (bounds size)

    // walk through inner values and copy only "black" points to the result mask
    for (y = minY; y < maxY + 1; y++)
      for (x = minX; x < maxX + 1; x++) {
        if (data[y * w + x] === 1)
          result[(y - minY + 1) * rw + (x - minX + 1)] = 1;
      }

    return {
      data: result,
      width: rw,
      height: rh,
      offset: {x: minX - 1, y: minY - 1}
    };
  };

  /** Create a contour array for the binary mask
   * Algorithm: http://www.sciencedirect.com/science/article/pii/S1077314203001401
   * @param {Object} mask: {Uint8Array} data, {int} width, {int} height, {Object} bounds
   * @return {Array} contours: {Array} points, {bool} inner, {int} label
   */
  lib.traceContours = function (mask) {
    var m = prepareMask(mask),
      contours = [],
      label = 0,
      w = m.width,
      w2 = w * 2,
      h = m.height,
      src = m.data,
      dx = m.offset.x,
      dy = m.offset.y,
      bounds,_p,
      dest = new Uint8Array(src), // label matrix
      i, j, x, y, k, k1, c, inner, dir, first, second, current, previous, next, d;

    // all [dx,dy] pairs (array index is the direction)
    // 5 6 7
    // 4 X 0
    // 3 2 1
    var directions = [[1, 0], [1, 1], [0, 1], [-1, 1], [-1, 0], [-1, -1], [0, -1], [1, -1]];

    for (y = 1; y < h - 1; y++)
      for (x = 1; x < w - 1; x++) {
        k = y * w + x;
        if (src[k] === 1) {
          for (i = -w; i < w2; i += w2) { // k - w: outer tracing (y - 1), k + w: inner tracing (y + 1)
            if (src[k + i] === 0 && dest[k + i] === 0) { // need contour tracing
              inner = i === w; // is inner contour tracing ?
              label++; // label for the next contour

              c = [];
              bounds = {
                minX : w,
                minY : h,
                maxX : -1,
                maxY : -1,
              };
              dir = inner ? 2 : 6; // start direction
              current = previous = first = {x: x, y: y};
              second = null;
              while (true) {
                dest[current.y * w + current.x] = label; // mark label for the current point
                // bypass all the neighbors around the current point in a clockwise
                for (j = 0; j < 8; j++) {
                  dir = (dir + 1) % 8;

                  // get the next point by new direction
                  d = directions[dir]; // index as direction
                  next = {x: current.x + d[0], y: current.y + d[1]};

                  k1 = next.y * w + next.x;
                  if (src[k1] === 1) // black boundary pixel
                  {
                    dest[k1] = label; // mark a label
                    break;
                  }
                  dest[k1] = -1; // mark a white boundary pixel
                  next = null;
                }
                if (next === null) break; // no neighbours (one-point contour)
                current = next;
                if (second) {
                  if (previous.x === first.x && previous.y === first.y && current.x === second.x && current.y === second.y) {
                    break; // creating the contour completed when returned to original position
                  }
                } else {
                  second = next;
                }
                _p = {x: previous.x + dx, y: previous.y + dy};
                if(bounds.minX > _p.x)bounds.minX = _p.x;
                if(bounds.maxX < _p.x)bounds.maxX = _p.x;
                if(bounds.minY > _p.y)bounds.minY = _p.y;
                if(bounds.maxY < _p.y)bounds.maxY = _p.y;
                c.push(_p);
                previous = current;
                dir = (dir + 4) % 8; // next dir (symmetrically to the current direction)
              }

              if (next != null) {
                _p = {x: first.x + dx, y: first.y + dy};
                if(bounds.minX >  _p.x)bounds.minX =  _p.x;
                if(bounds.maxX <  _p.x)bounds.maxX =  _p.x;
                if(bounds.minY >  _p.y)bounds.minY =  _p.y;
                if(bounds.maxY <  _p.y)bounds.maxY =  _p.y;
                c.push(_p); // close the contour
                contours.push({inner: inner, label: label, points: c,bounds : bounds}); // add contour to the list
              }
            }
          }
        }
      }

    return contours;
  };

  function rgbToHsl(r, g, b){
    r /= 255, g /= 255, b /= 255;
    var max = Math.max(r, g, b), min = Math.min(r, g, b);
    var h, s, l = (max + min) / 2;

    if(max == min){
      h = s = 0; // achromatic
    }else{
      var d = max - min;
      s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
      switch(max){
        case r: h = (g - b) / d + (g < b ? 6 : 0); break;
        case g: h = (b - r) / d + 2; break;
        case b: h = (r - g) / d + 4; break;
      }
      h /= 6;
    }

    return [h * 255, s* 255, l* 255];
  }

  lib.simplifyContour = function (c, simplifyTolerant, simplifyCount) {
    var
      i, j, k, c, points, len, resPoints, lst, stack, ids,
      maxd, maxi, dist, r1, r2, r12, dx, dy, pi, pf, pl;

    points = c.points;
    len = c.points.length;

    if (len < simplifyCount) { // contour isn't simplified
      resPoints = [];
      for (k = 0; k < len; k++) {
        resPoints.push({x: points[k].x, y: points[k].y});
      }
      return {
        bounds: c.bounds, inner: c.inner, label: c.label, points: resPoints, initialCount: len};
    }

    lst = [0, len - 1]; // always add first and last points
    stack = [{first: 0, last: len - 1}]; // first processed edge

    do {
      ids = stack.shift();
      if (ids.last <= ids.first + 1) // no intermediate points
      {
        continue;
      }

      maxd = -1.0; // max distance from point to current edge
      maxi = ids.first; // index of maximally distant point

      for (i = ids.first + 1; i < ids.last; i++) // bypass intermediate points in edge
      {
        // calc the distance from current point to edge
        pi = points[i];
        pf = points[ids.first];
        pl = points[ids.last];
        dx = pi.x - pf.x;
        dy = pi.y - pf.y;
        r1 = Math.sqrt(dx * dx + dy * dy);
        dx = pi.x - pl.x;
        dy = pi.y - pl.y;
        r2 = Math.sqrt(dx * dx + dy * dy);
        dx = pf.x - pl.x;
        dy = pf.y - pl.y;
        r12 = Math.sqrt(dx * dx + dy * dy);
        if (r1 >= Math.sqrt(r2 * r2 + r12 * r12)) dist = r2;
        else if (r2 >= Math.sqrt(r1 * r1 + r12 * r12)) dist = r1;
        else dist = Math.abs((dy * pi.x - dx * pi.y + pf.x * pl.y - pl.x * pf.y) / r12);

        if (dist > maxd) {
          maxi = i; // save the index of maximally distant point
          maxd = dist;
        }
      }

      if (maxd > simplifyTolerant) // if the max "deviation" is larger than allowed then...
      {
        lst.push(maxi); // add index to the simplified list
        stack.push({first: ids.first, last: maxi}); // add the left part for processing
        stack.push({first: maxi, last: ids.last}); // add the right part for processing
      }

    } while (stack.length > 0);

    resPoints = [];
    len = lst.length;
    lst.sort(function (a, b) {
      return a - b;
    }); // restore index order
    for (k = 0; k < len; k++) {
      resPoints.push({x: points[lst[k]].x, y: points[lst[k]].y}); // add result points to the correct order
    }
    return {
      bounds: c.bounds,
      inner: c.inner, label: c.label, points: resPoints, initialCount: c.points.length
    };
  };

  /** Simplify contours
   * Algorithms: http://psimpl.sourceforge.net/douglas-peucker.html
   * http://neerc.ifmo.ru/wiki/index.php?title=%D0%A3%D0%BF%D1%80%D0%BE%D1%89%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BF%D0%BE%D0%BB%D0%B8%D0%B3%D0%BE%D0%BD%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D0%B9_%D1%86%D0%B5%D0%BF%D0%B8
   * @param {Array} contours: {Array} points, {bool} inner, {int} label
   * @param {float} simplify tolerant
   * @param {int} simplify count: min number of points when the contour is simplified
   * @return {Array} contours: {Array} points, {bool} inner, {int} label, {int} initialCount
   */
  lib.simplifyContours = function (contours, simplifyTolerant, simplifyCount) {
    var lenContours = contours.length,
      result = [];

    // walk through all contours
    for (var j = 0; j < lenContours; j++) {

      result.push(lib.simplifyContour(contours[j], simplifyTolerant, simplifyCount));
    }

    return result;
  };

  return lib;
})();
if (true) {
  module.exports = MagicWand;
}

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 9 */
/***/ (function(module, exports) {

module.exports = $;

/***/ }),
/* 10 */
/***/ (function(module, exports) {

module.exports = "PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgICB4bWxuczppbmtzY2FwZT0iaHR0cDovL3d3dy5pbmtzY2FwZS5vcmcvbmFtZXNwYWNlcy9pbmtzY2FwZSIKICAgIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyIKICAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgIHhtbG5zOmNjPSJodHRwOi8vY3JlYXRpdmVjb21tb25zLm9yZy9ucyMiCiAgICB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIKICAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgICB4bWxuczpuczE9Imh0dHA6Ly9zb3ppLmJhaWVyb3VnZS5mciIKICAgIGlkPSJzdmc0ODg4IgogICAgc29kaXBvZGk6ZG9jbmFtZT0id2FybmluZ19idXR0b24uc3ZnIgogICAgdmlld0JveD0iMCAwIDQwMCA0MDAiCiAgICB2ZXJzaW9uPSIxLjEiCiAgICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ4LjAgcjk2NTQiCiAgPgogIDxkZWZzCiAgICAgIGlkPSJkZWZzNDg5MCIKICAgID4KICAgIDxsaW5lYXJHcmFkaWVudAogICAgICAgIGlkPSJsaW5lYXJHcmFkaWVudDg0MTEiCiAgICAgICAgeTI9IjM2Ny44OCIKICAgICAgICBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIKICAgICAgICB5MT0iMjg3LjQ5IgogICAgICAgIHgyPSIzMTUuNDciCiAgICAgICAgeDE9IjI0MS40MSIKICAgICAgICBpbmtzY2FwZTpjb2xsZWN0PSJhbHdheXMiCiAgICAgID4KICAgICAgPHN0b3AKICAgICAgICAgIGlkPSJzdG9wNDE1OCIKICAgICAgICAgIHN0eWxlPSJzdG9wLWNvbG9yOiNmZmZmZmYiCiAgICAgICAgICBvZmZzZXQ9IjAiCiAgICAgIC8+CiAgICAgIDxzdG9wCiAgICAgICAgICBpZD0ic3RvcDQxNjAiCiAgICAgICAgICBzdHlsZT0ic3RvcC1jb2xvcjojZmZmZmZmO3N0b3Atb3BhY2l0eTowIgogICAgICAgICAgb2Zmc2V0PSIxIgogICAgICAvPgogICAgPC9saW5lYXJHcmFkaWVudAogICAgPgogICAgPGZpbHRlcgogICAgICAgIGlkPSJmaWx0ZXI2MTI2IgogICAgICAgIGNvbG9yLWludGVycG9sYXRpb24tZmlsdGVycz0ic1JHQiIKICAgICAgICBpbmtzY2FwZTpjb2xsZWN0PSJhbHdheXMiCiAgICAgID4KICAgICAgPGZlR2F1c3NpYW5CbHVyCiAgICAgICAgICBpZD0iZmVHYXVzc2lhbkJsdXI2MTI4IgogICAgICAgICAgc3RkRGV2aWF0aW9uPSIwLjUzMDM1NzEzIgogICAgICAgICAgaW5rc2NhcGU6Y29sbGVjdD0iYWx3YXlzIgogICAgICAvPgogICAgPC9maWx0ZXIKICAgID4KICAgIDxsaW5lYXJHcmFkaWVudAogICAgICAgIGlkPSJsaW5lYXJHcmFkaWVudDg0MTMiCiAgICAgICAgeTI9IjM5MS40NSIKICAgICAgICBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIKICAgICAgICB5MT0iMzAwLjg2IgogICAgICAgIHgyPSIzNDIiCiAgICAgICAgeDE9IjI3NS42MSIKICAgICAgICBpbmtzY2FwZTpjb2xsZWN0PSJhbHdheXMiCiAgICAgID4KICAgICAgPHN0b3AKICAgICAgICAgIGlkPSJzdG9wNzIwMSIKICAgICAgICAgIHN0eWxlPSJzdG9wLWNvbG9yOiM1NTAwMDAiCiAgICAgICAgICBvZmZzZXQ9IjAiCiAgICAgIC8+CiAgICAgIDxzdG9wCiAgICAgICAgICBpZD0ic3RvcDcyMDMiCiAgICAgICAgICBzdHlsZT0ic3RvcC1jb2xvcjojZmYwMDAwIgogICAgICAgICAgb2Zmc2V0PSIxIgogICAgICAvPgogICAgPC9saW5lYXJHcmFkaWVudAogICAgPgogICAgPHJhZGlhbEdyYWRpZW50CiAgICAgICAgaWQ9InJhZGlhbEdyYWRpZW50ODQxNSIKICAgICAgICBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIKICAgICAgICBjeD0iMzEyLjc4IgogICAgICAgIGN5PSIzODYuNTciCiAgICAgICAgcj0iNTMuMDM2IgogICAgICAgIGdyYWRpZW50VHJhbnNmb3JtPSJtYXRyaXgoLS41OTMyNyAtLjU5MzI3IC43MTUwNSAtLjcxNTA1IDI0My4yNyA4NDkuMDMpIgogICAgICAgIGlua3NjYXBlOmNvbGxlY3Q9ImFsd2F5cyIKICAgICAgPgogICAgICA8c3RvcAogICAgICAgICAgaWQ9InN0b3A3MTEzLTciCiAgICAgICAgICBzdHlsZT0ic3RvcC1jb2xvcjojZmZmZmZmO3N0b3Atb3BhY2l0eTouNDA4MTYiCiAgICAgICAgICBvZmZzZXQ9IjAiCiAgICAgIC8+CiAgICAgIDxzdG9wCiAgICAgICAgICBpZD0ic3RvcDcxMTUtNyIKICAgICAgICAgIHN0eWxlPSJzdG9wLWNvbG9yOiNmZmZmZmY7c3RvcC1vcGFjaXR5OjAiCiAgICAgICAgICBvZmZzZXQ9IjEiCiAgICAgIC8+CiAgICA8L3JhZGlhbEdyYWRpZW50CiAgICA+CiAgICA8bGluZWFyR3JhZGllbnQKICAgICAgICBpZD0ibGluZWFyR3JhZGllbnQxMDQ0OSIKICAgICAgICB5Mj0iMzM4LjgyIgogICAgICAgIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIgogICAgICAgIHkxPSIyODYuNjciCiAgICAgICAgZ3JhZGllbnRUcmFuc2Zvcm09Im1hdHJpeCguOTU1MzQgMCAwIC45NTUzNCAxMzYuMTIgMTQuMDU1KSIKICAgICAgICB4Mj0iMzAwLjI3IgogICAgICAgIHgxPSIyNTUuMzIiCiAgICAgICAgaW5rc2NhcGU6Y29sbGVjdD0iYWx3YXlzIgogICAgICA+CiAgICAgIDxzdG9wCiAgICAgICAgICBpZD0ic3RvcDQxNTAiCiAgICAgICAgICBzdHlsZT0ic3RvcC1jb2xvcjojZmZmZmZmIgogICAgICAgICAgb2Zmc2V0PSIwIgogICAgICAvPgogICAgICA8c3RvcAogICAgICAgICAgaWQ9InN0b3A0MTUyIgogICAgICAgICAgc3R5bGU9InN0b3AtY29sb3I6I2ZmZmZmZjtzdG9wLW9wYWNpdHk6MCIKICAgICAgICAgIG9mZnNldD0iMSIKICAgICAgLz4KICAgIDwvbGluZWFyR3JhZGllbnQKICAgID4KICAgIDxmaWx0ZXIKICAgICAgICBpZD0iZmlsdGVyMTE0MjgiCiAgICAgICAgY29sb3ItaW50ZXJwb2xhdGlvbi1maWx0ZXJzPSJzUkdCIgogICAgICAgIGlua3NjYXBlOmNvbGxlY3Q9ImFsd2F5cyIKICAgICAgPgogICAgICA8ZmVHYXVzc2lhbkJsdXIKICAgICAgICAgIGlkPSJmZUdhdXNzaWFuQmx1cjExNDMwIgogICAgICAgICAgc3RkRGV2aWF0aW9uPSIxLjI0MzQ2NzgiCiAgICAgICAgICBpbmtzY2FwZTpjb2xsZWN0PSJhbHdheXMiCiAgICAgIC8+CiAgICA8L2ZpbHRlcgogICAgPgogIDwvZGVmcwogID4KICA8c29kaXBvZGk6bmFtZWR2aWV3CiAgICAgIGlkPSJiYXNlIgogICAgICBib3JkZXJjb2xvcj0iIzY2NjY2NiIKICAgICAgaW5rc2NhcGU6cGFnZXNoYWRvdz0iMiIKICAgICAgaW5rc2NhcGU6d2luZG93LXk9Ii04IgogICAgICBwYWdlY29sb3I9IiNmZmZmZmYiCiAgICAgIGlua3NjYXBlOndpbmRvdy1oZWlnaHQ9Ijk4OCIKICAgICAgaW5rc2NhcGU6d2luZG93LW1heGltaXplZD0iMSIKICAgICAgaW5rc2NhcGU6em9vbT0iMC43MDcxMDY3OCIKICAgICAgaW5rc2NhcGU6d2luZG93LXg9Ii04IgogICAgICBzaG93Z3JpZD0iZmFsc2UiCiAgICAgIGJvcmRlcm9wYWNpdHk9IjEuMCIKICAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ibGF5ZXIxIgogICAgICBpbmtzY2FwZTpjeD0iMzA0Ljg5NDA5IgogICAgICBpbmtzY2FwZTpjeT0iMzQxLjUyMTg2IgogICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9IjE2ODAiCiAgICAgIGlua3NjYXBlOnBhZ2VvcGFjaXR5PSIwLjAiCiAgICAgIGlua3NjYXBlOmRvY3VtZW50LXVuaXRzPSJweCIKICAvPgogIDxnCiAgICAgIGlkPSJsYXllcjEiCiAgICAgIGlua3NjYXBlOmxhYmVsPSJMYXllciAxIgogICAgICBpbmtzY2FwZTpncm91cG1vZGU9ImxheWVyIgogICAgICB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwIC02NTIuMzYpIgogICAgPgogICAgPGcKICAgICAgICBpZD0iZzExNDMyIgogICAgICAgIGlua3NjYXBlOmV4cG9ydC15ZHBpPSI5MCIKICAgICAgICBpbmtzY2FwZTpleHBvcnQteGRwaT0iOTAiCiAgICAgICAgdHJhbnNmb3JtPSJtYXRyaXgoMi45MDUxIDAgMCAyLjkwNTEgLTEwMDEuOSAtNzguOTYxKSIKICAgICAgPgogICAgICA8cGF0aAogICAgICAgICAgaWQ9InBhdGg3Mjc2IgogICAgICAgICAgc29kaXBvZGk6cng9IjUzLjAzNTcxMyIKICAgICAgICAgIHNvZGlwb2RpOnJ5PSI1My4wMzU3MTMiCiAgICAgICAgICBzdHlsZT0iZmlsbDojOTk5OTk5IgogICAgICAgICAgc29kaXBvZGk6dHlwZT0iYXJjIgogICAgICAgICAgZD0ibTM1Ni43OSAzNDYuMTFjMCAyOS4yOTEtMjMuNzQ1IDUzLjAzNi01My4wMzYgNTMuMDM2cy01My4wMzYtMjMuNzQ1LTUzLjAzNi01My4wMzYgMjMuNzQ1LTUzLjAzNiA1My4wMzYtNTMuMDM2IDUzLjAzNiAyMy43NDUgNTMuMDM2IDUzLjAzNnoiCiAgICAgICAgICB0cmFuc2Zvcm09Im1hdHJpeCguOTczNTQgMCAwIC45NzM1NCAxMjAuMDkgLTEyLjYyOCkiCiAgICAgICAgICBzb2RpcG9kaTpjeT0iMzQ2LjExMjE4IgogICAgICAgICAgc29kaXBvZGk6Y3g9IjMwMy43NSIKICAgICAgLz4KICAgICAgPHBhdGgKICAgICAgICAgIGlkPSJwYXRoNzI3OCIKICAgICAgICAgIHNvZGlwb2RpOnJ4PSI1My4wMzU3MTMiCiAgICAgICAgICBzb2RpcG9kaTpyeT0iNTMuMDM1NzEzIgogICAgICAgICAgc3R5bGU9ImZpbGw6dXJsKCNsaW5lYXJHcmFkaWVudDg0MTEpIgogICAgICAgICAgc29kaXBvZGk6dHlwZT0iYXJjIgogICAgICAgICAgZD0ibTM1Ni43OSAzNDYuMTFjMCAyOS4yOTEtMjMuNzQ1IDUzLjAzNi01My4wMzYgNTMuMDM2cy01My4wMzYtMjMuNzQ1LTUzLjAzNi01My4wMzYgMjMuNzQ1LTUzLjAzNiA1My4wMzYtNTMuMDM2IDUzLjAzNiAyMy43NDUgNTMuMDM2IDUzLjAzNnoiCiAgICAgICAgICB0cmFuc2Zvcm09Im1hdHJpeCguOTU5NjAgMCAwIC45NTk2MCAxMjQuMzMgLTcuODAxNCkiCiAgICAgICAgICBzb2RpcG9kaTpjeT0iMzQ2LjExMjE4IgogICAgICAgICAgc29kaXBvZGk6Y3g9IjMwMy43NSIKICAgICAgLz4KICAgICAgPHBhdGgKICAgICAgICAgIGlkPSJwYXRoNzI4MCIKICAgICAgICAgIHNvZGlwb2RpOnJ4PSI1My4wMzU3MTMiCiAgICAgICAgICBzb2RpcG9kaTpyeT0iNTMuMDM1NzEzIgogICAgICAgICAgc3R5bGU9ImZpbHRlcjp1cmwoI2ZpbHRlcjYxMjYpO2ZpbGw6I2VjZWNlYyIKICAgICAgICAgIHNvZGlwb2RpOnR5cGU9ImFyYyIKICAgICAgICAgIGQ9Im0zNTYuNzkgMzQ2LjExYzAgMjkuMjkxLTIzLjc0NSA1My4wMzYtNTMuMDM2IDUzLjAzNnMtNTMuMDM2LTIzLjc0NS01My4wMzYtNTMuMDM2IDIzLjc0NS01My4wMzYgNTMuMDM2LTUzLjAzNiA1My4wMzYgMjMuNzQ1IDUzLjAzNiA1My4wMzZ6IgogICAgICAgICAgdHJhbnNmb3JtPSJtYXRyaXgoLjg3MzU1IDAgMCAuODczNTUgMTUwLjQ3IDIxLjk4MSkiCiAgICAgICAgICBzb2RpcG9kaTpjeT0iMzQ2LjExMjE4IgogICAgICAgICAgc29kaXBvZGk6Y3g9IjMwMy43NSIKICAgICAgLz4KICAgICAgPHBhdGgKICAgICAgICAgIGlkPSJwYXRoNzI4MiIKICAgICAgICAgIHNvZGlwb2RpOnJ4PSI1My4wMzU3MTMiCiAgICAgICAgICBzb2RpcG9kaTpyeT0iNTMuMDM1NzEzIgogICAgICAgICAgc3R5bGU9ImZpbHRlcjp1cmwoI2ZpbHRlcjYxMjYpO2ZpbGw6Izk5OTk5OSIKICAgICAgICAgIHNvZGlwb2RpOnR5cGU9ImFyYyIKICAgICAgICAgIGQ9Im0zNTYuNzkgMzQ2LjExYzAgMjkuMjkxLTIzLjc0NSA1My4wMzYtNTMuMDM2IDUzLjAzNnMtNTMuMDM2LTIzLjc0NS01My4wMzYtNTMuMDM2IDIzLjc0NS01My4wMzYgNTMuMDM2LTUzLjAzNiA1My4wMzYgMjMuNzQ1IDUzLjAzNiA1My4wMzZ6IgogICAgICAgICAgdHJhbnNmb3JtPSJtYXRyaXgoLjgzODM4IDAgMCAuODM4MzggMTYxLjE1IDM0LjE1MikiCiAgICAgICAgICBzb2RpcG9kaTpjeT0iMzQ2LjExMjE4IgogICAgICAgICAgc29kaXBvZGk6Y3g9IjMwMy43NSIKICAgICAgLz4KICAgICAgPHBhdGgKICAgICAgICAgIGlkPSJwYXRoNzI4NCIKICAgICAgICAgIHNvZGlwb2RpOnJ4PSI1My4wMzU3MTMiCiAgICAgICAgICBzb2RpcG9kaTpyeT0iNTMuMDM1NzEzIgogICAgICAgICAgc3R5bGU9ImZpbGw6dXJsKCNsaW5lYXJHcmFkaWVudDg0MTMpIgogICAgICAgICAgc29kaXBvZGk6dHlwZT0iYXJjIgogICAgICAgICAgZD0ibTM1Ni43OSAzNDYuMTFjMCAyOS4yOTEtMjMuNzQ1IDUzLjAzNi01My4wMzYgNTMuMDM2cy01My4wMzYtMjMuNzQ1LTUzLjAzNi01My4wMzYgMjMuNzQ1LTUzLjAzNiA1My4wMzYtNTMuMDM2IDUzLjAzNiAyMy43NDUgNTMuMDM2IDUzLjAzNnoiCiAgICAgICAgICB0cmFuc2Zvcm09Im1hdHJpeCguODA1ODcgMCAwIC44MDU4NyAxNzEuMDMgNDUuNDA1KSIKICAgICAgICAgIHNvZGlwb2RpOmN5PSIzNDYuMTEyMTgiCiAgICAgICAgICBzb2RpcG9kaTpjeD0iMzAzLjc1IgogICAgICAvPgogICAgICA8cGF0aAogICAgICAgICAgaWQ9InBhdGg3Mjg2IgogICAgICAgICAgc29kaXBvZGk6cng9IjUzLjAzNTcxMyIKICAgICAgICAgIHNvZGlwb2RpOnJ5PSI1My4wMzU3MTMiCiAgICAgICAgICBzdHlsZT0iZmlsbDp1cmwoI3JhZGlhbEdyYWRpZW50ODQxNSkiCiAgICAgICAgICBzb2RpcG9kaTp0eXBlPSJhcmMiCiAgICAgICAgICBkPSJtMzU2Ljc5IDM0Ni4xMWMwIDI5LjI5MS0yMy43NDUgNTMuMDM2LTUzLjAzNiA1My4wMzZzLTUzLjAzNi0yMy43NDUtNTMuMDM2LTUzLjAzNiAyMy43NDUtNTMuMDM2IDUzLjAzNi01My4wMzYgNTMuMDM2IDIzLjc0NSA1My4wMzYgNTMuMDM2eiIKICAgICAgICAgIHRyYW5zZm9ybT0ibWF0cml4KC43NTgyNSAwIDAgLjc1ODI1IDE4Ni43NSA2My45MDYpIgogICAgICAgICAgc29kaXBvZGk6Y3k9IjM0Ni4xMTIxOCIKICAgICAgICAgIHNvZGlwb2RpOmN4PSIzMDMuNzUiCiAgICAgIC8+CiAgICAgIDxwYXRoCiAgICAgICAgICBpZD0icGF0aDcyODgiCiAgICAgICAgICBzdHlsZT0ib3BhY2l0eTouMzE3NzE7ZmlsbDp1cmwoI2xpbmVhckdyYWRpZW50MTA0NDkpIgogICAgICAgICAgaW5rc2NhcGU6Y29ubmVjdG9yLWN1cnZhdHVyZT0iMCIKICAgICAgICAgIGQ9Im00MTQuOCAyODQuMTVjLTEzLjMzMSAwLjMwMDY5LTI2LjE4NiA3LjM1OC0zMy4zMzYgMTkuNzQyLTcuNjkwMyAxMy4zMi02LjcxMzkgMjkuMjY2IDEuMTU0NSA0MS4zMzEgMC44NTMwNi0yNi41MzIgMjEuMTMyLTQ2LjUxNSA0Ni4zMjQtNDUuMDU0IDguMjU4OSAwLjQ3OTA3IDE2LjA1NCAzLjIwMDEgMjIuODU5IDcuNTkwOC0zLjI1NzgtNy40NDk4LTguODE3MS0xMy45NTMtMTYuMzk0LTE4LjMyNy02LjQ4NjctMy43NDUxLTEzLjYyNS01LjQzOTMtMjAuNjA4LTUuMjgxOHoiCiAgICAgIC8+CiAgICAgIDxwYXRoCiAgICAgICAgICBpZD0icmVjdDczNzAiCiAgICAgICAgICBkPSJtNDAyLjg4IDMwMC4wOS0xMS41ODEgMTEuNTgxIDEzLjI5NSAxMy4yOTUtMTMuMjk1IDEzLjI4MSAxMS41ODEgMTEuNTgxIDEzLjI4MS0xMy4yOTUgMTMuMjk1IDEzLjI5NSAxMS41ODEtMTEuNTgxLTEzLjI4MS0xMy4yODEgMTMuMjgxLTEzLjI5NS0xMS41ODEtMTEuNTgxLTEzLjI5NSAxMy4yODEtMTMuMjgxLTEzLjI4MXoiCiAgICAgICAgICBzdHlsZT0iZmlsdGVyOnVybCgjZmlsdGVyMTE0MjgpO2ZpbGw6IzFhMWExYSIKICAgICAgICAgIGlua3NjYXBlOmNvbm5lY3Rvci1jdXJ2YXR1cmU9IjAiCiAgICAgIC8+CiAgICAgIDxwYXRoCiAgICAgICAgICBpZD0icGF0aDEwNDU3IgogICAgICAgICAgc3R5bGU9ImZpbGw6I2ZmZmZmZiIKICAgICAgICAgIGlua3NjYXBlOmNvbm5lY3Rvci1jdXJ2YXR1cmU9IjAiCiAgICAgICAgICBkPSJtNDAzLjQ1IDMwMS4xNS0xMS4wODcgMTEuMDg3IDEyLjcyOCAxMi43MjgtMTIuNzI4IDEyLjcxNCAxMS4wODcgMTEuMDg3IDEyLjcxNC0xMi43MjggMTIuNzI4IDEyLjcyOCAxMS4wODctMTEuMDg3LTEyLjcxNC0xMi43MTQgMTIuNzE0LTEyLjcyOC0xMS4wODctMTEuMDg3LTEyLjcyOCAxMi43MTQtMTIuNzE0LTEyLjcxNHoiCiAgICAgIC8+CiAgICA8L2cKICAgID4KICA8L2cKICA+CiAgPG1ldGFkYXRhCiAgICA+CiAgICA8cmRmOlJERgogICAgICA+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgPgogICAgICAgIDxkYzpmb3JtYXQKICAgICAgICAgID5pbWFnZS9zdmcreG1sPC9kYzpmb3JtYXQKICAgICAgICA+CiAgICAgICAgPGRjOnR5cGUKICAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIKICAgICAgICAvPgogICAgICAgIDxjYzpsaWNlbnNlCiAgICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbGljZW5zZXMvcHVibGljZG9tYWluLyIKICAgICAgICAvPgogICAgICAgIDxkYzpwdWJsaXNoZXIKICAgICAgICAgID4KICAgICAgICAgIDxjYzpBZ2VudAogICAgICAgICAgICAgIHJkZjphYm91dD0iaHR0cDovL29wZW5jbGlwYXJ0Lm9yZy8iCiAgICAgICAgICAgID4KICAgICAgICAgICAgPGRjOnRpdGxlCiAgICAgICAgICAgICAgPk9wZW5jbGlwYXJ0PC9kYzp0aXRsZQogICAgICAgICAgICA+CiAgICAgICAgICA8L2NjOkFnZW50CiAgICAgICAgICA+CiAgICAgICAgPC9kYzpwdWJsaXNoZXIKICAgICAgICA+CiAgICAgICAgPGRjOnRpdGxlCiAgICAgICAgICA+ZXJyb3IgYnV0dG9uPC9kYzp0aXRsZQogICAgICAgID4KICAgICAgICA8ZGM6ZGF0ZQogICAgICAgICAgPjIwMTEtMDItMjRUMTc6NDU6NDU8L2RjOmRhdGUKICAgICAgICA+CiAgICAgICAgPGRjOmRlc2NyaXB0aW9uCiAgICAgICAgLz4KICAgICAgICA8ZGM6c291cmNlCiAgICAgICAgICA+aHR0cHM6Ly9vcGVuY2xpcGFydC5vcmcvZGV0YWlsLzEyMjQyNS9lcnJvci1idXR0b24tYnktcmljYXJkb21haWE8L2RjOnNvdXJjZQogICAgICAgID4KICAgICAgICA8ZGM6Y3JlYXRvcgogICAgICAgICAgPgogICAgICAgICAgPGNjOkFnZW50CiAgICAgICAgICAgID4KICAgICAgICAgICAgPGRjOnRpdGxlCiAgICAgICAgICAgICAgPnJpY2FyZG9tYWlhPC9kYzp0aXRsZQogICAgICAgICAgICA+CiAgICAgICAgICA8L2NjOkFnZW50CiAgICAgICAgICA+CiAgICAgICAgPC9kYzpjcmVhdG9yCiAgICAgICAgPgogICAgICAgIDxkYzpzdWJqZWN0CiAgICAgICAgICA+CiAgICAgICAgICA8cmRmOkJhZwogICAgICAgICAgICA+CiAgICAgICAgICAgIDxyZGY6bGkKICAgICAgICAgICAgICA+YnV0dG9uPC9yZGY6bGkKICAgICAgICAgICAgPgogICAgICAgICAgICA8cmRmOmxpCiAgICAgICAgICAgICAgPmNhbmNlbDwvcmRmOmxpCiAgICAgICAgICAgID4KICAgICAgICAgICAgPHJkZjpsaQogICAgICAgICAgICAgID5jaXJjbGU8L3JkZjpsaQogICAgICAgICAgICA+CiAgICAgICAgICAgIDxyZGY6bGkKICAgICAgICAgICAgICA+ZGVsZXRlPC9yZGY6bGkKICAgICAgICAgICAgPgogICAgICAgICAgICA8cmRmOmxpCiAgICAgICAgICAgICAgPnJlZDwvcmRmOmxpCiAgICAgICAgICAgID4KICAgICAgICAgICAgPHJkZjpsaQogICAgICAgICAgICAgID5yb3VuZDwvcmRmOmxpCiAgICAgICAgICAgID4KICAgICAgICAgIDwvcmRmOkJhZwogICAgICAgICAgPgogICAgICAgIDwvZGM6c3ViamVjdAogICAgICAgID4KICAgICAgPC9jYzpXb3JrCiAgICAgID4KICAgICAgPGNjOkxpY2Vuc2UKICAgICAgICAgIHJkZjphYm91dD0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbGljZW5zZXMvcHVibGljZG9tYWluLyIKICAgICAgICA+CiAgICAgICAgPGNjOnBlcm1pdHMKICAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vY3JlYXRpdmVjb21tb25zLm9yZy9ucyNSZXByb2R1Y3Rpb24iCiAgICAgICAgLz4KICAgICAgICA8Y2M6cGVybWl0cwogICAgICAgICAgICByZGY6cmVzb3VyY2U9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zI0Rpc3RyaWJ1dGlvbiIKICAgICAgICAvPgogICAgICAgIDxjYzpwZXJtaXRzCiAgICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjRGVyaXZhdGl2ZVdvcmtzIgogICAgICAgIC8+CiAgICAgIDwvY2M6TGljZW5zZQogICAgICA+CiAgICA8L3JkZjpSREYKICAgID4KICA8L21ldGFkYXRhCiAgPgo8L3N2Zwo+Cg=="

/***/ }),
/* 11 */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(fabric) {fabric.util.object.extend(fabric.BaseBrush.prototype, {
  useDrawingColor: true,
  setOptions: function (options) {
    for (var prop in options) {
      this[prop] = options[prop];
    }
  },
  type: "base-brush",
  initialize: function (canvas, options) {
    this.canvas = canvas;
    options = options || {};
    if(this.canvas.application) {
      this.canvas.application.fire("entity:created", {target: this, options: options})
    }
    this.setOptions(options);
  },
  convertColor: function (color, type) {
    type = type || "name";
    if (color instanceof Array) {
      if (type == "source") {
        return color;
      }
      color = "#" + fabric.Color.fromSource(color).toHex();
    }
    if (type == "hex" || type == "source") {
      if (fabric.Color.colorNameMap[color]) {
        color = fabric.Color.colorNameMap[color];
      }
      if (type == "source") {
        if (color == "transparent") {
          return [0, 0, 0, 0];
        }
        var _source = fabric.Color.fromHex(color).getSource()
        _source[3] *= 255;
        return _source;
      }
    }
    return color;
  },
  getColor: function (type) {
    var color = this.useDrawingColor && this.canvas.drawingColor || this.color;
    return this.convertColor(color, type);
  }
});

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 12 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {


fabric.MagicWand = __webpack_require__(8);

  /**
   * PencilBrush class
   * @class fabric.PencilBrush
   * @extends fabric.BaseBrush
   */
  fabric.PaintBucketBrush = fabric.util.createClass(fabric.BaseBrush, /** @lends fabric.PencilBrush.prototype */ {
    type: 'paint-bucket-brush',
    /**
     * Constructor
     * @param {fabric.Canvas} canvas
     * @return {fabric.PencilBrush} Instance of a pencil brush
     */
    initialize: function(canvas) {
      this.callSuper('initialize', canvas);
      this._points = [];
    },
    getTarget: function(){
      return this.canvas.drawingContext;
    },
    onMouseUp: function() {},
    onMouseMove: function() {},
    onMouseDown: function(pointer) {
      this._fill(pointer);
    },
    _fill: function(pointer){
      pointer = {
        x: Math.floor(pointer.x),
        y: Math.floor(pointer.y)
      };

      var info = this.getTarget().getImageData(0,0,this.getTarget().canvas.width,this.getTarget().canvas.height);

      fabric.MagicWand.floodFill(info, pointer.x , pointer.y, 1,{},null,function(mask){
        var _color = this.getColor('source');
        var _target = this.getTarget();
        var _w = mask.bounds.maxX - mask.bounds.minX + 1, _h = mask.bounds.maxY - mask.bounds.minY + 1;
        var oldImageData = _target.getImageData( mask.bounds.minX,mask.bounds.minY,_w, _h);

        mask.render(_target,{
          intersectionColor : _color,
          fill : _color,
          cache: false,
          left : mask.bounds.minX,
          top : mask.bounds.minY
        });

        this.canvas.fire("draw:after",{
          target: this.getTarget() ,
          redo: _target.getImageData( mask.bounds.minX,mask.bounds.minY,_w, _h),
          undo: oldImageData ,
          left : mask.bounds.minX,
          top : mask.bounds.minY,
          color: this.getColor().slice()
        });

        this.canvas.renderAll();
      }.bind(this));
    },
    getHistoryRecord: function(event) {

      return {
        canvas:   this.canvas,
        object:   event.target ,
        type:     "draw:bucket",
        left:     event.left ,
        top:      event.top ,
        undoData: event.undo,
        redoData: event.redo,
        color:    this.convertColor(event.color,"source"  ),
        undo: function(_action){
          _action.object.putImageData(_action.undoData, _action.left,_action.top);
          _action.canvas.renderAll();
        },
        redo: function(_action){
          _action.object.putImageData(_action.redoData, _action.left,_action.top);
          _action.canvas.renderAll();
        }
      }
    }
  });

fabric.SlideCanvas.prototype.drawingTools.PaintBucketBrush = {
  icon:  'data:image/svg+xml;base64,' + __webpack_require__(61),
  title: 'Bucket Brush'
};
fabric.SlideCanvas.prototype.activeDrawingTools.push("PaintBucketBrush");

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 13 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {


  /**
   * PencilBrush class
   * @class fabric.PencilBrush
   * @extends fabric.BaseBrush
   */
  fabric.PaintPenBrush = fabric.util.createClass(fabric.BaseBrush, /** @lends fabric.PencilBrush.prototype */ {
    type: 'paint-pen-brush',

    /**
     * Constructor
     * @param {fabric.Canvas} canvas
     * @return {fabric.PencilBrush} Instance of a pencil brush
     */
    initialize: function(canvas) {
      this.callSuper('initialize', canvas);
      this._points = [];
    },
    getTarget: function(){
      return this.canvas.drawingContext;
    },
    /**
     * Inovoked on mouse down
     * @param {Object} pointer
     */
    onMouseDown: function(pointer) {
      this._reset();
      this._fill(pointer);
    },

    /**
     * Inovoked on mouse move
     * @param {Object} pointer
     */
    onMouseMove: function(pointer) {
      this._fill(pointer);
    },
    /**
     * Invoked on mouse up
     */
    onMouseUp: function() {
      this.canvas.fire("draw:after",{
        target: this.getTarget() ,
        points: this._points.slice() ,
        color: this.getColor('source')
      });
    },
    _fill: function(pointer){
      pointer = {
        x: Math.floor(pointer.x),
        y: Math.floor(pointer.y)
      };

      if(_.findWhere(this._points,pointer)){
        return;
      }

      // this.getTarget().fillRect(pointer.x , pointer.y  ,1,1);
      var _data = this.getTarget().getImageData(pointer.x , pointer.y  ,1,1);
      pointer.color = Array.prototype.slice.call(_data.data);
      this._points.push(pointer);
      var _color = this.getColor('source');




      _data.data[0] = _color[0];
      _data.data[1] = _color[1];
      _data.data[2] = _color[2];
      _data.data[3] = _color[3];

      this.getTarget().putImageData(_data, pointer.x , pointer.y);
      this.canvas.renderAll();
    },
    undoPaintAction: function(_action){
      var ctx = _action.object;
      for(var i in _action.points){
        var _p  =_action.points[i], _c = _action.brush.getActionColor(_p.color);
        if(_c[3] == 0) {
          ctx.clearRect(_p.x,_p.y  ,1,1);
        }else{
          ctx.fillStyle = "rgba(" + _c[0] + "," + _c[1] + "," + _c[2] + "," + _c[3] +  ")";
          ctx.fillRect(_p.x,_p.y  ,1,1);
        }
      }
      _action.canvas.renderAll();
    },
    redoPaintAction: function(_action){

      var ctx = _action.object, _c = _action.brush.getActionColor(_action.color);
      var pts = _action.points;
      if(_c[3] == 0) {
        for(var i in pts){
          ctx.clearRect(pts[i].x,pts[i].y  ,1,1);
        }
      }else{
        ctx.fillStyle = "rgba(" + _c[0] + "," + _c[1] + "," + _c[2] + "," + _c[3] + ")";
        for(var i in pts){
          ctx.fillRect(pts[i].x,pts[i].y ,1,1);
        }
      }
      _action.canvas.renderAll();
    },
    /**
     * Clear points array and set contextTop canvas style.
     * @private
     */
    _reset: function() {
      this._points.length = 0;
      this.getTarget().fillStyle = this.color;
    },
    getHistoryRecord: function(event){

      return {
        canvas:   this.canvas,
        type:     "draw:pen",
        object:   event.target ,
        points:   event.points ,
        brush:   this,
        color:    event.color,
        undo:     this.undoPaintAction,
        redo:     this.redoPaintAction
      }
    }
  });

fabric.SlideCanvas.prototype.drawingTools.PaintPenBrush = {
  className: 'fa fa-paint-brush',
  title: 'Pen Brush'
};
fabric.SlideCanvas.prototype.activeDrawingTools.push("PaintPenBrush");

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 14 */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.PencilBrush.prototype.initialize = function(canvas) {
  this.callSuper('initialize', canvas);
  this._points = [ ];
};
fabric.PencilBrush.prototype.type = 'pencil-brush';

fabric.PencilBrush.prototype._render = function() {
  var ctx  = this.canvas.contextTop, v = this.canvas.viewportTransform, p1 = this._points[0], p2 = this._points[1];
  ctx.save();
  ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);
  ctx.beginPath();
  ctx.lineWidth = 1 / this.canvas.viewportTransform[0];
  if (this._points.length === 2 && p1.x === p2.x && p1.y === p2.y) {
    p1.x -= 0.5 / this.canvas.viewportTransform[0];
    p2.x += 0.5 / this.canvas.viewportTransform[0];
  }
  ctx.moveTo(p1.x, p1.y);
  for (var i = 1, len = this._points.length; i < len; i++) {
    var midPoint = p1.midPointFrom(p2);
    ctx.quadraticCurveTo(p1.x, p1.y, midPoint.x, midPoint.y);
    p1 = this._points[i];
    p2 = this._points[i + 1];
  }
  ctx.lineTo(p1.x, p1.y);
  ctx.stroke();
  ctx.restore();
};

fabric.PencilBrush.prototype.createPath = function(pathData) {
  var path = new fabric.Path(pathData, {
    stroke: this.getColor(),
    strokeWidth: this.width,
    application: this.canvas.application
  });
  if (this.shadow) {
    this.shadow.affectStroke = true;
    path.setShadow(this.shadow);
  }
  return path;
};
fabric.PencilBrush.prototype.minLength = 3;

fabric.PencilBrush.prototype.accuracy = 0;
fabric.PencilBrush.prototype._finalizeAndAddPath = function() {
  if(this._points.length < 2)return;
  var ctx = this.canvas.contextTop;
  ctx.closePath();
  this.canvas.clearContext(this.canvas.contextTop);
  if(this.accuracy){
    for(var i in this._points){
      this._points[i].x = +this._points[i].x.toFixed(this.accuracy);
      this._points[i].y = +this._points[i].y.toFixed(this.accuracy);
    }
    for(i = this._points.length - 1; i--; ){
      if(this._points[i].x == this._points[i + 1].x &&  this._points[i].y == this._points[i + 1].y){
        this._points.splice(i,1);
      }
    }
  }
  if(this._points.length < 2)return;
  var pathData = this.convertPointsToSVGPath(this._points).join('');
  if (this._points.length < this.minLength || pathData === 'M 0 0 Q 0 0 0 0 L 0 0') {
    return this.canvas.renderAll();
  }
  var path = this.createPath(pathData);
  this.canvas.add(path);
  path.setCoords();
  this._resetShadow();
  this.canvas.renderAll();
  this.canvas.fire('path:created', { path: path });
};


fabric.SlideCanvas.prototype.drawingTools.PencilBrush = {
  className: 'fa fa-pencil',
  title: 'Pencil Brush'
};
fabric.SlideCanvas.prototype.activeDrawingTools.push("PencilBrush");

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 15 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.PointsBrush = fabric.util.createClass(fabric.BaseBrush, {
  type: "points-brush",
  maximumPoints : 0,
  initialize: function (canvas) {
    this.callSuper('initialize', canvas);
    this.reset();
  },
  currentPoint : 1,
  getPoints: function(){
    return fabric.util.object.where(this.canvas._objects,{type: "material-point"});
  },
  checkPosition: null,
  onMouseDown: function (pointer) {

  },
  onMouseMove: function (pointer) {
  },
  reset: function(){
  },
  onMouseUp: function (pointer) {
    var _points = this.getPoints();

    var pos = {
      left: pointer.x -0.5,
      top: pointer.y  -0.5,
    };

    var _correct = this.checkPosition ? this.checkPosition(pointer) : true ;

    if(!_correct){
      this.canvas.fire("point:rejected",{point : pointer});
      return;
    }

    if(this.maximumPoints && _points.length >= this.maximumPoints){
      if(this.currentPoint > this.maximumPoints){
        this.currentPoint = 1;
      }
      if(this.wholeCoordinates){
        pointer.x = Math.round(pointer.x) + 0.5;
        pointer.y = Math.round(pointer.y)  + 0.5;
      }

      var _obj = fabric.util.object.findWhere(_points,{number : this.currentPoint++});

      var states = {
        original : {
          left: _obj.left,
          top: _obj.top
        },
        modified:  {
          left: pointer.x - 0.5,
          top: pointer.y - 0.5
        }
      };

      _obj.set(states.modified).setCoords().fire("modified",{states: states});
      this.canvas.fire("object:modified",{target : _obj, states: states});
      this.canvas.setActiveObject(_obj);
      this.canvas.renderAll();
      return;
    }else{
      this.currentPoint = 1;
      while(fabric.util.object.findWhere(_points,{number : this.currentPoint})){
        this.currentPoint++;
      }
    }

    var _obj = new fabric.MaterialPoint({
      number: this.currentPoint ,
      application: this.canvas.application,
      left: pos.left,
      top: pos.top
    });

    this.currentPoint++;
    this.canvas.add(_obj);
    this.canvas.fire("point:created",{point : _obj})
    this.canvas.setActiveObject(_obj);
    this.canvas.renderAll();
  },
  _render: function () {
  }
});

fabric.SlideCanvas.prototype.drawingTools.PointsBrush = {
  className: 'fa fa-circle-o',
  title: 'Points Brush'
};

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 16 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {


  /**
   * PencilBrush class
   * @class fabric.RectangleBrush
   * @extends fabric.BaseBrush
   */
  fabric.PolygonBrush = fabric.util.createClass(fabric.BaseBrush, /** @lends fabric.RectangleBrush.prototype */ {
    resultObjectType: "Polyline",
    type: "polygon-brush",
    virtualObject: false,
    maximumPoints : 0,
    individualDrawing: true,
    /**
     * Constructor
     * @param {fabric.Canvas} canvas
     * @return {fabric.RectangleBrush} Instance of a pencil brush
     */
    initialize: function (canvas) {
      this.callSuper('initialize', canvas);
      this.reset();
    },
    /**
     * Inovoked on mouse down
     * @param {Object} pointer
     */
    onMouseDown: function (pointer) {


      if(this.individualDrawing || !this.target){
        var _point = {x: pointer.x, y: pointer.y};
        this.points.push(_point);
        if(!this.virtualObject){
          this.target = this.canvas.createObject(
            fabric.util.object.extend({},
              this.resultObjectProperties, {
                type: this.resultObjectType,
                points: [_point],
                active: true
              }
            )
          );
        }
      }else{
        this._create_active_point(pointer);
      }

      if(this.virtualObject) {
        this._setBrushStyles();
        this._setShadow();
        this._render();
      }else{
        this.canvas.renderAll();
      }
    },

    _create_active_point: function (pointer) {
      var _point = {x: pointer.x, y: pointer.y};
      this.activePoint =  _point;
      this.activeTargetPoint =  {x: pointer.x - this.target.left, y : pointer.y - this.target.top};
      this.points.push(this.activePoint);
      this.target.addPoint(this.activeTargetPoint);
    },
    /**
     * Inovoked on mouse move
     * @param {Object} pointer
     */
    onMouseMove: function (pointer) {


      var _p =  {x: pointer.x - this.target.left, y : pointer.y - this.target.top};


      if(this.activePoint){
        this.activePoint.x = pointer.x;
        this.activePoint.y = pointer.y;
        var _order = this.target.points.length ;

        this.target.setPoint("p" + _order, {
          x : pointer.x - this.target.left,
          y : pointer.y - this.target.top
        });
      }else{
        var _dist = fabric.Point.prototype.distanceFrom.call(this.points[0],_p)
        if(_dist > 10){
          this._create_active_point(pointer);
        }
      }
      this.canvas.renderAll();
    },
    reset: function(){
      this.points = [];
      this.target = null;
      this.activePoint = null;
      this.activeTargetPoint = null;
    },
    /**
     * Invoked on mouse up
     */
    onMouseUp: function () {
      this.target.updateBbox();
      if(this.points.length == this.maximumPoints){
        this.reset();
      }
      this.activePoint = null;
      this.canvas.renderAll();
    },

    /**
     * Draw a smooth path on the topCanvas using quadraticCurveTo
     * @private
     */
    _render: function () {
      this.canvas.fire("before:brush:render",{target: this});

      var ctx = this.canvas.contextTop,
        v = this.canvas.viewportTransform;

      ctx.save();
      ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);

      var _klass_proto = fabric[this.resultObjectType].prototype;

      ctx.lineWidth = _klass_proto.strokeWidth;
      ctx.strokeStyle = _klass_proto.stroke;
      ctx.fillStyle = _klass_proto.fill;

      ctx.beginPath();
      ctx.moveTo(this.points[0].x,this.points[0].y);
      for(var i = 1; i < this.points.length; i++){
        ctx.lineTo(this.points[i].x,this.points[i].y)
      }
      ctx.closePath();
      ctx.fill();
      ctx.stroke();
      ctx.restore();
      this.canvas.fire("brush:render",{target: this})
    },
    drawingLimits: null, /*{
      left: 0,
      width: 0,
      height: 0,
      top: 0
    },*/
    minHeight: 50,
    minWidth: 50,
    _checkRectangle: function(_rect){


      var dl = this.drawingLimits;
      if(dl && dl == "backgroundImage"){
        dl= this.canvas.backgroundImage;
      }

      _rect = {
        left: _rect.left,
        top: _rect.top,
        width: _rect.width,
        height: _rect.height,
      };

      _rect.left  -= fabric.Rect.prototype.strokeWidth / 2;
      _rect.top   -= fabric.Rect.prototype.strokeWidth / 2;

      if(dl){
        if(_rect.left + _rect.width < dl.left ||
          _rect.top  + _rect.height < dl.top ||
          _rect.left > dl.width ||
          _rect.top > dl.height){
          return false;
        }

        if(_rect.top < dl.top){
          _rect.height +=_rect.top ;
          _rect.top = dl.top;
        }
        if(_rect.left < dl.left){
          _rect.width += _rect.left;
          _rect.left = dl.left;
        }
      }

      if(this.minWidth && _rect.width < this.minWidth){
        _rect.width = this.minWidth;
      }
      if(this.minHeight && _rect.height < this.minHeight){
        _rect.height = this.minHeight;
      }


      if(dl) {
        var _xdiff = _rect.left + _rect.width - dl.width;
        if (_xdiff > 0) {
          _rect.width -= _xdiff;
          if (this.minWidth && _rect.width < this.minWidth) {
            _rect.left -= this.minWidth - _rect.width;
            _rect.width = this.minWidth;
          }
        }
        var _ydiff = _rect.top + _rect.height - dl.height;
        if (_ydiff > 0) {
          _rect.height -= _ydiff;
          if (this.minHeight && _rect.height < this.minHeight) {
            _rect.top -= this.minHeight - _rect.height;
            _rect.height = this.minHeight;
          }
        }
      }
      return _rect;
    },
    resultObjectProperties: {}
  });


fabric.SlideCanvas.prototype.drawingTools.PolygonBrush = {
  icon: 'data:image/png;base64,'+ __webpack_require__(62),
  title: 'Polygon Brush'
};
fabric.SlideCanvas.prototype.activeDrawingTools.push("PolygonBrush");



/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 17 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {


/**
 * PencilBrush class
 * @class fabric.RectangleBrush
 * @extends fabric.BaseBrush
 */
fabric.RectangleBrush = fabric.util.createClass(fabric.BaseBrush, /** @lends fabric.RectangleBrush.prototype */ {
  resultObjectType: "Rect",
  type: "rectangle-brush",
  /**
   * Constructor
   * @param {fabric.Canvas} canvas
   * @return {fabric.RectangleBrush} Instance of a pencil brush
   */
  initialize: function (canvas) {
    this.callSuper('initialize', canvas);
  },

  /**
   * Inovoked on mouse down
   * @param {Object} pointer
   */
  onMouseDown: function (pointer) {
    //prepare for drawing
    delete this.p2;

    this.p1 = new fabric.Point(pointer.x, pointer.y);
    this._setBrushStyles();
    this._setShadow();
    this.canvas.contextTop.moveTo(this.p1.x, this.p1.y);
    this._render();
  },

  /**
   * Inovoked on mouse move
   * @param {Object} pointer
   */
  onMouseMove: function (pointer) {

    this.p2 = new fabric.Point(pointer.x, pointer.y);

    if(this.drawingObject){
      var _rect = this._getRect();
      this.drawingObject.set(_rect);
      this.drawingObject.fire("scaling");
    }else{

      if (this.p1.x === this.p2.x && this.p1.y === this.p2.y) {
        delete this.p2;
      } else {

        if(this.resultObjectType){
          var _rect = this._getRect();
          this.drawingObject = this._createRectangle(_rect);
        }
      }
    }
    this.canvas.renderLayer("lower");
  },

  /**
   * Invoked on mouse up
   */
  onMouseUp: function () {
    if(this.drawingObject){
      var _rect = this._getRect();
      var _rect2 = this._checkRectangle(_rect);

      this.canvas.layers.lower.objects.splice(this.canvas.layers.lower.objects.indexOf(this.drawingObject), 1);

      this.drawingObject.set(_rect2);
      this.canvas.add(this.drawingObject);
      this.canvas.setActiveObject(this.drawingObject);
      this.drawingObject.setCoords();
      delete this.drawingObject;
    }
    this.canvas.renderAll();
    // this._finalizeAndAddPath();
  },

  /**
   * Draw a smooth path on the topCanvas using quadraticCurveTo
   * @private
   */
  _render: function () {
    this.canvas.fire("before:brush:render",{target: this})
    if (!this.p2) {
      return;
    }
    var ctx = this.canvas.contextTop,
      v = this.canvas.viewportTransform,
      p1 = this.p1,
      p2 = this.p2;

    ctx.save();
    ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);
    ctx.beginPath();
    if(this.application){
      var _klass_proto = this.application.getDefaultProperties(fabric[this.resultObjectType].prototype) || {};
      ctx.lineWidth = _klass_proto.strokeWidth;
      ctx.strokeStyle = _klass_proto.stroke;
      ctx.fillStyle = _klass_proto.fill;
    }

    var _rect = this._getRect();
    ctx.rect(_rect.left, _rect.top, _rect.width, _rect.height);

    ctx.fill();
    ctx.stroke();
    ctx.restore();
    this.canvas.fire("brush:render",{target: this})
  },
  _getRect: function () {

    var x1, x2, y1, y2;
    if (this.p1.x < this.p2.x) {
      x1 = this.p1.x, x2 = this.p2.x;
    } else {
      x2 = this.p1.x, x1 = this.p2.x;
    }
    if (this.p1.y < this.p2.y) {
      y1 = this.p1.y, y2 = this.p2.y;
    } else {
      y2 = this.p1.y, y1 = this.p2.y;
    }
    return {
      left: x1,
      top: y1,
      width: x2 - x1,
      height: y2 - y1
    };
  },
  drawingLimits: null, /*{
   left: 0,
   width: 0,
   height: 0,
   top: 0
   },*/
  minHeight: 50,
  minWidth: 50,
  _checkRectangle: function(_rect){


    var dl = this.drawingLimits;
    if(dl && dl == "backgroundImage"){
      dl= this.canvas.backgroundImage;
    }

    _rect = {
      left: _rect.left,
      top: _rect.top,
      width: _rect.width,
      height: _rect.height,
    };

    // _rect.left  -= fabric.Rect.prototype.strokeWidth / 2;
    // _rect.top   -= fabric.Rect.prototype.strokeWidth / 2;

    if(dl){
      if(_rect.left + _rect.width < dl.left ||
        _rect.top  + _rect.height < dl.top ||
        _rect.left > dl.width ||
        _rect.top > dl.height){
        return false;
      }

      if(_rect.top < dl.top){
        _rect.height +=_rect.top ;
        _rect.top = dl.top;
      }
      if(_rect.left < dl.left){
        _rect.width += _rect.left;
        _rect.left = dl.left;
      }
    }

    if(this.minWidth && _rect.width < this.minWidth){
      _rect.width = this.minWidth;
    }
    if(this.minHeight && _rect.height < this.minHeight){
      _rect.height = this.minHeight;
    }


    if(dl) {
      var _xdiff = _rect.left + _rect.width - dl.width;
      if (_xdiff > 0) {
        _rect.width -= _xdiff;
        if (this.minWidth && _rect.width < this.minWidth) {
          _rect.left -= this.minWidth - _rect.width;
          _rect.width = this.minWidth;
        }
      }
      var _ydiff = _rect.top + _rect.height - dl.height;
      if (_ydiff > 0) {
        _rect.height -= _ydiff;
        if (this.minHeight && _rect.height < this.minHeight) {
          _rect.top -= this.minHeight - _rect.height;
          _rect.height = this.minHeight;
        }
      }
    }
    return _rect;
  },
  _createRectangle: function(rect){
    this.canvas.setActiveObject(false);
    rect.active = true;
    rect.application = this.application;
    rect.canvas = this.canvas;
    var _object = fabric.util.createObject(this.resultObjectType,rect);
    this.canvas.layers.lower.objects.push(_object);
    _object.updateResponsiveBorder();
    this.canvas.renderAll();
    return _object;
  }

  /**
   * On mouseup after drawing the path on contextTop canvas
   * we use the points captured to create an new fabric rect object
   * and add it to the fabric canvas.
   */
  // _finalizeAndAddPath: function () {
  //
  //   if (!this.p2) {
  //     return false;
  //   }
  //   var ctx = this.canvas.contextTop;
  //   ctx.closePath();
  //
  //
  //   this.canvas.clearContext(this.canvas.contextTop);
  //   this._resetShadow();
  //
  //   // var _rect = this._getRect();
  //   var _rect2 = this._checkRectangle(_rect);
  //   if(_rect2){
  //     // if(this.resultObjectType){
  //     //   this._createRectangle(_rect2);
  //     // }
  //     this.canvas.fire('rect:created', {rect: _rect2, original: _rect});
  //   }else{
  //     this.canvas.fire('rect:rejected', {rect: _rect});
  //   }
  //   this.canvas.renderLayer(this.layers.lower);
  // }
});


fabric.SlideCanvas.prototype.drawingTools.RectangleBrush = {
  className: 'fa fa-pencil-square',
  title: 'select-brush'
};
fabric.SlideCanvas.prototype.activeDrawingTools.push("RectangleBrush");

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 18 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

/**
 * # Application
 *
 * farbic.app function is the entry point of FabricJS application.
 * Application could be initialised with configuration object. Different extensions allows to initialize special application attributes such as *object prototypes*, *resizable canvas*, *available fonts*, etc.
 *
 * ### option: util
 * mediaRoot - root directory for all media files in fabric application
 *
 * ### option: resizable
 * makes canvas responsible. Canvas will be scaled to 100% of its container size
 *
 * ### option: onResize
 * function which override deafult canvas resize behavior.
 *
 * ### option: callback
 * function calls after canvas initialized
 *
 * ### option: initialize
 * function calls before canvas initialize
 *
 * @example
 *
 * new fabric.Application({
 *      resizable: true,
 *      onResize: function(){},
 *      util: {
 *        mediaRoot: '../../media/'
 *      },
 *      canvasContainer: "fiera-canvas",
 *      prototypes: {},
 *      objects: {},
 *      eventListeners: {},
 *      callback: function(){},
 *      initialize:  function(){}
 *      customPublicApplicationFunction: function(){},
 *      customPublicApplicationAttribute: value
 *  })
 *
 */

fabric.Application = function(options) {
  this.init(options);
};

fabric.Application.prototype = fabric.util.object.extend({},fabric.Observable,{
  defaultOptions: {
    /**
     * id of target canvas element
     */
    canvasContainer: null
  },
  credentials: false,
  ready : false,
  canvasClass: 'Canvas',
  optionsOrder: [
    "canvasContainer",
    "*",
    "objects",
    "slide"
  ],
  plugins: {
    preloaders: [],
    configuration: [],
    canvas: []
  },
  /**
   * Additional Event Listeners couldbe used to detect activeobject changes
   *  - canvas:created
   *  - entity:load - Event fired on creation of every new fabric instance(canvas,brush,object)
   *
   *  @example
   *  'entity:load' : function(e){
   *     if(e.options.boxType == 'machine') {
   *       e.options.type = "machine-mask-rectangle";
   *     }
   *   }
   */
  eventListeners: {
    "canvas:created": [],
    "entity:created": [
      function(e){
        if(e.target.eventListeners){
          for(var i in e.target.eventListeners) {
            var _listeners = e.target.eventListeners[i];
            if(_listeners.constructor == Array){
              for (var j in _listeners) {
                e.target.on(i, _listeners[j]);
              }
            }else{
              e.target.on(i, _listeners);
            }
          }
        }

        if(e.options.eventListeners){
          for(var i in e.options.eventListeners){
            e.target.on(i,e.options.eventListeners[i]);
          }
        }
        delete e.options.eventListeners;

        if(e.target._default_event_listeners){
          for(var i in e.target._default_event_listeners){
            e.target.on(i,e.target._default_event_listeners[i]);
          }
        }
      }
    ]
  },
  onSlideLoaded: function () {},
  onCanvasCreated: function () {},
  callback: function () {},

  init: function(options){
    this.initEventListeners();
    options =  fabric.util.object.deepExtend({},this.defaultOptions ,options || {});

    this.fire("loading:begin",{options : options});

    this._options = options;


    $( document ).ready(function(){
      fabric.util.order([
        this.preloader,
        this.loadConfiguration,
    //    this.createApp,
        this.initOptions,
        this.initialize,
        this.onApplicationCreated,
        this.postloader,
        this.callback && function(){
          setTimeout(this.callback.bind(this),0);
        },
        function(){
          this.fire("ready");
        }.bind(this)
      ],this)
    }.bind(this))
  },
  onApplicationCreated: function(){
    this.ready = true;
    this.fire("loading:end",{});
  },
  setCredentials: function(credentials){
    if(credentials){
      console.info("%cFiera Canvas Editor%c by %cDenis Ponomarev%c %c%6$s%c / %c%9$s%c", "color: #ffa500", "color: #202020", "color: #2EC06C", "color: #202020", "color: #337ab7", "www.hometlt.ru", "color: #202020", "color: #337ab7", "ponomarevtlt@gmail.com", "color: #202020");
    }
  },
  initOptions: function (resolve,error) {
    this.set(this._options,resolve);
  },
  loadConfiguration: function (resolve,error) {
    if(!this._options.configuration){
      return resolve();
    }
    var _app = this;
    fabric.util.promise
      .map(
        this._options.configuration,
        function(value){
          return new Promise(function(resolve,fail) {
            fabric.util.data.loadJson(value,resolve,fail);
          });
        }
      )
      .then(function(results){
        fabric.util.object.extend(_app._options,results)
      })
      .then(resolve,error);
  },
  setCanvasContainer: function (canvasContainer) {
    this.canvasContainer = canvasContainer;

    if (canvasContainer.constructor == String) {
      var el = document.getElementById(canvasContainer);
    } else {
      el = canvasContainer;
    }
    this.canvas = new fabric[this.canvasClass](el, {application: this});
    // }else{
    //   this.canvas = new fabric[this.canvasClass]({application: this});
    // }

    this.fire("canvas:created");
    this.onCanvasCreated();
  },
  dispose: function(){
    this.canvas.dispose();
  },

  //--------------------------------------------------------------------------------------------------------------------
  // Event Listeners
  //--------------------------------------------------------------------------------------------------------------------

  setEventListeners: function(val){
    this.on(val);
  },
  initEventListeners: function(){
    if(!this.__eventListeners){
      this.__eventListeners = {};
    }
    for (var event in this.eventListeners) {
      if(!this.__eventListeners[event]){
        this.__eventListeners[event] = []
      }
      this.__eventListeners[event] = this.__eventListeners[event].concat (this.eventListeners[event]);
    }
  },

  //--------------------------------------------------------------------------------------------------------------------
  //
  __set : fabric.Object.prototype.__set,
  _setObject: fabric.Object.prototype._setObject,
  set: fabric.Object.prototype.set,
  setOptions: fabric.Object.prototype.setOptions,
  actions: {
    save: {
      title: "save project",
      className: 'fa fa-floppy-o',
      action: function () {
        var data = this.toObject();
        this.application.api.save(data);
      }
    }
  }
});

// fabric.Application.addPlugin = fabric.PluginsMixin.addPlugin.bind(fabric.Application);

fabric.app = function(options){
  return new fabric.Application(options);
};


/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 19 */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(fabric) {/**
 * # Prototypes

 Prototypes allows to define **prototypes** property in Application configuration.

 ```javascript
 Application ({
  prototypes: {
    ClassName: options
  }
 })
 ```

 If prototype is defined every new Object created by application will have this properties by default.

 ```javascript
   NewClass: {
    $super: "ParentClass",
    type: "new-class",
    \/*other properties and methods*\/
   }
  ```

 if property **type** of Object class is defined then every object be default will have this type.

 ```javascript
   Object: {
    type: "rectangle"
   }
 ...
 //rectangle will be created
 fabric.createObject({width:100, height: 100})
 ```
*/






fabric.util.object.extend(fabric.Application.prototype, {
  optionsOrder: (function(){
    var oo = fabric.Application.prototype.optionsOrder;
    oo.splice(oo.indexOf("canvasContainer"),0,"prototypes");
    return oo;
  })(),
  getDefaultProperties: function(proto){
    if(!this.prototypes)return;

    var klassname = fabric.util.string.capitalize(fabric.util.string.camelize(proto.type),true);

    var _protoProperties = proto.__proto__ && proto.__proto__.type && this.getDefaultProperties(proto.__proto__) || {};
    var _defaultProperties = fabric.util.object.clone(this.prototypes[klassname]);

    fabric.util.object.extend(_protoProperties,_defaultProperties);

    return _protoProperties;
  },
  /**
   * default prototypes propertes for objects
   */
  prototypes: {
    Object: {
      includeDefaultValues: false
    },
    Canvas: {
      includeDefaultValues: false
    }
  },
  setUtils: function (utilsOptions) {

    if(!utilsOptions){
      return;
    }
    fabric.util.object.extend(this.util || {},utilsOptions);

    if (this.options['util']) {
      fabric.util.object.extend(fabric.util, this.options['util']);
    }
    if (this.options['fabric']) {
      fabric.util.object.extend(fabric, this.options['fabric']);
    }
    delete this.options['fabric'];
    delete this.options['util'];
  },
  setPrototypes: function (prototypes) {

    var _prototypes = fabric.util.object.deepExtend({}, this.prototypes ,prototypes);

    this.prototypes = _prototypes;
    this.klasses = {};


    if(_prototypes.eventListeners){
      _prototypes.eventListeners.$extend = 'array';
    }

    for (var klassName in _prototypes) {
      var _proto = _prototypes[klassName];

      for (var j in _proto) {
        if (_proto[j] && _proto[j]["$extend"]) {
          var _extend = _proto[j]["$extend"];
          if( _extend == "array"){
            _proto[j] = fabric.util.object.extendArraysObject(fabric[klassName].prototype[j],_proto[j]);
          } else if( _extend == "deep"){
            _proto[j] = fabric.util.object.deepExtend(fabric[klassName].prototype[j],_proto[j]);
          }else{
            _proto[j] = fabric.util.object.extend(fabric[klassName].prototype[j],_proto[j]);
          }
          delete _proto[j]["$extend"];
        }
      }


      if(_proto["$super"]){
        var _superklass = fabric[_proto["$super"] || klassName] ;
        delete _proto["$super"];

        var _fromObject = _proto.fromObject || _superklass.fromObject ;
        delete _proto.fromObject;
        var _klass = this.klasses[klassName] = fabric.util.createClass(_superklass, _proto);
        _klass.fromObject = _fromObject.bind(_klass);
      }

    //   if (klassName.actions && _proto.actions.constructor == Function) {
    //     fabric[klassName].prototype.actions = _proto.actions.call(fabric[klassName].prototype)
    //   }
    }

    if (_prototypes.Application) {
      fabric.util.object.deepExtend(this, _prototypes.Application);
    }

    // delete this.options['prototypes'];

    if (this.actions && this.actions.constructor == Function) {
      this.actions = this.actions.call(this)
    }
  },
  eventListeners: fabric.util.object.extendArraysObject(fabric.Application.prototype.eventListeners, {
    "entity:created": function (e) {
      var target = e.target;

      target.application = this;
      fabric.util.object.defaults(e.options, this.getDefaultProperties(target, e.options));

      for (var key in e.options) {
        var value = e.options[key];
        if (key[0] == "+") {
          var _key = key.substr(1);
          var _arr = target.get(_key);
          if (_arr instanceof Array) {
            _arr = _arr.slice().concat(value);
          } else {
            _arr = fabric.util.object.extend({}, _arr, value);
          }
          e.options[_key] = _arr;
          delete e.options[key];
        }
      }

      delete e.options.type;
      delete e.options.application;
    }
  })
});



/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 20 */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(fabric) {
fabric.Slide = function(application, slide){


  if(fabric.isLikelyNode){
    // fabric.Canvas = fabric.SlideCanvas;
    var w = slide.slideWidth; //todo|| slide.template.width;
    var h = slide.slideHeight;//todo || slide.template.height;
    var zoom = fabric.SlideCanvas.prototype.zoom || 1;
    this.canvas = fabric.createCanvasForNode(w * zoom,h * zoom);
  }else{
    this.canvas =  new fabric.SlideCanvas({application: application, interactive: false});
  }

  this.object = slide;
 // this.data = slide.data;
  this.application = application;
  this.id = ++ fabric.Slide._slides_id_counter;
};

fabric.Slide.prototype = fabric.util.object.extend({},fabric.Observable,{
  title : 'Новый Слайд'
});

fabric.Slide._slides_id_counter = 1;


fabric.util.object.extend(fabric.Application.prototype, {
  defaultOptions: fabric.util.object.extend(fabric.Application.prototype.defaultOptions,{
    activeSlide: 0
  }),
  optionsOrder: (function(){
    var oo = fabric.Application.prototype.optionsOrder;
    oo.push("activeSlide","slides");
    return oo;
  })(),
  activeSlide: 0,
  /*initialize: function (options) {

   fabric.util.object.extend(this, {
   last_id: 1,
   scaleValue: 1,
   activeSlide: null,
   history: null,
   slides: [],
   canvas: null
   });

   this.aligmentLineX = false;
   this.aligmentLineY = false;

   fabric.util.object.extend(this,options);
   fabric.util.object.defaults(options,this.defultOptions);

   // this.setAccess(this.access);

   if(options.gridsnapper !== undefined) {
   this.gridsnapper = options.gridsnapper
   }
   if(options.history !== undefined) {
   this.history = options.history;
   }
   if(options.data){
   this.data = options.data;
   }
   if(this.history) {
   this.history = new History(this);
   this.history.application = this.application;
   }


   if(options.canvas){
   var _canvas = new fabric.SlideCanvas(document.getElementById(options.canvas));
   _canvas.application = this.application;
   _canvas.project = this;
   this.setCanvas(_canvas);
   }

   return this;
   },*/
  setSlides: function (slides) {
    slides = fabric.util.object.cloneDeep(slides);
    this.slides = [];

    if (this.canvas) {
      this.canvas._objects.length = 0;
    }

    slides.forEach(function(slide){
      this.addSlide(slide)
    }.bind(this));

    this.preload();
    this.lazyLoad();
  },
  setActiveSlide: function(slideId){
    // console.log("@#");
    return;

    if(this.canvas.processing)return;
    if(this.activeSlide === slide)return;

    this.fire("slide:change:begin", {canvas: this.canvas});
    if(this.activeSlide) {
      delete this.activeSlide.canvas.mirrorSlide;
    }

    this.processing =true;
    if (this.unloadUnactiveSlides && this.canvas && this.activeSlide) {
      delete this.activeSlide.canvas;
      this.activeSlide.fire("canvas:changed",{canvas: null});
      this.activeSlide.data = this.canvas.toObject();
      this.canvas.clear();
    }
    this.activeSlide = slide;
    this.activeSlide.canvas.mirrorSlide = this.canvas;



    var _this = this;
    this.canvas.processing = true;

    if(this.activeSlide.canvas.loaded){
      _this.canvas.mirror(_this.activeSlide.canvas);
      _this.canvas.processing = false;
      _this.canvas.renderAll();
      _this.fire("slide:changed", {canvas: _this.canvas});
      _this.lazyLoad();
    }else{

      // _this.canvas.fire("loading:begin",{type:"current" , target: _this.canvas});
      this.activeSlide.canvas.load(slide.object, function () {
        _this.canvas.mirror(_this.activeSlide.canvas);
        _this.canvas.processing = false;
        _this.canvas.renderAll();
        _this.fire("slide:changed", {canvas: _this.canvas});
        // _this.canvas.fire("loading:end",{type:"current" , target: _this.canvas});
        _this.lazyLoad();
      });
    }
  },
  unloadUnactiveSlides: false,
  lazyLoadEnabled: true,
  lazyLoad: function(){

    var app = this;
    if(this.lazyLoadEnabled){
      this.slides.forEach(function(slide){
        if(!slide.canvas.loaded && !slide.canvas.processing){
          slide.canvas.load(slide.object,function(){
            slide.fire("loaded");
            if(app.activeSlide == slide.id){
              this.setActiveSlide(slide);
            }

            app.fire("slide:loading:end", {target: this});

            for(var _s in app.slides){
              if(!app.slides[_s].canvas.loaded){
                return;
              }
            }
            app.fire("loading:end", {});
          }.bind(slide));
        }
      });
    }else{
      app.fire("loading:end",{});
    }
  },
  addSlide: function (options) {
    var slide = new fabric.Slide(this, options);
    this.slides.push(slide);
    return slide;
  },
  removeSlide: function (slide) {
    var _s = this.slides;
    var _curPos = _s.indexOf(slide);
    _s.splice(_curPos, 1);

    if(slide == this.activeSlide){
      delete this.activeSlide ;
    }
  },
  /**
   * move slide to another position
   * @param slide
   * @param newPosition
   */
  moveSlide: function (slide,newPosition) {
    var _s = this.slides;

    var _curPos = _s.indexOf(slide);
    newPosition = parseInt(newPosition);

    if (_curPos < newPosition) {
      _s.splice(_curPos, 1);
      _s.splice(newPosition,0, slide);
    } else {
      _s.splice(_curPos, 1);
      _s.splice(newPosition, 0, slide);
    }
  },
  /**
   * replace slide
   * @param slide
   * @param newPosition - position of the second slide
   */
  replaceSlide: function (slide,newPosition) {
    var _s = this.slides;
    var _replacedSlide = _s[newPosition];
    var _curPos = _s.indexOf(slide);
    if (_curPos < newPosition) {
      _s.splice(newPosition, 1, slide);
      _s.splice(_curPos, 1, _replacedSlide);
    } else {
      _s.splice(_curPos, 1, _replacedSlide);
      _s.splice(newPosition, 1, slide);
    }
  },

  preload: function(){
    for(var i in this.slides) {
      var _slide = this.slides[i];
      // _slide.canvas.preload(_slide.object, function () {
      //   _slide.fire("modified");
      // });
    }
  },

  setActiveSlideByIndex: function(index){
    this.setActiveSlide(this.slides[index])
  },
  setActiveSlideById: function(id){
    this.setActiveSlide(  fabric.util.object.findWhere(this.slides,{id: id}));
  },
  duplicateSlide: function (slideData) {
    slideData = slideData.canvas.toObject();
    var _slide = this.addSlide(slideData);
    _slide.canvas.load(_slide.object);
  },

  nextSlide: function () {
    var i = this.slides.indexOf(this.activeSlide);
    if (i < this.slides.length - 1) {
      this.setActiveSlide(i + 1);
    }
  },
  prevSlide: function () {
    var i = this.slides.indexOf(this.activeSlide);
    if (i > 0) {
      this.setActiveSlide(i - 1);
    }
  },
  gotoSlide: function (slide) {
    this.setActiveSlide(slide - 1);
  },
  nextSlideAvailable: function () {
    var i = this.slides.indexOf(this.activeSlide);
    return i < this.slides.length - 1
  },
  prevSlideAvailable: function () {
    var i = this.slides.indexOf(this.activeSlide);
    return i > 0
  },

});


fabric.util.object.extend(fabric.SlideCanvas.prototype, {
  /**
   * Copy the content of active slide to main canvas.
   * @param slide
   */
  mirror: function (slide) {
    this.discardActiveGroup();
    this.discardActiveObject();
    // this.slideWidth = slide.slideWidth;
    // this.slideHeight = slide.slideHeight;
    this.setOriginalSize({width: slide.originalWidth || slide.width, height: slide.originalHeight || slide.height})
    this.backgroundImage = slide.backgroundImage;

    if(this.resizable) {
      this.originalWidth  = slide.originalWidth;
      this.originalHeight  = slide.originalHeight ;
    }else{
      this.setWidth((slide.originalWidth || slide.width)* this.viewportTransform[0]);
      this.setHeight((slide.originalHeight || slide.height)  * this.viewportTransform[0]);
    }
    this._onResize();
    this.activeArea = slide.activeArea;
    this.originalSlide = slide;

    this.template = slide.template;
    this.offsets = slide.offsets;
    // this._objects = [];
    // this.layers = slide.layers;

    if(this.backgroundImage){
      this.backgroundImage.canvas = this;
    }
    //todo
    // if(this._backgroundLayer) {
    //   for (var i in this._backgroundLayer) {
    //     this._backgroundLayer[i].canvas = this;
    //     this._backgroundLayer[i].setCoords();
    //   }
    //   this.setActiveArea(true);
    // }cd fier

    for(var layerName in slide.layers) {
      this.layers[layerName].objects = [];
    }
    this._objects = this.layers.lower.objects;

    if(slide.layers) {
      for(var layerName in slide.layers){
        for (var i in slide.layers[layerName].objects) {
          this.add(slide.layers[layerName].objects[i]);
        }
        slide.layers[layerName].objects = this.layers[layerName].objects;
      }
      slide._objects = this._objects;
    }else{
      if(slide._objects) {
        for (var i in slide._objects) {
          this.add(slide._objects[i]);
        }
      }
      slide._objects = this._objects;
    }
    var _this = this;
    slide.on('object:added',function(e){
      _this.add(e.target);
    });
    this.fire('changed', {target: slide})
  },
  project: null,
  unique: false,
  required: false,
  stateProperties: ["unique","required"],
  removeSlide: function(){
    this.project.removeSlide(this)
  },
  duplicateSlide: function(){
    this.project.duplicateSlide(this)
  }
});

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 21 */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(fabric) {


if(!Object.values){
  Object.defineProperty(Object, 'values', {
    enumerable: false,
    configurable: false,
    writable: false,
    value: function(_object) {
      var _values = [];
      Object.keys(_object).forEach(function (key) {
        _values.push(_object[key]);
        // use val
      });
      return _values;
    }
  });
}


fabric.util.object.extend(fabric,{
  errors: []
});

fabric.util.order = function(_array,context ){
  (function _call(){
    if(!_array.length)return;
    var foo = _array.shift();
    if(foo){
      if(foo.length){
        foo.call(context,_call);
      }else{
        foo.call(context);
        _call();
      }
    }else{
      _call();
    }
  })()
};

fabric.util.promise = {
  map: function (data, foo) {

    if(data.constructor == Array){
      return Promise.all(data.map(foo))
        .then(function (results, error) {
          if (error) {
            return Promise.reject(error);
          }
          return Promise.resolve(results);
        })
    }

    var keys = Object.keys(data);
    var urls = Object.values(data);
    return Promise.all(urls.map(foo))
      .then(function (results, error) {
        if (error) {
          return Promise.reject(error);
        }
        var _map = {};

        for(var i = 0 ; i < results.length; i++){
          _map[keys[i]] = results[i];
        }
        return Promise.resolve(_map);
      })
  },
  wrap: function (context) {
    return function wrap(foo) {
      return function () {
        var options = Array.prototype.slice.call(arguments,1);
        if (!foo.length) {
          return new Promise(function (resolve, fail) {
            var _result = foo.call(context);
            (_result || _result === undefined) ? resolve() : fail();
          });
        } else {
          return new Promise(foo.bind(context));
        }
      }
    }
  }
};

fabric.Object.prototype.set = function(key, value) {
  if (typeof key === 'object') {
    this._setObject(key, value);
  }
  else {
    if (typeof value === 'function' && key !== 'clipTo') {
      this._set(key, value(this.get(key)));
    }
    else {
      this._set(key, value);
    }
  }
  return this;
};

fabric.Object.prototype._setObject = function(options,callback) {
  var keys = Object.keys(options);
  if(this.optionsOrder){
    var middleIndex = this.optionsOrder.indexOf("*") || -1;

    var i = middleIndex, prop , keyIndex;

    while((prop = this.optionsOrder[--i])){
      if((keyIndex = keys.indexOf(prop)) !== -1){
        keys.splice(keyIndex, 1);
        keys.unshift(prop);
      }
    }
    i = middleIndex;
    while(prop = this.optionsOrder[++i]){
      if((keyIndex = keys.indexOf(prop)) !== -1){
        keys.splice(keyIndex, 1);
        keys.push(prop);
      }
    }

  }
  for (var i = 0; i < keys.length; i++) {
    var prop = keys[i];
    if(typeof options[prop] == "function"){
      keys.splice(i, 1);
      keys.unshift(prop);
    }
  }
  var queue;
  for (var i in keys) {
    var _key = keys[i];
    if(options[_key] === undefined || options[_key] === null)continue;
    var _fooName = "set" + fabric.util.string.capitalize(_key, true);
    if(this[_fooName] && this[_fooName].name && this[_fooName].name != "anonymous"){
      if(this[_fooName].length == 2){
        if(!queue){
          queue = fabric.util.queueLoad(2,callback);
        }else{
          queue.total ++;
        }
        this[_fooName](options[_key],function(_key){
          queue();
        }.bind(this,_key));
      }else{
        this[_fooName](options[_key])
      }
    } else {
      this.__set(_key, options[_key]);
    }
  }
  if(queue){
    queue()
  }else if(callback ){
    callback();
  }
};

var _get_pointer_overwritten = fabric.Canvas.prototype.getPointer;

fabric.util.object.extend(fabric.Canvas.prototype, {
  setWidth: function (value) {
    return this.setDimensions({ width: value }, {});
  },
  setHeight: function (value) {
    return this.setDimensions({ height: value }, {});
  },
  /**
   * @private
   */

  _setObject: fabric.Object.prototype._setObject,
  originalState: {},
  stateProperties: [],
  editingObject: null,
  getObjectByID: function(_id){
    var layers = this.layers || [{objects: this._objects}];
    for (var i in layers) {
      for (var j in layers[i].objects) {
        if (layers[i].objects[j].id === _id) {
          return layers[i].objects[j];
        }
      }
    }
    return null;
  },
  /*
   Add Custom Object Tranformations
   */
  getPointer: function (e, ignoreZoom, upperCanvasEl) {
    var pointer = _get_pointer_overwritten.call(this, e, ignoreZoom, upperCanvasEl);
    if (e._group) {
      return this._normalizePointer(e._group, pointer);
    }
    return pointer;
  },
  __set : fabric.Object.prototype._set,
  getModifiedStates: function (target) {
    var states = {
      original: {},
      modified: {}
    };
    for (var prop in target.originalState) {
      if (target.originalState[prop] !== target[prop]) {
        if(target.originalState[prop] instanceof Object){
          if(JSON.stringify(target.originalState[prop]) == JSON.stringify(target[prop])){
            continue;
          }
        }
        states.original[prop] = target.originalState[prop];
        states.modified[prop] = target[prop];
      }
    }
    return states;
  },
  _finalizeCurrentTransform: function () {

    var transform = this._currentTransform,
      target = transform.target;

    if (target._scaling) {
      target._scaling = false;
    }

    target.setCoords();

    this._restoreOriginXY(target);
    // only fire :modified event if target coordinates were changed during mousedown-mouseup
    this.fireModifiedIfChanged(target);
  },
  fireModifiedIfChanged: function (target) {
    if (this.stateful) {
      var _states = target.hasStateChanged();
      if(_states){
        this.fire('object:modified', {target: target , states: _states});
        target.fire('modified',{states: _states});
      }
    }
  },
  // _set: function (key, value,callback) {
  //   if (this.specialProperties.indexOf(key) !== -1) {
  //     this["set" + fabric.util.string.capitalize(key, true)](value,callback);
  //   } else {
  //     fabric.Object.prototype._set.call(this, key, value);
  //   }
  //   return this;
  // },
  get: fabric.Object.prototype.get,
  set: fabric.Object.prototype.set,
  hasStateChanged: fabric.Object.prototype.hasStateChanged,
  /** Creates a bottom canvas
   * @private
   * @param {HTMLElement} [canvasEl]
   */
  _createLowerCanvas: function (canvasEl) {
    if (typeof canvasEl == "string") {
      this.lowerCanvasEl = fabric.util.getById(canvasEl) || this._createCanvasElement();
    } else if (canvasEl) {
      this.lowerCanvasEl = canvasEl;
    } else {
      this.virtual = true;
      this.lowerCanvasEl = fabric.util.createCanvasElement();
    }

    this._initCanvasElement(this.lowerCanvasEl);

    fabric.util.addClass(this.lowerCanvasEl, 'lower-canvas');

    if (this.interactive) {
      this._applyCanvasStyle(this.lowerCanvasEl);
    }

    this.contextContainer = this.lowerCanvasEl.getContext('2d');
  },
  findTarget: function (e, skipGroup) {
    if (this.skipTargetFind) {
      return;
    }

    var ignoreZoom = true,
      pointer = this.getPointer(e, ignoreZoom),
      activeGroup = this.getActiveGroup(),
      activeObject = this.getActiveObject();
    if (activeGroup && !skipGroup && this._checkTarget(pointer, activeGroup)) {
      return activeGroup;
    }

    if (activeObject && this._checkTarget(pointer, activeObject)) {
      //added visceroid
      this._fireOverOutEvents(activeObject, e);
      return activeObject;
    }

    this.targets = [ ];

    var target = this._searchPossibleTargets(this._objects, pointer);
    this._fireOverOutEvents(target, e);
    return target;
  }
});

fabric.util.object.extend(fabric.Object.prototype, {
  setAngle: function(angle) {
    this.angle = angle;
  },
  __set : fabric.Object.prototype._set,
  get : fabric.Object.prototype.get,
  _set: function (key, value ,callback) {
    var _fooName = "set" + fabric.util.string.capitalize(key, true);
    if(this[_fooName]  && this[_fooName].name && this[_fooName].name != "anonymous"){
      // if (this.specialProperties.indexOf(key) !== -1) {
      // if(this[_fooName]){
      this[_fooName](value,callback);
    }else{
      this.__set(key, value);
    }
    return this;
  },
  disable: function () {
    this.set({
      selectable: false,
      evented: false,
      hasControls: false,
      lockMovementX: true,
      lockMovementY: true
    });
  },
  stored: true,
  /**
   * Saves state of an object
   * @param {Object} [options] Object with additional `stateProperties` array to include when saving state
   * @return {fabric.Object} thisArg
   */
  saveState: function(options) {
    this.stateProperties.forEach(function(prop) {
      var _val = this.get(prop);
      if(_val instanceof Object){
        this.originalState[prop] = fabric.util.object.cloneDeep(_val);
      }else{
        this.originalState[prop] = _val;
      }
    }, this);

    if (options && options.stateProperties) {
      options.stateProperties.forEach(function(prop) {
        this.originalState[prop] = this.get(prop);
      }, this);
    }
    return this;
  },
  hasStateChanged: function() {
    var modified = 0;
    var states = {
      original: {},
      modified: {}
    };
    for (var prop in this.originalState) {
      if (this.originalState[prop] !== this[prop]) {
        if(this.originalState[prop] instanceof Object){
          if(JSON.stringify(this.originalState[prop]) == JSON.stringify(this[prop])){
            continue;
          }
        }
        states.original[prop] = this.originalState[prop];
        states.modified[prop] = this[prop];
        modified++;
      }
    }
    return modified && states;
  }
});

fabric.util.getProportions = function (photo, container, mode) {
  mode = mode || 'fit';
  var _w = photo.naturalWidth || photo.width;
  var _h = photo.naturalHeight || photo.height;
  if (!container.height && !container.width) {
    return {
      scale: 1,
      width: _w,
      height: _h
    };
  }
  if (!photo.height && !photo.width) {
    return {
      scale: 0.001,
      width: container.width,
      height: container.height
    };
  }

  // var _asp = _w / _h, _c_asp = container.width / container.height;

  // if (_asp > _c_asp) {
  //   _h = container.height;
  //   _w = _h * _asp;
  //
  // } else {
  //   _w = container.width;
  //   _h = _w / _asp;
  // }
  // var scaleX = container.width / _w;
  // var scaleY = container.height / _h;
  var scaleX = container.width && container.width / _w || 999;
  var scaleY = container.height && container.height / _h || 999;

  var scale;
  if (mode === 'cover') {
    scale = Math.max(scaleX, scaleY);
  }
  if (mode === 'fit') {
    scale = Math.min(scaleX, scaleY);
  }
  if (mode === 'center') {
    scale = 1;
  }
  return {
    scale: scale,
    width: Math.floor(_w * scale),
    height: Math.floor(_h * scale)
  };
};

fabric.util.Utf8ArrayToStr = function(array) {
  var out, i, len, c;
  var char2, char3;

  out = "";
  len = array.length;
  i = 0;
  while(i < len) {
    c = array[i++];
    switch(c >> 4)
    {
      case 0: case 1: case 2: case 3: case 4: case 5: case 6: case 7:
      // 0xxxxxxx
      out += String.fromCharCode(c);
      break;
      case 12: case 13:
      // 110x xxxx   10xx xxxx
      char2 = array[i++];
      out += String.fromCharCode(((c & 0x1F) << 6) | (char2 & 0x3F));
      break;
      case 14:
        // 1110 xxxx  10xx xxxx  10xx xxxx
        char2 = array[i++];
        char3 = array[i++];
        out += String.fromCharCode(((c & 0x0F) << 12) |
          ((char2 & 0x3F) << 6) |
          ((char3 & 0x3F) << 0));
        break;
    }
  }

  return out;
};

fabric.util.createObject = function (type, options, callback) {
  if(typeof type !== "string"){
    callback = options;
    options = type;
    type = null;
  }else{
    options.type = type;
  }
  var app = options.application;
  app && app.fire("entity:load",{options: options});

  var _klassName = fabric.util.string.camelize(fabric.util.string.capitalize(type || options.type || app.prototypes.Object.type,true));
  var _klass = fabric[_klassName] || app.klasses[_klassName];


  if(!_klass){
    console.error(_klassName + " is undefined");
    return callback(new fabric.Rect(options))
  }

  var el = _klass.fromObject(options, function (el) {
    callback && callback(el);
    callback = null;
  });
  if (el) {
    callback && callback(el);
    callback = null;
  }
  return el;
};

fabric.util.dataURItoBlob = function (dataURI, dataTYPE) {
  var binary = atob(dataURI.split(',')[1]), array = [];
  for (var i = 0; i < binary.length; i++) {
    array.push(binary.charCodeAt(i));
  }
  return new Blob([new Uint8Array(array)], {type: dataTYPE});
};

fabric.util.blobToDataURL = function (blob, callback) {
  var a = new FileReader();
  a.onload = function (e) {
    callback(e.target.result);
  };
  a.readAsDataURL(blob);
};

fabric.util.createCanvasElementWithSize = function (size) {
  var canvas = fabric.util.createCanvasElement();
  canvas.width = size.width;
  canvas.height = size.height;
  return canvas;
};

fabric.util.string.toDashed = function (str) {
  return str.replace(/([a-z])([A-Z])/g, '$1-$2').toLowerCase();
};

fabric.util.string.uncapitalize = function(string){
  return string.charAt(0).toLowerCase() +
    (string.slice(1));
};

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 22 */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(fabric) {var _GroupRemoveNetive = fabric.Group.prototype.remove;

fabric.util.object.extend(fabric.Group.prototype, {
  /**
   * Removes object from canvas to which it was added last
   * @return {fabric.Object} thisArg
   * @chainable
   */
  remove: function () {
    if (arguments.length === 0) {
      this.canvas && this.canvas.remove(this);
    } else {
      _GroupRemoveNetive.apply(this, arguments);
    }

    return this;
  }
});

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 23 */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(fabric) {
__webpack_require__(7);

fabric.util.object.extend(fabric.Image.prototype,fabric.ImageMixin, {
  async: true,
  toObjectNative: fabric.Image.prototype.toObject,
  toObject:     function(){
    var obj = fabric.Image.prototype.toObjectNative.apply(this,arguments);
    if(obj.src.indexOf(fabric.util.mediaRoot) == 0){
      obj.src = obj.src.replace(fabric.util.mediaRoot,"");
    }
    return obj;
  },
  initialize: function (element, options, callback) {
    options || (options = {});
    this.filters = [];
    this.resizeFilters = [];


    if (options.originalSrc) {
      this._edited = true;
      fabric.util.loadImage(options.originalSrc, function (img) {
        this._originalElement = img;
      }.bind(this));
    }

    this._initElement(element, options, callback && function () {
        fabric.Object.prototype.initialize.call(this, options, callback);
      }.bind(this));//adding callback
  },

  _initElement: function (element, options, callback) {
    this.setElement(fabric.util.getById(element), callback, options);
    fabric.util.addClass(this.getElement(), fabric.Image.CSS_CANVAS);
  },
  /**
   * Sets crossOrigin value (on an instance and corresponding image element)
   * @return {fabric.Image} thisArg
   * @chainable
   */
  setCrossOrigin: function (value) {
    this.crossOrigin = value;
    if (this._element) {
      this._element.crossOrigin = value;
    }
    return this;
  },
  setElement: function (element, callback, options) {

    var _callback, _this;

    this._element = element;
    this._originalElement = element;
    this._initConfig(options);
    // this.setOptions(options );
    // this._setWidthHeight(this);
    // if (this._element && this.crossOrigin) {
    //   this._element.crossOrigin = this.crossOrigin;
    // }


    if (this.resizeFilters.length === 0) {
      _callback = callback;
    }
    else {
      _this = this;
      _callback = function () {
        _this.applyFilters(callback, _this.resizeFilters, _this._filteredEl || _this._originalElement, true);
      };
    }

    if (this.filters.length !== 0) {
      this.applyFilters(_callback);
    }
    else if (_callback) {
      _callback(this);
    }
    if(this.canvas){
      this.canvas.renderAll();
    }
    return this;
  },
  actions : {
    source: {
      type: 'effect',
      className: 'fa fa-file-image-o',
      title: "source",
      actionParameters: function ($el, data) {
        data.target.application.createGallery(data.target, $el);
      }
    }
  }
});

fabric.util.initFilters = function (img, object, callback) {

  // if (fabric.version >= 1.6) {
  fabric.Image.prototype._initFilters.call(object, object.filters, function (filters) {
    object.filters = filters || [];
    fabric.Image.prototype._initFilters.call(object, object.resizeFilters, function (resizeFilters) {
      object.resizeFilters = resizeFilters || [];
      callback(img, object);
    });
  });
  // } else {
  //   fabric.Image.prototype._initFilters.call(object, object, function (filters) {
  //     object.filters = filters || [];
  //     callback(img, object);
  //   });
  // }
};

fabric.util.initImageAndFilters = function (object, callback) {
  if (object.image) {
    var img = object.image;
    delete object.src;
    delete object.image;
    fabric.util.initFilters(img, object, callback);
  }else if (object.src) {
    fabric.util.loadImage(object.src, function (img) {
      //delete object.src;
      fabric.util.initFilters(img, object, callback);
    }, null, object.crossOrigin);
  } else {
    fabric.util.initFilters(null, object, callback);
  }
};

fabric.Image.fromObject = function (object, callback) {
  fabric.util.initImageAndFilters(object, function (img, object) {
    var instance = new fabric.Image(img, object, callback);
  })
};


fabric.Image.prototype._to_object_overwritten = fabric.Image.prototype.toObject;
fabric.Image.prototype.setSrc = function (opt) {
  console.log(opt);
};

fabric.Image.prototype.toObject = function (opt) {
  var obj = fabric.Image.prototype._to_object_overwritten.call(this, opt);


  if (this._edited) {
    obj.originalSrc = this._original_src || this._originalElement.src || this._element.src;
    obj.src = this._element.src;
  } else {
    obj.src = this._original_src || this._originalElement.src || this._element.src;
  }
  if (this.contentOffsets) {
    obj.contentOffsets = this.contentOffsets;
  }


  if (!this.includeDefaultValues) {
    if (!obj.filters.length)delete obj.filters;
  }
  //if(this._originalElement){
  //    obj.thumb = this._element.src;
  //}

  return obj;
};

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 24 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

var isVML = function() { return typeof G_vmlCanvasManager !== 'undefined'; }

//weird stuff
// delete fabric.Rect.prototype.toObject;
// fabric.Rect.prototype.storeProperties = ["*","rx","ry"];

fabric.INCLUDE_ALL = "*";

var _toObject_overwritten = fabric.Object.prototype.toObject;
fabric.util.object.extend(fabric.Object.prototype, {
  storeProperties: ['*'],
  eventListeners: {},
  toObject: function (propertiesToInclude) {
    if (propertiesToInclude == fabric.INCLUDE_ALL) {
      propertiesToInclude = [fabric.INCLUDE_ALL];
    }

    propertiesToInclude = propertiesToInclude || [];
    propertiesToInclude = propertiesToInclude.concat(this.storeProperties);


    var obj = _toObject_overwritten.call(this, propertiesToInclude);
    if (propertiesToInclude[0] !== fabric.INCLUDE_ALL) {
      if (!this.includeDefaultValues) {
        this._removeDefaultValues(obj);
      }
    }

    if (this.storeProperties.indexOf("*") == -1) {
      for (var i in obj) {
        if (this.storeProperties.indexOf(i) == -1) {
          delete obj[i];
        }
      }
    }

    this.fire("before:object", {object: obj});
    return obj;
  },
  /**
   * Sets object's properties from options
   * @param {Object} [options] Options object
   */
  setOptions: function (options) {
    this._setObject(options);
    // this._initGradient(options);
    // this._initPattern(options);
    // this._initClipping(options);
  },
  _initEntity: function (options) {
    options.application && options.application.fire("entity:created", {target: this, options: options});
  },
  initialize: function (options, callback) {
    options = options || {};
    this._initEntity(options);
    // if(options.wholeCoordinates){
    //   var coordinates = ["left","top","width","height"];
    //   for(var i in coordinates){
    //     if(options[coordinates[i]]){
    //       options[coordinates[i]] = Math.round(options[coordinates[i]]);
    //     }
    //   }
    // }
    var _self = this;
    this._setObject(options, function () {
      _self.loaded = true;
      _self.fire("loaded");
      callback && callback(_self);
    });
  },
  add: function (canvas) {
    canvas.add(this);
  },
  set: function (key, value) {
    if (typeof key === 'object') {
      this._setObject(key);
    }
    else {
      if (key[0] == "&") {
        key = key.substr(1);
        this._set(key, value(this.get(key)));
      }
      else {
        this._set(key, value);
      }
    }
    return this;
  }
});



fabric.util.object.extend(fabric.Object.prototype, {
  hasBoundsControls: true,
  flipTools:     false,
  orderTools:    false,
  stroke: "transparent",
  onTop: function () {
    return this.canvas._objects.indexOf(this) == this.canvas._objects.length - 1;
  },
  flop: function () {
    this.flipY = !this.flipY;
    this.canvas.renderAll();
  },
  flip: function () {
    this.flipX = !this.flipX;
    this.canvas.renderAll();
  },
  onBottom: function () {
    return this.canvas._objects.indexOf(this) == 0;
  },
  duplicate: function() {
    var _object = this.toObject(fabric.INCLUDE_ALL);
    _object.active = true;

    var _clone = _object.cloneSync && _object.cloneSync() || this.canvas.createObject(_object);
    return _clone;
  },
  minStrokeWidth: 0,
  maxStrokeWidth: function(){
    return Math.min(this.width,this.height) / 2;
  },
  actions: {
    boundingRect: {
      type: 'label',
      template: '<dt>L:</dt><dd class="{leftClass}" title="{left}">{roundLeft}</dd><dt>T:</dt><dd class="{topClass}"  title="{top}">{roundTop}</dd><dt>R:</dt><dd class="{rightClass}" title="{right}">{roundRight}</dd><dt>B:</dt><dd class="{bottomClass}"  title="{bottom}">{roundBottom}</dd>',
      value: {
        observe: "modified scaling moving rotating",
        get: function(){
          var _rect = this.getBoundingRect();

          if(this.movementLimits) {

            if (this.movementLimits == this.canvas) {
              var _v = this.canvas.viewportTransform;
              var _mlr = {
                left: _v[4],
                top: _v[5],
                width: (this.canvas.originalWidth || this.canvas.width) * _v[0],
                height: (this.canvas.originalHeight || this.canvas.height)  * _v[3],
                right: 0,
                bottom: 0
              }
            }else{
              _mlr = this.movementLimits.getBoundingRect();
            }


            _rect.bottom = this.movementLimits.height - _rect.height;
            var _t = _rect.top - _mlr.top;
            var _l = _rect.left - _mlr.left;
            var _r = _mlr.width - _rect.width - _l;
            var _b = _mlr.height - _rect.height - _t;
          }else{
            _t = _rect.top;
            _l = _rect.left;
            _b = this.canvas.height - _rect.height - _rect.top;
            _r  = this.canvas.width - _rect.width - _rect.left;
          }

          return {
            topClass: _t > 0 ? "positive" : _t < 0 ? "negative" : "zero",
            bottomClass: _b > 0 ? "positive" : _b < 0 ? "negative" : "zero",
            leftClass: _l > 0 ? "positive" : _l < 0 ? "negative" : "zero",
            rightClass: _r > 0 ? "positive" : _r < 0 ? "negative" : "zero",
            top:    _t,
            left:   _l,
            bottom: _b,
            right:  _r,
            roundTop:    Math.round(_t),
            roundLeft:   Math.round(_l),
            roundBottom: Math.round(_b),
            roundRight:  Math.round(_r)
          }
        }
      }
    },
    position: {
      title: 'position',
      type: 'menu',
      menu: {
        objectLeft: {
          type:   'number',
          title:  'left',
          value: {
            set: function (val) {
              this.left = val;
              this.fire("modified");
              this.canvas.fire("object:modified", {target: this});
              this.canvas.renderAll();
            },
            get: function () {
              return this.left;
            },
            observe: "modified"
          }
        },
        objectTop: {
          type:   'number',
          title:  'top',
          value: {
            set: function (val) {
              this.top = val;
              this.fire("modified");
              this.canvas.fire("object:modified", {target: this});
              this.canvas.renderAll();
            },
            get: function () {
              return this.top;
            },
            observe: "modified"
          }
        }
      }
    },
    dimensions: {
      title: 'dimensions',
      type: 'menu',
      menu:{
        objectWidth: {
          type:   'number',
          title:  'width',
          value: {
            set: function(val){
              this.saveState();
              this.dimensionsWidthValue = val;
              this.scaleToWidth(val *  this.canvas.getZoom());
              this.canvas.fireModifiedIfChanged(this);
              this.canvas.renderAll();
              delete this.dimensionsWidthValue;
            },
            get: function(){
              if(this.dimensionsWidthValue){
                return this.dimensionsWidthValue;
              }
              return Math.round(this.getBoundingRect().width / this.canvas.getZoom());
            },
            observe: "modified"
          }
        },
        objectHeight: {
          type:   'number',
          title:  'height',
          value: {
            set: function(val){
              this.saveState();
              this.scaleToHeight(val *  this.canvas.getZoom());
              this.dimensionsHeightValue = val;
              this.canvas.fireModifiedIfChanged(this);
              this.canvas.renderAll();
              delete this.dimensionsHeightValue;
            },
            get: function(){
              if(this.dimensionsHeightValue){
                return this.dimensionsHeightValue;
              }
              return Math.round(this.getBoundingRect().height / this.canvas.getZoom());
            },
            observe: "modified"
          }
        }
      }
    },
    center: {
      className:  'fa fa-bullseye',
      title: 'Center',
      action: function(){
        this.center();
        this.setCoords();
      }
    },
    objectFlip: {
      className:  'fa fa-arrows-h',
      title:      'flip',
      action:     'flip'
    },
    flop: {
      className:  'fa fa-arrows-v',
      title:      'flop'
    },
    bringForward: {
      title:      'bring forward',
      className:  'fa fa-level-up',
      disabled:   'onTop'
    },
    sendBackwards: {
      title:      'send backwards',
      className:  'fa fa-level-down',
      disabled:   'onBottom'
    },
    remove: {
      className:  'fa fa-trash',
      title:      'remove',
      key:        "Delete"
    },
    duplicate: {
      className:  'fa fa-clone',
      title:      'duplicate'
    }
  }
});

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 25 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {


/**
 * @private
 * @param {String} eventName
 * @param {Function} handler
 */
function _removeEventListener(eventName, handler) {
  if (!this.__eventListeners[eventName]) {
    return;
  }
  var eventListener = this.__eventListeners[eventName];
  if (handler) {
    eventListener.splice(eventListener.indexOf(handler), 1)
  }
  else {
    eventListener.length = 0;
  }
}

fabric.Canvas.prototype.stopObserving = fabric.Object.prototype.stopObserving = function stopObserving(eventName, handler) {
  if (!this.__eventListeners) {
    return;
  }

  // remove all key/value pairs (event name -> event handler)
  if (arguments.length === 0) {
    for (eventName in this.__eventListeners) {
      _removeEventListener.call(this, eventName);
    }
  }
  // one object with key/value pairs was passed
  else if (arguments.length === 1 && typeof arguments[0] === 'object') {
    for (var prop in eventName) {
      _removeEventListener.call(this, prop, eventName[prop]);
    }
  }
  else {
    _removeEventListener.call(this, eventName, handler);
  }
  return this;
}


fabric.Observable.on = fabric.Canvas.prototype.on = fabric.Object.prototype.on = function (eventName, handler,priority) {
  if (eventName.constructor == Object) {
    for (var i in eventName) {
      this.on(i, eventName[i],priority)
    }
    return this;
  }
  var events = eventName.split(" ");
  for (var i in events) {
    eventName = events[i];
    this.observe(eventName, handler);
    if(priority){
      this.__eventListeners[eventName].unshift(this.__eventListeners[eventName].pop());
    }
  }
  return this;
};
fabric.Canvas.prototype.off = fabric.Object.prototype.off = function (eventName, handler) {
  var events = eventName.split(" ");
  for (var i in events) {
    this.stopObserving(events[i], handler)
  }
  return this;
};


fabric.Canvas.prototype.fire = fabric.Object.prototype.fire = function fire(eventName, options) {
  if (!this.__eventListeners) {
    return;
  }

  var listenersForEvent = this.__eventListeners[eventName];
  if (listenersForEvent) {
    for (var i = 0, len = listenersForEvent.length; i < len; i++) {
      listenersForEvent[i].call(this, options || {});
    }
  }

  var listenersForEventAll = this.__eventListeners['*'];
  if (listenersForEventAll) {
    options = options || {};
    options.eventName = eventName;
    options.listeners = listenersForEvent;
    for (i = 0, len = listenersForEventAll.length; i < len; i++) {
      listenersForEventAll[i].call(this, options);
    }
  }

  return this;
};

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 26 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

__webpack_require__(4);

/**
 * # SlideCanvas
 * Inherited from fabric.Canvas
 *
 *

 ## method: load

Mathod allows to add new objects and set new attributes of canvas.

 ```javascript
 load : ({
    backgroundImage: string,
    objects: [FabricShapeOptions],
    customSyncOption: any,
    customAsyncOption: any
  },callback) : void
 ```

 To extend loading behavior and use custom options it is possible to define **set fucntions** in Canvas prototype.

 ```javascript
 // Canvas Prototype
 setCustomAsyncOption: function(val,callback){
  this.doAsyncMethod(val,callback)
}
 setCustomSyncOption: function(val){
  this.customSyncOtion = val;
}
 ```

 ### attribute: backgroundImageProperties

 default attributes for background image

 ### freeDrawingBrush

 default active drawing brush

 ```
 freeDrawingBrush: "PaintBucketBrush" | "PaintPenBrush" | "PencilBrush"
 ```

 ### attribute: onSlideLoaded

 onSlideLoaded calls as a callback for load fucntion

 ### attribute: backgroundPosition

 onSlideLoaded calls as a callback for load fucntion

 ```
 backgroundPosition: 'manual' | 'resize' | 'fit' | 'cover' | 'center'
 ```

 - manual - background will ne not scaled and put at left top corner
 - resize - canvas will be resized according to image size
 - fit - will be scaled to fit canvas size
 - cover - will be scaled to cover all canvas size
 - center - backogrund will be not scaled but put in the middle

 ### method: setInteractiveMode

 switch between drawing and hand( moving cunvas by mouse) modes

 ```javascript
 canvas.setInteractiveMode( mode : "hand" | "mixed") : void
 ```

 ### drawingColor

 drawing color using by brushes

 */
fabric.SlideCanvas = fabric.util.createClass(fabric.Canvas,fabric.PluginsMixin, {
  type: 'slide-canvas',
  /**
   * initialized width of the canvas
   */
  width: 160 ,
  /**
   * initialized height of the canvas
   */
  height: 90,
  /**
   * output quality
   */
  dotsPerUnit: 1,
  scale: 1,
  loaded: false,
  /**
   * allow user to interact with canvas
   */
  interactive: true,
  /**
   * fill not the slide area, but whole canvas with background color
   */
  addTextTool: false,
  defaultText: "text",
  defaultTextType: "text",
  thumbSize: {
    width: 50,
    height: 100
  },
  storeProperties: ['*','backgroundImage','width','height'],
  contextTopImageSmoothingEnabled: true,
  plugins: {
    initialize: [
    ],
    preloaders: [
    ],
    loaders: [],
    savers : [
      function serializeThumb(propertiesToInclude, _data){
        if(propertiesToInclude.indexOf('thumb') !== -1){
          var size = fabric.util.getProportions(this.getOriginalSize(), this.thumbSize, 'fit');
          var canvas = fabric.util.createCanvasElement();
          canvas.width = size.width;
          canvas.height = size.height;
          this.renderThumb(canvas);
          _data.thumb = canvas.toDataURL();
        }
      },
      function serializeTemplate(propertiesToInclude, _data) {
        if (propertiesToInclude.indexOf('template') !== -1) {
          if (this.template) {
            for (var i in _data.template) {
              if (JSON.stringify(_data[i]) == JSON.stringify(_data.template[i])) {
                delete _data[i];
              }
            }
            _data.template = this.template.id;
          }
        }
      }
    ]
  },
  setBackgroundColor: function(backgroundColor, callback) {
    return this.__setBgOverlayColor('backgroundColor', backgroundColor, function(){
      this.renderAll();
      callback && callback()
    }.bind(this));
  },
  setInteractive: function (value) {
    this.interactive = value;
  },
  _initOptions: function (options) {
    this.width = this.width || parseInt(this.lowerCanvasEl.width, 10) || 0;
    this.height = this.height || parseInt(this.lowerCanvasEl.height, 10) || 0;

    if (!this.lowerCanvasEl.style) {
      return;
    }

    this.lowerCanvasEl.width = this.width;
    this.lowerCanvasEl.height = this.height;

    this.lowerCanvasEl.style.width = this.width + 'px';
    this.lowerCanvasEl.style.height = this.height + 'px';

    this.viewportTransform = this.viewportTransform.slice();
  },
  _createUpperCanvas: function () {
    fabric.Canvas.prototype._createUpperCanvas.call(this);
    var ctx = this.contextTop;

    if(ctx.imageSmoothingEnabled){
      ctx.imageSmoothingEnabled = this.contextTopImageSmoothingEnabled;
      return;
    }
    ctx.webkitImageSmoothingEnabled = this.contextTopImageSmoothingEnabled;
    ctx.mozImageSmoothingEnabled    = this.contextTopImageSmoothingEnabled;
    ctx.msImageSmoothingEnabled     = this.contextTopImageSmoothingEnabled;
    ctx.oImageSmoothingEnabled      = this.contextTopImageSmoothingEnabled;
  },
  _onMouseUpInDrawingMode: function(e) {
    this._isCurrentlyDrawing = false;
    if (this.clipTo) {
      this.contextTop.restore();
    }
    var pointer = this.getPointer(e);
    this.freeDrawingBrush.onMouseUp(pointer);
    this._handleEvent(e, 'up');
  },
  initialize: function (el, options,callback) {
    if(el && el.constructor == Object){
      callback= options;
      options = el;
      el = null;
    }
    options = options || {};



    if(options.application){
      options.application.fire("entity:created",{target : this , options : options});
    }

    this.id = fabric.SlideCanvas.__idcounter++;

    this._objects = [];
    this._createLowerCanvas(el);


    if(!this.virtual){
      this.created = true;


      this._currentTransform = null;
      this._groupSelector = null;
      this._initWrapperElement();
      this._createUpperCanvas();
      this._initEventListeners();
      this._initRetinaScaling();
      this.calcOffset();
      this.initLayers();



      this._createCacheCanvas();
      this._setImageSmoothing();
      this._initRetinaScaling();
    }else{
      this.initLayers();
    }

    this.plugins.initialize.forEach(function(initializer){
      initializer.call(this, options);
    }.bind(this));

    if(options["+actions"]) {
      this.set("+actions", options["+actions"])
    }
    if(options.actions){
      this.set("actions",options.actions)
    }


    if(options && options.onResize){
      this.onResize = options.onResize;
    }

    if (this.requestAnimFrame) {
      this.addVideosSupport();
    }

    this._initOptions();

    this._setObject(options);

    this.calcOffset();

    // this.load(options,callback);

    this.fire("created");
    // if(this.application){
    //   this.application.fire("canvas:created",{target : this});
    // }
  },
  initLayers: function(){
    if(this.upperCanvasEl){
      this.wrapperEl.appendChild(this.upperCanvasEl);
    }
    //todo from layers module
  },
  create: function () {
    this.created = true;
    this._initInteractive();
    this._createCacheCanvas();
  },
  toObject: function (propertiesToInclude) {

    propertiesToInclude = (propertiesToInclude || []).concat(this.storeProperties);

    var _self =  this;
    var _objs = this.getObjects();

    _objs = fabric.util.object.filter(_objs,{stored: true});
    _objs = _objs.map(function(instance) {
      return instance.toObject(_self.objectsPropertiesToInclude);
    });

    var _data = {
      objects: _objs
    };

    fabric.util.populateWithProperties(this, _data, this.propertiesToInclude);
    //
    // for(var i in propertiesToInclude){
    //   var _prop = propertiesToInclude[i];
    //   _data[_prop] = this[_prop];
    // }

    if(propertiesToInclude.indexOf('backgroundImage') !== -1){
      fabric.util.object.extend(_data, this.__serializeBgOverlay());
    }

    if(propertiesToInclude.indexOf('width') !== -1 && this.originalWidth){
      _data.width = this.originalWidth;
    }
    if(propertiesToInclude.indexOf('height') !== -1 && this.originalHeight){
      _data.height = this.originalHeight;
    }

    this.plugins.savers.forEach(function(saver){
      saver.call(this, propertiesToInclude, _data);
    }.bind(this));
    this.fire("before:object",{object: _data});

    return _data;
  },
  setTemplate: function(template){

    this.template = template;
    if(!template)return;

    this.setWidth(this.slideWidth || template.width);
    this.setHeight(this.slideHeight || template.height);
    this.originalHeight = this.height;
    this.originalWidth = this.width;

    this.set(fabric.util.object.rearrange(template,["areas","helpers","offsets"]));

    this._update_clip_rect();
    this._update_background_image();
    this.fire("modified",{type: "template"});
    this.renderAll();
  },
  addText: function (text, options) {
    this.createObject({
      position: "center",
      text: text,
      type:   this.defaultTextType,
      clipTo: this.activeArea,
      movementLimits : this.activeArea
    });
  },
  /**
   * Additional Event Listeners
   *  - loading:end
   *  - target:modified - couldbe used to detect active object changes
   *  - target:changed
   *  - target:cleared
   */
  eventListeners: {
    'object:moving': function (obj) {
      this.fire('target:modified', this, obj)
    },
    'selection:cleared': function (event) {
      if(!this.target)return;
      this.target.fire('deselected', event);
      this.target = null;
      this.fire('target:cleared', event);
    },
    'object:selected': function (event) {
      event.previous = this.target;
      this.target = event.target;
      if(event.previous){
        event.previous.fire('deselected', event);
      }
      this.fire('target:changed', event);
    },
    'group:selected': function (event) {
      this.target = event.target;
      this.fire('target:changed', event);
    }
  }
});
fabric.SlideCanvas.__idcounter = 0;
fabric.SlideCanvas.fromJson = function(url,callback , element){
  fabric.util.data.loadJson(url,function(data){
    new fabric.SlideCanvas(element,data,callback)
  })
};

fabric.SlideCanvas.prototype.actions = fabric.util.object.extend({}, {
  selectAll: {
   title: 'selectAll',
   type: 'key'
  },
  backgroundColor : {
    type: "color"
  },
  addText: {
    className:  'fa fa-font',
    title: 'text',
    action: function () {
      this.addText(this.defaultText,{});
    }
  }
});

fabric.util.object.extend(fabric.Application.prototype, {
  setSlide: function (value, callback) {
    var _canvas = this.canvas;
    if (_canvas.load) {
      _canvas.load(value, callback);
    } else {
      _canvas.createObjects(value, callback);
    }
  }
});

fabric.Application.prototype.canvasClass = 'SlideCanvas';

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 27 */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(fabric) {var textInitialize = fabric.Text.prototype.initialize;

fabric.util.object.extend(fabric.Text.prototype, {
  textInitialize: textInitialize,
  editTool: false,
  advancedColorsTools: false,
  textFontSizeTools: false,
  textAligmentTools: false,
  advancedTextStyleTools: false,
  rasterizeTool: false,
  rasterizeKlass: fabric.Image,
  initialize: function (text, options) {
    this._initEntity(options);
    this.textInitialize(text, options);
    // this.updateCache();
  },
    _render_cache: function (ctx) {
  ctx.save();
  ctx.scale(
    this.scaleX * (this.flipX ? -1 : 1),
    this.scaleY * (this.flipY ? -1 : 1)
  );
  this.transform(ctx);
  this._setShadow(ctx);
  ctx.translate(-this.width / 2, -this.height / 2);
  ctx.drawImage(this._cache, 0, 0, this.width, this.height);
  ctx.restore();
},
  updateCache: function () {

    var size = {
      width: this.width * this.canvas.dotsPerUnit,
      height: this.height * this.canvas.dotsPerUnit
    };

    var _clipTo = this.clipTo;
    delete this.clipTo;
    this._cache = fabric.util.createCanvasElementWithSize(size);
    var ctx = this._cache.getContext("2d");
    ctx.scale(
      this.canvas.dotsPerUnit,
      this.canvas.dotsPerUnit);
    ctx.translate(this.width / 2, this.height / 2);

    this.render(ctx, true);
    this.render = this._render_cache;
    this.clipTo = _clipTo;

  },
  rasterizeText: function () {
    this.updateCache();
    var img = fabric.util.createImage();

    img.onload = function () {
      var obj = this.toObject();
      obj.width = img.width;
      obj.height = img.height;
      obj.scaleX = this.scaleX * (this.height / img.height);
      obj.scaleY = this.scaleY * (this.width / img.width );
      obj.rasterizedType = obj.type;
      delete obj.type;

      var el = new this.rasterizeKlass(img, obj);
      this.canvas.add(el);
      this.canvas.remove(this);
      setTimeout(function () {
        this.canvas.setActiveObject(el);
        this.canvas.renderAll();
      }.bind(this))
    }.bind(this);
    img.src = this._cache.toDataURL();
    //this.on('modified',this.updateCache.bind(this));
  },
  getStyle: function (styleName) {
    var object = this;
    return (object.getSelectionStyles && object.isEditing)
      ? (object.getSelectionStyles()[styleName] || object[styleName])
      : (object[styleName] || object['__' + styleName] || '');
  },
  getPattern: function (url) {
    var _fill = this.getStyle('fill ');
    return _fill && _fill.source;
  },
  setPattern: function (url) {
    if (!url) {
      this.setStyle('fill');
    } else {
      // var _texture = _.findWhere(this.project.textures, {id: url});
      var _this = this;
      fabric.util.loadImage(url, function(img) {
        _this.setStyle('fill', new fabric.Pattern({
          source: img,
          repeat: 'repeat'
        }));
      });
    }
  },
  getOpacity: function () {
    return this.getStyle('opacity') * 100;
  },
  setOpacity: function (value) {
    this.setStyle('opacity', parseInt(value, 10) / 100);
  },
  getRadius: function () {
    return this.get('radius');
  },
  setShadow: function(options) {
    return this.setProperty('shadow', options ? new fabric.Shadow(options) : null);
  },
  setProperty: function (prop, value) {
    this[prop] = value;
    this.canvas && this.canvas.renderAll();
  },
  setRadius: function (value) {
    this.setProperty('radius', value);
  },
  getSpacing: function () {
    return this.get('spacing');
  },
  setSpacing: function (value) {
    this.setProperty('spacing', value);
  },
  getReverted: function () {
    return this.get('reverted');
  },
  setReverted: function (value) {
    this.setProperty('reverted', value);
  },
  getFill: function () {
    return this.getStyle('fill');
  },
  setFill: function (value) {
    this.setStyle('fill', value);
  },
  getText: function () {
    return this.get('text');
  },
  setText: function (value) {
    this.setProperty('text', value);
  },
  getTextAlign: function () {
    return this.get('textAlign');
  },
  setTextAlign: function (value) {
    this.setProperty('textAlign', value.toLowerCase());
  },
  getFontFamily: function () {
    return this.get('fontFamily');
  },
  setFontFamily: function (value) {
    this.setStyle('fontFamily', value);
  },
  getStyles: function(){
    return this.styles || {
        fill :                this.fill,
        fontSize :            this.fontSize,
        textBackgroundColor : this.textBackgroundColor,
        textDecoration :      this.textDecoration,
        fontFamily :          this.fontFamily,
        fontWeight :          this.fontWeight,
        fontStyle :           this.fontStyle,
        stroke :              this.stroke,
        strokeWidth :         this.strokeWidth
      };
  },
  getBgColor: function () {
    return this.get('backgroundColor');
  },
  setBgColor: function (value) {
    this.setProperty('backgroundColor', value);
  },
  getTextBgColor: function () {
    return this.get('textBackgroundColor');
  },
  setTextBgColor: function (value) {
    this.setProperty('textBackgroundColor', value);
  },
  getStroke: function () {
    return this.getStyle('stroke');
  },
  setStroke: function (value) {
    this.setStyle('stroke', value);
  },
  getStrokeWidth: function () {
    return this.getStyle('strokeWidth');
  },
  setStrokeWidth: function (value) {
    this.setStyle('strokeWidth', parseInt(value, 10));
  },
  decreaseFontSize: function () {
    this.setStyle('fontSize', parseInt(this.getStyle('fontSize')) - 1);
  },
  increaseFontSize: function () {
    this.setStyle('fontSize', parseInt(this.getStyle('fontSize')) + 1);
  },
  getFontSize: function () {
    return this.getStyle('fontSize');
  },
  setFontSize: function (value) {
    this.setStyle('fontSize', parseInt(value, 10));
  },
  getLineHeight: function () {
    return this.getStyle('lineHeight');
  },
  setLineHeight: function (value) {
    this.setStyle('lineHeight', parseFloat(value, 10));
  },
  addText: function (text,options) {

    var _match = this.text.match(/\n/g);
    var _lineIndex = _match && _match.length || 0;
    var charIndex = this.text.length - this.text.lastIndexOf("\n") - 1;

    if(!this.styles[_lineIndex]){
      this.styles[_lineIndex] = {}
    }

    if(!this.styles[_lineIndex][charIndex]){
      this.styles[_lineIndex][charIndex] = {}
    }
    fabric.util.object.extend(this.styles[_lineIndex][charIndex],options);
    this.text +=text;
    // this.styles;
  },
  getBold: function () {
    return this.getStyle('fontWeight') === "bold";
  },
  setBold: function (value) {
    this.setStyle('fontWeight', value ? 'bold' : '');
  },
  getItalic: function () {
    return this.getStyle('fontStyle') === 'italic';
  },
  setItalic: function (value) {
    this.setStyle('fontStyle', value ? 'italic' : '' );
  },
  getUnderline: function () {
    return this.getStyle('textDecoration').indexOf('underline') > -1;
  },
  setUnderline: function (value) {
    value = value ? (this.getStyle('textDecoration') + ' underline')
      : this.getStyle('textDecoration').replace('underline', '');

    this.setStyle('textDecoration', value);
  },
  getLinethrough: function () {
    return this.getStyle('textDecoration').indexOf('line-through') > -1;
  },
  setLinethrough: function (value) {
    value = value ? (this.getStyle('textDecoration') + ' line-through')
      : this.getStyle('textDecoration').replace('line-through', '');

    this.setStyle('textDecoration', value);
  },
  getOverline: function () {
    return this.getStyle('textDecoration').indexOf('overline') > -1;
  },
  setOverline: function (value) {
    value = value ? (this.getStyle('textDecoration') + ' overline')
      : this.getStyle('textDecoration').replace('overlin', '');

    this.setStyle('textDecoration', value);
  },
  setStyle: function (styleName, value) {
    var object = this;
    var _old = fabric.util.object.cloneDeep(object.getStyles());
    //var _old = fabric.util.object.deepExtend({}, object.getStyles);//getSelectionStyles();
    if (object.setSelectionStyles && object.isEditing) {
      var style = {};
      if (value !== undefined) {
        style[styleName] = value;
      } else {
        delete style[styleName];
      }
      object.setSelectionStyles(style);
      object.setCoords();
    }
    else {
      if (value !== undefined) {
        object[styleName] = value;
      } else {
        delete object[styleName];
      }
      for (var i in object.styles) {
        for (var j in object.styles[i]) {
          if (object.styles[i][j][styleName] !== undefined) {
            delete object.styles[i][j][styleName];
          }
        }
      }
    }

    var styles_data = object.getStyles();

    if(this.type != "text"){
      this.styles = fabric.util.object.cloneDeep(styles_data);
    }

    this.setCoords();

    this.fire("styles:modified", {
      original: _old,
      modified: styles_data
    });
    this.canvas && this.canvas.renderAll();
    /*
     this.project.history.add({
     slide: this.slide,
     object: this,
     undo: _old,
     redo: styles_data,
     type: 'styled',
     undoFn: function(){
     this.object.data.styles = this.undo;
     this.object.fabric.set('styles',this.undo);
     this.object.fabric.setCoords();
     this.object.slide.render();
     },
     redoFn:  function(){
     this.object.data.styles = this.redo;
     this.object.fabric.set('styles',this.redo);
     this.object.fabric.setCoords();
     this.object.slide.render();
     }
     });*/
  },

  generateTextStyle: function () {
    return {
      'font-style': this.isItalic() ? 'italic' : 'normal',
      'font-weight': this.isBold() ? 700 : 400,
      'text-decoration': (this.isLinethrough() ? 'line-through ' : '' ) +
      (this.isOverline() ? 'overline ' : '' ) +
      (this.isUnderline() ? 'underline ' : '')
    }
  },
  actions: {
    rasterizeText: {
      insert: 'rasterizeTool',
      className: 'button-easel',
      title: 'rasterizeText',
   //   action: _TEX.rasterizeText
    },
    fill: {
      type: 'color',
      title: 'fill',
      insert: '!advancedColorsTools',
      value: 'fill'
    },
    textBgcolor: {
      type: 'color',
      title: 'bgColor',
      value: 'bgColor'
    },
    textTextbgcolor: {
      type: 'color',
      title: 'textBgColor',
      value: 'textBgColor'
    },
    textFill: {
      type: 'color',
      title: 'fill',
      value: 'fill'
    },
    textBold: {
      type: "checkbox",
      title: 'bold',
      value: 'bold',
      className: 'fa fa-bold'
    },
    textItalic: {
      type: "checkbox",
      title: 'italic',
      value: 'italic',
      className: 'fa fa-italic'
    },
    textUnderline: {
      type: "checkbox",
      title: 'Underline',
      value: 'underline',
      className: 'fa fa-underline'
    },
    textLinethrough: {
      type: "checkbox",
      insert: 'advancedTextStyleTools',
      title: 'Linethrough',
      value: 'linethrough',
      className: 'text-linethrough fa fa-strikethrough'
    },
    textOverline: {
      type: "checkbox",
      insert: 'advancedTextStyleTools',
      title: 'overline',
      value: 'overline',
      className: 'text-overline fa fa-overline'
    },
    textAlign: {
      type: 'options',
      title: 'text align',
      insert: 'textAligmentTools',
      value: "textAlign",
      menu: {
        textAlignCenter: {
          title: 'align center',
          option: 'center',
          className: 'fa fa-align-center'
        },
        textAlignLeft: {
          title: 'align left',
          option: 'left',
          className: 'fa fa-align-left'
        },
        textAlignRight: {
          title: 'align right',
          option: 'right',
          className: 'fa fa-align-right'
        },
        textAlignJustify: {
          title: 'align justify',
          option: 'justify',
          className: 'fa fa-align-justify'
        }
      }
    },
    fontFamily: {
      type: 'fontFamily',
      title: 'font family',
      className: 'fa fa-text',
      value: 'fontFamily',
      data: function(){
        return this.application._fonts
      }
    },
    textFontSize: {
      insert: 'textFontSizeTools',
      type: 'number',
      title: 'fontSize',
      value: 'fontSize'
    },
    /*textFont: {
     insert: 'textFontSizeTools',
     type: 'menu',
     title: 'font',
     className: 'fa fa-font',
     menu: {
     textFontSizeDecrease: {
     title: 'decreaseFontSize',
     action: _TEX.decreaseFontSize,
     className: 'fa fa-font font-size-decrease'
     },
     textFontSizeIncrease: {
     title: 'increaseFontSize',
     action: _TEX.increaseFontSize,
     className: 'fa fa-font font-size-increase'
     }
     }
     }*/
    advancedColorsTools: {
      className: 'colors',
      type: 'menu',
      title: 'colors',
      toggled: true,
      menu: ["fill","textBgcolor","textTextbgcolor","textFill"]
    },
    textStyle: {
      type: 'menu',
      title: 'text style',
      toggled: true,
      className: 'fa fa-font',
      style: 'generateTextStyle',
      menu: [
        "textBold","textItalic","textUnderline","textLinethrough",
        "textOverline","textAlign","fontFamily","textFontSize"
      ]
    }
  }
});

fabric.util.object.extend(fabric.IText.prototype, {
  initHiddenTextarea_native: fabric.IText.prototype.initHiddenTextarea,
  initHiddenTextarea: function(){
    this.initHiddenTextarea_native();
    this.hiddenTextarea.style.width = "9999px";
  },
  /**
   * Exits from editing state
   * @return {fabric.IText} thisArg
   * @chainable
   */
  exitEditing: function() {
    // var isTextChanged = (this._textBeforeEdit !== this.text);
    this.selected = false;
    this.isEditing = false;
    this.selectable = true;

    this.selectionEnd = this.selectionStart;
    this.hiddenTextarea && this.canvas && this.hiddenTextarea.parentNode.removeChild(this.hiddenTextarea);
    this.hiddenTextarea = null;

    this.abortCursorAnimation();
    this._restoreEditingProps();
    this._currentCursorOpacity = 0;

    this.fire('editing:exited');
    // isTextChanged && this.fire('modified');
    if (this.canvas) {
      this.canvas.off('mouse:move', this.mouseMoveHandler);
      this.canvas.fire('text:editing:exited', { target: this });
      this.canvas.fireModifiedIfChanged(this);
    }
    return this;
  },
  maxStrokeWidth: function(){
    return Math.ceil( this.getFontSize() / 10);
  },
  actions: {
    enterEditing: {
      insert:     'editTool',
      className:  'fa fa-pencil-square-o',
      title:      'edit'
      //action:     _TEX.enterEditing
    }
  }
});



/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 28 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {


/**
   * Draw CSS3 border image on canvas.
   * @param canvas    {HTMLCanvasElement}
   * @param img       {HTMLImageElement} border-image-source image
   * @param options   {Object}
   *      slice {Array} border-image-slice values
   *      width {Array} border-image-width values
   *      outset {Array} border-image-outset values
   *      repeat {Array} border-image-repeat values
   * @param size      {Object}
   */
   fabric.util.drawBorderImage  = function(canvas, img, options){


    var options = fabric.util.object.extend({
      "slice":        [25,25,25,25],
      "width":        [25,25,25,25],
      "fill":         false,
      "repeat":       ["round","round"],
      "outset_values"	: [0, 0, 0, 0],
      "slice_units"   : [0, 0, 0, 0],
      "width_units"	: [0, 0, 0, 0],
      "outset_units"	: [0, 0, 0, 0],
      "size"			: [canvas.width, canvas.height]
    },options)


    var w = img.width;
    var h = img.height;

    var ctx = canvas.getContext("2d");
    var slice = options.slice;
    var width = options.width;

    var w2 = options.size[0];
    var h2 = options.size[1];


    if(options.slice_units[0] == 1)slice[0] *=  h / 100;
    if(options.slice_units[1] == 1)slice[1] *=  w / 100;
    if(options.slice_units[2] == 1)slice[2] *=  h / 100;
    if(options.slice_units[3] == 1)slice[3] *=  w / 100;

    if(options.width_units[0] == 1)width[0] *= h2 / 100;
    if(options.width_units[1] == 1)width[1] *= w2 / 100;
    if(options.width_units[2] == 1)width[2] *= h2 / 100;
    if(options.width_units[3] == 1)width[3] *= w2 / 100;


    function drawSide(side,sliceOffset,sliceWidth, drawOffset,drawWidth){
      var d;
      if(side == 0) {
        d = [slice[3] + sliceOffset, 0, sliceWidth,  slice[0],
          width[3] + drawOffset, 0, drawWidth,  width[0]]
      }
      if(side == 2){
        d = [slice[3] + sliceOffset, h - slice[2] ,sliceWidth,  slice[2],
          width[3] + drawOffset, h2 - width[2],drawWidth, width[2]]
      }
      if(side == 1) {
        d = [ w - slice[1], slice[0] + sliceOffset,  slice[1], sliceWidth,
          w2 - width[1], width[0] + drawOffset,width[1], drawWidth];
      }
      if(side == 3) {
        d = [ 0, slice[0] + sliceOffset,  slice[3], sliceWidth,
          0, width[0] + drawOffset, width[3],drawWidth];
      }
      ctx.drawImage(img,d[0],d[1],d[2],d[3],d[4],d[5],d[6],d[7])
    }


    function _draw_border_side(side){
      var _top_width, _top_slice, repeat;
      if(side == 0 || side == 2){
        _top_width = w2 - width[1]- width[3];
        _top_slice  =  w - slice[1] - slice[3];
        repeat = options.repeat[0];
      }else{
        _top_width = h2 - width[0]- width[2];
        _top_slice  =  h - slice[0] - slice[2];
        repeat = options.repeat[1];
      }


      if(repeat == "stretch"){
        return drawSide(side, 0,  _top_slice ,  0,     _top_width);
      }

      var _aspect =   slice[side] / width[side];
      var _one_width =  _top_slice *  width[side] / slice[side] ;
      var count = 1;
      var _left = 0;

      if(repeat == "repeat"){

        var _rest = _one_width - _top_width % _one_width / 2;
        var _rest_aspect  = _aspect * _rest;
        count =  Math.floor(_top_width / _one_width);


        if(_rest > 0){
          drawSide(side, _rest_aspect ,  _top_slice - _rest_aspect,  0,     _one_width - _rest)
        }

        _left =  _one_width - _rest;

        for(var i = 0 ; i< count;i ++){
          drawSide( side,0,   _top_slice ,  _left,     _one_width);
          _left +=_one_width;
        }

        if(_rest > 0){
          drawSide(side,  0 ,    _top_slice - _rest_aspect,  _left,    _one_width - _rest );
        }
      }
      if(repeat == "round"){

        _left = 0;
        count =  Math.max(1,Math.round(_top_width / _one_width));
        _one_width = _top_width / count;

        while(_left < _top_width){
          drawSide(side,0,     _top_slice ,  _left,     _one_width );
          _left +=_one_width;
        }
      }
    }

    _draw_border_side(0);
    _draw_border_side(2);
    _draw_border_side(1);
    _draw_border_side(3);

  //top left
    ctx.drawImage(img, 0, 0, slice[3], slice[0], 0, 0, width[3], width[0]);
  //top right
    ctx.drawImage(img, w - slice[1], 0, slice[1], slice[0],
      w2 - width[1], 0, width[1], width[0]);
  //bottom left
    ctx.drawImage(img, 0, h - slice[2], slice[3], slice[2],
      0, h2 - width[2], width[3], width[2]);

  //bottom right
    ctx.drawImage(img, w - slice[1], h - slice[2], slice[1], slice[2],
      w2 - width[1], h2 - width[2], width[1], width[2]);

  }

  /*
   var Frame = function(project,data){

   if(data.border_image){
   data.border_image = mixin( {
   "slice":          [25,25,25,25],
   "width":          [25,25,25,25],
   "fill":           false,
   "repeat":         ["round","round"],
   "outset"	:     [0, 0, 0, 0],
   "slice_units"   : [0, 0, 0, 0],
   "width_units"	: [0, 0, 0, 0],
   "outset_units"	: [0, 0, 0, 0]
   }, data.border_image)
   }


   this.superclass.constructor.call(this,project,data);
   this._add_root("mask");
   this._add_root("image");
   this.example = this._get_example();

   };*/
  fabric.util.getOffsetsClipPath = function(o) {

    return ['M', o[3], o[0], 'L', 100 - o[1], o[0], 'L', 100 - o[1], 100 - o[2], 'L', o[3], 100 - o[2], 'z'].join(" ");
  };

  fabric.util.getRadiusClipPath = function(radius,radius_units, width,height) {

  var br  = radius;
  var bru = radius_units || [1,1,1,1,1,1,1,1];



  var s = {
    "top-left-h":     br[0] * (bru[0] ? height / 100 : 1),
    "top-left-w":     br[1] * (bru[1] ? width / 100 : 1),
    "top-right-h":    br[2] * (bru[2] ? height / 100 : 1),
    "top-right-w":    br[3] * (bru[3] ? width / 100 : 1),
    "bottom-right-w": br[4] * (bru[4] ? width / 100 : 1),
    "bottom-right-h": br[5] * (bru[5] ? height / 100 : 1),
    "bottom-left-w":  br[6] * (bru[6] ? width / 100 : 1),
    "bottom-left-h":  br[7] * (bru[7] ? height / 100 : 1)
  };

  return [
    "M", 0, s["top-left-h"],
    "C", 0, s["top-left-h"], 0, 0, s["top-left-w"], 0,
    "H", width - s["top-right-w"],
    "C", width - s["top-right-w"], 0, width, 0, width, s["top-right-h"],
    "V", height - s["bottom-right-h"],
    "C", width, height - s["bottom-right-h"], width, height, width - s["bottom-right-w"], height,
    "H", s["bottom-left-w"],
    "C", s["bottom-left-w"], height, 0, height, 0, height - s["bottom-left-h"],
    "Z"
  ].join(" ");
};

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 29 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {


var _bindEvents = fabric.Canvas.prototype._bindEvents;
var _onMouseDown_overwritten = fabric.Canvas.prototype._onMouseDown;
var _onMouseUp_overwritten = fabric.Canvas.prototype._onMouseUp;
var _initEventListeners_overwritten = fabric.Canvas.prototype._initEventListeners;
var removeListeners_overwritten = fabric.Canvas.prototype.removeListeners;

fabric.util.object.extend(fabric.Canvas.prototype, {
  tapholdThreshold: 2000,
  _bindEvents: function () {
    _bindEvents.call(this);
    this._onClick = this._onClick.bind(this);
    this._onDoubleClick = this._onDoubleClick.bind(this);
    this._onTapHold = this._onTapHold.bind(this);
  },

  _onDoubleClick: function (e) {
    var self = this;

    var target = self.findTarget(e);
    self.fire('mouse:dblclick', {
      target: target,
      e: e
    });

    if (target && !self.isDrawingMode) {
      // To unify the behavior, the object's double click event does not fire on drawing mode.
      target.fire('dblclick', {
        e: e
      });
    }
  },

  _onDrop: function (e) {
    var _zoom = this.getZoom();
    e.x /= _zoom;
    e.y /= _zoom;
    e.offsetX /= _zoom;
    e.offsetY /= _zoom;
    e.width = e.helper.width() / _zoom;
    e.height = e.helper.height() / _zoom;
    var self = this;

    this.fire('mouse:drop', e);

  },

  _onDragMove: function (e) {
    var self = this;

    var target = self.findTarget(e.originalEvent);
    self.fire('mouse:dragmove', {
      target: target,
      e: e,
      data: e.data
    });
    if (target && !self.isDrawingMode) {
      // To unify the behavior, the object's double click event does not fire on drawing mode.
      target.fire('object:dragmove', {
        e: e,
        data: e.data
      });
    }
    if (this._last_target == target)return;
    if (this._last_target) {
      self.fire('mouse:dragleave', {
        target: this._last_target,
        e: e,
        data: e.data
      });
      this._last_target.fire('object:dragleave', {
        e: e,
        data: e.data
      });
      this._last_target = false;
    }
    if (target) {

      self.fire('mouse:dragenter', {
        target: target,
        e: e,
        data: e.data
      });
      target.fire('object:dragenter', {
        e: e,
        data: e.data
      });

      this._last_target = target;
    }

  },

  _onClick: function (e) {
    var self = this;

    var target = self.findTarget(e);
    self.fire('mouse:click', {
      target: target,
      e: e
    });

    if (target && !self.isDrawingMode) {
      if (
        target.originalState.left == target.left &&
        target.originalState.top == target.top &&
        target.originalState.scaleX == target.scaleX &&
        target.originalState.scaleY == target.scaleY &&
        target.originalState.angle == target.angle
      ) {
        // To unify the behavior, the object's double click event does not fire on drawing mode.
        target.fire('object:click', {
          e: e
        });
      }
    }
  },

  _onTapHold: function (e) {
    var self = this;

    var target = self.findTarget(e);
    self.fire('touch:taphold', {
      target: target,
      e: e
    });

    if (target && !self.isDrawingMode) {
      // To unify the behavior, the object's tap hold event does not fire on drawing mode.
      target.fire('taphold', {
        e: e
      });
    }

    if (e.type === 'touchend' && self.touchStartTimer != null) {
      clearTimeout(self.touchStartTimer);
    }
  },

  _onMouseDown: function (e) {
    _onMouseDown_overwritten.call(this, e);
    var self = this;
    if (e.type === 'touchstart') {
      var touchStartTimer = setTimeout(function () {
        self._onTapHold(e);
        self.isLongTap = true;
      }, self.tapholdThreshold);
      self.touchStartTimer = touchStartTimer;
      return;
    }

    // Add right click support
    if (e.which === 3) {
      var target = this.findTarget(e);
      self.fire('mouse:down', {target: target, e: e});
      if (target && !self.isDrawingMode) {
        // To unify the behavior, the object's mouse down event does not fire on drawing mode.
        target.fire('mousedown', {
          e: e
        });
      }
    }
  },

  _onMouseUp: function (e) {

    _onMouseUp_overwritten.call(this, e);

    if (e.type === 'touchend') {
      // Process tap hold.
      if (this.touchStartTimer != null) {
        clearTimeout(this.touchStartTimer);
      }
      // Process long tap.
      if (this.isLongTap) {
        this._onLongTapEnd(e);
        this.isLongTap = false;
      }
      // Process double click
      var now = new Date().getTime();
      var lastTouch = this.lastTouch || now + 1;
      var delta = now - lastTouch;
      if (delta < 300 && delta > 0) {
        // After we detct a doubletap, start over
        this.lastTouch = null;

        this._onDoubleTap(e);
      } else {
        this.lastTouch = now;
      }
    }
  },

  _onDoubleTap: function (e) {
    var self = this;

    var target = self.findTarget(e);
    self.fire('touch:doubletap', {
      target: target,
      e: e
    });

    if (target && !self.isDrawingMode) {
      // To unify the behavior, the object's double tap event does not fire on drawing mode.
      target.fire('object:doubletap', {
        e: e
      });
    }
  },

  _onLongTapEnd: function (e) {
    var self = this;

    var target = self.findTarget(e);
    self.fire('touch:longtapend', {
      target: target,
      e: e
    });

    if (target && !self.isDrawingMode) {
      // To unify the behavior, the object's long tap end event does not fire on drawing mode.
      target.fire('object:longtapend', {
        e: e
      });
    }
  },

  _initEventListeners: function () {
    var self = this;
    _initEventListeners_overwritten.call(self);

    fabric.util.addListener(self.upperCanvasEl, 'click', self._onClick);
    fabric.util.addListener(self.upperCanvasEl, 'dblclick', self._onDoubleClick);

    self.on('object:scaling', function (e) {
      if (e.target && e.target._scaling_events_enabled) {
        e.target.fire("scaling", e.e);
      }
    });
    self.on('object:selected', function (e) {
      if (e.target) {
        e.target.fire("object:selected", e.e);
      }
    });
    self.on('mouse:over', function (e) {
      if (e.target) {
        e.target.fire("mouse:over", e.e);
      }
    });

    self.on('mouse:out', function (e) {
      if (e.target) {
        e.target.fire("mouse:out", e.e);
      }
    });

  },

  removeListeners: function () {
    var self = this;
    removeListeners_overwritten.call(self);


    fabric.util.removeListener(self.upperCanvasEl, 'click', self._onClick);
    fabric.util.removeListener(self.upperCanvasEl, 'dblclick', self._onDoubleClick);
  }
});

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 30 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {


fabric.util.object.extend(fabric.Canvas.prototype, {
   // enableClipAreaZooming: function(){
      //todo
      // this.on('viewport:scaled', function(){
      //   if (!this.layer("background").objects) return;
      //   this._backgroundLayer[0].setCoords();
      // });
   // },
    _fabric_clip_function: function (ctx2) {

      var clipRect = this.clipRect;
      ctx2.save();
      clipRect.render(ctx2);
      ctx2.restore();

    }
  });

fabric.Object.prototype.setClipTo = function(val) {
  if (typeof val !== 'string') {
    this.clipTo = val;
  }

  var functionBody = fabric.util.getFunctionBody(val);
  if (typeof functionBody !== 'undefined') {
    this.clipTo = new Function('ctx', functionBody);
  }
};

/**
 * @private
 * @param {Object} [options] Options object
 */
fabric.Object.prototype._initClipping = function (options) {
  if (!options.clipTo || typeof options.clipTo !== 'string') {
    return;
  }
  if (options.clipTo[0] == '#') {
    //  var _id = options.clipTo[0].substring(1);
    this.clipTo = options.clipTo;
    return;
  }

  var functionBody = fabric.util.getFunctionBody(options.clipTo);
  if (typeof functionBody !== 'undefined') {
    this.clipTo = new Function('ctx', functionBody);
  }
};
fabric.Object.prototype.getClipTo = function () {
  return "#" + this.clipTo.id;
};

fabric.util.clipContext = function (receiver, ctx) {

  if (receiver.clipTo.constructor === String) {
    if (receiver.clipTo === "canvas") {
      receiver.clipTo = receiver.canvas;
    }
    else{

      var _id = receiver.clipTo.substring(1);

      var _clipCtx = receiver.canvas.getObjectByID(_id);
      if(_clipCtx){
        receiver.clipTo = _clipCtx;
      }else{
        console.warn("error: clipTo not found" + receiver.clipTo);
        delete receiver.clipTo;
        return;
      }
    }
  }



  ctx.save();
  ctx.beginPath();

  if (receiver.clipTo.constructor === Function) {
    receiver.clipTo(ctx);
  } else {
    fabric.util._clipToObject(receiver, ctx);
    ctx.clip();
  }

};

fabric.util._clipToObject = function (receiver, ctx) {
  ctx.save();
  ctx.beginPath();

  var fromLeft = false;
  var center = fromLeft ? receiver._getLeftTopCoords() : receiver.getCenterPoint();
  ctx.transform(1, Math.tan(fabric.util.degreesToRadians(-receiver.skewY)), 0, 1, 0, 0);
  ctx.transform(1, 0, Math.tan(fabric.util.degreesToRadians(-receiver.skewX)), 1, 0, 0);
  ctx.scale(
    (1 / receiver.scaleX) * (receiver.flipX ? -1 : 1),
    (1 / receiver.scaleY) * (receiver.flipY ? -1 : 1)
  );
  ctx.rotate(fabric.util.degreesToRadians(-receiver.angle));
  ctx.translate(-center.x, -center.y);


  if (receiver.clipTo.points) {
    var ps = receiver.clipTo.points;
    ctx.moveTo(ps[0].x, ps[0].y);
    for (var j = 1; j < ps.length; j++) {
      ctx.lineTo(ps[j].x, ps[j].y);
    }
    //ctx.stroke();
  } else if (receiver.clipTo.type == "path") {

    ctx.globalAlpha = 0;
    receiver.clipTo.transform(ctx);
    receiver.clipTo._render(ctx);
  } else if (receiver.clipTo.type == "slide-canvas") {
    ctx.rect(0,0, receiver.clipTo.width, receiver.clipTo.height);
  }else {
    ctx.translate(receiver.clipTo.left, receiver.clipTo.top);
    ctx.rotate(-(receiver.clipTo.angle * -1) * Math.PI / 180);
    ctx.rect(0,0, receiver.clipTo.width, receiver.clipTo.height);
  }

  ctx.closePath();
  ctx.restore();
};

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 31 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.util.object.extend(fabric,{
  debugTimeout: 0
});

fabric.util.object.extend(fabric.Application.prototype, {
  setDebug: function () {
    this.on("ready", function () {
      this.enableDebugging();
    })
  },

  enableDebugging: function(){
    if(fabric.debug){

      var _operand = "color: #2EC06C; font-style: italic;";
      console.info("debug enabled. (use %capp%c, %cproject%c, %ccanvas%c, %ctarget%c in console)",
        _operand, "color: #202020",
        _operand, "color: #202020",
        _operand, "color: #202020",
        _operand, "color: #202020");

      window.app = this;
      window.canvas = this.canvas;
      window.project = this.project;
      window.target = null;
      this.canvas && this.canvas.on("target:changed", function () {
        window.target = this.target;
      });
    }
  }
});

fabric.Object.prototype.debug = function(noBorders){
  var canvas = document.createElement("canvas");
  canvas.width = noBorders ?this.width: this.width + 2;
  canvas.height = noBorders ?this.height : this.height + 2;

  var ctx = canvas.getContext('2d');
  if(!noBorders){
    ctx.lineWidth=1;
    ctx.strokeStyle="yellow";
    ctx.strokeRect(0,0,this.width + 2,this.height+ 2);
    ctx.setLineDash([4,4]);
    ctx.strokeStyle="#000000";
    ctx.strokeRect(0,0,this.width + 2,this.height+ 2);
  }
  ctx.translate(this.width/2  + 1,this.height/2 + 1);
  var _clipTo = this.clipTo;
  delete this.clipTo;
  this.render(ctx,true);
  this.clipTo = _clipTo;
  window.open(canvas.toDataURL(),"_blank");
};


fabric.Application.prototype.logEvents = fabric.Object.prototype.logEvents = function eventsLogger(options){
  var _counter = {};
  for(var i in options){
    _counter[i] = 0;
    this.on(options[i],function(i, event) {
      console.log(i + " " + ++_counter[i],event);
    }.bind(this,i));
  }
};




/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 32 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.util.object.extend(fabric.SlideCanvas.prototype, {
  setDroppable: function(val){
    this.droppable = val;
    if(this.droppable){
      this.initDragAndDrop();
    }
  },
  droppable: false, //{}
  isDropAvailable: function (droppable, data) {

    for (var i in droppable) {
      if (droppable[i].constructor == Array) {
        if (droppable[i].indexOf(data[i]) == -1)return false;
      } else {
        if(droppable[i] == "*")continue;
        if (droppable[i] != data[i]) return false;
      }
    }
    return true;
    //return (this.supportedTypes == "*" || this.supportedTypes.indexOf(type)!= -1)
  },
  drop: function (data) {
    var _this = this;
    data = fabric.util.object.clone(data);

    if (data.category == "background") {
      this.setBackgroundImage(data.src, this.renderAll.bind(this))
    }
    else {
      data.active = true;
      _this.createObject(data);
    }


    //fabric.util.createObject(data, function (el) {
    //  app.canvas.add(el);
    //  app.canvas.setActiveObject(el);
    //});
  },
  initDragAndDrop: function () {
    this.on("mouse:drop", function (e) {
      var _x = (e.x - e.offsetX);
      var _y = (e.y - e.offsetY)
      var _w = (e.data.width || e.width  );
      var _h = (e.data.height || e.height );

      if (e.data.scaleX) {
        var _scaleX = e.data.scaleX / this.viewportTransform[0]

      } else {
        _scaleX = 1;
        _w /= this.viewportTransform[0]
      }

      if (e.data.scaleY) {
        var _scaleY = e.data.scaleY / this.viewportTransform[3];
      } else {
        _scaleY = 1;
        _h /= this.viewportTransform[3]
      }

      var _stroke = e.data.strokeWidth || 0;
      if (e.data.left) {
        _x += (e.data.left + _stroke) / this.viewportTransform[0];
      }
      if (e.data.top) {
        _y += (e.data.top + _stroke) / this.viewportTransform[3];
      }


      e.data = fabric.util.object.extend({}, e.data, {
        scaleX: _scaleX,
        scaleY: _scaleY,
        left: _x,
        top: _y,
        width: _w,
        height: _h,
        originalWidth: e.data.width,
        originalHeight: e.data.height
      });

      this.fire("before:drop",e);

      e.target = this.findTarget(e.originalEvent);
      if (e.target && !this.isDrawingMode) {
        // To unify the behavior, the object's double click event does not fire on drawing mode.
        e.target.fire('object:drop', e);
      }


      if (e.target && e.target.droppable) {
        if (this.isDropAvailable(e.target.droppable, e.data)) {
          e.target.deactivate();
          e.target.drop(e.data);
        }
      } else {
        if (this.droppable && this.isDropAvailable(this.droppable, e.data)) {
          this.drop(e.data);
        }
      }
    });
    this.on("mouse:dragenter", function (e) {
      if (e.target && e.target.droppable) {
        if (this.isDropAvailable(e.target.droppable, e.data)) {
          e.target.activate();
          e.e.helper.css("cursor", "alias");
          this.setCursor("alias");
        } else {
          e.e.helper.css("cursor", "not-allowed");
          this.setCursor("not-allowed");
        }
      }
    });
    this.on("mouse:dragleave", function (e) {
      if (e.target && e.target.droppable) {
        if (this.isDropAvailable(e.target.droppable, e.data)) {
          this._activated = false;
          e.target.deactivate()
        }
        e.e.helper.css("cursor", "pointer");
      }
    });
  }
});

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 33 */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(fabric) {if(typeof WebFont == "undefined"){
  fabric.webFontsLoader = __webpack_require__(66);
}else{
  fabric.webFontsLoader = WebFont;
}

//интересная библиотека
// http://opentype.js.org/index.html
//todo add step
//
// fabric.Application.prototype.steps.splice(3,0,"loadWebfonts");

fabric.util.object.extend(fabric.Application.prototype, {
  // setWebfonts: function (callback) {
  //
  // },
  setFonts: function (fonts, callback) {
    this.fonts = fonts;
    if(fabric.isLikelyNode){
      //todo шрифты не грузятся на сервере
      return callback();
    }
    // if(!fonts || !fonts.length){
    //   return callback();
    // }
    this.fire("loading",{type: "webfonts"});

    this._fonts = [];

    for(var i in this.fonts){
      this._fonts = this._fonts.concat(this.fonts[i]);
    }
    this._fonts = fabric.util.object.sortBy(this._fonts, function(font){ return font; });

    if(fabric.webFontsLoader && (this.fonts.google && this.fonts.google.length || this.fonts.custom && this.fonts.custom.length) ){
      var fonts_options = {
        active: function () {
          callback();
        }
      };
      if(this.fonts.google && this.fonts.google.length){
        fonts_options.google =  {
          families: this.fonts.google
        };
      }
      if(this.fonts.custom && this.fonts.custom.length){
        fonts_options.custom =  {
          families: this.fonts.custom
        };
      }

      fabric.webFontsLoader.load(fonts_options);
    } else {
      callback();
    }
    if (this.waitForWebfonts) {
      fabric.util.fonts.waitFor(this.waitForWebfonts, callback)
    }
  },
  fonts: {
    standart: [
      'Arial',
      'Arial Black',
      'Comic Sans MS',
      'Courier New',
      'Georgia',
      'Impact',
      'Lucida Console',
      'Tahoma',
      'Times New Roman',
      'Geneva',
      'sans-serif',
      'serif',
      'monospace',
      'cursive'
    ],
    google: [],
    custom: []
  }
});


fabric.util.fonts = {
  waitFor: function (fonts, callback) {
    var loadedFonts = 0;
    for (var i = 0, l = fonts.length; i < l; ++i) {
      (function (font) {
        var node = document.createElement('span');
        // Characters that vary significantly among different fonts
        node.innerHTML = 'giItT1WQy@!-/#';
        // Visible - so we can measure it - but not on the screen
        node.style.position = 'absolute';
        node.style.left = '-10000px';
        node.style.top = '-10000px';
        // Large font size makes even subtle changes obvious
        node.style.fontSize = '300px';
        // Reset any font properties
        node.style.fontFamily = 'sans-serif';
        node.style.fontVariant = 'normal';
        node.style.fontStyle = 'normal';
        node.style.fontWeight = 'normal';
        node.style.letterSpacing = '0';
        document.body.appendChild(node);

        // Remember width with no applied web font
        var width = node.offsetWidth;

        node.style.fontFamily = font;

        var interval;

        function checkFont() {
          // Compare current width with original width
          if (node && node.offsetWidth != width) {
            ++loadedFonts;
            node.parentNode.removeChild(node);
            node = null;
          }

          // If all fonts have been loaded
          if (loadedFonts >= fonts.length) {
            if (interval) {
              clearInterval(interval);
            }
            if (loadedFonts == fonts.length) {
              setTimeout(function () {
                callback();
              }, 50)
              return true;
            }
          }
        }

        if (!checkFont()) {
          interval = setInterval(checkFont, 50);
        }
      })(fonts[i]);
    }
  }
};

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 34 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric, __dirname) {


fabric.util.mediaRoot = "";
fabric.util.addNoCache = false;

fabric.util._loadImage_overwritten = fabric.util.loadImage;


fabric.util.object.extend(fabric.Application.prototype, {
  optionsOrder: (function(){
    var oo = fabric.Application.prototype.optionsOrder;
    oo.splice(oo.indexOf("canvasContainer"),0,"mediaRoot");
    return oo;
  })(),
  setMediaRoot: function (_mediaRoot) {
    if (_mediaRoot) {
      var _dirname;
      if (fabric.isLikelyNode) {
        _dirname = __dirname;
      } else {
        _dirname = fabric.util.path.getParentDirectoryUrl(window.location.href);
      }

    //  if ((_mediaRoot.indexOf("./") == 0)) {
    //  }
      var _last = _mediaRoot[_mediaRoot.length - 1];
      if (_last != "/" && _last != "\\") {
        _mediaRoot += "/"
      }
      _mediaRoot = fabric.util.path.resolve(_dirname + _mediaRoot);
      fabric.util.mediaRoot = _mediaRoot;
    }
  }
});




// if(!fabric.isLikelyNode){
//
//   var URL = require('url'),
//     HTTP = require('http'),
//     HTTPS = require('https'),
//     Image = require('canvas').Image;
//
//   /** @private */
//   var request = function (url, encoding, callback) {
//     var oURL = URL.parse(url);
//
//     // detect if http or https is used
//     if ( !oURL.port ) {
//       oURL.port = ( oURL.protocol.indexOf('https:') === 0 ) ? 443 : 80;
//     }
//
//     // assign request handler based on protocol
//     var reqHandler = (oURL.protocol.indexOf('https:') === 0 ) ? HTTPS : HTTP,
//       req = reqHandler.request({
//         hostname: oURL.hostname,
//         port: oURL.port,
//         path: oURL.path,
//         method: 'GET'
//       }, function(response) {
//         var body = '';
//         if (encoding) {
//           response.setEncoding(encoding);
//         }
//         response.on('end', function () {
//           callback(body);
//         });
//         response.on('data', function (chunk) {
//           if (response.statusCode === 200) {
//             body += chunk;
//           }
//         });
//       });
//
//     req.on('error', function(err) {
//       if (err.errno === process.ECONNREFUSED) {
//         fabric.log('ECONNREFUSED: connection refused to ' + oURL.hostname + ':' + oURL.port);
//       }
//       else {
//         fabric.log(err.message);
//       }
//       callback(null);
//     });
//
//     req.end();
//   }
//
//   /** @private */
//   var requestFs = function (path, callback) {
//     var fs = require('fs');
//     fs.readFile(path, function (err, data) {
//       if (err) {
//         fabric.log(err);
//         throw err;
//       }
//       else {
//         callback(data);
//       }
//     });
//   };
//
//   fabric.util.loadImage = function(url, callback, context) {
//
//
//     var img = new Image();
//     img.onerror = function(){
//       console.log("error");
//       callback && callback.call(context, null, true);
//     };
//     img.onload = function(){
//       console.log("success");
//       callback && callback.call(context, img);
//     };
//
//     function createImageAndCallBack(data) {
//       if (data) {
//         img.src = data;
//         // preserving original url, which seems to be lost in node-canvas
//         img._src = url;
//       }
//       else {
//         img = null;
//         callback && callback.call(context, null, true);
//       }
//     }
//
//     if (url && (url instanceof Buffer || url.indexOf('data') === 0)) {
//       img.src = img._src = url;
//     }
//     else if (url && url.indexOf('http') !== 0) {
//       var path = require("path");
//       url = fabric.util.getURL(url);
//       url =   path.resolve(fabric.util.mediaRoot, url);
//       img.src =  url;
//       // requestFs(url, createImageAndCallBack);
//     }
//     else if (url) {
//       request(url, 'binary', createImageAndCallBack);
//     }
//     else {
//       callback && callback.call(context, url);
//     }
//   };
// }else{
  fabric.util.loadResources = function (resources, callback, context, crossOrigin) {

    var loadedResources = {};
    var loader = fabric.util.queueLoad(Object.keys(resources).length,function(){
      callback(loadedResources);
    });
    for(var i in resources){
      (function(i){
        fabric.util.loadImage(resources[i], function(image){
          loadedResources[i] = image;
          loader();
        }, context, crossOrigin);
      }(i));
    }
  };

  fabric.util.loadImage = function (url, callback, context, crossOrigin) {
    url = fabric.util.getURL(url);
    function _check_errors(img){
      //изображение не было загружено
      if (img) {
        callback.call(this,img);
      } else {
        fabric.errors.push({type: "image", message: "Image was not loaded"});
        fabric.util._loadImage_overwritten(fabric.media.error, callback, context, crossOrigin || 'Anonymous');
      }
    }

    if(fabric.debugTimeout){
      setTimeout(fabric.util._loadImage_overwritten.bind(this,url, _check_errors , context, crossOrigin || 'Anonymous'),fabric.debugTimeout)
    }else{
      fabric.util._loadImage_overwritten(url, _check_errors , context, crossOrigin || 'Anonymous');
    }
  };


fabric.util.getURL = function(url){
  if (url.indexOf('blob') !== 0 && url.indexOf('data') !== 0 && url.indexOf('://') == -1) {
    url = fabric.util.mediaRoot + url;
  }
  if (fabric.util.addNoCache && /^(http|https)\:\/\//.test(url)) {
    url += '?no-cache=' + new Date().getTime()
  }
  return url;
};


fabric.util.loadVideo = function (sources, callback, context, crossOrigin) {

  function loadIt(url){
    video.src = fabric.util.getURL(url);
    video.addEventListener("loadeddata", function(){
      callback(video);
    }, true);
    video.load();
  }




  var video = document.createElement('video');


  //trying to find the most suitable source for current browser
  for (var type in sources) {
    if(video.canPlayType(type) == "yes"){
      this.mediaType = type;
      loadIt(sources[type]);
      return;
    }
  }
  for (var type in sources) {
    if(video.canPlayType(type) == "maybe"){
      this.mediaType = type;
      loadIt(sources[type]);
      return;
    }
  }
  console.warn("video sources formats is not supported")


};

fabric.util._loadSVGFromURL_overwritten = fabric.loadSVGFromURL;
fabric.loadSVGFromURL = function (url, callback, reviver) {
  if (url.indexOf('data') !== 0 && url.indexOf('://') == -1) {
    url = fabric.util.mediaRoot + url;
  }
  if (fabric.util.addNoCache && /^(http|https)\:\/\//.test(url)) {
    url += '?no-cache=' + moment().format('x');
  }
  fabric.util._loadSVGFromURL_overwritten(url, function(data){
     if(data){
       return callback(data);
     }

    var xml = jQuery.parseXML(atob(fabric.media.error.substr(26)));

    fabric.parseSVGDocument(xml.documentElement, function (results, options) {
      callback && callback(results, options);
    }, reviver);

  }, reviver);
};

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0), "/"))

/***/ }),
/* 35 */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(fabric) {
/*
export interface GalleryData : {
 target: fabricjs object
}
*/


fabric.Application.prototype.setElementFromMenu = function (selectedData) {
  this.canvas.createImageObject(selectedData.image, this.uploadClass);
};

fabric.util.object.extend(fabric.Application.prototype, {
  draggableArea: ".ff-container",
  /*createGallery: function (target, $el, options) {
    if ($el.constructor === String) {
      $el = $("#" + $el);
    }
    options = options || {};

    if (target.galleryCategory) {
      options.category = target.galleryCategory;
    }

    $el.empty();
    var library = this.getLibraryElements(options);


    this.createElementsList($el, library);

    _.each(library, function (libraryItem) {
      var img = new Image();
      img.src = fabric.util.mediaRoot + libraryItem.src;

      var $img = $(img).width(100).height(100)
        .click(function () {

          var selectedData = {
            image: img,
            data: libraryItem,
            options: options
          };
          target.setElementFromMenu(selectedData);
        });

      $el.append($img);
    });
  },*/
  getFontsLibrary: function () {
    return _.map(this._fonts,function(fontName){
      return {
        fontFamily: fontName,
        fontSize: 25,
        category: "fontFamily",
        text: fontName,
        type: "text"
      }
    })
  },
  _addCanvasEl: function (el, element,$innerEl){

    // element = fabric.util.object.cloneDeep(element);

    var canvasEl = document.createElement("canvas");
    canvasEl.width = 156;
    canvasEl.height = 86;

    var _fake_canvas = new fabric.StaticCanvas(canvasEl,{application: this});
    _fake_canvas.clear();

    element.position = "center";

    _fake_canvas.createObject(element,function(_object){
      var b = _object.getBoundingRect();
     /* _object.set({
        left : 80 - b.width/2 - _object.strokeWidth * 2,
        top : 45 - b.height/2 - _object.strokeWidth * 2
      });*/

      fabric.util.object.extend(element,{
        scaleX: _object.scaleX,
        scaleY: _object.scaleY,
        width: _object.width,
        height: _object.height,
        left: _object.left,
        top: _object.top,
        strokeWidth: _object.strokeWidth
      });

      delete element.position;

      _fake_canvas.add(_object);
      _fake_canvas.renderAll();

      $innerEl[0].src = canvasEl.toDataURL();

      delete _object.canvas;
      el[0].data = element;
      el[0].element = _object;

    });
  },
  updateElementsList: function ($el, library, options) {

    var app = this;
    for (var i in library) {
      var element = library[i];
      var el = $("<span>")
        .addClass("list-item");

      el[0].data = element;

      if (options.element) {
        element = options.element(element);
      }

      if (element.title) {
        var $span = $("<span>").text(element.title).addClass("element-title");
        el.append($span);
      }
      var $innerEl = null;

      if (options.render) {
        $innerEl = options.render(element);
      } else {
        if (element.category == "fontFamily") {
          $innerEl = $("<span>").css({
            "color": element.fill || fabric.Text.prototype.fill,
            "font-family": element.fontFamily,
            "font-size": element.fontSize
          }).text(element.text);
        } else {
          switch (element.type) {
            case "image":
              $innerEl = $("<img>").attr({
                src: fabric.util.mediaRoot + element.src
              });
              el[0].element = $innerEl[0];
              break;
            case "video":
              $innerEl = $("<video>");
              for (var type in element.src) {
                $innerEl.append($("<source>").attr({
                  src: fabric.util.mediaRoot + element.src[type],
                  type: type
                }));
              }
              el[0].element = $innerEl[0];
              break;
            default:
              $innerEl = $("<img width=160 height=90>");
              this._addCanvasEl(el, element, $innerEl);
          }
        }
      }
      if ($innerEl.constructor == Array) {
        var _span = $("<span>");
        _span.append($innerEl);
        $innerEl = _span;
      }
      el.append($innerEl);


      if (options.draggable) {
        $innerEl.draggable({
          draggable: "helper",
          droppable: ".canvas-container",
          ngModel: element,
          onMove: function (data) {
            app.canvas._onDragMove && app.canvas._onDragMove(data.$event);
          },
          onDrop: function (data) {
            app.canvas._onDrop(data.$event);
          },
          draggableArea: app.draggableArea
        })
      }
      $innerEl.click(options.activate.bind(this, el[0]));
      $el.append(el);
    }
  },
  createElementsList: function ($el, library, options) {
    options = fabric.util.object.defaults(options || {}, {
      draggable: true,
      activate: function (el) {
        if (this.target && this.target.setElement) {
          this.target.setElement(el.data);
        } else {

          this.canvas.createObject(fabric.util.object.deepExtend({
            position: "center"
          }, el.data));
        }
      }
    });
    this.updateElementsList($el, library, options);
  }
});

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 36 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

var History = __webpack_require__(75);

History.prototype.insertRecords = false;
History.prototype.actions = {
  undo: {
    keyCode: 'z',
    ctrlKey:  true,
    observe: 'changed',
    className: 'fa fa-undo',
    title: 'undo',
    enabled: 'canUndo',
    action: function(){
      this.undo();
    }
  },
  records: {
    title:          "records",
    itemClassName:  "filters-selector",
    className:      "fa fa-history",
    type:           "select",
    templateSelection: function(state, container) {
      if (state.any) {
        return state.text;
      }
      return $('<span>' + state.id + ":" + state.type + '</span>');
    },
    templateResult: function(state, container,data) {
      if(!state.type)return;
      var _keys = state.originalState && Object.keys(state.originalState).join(',') || '';
      var type = state.object && state.object.type || '';
      return $("<span>{id}:{type}({otype} {keys})</span>".format(fabric.util.object.extend({keys : _keys, otype: type},state)));
      // if(state.id != "none"){
      //   var $canvas = $('<canvas>');
      //   $el.prepend($canvas);
      // }
      // return $el;
    },
    value:      {
      observe: 'changed',
      set : function(val,filtersData){
        this.goto(val);
      },
      get: function(){
        return this.records[this.current].id;
      },
      options: function(){
        return this.records;
      }
    }
  },
  redo: {
    keyCode: 'y',
    ctrlKey:  true,
    observe: 'changed',
    className: 'fa fa-repeat',
    title: 'redo',
    enabled: 'canRedo',
    action: function(){
      this.redo();
    }
  }
};

fabric.util.object.extend(fabric.SlideCanvas.prototype.actions, {
  history: {
    title: 'history',
    type: 'menu',
    target: function () {
      return this.history;
    },
    menu: function () {
      return this.actions;
    }
  }
});



fabric.util.object.extend(fabric.Canvas.prototype, {
  insertHistory: false,
  onObjectModified: function (e) {
    if (!this.history.enabled || this.processing || this.history.processing) {
      return false;
    }
    var _canvas = e.target.canvas || e.target.wrapperEl && e.target;

    this.history.add({
      canvas:  e.target.canvas.originalSlide || e.target.canvas,
      originalState:  e.states.original,
      modifiedState:  e.states.modified,
      object: e.target,
      type: 'object:modified',
      undo: function (_action) {
        _action.object.set(_action.originalState);
        if(_action.canvas.mirrorSlide == this.canvas){
          _action.object.setCoords();
          var _canvas = this.canvas || this;
          _canvas.renderAll();
        }
        _action.canvas.fire('object:modified', { target: _action.object });
        _action.object.fire('modified');
        _action.canvas.renderAll();
      },
      redo: function (_action) {
        _action.object.set(_action.modifiedState);
        _action.object.setCoords();
        if(_action.canvas.mirrorSlide == this.canvas){
          _action.object.setCoords();
          var _canvas = this.canvas || this;
          _canvas.renderAll();
        }
        _action.canvas.fire('object:modified', { target: _action.object });
        _action.object.fire('modified');
        _action.canvas.renderAll();
      }
    });
  },
  clearHistory: function () {
    this.history.clear();
  },
  disableHistory: function () {
    this.history.enabled = false;
  },
  _add_object_history_action: function (_action) {
    var _canvas = this.canvas || this;
    if(this.canvas && _action.canvas.mirrorSlide == this.canvas){
      _canvas.add(_action.object);
      _canvas.setActiveObject(_action.object);
      _canvas.renderAll();
    }else{
      _action.canvas.add(_action.object);
    }
    _action.canvas.renderAll();
  },

  _remove_object_history_action: function (_action) {
    _action.canvas.remove(_action.object);
    _action.canvas.renderAll();
    if(this.canvas && _action.canvas.mirrorSlide == this.canvas){
      this.canvas.renderAll();
    }
  },

  onObjectRemoved: function (e) {
    if (!this.history.enabled || this.processing || this.history.processing) {
      return false;
    }
    this.history.add({
      canvas: e.target.canvas.originalSlide || e.target.canvas,
      object: e.target,
      type: 'object:removed',
      redo: this._remove_object_history_action,
      undo: this._add_object_history_action
    });
  },
  onDrawAfter: function(event){
    if (!this.history.enabled || this.processing || this.history.processing) {
      return false;
    }
    this.history.add(this.freeDrawingBrush.getHistoryRecord(event))
  },
  onObjectAdded: function (e) {
    if (!this.history.enabled || this.processing || this.history.processing) {
      return false;
    }
    this.history.add({
      canvas:  e.target.canvas.originalSlide || e.target.canvas,
      object: e.target,
      type: 'object:added',
      undo: this._remove_object_history_action,
      redo: this._add_object_history_action
    });
  },
  initHistory: function (history) {
    if(!history){
      history = new History(this);
      history.application = this.application;
    }

    this.history = history;
    this.on({
      'loading:begin':    this.clearHistory,
      'draw:after':       this.onDrawAfter,
      'object:modified':  this.onObjectModified,
      'object:added':     this.onObjectAdded,
      'object:removed':   this.onObjectRemoved
    });

    var _this = this;
    this.history.on('changed', function(e){
      if(this.activeAction.canvas){
        this.activeAction.canvas.moment = e.action.moment;
      }
    });
    var proto = this.application.prototypes.History;
    if(proto){
      if(proto.eventListeners){
        history.on(proto.eventListeners);
      }
    }
  },
  enableHistory: function () {
    this.history.enabled = true;
  }
});

fabric.HISTORY_OPTIONS = {
  INDIVIDUAL: 0,
  SHARED: 1
};

fabric.util.object.extend(fabric.Application.prototype, {
  history: true,
  setHistory: function(historyOption){

    if(historyOption === fabric.HISTORY_OPTIONS.SHARED){
      this.history = new History(this);
      this.enableHistory();

      this.on("ready",function(){
        if (this.canvas) {
          this.canvas.initHistory(this.history);
        }
      })

    }
    if(historyOption === fabric.HISTORY_OPTIONS.INDIVIDUAL){
      //todo unsupported
    }

  },
  actions: fabric.util.object.extend(fabric.Application.prototype.actions,{
    history: {
      insert: 'historyTools',
      title: 'history',
      type: 'menu',
      target: function () {
        return this.history;
      },
      menu: function () {
        return this.actions;
      }
    }
  }),
  _default_event_listeners : {
    "slide:change:begin" : function(){
      this.processing = true ;
      if(this.history){
        this.history.processing = true ;
      }
    },
    "slide:changed" : function(){
      this.processing = false;
      if(this.history){
        this.history.processing = false;
      }
    }
  },
  historyTools: false,
  enableHistory: function () {
    this.history.enabled = true;
  }
});

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 37 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

{

  /*
   fabric.Image.filters.Redify = fabric.util.createClass(fabric.Image.filters.BaseFilter, {
   type: 'Redify',
   applyTo: function (canvasEl) {
   var context = canvasEl.getContext('2d'),
   imageData = context.getImageData(0, 0,
   canvasEl.width, canvasEl.height),
   data = imageData.data;
   for (var i = 0, len = data.length; i < len; i += 4) {
   data[i + 1] = 0;
   data[i + 2] = 0;
   }
   context.putImageData(imageData, 0, 0);
   }
   });
   fabric.Image.filters.Redify.fromObject = function (object) {
   return new fabric.Image.filters.Redify(object);
   };
   */

  fabric.Image.filters.Sharpen = fabric.util.createClass(fabric.Image.filters.Convolute, {
    type: 'Sharpen',
    initialize: function(options) {
      options = options || { };

      this.opaque = options.opaque;
      this.matrix = options.matrix || [
          0, -1, 0,
          -1, 5, -1,
          0, -1, 0
        ];
    }
  });
  fabric.Image.filters.Sharpen.fromObject = function (object) {
    return new fabric.Image.filters.Sharpen(object);
  };

  fabric.Image.filters.Blur = fabric.util.createClass(fabric.Image.filters.Convolute, {
    type: 'Blur',
    initialize: function(options) {
      options = options || { };

      var _v = 1 / 9;
      this.opaque = options.opaque;
      this.matrix = options.matrix || [
          _v, _v, _v,
          _v, _v, _v,
          _v, _v, _v
        ];
    }
  });
  fabric.Image.filters.Blur.fromObject = function (object) {
    return new fabric.Image.filters.Blur(object);
  };

  fabric.Image.filters.Emboss = fabric.util.createClass(fabric.Image.filters.Convolute, {
    type: 'Emboss',
    initialize: function(options) {
      options = options || { };

      this.opaque = options.opaque;
      this.matrix = options.matrix || [
          1,   1,   1,
          1, 0.7,  -1,
          -1,  -1,  -1
        ];
    }
  });
  fabric.Image.filters.Emboss.fromObject = function (object) {
    return new fabric.Image.filters.Emboss(object);
  };


  fabric.Image.filters.Mask.prototype.maskFilter = true;

  var prototypeOptions = {
    Brightness: {
      "brightness": {value: 100, min: 0, max: 255}
    },
    Noise: {
      "noise": {value: 100, min: 0, max: 1000}
    },
    Convolute: {
      "opaque": {value: true, type: "boolean" },
      "matrix": {value: [1, 1, 1, 1, 1, 1, 1, 1, 1], type: "matrix" }
    },
    Blur: {},
    Sharpen: {},
    Emboss: {},
    Multiply: {
      "color": {type: 'color', value: "#F0F"}
    },
    Pixelate: {
      "blocksize": {value: 4, min: 2, max: 20}
    },
    Tint: {
      "color":  {type: 'color', value: "#3513B0"},
      "opacity": {value: 1, min: 0, max: 1, step: 0.1}
    },
    Mask: {
      mask: {
        type: 'image',
        value: {
          src:  "photos/explosion.png"
        }
      },
      channel: { value: 0}
    },
    Blend: {
      "color": {type: 'color', value: "#3513B0"},
      "mode": {
        value: "add",
        options: [
          {value: "add", title: "Add"},
          {value: "diff", title: "Diff"},
          {value: "subtract", title: "Subtract"},
          {value: "multiply", title: "Multiply"},
          {value: "screen", title: "Screen"},
          {value: "lighten", title: "Lighten"},
          {value: "darken", title: "Darken"}
        ]
      }
    }
  };


  for(var i in prototypeOptions){
    fabric.Image.filters[i].prototype.options = prototypeOptions[i];
  }



}




fabric.Image.getFiltersList = function(el){

  el = el || fabric.Image.prototype;
  var filterList = [];
  for(var i in el.availableFilters){
    var _f = fabric.Image.filters[el.availableFilters[i]];

    var _data = {
      type:     el.availableFilters[i]
    };
    if(_f.prototype.custom){
      if(!el.customFilters){
        continue;
      }
    }
    if(_f.prototype.maskFilter){
      if(!el.maskFilter){
        continue;
      }
    }
    if(_f.prototype.caman){
      if(!el.camanFilters){
        continue;
      }
      _data.caman = true;
    }else{
      if(!el.fabricFilters){
        continue;
      }
    }
    if(_f.prototype.options){
      _data.options = fabric.util.object.clone(_f.prototype.options);
    }
    _data.text = _f.prototype.title || el.availableFilters[i];

    filterList.push(_data)
  }
  return filterList;
};

fabric.util.object.extend(fabric.Image.prototype, {
  camanFilters: false,
  fabricFilters: true,
  customFilters: false,
  maskFilter: false,
  getFiltersData : function () {
    var _filters = fabric.Image.getFiltersList(this);
    for (var i in this.filters) {
      var _f = fabric.util.object.findWhere(_filters,{type: fabric.util.string.capitalize(this.filters[i].type)})
      if(_f){
        _f.enabled = true;
      }
    }
    return _filters;
  },
  availableFilters: [
    //fabricJS
    "Grayscale",
    "Sepia",
    "Sepia2",
    "Invert",
    "Blur",
    "Sharpen",
    "Emboss",
    "Blend",
    "Tint",
    "Multiply",
    //"Convolute",
    "Noise",
    "Brightness",
    "Pixelate",
    "GradientTransparency",
    "Mask"
  ],
  getFilter: function (filterName) {
    filterName = fabric.util.string.uncapitalize(filterName);
    for(var i in this.filters){
      if(fabric.util.string.uncapitalize(this.filters[i].type) === filterName){
        return this.filters[i];
      }
    }
    return false;
  },
  setFilter: function (filter) {

    var _old_filter = false;
    if(filter.replace){
      this.filters = [];
    }else{
      _old_filter = fabric.util.object.findWhere(this.filters, {type: filter.type});
      _old_filter = _old_filter && _old_filter.toObject() || false;
    }


    if(filter.type){
      var _type = fabric.util.string.capitalize(filter.type,true);
      var _new_filter = filter.options && fabric.util.object.clone(filter.options);


    }else{
      _type = false;
      _new_filter = false;
    }

    /* this.project.history.add({
     data:   [$.extend(true, {}, this.data)],
     slide:  this.slide,
     object: this,
     redo:   filter,
     undo:   _old_filter ,
     type:   "filter",
     undoFn: function(action){
     action.object._set_filter(action.undo);
     },
     redoFn:  function(action){
     action.object._set_filter(action.redo);
     }
     });
     */
    this._set_filter(_type, _new_filter, _old_filter);

  },

  _set_filter: function (_type, _new_filter) {

    if(_type){
      var _old_filter = this.getFilter(_type);
    }

    if (_old_filter && _new_filter) {
      for (var i in _new_filter) {
        _old_filter[i] = _new_filter[i];
      }
    } else if (_old_filter && !_new_filter) {
      this.filters.splice(this.filters.indexOf(_old_filter), 1);
    }
    if (!_old_filter && _new_filter) {
      this.filters.push(new fabric.Image.filters[_type](_new_filter));
    }
    this.applyFilters(this.canvas.renderAll.bind(this.canvas));
  },

  insertImageFilters: false,
  actions : fabric.util.object.extend(fabric.Image.prototype.actions, {
    imageFilters: {
      title: "фильтр",
      itemClassName: "filters-selector",
      className: "fa fa-filter",
      type: "select",
      templateSelection: function (state, container) {
        if (state.any) {
          return state.text;
        }
        return $('<span><span class="color-span" style="background-color:' + state.text + '"></span>' + state.text + '</span>');
      },
      templateResult: function (state, container, data) {
        var $el = $('<span>' + state.text + '</span>');
        if (state.id != "none") {
          var $canvas = $('<canvas>');
          fabric.util.drawFilter($canvas[0], data.target._element, state.id, {
            height: 22
          });
          $el.prepend($canvas);
        }
        return $el;
      },
      value: {
        set: function (val, filtersData) {
          var options = false;
          if (val == "none") {
            val = false;
          } else {
            var _f = _.findWhere(filtersData, {id: val});
            _f.enabled = !_f.enabled;
            for (var i in _f.options) {
              if ($.isNumeric(_f.options[i])) {
                _f.options[i] = parseFloat(_f.options[i]);
              }
            }
            if (_f.enabled) {
              options = {};
              for (var i in _f.options) {
                options[i] = _f.options[i].value;
              }
            }


          }
          this.setFilter({
            type: val,
            options: options,
            replace: true
          });
        },
        get: function () {
          return this.filters.length ? fabric.util.string.capitalize(this.filters[0].type, true) : "none"
        },
        options: function () {

          var _filters = this.getFiltersData();
          for (var i in _filters) {
            _filters[i].id = _filters[i].type;
          }
          return [{
            id: 'none',
            text: 'original',
            enabled: !this.filters || !this.filters.length
          }].concat(_filters);

        }
      }
    }
  })
});

//
// fabric.Image.filterManager = {
//
//   //hide: function(object){
//   //
//   //},
//   show: function (object) {
//     this.activeObject = object;
//     this.fire('show', object);
//     this.on('target:changed', object)
//   }
// // };



// fabric.util.observable(fabric.Image.filterManager);

fabric.util.drawFilter = function(element,src, filterName ,options){
  if(src.constructor === String){
    fabric.util.loadImage(src,function(el){
      fabric.util._drawFilter(element, el, filterName ,options);
    })
  }else{
    fabric.util._drawFilter(element,src, filterName ,options);
  }
};

fabric.util._drawFilter = function(element, el, filterName ,options){

  var ctx =element.getContext("2d");
  if(options){
    if(options.width && options.height){
      element.width = options.width;
      element.height = options.height;
    }else if(options.width){
      element.width = options.width;
      element.height = options.width * (el.height / el.width);
    }else if(options.height){
      element.height = options.height;
      element.width = options.height * (el.width / el.height);
    }
  }

  ctx.drawImage(el,0,0,element.width,element.height);
  if(!filterName)return;
  filterName = fabric.util.string.capitalize(filterName,true);

  if(fabric.Image.filters[filterName]){
    var _filter = new fabric.Image.filters[filterName]()
  }else{
    var _filter =fabric.Image.filters[filterName].create({});
  }

  //var _filter = new fabric.Image.filters[filterName];
  if(_filter){
    var _fo = fabric.Image.filters[filterName].prototype.options;
    var filterOptions = {};
    for(var i in _fo){
      filterOptions[i] = _fo[i].value;

    }
    fabric.util.object.extend(_filter,filterOptions);
    _filter.imageData = ctx.getImageData(0,0,element.width,element.height);
    _filter.applyTo(element);
  }
};

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 38 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {/**
* InteractiveMode mixin. Allow to switch between pan/edit/drawing canvas modes.
*/




var _mouse_down_overwritten = fabric.Canvas.prototype._onMouseDown;
var _mouse_up_overwritten = fabric.Canvas.prototype._onMouseUp;
var _mouse_move_overwritten = fabric.Canvas.prototype._onMouseMove;

fabric.util.object.extend(fabric.SlideCanvas.prototype, {
  _initEventListeners_overwritten: fabric.Canvas.prototype._initEventListeners,
  _initEventListeners: function () {
    this._initEventListeners_overwritten();
    this.___onKeyDown = this._onKeyDown.bind(this);
    fabric.util.addListener(fabric.window, 'keydown', this.___onKeyDown);
  },
  _removeListeners_overwritten: fabric.Canvas.prototype.removeListeners,
  removeListeners: function () {
    this._removeListeners_overwritten();
    fabric.util.removeListener(fabric.window, 'keydown', this.___onKeyDown);
  },
  _onKeyDown: function (e) {
    return this._applyMixedMode(e);
  },
  getInteractiveMode: function () {
    return this.interactiveMode;
  },
  setInteractiveMode: function (tool) {
    //todo checkthis out
    // if (tool === 'hand') {
    //   this.setCursor('pointer');
    // }
    this.isDrawingMode = (tool === 'draw');
    this.isHandMode = (tool === 'hand');
    this.interactive = (tool !== 'disabled');
    this.isMixedMode = (tool === 'mixed');

    if (!this.interactive) {
      this.upperCanvasEl.style.cursor = 'default';
    }
    this.interactiveMode = tool;
  },

  /**
   *  current mode
   *  @values default | hand | selection
   *  @comment
   *      hand      - moving canvas
   *      draw - drawing reactangles
   *      selection - default behavior
   */
  interactiveMode: 'default',

  isHandMode: false,
  _handModeCursorMove: false,
  _handModeCursorDown: false,
  _handModeCursorPosition: {x: 0, y: 0},
  _handModeMouseMove: function (e) {
    if (this._handModeCursorDown === true) {

      if (e.pageY === this._handModeCursorPosition.y && e.pageX === this._handModeCursorPosition.x) {
        return;
      }

      this._handModeCursorMove = true;

      var scroll = {x: this.viewportTransform[4], y: this.viewportTransform[5]};

      var newScroll = {
        x: scroll.x - (this._handModeCursorPosition.x - e.pageX),
        y: scroll.y - (this._handModeCursorPosition.y - e.pageY)
      };

      var dims = {
        width: this.size.width * this.zoom - this.lowerCanvasEl.width,
        height: this.size.height * this.zoom - this.lowerCanvasEl.height
      };
      /*  todo need to add some restrictions later
       //Math.max(Math.min(0,newScroll.x),-dims.width);
       //Math.max(Math.min(0,newScroll.y),-dims.height);
       */
      this.viewportTransform[4] = newScroll.x;
      this.viewportTransform[5] = newScroll.y;

      this.fire('viewport:translate');

      this.renderAll();
      for (var i = 0, len = this._objects.length; i < len; i++) {
        this._objects[i].setCoords();
      }

      this._handModeCursorPosition.y = e.pageY;
      this._handModeCursorPosition.x = e.pageX;
    }
  },
  _handModeMouseUp: function () {
    this._handModeCursorDown = false;
    if (!this._handModeCursorMove) {

    }
  },
  _handModeMouseDown: function (e) {

    this._handModeCursorMove = false;
    this._handModeCursorDown = true;
    this._handModeCursorPosition = {
      y: e.pageY,
      x: e.pageX
    };
  },
  handModeEnabled: false,
  handModeKey: "Alt",
  _applyMixedMode: function (e) {
    this._current_target = this.findTarget(e);

    if (this.handModeEnabled && e.altKey || e.key === this.handModeKey) {
      //if shift use hand mode
      if (!this.isHandMode) {
        this.isHandMode = true;
        this.isDrawingMode = false;
        this.setCursor('pointer');
      }
    } else if (this.isMixedMode && !this._isCurrentlyDrawing && !this._currentTransform) {

      this.isHandMode = false;

      if (this._current_target) {
        if (this.freeDrawingBrush && this._current_target.allowDrawing) {
          var corner = this._current_target._findTargetCorner(this.getPointer(e, true));
          if (!corner) {
            this.isDrawingMode = true;
          } else {
            this.isDrawingMode = false;
          }
        } else if (this.isDrawingMode) {
          this.isDrawingMode = false;
        }
      } else {
        if (this.freeDrawingBrush && !this.isDrawingMode) {
          this.setCursor(this.freeDrawingCursor);
          this.isDrawingMode = true;
        }
      }
    } else {
      this.isHandMode = false;
    }

  },
  _onMouseMove: function (e) {
    if (!this.interactive) {
      return;
    }

    this._applyMixedMode(e);

    if (this.isHandMode) {

      if (this._current_target && this._current_target.selectable_overwritten) {
        this._current_target.selectable = true;
      }

      if (this._handModeActive) {
        return this._handModeMouseMove(e);
      }
      this.fire('mouse:move', {target: this._current_target, e: e});
      this._current_target && this._current_target.fire('mousemove', {e: e});
      return true;
    } else {
      return _mouse_move_overwritten.call(this, e);
    }
  }, /**
   * @private
   */
  _onScale: function (e, transform, x, y) {

    var useUniScale = e.shiftKey ^ this.shiftInverted;
    // rotate object only if shift key is not pressed
    // and if it is not a group we are transforming
    if ((useUniScale || this.uniScaleTransform) && !transform.target.get('lockUniScaling')) {
      transform.currentAction = 'scale';
      return this._scaleObject(x, y);
    }
    else {
      // Switch from a normal resize to proportional
      if (!transform.reset && transform.currentAction === 'scale') {
        this._resetCurrentTransform(e);
      }

      transform.currentAction = 'scaleEqually';
      return this._scaleObject(x, y, 'equally');
    }
  },
  shiftInverted: false,
  _setCursorFromEvent_overwritten: fabric.Canvas.prototype._setCursorFromEvent,
  _setCursorFromEvent: function (e, target) {
    if (this.isHandMode) {
      this.setCursor('pointer');
    } else {
      this._setCursorFromEvent_overwritten(e, target);
    }
  },
  _onMouseDown: function (e) {
    if (!this.interactive) {
      return;
    }

    e.preventDefault();
    e.stopPropagation();

    this._applyMixedMode(e);
    if (this.isHandMode && this._current_target) {
      this._current_target.selectable_overwritten = this._current_target.selectable;
      this._current_target.selectable = false;
    }

    _mouse_down_overwritten.call(this, e);


    if (this.isHandMode) {

      if (this._current_target && this._current_target.selectable_overwritten) {
        this._current_target.selectable = true;
      }
      this._handModeActive = true;
      this._handModeMouseDown(e);
    }
  },

  _onMouseUp: function (e) {
    if (!this.interactive) {
      return;
    }
    e.preventDefault();
    e.stopPropagation();
    _mouse_up_overwritten.call(this, e);

    if (this.isHandMode) {
      this._handModeActive = false;
    }
  }
});

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 39 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.objectsLibrary = {
  text: {
    title: "Text",
    type: "i-text",
    text: "Текст"
  },
  line: {
    type: "line",
    strokeWidth: 5,
    stroke: "black",
    scaleX: 1,
    scaleY: 1,
    x1: 0,
    x2: 100,
    y1: 0,
    y2: 50
  },
  triangle: {
    type: "triangle",
    width: function(w,h){ return Math.min(w,h) - 4},
    height: function(w,h){ return Math.min(w,h) - 4}
  },
  rectangle: {
    type: "rect",
    width: function(w,h){ return Math.min(w,h) - 4},
    height: function(w,h){ return Math.min(w,h) - 4}
  },
  polygon: {
    scaleX: 1,
    scaleY: 1,
    type: "polygon",
    points: function(w,h) {
      return [
        {x: 25, y: 1},
        {x: 31, y: 18},
        {x: 49, y: 18},
        {x: 35, y: 29},
        {x: 40, y: 46},
        {x: 25, y: 36},
        {x: 10, y: 46},
        {x: 15, y: 29},
        {x:  1, y: 18},
        {x: 19, y: 18}
      ];
    }
  },
  path: {
    "type": "path",
    "path":  "m581.077942,2.537359c-2.053223,0.047071 -4.04071,0.188348 -6.108093,0.352907c-33.05542,2.663918 -62.235901,19.640541 -77.057678,44.925953l-7.8573,19.135319c1.698822,-6.633144 4.302979,-13.065384 7.8573,-19.135319c-26.430695,-22.16293 -63.531677,-32.388445 -100.192383,-27.574373c-36.661469,4.788353 -68.503082,24.041758 -85.901978,51.935225c-49.116486,-24.490013 -110.34288,-22.999454 -157.711807,3.860092c-47.369164,26.86068 -72.61673,74.40551 -64.941162,122.38308l5.021355,19.49968c-2.263329,-6.38501 -3.960793,-12.887695 -5.021355,-19.49968l-0.761948,1.798569c-41.179165,3.625244 -74.945375,29.465134 -83.716398,64.059235c-8.771805,34.597748 9.46701,70.085876 45.185621,87.96701l55.776558,10.973114c-19.480217,1.291962 -38.915543,-2.534515 -55.776558,-10.973114c-27.5478,24.96817 -33.888516,61.935303 -15.71492,92.467834c18.173733,30.524719 56.988899,48.110687 97.030457,44.11734l24.339722,-5.21109c-7.827499,2.651611 -15.960983,4.379059 -24.339722,5.21109c22.730042,33.857269 60.428192,58.556244 104.66893,68.383514c44.2491,9.81366 91.240952,4.014771 130.425949,-16.094604c31.96701,40.793823 88.707642,62.217468 145.596313,54.99707c56.902466,-7.219666 103.833984,-41.81427 120.501343,-88.770996l5.781433,-26.239532c-0.863708,8.909546 -2.742249,17.681366 -5.781433,26.239532c39.133301,20.753662 88.353333,21.927307 128.785095,3.049316c40.439819,-18.874084 65.665771,-54.869049 66.036133,-94.078247l-14.495605,-58.580597l-57.105713,-39.630768c44.163452,22.374573 71.992615,56.467255 71.601318,98.211365c52.49707,0.448181 97.103394,-35.956573 117.112427,-77.726288c20.011597,-41.769836 12.443604,-89.396759 -19.864929,-125.164642c13.401184,-26.637695 12.609985,-56.937332 -2.183472,-83.034088c-14.786194,-26.097893 -42.065491,-45.476891 -74.873047,-53.098335c-7.341431,-34.580929 -37.602661,-62.404482 -77.600708,-71.526293c-39.998474,-9.121368 -82.584839,2.123992 -109.364807,28.926123l-16.258179,22.19817c4.157959,-8.018612 9.583923,-15.495213 16.258179,-22.19817c-18.876953,-21.060713 -48.486023,-32.954061 -79.348938,-32.155401l0,0z",
    "width": function(w,h){return w - 4 },
    "height": function(w,h){return h - 4}
  },
  ellipse: {
    "type": "ellipse",
    "rx": function(w,h){return w /2 - 4},
    "ry": function(w,h){return h/ 2 - 4}
  },
  circle: {
    type: "circle",
    radius: function(w,h){ return Math.min(w,h)/2 - 4}
  }
};

fabric.getObjectsList = function(w,h){
  var _lib = [];
  for(var i in this.objectsLibrary){
    var o = _lib[i] = fabric.util.object.cloneDeep(this.objectsLibrary[i]);
    o.title = o.title || o.type;
    if(o.width === 0 ) o.width = w;
    if(o.height === 0 ) o.height = h;
    for(var j in o){
      if(o[j].constructor == Function){
        o[j] = o[j].call(o,w,h);
      }
    }
  }
  return _lib;
};

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 40 */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.util.object.extend(fabric.Application.prototype, {
  // loaderTemplate: "<span class='fa fa-pulse fa-spinner canvas-load-spinner'></span>",
  loaderIcon:   'data:image/svg+xml;base64,' + __webpack_require__(60),
  loaderContainer: null,
  _showMainLoaderIndicator: function () {
    this.loaderEl.show();
    this.loaderContainer.addClass("processing");
  },
  _hideMainLoaderIndicator: function () {
    this.loaderEl.hide();
    this.loaderContainer.removeClass("processing");
  },
  setLoaderTemplate: function (val) {
    if(this.virtual) return false;
    this.loaderTemplate = val.replace("{loaderIcon}",this.loaderIcon);
    if(val) {
      this.loaderContainer = $(this.loaderContainer);
      this.loaderEl = $(this.loaderTemplate).hide();
      this.loaderContainer.append(this.loaderEl);
      // this.on("loading:begin", this._showMainLoaderIndicator);
      // this.on("loading:end", this._hideMainLoaderIndicator);


      this.on("project:changed",function(){
        this.project.on("slide:change:begin", this._showMainLoaderIndicator.bind(this));
        this.project.on("slide:changed", this._hideMainLoaderIndicator.bind(this));
      })

    }
  }
});


// fabric.util.object.extend(fabric.SlideCanvas.prototype, {
//   // loaderTemplate: "<span class='fa fa-pulse fa-spinner canvas-load-spinner'></span>",
//   setLoaderTemplate: function (val) {
//     if(this.virtual) return false;
//     this.loaderTemplate = val;
//     if(val) {
//       this.loaderEl = $(this.loaderTemplate).hide();
//       $(this.wrapperEl).append(this.loaderEl);
//       this.on("loading:begin", function () {
//         this.loaderEl.show();
//         $(this.wrapperEl).addClass("processing");
//       });
//       this.on("loading:end", function () {
//         this.loaderEl.hide();
//         $(this.wrapperEl).removeClass("processing");
//       });
//     }
//   }
// });

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 41 */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(fabric) {__webpack_require__(71);
__webpack_require__(72);

// todo это убрать
//fabric.movementsLimitsEasy = false;
var _toObject_overwritten = fabric.Object.prototype.toObject;
//todo use event "before:object";

fabric.Object.prototype.toObject = function (propertiesToInclude) {
  var obj = _toObject_overwritten.call(this,propertiesToInclude);
  var _storeAll = this.storeProperties.indexOf("*") != -1;
  if (this.clipTo && this.clipTo.id && (_storeAll || this.storeProperties.indexOf("clipTo") != -1)) {
    obj.clipTo = '#' + this.clipTo.id
  }
  if ( this.movementLimits &&  (_storeAll || this.storeProperties.indexOf("movementLimits") != -1)) {
    obj.movementLimits = this.movementLimits.id ? '#' + this.movementLimits.id : this.movementLimits;
  }
  return obj;
};

var _scaleObject_overwritten = fabric.Canvas.prototype._scaleObject;


fabric.util.object.extend(fabric.Object.prototype, {
  setWholeCoordinates: function(val){
    this.wholeCoordinates = val;
    this.on("added modified",function(){
      if(this.wholeCoordinates){
        this.set({
          left: Math.round(this.left),
          top: Math.round(this.top),
          width: Math.round(this.width),
          height: Math.round(this.height)
        })
      }
    },true)
  },
  // setTop: function(val){
  //   if(this.wholeCoordinates){
  //     val = Math.round(val);
  //   }
  //   this.top = val;
  // },
  // setLeft: function(val){
  //   if(this.wholeCoordinates){
  //     val = Math.round(val);
  //   }
  //   this.left = val;
  // },
  // setWidth: function(w){
  //   if(this.wholeCoordinates){
  //     w = Math.round(w);
  //   }
  //   this.width = w;
  // },
  // setHeight: function(h){
  //   if(this.wholeCoordinates){
  //     h = Math.round(h);
  //   }
  //   this.height = h;
  // },
  // specialProperties: fabric.Object.prototype.specialProperties.concat(["movementLimits"]),

  setActive: function(value){
    if(!this.canvas){
      this.on("added",function(){
        this.canvas.setActiveObject(this);
      })
    }

    this.active = value;

  },
  setPosition: function(_position){
    if(_position === "center") {
      this.on("added",function(){
        this.canvas.fitObject(this);
      })
    }
  },

  setMovementLimits: function (val) {


    if(!this.movementLimits){
      this.on({
        added: function(){
          if( this.canvas.interactive){
            this.canvas._check_object_position(this);
          }
        },
        rotated: function (event) {
          var target = this;

          if (target.resizable) {
            if (pos.left !== undefined) {
              if (target.left < pos.left) {
                target.width += target.left - pos.left;
                target.left = pos.left;
              } else {
                target.width -= target.left - pos.left;
              }
            }
            if (pos.top !== undefined) {
              if (target.top < pos.top) {
                target.height += target.top - pos.top;
                target.top = pos.top;
              } else {
                target.height -= target.top - pos.top;
              }
            }
          }
          this.canvas._check_object_position(this)
        },
        modified: function (event) {
          this.canvas._check_object_after_modified(this)
        }
      });
    }
    this.movementLimits = val;

   /* if(this.canvas){
      this._setMovementLimitsString();
    }*/

  }
});


fabric.util.object.extend(fabric.StaticCanvas.prototype, {
  fitObject: function (el) {
    var _rect, maxSize, o = this.offsets;

    if(!el.movementLimits || el.movementLimits == "canvas"){
      var _zoom = this.getZoom();
      var _w = this.originalWidth || this.width / _zoom;
      var _h = this.originalHeight || this.height / _zoom;
      _rect = {
        width: o ? (_w - o.left - o.right) : _w,
        height: o ?(_h - o.top - o.bottom) : _h
      };
      /* offsets = {
       left: o && o.top ||0 ,
       top:  o &&  o.left ||0
       }*/
    }else if(el.movementLimits.constructor !== Function){
      var lim = el.movementLimits;
      _rect = {
        left:   lim.left * lim.scaleX,
        width:  lim.width * lim.scaleX ,
        top:    lim.top * lim.scaleY,
        height: lim.height * lim.scaleY
      };
      //maxSize = _rect;
      // offsets = lim;
    }
    maxSize = {
      width: _rect.width * this.fitIndex,
      height: _rect.height * this.fitIndex
    };
    var size = fabric.util.getProportions(el, maxSize, 'fit');

    if(el.resizable){
      el.setOptions({
        width: el.width * size.scale,
        height: el.height * size.scale
      });
      el.updateElement();
    }else{
      el.setOptions({
        scaleX: size.scale,
        scaleY: size.scale
      });
    }
    this.centerObject(el);
    el.setCoords();
  },
  //fix getcenter function
  centerObject: function (object) {
    var center;
    if (object.movementLimits) {

      center = this._getMovementsLimitsCenter(object.movementLimits);
    } else {
      center = this.getCenter();
    }
    this._centerObject(object, new fabric.Point(center.left, center.top));
    this.renderAll();
    return this;
  },
  getCenter: function () {
    return {
      top: this.originalHeight / 2 / this.getZoom(),
      left: this.originalWidth / 2 / this.getZoom()
    };
  },

  movementLimits: {
    left: false,
    top: false,
    right: false,
    bottom: false
  },
  setMovementLimits: function (_offsets) {
    this.movementLimits = _offsets;

    return this;
  },
  //content хотя бы  пиксель объекта должен быть внутри зоны
  //fit зона должно полностью находится внутри объекта
  movementLimitMode: "fit",
  _getMovementsLimitsCenter: function(movementLimits){

    var o = this.offsets;
    if (movementLimits === 'canvas') {
      var _w = this.originalWidth || this.width;
      var _h = this.originalHeight || this.height;
      return {top: o.top + (_h - o.top - o.bottom) /2  , left:  o.left + (_w - o.left - o.right) /2};
    }else{
      var obj = this.getObjectByID(movementLimits);
      var _xy = obj.getCenterPoint();
      return {top: _xy.y, left: _xy.x};
    }
  },
  _getMovementsLimitsRect: function(movementLimits){

    var o = this.offsets;
    var _w = this.originalWidth || this.width;
    var _h = this.originalHeight || this.height;

    if(movementLimits.constructor !== String){
      return movementLimits;
    }

    var scale = this.viewportTransform[0];

    if (movementLimits === 'canvas') {

      var rect = {
        left: o.left,
        top: o.top,
        width: _w - o.left - o.right,
        height: _h - o.top - o.bottom,
        right: o.right,
        bottom: o.bottom
      }

      rect.width *= scale;
      rect.height *= scale;
      return rect;
    }else{
      var obj = this.getObjectByID(movementLimits);
      var _stroke_width = obj.strokeWidth;
      obj.strokeWidth = 0;

      obj.setCoords();
      var rect = obj.getBoundingRect();

      obj.strokeWidth = _stroke_width;


      rect.left /= scale;
      rect.top /= scale;
      rect.width /= scale;
      rect.height /= scale;
      rect.left -= this.viewportTransform[4] / scale;
      rect.top -= this.viewportTransform[5] / scale;

      //rect.left   += sw /2;
      //rect.top    += sw /2;
      //rect.width  -= sw;
      //rect.height -= sw;

      rect.right = _w - (rect.left + rect.width);
      rect.bottom = _h - (rect.top + rect.height);

      return rect;
    }
  },
  contentOffsets : 5,
  getFixedPosition: function (target, x, y) {

    var _w = this.originalWidth || this.width;
    var _h = this.originalHeight || this.height;


    if (x === undefined) {
      x = target.left;
    }
    if (y === undefined) {
      y = target.top;
    }
    var scale = this.viewportTransform[0];
    target.setCoords();
    var bounds = target.getBoundingRect();
    bounds.left /= scale;
    bounds.top /= scale;
    bounds.width /= scale;
    bounds.height /= scale;

    bounds.left -= this.viewportTransform[4] / scale;
    bounds.top -= this.viewportTransform[5] / scale;
    bounds.right = _w - (bounds.left + bounds.width);
    bounds.bottom = _h - (bounds.top + bounds.height);


    var limits = this._getMovementsLimitsRect(target.movementLimits || this.movementLimits);
    // var limits = rect || this.movementLimits;

    var newPos = {};
    var _l = limits.left, _r = limits.right;
    var _t = limits.top, _b = limits.bottom;

    if (target.movementLimitMode === "content") {
      _l -= bounds.width - this.contentOffsets
      _r -= bounds.width - this.contentOffsets
      _t -= bounds.height - this.contentOffsets
      _b -= bounds.height - this.contentOffsets
    }

    if (target.movementLimitMode === "fit" && !target.resizable) {
      if (_l !== false && _r !== false) {
        var _w = _w - _l - _r;
        if (bounds.width > _w) {
          var _asp = _w / bounds.width;
          newPos.scaleX = _asp;
          newPos.scaleY = _asp;
        }
      }

      if (_t !== false && _b !== false) {
        var _h = _h - _t - _b;
        if (bounds.height > _h) {
          var _asp = _h / bounds.height;
          target.scaleX *= _asp;
          target.scaleY *= _asp;
        }
      }
    }

    if (target.movementLimitMode === "fit" || target.movementLimitMode === "content") {

      if (_l !== false) {
        var _diff = _l - bounds.left;
        if (_diff > 0) {
          newPos.left = x + _diff;
        }
      }

      if (!newPos.left && _r !== false) {
        var _diff = _r - bounds.right;
        if (_diff > 0) {
          newPos.left = x - _diff;
        }
      }

      if (_t !== false) {
        var _diff = _t - bounds.top;
        if (_diff > 0) {
          newPos.top = y + _diff;
        }
      }

      if (!newPos.top && _b !== false) {
        var _diff = _b - bounds.bottom;
        if (_diff > 0) {
          newPos.top = y - _diff;
        }
      }

    }

    return newPos;
  },


  // _restoreOriginXYNative: _restoreOriginXYNative,
  // _restoreOriginXY: function (target) {
  //   this._restoreOriginXYNative(target);
  //
  //   // if (target.wholeCoordinates) {
  //   //   target.left = Math.round(target.left);
  //   //   target.top = Math.round(target.top);
  //   // }
  // },

  /**
   * Sets the position of the object taking into consideration the object's origin
   * @param {fabric.Point} pos The new position of the object
   * @param {String} originX Horizontal origin: 'left', 'center' or 'right'
   * @param {String} originY Vertical origin: 'top', 'center' or 'bottom'
   * @return {void}
   */
  setPositionByOrigin: function (pos, originX, originY) {
    var center = this.translateToCenterPoint(pos, originX, originY),
      position = this.translateToOriginPoint(center, this.originX, this.originY);

    // if (this.wholeCoordinates) {
    //   position.x = Math.round(position.x);
    //   position.y = Math.round(position.y);
    // }
    this.set('left', position.x);
    this.set('top', position.y);
  }
});

var _translateObject_overwritten = fabric.Canvas.prototype._translateObject;
var _beforeScaleTransform_overwritten = fabric.Canvas.prototype._beforeScaleTransform;
var _beforeTransform_overwritten = fabric.Canvas.prototype._beforeTransform;
var _restoreOriginXYNative = fabric.Canvas.prototype._restoreOriginXY;
fabric.util.object.extend(fabric.SlideCanvas.prototype, {
  _beforeScaleTransform_overwritten: _beforeScaleTransform_overwritten,
  _beforeScaleTransform: function (e, transform) {
    this._beforeScaleTransform_overwritten(e, transform);
    if (!this._currentTransform.original.oCoords) {
      this._currentTransform.original.oCoords = fabric.util.object.cloneDeep(this._currentTransform.target.oCoords);
    }
  },
  getFixedPositionEasy: function (target, x, y) {
    var _w = this.originalWidth || this.width;
    var _h = this.originalHeight || this.height;

    if (x === undefined) {
      x = target.left;
    }
    if (y === undefined) {
      y = target.top;
    }
    var scale = this.viewportTransform[0];
    target.setCoords();
    target.right = _w - (target.left + target.width);
    target.bottom = _h - (target.top + target.height);

    var _diff, _asp, rect;
    var newPos = {
      left: x,
      top: y,
      width: target.width,
      height: target.height
    };

    if (target.width > _w) {
      newPos.width = _w;
    }
    if (target.height > _h) {
      newPos.height = _h;
    }
    if (target.left < 0) {
      newPos.width += target.left;
      newPos.left -= target.left;
    }
    if (target.right < 0) {
      newPos.width += target.right;
    }
    if (target.top < 0) {
      newPos.height += target.top;
    }
    if (target.bottom < 0) {
      newPos.height += target.bottom;
    }
    return newPos;
  },
  /**
   * функцию можно вызвать с евентом  'after:render'. Позволяет отображать вычисления пересечений изменяемого объекта с рамкой. выделяет красными лиинияи
   * @private
   * @example
   *  eventListeners : {
    Canvas: {
      'before:render': function(){
        this.clearContext(this.contextTop);
      },
      'after:render': function(){
        this._debug_intersections()
      }
    }
  }
   */
  drawInterestionLines: function(){
    var tr = this._currentTransform;
    if (tr && tr._intersections) {
      var ctx = this.contextTop;
      ctx.beginPath();
      ctx.strokeStyle = "red";
      for(var i in tr._intersections){
        var _coord = tr._intersections[i];
        ctx.moveTo(_coord.x + 5, _coord.y);
        ctx.arc(_coord.x, _coord.y, 5, 0, 2 * Math.PI);
      }
      for(var i in tr.lines){
        var _l = tr.lines[i];
        ctx.moveTo(_l[0].x,_l[0].y);
        ctx.lineTo(_l[1].x,_l[1].y);
      }
      for(var i in tr.mlLines){
        var _l = tr.mlLines[i];
        ctx.moveTo(_l[0].x,_l[0].y);
        ctx.lineTo(_l[1].x,_l[1].y);
      }
      ctx.stroke();
    }
  },
  _scaleObjectEasy: function (x, y, by) {
    //_scaleObject_overwritten.call(this, x, y, by);
    var tr = this._currentTransform,
      target = tr.target,
      corner = tr.corner;
    if(!target.movementLimits){
      return _scaleObject_overwritten.call(this, x,y, by);
    }


    if (target.movementLimitMode !== 'fit')return;
    x = Math.min(target.movementLimits.width, Math.max(0,x));
    y = Math.min(target.movementLimits.height, Math.max(0,y));
    _scaleObject_overwritten.call(this, x,y, by);
  },
  /**
   * Scales object by invoking its scaleX/scaleY methods
   * @private
   * @param {Number} x pointer's x coordinate
   * @param {Number} y pointer's y coordinate
   * @param {String} by Either 'x' or 'y' - specifies dimension constraint by which to scale an object.
   *                    When not provided, an object is scaled by both dimensions equally
   */
  _scaleObject: function (x, y, by) {
    var _scaled = _scaleObject_overwritten.call(this, x, y, by);

    var tr = this._currentTransform,
      target = tr.target,
      corner = tr.corner;
    var _v = this.viewportTransform;

    if (!target.movementLimits || target.movementLimitMode !== "fit"){
      return _scaled;
    }
    target.setCoords();

    var _scale = this.getZoom();

    if(target.movementLimits == this){
      var _w = this.originalWidth || this.width;
      var _h = this.originalHeight || this.height;
      var _l = this.viewportTransform[4] ;
      var _t = this.viewportTransform[5] ;
      _w *= _scale;
      _h *= _scale;
      var _rc = {
        tl: {x: _l, y: _t},
        tr: {x: _l + _w, y: _t},
        bl: {x: _l, y: _t + _h},
        br: {x: _l + _w, y: _t + _h}
      }
    }else{
      target.movementLimits.setCoords();
      var _rc = target.movementLimits.oCoords;
    }


    if (!tr.pointerOffset) {
      tr.pointerOffset = {
        x: x * _v[0] - target.oCoords[corner].x,
        y: y * _v[3] - target.oCoords[corner].y
      }

      tr.pointCenter = target.getCenterPoint();
      tr.pointCenter.x *= _scale;
      tr.pointCenter.y *= _scale;
      tr.pointOriginal = tr.original.oCoords[corner];
    }

    tr.pointTranformed = target.oCoords[corner];

    tr.mlLines = [];
    tr.lines = [];
    function _intersection(corner, coordinate) {
      var _oc;
      if (coordinate == "x" && corner[0] != "m") {
        _oc = tr.original.oCoords["m" + corner[0]];
      } else if (coordinate == "y" && corner[0] != "m") {
        _oc = tr.original.oCoords["m" + corner[1]];
      } else {
        _oc = tr.pointCenter;
        _oc = {
          x: _oc.x + _v[4],
          y: _oc.y + _v[5]
        };
      }
      var _tc = target.oCoords[corner];

      tr.lines.push([_oc, _tc]);
      tr.mlLines.push([_rc.tl, _rc.tr]);
      tr.mlLines.push([_rc.tr, _rc.br]);
      tr.mlLines.push([_rc.br, _rc.bl]);
      tr.mlLines.push([_rc.bl, _rc.tl]);

      var inters = fabric.Intersection.intersectLinePolygon(_oc, _tc, [_rc.tl, _rc.tr, _rc.br, _rc.bl]);
      if (!inters.points.length) {
        return;
      }
      inters.points[0].coordinate = coordinate;
      tr._intersections.push(inters.points[0])

//         if (coordinate) {
//           var p1 = inters.points[0];

//           var corner2;
//           if (coordinate == "x") {
//             corner2 = (corner[0] == "t" ? "b" : "t") + corner[1];
//           } else {
//             corner2 = corner[0] + (corner[1] == "l" ? "r" : "l");
//           }
//           var _p2 = target.oCoords[corner2];
//           var _diff = {x: _tc.x - p1.x, y: _tc.y - p1.y};

//           var p2 = {
//             x: _p2.x - _diff.x,
//             y: _p2.y - _diff.y
//           };

//           var its = fabric.Intersection.intersectLineLine(tr.pointCenter, tr.pointTranformed, p1, p2);
//           if (!its.points[0]) {
//             return;
//           }
//           tr._intersections.push(its.points[0]);
//         } else {
//           tr._intersections.push(inters.points[0]);
//         }


      //
      //if(inters.points.length){
      //  _scaleObject_overwritten.call(this, inters.points[0].x,  inters.points[0].y, by);
      //  target.setCoords();
      //}else{
      //  _scaleObject_overwritten.call(this, x, y, by);
      //}
    }


    tr._intersection = null;
    tr._intersections = [];
    switch (corner) {
      case "tl":
        _intersection("tl");
        _intersection("bl", "x");
        _intersection("tr", "y");
        break;
      case "tr":
        _intersection("tr");
        _intersection("tl", "y");
        _intersection("br", "x");
        break;
      case "br":
        _intersection("br");
        _intersection("tr", "x");
        _intersection("bl", "y");
        break;
      case "bl":
        _intersection("bl");
        _intersection("tl", "x");
        _intersection("br", "y");
        break;
      case "mt":
        _intersection("mt");
        _intersection("tl", "y");
        _intersection("tr", "y");
        break;
      case "mb":
        _intersection("mb");
        _intersection("bl", "y");
        _intersection("br", "y");
        break;
      case "mr":
        _intersection("mr");
        _intersection("tr", "x");
        _intersection("br", "x");
        break;
      case "ml":
        _intersection("ml");
        _intersection("tl", "x");
        _intersection("bl", "x");
    }

    if (!tr._intersections.length) {
      return _scaled;
    }


    var _newXY = tr._intersections[0];
    var _l = tr._intersections[0].distanceFrom(tr.pointOriginal);

    for (var i = 1; i < tr._intersections.length; i++) {
      var _l2 = tr._intersections[i].distanceFrom(tr.pointOriginal);
      if (_l2 < _l) {
        _newXY = tr._intersections[i];
        _l = _l2;
      }
    }
    tr._intersection = _newXY;


    if (by == "equally") {
      //by = false;

      var _diff2 = {x: _newXY.x - tr.pointCenter.x, y: _newXY.y - tr.pointCenter.y};
      var _l = Math.sqrt(_diff2.x * _diff2.x + _diff2.y * _diff2.y);

      _newXY.x -= _diff2.x / _l * target.strokeWidth;
      _newXY.y -= _diff2.y / _l * target.strokeWidth;
      // scrt(x*x + y*y) = atrokewidth
      var a = 1;
    }
    //return _scaleObject_overwritten.call(this, x, y, by);
    var __x = (_newXY.x + tr.pointerOffset.x ) / _v[0];
    var __y = (_newXY.y + tr.pointerOffset.y ) / _v[3];
    return _scaleObject_overwritten.call(this, __x, __y, by);

    //
    //if (corner == "br" || corner == "tr" || corner == "mr") {
    //  if (x < target.movementXMaxLimit) {
    //    x = target.movementXMaxLimit;
    //  }
    //}
    //if (corner == "bl" || corner == "tl" || corner == "ml") {
    //  if (x > target.movementXMinLimit) {
    //    x = target.movementXMinLimit;
    //  }
    //}
    //if (corner == "bl" || corner == "br" || corner == "mb") {
    //  if (y < target.movementYMaxLimit) {
    //    y = target.movementYMaxLimit;
    //  }
    //}
    //if (corner == "tl" || corner == "tr" || corner == "mt") {
    //  if (y > target.movementYMinLimit) {
    //    y = target.movementYMinLimit;
    //  }
    //}
    //
    //_scaleObject_overwritten.call(this, x, y, by);
  },
  movementLimitsOnAddAction: 'translate',
  _check_object_after_modified: function (target) {
    if (!this._currentTransform) {
      return;
    }
    var pos = this.getFixedPosition(target, target.left, target.top);

    switch (this._currentTransform.corner) {
      case "mtr":
        if (pos.left !== undefined) {
          target.set('left', pos.left);
        }
        if (pos.top) {
          target.set('top', pos.top);
        }
        break;
      case "mr":
      case "br":
        if (pos.left !== undefined) {
          var _ldiff = target.left - pos.left;

        }
        if (pos.top !== undefined) {
          var _tdiff = target.top - pos.top;
        }

        if (_ldiff && (!_tdiff || Math.abs(_ldiff) > Math.abs(_tdiff))) {
          if (_ldiff < 0) {
            target.width += _ldiff;
          } else {
            target.width -= _ldiff;
          }
        } else if (_tdiff) {
          if (_tdiff < 0) {
            target.width += _tdiff;
          } else {
            target.width -= _tdiff;
          }
        }
      //console.log(pos,_ldiff,_tdiff)
    }
    // this._check_object_position(target)
  },
  _check_object_position: function (target) {

    var pos = this.getFixedPosition(target, target.left, target.top);
    if (this.movementLimitsOnAddAction == 'translate') {
      if (pos.left !== undefined) {
        target.set('left', pos.left);
      }
      if (pos.top !== undefined) {
        target.set('top', pos.top);
      }
    }else{

      if (pos.left !== undefined) {
        if (target.left < pos.left) {
          target.width += target.left - pos.left;
          target.left = pos.left;
        } else {
          target.width -= target.left - pos.left;
        }
      }
      if (pos.top !== undefined) {
        if (target.top < pos.top) {
          target.height += target.top - pos.top;
          target.top = pos.top;
        } else {
          target.height -= target.top - pos.top;
        }
      }
    }


    if (pos.scaleX) {
      target.scaleX = target.scaleX *= pos.scaleX;
    }
    if (pos.scaleY) {
      target.scaleY = target.scaleY *= pos.scaleY;
    }

    target.setCoords();

    this.renderAll();
    // if(target.wholeCoordinates){
    //   target.top = Math.round(target.top);
    //   target.left = Math.round(target.left);
    //   target.height = Math.round(target.height);
    //   target.width = Math.round(target.width);
    // }
  },
  _translateObject: function (x, y, limits) {
    var target = this._currentTransform.target;
    if(target.beforeTranslate){
      var _point = target.beforeTranslate(x, y);
      if(!_point)return false;
      x = _point.x;
      y = _point.y;
    }
    var _translated = _translateObject_overwritten.call(this, x, y, limits);

    if(this.movementLimits){

      var pos = this.getFixedPosition(target, x, y);

      if (pos.scaleX) {
        target.scaleX = this._currentTransform.scaleX *= pos.scaleX;
      }
      if (pos.scaleY) {
        target.scaleY = this._currentTransform.scaleY *= pos.scaleY;
      }

      if (pos.top !== undefined || pos.left !== undefined) {
        _translated = _translateObject_overwritten.call(this,
          pos.left !== undefined ? pos.left : x,
          pos.top !== undefined ? pos.top : y);
      }
    }
    return _translated || pos.scaleX || pos.scaleY;



    /* if (!target.get('lockMovementX')) {
     var _val = x - this._currentTransform.offsetX;

     //left offset
     var lim = this.movementLimits.minX.constructor == Number ? this.movementLimits.minX : -bounds.width + 1;
     if(target.movementXMinLimit && target.movementXMinLimit.constructor == Number && target.movementXMinLimit > lim ){
     lim = target.movementXMinLimit ;
     }

     _val = Math.min(lim, _val);

     //right offset
     var lim = this.movementLimits.maxX.constructor == Number ? this.movementLimits.maxX : this.width + bounds.width - 1;
     if(target.movementXMaxLimit && target.movementXMaxLimit.constructor == Number && target.movementXMaxLimit > lim ){
     lim = target.movementXMaxLimit ;
     }
     _val = Math.max(lim  - target.width * target.scaleX, _val);
     target.set('left', _val);
     }
     if (!target.get('lockMovementY')) {
     var _val = y - this._currentTransform.offsetY;
     if(target.movementYMinLimit !== undefined)
     _val = Math.min(target.movementYMinLimit, _val);
     if(target.movementYMaxLimit !== undefined)
     _val = Math.max(target.movementYMaxLimit  - target.height, _val);

     target.set('top', _val);
     }
     */
    //movementLimits ={
    //    xmin: 0,
    //    xmax: 0,
    //    ymin: 0,
    //    ymax: 0
    //};

  },

  _beforeTransform: function (e, target) {
    target && target._beforeTransform ?
      target._beforeTransform(e) :
      _beforeTransform_overwritten.call(this, e, target);
  },
  _beforeTransformNative: _beforeTransform_overwritten,
  /**
   * Translates object by "setting" its left/top
   * @private
   * @param {Number} x pointer's x coordinate
   * @param {Number} y pointer's y coordinate
   * @return {Boolean} true if the translation occurred
   */
  _translateObject: function (x, y) {
    var transform = this._currentTransform,
      target = transform.target,
      newLeft = x - transform.offsetX,
      newTop = y - transform.offsetY,
      moveX = !target.get('lockMovementX') && target.left !== newLeft,
      moveY = !target.get('lockMovementY') && target.top !== newTop;


    //round coordinates
    // if (target.wholeCoordinates) {
    //   newLeft = Math.round(newLeft);
    //   newTop = Math.round(newTop);
    // }

    moveX && target.set('left', newLeft);
    moveY && target.set('top', newTop);
    return moveX || moveY;
  }
});

//fabric.SlideCanvas.addPlugin("loaders",function(){
//    this.initMovementLimits();
//});

//todo
fabric.Rect.prototype.stateProperties   = fabric.Rect.prototype.stateProperties.concat(["movementLimits","clipTo"]);
fabric.Object.prototype.stateProperties = fabric.Object.prototype.stateProperties.concat(["movementLimits","clipTo"]);
fabric.IText.prototype.stateProperties  = fabric.IText.prototype.stateProperties.concat(["movementLimits","clipTo"]);
fabric.Image.prototype.stateProperties  = fabric.Image.prototype.stateProperties.concat(["movementLimits","clipTo"]);



/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 42 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {


var _set_sbackground_image_overwritten = fabric.Canvas.prototype.setBackgroundImage;

fabric.util.object.extend(fabric.Canvas.prototype, {
  /**
   * backgroundPosition
   * @values manual | cover | fit
   */
  backgroundPosition: 'manual',
  setBackgroundPosition: function (src) {
    this.backgroundPosition = src;
    this._update_background_image();
    return this;
  },
  offsets: {
    left: 0,
    right: 0,
    bottom: 0,
    top: 0
  },

  // setBackgroundImage: function (src, callback, options) {
  //
  //   _set_sbackground_image_overwritten.call(this, src, function () {
  //     this._update_background_image();
  //     callback && callback(this.backgroundImage);
  //   }.bind(this), options);
  //   return this;
  // },
  fillBackgroundColorOverCanvas: false,
  _renderBackgroundOrOverlay: function(ctx, property) {
    var object = this[property + 'Color'];
    if (object) {
      ctx.fillStyle = object.toLive
        ? object.toLive(ctx)
        : object;

      if(!this.fillBackgroundColorOverCanvas){
        ctx.fillRect(
          object.offsetX || this.viewportTransform[4]/ this.viewportTransform[0],
          object.offsetY || this.viewportTransform[5]/ this.viewportTransform[0],
          this.width * this.viewportTransform[0],
          this.height  * this.viewportTransform[0]);
      }else{
        ctx.fillRect(

          object.offsetX || 0,
          object.offsetY || 0,
          this.originalWidth ,
          this.originalHeight);
      }
    }
    object = this[property + 'Image'];
    if(object && object.constructor !== String &&  object.constructor !== Object){
        object.render(ctx);
    }
  },
  getImageData: function (options) {
    options = fabric.util.object.extend({
      clipped_area: false,
      clipped_area_only: false,
      draw_background: true,
      format: 'png',
      quality: 0.8
    }, options || {});

    var size;
    if (options.clipped_area) {
      size = options.clipped_area.getBoundingRect();
      var _zoom = this.getZoom();
      size.left   /= _zoom;
      size.top    /= _zoom;
      size.width  /= _zoom;
      size.height /= _zoom;
      fabric.util.object.extend(options, size);
    } else {
      size = {
        width: options.width || this.originalWidth || this.width,
        height: options.height || this.originalHeight || this.height,
      };

      if (options.clipped_area_only) {
        size.width -= this.offsets.left + this.offsets.right;
        size.height -= this.offsets.top + this.offsets.bottom;
      }
    }
    if (options.zoom) {
      size.width *= options.zoom;
      size.height *= options.zoom;
    }

    var canvas = fabric.util.createCanvasElement();
    canvas.width = size.width;
    canvas.height = size.height;

    options.left = Math.floor(options.left);
    options.top = Math.floor(options.top);
    options.height = Math.ceil(options.height);
    options.width = Math.ceil(options.width);

    this.renderThumb(canvas, options);

    var src = canvas.toDataURL(options);

    var blob = fabric.util.dataURItoBlob(src, 'image/' + options.format);
    var objectURL = URL.createObjectURL(blob);
    return {
      dataURL: src,
      blob: blob,
      url: objectURL,
      canvas: canvas
    };
  },
  getOriginalSize: function () {
    return {
      width: this.originalWidth,
      height: this.originalHeight
    }
  },

  renderThumb: function (canvas, options) {

    options = options || {
        objects: true,
        clipped_area_only: false,
        draw_background: true
      };

    if (options.zoom) {
      var _zoom = options.zoom;
    } else {
      if (canvas.width) {
        var _zoom = canvas.width / (this.originalWidth || this.width)
      } else {
        var _zoom = 1;
      }
    }
    var _old_Scale = this.viewportTransform[0];
    var old_x = this.viewportTransform[4];
    var old_y = this.viewportTransform[5];
    this.viewportTransform[4] = this.viewportTransform[5] = 0;
    this.viewportTransform[0] = this.viewportTransform[3] = 1;

    this.viewportTransform[0] = this.viewportTransform[3] = _zoom;
    //this._update_clip_rect();

    if (this.clipRect) {
      this.clipRect.setOpacity(0);
    }

    var size = {
      width: this.originalWidth || this.width,
      height: this.originalHeight || this.height
    };
    size.width = Math.ceil(size.width * _zoom);
    size.height = Math.ceil(size.height * _zoom);

    var _canvas = fabric.util.createCanvasElement();
    _canvas.width = size.width;
    _canvas.height = size.height;

    var canvasToDrawOn = _canvas.getContext('2d'), objsToRender;

    this.clearContext(canvasToDrawOn);
    canvasToDrawOn.save();
    canvasToDrawOn.transform.apply(canvasToDrawOn, this.viewportTransform);

    if (options.draw_background) {
      this._renderBackground(canvasToDrawOn);
      //if (this._backgroundLayer) {
      //  this._renderObjects(canvasToDrawOn, this._backgroundLayer);
      //}
    }

    if (!options.clipped_area_only && this.clipTo) {
      fabric.util.clipContext(this, canvasToDrawOn);
    }

    var _objects;
    if (options.objects && options.objects.constructor === Array) {
      _objects = options.objects;
    } else {
      _objects = options.objects !== false ? this._objects : [];
    }
    if (options.clipped_area) {
      _objects = fabric.util.object.clone(_objects);
      for (var i = _objects.length; i--;) {
        if (_objects[i].clipTo !== options.clipped_area) {
          _objects.splice(i, 1);
        }
      }
    }
    // if (fabric.version >= 1.6) {
      this._renderObjects(canvasToDrawOn, _objects);
    // } else {
    //   for (var i = 0, length = _objects.length; i < length; ++i) {
    //     this._draw(canvasToDrawOn, _objects[i]);
    //   }
    // }


    canvasToDrawOn.restore();
    if (!options.clipped_area_only && this.clipTo) {
      canvasToDrawOn.restore();
    }
    this._renderOverlay(canvasToDrawOn);
    canvasToDrawOn.restore();
    if (this.clipRect) {
      this.clipRect.setOpacity(1);
    }
    var ctx = canvas.getContext('2d');
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    if (options.clipped_area_only && this.clipRect) {
      var _rect = {
        left: this.clipRect.left * _zoom,
        top: this.clipRect.top * _zoom,
        width: this.clipRect.width * _zoom,
        height: this.clipRect.height * _zoom
      };
    } else {
      var _rect = {
        left: options.left * _zoom || 0,
        top: options.top * _zoom || 0,
        width: options.width * _zoom || size.width,
        height: options.height * _zoom || size.height
      };
    }
    if (options.angle) {
      ctx.rotate(-options.angle * Math.PI / 180);
      ctx.drawImage(_canvas,
        0, 0, _rect.width + _rect.left + _canvas.width, _rect.height + _rect.top + _canvas.height,
        -_rect.left, -_rect.top, canvas.width + _rect.left + _canvas.width, canvas.height + _rect.top + _canvas.height);
    } else {
      ctx.drawImage(_canvas, _rect.left, _rect.top, _rect.width, _rect.height, 0, 0, canvas.width, canvas.height);
    }

    this.viewportTransform[0] = this.viewportTransform[3] = _old_Scale;
    // this._update_background_image();
    //this._update_clip_rect();

    this.viewportTransform[4] = old_x;
    this.viewportTransform[5] = old_y;


    return canvas;
  },

  // setOffsets: function (_offsets) {
  //   this.offsets = _offsets || fabric.util.object.extend({}, fabric.SlideCanvas.prototype.offsets);
  //   //this._update_clip_rect();
  //   return this;
  // },
  getRect: function (options) {


    var rect = {};

    var _w = this.originalWidth || this.width; //this.originalWidth
    var _flexArray = fabric.util.flex(_w , [{value: options.left, flex: 0},{value: options.width, flex: 1},{value: options.right, flex: 0}] );
    rect.left = _flexArray[0];
    rect.width = _flexArray[1];
    rect.right = _flexArray[2];

    var _h = this.originalHeight|| this.height;   //this.originalHeight
    var _flexArray = fabric.util.flex(_h , [{value: options.top, flex: 0},{value: options.height, flex: 1},{value: options.bottom, flex: 0}] );
    rect.top = _flexArray[0];
    rect.height = _flexArray[1];
    rect.bottom = _flexArray[2];

    return rect;
  },
});

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 43 */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(fabric) {
if(typeof saveAs == "undefined"){
  fabric.saveAs  = __webpack_require__(65).saveAs;
}else{
  fabric.saveAs = saveAs;
}

fabric.util.object.extend(fabric.SlideCanvas.prototype, {
  insertRenderArea: false,
  insertRenderFull: false,
});


fabric.util.object.extend(fabric.SlideCanvas.prototype.actions, {
  renderArea: {
    className: 'fa fa-download',
    title: 'download',
    action: function () {
      fabric.saveAs(this.getImageData({
        clipped_area: this.activeArea,
        zoom: this.dotsPerUnit,
        clipped_area_only: true,
        draw_background: true
      }).blob, this.title);
    }
  },
  renderFull: {
    title: 'download with background',
    action: function () {
      fabric.saveAs(this.getImageData({
        zoom: this.dotsPerUnit,
        clipped_area_only: false,
        draw_background: true
      }).blob, this.title);
    }
  }
});

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 44 */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(fabric) {/*todo
fabric.SlideCanvas.addPlugin("initialize",function(){
  if(typeof this.freeDrawingBrush == "string" ){
    this.setFreeDrawingBrush(this.freeDrawingBrush);
  }
});*/

fabric.util.object.extend(fabric.SlideCanvas.prototype,{
  /**
   * ['PencilBrush','RectangleBrush']
   */
  activeDrawingTools: [],
  /**
   *
     {
      BrushClassName: {
        className: 'brush className',
        title: 'brush title'
      }
    }
   */
  drawingTools: {},
  insertDrawingTool: false,
  actions: fabric.util.object.extend(fabric.SlideCanvas.prototype.actions,{
    drawingTool: {
      title: 'drawing-tool',
      type: 'options',
      value: 'freeDrawingBrush',
      menu: function(){
        var _tools = {};
        for(var i in this.activeDrawingTools){
          var _tool = this.activeDrawingTools[i];
          _tools[_tool] = fabric.util.object.extend({option: _tool},this.drawingTools[_tool]);
        }
        return _tools;
      }
    }
  }),
  freeDrawingBrush: 'PencilBrush',
  drawingColor: [0,0,0,255],
  _onMouseDownInDrawingMode: function(e) {
    this._isCurrentlyDrawing = true;
    if(!this.freeDrawingBrush.target){
      this.discardActiveObject(e).renderAll();
    }
    if (this.clipTo) {
      fabric.util.clipContext(this, this.contextTop);
    }
    var pointer = this.getPointer(e);
    this.freeDrawingBrush.onMouseDown(pointer);
    this._handleEvent(e, 'down');
  },
  getFreeDrawingBrush: function() {
    if(!this.freeDrawingBrush){
      return "Selection";
    }
    return  fabric.util.string.capitalize(fabric.util.string.camelize(this.freeDrawingBrush.type),true);
  },
  setFreeDrawingBrush: function(brush) {

    if(brush == 'Selection'){
      this.isDrawingMode = false;
      this.freeDrawingBrush = "";
      return;
    }
    var className = fabric.util.string.capitalize(fabric.util.string.camelize(brush),true);
    if(this["__" + className]){
      this.freeDrawingBrush = this["__" + className] ;
    }else{
      this.freeDrawingBrush = this["__" + className] = new  fabric[className](this);
    }
    this.fire("brush:changed",{brush: this.freeDrawingBrush});
  },
  drawZoomedArea : function(ctx,left, top ,width, height , pointer ) {

    width = width || 90;
    height = height || 90;

    ctx.save();
    ctx.translate(left || 0, top || 0);

    ctx.fillStyle = 'black';
    ctx.strokeStyle = "#fff";
    ctx.strokeWidth = 1;
    ctx.setLineDash([2, 2]);
    ctx.drawImage(this.backgroundImage._element,Math.floor(pointer.x) - 4, Math.floor(pointer.y) - 4 , 9 , 9, 0,0 , width, width );
    ctx.strokeRect(0,0 , width, width);
    ctx.strokeRect(40 , 40 , 10, 10);
    ctx.restore();
  }
});

fabric.SlideCanvas.prototype.drawingTools.Selection = {
  className: 'fa fa-mouse-pointer',
  title: 'Selection'
};
fabric.SlideCanvas.prototype.activeDrawingTools.push("Selection");

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 45 */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(fabric) {fabric.util.createThumb = function(slide, $el){

  var _canvas = slide.canvas,
      firstDraw = true,
      modified,
      _w = +$el.getAttribute("width"),
      _h = +$el.getAttribute("height");

  if (_h) {
    $el.style.height = $el.height;
  }

  function renderThumb() {
    if (_canvas.processing || !_canvas.loaded) {
      return false;
    }
    _canvas.renderThumb($el);
    modified = _canvas.modified;
  }

  function forceRenderThumb() {
    if (this.canvas) {
      if (this.canvas.loaded) {
        this.canvas.renderThumb($el);
      }
      return;
    }
    if (firstDraw && this.data.thumb) {
      var img = new Image();
      img.onload = function () {
        var ctx = $el.getContext("2d");
        ctx.clearRect(0, 0, $el.width, $el.height);
        ctx.drawImage(img, 0, 0, $el.width, $el.height);
        modified = this.modified;
      };
      img.src = this.data.thumb;
      return;
    }

    if (attrs.force !== "true") return;
    var canvas = new fabric.SlideCanvas(null, this.data, function () {
      canvas.renderThumb($el);
      //modified = slide.modified;
    });
  }


  function scaleThumb() {

    var _container = {
      width: _w,
      height: _h,
    };

    var size = {
      width: slide.canvas.originalWidth || slide.canvas.width,
      height: slide.canvas.originalHeight || slide.canvas.height
    };

    var _fitSize = fabric.util.getProportions( size,_container,"fit");

    $el.width = _fitSize.width;
    $el.height = _fitSize.height;


    $el.style.width = _fitSize.width + 'px';
    $el.style.height = _fitSize.height  + 'px';
    renderThumb();
  }

  function canvasChanged() {
    // _canvas && _canvas.off('after:render', renderThumb);
    // if (this.canvas) {
      // _canvas = scope.ffThumb.canvas;
      this.canvas.on('after:render', renderThumb);
      this.canvas.on("dimensions:modified", scaleThumb);
      this.canvas.on("loading:end", scaleThumb);
    // }
  }


  $el.setAttribute("title", slide.title);
  slide.on('canvas:changed', canvasChanged);
  slide.on('modified', forceRenderThumb);

  scaleThumb.call(slide);
  forceRenderThumb.call(slide);
  canvasChanged.call(slide);

};

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 46 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {
if(!Toolbar){
  var Toolbar = __webpack_require__(1);
  __webpack_require__(77);
  __webpack_require__(79);
  __webpack_require__(80);
  __webpack_require__(81);
  __webpack_require__(78);
}

Toolbar.prototype.setFunctionCallback = function(target){
  if(target.canvas){
    return target.canvas.renderAll();
  }
  if(target.renderAll){
    return target.renderAll()
  }
};


fabric.ToolsMixin = {
  /**
   *
   * @param tools ["x", "*", "y"]
   * @param proto
   * @returns ["x", "a", "b", "c", "y"]
   * @private
   */
  _getTools: function(tools,proto){
    var indexOfStar = -1;
    if((indexOfStar = tools.indexOf("*")) == -1){
      return tools;
    }

    var klassname = fabric.util.string.capitalize(fabric.util.string.camelize(proto.type),true);
    var protoFabric = fabric[klassname].prototype;
    var protoApp = this.application.prototypes[klassname];

    var tools2 = protoApp && protoApp.tools || protoFabric.tools;
    if(tools2){
      tools.splice.apply(tools, [indexOfStar, 1].concat(tools2));
    }
    return this._getTools(tools, protoFabric.__proto__ );
  },
  setTools: function(tools){
    this.tools = this._getTools(tools , this.__proto__.__proto__);
    this.makeActions();
  },
  _getActionValue: function (property) {
    var object = this;
    do{
      if(object.actions && object.actions[property]){
        return object.actions[property];
      }
    }while(object = object.__proto__);
    return null;
  },
  makeActions: function(){
    var actions = {};
    var self = this;
    _.each(this.tools, function(tool){
      var _val = self._getActionValue(tool);
      if(_val){
        actions[tool] = _val;
      }else{
        console.warn("tool " + tool + " is undefined");
      }
    });
    this.generatedActions = Toolbar.makeActions(actions,this);
  }
};
fabric.util.object.extend(fabric.Canvas.prototype,fabric.ToolsMixin);
fabric.util.object.extend(fabric.Object.prototype,fabric.ToolsMixin);
fabric.util.object.extend(fabric.Application.prototype,fabric.ToolsMixin);


fabric.util.object.extend(fabric.Application.prototype,{
  toolbar: false,
  setApplicationToolbarContainer: function(containerId) {
    this.applicationToolbarContainer = containerId;
    new fabric.Toolbar(this, containerId);
  },
  setCanvasToolbarContainer: function(containerId) {
    this.canvasToolbarContainer = containerId;
    new fabric.Toolbar(this.canvas, containerId);
  },
  setObjectsToolbarOptions: function(options) {
    options = _.defaults(options || {
      originX: "left",
      originY: "top",
      marginX: 0,
      marginY: 0
    });

    this.objectsToolbarOptions = options;

    var canvas = this.canvas;
    canvas.on({
      'object:moving': function (event) {
        var $menu = this.getToolbarContainer();
        canvas.setToolbarCoords($menu, canvas.target, canvas.application.objectsToolbarOptions);
      }
    });
  },
  setObjectsToolbarContainer: function(containerId) {
    this.objectsToolbarContainer = containerId;

    var canvas = this.canvas;

    if (containerId) {
      this.$menu = $(document.getElementById(containerId)).hide();
    } else {
      this.$menu = this.$menu || $('<div>');
      $(this.wrapperEl).prepend(this.$menu);
    }
    this.$menu.hide();

    var _last_target = canvas.target;
    canvas.on({
      'target:cleared': function (event) {
        if (_last_target) {
          var $menu = this.getToolbarContainer();
          $menu.hide();
          canvas.objectToolbar.destroy();
          delete canvas.objectToolbar;
          _last_target = null;
        }
      },
      'target:changed': function (event) {
        if (_last_target) {
          canvas.objectToolbar.destroy();
        }
        canvas.createFloatedMenu(this.application.objectsToolbarOptions);
        _last_target = event.target;
      }
    });
  },
  setToolbarOptions: function(toolbarOptions){

    fabric.util.object.deepExtend(Toolbar.tools, toolbarOptions.tools);
    for (var klassName in toolbarOptions.actions) {
      var actions = toolbarOptions.actions[klassName];
      if(!fabric[klassName].prototype.actions){
        fabric[klassName].prototype.actions = {}
      }
      var protoActions = fabric[klassName].prototype.actions;

      if (actions.constructor == Function) {
        actions = actions.call(fabric[klassName].prototype)
      }else{
        actions = fabric.util.object.cloneDeep(actions);
      }
     // var $order = actions["$order"];
     // delete actions["$order"];

      for (var j in actions) {
        if(protoActions[j]){
          if (actions[j]["$clone"]) {
            protoActions[j] = fabric.util.object.deepExtend({}, protoActions[j]);
            delete actions[j]["$clone"];
          }
          fabric.util.object.deepExtend(protoActions[j], actions[j]);
        }else{
          protoActions[j] = actions[j];
        }
      }
     /* if($order){
        fabric[klassName].prototype.actions = fabric.util.object.rearrange(protoActions, $order);
      }*/
    }
  },
  eventListeners: fabric.util.object.extendArraysObject(fabric.Application.prototype.eventListeners, {
   // "canvas:created" : function(){
    //  this.initTools();
   // },
   //  "canvas:created": function(){
   //    this.createToolbars();
   //  }
  })
});

fabric.Toolbar = Toolbar;

fabric.util.object.extend(fabric.Canvas.prototype, {
  setToolbarCoords: function ($menu, target, options) {

    options = fabric.util.object.extend({
      originX: "left",
      originY: "top",
      marginX: 0,
      marginY: 0
    }, options);

    target.setCoords();
    var r = target.getBoundingRect();

    var _left;
    switch (options.originX) {
      case "left":
        _left = r.left;
        break;
      case "right":
        _left = r.left + r.width;
        break;
      case "center":
        _left = r.left + r.width / 2;
        break;
    }
    ;
    var _top;
    switch (options.originY) {
      case "top":
        _top = r.top - $menu.height();
        break;
      case "bottom":
        _top = r.top + r.height;
        break;
      case "center":
        _top = r.top + r.height / 2 - $menu.height() / 2;
        break;
    }
    ;


    _top += options.marginY;
    _left += options.marginX

    var _menuContainerOffset = $($menu.parents()[0]).offset();
    var _canvasOffset = $(this.wrapperEl).offset();

    _top += _canvasOffset.top - _menuContainerOffset.top;
    _left += _canvasOffset.left - _menuContainerOffset.left;

    var coords = {
      top: Math.max(3, _top),
      left: Math.min(Math.max(3, _left), $(this.wrapperEl).width() - $menu.width() - 5)
    };


    $(this.wrapperEl).offset();

    $menu.css(coords);
    return coords;
  },
  getToolbarContainer: function (id, options) {
    return $(document.getElementById(this.application.objectsToolbarContainer));
  },
  createFloatedMenu: function (options) {

    var $menu = this.getToolbarContainer();

    $menu.show();
    //this.toolsContainer = this.$menu;
   /* var _tc = $menu.find(".toolbar-tools-container");
    if (_tc.length) {
      this.toolsContainer = _tc;
    }*/
   // this.toolsContainer.empty();
    if (this.target.actions) {
      this.objectToolbar = new fabric.Toolbar (this.target, $menu, options);
    }
    if(this.application.objectsToolbarOptions){
      $menu.addClass("floated-menu");
      this.setToolbarCoords($menu, this.target, this.application.objectsToolbarOptions);

    }
  }
});



/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 47 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {


fabric.util.uploadImageMaxSize = {
  width: 400,
  height: 400
};

fabric.util.uploadImageMinSize = {
  width: 100,
  height: 100
};

fabric.util.multiUpload = false;

fabric.util.readFile = function(file,callback){

  var reader = new FileReader();
  reader.onload = function (e) {
    var result = e.target.result;
    var type = result.substr(11, result.indexOf(";") - 11);
    var img = new Image();
    img.type = type;
    img.name = file.name;
    img.onload = function () {

      if(!fabric.util.multiUpload){
        if (fabric.util.uploadPreprocessor) {
          fabric.util.uploadPreprocessor([this], function (val) {
            callback(val);
          },options)
        } else {
          callback(this);
        }
      }else{
        callback();
      }
    };
    img.src = result;
  };
  reader.readAsDataURL(file );
};


fabric.util.createUploadInput = function (options, complete, progress) {

  var input = document.createElement("input");
  input.setAttribute("type", "file");
  input.setAttribute("multiple", true);
  input.className = "hidden";

  $(input).change(function () {

    if(input.files && input.files.length){

      var _loader = fabric.util.queueLoad(input.files.length,function(loaded){

        if(fabric.util.multiUpload){
          if (fabric.util.uploadPreprocessor) {
            fabric.util.uploadPreprocessor(loaded, function (val) {
              complete(val,options);
            },options)
          } else {
            complete(loaded,options);
          }
        }else{
          complete(loaded[0],options);

        }
      },function(total, current, image){
        if(fabric.util.multiUpload) {
          if (progress) {
            progress(total, current, image);
          }
        }
      });



      for(var i =0; i< input.files.length; i++){
        fabric.util.readFile(input.files[i],_loader);
      }



    }

  });

  fabric.util.uploadInput = input;
};


//fabric.util.resizeImage(img, callback);
fabric.util.uploadPreprocessor = null;


fabric.util.uploadImage = function (cb,progress,options) {
  fabric.util.createUploadInput(options,cb,progress);
  $(fabric.util.uploadInput).trigger('click');
};


fabric.util.resizeUploadedImage = function (img, callback) {

  if (img.type === "svg+xml") {
    callback(img);
    return;
  }
  //Here we can put a restriction to upload a minim sized logo
  if (img.width < fabric.util.uploadImageMinSize.width || img.height < fabric.util.uploadImageMinSize.height) {
    alert("Logo is too small. MInimum size is " + fabric.util.uploadImageMinSize.width + "x" + fabric.util.uploadImageMinSize.height);
    callback(false);
    return;
  }

  if (img.width > fabric.util.uploadImageMaxSize.width || img.height > fabric.util.uploadImageMaxSize.height) {

    var size = fabric.util.getProportions(img, fabric.util.uploadImageMaxSize, "fit");

    var filter = new fabric.Image.filters.ResizeDP();

    var canvas = fabric.util.createCanvasElementWithSize(img);
    var ctx = canvas.getContext("2d");
    ctx.drawImage(img, 0, 0);
    filter.applyTo(canvas, size.width, size.height);
    callback(canvas);
  } else {
    callback(img);
  }
};


fabric.util.object.extend(fabric.Canvas.prototype,{
  uploadClass: 'Image',
  uploadImageTool: false,
  createImageObject: function (img, objectType) {
    if (!img)return;
    this.createObject({
      position: "center",
      active: true,
      type: this.uploadClass,
      image: img,
      clipTo: this.activeArea,
      movementLimits: this.activeArea
    });
  },
  actions: fabric.util.object.extend(fabric.SlideCanvas.prototype.actions,{
    uploadImage: {
      className:  'fa fa-upload',
      key: 'U',
      title: 'upload image',
      action: function () {
        fabric.util.uploadImage(function(img){
          this.createImageObject(img,this.uploadClass)
        }.bind(this))
      }
    }
  })
});

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 48 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {



/////////////////module responsive borders//////////////////////////////////////////////////////////////////////////////////////////

fabric.util.object.extend(fabric.Object.prototype, {
  responsiveBorders: false
});

if(!fabric.SlideCanvas.prototype._default_event_listeners){
  fabric.SlideCanvas.prototype._default_event_listeners = {};
};

fabric.Object.prototype.updateResponsiveBorder = function(){
  if(this.responsiveBorders){
    if(!this.originalStrokeWidth){
      this.originalStrokeWidth = this.strokeWidth;
    }
    this.strokeWidth = this.canvas ? this.originalStrokeWidth / this.canvas.viewportTransform[0] : 0;
  }
};

fabric.util.object.extend(fabric.SlideCanvas.prototype, {
  _default_event_listeners: {
    "dimensions:modified": function () {
      this.centerAndZoomOut();
    },
    'viewport:scaled': function () {
      if (this.backgroundImage) {
        this.backgroundImage.updateResponsiveBorder();
      }
      for (var i in this._objects) {
        this._objects[i].updateResponsiveBorder();
      }
    },
    "background-image:loaded": function (event) {
      if (this.autoCenterAndZoomOutEnabled) {
        this.centerAndZoomOut();
      }
    },
    "loading:end": function (event) {
      if (this.autoCenterAndZoomOutEnabled && (this.originalHeight || this.originalWidth)) {
        this.centerAndZoomOut();
      }
    },
    "object:added": function (event) {
      event.target.updateResponsiveBorder()
    }
  }
});


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////



fabric.util.object.extend(fabric.SlideCanvas.prototype, {
  zoomCtrlKey: true,
  mouseWheelEnabled : false,
  _setZoomNative  : fabric.Canvas.prototype.setZoom,
  _zoomToPointNative  : fabric.Canvas.prototype.zoomToPoint,
  changeDimensionOnZoom: false,
  drawZoomArea : function(_ctx,left, top ,width, height ){
    _ctx.save();
    _ctx.translate(left || 0, top || 0);
    var _scale = this.getZoom();
    var _size = fabric.util.getProportions(this.backgroundImage, {width: width || 100, height: height || 100});
    _ctx.globalAlpha = 0.5;
    _ctx.fillRect(0,0,_size.width, _size.height);
    _ctx.strokeStyle = "red";

    var v = this.viewportTransform;

    var x1 = -v[4] * _size.scale / _scale;
    var y1 = -v[5] * _size.scale / _scale;
    var x2 = x1 + this.width * _size.scale / _scale;
    var y2 = y1 + this.height * _size.scale / _scale;

    x1 = Math.max(x1,0);
    y1 = Math.max(y1,0);
    x2 = Math.min(x2,_size.width);
    y2 = Math.min(y2,_size.height);

    _ctx.globalAlpha = 1;
    _ctx.beginPath();
    _ctx.moveTo(x1,y1);
    _ctx.lineTo(x2,y1);
    _ctx.lineTo(x2,y2);
    _ctx.lineTo(x1,y2);
    _ctx.lineTo(x1,y1);

    _ctx.fill();
    _ctx.clip();
    // _ctx.globalCompositeOperation = "source-in";
    _ctx.drawImage(this.backgroundImage._element,0,0,_size.width, _size.height)
    // _ctx.globalCompositeOperation = "source-over";
    // _ctx.drawImage(this.backgroundImage._element,0,0,_size.width, _size.height)
    _ctx.stroke();
    _ctx.strokeRect(0,0,_size.width, _size.height);
    _ctx.restore();
  },
  setZoom: function (_scale){
    if(this.changeDimensionOnZoom){
      var _w = Math.round(this.originalWidth * _scale);
      var _h = Math.round(this.originalHeight * _scale);
      this.setDimensions({
        width: _w,
        height: _h
      });
    }
    this._zoomToPointNative( new fabric.Point(0, 0), _scale)
    //  this._setZoomNative(_scale);
    this.fire('viewport:scaled', {scale: _scale});
  },
  zoomToPoint: function(point, newZoom){
    var _max =  this.getMaxZoom();
    var _min =  this.getMinZoom().scale;
    if(newZoom > _max){
      newZoom = _max;
    }
    if(newZoom < _min){
      newZoom = _min;
    }
    this._zoomToPointNative( point, newZoom);
    for (var i in this._objects) {
      this._objects[i].setCoords();
    }
    this.fire('viewport:scaled', {scale: newZoom});
  },
  resetViewport: function () {
    _canvas.viewportTransform[0] = 1;
    _canvas.viewportTransform[3] = 1;
    _canvas.viewportTransform[4] = 0;
    _canvas.viewportTransform[5] = 0;
    _canvas.renderAll();
    for (var i in this._objects) {
      this._objects[i].setCoords();
    }
  },
  zoomToPointEnabled: true,
  minZoomFactor: 1,
  maxZoom: 20,
  autoCenterAndZoomOutEnabled: false,
  getMaxZoom: function () {
    return this.maxZoom;
  },
  getMinZoom: function () {
    var _containerSize = {
      width: $(this.wrapperEl).width(),
      height: $(this.wrapperEl).height()
    };
    var _bgSize = {
      width: this.originalWidth,
      height: this.originalHeight
    };
    var _maxSize = {
      width: _containerSize.width * this.minZoomFactor,
      height: _containerSize.height * this.minZoomFactor
    };

    return fabric.util.getProportions(_bgSize, _maxSize, 'fit');
  },
  centerAndZoomOut: function () {

    if(this.virtual){
      return;
    }
    var options = this.getMinZoom();

    var _containerSize = {
      width: $(this.wrapperEl).width(),
      height: $(this.wrapperEl).height()
    };

    var vpt = this.viewportTransform.slice(0);
    vpt[0] = options.scale;
    vpt[3] = options.scale;
    vpt[4] = (_containerSize.width - options.width ) / 2;
    vpt[5] = (_containerSize.height - options.height) / 2;

    this.setViewportTransform(vpt);


    this._update_background_image();
    // this.fire("viewport:scaled",{scale: options.scale})
    //this.renderAll();
  },
  centerOnObject: function(tag){
    var br = tag.getBoundingRect();
    var ct = this.viewportTransform;
    br.width /= ct[0];
    br.height /= ct[3];
    var size = {
      width: br.width * 1.1,
      height: br.height * 1.1
    };

    var prop = fabric.util.getProportions(size,this);
    var _w = (this.width / prop.scale - size.width ) / 2;
    var _h = (this.height / prop.scale - size.height) / 2;
    var _l = (br.left  - ct[4]) / ct[0];
    var _t = (br.top - ct[5]) / ct[3];

    var x1 = [
      prop.scale,
      0,0,
      prop.scale,
      - tag.left * prop.scale + (tag.width * 0.05 + _w) * prop.scale,
      - tag.top * prop.scale + (tag.height * 0.05 + _h )* prop.scale
    ];
    var x2 = [
      prop.scale,
      0,0,
      prop.scale,
      - _l  * prop.scale + (br.width * 0.05 + _w) * prop.scale,
      - _t  * prop.scale + (br.height * 0.05 + _h )* prop.scale
    ];

    this.setViewportTransform(x2);
    this.fire("viewport:scaled",{scale: prop.scale})
    this.renderAll();
  },

  __onMouseWheel: function (event) {

    if(!this.mouseWheelEnabled || this.zoomCtrlKey && !event.ctrlKey){
      return;
    }
//Find nearest point, that is inside image END
    var zoomStep;// = 0.1 * event.deltaY;
    if (event.deltaY < 0) {
      zoomStep = 1.1;
    } else {
      zoomStep = 0.9;
    }

    var newZoom = this.getZoom() * zoomStep;
    var minZoom = this.getMinZoom().scale;


    if(this.zoomToPointEnabled){
      var point = new fabric.Point(event.offsetX, event.offsetY);
      var _x = this.viewportTransform[4];
      var _y = this.viewportTransform[5];

      // Find nearest point, that is inside image BEGIN
      // It is needed to prevent canvas to zoom outside image
      var _w = this.originalWidth * this.getZoom() + _x;
      var _h = this.originalHeight * this.getZoom() + _y;


      if (point.x < _x) {
        point.x = _x;
      }
      if (point.y < _y) {
        point.y = _y;
      }
      if (point.x > _w) {
        point.x = _w;
      }
      if (point.y > _h) {
        point.y = _h;
      }
      if (minZoom > newZoom) {
        if(this.autoCenterAndZoomOutEnabled){
          this.centerAndZoomOut();
        }
      } else {
        this.zoomToPoint(point, newZoom);
      }
    }else{
      this.setZoom(newZoom);
    }




    for (var i in this._objects) {
      this._objects[i].setCoords();
    }
    this.renderAll();
    event.stopPropagation();
    event.preventDefault();
    return false; //preventing scroll page
  },
  scaleFactor: 1.1,
  getOrignalCenter : function(){
    var point = this.getCenter();
    point.left += this.viewportTransform[4] ;
    point.top += this.viewportTransform[5];
    return point;
  }
});




fabric.util.object.extend(fabric.SlideCanvas.prototype.actions, {
  zoomOut: {
    className: 'fa fa-search-minus',
    title: 'zoom-out',
    action: function (m) {
      var point = this.getOrignalCenter();
      var scaleValue = this.getZoom() / this.scaleFactor;
      this.zoomToPoint({x: point.left, y: point.top},scaleValue);
    }
  },
  zoomNumber: {
    type: 'number',
    value: {
      min:  function(){return 0.01},
      max:  function(){return 10},
      set: function (val) {
        this.setZoom(val)
      },
      get: function () {
        return this.getZoom()
      },
      observe: "viewport:scaled"
    }
  },
  zoomIn: {
    className: 'fa fa-search-plus',
    title: 'zoom-in',
    action: function (m) {
      var point = this.getOrignalCenter();
      var scaleValue = this.getZoom() * this.scaleFactor;
      this.zoomToPoint({x: point.left, y: point.top},scaleValue);
    }
  }
  // zoom: {
  //   title: "zoom",
  //   menu: zoomOut
  // }
});

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 49 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

__webpack_require__(70);
__webpack_require__(69);
__webpack_require__(76);
__webpack_require__(7);
__webpack_require__(74);

/**
 * @author Denis Ponomarev
 * @email den.ponomarev@gmail.com
 */
fabric.Clipart = fabric.util.createClass(
  fabric.Group,
  fabric.StrokeMixin,
  fabric.CacheMixin,
  fabric.ImageMixin, {
    type: 'clipart',
    colors: null,
    format: 'svg',
    resizable: true,
    processing: false,
    stateProperties: fabric.Group.prototype.stateProperties.concat(["colors"]),
    optionsOrder: ["*","colors","element","tools"],
    getOriginalSize: function(){
      return {
        width: this.element.width,
        height: this.element.height
      }
    },
    initialize: function (options) {
      options || ( options = {});

      if (options.constructor != Object) {

        var _obj = options.toObject();
        if (options.element) {
          _obj.element = options.element.cloneSync();
          _obj.element.clipTo = _obj._fabric_shape;
        }
        _obj.shape = options.shape;
        options = _obj;
      }

      this.on({
        "scaling": this.updateElement
      });

      this.initShape(options);
      this._fabric_shape.set({
        opacity: 0,
        originX : 'center',
        originY : 'center',
      });

      this.callSuper('initialize', [this._fabric_shape], options);
      this._setWidthHeight(options);
    },
    setShape: function(el,cb){

      el =  fabric.util.object.extend({
        strokeWidthFull: this.shape.strokeWidthFull,
        strokeWidthEmpty: this.shape.strokeWidthEmpty,
        strokeWidthActive: this.shape.strokeWidthActive,
        dashArray : this.shape.dashArray,
        strokeEmpty:  this.shape.strokeEmpty,
        strokeFull:  this.shape.strokeFull,
        strokeActive:this.shape.strokeActive
      },el);

      var _this = this;
      if(el && el.src && !el.paths){
        fabric.loadSVGFromURL(el.src,function(paths,options) {
          el.paths  = paths;
          fabric.util.object.extend(el,options);
          _this._set_shape(el);
          _this.add(_this._fabric_shape)
          _this._apply_shape();
          cb && cb();
        })
      }else{
        _this._set_shape(el);
        _this.add(_this._fabric_shape);
        _this._apply_shape();
        cb && cb();
      }
    },
    setElement: function (element) {
      if(this.element){
        this.remove(this.element);
      }
      if(!element){
        return;
      }
      element.set({
        originX : 'center',
        originY : 'center'
      });
      this.add(element);
      this.element = element;
      if (this.format === 'png' || this.format === 'image/png' || this.format === 'jpeg' || this.format === 'image/jpeg') {
        this._cache = this.element._element;
      } else {
        this._init_color_array();
      }
      this.dirty = true;
      this.canvas && this.canvas.renderAll();
    },
    updateElement: function () {
      if(this.element){
        this.element.scaleX = this.width / this.element.width;
        this.element.scaleY = this.height / this.element.height;
      }
      if(this._fabric_shape){
        this._fabric_shape.set({
          width: this.width,
          height: this.height
        });
      }
      this.dirty = true;
    },
    _render: function (ctx) {
      ctx.save();
      ctx.scale(this.element.scaleX,this.element.scaleY)
      for (var i = 0, l = this.element.paths.length; i < l; ++i) {
        this.element.paths[i].render(ctx, true);
      }
      ctx.restore();
    },
    /**
     * кобъект готовится к замену фото
     */
    activate: function () {
      this._activated = true;
      this._fabric_shape.setOpacity(1);
      this.updateStroke();
      this.canvas.renderAll();
    },
    /**
     * кобъект не готовится к замену фото
     */
    deactivate: function () {
      this._activated = false;
      this.updateStroke();
      this.canvas.renderAll();
    },
    _init_color_array: function () {

      this.processing = true;
      this._colors = this.element.extractColors();

      this.colors = this.colors || {};

      for (var _color in this.colors) {
        this.setClipartColor(_color, this.colors[_color],true)
      }
    },
    setElementFromMenu: function(options){
      var _this = this;
      fabric.PathGroup.fromURL(options.image.src, function (el) {
        _this.setElement(el);
        _this.makeActions();
        _this.canvas.createFloatedMenu(_this.application.objectsToolbarOptions);
      },{
        width: this.width,
        height: this.height
      });
    },
    // render: function (ctx) {
    //   // var x = noTransform ? 0 : - this.width * this.scaleX / 2,
    //   //   y = noTransform ? 0 : - this.height * this.scaleY / 2;
    //   //
    //   // ctx.save();
    //   // ctx.translate(x,y);
    //   fabric.Group.prototype.render.apply(this,arguments)
    //   // ctx.restore();
    // },
    setClipartColor: function (key, value, preventCacheUpdate) {

      if (!value) {
        value = key;
        delete this.colors[key];
      } else {
        this.colors[key] = value;
      }
      var _colors = this._colors[key];
      for (var i in _colors) {
        if (_colors[i].color) {
          _colors[i].color.fill = value;
        }
        if (_colors[i].stop) {
          _colors[i].stop.color = value;
        }
      }

      this.dirty = true;
      this.canvas && this.canvas.renderAll();
    },
    toObject: function (propertiesToInclude) {
      var _obj = this.callSuper('toObject', ['src', 'colors'].concat(propertiesToInclude));
      delete _obj.objects;
      return _obj;
    },
    actions:  {
      source: {
        type: 'effect',
        className: 'fa fa-file-image-o',
        title: "source",
        actionParameters: function ($el, data) {
          data.target.application.createGallery(data.target, $el, data);
        }
      },
      colors: {
        type: 'menu',
        title: 'color menu',
        menu: function () {
          var _menu = [];
          for (var key in this._colors) {
            _menu.push({
              title: "Color (" + key + ")",
              value: {
                defaultValue: key,
                value: this.colors[key] || key,
                get: function (key) {
                  return this.colors[key] || key;
                }.bind(this, key),
                set: this.setClipartColor.bind(this, key)
              },
              type: "color"
            })
          }
          return _menu;
        }
      }
    }
  }
);

fabric.Clipart.async = true;

/**
 * Creates fabric.PathGroup instance from an object representation
 * @static
 * @memberOf fabric.PathGroup
 * @param {Object} object Object to create an instance from
 * @param {Function} callback Callback to invoke when an fabric.PathGroup instance is created
 */
fabric.Clipart.fromObject = function (object, callback) {
  if (typeof object.src === 'string') {
    if (object.format === 'png' || object.format === "image/png" || object.format === 'jpeg' || object.format === "image/jpeg") {
      fabric.Image.fromURL(object.src, function (el) {
        object.element = el;
        callback(new fabric.Clipart(object));
      }, {
        width: object.width || fabric.Clipart.prototype.width,
        height: object.height || fabric.Clipart.prototype.height
      });
    } else {
      fabric.PathGroup.fromURL(object.src, function (el) {
        object.element = el;
        callback(new fabric.Clipart(object));
      }, {
        width: object.width || fabric.Clipart.prototype.width,
        height: object.height || fabric.Clipart.prototype.height
      });
    }
  } else {
    return new fabric.Clipart(object);
  }
};

fabric.util.createAccessors(fabric.Clipart);

if (fabric.objectsLibrary) {
  fabric.util.object.extend(fabric.objectsLibrary, {
    clipart: {
      "width": function (w, h) {
        var _asp = Math.min(285 / 365, w / h);
        return w;
      },
      "height": function (w, h) {
        var _asp = Math.min(285 / 365, w / h);
        return h;
      },
      "type": "clipart",
      "src": "data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTkuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeD0iMHB4IiB5PSIwcHgiIHZpZXdCb3g9IjAgMCA1MTIgNTEyIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA1MTIgNTEyOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIgd2lkdGg9IjUxMnB4IiBoZWlnaHQ9IjUxMnB4Ij4KPGc+Cgk8cGF0aCBzdHlsZT0iZmlsbDojRkY4QzQ2OyIgZD0iTTE2My4xODksNjcuMTQ4QzEyOS42MTYsNjcuMTQ4LDEyMS4yMjIsMCw3OS4yNTUsMEM1Mi43MTMsMCwyOC44OTQsMTYuNzg3LDI4Ljg5NCw1MC4zNjEgICBzNTguNzU0LDUwLjM2MSw0MS45NjcsMTA5LjExNUwxNjMuMTg5LDY3LjE0OHoiLz4KCTxwYXRoIHN0eWxlPSJmaWxsOiNGRjhDNDY7IiBkPSJNMzQ3Ljg0NSw2Ny4xNDhDMzgxLjQxOSw2Ny4xNDgsMzg5LjgxMiwwLDQzMS43OCwwYzI2LjU0MiwwLDUwLjM2MSwxNi43ODcsNTAuMzYxLDUwLjM2MSAgIHMtNTguNzU0LDUwLjM2MS00MS45NjcsMTA5LjExNUwzNDcuODQ1LDY3LjE0OHoiLz4KPC9nPgo8Zz4KCTxwYXRoIHN0eWxlPSJmaWxsOiNGRkVCRDI7IiBkPSJNMzMxLjU0MSw0NjEuNjM5QzMzMS41NDEsNDg5LjQ1MywzMTEuNjI2LDUxMiwyNTYsNTEycy03NS41NDEtMjIuNTQ3LTc1LjU0MS01MC4zNjF2LTguMzkzaDE1MC41OTkgICBMMzMxLjU0MSw0NjEuNjM5eiIvPgoJPHBhdGggc3R5bGU9ImZpbGw6I0ZGRUJEMjsiIGQ9Ik00NTkuMzY4LDE4Mi45MWMzNC40NDYsNTYuMzAzLDQwLjA0MiwxMDIuNDY3LDQwLjA0MiwxMDIuNDY3aC0xNi43ODcgICBjMCwwLDE2Ljc4Nyw0MS40NDMsMTYuNzg3LDY3LjE0OGwtMjUuMTgtOC4zOTNjMCwwLDE2Ljc4NywzNy43NywxNi43ODcsNjcuMTQ4YzAsMC41MjUtMjUuMTgtOC4zOTMtMjUuMTgtOC4zOTMgICBzMTIuNTksMjguMzI4LDguMzkzLDQxLjk2N2MtMC4xNTQsMC41MDEtMjUuMTgtOC4zOTMtMjUuMTgtOC4zOTNzNy4zNDQsMTkuNTg1LDAsMzMuNTc0bC00MS45NjctMTYuNzg3ICAgYzAsMC03Ljg0NiwyNS42ODEtOC4zOTMsMjUuMThjLTE4LjM2MS0xNi43ODctNDEuOTY3LTI1LjE4LTQxLjk2Ny0yNS4xOEgxNTUuMjc5YzAsMC0yMy42MDcsOC4zOTMtNDEuOTY3LDI1LjE4ICAgYy0wLjU0OCwwLjUtOC4zOTMtMjUuMTgtOC4zOTMtMjUuMThsLTQxLjk2NywxNi43ODdjLTcuMzQ0LTEzLjk4OSwwLTMzLjU3NCwwLTMzLjU3NHMtMjUuMDI2LDguODk1LTI1LjE4LDguMzkzICAgYy00LjE5Ny0xMy42MzksOC4zOTMtNDEuOTY3LDguMzkzLTQxLjk2N3MtMjUuMTgsOC45MTgtMjUuMTgsOC4zOTNjMC0yOS4zNzcsMTYuNzg3LTY3LjE0OCwxNi43ODctNjcuMTQ4bC0yNS4xOCw4LjM5MyAgIGMwLTI1LjcwNSwxNi43ODctNjcuMTQ4LDE2Ljc4Ny02Ny4xNDhIMTIuNTljMCwwLDUuNTk1LTQ2LjE2NCw0MC4wNDItMTAyLjQ2N0g0NTkuMzY4eiIvPgo8L2c+CjxlbGxpcHNlIHN0eWxlPSJmaWxsOiNGRkE1NEI7IiBjeD0iMjU1LjUxNyIgY3k9IjIzMC44MiIgcng9IjIwOS44MzYiIHJ5PSIxOTcuMjQ2Ii8+CjxnPgoJCgkJPGVsbGlwc2UgdHJhbnNmb3JtPSJtYXRyaXgoLTAuNjA0MiAtMC43OTY4IDAuNzk2OCAtMC42MDQyIDYzLjk0NzUgNDk5Ljg5MjYpIiBzdHlsZT0iZmlsbDojRkZFQkQyOyIgY3g9IjE1Ni4xMjMiIGN5PSIyMzQuMDY1IiByeD0iMzcuNzY5IiByeT0iNDYuMTYzIi8+CgkKCQk8ZWxsaXBzZSB0cmFuc2Zvcm09Im1hdHJpeCgtMC42MDQyIDAuNzk2OCAtMC43OTY4IC0wLjYwNDIgNzU1LjkyMDQgOTIuNzAzMSkiIHN0eWxlPSJmaWxsOiNGRkVCRDI7IiBjeD0iMzU0LjkzNyIgY3k9IjIzNC4wODYiIHJ4PSIzNy43NjkiIHJ5PSI0Ni4xNjMiLz4KPC9nPgo8cGF0aCBzdHlsZT0iZmlsbDojRkY4QzQ2OyIgZD0iTTI1NS41MjQsMjYwLjE5N2gtMC4wMTNjLTI4LjcxMSwwLTU1LjA0NSwxOC4yNjgtNjguNTM2LDQ3LjUxMSAgYy0xOC4xNjMsMzkuMzc0LTQwLjU3Myw5MS45OTYtNDAuNTczLDExMS45NjRoMjE4LjIyOWMwLTE5Ljk2Ny0yMi40MDktNzIuNTktNDAuNTczLTExMS45NjQgIEMzMTAuNTY5LDI3OC40NjQsMjg0LjIzNCwyNjAuMTk3LDI1NS41MjQsMjYwLjE5N3oiLz4KPHBhdGggc3R5bGU9ImZpbGw6I0ZGREVCNzsiIGQ9Ik0zMDQuNzk1LDM2OS4zMTFjLTE5LjM5MywwLTM2Ljg1NSw2LTQ5LjI3OCwxNS41ODhjLTEyLjQyMi05LjU4OC0yOS44ODUtMTUuNTg4LTQ5LjI3OC0xNS41ODggIGMtMzcuNjgyLDAtNjguMjMsMjIuNTQ3LTY4LjIzLDUwLjM2MXMzMC41NDgsNTAuMzYxLDY4LjIzLDUwLjM2MWMxNS43MjgsMCwzMC4xODctMy45NDcsNDEuNzE2LTEwLjU1NCAgYzQuNzY0LTIuNzMsMTAuMzU3LTIuNzMsMTUuMTIyLDBjMTEuNTI5LDYuNjA3LDI1Ljk4OCwxMC41NTQsNDEuNzE2LDEwLjU1NGMzNy42ODIsMCw2OC4yMy0yMi41NDcsNjguMjMtNTAuMzYxICBTMzQyLjQ3OCwzNjkuMzExLDMwNC43OTUsMzY5LjMxMXoiLz4KPGc+Cgk8cGF0aCBzdHlsZT0iZmlsbDojNDY0NjU1OyIgZD0iTTIxNS4zNDQsMzc0Ljk5MWwzMy40OCw0NC4yMzJjMy4zNTgsNC40MzcsMTAuMDI2LDQuNDM3LDEzLjM4NCwwbDMzLjQ4LTQ0LjIzMiAgIGM0LjE4NC01LjUyOCwwLjI0MS0xMy40NTktNi42OTMtMTMuNDU5aC00LjVjLTIuNTIsMC01LjAyNiwwLjM3OC03LjQzMiwxLjEyMmwtMTQuMTE2LDQuMzYxYy00Ljg0MiwxLjQ5Ni0xMC4wMjMsMS40OTYtMTQuODY1LDAgICBsLTE0LjExNi00LjM2MWMtMi40MDgtMC43NDQtNC45MTMtMS4xMjItNy40MzItMS4xMjJoLTQuNDk5QzIxNS4xMDMsMzYxLjUzMiwyMTEuMTYsMzY5LjQ2MywyMTUuMzQ0LDM3NC45OTF6Ii8+Cgk8Y2lyY2xlIHN0eWxlPSJmaWxsOiM0NjQ2NTU7IiBjeD0iMTU0Ljc5NiIgY3k9IjIzNS4wMTYiIHI9IjE2Ljc4NyIvPgoJPGNpcmNsZSBzdHlsZT0iZmlsbDojNDY0NjU1OyIgY3g9IjM1Ni4yMzkiIGN5PSIyMzUuMDE2IiByPSIxNi43ODciLz4KCTxwYXRoIHN0eWxlPSJmaWxsOiM0NjQ2NTU7IiBkPSJNNzcuMzU4LDMzNS4wMDFsNDYuMjA2LTM3LjgwNWM0LjAxMi0zLjI4MywxLjEyMy05Ljc2MS00LjAwMS04Ljk2OWwtNjEuNDc4LDkuNSAgIEM2My4xMjMsMzEwLjg2LDY5LjYxOCwzMjMuMzMxLDc3LjM1OCwzMzUuMDAxeiIvPgoJPHBhdGggc3R5bGU9ImZpbGw6IzQ2NDY1NTsiIGQ9Ik0xMjEuNDkzLDM4Mi41NzdsMjUuMDUyLTY2LjgwN2MxLjkyMi01LjEyNS00LjQ5NC05LjI1Ni04LjM2NC01LjM4NWwtNDUuMTgzLDQ1LjE4MyAgIEMxMDEuNTU1LDM2NS40MDYsMTExLjA5OCwzNzQuNDU1LDEyMS40OTMsMzgyLjU3N3oiLz4KCTxwYXRoIHN0eWxlPSJmaWxsOiM0NjQ2NTU7IiBkPSJNMjI2LjQwNSwxMDkuMTQ5bC02LjYzMy03Mi42NjdjLTguMTA2LDEuMzA4LTE2LjA1MiwzLjA0NC0yMy44MTEsNS4yMDFsMjEuNTMyLDY5LjIzOSAgIEMyMTkuMTIsMTE2LjE1NywyMjYuOTAzLDExNC42MDksMjI2LjQwNSwxMDkuMTQ5eiIvPgoJPHBhdGggc3R5bGU9ImZpbGw6IzQ2NDY1NTsiIGQ9Ik0yOTEuMjYzLDM2LjQ4MmwtNi42MzMsNzIuNjY3Yy0wLjQ5OCw1LjQ2LDcuMjg0LDcuMDA3LDguOTEzLDEuNzcybDIxLjUzMi02OS4yMzkgICBDMzA3LjMxNSwzOS41MjcsMjk5LjM2OSwzNy43OSwyOTEuMjYzLDM2LjQ4MnoiLz4KCTxwYXRoIHN0eWxlPSJmaWxsOiM0NjQ2NTU7IiBkPSJNMzM3LjM4Nyw0OS4xNTZsLTIwLjUwOSw0Ny40NDljLTIuMTM3LDQuOTQ2LDQuNTQ5LDguODY4LDcuODIzLDQuNTg4bDMyLjczLTQyLjc5MSAgIEMzNTAuOTQ2LDU1LjAxLDM0NC4yNzEsNTEuOSwzMzcuMzg3LDQ5LjE1NnoiLz4KCTxwYXRoIHN0eWxlPSJmaWxsOiM0NjQ2NTU7IiBkPSJNMTk0LjE1Nyw5Ni42MDVsLTIwLjUwOS00Ny40NDljLTYuODg0LDIuNzQ1LTEzLjU1OSw1Ljg1My0yMC4wNDQsOS4yNDdsMzIuNzMsNDIuNzkgICBDMTg5LjYwOCwxMDUuNDczLDE5Ni4yOTUsMTAxLjU1MSwxOTQuMTU3LDk2LjYwNXoiLz4KCTxwYXRoIHN0eWxlPSJmaWxsOiM0NjQ2NTU7IiBkPSJNMjcyLjIyNCwzNC4yNTNjLTUuNTE4LTAuNDA4LTExLjA3Ny0wLjY3OS0xNi43MDctMC42NzljLTUuNjMsMC0xMS4xODksMC4yNzEtMTYuNzA3LDAuNjc5ICAgbDEyLjE2OSwxMDMuNDRjMC42MzMsNS4zOCw4LjQ0Miw1LjM4LDkuMDc1LDBMMjcyLjIyNCwzNC4yNTN6Ii8+Cgk8cGF0aCBzdHlsZT0iZmlsbDojNDY0NjU1OyIgZD0iTTQzNC44NjgsMzM1LjAwMWwtNDYuMjA2LTM3LjgwNWMtNC4wMTItMy4yODMtMS4xMjMtOS43NjEsNC4wMDEtOC45NjlsNjEuNDc4LDkuNSAgIEM0NDkuMTA0LDMxMC44Niw0NDIuNjA4LDMyMy4zMzEsNDM0Ljg2OCwzMzUuMDAxeiIvPgoJPHBhdGggc3R5bGU9ImZpbGw6IzQ2NDY1NTsiIGQ9Ik0zOTAuNzMzLDM4Mi41NzdsLTI1LjA1Mi02Ni44MDdjLTEuOTIyLTUuMTI1LDQuNDk0LTkuMjU2LDguMzY0LTUuMzg1bDQ1LjE4Myw0NS4xODMgICBDNDEwLjY3MSwzNjUuNDA2LDQwMS4xMjksMzc0LjQ1NSwzOTAuNzMzLDM4Mi41Nzd6Ii8+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPC9zdmc+Cg=="
    }
  });
}

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 50 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {


__webpack_require__(73);
//fabric.require("SlideImage",["SlideObject"/*,"Pathfinder"*/],function() {

fabric.util.object.extend(fabric.Image.prototype, {
  contentOffsets: null,
  /**
   * @private
   * @param {CanvasRenderingContext2D} ctx Context to render on
   * @param {Boolean} noTransform
   */
  _render: function (ctx, noTransform) {
    var x, y, imageMargins = this._findMargins(), elementToDraw;

    x = (noTransform ? this.left : -this.width / 2);
    y = (noTransform ? this.top : -this.height / 2);

    if (this.meetOrSlice === 'slice') {
      ctx.beginPath();
      ctx.rect(x, y, this.width, this.height);
      ctx.clip();
    }

    if (this.isMoving === false && this.resizeFilters.length && this._needsResize()) {
      this._lastScaleX = this.scaleX;
      this._lastScaleY = this.scaleY;
      elementToDraw = this.applyFilters(null, this.resizeFilters, this._filteredEl || this._originalElement, true);
    }
    else {
      elementToDraw = this._element;
    }
    this._renderFill(ctx);
    elementToDraw && ctx.drawImage(elementToDraw,
      x + imageMargins.marginX,
      y + imageMargins.marginY,
      imageMargins.width,
      imageMargins.height
    );

    this._stroke(ctx);
    this._renderStroke(ctx);
  },
  imageTools: false,
  photoshopTools: false,
  cloneSync: function () {
    var _object = this.toObject();
    delete _object.filters;
    var clone = new fabric.Image(this._element, _object);
    clone._filteredEl = this._filteredEl;
    clone.filters = this.filters;
    return clone;
  },
  revertChanges: function () {
    var pathfinder = this.canvas.getPathfinder();
    if (pathfinder.target && pathfinder.target == this) {
      pathfinder.hide();
    }

    if (this._element == this._originalElement) {
      return;
    }

    this.filters.length = 0;
    if (this._filteredEl) {
      delete this._filteredEl;
    }
    delete this._edited;
    this._element = this._originalElement;

    this.fire("content:modified", {
      bounds: {minX: 0, minY: 0, maxX: this._element.width, maxY: this._element.height}
    });


    this.canvas.renderAll();
  },
  extractColors: function() {
    var _colors = fabric.MagicWand.extractColors(this._element);
    var colors = {};
    for(var i in _colors){
      var _str = "rgb(" + _colors[i].join(",") + ")";
      colors[_str] = {};
    }
    return colors;
  },
  actions: fabric.util.object.extend( fabric.Image.prototype.actions, {
    photoshopTools: {
      type: 'effect',
      effectTpl: '<div id="editor-tools" class="inline-actions compact"></div>' +
                    '<div class="checkboard" ><div id="pathfinder"></div></div>',
      className: 'fa fa-pencil-square-o',
      title: "advanced tools",
      action: function () {
        var pathfinder = this.canvas.getPathfinder();
        pathfinder.target = this;
        pathfinder.setPicture(this._element);
        pathfinder.show();
      },
      actionParameters: function (el, data) {

        var pathfinder = this.canvas.getPathfinder();
        pathfinder.canvas = this.canvas;

        new fabric.Toolbar(pathfinder, 'editor-tools');


        pathfinder.setContainer('pathfinder');

        // if (pathfinder.target)pathfinder.hide();
        pathfinder.target = this;
        pathfinder.setPicture(this._element);
        pathfinder.show();
      }
    },
    revertChanges: {
      className: 'fa fa-history',
      title: "revert to orignal image",
      action: "revertChanges",
      observe: "content:modified",
      visible: function () {
        return !!this._filteredEl || this._edited;
      }
    }
  })
});

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 51 */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(fabric) {
// require("../modules/pathfinder");
__webpack_require__(68);

fabric.util.object.extend(fabric.Image.prototype, {
  removeWhite: function (threshold, removeAll, callback) {


    var rwf = _.findWhere(this.filters, {type: 'RemoveWhiteDP'});

    if (rwf) {
      rwf.options.colorThreshold = threshold;
      rwf.options.fromCorners = !removeAll;
    } else {
      rwf = new fabric.Image.filters.RemoveWhiteDP({
        fromCorners: !removeAll,
        blurRadius: 2,
        colorThreshold: threshold
      });
      this.filters.push(rwf);
    }

    var _this = this;
    this.applyFilters(function () {
      //_this.width = _this._element.width;
      //_this.height = _this._element.height;
      _this.canvas.renderAll();
      _this.fire("content:modified", {filter: rwf, bounds: rwf.bounds});
      callback && callback();
    });
  },
  removeWhiteAll: true,

  actions: fabric.util.object.extend(fabric.Image.prototype.actions, {
    removeWhiteFromBorders: {
      title: 'Remove Background',
      type: 'effect',
      className: "fa fa-dot-circle-o",
      effectTpl: '<button id="select-colors-action-button" class="fa fa-check"></button>' +
      '<input id="select-colors-checkbox" type="checkbox">' +
      '<input id="select-colors-threshold" type="range"   min="1" max="255">',
      actionParameters: function (el, data) {
        var
          actionChk = el.find('#select-colors-checkbox'),
          actionBtn = el.find('#select-colors-action-button');
        data.thresholdEl = el.find('#select-colors-threshold');

        data.removeWhiteAll = actionChk.is(":checked");
        actionChk.change(function () {
          data.removeWhiteAll = actionChk.is(":checked")
        });
        actionBtn.click(function () {
          data.action();
        });
        if (!data.__action) {

          data.__action = data.action;
          data.action = function () {
            data.__action(parseInt(data.thresholdEl.val()), data.removeWhiteAll)
          };
        }
      },
      action: "removeWhite",
      insert: 'imageTools'
    }
  })
});

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 52 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

var path_initialize_overwritten = fabric.Path.prototype.initialize;

fabric.util.object.extend(fabric.Path.prototype, {
  accuracy: 0,
  initialize: function (path, options) {
    this.callSuper('initialize', options);
    path_initialize_overwritten.call(this, path, options);
    this._set_accuracy(this.accuracy, this.path);
  },
  translate: function (path, translateX, translateY) {
    var current;
    //if(this.path[0][0] === "m"){
    //  return;
    //}
    for (var i = 0, len = path.length; i < len; ++i) {

      current = path[i];

      switch (current[0]) { // first letter
        case 'L': // lineto, absolute
          current[1] += translateX;
          current[2] += translateY;
          break;
        case 'H':
          current[1] += translateX;
          break;
        case 'V': // verical lineto, absolute
          current[1] += translateY;
          break;
        case 'M':
          current[1] += translateX;
          current[2] += translateY;
          break;
        case 'C':
          current[1] += translateX;
          current[2] += translateY;
          current[3] += translateX;
          current[4] += translateY;
          current[5] += translateX;
          current[6] += translateY;
          break;
        case 'S':
          current[1] += translateX;
          current[2] += translateY;
          current[3] += translateX;
          current[4] += translateY;
          break;
        case 'Q': // quadraticCurveTo, absolute
          current[1] += translateX;
          current[2] += translateY;
          current[3] += translateX;
          current[4] += translateY;
          break;
        case 'T':
          current[1] += translateX;
          current[2] += translateY;
          break;
        case 'A':
          current[1] += translateX;//todo??
          current[2] += translateY;//todo ??
          current[6] += translateX;
          current[7] += translateY;
      }
    }
  },
  _set_accuracy: function (accuracy, path) {
    for (var i =0 ; i < path.length; i++) {
      for (var j = 1; j < path[i].length; j++) {
        path[i][j] = +path[i][j].toFixed(this.accuracy);
      }
    }
  },
  setAccuracy: function (accuracy) {
    this.accuracy = accuracy;
    if(!this._points)return;
    this._set_accuracy(accuracy, this.path);
  },
  storePathAsString: false,
  _toObject_overwritten: fabric.Path.prototype.toObject,
//todo use event "before:object";
  toObject: function (propertiesToInclude) {

    if(this.accuracy){
      this._set_accuracy(this.accuracy,this.path);
      this.left = +this.left.toFixed(this.accuracy);
      this.top  = +this.top.toFixed(this.accuracy);
      this.pathOffset.x = +this.pathOffset.x.toFixed(this.accuracy);
      this.pathOffset.y = +this.pathOffset.y.toFixed(this.accuracy);
    }

    var _obj = this._toObject_overwritten(propertiesToInclude);

    if (this.storeProperties.indexOf("*") == -1) {

      if (_obj.pathOffset && this.storeProperties.indexOf("pathOffset") == -1) {
        this.translate(_obj.path, _obj.pathOffset.x, _obj.pathOffset.y)
        this._set_accuracy(this.accuracy,_obj.path);
      }

      for (var i in _obj) {
        if (this.storeProperties.indexOf(i) == -1) {
          delete _obj[i];
        }
      }
      console.log("!!!")
    }
    if (this.storePathAsString) {
      _obj.path = _obj.path.join('')
    }
    return _obj;
  }
});

/**
 * Creates an instance of fabric.Path from an object
 * @static
 * @memberOf fabric.Path
 * @param {Object} object
 * @param {Function} callback Callback to invoke when an fabric.Path instance is created
 */
fabric.Path.fromObject = function (object, callback) {
  /* if (typeof object.path === 'string') {
   fabric.loadSVGFromURL(object.path, function (elements) {
   var path = elements[0],
   pathUrl = object.path;

   delete object.path;

   fabric.util.object.extend(path, object);
   path.setSourcePath(pathUrl);

   callback(path);
   });
   }
   else {*/

  var _scaled = object.scaleX || object.scaleY;

  var path = new fabric.Path(object.path, object);

  if(!_scaled){
    if(object.width){
      path.scaleX = object.width / path.width;
    }
    if(object.height){
      path.scaleY = object.height / path.height;
    }
  }

  callback && callback(path);
  return path;
  // }
};

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 53 */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(fabric) {
//----------------------------------------------------------------------------------------------------------------------
// ListStyle

fabric.util.object.extend(fabric.Textbox.prototype, {
  stateProperties: fabric.Rect.prototype.stateProperties.concat(["listStyleType","listStyleFormat","listTextPadding","textPadding"]),
  listStyleType: "none",
  listStyleFormat: "N.",
  listTextPadding: 40,
  textPadding: 0,
  setTextPadding: function(val){
    this.textPadding = val;
    this._initDimensions();
  },
  setListStyleType: function(val){
    this.listStyleType = val;
    this.setTextPadding(val === "none" ? 0: this.listTextPadding);
  },
  /**
   * Wraps text using the 'width' property of Textbox. First this function
   * splits text on newlines, so we preserve newlines entered by the user.
   * Then it wraps each line using the width of the Textbox by calling
   * _wrapLine().
   * @param {CanvasRenderingContext2D} ctx Context to use for measurements
   * @param {String} text The string of text that is split into lines
   * @returns {Array} Array of lines
   */
  _wrapText: function(ctx, text) {
    var lines = text.split(this._reNewline), wrapped = [], i;


    this._paragraphs = {};

    for (i = 0; i < lines.length; i++) {
      this._paragraphs[wrapped.length] = this.listStyleFormat.replace("N",i + 1)
      wrapped = wrapped.concat(this._wrapLine(ctx, lines[i], i));
    }

    return wrapped;
  },


  /**
   * Wraps a line of text using the width of the Textbox and a context.
   * @param {CanvasRenderingContext2D} ctx Context to use for measurements
   * @param {String} text The string of text to split into lines
   * @param {Number} lineIndex
   * @returns {Array} Array of line(s) into which the given text is wrapped
   * to.
   */
  _wrapLine: function(ctx, text, lineIndex) {
    var lineWidth        = 0,
      lines            = [],
      line             = '',
      words            = text.split(' '),
      word             = '',
      offset           = 0,
      infix            = ' ',
      wordWidth        = 0,
      infixWidth       = 0,
      largestWordWidth = 0,
      lineJustStarted = true,
      additionalSpace = this._getWidthOfCharSpacing();



    var _textAreaWidth = this.width;
    if(this.textPadding){
      _textAreaWidth -= this.textPadding
    }
    for (var i = 0; i < words.length; i++) {
      word = words[i];
      wordWidth = this._measureText(ctx, word, lineIndex, offset);

      offset += word.length;

      lineWidth += infixWidth + wordWidth - additionalSpace;

      if (lineWidth >= _textAreaWidth && !lineJustStarted) {
        lines.push(line);
        line = '';
        lineWidth = wordWidth;
        lineJustStarted = true;
      }
      else {
        lineWidth += additionalSpace;
      }

      if (!lineJustStarted) {
        line += infix;
      }
      line += word;

      infixWidth = this._measureText(ctx, infix, lineIndex, offset);
      offset++;
      lineJustStarted = false;
      // keep track of largest word
      if (wordWidth > largestWordWidth) {
        largestWordWidth = wordWidth;
      }
    }

    i && lines.push(line);

    if (largestWordWidth > this.dynamicMinWidth) {
      this.dynamicMinWidth = largestWordWidth - additionalSpace;
    }

    return lines;
  },
  /**
   * @private
   * @param {Number} lineWidth Width of text line
   * @return {Number} Line left offset
   */
  _getLineLeftOffset: function(lineWidth) {
    if (this.textAlign === 'center') {
      return (this.width - lineWidth) / 2 + this.textPadding/2;
    }
    if (this.textAlign === 'right') {
      return this.width - lineWidth;
    }
    return this.textPadding;
  },
  /**
   * @private
   * @param {CanvasRenderingContext2D} ctx Context to render on
   * @param {String} method Method name ("fillText" or "strokeText")
   */
  _renderTextCommon: function(ctx, method) {

    var lineHeights = 0, left = this._getLeftOffset(), top = this._getTopOffset();

    for (var i = 0, len = this._textLines.length; i < len; i++) {
      var heightOfLine = this._getHeightOfLine(ctx, i),
        maxHeight = heightOfLine / this.lineHeight,
        lineWidth = this._getLineWidth(ctx, i),
        leftOffset = this._getLineLeftOffset(lineWidth);


      this._renderTextLine(
        method,
        ctx,
        this._textLines[i],
        left + leftOffset,
        top + lineHeights + maxHeight,
        i
      );
      lineHeights += heightOfLine;
    }
  },


  /**
   * @private
   * @param {String} method Method name ("fillText" or "strokeText")
   * @param {CanvasRenderingContext2D} ctx Context to render on
   * @param {String} line Text to render
   * @param {Number} left Left position of text
   * @param {Number} top Top position of text
   * @param {Number} lineIndex Index of a line in a text
   */
  _renderTextLine: function(method, ctx, line, left, top, lineIndex) {



    // lift the line by quarter of fontSize
    top -= this.fontSize * this._fontSizeFraction;

    switch(this.listStyleType){
      case "decimal":
        if( this._paragraphs[lineIndex]){
          // lift the line by quarter of fontSize
          this._renderChars(method, ctx, this._paragraphs[lineIndex] , left - this.textPadding , top  , lineIndex, 0);
        }
    }


    // short-circuit
    var lineWidth = this._getLineWidth(ctx, lineIndex);
    if (this.textAlign !== 'justify' || this.width < lineWidth) {

      this._renderChars(method, ctx, line, left, top, lineIndex);
      return;
    }


    // stretch the line
    var words = line.split(/\s+/),
      charOffset = 0,
      wordsWidth = this._getWidthOfWords(ctx, words.join(''), lineIndex, 0),
      widthDiff = this.width - wordsWidth - this.textPadding,
      numSpaces = words.length - 1,
      spaceWidth = numSpaces > 0 ? widthDiff / numSpaces : 0,
      leftOffset = 0, word;

    for (var i = 0, len = words.length; i < len; i++) {
      while (line[charOffset] === ' ' && charOffset < line.length) {
        charOffset++;
      }
      word = words[i];
      this._renderChars(method, ctx, word, left + leftOffset, top, lineIndex, charOffset);
      leftOffset += this._getWidthOfWords(ctx, word, lineIndex, charOffset) + spaceWidth;
      charOffset += word.length;
    }
  },
  toggleListStyleType: function(){
    this.setListStyleType(this.listStyleType == "none" ? "decimal" : "none");
    this.canvas.renderAll();
  },
  actions: {
    toggleListStyleType: {
      className: 'fa fa-list-ol',
      title: 'ordered list'
    }
  }

})

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 54 */
/***/ (function(module, exports, __webpack_require__) {


var path = __webpack_require__(6);
var util = __webpack_require__(3);
var object = __webpack_require__(2);

function isServer() {
  return ! (typeof window != 'undefined' && window.document);
}


if (isServer()) {
  var fs = __webpack_require__(82);
}


function _load_json (value, callback_success, callback_error){

  var output = null;
  var errors = [];

  if (value.constructor == String) {

    var filename, regex_data, init_property;
    regex_data = /^([^#]*)#?(.*)$/.exec(value);

    filename = regex_data[1];
    init_property = regex_data[2];
    utils.getInlineJson(filename, "json", _loadJson_data, function (error) {
      errors.push(error);
      if (callback_error) {
        callback_error(error)
      } else {
        console.error("file: \"" + filename + "\". " + error.message)
      }
    });
  } else {
    _loadJson_data(value);
  }

  function _loadJson_data(data) {
    /*
     замена записей "url(./path/to/file)  на "../../path/to/file"
     url начинающиеся с ./ относительно родителького json файла

     url с "/" добавляется APP_STATIC_PATH
     */
    utils.recoursive(data,
      function (property, value, parent) {
        if (/^url\(.*\)$/.test(value)) {
          var regex_data = /^url\((\.?\/)?(.*)\)$/.exec(value);
          var url = regex_data[2];

          if (regex_data[1] == "/") {
            url = window.APP_STATIC_PATH + url;
          }
          if (regex_data[1] == "./") {
            url = path.getParentDirectoryUrl(filename) + url;
          }

          parent[property] = path.resolve(url);
        }
      }
    );


    var loader = util.queueLoad(1, function finalize() {

      if (init_property) {
        var prop_arr = init_property.split("/");
        for (var i = 0; i < prop_arr.length; i++) {
          data = data[prop_arr[i]];
        }
      }

      if (errors.length) {
        if (callback_error) callback_error(errors);
      } else {
        if (callback_success) callback_success(data);
        output = data;
      }
    });

    /**
     * remove comments
     */
    utils.recoursive(data, function (property, value, parent) {
      /*
       remove comments like
       ["@comment()"]
       "@comment": {}
       */
      if (/^\/\/.*$/.test(value) || /^@comment\(.*\)$/.test(value) || property == "@comment") {
        if (parent.constructor == Array) {
          parent.splice(property, 1);
        } else {
          delete parent[property];
        }
      } else if (/^@extend.*$/.test(property)) {

        loader.total++;
        _load_json(value, function (data) {
          var ext_data = object.deepExtend(data, parent);
          object.deepExtend(parent, ext_data);
          delete parent["@extend"];
          loader();
        }, function (data, error) {
          errors.push(error);
          loader();
        });
      } else if (/^@extend\(.*\)$/.test(value)) {
        var _reg_data = /^@extend\((\.\/)?(.*)\)$/.exec(value);
        var url = _reg_data[2];
        if (_reg_data[1]) {
          url = path.getParentDirectoryUrl(filename) + url;
        }
        loader.total++;
        _load_json(url, function (data) {
          parent[property] = data;
          loader();
        }, function (data, error) {
          errors.push(error);
          loader();
        });
      } else if (/^@mixin\(.*\)$/.test(value)) {
        var _reg_data = /^@mixin\((\.\/)?(.*)\)$/.exec(value);
        var url = _reg_data[2];
        if (_reg_data[1]) {
          url = path.getParentDirectoryUrl(filename) + url;
        }
        loader.total++;
        _load_json(url, function (data) {
          if (parent.constructor == Array) {
            parent.splice(property, 1);
            for (var i in data) {
              parent.push(data[i])
            }
          } else {
            delete parent[property];
            for (var i in data) {
              parent[i] = data[i];
            }
          }
          loader();
        }, function (data, error) {
          errors.push(error);
          loader();
        });
      } else if (/^@load\((.*)\)$/.test(value)) {
        var _reg_data = /^@load\((\.?\/)?(.*)\)$/.exec(value);
        var url = _reg_data[2];
        if (_reg_data[1] == "/") {
          url = window.APP_STATIC_PATH + url;
        }
        if (_reg_data[1] == "./") {
          url = path.getParentDirectoryUrl(filename) + url;
        }

        loader.total++;
        utils.getInlineJson(url, "html", function (data) {
          parent[property] = data;
          loader();
        }, function (data, error) {
          errors.push(error);
          loader();
        });
      }

    });
    loader();

  }

  return output;
}

var utils = {
  CACHED_JSON : {},
  loadJsonSync: function(src){
    var data;
    _load_json(src,function(_data){
      data = _data;
    });
    return data;
  },

  /**
   позволяет использовать конструкции вида
   расширить данные из файла template.json
   "@extend" : "url(data/template.json)",
   "@extend" : "url(data/template.json#settings/stages)",

   //заменить строку наданные из файла
   "stages":       "url(data/template.json#settings/stages)",

   * @param filename
   * @param callback_success
   * @param callback_error
   */
  loadJson: function (value,resolve_cb,fail_cb) {
      return _load_json(value,function(data){
        resolve_cb && resolve_cb(data);
      },function(err){
        fail_cb && fail_cb(err);
      });
  },

  removeComments: function (str) {
    str = str.replace(/^\s*(\/\/.*|(?:\/\*[\s\S]*?)\*\/\s*)$/gm,"");
    return str;
  },
  /**
   *
   * @param object
   * @param criteria - выполнять функцию со всеми объектами
   */
  recoursive: function (object, criteria) {
    var readed = [];
    if (!object) return;
    return (function sub_recoursive(object) {
      if (readed.indexOf(object) != -1) {
        return;
      }
      readed.push(object);


      if (object instanceof Array) {
        for (var prop = object.length; prop--;) {
          if (object[prop] && (object[prop].constructor == Object || object[prop].constructor == Array)) {
            sub_recoursive(object[prop]);
          } else {
            var break_ = criteria(prop, object[prop], object);
          }
        }
      } else {
        for (var prop in object) {
          if (object[prop] && (object[prop].constructor == Object || object[prop].constructor == Array)) {
            sub_recoursive(object[prop]);
          } else {
            var break_ = criteria(prop, object[prop], object);
          }
        }
      }
    })(object);
  },

  parseCSV: function (data) {
    var rows = data.split(/\n/);
    var columns = rows[0].split(',');
    rows.splice(0, 1);

    for (var i = 0; i < rows.length; i++) {
      var output_row_data = {};
      var row_data = [];


      var _quote = false, last = -1;
      var j = -1;
      var str = rows[i];
      while (++j < str.length) {
        if (!_quote) {
          if (str[j] == '\'' || str[j] == '\"') {
            _quote = str[j];
          }
          if (str[j] == ",") {
            var _val = str.substring(last, j);
            if (_val[0] == '\"' && _val[_val.length - 1] == '\"') {
              _val = _val.substring(1, _val.length - 1);
            }
            row_data.push(_val);
            last = j + 1;
          }
        } else {
          if (str[j] == _quote) {
            _quote = false;
          }
        }
      }

      for (var j in row_data) {
        output_row_data[columns[j]] = row_data[j];
      }
      rows[i] = output_row_data;
    }
    return rows;
  },
  parseData: function (data, dataType) {
    var _parsed;
    if (dataType == "csv") {
      _parsed = utils.parseCSV(data);
    } else if (dataType == "json") {
      _parsed = data.trim();
      //if (data[0] != "{" && data[0] != "[") {
      //  return false;
      //}

      _parsed = utils.removeComments(_parsed);
      //data  = data.replace(/\n/g,"")

      try{
        var _parsed = JSON.parse(_parsed);//= JSON.parse(data.replace(/\/\*[\s\S]*?\*\/|\/\/.*/g,""));
      }catch(e){
        return {
          status: "error",
          message: e.toString(),
          data:  data
        };
      }
      //var script = $("<script type='text/json' id='" + url + "'>" + JSON.stringify(data) + "</script>");
    }
    return {
      status: "success",
      data: _parsed
    };
  },
  load: function (url, dataType, callback_success, callback_error) {
    //todo
    if (isServer()) {
      try {
        var data = fs.readFileSync(url, 'utf8');
        data = data.replace(/^\uFEFF/, '');
        var _parsed = utils.parseData(data, dataType);
        if(_parsed.status == "error"){
          callback_error({
            status:   "error",
            message:  _parsed.message,
            data:     _parsed.data
          });
          return;
        }
        callback_success(_parsed.data);
      } catch (e) {

        if (e.code === 'ENOENT') {
          console.log('File not found!');
        } else {
          throw e;
        }
        callback_error(data);
      }
    } else {

      var httpRequest = new XMLHttpRequest();

      httpRequest.onreadystatechange = function () {
        if (httpRequest.readyState === 4) {
          if (httpRequest.status === 200) {
            var data = httpRequest.responseText;
            var _parsed = utils.parseData(data, dataType);
            if(_parsed.status == "error"){
              callback_error({
                status: httpRequest.status,
                message:  _parsed.message,
                response: httpRequest.responseText
              });
              return;
            }
            callback_success(_parsed.data);
          } else {
            callback_error(url, httpRequest)
          }
        }
      };
      httpRequest.open('GET', url);
      httpRequest.send();
    }
  },
  /**
   * Позволяетзагружать json файлы , содержащие ссылки на другие json файлы.
   * вместо ссылок типа
   *  "property" : "url(chunk.json)"
   *  будет загружено содержимое файла
   *  "property" : {...}
   *
   *  если указать якорь
   *  "property" : "url(chunk.json#settings/chunk/0/text)"
   *
   * то будет загружено содержимое поля settings.chunk[0].text из файла chunk.json
   *
   *
   * @param filename  путь к основному json файлу
   * @param callback  будет вызван после окончания загрузки всех файлов
   */
  getInlineJson: function (url, dataType, callback_success, callback_error) {

    if (dataType.constructor != String) {
      callback_error = callback_success;
      callback_success = dataType;
      dataType = "json";
    }


    if (typeof utils.CACHED_JSON !== "undefined" && utils.CACHED_JSON && utils.CACHED_JSON[url]) {
      callback_success(utils.CACHED_JSON[url]);
      return;
    }
    if (typeof $ !== "undefined") {
      if (typeof document !== "undefined") {
        var inline = $("script[id='" + url + "']");
        if (inline.length > 0) {
          var _data =
            inline[0].innerText || //all
            inline[0].textContent || //firefox
            inline[0].text; //ie8
          if (dataType == "json") {

            var _data = utils.removeComments(_data);
            callback_success(JSON.parse(_data));
          } else {
            callback_success(_data);
          }
          return;
        }
      }
    }
    utils.load(url, dataType, callback_success, callback_error);
  }
};

module.exports = utils;


/***/ }),
/* 55 */
/***/ (function(module, exports) {



module.exports = {

  loadScript: function (requirement, helper, error) {
    var head = document.getElementsByTagName('head')[0];
    var script = document.createElement('script');
    script.type = 'text/javascript';
    script.onerror = error;
    script.onreadystatechange = function () {
      if (this.readyState == 'complete') {
        helper(script, __src);
      }
    };
    script.addEventListener("load", helper, true);
    script.src = requirement;
    head.appendChild(script);
  },
  scriptURL: function () {

    if (document.currentScript) {
      return document.currentScript.src;
    }
    var scripts = document.getElementsByTagName('script');
    for (var i = scripts.length - 1; i--;) {
      if (scripts[i].src) {
        return scripts[i].src;
      }
    }
    return false;
  }
};


/***/ }),
/* 56 */
/***/ (function(module, exports) {


var deepDiffMapper = {
  VALUE_CREATED: 'created',
  VALUE_UPDATED: 'updated',
  VALUE_DELETED: 'deleted',
  VALUE_UNCHANGED: 'unchanged',
  map: function(obj1, obj2) {
    if (this.isFunction(obj1) || this.isFunction(obj2)) {
      throw 'Invalid argument. Function given, object expected.';
    }
    if (this.isValue(obj1) || this.isValue(obj2)) {
      return {
        '_map_type': this.compareValues(obj1, obj2),
        '_map_data': (obj2 === undefined) ? obj1 : obj2
      };
    }


    if(_.isArray(obj2)){
      var _array = true;
      var diff = [];
    }else{
      var diff = {};
    }


    for (var key in obj1) {
      if (this.isFunction(obj1[key])) {
        continue;
      }

      var value2 = undefined;
      if ('undefined' != typeof(obj2[key])) {
        value2 = obj2[key];
      }

      diff[key] = this.map(obj1[key], value2);
    }
    for (var key in obj2) {
      if (this.isFunction(obj2[key]) || ('undefined' != typeof(diff[key]))) {
        continue;
      }

      var _val = this.map(undefined, obj2[key]);
      if(_array){
        diff.push(_val);
      }else{
        diff[key] = _val
      }
    }

    return {
      '_map_type': '',
      '_map_data': diff
    };

  },
  compareValues: function(value1, value2) {
    if (value1 === value2) {
      return this.VALUE_UNCHANGED;
    }
    if ('undefined' == typeof(value1)) {
      return this.VALUE_CREATED;
    }
    if ('undefined' == typeof(value2)) {
      return this.VALUE_DELETED;
    }

    return this.VALUE_UPDATED;
  },
  isFunction: function(obj) {
    return {}.toString.apply(obj) === '[object Function]';
  },
  isArray: function(obj) {
    return {}.toString.apply(obj) === '[object Array]';
  },
  isObject: function(obj) {
    return {}.toString.apply(obj) === '[object Object]';
  },
  isValue: function(obj) {
    return !this.isObject(obj) && !this.isArray(obj);
  }
};

module.exports = {
  differenceMap: deepDiffMapper.map.bind(deepDiffMapper),
  syntaxHighlight: function (json) {
    if (typeof json != 'string') {
      json = JSON.stringify(json, null, 2);
    }
    json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');

    json = json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {
      var cls = 'number';
      if (/^"/.test(match)) {
        if (/:$/.test(match)) {
          cls = 'key';
        } else {
          cls = 'string';
        }
      } else if (/true|false/.test(match)) {
        cls = 'boolean';
      } else if (/null/.test(match)) {
        cls = 'null';
      }
      return '<span class="' + cls + '">' + match + '</span>';
    });
    return json = json.replace(/[^,\n][^\n]*/g, function (match) {
      return '<span>' + match + '</span>';
    });
  },
  differenceHighlight: function  (json,output){

    if(output){
      output.empty();
    }else{
      output = $("<pre>");
    }


    function printObject(json,level,output,comma,objectIndex){
      var _el = $("<p>");

      _el.append($("<span>").addClass("object-key").append(
        $("<span>").text(new Array(level).join(' ') )
      ));
      if(objectIndex){
        _el.append(
          $("<span>").text('"').addClass("invisible"),
          $("<span>").addClass("key").text(objectIndex),
          $("<span>").text('"').addClass("invisible"),
          $("<span>").text(': ')
        );
      }

      if(json && json._map_type !== undefined){
        _el.addClass(json._map_type);

        if(_.isArray(json._map_data)){
          _el.append($("<span>").text("["));
          var _last_key = json._map_data.length - 1;
          for(var i in json._map_data){
            printObject(json._map_data[i],level + 1,_el,i != _last_key);
          }
          _el.append($("<p>").text(new Array(level ).join(' ') + "]" + (comma ? "," : "")));
        }
        else if(_.isObject(json._map_data)){
          _el.append($("<span>").text("{"));
          var _last_key = Object.keys(json._map_data).pop();
          for(var i in json._map_data){
            printObject(json._map_data[i],level + 1,_el,i != _last_key,i);
          }
          _el.append($("<p>").text(new Array(level ).join(' ') + "}" + (comma ? "," : "")));
        }
        else{

          if(_.isNull(json._map_data)){
            _el.append(
              $("<span>").text(JSON.stringify(json._map_data, null, 2))
            );
          }
          else if(json._map_data.constructor === String ){
            _el.append(
              $("<span>").text('"'),
              $("<span>").addClass('string').text(json._map_data),
              $("<span>").text('"')
            );
          }
          else if(json._map_data.constructor === Number || json._map_data.constructor === Boolean){
            _el.append(
              $("<span>").addClass('number').text(json._map_data)
            );
          }
          else{
            _el.append(
              $("<span>").text(JSON.stringify(json._map_data, null, 2))
            );
          }
          if(comma){
            _el.append(
              $("<span>").text(",")
            );
          }


        }
      }else{
        _el.append(
          $("<span>").text(JSON.stringify(json, null, 2))
        )

        if(comma){
          _el.append(
            $("<span>").text(",")
          );
        }

      }

      output.append(_el);

    }
    printObject(json,1,output);
    return output;
  }
};



/***/ }),
/* 57 */
/***/ (function(module, exports) {

module.exports = function() {
	throw new Error("define cannot be used indirect");
};


/***/ }),
/* 58 */
/***/ (function(module, exports) {

/* WEBPACK VAR INJECTION */(function(__webpack_amd_options__) {/* globals __webpack_amd_options__ */
module.exports = __webpack_amd_options__;

/* WEBPACK VAR INJECTION */}.call(exports, {}))

/***/ }),
/* 59 */
/***/ (function(module, exports) {

module.exports = "PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMiAyMiI+PGcgdHJhbnNmb3JtPSJtYXRyaXgoLjAzOTY1IDAgMCAuMDM5NjUgMS4xNjMgMS4xNjMpIiBmaWxsPSIjNGQ0ZDRkIj48cGF0aCBkPSJtMjUwLjIgODEuNjFjOTcuNDMgMCAxNzkuNzUgNDMuNDMgMTc5Ljc1IDk0LjgzIDAgMTIuNDQ5LTQuOTM0IDI0LjQ0OS0xMy42NDUgMzUuNDY1bDM1LjQwMiAxMC40MDRjOC42MTMtMTQuMjI3IDEzLjUzMy0yOS42MjkgMTMuNTMzLTQ1Ljg2OSAwLTcyLjk2NS05NC40Ni0xMzAuMTItMjE1LjA0LTEzMC4xMi0xMjAuNTcgMC0yMTUuMDQgNTcuMTYtMjE1LjA0IDEzMC4xMiAwIDI2LjkxOCAxMi45MzYgNTEuNjQzIDM1LjE5IDcyLjE3LTYuOTUxIDQuNTAyLTEzLjc1NiAxMC41MDItMTguODM2IDE4Ljk4NC0xMC40NTMgMTcuNDQ5LTEwLjY2IDM5LjA5LS42NDUgNjQuMzUgOS40MzMgMjMuNzkxIDcuMTI1IDMyLjU4MiA1LjY5MyAzNS4yNC0zLjM1NCA2LjMyMi0xOC4xMyA5LjUxNC0zMi4zODUgMTIuNTk2LTMuNDg2Ljc1OC03LjA0IDEuNTMxLTEwLjU4MiAyLjM3MS05LjQ4NCAyLjI0LTE1LjM1MyAxMS43MjUtMTMuMTMgMjEuMjMgMS45MDIgOC4xMTEgOS4xNjQgMTMuNTk2IDE3LjE2IDEzLjU5NiAxLjM0IDAgMi43MDktLjE2IDQuMDY4LS40NjcgMy4zMi0uNzkxIDYuNjU2LTEuNTE4IDkuOTMyLTIuMjI3IDIxLjExLTQuNTY0IDQ1LjAyLTkuNzQyIDU2LjA4LTMwLjQ4MiA4LjQ4Ni0xNS45MDIgNy4xOTUtMzYuNTE2LTQuMDMtNjQuODUtNS43MjUtMTQuNDM1LTYuMzg1LTI1LjU2NC0xLjk0Ny0zMy4xIDQuOTY1LTguNDUxIDE2LjE0LTEyLjIwNyAyMi4xOS0xMy40NjcgMzUuNzA1IDE5LjkwMiA4Mi44NSAzMi4zNTQgMTM1LjU5IDMzLjg2OWwtMTAuNTA0LTM1Ljc0Yy04Ny44Ny01Ljc1OC0xNTguNTYtNDYuNDUtMTU4LjU2LTk0LjA3LjAwMDEtNTEuNCA4Mi4zMi05NC44MyAxNzkuNzUtOTQuODMiLz48cGF0aCBkPSJtNDg3LjU3IDI2OS42M2wtMjIyLjA1LTY1LjI3Yy0xLjExNS0uMzM4LTIuMjQ0LS40ODItMy4zNzMtLjQ4Mi0zLjExMyAwLTYuMTU4IDEuMjI3LTguNDM0IDMuNS0zLjA5NiAzLjA4LTQuMjU4IDcuNjEzLTMuMDIgMTEuNzg5bDY1LjI3IDIyMi4xYzEuMzQgNC42MTMgNS4zNTIgNy45ODIgMTAuMTQzIDguNS40NTMuMDQ3Ljg5MS4wNjQgMS4zMjIuMDY0IDQuMzA5IDAgOC4zMDctMi4zMzggMTAuNDM5LTYuMTYybDU0LjA4LTk4LjA0IDk4LjAzLTU0LjA5YzQuMjI1LTIuMzIyIDYuNjI5LTYuOTUxIDYuMS0xMS43MjctLjUxNC00Ljc4Ny0zLjg3NC04LjgwNS04LjUwMi0xMC4xNzYiLz48L2c+PC9zdmc+Cg=="

/***/ }),
/* 60 */
/***/ (function(module, exports) {

module.exports = "PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48c3ZnIHdpZHRoPScxODhweCcgaGVpZ2h0PScxODhweCcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2aWV3Qm94PSIwIDAgMTAwIDEwMCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pZFlNaWQiIGNsYXNzPSJ1aWwtc3BpbiI+PHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjEwMCIgaGVpZ2h0PSIxMDAiIGZpbGw9Im5vbmUiIGNsYXNzPSJiayI+PC9yZWN0PjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDUwIDUwKSI+PGcgdHJhbnNmb3JtPSJyb3RhdGUoMCkgdHJhbnNsYXRlKDM0IDApIj48Y2lyY2xlIGN4PSIwIiBjeT0iMCIgcj0iOCIgZmlsbD0iI2NmZmZkZiI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0ib3BhY2l0eSIgZnJvbT0iMSIgdG89IjAuMSIgYmVnaW49IjBzIiBkdXI9IjFzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSI+PC9hbmltYXRlPjxhbmltYXRlVHJhbnNmb3JtIGF0dHJpYnV0ZU5hbWU9InRyYW5zZm9ybSIgdHlwZT0ic2NhbGUiIGZyb209IjEuNSIgdG89IjEiIGJlZ2luPSIwcyIgZHVyPSIxcyIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiPjwvYW5pbWF0ZVRyYW5zZm9ybT48L2NpcmNsZT48L2c+PGcgdHJhbnNmb3JtPSJyb3RhdGUoNDUpIHRyYW5zbGF0ZSgzNCAwKSI+PGNpcmNsZSBjeD0iMCIgY3k9IjAiIHI9IjgiIGZpbGw9IiNjZmZmZGYiPjxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9Im9wYWNpdHkiIGZyb209IjEiIHRvPSIwLjEiIGJlZ2luPSIwLjEycyIgZHVyPSIxcyIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiPjwvYW5pbWF0ZT48YW5pbWF0ZVRyYW5zZm9ybSBhdHRyaWJ1dGVOYW1lPSJ0cmFuc2Zvcm0iIHR5cGU9InNjYWxlIiBmcm9tPSIxLjUiIHRvPSIxIiBiZWdpbj0iMC4xMnMiIGR1cj0iMXMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIj48L2FuaW1hdGVUcmFuc2Zvcm0+PC9jaXJjbGU+PC9nPjxnIHRyYW5zZm9ybT0icm90YXRlKDkwKSB0cmFuc2xhdGUoMzQgMCkiPjxjaXJjbGUgY3g9IjAiIGN5PSIwIiByPSI4IiBmaWxsPSIjY2ZmZmRmIj48YW5pbWF0ZSBhdHRyaWJ1dGVOYW1lPSJvcGFjaXR5IiBmcm9tPSIxIiB0bz0iMC4xIiBiZWdpbj0iMC4yNXMiIGR1cj0iMXMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIj48L2FuaW1hdGU+PGFuaW1hdGVUcmFuc2Zvcm0gYXR0cmlidXRlTmFtZT0idHJhbnNmb3JtIiB0eXBlPSJzY2FsZSIgZnJvbT0iMS41IiB0bz0iMSIgYmVnaW49IjAuMjVzIiBkdXI9IjFzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSI+PC9hbmltYXRlVHJhbnNmb3JtPjwvY2lyY2xlPjwvZz48ZyB0cmFuc2Zvcm09InJvdGF0ZSgxMzUpIHRyYW5zbGF0ZSgzNCAwKSI+PGNpcmNsZSBjeD0iMCIgY3k9IjAiIHI9IjgiIGZpbGw9IiNjZmZmZGYiPjxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9Im9wYWNpdHkiIGZyb209IjEiIHRvPSIwLjEiIGJlZ2luPSIwLjM3cyIgZHVyPSIxcyIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiPjwvYW5pbWF0ZT48YW5pbWF0ZVRyYW5zZm9ybSBhdHRyaWJ1dGVOYW1lPSJ0cmFuc2Zvcm0iIHR5cGU9InNjYWxlIiBmcm9tPSIxLjUiIHRvPSIxIiBiZWdpbj0iMC4zN3MiIGR1cj0iMXMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIj48L2FuaW1hdGVUcmFuc2Zvcm0+PC9jaXJjbGU+PC9nPjxnIHRyYW5zZm9ybT0icm90YXRlKDE4MCkgdHJhbnNsYXRlKDM0IDApIj48Y2lyY2xlIGN4PSIwIiBjeT0iMCIgcj0iOCIgZmlsbD0iI2NmZmZkZiI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0ib3BhY2l0eSIgZnJvbT0iMSIgdG89IjAuMSIgYmVnaW49IjAuNXMiIGR1cj0iMXMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIj48L2FuaW1hdGU+PGFuaW1hdGVUcmFuc2Zvcm0gYXR0cmlidXRlTmFtZT0idHJhbnNmb3JtIiB0eXBlPSJzY2FsZSIgZnJvbT0iMS41IiB0bz0iMSIgYmVnaW49IjAuNXMiIGR1cj0iMXMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIj48L2FuaW1hdGVUcmFuc2Zvcm0+PC9jaXJjbGU+PC9nPjxnIHRyYW5zZm9ybT0icm90YXRlKDIyNSkgdHJhbnNsYXRlKDM0IDApIj48Y2lyY2xlIGN4PSIwIiBjeT0iMCIgcj0iOCIgZmlsbD0iI2NmZmZkZiI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0ib3BhY2l0eSIgZnJvbT0iMSIgdG89IjAuMSIgYmVnaW49IjAuNjJzIiBkdXI9IjFzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSI+PC9hbmltYXRlPjxhbmltYXRlVHJhbnNmb3JtIGF0dHJpYnV0ZU5hbWU9InRyYW5zZm9ybSIgdHlwZT0ic2NhbGUiIGZyb209IjEuNSIgdG89IjEiIGJlZ2luPSIwLjYycyIgZHVyPSIxcyIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiPjwvYW5pbWF0ZVRyYW5zZm9ybT48L2NpcmNsZT48L2c+PGcgdHJhbnNmb3JtPSJyb3RhdGUoMjcwKSB0cmFuc2xhdGUoMzQgMCkiPjxjaXJjbGUgY3g9IjAiIGN5PSIwIiByPSI4IiBmaWxsPSIjY2ZmZmRmIj48YW5pbWF0ZSBhdHRyaWJ1dGVOYW1lPSJvcGFjaXR5IiBmcm9tPSIxIiB0bz0iMC4xIiBiZWdpbj0iMC43NXMiIGR1cj0iMXMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIj48L2FuaW1hdGU+PGFuaW1hdGVUcmFuc2Zvcm0gYXR0cmlidXRlTmFtZT0idHJhbnNmb3JtIiB0eXBlPSJzY2FsZSIgZnJvbT0iMS41IiB0bz0iMSIgYmVnaW49IjAuNzVzIiBkdXI9IjFzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSI+PC9hbmltYXRlVHJhbnNmb3JtPjwvY2lyY2xlPjwvZz48ZyB0cmFuc2Zvcm09InJvdGF0ZSgzMTUpIHRyYW5zbGF0ZSgzNCAwKSI+PGNpcmNsZSBjeD0iMCIgY3k9IjAiIHI9IjgiIGZpbGw9IiNjZmZmZGYiPjxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9Im9wYWNpdHkiIGZyb209IjEiIHRvPSIwLjEiIGJlZ2luPSIwLjg3cyIgZHVyPSIxcyIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiPjwvYW5pbWF0ZT48YW5pbWF0ZVRyYW5zZm9ybSBhdHRyaWJ1dGVOYW1lPSJ0cmFuc2Zvcm0iIHR5cGU9InNjYWxlIiBmcm9tPSIxLjUiIHRvPSIxIiBiZWdpbj0iMC44N3MiIGR1cj0iMXMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIj48L2FuaW1hdGVUcmFuc2Zvcm0+PC9jaXJjbGU+PC9nPjwvZz48L3N2Zz4="

/***/ }),
/* 61 */
/***/ (function(module, exports) {

module.exports = "PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNMjEuMTQzIDkuNjY3Yy0uNzMzLTEuMzkyLTEuOTE0LTMuMDUtMy42MTctNC43NTMtMi45NzctMi45NzgtNS40NzgtMy45MTQtNi43ODUtMy45MTQtLjQxNCAwLS43MDguMDk0LS44Ni4yNDZsLTEuMzYxIDEuMzZjLTEuODk5LS4yMzYtMy40Mi4xMDYtNC4yOTQuOTgzLS44NzYuODc1LTEuMTY0IDIuMTU5LS43OTIgMy41MjMuNDkyIDEuODA2IDIuMzA1IDQuMDQ5IDUuOTA1IDUuMzc1LjAzOC4zMjMuMTU3LjYzOC40MDUuODg1LjU4OC41ODggMS41MzUuNTg2IDIuMTIxIDBzLjU4OC0xLjUzMy4wMDItMi4xMTljLS41ODgtLjU4Ny0xLjUzNy0uNTg4LTIuMTIzLS4wMDFsLS4xNy4yNTZjLTIuMDMxLS43NjUtMy4zOTUtMS44MjgtNC4yMzItMi45bDMuODc5LTMuODc1Yy40OTYgMi43MyA2LjQzMiA4LjY3NiA5LjE3OCA5LjE3OGwtNy4xMTUgNy4xMDdjLS4yMzQuMTUzLTIuNzk4LS4zMTYtNi4xNTYtMy42NzUtMy4zOTMtMy4zOTMtMy4xNzUtNS4yNzEtMy4wMjctNS40OThsMS44NTktMS44NTZjLS40MzktLjM1OS0uOTI1LTEuMTAzLTEuMTQxLTEuNjg5bC0yLjEzNCAyLjEzMWMtLjQ0NS40NDYtLjY4NSAxLjA2NC0uNjg1IDEuODIgMCAxLjYzNCAxLjEyMSAzLjkxNSAzLjcxMyA2LjUwNiAyLjc2NCAyLjc2NCA1LjU4IDQuMjQzIDcuNDMyIDQuMjQzLjY0OCAwIDEuMTgtLjE5NSAxLjU0Ny0uNTYybDguMDg2LTguMDc4Yy45MS44NzQtLjc3OCAzLjUzOC0uNzc4IDQuNjQ4IDAgMS4xMDQuODk2IDEuOTk5IDIgMS45OTkgMS4xMDUgMCAyLS44OTYgMi0yIDAtMy4xODQtMS40MjUtNi44MS0yLjg1Ny05LjM0em0tMTYuMjA5LTUuMzcxYy41MjctLjUzIDEuNDcxLS43OTEgMi42NTYtLjc2MWwtMy4yMDkgMy4yMDZjLS4yMzYtLjk3OC0uMDQ5LTEuODQ1LjU1My0yLjQ0NXptOS4yOTIgNC4wNzlsLS4wMy0uMDI5Yy0xLjI5Mi0xLjI5Mi0zLjgwMy00LjM1Ni0zLjA5Ni01LjA2My43MTUtLjcxNSAzLjQ4OCAxLjUyMSA1LjA2MiAzLjA5Ni44NjIuODYyIDIuMDg4IDIuMjQ3IDIuOTM3IDMuNDU4LTEuNzE3LTEuMDc0LTMuNDkxLTEuNDY5LTQuODczLTEuNDYyeiIvPjwvc3ZnPg=="

/***/ }),
/* 62 */
/***/ (function(module, exports) {

module.exports = "iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAANlAAADZQBELD/fAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAXPSURBVHic5dt/yF5lGQfwz7U555aatpEopk6yLba16IegDCk0C0kD2woJDZr9IbUg0zYi+yMSQvtFhhG1aOI/Of/QLLEgcggzzcpBc1CT2oqsXNhqsznbrv647xffPXuf7Xmec57z7p1fuDmcc+4f1/W9r3Of+1zXdSIzvRoQEfPxucz8/GHXXw0ERMRC/ARzM/Otk+/Nmh6RukNEXIgtuHiq+yc0ARHxNkX5i/rVOWEJiIgrsRln4Yl+9U5IAiLievwYp+Jb+Fi/uiccARGxDhsxR1n11+JQv/ondSXYuBERs/ANrMX/cGNmbjxWuxOCgIiYi3uxCvuwKjMfGaTtjCcgIs7Ag7gMz+OqzHxq0PYzmoCIOBePYCmexfsyc8cwfRyxCEbE4oh4bTsijg8RsRSPK8r/GpcOqzxTW8DVuDMi/oxt+F0t2/BMZr44stQtISIuU8z+DPxUeeb3jtRZZh5WcBr+hZyiHMQOPIDbcR2W4+TefsZVlIVuf5XnHswZoM2SWv/pI+71afDl2uAp3IwNym7qP32IeRnP4D58AR/EYsxuWfm1dRKyyhgDthuagLPxEg7g3EnXA4vwfqxXXj2/nTQjvWU/nq711td2iwYVvGfciUk5iLVDth+OgNpoQ230lQEGmF1n/NpqAfcpa8bLfYjZWy3q+9XCrsQ5ffqeU019gtDVI1hOXwL6+gMi4s1Vib14Q2bumbLiURARJ1dilmJZLUtxoam34S94ZeHdpjxW6ypBe/CBzNw8ghxLsB1bs8cfcCzmfqQwt77lZ3ke3o4bcAcexk5TW0viL1jeYLzhLaAytxKP4TlckJkHhmV/GETE6YqFTLaYebguM3c16Hc0C6jkPK6wt6ZNK+iyOIoFDPI5fEc93hIRMeosHK8YhIAH8XuFxavHK073OCYBmXkIX62nt45XnO4xqEfoHvwdKyPikjHK0zkGIiAz9+OuevrZ8YnTPYbxCd6tbIquiYg3jUmezjEwAZn5Ar5X29wyNok6xrBe4a8rDscbIuKsMcjTOYYioO7Gfoi5+NRYJOoYo8QF7qzHmyLi1DaFmQ4MTUBmbsXPcCZubF2ijjFqZGhie/zpiJjRnuWRCMjMn+M3OA8fblWijtEkNjixFszo7XETAjbhT1hRQ9EzEiMTkJkH8bV6OmO3x03D4xvwT1xeszFmHBoRkCVKdHc9nZFrQRsJEnfhv1gdERe00F+naExAZj6PHyixgZub9jcmLOp7pyWn4xuViM0+LDgOnKBzcAW+iT96xb0+eGRohEE31UFumyalX4ePKB9rexweV/iD4ta7dJwEXFwH+wfmdaT0RfgMHlU+0ydHsR9TXs9LjtpHywI9WgW4aUwKz8ZK5Vtke88s/xv3K9GmhQP32bKAV00yuVkt9XmakhOwEbt7lN6p5AG+14g5Cm0TEEpgM5WsjVH7OQ+fUPJ/Xpqk8CE8iduwohWZ2ySgCv/RKuwTQxL3TnxRySeYPMsv4iF8HGe3Lm+Lii/GGsVxOiH87VjWp/48JWHiO/hrj9LP4bu4BvPbVrpVAqri91fz7Bfe/iXeoiQur1HCbft66mzFl+rbZKgMkial0Q8TNT6wBQuUbJBf4RdKbtFyvBuX4BTl1TSrmjsl/WazkoPwUGbuHFmQJmg4+xML3r14TZ86c5Uc3omZ3oTVOL2rWR7LI6DsrxO7DGCySk5Q4orpVnpyafIxNBEY2ZWDPUfP1uOZDcZsHw0s4CQlofKgY8wq3qHEFQ/h/Ome9VYegarYJxWzPqCkvF2v5hXi9fgQvl2VHyjlbkYRUBW91ZGJkn8z9WvxXdOtcG9p5b/BiDhHcYa8R/ENzFd8hU8qi9/Cai3bMnNZ4wFbROs/TtZEqgWZubvn2g4lQfL8bJDy1jZa/2kqC3b3XlN2g7Ci7TGbYDr+GjtlGsbsi04IqP/1XF5Pt3cx5qDoygLWKRunLUoS9HGDrgjYo4TRVmXbq25D/B9PLfo3EMEZiwAAAABJRU5ErkJggg=="

/***/ }),
/* 63 */
/***/ (function(module, exports, __webpack_require__) {

/**
 * Font Selector - jQuery plugin 0.1
 *
 * Copyright (c) 2012 Chris Dyer
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following
 * conditions are met:
 *
 * Redistributions of source code must retain the above copyright notice, this list of conditions and the following
 * disclaimer. Redistributions in binary form must reproduce the above copyright notice, this list of conditions
 * and the following disclaimer in the documentation and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING,
 * BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO
 * EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;
 * OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 */



(function (factory) {
  if (true) {
    module.exports = factory(__webpack_require__(9));
  } else {
    factory(jQuery);
  }
}(
    function( $ ) {

  'use strict';
  //if(_ && _.styleSheetContains && !_.styleSheetContains('.fontSelect')){
  //  _.linkCSS(_.scriptURL() + "/../../css/jquery.fontSelector.css");
  //}

  var settings;

  var methods = {
    init : function(options) {

      settings = $.extend( {
        'hide_fallbacks' : false,
        'selected' : function(style) {},
        'opened' : function() {},
        'closed' : function() {},
        'initial' : '',
        'fonts' : []
      }, options);

      var root = this;
      var $root = $(this);
      root.selectedCallback = settings['selected'];
      root.openedCallback = settings['opened'];
      root.closedCallback = settings['closed'];
      var visible = false;
      var selected = false;
      var openedClass = 'fontSelectOpen';

      var displayName = function(font) {
        if (settings['hide_fallbacks']){
          var index = font.indexOf(',');
          if(index == -1 )return font;
          return font.substr(0, index);
        }else
          return font;
      }


      var select = function(font,initial) {
        root.find('span').html(displayName(font).replace(/["']{1}/gi,""));
        root.css('font-family', font);
        selected = font;

        if(!initial)root.selectedCallback(selected);
      }

      var positionUl = function() {
        var left, top;
        left = $(root).offset().left;
        top = $(root).offset().top + $(root).outerHeight();

        $(ul).css({
          'position': 'absolute',
          'left': left + 'px',
          'top': top + 'px',
          'width': $(root).outerWidth() + 'px'
        });
      }

      var closeUl = function() {
        ul.slideUp('fast', function() {
          visible = false;
        });

        $root.removeClass(openedClass);

        root.closedCallback();
      }

      var openUi = function() {
        ul.slideDown('fast', function() {
          visible = true;
        });

        $root.addClass(openedClass);

        root.openedCallback();
      }

      // Setup markup
      $root.prepend('<span>' + settings['initial'].replace(/'/g,'&#039;') + '</span>');
      var ul = $('<ul class="fontSelectUl"></ul>').appendTo('body');
      ul.hide();
      positionUl();

      for (var i = 0; i < settings['fonts'].length; i++) {
        var item = $('<li>' + displayName(settings['fonts'][i]) + '</li>').appendTo(ul);
        item.css('font-family', settings['fonts'][i]);
        item[0].data = settings['fonts'][i];
      }

      if (settings['initial'] != '')
        select(settings['initial'],true);

      ul.find('li').click(function() {

        if (!visible)
          return;

        positionUl();
        closeUl();

        select(this.data);
      });

      $root.click(function(event) {

        if (visible)
          return;

        event.stopPropagation();

        positionUl();
        openUi();
      });

      $('html').click(function() {
        if (visible)
        {
          closeUl();
        }
      })
    },
    selected : function() {
      return this.data;
    },
    select : function(font) {
      this.find('span').html(font.substr(0, font.indexOf(',')).replace(/["']{1}/gi,""));
      this.css('font-family', font);
      var selected = false;
      selected = font;
    }
  };
  $.fontSelector = {

  };

  $.fn.fontSelector = function(method) {
    if ( methods[method] ) {
      return methods[ method ].apply( this, Array.prototype.slice.call( arguments, 1 ));
    } else if ( typeof method === 'object' || ! method ) {
      return methods.init.apply( this, arguments );
    } else {
      $.error( 'Method ' +  method + ' does not exist on jQuery.fontSelector' );
    }
  }
}));


/***/ }),
/* 64 */
/***/ (function(module, exports, __webpack_require__) {

/*
 * jQuery MiniColors: A tiny color picker built on jQuery
 *
 * Copyright: Cory LaViska for A Beautiful Site, LLC: http://www.abeautifulsite.net/
 *
 * Contribute: https://github.com/claviska/jquery-minicolors
 *
 * @license: http://opensource.org/licenses/MIT
 *
 */



(function (factory) {
  if (true) {
    module.exports = factory(__webpack_require__(9));
  } else {
    factory(jQuery);
  }
}(
  function ($) {

    'use strict';
    //if(_ && _.styleSheetContains && !_.styleSheetContains('.minicolors')){
    //  _.linkCSS(_.scriptURL() + "/../../css/jquery.minicolors.css");
    //}

    // Defaults
    $.minicolors = {
      defaults: {
        animationSpeed: 50,
        animationEasing: 'swing',
        change: null,
        changeDelay: 0,
        control: 'hue',
        dataUris: true,
        defaultValue: '',
        format: 'hex',
        hide: null,
        hideSpeed: 100,
        inline: false,
        keywords: '',
        letterCase: 'lowercase',
        opacity: false,
        position: 'bottom left',
        show: null,
        showSpeed: 100,
        theme: 'default',
        swatches: []
      }
    };

    // Public methods
    $.extend($.fn, {
      minicolors: function(method, data) {

        switch(method) {

          // Destroy the control
          case 'destroy':
            $(this).each( function() {
              destroy($(this));
            });
            return $(this);

          // Hide the color picker
          case 'hide':
            hide();
            return $(this);

          // Get/set opacity
          case 'opacity':
            // Getter
            if( data === undefined ) {
              // Getter
              return $(this).attr('data-opacity');
            } else {
              // Setter
              $(this).each( function() {
                updateFromInput($(this).attr('data-opacity', data));
              });
            }
            return $(this);

          // Get an RGB(A) object based on the current color/opacity
          case 'rgbObject':
            return rgbObject($(this), method === 'rgbaObject');

          // Get an RGB(A) string based on the current color/opacity
          case 'rgbString':
          case 'rgbaString':
            return rgbString($(this), method === 'rgbaString');

          // Get/set settings on the fly
          case 'settings':
            if( data === undefined ) {
              return $(this).data('minicolors-settings');
            } else {
              // Setter
              $(this).each( function() {
                var settings = $(this).data('minicolors-settings') || {};
                destroy($(this));
                $(this).minicolors($.extend(true, settings, data));
              });
            }
            return $(this);

          // Show the color picker
          case 'show':
            show( $(this).eq(0) );
            return $(this);

          // Get/set the hex color value
          case 'value':
            if( data === undefined ) {
              // Getter
              return $(this).val();
            } else {
              // Setter
              $(this).each( function() {
                if( typeof(data) === 'object' ) {
                  if( data.opacity ) {
                    $(this).attr('data-opacity', keepWithin(data.opacity, 0, 1));
                  }
                  if( data.color ) {
                    $(this).val(data.color);
                  }
                } else {
                  $(this).val(data);
                }
                updateFromInput($(this));
              });
            }
            return $(this);

          // Initializes the control
          default:
            if( method !== 'create' ) data = method;
            $(this).each( function() {
              init($(this), data);
            });
            return $(this);

        }

      }
    });

    var inputText, globalSettings, globalTarget , globalInput ;
    // Initialize input elements
    function init(input, settings) {

      var minicolors = $('<div class="minicolors" />'),
        defaults = $.minicolors.defaults,
        size,
        swatches,
        textPanel,
        swatch,
        panel,
        globalTarget = input,
        i;

      // Do nothing if already initialized
      if( input.data('minicolors-initialized') ) return;

      // Handle settings
      globalSettings = settings = $.extend(true, {}, defaults, settings);

      // The wrapper
      minicolors
        .addClass('minicolors-theme-' + settings.theme)
        .toggleClass('minicolors-with-opacity', settings.opacity)
        .toggleClass('minicolors-no-data-uris', settings.dataUris !== true);

      // Custom positioning
      if( settings.position !== undefined ) {
        $.each(settings.position.split(' '), function() {
          minicolors.addClass('minicolors-position-' + this);
        });
      }

      // Input size
      if( settings.format === 'rgb' ) {
        size = settings.opacity ? '25' : '20';
      } else {
        size = settings.keywords ? '11' : '7';
      }
       globalInput = input;
      // The input
      input
        .addClass('minicolors-input')
        .data('minicolors-initialized', false)
        .data('minicolors-settings', settings)
        .prop('size', size)
        .wrap(minicolors)
        .after(
        '<div class="minicolors-panel minicolors-slider-' + settings.control + '">' +
        '<div class="minicolors-slider minicolors-sprite">' +
        '<div class="minicolors-picker"></div>' +
        '</div>' +
        '<div class="minicolors-opacity-slider minicolors-sprite">' +
        '<div class="minicolors-picker"></div>' +
        '</div>' +
        '<div class="minicolors-grid minicolors-sprite">' +
        '<div class="minicolors-grid-inner"></div>' +
        '<div class="minicolors-picker"><div></div></div>' +
        '</div>' +
        '</div>'
      );

      // The swatch
      if( !settings.inline ) {
        input.after('<span class="minicolors-swatch minicolors-sprite minicolors-input-swatch"><span class="minicolors-swatch-color"></span></span>');
        input.next('.minicolors-input-swatch').on('click', function(event) {
          event.preventDefault();
          input.focus();
        });
      }

      // Prevent text selection in IE
      panel = input.parent().find('.minicolors-panel');
      panel.on('selectstart', function() { return false; }).end();

      // Swatches
      if (settings.swatches && settings.swatches.length !== 0) {
        if (settings.swatches.length > 7) {
          settings.swatches.length = 7;
        }
        panel.addClass('minicolors-with-swatches');
        swatches = $('<ul class="minicolors-swatches"></ul>')
          .appendTo(panel);
        for(i = 0; i < settings.swatches.length; ++i) {
          swatch = settings.swatches[i];
          swatch = isRgb(swatch) ? parseRgb(swatch, true) : hex2rgb(parseHex(swatch, true));
          $('<li class="minicolors-swatch minicolors-sprite"><span class="minicolors-swatch-color"></span></li>')
            .appendTo(swatches)
            .data('swatch-color', settings.swatches[i])
            .find('.minicolors-swatch-color')
            .css({
              backgroundColor: rgb2hex(swatch),
              opacity: swatch.a
            });
          settings.swatches[i] = swatch;
        }

      }


      // Swatches
      if (settings.text) {
        panel.addClass('minicolors-with-text');
        textPanel = $('<div class="minicolors-text"></div>')
          .appendTo(panel);
        inputText = $('<input type="text">')
          .appendTo(textPanel);

        $(inputText).change(function(){
          input.val(inputText.val());
          updateFromInput(input, true);
        })

      }

      // Inline controls
      if( settings.inline ) input.parent().addClass('minicolors-inline');

      updateFromInput(input, false);

      input.data('minicolors-initialized', true);

    }

    // Returns the input back to its original state
    function destroy(input) {

      var minicolors = input.parent();

      // Revert the input element
      input
        .removeData('minicolors-initialized')
        .removeData('minicolors-settings')
        .removeProp('size')
        .removeClass('minicolors-input');

      // Remove the wrap and destroy whatever remains
      minicolors.before(input).remove();

    }

    // Shows the specified dropdown panel
    function show(input) {

      var minicolors = input.parent(),
        panel = minicolors.find('.minicolors-panel'),
        settings = input.data('minicolors-settings');

      // Do nothing if uninitialized, disabled, inline, or already open
      if( !input.data('minicolors-initialized') ||
        input.prop('disabled') ||
        minicolors.hasClass('minicolors-inline') ||
        minicolors.hasClass('minicolors-focus')
      ) return;

      hide();

      minicolors.addClass('minicolors-focus');
      panel
        .stop(true, true)
        .fadeIn(settings.showSpeed, function() {
          if( settings.show ) settings.show.call(input.get(0));
        });

    }

    // Hides all dropdown panels
    function hide() {

      $('.minicolors-focus').each( function() {

        var minicolors = $(this),
          input = minicolors.find('.minicolors-input'),
          panel = minicolors.find('.minicolors-panel'),
          settings = input.data('minicolors-settings');

        panel.fadeOut(settings.hideSpeed, function() {
          if( settings.hide ) settings.hide.call(input.get(0));
          minicolors.removeClass('minicolors-focus');
        });

      });
    }

    // Moves the selected picker
    function move(target, event, animate) {

      var input =  target.parents('.minicolors').find('.minicolors-input'),
        settings = input.data('minicolors-settings'),
        picker = target.find('[class$=-picker]'),
        offsetX = target.offset().left,
        offsetY = target.offset().top,
        x = Math.round(event.pageX - offsetX),
        y = Math.round(event.pageY - offsetY),
        duration = animate ? settings.animationSpeed : 0,
        wx, wy, r, phi;

      // Touch support
      if( event.originalEvent.changedTouches ) {
        x = event.originalEvent.changedTouches[0].pageX - offsetX;
        y = event.originalEvent.changedTouches[0].pageY - offsetY;
      }

      // Constrain picker to its container
      if( x < 0 ) x = 0;
      if( y < 0 ) y = 0;
      if( x > target.width() ) x = target.width();
      if( y > target.height() ) y = target.height();

      // Constrain color wheel values to the wheel
      if( target.parent().is('.minicolors-slider-wheel') && picker.parent().is('.minicolors-grid') ) {
        wx = 75 - x;
        wy = 75 - y;
        r = Math.sqrt(wx * wx + wy * wy);
        phi = Math.atan2(wy, wx);
        if( phi < 0 ) phi += Math.PI * 2;
        if( r > 75 ) {
          r = 75;
          x = 75 - (75 * Math.cos(phi));
          y = 75 - (75 * Math.sin(phi));
        }
        x = Math.round(x);
        y = Math.round(y);
      }

      // Move the picker
      if( target.is('.minicolors-grid') ) {
        picker
          .stop(true)
          .animate({
            top: y + 'px',
            left: x + 'px'
          }, duration, settings.animationEasing, function() {
            updateFromControl(input, target);
          });
      } else {
        picker
          .stop(true)
          .animate({
            top: y + 'px'
          }, duration, settings.animationEasing, function() {
            updateFromControl(input, target);
          });
      }

    }

    // Sets the input based on the color picker values
    function updateFromControl(input, target) {

      function getCoords(picker, container) {

        var left, top;
        if( !picker.length || !container ) return null;
        left = picker.offset().left;
        top = picker.offset().top;

        return {
          x: left - container.offset().left + (picker.outerWidth() / 2),
          y: top - container.offset().top + (picker.outerHeight() / 2)
        };

      }

      var hue, saturation, brightness, x, y, r, phi,

        hex = input.val(),
        opacity = input.attr('data-opacity'),

      // Helpful references
        minicolors = input.parent(),
        settings = input.data('minicolors-settings'),
        swatch = minicolors.find('.minicolors-input-swatch'),

      // Panel objects
        grid = minicolors.find('.minicolors-grid'),
        slider = minicolors.find('.minicolors-slider'),
        opacitySlider = minicolors.find('.minicolors-opacity-slider'),

      // Picker objects
        gridPicker = grid.find('[class$=-picker]'),
        sliderPicker = slider.find('[class$=-picker]'),
        opacityPicker = opacitySlider.find('[class$=-picker]'),

      // Picker positions
        gridPos = getCoords(gridPicker, grid),
        sliderPos = getCoords(sliderPicker, slider),
        opacityPos = getCoords(opacityPicker, opacitySlider);

      // Handle colors
      if( target.is('.minicolors-grid, .minicolors-slider, .minicolors-opacity-slider') ) {

        // Determine HSB values
        switch(settings.control) {

          case 'wheel':
            // Calculate hue, saturation, and brightness
            x = (grid.width() / 2) - gridPos.x;
            y = (grid.height() / 2) - gridPos.y;
            r = Math.sqrt(x * x + y * y);
            phi = Math.atan2(y, x);
            if( phi < 0 ) phi += Math.PI * 2;
            if( r > 75 ) {
              r = 75;
              gridPos.x = 69 - (75 * Math.cos(phi));
              gridPos.y = 69 - (75 * Math.sin(phi));
            }
            saturation = keepWithin(r / 0.75, 0, 100);
            hue = keepWithin(phi * 180 / Math.PI, 0, 360);
            brightness = keepWithin(100 - Math.floor(sliderPos.y * (100 / slider.height())), 0, 100);
            hex = hsb2hex({
              h: hue,
              s: saturation,
              b: brightness
            });

            // Update UI
            slider.css('backgroundColor', hsb2hex({ h: hue, s: saturation, b: 100 }));
            break;

          case 'saturation':
            // Calculate hue, saturation, and brightness
            hue = keepWithin(parseInt(gridPos.x * (360 / grid.width()), 10), 0, 360);
            saturation = keepWithin(100 - Math.floor(sliderPos.y * (100 / slider.height())), 0, 100);
            brightness = keepWithin(100 - Math.floor(gridPos.y * (100 / grid.height())), 0, 100);
            hex = hsb2hex({
              h: hue,
              s: saturation,
              b: brightness
            });

            // Update UI
            slider.css('backgroundColor', hsb2hex({ h: hue, s: 100, b: brightness }));
            minicolors.find('.minicolors-grid-inner').css('opacity', saturation / 100);
            break;

          case 'brightness':
            // Calculate hue, saturation, and brightness
            hue = keepWithin(parseInt(gridPos.x * (360 / grid.width()), 10), 0, 360);
            saturation = keepWithin(100 - Math.floor(gridPos.y * (100 / grid.height())), 0, 100);
            brightness = keepWithin(100 - Math.floor(sliderPos.y * (100 / slider.height())), 0, 100);
            hex = hsb2hex({
              h: hue,
              s: saturation,
              b: brightness
            });

            // Update UI
            slider.css('backgroundColor', hsb2hex({ h: hue, s: saturation, b: 100 }));
            minicolors.find('.minicolors-grid-inner').css('opacity', 1 - (brightness / 100));
            break;

          default:
            // Calculate hue, saturation, and brightness
            hue = keepWithin(360 - parseInt(sliderPos.y * (360 / slider.height()), 10), 0, 360);
            saturation = keepWithin(Math.floor(gridPos.x * (100 / grid.width())), 0, 100);
            brightness = keepWithin(100 - Math.floor(gridPos.y * (100 / grid.height())), 0, 100);
            hex = hsb2hex({
              h: hue,
              s: saturation,
              b: brightness
            });

            // Update UI
            grid.css('backgroundColor', hsb2hex({ h: hue, s: 100, b: 100 }));
            break;

        }

        // Handle opacity
        if( settings.opacity ) {
          opacity = parseFloat(1 - (opacityPos.y / opacitySlider.height())).toFixed(2);
        } else {
          opacity = 1;
        }

        updateInput(input, hex, opacity);
      }
      else {
        // Set swatch color
        swatch.find('span').css({
          backgroundColor: hex,
          opacity: opacity
        });

        // Handle change event
        doChange(input, hex, opacity);
      }
    }

    // Sets the value of the input and does the appropriate conversions
    // to respect settings, also updates the swatch
    function updateInput(input, value, opacity) {
      var rgb,

      // Helpful references
        minicolors = input.parent(),
        settings = input.data('minicolors-settings'),
        swatch = minicolors.find('.minicolors-input-swatch');

      if( settings.opacity ) input.attr('data-opacity', opacity);

      // Set color string
      if( settings.format === 'rgb' ) {
        // Returns RGB(A) string

        // Checks for input format and does the conversion
        if ( isRgb(value) ) {
          rgb = parseRgb(value, true);
        }
        else {
          rgb = hex2rgb(parseHex(value, true));
        }


        opacity = input.attr('data-opacity') === '' ? 1 : keepWithin( parseFloat( input.attr('data-opacity') ).toFixed(2), 0, 1 );
        if( isNaN( opacity ) || !settings.opacity ) opacity = 1;

        if( input.minicolors('rgbObject').a <= 1 && rgb && settings.opacity) {
          // Set RGBA string if alpha
          value = 'rgba(' + rgb.r + ', ' + rgb.g + ', ' + rgb.b + ', ' + parseFloat( opacity ) + ')';
        } else {
          // Set RGB string (alpha = 1)
          value = 'rgb(' + rgb.r + ', ' + rgb.g + ', ' + rgb.b + ')';
        }
      } else {
        // Returns hex color

        // Checks for input format and does the conversion
        if ( isRgb(value) ) {
          value = rgbString2hex(value);
        }

        value = convertCase( value, settings.letterCase );
      }




      // Update value from picker
      //globalInput.val( value );
      input.val( value );

      if(inputText){
        inputText.val(value);
      }


      // Set swatch color
      swatch.find('span').css({
        backgroundColor: value,
        opacity: opacity
      });

      // Handle change event
      doChange(input, value, opacity);
    }

    // Sets the color picker values from the input
    function updateFromInput(input, preserveInputValue) {
     var  settings = globalSettings;
      var hex,
        hsb,
        opacity,
        keywords,
        alpha,
        value,
        x, y, r, phi,

      // Helpful references
        minicolors = input.parent(),
      //  settings = input.data('minicolors-settings'),
        swatch = minicolors.find('.minicolors-input-swatch'),

      // Panel objects
        grid = minicolors.find('.minicolors-grid'),
        slider = minicolors.find('.minicolors-slider'),
        opacitySlider = minicolors.find('.minicolors-opacity-slider'),

      // Picker objects
        gridPicker = grid.find('[class$=-picker]'),
        sliderPicker = slider.find('[class$=-picker]'),
        opacityPicker = opacitySlider.find('[class$=-picker]');

      // Determine hex/HSB values
      if( isRgb(input.val()) ) {
        // If input value is a rgb(a) string, convert it to hex color and update opacity
        hex = rgbString2hex(input.val());
        alpha = keepWithin(parseFloat(getAlpha(input.val())).toFixed(2), 0, 1);
        if( alpha ) {
          input.attr('data-opacity', alpha);
        }
      } else {
        hex = convertCase(parseHex(input.val(), true), settings.letterCase);
      }

      if( !hex ){
        hex = convertCase(parseInput(settings.defaultValue, true), settings.letterCase);
      }
      hsb = hex2hsb(hex);

      // Get array of lowercase keywords
      keywords = !settings.keywords ? [] : $.map(settings.keywords.split(','), function(a) {
        return $.trim(a.toLowerCase());
      });

      // Set color string
      if( input.val() !== '' && $.inArray(input.val().toLowerCase(), keywords) > -1 ) {
        value = convertCase(input.val());
      } else {
        value = isRgb(input.val()) ? parseRgb(input.val()) : hex;
      }

      // Update input value
      if( !preserveInputValue ){
        globalInput.val(value);

        inputText && inputText.val(value);
      }
      globalSettings = settings
      // Determine opacity value
      if( settings.opacity ) {
        // Get from data-opacity attribute and keep within 0-1 range
        opacity = input.attr('data-opacity') === '' ? 1 : keepWithin(parseFloat(input.attr('data-opacity')).toFixed(2), 0, 1);
        if( isNaN(opacity) ) opacity = 1;
        input.attr('data-opacity', opacity);
        swatch.find('span').css('opacity', opacity);

        // Set opacity picker position
        y = keepWithin(opacitySlider.height() - (opacitySlider.height() * opacity), 0, opacitySlider.height());
        opacityPicker.css('top', y + 'px');
      }

      // Set opacity to zero if input value is transparent
      if( input.val().toLowerCase() === 'transparent' ) {
        swatch.find('span').css('opacity', 0);
      }

      // Update swatch
      swatch.find('span').css('backgroundColor', hex);

      // Determine picker locations
      switch(settings.control) {

        case 'wheel':
          // Set grid position
          r = keepWithin(Math.ceil(hsb.s * 0.75), 0, grid.height() / 2);
          phi = hsb.h * Math.PI / 180;
          x = keepWithin(75 - Math.cos(phi) * r, 0, grid.width());
          y = keepWithin(75 - Math.sin(phi) * r, 0, grid.height());
          gridPicker.css({
            top: y + 'px',
            left: x + 'px'
          });

          // Set slider position
          y = 150 - (hsb.b / (100 / grid.height()));
          if( hex === '' ) y = 0;
          sliderPicker.css('top', y + 'px');

          // Update panel color
          slider.css('backgroundColor', hsb2hex({ h: hsb.h, s: hsb.s, b: 100 }));
          break;

        case 'saturation':
          // Set grid position
          x = keepWithin((5 * hsb.h) / 12, 0, 150);
          y = keepWithin(grid.height() - Math.ceil(hsb.b / (100 / grid.height())), 0, grid.height());
          gridPicker.css({
            top: y + 'px',
            left: x + 'px'
          });

          // Set slider position
          y = keepWithin(slider.height() - (hsb.s * (slider.height() / 100)), 0, slider.height());
          sliderPicker.css('top', y + 'px');

          // Update UI
          slider.css('backgroundColor', hsb2hex({ h: hsb.h, s: 100, b: hsb.b }));
          minicolors.find('.minicolors-grid-inner').css('opacity', hsb.s / 100);
          break;

        case 'brightness':
          // Set grid position
          x = keepWithin((5 * hsb.h) / 12, 0, 150);
          y = keepWithin(grid.height() - Math.ceil(hsb.s / (100 / grid.height())), 0, grid.height());
          gridPicker.css({
            top: y + 'px',
            left: x + 'px'
          });

          // Set slider position
          y = keepWithin(slider.height() - (hsb.b * (slider.height() / 100)), 0, slider.height());
          sliderPicker.css('top', y + 'px');

          // Update UI
          slider.css('backgroundColor', hsb2hex({ h: hsb.h, s: hsb.s, b: 100 }));
          minicolors.find('.minicolors-grid-inner').css('opacity', 1 - (hsb.b / 100));
          break;

        default:
          // Set grid position
          x = keepWithin(Math.ceil(hsb.s / (100 / grid.width())), 0, grid.width());
          y = keepWithin(grid.height() - Math.ceil(hsb.b / (100 / grid.height())), 0, grid.height());
          gridPicker.css({
            top: y + 'px',
            left: x + 'px'
          });

          // Set slider position
          y = keepWithin(slider.height() - (hsb.h / (360 / slider.height())), 0, slider.height());
          sliderPicker.css('top', y + 'px');

          // Update panel color
          grid.css('backgroundColor', hsb2hex({ h: hsb.h, s: 100, b: 100 }));
          break;

      }

      // Fire change event, but only if minicolors is fully initialized
      if( input.data('minicolors-initialized') ) {
        doChange(input, value, opacity);
      }

    }

    // Runs the change and changeDelay callbacks
    function doChange(input, value, opacity) {

      var settings = input.data('minicolors-settings'),
        lastChange = input.data('minicolors-lastChange'),
        obj,
        sel,
        i;

      // Only run if it actually changed
      if( !lastChange || lastChange.value !== value || lastChange.opacity !== opacity ) {

        // Remember last-changed value
        input.data('minicolors-lastChange', {
          value: value,
          opacity: opacity
        });

        // Check and select applicable swatch
        if (settings.swatches && settings.swatches.length !== 0) {
          if(!isRgb(value)) {
            obj = hex2rgb(value);
          }
          else {
            obj = parseRgb(value, true);
          }
          sel = -1;
          for(i = 0; i < settings.swatches.length; ++i) {
            if (obj.r === settings.swatches[i].r && obj.g === settings.swatches[i].g && obj.b === settings.swatches[i].b && obj.a === settings.swatches[i].a) {
              sel = i;
              break;
            }
          }

          input.parent().find('.minicolors-swatches .minicolors-swatch').removeClass('selected');
          if (i !== -1) {
            input.parent().find('.minicolors-swatches .minicolors-swatch').eq(i).addClass('selected');
          }
        }

        // Fire change event
        if( settings.change ) {
          if( settings.changeDelay ) {
            // Call after a delay
            clearTimeout(input.data('minicolors-changeTimeout'));
            input.data('minicolors-changeTimeout', setTimeout( function() {
              settings.change.call(input.get(0), value, opacity);
            }, settings.changeDelay));
          } else {
            // Call immediately
            settings.change.call(input.get(0), value, opacity);
          }
        }
        input.trigger('change').trigger('input');
      }

    }

    // Generates an RGB(A) object based on the input's value
    function rgbObject(input) {
      var hex = parseHex($(input).val(), true),
        rgb = hex2rgb(hex),
        opacity = $(input).attr('data-opacity');
      if( !rgb ) return null;
      if( opacity !== undefined ) $.extend(rgb, { a: parseFloat(opacity) });
      return rgb;
    }

    // Generates an RGB(A) string based on the input's value
    function rgbString(input, alpha) {
      var hex = parseHex($(input).val(), true),
        rgb = hex2rgb(hex),
        opacity = $(input).attr('data-opacity');
      if( !rgb ) return null;
      if( opacity === undefined ) opacity = 1;
      if( alpha ) {
        return 'rgba(' + rgb.r + ', ' + rgb.g + ', ' + rgb.b + ', ' + parseFloat(opacity) + ')';
      } else {
        return 'rgb(' + rgb.r + ', ' + rgb.g + ', ' + rgb.b + ')';
      }
    }

    // Converts to the letter case specified in settings
    function convertCase(string, letterCase) {
      return letterCase === 'uppercase' ? string.toUpperCase() : string.toLowerCase();
    }

    // Parses a string and returns a valid hex string when possible
    function parseHex(string, expand) {
      string = string.replace(/^#/g, '');
      if( !string.match(/^[A-F0-9]{3,6}/ig) ) return '';
      if( string.length !== 3 && string.length !== 6 ) return '';
      if( string.length === 3 && expand ) {
        string = string[0] + string[0] + string[1] + string[1] + string[2] + string[2];
      }
      return '#' + string;
    }

    // Parses a string and returns a valid RGB(A) string when possible
    function parseRgb(string, obj) {

      var values = string.replace(/[^\d,.]/g, ''),
        rgba = values.split(',');

      rgba[0] = keepWithin(parseInt(rgba[0], 10), 0, 255);
      rgba[1] = keepWithin(parseInt(rgba[1], 10), 0, 255);
      rgba[2] = keepWithin(parseInt(rgba[2], 10), 0, 255);
      if( rgba[3] ) {
        rgba[3] = keepWithin(parseFloat(rgba[3], 10), 0, 1);
      }

      // Return RGBA object
      if( obj ) {
        return {
          r: rgba[0],
          g: rgba[1],
          b: rgba[2],
          a: rgba[3] ? rgba[3] : null
        };
      }

      // Return RGBA string
      if( typeof(rgba[3]) !== 'undefined' && rgba[3] <= 1 ) {
        return 'rgba(' + rgba[0] + ', ' + rgba[1] + ', ' + rgba[2] + ', ' + rgba[3] + ')';
      } else {
        return 'rgb(' + rgba[0] + ', ' + rgba[1] + ', ' + rgba[2] + ')';
      }

    }

    // Parses a string and returns a valid color string when possible
    function parseInput(string, expand) {
      if( isRgb(string) ) {
        // Returns a valid rgb(a) string
        return parseRgb(string);
      } else {
        return parseHex(string, expand);
      }
    }

    // Keeps value within min and max
    function keepWithin(value, min, max) {
      if( value < min ) value = min;
      if( value > max ) value = max;
      return value;
    }

    // Checks if a string is a valid RGB(A) string
    function isRgb(string) {
      var rgb = string.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);
      return (rgb && rgb.length === 4) ? true : false;
    }

    // Function to get alpha from a RGB(A) string
    function getAlpha(rgba) {
      rgba = rgba.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+(\.\d{1,2})?|\.\d{1,2})[\s+]?/i);
      return (rgba && rgba.length === 6) ? rgba[4] : '1';
    }

    // Converts an HSB object to an RGB object
    function hsb2rgb(hsb) {
      var rgb = {};
      var h = Math.round(hsb.h);
      var s = Math.round(hsb.s * 255 / 100);
      var v = Math.round(hsb.b * 255 / 100);
      if(s === 0) {
        rgb.r = rgb.g = rgb.b = v;
      } else {
        var t1 = v;
        var t2 = (255 - s) * v / 255;
        var t3 = (t1 - t2) * (h % 60) / 60;
        if( h === 360 ) h = 0;
        if( h < 60 ) { rgb.r = t1; rgb.b = t2; rgb.g = t2 + t3; }
        else if( h < 120 ) {rgb.g = t1; rgb.b = t2; rgb.r = t1 - t3; }
        else if( h < 180 ) {rgb.g = t1; rgb.r = t2; rgb.b = t2 + t3; }
        else if( h < 240 ) {rgb.b = t1; rgb.r = t2; rgb.g = t1 - t3; }
        else if( h < 300 ) {rgb.b = t1; rgb.g = t2; rgb.r = t2 + t3; }
        else if( h < 360 ) {rgb.r = t1; rgb.g = t2; rgb.b = t1 - t3; }
        else { rgb.r = 0; rgb.g = 0; rgb.b = 0; }
      }
      return {
        r: Math.round(rgb.r),
        g: Math.round(rgb.g),
        b: Math.round(rgb.b)
      };
    }

    // Converts an RGB string to a hex string
    function rgbString2hex(rgb){
      rgb = rgb.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);
      return (rgb && rgb.length === 4) ? '#' +
      ('0' + parseInt(rgb[1],10).toString(16)).slice(-2) +
      ('0' + parseInt(rgb[2],10).toString(16)).slice(-2) +
      ('0' + parseInt(rgb[3],10).toString(16)).slice(-2) : '';
    }

    // Converts an RGB object to a hex string
    function rgb2hex(rgb) {
      var hex = [
        rgb.r.toString(16),
        rgb.g.toString(16),
        rgb.b.toString(16)
      ];
      $.each(hex, function(nr, val) {
        if (val.length === 1) hex[nr] = '0' + val;
      });
      return '#' + hex.join('');
    }

    // Converts an HSB object to a hex string
    function hsb2hex(hsb) {
      return rgb2hex(hsb2rgb(hsb));
    }

    // Converts a hex string to an HSB object
    function hex2hsb(hex) {
      var hsb = rgb2hsb(hex2rgb(hex));
      if( hsb.s === 0 ) hsb.h = 360;
      return hsb;
    }

    // Converts an RGB object to an HSB object
    function rgb2hsb(rgb) {
      var hsb = { h: 0, s: 0, b: 0 };
      var min = Math.min(rgb.r, rgb.g, rgb.b);
      var max = Math.max(rgb.r, rgb.g, rgb.b);
      var delta = max - min;
      hsb.b = max;
      hsb.s = max !== 0 ? 255 * delta / max : 0;
      if( hsb.s !== 0 ) {
        if( rgb.r === max ) {
          hsb.h = (rgb.g - rgb.b) / delta;
        } else if( rgb.g === max ) {
          hsb.h = 2 + (rgb.b - rgb.r) / delta;
        } else {
          hsb.h = 4 + (rgb.r - rgb.g) / delta;
        }
      } else {
        hsb.h = -1;
      }
      hsb.h *= 60;
      if( hsb.h < 0 ) {
        hsb.h += 360;
      }
      hsb.s *= 100/255;
      hsb.b *= 100/255;
      return hsb;
    }

    // Converts a hex string to an RGB object
    function hex2rgb(hex) {
      hex = parseInt(((hex.indexOf('#') > -1) ? hex.substring(1) : hex), 16);
      return {
        /* jshint ignore:start */
        r: hex >> 16,
        g: (hex & 0x00FF00) >> 8,
        b: (hex & 0x0000FF)
        /* jshint ignore:end */
      };
    }

    // Handle events
    $(document)
      // Hide on clicks outside of the control
      .on('mousedown.minicolors touchstart.minicolors', function(event) {
        if( !$(event.target).parents().add(event.target).hasClass('minicolors') ) {
          hide();
        }
      })
      // Start moving
      .on('mousedown.minicolors touchstart.minicolors', '.minicolors-grid, .minicolors-slider, .minicolors-opacity-slider', function(event) {
        var target = $(this);
        event.preventDefault();
        $(document).data('minicolors-target', target);
        move(target, event, true);
      })
      // Move pickers
      .on('mousemove.minicolors touchmove.minicolors', function(event) {
        var target = $(document).data('minicolors-target');
        if( target ) move(target, event);
      })
      // Stop moving
      .on('mouseup.minicolors touchend.minicolors', function() {
        $(this).removeData('minicolors-target');
      })
      // Selected a swatch
      .on('click.minicolors', '.minicolors-swatches li', function(event) {
        event.preventDefault();
        var target = $(this), input = target.parents('.minicolors').find('.minicolors-input'), color = target.data('swatch-color');
        updateInput(input, color, getAlpha(color));
        updateFromInput(input);
      })
      // Show panel when swatch is clicked
      .on('mousedown.minicolors touchstart.minicolors', '.minicolors-input-swatch', function(event) {
        var input = $(this).parent().find('.minicolors-input');
        event.preventDefault();
        if( input.parent().find('.minicolors-panel').css("display") !== "none"){
          //todo
          //hide();
        }else{
          show(input);
        }
      })
      // Show on focus
      .on('focus.minicolors', '.minicolors-input', function() {
        var input = $(this);
        if( !input.data('minicolors-initialized') ) return;
        show(input);
      })
      // Update value on blur
      .on('blur.minicolors', '.minicolors-input', function() {
        var input = $(this),
          settings = input.data('minicolors-settings'),
          keywords,
          hex,
          rgba,
          swatchOpacity,
          value;

        if( !input.data('minicolors-initialized') ) return;

        // Get array of lowercase keywords
        keywords = !settings.keywords ? [] : $.map(settings.keywords.split(','), function(a) {
          return $.trim(a.toLowerCase());
        });

        // Set color string
        if( input.val() !== '' && $.inArray(input.val().toLowerCase(), keywords) > -1 ) {
          value = input.val();
        } else {
          // Get RGBA values for easy conversion
          if( isRgb(input.val()) ) {
            rgba = parseRgb(input.val(), true);
          } else {
            hex = parseHex(input.val(), true);
            rgba = hex ? hex2rgb(hex) : null;
          }

          // Convert to format
          if( rgba === null ) {
            value = settings.defaultValue;
          } else if( settings.format === 'rgb' ) {
            value = settings.opacity ?
              parseRgb('rgba(' + rgba.r + ',' + rgba.g + ',' + rgba.b + ',' + input.attr('data-opacity') + ')') :
              parseRgb('rgb(' + rgba.r + ',' + rgba.g + ',' + rgba.b + ')');
          } else {
            value = rgb2hex(rgba);
          }
        }

        // Update swatch opacity
        swatchOpacity = settings.opacity ? input.attr('data-opacity') : 1;
        if( value.toLowerCase() === 'transparent' ) swatchOpacity = 0;
        input
          .closest('.minicolors')
          .find('.minicolors-input-swatch > span')
          .css('opacity', swatchOpacity);

        // Set input value
        input.val(value);

        // Is it blank?
        if( input.val() === '' ) input.val(parseInput(settings.defaultValue, true));

        // Adjust case
        input.val( convertCase(input.val(), settings.letterCase) );

      })
      // Handle keypresses
      .on('keydown.minicolors', '.minicolors-input', function(event) {
        var input = $(this);
        if( !input.data('minicolors-initialized') ) return;
        switch(event.keyCode) {
          case 9: // tab
            hide();
            break;
          case 13: // enter
          case 27: // esc
            hide();
            input.blur();
            break;
        }
      })
      // Update on keyup
      .on('keyup.minicolors', '.minicolors-input', function() {
        var input = $(this);
        if( !input.data('minicolors-initialized') ) return;
        updateFromInput(input, true);
      })
      // Update on paste
      .on('paste.minicolors', '.minicolors-input', function() {
        var input = $(this);
        if( !input.data('minicolors-initialized') ) return;
        setTimeout( function() {
          updateFromInput(input, true);
        }, 1);
      });

  }));


/***/ }),
/* 65 */
/***/ (function(module, exports, __webpack_require__) {

var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* FileSaver.js
 * A saveAs() FileSaver implementation.
 * 1.1.20150716
 *
 * By Eli Grey, http://eligrey.com
 * License: X11/MIT
 *   See https://github.com/eligrey/FileSaver.js/blob/master/LICENSE.md
 */

/*global self */
/*jslint bitwise: true, indent: 4, laxbreak: true, laxcomma: true, smarttabs: true, plusplus: true */

/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */



var isLikelyNode = typeof Buffer !== 'undefined' && typeof window === 'undefined';



var saveAs = !isLikelyNode &&  (function(view) {
        "use strict";
        // IE <10 is explicitly unsupported
        if (typeof navigator !== "undefined" && /MSIE [1-9]\./.test(navigator.userAgent)) {
            return;
        }
        var
            doc = view.document
        // only get URL when necessary in case Blob.js hasn't overridden it yet
            , get_URL = function() {
                return view.URL || view.webkitURL || view;
            }
            , save_link = doc.createElementNS("http://www.w3.org/1999/xhtml", "a")
            , can_use_save_link = "download" in save_link
            , click = function(node) {
                var event = new MouseEvent("click");
                node.dispatchEvent(event);
            }
            , webkit_req_fs = view.webkitRequestFileSystem
            , req_fs = view.requestFileSystem || webkit_req_fs || view.mozRequestFileSystem
            , throw_outside = function(ex) {
                (view.setImmediate || view.setTimeout)(function() {
                    throw ex;
                }, 0);
            }
            , force_saveable_type = "application/octet-stream"
            , fs_min_size = 0
        // See https://code.google.com/p/chromium/issues/detail?id=375297#c7 and
        // https://github.com/eligrey/FileSaver.js/commit/485930a#commitcomment-8768047
        // for the reasoning behind the timeout and revocation flow
            , arbitrary_revoke_timeout = 500 // in ms
            , revoke = function(file) {
                var revoker = function() {
                    if (typeof file === "string") { // file is an object URL
                        get_URL().revokeObjectURL(file);
                    } else { // file is a File
                        file.remove();
                    }
                };
                if (view.chrome) {
                    revoker();
                } else {
                    setTimeout(revoker, arbitrary_revoke_timeout);
                }
            }
            , dispatch = function(filesaver, event_types, event) {
                event_types = [].concat(event_types);
                var i = event_types.length;
                while (i--) {
                    var listener = filesaver["on" + event_types[i]];
                    if (typeof listener === "function") {
                        try {
                            listener.call(filesaver, event || filesaver);
                        } catch (ex) {
                            throw_outside(ex);
                        }
                    }
                }
            }
            , auto_bom = function(blob) {
                // prepend BOM for UTF-8 XML and text/* types (including HTML)
                if (/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(blob.type)) {
                    return new Blob(["\ufeff", blob], {type: blob.type});
                }
                return blob;
            }
            , FileSaver = function(blob, name, no_auto_bom) {
                if (!no_auto_bom) {
                    blob = auto_bom(blob);
                }
                // First try a.download, then web filesystem, then object URLs
                var
                    filesaver = this
                    , type = blob.type
                    , blob_changed = false
                    , object_url
                    , target_view
                    , dispatch_all = function() {
                        dispatch(filesaver, "writestart progress write writeend".split(" "));
                    }
                // on any filesys errors revert to saving with object URLs
                    , fs_error = function() {
                        // don't create more object URLs than needed
                        if (blob_changed || !object_url) {
                            object_url = get_URL().createObjectURL(blob);
                        }
                        if (target_view) {
                            target_view.location.href = object_url;
                        } else {
                            var new_tab = view.open(object_url, "_blank");
                            if (new_tab == undefined && typeof safari !== "undefined") {
                                //Apple do not allow window.open, see http://bit.ly/1kZffRI
                                view.location.href = object_url
                            }
                        }
                        filesaver.readyState = filesaver.DONE;
                        dispatch_all();
                        revoke(object_url);
                    }
                    , abortable = function(func) {
                        return function() {
                            if (filesaver.readyState !== filesaver.DONE) {
                                return func.apply(this, arguments);
                            }
                        };
                    }
                    , create_if_not_found = {create: true, exclusive: false}
                    , slice
                    ;
                filesaver.readyState = filesaver.INIT;
                if (!name) {
                    name = "download";
                }
                if (can_use_save_link) {
                    object_url = get_URL().createObjectURL(blob);
                    save_link.href = object_url;
                    save_link.download = name;
                    setTimeout(function() {
                        click(save_link);
                        dispatch_all();
                        revoke(object_url);
                        filesaver.readyState = filesaver.DONE;
                    });
                    return;
                }
                // Object and web filesystem URLs have a problem saving in Google Chrome when
                // viewed in a tab, so I force save with application/octet-stream
                // http://code.google.com/p/chromium/issues/detail?id=91158
                // Update: Google errantly closed 91158, I submitted it again:
                // https://code.google.com/p/chromium/issues/detail?id=389642
                if (view.chrome && type && type !== force_saveable_type) {
                    slice = blob.slice || blob.webkitSlice;
                    blob = slice.call(blob, 0, blob.size, force_saveable_type);
                    blob_changed = true;
                }
                // Since I can't be sure that the guessed media type will trigger a download
                // in WebKit, I append .download to the filename.
                // https://bugs.webkit.org/show_bug.cgi?id=65440
                if (webkit_req_fs && name !== "download") {
                    name += ".download";
                }
                if (type === force_saveable_type || webkit_req_fs) {
                    target_view = view;
                }
                if (!req_fs) {
                    fs_error();
                    return;
                }
                fs_min_size += blob.size;
                req_fs(view.TEMPORARY, fs_min_size, abortable(function(fs) {
                    fs.root.getDirectory("saved", create_if_not_found, abortable(function(dir) {
                        var save = function() {
                            dir.getFile(name, create_if_not_found, abortable(function(file) {
                                file.createWriter(abortable(function(writer) {
                                    writer.onwriteend = function(event) {
                                        target_view.location.href = file.toURL();
                                        filesaver.readyState = filesaver.DONE;
                                        dispatch(filesaver, "writeend", event);
                                        revoke(file);
                                    };
                                    writer.onerror = function() {
                                        var error = writer.error;
                                        if (error.code !== error.ABORT_ERR) {
                                            fs_error();
                                        }
                                    };
                                    "writestart progress write abort".split(" ").forEach(function(event) {
                                        writer["on" + event] = filesaver["on" + event];
                                    });
                                    writer.write(blob);
                                    filesaver.abort = function() {
                                        writer.abort();
                                        filesaver.readyState = filesaver.DONE;
                                    };
                                    filesaver.readyState = filesaver.WRITING;
                                }), fs_error);
                            }), fs_error);
                        };
                        dir.getFile(name, {create: false}, abortable(function(file) {
                            // delete file if it already exists
                            file.remove();
                            save();
                        }), abortable(function(ex) {
                            if (ex.code === ex.NOT_FOUND_ERR) {
                                save();
                            } else {
                                fs_error();
                            }
                        }));
                    }), fs_error);
                }), fs_error);
            }
            , FS_proto = FileSaver.prototype
            , saveAs = function(blob, name, no_auto_bom) {
                return new FileSaver(blob, name, no_auto_bom);
            }
            ;
        // IE 10+ (native saveAs)
        if (typeof navigator !== "undefined" && navigator.msSaveOrOpenBlob) {
            return function(blob, name, no_auto_bom) {
                if (!no_auto_bom) {
                    blob = auto_bom(blob);
                }
                return navigator.msSaveOrOpenBlob(blob, name || "download");
            };
        }

        FS_proto.abort = function() {
            var filesaver = this;
            filesaver.readyState = filesaver.DONE;
            dispatch(filesaver, "abort");
        };
        FS_proto.readyState = FS_proto.INIT = 0;
        FS_proto.WRITING = 1;
        FS_proto.DONE = 2;

        FS_proto.error =
            FS_proto.onwritestart =
                FS_proto.onprogress =
                    FS_proto.onwrite =
                        FS_proto.onabort =
                            FS_proto.onerror =
                                FS_proto.onwriteend =
                                    null;

        return saveAs;
    }(
        typeof self !== "undefined" && self
        || typeof window !== "undefined" && window
        || this.content
    ));
// `self` is undefined in Firefox for Android content script context
// while `this` is nsIContentFrameMessageManager
// with an attribute `content` that corresponds to the window

if (typeof module !== "undefined" && module.exports) {
    module.exports.saveAs = saveAs;
} else if (("function" !== "undefined" && __webpack_require__(57) !== null) && (__webpack_require__(58) != null)) {
    !(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_AMD_DEFINE_RESULT__ = function() {
        return saveAs;
    }.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),
				__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));
}


/***/ }),
/* 66 */
/***/ (function(module, exports, __webpack_require__) {

var __WEBPACK_AMD_DEFINE_RESULT__;/* Web Font Loader v1.6.26 - (c) Adobe Systems, Google. License: Apache 2.0 */(function(){function aa(a,b,c){return a.call.apply(a.bind,arguments)}function ba(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,d);return a.apply(b,c)}}return function(){return a.apply(b,arguments)}}function p(a,b,c){p=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?aa:ba;return p.apply(null,arguments)}var q=Date.now||function(){return+new Date};function ca(a,b){this.a=a;this.m=b||a;this.c=this.m.document}var da=!!window.FontFace;function t(a,b,c,d){b=a.c.createElement(b);if(c)for(var e in c)c.hasOwnProperty(e)&&("style"==e?b.style.cssText=c[e]:b.setAttribute(e,c[e]));d&&b.appendChild(a.c.createTextNode(d));return b}function u(a,b,c){a=a.c.getElementsByTagName(b)[0];a||(a=document.documentElement);a.insertBefore(c,a.lastChild)}function v(a){a.parentNode&&a.parentNode.removeChild(a)}
  function w(a,b,c){b=b||[];c=c||[];for(var d=a.className.split(/\s+/),e=0;e<b.length;e+=1){for(var f=!1,g=0;g<d.length;g+=1)if(b[e]===d[g]){f=!0;break}f||d.push(b[e])}b=[];for(e=0;e<d.length;e+=1){f=!1;for(g=0;g<c.length;g+=1)if(d[e]===c[g]){f=!0;break}f||b.push(d[e])}a.className=b.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function y(a,b){for(var c=a.className.split(/\s+/),d=0,e=c.length;d<e;d++)if(c[d]==b)return!0;return!1}
  function z(a){if("string"===typeof a.f)return a.f;var b=a.m.location.protocol;"about:"==b&&(b=a.a.location.protocol);return"https:"==b?"https:":"http:"}function ea(a){return a.m.location.hostname||a.a.location.hostname}
  function A(a,b,c){function d(){k&&e&&f&&(k(g),k=null)}b=t(a,"link",{rel:"stylesheet",href:b,media:"all"});var e=!1,f=!0,g=null,k=c||null;da?(b.onload=function(){e=!0;d()},b.onerror=function(){e=!0;g=Error("Stylesheet failed to load");d()}):setTimeout(function(){e=!0;d()},0);u(a,"head",b)}
  function B(a,b,c,d){var e=a.c.getElementsByTagName("head")[0];if(e){var f=t(a,"script",{src:b}),g=!1;f.onload=f.onreadystatechange=function(){g||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(g=!0,c&&c(null),f.onload=f.onreadystatechange=null,"HEAD"==f.parentNode.tagName&&e.removeChild(f))};e.appendChild(f);setTimeout(function(){g||(g=!0,c&&c(Error("Script load timeout")))},d||5E3);return f}return null};function C(){this.a=0;this.c=null}function D(a){a.a++;return function(){a.a--;E(a)}}function F(a,b){a.c=b;E(a)}function E(a){0==a.a&&a.c&&(a.c(),a.c=null)};function G(a){this.a=a||"-"}G.prototype.c=function(a){for(var b=[],c=0;c<arguments.length;c++)b.push(arguments[c].replace(/[\W_]+/g,"").toLowerCase());return b.join(this.a)};function H(a,b){this.c=a;this.f=4;this.a="n";var c=(b||"n4").match(/^([nio])([1-9])$/i);c&&(this.a=c[1],this.f=parseInt(c[2],10))}function fa(a){return I(a)+" "+(a.f+"00")+" 300px "+J(a.c)}function J(a){var b=[];a=a.split(/,\s*/);for(var c=0;c<a.length;c++){var d=a[c].replace(/['"]/g,"");-1!=d.indexOf(" ")||/^\d/.test(d)?b.push("'"+d+"'"):b.push(d)}return b.join(",")}function K(a){return a.a+a.f}function I(a){var b="normal";"o"===a.a?b="oblique":"i"===a.a&&(b="italic");return b}
  function ga(a){var b=4,c="n",d=null;a&&((d=a.match(/(normal|oblique|italic)/i))&&d[1]&&(c=d[1].substr(0,1).toLowerCase()),(d=a.match(/([1-9]00|normal|bold)/i))&&d[1]&&(/bold/i.test(d[1])?b=7:/[1-9]00/.test(d[1])&&(b=parseInt(d[1].substr(0,1),10))));return c+b};function ha(a,b){this.c=a;this.f=a.m.document.documentElement;this.h=b;this.a=new G("-");this.j=!1!==b.events;this.g=!1!==b.classes}function ia(a){a.g&&w(a.f,[a.a.c("wf","loading")]);L(a,"loading")}function M(a){if(a.g){var b=y(a.f,a.a.c("wf","active")),c=[],d=[a.a.c("wf","loading")];b||c.push(a.a.c("wf","inactive"));w(a.f,c,d)}L(a,"inactive")}function L(a,b,c){if(a.j&&a.h[b])if(c)a.h[b](c.c,K(c));else a.h[b]()};function ja(){this.c={}}function ka(a,b,c){var d=[],e;for(e in b)if(b.hasOwnProperty(e)){var f=a.c[e];f&&d.push(f(b[e],c))}return d};function N(a,b){this.c=a;this.f=b;this.a=t(this.c,"span",{"aria-hidden":"true"},this.f)}function O(a){u(a.c,"body",a.a)}function P(a){return"display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+J(a.c)+";"+("font-style:"+I(a)+";font-weight:"+(a.f+"00")+";")};function Q(a,b,c,d,e,f){this.g=a;this.j=b;this.a=d;this.c=c;this.f=e||3E3;this.h=f||void 0}Q.prototype.start=function(){var a=this.c.m.document,b=this,c=q(),d=new Promise(function(d,e){function k(){q()-c>=b.f?e():a.fonts.load(fa(b.a),b.h).then(function(a){1<=a.length?d():setTimeout(k,25)},function(){e()})}k()}),e=new Promise(function(a,d){setTimeout(d,b.f)});Promise.race([e,d]).then(function(){b.g(b.a)},function(){b.j(b.a)})};function R(a,b,c,d,e,f,g){this.v=a;this.B=b;this.c=c;this.a=d;this.s=g||"BESbswy";this.f={};this.w=e||3E3;this.u=f||null;this.o=this.j=this.h=this.g=null;this.g=new N(this.c,this.s);this.h=new N(this.c,this.s);this.j=new N(this.c,this.s);this.o=new N(this.c,this.s);a=new H(this.a.c+",serif",K(this.a));a=P(a);this.g.a.style.cssText=a;a=new H(this.a.c+",sans-serif",K(this.a));a=P(a);this.h.a.style.cssText=a;a=new H("serif",K(this.a));a=P(a);this.j.a.style.cssText=a;a=new H("sans-serif",K(this.a));a=
    P(a);this.o.a.style.cssText=a;O(this.g);O(this.h);O(this.j);O(this.o)}var S={D:"serif",C:"sans-serif"},T=null;function U(){if(null===T){var a=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);T=!!a&&(536>parseInt(a[1],10)||536===parseInt(a[1],10)&&11>=parseInt(a[2],10))}return T}R.prototype.start=function(){this.f.serif=this.j.a.offsetWidth;this.f["sans-serif"]=this.o.a.offsetWidth;this.A=q();la(this)};
  function ma(a,b,c){for(var d in S)if(S.hasOwnProperty(d)&&b===a.f[S[d]]&&c===a.f[S[d]])return!0;return!1}function la(a){var b=a.g.a.offsetWidth,c=a.h.a.offsetWidth,d;(d=b===a.f.serif&&c===a.f["sans-serif"])||(d=U()&&ma(a,b,c));d?q()-a.A>=a.w?U()&&ma(a,b,c)&&(null===a.u||a.u.hasOwnProperty(a.a.c))?V(a,a.v):V(a,a.B):na(a):V(a,a.v)}function na(a){setTimeout(p(function(){la(this)},a),50)}function V(a,b){setTimeout(p(function(){v(this.g.a);v(this.h.a);v(this.j.a);v(this.o.a);b(this.a)},a),0)};function W(a,b,c){this.c=a;this.a=b;this.f=0;this.o=this.j=!1;this.s=c}var X=null;W.prototype.g=function(a){var b=this.a;b.g&&w(b.f,[b.a.c("wf",a.c,K(a).toString(),"active")],[b.a.c("wf",a.c,K(a).toString(),"loading"),b.a.c("wf",a.c,K(a).toString(),"inactive")]);L(b,"fontactive",a);this.o=!0;oa(this)};
  W.prototype.h=function(a){var b=this.a;if(b.g){var c=y(b.f,b.a.c("wf",a.c,K(a).toString(),"active")),d=[],e=[b.a.c("wf",a.c,K(a).toString(),"loading")];c||d.push(b.a.c("wf",a.c,K(a).toString(),"inactive"));w(b.f,d,e)}L(b,"fontinactive",a);oa(this)};function oa(a){0==--a.f&&a.j&&(a.o?(a=a.a,a.g&&w(a.f,[a.a.c("wf","active")],[a.a.c("wf","loading"),a.a.c("wf","inactive")]),L(a,"active")):M(a.a))};function pa(a){this.j=a;this.a=new ja;this.h=0;this.f=this.g=!0}pa.prototype.load=function(a){this.c=new ca(this.j,a.context||this.j);this.g=!1!==a.events;this.f=!1!==a.classes;qa(this,new ha(this.c,a),a)};
  function ra(a,b,c,d,e){var f=0==--a.h;(a.f||a.g)&&setTimeout(function(){var a=e||null,k=d||null||{};if(0===c.length&&f)M(b.a);else{b.f+=c.length;f&&(b.j=f);var h,m=[];for(h=0;h<c.length;h++){var l=c[h],n=k[l.c],r=b.a,x=l;r.g&&w(r.f,[r.a.c("wf",x.c,K(x).toString(),"loading")]);L(r,"fontloading",x);r=null;null===X&&(X=window.FontFace?(x=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent))?42<parseInt(x[1],10):!0:!1);X?r=new Q(p(b.g,b),p(b.h,b),b.c,l,b.s,n):r=new R(p(b.g,b),p(b.h,b),b.c,l,b.s,a,
    n);m.push(r)}for(h=0;h<m.length;h++)m[h].start()}},0)}function qa(a,b,c){var d=[],e=c.timeout;ia(b);var d=ka(a.a,c,a.c),f=new W(a.c,b,e);a.h=d.length;b=0;for(c=d.length;b<c;b++)d[b].load(function(b,d,c){ra(a,f,b,d,c)})};function sa(a,b){this.c=a;this.a=b}function ta(a,b,c){var d=z(a.c);a=(a.a.api||"fast.fonts.net/jsapi").replace(/^.*http(s?):(\/\/)?/,"");return d+"//"+a+"/"+b+".js"+(c?"?v="+c:"")}
  sa.prototype.load=function(a){function b(){if(f["__mti_fntLst"+d]){var c=f["__mti_fntLst"+d](),e=[],h;if(c)for(var m=0;m<c.length;m++){var l=c[m].fontfamily;void 0!=c[m].fontStyle&&void 0!=c[m].fontWeight?(h=c[m].fontStyle+c[m].fontWeight,e.push(new H(l,h))):e.push(new H(l))}a(e)}else setTimeout(function(){b()},50)}var c=this,d=c.a.projectId,e=c.a.version;if(d){var f=c.c.m;B(this.c,ta(c,d,e),function(e){e?a([]):(f["__MonotypeConfiguration__"+d]=function(){return c.a},b())}).id="__MonotypeAPIScript__"+
    d}else a([])};function ua(a,b){this.c=a;this.a=b}ua.prototype.load=function(a){var b,c,d=this.a.urls||[],e=this.a.families||[],f=this.a.testStrings||{},g=new C;b=0;for(c=d.length;b<c;b++)A(this.c,d[b],D(g));var k=[];b=0;for(c=e.length;b<c;b++)if(d=e[b].split(":"),d[1])for(var h=d[1].split(","),m=0;m<h.length;m+=1)k.push(new H(d[0],h[m]));else k.push(new H(d[0]));F(g,function(){a(k,f)})};function va(a,b,c){a?this.c=a:this.c=b+wa;this.a=[];this.f=[];this.g=c||""}var wa="//fonts.googleapis.com/css";function xa(a,b){for(var c=b.length,d=0;d<c;d++){var e=b[d].split(":");3==e.length&&a.f.push(e.pop());var f="";2==e.length&&""!=e[1]&&(f=":");a.a.push(e.join(f))}}
  function ya(a){if(0==a.a.length)throw Error("No fonts to load!");if(-1!=a.c.indexOf("kit="))return a.c;for(var b=a.a.length,c=[],d=0;d<b;d++)c.push(a.a[d].replace(/ /g,"+"));b=a.c+"?family="+c.join("%7C");0<a.f.length&&(b+="&subset="+a.f.join(","));0<a.g.length&&(b+="&text="+encodeURIComponent(a.g));return b};function za(a){this.f=a;this.a=[];this.c={}}
  var Aa={latin:"BESbswy","latin-ext":"\u00e7\u00f6\u00fc\u011f\u015f",cyrillic:"\u0439\u044f\u0416",greek:"\u03b1\u03b2\u03a3",khmer:"\u1780\u1781\u1782",Hanuman:"\u1780\u1781\u1782"},Ba={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},Ca={i:"i",italic:"i",n:"n",normal:"n"},
    Da=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/;
  function Ea(a){for(var b=a.f.length,c=0;c<b;c++){var d=a.f[c].split(":"),e=d[0].replace(/\+/g," "),f=["n4"];if(2<=d.length){var g;var k=d[1];g=[];if(k)for(var k=k.split(","),h=k.length,m=0;m<h;m++){var l;l=k[m];if(l.match(/^[\w-]+$/)){var n=Da.exec(l.toLowerCase());if(null==n)l="";else{l=n[2];l=null==l||""==l?"n":Ca[l];n=n[1];if(null==n||""==n)n="4";else var r=Ba[n],n=r?r:isNaN(n)?"4":n.substr(0,1);l=[l,n].join("")}}else l="";l&&g.push(l)}0<g.length&&(f=g);3==d.length&&(d=d[2],g=[],d=d?d.split(","):
    g,0<d.length&&(d=Aa[d[0]])&&(a.c[e]=d))}a.c[e]||(d=Aa[e])&&(a.c[e]=d);for(d=0;d<f.length;d+=1)a.a.push(new H(e,f[d]))}};function Fa(a,b){this.c=a;this.a=b}var Ga={Arimo:!0,Cousine:!0,Tinos:!0};Fa.prototype.load=function(a){var b=new C,c=this.c,d=new va(this.a.api,z(c),this.a.text),e=this.a.families;xa(d,e);var f=new za(e);Ea(f);A(c,ya(d),D(b));F(b,function(){a(f.a,f.c,Ga)})};function Ha(a,b){this.c=a;this.a=b}Ha.prototype.load=function(a){var b=this.a.id,c=this.c.m;b?B(this.c,(this.a.api||"https://use.typekit.net")+"/"+b+".js",function(b){if(b)a([]);else if(c.Typekit&&c.Typekit.config&&c.Typekit.config.fn){b=c.Typekit.config.fn;for(var e=[],f=0;f<b.length;f+=2)for(var g=b[f],k=b[f+1],h=0;h<k.length;h++)e.push(new H(g,k[h]));try{c.Typekit.load({events:!1,classes:!1,async:!0})}catch(m){}a(e)}},2E3):a([])};function Ia(a,b){this.c=a;this.f=b;this.a=[]}Ia.prototype.load=function(a){var b=this.f.id,c=this.c.m,d=this;b?(c.__webfontfontdeckmodule__||(c.__webfontfontdeckmodule__={}),c.__webfontfontdeckmodule__[b]=function(b,c){for(var g=0,k=c.fonts.length;g<k;++g){var h=c.fonts[g];d.a.push(new H(h.name,ga("font-weight:"+h.weight+";font-style:"+h.style)))}a(d.a)},B(this.c,z(this.c)+(this.f.api||"//f.fontdeck.com/s/css/js/")+ea(this.c)+"/"+b+".js",function(b){b&&a([])})):a([])};var Y=new pa(window);Y.a.c.custom=function(a,b){return new ua(b,a)};Y.a.c.fontdeck=function(a,b){return new Ia(b,a)};Y.a.c.monotype=function(a,b){return new sa(b,a)};Y.a.c.typekit=function(a,b){return new Ha(b,a)};Y.a.c.google=function(a,b){return new Fa(b,a)};var Z={load:p(Y.load,Y)}; true?!(__WEBPACK_AMD_DEFINE_RESULT__ = function(){return Z}.call(exports, __webpack_require__, exports, module),
				__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__)):"undefined"!==typeof module&&module.exports?module.exports=Z:(window.WebFont=Z,window.WebFontConfig&&Y.load(window.WebFontConfig));}());


/***/ }),
/* 67 */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(fabric) {fabric.debug = true;
fabric.extensions = [];
fabric.util.data = __webpack_require__(54);
fabric.util.path = __webpack_require__(6);
fabric.util.compile = __webpack_require__(5);
fabric.util.loader = __webpack_require__(55);
fabric.util.syntax = __webpack_require__(56);
fabric.util.object.extend(fabric.util.object,__webpack_require__(2));
fabric.util.object.extend(fabric.util,__webpack_require__(3));

//require('./modules');

__webpack_require__(21);
__webpack_require__(25);
__webpack_require__(18);
__webpack_require__(4);
__webpack_require__(26);
__webpack_require__(20);
__webpack_require__(19);
__webpack_require__(24);
__webpack_require__(27);
__webpack_require__(22);
__webpack_require__(23);
__webpack_require__(46);
__webpack_require__(29);
__webpack_require__(37);
__webpack_require__(33);
__webpack_require__(35);
__webpack_require__(39);
__webpack_require__(31);
__webpack_require__(34);
__webpack_require__(47);
__webpack_require__(40);
__webpack_require__(32);
__webpack_require__(42);
__webpack_require__(45);
__webpack_require__(30);
__webpack_require__(41);
__webpack_require__(36);
__webpack_require__(48);
__webpack_require__(38);
__webpack_require__(28);
__webpack_require__(43);
__webpack_require__(44);
__webpack_require__(11);
__webpack_require__(14);
__webpack_require__(17);
__webpack_require__(16);
__webpack_require__(13);
__webpack_require__(12);
__webpack_require__(15);
__webpack_require__(52);
__webpack_require__(49);
__webpack_require__(50);
__webpack_require__(51);
__webpack_require__(53);


if(!fabric.isLikelyNode){
  /**
   * inline script images
   * @type {{error: string}}
   */
  fabric.media = {
    /**
     * replace images loaded with errors
     */
    error: 'data:image/svg+xml;base64,' + __webpack_require__(10)
  };
}

module.exports  = fabric;

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 68 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {


fabric.RemoveWhiteDP = fabric.Image.filters.RemoveWhiteDP =  fabric.util.createClass(fabric.Image.filters.BaseFilter,{
    type: 'RemoveWhiteDP',
    initialize: function(options) {
        if(options)delete options.type;
        this.options = fabric.util.object.defaults(options || {},{
                fromCorners : true,
                blurRadius: 2,
                colorThreshold: 32
            });
        this.pathfinder = new fabric.Pathfinder(this.options);
    },
    applyTo: function(canvasEl) {

        var pathfinder = this.pathfinder;

        pathfinder.colorThreshold = this.options.colorThreshold;
        pathfinder.setPicture(canvasEl);
        pathfinder.selectBackground(this.options.fromCorners);
        if(pathfinder.mask.count ) {
          pathfinder._fill([0, 0, 0, 0]);
          pathfinder.mask = fabric.MagicWand.invertMask(pathfinder.mask);
          //todo inverting mask

          if(pathfinder.mask.count){
            var _width = pathfinder.mask.bounds.maxX - pathfinder.mask.bounds.minX + 1;
            var _height = pathfinder.mask.bounds.maxY - pathfinder.mask.bounds.minY + 1;
            var ctx = canvasEl.getContext('2d');
            var imageData = pathfinder.editedImageCanvas.getContext('2d').getImageData(pathfinder.mask.bounds.minX, pathfinder.mask.bounds.minY, _width, _height);
            canvasEl.width  = _width;
            canvasEl.height = _height;
            ctx.putImageData(imageData, 0, 0);
            this.bounds = pathfinder.mask.bounds;
          }else{
            var ctx = canvasEl.getContext('2d');
            canvasEl.width  = 1;
            canvasEl.height = 1;
            ctx.clearRect(0,0,1,1);
            this.bounds = {
              maxX: 0,
              maxY: 0,
              minX: 0,
              minY: 0
            }
          }
        }



            //clip the image
        pathfinder.clearMemory();

    },
    toObject: function() {
        return fabric.util.object.extend(this.callSuper('toObject'), this.options);
    }
});

fabric.Image.filters.RemoveWhiteDP.fromObject = function(object) {
    return new fabric.Image.filters.RemoveWhiteDP(object);
};

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 69 */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(fabric) {
fabric.CacheMixin = {
  caching: true,
  dirty: true,
  render: function ( ctx) {

    ctx.save();
    if (this.transformMatrix) {
      ctx.transform.apply(ctx, this.transformMatrix);
    }
    this.transform(ctx);

    this._setShadow(ctx);
    this.clipTo && fabric.util.clipContext(this, ctx);

    ctx.translate(-this.width / 2, -this.height / 2);

    if (this.caching) {
      if(!this._cache){
        this._cache = fabric.util.createCanvasElementWithSize(this);
      }
      if(this.dirty){
        this._cache.width = this.width;
        this._cache.height = this.height;
        var cacheCtx = this._cache.getContext("2d");
        cacheCtx.clearRect(0,0,this._cache.width,this._cache.height)
        this._render(cacheCtx);
        this.dirty = false;
      }

      ctx.drawImage(this._cache, 0, 0, this.width, this.height,0, 0, this.width, this.height);
    }else{
      this._render(ctx);
    }

    this.clipTo && ctx.restore();
    ctx.restore();
  }

};

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 70 */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(fabric) {fabric.StrokeMixin = {
  shape: {
    strokeWidthFull: 0,
    strokeWidthEmpty: 2,
    strokeWidthActive: 2,
    strokeDashArray : [5,5],
    fill: "transparent",
    strokeEmpty:  "red",
    strokeFull:   "red",
    strokeActive: "green"
  },
  setShape: function(el,cb){

    el =  fabric.util.object.extend({
      strokeWidthFull: this.shape.strokeWidthFull,
      strokeWidthEmpty: this.shape.strokeWidthEmpty,
      strokeWidthActive: this.shape.strokeWidthActive,
      dashArray : this.shape.dashArray,
      strokeEmpty:  this.shape.strokeEmpty,
      strokeFull:  this.shape.strokeFull,
      strokeActive:this.shape.strokeActive
    },el);


    var _this = this;
    if(el && el.src && !el.paths){
      fabric.loadSVGFromURL(el.src,function(paths,options) {
        el.paths  = paths;
        fabric.util.object.extend(el,options);
        _this._set_shape(el);
        _this.add(_this._fabric_shape)
        _this._apply_shape();
        cb && cb();
      })
    }else{
      _this._set_shape(el);
      _this.add(_this._fabric_shape);
      _this._apply_shape();
      cb && cb();
    }
  },
  initShape: function(options){

    var _shapeOptions = fabric.util.object.extend(options.shape || {} , this.shape);

    this._fabric_shape =  new fabric.Rect(fabric.util.object.extend({},_shapeOptions,{
      width:            options.width,
      height:           options.height,
      stroke:           _shapeOptions.strokeEmpty,
      strokeWidth:      _shapeOptions.strokeWidthEmpty
    }));
  },

  /**
   * �������������� ����� �� ������� ������� ����
   * @private
   */
  _apply_shape: function () {
    var shape = this.shape;

    var _off = shape && shape.offsets;

    if (!_off) {
      _off = [0, 0, 0, 0];
    }

    var _off_units = shape && shape.offsets_units;

    if (!_off_units) {
      //if (frame.border_image) {todo
      //    _off_units = frame.border_image.width_units || [0, 0, 0, 0];
      //} else {
      _off_units = [1, 1, 1, 1];
      //}
    }

    /*else if(shape.offsets && shape.offsets_units){
     var s = this.slide.scaleValue;
     this._fabric_shape = new fabric.Rect({
     originX: 'center',
     originY: 'center',
     width:  (this.data.geometry.width - shape.offsets[3] - shape.offsets[1]) * s,
     height: (this.data.geometry.height -shape.offsets[0] - shape.offsets[2]) * s
     });*/

    _off = {
      top:   _off[0] * (_off_units[0] ? this.height / 100 : 1) || 0,
      right: _off[1] * (_off_units[1] ? this.width / 100 : 1) || 0,
      bottom:_off[2] * (_off_units[2] ? this.height / 100 : 1) || 0,
      left:  _off[3] * (_off_units[3] ? this.width / 100 : 1) || 0
    };


    var _w = (this.width - _off.left - _off.right );// *this.slide.scaleValue;
    var _h = (this.height - _off.top - _off.bottom);// *this.slide.scaleValue;


    //if(this.resources.frame.data.shape && this.resources.frame.data.shape.radius){
    //
    //    this._fabric_shape.set({
    //        left: -this.width/2  + _off.left ,
    //        top:  -this.height/2 + _off.top ,
    //        width: _w - _off.left -_off.right,
    //        height:  _h - _off.top -_off.bottom,
    //        scaleX:  1,
    //        scaleY:  1
    //    });
    //}else{


    if(this.shape.path || this.shape.paths || this.shape.offsets){
      var _sw = this.shape.width || this._fabric_shape.width;
      var _sh = this.shape.height || this._fabric_shape.height;

      if(this._fabric_shape.strokeWidth){
        _sw += this._fabric_shape.strokeWidth ;
        _sh += this._fabric_shape.strokeWidth ;
      }

      var options = {
        left:   -this.width / 2 + _off.left,
        top:    -this.height / 2 + _off.top,
        scaleX: _w / 100 / (_sw / 100),// * (shape.scaleX || 1),
        scaleY: _h / 100 / (_sh / 100),// * (shape.scaleY || 1)
        angle: 0
      };
    }else{
      var options = {
        left:   -this.width / 2 + _off.left,
        top:    -this.height / 2 + _off.top,
        width:    _w,// * (shape.scaleX || 1),
        height:   _h,// * (shape.scaleY || 1)
        angle: 0
      };
    }

    this._fabric_shape.set(options);

    this.updateStroke();
    this.canvas && this.canvas.renderAll();
  },
  _set_shape: function (shape) {

    if(this._fabric_shape){
      this.remove(this._fabric_shape);
      delete this._fabric_shape;
    }
    var _fabric_shape;
    var _options = {
      fill:             "transparent",
      strokeDashArray : this.shape.dashArray,
    };

    this.shape = shape;

    if(!shape){
      _fabric_shape = new fabric.Rect({
        width: this.width,
        height: this.height
      });
      _fabric_shape.set(_options)
    }else if (shape.paths) {

      for(var i in shape.paths){
        shape.paths[i].set(_options)
      }

      _fabric_shape = fabric.util.groupSVGElements(shape.paths, shape);
      //this._objects.unshift(this._objects.pop());
    }else {
      var path;

      if (shape.radius) {
        path = fabric.util.getRadiusClipPath(shape.radius, shape.radius_units, this.width, this.height);
        _fabric_shape = new fabric.Path(path, _options);
      } else if (shape.path) {
        _fabric_shape = new fabric.Path(shape.path, _options);
        //} else if(shape.offsets){
        //  path = fabric.util.getOffsetsClipPath(shape.offsets, shape.offsets_units)
      }else{
        path =  'M 0 0 L {width} 0 L {width} {height} L 0 {height} z'.format(fabric.util.object.extend({
          width:            100,
          height:           100
        },shape));

        _fabric_shape = new fabric.Path(path, _options);
        //
        //_fabric_shape =  new fabric.Rect(fabric.util.object.extend({
        //  width:            100,
        //  height:           100
        //},shape));

      }
    }


    _fabric_shape.set({
      scaleX: this.width  / _fabric_shape.width,
      scaleY: this.height / _fabric_shape.height,
      perPixelTargetFind: true,
      selectable: false,
      originX: "left",
      originY: "top"
    });



    this._fabric_shape =  _fabric_shape;


    if(this.element){
      this.element.clipTo = this._fabric_shape;
    }


    this.updateStroke();

  },

  updateStroke: function(){

    var _stroke = this.shape.stroke;
    var _sw = 0;
    if((this._activated || this._clipmode )&& this.shape.strokeWidthActive){
      _sw = this.shape.strokeWidthActive
    }else if(this.element && this.shape.strokeWidthFull){
      _sw = this.shape.strokeWidthFull;
    }else if(!this.element && this.shape.strokeWidthEmpty){
      _sw = this.shape.strokeWidthEmpty;
    }
    if((this._activated || this._clipmode) && this.shape.strokeActive){
      _stroke = this.shape.strokeActive
    }else if(this.element && this.shape.strokeFull){
      _stroke = this.shape.strokeFull;
    }else if(!this.element && this.shape.strokeEmpty){
      _stroke = this.shape.strokeEmpty;
    }


    var _strokeWidth = _sw / Math.max(this._fabric_shape.scaleX,this._fabric_shape.scaleY);

    if(this.shape){
      if(this.shape.paths ){
        for(var i in this._fabric_shape.paths){
          this._fabric_shape.paths[i].setStrokeWidth(_strokeWidth)
          this._fabric_shape.paths[i].setStroke(_stroke)
        }
      }else{
        this._fabric_shape.setStrokeWidth(_strokeWidth)
        this._fabric_shape.setStroke(_stroke)
      }
    }
  },
  /**
   * кобъект готовится к замену фото
   */
  activate: function(){
    this._activated = true;
    this._fabric_shape.setOpacity(1);
    this.updateStroke();
    this.canvas.renderAll();
  },
  /**
   * кобъект не готовится к замену фото
   */
  deactivate: function(){
    this._activated = false;
    this.updateStroke();
    this.canvas.renderAll();
  },
}

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 71 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.util.object.extend(fabric.StaticCanvas.prototype, {
  offsets: {left: 0, top: 0, right: 0, bottom: 0}
});

fabric.util.object.extend(fabric.SlideCanvas.prototype, {
  defaultOptions: fabric.util.object.extend(fabric.SlideCanvas.prototype.defaultOptions,{
    offsets: {left : 0,top : 0, right: 0, bottom:0}
  }),
  eventListeners: fabric.util.object.extendArraysObject(fabric.SlideCanvas.prototype.eventListeners, {
    "before:drop": function(e){
      //todo;
      if(!this._backgroundLayer){
        return;
      }
      var pointer = this.getPointer(e.originalEvent, true);
      var target = this._searchPossibleTargets(this._backgroundLayer, pointer);
      if (target) {
        this.setActiveArea(target);
        e.data.clipTo = "#" + target.id;
        e.data.movementLimits = "#" + target.id;
      }
    }
  }),
  _update_clip_rect: function () {
    if (this.areas || !this.layers.background.objects[0]) return;
    var geometry = this.getRect(this.offsets);
    this.layers.background.objects[0].set(geometry);
  },
  //offsets: {left : 0,top : 0, right: 0, bottom:0},
  setHelpers: function (helpers, callback) {
    var self = this;
    if(helpers){
      for (var i in helpers){
        fabric.util.createObject(helpers[i],function(helper){
          self.layers.background.objects.push(helper);
          self.renderAll();
        });
      }
    }
    callback && callback();
  },
  areaActivating: false,
  addElementsInsideActiveArea: false,
  areaProperties: {
    originX: 'left',
    originY: 'top',
    fill: 'transparent',
    strokeDashArray: [5, 5],
    strokeWidth: 1,
    stroke: 'black',
    resizable: true
    //selectable: false
  },
  setAreaProperty: function (property, value) {
    this["area_" + property] = value;
    for (var i in this.layers.background.objects) {
      this.layers.background.objects[i][property] = value;
    }
    this.renderAll();
  },
  setActiveArea: function (area) {
    if (area === true) {
      area = this.layers.background.objects[0] || null;
    }
    if (this.activeArea) {
      this.activeArea.setStroke("#000");
    }
    this.activeArea = area;
    if (area) {
      area.setStroke("#B7F1ED");
    }
  },
  setAreaActivating: function (value/*, force*/) {
    //todo force
    var force = true;
    if (force || (value && !this.areaActivating)) {
      this.areaActivating = true;
      this.on("object:modified", function (e) {
        if(this.editingObject){
          return;
        }
        //todo event! не ъотел бы это тут испольовать,но работает
        var pointer = this.getPointer(event, true);
        var target = this._searchPossibleTargets(this.layers.background.objects, pointer);
        if(this._currentTransform && target && this.target.movementLimits != target){
          this.target.movementLimits = this.target.clipTo = target;
          this.setActiveArea(target);
        }
      });
      this.on("mouse:down", function (e) {
        var pointer = this.getPointer(e.e, true);
        var target = this._searchPossibleTargets(this.layers.background.objects, pointer);
        if (target) {
          this.setActiveArea(target);
        }
      })
    }
  },
  _update_area_geometry: function(el,options){
    if (options.path) {

      options.width = options.width || el.width;
      var geometry = this.getRect(options);
      var _scale = el.width / geometry.width;
      el.set({
        left: geometry.left ,///* el.left * _scale*/,
        top: geometry.top ,//+ el.top * _scale,
        scaleX: _scale,
        scaleY: _scale
      });
      return;
    }
    var geometry = this.getRect(options);

    if(options.src){
      var _scale = geometry.width / img.width;
      el.set({
        left: geometry.left,// + el.left * _scale,
        top: geometry.top ,//+ el.top * _scale,
        strokeWidth: this.areaProperties.strokeWidth / _scale,
        scaleX: _scale,
        scaleY: _scale
      });
    }else{
      el.set(geometry);
    }
  },
  createArea: function (area, callback) {

    var _this = this;

    var _finalize = function (path, area) {
      path.id = area.id;
      area.instance = path;
      path.layer = "background";
      _this.add(path);
      this._update_area_geometry(path,area);
      // _this._backgroundLayer.push(path);
      // path.canvas = _this;
      callback();
    }.bind(this);


    var path, rectarea;
    if (area.path) {
      path = new fabric.Path(area.path, this.areaProperties);
      area.top = path.top;
      area.left = path.left;
      area.width = path.width;
      area.height = path.height;
      _finalize(path, area);
    } else if (area.src) {
      var clipFiller = new fabric.Pathfinder({});
      fabric.util.loadImage(area.src, function (img) {
        clipFiller.setImage(img);
        clipFiller.mask = MagicWand.selectBackground(clipFiller.getInfo(), null, 15);

        var contours = clipFiller.getContours();
        var clipPoints = contours[1].points;
        var pathData = fabric.PencilBrush.prototype.convertPointsToSVGPath(clipPoints).join('');//todo
        path = new fabric.Path(pathData, _this.areaProperties);

        _finalize(path, area);
      });

    } else {
      path = new fabric.Rect(this.areaProperties);
      _finalize(path, area);
    }



    if(( area.right || area.bottom || area.path ) && (!this.originalWidth  || !this.originalHeight) ){
      this.on("background-image:loaded",function(){
        this._update_area_geometry(path,area);
      this.renderAll();
      }.bind(this))
    }

    /*
     app.canvas.setOffsets({
     right:  1,
     left:   1,
     top:    1,
     bottom: 1
     });


     app.canvas.clipTo = function (ctx) {
     var zoom = app.canvas_config.width / app.canvas.backgroundImage.filters[0].pathfinder.mask.width;
     ctx.save();
     ctx.scale(zoom, zoom);
     app.clipFiller.traceInner(ctx);
     ctx.restore();
     };*/
  },
  removeArea: function (area, callback) {

    var objs = this.getObjects();
    for (var i in objs) {
      if (objs[i].movementLimits == area) {
        delete objs[i].movementLimits;
      }
      if (objs[i].clipTo == area) {
        //if(objs[i].olcClipToID){
        //    objs[i].clipToID = objs[i].oldClipToID;
        //}
        delete objs[i].clipTo;
        //objs[i].olcClipToID = area.id;
      }
    }
    area.remove();
  },
  /**
   *
   * @param offsets : {top: number, right: number, bottom: number, left: number} | number | [?number,?number,?number,?number]
   * @param callback
   */
  setOffsets: function (offsets, callback) {

    if (offsets.constructor === Number) {
      this.offsets = {top: offsets, right: offsets, bottom: offsets, left: offsets};
    }else if (offsets.length) {
      switch(offsets.length){
        case 0: this.offsets = {top: 0, right: 0, bottom: 0, left: 0}; break;
        case 1: this.offsets = {top: offsets[0], right: offsets[0], bottom: offsets[0], left: offsets[0]}; break;
        case 2: this.offsets = {top: offsets[0], right: offsets[1], bottom: offsets[0], left: offsets[1]}; break;
        case 3: this.offsets = {top: offsets[0], right: offsets[1], bottom: offsets[2], left: offsets[1]}; break;
        case 4: this.offsets = {top: offsets[0], right: offsets[1], bottom: offsets[2], left: offsets[3]}; break;
      }
    }else{
      this.offsets = offsets;
    }

    this.setAreas([this.offsets], callback);
  },
  setAreas: function (areas, callback) {
    areas = areas || [];
    if (this.areas) {
      for (var i = this.areas.length; i--;) {
        this.removeArea(this.areas[i].instance);
      }
    }
    this.areas = areas;

    var cb = fabric.util.queueLoad(areas.length + 1, function () {
      if (this.areaActivating) {
        if (this.layers.background.objects[0]) {
          this.setActiveArea(true);
        } else {
          this.activeArea = null;
        }
      }

      var objs = this.getObjects();
//work with object
      if (!areas.length) {
        objs.length && this.clear();
      } else {
       /* todo : применить текущую зону ко всем объектам
       var _area = this.activeArea || this.layers.background.objects[0];
        for (var i in objs) {
          var obj = objs[i];
          obj.clipTo = _area;
          obj.setMovementLimits(_area);
          obj.setCoords();
        }*/
      }
      callback && callback.call(this);
    }.bind(this));

    for (var i in areas) {
      if (!areas[i].id) {
        areas[i].id = "__" + i;
      }
      this.createArea(areas[i], cb);
    }
    cb();

    this.renderAll();
  }
})

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 72 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {


// fabric.require('SlideGroup',['SlideObject'], function() {
var _OBJ = fabric.Object.prototype;
var _handleGrouping_overwritten = fabric.Canvas.prototype._handleGrouping;
fabric.Object.prototype.groupable = true;

fabric.util.object.extend(fabric.Canvas.prototype, {
  /**
   * Deactivates all objects and dispatches appropriate events
   * @return {fabric.Canvas} thisArg
   * @chainable
   */
  deactivateAllWithDispatch: function (e) {
    var activeGroup = this.getActiveGroup(),
      activeObject = this.getActiveObject();
    var _target = activeObject || activeGroup;
    if (_target) {
      this.fire('before:selection:cleared', { target: _target, e: e });
    }
    this.deactivateAll();
    if (_target) {
      this.fire('selection:cleared', { e: e, target: _target });
      _target.fire('deselected');
    }
    return this;
  },

  /**
   * Divides objects in two groups, one to render immediately
   * and one to render as activeGroup.
   * return objects to render immediately and pushes the other in the activeGroup.
   */
  _chooseObjectsToRender: function() {
    var activeGroup = this.getActiveGroup(),
      activeObject = this.getActiveObject(),
      object, objsToRender = [ ], activeGroupObjects = [ ];

    if (activeGroup && !this.preserveObjectStacking) {
      for (var i = 0, length = this._objects.length; i < length; i++) {
        object = this._objects[i];
        if (!activeGroup.contains(object)) {
          if(!object.hiddenActive){
            objsToRender.push(object);
          }
        }
        else {
          activeGroupObjects.push(object);
        }
      }
      if (activeGroup) {
        // activeGroup._set('_objects', activeGroupObjects);
        objsToRender.push(activeGroup);
      }
      activeObject && objsToRender.push(activeObject);
      // activeGroup._set('_objects', activeGroupObjects);
    }
    else {
      objsToRender = this._objects;
    }
    return objsToRender;
  },
  /**
   * adding before:selection:created event
   * @private
   * @param {Event} e Event object
   * @param {fabric.Object} target
   */
  _handleGrouping: function (e, target) {
    this.fire("before:selection:created");
    _handleGrouping_overwritten.call(this, e, target);
  },
  /**
   * @private
   * @param {Event} e mouse event
   */
  _groupSelectedObjects: function (e) {

    var group = this._collectObjects();

    group = fabric.util.object.filter(group,{groupable: true});

    // do not create group for 1 element only
    if (group.length === 1) {
      this.setActiveObject(group[0], e);
    }
    else if (group.length > 1) {
      group = new fabric.Group(group.reverse(), {
        canvas: this
      });
      group.addWithUpdate();
      this.setActiveGroup(group, e);
      group.saveCoords();
      this.fire('selection:created', { target: group });
      this.renderAll();
    }
  }
});

_OBJ.cloneSync = function(){
  var _klass = fabric[fabric.util.string.camelize(fabric.util.string.capitalize(this.type))];
  if(_klass.async){
    var _obj = new _klass.fromObject(this);
  }else{
    var _obj = this.clone();
  }
  _obj.canvas = this.canvas;
  return _obj;
};

fabric.util.object.extend(fabric.Group.prototype, {
  groupSelectable: true,
  cloneSync: function() {
    var _clonedObjects = this._objects.map(function(object){
      return object.cloneSync();
    });


    var object = this.toObject();
    delete object.objects;

    return new fabric.Group(_clonedObjects, object, true);

    // fabric.util.enlivenObjects(object.objects, function (enlivenedObjects) {
    //   delete object.objects;
    //   callback && callback(new fabric.Group(enlivenedObjects, object, true));
    // });
  },
  _calcBounds : function (onlyWidthHeight) {
    var aX = [],
      aY = [],
      o, prop,
      props = ['tr', 'br', 'bl', 'tl'];

    for (var i = 0, len = this._objects.length; i < len; ++i) {
      o = this._objects[i];
      if (o.notSelectableInTheGroup) {
        continue;
      }
      o.setCoords();
      for (var j = 0; j < props.length; j++) {
        prop = props[j];
        aX.push(o.oCoords[prop].x);
        aY.push(o.oCoords[prop].y);
      }
    }

    this.set(this._getBounds(aX, aY, onlyWidthHeight));
  },
  initialize_overwritten: fabric.Group.prototype.initialize,
  isSelectionGroup: function(){
    return this.canvas._objects.indexOf(this) === -1
  },
  //clone: function(callback){
  //  if(callback === true || callback.constructor === Object){
  //    var _frame = new fabric.Group(this);
  //    if(callback.constructor === Object){
  //      _frame.set(callback);
  //      return _frame;
  //    }
  //  }
  //  return this.callSuper('clone',callback);
  //},
  initialize: function(objects,options){
    if(objects.constructor != Array){
      var el = objects;
      options = el.toObject();
      objects = [];
      for(var i in el._objects){
        objects.push(el._objects[i].cloneSync())
      }
    }

    this.initialize_overwritten(objects,options);
    if(this.type == 'group'){
      this.on("dblclick", function(){
        if(this.canvas._objects.indexOf(this) === -1){
          this.groupSelectedElements();
        }else{
          this.ungroup();
        }
      });
    }
  },
  ungroup : function() {
    this.canvas.discardActiveGroup();
    this._restoreObjectsState();
    this.canvas.remove(this);
    for(var i in this._objects){
      this.canvas.add(this._objects[i]);
      this._objects[i].clipTo = this.clipTo;
      //this._objects[i].active = true;
    }
    var group = new fabric.Group(this._objects, {
      canvas: this.canvas
    });
    group.addWithUpdate();
    this.canvas.setActiveGroup(group);
    group.saveCoords();
    this.canvas.fire('selection:created', { target: group });
    this.canvas.renderAll();

    //var _group = new fabric.Group(this._objects);
    //_group.canvas = this.canvas;
    //this.canvas.setActiveObject(_group);
  },

  groupSelectedElements: function(){



    var el = this.cloneSync();
    this.canvas.add(el);
    this.canvas.discardActiveGroup();
    this.canvas.setActiveObject(el);

    for(var i in this._objects){
      this.canvas.remove(this._objects[i].originalObject);
    }


  },
  actions: {

    objectRemove: {
      className:  'fa fa-trash',
      title:      'Delete',
      key:        "Delete",
      action:     function(){
        if(this.isSelectionGroup()){
          for(var i in this._objects){
            var _obj = this._objects[i];
            this.canvas.remove(_obj.originalObject);
          }
          this.canvas.discardActiveGroup();
          this.canvas.discardActiveObject();
        }else{
          this.canvas.remove(this);
        }
        this.canvas.renderAll();
      }
    },
    objectDuplicate: {
      className:  'fa fa-clone',
      insert:     'duplicateTool',
      title:      'Duplicate',
      action: function () {
        if(this.isSelectionGroup()){
          this.canvas.fire('before:selection:cleared', { target: this, e: null });
          this.canvas.discardActiveGroup();
          this.duplicate(function(el){
            el.ungroup();
          });

          this.canvas.renderAll();
        }else{
          this.duplicate();
        }
      }
    },
    selectGroup: {
      title: 'группа',
      className: 'fa fa-object-group',
      visible: function(){
        return this.isSelectionGroup();
      },
      action: function () {
        this.groupSelectedElements();
        this.canvas.renderAll();
      }
      //visible: IDE.groupAvailable
    },
    unselectGroup: {
      title: 'группа',
      className: 'fa fa-object-ungroup',
      visible: function(){
        return this.canvas._objects.indexOf(this) !== -1
      },
      action: function () {
        this.ungroup();
        this.canvas.renderAll();
      }
    }
  }
});


fabric.util.object.extend(fabric.SlideCanvas.prototype,{
  eventListeners: fabric.util.object.extendArraysObject(fabric.SlideCanvas.prototype.eventListeners, {
    'selection:created': function(event){
      this._onSelectionCreated(event);
    }
  }),
  _onSelectionModified: function () {
    for (var i in this._objects) {
      var copy = this._objects[i].cloneSync();
      copy.group = this;
      this._restoreObjectState(copy);
      this._objects[i].originalObject.set({
        left: copy.left,
        top: copy.top,
        angle: copy.angle,
        scaleX: copy.scaleX,
        scaleY: copy.scaleY,
        skewX: copy.skewX,
        skewY: copy.skewY,
        width: copy.width,
        height: copy.height
      });
    }
  },
  _onSelectionDeselected: function (data) {
    for (var i in this._objects) {
      var _obj = this._objects[i];
      _obj.originalObject.setCoords();
      _obj.originalObject.evented = true;
      delete _obj.originalObject.hiddenActive;
    }
  },
  _onSelectionCreated: function (el) {

    var group  = el.target;

    var originalObjects = []
    for(var i in group._objects){
      var _obj = group._objects[i];
      originalObjects.push(_obj.originalObject || _obj)
    }

    group.destroy();
    group._objects = [];

    var _clipTo = originalObjects[0].clipTo;

    for (var i in originalObjects) {
      var original = originalObjects[i];

      if (_clipTo != original.clipTo) {
        _clipTo = false;
      }

      var _obj = original.cloneSync();

      _obj.set({
        clipTo: null,
        originalObject: original
      });
      original.set({
        active:false,
        evented: false,
        hiddenActive: true
      });

      group.addWithUpdate(_obj);
      group.setCoords();
    }

    group.clipTo =  _clipTo;

    group.on({
      "modified": this._onSelectionModified,
      'deselected': this._onSelectionDeselected
    });

  }
});

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 73 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.MagicWand = __webpack_require__(8);

var MagicWand = fabric.MagicWand ;

/**
 * Pathfinder (Pathfinder) Interface for MagicWand selection tool
 * @param options
 * @constructor
 */
function Pathfinder(options) {
  this.initialize(options);
}

Pathfinder.prototype = {
  type: 'pathfinder',
  keepOldSelection: true,
  alphaChannel: true,
  pathfinderMode: 'new',
  selectionTool: 'magic',
  adjacentPixels: true,
  async: false,
  pathfinderTools: false,
  blurRadius: 0,
  hatchLength: 4,
  colorThreshold: 15,
  simplifyTolerant: 0,
  simplifyCount: 30,
  hatchOffset: 0,
  imageInfo: null,
  mask: null,
  downPoint: null,
  allowDraw: false,
  shapeSelectionTools: false,
  initialize: function (options) {

    options.application && options.application.fire('entity:created',{target : this,options : options})

    for (var i in options) {
      this[i] = options[i];
    }
  },
  asyncronous: function (cb) {
    if (this.async) {
      setTimeout(cb);
    } else {
      cb();
    }
  },
  fillWithCurrentColor: function () {
    this.fill(this.color);
  },
  clearMemory: function () {
    delete this.resultCanvas;
    delete this.editedImageCanvas;
    delete this.test_picture;
    delete this.mask;
  },
  hide: function () {
    if (this.editedImageCanvas) {
      this.editedImageCanvas.remove();
      this.resultCanvas.remove();
      clearInterval(this.interval);
      this.clearMemory();
      this.fire('hidden');
    }
  },
  setContainer: function (container) {
    if (container.constructor === String) {
      container = document.getElementById(container);
    }
    this.container = container;

    this.test_picture = new Image();
    this.test_picture.onload = this.initCanvas.bind(this);
    return this;
  },
  getSelectionTool: function () {
    return this.selectionTool;
  },
  setSelectionTool: function (tool) {
    this.selectionTool = tool;
    this.downPoint = false ;
    this.fire('tool:changed', tool);
  },
  getThreshold: function () {
    return this.colorThreshold;
  },
  setThreshold: function (thres) {
    if(thres !== undefined){
      this.colorThreshold = thres;
    }
    if (this.downPoint) {
      this.drawMask(this.downPoint.x, this.downPoint.y, this.adjacentPixels);
    }
    this.fire('threshold:changed', {threshold: this.colorThreshold});
  },
  setPicture: function (img) {
    this.setImage(img);
    var cvs = fabric.util.createCanvasElement();

    cvs.onmouseup = this.onMouseUp.bind(this);
    cvs.onmousedown = this.onMouseDown.bind(this);
    cvs.onmousemove = this.onMouseMove.bind(this);
    cvs.oncontextmenu = function () {
      return false;
    };
    this.initCanvas(cvs);
  },
  load: function (file) {
    if (!file)return;

    if (file.constructor === String) {
      Pathfinder.test_picture.setAttribute('src',file);
    } else {
      var reader = new FileReader();
      reader.onload = function (e) {
        this.test_picture.setAttribute('src', e.target.result);
      }.bind(this);
      reader.readAsDataURL(file);
    }
  },
  initCanvas: function (cvs) {
    var img = this.editedImageCanvas;
    if(this.resultCanvas){
      $(this.resultCanvas).remove()
    }
    this.resultCanvas = cvs;
    this.createSelectionDrawCanvas();


    this.context = cvs.getContext('2d');
    cvs.width = img.width;
    cvs.height = img.height;
    //this.setImage(img);
  },
  setImage: function (img) {
    this._test_todo_img = img;
    //this.mask = null;//MagicWand.createMask(img.width,img.height);
    this.editedImageCanvas = fabric.util.createCanvasElement();
    this.editedImageCanvas.width = img.width;
    this.editedImageCanvas.height = img.height;
    this.editedImageCanvas.getContext('2d').drawImage(img, 0, 0);
    this.initCanvas(fabric.util.createCanvasElement())
  },
  getInfo: function () {

    var ctx = this.editedImageCanvas.getContext('2d');
    var imageInfo = ctx.getImageData(0, 0, this.editedImageCanvas.width, this.editedImageCanvas.height);
    imageInfo.bytes = 4;
    return imageInfo;
  },
  getMousePosition: function (e) {
    var scale = this.resultCanvas.width / $(this.resultCanvas).width();
    var target = e.target || e.srcElement,
      rect = target.getBoundingClientRect(),
      offsetX = e.clientX - rect.left,
      offsetY = e.clientY - rect.top;
    return {x: Math.round(offsetX * scale), y: Math.round(offsetY * scale)};
  },
  radius: 20,
  resetSelectionDrawCanvas: function () {
    this.selectionDrawContext.fillStyle = "black";
    //this.selectionDrawContext(0, 0, canvas.width, canvas.height);
    this.selectionDrawContext.fillRect(0,0,this.selectionDrawCanvas.width,this.selectionDrawCanvas.height);
    this.selectionDrawContext.fillStyle = "white";
    this.selectionDrawContext.strokeStyle = "white";
  },
  createSelectionDrawCanvas: function () {

    if(this.selectionDrawCanvas ){
      $(this.selectionDrawCanvas ).remove();
    }
    this.selectionDrawCanvas = fabric.util.createCanvasElement();
    this.selectionDrawCanvas.width  = this.resultCanvas.width;
    this.selectionDrawCanvas.height = this.resultCanvas.height;
    this.selectionDrawContext = this.selectionDrawCanvas.getContext("2d");
    this.resetSelectionDrawCanvas();
  },
  _onMouseDown: function (point) {
    point.x = Math.min(Math.max(0, parseInt(point.x)), this.resultCanvas.width - 1);
    point.y = Math.min(Math.max(0, parseInt(point.y)), this.resultCanvas.height - 1);
    this.allowDraw = true;
    this.drawingTools[this.selectionTool].mouseDown.call(this,point);
  },
  onMouseDown: function (e) {
    e.preventDefault();
    e.stopPropagation();
    this._onMouseDown(this.getMousePosition(e));

  },
  _onMouseMove: function (p) {
    p.x = Math.min(Math.max(0, parseInt(p.x)), this.resultCanvas.width - 1);
    p.y = Math.min(Math.max(0, parseInt(p.y)), this.resultCanvas.height - 1);
    this.drawingTools[this.selectionTool].mouseMove.call(this,p);
  },
  onMouseMove: function (e) {
    var p = this.getMousePosition(e);
    this._onMouseMove(p);
  },
  color: [255, 0, 0, 255],
  onMouseUp: function (e) {
    this.allowDraw = false;
    this.drawingTools[this.selectionTool].mouseUp.call(this,e);
  },
  applyMask: function (canvas, left, top) {
    if (canvas.width === 0 || canvas.height === 0) {
      delete this.mask;
      this.render();
      return;
    }
    var info = this.getInfo(),
      mask = MagicWand.maskSelection(canvas,left,top) ;

    this.mask = mask;
    this.fire('selection:changed', {mask: mask, target: this.target});
  },
  setPathfinderMode: function (value) {
    this.pathfinderMode = value;
  },
  getPathfinderMode: function () {
    return this.pathfinderMode;
  },
  modifySelection: function (mask, pathfinderMode, noEvents) {
    this.shouldModify = false;
    if(this.selectionObject){
      this.selectionObject.remove();
    }
    this.downPoint = false;
    if (mask === undefined) {
      mask = this.mask;
    }
    if (pathfinderMode === undefined) {
      pathfinderMode = this.pathfinderMode;
    }
    if (pathfinderMode !== 'new' && this.oldMask) {
      mask = MagicWand[pathfinderMode](mask, this.oldMask);
    }
    if (this.blurRadius) {
      mask = MagicWand.gaussBlurOnlyBorder(mask, this.blurRadius);
    }
    //if (pathfinderMode !== 'new' && this.oldMask || this.blurRadius) {
    //  mask.cacheInd = MagicWand.getBorderIndices(mask);
    //}

    if(mask && mask.count && this.keepOldSelection){
      mask.makeCache();
      this.oldMask = mask;
    }else{
      delete this.oldMask ;
    }


    this.mask = MagicWand.createMask(this.editedImageCanvas.width, this.editedImageCanvas.height);
    if (!noEvents) {
      this.fire('selection:changed', {mask: mask, target: this.target});
    }
    this.render();
  },
  createSelection: function (mask) {
    if (this.shouldModify) {
      this.modifySelection();
    }

    this.mask = mask || MagicWand.createMask(this.editedImageCanvas.width, this.editedImageCanvas.height);
    this.render();
  },
  setSelection: function (mask) {
    this.mask = mask;
    this.render();
    this.fire('selection:changed', {mask: mask, target: this.target});
  },
  fill: function (color, callback) {
    this.asyncronous(function () {
      this._fill(color, false);
      callback && callback.call(this);
    }.bind(this), 0);
  },
  _fill: function (color, invert, canvas) {


    if (!this.mask) return;


    canvas = canvas || this.editedImageCanvas;
    var ctx = canvas.getContext('2d');//b.minX, b.minY, b.maxX - b.minX, b.maxY - b.minY);

    MagicWand.fillMask(ctx, this.mask, color);

    this.fire('image:changed', this.editedImageCanvas);
  },
  hatchTick: function () {
    this.hatchOffset = (this.hatchOffset + 1) % (this.hatchLength * 2);
    this.render(true);
  },
  show: function () {
    while (this.container.lastChild) {
      this.container.removeChild(this.container.lastChild);
    }
    this.container.appendChild(this.editedImageCanvas);
    this.container.appendChild(this.resultCanvas);
    this.interval = setInterval(this.hatchTick.bind(this), 300);

    this.fire('show');
  },
  clear: function (invert, canvas, callback) {
    this.asyncronous(function () {
      this._fill([0, 0, 0, 0], invert, canvas);
      callback && callback.call(this);
    }.bind(this), 0);
  },
  render: function (noBorder) {
    if (!this.context || !this.mask)return;

    var ctx = this.context;
    if (!noBorder) {
      this.mask.cacheInd = MagicWand.getBorderIndices(this.mask);
    }
    ctx.clearRect(0, 0, this.mask.width, this.mask.height);

    var _new_color = (!this.oldMask || this.pathfinderMode == "new" || this.pathfinderMode == "add"|| this.pathfinderMode == "exclude")
      ? this.newMaskColor : this.removedMaskColor;

    var _intersection_color;
    if(this.pathfinderMode == "add" || this.pathfinderMode == "new"|| this.pathfinderMode == "intersect"){
      _intersection_color = this.newMaskColor;
    }else{
      _intersection_color = this.removedMaskColor ;//intersectionRemovedMaskColor;
    }
    var _old_color;
    if(this.pathfinderMode == "exclude" || this.pathfinderMode == "substract"|| this.pathfinderMode == "add"){
      _old_color = this.newMaskColor;
    }else{
      _old_color = this.removedMaskColor;
    }

    this.oldMask && this.oldMask.render(ctx,{
      fill: _old_color
    });


    this.mask.render(ctx,{
      fill: _new_color,
      intersectionColor : _intersection_color,
      outerIntersectionColor : _old_color,
      // outerFill : "rgba(0,0,0,0.5)"
    });

    if(this.renderBorder){
      this.oldMask && this.oldMask.renderBorder(ctx,{});

      this.mask.renderBorder(ctx,{
        hatchOffset: this.hatchOffset
      });
    }

  },
  renderBorder: true,
  intersectionRemovedMaskColor: '#ffaaaa',
  removedMaskColor: '#aaaaff',
  newMaskColor:  '#aaFFaa' ,
  renderMask: function (ctx, mask, color, left, top) {
    mask = mask || this.mask;
    mask && mask.render(ctx,{
      intersectionColor: '#fff',
      outerIntersectionColor: '#000',
      fill :color || '#fff',
      left : left,
      top : top
    })
  },
  getContours: function () {
    if (!this.__cs) {
      this.__cs = MagicWand.traceContours(this.mask);
      this.__cs = MagicWand.simplifyContours(this.__cs, this.simplifyTolerant, this.simplifyCount);
    }
    return this.__cs;
  },
  traceInner: function (ctx) {

    var cs = this.getContours();
    var ctx = ctx || this.context;
    ctx.beginPath();
    for (var i = 0; i < cs.length; i++) {
      if (!cs[i].inner) continue;
      var ps = cs[i].points;
      ctx.moveTo(ps[0].x, ps[0].y);
      for (var j = 1; j < ps.length; j++) {
        ctx.lineTo(ps[j].x, ps[j].y);
      }
    }
    ctx.stroke();
  },
  getColor: function () {
    return 'rgba(' + this.color.join(', ') + ')';
  },
  setColor: function (color) {
    var _arr = color.substring(color.indexOf('(') + 1, color.length - 1).split(', ');
    for (var i in _arr) {
      _arr[i] = parseFloat(_arr[i]);
    }
    _arr[3] = Math.round(_arr[3] * 255);
    this.color = _arr;
  },
  trace: function (ctx) {
    var info = this.getInfo();
    var cs = MagicWand.traceContours(this.mask);
    cs = MagicWand.simplifyContours(cs, this.simplifyTolerant, this.simplifyCount);

    // draw contours
    var ctx = ctx || this.context;
    ctx.clearRect(0, 0, info.width, info.height);
    //inner
    ctx.beginPath();
    for (var i = 0; i < cs.length; i++) {
      if (!cs[i].inner) continue;
      var ps = cs[i].points;
      ctx.moveTo(ps[0].x, ps[0].y);
      for (var j = 1; j < ps.length; j++) {
        ctx.lineTo(ps[j].x, ps[j].y);
      }
    }
    ctx.strokeStyle = 'red';
    ctx.stroke();
    //outer
    ctx.beginPath();
    for (var i = 0; i < cs.length; i++) {
      if (cs[i].inner) continue;
      var ps = cs[i].points;
      ctx.moveTo(ps[0].x, ps[0].y);
      for (var j = 1; j < ps.length; j++) {
        ctx.lineTo(ps[j].x, ps[j].y);
      }
    }
    ctx.strokeStyle = 'blue';
    ctx.stroke();
  },
  removeNoise: function (threshold) {

    if(!this.mask || !this.mask.count)return;
    this.createSelectionDrawCanvas();
    //this.renderMask(this.selectionDrawContext, this.mask);

    var cs = MagicWand.traceContours(this.mask);
    cs = MagicWand.simplifyContours(cs, this.simplifyTolerant, this.simplifyCount);

    var ctx = this.selectionDrawContext, v = this.canvas.viewportTransform;

    //  cs = MagicWand.simplifyContours(cs, this.simplifyTolerant, this.simplifyCount);

    ctx.save();
    ctx.translate(0.5,0.5);
    ctx.fillStyle= "#fff";
    //ctx.fillStyle= "#0f0";
    ctx.strokeStyle= "#fff";
    for (var i = 0; i < cs.length; i++) {
      if (!cs[i].inner && cs[i].points.length > threshold) {
        var ps = cs[i].points;
        ctx.beginPath();
        ctx.moveTo(ps[0].x, ps[0].y);
        for (var j = 1; j < ps.length; j++) {
          ctx.lineTo(ps[j].x, ps[j].y);
        }
        ctx.closePath();
        ctx.fill();
      }

    }
    this.mask = MagicWand.maskSelection( this.selectionDrawCanvas);
    this.setSelection(this.mask);

    ctx.restore();
  },

  tools: [
    "adjacentPixels",
    "pathfinderRadius",
    "pathfinderThreshold",
    "selectionTool",
    "pathfinder",
    "fillWithCurrentColor",
    "clear",
    "pathfinderColor"
  ],
  actions : {

    cancelSelection: {
      visible: false,
      key:  'Escape',
      action: function(){
        delete this.shouldModify;
        this.mask = MagicWand.createMask(this.editedImageCanvas.width, this.editedImageCanvas.height);
      }
    },
    modifySelection: {
      visible: false,
      key:  'Enter',
      action: function(){
        if(this.shouldModify){
          this.modifySelection();
        }
      }
    },
    adjacentPixels: {
      className: 'button-adjacent',
      title: 'selet all',
      type: 'checkbox',
      value: 'adjacentPixels',
      visible: function () {
        return this.selectionTool === 'magic';
      },
      observe: 'tool:changed'
    },
    pathfinderRadius: {
      title: 'radius',
      type: 'range',
      value: {
        get: function () {
          return this.radius
        },
        set: function (val) {
          this.radius = val;
        },
        min: 1,
        max: 255
      },
      visible: function () {
        return this.selectionTool === 'brush';
      },
      observe: 'tool:changed'
    },
    pathfinderThreshold: {
      title: 'Threshold',
      type: 'range',
      value: {
        observe: 'threshold:changed',
        get: function () {
          return this.colorThreshold
        },
        set: function (val) {
          this.setThreshold(val);
        },
        min: 0,
        max: 255
      },
      visible: function () {
        return this.selectionTool === 'magic';
      },
      observe: 'tool:changed'
    },
    selectionTool: {
      title: 'selection-tool',
      type: 'options',
      value: 'selectionTool',
      menu: {
        selectionToolBrush: {
          className: 'fa fa-paint-brush',
          title: 'select-brush',
          option: 'brush'
        },
        selectionToolRectangle: {
          className: 'fa fa-square',
          title: 'select-rectangle',
          option: 'rectangle'
        },
        selectionElliptical: {
          className: 'fa fa-circle',
          title: 'select-circle',
          option: 'circle'
        },
        selectionToolMagic: {
          className: 'fa fa-magic',
          title: 'select-magic',
          option: 'magic'
        },
        selectionToolLasso: {
          use: 'shapeSelectionTools',
          title: 'select-lasso',
          option: 'lasso',
          icon: 'data:image/svg+xml;base64,'+ __webpack_require__(59)
        }
      }
    },
    pathfinder: {
      title: 'pathfinder',
      type: 'options',
      value: 'pathfinderMode',
      menu: {
        pathfinderNew: {
          title: 'pathfinder-new',
          option: 'new'
        },
        pathfinderExclude: {
          title: 'pathfinder-exclude',
          option: 'exclude'
        },
        pathfinderSubstract: {
          title: 'pathfinder-substract',
          option: 'substract'
        },
        pathfinderAdd: {
          title: 'pathfinder-add',
          option: 'add'
        },
        pathfinderIntersect: {
          title: 'pathfinder-intersect',
          option: 'intersect'
        }
      }
    },
    fillWithCurrentColor: {
      title: 'fillWithCurrentColor',
      className: 'fa fa-paint-brush'
    },
    clear: {
      className: 'fa fa-eraser',
      id:     'Pathfinder-clear',
      title:  'clear'
    },
    pathfinderColor: {
      title:  'color',
      type:   'color',
      value:  'color'
    }
  }
};

fabric.util.observable(Pathfinder.prototype);

fabric.util.object.extend(Pathfinder.prototype, fabric.ToolsMixin, {
  selectBackground: function (fromCorners) {
    var info = this.getInfo(), mask;

    if (fromCorners) {
      var mask1 = MagicWand.selectBackground(info, [255, 255, 255, false], this.colorThreshold);
      var mask2 = MagicWand.selectBackground(info, [false, false, false, 0], this.colorThreshold);
      mask = MagicWand.add(mask1, mask2);
    } else {
      mask = MagicWand.selectAllByColor(info, [255, 255, 255, 255], this.colorThreshold);
    }

    if (this.blurRadius) {
      mask = MagicWand.gaussBlurOnlyBorder(mask, this.blurRadius);
    }
    this.setSelection(mask);
  },
  colorSelection: function (colors, threshold) {
    var info = this.getInfo(), mask2,
      mask = MagicWand.createMask(info.width, info.height);
    for (var i in colors) {
      var _color = new fabric.Color(colors[i])._source;
      _color[3] = Math.round(_color[3] * 255);
      mask2 = MagicWand.selectAllByColor(info, _color, threshold[i])
      mask = MagicWand.add(mask, mask2);
    }
    delete this.oldMask;
    this.modifySelection(mask);
  },
  smartSelection: function (threshold) {
    var info = this.getInfo(), mask;
    mask = MagicWand.selectBackground(info, null, threshold || this.colorThreshold);
    mask = MagicWand.invertMask(mask);
    delete this.oldMask;
    this.modifySelection(mask);
  }
});


Pathfinder.prototype.drawingTools = {
  brush: {
    mouseUp: function(){
      this.modifySelection();
      this.resetSelectionDrawCanvas();
    },
    mouseMove: function(p){
      if (!this.allowDraw) return;
      this.drawCircle(p.x, p.y, this.radius);
    },
    mouseDown: function(point){
      this.createSelection();
      this.downPoint = point;
      this.createSelectionDrawCanvas();
      this.drawCircle(point.x, point.y, this.radius);
    },
    utils: {
      drawCircle: function (x, y, r) {
        var ctx = this.selectionDrawContext,
          v = this.canvas.viewportTransform;
        ctx.save();
        //  ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);
        ctx.beginPath();
        ctx.arc(x, y, this.radius, 0, Math.PI * 2, false);
        ctx.closePath();
        ctx.fill();
        ctx.restore();
        MagicWand.maskSelection( this.selectionDrawCanvas, 0,0, this.mask, 'add');
        this.setSelection(this.mask);
      }
    }
  },
  magic: {
    mouseUp: function(){
      this.shouldModify = true;
    },
    mouseMove: function (p){
      if (!this.allowDraw) return;
      var dist = p.x - this.downPoint.x;

      var val = this._init_thres + dist;
      var thres = Math.min(Math.max(val, 1), 255);
      if (thres != this.colorThreshold) {
        this.setThreshold(thres);
      }
    },
    mouseDown: function (point){
      if (this.shouldModify) {
        this.modifySelection();
      }
      this.downPoint = point;
      this.colorThreshold = 15;
      this.fire('threshold:changed', {threshold: this.colorThreshold});
      this._init_thres = this.colorThreshold;
      this.drawMask(this.downPoint.x, this.downPoint.y, this.adjacentPixels);
      return false;
    },
    utils:{
      drawMask: function (x, y, adjacentPixels) {
        this.asyncronous(this._drawMask.bind(this, x, y, adjacentPixels), 0);
      },
      _drawMask: function (x, y, adjacentPixels) {
        MagicWand.alphaChannel = this.alphaChannel;
        var info = this.getInfo(), mask;
        if (adjacentPixels) {
          MagicWand.floodFill(info, x, y, this.colorThreshold,{},null,function(mask){
            this.setSelection(mask);
          }.bind(this));
        } else {
          mask = MagicWand.selectAll(info, x, y, this.colorThreshold);
          this.setSelection(mask);
        }
      }
    }
  },
  rectangle: {
    mouseDown: function(point) {
      if (this.shouldModify) {
        this.modifySelection();
      }
      this.downPoint = point;
      this.shouldModify = true;
    },
    mouseUp: function(){
      //this.modifySelection();
      //this.resetSelectionDrawCanvas();
    },
    mouseMove: function(p){
      if (!this.allowDraw) return;
      this.drawRectangle(this.downPoint.x, this.downPoint.y, p.x, p.y);
    },
    utils:{
      drawRectangle: function (x, y, x2, y2) {
        var info = this.getInfo(),
          mask = MagicWand.selectRectangle(info, x, y, x2, y2);
        this.setSelection(mask);
      }
    }
  },
  circle: {
    mouseDown: function(point) {
      if (this.shouldModify) {
        this.modifySelection();
      }
      this.downPoint = point;
      this.createSelectionDrawCanvas();
      this.selectionObject = new fabric.Ellipse({
        left: point.x + this.target.left,
        top:  point.y + this.target.top,
        rx:1,
        ry:1,
        hasBorders: false,
        originX: 'center',
        originY: 'center',
        strokeWidth: 1,
        fill: 'transparent',
        stroke: 'transparent'
      });
      this.canvas.add(this.selectionObject);
      this.updateShape();
    },
    mouseUp: function(){
      this.canvas.setInteractiveMode("mixed");
      this.selectionObject.setCoords();
      var _this = this;
      this.selectionObject.on('scaling moving rotating',function(){
        _this.updateShape();
      });
      this.canvas.setActiveObject(this.selectionObject);
      this.shouldModify = true;
      //  this.modifySelection();
      //  this.resetSelectionDrawCanvas();
    },
    mouseMove: function(p){
      if (!this.allowDraw) return;
      this.selectionObject.set({
        rx: Math.abs((p.x + this.target.left -  this.selectionObject.get('left'))) ,
        ry: Math.abs((p.y + this.target.top  - this.selectionObject.get('top')))
      });

      this.updateShape();

    },
    utils:{
      updateShape: function () {
        this.resetSelectionDrawCanvas();
        this.selectionObject.fill = 'white';
        this.selectionDrawContext.save();
        this.selectionDrawContext.translate(-this.target.left, - this.target.top);
        this.selectionObject.render(this.selectionDrawContext);
        this.selectionDrawContext.restore();
        this.selectionObject.fill = 'transparent';
        this.mask = MagicWand.maskSelection( this.selectionDrawCanvas);
        this.setSelection(this.mask);
      }
    }
  },
  lasso: {
    mouseUp: function(){
      if(this.readyToClosePath) {
        this._closePath();
      }
    },
    mouseMove: function(p){
      if (!this.allowDraw) return;
      this.drawLine(this._last_point, p)
      this._points.push(p);
      this._last_point = p;
    },
    mouseDown: function(point){
      if(!this.downPoint){
        this.createSelection();
        this.createSelectionDrawCanvas();
        this._path_out = false;
        this.downPoint = point;
        this._points = [];
        this.selectionDrawContext.beginPath();
        this.canvas.on('mouse:move', this._changeCursorOverClosePoint);
      }
      if(this._last_point){
        if(this.readyToClosePath){
          this._closePath();
        }else{
          this.drawLine(this._last_point, point)
          this._last_point = point;
          this._points.push(point);
        }
      }else{

        this.drawLine({x:point.x - 0.5,y: point.y}, {x:point.x + 0.5,y: point.y })
        this._last_point = {x:point.x + 0.5,y: point.y };
        this._points.push(point);
        this.shouldModify = true;
      }
    },
    utils: {
      drawLine: function (p1 ,p2 ) {
        var ctx = this.selectionDrawContext,
          v = this.canvas.viewportTransform;
        ctx.save();
        //ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);
        ctx.moveTo(p1.x,p1.y);
        ctx.lineTo(p2.x,p2.y);
        ctx.stroke();
        ctx.restore();
        MagicWand.maskSelection(this.selectionDrawCanvas,0,0,this.mask,'add');
        this.setSelection(this.mask);
      },
      _closePath:  function (e) {

        this.allowDraw = false;
        var ctx = this.selectionDrawContext;
        ctx.beginPath();
        ctx.moveTo(this._points[0].x,this._points[0].y)
        for(var i = 1 ; i < this._points.length;i ++){
          ctx.lineTo(this._points[i].x,this._points[i].y)
        }
        ctx.closePath();
        ctx.fill();
        MagicWand.maskSelection(this.selectionDrawCanvas,0,0,this.mask,'add');
        this.setSelection(this.mask);
        this.resetSelectionDrawCanvas();
        this._points = [];
        delete this.downPoint;
        delete this.readyToClosePath;
        delete this._last_point;
        this.canvas.off('mouse:move', this._changeCursorOverClosePoint);
        this.canvas.freeDrawingCursor = 'crosshair';
        this.canvas.setCursor(this.canvas.freeDrawingCursor);
        // this.drawLine(this._last_point, this.downPoint);
      },
      _changeCursorOverClosePoint:  function (e) {
        var canvas = this,
          pathfinder = canvas.pathfinder;
        if(!pathfinder.target)return;
        var ivt = fabric.util.invertTransform(canvas.viewportTransform),
          p = fabric.util.transformPoint(canvas.getPointer(e.e, true), ivt);
        p.x -= pathfinder.target.left;
        p.y -= pathfinder.target.top;
        if ( pathfinder.downPoint && pathfinder.downPoint.distanceFrom(p) < 10) {
          if(!pathfinder._path_out){
            return;
          }
          pathfinder.readyToClosePath = true;
          canvas.freeDrawingCursor = canvas.targetCursor;
          canvas.setCursor(canvas.freeDrawingCursor);
          //console.log(canvas.freeDrawingCursor);
        } else {
          pathfinder._path_out = true;
          pathfinder.readyToClosePath = false;
          canvas.freeDrawingCursor = 'crosshair';
          canvas.setCursor(canvas.freeDrawingCursor);
          // console.log(canvas.freeDrawingCursor);
        }
      }
    }
  }
};
for(var i in Pathfinder.prototype.drawingTools){
  fabric.util.object.extend(Pathfinder.prototype, Pathfinder.prototype.drawingTools[i].utils)
}
fabric.Pathfinder = Pathfinder;




fabric.util.object.extend(fabric.SlideCanvas.prototype, {
  pathfinder: false,
  setPathfinder: function (val) {
    if (val) {
      this.pathfinder = new fabric.Pathfinder('pathfinder');
      this.pathfinder.canvas = this;
    }
  },
  getPathfinder: function () {
    return this.pathfinder || this.application && this.application.pathfinder;
  }
});

fabric.util.object.extend(fabric.Application.prototype, {
  initPathfinder: function () {
    //if(this.pathfinder){

      this.pathfinder = new fabric.Pathfinder({
        application: this
      });

      this.pathfinder.on("image:changed", function (img) {
        var dataUrl = img.toDataURL();
        if (!this.target._originalElement) {
          this.target._originalElement = this.target._element;
        }
        this.target._element = new Image();

        this.target._element.onload = function(){
          this.target.fire("content:modified")
          this.target.canvas && this.target.canvas.renderAll();
        }.bind(this);

        this.target._element.src = dataUrl;
        this.target._edited = true
        if(this.target.dirty !== "undefined"){
          this.target.dirty = true;
        }


      });
    //}
  }
});

fabric.util.object.extend(fabric.Application.prototype, {
  eventListeners: fabric.util.object.extendArraysObject(fabric.Application.prototype.eventListeners, {
    "ready": function () {
      this.initPathfinder();
    }
  })
});

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 74 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {


var _set_object_scale_overwritten = fabric.Canvas.prototype._setObjectScale;
var _setup_current_transform = fabric.Canvas.prototype._setupCurrentTransform;

fabric.util.object.extend(fabric.Canvas.prototype, {
  _setupCurrentScaleTransform: _setup_current_transform,
  _setupCurrentTransform: function (e, target) {
    if (!target)return;
    if (target.setupCurrentTransform) {
      return target.setupCurrentTransform(e);
    } else {
      if (target.resizable) {
        return this._setupCurrentResizeTransform(e, target);
      } else {
        return this._setupCurrentScaleTransform.call(this, e, target);
      }
    }
  },
  _setObjectScale: function (localMouse, transform, lockScalingX, lockScalingY, by, lockScalingFlip, _dim) {

    var t = transform.target;

    if (!_dim) {
      var strokeWidth = t.stroke ? t.strokeWidth : 0;
      _dim = {
        x: (t.width + (strokeWidth / 2)),
        y: (t.height + (strokeWidth / 2))
      }
    }

    if (t.setObjectScale) {
      return t.setObjectScale(localMouse, transform,
        lockScalingX, lockScalingY, by, lockScalingFlip, _dim);
    }
    else {
      if (t.resizable) {
        return this._setObjectSize(localMouse, transform,
          lockScalingX, lockScalingY, by, lockScalingFlip, _dim);
      } else {
        return _set_object_scale_overwritten.call(this, localMouse, transform,
          lockScalingX, lockScalingY, by, lockScalingFlip, _dim);
      }
    }
  },
  _setObjectSize: function (localMouse, transform, lockScalingX, lockScalingY, by, lockScalingFlip, _dim) {

    var target = transform.target, forbidScalingX = false, forbidScalingY = false;
    var _stroke = transform.target.strokeWidth || 0;
    transform.newWidth = this.width * ((localMouse.x / transform.scaleX) / (this.width + _stroke));
    transform.newHeight = this.height * ((localMouse.y / transform.scaleY) / (this.height + _stroke));

    if(this.wholeCoordinates || target.wholeCoordinates){
      transform.newWidth = Math.round(transform.newWidth);
      transform.newHeight = Math.round(transform.newHeight);
    }
    if(transform.newHeight < 0 ){
      target.top = transform.top - transform.newHeight;
    }
    if (target.minWidth && transform.newWidth <= target.minWidth) {
      transform.newWidth = target.minWidth;
    }
    if (target.minHeight && transform.newHeight <= target.minHeight) {
      transform.newHeight = target.minHeight;
    }
    if (lockScalingFlip && transform.newWidth < target.width) {
      forbidScalingX = true;
    }
    if (lockScalingFlip && transform.newHeight < target.height) {
      forbidScalingY = true;
    }

    if (by === 'equally') {
      forbidScalingX || forbidScalingY || this._resizeObjectEqually(localMouse, target, transform, _dim);
    }
    else if (!by) {
      forbidScalingX || target.setWidth(transform.newWidth);
      forbidScalingY || target.setHeight(transform.newHeight);
    }
    else if (by === 'x' && !target.get('lockUniScaling')) {
      forbidScalingX || target.setWidth(transform.newWidth);
    }
    else if (by === 'y' && !target.get('lockUniScaling')) {
      forbidScalingY || target.setHeight(transform.newHeight);
    }
    return !forbidScalingX && !forbidScalingY;
    //transform.newWidth -= _stroke;
    //transform.newHeight -= _stroke;
  },
  _setupCurrentResizeTransform: function (e, target) {
    this._setupCurrentScaleTransform(e, target);
    this._currentTransform.original.height = target.height;
    this._currentTransform.original.width = target.width;
  },
  _resizeObjectEqually: function (localMouse, target, transform, _dim) {

    var dist = localMouse.y + localMouse.x,
      lastDist = _dim.y * transform.original.height / target.height +
        _dim.x * transform.original.width / target.width;

    transform.newWidth = transform.original.width * dist / lastDist;
    transform.newHeight = transform.original.height * dist / lastDist;

    var ratio = transform.original.height / transform.original.width;
    if (ratio > 1) {
      if (target.minWidth && transform.newWidth <= target.minWidth) {
        transform.newWidth = target.minWidth;
        transform.newHeight = target.minHeight * ratio;
      }
    } else {
      if (target.minHeight && transform.newHeight <= target.minHeight) {
        transform.newHeight = target.minHeight;
        transform.newWidth = target.minWidth / ratio;
      }
    }

    target.setWidth(transform.newWidth);
    target.setHeight(transform.newHeight);
  }
});

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 75 */
/***/ (function(module, exports, __webpack_require__) {


var utils = __webpack_require__(3);
utils.object = __webpack_require__(2);


/***********************************************************************************************************************
 ** DPHistory
 ***********************************************************************************************************************/


var DPHistory = function (parent, initAction) {
    this.parent = parent;
    this.clear(initAction);
};

DPHistory.prototype.setRecords = function (records,current) {
  this.canUndo = records.length;
  this.canRedo = false;

  if(!records.length){
    records = [{
      type: 'initialized',
      id: 0,
      text : 'initialized'
    }]
  }
  this.records = records;
  this.length = this.records.length ;
  this.current = current === undefined ? records.length - 1 : current;
  this.activeAction = this.records[this.current];
  this.fire("changed",{action: this.activeAction});
  return this;
};

DPHistory.prototype.restore = function () {
  this.setRecords(this.saved.records,this.saved.current);
  return this;
};

DPHistory.prototype.save = function () {
  this.saved = {
    current: this.current,
    records: utils.object.cloneDeep(this.records)
  }
  return this;
};

DPHistory.prototype.clear = function (initAction) {
    if (initAction) {
        initAction.id = 0;
    } else {
        initAction = {
            type: 'initialized',
            id: 0,
          text : 'initialized'
        }
    }
    this.records = [initAction];
    this.current = 0;
    this.canUndo = false;
    this.canRedo = false;
    this.activeAction = this.records[this.current];
  this.fire("changed",{action: this.activeAction});
  return this;
};


DPHistory.prototype.add = function(action){


    if (!this.enabled || this.processing) {
      return false;
    }

    action.moment = new Date().getTime();
    this.canUndo = true;
    this.canRedo = false;
    this.records.splice(this.current+ 1);
    this.records.push(action);
    this.length = this.records.length;
    action.id = this.length - 1;
    action.text = action.type || action.text;
    this.current = this.length - 1;

  this.activeAction = this.records[this.current];
  this.fire("changed",{action: action});
  return this;
};
DPHistory.prototype.disable = function(){
  this.enabled = false;
  return this;
};
DPHistory.prototype.enable = function(){
  this.enabled = true;
  return this;
};
DPHistory.prototype.undo = function(noFire){
    this.canRedo = true;
    var _action = this.records[this.current];
    this.current--;
  this.processing = true;
    _action.undo.call(this.parent,_action);
  this.processing = false;
    if(this.current == 0){
        this.canUndo = false;
    }
    if(!noFire){
      this.activeAction = this.records[this.current];
      this.fire("changed",{action: _action});
    }
  return this;
};

DPHistory.prototype.goto = function(index){
    if(index == this.current)return;
    if(index < this.current){
        for(var i = this.current - index ;i--; ){
            this.undo(true);
        }
    }if(index > this.current){
        for(var i = index - this.current ;i--; ){
            this.redo(true);
        }
    }
  this.activeAction = this.records[this.current];
  this.fire("changed",{action: this.activeAction});
  return this;
};

DPHistory.prototype.redo = function(noFire){
    if(this.current == this.length - 1){
        return;
    }
  this.processing = true;
    this.canUndo = true;
    this.current++;
    var _action = this.records[this.current];

    _action.redo.call(this.parent,_action);

    if(this.current == this.length - 1){
        this.canRedo = false;
    }
  this.processing = false;
  if(!noFire) {
    this.activeAction = this.records[this.current];
    this.fire("changed",{action: _action});
  }
  return this;
};
utils.observable(DPHistory.prototype);
module.exports = DPHistory;


/***/ }),
/* 76 */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(fabric) {
fabric.util.object.extend(fabric.PathGroup.prototype,{
  initialize_overwritten: fabric.PathGroup.prototype.initialize,
  initialize: function(paths, options){

    if(paths.constructor != Array){
      options = paths.toObject();
      delete options.paths;
      paths = paths.paths;
    }

    this.initialize_overwritten(paths, options);
  },
  extractColors: function () {
    var _colors = {};
    var _paths = this.paths;
    for (var i in _paths) {
      if (_paths[i].fill.type) {
        for (var j in _paths[i].fill.colorStops) {
          var _color = _paths[i].fill.colorStops[j].color;
          if (!_colors[_color]) _colors[_color] = [];
          _colors[_color].push({object: _paths[i], stop: _paths[i].fill.colorStops[j]});
        }

      } else {
        var _color = _paths[i].fill;
        if (!_colors[_color]) _colors[_color] = [];
        _colors[_color].push({object: _paths[i], color: _paths[i]});
      }
    }
    return _colors;
  }
})

fabric.PathGroup.fromElements = function (elements, object, url) {
  var _options = {
    toBeParsed: true,
    //originX: "center",
    //originY: "center"
  };

  //смещаем элементы так, чтобы их кооринаты начинались от 0.0
  if (elements.length) {

    var minX = Infinity,
      minY = Infinity;
    for (var i in elements) {
      minX = Math.min(elements[i].left, minX);
      minY = Math.min(elements[i].top, minY);
    }


    minX = Math.max(minX, 0);
    minY = Math.max(minY, 0);
    /* for (var i in elements) {
     elements[i].translate(-minX, -minY);
     elements[i].left -= minX;
     elements[i].pathOffset.x -= minX;
     elements[i].top -= minY;
     elements[i].pathOffset.y -= minY;
     }*/
  }

  var el = fabric.util.groupSVGElements(elements, _options, url);

  var scaleX = object.width ? object.width / el.width : null,
    scaleY = object.height ? object.height / el.height : null;
  if (scaleX && !scaleY) {
    scaleY = scaleX;
  }
  if (scaleY && !scaleX) {
    scaleX = scaleY;
  }
  if (!scaleY && !scaleX) {
    scaleX = scaleY = 1;
  }

  delete object.height;
  delete object.width;
  el.set(fabric.util.object.extend(object, {
    //left: 0, top: 0,
    scaleX: scaleX,
    scaleY: scaleY
  }));
  el.setLeft(object.left);
  el.setTop(object.top);
  return el;
};

// fabric.PathGroup.prototype.render = function(ctx,noTransform) {
//   if (!this.visible) {
//     return;
//   }
//   var x = noTransform ? 0 : - this.width * this.scaleX / 2,
//     y = noTransform ? 0 : - this.height * this.scaleY / 2;
//
//   ctx.save();
//   ctx.translate(x,y);
//
//   if (this.transformMatrix) {
//     ctx.transform.apply(ctx, this.transformMatrix);
//   }
//   this.transform(ctx);
//
//   this._setShadow(ctx);
//   this.clipTo && fabric.util.clipContext(this, ctx);
//   ctx.translate(-this.width/2, -this.height/2);
//   for (var i = 0, l = this.paths.length; i < l; ++i) {
//     this.paths[i].render(ctx, true);
//   }
//   this.clipTo && ctx.restore();
//   ctx.restore();
// }






fabric.PathGroup.fromURL = function (url, callback, object) {

  fabric.loadSVGFromURL(url,function(els){

    var el = new fabric.PathGroup(els, {toBeParsed:true});

    // //смещаем элементы так, чтобы их кооринаты начинались от 0.0
    // if (el.paths.length) {
    //
    //   var minX = Infinity,
    //     minY = Infinity;
    //   var maxX = -Infinity,
    //     maxY = -Infinity;
    //
    //   for (var i in el.paths) {
    //     var _p = el.paths[i];
    //     minX = Math.min(_p.left, minX);
    //     minY = Math.min(_p.top, minY);
    //     maxX = Math.max(_p.left + _p.width, maxX);
    //     maxY = Math.max(_p.top + _p.height, maxY);
    //   }
    //
    //   var _W = maxX - minX;
    //   var _H = maxY - minY;
    //   //
    //   //
    //   // minX = Math.max(minX, 0);
    //   // minY = Math.max(minY, 0);
    //   /* for (var i in elements) {
    //    elements[i].translate(-minX, -minY);
    //    elements[i].left -= minX;
    //    elements[i].pathOffset.x -= minX;
    //    elements[i].top -= minY;
    //    elements[i].pathOffset.y -= minY;
    //    }*/
    // }else{
    //   _W = 1;
    //   _H = 1;
    // }

    var scaleX = object.width ? object.width / el.width : null,
      scaleY = object.height ? object.height / el.height : null;
    if (scaleX && !scaleY) {
      scaleY = scaleX;
    }
    if (scaleY && !scaleX) {
      scaleX = scaleY;
    }
    if (!scaleY && !scaleX) {
      scaleX = scaleY = 1;
    }
    // console.log(object.width,el.width,object.height,el.height)
    // console.log(el);
    el.set( {
      scaleX: scaleX ,
      scaleY: scaleY
    });

    callback(el);
  });

  // fabric.loadSVGFromURL(url,function(els){
  //   callback(fabric.PathGroup.fromElements(els, object));
  // });
};

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 77 */
/***/ (function(module, exports, __webpack_require__) {

if(!$.minicolors){
    __webpack_require__(64);
}

if(typeof Toolbar === "undefined"){
  var Toolbar = __webpack_require__(1);
}

Toolbar.prototype.colorpicker = function (el, options) {
  options.format = 'rgb';
  options.opacity = true;
  el.minicolors(options);
};

Toolbar.prototype.colorpickerOptions = {
  position: "right bottom"
};

Toolbar.prototype.tools.color = {
  template:
    '<div class="object-menu-item" title="{title}">' +
    '<div class="btn button-{id} {className}">' +
    '<input type="text" data-format="rgba" data-opacity="true" data-text="true" data-control="saturation" data-swatches="#fff|#000|#f00|#0f0|#00f|#ff0|#0ff"  value="{valueCurrent}" transclude>',
  post: function ($item, data, options, transclude) {
    var target = data.target;

    var _visible = false;
    this.colorpicker(transclude, {
      // value:        data.value.get() ,//|| data.value.get(),
      defaultValue: /*data.value.defaultValue ||*/ data.value.get(),
      control:      transclude.attr('data-control') || 'hue',
      format:       transclude.attr('data-format') || 'hex',
      keywords:     transclude.attr('data-keywords') || '',
      inline:       transclude.attr('data-inline') === 'true',
      letterCase:   transclude.attr('data-letterCase') || 'lowercase',
      opacity:      transclude.attr('data-opacity'),
      position:     transclude.attr('data-position') || this.colorpickerOptions.position,
      swatches:     transclude.attr('data-swatches') ? transclude.attr('data-swatches').split('|') : [],
      text:     transclude.attr('data-text'),
      hide: function () {
        _visible = false
      },
      show: function () {
        _visible = true;
      },
      change: function (value, opacity) {
        data.value.set(value);
      }
    });

    var _el = $(transclude.parents()[0]).find(".minicolors-panel");

    var _HIDE = function(e){
      if(_visible && $(e.target).parents().index(_el) == -1){
        transclude.minicolors("hide");
      }
    };
    $("body").on("mousedown",_HIDE)
  }
};


/***/ }),
/* 78 */
/***/ (function(module, exports, __webpack_require__) {


if(typeof Toolbar === "undefined"){
  var Toolbar = __webpack_require__(1);
}

Toolbar.prototype.colorpicker = function (el, options) {
  options.format = 'rgb';
  options.opacity = true;
  el.minicolors(options);
};

Toolbar.prototype.tools.effect = {
  scope: function (data, options) {
    return {
      buttonsTitle: options.buttons && options.buttons.title || false,
      isParameters: !!data.actionParameters,
      buttonscClassName: (options.buttons && options.buttons.className || '')
    }
  },
  template: '<div class="object-menu-item" title="{title}">' +
      '<button class="btn button-{id} {className} {buttonscClassName}">' +
      '<span dp-if="buttonsTitle" class="button-title">{title}</span>' +
      '</button>' +
      '<div dp-if="isParameters" class="menu-action-parameters" style="display: none" transclude></div>' +
    '</div>',
    post: function ($item, data, options, transclude) {

    if(data.container){
      transclude = $(document.getElementById(data.container));
    }

    var $tpl;
    var foo = function () {
      if (data.effectTpl) {
        $tpl = $(data.effectTpl);
        transclude.html($tpl);
      }
      if (data.actionParametersId) {
        $tpl = $("#" + data.actionParametersId).clone();
        transclude.html($tpl);
      }
      return data.actionParameters.call(data.target, transclude, data, options);
    };
    this.toggleByButton($item, transclude, foo ,data);
  }
};


/***/ }),
/* 79 */
/***/ (function(module, exports, __webpack_require__) {


if(!$.fontSelector){
  __webpack_require__(63);
}

if(typeof Toolbar === "undefined"){
  var Toolbar = __webpack_require__(1);
}

Toolbar.prototype.fonts = [
  'Arial,Helvetica,sans-serif',
  'Arial Black,Gadget,sans-serif',
  'Comic Sans MS,cursive',
  'Courier New,Courier,monospace',
  'Georgia,serif',
  'Impact,Charcoal,sans-serif',
  'Lucida Console,Monaco,monospace',
  'Lucida Sans Unicode,Lucida Grande,sans-serif',
  'Palatino Linotype,Book Antiqua,Palatino,serif',
  'Tahoma,Geneva,sans-serif',
  'Times New Roman,Times,serif',
  'Trebuchet MS,Helvetica,sans-serif',
  'Verdana,Geneva,sans-serif',
  'Gill Sans,Geneva,sans-serif'
];


Toolbar.prototype.tools.fontFamily = {
  scope: function (data, options) {
    return {
      //currentValue: data.value.get(),
      onchange: function (e) {
        data.value.set(parseFloat($(e.target).val()));
      }
    }
  },
  template: '<div class="object-menu-item object-menu-font-family" title="{title}">' +
  '<div class="fontSelect" transclude><div class="arrow-down">',
    post: function ($item, data, options, transclude) {

    transclude.fontSelector({
      'hide_fallbacks': true,
      'initial': data.value.get(),//'Courier New,Courier New,Courier,monospace',
      'selected': data.value.set.bind(data.target),
      'fonts': data.data
    });
  }
};


/***/ }),
/* 80 */
/***/ (function(module, exports, __webpack_require__) {

;
if(typeof Toolbar === "undefined"){
  var Toolbar = __webpack_require__(1);
}

Toolbar.prototype.updateSelectedOption = function(data){
  var $checked = data.$item.find(":checked");
  var $checkedOptionEl = $($checked.parents()[0]);


  var selOption = data.$item.find('.btn-selected-option');
  selOption.html( $checkedOptionEl.find("label")[0].outerHTML );
};

Toolbar.prototype.tools.option = {
  scope: function (data, options) {
    var _self = this;
    return {
      parentId: data.parent.id,
      valueCurrent: data.parent.value.get() === data.option,
      onchange: function () {
        //оптимизировать

        var $checked = data.$item.find(":checked");
        var _value = $checked.val();
        if (_value == data.option) {
          data.parent.value.set(_value);
        }
        _self.updateSelectedOption(data.parent);
      }
    }
  },
  template:
    '<div class="object-menu-item object-menu-option " title="{title}" >' +
    '<input type="radio" id="tool-{id}" dp-checked="{valueCurrent}" name="{parentId}" value="{option}" onchange="onchange()">' +
    '<label class="btn button-{id} {className}" for="tool-{id}">' +
      '<img dp-if="icon" dp-src="icon">' +
      '<span dp-include="svg" dp-if="svg"></span>' +
      '<span dp-if="title" class="option-title">{title}</span>'
};

Toolbar.prototype.tools.options = {
  scope: function (data, options) {
    return {
      className: data.className || 'items-column',
      buttonsTitle: options.buttons && options.buttons.title || false,
      buttonsClassName: (options.buttons.className || '')
    }
  },
  template:
  '<div class="object-menu-item object-menu-options {className}" title="{title}">' +
  '<div class="btn-selected-option"></div>' +
  '<div class="object-menu-options-container" transclude>',
  post: function ($item, data, options, transclude) {
    this.generateMenu(data.target, transclude, options, data.menu);
    this.updateSelectedOption(data);
  }
};


/***/ }),
/* 81 */
/***/ (function(module, exports, __webpack_require__) {

;
if(typeof Toolbar === "undefined"){
  var Toolbar = __webpack_require__(1);
}

Toolbar.prototype.tools.select =  {
  scope: function (data, options) {
    return {
      getInputValue: function () {
        return parseFloat(data.$item.find("input").val());
      },
      getValue: data.value.get,
      setValue: data.value.set,
      onchange: function (e,model) {
        data.value.set(e.params.data.id,model);
      }
    }
  },
  template: '<div class="object-menu-item object-menu-select {itemClassName}" title="{title}" ><label for="xxx" class="btn button-{id} {className}"></label><select id="xxx">',
  post: function ($item, data, options, tool, val) {
    var model =  data.value.options();
    var _val = data.value.get();
    var _select = $item.find("select");
    _select.dpSelect({
      minimumResultsForSearch: Infinity,
      dropdownParent: $("body"),
      data:  model,
      templateSelection: function(state, container) {
        return data.templateSelection(state, container,data);
      },
      templateResult: function(state, container){
        return data.templateResult(state, container,data);
      },
    }).on("select2:select", function(e) {
      data.onchange(e, model);
    });
    _select.dpSelect("val",[_val]);
  }
}


/***/ }),
/* 82 */
/***/ (function(module, exports) {

module.exports = require("fs");

/***/ })
/******/ ]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmllcmEuZGV2LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3dlYnBhY2svYm9vdHN0cmFwIGExZTY2MjBjN2UzODJhOGFlYzZlIiwid2VicGFjazovLy9leHRlcm5hbCBcImZhYnJpY1wiIiwid2VicGFjazovLy8uLi90b29sYmFyL3NyYy90b29sYmFyLmpzIiwid2VicGFjazovLy8uL3V0aWwvb2JqZWN0LmpzIiwid2VicGFjazovLy8uL3V0aWwvdXRpbC5qcyIsIndlYnBhY2s6Ly8vLi9jb3JlL3N0YXRpYy1jYW52YXMuZXh0LmpzIiwid2VicGFjazovLy8uL3V0aWwvY29tcGlsZS5qcyIsIndlYnBhY2s6Ly8vLi91dGlsL3BhdGguanMiLCJ3ZWJwYWNrOi8vLy4vbWl4aW5zL3Byb3BvcnRpYW5hbFNpemVNaXhpbi5qcyIsIndlYnBhY2s6Ly8vLi9wbHVnaW5zL21hZ2ljd2FuZC5qcyIsIndlYnBhY2s6Ly8vZXh0ZXJuYWwgXCIkXCIiLCJ3ZWJwYWNrOi8vLy4vbWVkaWEvZXJyb3ItYnV0dG9uLnN2ZyIsIndlYnBhY2s6Ly8vLi9icnVzaGVzL0Jhc2VCcnVzaC5qcyIsIndlYnBhY2s6Ly8vLi9icnVzaGVzL1BhaW50QnVja2V0QnJ1c2guanMiLCJ3ZWJwYWNrOi8vLy4vYnJ1c2hlcy9QYWludFBlbkJydXNoLmpzIiwid2VicGFjazovLy8uL2JydXNoZXMvUGVuY2lsQnJ1c2guanMiLCJ3ZWJwYWNrOi8vLy4vYnJ1c2hlcy9Qb2ludHNCcnVzaC5qcyIsIndlYnBhY2s6Ly8vLi9icnVzaGVzL1BvbHlnb25CcnVzaC5qcyIsIndlYnBhY2s6Ly8vLi9icnVzaGVzL1JlY3RhbmdsZUJydXNoLmpzIiwid2VicGFjazovLy8uL2NvcmUvYXBwbGljYXRpb24uanMiLCJ3ZWJwYWNrOi8vLy4vY29yZS9hcHBsaWNhdGlvbi5wcm90b3R5cGVzLmpzIiwid2VicGFjazovLy8uL2NvcmUvYXBwbGljYXRpb24uc2xpZGVzLmpzIiwid2VicGFjazovLy8uL2NvcmUvYmFzZS5qcyIsIndlYnBhY2s6Ly8vLi9jb3JlL2dyb3VwLmV4dC5qcyIsIndlYnBhY2s6Ly8vLi9jb3JlL2ltYWdlLmV4dC5qcyIsIndlYnBhY2s6Ly8vLi9jb3JlL29iamVjdC5leHQuanMiLCJ3ZWJwYWNrOi8vLy4vY29yZS9vYnNlcnZlLmpzIiwid2VicGFjazovLy8uL2NvcmUvc2xpZGUuanMiLCJ3ZWJwYWNrOi8vLy4vY29yZS90ZXh0LmV4dC5qcyIsIndlYnBhY2s6Ly8vLi9tb2R1bGVzL2JvcmRlckltYWdlLmpzIiwid2VicGFjazovLy8uL21vZHVsZXMvY2FudmFzLmV2ZW50cy5qcyIsIndlYnBhY2s6Ly8vLi9tb2R1bGVzL2NsaXBUby5qcyIsIndlYnBhY2s6Ly8vLi9tb2R1bGVzL2RlYnVnLmpzIiwid2VicGFjazovLy8uL21vZHVsZXMvZHJvcHBhYmxlLmpzIiwid2VicGFjazovLy8uL21vZHVsZXMvZm9udHMuanMiLCJ3ZWJwYWNrOi8vLy4vbW9kdWxlcy9mcm9tVVJMLmpzIiwid2VicGFjazovLy8uL21vZHVsZXMvZ2FsbGVyeS5qcyIsIndlYnBhY2s6Ly8vLi9tb2R1bGVzL2hpc3RvcnkuanMiLCJ3ZWJwYWNrOi8vLy4vbW9kdWxlcy9pbWFnZS5maWx0ZXJzLmpzIiwid2VicGFjazovLy8uL21vZHVsZXMvaW50ZXJhY3RpdmVNb2RlLmpzIiwid2VicGFjazovLy8uL21vZHVsZXMvbGlicmFyeS5qcyIsIndlYnBhY2s6Ly8vLi9tb2R1bGVzL2xvYWRlci5qcyIsIndlYnBhY2s6Ly8vLi9tb2R1bGVzL21vdmVtZW50TGltaXRzLmpzIiwid2VicGFjazovLy8uL21vZHVsZXMvcmVuZGVyLmpzIiwid2VicGFjazovLy8uL21vZHVsZXMvc2F2ZUFzLmpzIiwid2VicGFjazovLy8uL21vZHVsZXMvc2xpZGUuZHJhd2luZy10b29scy5qcyIsIndlYnBhY2s6Ly8vLi9tb2R1bGVzL3RodW1iLmpzIiwid2VicGFjazovLy8uL21vZHVsZXMvdG9vbGJhci5qcyIsIndlYnBhY2s6Ly8vLi9tb2R1bGVzL3VwbG9hZC5qcyIsIndlYnBhY2s6Ly8vLi9tb2R1bGVzL3pvb20uanMiLCJ3ZWJwYWNrOi8vLy4vc2hhcGVzL2NsaXBhcnQuanMiLCJ3ZWJwYWNrOi8vLy4vc2hhcGVzL2ltYWdlLnBob3Rvc2hvcC10b29scy5qcyIsIndlYnBhY2s6Ly8vLi9zaGFwZXMvaW1hZ2UucmVtb3ZlLXdoaXRlLmpzIiwid2VicGFjazovLy8uL3NoYXBlcy9wYXRoLmpzIiwid2VicGFjazovLy8uL3NoYXBlcy90ZXh0Ym94Lmxpc3QuanMiLCJ3ZWJwYWNrOi8vLy4vdXRpbC9kYXRhLmpzIiwid2VicGFjazovLy8uL3V0aWwvbG9hZGVyLmpzIiwid2VicGFjazovLy8uL3V0aWwvc3ludGF4LmpzIiwid2VicGFjazovLy8od2VicGFjaykvYnVpbGRpbi9hbWQtZGVmaW5lLmpzIiwid2VicGFjazovLy8od2VicGFjaykvYnVpbGRpbi9hbWQtb3B0aW9ucy5qcyIsIndlYnBhY2s6Ly8vLi9tZWRpYS9sYXNzby5zdmciLCJ3ZWJwYWNrOi8vLy4vbWVkaWEvbG9hZGVyLnN2ZyIsIndlYnBhY2s6Ly8vLi9tZWRpYS9wYWludC1idWNrZXQuc3ZnIiwid2VicGFjazovLy8uL21lZGlhL3BvbHlnb24ucG5nIiwid2VicGFjazovLy8uLi9wbHVnaW5zLyQuZm9udFNlbGVjdG9yLmpzIiwid2VicGFjazovLy8uLi9wbHVnaW5zLyQubWluaWNvbG9ycy5qcyIsIndlYnBhY2s6Ly8vLi4vcGx1Z2lucy9zYXZlQXMuanMiLCJ3ZWJwYWNrOi8vLy4uL3BsdWdpbnMvd2ViZm9udC5qcyIsIndlYnBhY2s6Ly8vLi9maWVyYS5qcyIsIndlYnBhY2s6Ly8vLi9maWx0ZXJzL3JlbW92ZVdoaXRlLmpzIiwid2VicGFjazovLy8uL21peGlucy9jYWNoZU1peGluLmpzIiwid2VicGFjazovLy8uL21peGlucy9zdHJva2VNaXhpbi5qcyIsIndlYnBhY2s6Ly8vLi9tb2R1bGVzL2FyZWFzLmpzIiwid2VicGFjazovLy8uL21vZHVsZXMvZ3JvdXBzLmpzIiwid2VicGFjazovLy8uL21vZHVsZXMvcGF0aGZpbmRlci5qcyIsIndlYnBhY2s6Ly8vLi9tb2R1bGVzL3Jlc2l6YWJsZS5qcyIsIndlYnBhY2s6Ly8vLi9wbHVnaW5zL2hpc3RvcnkuanMiLCJ3ZWJwYWNrOi8vLy4vc2hhcGVzL1BhdGhHcm91cC5qcyIsIndlYnBhY2s6Ly8vLi4vdG9vbGJhci9tb2R1bGVzL3Rvb2xiYXIuY29sb3JzLmpzIiwid2VicGFjazovLy8uLi90b29sYmFyL21vZHVsZXMvdG9vbGJhci5lZmZlY3QuanMiLCJ3ZWJwYWNrOi8vLy4uL3Rvb2xiYXIvbW9kdWxlcy90b29sYmFyLmZvbnRzLmpzIiwid2VicGFjazovLy8uLi90b29sYmFyL21vZHVsZXMvdG9vbGJhci5vcHRpb25zLmpzIiwid2VicGFjazovLy8uLi90b29sYmFyL21vZHVsZXMvdG9vbGJhci5zZWxlY3QuanMiLCJ3ZWJwYWNrOi8vL2V4dGVybmFsIFwiZnNcIiJdLCJzb3VyY2VzQ29udGVudCI6WyIgXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuXG4gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXG4gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkge1xuIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuIFx0XHR9XG4gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbiBcdFx0XHRpOiBtb2R1bGVJZCxcbiBcdFx0XHRsOiBmYWxzZSxcbiBcdFx0XHRleHBvcnRzOiB7fVxuIFx0XHR9O1xuXG4gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4gXHRcdG1vZHVsZS5sID0gdHJ1ZTtcblxuIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4gXHR9XG5cblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuXG4gXHQvLyBpZGVudGl0eSBmdW5jdGlvbiBmb3IgY2FsbGluZyBoYXJtb255IGltcG9ydHMgd2l0aCB0aGUgY29ycmVjdCBjb250ZXh0XG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmkgPSBmdW5jdGlvbih2YWx1ZSkgeyByZXR1cm4gdmFsdWU7IH07XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwge1xuIFx0XHRcdFx0Y29uZmlndXJhYmxlOiBmYWxzZSxcbiBcdFx0XHRcdGVudW1lcmFibGU6IHRydWUsXG4gXHRcdFx0XHRnZXQ6IGdldHRlclxuIFx0XHRcdH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7XG4gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuIFx0XHRcdGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuIFx0XHRyZXR1cm4gZ2V0dGVyO1xuIFx0fTtcblxuIFx0Ly8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDY3KTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyB3ZWJwYWNrL2Jvb3RzdHJhcCBhMWU2NjIwYzdlMzgyYThhZWM2ZSIsIm1vZHVsZS5leHBvcnRzID0gZmFicmljO1xuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIGV4dGVybmFsIFwiZmFicmljXCJcbi8vIG1vZHVsZSBpZCA9IDBcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiXG52YXIgdXRpbHMgPSByZXF1aXJlKCcuLy4uLy4uL3NyYy91dGlsL3V0aWwuanMnKTtcbnV0aWxzLm9iamVjdCA9IHJlcXVpcmUoJy4vLi4vLi4vc3JjL3V0aWwvb2JqZWN0LmpzJyk7XG51dGlscy5jb21waWxlID0gcmVxdWlyZSgnLi8uLi8uLi9zcmMvdXRpbC9jb21waWxlLmpzJyk7XG5cbmZ1bmN0aW9uIGNhcGl0YWxpemUoc3RyaW5nLCBmaXJzdExldHRlck9ubHkpIHtcbiAgcmV0dXJuIHN0cmluZy5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArXG4gICAgKGZpcnN0TGV0dGVyT25seSA/IHN0cmluZy5zbGljZSgxKSA6IHN0cmluZy5zbGljZSgxKS50b0xvd2VyQ2FzZSgpKTtcbn1cblxuZnVuY3Rpb24gdG9EYXNoZWQgKHN0cikge1xuICByZXR1cm4gc3RyLnJlcGxhY2UoLyhbYS16XSkoW0EtWl0pL2csICckMS0kMicpLnRvTG93ZXJDYXNlKCk7XG59XG5cblxudmFyIFRvb2xiYXIgPSBmdW5jdGlvbihQQVJFTlQsIGVsLCBvcHRpb25zLCBtZW51KXtcbiAgdGhpcy5pbml0aWFsaXplKFBBUkVOVCwgZWwsIG9wdGlvbnMsIG1lbnUpXG59O1xuXG5cblRvb2xiYXIuX2dldEtleVN0cmluZyA9IGZ1bmN0aW9uIChjb25maWcpIHtcbiAgdmFyIHN0cmluZyA9IFwiXCI7XG5cbiAgaWYgKGNvbmZpZy5jdHJsS2V5KXN0cmluZyArPSBcIkN0cmwgKyBcIjtcbiAgaWYgKGNvbmZpZy5hbHRLZXkpc3RyaW5nICs9IFwiQWx0ICsgXCI7XG4gIGlmIChjb25maWcuc2hpZnRLZXkpc3RyaW5nICs9IFwiU2hpZnQgKyBcIjtcblxuICB2YXIgX2NvZGUgPSBjb25maWcua2V5O1xuICBpZihfY29kZSl7XG4gICAgc3RyaW5nICs9IGNvbmZpZy5rZXk7XG4gIH1cbiAgcmV0dXJuIHN0cmluZztcbn07XG5cblRvb2xiYXIubWFrZUFjdGlvbnMgPSBmdW5jdGlvbiAoYWN0aW9ucywgUEFSRU5UKSB7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGZvciAodmFyIGkgaW4gYWN0aW9ucykge1xuICAgICAgYWN0aW9uc1tpXS5pZCA9IGk7XG4gICAgICB2YXIgX2FjdGlvbiA9IHRoaXMubWFrZUFjdGlvbihhY3Rpb25zW2ldLCBQQVJFTlQpO1xuICAgICAgaWYoX2FjdGlvbil7XG4gICAgICAgIHJlc3VsdFtpXSA9IF9hY3Rpb247XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG59O1xuXG5Ub29sYmFyLm1ha2VBY3Rpb24gPSBmdW5jdGlvbiAoX09SSUdJTkFMLCBwYXJlbnQpIHtcblxuICBpZiAoX09SSUdJTkFMLmNvbnN0cnVjdG9yID09PSBGdW5jdGlvbikge1xuICAgIF9PUklHSU5BTCA9IF9PUklHSU5BTC5jYWxsKHBhcmVudCk7XG4gIH1cblxuICB2YXIgdGFyZ2V0O1xuXG4gIGlmIChfT1JJR0lOQUwudGFyZ2V0ICYmIF9PUklHSU5BTC50YXJnZXQuY29uc3RydWN0b3IgPT09IEZ1bmN0aW9uKSB7XG4gICAgdGFyZ2V0ID0gX09SSUdJTkFMLnRhcmdldC5jYWxsKHBhcmVudCk7XG4gIH0gZWxzZSB7XG4gICAgdGFyZ2V0ID0gX09SSUdJTkFMLnRhcmdldCB8fCBwYXJlbnQ7XG4gIH1cblxuICB2YXIgX19fdGFyZ2V0ID0gX09SSUdJTkFMLnRhcmdldDtcbiAgdmFyIF9fX3BhcmVudCA9IF9PUklHSU5BTC5wYXJlbnQ7XG4gIGRlbGV0ZSBfT1JJR0lOQUwucGFyZW50O1xuICBkZWxldGUgX09SSUdJTkFMLnRhcmdldDtcbiAgdmFyIFJFUyA9IHV0aWxzLm9iamVjdC5jbG9uZURlZXAoX09SSUdJTkFMKTtcbiAgX09SSUdJTkFMLnBhcmVudCA9IF9fX3BhcmVudDtcbiAgX09SSUdJTkFMLnRhcmdldCA9IF9fX3RhcmdldDtcblxuXG4gIFJFUy5wYXJlbnQgPSBfX19wYXJlbnQ7XG4gIFJFUy50YXJnZXQgPSB0YXJnZXQ7XG4gIFJFUy5pZCA9IHRvRGFzaGVkKF9PUklHSU5BTC5pZCk7XG5cblxuICBmdW5jdGlvbiBjcmVhdGVHZXR0ZXIocHJvcGVydHksdXNlUGFyZW50KSB7XG4gICAgaWYgKHByb3BlcnR5LmNvbnN0cnVjdG9yID09PSBGdW5jdGlvbikge1xuICAgICAgcmV0dXJuIHByb3BlcnR5O1xuICAgIH1cbiAgICBpZiAocHJvcGVydHkuY29uc3RydWN0b3IgPT09IFN0cmluZykge1xuICAgICAgdmFyIG5lZ2F0aXZlID0gZmFsc2U7XG4gICAgICBpZiAocHJvcGVydHlbMF0gPT09IFwiIVwiKSB7XG4gICAgICAgIHByb3BlcnR5ID0gcHJvcGVydHkuc3Vic3RyKDEpO1xuICAgICAgICBuZWdhdGl2ZSA9IHRydWU7XG4gICAgICB9XG4gICAgICBpZih1c2VQYXJlbnQpe1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiB0aGlzICYmICEhdGhpc1twcm9wZXJ0eV0gXiBuZWdhdGl2ZTtcbiAgICAgICAgfVxuICAgICAgfWVsc2V7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMgJiYgISF0aGlzW3Byb3BlcnR5XSBeIG5lZ2F0aXZlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG5cblxuICAvKnZhciBfaW5zZXJ0ID0gX09SSUdJTkFMLmluc2VydDtcbiAgaWYgKCFfaW5zZXJ0IHx8IF9pbnNlcnQuY29uc3RydWN0b3IgPT0gU3RyaW5nKSB7XG5cbiAgICBpZihfT1JJR0lOQUwucGFyZW50KXtcbiAgICAgIHZhciBpbnNlcnRwcm9wZXJ0eSA9IGZhYnJpYy51dGlsLnN0cmluZy5jYXBpdGFsaXplKGZhYnJpYy51dGlsLnN0cmluZy5jYW1lbGl6ZShfT1JJR0lOQUwucGFyZW50LmlkKSlcbiAgICB9ZWxzZXtcbiAgICAgIHZhciBpbnNlcnRwcm9wZXJ0eSA9IF9pbnNlcnQgfHwgXCJpbnNlcnRcIiArIGZhYnJpYy51dGlsLnN0cmluZy5jYXBpdGFsaXplKGlkLHRydWUpO1xuICAgIH1cblxuICAgIGlmKHRhcmdldFtpbnNlcnRwcm9wZXJ0eV0gIT09IHVuZGVmaW5lZCl7XG4gICAgICBfaW5zZXJ0ID0gdGFyZ2V0W2luc2VydHByb3BlcnR5XS8vIGNyZWF0ZUdldHRlcihpbnNlcnRwcm9wZXJ0eSx0cnVlKSgpXG4gICAgfWVsc2V7XG4gICAgICBfaW5zZXJ0ID0gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICBpZighX2luc2VydClyZXR1cm47Ki9cblxuICBpZiAoIVJFUy50eXBlKSB7XG4gICAgaWYgKFJFUy5tZW51KSB7XG4gICAgICBSRVMudHlwZSA9IFwibWVudVwiO1xuICAgIH1lbHNle1xuICAgICAgUkVTLnR5cGUgPSBcImJ1dHRvblwiO1xuICAgIH1cbiAgfVxuICBpZiAoIVJFUy5hY3Rpb24pIHtcbiAgICBpZihSRVMudHlwZSA9PT0gXCJidXR0b25cIil7XG4gICAgICBSRVMuYWN0aW9uID0gX09SSUdJTkFMLmlkO1xuICAgIH1cbiAgfVxuXG5cbiAgaWYgKFJFUy5hY3Rpb24pIHtcbiAgICBpZiAoUkVTLmFjdGlvbi5jb25zdHJ1Y3RvciA9PT0gU3RyaW5nKSB7XG4gICAgICBSRVMuYWN0aW9uID0gdGFyZ2V0W1JFUy5hY3Rpb25dO1xuICAgIH1cbiAgICAvL1JFUyA9IFJFUy5hY3Rpb24uYmluZCh0YXJnZXQpO1xuICAgIC8vUkVTLmFjdGlvbiA9IFJFUy5hY3Rpb24uYmluZCh0YXJnZXQpO1xuICAgIC8vXy5leHRlbmQoUkVTLCBfYWN0KTtcbiAgICAvL2FyZ3VtZW50cyBmb3IgYWN0aW9uIGZ1bmN0aW9uXG4gICAgaWYgKF9PUklHSU5BTC5hcmdzKSB7XG4gICAgICBSRVMuX2FjdGlvbiA9IFJFUy5hY3Rpb24uYmluZCh0YXJnZXQsIF9PUklHSU5BTC5hcmdzKTtcbiAgICB9IGVsc2Uge1xuICAgICAgUkVTLl9hY3Rpb24gPSBSRVMuYWN0aW9uLmJpbmQodGFyZ2V0KTtcbiAgICB9XG4gICAgUkVTLmFjdGlvbiA9IGZ1bmN0aW9uKCl7XG4gICAgICBpZihSRVMuZGlzYWJsZWQpcmV0dXJuO1xuICAgICAgUkVTLl9hY3Rpb24uYXBwbHkodGhpcyxhcmd1bWVudHMpO1xuICAgIH1cbiAgfVxuXG5cbiAgaWYgKF9PUklHSU5BTC5tZW51ICYmIF9PUklHSU5BTC5tZW51LmNvbnN0cnVjdG9yID09PSBGdW5jdGlvbikge1xuICAgIFJFUy5tZW51ID0gX09SSUdJTkFMLm1lbnUuYmluZCh0YXJnZXQpO1xuICB9XG4gIGlmIChfT1JJR0lOQUwuYWN0aXZlKSB7XG4gICAgUkVTLmFjdGl2ZSA9IGNyZWF0ZUdldHRlcihfT1JJR0lOQUwuYWN0aXZlKS5iaW5kKHRhcmdldCk7XG4gIH1cbiAgaWYgKF9PUklHSU5BTC52aXNpYmxlKSB7XG4gICAgUkVTLnZpc2libGUgPSBjcmVhdGVHZXR0ZXIoX09SSUdJTkFMLnZpc2libGUpLmJpbmQodGFyZ2V0KTtcbiAgfVxuICBpZiAoX09SSUdJTkFMLmVuYWJsZWQpIHtcbiAgICBSRVMuZW5hYmxlZCA9IGNyZWF0ZUdldHRlcihfT1JJR0lOQUwuZW5hYmxlZCkuYmluZCh0YXJnZXQpO1xuICB9XG4gIGlmICghX09SSUdJTkFMLnZhbHVlKSB7XG4gICAgc3dpdGNoKF9PUklHSU5BTC50eXBlKXtcbiAgICAgIGNhc2UgXCJjb2xvclwiOlxuICAgICAgY2FzZSBcInRleHRcIjpcbiAgICAgIGNhc2UgXCJudW1iZXJcIjpcbiAgICAgIGNhc2UgXCJyYW5nZVwiOlxuICAgICAgY2FzZSBcImxhYmVsXCI6XG4gICAgICBjYXNlIFwic2VsZWN0XCI6XG4gICAgICBjYXNlIFwiY2hlY2tib3hcIjpcbiAgICAgICAgX09SSUdJTkFMLnZhbHVlID0gX09SSUdJTkFMLmlkO1xuICAgICAgLy8gY29uc29sZS5sb2coaWQsIF9PUklHSU5BTCk7XG4gICAgfVxuICB9XG4gIGlmIChfT1JJR0lOQUwudmFsdWUpIHtcbiAgICB2YXIgX3NldCwgX2dldCwgX29wdGlvbnM7XG4gICAgaWYgKF9PUklHSU5BTC52YWx1ZS5jb25zdHJ1Y3RvciA9PT0gU3RyaW5nKSB7XG5cbiAgICAgIHZhciBzZXRGdW5jdGlvbk5hbWUgPSBcInNldFwiICsgY2FwaXRhbGl6ZShfT1JJR0lOQUwudmFsdWUsIHRydWUpLFxuICAgICAgICBnZXRGdW5jdGlvbk5hbWUgPSBcImdldFwiICsgY2FwaXRhbGl6ZShfT1JJR0lOQUwudmFsdWUsIHRydWUpLFxuICAgICAgICBtaW5OYW1lID0gXCJtaW5cIiArIGNhcGl0YWxpemUoX09SSUdJTkFMLnZhbHVlLCB0cnVlKSxcbiAgICAgICAgbWF4TmFtZSA9IFwibWF4XCIgKyBjYXBpdGFsaXplKF9PUklHSU5BTC52YWx1ZSwgdHJ1ZSksXG4gICAgICAgIHNldEZvbyA9IGZ1bmN0aW9uKHZhbCl7XG4gICAgICAgICAgdGFyZ2V0W3NldEZ1bmN0aW9uTmFtZV0odmFsKTtcbiAgICAgICAgICAvLyB0b2RvIHNlbGYuc2V0RnVuY3Rpb25DYWxsYmFjayh0YXJnZXQpO1xuICAgICAgICB9LFxuICAgICAgICBnZXRGb28gPSB0YXJnZXRbZ2V0RnVuY3Rpb25OYW1lXSxcbiAgICAgICAgbWluRm9vID0gdGFyZ2V0W21pbk5hbWVdLFxuICAgICAgICBtYXhGb28gPSB0YXJnZXRbbWF4TmFtZV07XG5cbiAgICAgIF9zZXQgPSBzZXRGb28gfHwgKF9PUklHSU5BTC5hcmdzID9cbiAgICAgICAgICBmdW5jdGlvbiAodmFsLCBhcmdzKSB7XG4gICAgICAgICAgICB0aGlzW19PUklHSU5BTC52YWx1ZV1bYXJnc10gPSB2YWw7XG4gICAgICAgICAgfSA6XG4gICAgICAgICAgZnVuY3Rpb24gKHZhbCkge1xuICAgICAgICAgICAgdGhpc1tfT1JJR0lOQUwudmFsdWVdID0gdmFsO1xuICAgICAgICAgIH0pO1xuXG4gICAgICBfZ2V0ID0gZ2V0Rm9vIHx8IChfT1JJR0lOQUwuYXJncyA/XG4gICAgICAgICAgZnVuY3Rpb24gKGFyZ3MpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzW19PUklHSU5BTC52YWx1ZV1bYXJnc107XG4gICAgICAgICAgfSA6XG4gICAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXNbX09SSUdJTkFMLnZhbHVlXTtcbiAgICAgICAgICB9KTtcblxuXG4gICAgICBSRVMudmFsdWUgPSB7XG4gICAgICAgIG1pbjogbWluRm9vLFxuICAgICAgICBtYXg6IG1heEZvb1xuICAgICAgfVxuXG4gICAgfSBlbHNlIHtcbiAgICAgIF9zZXQgPSBfT1JJR0lOQUwudmFsdWUuc2V0O1xuICAgICAgX2dldCA9IF9PUklHSU5BTC52YWx1ZS5nZXQ7XG4gICAgICBfb3B0aW9ucyA9IF9PUklHSU5BTC52YWx1ZS5vcHRpb25zO1xuICAgIH1cblxuICAgIGlmKFJFUy52YWx1ZS5taW4gIT09IHVuZGVmaW5lZCAmJiBSRVMudmFsdWUubWluLmNvbnN0cnVjdG9yID09PSBTdHJpbmcpe1xuICAgICAgUkVTLnZhbHVlLm1pbiA9IHRhcmdldFtSRVMudmFsdWUubWluXTtcbiAgICB9XG4gICAgaWYoUkVTLnZhbHVlLm1heCAhPT0gdW5kZWZpbmVkICYmIFJFUy52YWx1ZS5tYXguY29uc3RydWN0b3IgPT09IFN0cmluZyl7XG4gICAgICBSRVMudmFsdWUubWF4ID0gdGFyZ2V0W1JFUy52YWx1ZS5tYXhdO1xuICAgIH1cbiAgICBpZihSRVMudmFsdWUuc3RlcCAhPT0gdW5kZWZpbmVkICYmIFJFUy52YWx1ZS5zdGVwLmNvbnN0cnVjdG9yID09PSBTdHJpbmcpe1xuICAgICAgUkVTLnZhbHVlLnN0ZXAgPSB0YXJnZXRbUkVTLnZhbHVlLnN0ZXBdO1xuICAgIH1cbiAgICB2YXIgX21pbiA9IFJFUy52YWx1ZS5taW4sIF9tYXggPSBSRVMudmFsdWUubWF4LCBfc3RlcCA9IFJFUy52YWx1ZS5zdGVwO1xuXG4gICAgaWYgKF9zZXQpIHtcbiAgICAgIFJFUy52YWx1ZS5zZXQgPSAoIF9PUklHSU5BTC5hcmdzID8gX3NldC5iaW5kKHRhcmdldCwgX09SSUdJTkFMLmFyZ3MpIDogX3NldC5iaW5kKHRhcmdldCkpO1xuICAgIH1cbiAgICBpZiAoX2dldCkge1xuICAgICAgUkVTLnZhbHVlLmdldCA9ICggX09SSUdJTkFMLmFyZ3MgPyBfZ2V0LmJpbmQodGFyZ2V0LCBfT1JJR0lOQUwuYXJncykgOiBfZ2V0LmJpbmQodGFyZ2V0KSk7XG4gICAgfVxuICAgIGlmIChfbWluICYmIF9taW4uY29uc3RydWN0b3IgPT09IEZ1bmN0aW9uKSB7XG4gICAgICBSRVMudmFsdWUubWluID0gKCBfT1JJR0lOQUwuYXJncyA/IF9taW4uYmluZCh0YXJnZXQsIF9PUklHSU5BTC5hcmdzKSA6IF9taW4uYmluZCh0YXJnZXQpKTtcbiAgICB9XG4gICAgaWYgKF9tYXggJiYgX21heC5jb25zdHJ1Y3RvciA9PT0gRnVuY3Rpb24pIHtcbiAgICAgIFJFUy52YWx1ZS5tYXggPSAoIF9PUklHSU5BTC5hcmdzID8gX21heC5iaW5kKHRhcmdldCwgX09SSUdJTkFMLmFyZ3MpIDogX21heC5iaW5kKHRhcmdldCkpO1xuICAgIH1cbiAgICBpZiAoX3N0ZXAgJiYgX3N0ZXAuY29uc3RydWN0b3IgPT09IEZ1bmN0aW9uKSB7XG4gICAgICBSRVMudmFsdWUuc3RlcCA9ICggX09SSUdJTkFMLmFyZ3MgPyBfc3RlcC5iaW5kKHRhcmdldCwgX09SSUdJTkFMLmFyZ3MpIDogX3N0ZXAuYmluZCh0YXJnZXQpKTtcbiAgICB9XG4gICAgaWYgKF9vcHRpb25zKSB7XG4gICAgICBSRVMudmFsdWUub3B0aW9ucyA9ICggX09SSUdJTkFMLmFyZ3MgPyBfb3B0aW9ucy5iaW5kKHRhcmdldCwgX09SSUdJTkFMLmFyZ3MpIDogX29wdGlvbnMuYmluZCh0YXJnZXQpKTtcbiAgICB9XG4gIH1cblxuICBpZiAoX09SSUdJTkFMLmRhdGEpIHtcbiAgICBSRVMuZGF0YSA9IF9PUklHSU5BTC5kYXRhLmNhbGwodGFyZ2V0KTtcbiAgfVxuICBpZiAoUkVTLm1lbnUpIHtcbiAgICBpZiAoX09SSUdJTkFMLm1lbnUuY29uc3RydWN0b3IgPT09IEZ1bmN0aW9uKXtcbiAgICAgIFJFUy5tZW51ID0gIF9PUklHSU5BTC5tZW51LmNhbGwodGFyZ2V0KTtcbiAgICB9XG4gICAgaWYgKFJFUy50eXBlID09PSBcIm9wdGlvbnNcIikge1xuICAgICAgZm9yICh2YXIgaSBpbiBSRVMubWVudSkge1xuICAgICAgICBSRVMubWVudVtpXS5wYXJlbnQgPSBSRVM7XG4gICAgICAgIFJFUy5tZW51W2ldLnR5cGUgPSBcIm9wdGlvblwiO1xuICAgICAgICBpZighUkVTLm1lbnVbaV0udGl0bGUpe1xuICAgICAgICAgIFJFUy5tZW51W2ldLnRpdGxlID0gaTtcbiAgICAgICAgfVxuICAgICAgICBpZighUkVTLm1lbnVbaV0ub3B0aW9uKSB7XG4gICAgICAgICAgUkVTLm1lbnVbaV0ub3B0aW9uID0gaTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBmb3IgKHZhciBpIGluIFJFUy5tZW51KSB7XG4gICAgICBpZihSRVMubWVudVtpXS5jb25zdHJ1Y3RvciA9PT0gU3RyaW5nKXtcbiAgICAgICAgUkVTLm1lbnVbaV0gPSBmYWJyaWMudXRpbC5vYmplY3QuY2xvbmUoUkVTLnRhcmdldC5hY3Rpb25zW1JFUy5tZW51W2ldXSk7XG4gICAgICAgIFJFUy5tZW51W2ldLnBhcmVudCA9IFJFUztcbiAgICAgIH1cbiAgICAgIGlmKCFSRVMubWVudVtpXS5pZCl7XG4gICAgICAgIFJFUy5tZW51W2ldLmlkID0gaTtcbiAgICAgIH1cbiAgICAgIFJFUy5tZW51W2ldID0gVG9vbGJhci5tYWtlQWN0aW9uKFJFUy5tZW51W2ldLCB0YXJnZXQpO1xuICAgICAgaWYoIVJFUy5tZW51W2ldKXtcbiAgICAgICAgZGVsZXRlIFJFUy5tZW51W2ldO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG5cblxuICBpZiAoX09SSUdJTkFMLmtleWJvYXJkICE9PSBmYWxzZSAmJiAoX09SSUdJTkFMLmtleSB8fCBfT1JJR0lOQUwuc2hpZnRLZXkgfHwgX09SSUdJTkFMLmFsdEtleSB8fCBfT1JJR0lOQUwuY3RybEtleSB8fCBfT1JJR0lOQUwubWV0YUtleSkpIHtcbiAgICBpZihfT1JJR0lOQUwua2V5Q29kZSAmJiBfT1JJR0lOQUwua2V5Q29kZS5jb25zdHJ1Y3RvciA9PT0gU3RyaW5nKXtcbiAgICAgIFJFUy5rZXlDb2RlID0gX09SSUdJTkFMLmtleUNvZGUudG9VcHBlckNhc2UoKS5jaGFyQ29kZUF0KDApO1xuICAgICAgUkVTLmtleSA9IFN0cmluZy5mcm9tQ2hhckNvZGUoUkVTLmtleUNvZGUpO1xuICAgIH1cbiAgICBSRVMua2V5Ym9hcmQgPSB0cnVlXG4gIH07XG5cbiAgcmV0dXJuIFJFUztcbn07XG5cblRvb2xiYXIuZ2V0QnV0dG9ucyA9IGZ1bmN0aW9uIChhY3Rpb25zKSB7XG4gIHZhciBfYnV0dG9ucyA9IFtdO1xuICBmb3IodmFyIGkgaW4gYWN0aW9ucyl7XG4gICAgdmFyIGFjdGlvbiA9IGFjdGlvbnNbaV07XG4gICAgaWYoYWN0aW9uLmtleWJvYXJkKXtcbiAgICAgIGFjdGlvbi50aXRsZSArPSBcIiAoXCIgKyBUb29sYmFyLl9nZXRLZXlTdHJpbmcoYWN0aW9uKSArIFwiKVwiO1xuICAgICAgX2J1dHRvbnMucHVzaChhY3Rpb24pO1xuICAgIH1cbiAgICBpZiAoYWN0aW9ucy5tZW51KSB7XG4gICAgICBfYnV0dG9ucyA9IF9idXR0b25zLmNvbmNhdChUb29sYmFyLmdldEJ1dHRvbnMoYWN0aW9ucy5tZW51KSk7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBfYnV0dG9ucztcbn07XG5Ub29sYmFyLmluaXRLZXlzID0gZnVuY3Rpb24gKGFjdGlvbnMpIHtcblxuICB2YXIgYnV0dG9ucyA9IFRvb2xiYXIuZ2V0QnV0dG9ucyhhY3Rpb25zKTtcblxuICB2YXIgc2VsZiA9IHRoaXM7XG4gICQoXCJib2R5XCIpLm9uKCBcImtleWRvd25cIixmdW5jdGlvbiAoZSkge1xuICAgIGZvciAodmFyIGkgaW4gYnV0dG9ucykge1xuICAgICAgdmFyIF9jb25maWcgPSBidXR0b25zW2ldO1xuXG4gICAgICBpZihfY29uZmlnLmVuYWJsZWQgJiYgIV9jb25maWcuZW5hYmxlZCgpKXtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBpZihfY29uZmlnLmRpc2FibGVkIHx8IF9jb25maWcuZGlzYWJsZWQpe1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIGlmICgoIV9jb25maWcuZGlzYWJsZWQgJiYgIV9jb25maWcuaGlkZGVuKSAmJlxuICAgICAgICAoX2NvbmZpZy5rZXlDb2RlID09IGUua2V5Q29kZSB8fCBfY29uZmlnLmtleSA9PSBlLmtleSkgJiZcbiAgICAgICAgKF9jb25maWcuY3RybEtleSA9PT0gdW5kZWZpbmVkIHx8IF9jb25maWcuY3RybEtleSA9PSBlLmN0cmxLZXkgKSAmJlxuICAgICAgICAoX2NvbmZpZy5hbHRLZXkgPT09IHVuZGVmaW5lZCB8fCBfY29uZmlnLmFsdEtleSA9PSBlLmFsdEtleSApICYmXG4gICAgICAgIChfY29uZmlnLnNoaWZ0S2V5ID09PSB1bmRlZmluZWQgfHwgX2NvbmZpZy5zaGlmdEtleSA9PSBlLnNoaWZ0S2V5ICkgJiZcbiAgICAgICAgKF9jb25maWcubWV0YUtleSA9PT0gdW5kZWZpbmVkIHx8IF9jb25maWcubWV0YUtleSA9PSBlLm1ldGFLZXkgKSkge1xuXG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgaWYgKF9jb25maWcub3B0aW9uICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBfY29uZmlnLmFjdGlvbi5jYWxsKF9jb25maWcudGFyZ2V0LCBfY29uZmlnLm9wdGlvbiwgZSlcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBfY29uZmlnLmFjdGlvbi5jYWxsKF9jb25maWcudGFyZ2V0LCBlKVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9KTtcblxuICAvLyQod2luZG93KS5vbihcIm1vdXNld2hlZWxcIiwgZnVuY3Rpb24gKGV2ZW50KSB7XG4gIC8vICBmb3IgKHZhciBpIGluIHNlbGYuYnV0dG9ucykge1xuICAvLyAgICB2YXIgZGF0YSA9IHNlbGYuYnV0dG9uc1tpXTtcbiAgLy8gICAgaWYgKCFkYXRhLm1vdXNld2hlZWwpY29udGludWU7XG4gIC8vICAgIGlmICghZGF0YS5jdHJsS2V5IHx8IGRhdGEuY3RybEtleSAmJiBldmVudC5jdHJsS2V5KSB7XG4gIC8vICAgICAgaWYgKGV2ZW50LmRlbHRhWSA+IDAgJiYgZGF0YS5tb3VzZXdoZWVsID09IFwiPlwiKSB7XG4gIC8vICAgICAgICBkYXRhLmFjdGlvbi5jYWxsKHRhcmdldCwgZGF0YS5vcHRpb24gfHwgZXZlbnQsIGV2ZW50KVxuICAvLyAgICAgIH1cbiAgLy8gICAgICBpZiAoZXZlbnQuZGVsdGFZIDwgMCAmJiBkYXRhLm1vdXNld2hlZWwgPT0gXCI8XCIpIHtcbiAgLy8gICAgICAgIGRhdGEuYWN0aW9uLmNhbGwodGFyZ2V0LCBkYXRhLm9wdGlvbiB8fCBldmVudCwgZXZlbnQpXG4gIC8vICAgICAgfVxuICAvLyAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gIC8vICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gIC8vICAgICAgcmV0dXJuIGZhbHNlO1xuICAvLyAgICB9XG4gIC8vICB9XG4gIC8vfSk7XG5cbn07XG5cblRvb2xiYXIucHJvdG90eXBlID0ge1xuXG4gIC8vIHNldEZ1bmN0aW9uQ2FsbGJhY2s6IGZ1bmN0aW9uKCl7fSxcbiAgdG9vbHM6IHtcblxuICAgIFwibGFiZWxcIjoge1xuICAgICAgc2NvcGU6IGZ1bmN0aW9uIChkYXRhLCBvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgZ2V0VmFsdWU6IGRhdGEudmFsdWUuZ2V0LFxuICAgICAgICAgIHZhbHVlQ3VycmVudDogZGF0YS52YWx1ZS5nZXQoKVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgdGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwib2JqZWN0LW1lbnUtaXRlbSBvYmplY3QtbWVudS1sYWJlbFwiIHRpdGxlPVwie3RpdGxlfVwiPicsXG4gICAgICByZW5kZXI6IGZ1bmN0aW9uICgkaXRlbSwgZGF0YSwgb3B0aW9ucywgdG9vbCwgdmFsKSB7XG4gICAgICAgIHZhciBzY29wZSA9IGZhYnJpYy51dGlsLm9iamVjdC5kZWZhdWx0cyh0b29sLnNjb3BlLmNhbGwodGhpcywgZGF0YSwgb3B0aW9ucyksZGF0YSk7XG4gICAgICAgICRpdGVtLmh0bWwoZGF0YS50ZW1wbGF0ZS5mb3JtYXQoZGF0YS52YWx1ZS5nZXQoKSkpO1xuICAgICAgICB1dGlscy5jb21waWxlLmNvbXBpbGVFbGVtZW50KCRpdGVtLHNjb3BlKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIFwibnVtYmVyXCI6IHtcbiAgICAgIHNjb3BlOiBmdW5jdGlvbiAoZGF0YSwgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGdldElucHV0VmFsdWU6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICByZXR1cm4gcGFyc2VGbG9hdChkYXRhLiRpdGVtLmZpbmQoXCJpbnB1dFwiKS52YWwoKSk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBnZXRWYWx1ZTogZGF0YS52YWx1ZS5nZXQsXG4gICAgICAgICAgc2V0VmFsdWU6IGRhdGEudmFsdWUuc2V0LFxuICAgICAgICAgIG1pblZhbHVlOiBkYXRhLnZhbHVlLm1pbiAmJiBkYXRhLnZhbHVlLm1pbigpLFxuICAgICAgICAgIG1heFZhbHVlOiBkYXRhLnZhbHVlLm1heCAmJiBkYXRhLnZhbHVlLm1heCgpLFxuICAgICAgICAgIHZhbHVlQ3VycmVudDogZGF0YS52YWx1ZS5nZXQoKSxcbiAgICAgICAgICBvbmNoYW5nZTogZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGRhdGEudmFsdWUuc2V0KHBhcnNlRmxvYXQoJChlLnRhcmdldCkudmFsKCkpKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB0ZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJvYmplY3QtbWVudS1pdGVtIG9iamVjdC1tZW51LW51bWJlclwiIHRpdGxlPVwie3RpdGxlfVwiPicgK1xuICAgICAgJzxpbnB1dCB0eXBlPVwibnVtYmVyXCIgbWluPVwie21pblZhbHVlfVwiIG1heD1cInttYXhWYWx1ZX1cIiB2YWx1ZT1cInt2YWx1ZUN1cnJlbnR9XCIgb25jaGFuZ2U9XCJvbmNoYW5nZShldmVudClcIj4nLFxuICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoJGl0ZW0sIGRhdGEsIG9wdGlvbnMsIHRvb2wsIHZhbCkge1xuICAgICAgICAkaXRlbS5maW5kKFwiaW5wdXRcIikudmFsKGRhdGEudmFsdWUuZ2V0KCkpO1xuICAgICAgfVxuICAgIH0sXG4gICAgXCJyYW5nZVwiOiB7XG4gICAgICBzY29wZTogZnVuY3Rpb24gKGRhdGEsIG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBtaW5WYWx1ZTogZGF0YS52YWx1ZS5taW4gPyB0eXBlb2YgZGF0YS52YWx1ZS5taW4gPT0gXCJmdW5jdGlvblwiID8gZGF0YS52YWx1ZS5taW4oKSA6IGRhdGEudmFsdWUubWluOiAwLFxuICAgICAgICAgIG1heFZhbHVlOiBkYXRhLnZhbHVlLm1heCA/IHR5cGVvZiBkYXRhLnZhbHVlLm1heCA9PSBcImZ1bmN0aW9uXCIgPyBkYXRhLnZhbHVlLm1heCgpIDogZGF0YS52YWx1ZS5tYXg6IDEsXG4gICAgICAgICAgdmFsdWVTdGVwOiBkYXRhLnZhbHVlLnN0ZXAgPyB0eXBlb2YgZGF0YS52YWx1ZS5zdGVwID09IFwiZnVuY3Rpb25cIiA/IGRhdGEudmFsdWUuc3RlcCgpIDogZGF0YS52YWx1ZS5zdGVwOiAwLjEsXG4gICAgICAgICAgdmFsdWVDdXJyZW50OiBkYXRhLnZhbHVlLmdldCgpLFxuICAgICAgICAgIG9uY2hhbmdlOiBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgZGF0YS52YWx1ZS5zZXQocGFyc2VGbG9hdCgkKGUudGFyZ2V0KS52YWwoKSkpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cIm9iamVjdC1tZW51LWl0ZW0gb2JqZWN0LW1lbnUtcmFuZ2VcIiB0aXRsZT1cInt0aXRsZX1cIj4nICtcbiAgICAgICc8aW5wdXQgdHlwZT1cInJhbmdlXCIgc3RlcD1cInt2YWx1ZVN0ZXB9XCIgbWluPVwie21pblZhbHVlfVwiIG1heD1cInttYXhWYWx1ZX1cIiB2YWx1ZT1cInt2YWx1ZUN1cnJlbnR9XCIgb25jaGFuZ2U9XCJvbmNoYW5nZShldmVudClcIj4nLFxuICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoJGl0ZW0sIGRhdGEsIG9wdGlvbnMsIHRvb2wsIHZhbCkge1xuICAgICAgICAkaXRlbS5maW5kKFwiaW5wdXRcIikudmFsKGRhdGEudmFsdWUuZ2V0KCkpO1xuICAgICAgfVxuICAgIH0sXG4gICAgXCJjaGVja2JveFwiOiB7XG4gICAgICBzY29wZTogZnVuY3Rpb24gKGRhdGEsIG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBvbmNoYW5nZTogZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGRhdGEudmFsdWUuc2V0KGUudGFyZ2V0LmNoZWNrZWQpXG4gICAgICAgICAgfSxcbiAgICAgICAgICB2YWx1ZUN1cnJlbnQ6IGRhdGEudmFsdWUuZ2V0KClcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHRlbXBsYXRlOlxuICAgICAgJzxkaXYgY2xhc3M9XCJvYmplY3QtbWVudS1pdGVtIG9iamVjdC1tZW51LWNoZWNrYm94XCIgdGl0bGU9XCJ7dGl0bGV9XCI+JyArXG4gICAgICAnPGlucHV0IHR5cGU9XCJjaGVja2JveFwiIG9uY2hhbmdlPVwib25jaGFuZ2UoZXZlbnQpXCIgZHAtY2hlY2tlZD1cInt2YWx1ZUN1cnJlbnR9XCIgaWQ9XCJjaGVja2JveC17aWR9XCI+JyArXG4gICAgICAnPGxhYmVsIGZvcj1cImNoZWNrYm94LXtpZH1cIiAgY2xhc3M9XCJidG4gYnV0dG9uLXtpZH0ge2NsYXNzTmFtZX1cIj4nLFxuICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoJGl0ZW0sIGRhdGEsIG9wdGlvbnMsIHRvb2wsIHZhbCkge1xuICAgICAgICAkaXRlbS5maW5kKFwiaW5wdXRcIikudmFsKHZhbCk7XG4gICAgICB9XG4gICAgfSxcbiAgICBcIm1lbnVcIjoge1xuICAgICAgdGVtcGxhdGU6XG4gICAgICAgICc8ZGl2IGNsYXNzPVwib2JqZWN0LW1lbnUtaXRlbSBvYmplY3QtbWVudS1tZW51XCIgdGl0bGU9XCJ7dGl0bGV9XCI+JyArXG4gICAgICAgICc8bGFiZWwgZHAtaWY9XCJ0aXRsZVwiIGZvcj1cImJ1dHRvbi17aWR9XCI+e3RpdGxlfTwvbGFiZWw+JyArXG4gICAgICAgICc8YnV0dG9uIGNsYXNzPVwiYnRuIGJ1dHRvbi1tZW51LXRyaWdnZXIgYnV0dG9uLXtpZH0ge2NsYXNzTmFtZX1cIiBpZD1cImJ1dHRvbi17aWR9XCIvPicgK1xuICAgICAgICAnPGRpdiBjbGFzcz1cIm9iamVjdC1tZW51IHN1Ym1lbnVcIiB0cmFuc2NsdWRlLz4nLFxuICAgICAgcG9zdDogZnVuY3Rpb24gKCRpdGVtLCBkYXRhLCBvcHRpb25zLCB0cmFuc2NsdWRlKSB7XG4gICAgICAgIC8vJGl0ZW0uZmluZChcIi5idXR0b24tbWVudS10cmlnZ2VyXCIpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy8gICRpdGVtLmZpbmQoXCIub2JqZWN0LW1lbnVcIikudG9nZ2xlKCk7XG4gICAgICAgIC8vfSlcbiAgICAgICAgaWYgKGRhdGEuaG92ZXJlZCkge1xuICAgICAgICAgICRpdGVtLmFkZENsYXNzKFwiaG92ZXJlZFwiKTtcbiAgICAgICAgICB0aGlzLnRvZ2dsZUJ5SG92ZXIoJGl0ZW0sIHRyYW5zY2x1ZGUsIG51bGwsIGRhdGEpXG4gICAgICAgIH1cbiAgICAgICAgaWYgKGRhdGEudG9nZ2xlZCkge1xuICAgICAgICAgICRpdGVtLmFkZENsYXNzKFwidG9nZ2xlZFwiKTtcbiAgICAgICAgICB0aGlzLnRvZ2dsZUJ5QnV0dG9uKCRpdGVtLCB0cmFuc2NsdWRlKVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmdlbmVyYXRlTWVudShkYXRhLnRhcmdldCwgdHJhbnNjbHVkZSwgb3B0aW9ucywgZGF0YS5tZW51KTtcbiAgICAgIH1cbiAgICB9LFxuICAgIFwiYnV0dG9uXCI6IHtcbiAgICAgIHNjb3BlOiBmdW5jdGlvbiAoZGF0YSwgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGJ1dHRvbnNUaXRsZTogb3B0aW9ucy5idXR0b25zICYmIG9wdGlvbnMuYnV0dG9ucy50aXRsZSB8fCBmYWxzZSxcbiAgICAgICAgICBidXR0b25zY0NsYXNzTmFtZTogKG9wdGlvbnMuYnV0dG9ucyAmJiBvcHRpb25zLmJ1dHRvbnMuY2xhc3NOYW1lIHx8ICcnKVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgdGVtcGxhdGU6XG4gICAgICAnPGRpdiBjbGFzcz1cIm9iamVjdC1tZW51LWl0ZW1cIiB0aXRsZT1cInt0aXRsZX1cIj4nICtcbiAgICAgICc8YnV0dG9uIGNsYXNzPVwiYnRuIGJ1dHRvbi17aWR9IHtjbGFzc05hbWV9IHtidXR0b25zY0NsYXNzTmFtZX1cIiAgb25jbGljaz1cIiFkaXNhYmxlZCAmJiBvcHRpb24gPyBhY3Rpb24ob3B0aW9uKSA6IGFjdGlvbigpXCI+JyArXG4gICAgICAnPGltZyBkcC1pZj1cImljb25cIiBkcC1zcmM9XCJpY29uXCI+JyArXG4gICAgICAnPHNwYW4gZHAtaW5jbHVkZT1cInN2Z1wiIGRwLWlmPVwic3ZnXCI+PC9zcGFuPicgK1xuICAgICAgJzxzcGFuIGRwLWlmPVwiYnV0dG9uc1RpdGxlXCIgY2xhc3M9XCJidXR0b24tdGl0bGVcIj57dGl0bGV9PC9zcGFuPidcbiAgICB9XG4gIH0sXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKFBBUkVOVCwgZWwsIG9wdGlvbnMsIG1lbnUpe1xuICAgIHRoaXMuYnV0dG9ucyA9IFtdO1xuICAgIC8vdG9kbyDRjdGC0L4g0L3QtSDRgdC+0LLRgdC10Lwg0YXQvtGA0L7RiNC+LiDQvdC10LvRjNC30Y8g0YHQvtC30LTQsNGC0Ywg0YPQu9Cx0YDQsNGLINGBINGA0LDQt9C90YvQvNC4INC60L7QvdGE0LjQs9Cw0LzQuCDQutC90L7Qv9C+0LpcbiAgICAvLyB0aGlzLnRvb2xzID0gdXRpbHMub2JqZWN0LmNsb25lRGVlcCh0aGlzLnRvb2xzKTtcblxuICAgIGlmIChvcHRpb25zKSB7XG4gICAgICBpZiAob3B0aW9ucy5idXR0b24pIHtcbiAgICAgICAgdXRpbHMub2JqZWN0LmV4dGVuZCh0aGlzLnRvb2xzLmJ1dHRvbiwgb3B0aW9ucy5idXR0b24pO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoIVBBUkVOVC5nZW5lcmF0ZWRBY3Rpb25zKSB7XG4gICAgICBQQVJFTlQubWFrZUFjdGlvbnMoIG1lbnUpO1xuICAgIH1cblxuICAgIGlmKGVsLmNvbnN0cnVjdG9yID09PSBTdHJpbmcpe1xuICAgICAgZWwgPSAkKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGVsKSk7XG4gICAgfVxuICAgIGlmKGVsLmxlbmd0aCAmJiBPYmplY3Qua2V5cyhQQVJFTlQuZ2VuZXJhdGVkQWN0aW9ucykubGVuZ3RoKXtcbiAgICAgIHRoaXMuZ2VuZXJhdGVNZW51KFBBUkVOVCwgZWwsIG9wdGlvbnMsIFBBUkVOVC5nZW5lcmF0ZWRBY3Rpb25zKTtcbiAgICAgIHRoaXMub25DcmVhdGUoKTtcbiAgICAgIGVsLnNob3coKTtcbiAgICB9XG4gICAgVG9vbGJhci5pbml0S2V5cyhQQVJFTlQuZ2VuZXJhdGVkQWN0aW9ucyk7XG4gIH0sXG5vbkNyZWF0ZTogZnVuY3Rpb24gKCkge1xuXG4gIH0sXG4gIGRlc3Ryb3k6IGZ1bmN0aW9uICh0YXJnZXQpIHtcbiAgICBmb3IgKHZhciBpID0gdGhpcy5idXR0b25zLmxlbmd0aDtpLS07KSB7XG4gICAgICB2YXIgX2NvbmZpZyA9IHRoaXMuYnV0dG9uc1tpXTtcbiAgICAgIGlmKHRhcmdldCAmJiBfY29uZmlnLnRhcmdldCAhPSB0YXJnZXQgKXtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICB0aGlzLmJ1dHRvbnMuc3BsaWNlKGksMSk7XG4gICAgfVxuICB9LFxuICBjcmVhdGVJbnB1dDogZnVuY3Rpb24gKCRpdGVtLCBkYXRhLCB0eXBlKSB7XG5cbiAgICB2YXIgdGFyZ2V0ID0gZGF0YS50YXJnZXQ7XG4gICAgdmFyICRpbnB1dCA9ICQoXCI8aW5wdXQ+XCIpXG4gICAgICAuYXR0cihcInR5cGVcIiwgdHlwZSlcbiAgICAgIC5hdHRyKFwibWluXCIsIGRhdGEudmFsdWUubWluKCkpXG4gICAgICAuYXR0cihcIm1heFwiLCBkYXRhLnZhbHVlLm1heCgpKTtcblxuICAgICRpbnB1dC52YWwoZGF0YS52YWx1ZS5nZXQoKSk7XG4gICAgaWYgKGRhdGEudmFsdWUub2JzZXJ2ZSkge1xuICAgICAgdGFyZ2V0Lm9uKGRhdGEudmFsdWUub2JzZXJ2ZSwgZnVuY3Rpb24gKHZhbCkge1xuICAgICAgICAkaW5wdXQudmFsKGRhdGEudmFsdWUuZ2V0KCkpO1xuICAgICAgfSk7XG4gICAgfVxuICAgICRpbnB1dC5jaGFuZ2UoZnVuY3Rpb24gKGUpIHtcbiAgICAgIGRhdGEudmFsdWUuc2V0KHBhcnNlRmxvYXQoJGlucHV0LnZhbCgpKSlcbiAgICB9KTtcbiAgICAkaXRlbS5hcHBlbmQoJGlucHV0KTtcbiAgfSxcbiAgaW5pdEl0ZW06IGZ1bmN0aW9uICgkaXRlbSwgZGF0YSkge1xuXG4gICAgaWYgKGRhdGEuYWN0aXZlKSB7XG4gICAgICBpZiAoZGF0YS5hY3RpdmUuY2FsbChkYXRhLnRhcmdldCwgZGF0YS5vcHRpb24pKSB7XG4gICAgICAgICRpdGVtLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChkYXRhLnZpc2libGUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgaWYgKGRhdGEudmlzaWJsZS5jb25zdHJ1Y3RvciA9PSBGdW5jdGlvbikge1xuICAgICAgICBpZiAoIWRhdGEudmlzaWJsZS5jYWxsKGRhdGEudGFyZ2V0KSkge1xuICAgICAgICAgICRpdGVtLmhpZGUoKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmICghZGF0YS52aXNpYmxlKSB7XG4gICAgICAgICRpdGVtLmhpZGUoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBkYXRhLmRpc2FibGVkID0gZmFsc2U7XG4gICAgaWYgKGRhdGEuZW5hYmxlZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBpZiAoZGF0YS5lbmFibGVkLmNvbnN0cnVjdG9yID09IEZ1bmN0aW9uKSB7XG4gICAgICAgIGlmICghZGF0YS5lbmFibGVkLmNhbGwoZGF0YS50YXJnZXQpKSB7XG4gICAgICAgICAgJGl0ZW0uYXR0cihcImRpc2FibGVkXCIsIHRydWUpO1xuICAgICAgICAgIGRhdGEuZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKGRhdGEub2JzZXJ2ZSkge1xuICAgICAgLy90b2RvXG4gICAgICBpZiAoZGF0YS52aXNpYmxlICYmIGRhdGEudmlzaWJsZS5jb25zdHJ1Y3RvciA9PSBGdW5jdGlvbikge1xuICAgICAgICBkYXRhLnRhcmdldCAmJiBkYXRhLnRhcmdldC5vbihkYXRhLm9ic2VydmUsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBpZiAoIWRhdGEudmlzaWJsZS5jYWxsKGRhdGEudGFyZ2V0KSkge1xuICAgICAgICAgICAgJGl0ZW0uaGlkZSgpO1xuICAgICAgICAgICAgZGF0YS5oaWRkZW4gPSB0cnVlO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAkaXRlbS5zaG93KCk7XG4gICAgICAgICAgICBkYXRhLmhpZGRlbiA9IGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChkYXRhLnR5cGUgPT0gXCJvcHRpb25zXCIpIHtcbiAgICAgICAgZGF0YS50YXJnZXQgJiYgZGF0YS50YXJnZXQub24oZGF0YS5vYnNlcnZlLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgdmFyIF92YWwgPSBkYXRhLnZhbHVlLmdldCgpO1xuICAgICAgICAgICQoXCJbbmFtZT1cIiArIGRhdGEuaWQgKyBcIl1cIikucHJvcChcImNoZWNrZWRcIixmYWxzZSk7XG4gICAgICAgICAgJChcIltuYW1lPVwiICsgZGF0YS5pZCArIFwiXVt2YWx1ZT1cIiArIF92YWwgK1wiXVwiKS5wcm9wKFwiY2hlY2tlZFwiLHRydWUpO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgaWYgKGRhdGEuZW5hYmxlZCAmJiBkYXRhLmVuYWJsZWQuY29uc3RydWN0b3IgPT0gRnVuY3Rpb24pIHtcbiAgICAgICAgZGF0YS50YXJnZXQgJiYgZGF0YS50YXJnZXQub24oZGF0YS5vYnNlcnZlLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgaWYgKCFkYXRhLmVuYWJsZWQuY2FsbChkYXRhLnRhcmdldCkpIHtcbiAgICAgICAgICAgICRpdGVtLmF0dHIoXCJkaXNhYmxlZFwiLCB0cnVlKTtcbiAgICAgICAgICAgIGRhdGEuZGlzYWJsZWQgPSB0cnVlO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAkaXRlbS5yZW1vdmVBdHRyKFwiZGlzYWJsZWRcIik7XG4gICAgICAgICAgICBkYXRhLmRpc2FibGVkID0gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIHRvZ2dsZUJ5SG92ZXI6IGZ1bmN0aW9uICgkaXRlbSwgJHRvZ2dsZUVsZW1lbnQsIGZvbyxkYXRhKSB7XG5cbiAgICB2YXIgb25DbG9zZTtcblxuICAgICR0b2dnbGVFbGVtZW50LmhpZGUoKTtcbiAgICAkaXRlbS5tb3VzZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAkdG9nZ2xlRWxlbWVudC5oaWRlKCk7XG4gICAgICBvbkNsb3NlICYmIG9uQ2xvc2UoKTtcbiAgICB9KTtcbiAgICAkaXRlbS5tb3VzZW92ZXIoZnVuY3Rpb24gKCkge1xuICAgICAgJHRvZ2dsZUVsZW1lbnQuc2hvdygpO1xuICAgICAgb25DbG9zZSA9IGZvbyAmJiBmb28oKTtcbiAgICB9KTtcblxuICAgICRpdGVtLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmIChkYXRhICYmIGRhdGEuaW1tZWRpYXRlbHkpIHtcbiAgICAgICAgZGF0YS5hY3Rpb24oKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSxcbiAgdG9nZ2xlQnlCdXR0b246IGZ1bmN0aW9uICgkaXRlbSwgJHRvZ2dsZUVsZW1lbnQsIGZvbyxkYXRhKSB7XG5cbiAgICB2YXIgb25DbG9zZTtcbiAgICB2YXIgX3RyeV9oaWRlID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgIHZhciBfcGFyZW50cyA9ICQoZS50YXJnZXQpLnBhcmVudHMoKTtcbiAgICAgIGZvciAodmFyIGkgaW4gX3BhcmVudHMpIHtcbiAgICAgICAgaWYgKF9wYXJlbnRzW2ldID09PSAkaXRlbVswXSkge1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKCR0b2dnbGVFbGVtZW50LmNzcyhcImRpc3BsYXlcIikgIT09IFwibm9uZVwiKSB7XG4gICAgICAgICR0b2dnbGVFbGVtZW50LmhpZGUoKTtcbiAgICAgICAgb25DbG9zZSAmJiBvbkNsb3NlKCk7XG4gICAgICB9XG4gICAgfTtcblxuICAgICR0b2dnbGVFbGVtZW50LmNsaWNrKGZ1bmN0aW9uIChlKSB7XG4gICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIH0pO1xuICAgICR0b2dnbGVFbGVtZW50LmhpZGUoKTtcbiAgICAkaXRlbS5jbGljayhmdW5jdGlvbiAoKSB7XG5cbiAgICAgIGlmICgkdG9nZ2xlRWxlbWVudC5jc3MoXCJkaXNwbGF5XCIpICE9PSBcIm5vbmVcIikge1xuICAgICAgICAkdG9nZ2xlRWxlbWVudC5oaWRlKCk7XG4gICAgICAgIG9uQ2xvc2UgJiYgb25DbG9zZSgpO1xuICAgICAgICAkKHdpbmRvdykub2ZmKFwiY2xpY2tcIiwgX3RyeV9oaWRlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgICR0b2dnbGVFbGVtZW50LnNob3coKTtcbiAgICAgICAgJCh3aW5kb3cpLm9uKFwiY2xpY2tcIiwgX3RyeV9oaWRlKTtcblxuICAgICAgICBvbkNsb3NlID0gZm9vICYmIGZvbygpO1xuXG4gICAgICAgIGlmKGRhdGEgJiYgZGF0YS5pbW1lZGlhdGVseSl7XG4gICAgICAgICAgZGF0YS5hY3Rpb24oKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pXG4gIH0sXG4gIGdlbmVyYXRlTWVudTogZnVuY3Rpb24gKHRhcmdldCwgJGVsLCBvcHRpb25zLCBtZW51KSB7XG5cbiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7XG4gICAgICAgIHRpdGxlOiBmYWxzZVxuICAgICAgfTtcbiAgICBvcHRpb25zLmJ1dHRvbnMgPSBvcHRpb25zLmJ1dHRvbnMgfHwge1xuICAgICAgICBjbGFzc05hbWU6IFwiXCIsXG4gICAgICAgIHRpdGxlOiBmYWxzZVxuICAgICAgfTtcblxuICAgICRlbC5lbXB0eSgpO1xuXG4gICAgdmFyIF90aGlzID0gIHRoaXM7XG4gICAgZm9yICh2YXIgaSBpbiBtZW51KSB7XG4gICAgICB2YXIgZGF0YSA9IG1lbnVbaV07XG4gICAgICBpZiAoIWRhdGEgfHwgZGF0YS5pbnNlcnQgIT09IHVuZGVmaW5lZCAmJiAhZGF0YS5pbnNlcnQpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBkYXRhLnR5cGUgPSBkYXRhLnR5cGUgfHwgXCJidXR0b25cIjtcblxuICAgICAgLy90b2RvINC90LXQv9C+0L3Rj9GC0L3QviDQt9Cw0YfQtdC8INCw0YDQs9GD0LzQtdC90YIgdGFyZ2V0INCyINC90LDRh9Cw0LvQtVxuICAgICAgdmFyIHRhcmdldCA9IGRhdGEudGFyZ2V0O1xuXG4gICAgICB2YXIgdG9vbCA9IHRoaXMudG9vbHNbZGF0YS50eXBlXTtcblxuICAgICAgaWYgKCF0b29sKSB7XG4gICAgICAgIGNvbnNvbGUud2FybihcInRvb2wgJ1wiICsgZGF0YS50eXBlICsgXCInIHVuZGVmaW5lZFwiKTtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICB2YXIgc2NvcGUgPSBkYXRhO1xuICAgICAgaWYgKHRvb2wuc2NvcGUpIHtcbiAgICAgICAgc2NvcGUgPSBmYWJyaWMudXRpbC5vYmplY3QuZGVmYXVsdHModG9vbC5zY29wZS5jYWxsKHRoaXMsIGRhdGEsIG9wdGlvbnMpLGRhdGEpO1xuICAgICAgfVxuXG4gICAgICB2YXIgJGl0ZW0gPSAkKHRvb2wudGVtcGxhdGUuZm9ybWF0KHNjb3BlKSk7XG4gICAgICB2YXIgdHJhbnNjbHVkZSA9ICRpdGVtLmZpbmQoXCJbdHJhbnNjbHVkZV1cIik7XG4gICAgICBzY29wZS4kaXRlbSA9IGRhdGEuJGl0ZW0gPSAkaXRlbTtcbiAgICAgIGlmKGRhdGEudGVtcGxhdGUpe1xuICAgICAgICAkaXRlbS5odG1sKGRhdGEudGVtcGxhdGUuZm9ybWF0KGRhdGEudmFsdWUuZ2V0KCkpKTtcbiAgICAgIH1cblxuICAgICAgdXRpbHMuY29tcGlsZS5jb21waWxlRWxlbWVudCgkaXRlbSxzY29wZSk7XG5cbiAgICAgIGlmIChkYXRhLnZhbHVlICYmIGRhdGEudmFsdWUub2JzZXJ2ZSkge1xuXG4gICAgICAgIHRhcmdldC5vbihkYXRhLnZhbHVlLm9ic2VydmUsIGZ1bmN0aW9uICh2YWwpIHtcblxuICAgICAgICAgIGlmICh0b29sLnBvc3QpIHtcbiAgICAgICAgICAgIHRvb2wucG9zdC5jYWxsKF90aGlzLCRpdGVtLCBzY29wZSwgb3B0aW9ucywgdHJhbnNjbHVkZS5sZW5ndGggPyB0cmFuc2NsdWRlIDogbnVsbCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmKHRvb2wucmVuZGVyKXtcbiAgICAgICAgICAgIHRvb2wucmVuZGVyLmNhbGwoX3RoaXMsICRpdGVtLCBkYXRhLCBvcHRpb25zLCB0b29sLCB2YWwpO1xuICAgICAgICAgIH1cbiAgICAgICAgICAvL3RoaXMuZmlyZShkYXRhLnR5cGUgKyBcIjpyZW5kZXJcIix7aXRlbTogJGl0ZW0sIGRhdGE6IGRhdGEsIG9wdGlvbnM6IG9wdGlvbnMsIHRvb2w6IHRvb2wsIHZhbDogdmFsfSlcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuaW5pdEl0ZW0oJGl0ZW0sIGRhdGEpO1xuXG4gICAgICBpZiAodG9vbC5wb3N0KSB7XG4gICAgICAgIHRvb2wucG9zdC5jYWxsKHRoaXMsJGl0ZW0sIHNjb3BlLCBvcHRpb25zLCB0cmFuc2NsdWRlLmxlbmd0aCA/IHRyYW5zY2x1ZGUgOiBudWxsKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5maXJlKGRhdGEudHlwZSArIFwiOmNyZWF0ZWRcIix7aXRlbTogJGl0ZW0sIGRhdGE6IGRhdGEsIG9wdGlvbnM6IG9wdGlvbnMsIHRvb2w6IHRvb2x9KTtcblxuICAgICAgJGVsLmFwcGVuZCgkaXRlbSk7XG4gICAgfVxuICB9XG59O1xudXRpbHMub2JzZXJ2YWJsZShUb29sYmFyLnByb3RvdHlwZSk7XG5cblxuVG9vbGJhci5zaW5nbGUgPSBmdW5jdGlvbihkYXRhLGVsZW1lbnQpe1xuICBkYXRhLiRpdGVtID0gZWxlbWVudDtcbiAgZGF0YS50eXBlID0gZGF0YS50eXBlIHx8IFwiYnV0dG9uXCI7XG5cbiAgdmFyIHRvb2wgPSBUb29sYmFyLnByb3RvdHlwZS50b29sc1tkYXRhLnR5cGVdO1xuXG4gIFRvb2xiYXIucHJvdG90eXBlLmluaXRJdGVtKGVsZW1lbnQsZGF0YSk7XG5cbiAgaWYgKGRhdGEudmFsdWUgJiYgZGF0YS52YWx1ZS5vYnNlcnZlKSB7XG4gICAgZGF0YS50YXJnZXQub24oZGF0YS52YWx1ZS5vYnNlcnZlLCBmdW5jdGlvbiAodmFsKSB7XG4gICAgICB0b29sLnJlbmRlciggZWxlbWVudCwgZGF0YSwge30sIHRvb2wsIHZhbClcbiAgICB9KTtcbiAgfVxuXG4gIGlmKHRvb2wucG9zdCl7XG4gICAgdmFyIHRyYW5zY2x1ZGUgPSBlbGVtZW50LmZpbmQoXCJbdHJhbnNjbHVkZV1cIik7XG5cbiAgICB0b29sLnBvc3QuY2FsbChUb29sYmFyLnByb3RvdHlwZSwgZWxlbWVudCwgZGF0YSwge30sIHRyYW5zY2x1ZGUubGVuZ3RoID8gdHJhbnNjbHVkZSA6IG51bGwpO1xuICB9XG5cbiAgdmFyIHNjb3BlID0gZGF0YTtcbiAgaWYodG9vbC5zY29wZSl7XG4gICAgc2NvcGUgPSBfLmRlZmF1bHRzKGRhdGEsIHRvb2wuc2NvcGUuY2FsbChUb29sYmFyLnByb3RvdHlwZSwgZGF0YSwge30pKTtcbiAgfVxuXG4gIGVsZW1lbnQuZWFjaFNlbGYoXCIqXCIsZnVuY3Rpb24oKXtcbiAgICB2YXIgbm9kZXM9W10sIHZhbHVlcz1bXTtcbiAgICBmb3IgKHZhciBhdHQsIGkgPSAwLCBhdHRzID0gdGhpcy5hdHRyaWJ1dGVzLCBuID0gYXR0cy5sZW5ndGg7IGkgPCBuOyBpKyspe1xuICAgICAgYXR0ID0gYXR0c1tpXTtcbiAgICAgIG5vZGVzLnB1c2goYXR0Lm5vZGVOYW1lKTtcbiAgICAgIHZhbHVlcy5wdXNoKGF0dC5ub2RlVmFsdWUpO1xuICAgICAgdGhpcy5zZXRBdHRyaWJ1dGUoYXR0Lm5vZGVOYW1lLGF0dC5ub2RlVmFsdWUuZm9ybWF0KHNjb3BlKSk7XG4gICAgfVxuICB9KTtcbiAgdXRpbHMuY29tcGlsZS5jb21waWxlRWxlbWVudChlbGVtZW50LHNjb3BlKTtcbn07XG5cblxubW9kdWxlLmV4cG9ydHMgPSBUb29sYmFyO1xuXG5cblxuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi4vdG9vbGJhci9zcmMvdG9vbGJhci5qc1xuLy8gbW9kdWxlIGlkID0gMVxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCJ2YXIgdXRpbHMgPSB7XG4gIC8qKlxuICAgKlxuICAgKiBAcGFyYW0gYXJyXG4gICAqIEBwYXJhbSBhcnIyXG4gICAqIEByZXR1cm5zIHt7fX1cbiAgICogQGV4YW1wbGVcbiAgICogICAgeCA9IHthOiAxICxiOiAxLCBjOiBbMSwyXX1cbiAgICogICAgeSA9IHthOiAyICwgIGMgOiAzICwgZCA6IDF9XG4gICAqXG4gICAqICAgIGV4dGVuZEFycmF5c09iamVjdCh4LHkpID0ge2E6IFsxLDJdIGIgOiBbMV0gYyA6IFsxLDIsM10sIGQgWzFdIH1cbiAgICovXG4gIGV4dGVuZEFycmF5c09iamVjdCA6IGZ1bmN0aW9uKGFycixhcnIyKXtcbiAgICB2YXIgbmV3QXJyYXkgPSB7fTtcblxuICAgIGZvcih2YXIgaSBpbiBhcnIpe1xuICAgICAgaWYoYXJyW2ldLmNvbnN0cnVjdG9yID09IEFycmF5KXtcbiAgICAgICAgbmV3QXJyYXlbaV0gID0gW10uY29uY2F0KGFycltpXSk7XG4gICAgICB9ZWxzZXtcbiAgICAgICAgbmV3QXJyYXlbaV0gPSBbYXJyW2ldXTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBmb3IodmFyIGkgaW4gYXJyMil7XG4gICAgICBpZihuZXdBcnJheVtpXSl7XG4gICAgICAgIG5ld0FycmF5W2ldLnB1c2goYXJyMltpXSk7XG4gICAgICB9ZWxzZXtcbiAgICAgICAgbmV3QXJyYXlbaV0gPSBbYXJyMltpXV07XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBuZXdBcnJheTtcbiAgfSxcbiAgZmlsdGVyVmFsdWVzOiBmdW5jdGlvbiAoYXJyYXksIHZhbHVlcykge1xuICAgIHZhciBuZXdfYXJyYXkgPSBbXTtcbiAgICBmb3IgKHZhciBpIGluIGFycmF5KSB7XG4gICAgICB2YXIgX25ld19vYmplY3QgPSB7fTtcbiAgICAgIGZvciAodmFyIGogaW4gdmFsdWVzKSB7XG4gICAgICAgIF9uZXdfb2JqZWN0W3ZhbHVlc1tqXV0gPSBhcnJheVtpXVt2YWx1ZXNbal1dXG4gICAgICB9XG4gICAgICBuZXdfYXJyYXkucHVzaChfbmV3X29iamVjdCk7XG4gICAgfVxuICAgIHJldHVybiBuZXdfYXJyYXk7XG4gIH0sXG5cbiAgLyoqXG4gICAqICDQotCw0YHQvtCy0LDQvdC40LUg0KTQuNGI0LXRgNCw4oCT0JnQtdGC0YHQsCzRgdC70YPRh9Cw0LnQvdC+0LUg0YLQsNGB0L7QstCw0L3QuNC1INC80L3QvtC20LXRgdGC0LLQsFxuICAgKiBAcGFyYW0gb2JqZWN0XG4gICAqIEByZXR1cm5zIHsqfVxuICAgKi9cbiAgc2h1ZmZsZTogZnVuY3Rpb24gKG9iamVjdCkge1xuICAgIGlmICghb2JqZWN0Lmxlbmd0aCkgcmV0dXJuO1xuICAgIHZhciBpID0gb2JqZWN0Lmxlbmd0aDtcbiAgICB3aGlsZSAoLS1pKSB7XG4gICAgICB2YXIgaiA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChpICsgMSkpO1xuICAgICAgdmFyIHRlbXAgPSBvYmplY3RbaV07XG4gICAgICBvYmplY3RbaV0gPSBvYmplY3Rbal07XG4gICAgICBvYmplY3Rbal0gPSB0ZW1wO1xuICAgIH1cblxuICAgIHJldHVybiBvYmplY3Q7IC8vIGZvciBjb252ZW5pZW5jZSwgaW4gY2FzZSB3ZSB3YW50IGEgcmVmZXJlbmNlIHRvIHRoZSBhcnJheVxuICB9LFxuICAvKipcbiAgICogRGVwZW5kZW5jeTogdW5kZXJzY29yZS5qcyAoIGh0dHA6Ly9kb2N1bWVudGNsb3VkLmdpdGh1Yi5jb20vdW5kZXJzY29yZS8gKVxuICAgKlxuICAgKiBNaXggaXQgaW4gd2l0aCB1bmRlcnNjb3JlLmpzOlxuICAgKiBfLm1peGluKHtkZWVwRXh0ZW5kOiBkZWVwRXh0ZW5kfSk7XG4gICAqXG4gICAqIENhbGwgaXQgbGlrZSB0aGlzOlxuICAgKiB2YXIgbXlPYmogPSB1dGlscy5kZWVwRXh0ZW5kKGdyYW5kcGFyZW50LCBjaGlsZCwgZ3JhbmRjaGlsZCwgZ3JlYXRncmFuZGNoaWxkKVxuICAgKlxuICAgKiBOb3RlczpcbiAgICogS2VlcCBpdCBEUlkuXG4gICAqIFRoaXMgZnVuY3Rpb24gaXMgZXNwZWNpYWxseSB1c2VmdWwgaWYgeW91J3JlIHdvcmtpbmcgd2l0aCBKU09OIGNvbmZpZyBkb2N1bWVudHMuIEl0IGFsbG93cyB5b3UgdG8gY3JlYXRlIGEgZGVmYXVsdFxuICAgKiBjb25maWcgZG9jdW1lbnQgd2l0aCB0aGUgbW9zdCBjb21tb24gc2V0dGluZ3MsIHRoZW4gb3ZlcnJpZGUgdGhvc2Ugc2V0dGluZ3MgZm9yIHNwZWNpZmljIGNhc2VzLiBJdCBhY2NlcHRzIGFueVxuICAgKiBudW1iZXIgb2Ygb2JqZWN0cyBhcyBhcmd1bWVudHMsIGdpdmluZyB5b3UgZmluZS1ncmFpbmVkIGNvbnRyb2wgb3ZlciB5b3VyIGNvbmZpZyBkb2N1bWVudCBoaWVyYXJjaHkuXG4gICAqXG4gICAqIFNwZWNpYWwgRmVhdHVyZXMgYW5kIENvbnNpZGVyYXRpb25zOlxuICAgKiAtIHBhcmVudFJFIGFsbG93cyB5b3UgdG8gY29uY2F0ZW5hdGUgc3RyaW5ncy4gZXhhbXBsZTpcbiAgICogICB2YXIgb2JqID0gdXRpbHMuZGVlcEV4dGVuZCh7dXJsOiBcInd3dy5leGFtcGxlLmNvbVwifSwge3VybDogXCJodHRwOi8vI3tffS9wYXRoL3RvL2ZpbGUuaHRtbFwifSk7XG4gICAqICAgY29uc29sZS5sb2cob2JqLnVybCk7XG4gICAqICAgb3V0cHV0OiBcImh0dHA6Ly93d3cuZXhhbXBsZS5jb20vcGF0aC90by9maWxlLmh0bWxcIlxuICAgKlxuICAgKiAtIHBhcmVudFJFIGFsc28gYWN0cyBhcyBhIHBsYWNlaG9sZGVyLCB3aGljaCBjYW4gYmUgdXNlZnVsIHdoZW4geW91IG5lZWQgdG8gY2hhbmdlIG9uZSB2YWx1ZSBpbiBhbiBhcnJheSwgd2hpbGVcbiAgICogICBsZWF2aW5nIHRoZSBvdGhlcnMgdW50b3VjaGVkLiBleGFtcGxlOlxuICAgKiAgIHZhciBhcnIgPSB1dGlscy5kZWVwRXh0ZW5kKFsxMDAsICAgIHtpZDogMTIzNH0sIHRydWUsICBcImZvb1wiLCAgWzI1MCwgNTAwXV0sXG4gICAqICAgICAgICAgICAgICAgICAgICAgICAgICBbXCIje199XCIsIFwiI3tffVwiLCAgICAgZmFsc2UsIFwiI3tffVwiLCBcIiN7X31cIl0pO1xuICAgKiAgIGNvbnNvbGUubG9nKGFycik7XG4gICAqICAgb3V0cHV0OiBbMTAwLCB7aWQ6IDEyMzR9LCBmYWxzZSwgXCJmb29cIiwgWzI1MCwgNTAwXV1cbiAgICpcbiAgICogLSBUaGUgcHJldmlvdXMgZXhhbXBsZSBjYW4gYWxzbyBiZSB3cml0dGVuIGxpa2UgdGhpczpcbiAgICogICB2YXIgYXJyID0gdXRpbHMuZGVlcEV4dGVuZChbMTAwLCAgICB7aWQ6MTIzNH0sICAgdHJ1ZSwgIFwiZm9vXCIsICBbMjUwLCA1MDBdXSxcbiAgICogICAgICAgICAgICAgICAgICAgICAgICAgIFtcIiN7X31cIiwge30sICAgICAgICAgIGZhbHNlLCBcIiN7X31cIiwgW11dKTtcbiAgICogICBjb25zb2xlLmxvZyhhcnIpO1xuICAgKiAgIG91dHB1dDogWzEwMCwge2lkOiAxMjM0fSwgZmFsc2UsIFwiZm9vXCIsIFsyNTAsIDUwMF1dXG4gICAqXG4gICAqIC0gQW5kIGFsc28gbGlrZSB0aGlzOlxuICAgKiAgIHZhciBhcnIgPSB1dGlscy5kZWVwRXh0ZW5kKFsxMDAsICAgIHtpZDoxMjM0fSwgICB0cnVlLCAgXCJmb29cIiwgIFsyNTAsIDUwMF1dLFxuICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgW1wiI3tffVwiLCB7fSwgICAgICAgICAgZmFsc2VdKTtcbiAgICogICBjb25zb2xlLmxvZyhhcnIpO1xuICAgKiAgIG91dHB1dDogWzEwMCwge2lkOiAxMjM0fSwgZmFsc2UsIFwiZm9vXCIsIFsyNTAsIDUwMF1dXG4gICAqXG4gICAqIC0gQXJyYXkgb3JkZXIgaXMgaW1wb3J0YW50LiBleGFtcGxlOlxuICAgKiAgIHZhciBhcnIgPSB1dGlscy5kZWVwRXh0ZW5kKFsxLCAyLCAzLCA0XSwgWzEsIDQsIDMsIDJdKTtcbiAgICogICBjb25zb2xlLmxvZyhhcnIpO1xuICAgKiAgIG91dHB1dDogWzEsIDQsIDMsIDJdXG4gICAqXG4gICAqIC0gWW91IGNhbiByZW1vdmUgYW4gYXJyYXkgZWxlbWVudCBzZXQgaW4gYSBwYXJlbnQgb2JqZWN0IGJ5IHNldHRpbmcgdGhlIHNhbWUgaW5kZXggdmFsdWUgdG8gbnVsbCBpbiBhIGNoaWxkIG9iamVjdC5cbiAgICogICBleGFtcGxlOlxuICAgKiAgIHZhciBvYmogPSB1dGlscy5kZWVwRXh0ZW5kKHthcnI6IFsxLCAyLCAzLCA0XX0sIHthcnI6IFtcIiN7X31cIiwgbnVsbF19KTtcbiAgICogICBjb25zb2xlLmxvZyhvYmouYXJyKTtcbiAgICogICBvdXRwdXQ6IFsxLCAzLCA0XVxuICAgKlxuICAgKiovXG4gIGRlZXBFeHRlbmQ6IGZ1bmN0aW9uICgvKm9ial8xLCBbb2JqXzJdLCBbb2JqX05dKi8pIHtcbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDEgfHwgdHlwZW9mIGFyZ3VtZW50c1swXSAhPT0gJ29iamVjdCcpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA8IDIpIHJldHVybiBhcmd1bWVudHNbMF07XG5cbiAgICB2YXIgdGFyZ2V0ID0gYXJndW1lbnRzWzBdO1xuXG4gICAgLy8gY29udmVydCBhcmd1bWVudHMgdG8gYXJyYXkgYW5kIGN1dCBvZmYgdGFyZ2V0IG9iamVjdFxuICAgIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTtcblxuICAgIHZhciBrZXksIHZhbCwgc3JjLCBjbG9uZSwgdG1wQnVmO1xuXG4gICAgYXJncy5mb3JFYWNoKGZ1bmN0aW9uIChvYmopIHtcbiAgICAgIGlmICh0eXBlb2Ygb2JqICE9PSAnb2JqZWN0JykgcmV0dXJuO1xuXG4gICAgICBmb3IgKGtleSBpbiBvYmopIHtcbiAgICAgICAgaWYgKCEoa2V5IGluIG9iaikpIGNvbnRpbnVlO1xuXG4gICAgICAgIHNyYyA9IHRhcmdldFtrZXldO1xuICAgICAgICB2YWwgPSB1dGlscy5jbG9uZURlZXAob2JqW2tleV0pO1xuXG5cbiAgICAgICAgaWYgKHR5cGVvZiBzcmMgIT09ICdvYmplY3QnIHx8IHNyYyA9PT0gbnVsbCkge1xuICAgICAgICAgIHRhcmdldFtrZXldID0gdmFsO1xuICAgICAgICB9ZWxzZSBpZiAoQXJyYXkuaXNBcnJheSh2YWwpKSB7XG4gICAgICAgICAgY2xvbmUgPSAoQXJyYXkuaXNBcnJheShzcmMpKSA/IHNyYyA6IFtdO1xuXG4gICAgICAgICAgdmFsLmZvckVhY2goZnVuY3Rpb24oaXRlbSl7XG4gICAgICAgICAgICBjbG9uZS5wdXNoKHV0aWxzLmNsb25lRGVlcChpdGVtKSk7XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICB0YXJnZXRba2V5XSA9IGNsb25lO1xuICAgICAgICAgIC8vdG9kbyAg0LXRgdC70Lgg0LfQsNC40LzRgdGC0LLRg9C10Lwg0LzQsNGB0YHQuNCyICwg0YLQviDRgdGB0L7RhdGA0LDQvdGP0LXQvCDQt9C90LDRh9C10L3QuNGPINC40Lcg0L7QsdC+0LjRhSDQvNCw0YHRgdC40LLQvtCyXG4gICAgICAgICAgLy90YXJnZXRba2V5XSA9IHV0aWxzLmRlZXBFeHRlbmQoY2xvbmUsIHZhbCk7XG5cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjbG9uZSA9ICghQXJyYXkuaXNBcnJheShzcmMpKSA/IHNyYyA6IHt9O1xuICAgICAgICAgIHRhcmdldFtrZXldID0gdXRpbHMuZGVlcEV4dGVuZChjbG9uZSwgdmFsKTtcbiAgICAgICAgfVxuXG4gICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gdGFyZ2V0O1xuICB9LFxuICBjbG9uZURlZXA6IGZ1bmN0aW9uICh2YWwpIHtcblxuICAgIGlmICh0eXBlb2YgdmFsID09PSAndW5kZWZpbmVkJykge1xuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgICBpZiAodmFsID09PSBudWxsKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9IGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIERhdGUpIHtcbiAgICAgIHJldHVybiBuZXcgRGF0ZSh2YWwuZ2V0VGltZSgpKTtcbiAgICB9IGVsc2UgaWYgKHZhbCBpbnN0YW5jZW9mIFJlZ0V4cCkge1xuICAgICAgcmV0dXJuIG5ldyBSZWdFeHAodmFsKTtcbiAgICB9XG5cbiAgICBpZih2YWwuY2xvbmVTeW5jKXtcbiAgICAgIHJldHVybiB2YWwuY2xvbmVTeW5jKCk7XG4gICAgfWVsc2UgaWYodmFsLmNvbnN0cnVjdG9yID09IE9iamVjdCl7XG4gICAgICByZXR1cm4gdXRpbHMuZGVlcEV4dGVuZCh7fSwgdmFsKTtcbiAgICB9ZWxzZSBpZih2YWwuY29uc3RydWN0b3IgPT0gQXJyYXkpe1xuICAgICAgdmFyIGNsb25lID0gW107XG4gICAgICBmb3IodmFyIGkgPTAgO2kgPCB2YWwubGVuZ3RoOyBpKyspe1xuICAgICAgICBjbG9uZS5wdXNoKHV0aWxzLmNsb25lRGVlcCh2YWxbaV0pKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBjbG9uZTtcbiAgICB9ZWxzZXtcbiAgICAgIHJldHVybiB2YWw7XG4gICAgfVxuICB9LFxuICByZWFycmFuZ2U6IGZ1bmN0aW9uIChvYmplY3QsIGtleXMpIHtcbiAgICB2YXIgX25ld09yZGVyID0ge307XG4gICAgZm9yICh2YXIgaSBpbiBrZXlzKSB7XG4gICAgICBpZihvYmplY3Rba2V5c1tpXV0gIT09IHVuZGVmaW5lZCl7XG4gICAgICAgIF9uZXdPcmRlcltrZXlzW2ldXSA9IG9iamVjdFtrZXlzW2ldXVxuICAgICAgfVxuICAgIH1cbiAgICAvLyBmb3IgKGkgaW4gb2JqZWN0KSB7XG4gICAgLy8gICBkZWxldGUgb2JqZWN0W2ldO1xuICAgIC8vIH1cbiAgICAvLyBmb3IgKGkgaW4gX25ld09yZGVyKSB7XG4gICAgLy8gICBvYmplY3RbaV0gPSBfbmV3T3JkZXJbaV07XG4gICAgLy8gfVxuICAgIHJldHVybiBfbmV3T3JkZXI7XG4gIH0sXG4gIHNvcnRCeTogXy5zb3J0QnksXG4gIGRlZmF1bHRzOiBfLmRlZmF1bHRzLFxuICB3aGVyZTogXy53aGVyZSxcbiAgZmluZFdoZXJlOiBfLmZpbmRXaGVyZSxcbiAgZmlsdGVyOiBfLmZpbHRlcixcbiAgcGljazogXy5waWNrLFxuICBleHRlbmQ6IGZ1bmN0aW9uIChkZXN0aW5hdGlvbikge1xuICAgIC8vIEpTY3JpcHQgRG9udEVudW0gYnVnIGlzIG5vdCB0YWtlbiBjYXJlIG9mXG4gICAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV07XG4gICAgICBmb3IgKHZhciBwcm9wZXJ0eSBpbiBzb3VyY2UpIHtcbiAgICAgICAgZGVzdGluYXRpb25bcHJvcGVydHldID0gc291cmNlW3Byb3BlcnR5XTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGRlc3RpbmF0aW9uO1xuICB9XG59O1xubW9kdWxlLmV4cG9ydHMgPSAgdXRpbHM7XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL3V0aWwvb2JqZWN0LmpzXG4vLyBtb2R1bGUgaWQgPSAyXG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsInZhciBvYmplY3RVdGlscyA9IHJlcXVpcmUoXCIuL29iamVjdFwiKVxuXG52YXIgdXRpbHMgPSB7XG4gIC8qKlxuICAgKiB3aWxsIGRpdmlkZSB0b3RhbCB3aWR0aCBmb3IgZXZlcnkgb2JqZWN0IGluIGNvbHVtbnRzIGFycmF5XG4gICAqXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqICAgICB2YXIgX2ZsZXhBcnJheSA9IGZhYnJpYy51dGlsLmZsZXgoMjAwICwgW3tmbGV4OiAwfSx7dmFsdWU6IDEwMCwgZmxleDogMX0se2ZsZXg6IDB9XSApO1xuICAgKiBAcGFyYW0gdG90YWxcbiAgICogQHBhcmFtIGNvbHVtbnNcbiAgICogQHJldHVybnMge0FycmF5fVxuICAgKiBAZXhhbXBsZSBbNTAsMTAwLDUwXVxuICAgKi9cbiAgZmxleDogZnVuY3Rpb24gKHRvdGFsLGNvbHVtbnMpe1xuICAgIHZhciBfcmV0dXJuID0gW107XG4gICAgdmFyIHNwbGl0ID0gMDtcbiAgICBjb2x1bW5zLmZvckVhY2goZnVuY3Rpb24oY29sdW1uLCBpbmRleCl7XG4gICAgICBpZihjb2x1bW4udmFsdWUgPT09IHVuZGVmaW5lZCl7XG4gICAgICAgIHNwbGl0Kys7XG4gICAgICB9ZWxzZXtcbiAgICAgICAgdG90YWwgLT0gY29sdW1uLnZhbHVlO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHZhciBfdyA9IHRvdGFsIC8gc3BsaXQ7XG4gICAgY29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uKGNvbHVtbil7XG4gICAgICBfcmV0dXJuLnB1c2goY29sdW1uLnZhbHVlID09PSB1bmRlZmluZWQgPyBfdyA6ICBjb2x1bW4udmFsdWUgKTtcbiAgICB9KTtcbiAgICByZXR1cm4gX3JldHVybjtcbiAgfSxcbiAgd29ya2VyOiBmdW5jdGlvbiAoZm9vKSB7XG4gICAgaWYgKHdpbmRvdy5Xb3JrZXIpIHtcbiAgICAgIHZhciBzdHIgPSBmb28udG9TdHJpbmcoKTtcbiAgICAgIHZhciBldmVudEFyZyA9IHN0ci5zdWJzdHJpbmcoc3RyLmluZGV4T2YoXCIoXCIpICsgMSxzdHIuaW5kZXhPZihcIixcIikpO1xuICAgICAgdmFyIHBvc3RNZXNzYWdlQXJnID0gc3RyLnN1YnN0cmluZyhzdHIuaW5kZXhPZihcIixcIikgKyAxLHN0ci5pbmRleE9mKFwiKVwiKSk7XG4gICAgICB2YXIgX2Z1bmN0aW9uQm9keSA9IHN0ci5zdWJzdHJpbmcoc3RyLmluZGV4T2YoXCJ7XCIpICsgMSk7XG4gICAgICBzdHIgPSBcIm9ubWVzc2FnZT1mdW5jdGlvbihcIiArIGV2ZW50QXJnICsgXCIpe1wiICsgcG9zdE1lc3NhZ2VBcmcgKyBcIj0gcG9zdE1lc3NhZ2U7XCIgKyBfZnVuY3Rpb25Cb2R5O1xuICAgICAgdmFyIGJsb2IgPSBuZXcgQmxvYihbc3RyXSk7XG4gICAgICAvL1wib25tZXNzYWdlID0gZnVuY3Rpb24oZSkgeyBwb3N0TWVzc2FnZSgnbXNnIGZyb20gd29ya2VyJyk7IH1cIl0pO1xuICAgICAgdmFyIGJsb2JVUkwgPSB3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTtcbiAgICAgIHJldHVybiBuZXcgV29ya2VyKGJsb2JVUkwpO1xuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgd29ya2VyID0ge1xuICAgICAgICB0ZXJtaW5hdGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgfSxcbiAgICAgICAgcG9zdE1lc3NhZ2U6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBmb28oe2RhdGE6IGRhdGF9LCBmdW5jdGlvbiAocmVzcG9uc2VEYXRhKSB7XG4gICAgICAgICAgICAgIHdvcmtlci5vbm1lc3NhZ2UgJiYgd29ya2VyLm9ubWVzc2FnZSh7ZGF0YTogcmVzcG9uc2VEYXRhfSk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHdvcmtlcjtcbiAgICB9XG4gIH0sXG4gIG9ic2VydmFibGU6IGZ1bmN0aW9uIChvYmopIHtcbiAgICBfLmV4dGVuZChvYmosIHtcblxuICAgICAgZmlyZTogZnVuY3Rpb24gZmlyZShldmVudE5hbWUsIG9wdGlvbnMpIHtcbiAgICAgICAgaWYgKCF0aGlzLl9fZXZlbnRMaXN0ZW5lcnMpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGxpc3RlbmVyc0ZvckV2ZW50ID0gdGhpcy5fX2V2ZW50TGlzdGVuZXJzW2V2ZW50TmFtZV07XG4gICAgICAgIGlmICghbGlzdGVuZXJzRm9yRXZlbnQpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IGxpc3RlbmVyc0ZvckV2ZW50Lmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgbGlzdGVuZXJzRm9yRXZlbnRbaV0uY2FsbCh0aGlzLCBvcHRpb25zIHx8IHt9KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgIH0sXG4gICAgICBvbjogZnVuY3Rpb24gKGV2ZW50TmFtZSwgaGFuZGxlcikge1xuICAgICAgICBpZiAoZXZlbnROYW1lLmNvbnN0cnVjdG9yID09IE9iamVjdCkge1xuICAgICAgICAgIGZvciAodmFyIGkgaW4gZXZlbnROYW1lKSB7XG4gICAgICAgICAgICB0aGlzLm9uKGksIGV2ZW50TmFtZVtpXSlcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGV2ZW50cyA9IGV2ZW50TmFtZS5zcGxpdChcIiBcIik7XG4gICAgICAgIGZvciAodmFyIGkgaW4gZXZlbnRzKSB7XG4gICAgICAgICAgdGhpcy5vYnNlcnZlKGV2ZW50c1tpXSwgaGFuZGxlcilcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgIH0sXG4gICAgICBvYnNlcnZlOiBmdW5jdGlvbiAoZXZlbnROYW1lLCBoYW5kbGVyKSB7XG4gICAgICAgIGlmICghdGhpcy5fX2V2ZW50TGlzdGVuZXJzKSB7XG4gICAgICAgICAgdGhpcy5fX2V2ZW50TGlzdGVuZXJzID0ge307XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICBmb3IgKHZhciBwcm9wIGluIGV2ZW50TmFtZSkge1xuICAgICAgICAgICAgdGhpcy5vbihwcm9wLCBldmVudE5hbWVbcHJvcF0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICBpZiAoIXRoaXMuX19ldmVudExpc3RlbmVyc1tldmVudE5hbWVdKSB7XG4gICAgICAgICAgICB0aGlzLl9fZXZlbnRMaXN0ZW5lcnNbZXZlbnROYW1lXSA9IFtdO1xuICAgICAgICAgIH1cbiAgICAgICAgICB0aGlzLl9fZXZlbnRMaXN0ZW5lcnNbZXZlbnROYW1lXS5wdXNoKGhhbmRsZXIpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgfSxcbiAgICAgIG9mZjogZnVuY3Rpb24gc3RvcE9ic2VydmluZyhldmVudE5hbWUsIGhhbmRsZXIpIHtcbiAgICAgICAgZnVuY3Rpb24gX3JlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBoYW5kbGVyKSB7XG4gICAgICAgICAgaWYgKCF0aGlzLl9fZXZlbnRMaXN0ZW5lcnNbZXZlbnROYW1lXSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChoYW5kbGVyKSB7XG4gICAgICAgICAgICB2YXIgaWR4ID0gdGhpcy5fX2V2ZW50TGlzdGVuZXJzW2V2ZW50TmFtZV0uaW5kZXhPZihoYW5kbGVyKTtcbiAgICAgICAgICAgIGlmIChpZHggIT09IC0xKSB7XG4gICAgICAgICAgICAgIHRoaXMuX19ldmVudExpc3RlbmVyc1tldmVudE5hbWVdLnNwbGljZShpZHgsIDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuX19ldmVudExpc3RlbmVyc1tldmVudE5hbWVdLmxlbmd0aCA9IDA7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCF0aGlzLl9fZXZlbnRMaXN0ZW5lcnMpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICB0aGlzLl9fZXZlbnRMaXN0ZW5lcnMgPSB7fTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAxICYmIHR5cGVvZiBhcmd1bWVudHNbMF0gPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgZm9yICh2YXIgcHJvcCBpbiBldmVudE5hbWUpIHtcbiAgICAgICAgICAgIF9yZW1vdmVFdmVudExpc3RlbmVyLmNhbGwodGhpcywgcHJvcCwgZXZlbnROYW1lW3Byb3BdKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgX3JlbW92ZUV2ZW50TGlzdGVuZXIuY2FsbCh0aGlzLCBldmVudE5hbWUsIGhhbmRsZXIpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgfVxuICAgIH0pXG4gIH0sXG4gIGluT3JkZXI6IGZ1bmN0aW9uIChhcnJheSwgZm9vLCBjYWxsYmFjaykge1xuICAgIHZhciBfaW5kZXggPSAwO1xuICAgIGZ1bmN0aW9uIF9pbk9yZGVySW5kZXgoKSB7XG4gICAgICBpZiAoKytfaW5kZXggPCBhcnJheS5sZW5ndGgpIHtcbiAgICAgICAgZm9vKGFycmF5W19pbmRleF0sIF9pbmRleCwgX2luT3JkZXJJbmRleClcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKCk7XG4gICAgICB9XG4gICAgfVxuICAgIGZvbyhhcnJheVtfaW5kZXhdLCBfaW5kZXgsIF9pbk9yZGVySW5kZXgpXG4gIH0sXG4gIC8qKlxuICAgKiDQstC+0LfQstGA0LDRidCw0LXRgiDQvtCx0YrQtdC60YIg0YEg0LrQu9GO0YfQsNC80Lgg0YHRgtGA0L7QutC4IHVybFxuICAgKiBAcmV0dXJucyB7e319XG4gICAqL1xuICBxdWVyeVN0cmluZzogZnVuY3Rpb24gKHF1ZXJ5KSB7XG4gICAgaWYocXVlcnkpIHtcbiAgICAgIHF1ZXJ5ID0gcXVlcnkuc3Vic3RyKHF1ZXJ5LmluZGV4T2YoXCI/XCIpICsgMSkgO1xuICAgIH1lbHNle1xuICAgICAgcXVlcnkgPSB3aW5kb3cubG9jYXRpb24uc2VhcmNoLnN1YnN0cmluZygxKTtcbiAgICB9XG4gICAgdmFyIG9iaiA9IHt9O1xuICAgIHZhciBfbGVuZ3RoID0gMDtcbiAgICBpZiAoIXF1ZXJ5KXJldHVybiBvYmo7XG4gICAgdmFyIHZhcnMgPSBxdWVyeS5zcGxpdChcIiZcIik7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2YXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgcGFpciA9IHZhcnNbaV0uc3BsaXQoXCI9XCIpO1xuICAgICAgdmFyIF92bmFtZSA9IHBhaXJbMF0sIHZhbCA9IHBhaXJbMV07XG4gICAgICBpZiAodHlwZW9mIG9ialtfdm5hbWVdID09PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgIG9ialtfdm5hbWVdID0gdmFsIHx8IFwiXCI7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIF9sZW5ndGgsIHt2YWx1ZTogX3ZuYW1lLCBlbnVtZXJhYmxlOiBmYWxzZX0pO1xuICAgICAgICBfbGVuZ3RoKys7XG4gICAgICAgIC8vIElmIHNlY29uZCBlbnRyeSB3aXRoIHRoaXMgbmFtZVxuICAgICAgfSBlbHNlIGlmICh0eXBlb2Ygb2JqW192bmFtZV0gPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgdmFyIGFyciA9IFtvYmpbX3ZuYW1lXSwgdmFsXTtcbiAgICAgICAgb2JqW192bmFtZV0gPSBhcnI7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIF9sZW5ndGgsIHt2YWx1ZTogX3ZuYW1lLCBlbnVtZXJhYmxlOiBmYWxzZX0pO1xuICAgICAgICBfbGVuZ3RoKys7XG4gICAgICAgIC8vIElmIHRoaXJkIG9yIGxhdGVyIGVudHJ5IHdpdGggdGhpcyBuYW1lXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBvYmpbX3ZuYW1lXS5wdXNoKHZhbCk7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIF9sZW5ndGgsIHt2YWx1ZTogX3ZuYW1lLCBlbnVtZXJhYmxlOiBmYWxzZX0pO1xuICAgICAgICBfbGVuZ3RoKys7XG4gICAgICB9XG4gICAgfVxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIFwibGVuZ3RoXCIsIHt2YWx1ZTogX2xlbmd0aCwgZW51bWVyYWJsZTogZmFsc2V9KTtcbiAgICByZXR1cm4gb2JqO1xuICB9LFxuICBjb3B5VmFsdWU6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7XG4gICAgICByZXR1cm4gbnVsbFxuICAgIH1cbiAgICBpZiAodmFsdWUgPT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXR1cm4gdW5kZWZpbmVkXG4gICAgfVxuICAgIHN3aXRjaCAodmFsdWUuY29uc3RydWN0b3IpIHtcbiAgICAgIGNhc2UgT2JqZWN0OlxuICAgICAgICByZXR1cm4gb2JqZWN0VXRpbHMuZGVlcEV4dGVuZCh7fSwgdmFsdWUpO1xuICAgICAgY2FzZSBBcnJheTpcbiAgICAgICAgcmV0dXJuIG9iamVjdFV0aWxzLmRlZXBFeHRlbmQoW10sIHZhbHVlKTtcbiAgICAgIGNhc2UgU3RyaW5nOlxuICAgICAgY2FzZSBOdW1iZXI6XG4gICAgICBjYXNlIEJvb2xlYW46XG4gICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIC8vY29uc29sZS5sb2codmFsdWUuY29uc3RydWN0b3IpO1xuICAgICAgICByZXR1cm4gb2JqZWN0VXRpbHMuZGVlcEV4dGVuZCh7fSwgdmFsdWUpO1xuICAgIH1cbiAgfSxcbiAgY2xlYXJWYWx1ZTogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgc3dpdGNoICh2YWx1ZS5jb25zdHJ1Y3Rvcikge1xuICAgICAgY2FzZSBPYmplY3Q6XG4gICAgICAgIGZvciAodmFyIG1lbWJlciBpbiB2YWx1ZSkgZGVsZXRlIHZhbHVlW21lbWJlcl07XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBBcnJheTpcbiAgICAgICAgdmFsdWUubGVuZ3RoID0gMDtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBkZWxldGUgdmFsdWU7XG4gICAgfVxuICB9LFxuICBvYmplY3RzRGlmZmVyZW5jZTogZnVuY3Rpb24gKHByZXYsIG5vdykge1xuICAgIHZhciBjaGFuZ2VzID0ge307XG4gICAgZm9yICh2YXIgcHJvcCBpbiBub3cpIHtcbiAgICAgIGlmICghcHJldiB8fCBwcmV2W3Byb3BdICE9PSBub3dbcHJvcF0pIHtcbiAgICAgICAgaWYgKHR5cGVvZiBub3dbcHJvcF0gPT0gXCJvYmplY3RcIikge1xuICAgICAgICAgIHZhciBjID0gdXRpbHMub2JqZWN0c0RpZmZlcmVuY2UocHJldltwcm9wXSwgbm93W3Byb3BdKTtcbiAgICAgICAgICBpZiAoIV8uaXNFbXB0eShjKSkgLy8gdW5kZXJzY29yZVxuICAgICAgICAgICAgY2hhbmdlc1twcm9wXSA9IGM7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY2hhbmdlc1twcm9wXSA9IG5vd1twcm9wXTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gY2hhbmdlcztcbiAgfSxcbiAgc3BsaXRCeTogZnVuY3Rpb24gKHF1ZXJ5LCBkZWxpbWl0ZXIpIHtcbiAgICB2YXIgdHJhY2VRdWVyaWVzID0gW107XG4gICAgdmFyIHIgPSAwLFxuICAgICAgZiA9IDAsXG4gICAgICBfcF9zdGFydCA9IDA7XG4gICAgaWYgKHF1ZXJ5ID09IFwiXCIpIHJldHVybiBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHF1ZXJ5Lmxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgYyA9IHF1ZXJ5W2ldO1xuICAgICAgaWYgKGMgPT0gXCIoXCIpIHtcbiAgICAgICAgcisrO1xuICAgICAgICBmID0gMTtcbiAgICAgIH0gZWxzZSBpZiAoYyA9PSBcIilcIikge1xuICAgICAgICByLS07XG4gICAgICB9XG4gICAgICBpZiAociA9PSAwICYmIGYgPT0gMSkgZiA9IDA7XG4gICAgICBpZiAoZGVsaW1pdGVyLmluZGV4T2YoYykgIT0gLTEgJiYgciA9PSAwICYmIGYgPT0gMCkge1xuICAgICAgICB0cmFjZVF1ZXJpZXMucHVzaChxdWVyeS5zdWJzdHJpbmcoX3Bfc3RhcnQsIGkpKTtcbiAgICAgICAgX3Bfc3RhcnQgPSBpICsgMTtcbiAgICAgIH1cbiAgICB9XG4gICAgdHJhY2VRdWVyaWVzLnB1c2gocXVlcnkuc3Vic3RyaW5nKF9wX3N0YXJ0KSk7XG4gICAgcmV0dXJuIHRyYWNlUXVlcmllcztcbiAgfSxcbiAgcXVldWVMb2FkOiBmdW5jdGlvbiAodG90YWwsIGNvbXBsZXRlQ0IsIHByb2dyZXNzQ0IpIHtcbiAgICB2YXIgbG9hZGVyID0gZnVuY3Rpb24gKGVsKSB7XG4gICAgICBsb2FkZXIubG9hZGVkLnB1c2goZWwpO1xuICAgICAgbG9hZGVyLnByb2dyZXNzQ0IgJiYgbG9hZGVyLnByb2dyZXNzQ0IobG9hZGVyLmxvYWRlZC5sZW5ndGgsIGxvYWRlci50b3RhbCwgZWwsIGxvYWRlci5sb2FkZWQpO1xuXG4gICAgICBpZiAobG9hZGVyLmxvYWRlZC5sZW5ndGggPT0gbG9hZGVyLnRvdGFsKSB7XG4gICAgICAgIGxvYWRlci5jb21wbGV0ZUNCICYmIGxvYWRlci5jb21wbGV0ZUNCKGxvYWRlci5sb2FkZWQpO1xuICAgICAgICBsb2FkZXIuZmlyZShcImxvYWRlZFwiKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIGxvYWRlci5jb21wbGV0ZUNCID0gY29tcGxldGVDQjtcbiAgICBsb2FkZXIucHJvZ3Jlc3NDQiA9IHByb2dyZXNzQ0I7XG4gICAgbG9hZGVyLnRvdGFsID0gdG90YWw7XG4gICAgbG9hZGVyLmxvYWRlZCA9IFtdO1xuICAgIHV0aWxzLm9ic2VydmFibGUobG9hZGVyKTtcblxuICAgIHJldHVybiBsb2FkZXI7XG4gIH1cbn07XG5tb2R1bGUuZXhwb3J0cyA9ICB1dGlscztcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vdXRpbC91dGlsLmpzXG4vLyBtb2R1bGUgaWQgPSAzXG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIlxudmFyIEV4dENhbnZhc01peGluID0ge1xuICBkZWZhdWx0T3B0aW9uczoge30sXG4gIGFuaW1hdGVkOiBmYWxzZSxcbiAgZml0SW5kZXg6IDAuOCxcbiAgb3B0aW9uc09yZGVyOiBbXCJvcmlnaW5hbFdpZHRoXCIsXCJvcmlnaW5hbEhlaWdodFwiLFwid2lkdGhcIixcImhlaWdodFwiLFwiKlwiXSxcbiAgLyoqXG4gICAqIHJlcXVpcmVkIHRvIHNob3cgdmlkZW9cbiAgICovXG4gIHNldEFuaW1hdGVkOiBmdW5jdGlvbiAodmFsKSB7XG4gICAgaWYoIXZhbCl7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgZmFicmljLnV0aWwucmVxdWVzdEFuaW1GcmFtZShmdW5jdGlvbiByZW5kZXIoKSB7XG4gICAgICB0aGlzLnJlbmRlckFsbCgpO1xuICAgICAgZmFicmljLnV0aWwucmVxdWVzdEFuaW1GcmFtZShyZW5kZXIpO1xuICAgIH0uYmluZCh0aGlzKSk7XG4gIH0sXG4gIGZpbmQ6IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgaWYgKHR5cGVvZiBvcHRpb25zID09PSBcInN0cmluZ1wiKXtcbiAgICAgIG9wdGlvbnMgPSB7XG4gICAgICAgIHR5cGU6IG9wdGlvbnNcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhYnJpYy51dGlsLm9iamVjdC53aGVyZSh0aGlzLl9vYmplY3RzLG9wdGlvbnMpO1xuICB9LFxuICBfdXBkYXRlX2JhY2tncm91bmRfaW1hZ2U6IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgcGhvdG8gPSB0aGlzLmJhY2tncm91bmRJbWFnZTtcbiAgICBpZiAoIXBob3RvIHx8IHBob3RvLmNvbnN0cnVjdG9yID09IE9iamVjdCB8fCBwaG90by5jb25zdHJ1Y3RvciA9PSBTdHJpbmcpIHJldHVybjtcblxuICAgIGlmICh0aGlzLmJhY2tncm91bmRQb3NpdGlvbiA9PT0gJ3Jlc2l6ZScpIHtcbiAgICAgIHRoaXMub3JpZ2luYWxXaWR0aCA9IHBob3RvLndpZHRoO1xuICAgICAgdGhpcy5vcmlnaW5hbEhlaWdodCA9IHBob3RvLmhlaWdodDtcblxuICAgIH1lbHNlIGlmICh0aGlzLmJhY2tncm91bmRQb3NpdGlvbiAhPT0gJ21hbnVhbCcpIHtcblxuICAgICAgdmFyIF93ICA9ICB0aGlzLm9yaWdpbmFsV2lkdGggfHwgdGhpcy53aWR0aCwgIF9oID0gdGhpcy5vcmlnaW5hbEhlaWdodCB8fCB0aGlzLmhlaWdodDtcblxuICAgICAgaWYocGhvdG8uX29yaWdpbmFsRWxlbWVudCl7XG4gICAgICAgIHZhciBzaXplID0gZmFicmljLnV0aWwuZ2V0UHJvcG9ydGlvbnMocGhvdG8uX29yaWdpbmFsRWxlbWVudCwge1xuICAgICAgICAgIHdpZHRoOiBfdyxcbiAgICAgICAgICBoZWlnaHQ6IF9oXG4gICAgICAgIH0sIHRoaXMuYmFja2dyb3VuZFBvc2l0aW9uKTtcbiAgICAgIH1lbHNle1xuICAgICAgICBzaXplID0ge1xuICAgICAgICAgIHdpZHRoOiBfdyxcbiAgICAgICAgICBoZWlnaHQ6IF9oXG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgdmFyIF9sIDtcbiAgICAgIGlmKHRoaXMuYmFja2dyb3VuZEltYWdlLm9yaWdpblggPT0gJ2NlbnRlcicpe1xuICAgICAgICBfbCA9IF93IC8gMjtcbiAgICAgIH1lbHNle1xuICAgICAgICBfbCA9IChfdyAtIHNpemUud2lkdGgpIC8gMiA7XG4gICAgICB9XG4gICAgICB2YXIgX3QgO1xuICAgICAgaWYodGhpcy5iYWNrZ3JvdW5kSW1hZ2Uub3JpZ2luWSA9PSAnY2VudGVyJyl7XG4gICAgICAgIF90ID0gX2ggLyAyO1xuICAgICAgfWVsc2V7XG4gICAgICAgIF90ID0gKF9oIC0gc2l6ZS5oZWlnaHQpIC8gMiA7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuYmFja2dyb3VuZEltYWdlLnNldCh7XG4gICAgICAgIGxlZnQ6IF9sICsgdGhpcy52aWV3cG9ydFRyYW5zZm9ybVs0XSxcbiAgICAgICAgdG9wOiAgX3QgKyB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzVdLFxuICAgICAgICB3aWR0aDogc2l6ZS53aWR0aCxcbiAgICAgICAgaGVpZ2h0OiBzaXplLmhlaWdodFxuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIHZhciBfb3JpZyA9IHRoaXMuYmFja2dyb3VuZEltYWdlLmdldE9yaWdpbmFsU2l6ZSgpO1xuICAgICAgLy8gdGhpcy5iYWNrZ3JvdW5kSW1hZ2Uuc2V0KHtcbiAgICAgIC8vICAgb3JpZ2luWDogJ2xlZnQnLFxuICAgICAgLy8gICBvcmlnaW5ZOiAndG9wJyxcbiAgICAgIC8vICAgbGVmdDogMCwgLy90aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzRdLFxuICAgICAgLy8gICB0b3A6IDAsIC8vdGhpcy52aWV3cG9ydFRyYW5zZm9ybVs1XSxcbiAgICAgIC8vICAgd2lkdGg6IF9vcmlnLndpZHRoLFxuICAgICAgLy8gICBoZWlnaHQ6IF9vcmlnLmhlaWdodFxuICAgICAgLy8gfSk7XG4gICAgfVxuICB9LFxuICBzZXRCYWNrZ3JvdW5kSW1hZ2U6IGZ1bmN0aW9uIChiZywgY2FsbGJhY2spIHtcbiAgICB2YXIgX2JnaW1hZ2VMb2FkZWQgPSBmdW5jdGlvbiAoZWwpe1xuXG4gICAgICB0aGlzLmJhY2tncm91bmRJbWFnZSA9IGVsO1xuICAgICAgdGhpcy5iYWNrZ3JvdW5kSW1hZ2UuY2FudmFzID0gdGhpcztcbiAgICAgIHRoaXMuX3VwZGF0ZV9iYWNrZ3JvdW5kX2ltYWdlKCk7XG4gICAgICBpZighdGhpcy5vcmlnaW5hbFdpZHRoICYmICF0aGlzLm9yaWdpbmFsSGVpZ2h0KXtcbiAgICAgICAgdGhpcy5vcmlnaW5hbFdpZHRoID0gZWwud2lkdGg7XG4gICAgICAgIHRoaXMub3JpZ2luYWxIZWlnaHQgPSBlbC5oZWlnaHQ7XG4gICAgICB9XG4gICAgICB0aGlzLmZpcmUoXCJiYWNrZ3JvdW5kLWltYWdlOmxvYWRlZFwiLHt0YXJnZXQ6IGVsfSk7XG4gICAgICBjYWxsYmFjayAmJiBjYWxsYmFjaygpO1xuICAgIH1cblxuXG4gICAgaWYgKCFiZykge1xuICAgICAgdGhpcy5iYWNrZ3JvdW5kSW1hZ2UgPSBudWxsO1xuICAgICAgcmV0dXJuIGNhbGxiYWNrKCk7XG4gICAgfVxuICAgIGlmIChiZyBpbnN0YW5jZW9mIEhUTUxJbWFnZUVsZW1lbnQgfHwgYmcgaW5zdGFuY2VvZiBJbWFnZSl7XG5cbiAgICAgIHZhciBlbCA9IG5ldyBmYWJyaWMuSW1hZ2UoYmcse1xuICAgICAgICB3aWR0aDogYmcubmF0dXJhbFdpZHRoLFxuICAgICAgICBoZWlnaHQ6IGJnLm5hdHVyYWxIZWlnaHRcbiAgICAgIH0pO1xuXG4gICAgICBfYmdpbWFnZUxvYWRlZC5jYWxsKHRoaXMsZWwpO1xuICAgIH1cbiAgICBpZiAoYmcuY29uc3RydWN0b3IgPT0gU3RyaW5nKSB7XG4gICAgICBiZyA9IHtcbiAgICAgICAgc3JjOiBiZ1xuICAgICAgfVxuICAgIH1cbiAgICB2YXIgX3Byb3RvID0gdGhpcy5hcHBsaWNhdGlvbi5wcm90b3R5cGVzO1xuICAgIGlmKF9wcm90byAmJiBfcHJvdG8uU2xpZGVDYW52YXMgJiYgX3Byb3RvLlNsaWRlQ2FudmFzLmJhY2tncm91bmRJbWFnZVByb3BlcnRpZXMpe1xuICAgICAgZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChiZyxfcHJvdG8uU2xpZGVDYW52YXMuYmFja2dyb3VuZEltYWdlUHJvcGVydGllcyk7XG4gICAgfVxuICAgIGJnLmFwcGxpY2F0aW9uID0gdGhpcy5hcHBsaWNhdGlvbjtcbiAgICBiZy50eXBlID0gYmcudHlwZSB8fCBcImltYWdlXCI7XG4gICAgLy8gYmcud2lkdGggPSBiZy5uYXR1cmFsV2lkdGg7XG4gICAgLy8gYmcuaGVpZ2h0ID0gYmcubmF0dXJhbEhlaWdodDtcbiAgICAvL1xuICAgIGZhYnJpYy51dGlsLmNyZWF0ZU9iamVjdChiZyxfYmdpbWFnZUxvYWRlZC5iaW5kKHRoaXMpKTtcbiAgfSxcbiAgY3JlYXRlT2JqZWN0czogZnVuY3Rpb24ob2JqZWN0cyxjYWxsYmFjayl7XG5cbiAgICBpZih0aGlzLmFwcGxpY2F0aW9uKXtcbiAgICAgIGZvcih2YXIgaSBpbiBvYmplY3RzKXtcbiAgICAgICAgaWYob2JqZWN0c1tpXS5jb25zdHJ1Y3RvciA9PSBTdHJpbmcpe1xuICAgICAgICAgIG9iamVjdHNbaV0gPSB0aGlzLmFwcGxpY2F0aW9uLm9iamVjdHNbb2JqZWN0c1tpXV07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICB2YXIgX2NhbnZhcyA9IHRoaXM7XG5cbiAgICBmdW5jdGlvbiBzdWNjZXNzKF9vYmplY3RzKSB7XG4gICAgICBfY2FudmFzLmZpcmUoXCJwcm9ncmVzczpjb21wbGV0ZVwiLCB7b2JqZWN0czogb2JqZWN0c30pO1xuICAgICAgZm9yICh2YXIgaSBpbiBfb2JqZWN0cykge1xuICAgICAgICBfY2FudmFzLmFkZChfb2JqZWN0c1tpXS5vYmplY3QpO1xuICAgICAgfVxuICAgICAgX2NhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrLmNhbGwoX2NhbnZhcylcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBwcm9ncmVzcyhsLCB0KSB7XG4gICAgICBfY2FudmFzLmZpcmUoXCJwcm9ncmVzc1wiLCB7IGxvYWRlZCA6IGwsIHRvdGFsIDogdCB9KTtcbiAgICAgIGlmIChmYWJyaWMudXRpbC5sb2FkZXJEZWJ1Zykge1xuICAgICAgICBjb25zb2xlLmxvZyhcImxvYWRlZCBcIiArIGwgKyBcIiAvIFwiICsgdCk7XG4gICAgICB9XG4gICAgfVxuXG5cbiAgICB2YXIgX29iamVjdHMgPSBbXTtcbiAgICBpZiAoIW9iamVjdHMgfHwgIW9iamVjdHMubGVuZ3RoKSB7XG4gICAgICB0aGlzLmZpcmUoXCJwcm9ncmVzczpjb21wbGV0ZVwiLCAwKTtcbiAgICAgIHN1Y2Nlc3MoX29iamVjdHMpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHZhciBxdWV1ZUxvYWRDYWxsYmFjayA9IGZhYnJpYy51dGlsLnF1ZXVlTG9hZChvYmplY3RzLmxlbmd0aCwgZnVuY3Rpb24oKXtcbiAgICAgIHN1Y2Nlc3MoX29iamVjdHMpXG4gICAgfSwgcHJvZ3Jlc3MpO1xuXG4gICAgcXVldWVMb2FkQ2FsbGJhY2suZGF0YSA9ICh0aGlzLnRpdGxlIHx8IFwiXCIpICsgXCJvYmplY3RzXCI7XG5cbiAgICBmb3IgKHZhciBpIGluIG9iamVjdHMpIHtcbiAgICAgIChmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICB2YXIgX29iamVjdF9zbG90ID0ge29iamVjdDogbnVsbCwgb3B0aW9uczogb3B0aW9uc307XG4gICAgICAgIF9vYmplY3RzLnB1c2goX29iamVjdF9zbG90KTtcblxuICAgICAgICBvcHRpb25zLmFwcGxpY2F0aW9uID0gX2NhbnZhcy5hcHBsaWNhdGlvbjtcbiAgICAgICAgZmFicmljLnV0aWwuY3JlYXRlT2JqZWN0KG9wdGlvbnMsIGZ1bmN0aW9uIChlbCkge1xuICAgICAgICAgIF9vYmplY3Rfc2xvdC5vYmplY3QgPSBlbDtcbiAgICAgICAgICBxdWV1ZUxvYWRDYWxsYmFjaygpO1xuICAgICAgICB9KTtcbiAgICAgIH0pLmNhbGwodGhpcywgb2JqZWN0c1tpXSk7XG4gICAgfVxuICB9LFxuICAvKipcbiAgICogYXBwbHkgb3B0aW9ucyBmb3IgZ3JvdXAgb2YgZmlsdGVyZWQgb2JqZWN0c1xuICAgKiBAcGFyYW0gZmlsdGVyXG4gICAqIEBwYXJhbSBvcHRpb25zXG4gICAqL1xuICBhcHBseU9wdGlvbnM6IGZ1bmN0aW9uKGZpbHRlcixvcHRpb25zKXtcbiAgICB0aGlzLl9vYmplY3RzLmZvckVhY2goZnVuY3Rpb24oX29iail7XG4gICAgICBmb3IodmFyIHByb3AgaW4gZmlsdGVyKXtcbiAgICAgICAgaWYoX29ialtwcm9wXSAhPT0gIGZpbHRlcltwcm9wXSlyZXR1cm47XG4gICAgICB9XG4gICAgICBfb2JqLnNldE9wdGlvbnMob3B0aW9ucyk7XG4gICAgfSlcbiAgfSxcbiAgLyoqXG4gICAqIENyZWF0ZSBPYmplY3QgYnkgdHlwZSBhbmQgb3B0aW9uc1xuICAgKiBAcGFyYW0gdHlwZVxuICAgKiBAcGFyYW0gb3B0aW9uc1xuICAgKiBAcGFyYW0gY2FsbGJhY2tcbiAgICovXG4gIGNyZWF0ZU9iamVjdDogZnVuY3Rpb24gKHR5cGUsIG9wdGlvbnMsY2FsbGJhY2spIHtcbiAgICBpZih0eXBlb2YgdHlwZSAhPT0gXCJzdHJpbmdcIil7XG4gICAgICBjYWxsYmFjayA9IG9wdGlvbnM7XG4gICAgICBvcHRpb25zID0gZmFicmljLnV0aWwub2JqZWN0LmNsb25lKHR5cGUpO1xuICAgICAgdHlwZSA9IG51bGw7XG4gICAgfWVsc2V7XG4gICAgICBvcHRpb25zID0gZmFicmljLnV0aWwub2JqZWN0LmNsb25lKG9wdGlvbnMpO1xuICAgICAgb3B0aW9ucy50eXBlID0gdHlwZTtcbiAgICB9XG5cbiAgICB2YXIgX3NlbGYgPSB0aGlzO1xuICAgIG9wdGlvbnMuYXBwbGljYXRpb24gPSB0aGlzLmFwcGxpY2F0aW9uO1xuICAgLy8gdmFyIF9hY3RpdmUgPSBvcHRpb25zLmFjdGl2ZTtcbiAgIC8vIHZhciBfcG9zaXRpb24gPSBvcHRpb25zLnBvc2l0aW9uO1xuLy8gICAgZGVsZXRlIG9wdGlvbnMuYWN0aXZlO1xuICAvLyAgZGVsZXRlIG9wdGlvbnMucG9zaXRpb247XG5cblxuICAgIGZ1bmN0aW9uIF9hZGQoZWwpIHtcbiAgICAgIGlmKGVsLmNhbnZhcylyZXR1cm47XG4gICAgICBfc2VsZi5hZGQoZWwpO1xuLypcbiAgICAgIGlmKF9hY3RpdmUpe1xuICAgICAgaWYoX2FjdGl2ZSl7XG4gICAgICAgIF9zZWxmLnNldEFjdGl2ZU9iamVjdChlbCk7XG4gICAgICB9Ki9cbiAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKGVsKTtcbiAgICB9XG5cbiAgICB2YXIgZWwgPSBmYWJyaWMudXRpbC5jcmVhdGVPYmplY3Qob3B0aW9ucywgX2FkZCApO1xuICAgIGVsICYmIF9hZGQoZWwpO1xuICAgIHJldHVybiBlbDtcbiAgfSxcbiAgb25Mb2FkOiBmdW5jdGlvbiAoY2FsbGJhY2spIHtcbiAgICB0aGlzLnByb2Nlc3NpbmcgPWZhbHNlO1xuICAgIHRoaXMubG9hZGVkID0gdHJ1ZTtcbiAgICB0aGlzLmZpcmUoXCJsb2FkaW5nOmVuZFwiLHt0eXBlOiBcInNsaWRlXCIsIHRhcmdldDogdGhpc30pO1xuICAgIHRoaXMucmVuZGVyQWxsKCk7XG4gICAgY2FsbGJhY2sgJiYgY2FsbGJhY2suY2FsbCh0aGlzKTtcbiAgfSxcbiAgbG9hZDogZnVuY3Rpb24gKG9wdGlvbnMsY2FsbGJhY2spIHtcbiAgICB0aGlzLm9yaWdpbmFsV2lkdGggPSAwO1xuICAgIHRoaXMub3JpZ2luYWxIZWlnaHQgPSAwO1xuICAgIGlmICghb3B0aW9ucylyZXR1cm47XG5cbiAgICBpZighdGhpcy52aXJ0dWFsKXtcbiAgICAgIHRoaXMuY2xlYXIoKTtcbiAgICB9XG5cbiAgICBpZihvcHRpb25zLndpZHRoKXtcbiAgICAgIG9wdGlvbnMub3JpZ2luYWxXaWR0aCA9IG9wdGlvbnMud2lkdGg7XG4gICAgICBvcHRpb25zLm9yaWdpbmFsSGVpZ2h0ID0gb3B0aW9ucy5oZWlnaHQ7XG4gICAgfVxuXG4gICAgdGhpcy5wcm9jZXNzaW5nID0gdHJ1ZTtcbiAgICB0aGlzLmZpcmUoXCJsb2FkaW5nOmJlZ2luXCIse3R5cGU6IFwic2xpZGVcIiwgdGFyZ2V0OiB0aGlzfSk7XG5cbiAgICB0aGlzLnNldChvcHRpb25zLHRoaXMub25Mb2FkLmJpbmQodGhpcyxjYWxsYmFjaykpO1xuXG5cbiAgICAvL3RvZG9cbiAgICBpZih0aGlzLnBsdWdpbnMpe1xuICAgICAgdGhpcy5wbHVnaW5zLnByZWxvYWRlcnMuZm9yRWFjaChmdW5jdGlvbihwcmVsb2FkZXIpe1xuICAgICAgICBwcmVsb2FkZXIuY2FsbCh0aGlzLCBvcHRpb25zKTtcbiAgICAgICAgdGhpcy5vblJlc2l6ZSgpO1xuICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICB9XG5cblxuICB9LFxuICBzZXRPYmplY3RzOiBmdW5jdGlvbihvYmplY3RzLGNhbGxiYWNrKXtcblxuICAgIHRoaXMuY3JlYXRlT2JqZWN0cyhvYmplY3RzLGZ1bmN0aW9uKCl7XG4gICAgICBmb3IodmFyIGkgaW4gdGhpcy5fb2JqZWN0cyl7XG4gICAgICAgIHRoaXMuX29iamVjdHNbaV0uc2V0Q29vcmRzKCk7XG4gICAgICB9XG4gICAgICBjYWxsYmFjaygpO1xuICAgIH0pO1xuICB9LFxuICBvblJlc2l6ZTogZnVuY3Rpb24oKXtcbiAgICB2YXIgX3NjYWxlID0gTWF0aC5taW4oMSw4MDAgL3RoaXMud2lkdGggKTtcbiAgICAvLyB0aGlzLnNldFpvb20oX3NjYWxlKTtcbiAgICB0aGlzLnNldERpbWVuc2lvbnMoe3dpZHRoOiB0aGlzLndpZHRoLGhlaWdodDogdGhpcy5oZWlnaHR9KTtcbiAgfSxcbiAgZ2V0Q2VudGVyOiBmdW5jdGlvbiAoZWwpIHtcbiAgICByZXR1cm4ge1xuICAgICAgdG9wOiAodGhpcy5vcmlnaW5hbEhlaWdodCAgfHwgdGhpcy5nZXRIZWlnaHQoKSkgLyAyLFxuICAgICAgbGVmdDogKHRoaXMub3JpZ2luYWxXaWR0aCB8fCB0aGlzLmdldFdpZHRoKCkpIC8gMlxuICAgIH07XG4gIH0sXG4gIHNldE9yaWdpbmFsU2l6ZTogZnVuY3Rpb24gKHcsIGgpIHtcbiAgICB0aGlzLm9yaWdpbmFsV2lkdGggPSBoID8gdyA6ICh3Lm5hdHVyYWxXaWR0aCB8fCB3LndpZHRoKTtcbiAgICB0aGlzLm9yaWdpbmFsSGVpZ2h0ID0gaCA/IGggOiAody5uYXR1cmFsSGVpZ2h0IHx8IHcuaGVpZ2h0KTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxufTtcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuU3RhdGljQ2FudmFzLnByb3RvdHlwZSxFeHRDYW52YXNNaXhpbik7XG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5DYW52YXMucHJvdG90eXBlLEV4dENhbnZhc01peGluKTtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vY29yZS9zdGF0aWMtY2FudmFzLmV4dC5qc1xuLy8gbW9kdWxlIGlkID0gNFxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCJcblN0cmluZy5wcm90b3R5cGUuZm9ybWF0ICA9IGZ1bmN0aW9uICgpIHtcbiAgdmFyIHN0ciA9IHRoaXMudG9TdHJpbmcoKTtcbiAgaWYgKGFyZ3VtZW50cy5sZW5ndGgpIHtcbiAgICB2YXIgdHlwZSA9IHR5cGVvZiBhcmd1bWVudHNbMF1cbiAgICAgICwgYXJncyA9IHR5cGUgPT0gJ3N0cmluZycgfHwgdHlwZSA9PSAnbnVtYmVyJyA/IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cykgOiBhcmd1bWVudHNbMF1cbiAgICAvL1xuICAgIC8vIGZvciAodmFyIGFyZyBpbiBhcmdzKSBzdHIgPSBzdHIucmVwbGFjZShuZXcgUmVnRXhwKCdcXFxceycgKyBhcmcgKyAnXFxcXH0nLCAnZ2knKSwgYXJnc1thcmddKVxuXG4gICAgc3RyID0gc3RyLnJlcGxhY2UoL1xceyhbXn1dKilcXH0vZyxmdW5jdGlvbihhLGIpe1xuICAgICAgcmV0dXJuIHV0aWxzLmV2YWxJbkNvbnRleHQoYixhcmdzKVxuICAgIH0pXG4gIH1cblxuICByZXR1cm4gc3RyXG59O1xuXG51dGlscyA9IHtcbiAgZXh0cmFjdFZhcmlhYmxlczogZnVuY3Rpb24gKHN0cikge1xuICAgIHJldHVybiBzdHIubWF0Y2goLyg/ISg/OmRvfGlmfGlufGZvcnxsZXR8bmV3fHRyeXx2YXJ8Y2FzZXxlbHNlfGVudW18ZXZhbHxmYWxzZXxudWxsfHRoaXN8dHJ1ZXx2b2lkfHdpdGh8YnJlYWt8Y2F0Y2h8Y2xhc3N8Y29uc3R8c3VwZXJ8dGhyb3d8d2hpbGV8eWllbGR8ZGVsZXRlfGV4cG9ydHxpbXBvcnR8cHVibGljfHJldHVybnxzdGF0aWN8c3dpdGNofHR5cGVvZnxkZWZhdWx0fGV4dGVuZHN8ZmluYWxseXxwYWNrYWdlfHByaXZhdGV8Y29udGludWV8ZGVidWdnZXJ8ZnVuY3Rpb258YXJndW1lbnRzfGludGVyZmFjZXxwcm90ZWN0ZWR8aW1wbGVtZW50c3xpbnN0YW5jZW9mKSQpWyRBLVpcXF9hLXpcXHhhYVxceGI1XFx4YmFcXHhjMC1cXHhkNlxceGQ4LVxceGY2XFx4ZjgtXFx1MDJjMVxcdTAyYzYtXFx1MDJkMVxcdTAyZTAtXFx1MDJlNFxcdTAyZWNcXHUwMmVlXFx1MDM3MC1cXHUwMzc0XFx1MDM3NlxcdTAzNzdcXHUwMzdhLVxcdTAzN2RcXHUwMzg2XFx1MDM4OC1cXHUwMzhhXFx1MDM4Y1xcdTAzOGUtXFx1MDNhMVxcdTAzYTMtXFx1MDNmNVxcdTAzZjctXFx1MDQ4MVxcdTA0OGEtXFx1MDUyN1xcdTA1MzEtXFx1MDU1NlxcdTA1NTlcXHUwNTYxLVxcdTA1ODdcXHUwNWQwLVxcdTA1ZWFcXHUwNWYwLVxcdTA1ZjJcXHUwNjIwLVxcdTA2NGFcXHUwNjZlXFx1MDY2ZlxcdTA2NzEtXFx1MDZkM1xcdTA2ZDVcXHUwNmU1XFx1MDZlNlxcdTA2ZWVcXHUwNmVmXFx1MDZmYS1cXHUwNmZjXFx1MDZmZlxcdTA3MTBcXHUwNzEyLVxcdTA3MmZcXHUwNzRkLVxcdTA3YTVcXHUwN2IxXFx1MDdjYS1cXHUwN2VhXFx1MDdmNFxcdTA3ZjVcXHUwN2ZhXFx1MDgwMC1cXHUwODE1XFx1MDgxYVxcdTA4MjRcXHUwODI4XFx1MDg0MC1cXHUwODU4XFx1MDhhMFxcdTA4YTItXFx1MDhhY1xcdTA5MDQtXFx1MDkzOVxcdTA5M2RcXHUwOTUwXFx1MDk1OC1cXHUwOTYxXFx1MDk3MS1cXHUwOTc3XFx1MDk3OS1cXHUwOTdmXFx1MDk4NS1cXHUwOThjXFx1MDk4ZlxcdTA5OTBcXHUwOTkzLVxcdTA5YThcXHUwOWFhLVxcdTA5YjBcXHUwOWIyXFx1MDliNi1cXHUwOWI5XFx1MDliZFxcdTA5Y2VcXHUwOWRjXFx1MDlkZFxcdTA5ZGYtXFx1MDllMVxcdTA5ZjBcXHUwOWYxXFx1MGEwNS1cXHUwYTBhXFx1MGEwZlxcdTBhMTBcXHUwYTEzLVxcdTBhMjhcXHUwYTJhLVxcdTBhMzBcXHUwYTMyXFx1MGEzM1xcdTBhMzVcXHUwYTM2XFx1MGEzOFxcdTBhMzlcXHUwYTU5LVxcdTBhNWNcXHUwYTVlXFx1MGE3Mi1cXHUwYTc0XFx1MGE4NS1cXHUwYThkXFx1MGE4Zi1cXHUwYTkxXFx1MGE5My1cXHUwYWE4XFx1MGFhYS1cXHUwYWIwXFx1MGFiMlxcdTBhYjNcXHUwYWI1LVxcdTBhYjlcXHUwYWJkXFx1MGFkMFxcdTBhZTBcXHUwYWUxXFx1MGIwNS1cXHUwYjBjXFx1MGIwZlxcdTBiMTBcXHUwYjEzLVxcdTBiMjhcXHUwYjJhLVxcdTBiMzBcXHUwYjMyXFx1MGIzM1xcdTBiMzUtXFx1MGIzOVxcdTBiM2RcXHUwYjVjXFx1MGI1ZFxcdTBiNWYtXFx1MGI2MVxcdTBiNzFcXHUwYjgzXFx1MGI4NS1cXHUwYjhhXFx1MGI4ZS1cXHUwYjkwXFx1MGI5Mi1cXHUwYjk1XFx1MGI5OVxcdTBiOWFcXHUwYjljXFx1MGI5ZVxcdTBiOWZcXHUwYmEzXFx1MGJhNFxcdTBiYTgtXFx1MGJhYVxcdTBiYWUtXFx1MGJiOVxcdTBiZDBcXHUwYzA1LVxcdTBjMGNcXHUwYzBlLVxcdTBjMTBcXHUwYzEyLVxcdTBjMjhcXHUwYzJhLVxcdTBjMzNcXHUwYzM1LVxcdTBjMzlcXHUwYzNkXFx1MGM1OFxcdTBjNTlcXHUwYzYwXFx1MGM2MVxcdTBjODUtXFx1MGM4Y1xcdTBjOGUtXFx1MGM5MFxcdTBjOTItXFx1MGNhOFxcdTBjYWEtXFx1MGNiM1xcdTBjYjUtXFx1MGNiOVxcdTBjYmRcXHUwY2RlXFx1MGNlMFxcdTBjZTFcXHUwY2YxXFx1MGNmMlxcdTBkMDUtXFx1MGQwY1xcdTBkMGUtXFx1MGQxMFxcdTBkMTItXFx1MGQzYVxcdTBkM2RcXHUwZDRlXFx1MGQ2MFxcdTBkNjFcXHUwZDdhLVxcdTBkN2ZcXHUwZDg1LVxcdTBkOTZcXHUwZDlhLVxcdTBkYjFcXHUwZGIzLVxcdTBkYmJcXHUwZGJkXFx1MGRjMC1cXHUwZGM2XFx1MGUwMS1cXHUwZTMwXFx1MGUzMlxcdTBlMzNcXHUwZTQwLVxcdTBlNDZcXHUwZTgxXFx1MGU4MlxcdTBlODRcXHUwZTg3XFx1MGU4OFxcdTBlOGFcXHUwZThkXFx1MGU5NC1cXHUwZTk3XFx1MGU5OS1cXHUwZTlmXFx1MGVhMS1cXHUwZWEzXFx1MGVhNVxcdTBlYTdcXHUwZWFhXFx1MGVhYlxcdTBlYWQtXFx1MGViMFxcdTBlYjJcXHUwZWIzXFx1MGViZFxcdTBlYzAtXFx1MGVjNFxcdTBlYzZcXHUwZWRjLVxcdTBlZGZcXHUwZjAwXFx1MGY0MC1cXHUwZjQ3XFx1MGY0OS1cXHUwZjZjXFx1MGY4OC1cXHUwZjhjXFx1MTAwMC1cXHUxMDJhXFx1MTAzZlxcdTEwNTAtXFx1MTA1NVxcdTEwNWEtXFx1MTA1ZFxcdTEwNjFcXHUxMDY1XFx1MTA2NlxcdTEwNmUtXFx1MTA3MFxcdTEwNzUtXFx1MTA4MVxcdTEwOGVcXHUxMGEwLVxcdTEwYzVcXHUxMGM3XFx1MTBjZFxcdTEwZDAtXFx1MTBmYVxcdTEwZmMtXFx1MTI0OFxcdTEyNGEtXFx1MTI0ZFxcdTEyNTAtXFx1MTI1NlxcdTEyNThcXHUxMjVhLVxcdTEyNWRcXHUxMjYwLVxcdTEyODhcXHUxMjhhLVxcdTEyOGRcXHUxMjkwLVxcdTEyYjBcXHUxMmIyLVxcdTEyYjVcXHUxMmI4LVxcdTEyYmVcXHUxMmMwXFx1MTJjMi1cXHUxMmM1XFx1MTJjOC1cXHUxMmQ2XFx1MTJkOC1cXHUxMzEwXFx1MTMxMi1cXHUxMzE1XFx1MTMxOC1cXHUxMzVhXFx1MTM4MC1cXHUxMzhmXFx1MTNhMC1cXHUxM2Y0XFx1MTQwMS1cXHUxNjZjXFx1MTY2Zi1cXHUxNjdmXFx1MTY4MS1cXHUxNjlhXFx1MTZhMC1cXHUxNmVhXFx1MTZlZS1cXHUxNmYwXFx1MTcwMC1cXHUxNzBjXFx1MTcwZS1cXHUxNzExXFx1MTcyMC1cXHUxNzMxXFx1MTc0MC1cXHUxNzUxXFx1MTc2MC1cXHUxNzZjXFx1MTc2ZS1cXHUxNzcwXFx1MTc4MC1cXHUxN2IzXFx1MTdkN1xcdTE3ZGNcXHUxODIwLVxcdTE4NzdcXHUxODgwLVxcdTE4YThcXHUxOGFhXFx1MThiMC1cXHUxOGY1XFx1MTkwMC1cXHUxOTFjXFx1MTk1MC1cXHUxOTZkXFx1MTk3MC1cXHUxOTc0XFx1MTk4MC1cXHUxOWFiXFx1MTljMS1cXHUxOWM3XFx1MWEwMC1cXHUxYTE2XFx1MWEyMC1cXHUxYTU0XFx1MWFhN1xcdTFiMDUtXFx1MWIzM1xcdTFiNDUtXFx1MWI0YlxcdTFiODMtXFx1MWJhMFxcdTFiYWVcXHUxYmFmXFx1MWJiYS1cXHUxYmU1XFx1MWMwMC1cXHUxYzIzXFx1MWM0ZC1cXHUxYzRmXFx1MWM1YS1cXHUxYzdkXFx1MWNlOS1cXHUxY2VjXFx1MWNlZS1cXHUxY2YxXFx1MWNmNVxcdTFjZjZcXHUxZDAwLVxcdTFkYmZcXHUxZTAwLVxcdTFmMTVcXHUxZjE4LVxcdTFmMWRcXHUxZjIwLVxcdTFmNDVcXHUxZjQ4LVxcdTFmNGRcXHUxZjUwLVxcdTFmNTdcXHUxZjU5XFx1MWY1YlxcdTFmNWRcXHUxZjVmLVxcdTFmN2RcXHUxZjgwLVxcdTFmYjRcXHUxZmI2LVxcdTFmYmNcXHUxZmJlXFx1MWZjMi1cXHUxZmM0XFx1MWZjNi1cXHUxZmNjXFx1MWZkMC1cXHUxZmQzXFx1MWZkNi1cXHUxZmRiXFx1MWZlMC1cXHUxZmVjXFx1MWZmMi1cXHUxZmY0XFx1MWZmNi1cXHUxZmZjXFx1MjA3MVxcdTIwN2ZcXHUyMDkwLVxcdTIwOWNcXHUyMTAyXFx1MjEwN1xcdTIxMGEtXFx1MjExM1xcdTIxMTVcXHUyMTE5LVxcdTIxMWRcXHUyMTI0XFx1MjEyNlxcdTIxMjhcXHUyMTJhLVxcdTIxMmRcXHUyMTJmLVxcdTIxMzlcXHUyMTNjLVxcdTIxM2ZcXHUyMTQ1LVxcdTIxNDlcXHUyMTRlXFx1MjE2MC1cXHUyMTg4XFx1MmMwMC1cXHUyYzJlXFx1MmMzMC1cXHUyYzVlXFx1MmM2MC1cXHUyY2U0XFx1MmNlYi1cXHUyY2VlXFx1MmNmMlxcdTJjZjNcXHUyZDAwLVxcdTJkMjVcXHUyZDI3XFx1MmQyZFxcdTJkMzAtXFx1MmQ2N1xcdTJkNmZcXHUyZDgwLVxcdTJkOTZcXHUyZGEwLVxcdTJkYTZcXHUyZGE4LVxcdTJkYWVcXHUyZGIwLVxcdTJkYjZcXHUyZGI4LVxcdTJkYmVcXHUyZGMwLVxcdTJkYzZcXHUyZGM4LVxcdTJkY2VcXHUyZGQwLVxcdTJkZDZcXHUyZGQ4LVxcdTJkZGVcXHUyZTJmXFx1MzAwNS1cXHUzMDA3XFx1MzAyMS1cXHUzMDI5XFx1MzAzMS1cXHUzMDM1XFx1MzAzOC1cXHUzMDNjXFx1MzA0MS1cXHUzMDk2XFx1MzA5ZC1cXHUzMDlmXFx1MzBhMS1cXHUzMGZhXFx1MzBmYy1cXHUzMGZmXFx1MzEwNS1cXHUzMTJkXFx1MzEzMS1cXHUzMThlXFx1MzFhMC1cXHUzMWJhXFx1MzFmMC1cXHUzMWZmXFx1MzQwMC1cXHU0ZGI1XFx1NGUwMC1cXHU5ZmNjXFx1YTAwMC1cXHVhNDhjXFx1YTRkMC1cXHVhNGZkXFx1YTUwMC1cXHVhNjBjXFx1YTYxMC1cXHVhNjFmXFx1YTYyYVxcdWE2MmJcXHVhNjQwLVxcdWE2NmVcXHVhNjdmLVxcdWE2OTdcXHVhNmEwLVxcdWE2ZWZcXHVhNzE3LVxcdWE3MWZcXHVhNzIyLVxcdWE3ODhcXHVhNzhiLVxcdWE3OGVcXHVhNzkwLVxcdWE3OTNcXHVhN2EwLVxcdWE3YWFcXHVhN2Y4LVxcdWE4MDFcXHVhODAzLVxcdWE4MDVcXHVhODA3LVxcdWE4MGFcXHVhODBjLVxcdWE4MjJcXHVhODQwLVxcdWE4NzNcXHVhODgyLVxcdWE4YjNcXHVhOGYyLVxcdWE4ZjdcXHVhOGZiXFx1YTkwYS1cXHVhOTI1XFx1YTkzMC1cXHVhOTQ2XFx1YTk2MC1cXHVhOTdjXFx1YTk4NC1cXHVhOWIyXFx1YTljZlxcdWFhMDAtXFx1YWEyOFxcdWFhNDAtXFx1YWE0MlxcdWFhNDQtXFx1YWE0YlxcdWFhNjAtXFx1YWE3NlxcdWFhN2FcXHVhYTgwLVxcdWFhYWZcXHVhYWIxXFx1YWFiNVxcdWFhYjZcXHVhYWI5LVxcdWFhYmRcXHVhYWMwXFx1YWFjMlxcdWFhZGItXFx1YWFkZFxcdWFhZTAtXFx1YWFlYVxcdWFhZjItXFx1YWFmNFxcdWFiMDEtXFx1YWIwNlxcdWFiMDktXFx1YWIwZVxcdWFiMTEtXFx1YWIxNlxcdWFiMjAtXFx1YWIyNlxcdWFiMjgtXFx1YWIyZVxcdWFiYzAtXFx1YWJlMlxcdWFjMDAtXFx1ZDdhM1xcdWQ3YjAtXFx1ZDdjNlxcdWQ3Y2ItXFx1ZDdmYlxcdWY5MDAtXFx1ZmE2ZFxcdWZhNzAtXFx1ZmFkOVxcdWZiMDAtXFx1ZmIwNlxcdWZiMTMtXFx1ZmIxN1xcdWZiMWRcXHVmYjFmLVxcdWZiMjhcXHVmYjJhLVxcdWZiMzZcXHVmYjM4LVxcdWZiM2NcXHVmYjNlXFx1ZmI0MFxcdWZiNDFcXHVmYjQzXFx1ZmI0NFxcdWZiNDYtXFx1ZmJiMVxcdWZiZDMtXFx1ZmQzZFxcdWZkNTAtXFx1ZmQ4ZlxcdWZkOTItXFx1ZmRjN1xcdWZkZjAtXFx1ZmRmYlxcdWZlNzAtXFx1ZmU3NFxcdWZlNzYtXFx1ZmVmY1xcdWZmMjEtXFx1ZmYzYVxcdWZmNDEtXFx1ZmY1YVxcdWZmNjYtXFx1ZmZiZVxcdWZmYzItXFx1ZmZjN1xcdWZmY2EtXFx1ZmZjZlxcdWZmZDItXFx1ZmZkN1xcdWZmZGEtXFx1ZmZkY11bJEEtWlxcX2EtelxceGFhXFx4YjVcXHhiYVxceGMwLVxceGQ2XFx4ZDgtXFx4ZjZcXHhmOC1cXHUwMmMxXFx1MDJjNi1cXHUwMmQxXFx1MDJlMC1cXHUwMmU0XFx1MDJlY1xcdTAyZWVcXHUwMzcwLVxcdTAzNzRcXHUwMzc2XFx1MDM3N1xcdTAzN2EtXFx1MDM3ZFxcdTAzODZcXHUwMzg4LVxcdTAzOGFcXHUwMzhjXFx1MDM4ZS1cXHUwM2ExXFx1MDNhMy1cXHUwM2Y1XFx1MDNmNy1cXHUwNDgxXFx1MDQ4YS1cXHUwNTI3XFx1MDUzMS1cXHUwNTU2XFx1MDU1OVxcdTA1NjEtXFx1MDU4N1xcdTA1ZDAtXFx1MDVlYVxcdTA1ZjAtXFx1MDVmMlxcdTA2MjAtXFx1MDY0YVxcdTA2NmVcXHUwNjZmXFx1MDY3MS1cXHUwNmQzXFx1MDZkNVxcdTA2ZTVcXHUwNmU2XFx1MDZlZVxcdTA2ZWZcXHUwNmZhLVxcdTA2ZmNcXHUwNmZmXFx1MDcxMFxcdTA3MTItXFx1MDcyZlxcdTA3NGQtXFx1MDdhNVxcdTA3YjFcXHUwN2NhLVxcdTA3ZWFcXHUwN2Y0XFx1MDdmNVxcdTA3ZmFcXHUwODAwLVxcdTA4MTVcXHUwODFhXFx1MDgyNFxcdTA4MjhcXHUwODQwLVxcdTA4NThcXHUwOGEwXFx1MDhhMi1cXHUwOGFjXFx1MDkwNC1cXHUwOTM5XFx1MDkzZFxcdTA5NTBcXHUwOTU4LVxcdTA5NjFcXHUwOTcxLVxcdTA5NzdcXHUwOTc5LVxcdTA5N2ZcXHUwOTg1LVxcdTA5OGNcXHUwOThmXFx1MDk5MFxcdTA5OTMtXFx1MDlhOFxcdTA5YWEtXFx1MDliMFxcdTA5YjJcXHUwOWI2LVxcdTA5YjlcXHUwOWJkXFx1MDljZVxcdTA5ZGNcXHUwOWRkXFx1MDlkZi1cXHUwOWUxXFx1MDlmMFxcdTA5ZjFcXHUwYTA1LVxcdTBhMGFcXHUwYTBmXFx1MGExMFxcdTBhMTMtXFx1MGEyOFxcdTBhMmEtXFx1MGEzMFxcdTBhMzJcXHUwYTMzXFx1MGEzNVxcdTBhMzZcXHUwYTM4XFx1MGEzOVxcdTBhNTktXFx1MGE1Y1xcdTBhNWVcXHUwYTcyLVxcdTBhNzRcXHUwYTg1LVxcdTBhOGRcXHUwYThmLVxcdTBhOTFcXHUwYTkzLVxcdTBhYThcXHUwYWFhLVxcdTBhYjBcXHUwYWIyXFx1MGFiM1xcdTBhYjUtXFx1MGFiOVxcdTBhYmRcXHUwYWQwXFx1MGFlMFxcdTBhZTFcXHUwYjA1LVxcdTBiMGNcXHUwYjBmXFx1MGIxMFxcdTBiMTMtXFx1MGIyOFxcdTBiMmEtXFx1MGIzMFxcdTBiMzJcXHUwYjMzXFx1MGIzNS1cXHUwYjM5XFx1MGIzZFxcdTBiNWNcXHUwYjVkXFx1MGI1Zi1cXHUwYjYxXFx1MGI3MVxcdTBiODNcXHUwYjg1LVxcdTBiOGFcXHUwYjhlLVxcdTBiOTBcXHUwYjkyLVxcdTBiOTVcXHUwYjk5XFx1MGI5YVxcdTBiOWNcXHUwYjllXFx1MGI5ZlxcdTBiYTNcXHUwYmE0XFx1MGJhOC1cXHUwYmFhXFx1MGJhZS1cXHUwYmI5XFx1MGJkMFxcdTBjMDUtXFx1MGMwY1xcdTBjMGUtXFx1MGMxMFxcdTBjMTItXFx1MGMyOFxcdTBjMmEtXFx1MGMzM1xcdTBjMzUtXFx1MGMzOVxcdTBjM2RcXHUwYzU4XFx1MGM1OVxcdTBjNjBcXHUwYzYxXFx1MGM4NS1cXHUwYzhjXFx1MGM4ZS1cXHUwYzkwXFx1MGM5Mi1cXHUwY2E4XFx1MGNhYS1cXHUwY2IzXFx1MGNiNS1cXHUwY2I5XFx1MGNiZFxcdTBjZGVcXHUwY2UwXFx1MGNlMVxcdTBjZjFcXHUwY2YyXFx1MGQwNS1cXHUwZDBjXFx1MGQwZS1cXHUwZDEwXFx1MGQxMi1cXHUwZDNhXFx1MGQzZFxcdTBkNGVcXHUwZDYwXFx1MGQ2MVxcdTBkN2EtXFx1MGQ3ZlxcdTBkODUtXFx1MGQ5NlxcdTBkOWEtXFx1MGRiMVxcdTBkYjMtXFx1MGRiYlxcdTBkYmRcXHUwZGMwLVxcdTBkYzZcXHUwZTAxLVxcdTBlMzBcXHUwZTMyXFx1MGUzM1xcdTBlNDAtXFx1MGU0NlxcdTBlODFcXHUwZTgyXFx1MGU4NFxcdTBlODdcXHUwZTg4XFx1MGU4YVxcdTBlOGRcXHUwZTk0LVxcdTBlOTdcXHUwZTk5LVxcdTBlOWZcXHUwZWExLVxcdTBlYTNcXHUwZWE1XFx1MGVhN1xcdTBlYWFcXHUwZWFiXFx1MGVhZC1cXHUwZWIwXFx1MGViMlxcdTBlYjNcXHUwZWJkXFx1MGVjMC1cXHUwZWM0XFx1MGVjNlxcdTBlZGMtXFx1MGVkZlxcdTBmMDBcXHUwZjQwLVxcdTBmNDdcXHUwZjQ5LVxcdTBmNmNcXHUwZjg4LVxcdTBmOGNcXHUxMDAwLVxcdTEwMmFcXHUxMDNmXFx1MTA1MC1cXHUxMDU1XFx1MTA1YS1cXHUxMDVkXFx1MTA2MVxcdTEwNjVcXHUxMDY2XFx1MTA2ZS1cXHUxMDcwXFx1MTA3NS1cXHUxMDgxXFx1MTA4ZVxcdTEwYTAtXFx1MTBjNVxcdTEwYzdcXHUxMGNkXFx1MTBkMC1cXHUxMGZhXFx1MTBmYy1cXHUxMjQ4XFx1MTI0YS1cXHUxMjRkXFx1MTI1MC1cXHUxMjU2XFx1MTI1OFxcdTEyNWEtXFx1MTI1ZFxcdTEyNjAtXFx1MTI4OFxcdTEyOGEtXFx1MTI4ZFxcdTEyOTAtXFx1MTJiMFxcdTEyYjItXFx1MTJiNVxcdTEyYjgtXFx1MTJiZVxcdTEyYzBcXHUxMmMyLVxcdTEyYzVcXHUxMmM4LVxcdTEyZDZcXHUxMmQ4LVxcdTEzMTBcXHUxMzEyLVxcdTEzMTVcXHUxMzE4LVxcdTEzNWFcXHUxMzgwLVxcdTEzOGZcXHUxM2EwLVxcdTEzZjRcXHUxNDAxLVxcdTE2NmNcXHUxNjZmLVxcdTE2N2ZcXHUxNjgxLVxcdTE2OWFcXHUxNmEwLVxcdTE2ZWFcXHUxNmVlLVxcdTE2ZjBcXHUxNzAwLVxcdTE3MGNcXHUxNzBlLVxcdTE3MTFcXHUxNzIwLVxcdTE3MzFcXHUxNzQwLVxcdTE3NTFcXHUxNzYwLVxcdTE3NmNcXHUxNzZlLVxcdTE3NzBcXHUxNzgwLVxcdTE3YjNcXHUxN2Q3XFx1MTdkY1xcdTE4MjAtXFx1MTg3N1xcdTE4ODAtXFx1MThhOFxcdTE4YWFcXHUxOGIwLVxcdTE4ZjVcXHUxOTAwLVxcdTE5MWNcXHUxOTUwLVxcdTE5NmRcXHUxOTcwLVxcdTE5NzRcXHUxOTgwLVxcdTE5YWJcXHUxOWMxLVxcdTE5YzdcXHUxYTAwLVxcdTFhMTZcXHUxYTIwLVxcdTFhNTRcXHUxYWE3XFx1MWIwNS1cXHUxYjMzXFx1MWI0NS1cXHUxYjRiXFx1MWI4My1cXHUxYmEwXFx1MWJhZVxcdTFiYWZcXHUxYmJhLVxcdTFiZTVcXHUxYzAwLVxcdTFjMjNcXHUxYzRkLVxcdTFjNGZcXHUxYzVhLVxcdTFjN2RcXHUxY2U5LVxcdTFjZWNcXHUxY2VlLVxcdTFjZjFcXHUxY2Y1XFx1MWNmNlxcdTFkMDAtXFx1MWRiZlxcdTFlMDAtXFx1MWYxNVxcdTFmMTgtXFx1MWYxZFxcdTFmMjAtXFx1MWY0NVxcdTFmNDgtXFx1MWY0ZFxcdTFmNTAtXFx1MWY1N1xcdTFmNTlcXHUxZjViXFx1MWY1ZFxcdTFmNWYtXFx1MWY3ZFxcdTFmODAtXFx1MWZiNFxcdTFmYjYtXFx1MWZiY1xcdTFmYmVcXHUxZmMyLVxcdTFmYzRcXHUxZmM2LVxcdTFmY2NcXHUxZmQwLVxcdTFmZDNcXHUxZmQ2LVxcdTFmZGJcXHUxZmUwLVxcdTFmZWNcXHUxZmYyLVxcdTFmZjRcXHUxZmY2LVxcdTFmZmNcXHUyMDcxXFx1MjA3ZlxcdTIwOTAtXFx1MjA5Y1xcdTIxMDJcXHUyMTA3XFx1MjEwYS1cXHUyMTEzXFx1MjExNVxcdTIxMTktXFx1MjExZFxcdTIxMjRcXHUyMTI2XFx1MjEyOFxcdTIxMmEtXFx1MjEyZFxcdTIxMmYtXFx1MjEzOVxcdTIxM2MtXFx1MjEzZlxcdTIxNDUtXFx1MjE0OVxcdTIxNGVcXHUyMTYwLVxcdTIxODhcXHUyYzAwLVxcdTJjMmVcXHUyYzMwLVxcdTJjNWVcXHUyYzYwLVxcdTJjZTRcXHUyY2ViLVxcdTJjZWVcXHUyY2YyXFx1MmNmM1xcdTJkMDAtXFx1MmQyNVxcdTJkMjdcXHUyZDJkXFx1MmQzMC1cXHUyZDY3XFx1MmQ2ZlxcdTJkODAtXFx1MmQ5NlxcdTJkYTAtXFx1MmRhNlxcdTJkYTgtXFx1MmRhZVxcdTJkYjAtXFx1MmRiNlxcdTJkYjgtXFx1MmRiZVxcdTJkYzAtXFx1MmRjNlxcdTJkYzgtXFx1MmRjZVxcdTJkZDAtXFx1MmRkNlxcdTJkZDgtXFx1MmRkZVxcdTJlMmZcXHUzMDA1LVxcdTMwMDdcXHUzMDIxLVxcdTMwMjlcXHUzMDMxLVxcdTMwMzVcXHUzMDM4LVxcdTMwM2NcXHUzMDQxLVxcdTMwOTZcXHUzMDlkLVxcdTMwOWZcXHUzMGExLVxcdTMwZmFcXHUzMGZjLVxcdTMwZmZcXHUzMTA1LVxcdTMxMmRcXHUzMTMxLVxcdTMxOGVcXHUzMWEwLVxcdTMxYmFcXHUzMWYwLVxcdTMxZmZcXHUzNDAwLVxcdTRkYjVcXHU0ZTAwLVxcdTlmY2NcXHVhMDAwLVxcdWE0OGNcXHVhNGQwLVxcdWE0ZmRcXHVhNTAwLVxcdWE2MGNcXHVhNjEwLVxcdWE2MWZcXHVhNjJhXFx1YTYyYlxcdWE2NDAtXFx1YTY2ZVxcdWE2N2YtXFx1YTY5N1xcdWE2YTAtXFx1YTZlZlxcdWE3MTctXFx1YTcxZlxcdWE3MjItXFx1YTc4OFxcdWE3OGItXFx1YTc4ZVxcdWE3OTAtXFx1YTc5M1xcdWE3YTAtXFx1YTdhYVxcdWE3ZjgtXFx1YTgwMVxcdWE4MDMtXFx1YTgwNVxcdWE4MDctXFx1YTgwYVxcdWE4MGMtXFx1YTgyMlxcdWE4NDAtXFx1YTg3M1xcdWE4ODItXFx1YThiM1xcdWE4ZjItXFx1YThmN1xcdWE4ZmJcXHVhOTBhLVxcdWE5MjVcXHVhOTMwLVxcdWE5NDZcXHVhOTYwLVxcdWE5N2NcXHVhOTg0LVxcdWE5YjJcXHVhOWNmXFx1YWEwMC1cXHVhYTI4XFx1YWE0MC1cXHVhYTQyXFx1YWE0NC1cXHVhYTRiXFx1YWE2MC1cXHVhYTc2XFx1YWE3YVxcdWFhODAtXFx1YWFhZlxcdWFhYjFcXHVhYWI1XFx1YWFiNlxcdWFhYjktXFx1YWFiZFxcdWFhYzBcXHVhYWMyXFx1YWFkYi1cXHVhYWRkXFx1YWFlMC1cXHVhYWVhXFx1YWFmMi1cXHVhYWY0XFx1YWIwMS1cXHVhYjA2XFx1YWIwOS1cXHVhYjBlXFx1YWIxMS1cXHVhYjE2XFx1YWIyMC1cXHVhYjI2XFx1YWIyOC1cXHVhYjJlXFx1YWJjMC1cXHVhYmUyXFx1YWMwMC1cXHVkN2EzXFx1ZDdiMC1cXHVkN2M2XFx1ZDdjYi1cXHVkN2ZiXFx1ZjkwMC1cXHVmYTZkXFx1ZmE3MC1cXHVmYWQ5XFx1ZmIwMC1cXHVmYjA2XFx1ZmIxMy1cXHVmYjE3XFx1ZmIxZFxcdWZiMWYtXFx1ZmIyOFxcdWZiMmEtXFx1ZmIzNlxcdWZiMzgtXFx1ZmIzY1xcdWZiM2VcXHVmYjQwXFx1ZmI0MVxcdWZiNDNcXHVmYjQ0XFx1ZmI0Ni1cXHVmYmIxXFx1ZmJkMy1cXHVmZDNkXFx1ZmQ1MC1cXHVmZDhmXFx1ZmQ5Mi1cXHVmZGM3XFx1ZmRmMC1cXHVmZGZiXFx1ZmU3MC1cXHVmZTc0XFx1ZmU3Ni1cXHVmZWZjXFx1ZmYyMS1cXHVmZjNhXFx1ZmY0MS1cXHVmZjVhXFx1ZmY2Ni1cXHVmZmJlXFx1ZmZjMi1cXHVmZmM3XFx1ZmZjYS1cXHVmZmNmXFx1ZmZkMi1cXHVmZmQ3XFx1ZmZkYS1cXHVmZmRjMC05XFx1MDMwMC1cXHUwMzZmXFx1MDQ4My1cXHUwNDg3XFx1MDU5MS1cXHUwNWJkXFx1MDViZlxcdTA1YzFcXHUwNWMyXFx1MDVjNFxcdTA1YzVcXHUwNWM3XFx1MDYxMC1cXHUwNjFhXFx1MDY0Yi1cXHUwNjY5XFx1MDY3MFxcdTA2ZDYtXFx1MDZkY1xcdTA2ZGYtXFx1MDZlNFxcdTA2ZTdcXHUwNmU4XFx1MDZlYS1cXHUwNmVkXFx1MDZmMC1cXHUwNmY5XFx1MDcxMVxcdTA3MzAtXFx1MDc0YVxcdTA3YTYtXFx1MDdiMFxcdTA3YzAtXFx1MDdjOVxcdTA3ZWItXFx1MDdmM1xcdTA4MTYtXFx1MDgxOVxcdTA4MWItXFx1MDgyM1xcdTA4MjUtXFx1MDgyN1xcdTA4MjktXFx1MDgyZFxcdTA4NTktXFx1MDg1YlxcdTA4ZTQtXFx1MDhmZVxcdTA5MDAtXFx1MDkwM1xcdTA5M2EtXFx1MDkzY1xcdTA5M2UtXFx1MDk0ZlxcdTA5NTEtXFx1MDk1N1xcdTA5NjJcXHUwOTYzXFx1MDk2Ni1cXHUwOTZmXFx1MDk4MS1cXHUwOTgzXFx1MDliY1xcdTA5YmUtXFx1MDljNFxcdTA5YzdcXHUwOWM4XFx1MDljYi1cXHUwOWNkXFx1MDlkN1xcdTA5ZTJcXHUwOWUzXFx1MDllNi1cXHUwOWVmXFx1MGEwMS1cXHUwYTAzXFx1MGEzY1xcdTBhM2UtXFx1MGE0MlxcdTBhNDdcXHUwYTQ4XFx1MGE0Yi1cXHUwYTRkXFx1MGE1MVxcdTBhNjYtXFx1MGE3MVxcdTBhNzVcXHUwYTgxLVxcdTBhODNcXHUwYWJjXFx1MGFiZS1cXHUwYWM1XFx1MGFjNy1cXHUwYWM5XFx1MGFjYi1cXHUwYWNkXFx1MGFlMlxcdTBhZTNcXHUwYWU2LVxcdTBhZWZcXHUwYjAxLVxcdTBiMDNcXHUwYjNjXFx1MGIzZS1cXHUwYjQ0XFx1MGI0N1xcdTBiNDhcXHUwYjRiLVxcdTBiNGRcXHUwYjU2XFx1MGI1N1xcdTBiNjJcXHUwYjYzXFx1MGI2Ni1cXHUwYjZmXFx1MGI4MlxcdTBiYmUtXFx1MGJjMlxcdTBiYzYtXFx1MGJjOFxcdTBiY2EtXFx1MGJjZFxcdTBiZDdcXHUwYmU2LVxcdTBiZWZcXHUwYzAxLVxcdTBjMDNcXHUwYzNlLVxcdTBjNDRcXHUwYzQ2LVxcdTBjNDhcXHUwYzRhLVxcdTBjNGRcXHUwYzU1XFx1MGM1NlxcdTBjNjJcXHUwYzYzXFx1MGM2Ni1cXHUwYzZmXFx1MGM4MlxcdTBjODNcXHUwY2JjXFx1MGNiZS1cXHUwY2M0XFx1MGNjNi1cXHUwY2M4XFx1MGNjYS1cXHUwY2NkXFx1MGNkNVxcdTBjZDZcXHUwY2UyXFx1MGNlM1xcdTBjZTYtXFx1MGNlZlxcdTBkMDJcXHUwZDAzXFx1MGQzZS1cXHUwZDQ0XFx1MGQ0Ni1cXHUwZDQ4XFx1MGQ0YS1cXHUwZDRkXFx1MGQ1N1xcdTBkNjJcXHUwZDYzXFx1MGQ2Ni1cXHUwZDZmXFx1MGQ4MlxcdTBkODNcXHUwZGNhXFx1MGRjZi1cXHUwZGQ0XFx1MGRkNlxcdTBkZDgtXFx1MGRkZlxcdTBkZjJcXHUwZGYzXFx1MGUzMVxcdTBlMzQtXFx1MGUzYVxcdTBlNDctXFx1MGU0ZVxcdTBlNTAtXFx1MGU1OVxcdTBlYjFcXHUwZWI0LVxcdTBlYjlcXHUwZWJiXFx1MGViY1xcdTBlYzgtXFx1MGVjZFxcdTBlZDAtXFx1MGVkOVxcdTBmMThcXHUwZjE5XFx1MGYyMC1cXHUwZjI5XFx1MGYzNVxcdTBmMzdcXHUwZjM5XFx1MGYzZVxcdTBmM2ZcXHUwZjcxLVxcdTBmODRcXHUwZjg2XFx1MGY4N1xcdTBmOGQtXFx1MGY5N1xcdTBmOTktXFx1MGZiY1xcdTBmYzZcXHUxMDJiLVxcdTEwM2VcXHUxMDQwLVxcdTEwNDlcXHUxMDU2LVxcdTEwNTlcXHUxMDVlLVxcdTEwNjBcXHUxMDYyLVxcdTEwNjRcXHUxMDY3LVxcdTEwNmRcXHUxMDcxLVxcdTEwNzRcXHUxMDgyLVxcdTEwOGRcXHUxMDhmLVxcdTEwOWRcXHUxMzVkLVxcdTEzNWZcXHUxNzEyLVxcdTE3MTRcXHUxNzMyLVxcdTE3MzRcXHUxNzUyXFx1MTc1M1xcdTE3NzJcXHUxNzczXFx1MTdiNC1cXHUxN2QzXFx1MTdkZFxcdTE3ZTAtXFx1MTdlOVxcdTE4MGItXFx1MTgwZFxcdTE4MTAtXFx1MTgxOVxcdTE4YTlcXHUxOTIwLVxcdTE5MmJcXHUxOTMwLVxcdTE5M2JcXHUxOTQ2LVxcdTE5NGZcXHUxOWIwLVxcdTE5YzBcXHUxOWM4XFx1MTljOVxcdTE5ZDAtXFx1MTlkOVxcdTFhMTctXFx1MWExYlxcdTFhNTUtXFx1MWE1ZVxcdTFhNjAtXFx1MWE3Y1xcdTFhN2YtXFx1MWE4OVxcdTFhOTAtXFx1MWE5OVxcdTFiMDAtXFx1MWIwNFxcdTFiMzQtXFx1MWI0NFxcdTFiNTAtXFx1MWI1OVxcdTFiNmItXFx1MWI3M1xcdTFiODAtXFx1MWI4MlxcdTFiYTEtXFx1MWJhZFxcdTFiYjAtXFx1MWJiOVxcdTFiZTYtXFx1MWJmM1xcdTFjMjQtXFx1MWMzN1xcdTFjNDAtXFx1MWM0OVxcdTFjNTAtXFx1MWM1OVxcdTFjZDAtXFx1MWNkMlxcdTFjZDQtXFx1MWNlOFxcdTFjZWRcXHUxY2YyLVxcdTFjZjRcXHUxZGMwLVxcdTFkZTZcXHUxZGZjLVxcdTFkZmZcXHUyMDBjXFx1MjAwZFxcdTIwM2ZcXHUyMDQwXFx1MjA1NFxcdTIwZDAtXFx1MjBkY1xcdTIwZTFcXHUyMGU1LVxcdTIwZjBcXHUyY2VmLVxcdTJjZjFcXHUyZDdmXFx1MmRlMC1cXHUyZGZmXFx1MzAyYS1cXHUzMDJmXFx1MzA5OVxcdTMwOWFcXHVhNjIwLVxcdWE2MjlcXHVhNjZmXFx1YTY3NC1cXHVhNjdkXFx1YTY5ZlxcdWE2ZjBcXHVhNmYxXFx1YTgwMlxcdWE4MDZcXHVhODBiXFx1YTgyMy1cXHVhODI3XFx1YTg4MFxcdWE4ODFcXHVhOGI0LVxcdWE4YzRcXHVhOGQwLVxcdWE4ZDlcXHVhOGUwLVxcdWE4ZjFcXHVhOTAwLVxcdWE5MDlcXHVhOTI2LVxcdWE5MmRcXHVhOTQ3LVxcdWE5NTNcXHVhOTgwLVxcdWE5ODNcXHVhOWIzLVxcdWE5YzBcXHVhOWQwLVxcdWE5ZDlcXHVhYTI5LVxcdWFhMzZcXHVhYTQzXFx1YWE0Y1xcdWFhNGRcXHVhYTUwLVxcdWFhNTlcXHVhYTdiXFx1YWFiMFxcdWFhYjItXFx1YWFiNFxcdWFhYjdcXHVhYWI4XFx1YWFiZVxcdWFhYmZcXHVhYWMxXFx1YWFlYi1cXHVhYWVmXFx1YWFmNVxcdWFhZjZcXHVhYmUzLVxcdWFiZWFcXHVhYmVjXFx1YWJlZFxcdWFiZjAtXFx1YWJmOVxcdWZiMWVcXHVmZTAwLVxcdWZlMGZcXHVmZTIwLVxcdWZlMjZcXHVmZTMzXFx1ZmUzNFxcdWZlNGQtXFx1ZmU0ZlxcdWZmMTAtXFx1ZmYxOVxcdWZmM2ZdKi9naSk7XG4gIH0sXG4gIGV2YWxJbkNvbnRleHQ6IGZ1bmN0aW9uIChqcykge1xuICAgIGpzID0ganMucmVwbGFjZSgvXFxzKy9nLCAnJyk7XG5cblxuICAgIHZhciBrZXlzID0gW10sIHZhbHVlcyA9IFtdO1xuXG4gICAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGtleXMgPSBrZXlzLmNvbmNhdChPYmplY3Qua2V5cyhhcmd1bWVudHNbaV0pKTtcbiAgICAgIGZvciAodmFyIGogaW4gYXJndW1lbnRzW2ldKSB7XG4gICAgICAgIHZhbHVlcy5wdXNoKGFyZ3VtZW50c1tpXVtqXSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy9cbiAgICAvL2lmKF8uaXNDb3JyZWN0VmFyaWFibGVOYW1lKGpzKSAmJiBrZXlzLmluZGV4T2YoanMpID09PSAtMSl7XG4gICAgLy8gIGtleXMucHVzaChqcyk7XG4gICAgLy8gIHZhbHVlcy5wdXNoKHVuZGVmaW5lZCk7XG4gICAgLy99XG5cbiAgICB2YXIgYXJyID0gdXRpbHMuZXh0cmFjdFZhcmlhYmxlcyhqcyk7XG4gICAgLy9jb25zb2xlLmxvZyhhcnIpO1xuICAgIGZvciAodmFyIGkgaW4gYXJyKSB7XG4gICAgICBpZiAoa2V5cy5pbmRleE9mKGFycltpXSkgPT09IC0xKSB7XG4gICAgICAgIGtleXMucHVzaChhcnJbaV0pO1xuICAgICAgICB2YWx1ZXMucHVzaCh1bmRlZmluZWQpO1xuICAgICAgfVxuICAgIH1cbiAgICBqcyA9IFwidmFyIGZvbyA9IGZ1bmN0aW9uKFwiICsga2V5cy5qb2luKFwiLFwiKSArIFwiKXsgdmFyIF9fcmV0dXJuX192YWx1ZSA9IFwiICsganMgKyBcIiA7cmV0dXJuIF9fcmV0dXJuX192YWx1ZTt9OyBmb287XCI7XG4gICAgdHJ5IHtcbiAgICAgIHZhciBmb28gPSBldmFsKGpzKTtcbiAgICAgIHJldHVybiBmb28uYXBwbHkodGhpcywgdmFsdWVzKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cblxuICB9LFxuICBjb21waWxlRWxlbWVudDogZnVuY3Rpb24gKCRpdGVtLCBzY29wZSkge1xuXG4gICAgZnVuY3Rpb24gX2VhY2hTZWxmKGVsLCBzZWxlY3RvciwgZm9vKSB7XG4gICAgICBlbC5maW5kKHNlbGVjdG9yKS5lYWNoKGZvbyk7XG4gICAgICBpZiAoZWwuaXMoc2VsZWN0b3IpKSB7XG4gICAgICAgIGZvby5jYWxsKGVsWzBdKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLy5hZGRCYWNrKCdzZWxlY3RvcicpXG4gICAgX2VhY2hTZWxmKCRpdGVtLCBcIltvbmNsaWNrXVwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgb25DbGljayA9ICQodGhpcykuYXR0cihcIm9uY2xpY2tcIik7XG4gICAgICAkKHRoaXMpLnJlbW92ZUF0dHIoXCJvbmNsaWNrXCIpO1xuICAgICAgJCh0aGlzKS5jbGljayhmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgdXRpbHMuZXZhbEluQ29udGV4dChvbkNsaWNrLCBzY29wZSwge2V2ZW50OiBldmVudH0pO1xuICAgICAgfSlcbiAgICB9KVxuXG5cbiAgICBfZWFjaFNlbGYoJGl0ZW0sIFwiW29uY2hhbmdlXVwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgb25DaGFuZ2UgPSAkKHRoaXMpLmF0dHIoXCJvbmNoYW5nZVwiKTtcbiAgICAgICQodGhpcykucmVtb3ZlQXR0cihcIm9uY2hhbmdlXCIpO1xuICAgICAgJCh0aGlzKS5jaGFuZ2UoZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIHV0aWxzLmV2YWxJbkNvbnRleHQob25DaGFuZ2UsIHNjb3BlLCB7ZXZlbnQ6IGV2ZW50fSk7XG4gICAgICB9KVxuICAgIH0pO1xuXG4gICAgX2VhY2hTZWxmKCRpdGVtLCBcIltkcC1jaGVja2VkXVwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgX3ZhbCA9ICQodGhpcykuYXR0cihcImRwLWNoZWNrZWRcIik7XG4gICAgICB2YXIgdmFsID0gdXRpbHMuZXZhbEluQ29udGV4dChfdmFsLCBzY29wZSk7XG4gICAgICBpZiAodmFsKSB7XG4gICAgICAgICQodGhpcykuYXR0cihcImNoZWNrZWRcIiwgXCJjaGVja2VkXCIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgJCh0aGlzKS5yZW1vdmVBdHRyKFwiY2hlY2tlZFwiKTtcbiAgICAgIH1cblxuICAgIH0pO1xuICAgIF9lYWNoU2VsZigkaXRlbSwgXCJbZHAtc3JjXVwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgX3ZhbCA9ICQodGhpcykuYXR0cihcImRwLXNyY1wiKTtcbiAgICAgIHZhciB2YWwgPSB1dGlscy5ldmFsSW5Db250ZXh0KF92YWwsIHNjb3BlKTtcbiAgICAgIGlmICh2YWwpIHtcbiAgICAgICAgJCh0aGlzKS5hdHRyKFwic3JjXCIsIHZhbCk7XG4gICAgICB9XG5cbiAgICB9KTtcbiAgICBfZWFjaFNlbGYoJGl0ZW0sIFwiW2RwLWlmXVwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgX3ZhbCA9ICQodGhpcykuYXR0cihcImRwLWlmXCIpO1xuICAgICAgaWYgKF92YWwgPT09IFwiZmFsc2VcIikge1xuICAgICAgICAkKHRoaXMpLnJlbW92ZSgpO1xuICAgICAgfVxuICAgICAgaWYgKF92YWwgPT09IFwidHJ1ZVwiKSB7XG5cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciB2YWwgPSB1dGlscy5ldmFsSW5Db250ZXh0KF92YWwsIHNjb3BlKTtcbiAgICAgICAgaWYgKCF2YWwpIHtcbiAgICAgICAgICAkKHRoaXMpLnJlbW92ZSgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gICAgX2VhY2hTZWxmKCRpdGVtLCBcIltkcC1pbmNsdWRlXVwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgX2VsID0gJCh0aGlzKTtcbiAgICAgIHZhciBfdmFsID0gX2VsLmF0dHIoXCJkcC1pbmNsdWRlXCIpO1xuICAgICAgdmFyIHZhbCA9IHV0aWxzLmV2YWxJbkNvbnRleHQoX3ZhbCwgc2NvcGUpO1xuICAgICAgX2VsLmxvYWQodmFsKTtcbiAgICB9KTtcbiAgfSxcbiAgcGFyc2VUZW1wbGF0ZTogZnVuY3Rpb24gKHRwbCwgc2NvcGUpIHtcbiAgICB2YXIgJGl0ZW0gPSAkKHRwbC5mb3JtYXQoc2NvcGUpKTtcbiAgICBfLmNvbXBpbGVFbGVtZW50KCRpdGVtLCBzY29wZSk7XG4gICAgcmV0dXJuICRpdGVtO1xuICB9XG59O1xuaWYodHlwZW9mIG1vZHVsZSAhPT0gXCJ1bmRlZmluZWRcIil7XG4gIG1vZHVsZS5leHBvcnRzID0gdXRpbHM7XG59XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL3V0aWwvY29tcGlsZS5qc1xuLy8gbW9kdWxlIGlkID0gNVxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCJtb2R1bGUuZXhwb3J0cyA9IHtcbiAgcmVzb2x2ZTogZnVuY3Rpb24gKHBhdGgpIHtcbiAgICB2YXIgY2h1bmtzID0gcGF0aC5zcGxpdChcIi9cIik7XG4gICAgdmFyIHByZXYgPSAwO1xuICAgIGZvciAodmFyIGkgPSBjaHVua3MubGVuZ3RoOyBpLS0gPiAwOykge1xuICAgICAgaWYgKGNodW5rc1tpXSA9PSBcIi4uXCIpIHtcbiAgICAgICAgcHJldisrO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgd2hpbGUgKHByZXYgPiAwKSB7XG4gICAgICAgICAgY2h1bmtzLnNwbGljZShpLCAxKTtcbiAgICAgICAgICBjaHVua3Muc3BsaWNlKGktLSwgMSk7XG4gICAgICAgICAgcHJldi0tO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBjaHVua3Muam9pbihcIi9cIik7XG4gIH0sXG4gIGdldFBhcmVudERpcmVjdG9yeVVybDogZnVuY3Rpb24gKHVybCkge1xuICAgIHJldHVybiB1cmwuc3Vic3RyKDAsIHVybC5sYXN0SW5kZXhPZihcIi9cIikgKyAxKTtcbiAgfVxufVxuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi91dGlsL3BhdGguanNcbi8vIG1vZHVsZSBpZCA9IDZcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiZmFicmljLkltYWdlTWl4aW4gPSB7XG4gIHNldEVsZW1lbnRGcm9tTWVudSA6IGZ1bmN0aW9uKGRhdGEpe1xuICAgIHRoaXMuc2V0RWxlbWVudChkYXRhLmltYWdlKVxuICB9LFxuICBpbml0UHJvcG9ydGluYWxTaXplIDogdHJ1ZSxcbiAgLyoqXG4gICAqIEBwcml2YXRlXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc10gT2JqZWN0IHdpdGggd2lkdGgvaGVpZ2h0IHByb3BlcnRpZXNcbiAgICovXG4gIF9zZXRXaWR0aEhlaWdodDogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgIHZhciBfc2l6ZSA9IHRoaXMuZ2V0T3JpZ2luYWxTaXplKCk7XG4gICAgaWYoJ3dpZHRoJyBpbiBvcHRpb25zKXtcbiAgICAgIHRoaXMud2lkdGggPSBvcHRpb25zLndpZHRoO1xuICAgIH1lbHNle1xuICAgICAgaWYoIV9zaXplLndpZHRoKXtcbiAgICAgICAgdGhpcy53aWR0aCA9IDA7XG4gICAgICB9ZWxzZXtcbiAgICAgICAgaWYodGhpcy5pbml0UHJvcG9ydGluYWxTaXplICYmICdoZWlnaHQnIGluIG9wdGlvbnMpe1xuICAgICAgICAgIHRoaXMud2lkdGggPSAob3B0aW9ucy5oZWlnaHQgIC8gX3NpemUuaGVpZ2h0ICkgKiBfc2l6ZS53aWR0aDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLndpZHRoID0gX3NpemUud2lkdGg7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZignaGVpZ2h0JyBpbiBvcHRpb25zKXtcbiAgICAgIHRoaXMuaGVpZ2h0ID0gb3B0aW9ucy5oZWlnaHQ7XG4gICAgfWVsc2V7XG4gICAgICBpZighX3NpemUuaGVpZ2h0KXtcbiAgICAgICAgdGhpcy5oZWlnaHQgPSAwO1xuICAgICAgfWVsc2V7XG4gICAgICAgIGlmKHRoaXMuaW5pdFByb3BvcnRpbmFsU2l6ZSAmJiAnd2lkdGgnIGluIG9wdGlvbnMpe1xuICAgICAgICAgIHRoaXMuaGVpZ2h0ID0gKG9wdGlvbnMud2lkdGggIC8gX3NpemUud2lkdGggKSAqIF9zaXplLmhlaWdodDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLmhlaWdodCA9IF9zaXplLmhlaWdodDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxufTtcblxuZmFicmljLkFwcGxpY2F0aW9uLnByb3RvdHlwZS5nZXRMaWJyYXJ5RWxlbWVudHMgPSBmdW5jdGlvbihvcHRpb25zKXtcbiAgcmV0dXJuIFtdO1xufVxuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9taXhpbnMvcHJvcG9ydGlhbmFsU2l6ZU1peGluLmpzXG4vLyBtb2R1bGUgaWQgPSA3XG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIi8vIE1hZ2ljIFdhbmQgKEZ1enp5IFNlbGVjdGlvbiBUb29sKSBmb3IgSmF2YXNjcmlwdFxuLy9cbi8vIFRoZSBNSVQgTGljZW5zZSAoTUlUKVxuLy9cbi8vIENvcHlyaWdodCAoYykgMjAxNCwgUnlhc25veSBQYXVsIChyeWFzbm95cGF1bEBnbWFpbC5jb20pXG4vL1xuLy8gUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nIGEgY29weVxuLy8gb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgXCJTb2Z0d2FyZVwiKSwgdG8gZGVhbFxuLy8gaW4gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0c1xuLy8gdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbFxuLy8gY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzXG4vLyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOlxuLy9cbi8vIFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluXG4vLyBhbGwgY29waWVzIG9yIHN1YnN0YW50aWFsIHBvcnRpb25zIG9mIHRoZSBTb2Z0d2FyZS5cbi8vXG4vLyBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SXG4vLyBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSxcbi8vIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRVxuLy8gQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUlxuLy8gTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSxcbi8vIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU5cbi8vIFRIRSBTT0ZUV0FSRS5cblxudmFyIE1hZ2ljV2FuZCA9IChmdW5jdGlvbiAoKSB7XG4gIHZhciBsaWIgPSB7fTtcbiAgLy92YXIgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKTtcbiAgLy92YXIgY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7XG5cbiAgZnVuY3Rpb24gY3JlYXRlQ2FudmFzRWxlbWVudCgpe1xuICAgIGlmKHR5cGVvZiBDYW52YXMgIT09IFwidW5kZWZpbmVkXCIpe1xuICAgICAgcmV0dXJuIG5ldyBDYW52YXM7XG4gICAgfVxuICAgIHJldHVybiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpO1xuICB9XG5cbiAgZnVuY3Rpb24gU2VsZWN0aW9uTWFzayh3LGgsZGF0YSl7XG4gICAgaWYoYXJndW1lbnRzLmxlbmd0aCA9PSAxKXtcbiAgICAgIGZvcih2YXIgaSBpbiBhcmd1bWVudHNbMF0gKXtcbiAgICAgICAgdGhpc1tpXSA9IGFyZ3VtZW50c1swXVtpXTtcbiAgICAgIH1cbiAgICB9ZWxzZXtcbiAgICAgIHRoaXMuZGF0YSA9IG5ldyBVaW50OEFycmF5KGRhdGEgfHwgdyAqIGgpO1xuICAgICAgdGhpcy53aWR0aCAgPSB3O1xuICAgICAgdGhpcy5oZWlnaHQgPSBoO1xuICAgICAgdGhpcy5jb3VudCAgPSAwO1xuICAgICAgdGhpcy5ib3VuZHMgPSB7XG4gICAgICAgbWluWDogSW5maW5pdHksXG4gICAgICAgbWluWTogSW5maW5pdHksXG4gICAgICAgbWF4WTogLTEsXG4gICAgICAgbWF4WDogLTFcbiAgICAgIH07XG4gICAgICAvLyB0aGlzLmJvdW5kcyA9IHtcbiAgICAgIC8vICAgbWluWDogMCxcbiAgICAgIC8vICAgbWluWTogMCxcbiAgICAgIC8vICAgbWF4WTogaCxcbiAgICAgIC8vICAgbWF4WDogd1xuICAgICAgLy8gfTtcbiAgICB9XG4gIH1cbiAgbGliLlNlbGVjdGlvbk1hc2sgPSBTZWxlY3Rpb25NYXNrO1xuXG5cbiAgU2VsZWN0aW9uTWFzay5wcm90b3R5cGUuZGVidWcgPSBmdW5jdGlvbigpe1xuICAgIHZhciBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpO1xuICAgIGNhbnZhcy53aWR0aCA9IHRoaXMud2lkdGg7XG4gICAgY2FudmFzLmhlaWdodCA9IHRoaXMuaGVpZ2h0O1xuICAgIHZhciBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICB0aGlzLnJlbmRlcihjdHgse1xuICAgICAgZmlsbCA6IFwiI2ZmZlwiLFxuICAgICAgb3V0ZXJGaWxsIDogXCIjMDAwXCJcbiAgICB9KTtcbiAgICBjdHguZGVidWcoKTtcbiAgfTtcblxuICBTZWxlY3Rpb25NYXNrLnByb3RvdHlwZS5tYWtlQ2FjaGUgPSBmdW5jdGlvbihvcHRpb25zICl7XG4gICAgdGhpcy5jYWNoZSA9IGNyZWF0ZUNhbnZhc0VsZW1lbnQoKTtcbiAgICB0aGlzLmNhY2hlLndpZHRoID0gdGhpcy5ib3VuZHMubWF4WC0gdGhpcy5ib3VuZHMubWluWCArIDE7XG4gICAgdGhpcy5jYWNoZS5oZWlnaHQgPSB0aGlzLmJvdW5kcy5tYXhZLSB0aGlzLmJvdW5kcy5taW5ZICsgMTtcbiAgICB0aGlzLmNvbnRleHQgPSB0aGlzLmNhY2hlLmdldENvbnRleHQoJzJkJyk7XG5cbiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fVxuICAgIHRoaXMucmVuZGVyKHRoaXMuY29udGV4dCx7XG4gICAgICBmaWxsIDogXCIjZmZmXCIsXG4gICAgICBvdXRlckZpbGwgOiBcIiMwMDBcIixcbiAgICAgIGNhY2hlOiBmYWxzZSxcbiAgICAgIGxlZnQgOi10aGlzLmJvdW5kcy5taW5YLFxuICAgICAgdG9wIDotdGhpcy5ib3VuZHMubWluWVxuICAgIH0pO1xuXG4gIH07XG5cbiAgU2VsZWN0aW9uTWFzay5wcm90b3R5cGUuYWRkID0gZnVuY3Rpb24gKG1hc2spIHtcbiAgICB2YXIgaW5kZXgsIHgsIHk7XG4gICAgZm9yICh4ID0gbWFzay5ib3VuZHMubWluWDsgeCA8PSBtYXNrLmJvdW5kcy5tYXhYOyB4KyspIHtcbiAgICAgIGZvciAoeSA9IG1hc2suYm91bmRzLm1pblk7IHkgPD0gbWFzay5ib3VuZHMubWF4WTsgeSsrKSB7XG4gICAgICAgIGluZGV4ID0gbWFzay53aWR0aCAqIHkgKyB4O1xuICAgICAgICBpZiAoIG1hc2suZGF0YVtpbmRleF0gJiYgIXRoaXMuZGF0YVtpbmRleF0pe1xuICAgICAgICAgIHRoaXMuZGF0YVtpbmRleF0gPSAxO1xuICAgICAgICAgIHRoaXMuY291bnQrKztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMuYm91bmRzLm1pblggPSBNYXRoLm1pbihtYXNrLmJvdW5kcy5taW5YLCB0aGlzLmJvdW5kcy5taW5YKTtcbiAgICB0aGlzLmJvdW5kcy5tYXhYID0gTWF0aC5tYXgobWFzay5ib3VuZHMubWF4WCwgdGhpcy5ib3VuZHMubWF4WCk7XG4gICAgdGhpcy5ib3VuZHMubWluWSA9IE1hdGgubWluKG1hc2suYm91bmRzLm1pblksIHRoaXMuYm91bmRzLm1pblkpO1xuICAgIHRoaXMuYm91bmRzLm1heFkgPSBNYXRoLm1heChtYXNrLmJvdW5kcy5tYXhZLCB0aGlzLmJvdW5kcy5tYXhZKTtcbiAgfTtcbiAgZnVuY3Rpb24gaGV4VG9SZ2IoaGV4KSB7XG4gICAgLy8gRXhwYW5kIHNob3J0aGFuZCBmb3JtIChlLmcuIFwiMDNGXCIpIHRvIGZ1bGwgZm9ybSAoZS5nLiBcIjAwMzNGRlwiKVxuICAgIHZhciBzaG9ydGhhbmRSZWdleCA9IC9eIz8oW2EtZlxcZF0pKFthLWZcXGRdKShbYS1mXFxkXSkkL2k7XG4gICAgaGV4ID0gaGV4LnJlcGxhY2Uoc2hvcnRoYW5kUmVnZXgsIGZ1bmN0aW9uKG0sIHIsIGcsIGIpIHtcbiAgICAgIHJldHVybiByICsgciArIGcgKyBnICsgYiArIGI7XG4gICAgfSk7XG5cbiAgICB2YXIgcmVzdWx0ID0gL14jPyhbYS1mXFxkXXsyfSkoW2EtZlxcZF17Mn0pKFthLWZcXGRdezJ9KSQvaS5leGVjKGhleCk7XG4gICAgcmV0dXJuIHJlc3VsdCA/IHtcbiAgICAgIHI6IHBhcnNlSW50KHJlc3VsdFsxXSwgMTYpLFxuICAgICAgZzogcGFyc2VJbnQocmVzdWx0WzJdLCAxNiksXG4gICAgICBiOiBwYXJzZUludChyZXN1bHRbM10sIDE2KVxuICAgIH0gOiBudWxsO1xuICB9XG5cbiAgU2VsZWN0aW9uTWFzay5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24oY3R4LG9wdGlvbnMgKXtcbiAgICBpZighdGhpcy5jb3VudClyZXR1cm47XG5cbiAgICBvcHRpb25zICAgICAgICAgICAgID0gb3B0aW9ucyAgICAgICAgICAgICB8fCB7fTtcbiAgICBvcHRpb25zLmxlZnQgICAgICAgID0gb3B0aW9ucy5sZWZ0ICAgICAgICB8fCAwIDtcbiAgICBvcHRpb25zLnRvcCAgICAgICAgID0gb3B0aW9ucy50b3AgICAgICAgICB8fCAwIDtcbiAgICBvcHRpb25zLmZpbGwgICAgICAgID0gb3B0aW9ucy5maWxsICAgICAgICB8fCBmYWxzZSA7Ly8gWzAsMCwwLDBdO1xuICAgIG9wdGlvbnMuaW50ZXJzZWN0aW9uQ29sb3IgPSBvcHRpb25zLmludGVyc2VjdGlvbkNvbG9yIHx8ZmFsc2UgOy8vICBbMCwwLDAsMF07XG5cbiAgICBvcHRpb25zLm91dGVyRmlsbCAgICAgICAgPSBvcHRpb25zLm91dGVyRmlsbCAgICAgICAgfHwgZmFsc2UgOy8vIFswLDAsMCwwXTtcbiAgICBvcHRpb25zLm91dGVySW50ZXJzZWN0aW9uQ29sb3IgPSBvcHRpb25zLm91dGVySW50ZXJzZWN0aW9uQ29sb3IgfHxmYWxzZSA7Ly8gIFswLDAsMCwwXTtcblxuICAgIC8vaWYodGhpcy5jYWNoZSAmJiBvcHRpb25zLmNhY2hlICE9PSBmYWxzZSl7XG4gICAgLy9cbiAgICAvLyAgdmFyIF9jdHggPSB0aGlzLmNvbnRleHQ7XG4gICAgLy8gIF9jdHguc2F2ZSgpO1xuICAgIC8vICBfY3R4Lmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbj1cInNvdXJjZS1pblwiO1xuICAgIC8vICBfY3R4LmZpbGxTdHlsZT0gb3B0aW9ucy5maWxsO1xuICAgIC8vICBfY3R4LmZpbGxSZWN0KDAsMCx0aGlzLmNhY2hlLndpZHRoLHRoaXMuY2FjaGUuaGVpZ2h0KTtcbiAgICAvLyAgX2N0eC5yZXN0b3JlKCk7XG4gICAgLy9cbiAgICAvLyAgY3R4LnNhdmUoKTtcbiAgICAvLyAgY3R4Lmdsb2JhbEFscGhhID0gb3B0aW9ucy5vcGFjaXR5O1xuICAgIC8vICBjdHguZHJhd0ltYWdlKHRoaXMuY2FjaGUsdGhpcy5ib3VuZHMubWluWCx0aGlzLmJvdW5kcy5taW5ZKVxuICAgIC8vICBjdHgucmVzdG9yZSgpO1xuICAgIC8vICByZXR1cm47XG4gICAgLy99XG5cbiAgICAvL3RvZG8gZG8gbm90IHVzZSBmYWJyaWMgaGVyZSFcbiAgICBmdW5jdGlvbiBjb252ZXJ0Q29sb3IoY29sb3Ipe1xuICAgICAgaWYoY29sb3IuY29uc3RydWN0b3IgID09IFN0cmluZyApe1xuICAgICAgICBpZihjb2xvclswXSA9PSBcIiNcIil7XG4gICAgICAgICAgdmFyIF9yZ2IgPSBoZXhUb1JnYihjb2xvcik7XG4gICAgICAgICAgcmV0dXJuIFtfcmdiLnIsX3JnYi5nLF9yZ2IuYiwyNTVdO1xuICAgICAgICB9XG4gICAgICAgIGNvbG9yID0gbmV3IGZhYnJpYy5Db2xvcihjb2xvcikuX3NvdXJjZTtcbiAgICAgICAgY29sb3JbM10gKj0gMjU1O1xuICAgICAgfVxuICAgICAgcmV0dXJuIGNvbG9yO1xuICAgIH1cblxuICAgIHZhciBfdyA9IHRoaXMuYm91bmRzLm1heFggLSB0aGlzLmJvdW5kcy5taW5YICsgMTtcbiAgICB2YXIgX2ggPSB0aGlzLmJvdW5kcy5tYXhZIC0gdGhpcy5ib3VuZHMubWluWSArIDE7XG5cbiAgICAvL3ZhciBpbWdEYXRhID0gY3R4LmdldEltYWdlRGF0YShvcHRpb25zLmxlZnQsb3B0aW9ucy50b3AsX3csX2gpO1xuICAgIHZhciBpbWdEYXRhID0gY3R4LmdldEltYWdlRGF0YSh0aGlzLmJvdW5kcy5taW5YLHRoaXMuYm91bmRzLm1pblksX3csX2gpO1xuXG4gICAgdmFyIGNvbG9yICA9IGNvbnZlcnRDb2xvcihvcHRpb25zLmZpbGwpO1xuICAgIHZhciBjb2xvcjIgPSBjb252ZXJ0Q29sb3Iob3B0aW9ucy5pbnRlcnNlY3Rpb25Db2xvcik7XG4gICAgdmFyIGNvbG9yMyA9IGNvbnZlcnRDb2xvcihvcHRpb25zLm91dGVyRmlsbCk7XG4gICAgdmFyIGNvbG9yNCA9IGNvbnZlcnRDb2xvcihvcHRpb25zLm91dGVySW50ZXJzZWN0aW9uQ29sb3IpO1xuXG4gICAgZm9yKHZhciB4ID0gdGhpcy5ib3VuZHMubWluWCA7IHggPD0gdGhpcy5ib3VuZHMubWF4WDt4KysgKXtcbiAgICAgIGZvcih2YXIgeSA9IHRoaXMuYm91bmRzLm1pblkgOyB5IDw9IHRoaXMuYm91bmRzLm1heFk7IHkrKyApe1xuICAgICAgICB2YXIgaW5kZXggPSB0aGlzLndpZHRoICogeSArIHg7XG4gICAgICAgIHZhciBpbmRleF9zbWFsbCA9IF93ICogKHkgLSAodGhpcy5ib3VuZHMubWluWSkpICsgeCAtICh0aGlzLmJvdW5kcy5taW5YKTtcblxuICAgICAgICBpZih0aGlzLmRhdGFbaW5kZXhdICl7XG4gICAgICAgICAgdmFyIF9jb2xvciA9IGltZ0RhdGEuZGF0YVtpbmRleF9zbWFsbCAqIDQgKyAzXT8gY29sb3IyIDogY29sb3IgO1xuICAgICAgICAgIGlmKCFfY29sb3IpY29udGludWU7XG5cbiAgICAgICAgICBpbWdEYXRhLmRhdGFbaW5kZXhfc21hbGwgKiA0IF0gICAgPSBfY29sb3JbMF07XG4gICAgICAgICAgaW1nRGF0YS5kYXRhW2luZGV4X3NtYWxsICogNCArIDFdID0gX2NvbG9yWzFdO1xuICAgICAgICAgIGltZ0RhdGEuZGF0YVtpbmRleF9zbWFsbCAqIDQgKyAyXSA9IF9jb2xvclsyXTtcbiAgICAgICAgICBpbWdEYXRhLmRhdGFbaW5kZXhfc21hbGwgKiA0ICsgM10gPSBfY29sb3JbM107XG4gICAgICAgIH1lbHNle1xuICAgICAgICAgIHZhciBfY29sb3IgPSBpbWdEYXRhLmRhdGFbaW5kZXhfc21hbGwgKiA0ICsgM10/IGNvbG9yNCA6IGNvbG9yMyA7XG4gICAgICAgICAgaWYoIV9jb2xvciljb250aW51ZTtcblxuICAgICAgICAgIGltZ0RhdGEuZGF0YVtpbmRleF9zbWFsbCAqIDQgXSAgICA9IF9jb2xvclswXTtcbiAgICAgICAgICBpbWdEYXRhLmRhdGFbaW5kZXhfc21hbGwgKiA0ICsgMV0gPSBfY29sb3JbMV07XG4gICAgICAgICAgaW1nRGF0YS5kYXRhW2luZGV4X3NtYWxsICogNCArIDJdID0gX2NvbG9yWzJdO1xuICAgICAgICAgIGltZ0RhdGEuZGF0YVtpbmRleF9zbWFsbCAqIDQgKyAzXSA9IF9jb2xvclszXTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIGN0eC5wdXRJbWFnZURhdGEoaW1nRGF0YSwgb3B0aW9ucy5sZWZ0ICAsIG9wdGlvbnMudG9wICApO1xuICAgIGN0eC5wdXRJbWFnZURhdGEoaW1nRGF0YSwgdGhpcy5ib3VuZHMubWluWCx0aGlzLmJvdW5kcy5taW5ZICApO1xuICB9O1xuXG5cbiAgLyoqXG4gICAqIGdldCBhcnJheSB3aXRoIGJlZ2luIGFuZCBlbmQgaW5kaWNlcyBvZiBmaWxsZWQgMSBpbnRlcnZhbHNcbiAgICogQHBhcmFtIGN0eFxuICAgKiBAcGFyYW0gb3B0aW9uc1xuICAgKiBAcmV0dXJucyB7QXJyYXl9XG4gICAqL1xuICBTZWxlY3Rpb25NYXNrLnByb3RvdHlwZS5nZXRJbnRlcnZhbHNBcnJheSA9IGZ1bmN0aW9uIChjdHgsIG9wdGlvbnMpIHtcbiAgICB2YXIgX25ld0RhdGEgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMCwgX3ZhbCA9IDA7IGkgPCBhcnJheS5sZW5ndGg7IGkrKykge1xuICAgICAgaWYgKF92YWwgIT0gYXJyYXlbaV0pIHtcbiAgICAgICAgX25ld0RhdGEucHVzaChpKTtcbiAgICAgICAgX3ZhbCA9IGFycmF5W2ldO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gX25ld0RhdGE7XG4gIH07XG5cbiAgU2VsZWN0aW9uTWFzay5wcm90b3R5cGUucmVuZGVyQm9yZGVyID0gZnVuY3Rpb24gKGN0eCwgb3B0aW9ucykge1xuXG4gICAgb3B0aW9ucyAgICAgICAgICAgICA9IG9wdGlvbnMgICAgICAgICAgICAgfHwge307XG4gICAgb3B0aW9ucy5sZWZ0ICAgICAgICA9IG9wdGlvbnMubGVmdCAgICAgICAgfHwgMCA7XG4gICAgb3B0aW9ucy50b3AgICAgICAgICA9IG9wdGlvbnMudG9wICAgICAgICAgfHwgMCA7XG4gICAgb3B0aW9ucy5oYXRjaE9mZnNldCA9IG9wdGlvbnMuaGF0Y2hPZmZzZXQgfHwgMCA7XG4gICAgb3B0aW9ucy5oYXRjaExlbmd0aCA9IG9wdGlvbnMuaGF0Y2hMZW5ndGggfHwgNCA7XG4gICAgb3B0aW9ucy5vcGFjaXR5ID0gb3B0aW9ucy5vcGFjaXR5IHx8IDEgO1xuXG4gICAgdmFyIGltZ0RhdGEgPSBjdHguZ2V0SW1hZ2VEYXRhKDAsMCx0aGlzLndpZHRoLHRoaXMuaGVpZ2h0KTtcblxuICAgIGlmKCF0aGlzLmNhY2hlSW5kKXtcbiAgICAgIHRoaXMuY2FjaGVJbmQgPSBNYWdpY1dhbmQuZ2V0Qm9yZGVySW5kaWNlcyh0aGlzKTtcbiAgICB9XG5cbiAgICB2YXIgeCwgeSwgaSwgaiwgayxcbiAgICAgIHcgPSBpbWdEYXRhLndpZHRoLFxuICAgICAgaCA9IGltZ0RhdGEuaGVpZ2h0O1xuICAgIHZhciByZXMgPSBpbWdEYXRhLmRhdGE7XG5cbiAgICB2YXIgbGVuID0gdGhpcy5jYWNoZUluZC5sZW5ndGg7XG4gICAgZm9yIChqID0gMDsgaiA8IGxlbjsgaisrKSB7XG4gICAgICBpID0gdGhpcy5jYWNoZUluZFtqXTtcbiAgICAgIHggPSBpICUgdzsgLy8gY2FsYyB4IGJ5IGluZGV4XG4gICAgICB5ID0gKGkgLSB4KSAvIHc7IC8vIGNhbGMgeSBieSBpbmRleFxuICAgICAgayA9ICh5ICogdyArIHgpICogNDtcblxuICAgICAgaWYgKCh4ICsgeSArIG9wdGlvbnMuaGF0Y2hPZmZzZXQpICUgKG9wdGlvbnMuaGF0Y2hMZW5ndGggKiAyKSA8IG9wdGlvbnMuaGF0Y2hMZW5ndGgpIHsgLy8gZGV0ZWN0IGhhdGNoIGNvbG9yXG5cbiAgICAgICAgcmVzW2tdID0gMDtcbiAgICAgICAgcmVzW2sgKyAxXSA9IDA7XG4gICAgICAgIHJlc1trICsgMl0gPSAwO1xuICAgICAgICByZXNbayArIDNdID0gMjU1OyAvLyBibGFjaywgY2hhbmdlIG9ubHkgYWxwaGFcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlc1trXSA9IDI1NTsgLy8gd2hpdGVcbiAgICAgICAgcmVzW2sgKyAxXSA9IDI1NTtcbiAgICAgICAgcmVzW2sgKyAyXSA9IDI1NTtcbiAgICAgICAgcmVzW2sgKyAzXSA9IDI1NTtcbiAgICAgIH1cbiAgICB9XG4gICAgY3R4LnNhdmUoKTtcbiAgICBjdHguZ2xvYmFsQWxwaGEgPSBvcHRpb25zLm9wYWNpdHk7XG4gICAgY3R4LnB1dEltYWdlRGF0YShpbWdEYXRhLCBvcHRpb25zLmxlZnQgfHwgMCAsIG9wdGlvbnMudG9wIHx8IDAgKTtcbiAgICBjdHgucmVzdG9yZSgpO1xuICB9O1xuXG5cbiAgbGliLmNyZWF0ZU1hc2sgPSBmdW5jdGlvbiAodywgaCxkYXRhKSB7XG4gICAgcmV0dXJuIG5ldyBTZWxlY3Rpb25NYXNrKHcsaCxkYXRhKTtcbiAgfTtcblxuICBsaWIuZGlmZmVyZW5jZSA9IGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgcmV0dXJuIE1hdGgubWF4KFxuICAgICAgYlswXSAhPT0gZmFsc2UgPyBNYXRoLmFicyhiWzBdIC0gYVswXSk6IDAsXG4gICAgICBiWzFdICE9PSBmYWxzZSA/IE1hdGguYWJzKGJbMV0gLSBhWzFdKTogMCxcbiAgICAgIGJbMl0gIT09IGZhbHNlID8gTWF0aC5hYnMoYlsyXSAtIGFbMl0pOiAwLFxuICAgICAgYlszXSAhPT0gZmFsc2UgPyBNYXRoLmFicyhiWzNdIC0gYVszXSk6IDApO1xuICB9O1xuXG4gIGxpYi5hY2NlcHRhYmxlID0gZnVuY3Rpb24gKHgsIHksIGltYWdlLCB2aXNpdGVkLCBzYW1wbGVDb2xvciwgY29sb3JUaHJlc2hvbGQpIHtcbi8vIGNoZWNrIHdoZXRoZXIgdGhlIHBvaW50IGhhcyBiZWVuIHZpc2l0ZWRcbiAgICBpZiAodmlzaXRlZFt5ICogaW1hZ2Uud2lkdGggKyB4XSA9PT0gMSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICB2YXIgaSA9ICh5ICogaW1hZ2Uud2lkdGggKyB4KSAqIGxpYi5ieXRlcyxcbiAgICAgIGNvbG9yMiA9IFtpbWFnZS5kYXRhW2ldLCBpbWFnZS5kYXRhW2kgKyAxXSwgaW1hZ2UuZGF0YVtpICsgMl0sIGltYWdlLmRhdGFbaSArIDNdXTtcblxuXG4gICAgaWYgKHNhbXBsZUNvbG9yWzBdICE9PSBmYWxzZSAmJiBNYXRoLmFicyhzYW1wbGVDb2xvclswXSAtIGNvbG9yMlswXSkgPiBjb2xvclRocmVzaG9sZClyZXR1cm4gZmFsc2U7XG4gICAgaWYgKHNhbXBsZUNvbG9yWzFdICE9PSBmYWxzZSAmJiBNYXRoLmFicyhzYW1wbGVDb2xvclsxXSAtIGNvbG9yMlsxXSkgPiBjb2xvclRocmVzaG9sZClyZXR1cm4gZmFsc2U7XG4gICAgaWYgKHNhbXBsZUNvbG9yWzJdICE9PSBmYWxzZSAmJiBNYXRoLmFicyhzYW1wbGVDb2xvclsyXSAtIGNvbG9yMlsyXSkgPmNvbG9yVGhyZXNob2xkKXJldHVybiBmYWxzZTtcbiAgICBpZiAoc2FtcGxlQ29sb3JbM10gIT09IGZhbHNlICYmIE1hdGguYWJzKHNhbXBsZUNvbG9yWzNdIC0gY29sb3IyWzNdKSA+IGNvbG9yVGhyZXNob2xkKXJldHVybiBmYWxzZTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfTtcblxuICBsaWIuc2VsZWN0QWxsID0gZnVuY3Rpb24gKGltYWdlLCBweCwgcHksIGNvbG9yVGhyZXNob2xkKSB7XG4gICAgdmFyIGkgPSAocHkgKiBpbWFnZS53aWR0aCArIHB4KSAqIGxpYi5ieXRlcyxcbiAgICAgIGRhdGEgPSBpbWFnZS5kYXRhLFxuICAgICAgc2FtcGxlQ29sb3IgPSBbZGF0YVtpXSwgZGF0YVtpICsgMV0sIGRhdGFbaSArIDJdLCBkYXRhW2kgKyAzXV07IC8vIHN0YXJ0IHBvaW50IGNvbG9yIChzYW1wbGUpXG4gICAgcmV0dXJuIGxpYi5zZWxlY3RBbGxCeUNvbG9yKGltYWdlLCBzYW1wbGVDb2xvciwgY29sb3JUaHJlc2hvbGQpXG4gIH07XG5cblxuICAvKipcbiAgICogQ29udmVydHMgYW4gUkdCIGNvbG9yIHZhbHVlIHRvIEhTTC4gQ29udmVyc2lvbiBmb3JtdWxhXG4gICAqIGFkYXB0ZWQgZnJvbSBodHRwOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0hTTF9jb2xvcl9zcGFjZS5cbiAgICogQXNzdW1lcyByLCBnLCBhbmQgYiBhcmUgY29udGFpbmVkIGluIHRoZSBzZXQgWzAsIDI1NV0gYW5kXG4gICAqIHJldHVybnMgaCwgcywgYW5kIGwgaW4gdGhlIHNldCBbMCwgMV0uXG4gICAqXG4gICAqIEBwYXJhbSAgIE51bWJlciAgciAgICAgICBUaGUgcmVkIGNvbG9yIHZhbHVlXG4gICAqIEBwYXJhbSAgIE51bWJlciAgZyAgICAgICBUaGUgZ3JlZW4gY29sb3IgdmFsdWVcbiAgICogQHBhcmFtICAgTnVtYmVyICBiICAgICAgIFRoZSBibHVlIGNvbG9yIHZhbHVlXG4gICAqIEByZXR1cm4gIEFycmF5ICAgICAgICAgICBUaGUgSFNMIHJlcHJlc2VudGF0aW9uXG4gICAqL1xuICBsaWIucmdiVG9Ic2wgPSBmdW5jdGlvbihyLCBnLCBiKXtcbiAgICByIC89IDI1NSwgZyAvPSAyNTUsIGIgLz0gMjU1O1xuICAgIHZhciBtYXggPSBNYXRoLm1heChyLCBnLCBiKSwgbWluID0gTWF0aC5taW4ociwgZywgYik7XG4gICAgdmFyIGgsIHMsIGwgPSAobWF4ICsgbWluKSAvIDI7XG5cbiAgICBpZihtYXggPT0gbWluKXtcbiAgICAgIGggPSBzID0gMDsgLy8gYWNocm9tYXRpY1xuICAgIH1lbHNle1xuICAgICAgdmFyIGQgPSBtYXggLSBtaW47XG4gICAgICBzID0gbCA+IDAuNSA/IGQgLyAoMiAtIG1heCAtIG1pbikgOiBkIC8gKG1heCArIG1pbik7XG4gICAgICBzd2l0Y2gobWF4KXtcbiAgICAgICAgY2FzZSByOiBoID0gKGcgLSBiKSAvIGQgKyAoZyA8IGIgPyA2IDogMCk7IGJyZWFrO1xuICAgICAgICBjYXNlIGc6IGggPSAoYiAtIHIpIC8gZCArIDI7IGJyZWFrO1xuICAgICAgICBjYXNlIGI6IGggPSAociAtIGcpIC8gZCArIDQ7IGJyZWFrO1xuICAgICAgfVxuICAgICAgaCAvPSA2O1xuICAgIH1cblxuICAgIHJldHVybiBbaCwgcywgbF07XG4gIH1cblxuICBsaWIuc2VsZWN0Q29sb3JlZCA9IGZ1bmN0aW9uIChpbWFnZSwgb3B0aW9ucykge1xuXG4gICAgdmFyIG1hc2sgPSBuZXcgU2VsZWN0aW9uTWFzayhpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0KTtcblxuICAgIG1hc2suYm91bmRzID0ge1xuICAgICAgbWluWDogaW1hZ2Uud2lkdGgsXG4gICAgICBtaW5ZOiBpbWFnZS5oZWlnaHQsXG4gICAgICBtYXhZOiAtMSxcbiAgICAgIG1heFg6IC0xXG4gICAgfTtcblxuICAgIHZhciB4LCB5O1xuICAgIGZvciAoeSA9IDA7IHkgPCBpbWFnZS5oZWlnaHQ7IHkrKykge1xuICAgICAgZm9yICh4ID0gMDsgeCA8IGltYWdlLndpZHRoOyB4KyspIHtcbiAgICAgICAgdmFyIGluZGV4ID0gKHkgKiBpbWFnZS53aWR0aCArIHgpO1xuICAgICAgICB2YXIgaSA9IGluZGV4ICogbGliLmJ5dGVzO1xuICAgICAgICAvL2lmICghaW1hZ2UuZGF0YVtpICsgM10pIGNvbnRpbnVlO1xuXG5cbiAgICAgICAgaWYgKG9wdGlvbnMuYU1pbiAmJiBpbWFnZS5kYXRhW2kgKyAzXSA8IG9wdGlvbnMuYU1pbiljb250aW51ZTtcblxuICAgICAgICB2YXIgaHNsID0gcmdiVG9Ic2woaW1hZ2UuZGF0YVtpXSwgaW1hZ2UuZGF0YVtpICsgMV0sIGltYWdlLmRhdGFbaSArIDJdKTtcblxuXG4gICAgICAgIGlmIChvcHRpb25zLnNNaW4gJiYgaHNsWzFdIDwgb3B0aW9ucy5zTWluKWNvbnRpbnVlO1xuICAgICAgICBpZiAob3B0aW9ucy5zTWF4ICYmIGhzbFsxXSA+IG9wdGlvbnMuc01heCljb250aW51ZTtcbiAgICAgICAgaWYgKG9wdGlvbnMuYk1pbiAmJiBoc2xbMl0gPCBvcHRpb25zLmJNaW4pY29udGludWU7XG4gICAgICAgIGlmIChvcHRpb25zLmJNYXggJiYgaHNsWzJdID4gb3B0aW9ucy5iTWF4KWNvbnRpbnVlO1xuXG5cbiAgICAgICAgbWFzay5kYXRhW2luZGV4XSA9IDE7XG4gICAgICAgIG1hc2suY291bnQrKztcbiAgICAgICAgbWFzay5ib3VuZHMubWluWCA9IE1hdGgubWluKG1hc2suYm91bmRzLm1pblgsIHgpO1xuICAgICAgICBtYXNrLmJvdW5kcy5tYXhYID0gTWF0aC5tYXgobWFzay5ib3VuZHMubWF4WCwgeCk7XG4gICAgICAgIG1hc2suYm91bmRzLm1pblkgPSBNYXRoLm1pbihtYXNrLmJvdW5kcy5taW5ZLCB5KTtcbiAgICAgICAgbWFzay5ib3VuZHMubWF4WSA9IE1hdGgubWF4KG1hc2suYm91bmRzLm1heFksIHkpO1xuXG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBtYXNrO1xuICB9O1xuXG5cblxuXG4gIGxpYi5zZWxlY3RBbGxCeUNvbG9yID0gZnVuY3Rpb24gKGN0eCwgc2FtcGxlQ29sb3IsIGNvbG9yVGhyZXNob2xkKSB7XG4gICAgdmFyIGltYWdlID0gX2dldEltYWdlRGF0YShjdHgpO1xuXG4gICAgdmFyIG1hc2sgPSBuZXcgU2VsZWN0aW9uTWFzayhpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0KTtcblxuICAgIG1hc2suYm91bmRzID0ge1xuICAgICAgbWluWDogSW5maW5pdHksXG4gICAgICBtaW5ZOiBJbmZpbml0eSxcbiAgICAgIG1heFk6IC0xLFxuICAgICAgbWF4WDogLTFcbiAgICB9O1xuXG5cbiAgICB2YXIgdmlzaXRlZCA9IG5ldyBVaW50OEFycmF5KCBpbWFnZS53aWR0aCAqIGltYWdlLmhlaWdodCk7XG4gICAgdmFyIHgsIHk7XG4gICAgZm9yICh5ID0gMDsgeSA8IGltYWdlLmhlaWdodDsgeSsrKSB7XG4gICAgICBmb3IgKHggPSAwOyB4IDwgaW1hZ2Uud2lkdGg7IHgrKykge1xuICAgICAgICBpZihsaWIuYWNjZXB0YWJsZSh4LCB5LCBpbWFnZSwgbWFzay5kYXRhLCBzYW1wbGVDb2xvciwgY29sb3JUaHJlc2hvbGQpKXtcbiAgICAgICAgICBNYWdpY1dhbmQuZmxvb2RGaWxsKGltYWdlLCB4LCB5LCBjb2xvclRocmVzaG9sZCwge1xuICAgICAgICAgICAgc2FtcGxlQ29sb3I6ICAgIHNhbXBsZUNvbG9yLFxuICAgICAgICAgICAgYWN0aXZlTWFzayA6ICAgIG1hc2ssXG4gICAgICAgICAgICB2aXNpdGVkUG9pbnRzIDogdmlzaXRlZFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBtYXNrO1xuICB9O1xuXG5cblxuICBsaWIuZHJhd0ltYWdlID0gZnVuY3Rpb24gKGN0eCxjYW52YXMsIG1hc2sgLGxlZnQsIHRvcCkge1xuXG4gICAgdmFyIGN0eDIgPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcblxuXG4gICAgdmFyIGltZ0RhdGEgPSBjdHguZ2V0SW1hZ2VEYXRhKDAsIDAsIG1hc2sud2lkdGgsIG1hc2suaGVpZ2h0KTtcbiAgICB2YXIgaW1nRGF0YU9yaWdpbmFsID0gY3R4Mi5nZXRJbWFnZURhdGEobGVmdCwgdG9wLCBtYXNrLndpZHRoLCBtYXNrLmhlaWdodCk7XG5cblxuICAgIHZhciBiID0gbWFzay5ib3VuZHM7XG4gICAgZm9yICh2YXIgeCA9IGIubWluWDsgeCA8PSBiLm1heFg7IHgrKylmb3IgKHZhciB5ID0gYi5taW5ZOyB5IDw9IGIubWF4WTsgeSsrKSB7XG4gICAgICB2YXIgaSA9ICh5ICogbWFzay53aWR0aCArIHgpOy8vICogYnl0ZXM7IC8vIHBvaW50IGluZGV4IGluIHRoZSBpbWFnZSBkYXRhXG4gICAgICBpZiAobWFzay5kYXRhW2ldKSB7XG4gICAgICAgIGltZ0RhdGEuZGF0YVtpICogNF0gICAgID0gaW1nRGF0YU9yaWdpbmFsLmRhdGFbaSAqIDRdO1xuICAgICAgICBpbWdEYXRhLmRhdGFbaSAqIDQgKyAxXSA9IGltZ0RhdGFPcmlnaW5hbC5kYXRhW2kgKiA0ICsgMV07XG4gICAgICAgIGltZ0RhdGEuZGF0YVtpICogNCArIDJdID0gaW1nRGF0YU9yaWdpbmFsLmRhdGFbaSAqIDQgKyAyXTtcbiAgICAgICAgaW1nRGF0YS5kYXRhW2kgKiA0ICsgM10gPSBpbWdEYXRhT3JpZ2luYWwuZGF0YVtpICogNCArIDNdO1xuICAgICAgfVxuICAgIH1cbiAgICBjdHgucHV0SW1hZ2VEYXRhKGltZ0RhdGEsMCwgMCk7XG4gIH07XG5cbiAgZnVuY3Rpb24gX2dldEltYWdlRGF0YShjdHgpe1xuICAgIGlmKGN0eC5jb25zdHJ1Y3Rvci5uYW1lID09IFwiSW1hZ2VEYXRhXCIpe1xuICAgICAgcmV0dXJuIGN0eDtcbiAgICB9ZWxzZXtcbiAgICAgIHJldHVybiBjdHguZ2V0SW1hZ2VEYXRhKDAsIDAsIGN0eC5jYW52YXMud2lkdGgsIGN0eC5jYW52YXMuaGVpZ2h0KTtcbiAgICB9XG4gIH1cblxuICBsaWIuZmlsbE1hc2sgPSBmdW5jdGlvbiAoY3R4LG1hc2ssIGNvbG9yKSB7XG4gICAgdmFyIGltZ0RhdGEgPSBfZ2V0SW1hZ2VEYXRhKGN0eCk7XG4gICAgdmFyIGIgPSBtYXNrLmJvdW5kcztcbiAgICB2YXIgdyA9IGltZ0RhdGEud2lkdGgsXG4gICAgICBoID0gaW1nRGF0YS5oZWlnaHQ7XG5cbiAgICBmb3IgKHZhciB4ID0gYi5taW5YOyB4IDw9IGIubWF4WDsgeCsrKWZvciAodmFyIHkgPSBiLm1pblk7IHkgPD0gYi5tYXhZOyB5KyspIHtcbiAgICAgIHZhciBpID0gKHkgKiB3ICsgeCk7Ly8gKiBieXRlczsgLy8gcG9pbnQgaW5kZXggaW4gdGhlIGltYWdlIGRhdGFcbiAgICAgIGlmIChtYXNrLmRhdGFbaV0pIHtcbiAgICAgICAgaW1nRGF0YS5kYXRhW2kgKiA0XSAgICAgPSBjb2xvclswXTtcbiAgICAgICAgaW1nRGF0YS5kYXRhW2kgKiA0ICsgMV0gPSBjb2xvclsxXTtcbiAgICAgICAgaW1nRGF0YS5kYXRhW2kgKiA0ICsgMl0gPSBjb2xvclsyXTtcbiAgICAgICAgaW1nRGF0YS5kYXRhW2kgKiA0ICsgM10gPSBjb2xvclszXTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYoY3R4LmNvbnN0cnVjdG9yLm5hbWUgIT0gXCJJbWFnZURhdGFcIikge1xuICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCB3LCBoKTtcbiAgICAgIGN0eC5wdXRJbWFnZURhdGEoaW1nRGF0YSwgMCwgMCk7XG4gICAgfVxuICB9O1xuXG4gIGxpYi5zZWxlY3RCYWNrZ3JvdW5kID0gZnVuY3Rpb24gKGN0eCwgc2FtcGxlQ29sb3IsIGNvbG9yVGhyZXNob2xkKSB7XG4gICAgdmFyIGltYWdlID0gX2dldEltYWdlRGF0YShjdHgpO1xuXG4gICAgY29sb3JUaHJlc2hvbGQgPSBjb2xvclRocmVzaG9sZCB8fCAxNTtcblxuICAgIHZhciBtYXNrID0gbmV3IFNlbGVjdGlvbk1hc2soaW1hZ2Uud2lkdGgsIGltYWdlLmhlaWdodCk7XG4gICAgbWFzay5ib3VuZHMgPSB7XG4gICAgICBtaW5YOiBJbmZpbml0eSxcbiAgICAgIG1pblk6IEluZmluaXR5LFxuICAgICAgbWF4WTogLTEsXG4gICAgICBtYXhYOiAtMVxuICAgIH07XG5cbiAgICB2YXIgZGF0YSA9IGltYWdlLmRhdGE7XG5cbiAgICBzYW1wbGVDb2xvciA9IHNhbXBsZUNvbG9yIHx8W2RhdGFbMF0sIGRhdGFbMV0sIGRhdGFbMl0sIGRhdGFbM11dOyAvLyBzdGFydCBwb2ludCBjb2xvciAoc2FtcGxlKVxuXG4gICAgdmFyIGNvbG9yID0gc2FtcGxlQ29sb3I7XG5cbiAgICBmdW5jdGlvbiBhZGQoeCwgeSkge1xuICAgICAgaWYgKCFsaWIuYWNjZXB0YWJsZSh4LCB5LCBpbWFnZSwgbWFzay5kYXRhLCBzYW1wbGVDb2xvciwgY29sb3JUaHJlc2hvbGQpKXJldHVybjtcbiAgICAgIGlmICghc2FtcGxlQ29sb3IpIHtcbiAgICAgICAgdmFyIGluZGV4ID0gKHkgKiBpbWFnZS53aWR0aCArIHgpICogNDtcbiAgICAgICAgY29sb3IgPSBbZGF0YVtpbmRleF0sIGRhdGFbaW5kZXggKyAxXSwgZGF0YVtpbmRleCArIDJdLCBkYXRhW2luZGV4ICsgM11dO1xuICAgICAgfVxuICAgICAgdmFyIG1hc2syID0gTWFnaWNXYW5kLmZsb29kRmlsbChpbWFnZSwgeCwgeSwgY29sb3JUaHJlc2hvbGQsIG51bGwsIGNvbG9yKTtcbiAgICAgIG1hc2sgPSBNYWdpY1dhbmQuYWRkKG1hc2ssIG1hc2syKTtcbiAgICB9XG5cbiAgICB2YXIgeCwgeTtcblxuICAgIGZvciAoeCA9IDA7IHggPCBpbWFnZS53aWR0aDsgeCsrKSB7XG4gICAgICBhZGQoeCwgMCk7XG4gICAgfVxuICAgIGZvciAoeCA9IDA7IHggPCBpbWFnZS53aWR0aDsgeCsrKSB7XG4gICAgICBhZGQoeCwgaW1hZ2UuaGVpZ2h0IC0gMSk7XG4gICAgfVxuICAgIGZvciAoeSA9IDA7IHkgPCBpbWFnZS5oZWlnaHQ7IHkrKykge1xuICAgICAgYWRkKGltYWdlLndpZHRoIC0gMSwgeSk7XG4gICAgfVxuICAgIGZvciAoeSA9IDA7IHkgPCBpbWFnZS5oZWlnaHQ7IHkrKykge1xuICAgICAgYWRkKDAsIHkpO1xuICAgIH1cbiAgICByZXR1cm4gbWFzaztcblxuICB9O1xuXG4gIGxpYi5leHRyYWN0Q29sb3JzID0gZnVuY3Rpb24obWl4ZWRUeXBlLHRocmVzaG9sZCkge1xuICAgIHRocmVzaG9sZD0gdGhyZXNob2xkIHx8IDYwO1xuICAgIHZhciBpbWdEYXRhID0gbGliLmdldEltYWdlRGF0YShtaXhlZFR5cGUpO1xuICAgIHZhciBfY29sb3JzID0gW107XG4gICAgdmFyIGMxO1xuICAgIGZvcih2YXIgeCA9IDE7IHggPGltZ0RhdGEud2lkdGg7eCs9Myl7XG4gICAgICBmb3IodmFyIHkgPSAxOyB5IDxpbWdEYXRhLmhlaWdodDt5Kz0zKSB7XG4gICAgICAgIHZhciBpaWkgPSAoeCArIHkgKiBpbWdEYXRhLndpZHRoKSAqIDQ7XG4gICAgICAgIHZhciBpaUEgPSAoeCAtIDEgKyB5ICogaW1nRGF0YS53aWR0aCkgKiA0O1xuICAgICAgICB2YXIgaWlCID0gKHggKyAxICsgeSAqIGltZ0RhdGEud2lkdGgpICogNDtcbiAgICAgICAgdmFyIGlpQyA9ICh4IC0gMSArICh5ICsgMSkgKiBpbWdEYXRhLndpZHRoKSAqIDQ7XG4gICAgICAgIHZhciBpaUQgPSAoeCArIDEgKyAoeSArIDEpICogaW1nRGF0YS53aWR0aCkgKiA0O1xuICAgICAgICBpZihpbWdEYXRhLmRhdGFbaWlpICsgM10gPCAyNTUpY29udGludWU7XG5cbiAgICAgICAgYzEgPSBbIGltZ0RhdGEuZGF0YVtpaWldLCBpbWdEYXRhLmRhdGFbaWlpICsgMV0sIGltZ0RhdGEuZGF0YVtpaWkgKyAyXV07XG4gICAgICAgIHZhciBjQSA9IFsgaW1nRGF0YS5kYXRhW2lpQV0sIGltZ0RhdGEuZGF0YVtpaUEgKyAxXSwgaW1nRGF0YS5kYXRhW2lpQSArIDJdXTtcbiAgICAgICAgdmFyIGNCID0gWyBpbWdEYXRhLmRhdGFbaWlCXSwgaW1nRGF0YS5kYXRhW2lpQiArIDFdLCBpbWdEYXRhLmRhdGFbaWlCICsgMl1dO1xuICAgICAgICB2YXIgY0MgPSBbIGltZ0RhdGEuZGF0YVtpaUNdLCBpbWdEYXRhLmRhdGFbaWlDICsgMV0sIGltZ0RhdGEuZGF0YVtpaUMgKyAyXV07XG4gICAgICAgIHZhciBjRCA9IFsgaW1nRGF0YS5kYXRhW2lpRF0sIGltZ0RhdGEuZGF0YVtpaUQgKyAxXSwgaW1nRGF0YS5kYXRhW2lpRCArIDJdXTtcblxuICAgICAgICBpZihcbiAgICAgICAgICBjMVswXSAhPSBjQVswXSB8fCBjQVswXSAhPSBjQlswXSB8fCBjQlswXSAhPSBjQ1swXSB8fCBjQ1swXSAhPSBjRFswXSB8fFxuICAgICAgICAgIGMxWzFdICE9IGNBWzFdIHx8IGNBWzFdICE9IGNCWzFdIHx8IGNCWzFdICE9IGNDWzFdIHx8IGNDWzFdICE9IGNEWzFdIHx8XG4gICAgICAgICAgYzFbMl0gIT0gY0FbMl0gfHwgY0FbMl0gIT0gY0JbMl0gfHwgY0JbMl0gIT0gY0NbMl0gfHwgY0NbMl0gIT0gY0RbMl1cbiAgICAgICAgKXtcbiAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBpc05ld0NvbG9yID0gdHJ1ZTtcblxuICAgICAgICBmb3IodmFyIGkgaW4gX2NvbG9ycyl7XG4gICAgICAgICAgaWYoTWFnaWNXYW5kLmRpZmZlcmVuY2UoX2NvbG9yc1tpXSwgYzEpIDwgdGhyZXNob2xkKXtcbiAgICAgICAgICAgIGlzTmV3Q29sb3IgPSBmYWxzZTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZihpc05ld0NvbG9yKXtcbiAgICAgICAgICBfY29sb3JzLnB1c2goYzEpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBfY29sb3JzO1xuICB9O1xuXG4gIC8qKlxuICAgKiBpbWFnZVxuICAgKiBjYW52YXMgLSDRh9C10YDQvdC+INCx0LvQvtC1INC40LfQvtCx0YDQsNC20LXQvdC40LUuXG4gICAqXG4gICAqIG1hc2stINC/0YDQtdC00YvQtNGD0YnQsNGPINC80LDRgdC60LAuINC90LAg0L3QtdC1INCx0YPQtNC10YIg0L3QsNC60LvQsNC00YvQstCw0YLRjCDQvdC+0LLQsNGPXG4gICAqIG1vZGUgLSDRgdC/0L7RgdC+0LEg0L3QsNC70L7QttC10L3QuNGPLlxuICAgKi9cbiAgbGliLm1hc2tTZWxlY3Rpb24gPSBmdW5jdGlvbiAoIGNhbnZhcywgbGVmdCwgdG9wLCBtYXNrICxtb2RlKSB7XG4gICAgbGVmdCA9IGxlZnQgfHwgMDtcbiAgICB0b3AgPSB0b3AgfHwgMDtcbiAgICBpZihjYW52YXMuY29uc3RydWN0b3IubmFtZSA9PSBcIkhUTUxJbWFnZUVsZW1lbnRcIil7XG5cbiAgICAgIHZhciBfX2NhbnZhcyA9IGNyZWF0ZUNhbnZhc0VsZW1lbnQoKTtcbiAgICAgIF9fY2FudmFzLndpZHRoID0gY2FudmFzLndpZHRoO1xuICAgICAgX19jYW52YXMuaGVpZ2h0ID0gY2FudmFzLmhlaWdodDtcbiAgICAgIHZhciBfX2N0eCA9IF9fY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gICAgICBfX2N0eC5kcmF3SW1hZ2UoY2FudmFzLCAwLCAwKTtcbiAgICAgIGNhbnZhcyA9IF9fY2FudmFzO1xuICAgIH1cblxuXG4gICAgdmFyIGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpLFxuICAgICAgaW1nRGF0YSA9IGN0eC5nZXRJbWFnZURhdGEoMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KSxcbiAgICAgIG1hc2sgPSBtYXNrIHx8IE1hZ2ljV2FuZC5jcmVhdGVNYXNrKGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7XG5cbiAgICB2YXIgX3gxID0gTWF0aC5tYXgoMCwgLSBsZWZ0KSxcbiAgICAgIF95MSA9IE1hdGgubWF4KDAsIC0gdG9wKSxcbiAgICAgIF94MiA9IE1hdGgubWluKG1hc2sud2lkdGggLSBsZWZ0LGNhbnZhcy53aWR0aCk7XG4gICAgX3kyID0gTWF0aC5taW4obWFzay5oZWlnaHQgLSB0b3AsY2FudmFzLmhlaWdodCk7XG5cbiAgICBmb3IgKHZhciB4ID0gX3gxOyB4IDwgX3gyOyB4KyspIHtcbiAgICAgIGZvciAodmFyIHkgPSBfeTE7IHkgPCBfeTI7IHkrKykge1xuICAgICAgICB2YXIgaW5kZXggPSAoY2FudmFzLndpZHRoICogeSArIHgpICogNDtcblxuICAgICAgICBpZiAoaW1nRGF0YS5kYXRhW2luZGV4XSA+IDIwKSB7XG4gICAgICAgICAgdmFyIGluZGV4MiA9IG1hc2sud2lkdGggKiAoeSArIHRvcCkgKyB4ICsgbGVmdDtcbiAgICAgICAgICBtYXNrLmRhdGFbaW5kZXgyXSA9IDE7XG4gICAgICAgICAgbWFzay5jb3VudCsrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBtYXNrO1xuICB9LFxuICBsaWIuc2VsZWN0UmVjdGFuZ2xlID0gZnVuY3Rpb24gKGltYWdlLCB4MSwgeTEsIHgyLCB5Mikge1xuXG4gICAgICB2YXIgbWFzayA9IG5ldyBTZWxlY3Rpb25NYXNrKGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQpO1xuICAgICAgdmFyIG1pblggPSBNYXRoLm1pbih4MSwgeDIpO1xuICAgICAgdmFyIG1heFggPSBNYXRoLm1heCh4MSwgeDIpO1xuICAgICAgdmFyIG1pblkgPSBNYXRoLm1pbih5MSwgeTIpO1xuICAgICAgdmFyIG1heFkgPSBNYXRoLm1heCh5MSwgeTIpO1xuXG4gICAgICB2YXIgdyA9IGltYWdlLndpZHRoLCBoID0gaW1hZ2UuaGVpZ2h0O1xuXG4gICAgICB2YXIgZGF0YSA9IGltYWdlLmRhdGE7XG4gICAgICBmb3IgKHZhciB5ID0gbWluWTsgeSA8PSBtYXhZOyB5KyspIHtcbiAgICAgICAgZm9yICh2YXIgeCA9IG1pblg7IHggPD0gbWF4WDsgeCsrKSB7XG4gICAgICAgICAgaWYgKGRhdGFbKHkgKiB3ICsgeCkgKiA0ICsgM10pIHtcbiAgICAgICAgICAgIG1hc2suZGF0YVt5ICogdyArIHhdID0gMTtcbiAgICAgICAgICAgIG1hc2suY291bnQrKztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgbWFzay5ib3VuZHMgPSB7XG4gICAgICAgIG1pblg6IG1pblgsXG4gICAgICAgIG1pblk6IG1pblksXG4gICAgICAgIG1heFg6IG1heFgsXG4gICAgICAgIG1heFk6IG1heFlcbiAgICAgIH07XG5cbiAgICAgIHJldHVybiBtYXNrO1xuICAgIH07XG5cbiAgbGliLmJ5dGVzID0gNDtcblxuXG5cblxuXG5cbiAgbGliLl9fZmxvb2RGaWxsID0gZnVuY3Rpb24gKGUscG9zdE1lc3NhZ2UpIHtcblxuICAgIGRhdGEgPSBlLmRhdGE7XG4gICAgdmFyIGltYWdlID0gZGF0YVswXSwgcHggPSBkYXRhWzFdLCBweSA9IGRhdGFbMl0sIGNvbG9yVGhyZXNob2xkID0gZGF0YVszXSwgb3B0aW9ucyA9IGRhdGFbNF07XG5cbiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgICAvKntcbiAgICAgdmlzaXRlZFBvaW50c0FycmF5LFxuICAgICBzYW1wbGVDb2xvcixcbiAgICAgcmVzdWx0TWFza1xuICAgICB9Ki9cblxuICAgIHZhciBjLCB4LCBuZXdZLCBlbCwgeHIsIHhsLCBkeSwgZHlsLCBkeXIsIGNoZWNrWSxcbiAgICAgIGRhdGEgPSBpbWFnZS5kYXRhLCB3ID0gaW1hZ2Uud2lkdGgsIGggPSBpbWFnZS5oZWlnaHQsIGJ5dGVzID0gbGliLmJ5dGVzLFxuICAgICAgaSA9IHB5ICogdyArIHB4OyAvLyBzdGFydCBwb2ludCBpbmRleCBpbiB0aGUgbWFzayBkYXRhXG4gICAgaSA9IGkgKiBieXRlczsgLy8gc3RhcnQgcG9pbnQgaW5kZXggaW4gdGhlIGltYWdlIGRhdGFcblxuICAgIHZhciB2aXNpdGVkICAgICA9IG9wdGlvbnMudmlzaXRlZFBvaW50cyB8fCBuZXcgVWludDhBcnJheSggdyAqIGgpLCAvLyBtYXNrIG9mIHZpc2l0ZWQgcG9pbnRzXG4gICAgICBzYW1wbGVDb2xvciA9IG9wdGlvbnMuc2FtcGxlQ29sb3IgICB8fCBbZGF0YVtpXSwgZGF0YVtpICsgMV0sIGRhdGFbaSArIDJdLCBkYXRhW2kgKyAzXV0sIC8vIHN0YXJ0IHBvaW50IGNvbG9yIChzYW1wbGUpXG4gICAgICByZXN1bHQgICAgICA9IG9wdGlvbnMuYWN0aXZlTWFzaztcblxuICAgIGZ1bmN0aW9uIGFjY2VwdGFibGUoeCwgeSkge1xuLy8gY2hlY2sgd2hldGhlciB0aGUgcG9pbnQgaGFzIGJlZW4gdmlzaXRlZFxuICAgICAgaWYgKHZpc2l0ZWRbeSAqIGltYWdlLndpZHRoICsgeF0gPT09IDEpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgdmFyIGkgPSAoeSAqIGltYWdlLndpZHRoICsgeCkgKiBsaWIuYnl0ZXMsXG4gICAgICAgIGNvbG9yMiA9IFtpbWFnZS5kYXRhW2ldLCBpbWFnZS5kYXRhW2kgKyAxXSwgaW1hZ2UuZGF0YVtpICsgMl0sIGltYWdlLmRhdGFbaSArIDNdXTtcbiAgICAgIGlmIChzYW1wbGVDb2xvclswXSAhPT0gZmFsc2UgJiYgTWF0aC5hYnMoc2FtcGxlQ29sb3JbMF0gLSBjb2xvcjJbMF0pID4gY29sb3JUaHJlc2hvbGQpcmV0dXJuIGZhbHNlO1xuICAgICAgaWYgKHNhbXBsZUNvbG9yWzFdICE9PSBmYWxzZSAmJiBNYXRoLmFicyhzYW1wbGVDb2xvclsxXSAtIGNvbG9yMlsxXSkgPiBjb2xvclRocmVzaG9sZClyZXR1cm4gZmFsc2U7XG4gICAgICBpZiAoc2FtcGxlQ29sb3JbMl0gIT09IGZhbHNlICYmIE1hdGguYWJzKHNhbXBsZUNvbG9yWzJdIC0gY29sb3IyWzJdKSA+IGNvbG9yVGhyZXNob2xkKXJldHVybiBmYWxzZTtcbiAgICAgIGlmIChzYW1wbGVDb2xvclszXSAhPT0gZmFsc2UgJiYgTWF0aC5hYnMoc2FtcGxlQ29sb3JbM10gLSBjb2xvcjJbM10pID4gY29sb3JUaHJlc2hvbGQpcmV0dXJuIGZhbHNlO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfTtcblxuXG5cbiAgICBpZiAodmlzaXRlZFtpXSA9PT0gMSkgcmV0dXJuIG51bGw7XG5cblxuICAgIHZhciBmaXJzdCA9IHRydWU7XG4gICAgdmFyIHN0YWNrID0gW3t5OiBweSwgbGVmdDogcHggLSAxLCByaWdodDogcHggKyAxLCBkaXI6IDF9XTsgLy8gZmlyc3Qgc2Nhbm5pbmcgbGluZVxuXG4gICAgdmFyIG1vZGUgPSAnc3RyaWN0JztcbiAgICB2YXIgX2NpO1xuICAgIGRvIHtcbiAgICAgIGVsID0gc3RhY2suc2hpZnQoKTsgLy8gZ2V0IGxpbmUgZm9yIHNjYW5uaW5nXG5cbiAgICAgIGNoZWNrWSA9IGZhbHNlO1xuICAgICAgZm9yICh4ID0gZWwubGVmdCArIDE7IHggPCBlbC5yaWdodDsgeCsrKSB7XG4gICAgICAgIGR5ID0gZWwueSAqIHc7XG5cbiAgICAgICAgaWYobW9kZSA9PSAnZ3JhZGllbnQnICYmICFmaXJzdCkge1xuICAgICAgICAgIF9jaSA9IChkeSArIHggKyAoZWwuZGlyID09IC0xID8gdzogLSB3KSkqNDtcbiAgICAgICAgICBzYW1wbGVDb2xvciA9IFtkYXRhW19jaV0sZGF0YVtfY2krMV0sZGF0YVtfY2krMl0sZGF0YVtfY2krM11dO1xuICAgICAgICB9XG4gICAgICAgIGlmICghYWNjZXB0YWJsZSh4LCBlbC55LCBpbWFnZSwgdmlzaXRlZCwgc2FtcGxlQ29sb3IsIGNvbG9yVGhyZXNob2xkKSljb250aW51ZTtcblxuICAgICAgICBmaXJzdCA9IGZhbHNlO1xuXG4gICAgICAgIGNoZWNrWSA9IHRydWU7IC8vIGlmIHRoZSBjb2xvciBvZiB0aGUgbmV3IHBvaW50KHgseSkgaXMgc2ltaWxhciB0byB0aGUgc2FtcGxlIGNvbG9yIG5lZWQgdG8gY2hlY2sgbWlubWF4IGZvciBZXG5cbiAgICAgICAgcmVzdWx0LmNvdW50Kys7XG5cbiAgICAgICAgcmVzdWx0LmRhdGFbZHkgKyB4XSA9IDE7IC8vIG1hcmsgYSBuZXcgcG9pbnQgaW4gbWFza1xuICAgICAgICB2aXNpdGVkW2R5ICsgeF0gPSAxOyAvLyBtYXJrIGEgbmV3IHBvaW50IGFzIHZpc2l0ZWRcblxuICAgICAgICB4bCA9IHggLSAxO1xuICAgICAgICAvLyB3YWxrIHRvIGxlZnQgc2lkZSBzdGFydGluZyB3aXRoIHRoZSBsZWZ0IG5laWdoYm9yXG4gICAgICAgIHdoaWxlICh4bCA+IC0xKSB7XG4gICAgICAgICAgZHlsID0gZHkgKyB4bDtcblxuICAgICAgICAgIGlmKG1vZGUgPT0gJ2dyYWRpZW50Jykge1xuICAgICAgICAgICAgX2NpID0gKGR5bCArIDEpKjQ7XG4gICAgICAgICAgICBzYW1wbGVDb2xvciA9IFtkYXRhW19jaV0sIGRhdGFbX2NpICsgMV0sIGRhdGFbX2NpICsgMl0sIGRhdGFbX2NpICsgM11dO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoIWFjY2VwdGFibGUoeGwsIGVsLnksIGltYWdlLCB2aXNpdGVkLCBzYW1wbGVDb2xvciwgY29sb3JUaHJlc2hvbGQpKSBicmVhaztcblxuICAgICAgICAgIHJlc3VsdC5jb3VudCsrO1xuICAgICAgICAgIHJlc3VsdC5kYXRhW2R5bF0gPSAxO1xuICAgICAgICAgIHZpc2l0ZWRbZHlsXSA9IDE7XG5cbiAgICAgICAgICB4bC0tO1xuICAgICAgICB9XG4gICAgICAgIHhyID0geCArIDE7XG4gICAgICAgIC8vIHdhbGsgdG8gcmlnaHQgc2lkZSBzdGFydGluZyB3aXRoIHRoZSByaWdodCBuZWlnaGJvclxuICAgICAgICB3aGlsZSAoeHIgPCB3KSB7XG4gICAgICAgICAgZHlyID0gZHkgKyB4cjtcblxuICAgICAgICAgIGlmKG1vZGUgPT0gJ2dyYWRpZW50Jykge1xuICAgICAgICAgICAgX2NpID0gKGR5ciAtIDEpKjQ7XG4gICAgICAgICAgICBzYW1wbGVDb2xvciA9IFtkYXRhW19jaV0sIGRhdGFbX2NpICsgMV0sIGRhdGFbX2NpICsgMl0sIGRhdGFbX2NpICsgM11dO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoIWFjY2VwdGFibGUoeHIsIGVsLnksIGltYWdlLCB2aXNpdGVkLCBzYW1wbGVDb2xvciwgY29sb3JUaHJlc2hvbGQpKXtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJlc3VsdC5jb3VudCsrO1xuICAgICAgICAgIHJlc3VsdC5kYXRhW2R5cl0gPSAxO1xuICAgICAgICAgIHZpc2l0ZWRbZHlyXSA9IDE7XG4gICAgICAgICAgeHIrKztcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGNoZWNrIG1pbm1heCBmb3IgWFxuICAgICAgICBpZiAoeGwgPCByZXN1bHQuYm91bmRzLm1pblgpIHJlc3VsdC5ib3VuZHMubWluWCA9IHhsICsgMTtcbiAgICAgICAgaWYgKHhyID4gcmVzdWx0LmJvdW5kcy5tYXhYKSByZXN1bHQuYm91bmRzLm1heFggPSB4ciAtIDE7XG5cbiAgICAgICAgbmV3WSA9IGVsLnkgLSBlbC5kaXI7XG4gICAgICAgIGlmIChuZXdZID49IDAgJiYgbmV3WSA8IGgpIHtcbiAgICAgICAgICBpZiAoeGwgPCB4cikgc3RhY2sucHVzaCh7eTogbmV3WSwgbGVmdDogeGwsIHJpZ2h0OiB4ciwgZGlyOiAtZWwuZGlyfSk7IC8vIGZyb20gXCJuZXcgbGVmdFwiIHRvIFwibmV3IHJpZ2h0XCJcbiAgICAgICAgICAvLyBhZGQgdHdvIHNjYW5uaW5nIGxpbmVzIGluIHRoZSBvcHBvc2l0ZSBkaXJlY3Rpb24gKHkgLSBkaXIpIGlmIG5lY2Vzc2FyeVxuICAgICAgICAgIC8vIGlmICh4bCA8PSBlbC5sZWZ0KSBzdGFjay5wdXNoKHt5OiBuZXdZLCBsZWZ0OiB4bCwgcmlnaHQ6IGVsLmxlZnQsIGRpcjogLWVsLmRpcn0pOyAvLyBmcm9tIFwibmV3IGxlZnRcIiB0byBcImN1cnJlbnQgbGVmdFwiXG4gICAgICAgICAgLy8gaWYgKGVsLnJpZ2h0IDw9IHhyKSBzdGFjay5wdXNoKHt5OiBuZXdZLCBsZWZ0OiBlbC5yaWdodCwgcmlnaHQ6IHhyLCBkaXI6IC1lbC5kaXJ9KTsgLy8gZnJvbSBcImN1cnJlbnQgcmlnaHRcIiB0byBcIm5ldyByaWdodFwiXG4gICAgICAgIH1cbiAgICAgICAgbmV3WSA9IGVsLnkgKyBlbC5kaXI7XG4gICAgICAgIGlmIChuZXdZID49IDAgJiYgbmV3WSA8IGgpIHsgLy8gYWRkIHRoZSBzY2FubmluZyBsaW5lIGluIHRoZSBkaXJlY3Rpb24gKHkgKyBkaXIpIGlmIG5lY2Vzc2FyeVxuICAgICAgICAgIGlmICh4bCA8IHhyKSBzdGFjay5wdXNoKHt5OiBuZXdZLCBsZWZ0OiB4bCwgcmlnaHQ6IHhyLCBkaXI6IGVsLmRpcn0pOyAvLyBmcm9tIFwibmV3IGxlZnRcIiB0byBcIm5ldyByaWdodFwiXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIC8vIGNoZWNrIG1pbm1heCBmb3IgWSBpZiBuZWNlc3NhcnlcbiAgICAgIGlmIChjaGVja1kpIHtcbiAgICAgICAgaWYgKGVsLnkgPCByZXN1bHQuYm91bmRzLm1pblkpIHJlc3VsdC5ib3VuZHMubWluWSA9IGVsLnk7XG4gICAgICAgIGlmIChlbC55ID4gcmVzdWx0LmJvdW5kcy5tYXhZKSByZXN1bHQuYm91bmRzLm1heFkgPSBlbC55O1xuICAgICAgfVxuICAgIH0gd2hpbGUgKHN0YWNrLmxlbmd0aCA+IDApO1xuXG4gICAgcG9zdE1lc3NhZ2UgJiYgcG9zdE1lc3NhZ2UocmVzdWx0KTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuXG4gIGxpYi5leHRlbmRNYXNrID0gZnVuY3Rpb24gKG1hc2ssIHZhbHVlKSB7XG5cbiAgICB2YXIgbWFzazIgPSBuZXcgU2VsZWN0aW9uTWFzayhtYXNrLndpZHRoICsgMiwgbWFzay5oZWlnaHQgKyAyKTtcbiAgICBpZih2YWx1ZSl7XG4gICAgICBtYXNrMi5kYXRhLmZpbGwodmFsdWUpO1xuICAgIH1cblxuICAgIGZvcih2YXIgeSA9IDA7eSA8IG1hc2suaGVpZ2h0IDsgeSsrKXtcbiAgICAgIGZvcih2YXIgeCA9IDA7eCA8IG1hc2sud2lkdGggOyB4Kyspe1xuICAgICAgICBtYXNrMi5kYXRhWyAoeSArIDEpICogbWFzazIud2lkdGggKyB4ICsgMSBdID0gbWFzay5kYXRhW3kgKiBtYXNrLndpZHRoICsgeCBdO1xuICAgICAgfVxuICAgIH1cbiAgICBtYXNrMi5jb3VudCAgPSBtYXNrLmNvdW50O1xuXG4gICAgaWYoIXZhbHVlKSB7XG4gICAgICBtYXNrMi5ib3VuZHMgPSB7XG4gICAgICAgIG1pblg6IG1hc2suYm91bmRzLm1pblggKyAxLFxuICAgICAgICBtYXhYOiBtYXNrLmJvdW5kcy5tYXhYICsgMSxcbiAgICAgICAgbWF4WTogbWFzay5ib3VuZHMubWF4WSArIDEsXG4gICAgICAgIG1pblk6IG1hc2suYm91bmRzLm1pblkgKyAxXG4gICAgICB9O1xuICAgIH1lbHNle1xuICAgICAgbWFzazIuYm91bmRzID0gbWFzay5ib3VuZHM7XG4gICAgfVxuXG4gICAgcmV0dXJuIG1hc2syO1xuICB9O1xuXG4gIC8qKiBDcmVhdGUgYSBiaW5hcnkgbWFzayBvbiB0aGUgaW1hZ2UgYnkgY29sb3IgdGhyZXNob2xkXG4gICAqIEFsZ29yaXRobTogU2NhbmxpbmUgZmxvb2QgZmlsbCAoaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9GbG9vZF9maWxsKVxuICAgKiBAcGFyYW0ge09iamVjdH0gaW1hZ2U6IHtVaW50OEFycmF5fSBkYXRhLCB7aW50fSB3aWR0aCwge2ludH0gaGVpZ2h0LCB7aW50fSBieXRlc1xuICAgKiBAcGFyYW0ge2ludH0geCBvZiBzdGFydCBwaXhlbFxuICAgKiBAcGFyYW0ge2ludH0geSBvZiBzdGFydCBwaXhlbFxuICAgKiBAcGFyYW0ge2ludH0gY29sb3IgdGhyZXNob2xkXG4gICAqIEBwYXJhbSB7VWludDhBcnJheX0gbWFzayBvZiB2aXNpdGVkIHBvaW50cyAob3B0aW9uYWwpXG4gICAqIEByZXR1cm4ge09iamVjdH0gbWFzazoge1VpbnQ4QXJyYXl9IGRhdGEsIHtpbnR9IHdpZHRoLCB7aW50fSBoZWlnaHQsIHtPYmplY3R9IGJvdW5kc1xuICAgKi9cbiAgbGliLmZsb29kRmlsbCA9IGZ1bmN0aW9uIChpbWFnZSwgcHgsIHB5LCBjb2xvclRocmVzaG9sZCwgb3B0aW9ucyxjb2xvcixjYWxsYmFjaykge1xuICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICAgIG9wdGlvbnMuYWN0aXZlTWFzayA9IG9wdGlvbnMuYWN0aXZlTWFzayAgfHwgbmV3IFNlbGVjdGlvbk1hc2soaW1hZ2Uud2lkdGgsIGltYWdlLmhlaWdodCk7XG5cbiAgICByZXR1cm4gbGliLl9fZmxvb2RGaWxsKHtkYXRhOiBbaW1hZ2UsIHB4LCBweSwgY29sb3JUaHJlc2hvbGQsIG9wdGlvbnMsIGNvbG9yXX0sY2FsbGJhY2spO1xuXG4gICAgLypcbiAgICB2YXIgd29ya2VyID0gXy53b3JrZXIobGliLl9fZmxvb2RGaWxsKTtcbiAgICB3b3JrZXIub25tZXNzYWdlID0gZnVuY3Rpb24oZSl7XG4gICAgICB2YXIgbWFzayA9IG5ldyBTZWxlY3Rpb25NYXNrKGUuZGF0YSk7XG4gICAgICBjYWxsYmFjayAmJiBjYWxsYmFjayhtYXNrKTtcbiAgICB9O1xuICAgIHdvcmtlci5wb3N0TWVzc2FnZShbaW1hZ2UsIHB4LCBweSwgY29sb3JUaHJlc2hvbGQsIG9wdGlvbnNdKTtcbiovXG5cbiAgfTtcblxuICBsaWIuc3Vic3RyYWN0ID0gZnVuY3Rpb24gKG1hc2ssIG1hc2syKSB7XG4gICAgdmFyIG1pblgsIG1heFgsIG1pblksIG1heFk7XG5cbiAgICB2YXIgcmVzdWx0ID0gbmV3IFNlbGVjdGlvbk1hc2sobWFzay53aWR0aCwgbWFzay5oZWlnaHQpO1xuICAgIHZhciBib3VuZHMgPSBtYXNrMi5ib3VuZHM7XG5cbiAgICB2YXIgbWluWCA9IGZhbHNlLCBtaW5ZID0gbWFzay5oZWlnaHQsIG1heFggPSBmYWxzZSwgbWF4WSA9IC0xO1xuXG4gICAgZm9yICh2YXIgeCA9IGJvdW5kcy5taW5YOyB4IDw9IGJvdW5kcy5tYXhYOyB4KyspIHtcbiAgICAgIGZvciAodmFyIHkgPSBib3VuZHMubWluWTsgeSA8PSBib3VuZHMubWF4WTsgeSsrKSB7XG4gICAgICAgIHZhciBpbmRleCA9IG1hc2sud2lkdGggKiB5ICsgeDtcblxuICAgICAgICBpZiAoIW1hc2suZGF0YVtpbmRleF0gJiYgbWFzazIuZGF0YVtpbmRleF0pIHtcbiAgICAgICAgICByZXN1bHQuZGF0YVtpbmRleF0gPSAxO1xuICAgICAgICAgIHJlc3VsdC5jb3VudCsrO1xuICAgICAgICAgIGlmIChyZXN1bHQuYm91bmRzLm1pblkgPiB5KXJlc3VsdC5ib3VuZHMubWluWSA9IHk7XG4gICAgICAgICAgaWYgKHJlc3VsdC5ib3VuZHMubWF4WSA8IHkpcmVzdWx0LmJvdW5kcy5tYXhZID0geTtcbiAgICAgICAgICBpZiAocmVzdWx0LmJvdW5kcy5taW5YID4geClyZXN1bHQuYm91bmRzLm1pblggPSB4O1xuICAgICAgICAgIGlmIChyZXN1bHQuYm91bmRzLm1heFggPCB4KXJlc3VsdC5ib3VuZHMubWF4WCA9IHg7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgbGliLmdldEltYWdlRGF0YSAgPSBmdW5jdGlvbihtaXhlZFR5cGUpe1xuICAgIHZhciBjYW52YXM7XG4gICAgaWYgKG1peGVkVHlwZS5jb25zdHJ1Y3Rvci5uYW1lID09IFwiSW1hZ2VcIiB8fCBtaXhlZFR5cGUuY29uc3RydWN0b3IubmFtZSA9PSBcIkhUTUxJbWFnZUVsZW1lbnRcIikge1xuICAgICAgdmFyIF9jYW52YXMgPSBjcmVhdGVDYW52YXNFbGVtZW50KCk7XG4gICAgICBfY2FudmFzLndpZHRoID0gbWl4ZWRUeXBlLndpZHRoO1xuICAgICAgX2NhbnZhcy5oZWlnaHQgPSBtaXhlZFR5cGUuaGVpZ2h0O1xuICAgICAgdmFyIGN0eCA9IF9jYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpO1xuICAgICAgY3R4LmRyYXdJbWFnZShtaXhlZFR5cGUsIDAsIDApO1xuICAgICAgY2FudmFzID0gX2NhbnZhcztcbiAgICB9ZWxzZXtcbiAgICAgIGNhbnZhcyA9IG1peGVkVHlwZTtcbiAgICB9XG4gICAgaWYgKGNhbnZhcy5jb25zdHJ1Y3Rvci5uYW1lID09IFwiSFRNTENhbnZhc0VsZW1lbnRcIiB8fCBjYW52YXMuY29uc3RydWN0b3IubmFtZSA9PSBcIkNhbnZhc1wiKSB7XG4gICAgICB2YXIgaW1nRGF0YSA9IGNhbnZhcy5nZXRDb250ZXh0KFwiMmRcIikuZ2V0SW1hZ2VEYXRhKDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7XG4gICAgfWVsc2V7XG4gICAgICBpbWdEYXRhID0gbWl4ZWRUeXBlO1xuICAgIH1cbiAgICByZXR1cm4gaW1nRGF0YTtcbiAgfTtcblxuICBsaWIuZ2V0Q29sb3JlZFBpeGVscyA9IGZ1bmN0aW9uIChtaXhlZFR5cGUpIHtcbiAgICB2YXIgaW1nRGF0YSA9IGxpYi5nZXRJbWFnZURhdGEobWl4ZWRUeXBlKTtcbiAgICB2YXIgZGF0YSA9IGltZ0RhdGEuZGF0YTtcbiAgICB2YXIgcGl4ZWxzID0gMDtcbiAgICBmb3IgKHZhciBpID0gMzsgaSA8IGRhdGEubGVuZ3RoOyBpICs9IDQpIHtcbiAgICAgIGlmIChkYXRhW2ldKSB7XG4gICAgICAgIHBpeGVscys9IGRhdGFbaV0gLyAyNTU7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBwaXhlbHM7XG4gIH07XG5cbiAgbGliLmludmVydE1hc2sgPSBmdW5jdGlvbiAobWFzaykge1xuICAgIHZhciByZXN1bHQgPSBuZXcgU2VsZWN0aW9uTWFzayhtYXNrLndpZHRoLCBtYXNrLmhlaWdodCk7XG4gICAgcmVzdWx0LmJvdW5kcyA9IHtcbiAgICAgIG1pblg6IEluZmluaXR5LFxuICAgICAgbWluWTogSW5maW5pdHksXG4gICAgICBtYXhZOiAtMSxcbiAgICAgIG1heFg6IC0xXG4gICAgfTtcblxuXG4gICAgZm9yICh2YXIgeCA9IDA7IHggPCBtYXNrLndpZHRoOyB4KyspIHtcbiAgICAgIGZvciAodmFyIHkgPSAwOyB5IDwgbWFzay5oZWlnaHQ7IHkrKykge1xuICAgICAgICB2YXIgaW5kZXggPSBtYXNrLndpZHRoICogeSArIHg7XG4gICAgICAgIGlmICghbWFzay5kYXRhW2luZGV4XSkge1xuICAgICAgICAgIHJlc3VsdC5kYXRhW2luZGV4XSA9IDE7XG4gICAgICAgICAgcmVzdWx0LmNvdW50Kys7XG4gICAgICAgICAgaWYgKHJlc3VsdC5ib3VuZHMubWluWSA+IHkpcmVzdWx0LmJvdW5kcy5taW5ZID0geTtcbiAgICAgICAgICBpZiAocmVzdWx0LmJvdW5kcy5tYXhZIDwgeSlyZXN1bHQuYm91bmRzLm1heFkgPSB5O1xuICAgICAgICAgIGlmIChyZXN1bHQuYm91bmRzLm1pblggPiB4KXJlc3VsdC5ib3VuZHMubWluWCA9IHg7XG4gICAgICAgICAgaWYgKHJlc3VsdC5ib3VuZHMubWF4WCA8IHgpcmVzdWx0LmJvdW5kcy5tYXhYID0geDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuXG4gIGxpYi5leGNsdWRlID0gZnVuY3Rpb24gKG1hc2ssIG1hc2syKSB7XG4gICAgdmFyIHJlc3VsdCA9IG5ldyBTZWxlY3Rpb25NYXNrKG1hc2sud2lkdGgsIG1hc2suaGVpZ2h0KTtcbiAgICB2YXIgYm91bmRzID0ge1xuICAgICAgbWluWDogTWF0aC5taW4obWFzay5ib3VuZHMubWluWCwgbWFzazIuYm91bmRzLm1pblgpLFxuICAgICAgbWF4WDogTWF0aC5tYXgobWFzay5ib3VuZHMubWF4WCwgbWFzazIuYm91bmRzLm1heFgpLFxuICAgICAgbWluWTogTWF0aC5taW4obWFzay5ib3VuZHMubWluWSwgbWFzazIuYm91bmRzLm1pblkpLFxuICAgICAgbWF4WTogTWF0aC5tYXgobWFzay5ib3VuZHMubWF4WSwgbWFzazIuYm91bmRzLm1heFkpXG4gICAgfTtcblxuICAgIHZhciBtaW5YID0gZmFsc2UsIG1pblkgPSBtYXNrLmhlaWdodCwgbWF4WCA9IGZhbHNlLCBtYXhZID0gLTE7XG5cbiAgICBmb3IgKHZhciB4ID0gYm91bmRzLm1pblg7IHggPD0gYm91bmRzLm1heFg7IHgrKykge1xuICAgICAgZm9yICh2YXIgeSA9IGJvdW5kcy5taW5ZOyB5IDw9IGJvdW5kcy5tYXhZOyB5KyspIHtcbiAgICAgICAgdmFyIGluZGV4ID0gbWFzazIud2lkdGggKiB5ICsgeDtcblxuICAgICAgICBpZiAobWFzay5kYXRhW2luZGV4XSBeIG1hc2syLmRhdGFbaW5kZXhdKSB7XG4gICAgICAgICAgcmVzdWx0LmRhdGFbaW5kZXhdID0gMTtcbiAgICAgICAgICByZXN1bHQuY291bnQrKztcbiAgICAgICAgICBtYXhYID0geDtcbiAgICAgICAgICBpZiAobWluWSA+IHkpbWluWSA9IHk7XG4gICAgICAgICAgaWYgKG1heFkgPCB5KW1heFkgPSB5O1xuICAgICAgICAgIGlmIChtaW5YID09PSBmYWxzZSkge1xuICAgICAgICAgICAgbWluWCA9IHg7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmVzdWx0LmJvdW5kcyA9IHtcbiAgICAgIG1pblg6IG1pblgsXG4gICAgICBtYXhYOiBtYXhYLFxuICAgICAgbWluWTogbWluWSxcbiAgICAgIG1heFk6IG1heFlcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuXG4gIGxpYi5pbnRlcnNlY3QgPSBmdW5jdGlvbiAobWFzaywgbWFzazIpIHtcbiAgICB2YXIgbWluWCwgbWF4WCwgbWluWSwgbWF4WTtcblxuICAgIHZhciByZXN1bHQgPSBuZXcgU2VsZWN0aW9uTWFzayhtYXNrLndpZHRoLCBtYXNrLmhlaWdodCk7XG4gICAgdmFyIGJvdW5kcyA9IHtcbiAgICAgIG1pblg6IE1hdGgubWF4KG1hc2suYm91bmRzLm1pblgsIG1hc2syLmJvdW5kcy5taW5YKSxcbiAgICAgIG1heFg6IE1hdGgubWluKG1hc2suYm91bmRzLm1heFgsIG1hc2syLmJvdW5kcy5tYXhYKSxcbiAgICAgIG1pblk6IE1hdGgubWF4KG1hc2suYm91bmRzLm1pblksIG1hc2syLmJvdW5kcy5taW5ZKSxcbiAgICAgIG1heFk6IE1hdGgubWluKG1hc2suYm91bmRzLm1heFksIG1hc2syLmJvdW5kcy5tYXhZKVxuICAgIH07XG5cbiAgICB2YXIgbWluWCA9IGZhbHNlLCBtaW5ZID0gbWFzay5oZWlnaHQsIG1heFggPSBmYWxzZSwgbWF4WSA9IC0xO1xuXG4gICAgZm9yICh2YXIgeCA9IGJvdW5kcy5taW5YOyB4IDw9IGJvdW5kcy5tYXhYOyB4KyspIHtcbiAgICAgIGZvciAodmFyIHkgPSBib3VuZHMubWluWTsgeSA8PSBib3VuZHMubWF4WTsgeSsrKSB7XG4gICAgICAgIHZhciBpbmRleCA9IG1hc2syLndpZHRoICogeSArIHg7XG5cbiAgICAgICAgaWYgKG1hc2suZGF0YVtpbmRleF0gJiYgbWFzazIuZGF0YVtpbmRleF0pIHtcbiAgICAgICAgICByZXN1bHQuZGF0YVtpbmRleF0gPSAxO1xuICAgICAgICAgIHJlc3VsdC5jb3VudCsrO1xuICAgICAgICAgIG1heFggPSB4O1xuICAgICAgICAgIGlmIChtaW5ZID4geSltaW5ZID0geTtcbiAgICAgICAgICBpZiAobWF4WSA8IHkpbWF4WSA9IHk7XG4gICAgICAgICAgaWYgKG1pblggPT09IGZhbHNlKSB7XG4gICAgICAgICAgICBtaW5YID0geDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXN1bHQuYm91bmRzID0ge1xuICAgICAgbWluWDogbWluWCxcbiAgICAgIG1heFg6IG1heFgsXG4gICAgICBtaW5ZOiBtaW5ZLFxuICAgICAgbWF4WTogbWF4WVxuICAgIH1cblxuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG5cbiAgbGliLmFkZCA9IGZ1bmN0aW9uIChtYXNrLCBtYXNrMikge1xuICAgIHZhciByZXN1bHQgPSBuZXcgU2VsZWN0aW9uTWFzayhtYXNrLndpZHRoLCBtYXNrLmhlaWdodCk7XG5cbiAgICByZXN1bHQuYm91bmRzID0ge1xuICAgICAgbWluWDogTWF0aC5taW4obWFzay5ib3VuZHMubWluWCwgbWFzazIuYm91bmRzLm1pblgpLFxuICAgICAgbWF4WDogTWF0aC5tYXgobWFzay5ib3VuZHMubWF4WCwgbWFzazIuYm91bmRzLm1heFgpLFxuICAgICAgbWluWTogTWF0aC5taW4obWFzay5ib3VuZHMubWluWSwgbWFzazIuYm91bmRzLm1pblkpLFxuICAgICAgbWF4WTogTWF0aC5tYXgobWFzay5ib3VuZHMubWF4WSwgbWFzazIuYm91bmRzLm1heFkpXG4gICAgfTtcblxuICAgIGZvciAodmFyIHggPSByZXN1bHQuYm91bmRzLm1pblg7IHggPD0gcmVzdWx0LmJvdW5kcy5tYXhYOyB4KyspIHtcbiAgICAgIGZvciAodmFyIHkgPSByZXN1bHQuYm91bmRzLm1pblk7IHkgPD0gcmVzdWx0LmJvdW5kcy5tYXhZOyB5KyspIHtcbiAgICAgICAgdmFyIGluZGV4ID0gbWFzazIud2lkdGggKiB5ICsgeDtcblxuICAgICAgICBpZiAobWFzay5kYXRhW2luZGV4XSB8fCBtYXNrMi5kYXRhW2luZGV4XSkge1xuICAgICAgICAgIHJlc3VsdC5kYXRhW2luZGV4XSA9IDE7XG4gICAgICAgICAgcmVzdWx0LmNvdW50Kys7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuXG4gIC8qKiBBcHBseSB0aGUgZ2F1c3MtYmx1ciBmaWx0ZXIgdG8gYmluYXJ5IG1hc2tcbiAgICogQWxnb3JpdGhtczogaHR0cDovL2Jsb2cuaXZhbmsubmV0L2Zhc3Rlc3QtZ2F1c3NpYW4tYmx1ci5odG1sXG4gICAqIGh0dHA6Ly93d3cubGlicm93LmNvbS9hcnRpY2xlcy9hcnRpY2xlLTlcbiAgICogaHR0cDovL2VseW54c2RrLmZyZWUuZnIvZXh0LWRvY3MvQmx1ci9GYXN0X2JveF9ibHVyLnBkZlxuICAgKiBAcGFyYW0ge09iamVjdH0gbWFzazoge1VpbnQ4QXJyYXl9IGRhdGEsIHtpbnR9IHdpZHRoLCB7aW50fSBoZWlnaHQsIHtPYmplY3R9IGJvdW5kc1xuICAgKiBAcGFyYW0ge2ludH0gYmx1ciByYWRpdXNcbiAgICogQHJldHVybiB7T2JqZWN0fSBtYXNrOiB7VWludDhBcnJheX0gZGF0YSwge2ludH0gd2lkdGgsIHtpbnR9IGhlaWdodCwge09iamVjdH0gYm91bmRzXG4gICAqL1xuICBsaWIuZ2F1c3NCbHVyID0gZnVuY3Rpb24gKG1hc2ssIHJhZGl1cykge1xuXG4gICAgdmFyIGksIGssIGsxLCB4LCB5LCB2YWwsIHN0YXJ0LCBlbmQsXG4gICAgICBuID0gcmFkaXVzICogMiArIDEsIC8vIHNpemUgb2YgdGhlIHBhdHRlcm4gZm9yIHJhZGl1cy1uZWlnaGJvcnMgKGZyb20gLXIgdG8gK3Igd2l0aCB0aGUgY2VudGVyIHBvaW50KVxuICAgICAgczIgPSByYWRpdXMgKiByYWRpdXMsXG4gICAgICB3ZyA9IG5ldyBGbG9hdDMyQXJyYXkobiksIC8vIHdlaWdodHNcbiAgICAgIHRvdGFsID0gMCwgLy8gc3VtIG9mIHdlaWdodHModXNlZCBmb3Igbm9ybWFsaXphdGlvbilcbiAgICAgIHcgPSBtYXNrLndpZHRoLFxuICAgICAgaCA9IG1hc2suaGVpZ2h0LFxuICAgICAgZGF0YSA9IG1hc2suZGF0YSxcbiAgICAgIG1pblggPSBtYXNrLmJvdW5kcy5taW5YLFxuICAgICAgbWF4WCA9IG1hc2suYm91bmRzLm1heFgsXG4gICAgICBtaW5ZID0gbWFzay5ib3VuZHMubWluWSxcbiAgICAgIG1heFkgPSBtYXNrLmJvdW5kcy5tYXhZLFxuICAgICAgY291bnQgPSAwO1xuXG4gICAgLy8gY2FsYyBnYXVzcyB3ZWlnaHRzXG4gICAgZm9yIChpID0gMDsgaSA8IHJhZGl1czsgaSsrKSB7XG4gICAgICB2YXIgZHNxID0gKHJhZGl1cyAtIGkpICogKHJhZGl1cyAtIGkpO1xuICAgICAgdmFyIHd3ID0gTWF0aC5leHAoLWRzcSAvICgyLjAgKiBzMikpIC8gKDIgKiBNYXRoLlBJICogczIpO1xuICAgICAgd2dbcmFkaXVzICsgaV0gPSB3Z1tyYWRpdXMgLSBpXSA9IHd3O1xuICAgICAgdG90YWwgKz0gMiAqIHd3O1xuICAgIH1cbiAgICAvLyBub3JtYWxpemF0aW9uIHdlaWdodHNcbiAgICBmb3IgKGkgPSAwOyBpIDwgbjsgaSsrKSB7XG4gICAgICB3Z1tpXSAvPSB0b3RhbDtcbiAgICB9XG5cbiAgICB2YXIgcmVzdWx0ID0gbmV3IFVpbnQ4QXJyYXkodyAqIGgpLCAvLyByZXN1bHQgbWFza1xuICAgICAgZW5kWCA9IHJhZGl1cyArIHcsXG4gICAgICBlbmRZID0gcmFkaXVzICsgaDtcblxuICAgIC8vd2FsayB0aHJvdWdoIGFsbCBzb3VyY2UgcG9pbnRzIGZvciBibHVyXG4gICAgZm9yICh5ID0gbWluWTsgeSA8IG1heFkgKyAxOyB5KyspXG4gICAgICBmb3IgKHggPSBtaW5YOyB4IDwgbWF4WCArIDE7IHgrKykge1xuICAgICAgICB2YWwgPSAwO1xuICAgICAgICBrID0geSAqIHcgKyB4OyAvLyBpbmRleCBvZiB0aGUgcG9pbnRcbiAgICAgICAgc3RhcnQgPSByYWRpdXMgLSB4ID4gMCA/IHJhZGl1cyAtIHggOiAwO1xuICAgICAgICBlbmQgPSBlbmRYIC0geCA8IG4gPyBlbmRYIC0geCA6IG47IC8vIE1hdGgubWluKCgoKHcgLSAxKSAtIHgpICsgcmFkaXVzKSArIDEsIG4pO1xuICAgICAgICBrMSA9IGsgLSByYWRpdXM7XG4gICAgICAgIC8vIHdhbGsgdGhyb3VnaCB4LW5laWdoYm9yc1xuICAgICAgICBmb3IgKGkgPSBzdGFydDsgaSA8IGVuZDsgaSsrKSB7XG4gICAgICAgICAgdmFsICs9IGRhdGFbazEgKyBpXSAqIHdnW2ldO1xuICAgICAgICB9XG4gICAgICAgIHN0YXJ0ID0gcmFkaXVzIC0geSA+IDAgPyByYWRpdXMgLSB5IDogMDtcbiAgICAgICAgZW5kID0gZW5kWSAtIHkgPCBuID8gZW5kWSAtIHkgOiBuOyAvLyBNYXRoLm1pbigoKChoIC0gMSkgLSB5KSArIHJhZGl1cykgKyAxLCBuKTtcbiAgICAgICAgazEgPSBrIC0gcmFkaXVzICogdztcbiAgICAgICAgLy8gd2FsayB0aHJvdWdoIHktbmVpZ2hib3JzXG4gICAgICAgIGZvciAoaSA9IHN0YXJ0OyBpIDwgZW5kOyBpKyspIHtcbiAgICAgICAgICB2YWwgKz0gZGF0YVtrMSArIGkgKiB3XSAqIHdnW2ldO1xuICAgICAgICB9XG4gICAgICAgIGlmICh2YWwgPiAwLjUpIHtcbiAgICAgICAgICByZXN1bHRba10gPSAxO1xuICAgICAgICAgIGNvdW50Kys7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVzdWx0W2tdID0gMDtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIGNvdW50OiBjb3VudCxcbiAgICAgIGRhdGE6IHJlc3VsdCxcbiAgICAgIHdpZHRoOiB3LFxuICAgICAgaGVpZ2h0OiBoLFxuICAgICAgYm91bmRzOiB7XG4gICAgICAgIG1pblg6IG1pblgsXG4gICAgICAgIG1pblk6IG1pblksXG4gICAgICAgIG1heFg6IG1heFgsXG4gICAgICAgIG1heFk6IG1heFlcbiAgICAgIH1cbiAgICB9O1xuICB9O1xuXG4gIC8qKiBDcmVhdGUgYSBib3JkZXIgaW5kZXggYXJyYXkgb2YgYm91bmRhcnkgcG9pbnRzIG9mIHRoZSBtYXNrIHdpdGggcmFkaXVzLW5laWdoYm9yc1xuICAgKiBAcGFyYW0ge09iamVjdH0gbWFzazoge1VpbnQ4QXJyYXl9IGRhdGEsIHtpbnR9IHdpZHRoLCB7aW50fSBoZWlnaHQsIHtPYmplY3R9IGJvdW5kc1xuICAgKiBAcGFyYW0ge2ludH0gcmFkaXVzOiBibHVyIHJhZGl1c1xuICAgKiBAcGFyYW0ge1VpbnQ4QXJyYXl9IHZpc2l0ZWQ6IG1hc2sgb2YgdmlzaXRlZCBwb2ludHMgKG9wdGlvbmFsKVxuICAgKiBAcmV0dXJuIHtBcnJheX0gYm9yZGVyIGluZGV4IGFycmF5IG9mIGJvdW5kYXJ5IHBvaW50cyB3aXRoIHJhZGl1cy1uZWlnaGJvcnMgKG9ubHkgcG9pbnRzIG5lZWQgZm9yIGJsdXIpXG4gICAqL1xuICBmdW5jdGlvbiBjcmVhdGVCb3JkZXJGb3JCbHVyKG1hc2ssIHJhZGl1cywgdmlzaXRlZCkge1xuXG4gICAgdmFyIHgsIGksIGosIHksIGssIGsxLCBrMixcbiAgICAgIHcgPSBtYXNrLndpZHRoLFxuICAgICAgaCA9IG1hc2suaGVpZ2h0LFxuICAgICAgZGF0YSA9IG1hc2suZGF0YSxcbiAgICAgIHZpc2l0ZWREYXRhID0gbmV3IFVpbnQ4QXJyYXkoZGF0YSksXG4gICAgICBtaW5YID0gbWFzay5ib3VuZHMubWluWCxcbiAgICAgIG1heFggPSBtYXNrLmJvdW5kcy5tYXhYLFxuICAgICAgbWluWSA9IG1hc2suYm91bmRzLm1pblksXG4gICAgICBtYXhZID0gbWFzay5ib3VuZHMubWF4WSxcbiAgICAgIGxlbiA9IHcgKiBoLFxuICAgICAgdGVtcCA9IG5ldyBVaW50OEFycmF5KGxlbiksIC8vIGF1eGlsaWFyeSBhcnJheSB0byBjaGVjayB1bmlxdWVuZXNzXG4gICAgICBib3JkZXIgPSBbXSwgLy8gb25seSBib3JkZXIgcG9pbnRzXG4gICAgICB4MCA9IE1hdGgubWF4KG1pblgsIDEpLFxuICAgICAgeDEgPSBNYXRoLm1pbihtYXhYLCB3IC0gMiksXG4gICAgICB5MCA9IE1hdGgubWF4KG1pblksIDEpLFxuICAgICAgeTEgPSBNYXRoLm1pbihtYXhZLCBoIC0gMik7XG5cbiAgICBpZiAodmlzaXRlZCAmJiB2aXNpdGVkLmxlbmd0aCA+IDApIHtcbiAgICAgIC8vIGNvcHkgdmlzaXRlZCBwb2ludHMgKG9ubHkgXCJibGFja1wiKVxuICAgICAgZm9yIChrID0gMDsgayA8IGxlbjsgaysrKSB7XG4gICAgICAgIGlmICh2aXNpdGVkW2tdID09PSAxKSB2aXNpdGVkRGF0YVtrXSA9IDE7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gd2FsayB0aHJvdWdoIGlubmVyIHZhbHVlcyBleGNlcHQgcG9pbnRzIG9uIHRoZSBib3VuZGFyeSBvZiB0aGUgaW1hZ2VcbiAgICBmb3IgKHkgPSB5MDsgeSA8IHkxICsgMTsgeSsrKVxuICAgICAgZm9yICh4ID0geDA7IHggPCB4MSArIDE7IHgrKykge1xuICAgICAgICBrID0geSAqIHcgKyB4O1xuICAgICAgICBpZiAoZGF0YVtrXSA9PT0gMCkgY29udGludWU7IC8vIFwid2hpdGVcIiBwb2ludCBpc24ndCB0aGUgYm9yZGVyXG4gICAgICAgIGsxID0gayArIHc7IC8vIHkgKyAxXG4gICAgICAgIGsyID0gayAtIHc7IC8vIHkgLSAxXG4gICAgICAgIC8vIGNoZWNrIGlmIGFueSBuZWlnaGJvciB3aXRoIGEgXCJ3aGl0ZVwiIGNvbG9yXG4gICAgICAgIGlmICh2aXNpdGVkRGF0YVtrICsgMV0gPT09IDAgfHwgdmlzaXRlZERhdGFbayAtIDFdID09PSAwIHx8XG4gICAgICAgICAgdmlzaXRlZERhdGFbazFdID09PSAwIHx8IHZpc2l0ZWREYXRhW2sxICsgMV0gPT09IDAgfHwgdmlzaXRlZERhdGFbazEgLSAxXSA9PT0gMCB8fFxuICAgICAgICAgIHZpc2l0ZWREYXRhW2syXSA9PT0gMCB8fCB2aXNpdGVkRGF0YVtrMiArIDFdID09PSAwIHx8IHZpc2l0ZWREYXRhW2syIC0gMV0gPT09IDApIHtcbiAgICAgICAgICAvL2lmICh2aXNpdGVkRGF0YVtrICsgMV0gKyB2aXNpdGVkRGF0YVtrIC0gMV0gK1xuICAgICAgICAgIC8vICAgIHZpc2l0ZWREYXRhW2sxXSArIHZpc2l0ZWREYXRhW2sxICsgMV0gKyB2aXNpdGVkRGF0YVtrMSAtIDFdICtcbiAgICAgICAgICAvLyAgICB2aXNpdGVkRGF0YVtrMl0gKyB2aXNpdGVkRGF0YVtrMiArIDFdICsgdmlzaXRlZERhdGFbazIgLSAxXSA9PSA4KSBjb250aW51ZTtcbiAgICAgICAgICBib3JkZXIucHVzaChrKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgLy8gd2FsayB0aHJvdWdoIHBvaW50cyBvbiB0aGUgYm91bmRhcnkgb2YgdGhlIGltYWdlIGlmIG5lY2Vzc2FyeVxuICAgIC8vIGlmIHRoZSBcImJsYWNrXCIgcG9pbnQgaXMgYWRqYWNlbnQgdG8gdGhlIGJvdW5kYXJ5IG9mIHRoZSBpbWFnZSwgaXQgaXMgYSBib3JkZXIgcG9pbnRcbiAgICBpZiAobWluWCA9PSAwKVxuICAgICAgZm9yICh5ID0gbWluWTsgeSA8IG1heFkgKyAxOyB5KyspXG4gICAgICAgIGlmIChkYXRhW3kgKiB3XSA9PT0gMSlcbiAgICAgICAgICBib3JkZXIucHVzaCh5ICogdyk7XG5cbiAgICBpZiAobWF4WCA9PSB3IC0gMSlcbiAgICAgIGZvciAoeSA9IG1pblk7IHkgPCBtYXhZICsgMTsgeSsrKVxuICAgICAgICBpZiAoZGF0YVt5ICogdyArIG1heFhdID09PSAxKVxuICAgICAgICAgIGJvcmRlci5wdXNoKHkgKiB3ICsgbWF4WCk7XG5cbiAgICBpZiAobWluWSA9PSAwKVxuICAgICAgZm9yICh4ID0gbWluWDsgeCA8IG1heFggKyAxOyB4KyspXG4gICAgICAgIGlmIChkYXRhW3hdID09PSAxKVxuICAgICAgICAgIGJvcmRlci5wdXNoKHgpO1xuXG4gICAgaWYgKG1heFkgPT0gaCAtIDEpXG4gICAgICBmb3IgKHggPSBtaW5YOyB4IDwgbWF4WCArIDE7IHgrKylcbiAgICAgICAgaWYgKGRhdGFbbWF4WSAqIHcgKyB4XSA9PT0gMSlcbiAgICAgICAgICBib3JkZXIucHVzaChtYXhZICogdyArIHgpO1xuXG4gICAgdmFyIHJlc3VsdCA9IFtdLCAvLyBib3JkZXIgcG9pbnRzIHdpdGggcmFkaXVzLW5laWdoYm9yc1xuICAgICAgc3RhcnQsIGVuZCxcbiAgICAgIGVuZFggPSByYWRpdXMgKyB3LFxuICAgICAgZW5kWSA9IHJhZGl1cyArIGgsXG4gICAgICBuID0gcmFkaXVzICogMiArIDE7IC8vIHNpemUgb2YgdGhlIHBhdHRlcm4gZm9yIHJhZGl1cy1uZWlnaGJvcnMgKGZyb20gLXIgdG8gK3Igd2l0aCB0aGUgY2VudGVyIHBvaW50KVxuXG4gICAgbGVuID0gYm9yZGVyLmxlbmd0aDtcbiAgICAvLyB3YWxrIHRocm91Z2ggcmFkaXVzLW5laWdoYm9ycyBvZiBib3JkZXIgcG9pbnRzIGFuZCBhZGQgdGhlbSB0byB0aGUgcmVzdWx0IGFycmF5XG4gICAgZm9yIChqID0gMDsgaiA8IGxlbjsgaisrKSB7XG4gICAgICBrID0gYm9yZGVyW2pdOyAvLyBpbmRleCBvZiB0aGUgYm9yZGVyIHBvaW50XG4gICAgICB0ZW1wW2tdID0gMTsgLy8gbWFyayBib3JkZXIgcG9pbnRcbiAgICAgIHJlc3VsdC5wdXNoKGspOyAvLyBzYXZlIHRoZSBib3JkZXIgcG9pbnRcbiAgICAgIHggPSBrICUgdzsgLy8gY2FsYyB4IGJ5IGluZGV4XG4gICAgICB5ID0gKGsgLSB4KSAvIHc7IC8vIGNhbGMgeSBieSBpbmRleFxuICAgICAgc3RhcnQgPSByYWRpdXMgLSB4ID4gMCA/IHJhZGl1cyAtIHggOiAwO1xuICAgICAgZW5kID0gZW5kWCAtIHggPCBuID8gZW5kWCAtIHggOiBuOyAvLyBNYXRoLm1pbigoKCh3IC0gMSkgLSB4KSArIHJhZGl1cykgKyAxLCBuKTtcbiAgICAgIGsxID0gayAtIHJhZGl1cztcbiAgICAgIC8vIHdhbGsgdGhyb3VnaCB4LW5laWdoYm9yc1xuICAgICAgZm9yIChpID0gc3RhcnQ7IGkgPCBlbmQ7IGkrKykge1xuICAgICAgICBrMiA9IGsxICsgaTtcbiAgICAgICAgaWYgKHRlbXBbazJdID09PSAwKSB7IC8vIGNoZWNrIHRoZSB1bmlxdWVuZXNzXG4gICAgICAgICAgdGVtcFtrMl0gPSAxO1xuICAgICAgICAgIHJlc3VsdC5wdXNoKGsyKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgc3RhcnQgPSByYWRpdXMgLSB5ID4gMCA/IHJhZGl1cyAtIHkgOiAwO1xuICAgICAgZW5kID0gZW5kWSAtIHkgPCBuID8gZW5kWSAtIHkgOiBuOyAvLyBNYXRoLm1pbigoKChoIC0gMSkgLSB5KSArIHJhZGl1cykgKyAxLCBuKTtcbiAgICAgIGsxID0gayAtIHJhZGl1cyAqIHc7XG4gICAgICAvLyB3YWxrIHRocm91Z2ggeS1uZWlnaGJvcnNcbiAgICAgIGZvciAoaSA9IHN0YXJ0OyBpIDwgZW5kOyBpKyspIHtcbiAgICAgICAgazIgPSBrMSArIGkgKiB3O1xuICAgICAgICBpZiAodGVtcFtrMl0gPT09IDApIHsgLy8gY2hlY2sgdGhlIHVuaXF1ZW5lc3NcbiAgICAgICAgICB0ZW1wW2syXSA9IDE7XG4gICAgICAgICAgcmVzdWx0LnB1c2goazIpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcblxuICAvKiogQXBwbHkgdGhlIGdhdXNzLWJsdXIgZmlsdGVyIE9OTFkgdG8gYm9yZGVyIHBvaW50cyB3aXRoIHJhZGl1cy1uZWlnaGJvcnNcbiAgICogQWxnb3JpdGhtczogaHR0cDovL2Jsb2cuaXZhbmsubmV0L2Zhc3Rlc3QtZ2F1c3NpYW4tYmx1ci5odG1sXG4gICAqIGh0dHA6Ly93d3cubGlicm93LmNvbS9hcnRpY2xlcy9hcnRpY2xlLTlcbiAgICogaHR0cDovL2VseW54c2RrLmZyZWUuZnIvZXh0LWRvY3MvQmx1ci9GYXN0X2JveF9ibHVyLnBkZlxuICAgKiBAcGFyYW0gIHtPYmplY3R9ICAgICBtYXNrOiAgICAge1VpbnQ4QXJyYXl9IGRhdGEsIHtpbnR9IHdpZHRoLCB7aW50fSBoZWlnaHQsIHtPYmplY3R9IGJvdW5kc1xuICAgKiBAcGFyYW0gIHtpbnR9ICAgICAgICByYWRpdXM6ICAgYmx1ciByYWRpdXNcbiAgICogQHBhcmFtICB7VWludDhBcnJheX0gdmlzaXRlZDogIG1hc2sgb2YgdmlzaXRlZCBwb2ludHMgKG9wdGlvbmFsKVxuICAgKiBAcmV0dXJuIHtPYmplY3R9ICAgICBtYXNrOiAgICAge1VpbnQ4QXJyYXl9IGRhdGEsIHtpbnR9IHdpZHRoLCB7aW50fSBoZWlnaHQsIHtPYmplY3R9IGJvdW5kc1xuICAgKi9cbiAgbGliLmdhdXNzQmx1ck9ubHlCb3JkZXIgPSBmdW5jdGlvbiAobWFzaywgcmFkaXVzLCB2aXNpdGVkKSB7XG5cbiAgICB2YXIgYm9yZGVyID0gY3JlYXRlQm9yZGVyRm9yQmx1cihtYXNrLCByYWRpdXMsIHZpc2l0ZWQpLCAvLyBnZXQgYm9yZGVyIHBvaW50cyB3aXRoIHJhZGl1cy1uZWlnaGJvcnNcbiAgICAgIHd3LCBkc3EsIGksIGosIGssIGsxLCB4LCB5LCB2YWwsIHN0YXJ0LCBlbmQsXG4gICAgICBuID0gcmFkaXVzICogMiArIDEsIC8vIHNpemUgb2YgdGhlIHBhdHRlcm4gZm9yIHJhZGl1cy1uZWlnaGJvcnMgKGZyb20gLXIgdG8gK3Igd2l0aCBjZW50ZXIgcG9pbnQpXG4gICAgICBzMiA9IDIgKiByYWRpdXMgKiByYWRpdXMsXG4gICAgICB3ZyA9IG5ldyBGbG9hdDMyQXJyYXkobiksIC8vIHdlaWdodHNcbiAgICAgIHRvdGFsID0gMCwgLy8gc3VtIG9mIHdlaWdodHModXNlZCBmb3Igbm9ybWFsaXphdGlvbilcbiAgICAgIHcgPSBtYXNrLndpZHRoLFxuICAgICAgaCA9IG1hc2suaGVpZ2h0LFxuICAgICAgZGF0YSA9IG1hc2suZGF0YSxcbiAgICAgIG1pblggPSBtYXNrLmJvdW5kcy5taW5YLFxuICAgICAgbWF4WCA9IG1hc2suYm91bmRzLm1heFgsXG4gICAgICBtaW5ZID0gbWFzay5ib3VuZHMubWluWSxcbiAgICAgIG1heFkgPSBtYXNrLmJvdW5kcy5tYXhZLFxuICAgICAgbGVuID0gYm9yZGVyLmxlbmd0aDtcblxuICAgIC8vIGNhbGMgZ2F1c3Mgd2VpZ2h0c1xuICAgIGZvciAoaSA9IDA7IGkgPCByYWRpdXM7IGkrKykge1xuICAgICAgZHNxID0gKHJhZGl1cyAtIGkpICogKHJhZGl1cyAtIGkpO1xuICAgICAgd3cgPSBNYXRoLmV4cCgtZHNxIC8gczIpIC8gTWF0aC5QSTtcbiAgICAgIHdnW3JhZGl1cyArIGldID0gd2dbcmFkaXVzIC0gaV0gPSB3dztcbiAgICAgIHRvdGFsICs9IDIgKiB3dztcbiAgICB9XG4gICAgLy8gbm9ybWFsaXphdGlvbiB3ZWlnaHRzXG4gICAgZm9yIChpID0gMDsgaSA8IG47IGkrKykge1xuICAgICAgd2dbaV0gLz0gdG90YWw7XG4gICAgfVxuXG4gICAgdmFyIHJlc3VsdCA9IG5ldyBTZWxlY3Rpb25NYXNrKHcsaCxkYXRhKSwgLy8gY29weSB0aGUgc291cmNlIG1hc2tcbiAgICAgIGVuZFggPSByYWRpdXMgKyB3LFxuICAgICAgZW5kWSA9IHJhZGl1cyArIGg7XG5cbiAgICAvL3dhbGsgdGhyb3VnaCBhbGwgYm9yZGVyIHBvaW50cyBmb3IgYmx1clxuICAgIGZvciAoaSA9IDA7IGkgPCBsZW47IGkrKykge1xuICAgICAgayA9IGJvcmRlcltpXTsgLy8gaW5kZXggb2YgdGhlIGJvcmRlciBwb2ludFxuICAgICAgdmFsID0gMDtcbiAgICAgIHggPSBrICUgdzsgLy8gY2FsYyB4IGJ5IGluZGV4XG4gICAgICB5ID0gKGsgLSB4KSAvIHc7IC8vIGNhbGMgeSBieSBpbmRleFxuICAgICAgc3RhcnQgPSByYWRpdXMgLSB4ID4gMCA/IHJhZGl1cyAtIHggOiAwO1xuICAgICAgZW5kID0gZW5kWCAtIHggPCBuID8gZW5kWCAtIHggOiBuOyAvLyBNYXRoLm1pbigoKCh3IC0gMSkgLSB4KSArIHJhZGl1cykgKyAxLCBuKTtcbiAgICAgIGsxID0gayAtIHJhZGl1cztcbiAgICAgIC8vIHdhbGsgdGhyb3VnaCB4LW5laWdoYm9yc1xuICAgICAgZm9yIChqID0gc3RhcnQ7IGogPCBlbmQ7IGorKykge1xuICAgICAgICB2YWwgKz0gZGF0YVtrMSArIGpdICogd2dbal07XG4gICAgICB9XG4gICAgICBpZiAodmFsID4gMC41KSB7XG4gICAgICAgIHJlc3VsdC5kYXRhW2tdID0gMTtcbiAgICAgICAgcmVzdWx0LmNvdW50Kys7XG4gICAgICAgIC8vIGNoZWNrIG1pbm1heFxuICAgICAgICBpZiAoeCA8IG1pblgpIG1pblggPSB4O1xuICAgICAgICBpZiAoeCA+IG1heFgpIG1heFggPSB4O1xuICAgICAgICBpZiAoeSA8IG1pblkpIG1pblkgPSB5O1xuICAgICAgICBpZiAoeSA+IG1heFkpIG1heFkgPSB5O1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIHN0YXJ0ID0gcmFkaXVzIC0geSA+IDAgPyByYWRpdXMgLSB5IDogMDtcbiAgICAgIGVuZCA9IGVuZFkgLSB5IDwgbiA/IGVuZFkgLSB5IDogbjsgLy8gTWF0aC5taW4oKCgoaCAtIDEpIC0geSkgKyByYWRpdXMpICsgMSwgbik7XG4gICAgICBrMSA9IGsgLSByYWRpdXMgKiB3O1xuICAgICAgLy8gd2FsayB0aHJvdWdoIHktbmVpZ2hib3JzXG4gICAgICBmb3IgKGogPSBzdGFydDsgaiA8IGVuZDsgaisrKSB7XG4gICAgICAgIHZhbCArPSBkYXRhW2sxICsgaiAqIHddICogd2dbal07XG4gICAgICB9XG4gICAgICBpZiAodmFsID4gMC41KSB7XG4gICAgICAgIHJlc3VsdC5kYXRhW2tdID0gMTtcbiAgICAgICAgcmVzdWx0LmNvdW50Kys7XG4gICAgICAgIC8vIGNoZWNrIG1pbm1heFxuICAgICAgICBpZiAoeCA8IG1pblgpIG1pblggPSB4O1xuICAgICAgICBpZiAoeCA+IG1heFgpIG1heFggPSB4O1xuICAgICAgICBpZiAoeSA8IG1pblkpIG1pblkgPSB5O1xuICAgICAgICBpZiAoeSA+IG1heFkpIG1heFkgPSB5O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVzdWx0LmRhdGFba10gPSAwO1xuICAgICAgfVxuICAgIH1cbiAgICByZXN1bHQuYm91bmRzID0ge1xuICAgICAgbWluWDogbWluWCxcbiAgICAgIG1pblk6IG1pblksXG4gICAgICBtYXhYOiBtYXhYLFxuICAgICAgbWF4WTogbWF4WVxuICAgIH07XG5cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuXG4gIC8qKiBDcmVhdGUgYSBib3JkZXIgbWFzayAob25seSBib3VuZGFyeSBwb2ludHMpXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBtYXNrOiB7VWludDhBcnJheX0gZGF0YSwge2ludH0gd2lkdGgsIHtpbnR9IGhlaWdodCwge09iamVjdH0gYm91bmRzXG4gICAqIEByZXR1cm4ge09iamVjdH0gYm9yZGVyIG1hc2s6IHtVaW50OEFycmF5fSBkYXRhLCB7aW50fSB3aWR0aCwge2ludH0gaGVpZ2h0LCB7T2JqZWN0fSBvZmZzZXRcbiAgICovXG4gIGxpYi5jcmVhdGVCb3JkZXJNYXNrID0gZnVuY3Rpb24gKG1hc2spIHtcblxuICAgIHZhciB4LCB5LCBrLCBrMSwgazIsXG4gICAgICB3ID0gbWFzay53aWR0aCxcbiAgICAgIGggPSBtYXNrLmhlaWdodCxcbiAgICAgIGRhdGEgPSBtYXNrLmRhdGEsXG4gICAgICBtaW5YID0gbWFzay5ib3VuZHMubWluWCxcbiAgICAgIG1heFggPSBtYXNrLmJvdW5kcy5tYXhYLFxuICAgICAgbWluWSA9IG1hc2suYm91bmRzLm1pblksXG4gICAgICBtYXhZID0gbWFzay5ib3VuZHMubWF4WSxcbiAgICAgIHJ3ID0gbWF4WCAtIG1pblggKyAxLCAvLyBib3VuZHMgc2l6ZVxuICAgICAgcmggPSBtYXhZIC0gbWluWSArIDEsXG4gICAgICByZXN1bHQgPSBuZXcgVWludDhBcnJheShydyAqIHJoKSwgLy8gcmVkdWNlZCBtYXNrIChib3VuZHMgc2l6ZSlcbiAgICAgIHgwID0gTWF0aC5tYXgobWluWCwgMSksXG4gICAgICB4MSA9IE1hdGgubWluKG1heFgsIHcgLSAyKSxcbiAgICAgIHkwID0gTWF0aC5tYXgobWluWSwgMSksXG4gICAgICB5MSA9IE1hdGgubWluKG1heFksIGggLSAyKSxcbiAgICAgIGNvdW50ID0gMDtcblxuICAgIC8vIHdhbGsgdGhyb3VnaCBpbm5lciB2YWx1ZXMgZXhjZXB0IHBvaW50cyBvbiB0aGUgYm91bmRhcnkgb2YgdGhlIGltYWdlXG4gICAgZm9yICh5ID0geTA7IHkgPCB5MSArIDE7IHkrKylcbiAgICAgIGZvciAoeCA9IHgwOyB4IDwgeDEgKyAxOyB4KyspIHtcbiAgICAgICAgayA9IHkgKiB3ICsgeDtcbiAgICAgICAgaWYgKGRhdGFba10gPT09IDApIGNvbnRpbnVlOyAvLyBcIndoaXRlXCIgcG9pbnQgaXNuJ3QgdGhlIGJvcmRlclxuICAgICAgICBrMSA9IGsgKyB3OyAvLyB5ICsgMVxuICAgICAgICBrMiA9IGsgLSB3OyAvLyB5IC0gMVxuICAgICAgICAvLyBjaGVjayBpZiBhbnkgbmVpZ2hib3Igd2l0aCBhIFwid2hpdGVcIiBjb2xvclxuICAgICAgICBpZiAoZGF0YVtrICsgMV0gPT09IDAgfHwgZGF0YVtrIC0gMV0gPT09IDAgfHxcbiAgICAgICAgICBkYXRhW2sxXSA9PT0gMCB8fCBkYXRhW2sxICsgMV0gPT09IDAgfHwgZGF0YVtrMSAtIDFdID09PSAwIHx8XG4gICAgICAgICAgZGF0YVtrMl0gPT09IDAgfHwgZGF0YVtrMiArIDFdID09PSAwIHx8IGRhdGFbazIgLSAxXSA9PT0gMCkge1xuICAgICAgICAgIC8vaWYgKGRhdGFbayArIDFdICsgZGF0YVtrIC0gMV0gK1xuICAgICAgICAgIC8vICAgIGRhdGFbazFdICsgZGF0YVtrMSArIDFdICsgZGF0YVtrMSAtIDFdICtcbiAgICAgICAgICAvLyAgICBkYXRhW2syXSArIGRhdGFbazIgKyAxXSArIGRhdGFbazIgLSAxXSA9PSA4KSBjb250aW51ZTtcbiAgICAgICAgICByZXN1bHRbKHkgLSBtaW5ZKSAqIHJ3ICsgKHggLSBtaW5YKV0gPSAxO1xuICAgICAgICAgIGNvdW50Kys7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgIC8vIHdhbGsgdGhyb3VnaCBwb2ludHMgb24gdGhlIGJvdW5kYXJ5IG9mIHRoZSBpbWFnZSBpZiBuZWNlc3NhcnlcbiAgICAvLyBpZiB0aGUgXCJibGFja1wiIHBvaW50IGlzIGFkamFjZW50IHRvIHRoZSBib3VuZGFyeSBvZiB0aGUgaW1hZ2UsIGl0IGlzIGEgYm9yZGVyIHBvaW50XG4gICAgaWYgKG1pblggPT0gMClcbiAgICAgIGZvciAoeSA9IG1pblk7IHkgPCBtYXhZICsgMTsgeSsrKVxuICAgICAgICBpZiAoZGF0YVt5ICogd10gPT09IDEpIHtcbiAgICAgICAgICByZXN1bHRbKHkgLSBtaW5ZKSAqIHJ3XSA9IDE7XG4gICAgICAgICAgY291bnQrKztcbiAgICAgICAgfVxuXG4gICAgaWYgKG1heFggPT0gdyAtIDEpXG4gICAgICBmb3IgKHkgPSBtaW5ZOyB5IDwgbWF4WSArIDE7IHkrKylcbiAgICAgICAgaWYgKGRhdGFbeSAqIHcgKyBtYXhYXSA9PT0gMSkge1xuICAgICAgICAgIHJlc3VsdFsoeSAtIG1pblkpICogcncgKyAobWF4WCAtIG1pblgpXSA9IDE7XG4gICAgICAgICAgY291bnQrKztcbiAgICAgICAgfVxuXG4gICAgaWYgKG1pblkgPT0gMClcbiAgICAgIGZvciAoeCA9IG1pblg7IHggPCBtYXhYICsgMTsgeCsrKVxuICAgICAgICBpZiAoZGF0YVt4XSA9PT0gMSkge1xuICAgICAgICAgIHJlc3VsdFt4IC0gbWluWF0gPSAxO1xuICAgICAgICAgIGNvdW50Kys7XG4gICAgICAgIH1cblxuICAgIGlmIChtYXhZID09IGggLSAxKVxuICAgICAgZm9yICh4ID0gbWluWDsgeCA8IG1heFggKyAxOyB4KyspXG4gICAgICAgIGlmIChkYXRhW21heFkgKiB3ICsgeF0gPT09IDEpIHtcbiAgICAgICAgICByZXN1bHRbKG1heFkgLSBtaW5ZKSAqIHJ3ICsgKHggLSBtaW5YKV0gPSAxO1xuICAgICAgICAgIGNvdW50Kys7XG4gICAgICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICBjb3VudDogY291bnQsXG4gICAgICBkYXRhOiByZXN1bHQsXG4gICAgICB3aWR0aDogcncsXG4gICAgICBoZWlnaHQ6IHJoLFxuICAgICAgb2Zmc2V0OiB7eDogbWluWCwgeTogbWluWX1cbiAgICB9O1xuICB9O1xuXG4gIC8qKiBDcmVhdGUgYSBib3JkZXIgaW5kZXggYXJyYXkgb2YgYm91bmRhcnkgcG9pbnRzIG9mIHRoZSBtYXNrXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBtYXNrOiB7VWludDhBcnJheX0gZGF0YSwge2ludH0gd2lkdGgsIHtpbnR9IGhlaWdodFxuICAgKiBAcmV0dXJuIHtBcnJheX0gYm9yZGVyIGluZGV4IGFycmF5IGJvdW5kYXJ5IHBvaW50cyBvZiB0aGUgbWFza1xuICAgKi9cbiAgbGliLmdldEJvcmRlckluZGljZXMgPSBmdW5jdGlvbiAobWFzaykge1xuXG4gICAgdmFyIHgsIHksIGssIGsxLCBrMixcbiAgICAgIHcgPSBtYXNrLndpZHRoLFxuICAgICAgaCA9IG1hc2suaGVpZ2h0LFxuICAgICAgZGF0YSA9IG1hc2suZGF0YSxcbiAgICAgIGJvcmRlciA9IFtdLCAvLyBvbmx5IGJvcmRlciBwb2ludHNcbiAgICAgIHgxID0gdyAtIDEsXG4gICAgICB5MSA9IGggLSAxO1xuXG4gICAgLy8gd2FsayB0aHJvdWdoIGlubmVyIHZhbHVlcyBleGNlcHQgcG9pbnRzIG9uIHRoZSBib3VuZGFyeSBvZiB0aGUgaW1hZ2VcbiAgICBmb3IgKHkgPSAxOyB5IDwgeTE7IHkrKylcbiAgICAgIGZvciAoeCA9IDE7IHggPCB4MTsgeCsrKSB7XG4gICAgICAgIGsgPSB5ICogdyArIHg7XG4gICAgICAgIGlmIChkYXRhW2tdID09PSAwKSBjb250aW51ZTsgLy8gXCJ3aGl0ZVwiIHBvaW50IGlzbid0IHRoZSBib3JkZXJcbiAgICAgICAgazEgPSBrICsgdzsgLy8geSArIDFcbiAgICAgICAgazIgPSBrIC0gdzsgLy8geSAtIDFcbiAgICAgICAgLy8gY2hlY2sgaWYgYW55IG5laWdoYm9yIHdpdGggYSBcIndoaXRlXCIgY29sb3JcbiAgICAgICAgaWYgKGRhdGFbayArIDFdID09PSAwIHx8IGRhdGFbayAtIDFdID09PSAwIHx8XG4gICAgICAgICAgZGF0YVtrMV0gPT09IDAgfHwgZGF0YVtrMSArIDFdID09PSAwIHx8IGRhdGFbazEgLSAxXSA9PT0gMCB8fFxuICAgICAgICAgIGRhdGFbazJdID09PSAwIHx8IGRhdGFbazIgKyAxXSA9PT0gMCB8fCBkYXRhW2syIC0gMV0gPT09IDApIHtcbiAgICAgICAgICAvL2lmIChkYXRhW2sgKyAxXSArIGRhdGFbayAtIDFdICtcbiAgICAgICAgICAvLyAgICBkYXRhW2sxXSArIGRhdGFbazEgKyAxXSArIGRhdGFbazEgLSAxXSArXG4gICAgICAgICAgLy8gICAgZGF0YVtrMl0gKyBkYXRhW2syICsgMV0gKyBkYXRhW2syIC0gMV0gPT0gOCkgY29udGludWU7XG4gICAgICAgICAgYm9yZGVyLnB1c2goayk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgIC8vIHdhbGsgdGhyb3VnaCBwb2ludHMgb24gdGhlIGJvdW5kYXJ5IG9mIHRoZSBpbWFnZSBpZiBuZWNlc3NhcnlcbiAgICAvLyBpZiB0aGUgXCJibGFja1wiIHBvaW50IGlzIGFkamFjZW50IHRvIHRoZSBib3VuZGFyeSBvZiB0aGUgaW1hZ2UsIGl0IGlzIGEgYm9yZGVyIHBvaW50XG4gICAgZm9yICh5ID0gMDsgeSA8IGg7IHkrKylcbiAgICAgIGlmIChkYXRhW3kgKiB3XSA9PT0gMSlcbiAgICAgICAgYm9yZGVyLnB1c2goeSAqIHcpO1xuXG4gICAgZm9yICh4ID0gMDsgeCA8IHc7IHgrKylcbiAgICAgIGlmIChkYXRhW3hdID09PSAxKVxuICAgICAgICBib3JkZXIucHVzaCh4KTtcblxuICAgIGsgPSB3IC0gMTtcbiAgICBmb3IgKHkgPSAwOyB5IDwgaDsgeSsrKVxuICAgICAgaWYgKGRhdGFbeSAqIHcgKyBrXSA9PT0gMSlcbiAgICAgICAgYm9yZGVyLnB1c2goeSAqIHcgKyBrKTtcblxuICAgIGsgPSAoaCAtIDEpICogdztcbiAgICBmb3IgKHggPSAwOyB4IDwgdzsgeCsrKVxuICAgICAgaWYgKGRhdGFbayArIHhdID09PSAxKVxuICAgICAgICBib3JkZXIucHVzaChrICsgeCk7XG5cbiAgICByZXR1cm4gYm9yZGVyO1xuICB9O1xuXG4gIC8qKiBDcmVhdGUgYSBjb21wcmVzc2VkIG1hc2sgd2l0aCBhIFwid2hpdGVcIiBib3JkZXIgKDFweCBib3JkZXIgd2l0aCB6ZXJvIHZhbHVlcykgZm9yIHRoZSBjb250b3VyIHRyYWNpbmdcbiAgICogQHBhcmFtIHtPYmplY3R9IG1hc2s6IHtVaW50OEFycmF5fSBkYXRhLCB7aW50fSB3aWR0aCwge2ludH0gaGVpZ2h0LCB7T2JqZWN0fSBib3VuZHNcbiAgICogQHJldHVybiB7T2JqZWN0fSBib3JkZXIgbWFzazoge1VpbnQ4QXJyYXl9IGRhdGEsIHtpbnR9IHdpZHRoLCB7aW50fSBoZWlnaHQsIHtPYmplY3R9IG9mZnNldFxuICAgKi9cbiAgZnVuY3Rpb24gcHJlcGFyZU1hc2sobWFzaykge1xuICAgIHZhciB4LCB5LFxuICAgICAgdyA9IG1hc2sud2lkdGgsXG4gICAgICBkYXRhID0gbWFzay5kYXRhLFxuICAgICAgbWluWCA9IG1hc2suYm91bmRzLm1pblgsXG4gICAgICBtYXhYID0gbWFzay5ib3VuZHMubWF4WCxcbiAgICAgIG1pblkgPSBtYXNrLmJvdW5kcy5taW5ZLFxuICAgICAgbWF4WSA9IG1hc2suYm91bmRzLm1heFksXG4gICAgICBydyA9IG1heFggLSBtaW5YICsgMywgLy8gYm91bmRzIHNpemUgKzEgcHggb24gZWFjaCBzaWRlIChhIFwid2hpdGVcIiBib3JkZXIpXG4gICAgICByaCA9IG1heFkgLSBtaW5ZICsgMyxcbiAgICAgIHJlc3VsdCA9IG5ldyBVaW50OEFycmF5KHJ3ICogcmgpOyAvLyByZWR1Y2VkIG1hc2sgKGJvdW5kcyBzaXplKVxuXG4gICAgLy8gd2FsayB0aHJvdWdoIGlubmVyIHZhbHVlcyBhbmQgY29weSBvbmx5IFwiYmxhY2tcIiBwb2ludHMgdG8gdGhlIHJlc3VsdCBtYXNrXG4gICAgZm9yICh5ID0gbWluWTsgeSA8IG1heFkgKyAxOyB5KyspXG4gICAgICBmb3IgKHggPSBtaW5YOyB4IDwgbWF4WCArIDE7IHgrKykge1xuICAgICAgICBpZiAoZGF0YVt5ICogdyArIHhdID09PSAxKVxuICAgICAgICAgIHJlc3VsdFsoeSAtIG1pblkgKyAxKSAqIHJ3ICsgKHggLSBtaW5YICsgMSldID0gMTtcbiAgICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICBkYXRhOiByZXN1bHQsXG4gICAgICB3aWR0aDogcncsXG4gICAgICBoZWlnaHQ6IHJoLFxuICAgICAgb2Zmc2V0OiB7eDogbWluWCAtIDEsIHk6IG1pblkgLSAxfVxuICAgIH07XG4gIH07XG5cbiAgLyoqIENyZWF0ZSBhIGNvbnRvdXIgYXJyYXkgZm9yIHRoZSBiaW5hcnkgbWFza1xuICAgKiBBbGdvcml0aG06IGh0dHA6Ly93d3cuc2NpZW5jZWRpcmVjdC5jb20vc2NpZW5jZS9hcnRpY2xlL3BpaS9TMTA3NzMxNDIwMzAwMTQwMVxuICAgKiBAcGFyYW0ge09iamVjdH0gbWFzazoge1VpbnQ4QXJyYXl9IGRhdGEsIHtpbnR9IHdpZHRoLCB7aW50fSBoZWlnaHQsIHtPYmplY3R9IGJvdW5kc1xuICAgKiBAcmV0dXJuIHtBcnJheX0gY29udG91cnM6IHtBcnJheX0gcG9pbnRzLCB7Ym9vbH0gaW5uZXIsIHtpbnR9IGxhYmVsXG4gICAqL1xuICBsaWIudHJhY2VDb250b3VycyA9IGZ1bmN0aW9uIChtYXNrKSB7XG4gICAgdmFyIG0gPSBwcmVwYXJlTWFzayhtYXNrKSxcbiAgICAgIGNvbnRvdXJzID0gW10sXG4gICAgICBsYWJlbCA9IDAsXG4gICAgICB3ID0gbS53aWR0aCxcbiAgICAgIHcyID0gdyAqIDIsXG4gICAgICBoID0gbS5oZWlnaHQsXG4gICAgICBzcmMgPSBtLmRhdGEsXG4gICAgICBkeCA9IG0ub2Zmc2V0LngsXG4gICAgICBkeSA9IG0ub2Zmc2V0LnksXG4gICAgICBib3VuZHMsX3AsXG4gICAgICBkZXN0ID0gbmV3IFVpbnQ4QXJyYXkoc3JjKSwgLy8gbGFiZWwgbWF0cml4XG4gICAgICBpLCBqLCB4LCB5LCBrLCBrMSwgYywgaW5uZXIsIGRpciwgZmlyc3QsIHNlY29uZCwgY3VycmVudCwgcHJldmlvdXMsIG5leHQsIGQ7XG5cbiAgICAvLyBhbGwgW2R4LGR5XSBwYWlycyAoYXJyYXkgaW5kZXggaXMgdGhlIGRpcmVjdGlvbilcbiAgICAvLyA1IDYgN1xuICAgIC8vIDQgWCAwXG4gICAgLy8gMyAyIDFcbiAgICB2YXIgZGlyZWN0aW9ucyA9IFtbMSwgMF0sIFsxLCAxXSwgWzAsIDFdLCBbLTEsIDFdLCBbLTEsIDBdLCBbLTEsIC0xXSwgWzAsIC0xXSwgWzEsIC0xXV07XG5cbiAgICBmb3IgKHkgPSAxOyB5IDwgaCAtIDE7IHkrKylcbiAgICAgIGZvciAoeCA9IDE7IHggPCB3IC0gMTsgeCsrKSB7XG4gICAgICAgIGsgPSB5ICogdyArIHg7XG4gICAgICAgIGlmIChzcmNba10gPT09IDEpIHtcbiAgICAgICAgICBmb3IgKGkgPSAtdzsgaSA8IHcyOyBpICs9IHcyKSB7IC8vIGsgLSB3OiBvdXRlciB0cmFjaW5nICh5IC0gMSksIGsgKyB3OiBpbm5lciB0cmFjaW5nICh5ICsgMSlcbiAgICAgICAgICAgIGlmIChzcmNbayArIGldID09PSAwICYmIGRlc3RbayArIGldID09PSAwKSB7IC8vIG5lZWQgY29udG91ciB0cmFjaW5nXG4gICAgICAgICAgICAgIGlubmVyID0gaSA9PT0gdzsgLy8gaXMgaW5uZXIgY29udG91ciB0cmFjaW5nID9cbiAgICAgICAgICAgICAgbGFiZWwrKzsgLy8gbGFiZWwgZm9yIHRoZSBuZXh0IGNvbnRvdXJcblxuICAgICAgICAgICAgICBjID0gW107XG4gICAgICAgICAgICAgIGJvdW5kcyA9IHtcbiAgICAgICAgICAgICAgICBtaW5YIDogdyxcbiAgICAgICAgICAgICAgICBtaW5ZIDogaCxcbiAgICAgICAgICAgICAgICBtYXhYIDogLTEsXG4gICAgICAgICAgICAgICAgbWF4WSA6IC0xLFxuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICBkaXIgPSBpbm5lciA/IDIgOiA2OyAvLyBzdGFydCBkaXJlY3Rpb25cbiAgICAgICAgICAgICAgY3VycmVudCA9IHByZXZpb3VzID0gZmlyc3QgPSB7eDogeCwgeTogeX07XG4gICAgICAgICAgICAgIHNlY29uZCA9IG51bGw7XG4gICAgICAgICAgICAgIHdoaWxlICh0cnVlKSB7XG4gICAgICAgICAgICAgICAgZGVzdFtjdXJyZW50LnkgKiB3ICsgY3VycmVudC54XSA9IGxhYmVsOyAvLyBtYXJrIGxhYmVsIGZvciB0aGUgY3VycmVudCBwb2ludFxuICAgICAgICAgICAgICAgIC8vIGJ5cGFzcyBhbGwgdGhlIG5laWdoYm9ycyBhcm91bmQgdGhlIGN1cnJlbnQgcG9pbnQgaW4gYSBjbG9ja3dpc2VcbiAgICAgICAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgODsgaisrKSB7XG4gICAgICAgICAgICAgICAgICBkaXIgPSAoZGlyICsgMSkgJSA4O1xuXG4gICAgICAgICAgICAgICAgICAvLyBnZXQgdGhlIG5leHQgcG9pbnQgYnkgbmV3IGRpcmVjdGlvblxuICAgICAgICAgICAgICAgICAgZCA9IGRpcmVjdGlvbnNbZGlyXTsgLy8gaW5kZXggYXMgZGlyZWN0aW9uXG4gICAgICAgICAgICAgICAgICBuZXh0ID0ge3g6IGN1cnJlbnQueCArIGRbMF0sIHk6IGN1cnJlbnQueSArIGRbMV19O1xuXG4gICAgICAgICAgICAgICAgICBrMSA9IG5leHQueSAqIHcgKyBuZXh0Lng7XG4gICAgICAgICAgICAgICAgICBpZiAoc3JjW2sxXSA9PT0gMSkgLy8gYmxhY2sgYm91bmRhcnkgcGl4ZWxcbiAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgZGVzdFtrMV0gPSBsYWJlbDsgLy8gbWFyayBhIGxhYmVsXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgZGVzdFtrMV0gPSAtMTsgLy8gbWFyayBhIHdoaXRlIGJvdW5kYXJ5IHBpeGVsXG4gICAgICAgICAgICAgICAgICBuZXh0ID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKG5leHQgPT09IG51bGwpIGJyZWFrOyAvLyBubyBuZWlnaGJvdXJzIChvbmUtcG9pbnQgY29udG91cilcbiAgICAgICAgICAgICAgICBjdXJyZW50ID0gbmV4dDtcbiAgICAgICAgICAgICAgICBpZiAoc2Vjb25kKSB7XG4gICAgICAgICAgICAgICAgICBpZiAocHJldmlvdXMueCA9PT0gZmlyc3QueCAmJiBwcmV2aW91cy55ID09PSBmaXJzdC55ICYmIGN1cnJlbnQueCA9PT0gc2Vjb25kLnggJiYgY3VycmVudC55ID09PSBzZWNvbmQueSkge1xuICAgICAgICAgICAgICAgICAgICBicmVhazsgLy8gY3JlYXRpbmcgdGhlIGNvbnRvdXIgY29tcGxldGVkIHdoZW4gcmV0dXJuZWQgdG8gb3JpZ2luYWwgcG9zaXRpb25cbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgc2Vjb25kID0gbmV4dDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgX3AgPSB7eDogcHJldmlvdXMueCArIGR4LCB5OiBwcmV2aW91cy55ICsgZHl9O1xuICAgICAgICAgICAgICAgIGlmKGJvdW5kcy5taW5YID4gX3AueClib3VuZHMubWluWCA9IF9wLng7XG4gICAgICAgICAgICAgICAgaWYoYm91bmRzLm1heFggPCBfcC54KWJvdW5kcy5tYXhYID0gX3AueDtcbiAgICAgICAgICAgICAgICBpZihib3VuZHMubWluWSA+IF9wLnkpYm91bmRzLm1pblkgPSBfcC55O1xuICAgICAgICAgICAgICAgIGlmKGJvdW5kcy5tYXhZIDwgX3AueSlib3VuZHMubWF4WSA9IF9wLnk7XG4gICAgICAgICAgICAgICAgYy5wdXNoKF9wKTtcbiAgICAgICAgICAgICAgICBwcmV2aW91cyA9IGN1cnJlbnQ7XG4gICAgICAgICAgICAgICAgZGlyID0gKGRpciArIDQpICUgODsgLy8gbmV4dCBkaXIgKHN5bW1ldHJpY2FsbHkgdG8gdGhlIGN1cnJlbnQgZGlyZWN0aW9uKVxuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgaWYgKG5leHQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIF9wID0ge3g6IGZpcnN0LnggKyBkeCwgeTogZmlyc3QueSArIGR5fTtcbiAgICAgICAgICAgICAgICBpZihib3VuZHMubWluWCA+ICBfcC54KWJvdW5kcy5taW5YID0gIF9wLng7XG4gICAgICAgICAgICAgICAgaWYoYm91bmRzLm1heFggPCAgX3AueClib3VuZHMubWF4WCA9ICBfcC54O1xuICAgICAgICAgICAgICAgIGlmKGJvdW5kcy5taW5ZID4gIF9wLnkpYm91bmRzLm1pblkgPSAgX3AueTtcbiAgICAgICAgICAgICAgICBpZihib3VuZHMubWF4WSA8ICBfcC55KWJvdW5kcy5tYXhZID0gIF9wLnk7XG4gICAgICAgICAgICAgICAgYy5wdXNoKF9wKTsgLy8gY2xvc2UgdGhlIGNvbnRvdXJcbiAgICAgICAgICAgICAgICBjb250b3Vycy5wdXNoKHtpbm5lcjogaW5uZXIsIGxhYmVsOiBsYWJlbCwgcG9pbnRzOiBjLGJvdW5kcyA6IGJvdW5kc30pOyAvLyBhZGQgY29udG91ciB0byB0aGUgbGlzdFxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICByZXR1cm4gY29udG91cnM7XG4gIH07XG5cbiAgZnVuY3Rpb24gcmdiVG9Ic2wociwgZywgYil7XG4gICAgciAvPSAyNTUsIGcgLz0gMjU1LCBiIC89IDI1NTtcbiAgICB2YXIgbWF4ID0gTWF0aC5tYXgociwgZywgYiksIG1pbiA9IE1hdGgubWluKHIsIGcsIGIpO1xuICAgIHZhciBoLCBzLCBsID0gKG1heCArIG1pbikgLyAyO1xuXG4gICAgaWYobWF4ID09IG1pbil7XG4gICAgICBoID0gcyA9IDA7IC8vIGFjaHJvbWF0aWNcbiAgICB9ZWxzZXtcbiAgICAgIHZhciBkID0gbWF4IC0gbWluO1xuICAgICAgcyA9IGwgPiAwLjUgPyBkIC8gKDIgLSBtYXggLSBtaW4pIDogZCAvIChtYXggKyBtaW4pO1xuICAgICAgc3dpdGNoKG1heCl7XG4gICAgICAgIGNhc2UgcjogaCA9IChnIC0gYikgLyBkICsgKGcgPCBiID8gNiA6IDApOyBicmVhaztcbiAgICAgICAgY2FzZSBnOiBoID0gKGIgLSByKSAvIGQgKyAyOyBicmVhaztcbiAgICAgICAgY2FzZSBiOiBoID0gKHIgLSBnKSAvIGQgKyA0OyBicmVhaztcbiAgICAgIH1cbiAgICAgIGggLz0gNjtcbiAgICB9XG5cbiAgICByZXR1cm4gW2ggKiAyNTUsIHMqIDI1NSwgbCogMjU1XTtcbiAgfVxuXG4gIGxpYi5zaW1wbGlmeUNvbnRvdXIgPSBmdW5jdGlvbiAoYywgc2ltcGxpZnlUb2xlcmFudCwgc2ltcGxpZnlDb3VudCkge1xuICAgIHZhclxuICAgICAgaSwgaiwgaywgYywgcG9pbnRzLCBsZW4sIHJlc1BvaW50cywgbHN0LCBzdGFjaywgaWRzLFxuICAgICAgbWF4ZCwgbWF4aSwgZGlzdCwgcjEsIHIyLCByMTIsIGR4LCBkeSwgcGksIHBmLCBwbDtcblxuICAgIHBvaW50cyA9IGMucG9pbnRzO1xuICAgIGxlbiA9IGMucG9pbnRzLmxlbmd0aDtcblxuICAgIGlmIChsZW4gPCBzaW1wbGlmeUNvdW50KSB7IC8vIGNvbnRvdXIgaXNuJ3Qgc2ltcGxpZmllZFxuICAgICAgcmVzUG9pbnRzID0gW107XG4gICAgICBmb3IgKGsgPSAwOyBrIDwgbGVuOyBrKyspIHtcbiAgICAgICAgcmVzUG9pbnRzLnB1c2goe3g6IHBvaW50c1trXS54LCB5OiBwb2ludHNba10ueX0pO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYm91bmRzOiBjLmJvdW5kcywgaW5uZXI6IGMuaW5uZXIsIGxhYmVsOiBjLmxhYmVsLCBwb2ludHM6IHJlc1BvaW50cywgaW5pdGlhbENvdW50OiBsZW59O1xuICAgIH1cblxuICAgIGxzdCA9IFswLCBsZW4gLSAxXTsgLy8gYWx3YXlzIGFkZCBmaXJzdCBhbmQgbGFzdCBwb2ludHNcbiAgICBzdGFjayA9IFt7Zmlyc3Q6IDAsIGxhc3Q6IGxlbiAtIDF9XTsgLy8gZmlyc3QgcHJvY2Vzc2VkIGVkZ2VcblxuICAgIGRvIHtcbiAgICAgIGlkcyA9IHN0YWNrLnNoaWZ0KCk7XG4gICAgICBpZiAoaWRzLmxhc3QgPD0gaWRzLmZpcnN0ICsgMSkgLy8gbm8gaW50ZXJtZWRpYXRlIHBvaW50c1xuICAgICAge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cblxuICAgICAgbWF4ZCA9IC0xLjA7IC8vIG1heCBkaXN0YW5jZSBmcm9tIHBvaW50IHRvIGN1cnJlbnQgZWRnZVxuICAgICAgbWF4aSA9IGlkcy5maXJzdDsgLy8gaW5kZXggb2YgbWF4aW1hbGx5IGRpc3RhbnQgcG9pbnRcblxuICAgICAgZm9yIChpID0gaWRzLmZpcnN0ICsgMTsgaSA8IGlkcy5sYXN0OyBpKyspIC8vIGJ5cGFzcyBpbnRlcm1lZGlhdGUgcG9pbnRzIGluIGVkZ2VcbiAgICAgIHtcbiAgICAgICAgLy8gY2FsYyB0aGUgZGlzdGFuY2UgZnJvbSBjdXJyZW50IHBvaW50IHRvIGVkZ2VcbiAgICAgICAgcGkgPSBwb2ludHNbaV07XG4gICAgICAgIHBmID0gcG9pbnRzW2lkcy5maXJzdF07XG4gICAgICAgIHBsID0gcG9pbnRzW2lkcy5sYXN0XTtcbiAgICAgICAgZHggPSBwaS54IC0gcGYueDtcbiAgICAgICAgZHkgPSBwaS55IC0gcGYueTtcbiAgICAgICAgcjEgPSBNYXRoLnNxcnQoZHggKiBkeCArIGR5ICogZHkpO1xuICAgICAgICBkeCA9IHBpLnggLSBwbC54O1xuICAgICAgICBkeSA9IHBpLnkgLSBwbC55O1xuICAgICAgICByMiA9IE1hdGguc3FydChkeCAqIGR4ICsgZHkgKiBkeSk7XG4gICAgICAgIGR4ID0gcGYueCAtIHBsLng7XG4gICAgICAgIGR5ID0gcGYueSAtIHBsLnk7XG4gICAgICAgIHIxMiA9IE1hdGguc3FydChkeCAqIGR4ICsgZHkgKiBkeSk7XG4gICAgICAgIGlmIChyMSA+PSBNYXRoLnNxcnQocjIgKiByMiArIHIxMiAqIHIxMikpIGRpc3QgPSByMjtcbiAgICAgICAgZWxzZSBpZiAocjIgPj0gTWF0aC5zcXJ0KHIxICogcjEgKyByMTIgKiByMTIpKSBkaXN0ID0gcjE7XG4gICAgICAgIGVsc2UgZGlzdCA9IE1hdGguYWJzKChkeSAqIHBpLnggLSBkeCAqIHBpLnkgKyBwZi54ICogcGwueSAtIHBsLnggKiBwZi55KSAvIHIxMik7XG5cbiAgICAgICAgaWYgKGRpc3QgPiBtYXhkKSB7XG4gICAgICAgICAgbWF4aSA9IGk7IC8vIHNhdmUgdGhlIGluZGV4IG9mIG1heGltYWxseSBkaXN0YW50IHBvaW50XG4gICAgICAgICAgbWF4ZCA9IGRpc3Q7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKG1heGQgPiBzaW1wbGlmeVRvbGVyYW50KSAvLyBpZiB0aGUgbWF4IFwiZGV2aWF0aW9uXCIgaXMgbGFyZ2VyIHRoYW4gYWxsb3dlZCB0aGVuLi4uXG4gICAgICB7XG4gICAgICAgIGxzdC5wdXNoKG1heGkpOyAvLyBhZGQgaW5kZXggdG8gdGhlIHNpbXBsaWZpZWQgbGlzdFxuICAgICAgICBzdGFjay5wdXNoKHtmaXJzdDogaWRzLmZpcnN0LCBsYXN0OiBtYXhpfSk7IC8vIGFkZCB0aGUgbGVmdCBwYXJ0IGZvciBwcm9jZXNzaW5nXG4gICAgICAgIHN0YWNrLnB1c2goe2ZpcnN0OiBtYXhpLCBsYXN0OiBpZHMubGFzdH0pOyAvLyBhZGQgdGhlIHJpZ2h0IHBhcnQgZm9yIHByb2Nlc3NpbmdcbiAgICAgIH1cblxuICAgIH0gd2hpbGUgKHN0YWNrLmxlbmd0aCA+IDApO1xuXG4gICAgcmVzUG9pbnRzID0gW107XG4gICAgbGVuID0gbHN0Lmxlbmd0aDtcbiAgICBsc3Quc29ydChmdW5jdGlvbiAoYSwgYikge1xuICAgICAgcmV0dXJuIGEgLSBiO1xuICAgIH0pOyAvLyByZXN0b3JlIGluZGV4IG9yZGVyXG4gICAgZm9yIChrID0gMDsgayA8IGxlbjsgaysrKSB7XG4gICAgICByZXNQb2ludHMucHVzaCh7eDogcG9pbnRzW2xzdFtrXV0ueCwgeTogcG9pbnRzW2xzdFtrXV0ueX0pOyAvLyBhZGQgcmVzdWx0IHBvaW50cyB0byB0aGUgY29ycmVjdCBvcmRlclxuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgYm91bmRzOiBjLmJvdW5kcyxcbiAgICAgIGlubmVyOiBjLmlubmVyLCBsYWJlbDogYy5sYWJlbCwgcG9pbnRzOiByZXNQb2ludHMsIGluaXRpYWxDb3VudDogYy5wb2ludHMubGVuZ3RoXG4gICAgfTtcbiAgfTtcblxuICAvKiogU2ltcGxpZnkgY29udG91cnNcbiAgICogQWxnb3JpdGhtczogaHR0cDovL3BzaW1wbC5zb3VyY2Vmb3JnZS5uZXQvZG91Z2xhcy1wZXVja2VyLmh0bWxcbiAgICogaHR0cDovL25lZXJjLmlmbW8ucnUvd2lraS9pbmRleC5waHA/dGl0bGU9JUQwJUEzJUQwJUJGJUQxJTgwJUQwJUJFJUQxJTg5JUQwJUI1JUQwJUJEJUQwJUI4JUQwJUI1XyVEMCVCRiVEMCVCRSVEMCVCQiVEMCVCOCVEMCVCMyVEMCVCRSVEMCVCRCVEMCVCMCVEMCVCQiVEMSU4QyVEMCVCRCVEMCVCRSVEMCVCOV8lRDElODYlRDAlQjUlRDAlQkYlRDAlQjhcbiAgICogQHBhcmFtIHtBcnJheX0gY29udG91cnM6IHtBcnJheX0gcG9pbnRzLCB7Ym9vbH0gaW5uZXIsIHtpbnR9IGxhYmVsXG4gICAqIEBwYXJhbSB7ZmxvYXR9IHNpbXBsaWZ5IHRvbGVyYW50XG4gICAqIEBwYXJhbSB7aW50fSBzaW1wbGlmeSBjb3VudDogbWluIG51bWJlciBvZiBwb2ludHMgd2hlbiB0aGUgY29udG91ciBpcyBzaW1wbGlmaWVkXG4gICAqIEByZXR1cm4ge0FycmF5fSBjb250b3Vyczoge0FycmF5fSBwb2ludHMsIHtib29sfSBpbm5lciwge2ludH0gbGFiZWwsIHtpbnR9IGluaXRpYWxDb3VudFxuICAgKi9cbiAgbGliLnNpbXBsaWZ5Q29udG91cnMgPSBmdW5jdGlvbiAoY29udG91cnMsIHNpbXBsaWZ5VG9sZXJhbnQsIHNpbXBsaWZ5Q291bnQpIHtcbiAgICB2YXIgbGVuQ29udG91cnMgPSBjb250b3Vycy5sZW5ndGgsXG4gICAgICByZXN1bHQgPSBbXTtcblxuICAgIC8vIHdhbGsgdGhyb3VnaCBhbGwgY29udG91cnNcbiAgICBmb3IgKHZhciBqID0gMDsgaiA8IGxlbkNvbnRvdXJzOyBqKyspIHtcblxuICAgICAgcmVzdWx0LnB1c2gobGliLnNpbXBsaWZ5Q29udG91cihjb250b3Vyc1tqXSwgc2ltcGxpZnlUb2xlcmFudCwgc2ltcGxpZnlDb3VudCkpO1xuICAgIH1cblxuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG5cbiAgcmV0dXJuIGxpYjtcbn0pKCk7XG5pZiAodHlwZW9mIGV4cG9ydHMgIT09ICd1bmRlZmluZWQnKSB7XG4gIG1vZHVsZS5leHBvcnRzID0gTWFnaWNXYW5kO1xufVxuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9wbHVnaW5zL21hZ2ljd2FuZC5qc1xuLy8gbW9kdWxlIGlkID0gOFxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCJtb2R1bGUuZXhwb3J0cyA9ICQ7XG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gZXh0ZXJuYWwgXCIkXCJcbi8vIG1vZHVsZSBpZCA9IDlcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwibW9kdWxlLmV4cG9ydHMgPSBcIlBEOTRiV3dnZG1WeWMybHZiajBpTVM0d0lpQmxibU52WkdsdVp6MGlWVlJHTFRnaUlITjBZVzVrWVd4dmJtVTlJbTV2SWo4K0Nqd2hMUzBnUTNKbFlYUmxaQ0IzYVhSb0lFbHVhM05qWVhCbElDaG9kSFJ3T2k4dmQzZDNMbWx1YTNOallYQmxMbTl5Wnk4cElDMHRQZ284YzNabkNpQWdJQ0I0Yld4dWN6cHBibXR6WTJGd1pUMGlhSFIwY0RvdkwzZDNkeTVwYm10elkyRndaUzV2Y21jdmJtRnRaWE53WVdObGN5OXBibXR6WTJGd1pTSUtJQ0FnSUhodGJHNXpPbkprWmowaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1UazVPUzh3TWk4eU1pMXlaR1l0YzNsdWRHRjRMVzV6SXlJS0lDQWdJSGh0Ykc1elBTSm9kSFJ3T2k4dmQzZDNMbmN6TG05eVp5OHlNREF3TDNOMlp5SUtJQ0FnSUhodGJHNXpPbk52Wkdsd2IyUnBQU0pvZEhSd09pOHZjMjlrYVhCdlpHa3VjMjkxY21ObFptOXlaMlV1Ym1WMEwwUlVSQzl6YjJScGNHOWthUzB3TG1SMFpDSUtJQ0FnSUhodGJHNXpPbU5qUFNKb2RIUndPaTh2WTNKbFlYUnBkbVZqYjIxdGIyNXpMbTl5Wnk5dWN5TWlDaUFnSUNCNGJXeHVjenA0YkdsdWF6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNVGs1T1M5NGJHbHVheUlLSUNBZ0lIaHRiRzV6T21SalBTSm9kSFJ3T2k4dmNIVnliQzV2Y21jdlpHTXZaV3hsYldWdWRITXZNUzR4THlJS0lDQWdJSGh0Ykc1ek9uTjJaejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpQ2lBZ0lDQjRiV3h1Y3pwdWN6RTlJbWgwZEhBNkx5OXpiM3BwTG1KaGFXVnliM1ZuWlM1bWNpSUtJQ0FnSUdsa1BTSnpkbWMwT0RnNElnb2dJQ0FnYzI5a2FYQnZaR2s2Wkc5amJtRnRaVDBpZDJGeWJtbHVaMTlpZFhSMGIyNHVjM1puSWdvZ0lDQWdkbWxsZDBKdmVEMGlNQ0F3SURRd01DQTBNREFpQ2lBZ0lDQjJaWEp6YVc5dVBTSXhMakVpQ2lBZ0lDQnBibXR6WTJGd1pUcDJaWEp6YVc5dVBTSXdMalE0TGpBZ2NqazJOVFFpQ2lBZ1Bnb2dJRHhrWldaekNpQWdJQ0FnSUdsa1BTSmtaV1p6TkRnNU1DSUtJQ0FnSUQ0S0lDQWdJRHhzYVc1bFlYSkhjbUZrYVdWdWRBb2dJQ0FnSUNBZ0lHbGtQU0pzYVc1bFlYSkhjbUZrYVdWdWREZzBNVEVpQ2lBZ0lDQWdJQ0FnZVRJOUlqTTJOeTQ0T0NJS0lDQWdJQ0FnSUNCbmNtRmthV1Z1ZEZWdWFYUnpQU0oxYzJWeVUzQmhZMlZQYmxWelpTSUtJQ0FnSUNBZ0lDQjVNVDBpTWpnM0xqUTVJZ29nSUNBZ0lDQWdJSGd5UFNJek1UVXVORGNpQ2lBZ0lDQWdJQ0FnZURFOUlqSTBNUzQwTVNJS0lDQWdJQ0FnSUNCcGJtdHpZMkZ3WlRwamIyeHNaV04wUFNKaGJIZGhlWE1pQ2lBZ0lDQWdJRDRLSUNBZ0lDQWdQSE4wYjNBS0lDQWdJQ0FnSUNBZ0lHbGtQU0p6ZEc5d05ERTFPQ0lLSUNBZ0lDQWdJQ0FnSUhOMGVXeGxQU0p6ZEc5d0xXTnZiRzl5T2lObVptWm1abVlpQ2lBZ0lDQWdJQ0FnSUNCdlptWnpaWFE5SWpBaUNpQWdJQ0FnSUM4K0NpQWdJQ0FnSUR4emRHOXdDaUFnSUNBZ0lDQWdJQ0JwWkQwaWMzUnZjRFF4TmpBaUNpQWdJQ0FnSUNBZ0lDQnpkSGxzWlQwaWMzUnZjQzFqYjJ4dmNqb2pabVptWm1abU8zTjBiM0F0YjNCaFkybDBlVG93SWdvZ0lDQWdJQ0FnSUNBZ2IyWm1jMlYwUFNJeElnb2dJQ0FnSUNBdlBnb2dJQ0FnUEM5c2FXNWxZWEpIY21Ga2FXVnVkQW9nSUNBZ1Bnb2dJQ0FnUEdacGJIUmxjZ29nSUNBZ0lDQWdJR2xrUFNKbWFXeDBaWEkyTVRJMklnb2dJQ0FnSUNBZ0lHTnZiRzl5TFdsdWRHVnljRzlzWVhScGIyNHRabWxzZEdWeWN6MGljMUpIUWlJS0lDQWdJQ0FnSUNCcGJtdHpZMkZ3WlRwamIyeHNaV04wUFNKaGJIZGhlWE1pQ2lBZ0lDQWdJRDRLSUNBZ0lDQWdQR1psUjJGMWMzTnBZVzVDYkhWeUNpQWdJQ0FnSUNBZ0lDQnBaRDBpWm1WSFlYVnpjMmxoYmtKc2RYSTJNVEk0SWdvZ0lDQWdJQ0FnSUNBZ2MzUmtSR1YyYVdGMGFXOXVQU0l3TGpVek1ETTFOekV6SWdvZ0lDQWdJQ0FnSUNBZ2FXNXJjMk5oY0dVNlkyOXNiR1ZqZEQwaVlXeDNZWGx6SWdvZ0lDQWdJQ0F2UGdvZ0lDQWdQQzltYVd4MFpYSUtJQ0FnSUQ0S0lDQWdJRHhzYVc1bFlYSkhjbUZrYVdWdWRBb2dJQ0FnSUNBZ0lHbGtQU0pzYVc1bFlYSkhjbUZrYVdWdWREZzBNVE1pQ2lBZ0lDQWdJQ0FnZVRJOUlqTTVNUzQwTlNJS0lDQWdJQ0FnSUNCbmNtRmthV1Z1ZEZWdWFYUnpQU0oxYzJWeVUzQmhZMlZQYmxWelpTSUtJQ0FnSUNBZ0lDQjVNVDBpTXpBd0xqZzJJZ29nSUNBZ0lDQWdJSGd5UFNJek5ESWlDaUFnSUNBZ0lDQWdlREU5SWpJM05TNDJNU0lLSUNBZ0lDQWdJQ0JwYm10elkyRndaVHBqYjJ4c1pXTjBQU0poYkhkaGVYTWlDaUFnSUNBZ0lENEtJQ0FnSUNBZ1BITjBiM0FLSUNBZ0lDQWdJQ0FnSUdsa1BTSnpkRzl3TnpJd01TSUtJQ0FnSUNBZ0lDQWdJSE4wZVd4bFBTSnpkRzl3TFdOdmJHOXlPaU0xTlRBd01EQWlDaUFnSUNBZ0lDQWdJQ0J2Wm1aelpYUTlJakFpQ2lBZ0lDQWdJQzgrQ2lBZ0lDQWdJRHh6ZEc5d0NpQWdJQ0FnSUNBZ0lDQnBaRDBpYzNSdmNEY3lNRE1pQ2lBZ0lDQWdJQ0FnSUNCemRIbHNaVDBpYzNSdmNDMWpiMnh2Y2pvalptWXdNREF3SWdvZ0lDQWdJQ0FnSUNBZ2IyWm1jMlYwUFNJeElnb2dJQ0FnSUNBdlBnb2dJQ0FnUEM5c2FXNWxZWEpIY21Ga2FXVnVkQW9nSUNBZ1Bnb2dJQ0FnUEhKaFpHbGhiRWR5WVdScFpXNTBDaUFnSUNBZ0lDQWdhV1E5SW5KaFpHbGhiRWR5WVdScFpXNTBPRFF4TlNJS0lDQWdJQ0FnSUNCbmNtRmthV1Z1ZEZWdWFYUnpQU0oxYzJWeVUzQmhZMlZQYmxWelpTSUtJQ0FnSUNBZ0lDQmplRDBpTXpFeUxqYzRJZ29nSUNBZ0lDQWdJR041UFNJek9EWXVOVGNpQ2lBZ0lDQWdJQ0FnY2owaU5UTXVNRE0ySWdvZ0lDQWdJQ0FnSUdkeVlXUnBaVzUwVkhKaGJuTm1iM0p0UFNKdFlYUnlhWGdvTFM0MU9UTXlOeUF0TGpVNU16STNJQzQzTVRVd05TQXRMamN4TlRBMUlESTBNeTR5TnlBNE5Ea3VNRE1wSWdvZ0lDQWdJQ0FnSUdsdWEzTmpZWEJsT21OdmJHeGxZM1E5SW1Gc2QyRjVjeUlLSUNBZ0lDQWdQZ29nSUNBZ0lDQThjM1J2Y0FvZ0lDQWdJQ0FnSUNBZ2FXUTlJbk4wYjNBM01URXpMVGNpQ2lBZ0lDQWdJQ0FnSUNCemRIbHNaVDBpYzNSdmNDMWpiMnh2Y2pvalptWm1abVptTzNOMGIzQXRiM0JoWTJsMGVUb3VOREE0TVRZaUNpQWdJQ0FnSUNBZ0lDQnZabVp6WlhROUlqQWlDaUFnSUNBZ0lDOCtDaUFnSUNBZ0lEeHpkRzl3Q2lBZ0lDQWdJQ0FnSUNCcFpEMGljM1J2Y0RjeE1UVXROeUlLSUNBZ0lDQWdJQ0FnSUhOMGVXeGxQU0p6ZEc5d0xXTnZiRzl5T2lObVptWm1abVk3YzNSdmNDMXZjR0ZqYVhSNU9qQWlDaUFnSUNBZ0lDQWdJQ0J2Wm1aelpYUTlJakVpQ2lBZ0lDQWdJQzgrQ2lBZ0lDQThMM0poWkdsaGJFZHlZV1JwWlc1MENpQWdJQ0ErQ2lBZ0lDQThiR2x1WldGeVIzSmhaR2xsYm5RS0lDQWdJQ0FnSUNCcFpEMGliR2x1WldGeVIzSmhaR2xsYm5ReE1EUTBPU0lLSUNBZ0lDQWdJQ0I1TWowaU16TTRMamd5SWdvZ0lDQWdJQ0FnSUdkeVlXUnBaVzUwVlc1cGRITTlJblZ6WlhKVGNHRmpaVTl1VlhObElnb2dJQ0FnSUNBZ0lIa3hQU0l5T0RZdU5qY2lDaUFnSUNBZ0lDQWdaM0poWkdsbGJuUlVjbUZ1YzJadmNtMDlJbTFoZEhKcGVDZ3VPVFUxTXpRZ01DQXdJQzQ1TlRVek5DQXhNell1TVRJZ01UUXVNRFUxS1NJS0lDQWdJQ0FnSUNCNE1qMGlNekF3TGpJM0lnb2dJQ0FnSUNBZ0lIZ3hQU0l5TlRVdU16SWlDaUFnSUNBZ0lDQWdhVzVyYzJOaGNHVTZZMjlzYkdWamREMGlZV3gzWVhseklnb2dJQ0FnSUNBK0NpQWdJQ0FnSUR4emRHOXdDaUFnSUNBZ0lDQWdJQ0JwWkQwaWMzUnZjRFF4TlRBaUNpQWdJQ0FnSUNBZ0lDQnpkSGxzWlQwaWMzUnZjQzFqYjJ4dmNqb2pabVptWm1abUlnb2dJQ0FnSUNBZ0lDQWdiMlptYzJWMFBTSXdJZ29nSUNBZ0lDQXZQZ29nSUNBZ0lDQThjM1J2Y0FvZ0lDQWdJQ0FnSUNBZ2FXUTlJbk4wYjNBME1UVXlJZ29nSUNBZ0lDQWdJQ0FnYzNSNWJHVTlJbk4wYjNBdFkyOXNiM0k2STJabVptWm1aanR6ZEc5d0xXOXdZV05wZEhrNk1DSUtJQ0FnSUNBZ0lDQWdJRzltWm5ObGREMGlNU0lLSUNBZ0lDQWdMejRLSUNBZ0lEd3ZiR2x1WldGeVIzSmhaR2xsYm5RS0lDQWdJRDRLSUNBZ0lEeG1hV3gwWlhJS0lDQWdJQ0FnSUNCcFpEMGlabWxzZEdWeU1URTBNamdpQ2lBZ0lDQWdJQ0FnWTI5c2IzSXRhVzUwWlhKd2IyeGhkR2x2YmkxbWFXeDBaWEp6UFNKelVrZENJZ29nSUNBZ0lDQWdJR2x1YTNOallYQmxPbU52Ykd4bFkzUTlJbUZzZDJGNWN5SUtJQ0FnSUNBZ1Bnb2dJQ0FnSUNBOFptVkhZWFZ6YzJsaGJrSnNkWElLSUNBZ0lDQWdJQ0FnSUdsa1BTSm1aVWRoZFhOemFXRnVRbXgxY2pFeE5ETXdJZ29nSUNBZ0lDQWdJQ0FnYzNSa1JHVjJhV0YwYVc5dVBTSXhMakkwTXpRMk56Z2lDaUFnSUNBZ0lDQWdJQ0JwYm10elkyRndaVHBqYjJ4c1pXTjBQU0poYkhkaGVYTWlDaUFnSUNBZ0lDOCtDaUFnSUNBOEwyWnBiSFJsY2dvZ0lDQWdQZ29nSUR3dlpHVm1jd29nSUQ0S0lDQThjMjlrYVhCdlpHazZibUZ0WldSMmFXVjNDaUFnSUNBZ0lHbGtQU0ppWVhObElnb2dJQ0FnSUNCaWIzSmtaWEpqYjJ4dmNqMGlJelkyTmpZMk5pSUtJQ0FnSUNBZ2FXNXJjMk5oY0dVNmNHRm5aWE5vWVdSdmR6MGlNaUlLSUNBZ0lDQWdhVzVyYzJOaGNHVTZkMmx1Wkc5M0xYazlJaTA0SWdvZ0lDQWdJQ0J3WVdkbFkyOXNiM0k5SWlObVptWm1abVlpQ2lBZ0lDQWdJR2x1YTNOallYQmxPbmRwYm1SdmR5MW9aV2xuYUhROUlqazRPQ0lLSUNBZ0lDQWdhVzVyYzJOaGNHVTZkMmx1Wkc5M0xXMWhlR2x0YVhwbFpEMGlNU0lLSUNBZ0lDQWdhVzVyYzJOaGNHVTZlbTl2YlQwaU1DNDNNRGN4TURZM09DSUtJQ0FnSUNBZ2FXNXJjMk5oY0dVNmQybHVaRzkzTFhnOUlpMDRJZ29nSUNBZ0lDQnphRzkzWjNKcFpEMGlabUZzYzJVaUNpQWdJQ0FnSUdKdmNtUmxjbTl3WVdOcGRIazlJakV1TUNJS0lDQWdJQ0FnYVc1cmMyTmhjR1U2WTNWeWNtVnVkQzFzWVhsbGNqMGliR0Y1WlhJeElnb2dJQ0FnSUNCcGJtdHpZMkZ3WlRwamVEMGlNekEwTGpnNU5EQTVJZ29nSUNBZ0lDQnBibXR6WTJGd1pUcGplVDBpTXpReExqVXlNVGcySWdvZ0lDQWdJQ0JwYm10elkyRndaVHAzYVc1a2IzY3RkMmxrZEdnOUlqRTJPREFpQ2lBZ0lDQWdJR2x1YTNOallYQmxPbkJoWjJWdmNHRmphWFI1UFNJd0xqQWlDaUFnSUNBZ0lHbHVhM05qWVhCbE9tUnZZM1Z0Wlc1MExYVnVhWFJ6UFNKd2VDSUtJQ0F2UGdvZ0lEeG5DaUFnSUNBZ0lHbGtQU0pzWVhsbGNqRWlDaUFnSUNBZ0lHbHVhM05qWVhCbE9teGhZbVZzUFNKTVlYbGxjaUF4SWdvZ0lDQWdJQ0JwYm10elkyRndaVHBuY205MWNHMXZaR1U5SW14aGVXVnlJZ29nSUNBZ0lDQjBjbUZ1YzJadmNtMDlJblJ5WVc1emJHRjBaU2d3SUMwMk5USXVNellwSWdvZ0lDQWdQZ29nSUNBZ1BHY0tJQ0FnSUNBZ0lDQnBaRDBpWnpFeE5ETXlJZ29nSUNBZ0lDQWdJR2x1YTNOallYQmxPbVY0Y0c5eWRDMTVaSEJwUFNJNU1DSUtJQ0FnSUNBZ0lDQnBibXR6WTJGd1pUcGxlSEJ2Y25RdGVHUndhVDBpT1RBaUNpQWdJQ0FnSUNBZ2RISmhibk5tYjNKdFBTSnRZWFJ5YVhnb01pNDVNRFV4SURBZ01DQXlMamt3TlRFZ0xURXdNREV1T1NBdE56Z3VPVFl4S1NJS0lDQWdJQ0FnUGdvZ0lDQWdJQ0E4Y0dGMGFBb2dJQ0FnSUNBZ0lDQWdhV1E5SW5CaGRHZzNNamMySWdvZ0lDQWdJQ0FnSUNBZ2MyOWthWEJ2WkdrNmNuZzlJalV6TGpBek5UY3hNeUlLSUNBZ0lDQWdJQ0FnSUhOdlpHbHdiMlJwT25KNVBTSTFNeTR3TXpVM01UTWlDaUFnSUNBZ0lDQWdJQ0J6ZEhsc1pUMGlabWxzYkRvak9UazVPVGs1SWdvZ0lDQWdJQ0FnSUNBZ2MyOWthWEJ2WkdrNmRIbHdaVDBpWVhKaklnb2dJQ0FnSUNBZ0lDQWdaRDBpYlRNMU5pNDNPU0F6TkRZdU1URmpNQ0F5T1M0eU9URXRNak11TnpRMUlEVXpMakF6TmkwMU15NHdNellnTlRNdU1ETTJjeTAxTXk0d016WXRNak11TnpRMUxUVXpMakF6TmkwMU15NHdNellnTWpNdU56UTFMVFV6TGpBek5pQTFNeTR3TXpZdE5UTXVNRE0ySURVekxqQXpOaUF5TXk0M05EVWdOVE11TURNMklEVXpMakF6Tm5vaUNpQWdJQ0FnSUNBZ0lDQjBjbUZ1YzJadmNtMDlJbTFoZEhKcGVDZ3VPVGN6TlRRZ01DQXdJQzQ1TnpNMU5DQXhNakF1TURrZ0xURXlMall5T0NraUNpQWdJQ0FnSUNBZ0lDQnpiMlJwY0c5a2FUcGplVDBpTXpRMkxqRXhNakU0SWdvZ0lDQWdJQ0FnSUNBZ2MyOWthWEJ2WkdrNlkzZzlJak13TXk0M05TSUtJQ0FnSUNBZ0x6NEtJQ0FnSUNBZ1BIQmhkR2dLSUNBZ0lDQWdJQ0FnSUdsa1BTSndZWFJvTnpJM09DSUtJQ0FnSUNBZ0lDQWdJSE52Wkdsd2IyUnBPbko0UFNJMU15NHdNelUzTVRNaUNpQWdJQ0FnSUNBZ0lDQnpiMlJwY0c5a2FUcHllVDBpTlRNdU1ETTFOekV6SWdvZ0lDQWdJQ0FnSUNBZ2MzUjViR1U5SW1acGJHdzZkWEpzS0NOc2FXNWxZWEpIY21Ga2FXVnVkRGcwTVRFcElnb2dJQ0FnSUNBZ0lDQWdjMjlrYVhCdlpHazZkSGx3WlQwaVlYSmpJZ29nSUNBZ0lDQWdJQ0FnWkQwaWJUTTFOaTQzT1NBek5EWXVNVEZqTUNBeU9TNHlPVEV0TWpNdU56UTFJRFV6TGpBek5pMDFNeTR3TXpZZ05UTXVNRE0yY3kwMU15NHdNell0TWpNdU56UTFMVFV6TGpBek5pMDFNeTR3TXpZZ01qTXVOelExTFRVekxqQXpOaUExTXk0d016WXROVE11TURNMklEVXpMakF6TmlBeU15NDNORFVnTlRNdU1ETTJJRFV6TGpBek5ub2lDaUFnSUNBZ0lDQWdJQ0IwY21GdWMyWnZjbTA5SW0xaGRISnBlQ2d1T1RVNU5qQWdNQ0F3SUM0NU5UazJNQ0F4TWpRdU16TWdMVGN1T0RBeE5Da2lDaUFnSUNBZ0lDQWdJQ0J6YjJScGNHOWthVHBqZVQwaU16UTJMakV4TWpFNElnb2dJQ0FnSUNBZ0lDQWdjMjlrYVhCdlpHazZZM2c5SWpNd015NDNOU0lLSUNBZ0lDQWdMejRLSUNBZ0lDQWdQSEJoZEdnS0lDQWdJQ0FnSUNBZ0lHbGtQU0p3WVhSb056STRNQ0lLSUNBZ0lDQWdJQ0FnSUhOdlpHbHdiMlJwT25KNFBTSTFNeTR3TXpVM01UTWlDaUFnSUNBZ0lDQWdJQ0J6YjJScGNHOWthVHB5ZVQwaU5UTXVNRE0xTnpFeklnb2dJQ0FnSUNBZ0lDQWdjM1I1YkdVOUltWnBiSFJsY2pwMWNtd29JMlpwYkhSbGNqWXhNallwTzJacGJHdzZJMlZqWldObFl5SUtJQ0FnSUNBZ0lDQWdJSE52Wkdsd2IyUnBPblI1Y0dVOUltRnlZeUlLSUNBZ0lDQWdJQ0FnSUdROUltMHpOVFl1TnprZ016UTJMakV4WXpBZ01qa3VNamt4TFRJekxqYzBOU0ExTXk0d016WXROVE11TURNMklEVXpMakF6Tm5NdE5UTXVNRE0yTFRJekxqYzBOUzAxTXk0d016WXROVE11TURNMklESXpMamMwTlMwMU15NHdNellnTlRNdU1ETTJMVFV6TGpBek5pQTFNeTR3TXpZZ01qTXVOelExSURVekxqQXpOaUExTXk0d016WjZJZ29nSUNBZ0lDQWdJQ0FnZEhKaGJuTm1iM0p0UFNKdFlYUnlhWGdvTGpnM016VTFJREFnTUNBdU9EY3pOVFVnTVRVd0xqUTNJREl4TGprNE1Ta2lDaUFnSUNBZ0lDQWdJQ0J6YjJScGNHOWthVHBqZVQwaU16UTJMakV4TWpFNElnb2dJQ0FnSUNBZ0lDQWdjMjlrYVhCdlpHazZZM2c5SWpNd015NDNOU0lLSUNBZ0lDQWdMejRLSUNBZ0lDQWdQSEJoZEdnS0lDQWdJQ0FnSUNBZ0lHbGtQU0p3WVhSb056STRNaUlLSUNBZ0lDQWdJQ0FnSUhOdlpHbHdiMlJwT25KNFBTSTFNeTR3TXpVM01UTWlDaUFnSUNBZ0lDQWdJQ0J6YjJScGNHOWthVHB5ZVQwaU5UTXVNRE0xTnpFeklnb2dJQ0FnSUNBZ0lDQWdjM1I1YkdVOUltWnBiSFJsY2pwMWNtd29JMlpwYkhSbGNqWXhNallwTzJacGJHdzZJems1T1RrNU9TSUtJQ0FnSUNBZ0lDQWdJSE52Wkdsd2IyUnBPblI1Y0dVOUltRnlZeUlLSUNBZ0lDQWdJQ0FnSUdROUltMHpOVFl1TnprZ016UTJMakV4WXpBZ01qa3VNamt4TFRJekxqYzBOU0ExTXk0d016WXROVE11TURNMklEVXpMakF6Tm5NdE5UTXVNRE0yTFRJekxqYzBOUzAxTXk0d016WXROVE11TURNMklESXpMamMwTlMwMU15NHdNellnTlRNdU1ETTJMVFV6TGpBek5pQTFNeTR3TXpZZ01qTXVOelExSURVekxqQXpOaUExTXk0d016WjZJZ29nSUNBZ0lDQWdJQ0FnZEhKaGJuTm1iM0p0UFNKdFlYUnlhWGdvTGpnek9ETTRJREFnTUNBdU9ETTRNemdnTVRZeExqRTFJRE0wTGpFMU1pa2lDaUFnSUNBZ0lDQWdJQ0J6YjJScGNHOWthVHBqZVQwaU16UTJMakV4TWpFNElnb2dJQ0FnSUNBZ0lDQWdjMjlrYVhCdlpHazZZM2c5SWpNd015NDNOU0lLSUNBZ0lDQWdMejRLSUNBZ0lDQWdQSEJoZEdnS0lDQWdJQ0FnSUNBZ0lHbGtQU0p3WVhSb056STROQ0lLSUNBZ0lDQWdJQ0FnSUhOdlpHbHdiMlJwT25KNFBTSTFNeTR3TXpVM01UTWlDaUFnSUNBZ0lDQWdJQ0J6YjJScGNHOWthVHB5ZVQwaU5UTXVNRE0xTnpFeklnb2dJQ0FnSUNBZ0lDQWdjM1I1YkdVOUltWnBiR3c2ZFhKc0tDTnNhVzVsWVhKSGNtRmthV1Z1ZERnME1UTXBJZ29nSUNBZ0lDQWdJQ0FnYzI5a2FYQnZaR2s2ZEhsd1pUMGlZWEpqSWdvZ0lDQWdJQ0FnSUNBZ1pEMGliVE0xTmk0M09TQXpORFl1TVRGak1DQXlPUzR5T1RFdE1qTXVOelExSURVekxqQXpOaTAxTXk0d016WWdOVE11TURNMmN5MDFNeTR3TXpZdE1qTXVOelExTFRVekxqQXpOaTAxTXk0d016WWdNak11TnpRMUxUVXpMakF6TmlBMU15NHdNell0TlRNdU1ETTJJRFV6TGpBek5pQXlNeTQzTkRVZ05UTXVNRE0ySURVekxqQXpObm9pQ2lBZ0lDQWdJQ0FnSUNCMGNtRnVjMlp2Y20wOUltMWhkSEpwZUNndU9EQTFPRGNnTUNBd0lDNDRNRFU0TnlBeE56RXVNRE1nTkRVdU5EQTFLU0lLSUNBZ0lDQWdJQ0FnSUhOdlpHbHdiMlJwT21ONVBTSXpORFl1TVRFeU1UZ2lDaUFnSUNBZ0lDQWdJQ0J6YjJScGNHOWthVHBqZUQwaU16QXpMamMxSWdvZ0lDQWdJQ0F2UGdvZ0lDQWdJQ0E4Y0dGMGFBb2dJQ0FnSUNBZ0lDQWdhV1E5SW5CaGRHZzNNamcySWdvZ0lDQWdJQ0FnSUNBZ2MyOWthWEJ2WkdrNmNuZzlJalV6TGpBek5UY3hNeUlLSUNBZ0lDQWdJQ0FnSUhOdlpHbHdiMlJwT25KNVBTSTFNeTR3TXpVM01UTWlDaUFnSUNBZ0lDQWdJQ0J6ZEhsc1pUMGlabWxzYkRwMWNtd29JM0poWkdsaGJFZHlZV1JwWlc1ME9EUXhOU2tpQ2lBZ0lDQWdJQ0FnSUNCemIyUnBjRzlrYVRwMGVYQmxQU0poY21NaUNpQWdJQ0FnSUNBZ0lDQmtQU0p0TXpVMkxqYzVJRE0wTmk0eE1XTXdJREk1TGpJNU1TMHlNeTQzTkRVZ05UTXVNRE0yTFRVekxqQXpOaUExTXk0d016WnpMVFV6TGpBek5pMHlNeTQzTkRVdE5UTXVNRE0yTFRVekxqQXpOaUF5TXk0M05EVXROVE11TURNMklEVXpMakF6TmkwMU15NHdNellnTlRNdU1ETTJJREl6TGpjME5TQTFNeTR3TXpZZ05UTXVNRE0yZWlJS0lDQWdJQ0FnSUNBZ0lIUnlZVzV6Wm05eWJUMGliV0YwY21sNEtDNDNOVGd5TlNBd0lEQWdMamMxT0RJMUlERTROaTQzTlNBMk15NDVNRFlwSWdvZ0lDQWdJQ0FnSUNBZ2MyOWthWEJ2WkdrNlkzazlJak0wTmk0eE1USXhPQ0lLSUNBZ0lDQWdJQ0FnSUhOdlpHbHdiMlJwT21ONFBTSXpNRE11TnpVaUNpQWdJQ0FnSUM4K0NpQWdJQ0FnSUR4d1lYUm9DaUFnSUNBZ0lDQWdJQ0JwWkQwaWNHRjBhRGN5T0RnaUNpQWdJQ0FnSUNBZ0lDQnpkSGxzWlQwaWIzQmhZMmwwZVRvdU16RTNOekU3Wm1sc2JEcDFjbXdvSTJ4cGJtVmhja2R5WVdScFpXNTBNVEEwTkRrcElnb2dJQ0FnSUNBZ0lDQWdhVzVyYzJOaGNHVTZZMjl1Ym1WamRHOXlMV04xY25aaGRIVnlaVDBpTUNJS0lDQWdJQ0FnSUNBZ0lHUTlJbTAwTVRRdU9DQXlPRFF1TVRWakxURXpMak16TVNBd0xqTXdNRFk1TFRJMkxqRTROaUEzTGpNMU9DMHpNeTR6TXpZZ01Ua3VOelF5TFRjdU5qa3dNeUF4TXk0ek1pMDJMamN4TXprZ01qa3VNalkySURFdU1UVTBOU0EwTVM0ek16RWdNQzQ0TlRNd05pMHlOaTQxTXpJZ01qRXVNVE15TFRRMkxqVXhOU0EwTmk0ek1qUXRORFV1TURVMElEZ3VNalU0T1NBd0xqUTNPVEEzSURFMkxqQTFOQ0F6TGpJd01ERWdNakl1T0RVNUlEY3VOVGt3T0MwekxqSTFOemd0Tnk0ME5EazRMVGd1T0RFM01TMHhNeTQ1TlRNdE1UWXVNemswTFRFNExqTXlOeTAyTGpRNE5qY3RNeTQzTkRVeExURXpMall5TlMwMUxqUXpPVE10TWpBdU5qQTRMVFV1TWpneE9Ib2lDaUFnSUNBZ0lDOCtDaUFnSUNBZ0lEeHdZWFJvQ2lBZ0lDQWdJQ0FnSUNCcFpEMGljbVZqZERjek56QWlDaUFnSUNBZ0lDQWdJQ0JrUFNKdE5EQXlMamc0SURNd01DNHdPUzB4TVM0MU9ERWdNVEV1TlRneElERXpMakk1TlNBeE15NHlPVFV0TVRNdU1qazFJREV6TGpJNE1TQXhNUzQxT0RFZ01URXVOVGd4SURFekxqSTRNUzB4TXk0eU9UVWdNVE11TWprMUlERXpMakk1TlNBeE1TNDFPREV0TVRFdU5UZ3hMVEV6TGpJNE1TMHhNeTR5T0RFZ01UTXVNamd4TFRFekxqSTVOUzB4TVM0MU9ERXRNVEV1TlRneExURXpMakk1TlNBeE15NHlPREV0TVRNdU1qZ3hMVEV6TGpJNE1Yb2lDaUFnSUNBZ0lDQWdJQ0J6ZEhsc1pUMGlabWxzZEdWeU9uVnliQ2dqWm1sc2RHVnlNVEUwTWpncE8yWnBiR3c2SXpGaE1XRXhZU0lLSUNBZ0lDQWdJQ0FnSUdsdWEzTmpZWEJsT21OdmJtNWxZM1J2Y2kxamRYSjJZWFIxY21VOUlqQWlDaUFnSUNBZ0lDOCtDaUFnSUNBZ0lEeHdZWFJvQ2lBZ0lDQWdJQ0FnSUNCcFpEMGljR0YwYURFd05EVTNJZ29nSUNBZ0lDQWdJQ0FnYzNSNWJHVTlJbVpwYkd3NkkyWm1abVptWmlJS0lDQWdJQ0FnSUNBZ0lHbHVhM05qWVhCbE9tTnZibTVsWTNSdmNpMWpkWEoyWVhSMWNtVTlJakFpQ2lBZ0lDQWdJQ0FnSUNCa1BTSnROREF6TGpRMUlETXdNUzR4TlMweE1TNHdPRGNnTVRFdU1EZzNJREV5TGpjeU9DQXhNaTQzTWpndE1USXVOekk0SURFeUxqY3hOQ0F4TVM0d09EY2dNVEV1TURnM0lERXlMamN4TkMweE1pNDNNamdnTVRJdU56STRJREV5TGpjeU9DQXhNUzR3T0RjdE1URXVNRGczTFRFeUxqY3hOQzB4TWk0M01UUWdNVEl1TnpFMExURXlMamN5T0MweE1TNHdPRGN0TVRFdU1EZzNMVEV5TGpjeU9DQXhNaTQzTVRRdE1USXVOekUwTFRFeUxqY3hOSG9pQ2lBZ0lDQWdJQzgrQ2lBZ0lDQThMMmNLSUNBZ0lENEtJQ0E4TDJjS0lDQStDaUFnUEcxbGRHRmtZWFJoQ2lBZ0lDQStDaUFnSUNBOGNtUm1PbEpFUmdvZ0lDQWdJQ0ErQ2lBZ0lDQWdJRHhqWXpwWGIzSnJDaUFnSUNBZ0lDQWdQZ29nSUNBZ0lDQWdJRHhrWXpwbWIzSnRZWFFLSUNBZ0lDQWdJQ0FnSUQ1cGJXRm5aUzl6ZG1jcmVHMXNQQzlrWXpwbWIzSnRZWFFLSUNBZ0lDQWdJQ0ErQ2lBZ0lDQWdJQ0FnUEdSak9uUjVjR1VLSUNBZ0lDQWdJQ0FnSUNBZ2NtUm1PbkpsYzI5MWNtTmxQU0pvZEhSd09pOHZjSFZ5YkM1dmNtY3ZaR012WkdOdGFYUjVjR1V2VTNScGJHeEpiV0ZuWlNJS0lDQWdJQ0FnSUNBdlBnb2dJQ0FnSUNBZ0lEeGpZenBzYVdObGJuTmxDaUFnSUNBZ0lDQWdJQ0FnSUhKa1pqcHlaWE52ZFhKalpUMGlhSFIwY0RvdkwyTnlaV0YwYVhabFkyOXRiVzl1Y3k1dmNtY3ZiR2xqWlc1elpYTXZjSFZpYkdsalpHOXRZV2x1THlJS0lDQWdJQ0FnSUNBdlBnb2dJQ0FnSUNBZ0lEeGtZenB3ZFdKc2FYTm9aWElLSUNBZ0lDQWdJQ0FnSUQ0S0lDQWdJQ0FnSUNBZ0lEeGpZenBCWjJWdWRBb2dJQ0FnSUNBZ0lDQWdJQ0FnSUhKa1pqcGhZbTkxZEQwaWFIUjBjRG92TDI5d1pXNWpiR2x3WVhKMExtOXlaeThpQ2lBZ0lDQWdJQ0FnSUNBZ0lENEtJQ0FnSUNBZ0lDQWdJQ0FnUEdSak9uUnBkR3hsQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdQazl3Wlc1amJHbHdZWEowUEM5a1l6cDBhWFJzWlFvZ0lDQWdJQ0FnSUNBZ0lDQStDaUFnSUNBZ0lDQWdJQ0E4TDJOak9rRm5aVzUwQ2lBZ0lDQWdJQ0FnSUNBK0NpQWdJQ0FnSUNBZ1BDOWtZenB3ZFdKc2FYTm9aWElLSUNBZ0lDQWdJQ0ErQ2lBZ0lDQWdJQ0FnUEdSak9uUnBkR3hsQ2lBZ0lDQWdJQ0FnSUNBK1pYSnliM0lnWW5WMGRHOXVQQzlrWXpwMGFYUnNaUW9nSUNBZ0lDQWdJRDRLSUNBZ0lDQWdJQ0E4WkdNNlpHRjBaUW9nSUNBZ0lDQWdJQ0FnUGpJd01URXRNREl0TWpSVU1UYzZORFU2TkRVOEwyUmpPbVJoZEdVS0lDQWdJQ0FnSUNBK0NpQWdJQ0FnSUNBZ1BHUmpPbVJsYzJOeWFYQjBhVzl1Q2lBZ0lDQWdJQ0FnTHo0S0lDQWdJQ0FnSUNBOFpHTTZjMjkxY21ObENpQWdJQ0FnSUNBZ0lDQSthSFIwY0hNNkx5OXZjR1Z1WTJ4cGNHRnlkQzV2Y21jdlpHVjBZV2xzTHpFeU1qUXlOUzlsY25KdmNpMWlkWFIwYjI0dFlua3RjbWxqWVhKa2IyMWhhV0U4TDJSak9uTnZkWEpqWlFvZ0lDQWdJQ0FnSUQ0S0lDQWdJQ0FnSUNBOFpHTTZZM0psWVhSdmNnb2dJQ0FnSUNBZ0lDQWdQZ29nSUNBZ0lDQWdJQ0FnUEdOak9rRm5aVzUwQ2lBZ0lDQWdJQ0FnSUNBZ0lENEtJQ0FnSUNBZ0lDQWdJQ0FnUEdSak9uUnBkR3hsQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdQbkpwWTJGeVpHOXRZV2xoUEM5a1l6cDBhWFJzWlFvZ0lDQWdJQ0FnSUNBZ0lDQStDaUFnSUNBZ0lDQWdJQ0E4TDJOak9rRm5aVzUwQ2lBZ0lDQWdJQ0FnSUNBK0NpQWdJQ0FnSUNBZ1BDOWtZenBqY21WaGRHOXlDaUFnSUNBZ0lDQWdQZ29nSUNBZ0lDQWdJRHhrWXpwemRXSnFaV04wQ2lBZ0lDQWdJQ0FnSUNBK0NpQWdJQ0FnSUNBZ0lDQThjbVJtT2tKaFp3b2dJQ0FnSUNBZ0lDQWdJQ0ErQ2lBZ0lDQWdJQ0FnSUNBZ0lEeHlaR1k2YkdrS0lDQWdJQ0FnSUNBZ0lDQWdJQ0ErWW5WMGRHOXVQQzl5WkdZNmJHa0tJQ0FnSUNBZ0lDQWdJQ0FnUGdvZ0lDQWdJQ0FnSUNBZ0lDQThjbVJtT214cENpQWdJQ0FnSUNBZ0lDQWdJQ0FnUG1OaGJtTmxiRHd2Y21SbU9teHBDaUFnSUNBZ0lDQWdJQ0FnSUQ0S0lDQWdJQ0FnSUNBZ0lDQWdQSEprWmpwc2FRb2dJQ0FnSUNBZ0lDQWdJQ0FnSUQ1amFYSmpiR1U4TDNKa1pqcHNhUW9nSUNBZ0lDQWdJQ0FnSUNBK0NpQWdJQ0FnSUNBZ0lDQWdJRHh5WkdZNmJHa0tJQ0FnSUNBZ0lDQWdJQ0FnSUNBK1pHVnNaWFJsUEM5eVpHWTZiR2tLSUNBZ0lDQWdJQ0FnSUNBZ1Bnb2dJQ0FnSUNBZ0lDQWdJQ0E4Y21SbU9teHBDaUFnSUNBZ0lDQWdJQ0FnSUNBZ1BuSmxaRHd2Y21SbU9teHBDaUFnSUNBZ0lDQWdJQ0FnSUQ0S0lDQWdJQ0FnSUNBZ0lDQWdQSEprWmpwc2FRb2dJQ0FnSUNBZ0lDQWdJQ0FnSUQ1eWIzVnVaRHd2Y21SbU9teHBDaUFnSUNBZ0lDQWdJQ0FnSUQ0S0lDQWdJQ0FnSUNBZ0lEd3ZjbVJtT2tKaFp3b2dJQ0FnSUNBZ0lDQWdQZ29nSUNBZ0lDQWdJRHd2WkdNNmMzVmlhbVZqZEFvZ0lDQWdJQ0FnSUQ0S0lDQWdJQ0FnUEM5all6cFhiM0pyQ2lBZ0lDQWdJRDRLSUNBZ0lDQWdQR05qT2t4cFkyVnVjMlVLSUNBZ0lDQWdJQ0FnSUhKa1pqcGhZbTkxZEQwaWFIUjBjRG92TDJOeVpXRjBhWFpsWTI5dGJXOXVjeTV2Y21jdmJHbGpaVzV6WlhNdmNIVmliR2xqWkc5dFlXbHVMeUlLSUNBZ0lDQWdJQ0ErQ2lBZ0lDQWdJQ0FnUEdOak9uQmxjbTFwZEhNS0lDQWdJQ0FnSUNBZ0lDQWdjbVJtT25KbGMyOTFjbU5sUFNKb2RIUndPaTh2WTNKbFlYUnBkbVZqYjIxdGIyNXpMbTl5Wnk5dWN5TlNaWEJ5YjJSMVkzUnBiMjRpQ2lBZ0lDQWdJQ0FnTHo0S0lDQWdJQ0FnSUNBOFkyTTZjR1Z5YldsMGN3b2dJQ0FnSUNBZ0lDQWdJQ0J5WkdZNmNtVnpiM1Z5WTJVOUltaDBkSEE2THk5amNtVmhkR2wyWldOdmJXMXZibk11YjNKbkwyNXpJMFJwYzNSeWFXSjFkR2x2YmlJS0lDQWdJQ0FnSUNBdlBnb2dJQ0FnSUNBZ0lEeGpZenB3WlhKdGFYUnpDaUFnSUNBZ0lDQWdJQ0FnSUhKa1pqcHlaWE52ZFhKalpUMGlhSFIwY0RvdkwyTnlaV0YwYVhabFkyOXRiVzl1Y3k1dmNtY3Zibk1qUkdWeWFYWmhkR2wyWlZkdmNtdHpJZ29nSUNBZ0lDQWdJQzgrQ2lBZ0lDQWdJRHd2WTJNNlRHbGpaVzV6WlFvZ0lDQWdJQ0ErQ2lBZ0lDQThMM0prWmpwU1JFWUtJQ0FnSUQ0S0lDQThMMjFsZEdGa1lYUmhDaUFnUGdvOEwzTjJad28rQ2c9PVwiXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi4vfi9iYXNlNjQtbG9hZGVyIS4vbWVkaWEvZXJyb3ItYnV0dG9uLnN2Z1xuLy8gbW9kdWxlIGlkID0gMTBcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuQmFzZUJydXNoLnByb3RvdHlwZSwge1xuICB1c2VEcmF3aW5nQ29sb3I6IHRydWUsXG4gIHNldE9wdGlvbnM6IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgZm9yICh2YXIgcHJvcCBpbiBvcHRpb25zKSB7XG4gICAgICB0aGlzW3Byb3BdID0gb3B0aW9uc1twcm9wXTtcbiAgICB9XG4gIH0sXG4gIHR5cGU6IFwiYmFzZS1icnVzaFwiLFxuICBpbml0aWFsaXplOiBmdW5jdGlvbiAoY2FudmFzLCBvcHRpb25zKSB7XG4gICAgdGhpcy5jYW52YXMgPSBjYW52YXM7XG4gICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG4gICAgaWYodGhpcy5jYW52YXMuYXBwbGljYXRpb24pIHtcbiAgICAgIHRoaXMuY2FudmFzLmFwcGxpY2F0aW9uLmZpcmUoXCJlbnRpdHk6Y3JlYXRlZFwiLCB7dGFyZ2V0OiB0aGlzLCBvcHRpb25zOiBvcHRpb25zfSlcbiAgICB9XG4gICAgdGhpcy5zZXRPcHRpb25zKG9wdGlvbnMpO1xuICB9LFxuICBjb252ZXJ0Q29sb3I6IGZ1bmN0aW9uIChjb2xvciwgdHlwZSkge1xuICAgIHR5cGUgPSB0eXBlIHx8IFwibmFtZVwiO1xuICAgIGlmIChjb2xvciBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICBpZiAodHlwZSA9PSBcInNvdXJjZVwiKSB7XG4gICAgICAgIHJldHVybiBjb2xvcjtcbiAgICAgIH1cbiAgICAgIGNvbG9yID0gXCIjXCIgKyBmYWJyaWMuQ29sb3IuZnJvbVNvdXJjZShjb2xvcikudG9IZXgoKTtcbiAgICB9XG4gICAgaWYgKHR5cGUgPT0gXCJoZXhcIiB8fCB0eXBlID09IFwic291cmNlXCIpIHtcbiAgICAgIGlmIChmYWJyaWMuQ29sb3IuY29sb3JOYW1lTWFwW2NvbG9yXSkge1xuICAgICAgICBjb2xvciA9IGZhYnJpYy5Db2xvci5jb2xvck5hbWVNYXBbY29sb3JdO1xuICAgICAgfVxuICAgICAgaWYgKHR5cGUgPT0gXCJzb3VyY2VcIikge1xuICAgICAgICBpZiAoY29sb3IgPT0gXCJ0cmFuc3BhcmVudFwiKSB7XG4gICAgICAgICAgcmV0dXJuIFswLCAwLCAwLCAwXTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgX3NvdXJjZSA9IGZhYnJpYy5Db2xvci5mcm9tSGV4KGNvbG9yKS5nZXRTb3VyY2UoKVxuICAgICAgICBfc291cmNlWzNdICo9IDI1NTtcbiAgICAgICAgcmV0dXJuIF9zb3VyY2U7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBjb2xvcjtcbiAgfSxcbiAgZ2V0Q29sb3I6IGZ1bmN0aW9uICh0eXBlKSB7XG4gICAgdmFyIGNvbG9yID0gdGhpcy51c2VEcmF3aW5nQ29sb3IgJiYgdGhpcy5jYW52YXMuZHJhd2luZ0NvbG9yIHx8IHRoaXMuY29sb3I7XG4gICAgcmV0dXJuIHRoaXMuY29udmVydENvbG9yKGNvbG9yLCB0eXBlKTtcbiAgfVxufSk7XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL2JydXNoZXMvQmFzZUJydXNoLmpzXG4vLyBtb2R1bGUgaWQgPSAxMVxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCIndXNlIHN0cmljdCc7XG5cblxuZmFicmljLk1hZ2ljV2FuZCA9IHJlcXVpcmUoJy4uL3BsdWdpbnMvbWFnaWN3YW5kJyk7XG5cbiAgLyoqXG4gICAqIFBlbmNpbEJydXNoIGNsYXNzXG4gICAqIEBjbGFzcyBmYWJyaWMuUGVuY2lsQnJ1c2hcbiAgICogQGV4dGVuZHMgZmFicmljLkJhc2VCcnVzaFxuICAgKi9cbiAgZmFicmljLlBhaW50QnVja2V0QnJ1c2ggPSBmYWJyaWMudXRpbC5jcmVhdGVDbGFzcyhmYWJyaWMuQmFzZUJydXNoLCAvKiogQGxlbmRzIGZhYnJpYy5QZW5jaWxCcnVzaC5wcm90b3R5cGUgKi8ge1xuICAgIHR5cGU6ICdwYWludC1idWNrZXQtYnJ1c2gnLFxuICAgIC8qKlxuICAgICAqIENvbnN0cnVjdG9yXG4gICAgICogQHBhcmFtIHtmYWJyaWMuQ2FudmFzfSBjYW52YXNcbiAgICAgKiBAcmV0dXJuIHtmYWJyaWMuUGVuY2lsQnJ1c2h9IEluc3RhbmNlIG9mIGEgcGVuY2lsIGJydXNoXG4gICAgICovXG4gICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oY2FudmFzKSB7XG4gICAgICB0aGlzLmNhbGxTdXBlcignaW5pdGlhbGl6ZScsIGNhbnZhcyk7XG4gICAgICB0aGlzLl9wb2ludHMgPSBbXTtcbiAgICB9LFxuICAgIGdldFRhcmdldDogZnVuY3Rpb24oKXtcbiAgICAgIHJldHVybiB0aGlzLmNhbnZhcy5kcmF3aW5nQ29udGV4dDtcbiAgICB9LFxuICAgIG9uTW91c2VVcDogZnVuY3Rpb24oKSB7fSxcbiAgICBvbk1vdXNlTW92ZTogZnVuY3Rpb24oKSB7fSxcbiAgICBvbk1vdXNlRG93bjogZnVuY3Rpb24ocG9pbnRlcikge1xuICAgICAgdGhpcy5fZmlsbChwb2ludGVyKTtcbiAgICB9LFxuICAgIF9maWxsOiBmdW5jdGlvbihwb2ludGVyKXtcbiAgICAgIHBvaW50ZXIgPSB7XG4gICAgICAgIHg6IE1hdGguZmxvb3IocG9pbnRlci54KSxcbiAgICAgICAgeTogTWF0aC5mbG9vcihwb2ludGVyLnkpXG4gICAgICB9O1xuXG4gICAgICB2YXIgaW5mbyA9IHRoaXMuZ2V0VGFyZ2V0KCkuZ2V0SW1hZ2VEYXRhKDAsMCx0aGlzLmdldFRhcmdldCgpLmNhbnZhcy53aWR0aCx0aGlzLmdldFRhcmdldCgpLmNhbnZhcy5oZWlnaHQpO1xuXG4gICAgICBmYWJyaWMuTWFnaWNXYW5kLmZsb29kRmlsbChpbmZvLCBwb2ludGVyLnggLCBwb2ludGVyLnksIDEse30sbnVsbCxmdW5jdGlvbihtYXNrKXtcbiAgICAgICAgdmFyIF9jb2xvciA9IHRoaXMuZ2V0Q29sb3IoJ3NvdXJjZScpO1xuICAgICAgICB2YXIgX3RhcmdldCA9IHRoaXMuZ2V0VGFyZ2V0KCk7XG4gICAgICAgIHZhciBfdyA9IG1hc2suYm91bmRzLm1heFggLSBtYXNrLmJvdW5kcy5taW5YICsgMSwgX2ggPSBtYXNrLmJvdW5kcy5tYXhZIC0gbWFzay5ib3VuZHMubWluWSArIDE7XG4gICAgICAgIHZhciBvbGRJbWFnZURhdGEgPSBfdGFyZ2V0LmdldEltYWdlRGF0YSggbWFzay5ib3VuZHMubWluWCxtYXNrLmJvdW5kcy5taW5ZLF93LCBfaCk7XG5cbiAgICAgICAgbWFzay5yZW5kZXIoX3RhcmdldCx7XG4gICAgICAgICAgaW50ZXJzZWN0aW9uQ29sb3IgOiBfY29sb3IsXG4gICAgICAgICAgZmlsbCA6IF9jb2xvcixcbiAgICAgICAgICBjYWNoZTogZmFsc2UsXG4gICAgICAgICAgbGVmdCA6IG1hc2suYm91bmRzLm1pblgsXG4gICAgICAgICAgdG9wIDogbWFzay5ib3VuZHMubWluWVxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmNhbnZhcy5maXJlKFwiZHJhdzphZnRlclwiLHtcbiAgICAgICAgICB0YXJnZXQ6IHRoaXMuZ2V0VGFyZ2V0KCkgLFxuICAgICAgICAgIHJlZG86IF90YXJnZXQuZ2V0SW1hZ2VEYXRhKCBtYXNrLmJvdW5kcy5taW5YLG1hc2suYm91bmRzLm1pblksX3csIF9oKSxcbiAgICAgICAgICB1bmRvOiBvbGRJbWFnZURhdGEgLFxuICAgICAgICAgIGxlZnQgOiBtYXNrLmJvdW5kcy5taW5YLFxuICAgICAgICAgIHRvcCA6IG1hc2suYm91bmRzLm1pblksXG4gICAgICAgICAgY29sb3I6IHRoaXMuZ2V0Q29sb3IoKS5zbGljZSgpXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICB9LFxuICAgIGdldEhpc3RvcnlSZWNvcmQ6IGZ1bmN0aW9uKGV2ZW50KSB7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGNhbnZhczogICB0aGlzLmNhbnZhcyxcbiAgICAgICAgb2JqZWN0OiAgIGV2ZW50LnRhcmdldCAsXG4gICAgICAgIHR5cGU6ICAgICBcImRyYXc6YnVja2V0XCIsXG4gICAgICAgIGxlZnQ6ICAgICBldmVudC5sZWZ0ICxcbiAgICAgICAgdG9wOiAgICAgIGV2ZW50LnRvcCAsXG4gICAgICAgIHVuZG9EYXRhOiBldmVudC51bmRvLFxuICAgICAgICByZWRvRGF0YTogZXZlbnQucmVkbyxcbiAgICAgICAgY29sb3I6ICAgIHRoaXMuY29udmVydENvbG9yKGV2ZW50LmNvbG9yLFwic291cmNlXCIgICksXG4gICAgICAgIHVuZG86IGZ1bmN0aW9uKF9hY3Rpb24pe1xuICAgICAgICAgIF9hY3Rpb24ub2JqZWN0LnB1dEltYWdlRGF0YShfYWN0aW9uLnVuZG9EYXRhLCBfYWN0aW9uLmxlZnQsX2FjdGlvbi50b3ApO1xuICAgICAgICAgIF9hY3Rpb24uY2FudmFzLnJlbmRlckFsbCgpO1xuICAgICAgICB9LFxuICAgICAgICByZWRvOiBmdW5jdGlvbihfYWN0aW9uKXtcbiAgICAgICAgICBfYWN0aW9uLm9iamVjdC5wdXRJbWFnZURhdGEoX2FjdGlvbi5yZWRvRGF0YSwgX2FjdGlvbi5sZWZ0LF9hY3Rpb24udG9wKTtcbiAgICAgICAgICBfYWN0aW9uLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSk7XG5cbmZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUuZHJhd2luZ1Rvb2xzLlBhaW50QnVja2V0QnJ1c2ggPSB7XG4gIGljb246ICAnZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCwnICsgcmVxdWlyZSgnYmFzZTY0LWxvYWRlciEuLy4uL21lZGlhL3BhaW50LWJ1Y2tldC5zdmcnKSxcbiAgdGl0bGU6ICdCdWNrZXQgQnJ1c2gnXG59O1xuZmFicmljLlNsaWRlQ2FudmFzLnByb3RvdHlwZS5hY3RpdmVEcmF3aW5nVG9vbHMucHVzaChcIlBhaW50QnVja2V0QnJ1c2hcIik7XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL2JydXNoZXMvUGFpbnRCdWNrZXRCcnVzaC5qc1xuLy8gbW9kdWxlIGlkID0gMTJcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiJ3VzZSBzdHJpY3QnO1xuXG5cbiAgLyoqXG4gICAqIFBlbmNpbEJydXNoIGNsYXNzXG4gICAqIEBjbGFzcyBmYWJyaWMuUGVuY2lsQnJ1c2hcbiAgICogQGV4dGVuZHMgZmFicmljLkJhc2VCcnVzaFxuICAgKi9cbiAgZmFicmljLlBhaW50UGVuQnJ1c2ggPSBmYWJyaWMudXRpbC5jcmVhdGVDbGFzcyhmYWJyaWMuQmFzZUJydXNoLCAvKiogQGxlbmRzIGZhYnJpYy5QZW5jaWxCcnVzaC5wcm90b3R5cGUgKi8ge1xuICAgIHR5cGU6ICdwYWludC1wZW4tYnJ1c2gnLFxuXG4gICAgLyoqXG4gICAgICogQ29uc3RydWN0b3JcbiAgICAgKiBAcGFyYW0ge2ZhYnJpYy5DYW52YXN9IGNhbnZhc1xuICAgICAqIEByZXR1cm4ge2ZhYnJpYy5QZW5jaWxCcnVzaH0gSW5zdGFuY2Ugb2YgYSBwZW5jaWwgYnJ1c2hcbiAgICAgKi9cbiAgICBpbml0aWFsaXplOiBmdW5jdGlvbihjYW52YXMpIHtcbiAgICAgIHRoaXMuY2FsbFN1cGVyKCdpbml0aWFsaXplJywgY2FudmFzKTtcbiAgICAgIHRoaXMuX3BvaW50cyA9IFtdO1xuICAgIH0sXG4gICAgZ2V0VGFyZ2V0OiBmdW5jdGlvbigpe1xuICAgICAgcmV0dXJuIHRoaXMuY2FudmFzLmRyYXdpbmdDb250ZXh0O1xuICAgIH0sXG4gICAgLyoqXG4gICAgICogSW5vdm9rZWQgb24gbW91c2UgZG93blxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBwb2ludGVyXG4gICAgICovXG4gICAgb25Nb3VzZURvd246IGZ1bmN0aW9uKHBvaW50ZXIpIHtcbiAgICAgIHRoaXMuX3Jlc2V0KCk7XG4gICAgICB0aGlzLl9maWxsKHBvaW50ZXIpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBJbm92b2tlZCBvbiBtb3VzZSBtb3ZlXG4gICAgICogQHBhcmFtIHtPYmplY3R9IHBvaW50ZXJcbiAgICAgKi9cbiAgICBvbk1vdXNlTW92ZTogZnVuY3Rpb24ocG9pbnRlcikge1xuICAgICAgdGhpcy5fZmlsbChwb2ludGVyKTtcbiAgICB9LFxuICAgIC8qKlxuICAgICAqIEludm9rZWQgb24gbW91c2UgdXBcbiAgICAgKi9cbiAgICBvbk1vdXNlVXA6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5jYW52YXMuZmlyZShcImRyYXc6YWZ0ZXJcIix7XG4gICAgICAgIHRhcmdldDogdGhpcy5nZXRUYXJnZXQoKSAsXG4gICAgICAgIHBvaW50czogdGhpcy5fcG9pbnRzLnNsaWNlKCkgLFxuICAgICAgICBjb2xvcjogdGhpcy5nZXRDb2xvcignc291cmNlJylcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgX2ZpbGw6IGZ1bmN0aW9uKHBvaW50ZXIpe1xuICAgICAgcG9pbnRlciA9IHtcbiAgICAgICAgeDogTWF0aC5mbG9vcihwb2ludGVyLngpLFxuICAgICAgICB5OiBNYXRoLmZsb29yKHBvaW50ZXIueSlcbiAgICAgIH07XG5cbiAgICAgIGlmKF8uZmluZFdoZXJlKHRoaXMuX3BvaW50cyxwb2ludGVyKSl7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgLy8gdGhpcy5nZXRUYXJnZXQoKS5maWxsUmVjdChwb2ludGVyLnggLCBwb2ludGVyLnkgICwxLDEpO1xuICAgICAgdmFyIF9kYXRhID0gdGhpcy5nZXRUYXJnZXQoKS5nZXRJbWFnZURhdGEocG9pbnRlci54ICwgcG9pbnRlci55ICAsMSwxKTtcbiAgICAgIHBvaW50ZXIuY29sb3IgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChfZGF0YS5kYXRhKTtcbiAgICAgIHRoaXMuX3BvaW50cy5wdXNoKHBvaW50ZXIpO1xuICAgICAgdmFyIF9jb2xvciA9IHRoaXMuZ2V0Q29sb3IoJ3NvdXJjZScpO1xuXG5cblxuXG4gICAgICBfZGF0YS5kYXRhWzBdID0gX2NvbG9yWzBdO1xuICAgICAgX2RhdGEuZGF0YVsxXSA9IF9jb2xvclsxXTtcbiAgICAgIF9kYXRhLmRhdGFbMl0gPSBfY29sb3JbMl07XG4gICAgICBfZGF0YS5kYXRhWzNdID0gX2NvbG9yWzNdO1xuXG4gICAgICB0aGlzLmdldFRhcmdldCgpLnB1dEltYWdlRGF0YShfZGF0YSwgcG9pbnRlci54ICwgcG9pbnRlci55KTtcbiAgICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgIH0sXG4gICAgdW5kb1BhaW50QWN0aW9uOiBmdW5jdGlvbihfYWN0aW9uKXtcbiAgICAgIHZhciBjdHggPSBfYWN0aW9uLm9iamVjdDtcbiAgICAgIGZvcih2YXIgaSBpbiBfYWN0aW9uLnBvaW50cyl7XG4gICAgICAgIHZhciBfcCAgPV9hY3Rpb24ucG9pbnRzW2ldLCBfYyA9IF9hY3Rpb24uYnJ1c2guZ2V0QWN0aW9uQ29sb3IoX3AuY29sb3IpO1xuICAgICAgICBpZihfY1szXSA9PSAwKSB7XG4gICAgICAgICAgY3R4LmNsZWFyUmVjdChfcC54LF9wLnkgICwxLDEpO1xuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICBjdHguZmlsbFN0eWxlID0gXCJyZ2JhKFwiICsgX2NbMF0gKyBcIixcIiArIF9jWzFdICsgXCIsXCIgKyBfY1syXSArIFwiLFwiICsgX2NbM10gKyAgXCIpXCI7XG4gICAgICAgICAgY3R4LmZpbGxSZWN0KF9wLngsX3AueSAgLDEsMSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIF9hY3Rpb24uY2FudmFzLnJlbmRlckFsbCgpO1xuICAgIH0sXG4gICAgcmVkb1BhaW50QWN0aW9uOiBmdW5jdGlvbihfYWN0aW9uKXtcblxuICAgICAgdmFyIGN0eCA9IF9hY3Rpb24ub2JqZWN0LCBfYyA9IF9hY3Rpb24uYnJ1c2guZ2V0QWN0aW9uQ29sb3IoX2FjdGlvbi5jb2xvcik7XG4gICAgICB2YXIgcHRzID0gX2FjdGlvbi5wb2ludHM7XG4gICAgICBpZihfY1szXSA9PSAwKSB7XG4gICAgICAgIGZvcih2YXIgaSBpbiBwdHMpe1xuICAgICAgICAgIGN0eC5jbGVhclJlY3QocHRzW2ldLngscHRzW2ldLnkgICwxLDEpO1xuICAgICAgICB9XG4gICAgICB9ZWxzZXtcbiAgICAgICAgY3R4LmZpbGxTdHlsZSA9IFwicmdiYShcIiArIF9jWzBdICsgXCIsXCIgKyBfY1sxXSArIFwiLFwiICsgX2NbMl0gKyBcIixcIiArIF9jWzNdICsgXCIpXCI7XG4gICAgICAgIGZvcih2YXIgaSBpbiBwdHMpe1xuICAgICAgICAgIGN0eC5maWxsUmVjdChwdHNbaV0ueCxwdHNbaV0ueSAsMSwxKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgX2FjdGlvbi5jYW52YXMucmVuZGVyQWxsKCk7XG4gICAgfSxcbiAgICAvKipcbiAgICAgKiBDbGVhciBwb2ludHMgYXJyYXkgYW5kIHNldCBjb250ZXh0VG9wIGNhbnZhcyBzdHlsZS5cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIF9yZXNldDogZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLl9wb2ludHMubGVuZ3RoID0gMDtcbiAgICAgIHRoaXMuZ2V0VGFyZ2V0KCkuZmlsbFN0eWxlID0gdGhpcy5jb2xvcjtcbiAgICB9LFxuICAgIGdldEhpc3RvcnlSZWNvcmQ6IGZ1bmN0aW9uKGV2ZW50KXtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgY2FudmFzOiAgIHRoaXMuY2FudmFzLFxuICAgICAgICB0eXBlOiAgICAgXCJkcmF3OnBlblwiLFxuICAgICAgICBvYmplY3Q6ICAgZXZlbnQudGFyZ2V0ICxcbiAgICAgICAgcG9pbnRzOiAgIGV2ZW50LnBvaW50cyAsXG4gICAgICAgIGJydXNoOiAgIHRoaXMsXG4gICAgICAgIGNvbG9yOiAgICBldmVudC5jb2xvcixcbiAgICAgICAgdW5kbzogICAgIHRoaXMudW5kb1BhaW50QWN0aW9uLFxuICAgICAgICByZWRvOiAgICAgdGhpcy5yZWRvUGFpbnRBY3Rpb25cbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuXG5mYWJyaWMuU2xpZGVDYW52YXMucHJvdG90eXBlLmRyYXdpbmdUb29scy5QYWludFBlbkJydXNoID0ge1xuICBjbGFzc05hbWU6ICdmYSBmYS1wYWludC1icnVzaCcsXG4gIHRpdGxlOiAnUGVuIEJydXNoJ1xufTtcbmZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUuYWN0aXZlRHJhd2luZ1Rvb2xzLnB1c2goXCJQYWludFBlbkJydXNoXCIpO1xuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9icnVzaGVzL1BhaW50UGVuQnJ1c2guanNcbi8vIG1vZHVsZSBpZCA9IDEzXG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIlxuXG5mYWJyaWMuUGVuY2lsQnJ1c2gucHJvdG90eXBlLmluaXRpYWxpemUgPSBmdW5jdGlvbihjYW52YXMpIHtcbiAgdGhpcy5jYWxsU3VwZXIoJ2luaXRpYWxpemUnLCBjYW52YXMpO1xuICB0aGlzLl9wb2ludHMgPSBbIF07XG59O1xuZmFicmljLlBlbmNpbEJydXNoLnByb3RvdHlwZS50eXBlID0gJ3BlbmNpbC1icnVzaCc7XG5cbmZhYnJpYy5QZW5jaWxCcnVzaC5wcm90b3R5cGUuX3JlbmRlciA9IGZ1bmN0aW9uKCkge1xuICB2YXIgY3R4ICA9IHRoaXMuY2FudmFzLmNvbnRleHRUb3AsIHYgPSB0aGlzLmNhbnZhcy52aWV3cG9ydFRyYW5zZm9ybSwgcDEgPSB0aGlzLl9wb2ludHNbMF0sIHAyID0gdGhpcy5fcG9pbnRzWzFdO1xuICBjdHguc2F2ZSgpO1xuICBjdHgudHJhbnNmb3JtKHZbMF0sIHZbMV0sIHZbMl0sIHZbM10sIHZbNF0sIHZbNV0pO1xuICBjdHguYmVnaW5QYXRoKCk7XG4gIGN0eC5saW5lV2lkdGggPSAxIC8gdGhpcy5jYW52YXMudmlld3BvcnRUcmFuc2Zvcm1bMF07XG4gIGlmICh0aGlzLl9wb2ludHMubGVuZ3RoID09PSAyICYmIHAxLnggPT09IHAyLnggJiYgcDEueSA9PT0gcDIueSkge1xuICAgIHAxLnggLT0gMC41IC8gdGhpcy5jYW52YXMudmlld3BvcnRUcmFuc2Zvcm1bMF07XG4gICAgcDIueCArPSAwLjUgLyB0aGlzLmNhbnZhcy52aWV3cG9ydFRyYW5zZm9ybVswXTtcbiAgfVxuICBjdHgubW92ZVRvKHAxLngsIHAxLnkpO1xuICBmb3IgKHZhciBpID0gMSwgbGVuID0gdGhpcy5fcG9pbnRzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgdmFyIG1pZFBvaW50ID0gcDEubWlkUG9pbnRGcm9tKHAyKTtcbiAgICBjdHgucXVhZHJhdGljQ3VydmVUbyhwMS54LCBwMS55LCBtaWRQb2ludC54LCBtaWRQb2ludC55KTtcbiAgICBwMSA9IHRoaXMuX3BvaW50c1tpXTtcbiAgICBwMiA9IHRoaXMuX3BvaW50c1tpICsgMV07XG4gIH1cbiAgY3R4LmxpbmVUbyhwMS54LCBwMS55KTtcbiAgY3R4LnN0cm9rZSgpO1xuICBjdHgucmVzdG9yZSgpO1xufTtcblxuZmFicmljLlBlbmNpbEJydXNoLnByb3RvdHlwZS5jcmVhdGVQYXRoID0gZnVuY3Rpb24ocGF0aERhdGEpIHtcbiAgdmFyIHBhdGggPSBuZXcgZmFicmljLlBhdGgocGF0aERhdGEsIHtcbiAgICBzdHJva2U6IHRoaXMuZ2V0Q29sb3IoKSxcbiAgICBzdHJva2VXaWR0aDogdGhpcy53aWR0aCxcbiAgICBhcHBsaWNhdGlvbjogdGhpcy5jYW52YXMuYXBwbGljYXRpb25cbiAgfSk7XG4gIGlmICh0aGlzLnNoYWRvdykge1xuICAgIHRoaXMuc2hhZG93LmFmZmVjdFN0cm9rZSA9IHRydWU7XG4gICAgcGF0aC5zZXRTaGFkb3codGhpcy5zaGFkb3cpO1xuICB9XG4gIHJldHVybiBwYXRoO1xufTtcbmZhYnJpYy5QZW5jaWxCcnVzaC5wcm90b3R5cGUubWluTGVuZ3RoID0gMztcblxuZmFicmljLlBlbmNpbEJydXNoLnByb3RvdHlwZS5hY2N1cmFjeSA9IDA7XG5mYWJyaWMuUGVuY2lsQnJ1c2gucHJvdG90eXBlLl9maW5hbGl6ZUFuZEFkZFBhdGggPSBmdW5jdGlvbigpIHtcbiAgaWYodGhpcy5fcG9pbnRzLmxlbmd0aCA8IDIpcmV0dXJuO1xuICB2YXIgY3R4ID0gdGhpcy5jYW52YXMuY29udGV4dFRvcDtcbiAgY3R4LmNsb3NlUGF0aCgpO1xuICB0aGlzLmNhbnZhcy5jbGVhckNvbnRleHQodGhpcy5jYW52YXMuY29udGV4dFRvcCk7XG4gIGlmKHRoaXMuYWNjdXJhY3kpe1xuICAgIGZvcih2YXIgaSBpbiB0aGlzLl9wb2ludHMpe1xuICAgICAgdGhpcy5fcG9pbnRzW2ldLnggPSArdGhpcy5fcG9pbnRzW2ldLngudG9GaXhlZCh0aGlzLmFjY3VyYWN5KTtcbiAgICAgIHRoaXMuX3BvaW50c1tpXS55ID0gK3RoaXMuX3BvaW50c1tpXS55LnRvRml4ZWQodGhpcy5hY2N1cmFjeSk7XG4gICAgfVxuICAgIGZvcihpID0gdGhpcy5fcG9pbnRzLmxlbmd0aCAtIDE7IGktLTsgKXtcbiAgICAgIGlmKHRoaXMuX3BvaW50c1tpXS54ID09IHRoaXMuX3BvaW50c1tpICsgMV0ueCAmJiAgdGhpcy5fcG9pbnRzW2ldLnkgPT0gdGhpcy5fcG9pbnRzW2kgKyAxXS55KXtcbiAgICAgICAgdGhpcy5fcG9pbnRzLnNwbGljZShpLDEpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBpZih0aGlzLl9wb2ludHMubGVuZ3RoIDwgMilyZXR1cm47XG4gIHZhciBwYXRoRGF0YSA9IHRoaXMuY29udmVydFBvaW50c1RvU1ZHUGF0aCh0aGlzLl9wb2ludHMpLmpvaW4oJycpO1xuICBpZiAodGhpcy5fcG9pbnRzLmxlbmd0aCA8IHRoaXMubWluTGVuZ3RoIHx8IHBhdGhEYXRhID09PSAnTSAwIDAgUSAwIDAgMCAwIEwgMCAwJykge1xuICAgIHJldHVybiB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgfVxuICB2YXIgcGF0aCA9IHRoaXMuY3JlYXRlUGF0aChwYXRoRGF0YSk7XG4gIHRoaXMuY2FudmFzLmFkZChwYXRoKTtcbiAgcGF0aC5zZXRDb29yZHMoKTtcbiAgdGhpcy5fcmVzZXRTaGFkb3coKTtcbiAgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gIHRoaXMuY2FudmFzLmZpcmUoJ3BhdGg6Y3JlYXRlZCcsIHsgcGF0aDogcGF0aCB9KTtcbn07XG5cblxuZmFicmljLlNsaWRlQ2FudmFzLnByb3RvdHlwZS5kcmF3aW5nVG9vbHMuUGVuY2lsQnJ1c2ggPSB7XG4gIGNsYXNzTmFtZTogJ2ZhIGZhLXBlbmNpbCcsXG4gIHRpdGxlOiAnUGVuY2lsIEJydXNoJ1xufTtcbmZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUuYWN0aXZlRHJhd2luZ1Rvb2xzLnB1c2goXCJQZW5jaWxCcnVzaFwiKTtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vYnJ1c2hlcy9QZW5jaWxCcnVzaC5qc1xuLy8gbW9kdWxlIGlkID0gMTRcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiJ3VzZSBzdHJpY3QnO1xuXG5mYWJyaWMuUG9pbnRzQnJ1c2ggPSBmYWJyaWMudXRpbC5jcmVhdGVDbGFzcyhmYWJyaWMuQmFzZUJydXNoLCB7XG4gIHR5cGU6IFwicG9pbnRzLWJydXNoXCIsXG4gIG1heGltdW1Qb2ludHMgOiAwLFxuICBpbml0aWFsaXplOiBmdW5jdGlvbiAoY2FudmFzKSB7XG4gICAgdGhpcy5jYWxsU3VwZXIoJ2luaXRpYWxpemUnLCBjYW52YXMpO1xuICAgIHRoaXMucmVzZXQoKTtcbiAgfSxcbiAgY3VycmVudFBvaW50IDogMSxcbiAgZ2V0UG9pbnRzOiBmdW5jdGlvbigpe1xuICAgIHJldHVybiBmYWJyaWMudXRpbC5vYmplY3Qud2hlcmUodGhpcy5jYW52YXMuX29iamVjdHMse3R5cGU6IFwibWF0ZXJpYWwtcG9pbnRcIn0pO1xuICB9LFxuICBjaGVja1Bvc2l0aW9uOiBudWxsLFxuICBvbk1vdXNlRG93bjogZnVuY3Rpb24gKHBvaW50ZXIpIHtcblxuICB9LFxuICBvbk1vdXNlTW92ZTogZnVuY3Rpb24gKHBvaW50ZXIpIHtcbiAgfSxcbiAgcmVzZXQ6IGZ1bmN0aW9uKCl7XG4gIH0sXG4gIG9uTW91c2VVcDogZnVuY3Rpb24gKHBvaW50ZXIpIHtcbiAgICB2YXIgX3BvaW50cyA9IHRoaXMuZ2V0UG9pbnRzKCk7XG5cbiAgICB2YXIgcG9zID0ge1xuICAgICAgbGVmdDogcG9pbnRlci54IC0wLjUsXG4gICAgICB0b3A6IHBvaW50ZXIueSAgLTAuNSxcbiAgICB9O1xuXG4gICAgdmFyIF9jb3JyZWN0ID0gdGhpcy5jaGVja1Bvc2l0aW9uID8gdGhpcy5jaGVja1Bvc2l0aW9uKHBvaW50ZXIpIDogdHJ1ZSA7XG5cbiAgICBpZighX2NvcnJlY3Qpe1xuICAgICAgdGhpcy5jYW52YXMuZmlyZShcInBvaW50OnJlamVjdGVkXCIse3BvaW50IDogcG9pbnRlcn0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmKHRoaXMubWF4aW11bVBvaW50cyAmJiBfcG9pbnRzLmxlbmd0aCA+PSB0aGlzLm1heGltdW1Qb2ludHMpe1xuICAgICAgaWYodGhpcy5jdXJyZW50UG9pbnQgPiB0aGlzLm1heGltdW1Qb2ludHMpe1xuICAgICAgICB0aGlzLmN1cnJlbnRQb2ludCA9IDE7XG4gICAgICB9XG4gICAgICBpZih0aGlzLndob2xlQ29vcmRpbmF0ZXMpe1xuICAgICAgICBwb2ludGVyLnggPSBNYXRoLnJvdW5kKHBvaW50ZXIueCkgKyAwLjU7XG4gICAgICAgIHBvaW50ZXIueSA9IE1hdGgucm91bmQocG9pbnRlci55KSAgKyAwLjU7XG4gICAgICB9XG5cbiAgICAgIHZhciBfb2JqID0gZmFicmljLnV0aWwub2JqZWN0LmZpbmRXaGVyZShfcG9pbnRzLHtudW1iZXIgOiB0aGlzLmN1cnJlbnRQb2ludCsrfSk7XG5cbiAgICAgIHZhciBzdGF0ZXMgPSB7XG4gICAgICAgIG9yaWdpbmFsIDoge1xuICAgICAgICAgIGxlZnQ6IF9vYmoubGVmdCxcbiAgICAgICAgICB0b3A6IF9vYmoudG9wXG4gICAgICAgIH0sXG4gICAgICAgIG1vZGlmaWVkOiAge1xuICAgICAgICAgIGxlZnQ6IHBvaW50ZXIueCAtIDAuNSxcbiAgICAgICAgICB0b3A6IHBvaW50ZXIueSAtIDAuNVxuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICBfb2JqLnNldChzdGF0ZXMubW9kaWZpZWQpLnNldENvb3JkcygpLmZpcmUoXCJtb2RpZmllZFwiLHtzdGF0ZXM6IHN0YXRlc30pO1xuICAgICAgdGhpcy5jYW52YXMuZmlyZShcIm9iamVjdDptb2RpZmllZFwiLHt0YXJnZXQgOiBfb2JqLCBzdGF0ZXM6IHN0YXRlc30pO1xuICAgICAgdGhpcy5jYW52YXMuc2V0QWN0aXZlT2JqZWN0KF9vYmopO1xuICAgICAgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gICAgICByZXR1cm47XG4gICAgfWVsc2V7XG4gICAgICB0aGlzLmN1cnJlbnRQb2ludCA9IDE7XG4gICAgICB3aGlsZShmYWJyaWMudXRpbC5vYmplY3QuZmluZFdoZXJlKF9wb2ludHMse251bWJlciA6IHRoaXMuY3VycmVudFBvaW50fSkpe1xuICAgICAgICB0aGlzLmN1cnJlbnRQb2ludCsrO1xuICAgICAgfVxuICAgIH1cblxuICAgIHZhciBfb2JqID0gbmV3IGZhYnJpYy5NYXRlcmlhbFBvaW50KHtcbiAgICAgIG51bWJlcjogdGhpcy5jdXJyZW50UG9pbnQgLFxuICAgICAgYXBwbGljYXRpb246IHRoaXMuY2FudmFzLmFwcGxpY2F0aW9uLFxuICAgICAgbGVmdDogcG9zLmxlZnQsXG4gICAgICB0b3A6IHBvcy50b3BcbiAgICB9KTtcblxuICAgIHRoaXMuY3VycmVudFBvaW50Kys7XG4gICAgdGhpcy5jYW52YXMuYWRkKF9vYmopO1xuICAgIHRoaXMuY2FudmFzLmZpcmUoXCJwb2ludDpjcmVhdGVkXCIse3BvaW50IDogX29ian0pXG4gICAgdGhpcy5jYW52YXMuc2V0QWN0aXZlT2JqZWN0KF9vYmopO1xuICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICB9LFxuICBfcmVuZGVyOiBmdW5jdGlvbiAoKSB7XG4gIH1cbn0pO1xuXG5mYWJyaWMuU2xpZGVDYW52YXMucHJvdG90eXBlLmRyYXdpbmdUb29scy5Qb2ludHNCcnVzaCA9IHtcbiAgY2xhc3NOYW1lOiAnZmEgZmEtY2lyY2xlLW8nLFxuICB0aXRsZTogJ1BvaW50cyBCcnVzaCdcbn07XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL2JydXNoZXMvUG9pbnRzQnJ1c2guanNcbi8vIG1vZHVsZSBpZCA9IDE1XG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIid1c2Ugc3RyaWN0JztcblxuXG4gIC8qKlxuICAgKiBQZW5jaWxCcnVzaCBjbGFzc1xuICAgKiBAY2xhc3MgZmFicmljLlJlY3RhbmdsZUJydXNoXG4gICAqIEBleHRlbmRzIGZhYnJpYy5CYXNlQnJ1c2hcbiAgICovXG4gIGZhYnJpYy5Qb2x5Z29uQnJ1c2ggPSBmYWJyaWMudXRpbC5jcmVhdGVDbGFzcyhmYWJyaWMuQmFzZUJydXNoLCAvKiogQGxlbmRzIGZhYnJpYy5SZWN0YW5nbGVCcnVzaC5wcm90b3R5cGUgKi8ge1xuICAgIHJlc3VsdE9iamVjdFR5cGU6IFwiUG9seWxpbmVcIixcbiAgICB0eXBlOiBcInBvbHlnb24tYnJ1c2hcIixcbiAgICB2aXJ0dWFsT2JqZWN0OiBmYWxzZSxcbiAgICBtYXhpbXVtUG9pbnRzIDogMCxcbiAgICBpbmRpdmlkdWFsRHJhd2luZzogdHJ1ZSxcbiAgICAvKipcbiAgICAgKiBDb25zdHJ1Y3RvclxuICAgICAqIEBwYXJhbSB7ZmFicmljLkNhbnZhc30gY2FudmFzXG4gICAgICogQHJldHVybiB7ZmFicmljLlJlY3RhbmdsZUJydXNofSBJbnN0YW5jZSBvZiBhIHBlbmNpbCBicnVzaFxuICAgICAqL1xuICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIChjYW52YXMpIHtcbiAgICAgIHRoaXMuY2FsbFN1cGVyKCdpbml0aWFsaXplJywgY2FudmFzKTtcbiAgICAgIHRoaXMucmVzZXQoKTtcbiAgICB9LFxuICAgIC8qKlxuICAgICAqIElub3Zva2VkIG9uIG1vdXNlIGRvd25cbiAgICAgKiBAcGFyYW0ge09iamVjdH0gcG9pbnRlclxuICAgICAqL1xuICAgIG9uTW91c2VEb3duOiBmdW5jdGlvbiAocG9pbnRlcikge1xuXG5cbiAgICAgIGlmKHRoaXMuaW5kaXZpZHVhbERyYXdpbmcgfHwgIXRoaXMudGFyZ2V0KXtcbiAgICAgICAgdmFyIF9wb2ludCA9IHt4OiBwb2ludGVyLngsIHk6IHBvaW50ZXIueX07XG4gICAgICAgIHRoaXMucG9pbnRzLnB1c2goX3BvaW50KTtcbiAgICAgICAgaWYoIXRoaXMudmlydHVhbE9iamVjdCl7XG4gICAgICAgICAgdGhpcy50YXJnZXQgPSB0aGlzLmNhbnZhcy5jcmVhdGVPYmplY3QoXG4gICAgICAgICAgICBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKHt9LFxuICAgICAgICAgICAgICB0aGlzLnJlc3VsdE9iamVjdFByb3BlcnRpZXMsIHtcbiAgICAgICAgICAgICAgICB0eXBlOiB0aGlzLnJlc3VsdE9iamVjdFR5cGUsXG4gICAgICAgICAgICAgICAgcG9pbnRzOiBbX3BvaW50XSxcbiAgICAgICAgICAgICAgICBhY3RpdmU6IHRydWVcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgKVxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH1lbHNle1xuICAgICAgICB0aGlzLl9jcmVhdGVfYWN0aXZlX3BvaW50KHBvaW50ZXIpO1xuICAgICAgfVxuXG4gICAgICBpZih0aGlzLnZpcnR1YWxPYmplY3QpIHtcbiAgICAgICAgdGhpcy5fc2V0QnJ1c2hTdHlsZXMoKTtcbiAgICAgICAgdGhpcy5fc2V0U2hhZG93KCk7XG4gICAgICAgIHRoaXMuX3JlbmRlcigpO1xuICAgICAgfWVsc2V7XG4gICAgICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICBfY3JlYXRlX2FjdGl2ZV9wb2ludDogZnVuY3Rpb24gKHBvaW50ZXIpIHtcbiAgICAgIHZhciBfcG9pbnQgPSB7eDogcG9pbnRlci54LCB5OiBwb2ludGVyLnl9O1xuICAgICAgdGhpcy5hY3RpdmVQb2ludCA9ICBfcG9pbnQ7XG4gICAgICB0aGlzLmFjdGl2ZVRhcmdldFBvaW50ID0gIHt4OiBwb2ludGVyLnggLSB0aGlzLnRhcmdldC5sZWZ0LCB5IDogcG9pbnRlci55IC0gdGhpcy50YXJnZXQudG9wfTtcbiAgICAgIHRoaXMucG9pbnRzLnB1c2godGhpcy5hY3RpdmVQb2ludCk7XG4gICAgICB0aGlzLnRhcmdldC5hZGRQb2ludCh0aGlzLmFjdGl2ZVRhcmdldFBvaW50KTtcbiAgICB9LFxuICAgIC8qKlxuICAgICAqIElub3Zva2VkIG9uIG1vdXNlIG1vdmVcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gcG9pbnRlclxuICAgICAqL1xuICAgIG9uTW91c2VNb3ZlOiBmdW5jdGlvbiAocG9pbnRlcikge1xuXG5cbiAgICAgIHZhciBfcCA9ICB7eDogcG9pbnRlci54IC0gdGhpcy50YXJnZXQubGVmdCwgeSA6IHBvaW50ZXIueSAtIHRoaXMudGFyZ2V0LnRvcH07XG5cblxuICAgICAgaWYodGhpcy5hY3RpdmVQb2ludCl7XG4gICAgICAgIHRoaXMuYWN0aXZlUG9pbnQueCA9IHBvaW50ZXIueDtcbiAgICAgICAgdGhpcy5hY3RpdmVQb2ludC55ID0gcG9pbnRlci55O1xuICAgICAgICB2YXIgX29yZGVyID0gdGhpcy50YXJnZXQucG9pbnRzLmxlbmd0aCA7XG5cbiAgICAgICAgdGhpcy50YXJnZXQuc2V0UG9pbnQoXCJwXCIgKyBfb3JkZXIsIHtcbiAgICAgICAgICB4IDogcG9pbnRlci54IC0gdGhpcy50YXJnZXQubGVmdCxcbiAgICAgICAgICB5IDogcG9pbnRlci55IC0gdGhpcy50YXJnZXQudG9wXG4gICAgICAgIH0pO1xuICAgICAgfWVsc2V7XG4gICAgICAgIHZhciBfZGlzdCA9IGZhYnJpYy5Qb2ludC5wcm90b3R5cGUuZGlzdGFuY2VGcm9tLmNhbGwodGhpcy5wb2ludHNbMF0sX3ApXG4gICAgICAgIGlmKF9kaXN0ID4gMTApe1xuICAgICAgICAgIHRoaXMuX2NyZWF0ZV9hY3RpdmVfcG9pbnQocG9pbnRlcik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgIH0sXG4gICAgcmVzZXQ6IGZ1bmN0aW9uKCl7XG4gICAgICB0aGlzLnBvaW50cyA9IFtdO1xuICAgICAgdGhpcy50YXJnZXQgPSBudWxsO1xuICAgICAgdGhpcy5hY3RpdmVQb2ludCA9IG51bGw7XG4gICAgICB0aGlzLmFjdGl2ZVRhcmdldFBvaW50ID0gbnVsbDtcbiAgICB9LFxuICAgIC8qKlxuICAgICAqIEludm9rZWQgb24gbW91c2UgdXBcbiAgICAgKi9cbiAgICBvbk1vdXNlVXA6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMudGFyZ2V0LnVwZGF0ZUJib3goKTtcbiAgICAgIGlmKHRoaXMucG9pbnRzLmxlbmd0aCA9PSB0aGlzLm1heGltdW1Qb2ludHMpe1xuICAgICAgICB0aGlzLnJlc2V0KCk7XG4gICAgICB9XG4gICAgICB0aGlzLmFjdGl2ZVBvaW50ID0gbnVsbDtcbiAgICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBEcmF3IGEgc21vb3RoIHBhdGggb24gdGhlIHRvcENhbnZhcyB1c2luZyBxdWFkcmF0aWNDdXJ2ZVRvXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfcmVuZGVyOiBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLmNhbnZhcy5maXJlKFwiYmVmb3JlOmJydXNoOnJlbmRlclwiLHt0YXJnZXQ6IHRoaXN9KTtcblxuICAgICAgdmFyIGN0eCA9IHRoaXMuY2FudmFzLmNvbnRleHRUb3AsXG4gICAgICAgIHYgPSB0aGlzLmNhbnZhcy52aWV3cG9ydFRyYW5zZm9ybTtcblxuICAgICAgY3R4LnNhdmUoKTtcbiAgICAgIGN0eC50cmFuc2Zvcm0odlswXSwgdlsxXSwgdlsyXSwgdlszXSwgdls0XSwgdls1XSk7XG5cbiAgICAgIHZhciBfa2xhc3NfcHJvdG8gPSBmYWJyaWNbdGhpcy5yZXN1bHRPYmplY3RUeXBlXS5wcm90b3R5cGU7XG5cbiAgICAgIGN0eC5saW5lV2lkdGggPSBfa2xhc3NfcHJvdG8uc3Ryb2tlV2lkdGg7XG4gICAgICBjdHguc3Ryb2tlU3R5bGUgPSBfa2xhc3NfcHJvdG8uc3Ryb2tlO1xuICAgICAgY3R4LmZpbGxTdHlsZSA9IF9rbGFzc19wcm90by5maWxsO1xuXG4gICAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgICBjdHgubW92ZVRvKHRoaXMucG9pbnRzWzBdLngsdGhpcy5wb2ludHNbMF0ueSk7XG4gICAgICBmb3IodmFyIGkgPSAxOyBpIDwgdGhpcy5wb2ludHMubGVuZ3RoOyBpKyspe1xuICAgICAgICBjdHgubGluZVRvKHRoaXMucG9pbnRzW2ldLngsdGhpcy5wb2ludHNbaV0ueSlcbiAgICAgIH1cbiAgICAgIGN0eC5jbG9zZVBhdGgoKTtcbiAgICAgIGN0eC5maWxsKCk7XG4gICAgICBjdHguc3Ryb2tlKCk7XG4gICAgICBjdHgucmVzdG9yZSgpO1xuICAgICAgdGhpcy5jYW52YXMuZmlyZShcImJydXNoOnJlbmRlclwiLHt0YXJnZXQ6IHRoaXN9KVxuICAgIH0sXG4gICAgZHJhd2luZ0xpbWl0czogbnVsbCwgLyp7XG4gICAgICBsZWZ0OiAwLFxuICAgICAgd2lkdGg6IDAsXG4gICAgICBoZWlnaHQ6IDAsXG4gICAgICB0b3A6IDBcbiAgICB9LCovXG4gICAgbWluSGVpZ2h0OiA1MCxcbiAgICBtaW5XaWR0aDogNTAsXG4gICAgX2NoZWNrUmVjdGFuZ2xlOiBmdW5jdGlvbihfcmVjdCl7XG5cblxuICAgICAgdmFyIGRsID0gdGhpcy5kcmF3aW5nTGltaXRzO1xuICAgICAgaWYoZGwgJiYgZGwgPT0gXCJiYWNrZ3JvdW5kSW1hZ2VcIil7XG4gICAgICAgIGRsPSB0aGlzLmNhbnZhcy5iYWNrZ3JvdW5kSW1hZ2U7XG4gICAgICB9XG5cbiAgICAgIF9yZWN0ID0ge1xuICAgICAgICBsZWZ0OiBfcmVjdC5sZWZ0LFxuICAgICAgICB0b3A6IF9yZWN0LnRvcCxcbiAgICAgICAgd2lkdGg6IF9yZWN0LndpZHRoLFxuICAgICAgICBoZWlnaHQ6IF9yZWN0LmhlaWdodCxcbiAgICAgIH07XG5cbiAgICAgIF9yZWN0LmxlZnQgIC09IGZhYnJpYy5SZWN0LnByb3RvdHlwZS5zdHJva2VXaWR0aCAvIDI7XG4gICAgICBfcmVjdC50b3AgICAtPSBmYWJyaWMuUmVjdC5wcm90b3R5cGUuc3Ryb2tlV2lkdGggLyAyO1xuXG4gICAgICBpZihkbCl7XG4gICAgICAgIGlmKF9yZWN0LmxlZnQgKyBfcmVjdC53aWR0aCA8IGRsLmxlZnQgfHxcbiAgICAgICAgICBfcmVjdC50b3AgICsgX3JlY3QuaGVpZ2h0IDwgZGwudG9wIHx8XG4gICAgICAgICAgX3JlY3QubGVmdCA+IGRsLndpZHRoIHx8XG4gICAgICAgICAgX3JlY3QudG9wID4gZGwuaGVpZ2h0KXtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICBpZihfcmVjdC50b3AgPCBkbC50b3Ape1xuICAgICAgICAgIF9yZWN0LmhlaWdodCArPV9yZWN0LnRvcCA7XG4gICAgICAgICAgX3JlY3QudG9wID0gZGwudG9wO1xuICAgICAgICB9XG4gICAgICAgIGlmKF9yZWN0LmxlZnQgPCBkbC5sZWZ0KXtcbiAgICAgICAgICBfcmVjdC53aWR0aCArPSBfcmVjdC5sZWZ0O1xuICAgICAgICAgIF9yZWN0LmxlZnQgPSBkbC5sZWZ0O1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmKHRoaXMubWluV2lkdGggJiYgX3JlY3Qud2lkdGggPCB0aGlzLm1pbldpZHRoKXtcbiAgICAgICAgX3JlY3Qud2lkdGggPSB0aGlzLm1pbldpZHRoO1xuICAgICAgfVxuICAgICAgaWYodGhpcy5taW5IZWlnaHQgJiYgX3JlY3QuaGVpZ2h0IDwgdGhpcy5taW5IZWlnaHQpe1xuICAgICAgICBfcmVjdC5oZWlnaHQgPSB0aGlzLm1pbkhlaWdodDtcbiAgICAgIH1cblxuXG4gICAgICBpZihkbCkge1xuICAgICAgICB2YXIgX3hkaWZmID0gX3JlY3QubGVmdCArIF9yZWN0LndpZHRoIC0gZGwud2lkdGg7XG4gICAgICAgIGlmIChfeGRpZmYgPiAwKSB7XG4gICAgICAgICAgX3JlY3Qud2lkdGggLT0gX3hkaWZmO1xuICAgICAgICAgIGlmICh0aGlzLm1pbldpZHRoICYmIF9yZWN0LndpZHRoIDwgdGhpcy5taW5XaWR0aCkge1xuICAgICAgICAgICAgX3JlY3QubGVmdCAtPSB0aGlzLm1pbldpZHRoIC0gX3JlY3Qud2lkdGg7XG4gICAgICAgICAgICBfcmVjdC53aWR0aCA9IHRoaXMubWluV2lkdGg7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHZhciBfeWRpZmYgPSBfcmVjdC50b3AgKyBfcmVjdC5oZWlnaHQgLSBkbC5oZWlnaHQ7XG4gICAgICAgIGlmIChfeWRpZmYgPiAwKSB7XG4gICAgICAgICAgX3JlY3QuaGVpZ2h0IC09IF95ZGlmZjtcbiAgICAgICAgICBpZiAodGhpcy5taW5IZWlnaHQgJiYgX3JlY3QuaGVpZ2h0IDwgdGhpcy5taW5IZWlnaHQpIHtcbiAgICAgICAgICAgIF9yZWN0LnRvcCAtPSB0aGlzLm1pbkhlaWdodCAtIF9yZWN0LmhlaWdodDtcbiAgICAgICAgICAgIF9yZWN0LmhlaWdodCA9IHRoaXMubWluSGVpZ2h0O1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIF9yZWN0O1xuICAgIH0sXG4gICAgcmVzdWx0T2JqZWN0UHJvcGVydGllczoge31cbiAgfSk7XG5cblxuZmFicmljLlNsaWRlQ2FudmFzLnByb3RvdHlwZS5kcmF3aW5nVG9vbHMuUG9seWdvbkJydXNoID0ge1xuICBpY29uOiAnZGF0YTppbWFnZS9wbmc7YmFzZTY0LCcrIHJlcXVpcmUoJ2Jhc2U2NC1sb2FkZXIhLi8uLi9tZWRpYS9wb2x5Z29uLnBuZycpLFxuICB0aXRsZTogJ1BvbHlnb24gQnJ1c2gnXG59O1xuZmFicmljLlNsaWRlQ2FudmFzLnByb3RvdHlwZS5hY3RpdmVEcmF3aW5nVG9vbHMucHVzaChcIlBvbHlnb25CcnVzaFwiKTtcblxuXG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL2JydXNoZXMvUG9seWdvbkJydXNoLmpzXG4vLyBtb2R1bGUgaWQgPSAxNlxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCIndXNlIHN0cmljdCc7XG5cblxuLyoqXG4gKiBQZW5jaWxCcnVzaCBjbGFzc1xuICogQGNsYXNzIGZhYnJpYy5SZWN0YW5nbGVCcnVzaFxuICogQGV4dGVuZHMgZmFicmljLkJhc2VCcnVzaFxuICovXG5mYWJyaWMuUmVjdGFuZ2xlQnJ1c2ggPSBmYWJyaWMudXRpbC5jcmVhdGVDbGFzcyhmYWJyaWMuQmFzZUJydXNoLCAvKiogQGxlbmRzIGZhYnJpYy5SZWN0YW5nbGVCcnVzaC5wcm90b3R5cGUgKi8ge1xuICByZXN1bHRPYmplY3RUeXBlOiBcIlJlY3RcIixcbiAgdHlwZTogXCJyZWN0YW5nbGUtYnJ1c2hcIixcbiAgLyoqXG4gICAqIENvbnN0cnVjdG9yXG4gICAqIEBwYXJhbSB7ZmFicmljLkNhbnZhc30gY2FudmFzXG4gICAqIEByZXR1cm4ge2ZhYnJpYy5SZWN0YW5nbGVCcnVzaH0gSW5zdGFuY2Ugb2YgYSBwZW5jaWwgYnJ1c2hcbiAgICovXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uIChjYW52YXMpIHtcbiAgICB0aGlzLmNhbGxTdXBlcignaW5pdGlhbGl6ZScsIGNhbnZhcyk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIElub3Zva2VkIG9uIG1vdXNlIGRvd25cbiAgICogQHBhcmFtIHtPYmplY3R9IHBvaW50ZXJcbiAgICovXG4gIG9uTW91c2VEb3duOiBmdW5jdGlvbiAocG9pbnRlcikge1xuICAgIC8vcHJlcGFyZSBmb3IgZHJhd2luZ1xuICAgIGRlbGV0ZSB0aGlzLnAyO1xuXG4gICAgdGhpcy5wMSA9IG5ldyBmYWJyaWMuUG9pbnQocG9pbnRlci54LCBwb2ludGVyLnkpO1xuICAgIHRoaXMuX3NldEJydXNoU3R5bGVzKCk7XG4gICAgdGhpcy5fc2V0U2hhZG93KCk7XG4gICAgdGhpcy5jYW52YXMuY29udGV4dFRvcC5tb3ZlVG8odGhpcy5wMS54LCB0aGlzLnAxLnkpO1xuICAgIHRoaXMuX3JlbmRlcigpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBJbm92b2tlZCBvbiBtb3VzZSBtb3ZlXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBwb2ludGVyXG4gICAqL1xuICBvbk1vdXNlTW92ZTogZnVuY3Rpb24gKHBvaW50ZXIpIHtcblxuICAgIHRoaXMucDIgPSBuZXcgZmFicmljLlBvaW50KHBvaW50ZXIueCwgcG9pbnRlci55KTtcblxuICAgIGlmKHRoaXMuZHJhd2luZ09iamVjdCl7XG4gICAgICB2YXIgX3JlY3QgPSB0aGlzLl9nZXRSZWN0KCk7XG4gICAgICB0aGlzLmRyYXdpbmdPYmplY3Quc2V0KF9yZWN0KTtcbiAgICAgIHRoaXMuZHJhd2luZ09iamVjdC5maXJlKFwic2NhbGluZ1wiKTtcbiAgICB9ZWxzZXtcblxuICAgICAgaWYgKHRoaXMucDEueCA9PT0gdGhpcy5wMi54ICYmIHRoaXMucDEueSA9PT0gdGhpcy5wMi55KSB7XG4gICAgICAgIGRlbGV0ZSB0aGlzLnAyO1xuICAgICAgfSBlbHNlIHtcblxuICAgICAgICBpZih0aGlzLnJlc3VsdE9iamVjdFR5cGUpe1xuICAgICAgICAgIHZhciBfcmVjdCA9IHRoaXMuX2dldFJlY3QoKTtcbiAgICAgICAgICB0aGlzLmRyYXdpbmdPYmplY3QgPSB0aGlzLl9jcmVhdGVSZWN0YW5nbGUoX3JlY3QpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHRoaXMuY2FudmFzLnJlbmRlckxheWVyKFwibG93ZXJcIik7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEludm9rZWQgb24gbW91c2UgdXBcbiAgICovXG4gIG9uTW91c2VVcDogZnVuY3Rpb24gKCkge1xuICAgIGlmKHRoaXMuZHJhd2luZ09iamVjdCl7XG4gICAgICB2YXIgX3JlY3QgPSB0aGlzLl9nZXRSZWN0KCk7XG4gICAgICB2YXIgX3JlY3QyID0gdGhpcy5fY2hlY2tSZWN0YW5nbGUoX3JlY3QpO1xuXG4gICAgICB0aGlzLmNhbnZhcy5sYXllcnMubG93ZXIub2JqZWN0cy5zcGxpY2UodGhpcy5jYW52YXMubGF5ZXJzLmxvd2VyLm9iamVjdHMuaW5kZXhPZih0aGlzLmRyYXdpbmdPYmplY3QpLCAxKTtcblxuICAgICAgdGhpcy5kcmF3aW5nT2JqZWN0LnNldChfcmVjdDIpO1xuICAgICAgdGhpcy5jYW52YXMuYWRkKHRoaXMuZHJhd2luZ09iamVjdCk7XG4gICAgICB0aGlzLmNhbnZhcy5zZXRBY3RpdmVPYmplY3QodGhpcy5kcmF3aW5nT2JqZWN0KTtcbiAgICAgIHRoaXMuZHJhd2luZ09iamVjdC5zZXRDb29yZHMoKTtcbiAgICAgIGRlbGV0ZSB0aGlzLmRyYXdpbmdPYmplY3Q7XG4gICAgfVxuICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgIC8vIHRoaXMuX2ZpbmFsaXplQW5kQWRkUGF0aCgpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBEcmF3IGEgc21vb3RoIHBhdGggb24gdGhlIHRvcENhbnZhcyB1c2luZyBxdWFkcmF0aWNDdXJ2ZVRvXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBfcmVuZGVyOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5jYW52YXMuZmlyZShcImJlZm9yZTpicnVzaDpyZW5kZXJcIix7dGFyZ2V0OiB0aGlzfSlcbiAgICBpZiAoIXRoaXMucDIpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdmFyIGN0eCA9IHRoaXMuY2FudmFzLmNvbnRleHRUb3AsXG4gICAgICB2ID0gdGhpcy5jYW52YXMudmlld3BvcnRUcmFuc2Zvcm0sXG4gICAgICBwMSA9IHRoaXMucDEsXG4gICAgICBwMiA9IHRoaXMucDI7XG5cbiAgICBjdHguc2F2ZSgpO1xuICAgIGN0eC50cmFuc2Zvcm0odlswXSwgdlsxXSwgdlsyXSwgdlszXSwgdls0XSwgdls1XSk7XG4gICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgIGlmKHRoaXMuYXBwbGljYXRpb24pe1xuICAgICAgdmFyIF9rbGFzc19wcm90byA9IHRoaXMuYXBwbGljYXRpb24uZ2V0RGVmYXVsdFByb3BlcnRpZXMoZmFicmljW3RoaXMucmVzdWx0T2JqZWN0VHlwZV0ucHJvdG90eXBlKSB8fCB7fTtcbiAgICAgIGN0eC5saW5lV2lkdGggPSBfa2xhc3NfcHJvdG8uc3Ryb2tlV2lkdGg7XG4gICAgICBjdHguc3Ryb2tlU3R5bGUgPSBfa2xhc3NfcHJvdG8uc3Ryb2tlO1xuICAgICAgY3R4LmZpbGxTdHlsZSA9IF9rbGFzc19wcm90by5maWxsO1xuICAgIH1cblxuICAgIHZhciBfcmVjdCA9IHRoaXMuX2dldFJlY3QoKTtcbiAgICBjdHgucmVjdChfcmVjdC5sZWZ0LCBfcmVjdC50b3AsIF9yZWN0LndpZHRoLCBfcmVjdC5oZWlnaHQpO1xuXG4gICAgY3R4LmZpbGwoKTtcbiAgICBjdHguc3Ryb2tlKCk7XG4gICAgY3R4LnJlc3RvcmUoKTtcbiAgICB0aGlzLmNhbnZhcy5maXJlKFwiYnJ1c2g6cmVuZGVyXCIse3RhcmdldDogdGhpc30pXG4gIH0sXG4gIF9nZXRSZWN0OiBmdW5jdGlvbiAoKSB7XG5cbiAgICB2YXIgeDEsIHgyLCB5MSwgeTI7XG4gICAgaWYgKHRoaXMucDEueCA8IHRoaXMucDIueCkge1xuICAgICAgeDEgPSB0aGlzLnAxLngsIHgyID0gdGhpcy5wMi54O1xuICAgIH0gZWxzZSB7XG4gICAgICB4MiA9IHRoaXMucDEueCwgeDEgPSB0aGlzLnAyLng7XG4gICAgfVxuICAgIGlmICh0aGlzLnAxLnkgPCB0aGlzLnAyLnkpIHtcbiAgICAgIHkxID0gdGhpcy5wMS55LCB5MiA9IHRoaXMucDIueTtcbiAgICB9IGVsc2Uge1xuICAgICAgeTIgPSB0aGlzLnAxLnksIHkxID0gdGhpcy5wMi55O1xuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgbGVmdDogeDEsXG4gICAgICB0b3A6IHkxLFxuICAgICAgd2lkdGg6IHgyIC0geDEsXG4gICAgICBoZWlnaHQ6IHkyIC0geTFcbiAgICB9O1xuICB9LFxuICBkcmF3aW5nTGltaXRzOiBudWxsLCAvKntcbiAgIGxlZnQ6IDAsXG4gICB3aWR0aDogMCxcbiAgIGhlaWdodDogMCxcbiAgIHRvcDogMFxuICAgfSwqL1xuICBtaW5IZWlnaHQ6IDUwLFxuICBtaW5XaWR0aDogNTAsXG4gIF9jaGVja1JlY3RhbmdsZTogZnVuY3Rpb24oX3JlY3Qpe1xuXG5cbiAgICB2YXIgZGwgPSB0aGlzLmRyYXdpbmdMaW1pdHM7XG4gICAgaWYoZGwgJiYgZGwgPT0gXCJiYWNrZ3JvdW5kSW1hZ2VcIil7XG4gICAgICBkbD0gdGhpcy5jYW52YXMuYmFja2dyb3VuZEltYWdlO1xuICAgIH1cblxuICAgIF9yZWN0ID0ge1xuICAgICAgbGVmdDogX3JlY3QubGVmdCxcbiAgICAgIHRvcDogX3JlY3QudG9wLFxuICAgICAgd2lkdGg6IF9yZWN0LndpZHRoLFxuICAgICAgaGVpZ2h0OiBfcmVjdC5oZWlnaHQsXG4gICAgfTtcblxuICAgIC8vIF9yZWN0LmxlZnQgIC09IGZhYnJpYy5SZWN0LnByb3RvdHlwZS5zdHJva2VXaWR0aCAvIDI7XG4gICAgLy8gX3JlY3QudG9wICAgLT0gZmFicmljLlJlY3QucHJvdG90eXBlLnN0cm9rZVdpZHRoIC8gMjtcblxuICAgIGlmKGRsKXtcbiAgICAgIGlmKF9yZWN0LmxlZnQgKyBfcmVjdC53aWR0aCA8IGRsLmxlZnQgfHxcbiAgICAgICAgX3JlY3QudG9wICArIF9yZWN0LmhlaWdodCA8IGRsLnRvcCB8fFxuICAgICAgICBfcmVjdC5sZWZ0ID4gZGwud2lkdGggfHxcbiAgICAgICAgX3JlY3QudG9wID4gZGwuaGVpZ2h0KXtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuXG4gICAgICBpZihfcmVjdC50b3AgPCBkbC50b3Ape1xuICAgICAgICBfcmVjdC5oZWlnaHQgKz1fcmVjdC50b3AgO1xuICAgICAgICBfcmVjdC50b3AgPSBkbC50b3A7XG4gICAgICB9XG4gICAgICBpZihfcmVjdC5sZWZ0IDwgZGwubGVmdCl7XG4gICAgICAgIF9yZWN0LndpZHRoICs9IF9yZWN0LmxlZnQ7XG4gICAgICAgIF9yZWN0LmxlZnQgPSBkbC5sZWZ0O1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmKHRoaXMubWluV2lkdGggJiYgX3JlY3Qud2lkdGggPCB0aGlzLm1pbldpZHRoKXtcbiAgICAgIF9yZWN0LndpZHRoID0gdGhpcy5taW5XaWR0aDtcbiAgICB9XG4gICAgaWYodGhpcy5taW5IZWlnaHQgJiYgX3JlY3QuaGVpZ2h0IDwgdGhpcy5taW5IZWlnaHQpe1xuICAgICAgX3JlY3QuaGVpZ2h0ID0gdGhpcy5taW5IZWlnaHQ7XG4gICAgfVxuXG5cbiAgICBpZihkbCkge1xuICAgICAgdmFyIF94ZGlmZiA9IF9yZWN0LmxlZnQgKyBfcmVjdC53aWR0aCAtIGRsLndpZHRoO1xuICAgICAgaWYgKF94ZGlmZiA+IDApIHtcbiAgICAgICAgX3JlY3Qud2lkdGggLT0gX3hkaWZmO1xuICAgICAgICBpZiAodGhpcy5taW5XaWR0aCAmJiBfcmVjdC53aWR0aCA8IHRoaXMubWluV2lkdGgpIHtcbiAgICAgICAgICBfcmVjdC5sZWZ0IC09IHRoaXMubWluV2lkdGggLSBfcmVjdC53aWR0aDtcbiAgICAgICAgICBfcmVjdC53aWR0aCA9IHRoaXMubWluV2lkdGg7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHZhciBfeWRpZmYgPSBfcmVjdC50b3AgKyBfcmVjdC5oZWlnaHQgLSBkbC5oZWlnaHQ7XG4gICAgICBpZiAoX3lkaWZmID4gMCkge1xuICAgICAgICBfcmVjdC5oZWlnaHQgLT0gX3lkaWZmO1xuICAgICAgICBpZiAodGhpcy5taW5IZWlnaHQgJiYgX3JlY3QuaGVpZ2h0IDwgdGhpcy5taW5IZWlnaHQpIHtcbiAgICAgICAgICBfcmVjdC50b3AgLT0gdGhpcy5taW5IZWlnaHQgLSBfcmVjdC5oZWlnaHQ7XG4gICAgICAgICAgX3JlY3QuaGVpZ2h0ID0gdGhpcy5taW5IZWlnaHQ7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIF9yZWN0O1xuICB9LFxuICBfY3JlYXRlUmVjdGFuZ2xlOiBmdW5jdGlvbihyZWN0KXtcbiAgICB0aGlzLmNhbnZhcy5zZXRBY3RpdmVPYmplY3QoZmFsc2UpO1xuICAgIHJlY3QuYWN0aXZlID0gdHJ1ZTtcbiAgICByZWN0LmFwcGxpY2F0aW9uID0gdGhpcy5hcHBsaWNhdGlvbjtcbiAgICByZWN0LmNhbnZhcyA9IHRoaXMuY2FudmFzO1xuICAgIHZhciBfb2JqZWN0ID0gZmFicmljLnV0aWwuY3JlYXRlT2JqZWN0KHRoaXMucmVzdWx0T2JqZWN0VHlwZSxyZWN0KTtcbiAgICB0aGlzLmNhbnZhcy5sYXllcnMubG93ZXIub2JqZWN0cy5wdXNoKF9vYmplY3QpO1xuICAgIF9vYmplY3QudXBkYXRlUmVzcG9uc2l2ZUJvcmRlcigpO1xuICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgIHJldHVybiBfb2JqZWN0O1xuICB9XG5cbiAgLyoqXG4gICAqIE9uIG1vdXNldXAgYWZ0ZXIgZHJhd2luZyB0aGUgcGF0aCBvbiBjb250ZXh0VG9wIGNhbnZhc1xuICAgKiB3ZSB1c2UgdGhlIHBvaW50cyBjYXB0dXJlZCB0byBjcmVhdGUgYW4gbmV3IGZhYnJpYyByZWN0IG9iamVjdFxuICAgKiBhbmQgYWRkIGl0IHRvIHRoZSBmYWJyaWMgY2FudmFzLlxuICAgKi9cbiAgLy8gX2ZpbmFsaXplQW5kQWRkUGF0aDogZnVuY3Rpb24gKCkge1xuICAvL1xuICAvLyAgIGlmICghdGhpcy5wMikge1xuICAvLyAgICAgcmV0dXJuIGZhbHNlO1xuICAvLyAgIH1cbiAgLy8gICB2YXIgY3R4ID0gdGhpcy5jYW52YXMuY29udGV4dFRvcDtcbiAgLy8gICBjdHguY2xvc2VQYXRoKCk7XG4gIC8vXG4gIC8vXG4gIC8vICAgdGhpcy5jYW52YXMuY2xlYXJDb250ZXh0KHRoaXMuY2FudmFzLmNvbnRleHRUb3ApO1xuICAvLyAgIHRoaXMuX3Jlc2V0U2hhZG93KCk7XG4gIC8vXG4gIC8vICAgLy8gdmFyIF9yZWN0ID0gdGhpcy5fZ2V0UmVjdCgpO1xuICAvLyAgIHZhciBfcmVjdDIgPSB0aGlzLl9jaGVja1JlY3RhbmdsZShfcmVjdCk7XG4gIC8vICAgaWYoX3JlY3QyKXtcbiAgLy8gICAgIC8vIGlmKHRoaXMucmVzdWx0T2JqZWN0VHlwZSl7XG4gIC8vICAgICAvLyAgIHRoaXMuX2NyZWF0ZVJlY3RhbmdsZShfcmVjdDIpO1xuICAvLyAgICAgLy8gfVxuICAvLyAgICAgdGhpcy5jYW52YXMuZmlyZSgncmVjdDpjcmVhdGVkJywge3JlY3Q6IF9yZWN0Miwgb3JpZ2luYWw6IF9yZWN0fSk7XG4gIC8vICAgfWVsc2V7XG4gIC8vICAgICB0aGlzLmNhbnZhcy5maXJlKCdyZWN0OnJlamVjdGVkJywge3JlY3Q6IF9yZWN0fSk7XG4gIC8vICAgfVxuICAvLyAgIHRoaXMuY2FudmFzLnJlbmRlckxheWVyKHRoaXMubGF5ZXJzLmxvd2VyKTtcbiAgLy8gfVxufSk7XG5cblxuZmFicmljLlNsaWRlQ2FudmFzLnByb3RvdHlwZS5kcmF3aW5nVG9vbHMuUmVjdGFuZ2xlQnJ1c2ggPSB7XG4gIGNsYXNzTmFtZTogJ2ZhIGZhLXBlbmNpbC1zcXVhcmUnLFxuICB0aXRsZTogJ3NlbGVjdC1icnVzaCdcbn07XG5mYWJyaWMuU2xpZGVDYW52YXMucHJvdG90eXBlLmFjdGl2ZURyYXdpbmdUb29scy5wdXNoKFwiUmVjdGFuZ2xlQnJ1c2hcIik7XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL2JydXNoZXMvUmVjdGFuZ2xlQnJ1c2guanNcbi8vIG1vZHVsZSBpZCA9IDE3XG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIid1c2Ugc3RyaWN0JztcblxuLyoqXG4gKiAjIEFwcGxpY2F0aW9uXG4gKlxuICogZmFyYmljLmFwcCBmdW5jdGlvbiBpcyB0aGUgZW50cnkgcG9pbnQgb2YgRmFicmljSlMgYXBwbGljYXRpb24uXG4gKiBBcHBsaWNhdGlvbiBjb3VsZCBiZSBpbml0aWFsaXNlZCB3aXRoIGNvbmZpZ3VyYXRpb24gb2JqZWN0LiBEaWZmZXJlbnQgZXh0ZW5zaW9ucyBhbGxvd3MgdG8gaW5pdGlhbGl6ZSBzcGVjaWFsIGFwcGxpY2F0aW9uIGF0dHJpYnV0ZXMgc3VjaCBhcyAqb2JqZWN0IHByb3RvdHlwZXMqLCAqcmVzaXphYmxlIGNhbnZhcyosICphdmFpbGFibGUgZm9udHMqLCBldGMuXG4gKlxuICogIyMjIG9wdGlvbjogdXRpbFxuICogbWVkaWFSb290IC0gcm9vdCBkaXJlY3RvcnkgZm9yIGFsbCBtZWRpYSBmaWxlcyBpbiBmYWJyaWMgYXBwbGljYXRpb25cbiAqXG4gKiAjIyMgb3B0aW9uOiByZXNpemFibGVcbiAqIG1ha2VzIGNhbnZhcyByZXNwb25zaWJsZS4gQ2FudmFzIHdpbGwgYmUgc2NhbGVkIHRvIDEwMCUgb2YgaXRzIGNvbnRhaW5lciBzaXplXG4gKlxuICogIyMjIG9wdGlvbjogb25SZXNpemVcbiAqIGZ1bmN0aW9uIHdoaWNoIG92ZXJyaWRlIGRlYWZ1bHQgY2FudmFzIHJlc2l6ZSBiZWhhdmlvci5cbiAqXG4gKiAjIyMgb3B0aW9uOiBjYWxsYmFja1xuICogZnVuY3Rpb24gY2FsbHMgYWZ0ZXIgY2FudmFzIGluaXRpYWxpemVkXG4gKlxuICogIyMjIG9wdGlvbjogaW5pdGlhbGl6ZVxuICogZnVuY3Rpb24gY2FsbHMgYmVmb3JlIGNhbnZhcyBpbml0aWFsaXplXG4gKlxuICogQGV4YW1wbGVcbiAqXG4gKiBuZXcgZmFicmljLkFwcGxpY2F0aW9uKHtcbiAqICAgICAgcmVzaXphYmxlOiB0cnVlLFxuICogICAgICBvblJlc2l6ZTogZnVuY3Rpb24oKXt9LFxuICogICAgICB1dGlsOiB7XG4gKiAgICAgICAgbWVkaWFSb290OiAnLi4vLi4vbWVkaWEvJ1xuICogICAgICB9LFxuICogICAgICBjYW52YXNDb250YWluZXI6IFwiZmllcmEtY2FudmFzXCIsXG4gKiAgICAgIHByb3RvdHlwZXM6IHt9LFxuICogICAgICBvYmplY3RzOiB7fSxcbiAqICAgICAgZXZlbnRMaXN0ZW5lcnM6IHt9LFxuICogICAgICBjYWxsYmFjazogZnVuY3Rpb24oKXt9LFxuICogICAgICBpbml0aWFsaXplOiAgZnVuY3Rpb24oKXt9XG4gKiAgICAgIGN1c3RvbVB1YmxpY0FwcGxpY2F0aW9uRnVuY3Rpb246IGZ1bmN0aW9uKCl7fSxcbiAqICAgICAgY3VzdG9tUHVibGljQXBwbGljYXRpb25BdHRyaWJ1dGU6IHZhbHVlXG4gKiAgfSlcbiAqXG4gKi9cblxuZmFicmljLkFwcGxpY2F0aW9uID0gZnVuY3Rpb24ob3B0aW9ucykge1xuICB0aGlzLmluaXQob3B0aW9ucyk7XG59O1xuXG5mYWJyaWMuQXBwbGljYXRpb24ucHJvdG90eXBlID0gZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCh7fSxmYWJyaWMuT2JzZXJ2YWJsZSx7XG4gIGRlZmF1bHRPcHRpb25zOiB7XG4gICAgLyoqXG4gICAgICogaWQgb2YgdGFyZ2V0IGNhbnZhcyBlbGVtZW50XG4gICAgICovXG4gICAgY2FudmFzQ29udGFpbmVyOiBudWxsXG4gIH0sXG4gIGNyZWRlbnRpYWxzOiBmYWxzZSxcbiAgcmVhZHkgOiBmYWxzZSxcbiAgY2FudmFzQ2xhc3M6ICdDYW52YXMnLFxuICBvcHRpb25zT3JkZXI6IFtcbiAgICBcImNhbnZhc0NvbnRhaW5lclwiLFxuICAgIFwiKlwiLFxuICAgIFwib2JqZWN0c1wiLFxuICAgIFwic2xpZGVcIlxuICBdLFxuICBwbHVnaW5zOiB7XG4gICAgcHJlbG9hZGVyczogW10sXG4gICAgY29uZmlndXJhdGlvbjogW10sXG4gICAgY2FudmFzOiBbXVxuICB9LFxuICAvKipcbiAgICogQWRkaXRpb25hbCBFdmVudCBMaXN0ZW5lcnMgY291bGRiZSB1c2VkIHRvIGRldGVjdCBhY3RpdmVvYmplY3QgY2hhbmdlc1xuICAgKiAgLSBjYW52YXM6Y3JlYXRlZFxuICAgKiAgLSBlbnRpdHk6bG9hZCAtIEV2ZW50IGZpcmVkIG9uIGNyZWF0aW9uIG9mIGV2ZXJ5IG5ldyBmYWJyaWMgaW5zdGFuY2UoY2FudmFzLGJydXNoLG9iamVjdClcbiAgICpcbiAgICogIEBleGFtcGxlXG4gICAqICAnZW50aXR5OmxvYWQnIDogZnVuY3Rpb24oZSl7XG4gICAqICAgICBpZihlLm9wdGlvbnMuYm94VHlwZSA9PSAnbWFjaGluZScpIHtcbiAgICogICAgICAgZS5vcHRpb25zLnR5cGUgPSBcIm1hY2hpbmUtbWFzay1yZWN0YW5nbGVcIjtcbiAgICogICAgIH1cbiAgICogICB9XG4gICAqL1xuICBldmVudExpc3RlbmVyczoge1xuICAgIFwiY2FudmFzOmNyZWF0ZWRcIjogW10sXG4gICAgXCJlbnRpdHk6Y3JlYXRlZFwiOiBbXG4gICAgICBmdW5jdGlvbihlKXtcbiAgICAgICAgaWYoZS50YXJnZXQuZXZlbnRMaXN0ZW5lcnMpe1xuICAgICAgICAgIGZvcih2YXIgaSBpbiBlLnRhcmdldC5ldmVudExpc3RlbmVycykge1xuICAgICAgICAgICAgdmFyIF9saXN0ZW5lcnMgPSBlLnRhcmdldC5ldmVudExpc3RlbmVyc1tpXTtcbiAgICAgICAgICAgIGlmKF9saXN0ZW5lcnMuY29uc3RydWN0b3IgPT0gQXJyYXkpe1xuICAgICAgICAgICAgICBmb3IgKHZhciBqIGluIF9saXN0ZW5lcnMpIHtcbiAgICAgICAgICAgICAgICBlLnRhcmdldC5vbihpLCBfbGlzdGVuZXJzW2pdKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgIGUudGFyZ2V0Lm9uKGksIF9saXN0ZW5lcnMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmKGUub3B0aW9ucy5ldmVudExpc3RlbmVycyl7XG4gICAgICAgICAgZm9yKHZhciBpIGluIGUub3B0aW9ucy5ldmVudExpc3RlbmVycyl7XG4gICAgICAgICAgICBlLnRhcmdldC5vbihpLGUub3B0aW9ucy5ldmVudExpc3RlbmVyc1tpXSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGRlbGV0ZSBlLm9wdGlvbnMuZXZlbnRMaXN0ZW5lcnM7XG5cbiAgICAgICAgaWYoZS50YXJnZXQuX2RlZmF1bHRfZXZlbnRfbGlzdGVuZXJzKXtcbiAgICAgICAgICBmb3IodmFyIGkgaW4gZS50YXJnZXQuX2RlZmF1bHRfZXZlbnRfbGlzdGVuZXJzKXtcbiAgICAgICAgICAgIGUudGFyZ2V0Lm9uKGksZS50YXJnZXQuX2RlZmF1bHRfZXZlbnRfbGlzdGVuZXJzW2ldKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICBdXG4gIH0sXG4gIG9uU2xpZGVMb2FkZWQ6IGZ1bmN0aW9uICgpIHt9LFxuICBvbkNhbnZhc0NyZWF0ZWQ6IGZ1bmN0aW9uICgpIHt9LFxuICBjYWxsYmFjazogZnVuY3Rpb24gKCkge30sXG5cbiAgaW5pdDogZnVuY3Rpb24ob3B0aW9ucyl7XG4gICAgdGhpcy5pbml0RXZlbnRMaXN0ZW5lcnMoKTtcbiAgICBvcHRpb25zID0gIGZhYnJpYy51dGlsLm9iamVjdC5kZWVwRXh0ZW5kKHt9LHRoaXMuZGVmYXVsdE9wdGlvbnMgLG9wdGlvbnMgfHwge30pO1xuXG4gICAgdGhpcy5maXJlKFwibG9hZGluZzpiZWdpblwiLHtvcHRpb25zIDogb3B0aW9uc30pO1xuXG4gICAgdGhpcy5fb3B0aW9ucyA9IG9wdGlvbnM7XG5cblxuICAgICQoIGRvY3VtZW50ICkucmVhZHkoZnVuY3Rpb24oKXtcbiAgICAgIGZhYnJpYy51dGlsLm9yZGVyKFtcbiAgICAgICAgdGhpcy5wcmVsb2FkZXIsXG4gICAgICAgIHRoaXMubG9hZENvbmZpZ3VyYXRpb24sXG4gICAgLy8gICAgdGhpcy5jcmVhdGVBcHAsXG4gICAgICAgIHRoaXMuaW5pdE9wdGlvbnMsXG4gICAgICAgIHRoaXMuaW5pdGlhbGl6ZSxcbiAgICAgICAgdGhpcy5vbkFwcGxpY2F0aW9uQ3JlYXRlZCxcbiAgICAgICAgdGhpcy5wb3N0bG9hZGVyLFxuICAgICAgICB0aGlzLmNhbGxiYWNrICYmIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgc2V0VGltZW91dCh0aGlzLmNhbGxiYWNrLmJpbmQodGhpcyksMCk7XG4gICAgICAgIH0sXG4gICAgICAgIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgdGhpcy5maXJlKFwicmVhZHlcIik7XG4gICAgICAgIH0uYmluZCh0aGlzKVxuICAgICAgXSx0aGlzKVxuICAgIH0uYmluZCh0aGlzKSlcbiAgfSxcbiAgb25BcHBsaWNhdGlvbkNyZWF0ZWQ6IGZ1bmN0aW9uKCl7XG4gICAgdGhpcy5yZWFkeSA9IHRydWU7XG4gICAgdGhpcy5maXJlKFwibG9hZGluZzplbmRcIix7fSk7XG4gIH0sXG4gIHNldENyZWRlbnRpYWxzOiBmdW5jdGlvbihjcmVkZW50aWFscyl7XG4gICAgaWYoY3JlZGVudGlhbHMpe1xuICAgICAgY29uc29sZS5pbmZvKFwiJWNGaWVyYSBDYW52YXMgRWRpdG9yJWMgYnkgJWNEZW5pcyBQb25vbWFyZXYlYyAlYyU2JHMlYyAvICVjJTkkcyVjXCIsIFwiY29sb3I6ICNmZmE1MDBcIiwgXCJjb2xvcjogIzIwMjAyMFwiLCBcImNvbG9yOiAjMkVDMDZDXCIsIFwiY29sb3I6ICMyMDIwMjBcIiwgXCJjb2xvcjogIzMzN2FiN1wiLCBcInd3dy5ob21ldGx0LnJ1XCIsIFwiY29sb3I6ICMyMDIwMjBcIiwgXCJjb2xvcjogIzMzN2FiN1wiLCBcInBvbm9tYXJldnRsdEBnbWFpbC5jb21cIiwgXCJjb2xvcjogIzIwMjAyMFwiKTtcbiAgICB9XG4gIH0sXG4gIGluaXRPcHRpb25zOiBmdW5jdGlvbiAocmVzb2x2ZSxlcnJvcikge1xuICAgIHRoaXMuc2V0KHRoaXMuX29wdGlvbnMscmVzb2x2ZSk7XG4gIH0sXG4gIGxvYWRDb25maWd1cmF0aW9uOiBmdW5jdGlvbiAocmVzb2x2ZSxlcnJvcikge1xuICAgIGlmKCF0aGlzLl9vcHRpb25zLmNvbmZpZ3VyYXRpb24pe1xuICAgICAgcmV0dXJuIHJlc29sdmUoKTtcbiAgICB9XG4gICAgdmFyIF9hcHAgPSB0aGlzO1xuICAgIGZhYnJpYy51dGlsLnByb21pc2VcbiAgICAgIC5tYXAoXG4gICAgICAgIHRoaXMuX29wdGlvbnMuY29uZmlndXJhdGlvbixcbiAgICAgICAgZnVuY3Rpb24odmFsdWUpe1xuICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLGZhaWwpIHtcbiAgICAgICAgICAgIGZhYnJpYy51dGlsLmRhdGEubG9hZEpzb24odmFsdWUscmVzb2x2ZSxmYWlsKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgKVxuICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzdWx0cyl7XG4gICAgICAgIGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoX2FwcC5fb3B0aW9ucyxyZXN1bHRzKVxuICAgICAgfSlcbiAgICAgIC50aGVuKHJlc29sdmUsZXJyb3IpO1xuICB9LFxuICBzZXRDYW52YXNDb250YWluZXI6IGZ1bmN0aW9uIChjYW52YXNDb250YWluZXIpIHtcbiAgICB0aGlzLmNhbnZhc0NvbnRhaW5lciA9IGNhbnZhc0NvbnRhaW5lcjtcblxuICAgIGlmIChjYW52YXNDb250YWluZXIuY29uc3RydWN0b3IgPT0gU3RyaW5nKSB7XG4gICAgICB2YXIgZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjYW52YXNDb250YWluZXIpO1xuICAgIH0gZWxzZSB7XG4gICAgICBlbCA9IGNhbnZhc0NvbnRhaW5lcjtcbiAgICB9XG4gICAgdGhpcy5jYW52YXMgPSBuZXcgZmFicmljW3RoaXMuY2FudmFzQ2xhc3NdKGVsLCB7YXBwbGljYXRpb246IHRoaXN9KTtcbiAgICAvLyB9ZWxzZXtcbiAgICAvLyAgIHRoaXMuY2FudmFzID0gbmV3IGZhYnJpY1t0aGlzLmNhbnZhc0NsYXNzXSh7YXBwbGljYXRpb246IHRoaXN9KTtcbiAgICAvLyB9XG5cbiAgICB0aGlzLmZpcmUoXCJjYW52YXM6Y3JlYXRlZFwiKTtcbiAgICB0aGlzLm9uQ2FudmFzQ3JlYXRlZCgpO1xuICB9LFxuICBkaXNwb3NlOiBmdW5jdGlvbigpe1xuICAgIHRoaXMuY2FudmFzLmRpc3Bvc2UoKTtcbiAgfSxcblxuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIEV2ZW50IExpc3RlbmVyc1xuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgc2V0RXZlbnRMaXN0ZW5lcnM6IGZ1bmN0aW9uKHZhbCl7XG4gICAgdGhpcy5vbih2YWwpO1xuICB9LFxuICBpbml0RXZlbnRMaXN0ZW5lcnM6IGZ1bmN0aW9uKCl7XG4gICAgaWYoIXRoaXMuX19ldmVudExpc3RlbmVycyl7XG4gICAgICB0aGlzLl9fZXZlbnRMaXN0ZW5lcnMgPSB7fTtcbiAgICB9XG4gICAgZm9yICh2YXIgZXZlbnQgaW4gdGhpcy5ldmVudExpc3RlbmVycykge1xuICAgICAgaWYoIXRoaXMuX19ldmVudExpc3RlbmVyc1tldmVudF0pe1xuICAgICAgICB0aGlzLl9fZXZlbnRMaXN0ZW5lcnNbZXZlbnRdID0gW11cbiAgICAgIH1cbiAgICAgIHRoaXMuX19ldmVudExpc3RlbmVyc1tldmVudF0gPSB0aGlzLl9fZXZlbnRMaXN0ZW5lcnNbZXZlbnRdLmNvbmNhdCAodGhpcy5ldmVudExpc3RlbmVyc1tldmVudF0pO1xuICAgIH1cbiAgfSxcblxuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vXG4gIF9fc2V0IDogZmFicmljLk9iamVjdC5wcm90b3R5cGUuX19zZXQsXG4gIF9zZXRPYmplY3Q6IGZhYnJpYy5PYmplY3QucHJvdG90eXBlLl9zZXRPYmplY3QsXG4gIHNldDogZmFicmljLk9iamVjdC5wcm90b3R5cGUuc2V0LFxuICBzZXRPcHRpb25zOiBmYWJyaWMuT2JqZWN0LnByb3RvdHlwZS5zZXRPcHRpb25zLFxuICBhY3Rpb25zOiB7XG4gICAgc2F2ZToge1xuICAgICAgdGl0bGU6IFwic2F2ZSBwcm9qZWN0XCIsXG4gICAgICBjbGFzc05hbWU6ICdmYSBmYS1mbG9wcHktbycsXG4gICAgICBhY3Rpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGRhdGEgPSB0aGlzLnRvT2JqZWN0KCk7XG4gICAgICAgIHRoaXMuYXBwbGljYXRpb24uYXBpLnNhdmUoZGF0YSk7XG4gICAgICB9XG4gICAgfVxuICB9XG59KTtcblxuLy8gZmFicmljLkFwcGxpY2F0aW9uLmFkZFBsdWdpbiA9IGZhYnJpYy5QbHVnaW5zTWl4aW4uYWRkUGx1Z2luLmJpbmQoZmFicmljLkFwcGxpY2F0aW9uKTtcblxuZmFicmljLmFwcCA9IGZ1bmN0aW9uKG9wdGlvbnMpe1xuICByZXR1cm4gbmV3IGZhYnJpYy5BcHBsaWNhdGlvbihvcHRpb25zKTtcbn07XG5cblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vY29yZS9hcHBsaWNhdGlvbi5qc1xuLy8gbW9kdWxlIGlkID0gMThcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiLyoqXG4gKiAjIFByb3RvdHlwZXNcblxuIFByb3RvdHlwZXMgYWxsb3dzIHRvIGRlZmluZSAqKnByb3RvdHlwZXMqKiBwcm9wZXJ0eSBpbiBBcHBsaWNhdGlvbiBjb25maWd1cmF0aW9uLlxuXG4gYGBgamF2YXNjcmlwdFxuIEFwcGxpY2F0aW9uICh7XG4gIHByb3RvdHlwZXM6IHtcbiAgICBDbGFzc05hbWU6IG9wdGlvbnNcbiAgfVxuIH0pXG4gYGBgXG5cbiBJZiBwcm90b3R5cGUgaXMgZGVmaW5lZCBldmVyeSBuZXcgT2JqZWN0IGNyZWF0ZWQgYnkgYXBwbGljYXRpb24gd2lsbCBoYXZlIHRoaXMgcHJvcGVydGllcyBieSBkZWZhdWx0LlxuXG4gYGBgamF2YXNjcmlwdFxuICAgTmV3Q2xhc3M6IHtcbiAgICAkc3VwZXI6IFwiUGFyZW50Q2xhc3NcIixcbiAgICB0eXBlOiBcIm5ldy1jbGFzc1wiLFxuICAgIFxcLypvdGhlciBwcm9wZXJ0aWVzIGFuZCBtZXRob2RzKlxcL1xuICAgfVxuICBgYGBcblxuIGlmIHByb3BlcnR5ICoqdHlwZSoqIG9mIE9iamVjdCBjbGFzcyBpcyBkZWZpbmVkIHRoZW4gZXZlcnkgb2JqZWN0IGJlIGRlZmF1bHQgd2lsbCBoYXZlIHRoaXMgdHlwZS5cblxuIGBgYGphdmFzY3JpcHRcbiAgIE9iamVjdDoge1xuICAgIHR5cGU6IFwicmVjdGFuZ2xlXCJcbiAgIH1cbiAuLi5cbiAvL3JlY3RhbmdsZSB3aWxsIGJlIGNyZWF0ZWRcbiBmYWJyaWMuY3JlYXRlT2JqZWN0KHt3aWR0aDoxMDAsIGhlaWdodDogMTAwfSlcbiBgYGBcbiovXG5cblxuXG5cblxuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5BcHBsaWNhdGlvbi5wcm90b3R5cGUsIHtcbiAgb3B0aW9uc09yZGVyOiAoZnVuY3Rpb24oKXtcbiAgICB2YXIgb28gPSBmYWJyaWMuQXBwbGljYXRpb24ucHJvdG90eXBlLm9wdGlvbnNPcmRlcjtcbiAgICBvby5zcGxpY2Uob28uaW5kZXhPZihcImNhbnZhc0NvbnRhaW5lclwiKSwwLFwicHJvdG90eXBlc1wiKTtcbiAgICByZXR1cm4gb287XG4gIH0pKCksXG4gIGdldERlZmF1bHRQcm9wZXJ0aWVzOiBmdW5jdGlvbihwcm90byl7XG4gICAgaWYoIXRoaXMucHJvdG90eXBlcylyZXR1cm47XG5cbiAgICB2YXIga2xhc3NuYW1lID0gZmFicmljLnV0aWwuc3RyaW5nLmNhcGl0YWxpemUoZmFicmljLnV0aWwuc3RyaW5nLmNhbWVsaXplKHByb3RvLnR5cGUpLHRydWUpO1xuXG4gICAgdmFyIF9wcm90b1Byb3BlcnRpZXMgPSBwcm90by5fX3Byb3RvX18gJiYgcHJvdG8uX19wcm90b19fLnR5cGUgJiYgdGhpcy5nZXREZWZhdWx0UHJvcGVydGllcyhwcm90by5fX3Byb3RvX18pIHx8IHt9O1xuICAgIHZhciBfZGVmYXVsdFByb3BlcnRpZXMgPSBmYWJyaWMudXRpbC5vYmplY3QuY2xvbmUodGhpcy5wcm90b3R5cGVzW2tsYXNzbmFtZV0pO1xuXG4gICAgZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChfcHJvdG9Qcm9wZXJ0aWVzLF9kZWZhdWx0UHJvcGVydGllcyk7XG5cbiAgICByZXR1cm4gX3Byb3RvUHJvcGVydGllcztcbiAgfSxcbiAgLyoqXG4gICAqIGRlZmF1bHQgcHJvdG90eXBlcyBwcm9wZXJ0ZXMgZm9yIG9iamVjdHNcbiAgICovXG4gIHByb3RvdHlwZXM6IHtcbiAgICBPYmplY3Q6IHtcbiAgICAgIGluY2x1ZGVEZWZhdWx0VmFsdWVzOiBmYWxzZVxuICAgIH0sXG4gICAgQ2FudmFzOiB7XG4gICAgICBpbmNsdWRlRGVmYXVsdFZhbHVlczogZmFsc2VcbiAgICB9XG4gIH0sXG4gIHNldFV0aWxzOiBmdW5jdGlvbiAodXRpbHNPcHRpb25zKSB7XG5cbiAgICBpZighdXRpbHNPcHRpb25zKXtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCh0aGlzLnV0aWwgfHwge30sdXRpbHNPcHRpb25zKTtcblxuICAgIGlmICh0aGlzLm9wdGlvbnNbJ3V0aWwnXSkge1xuICAgICAgZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMudXRpbCwgdGhpcy5vcHRpb25zWyd1dGlsJ10pO1xuICAgIH1cbiAgICBpZiAodGhpcy5vcHRpb25zWydmYWJyaWMnXSkge1xuICAgICAgZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMsIHRoaXMub3B0aW9uc1snZmFicmljJ10pO1xuICAgIH1cbiAgICBkZWxldGUgdGhpcy5vcHRpb25zWydmYWJyaWMnXTtcbiAgICBkZWxldGUgdGhpcy5vcHRpb25zWyd1dGlsJ107XG4gIH0sXG4gIHNldFByb3RvdHlwZXM6IGZ1bmN0aW9uIChwcm90b3R5cGVzKSB7XG5cbiAgICB2YXIgX3Byb3RvdHlwZXMgPSBmYWJyaWMudXRpbC5vYmplY3QuZGVlcEV4dGVuZCh7fSwgdGhpcy5wcm90b3R5cGVzICxwcm90b3R5cGVzKTtcblxuICAgIHRoaXMucHJvdG90eXBlcyA9IF9wcm90b3R5cGVzO1xuICAgIHRoaXMua2xhc3NlcyA9IHt9O1xuXG5cbiAgICBpZihfcHJvdG90eXBlcy5ldmVudExpc3RlbmVycyl7XG4gICAgICBfcHJvdG90eXBlcy5ldmVudExpc3RlbmVycy4kZXh0ZW5kID0gJ2FycmF5JztcbiAgICB9XG5cbiAgICBmb3IgKHZhciBrbGFzc05hbWUgaW4gX3Byb3RvdHlwZXMpIHtcbiAgICAgIHZhciBfcHJvdG8gPSBfcHJvdG90eXBlc1trbGFzc05hbWVdO1xuXG4gICAgICBmb3IgKHZhciBqIGluIF9wcm90bykge1xuICAgICAgICBpZiAoX3Byb3RvW2pdICYmIF9wcm90b1tqXVtcIiRleHRlbmRcIl0pIHtcbiAgICAgICAgICB2YXIgX2V4dGVuZCA9IF9wcm90b1tqXVtcIiRleHRlbmRcIl07XG4gICAgICAgICAgaWYoIF9leHRlbmQgPT0gXCJhcnJheVwiKXtcbiAgICAgICAgICAgIF9wcm90b1tqXSA9IGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmRBcnJheXNPYmplY3QoZmFicmljW2tsYXNzTmFtZV0ucHJvdG90eXBlW2pdLF9wcm90b1tqXSk7XG4gICAgICAgICAgfSBlbHNlIGlmKCBfZXh0ZW5kID09IFwiZGVlcFwiKXtcbiAgICAgICAgICAgIF9wcm90b1tqXSA9IGZhYnJpYy51dGlsLm9iamVjdC5kZWVwRXh0ZW5kKGZhYnJpY1trbGFzc05hbWVdLnByb3RvdHlwZVtqXSxfcHJvdG9bal0pO1xuICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgX3Byb3RvW2pdID0gZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWNba2xhc3NOYW1lXS5wcm90b3R5cGVbal0sX3Byb3RvW2pdKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZGVsZXRlIF9wcm90b1tqXVtcIiRleHRlbmRcIl07XG4gICAgICAgIH1cbiAgICAgIH1cblxuXG4gICAgICBpZihfcHJvdG9bXCIkc3VwZXJcIl0pe1xuICAgICAgICB2YXIgX3N1cGVya2xhc3MgPSBmYWJyaWNbX3Byb3RvW1wiJHN1cGVyXCJdIHx8IGtsYXNzTmFtZV0gO1xuICAgICAgICBkZWxldGUgX3Byb3RvW1wiJHN1cGVyXCJdO1xuXG4gICAgICAgIHZhciBfZnJvbU9iamVjdCA9IF9wcm90by5mcm9tT2JqZWN0IHx8IF9zdXBlcmtsYXNzLmZyb21PYmplY3QgO1xuICAgICAgICBkZWxldGUgX3Byb3RvLmZyb21PYmplY3Q7XG4gICAgICAgIHZhciBfa2xhc3MgPSB0aGlzLmtsYXNzZXNba2xhc3NOYW1lXSA9IGZhYnJpYy51dGlsLmNyZWF0ZUNsYXNzKF9zdXBlcmtsYXNzLCBfcHJvdG8pO1xuICAgICAgICBfa2xhc3MuZnJvbU9iamVjdCA9IF9mcm9tT2JqZWN0LmJpbmQoX2tsYXNzKTtcbiAgICAgIH1cblxuICAgIC8vICAgaWYgKGtsYXNzTmFtZS5hY3Rpb25zICYmIF9wcm90by5hY3Rpb25zLmNvbnN0cnVjdG9yID09IEZ1bmN0aW9uKSB7XG4gICAgLy8gICAgIGZhYnJpY1trbGFzc05hbWVdLnByb3RvdHlwZS5hY3Rpb25zID0gX3Byb3RvLmFjdGlvbnMuY2FsbChmYWJyaWNba2xhc3NOYW1lXS5wcm90b3R5cGUpXG4gICAgLy8gICB9XG4gICAgfVxuXG4gICAgaWYgKF9wcm90b3R5cGVzLkFwcGxpY2F0aW9uKSB7XG4gICAgICBmYWJyaWMudXRpbC5vYmplY3QuZGVlcEV4dGVuZCh0aGlzLCBfcHJvdG90eXBlcy5BcHBsaWNhdGlvbik7XG4gICAgfVxuXG4gICAgLy8gZGVsZXRlIHRoaXMub3B0aW9uc1sncHJvdG90eXBlcyddO1xuXG4gICAgaWYgKHRoaXMuYWN0aW9ucyAmJiB0aGlzLmFjdGlvbnMuY29uc3RydWN0b3IgPT0gRnVuY3Rpb24pIHtcbiAgICAgIHRoaXMuYWN0aW9ucyA9IHRoaXMuYWN0aW9ucy5jYWxsKHRoaXMpXG4gICAgfVxuICB9LFxuICBldmVudExpc3RlbmVyczogZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZEFycmF5c09iamVjdChmYWJyaWMuQXBwbGljYXRpb24ucHJvdG90eXBlLmV2ZW50TGlzdGVuZXJzLCB7XG4gICAgXCJlbnRpdHk6Y3JlYXRlZFwiOiBmdW5jdGlvbiAoZSkge1xuICAgICAgdmFyIHRhcmdldCA9IGUudGFyZ2V0O1xuXG4gICAgICB0YXJnZXQuYXBwbGljYXRpb24gPSB0aGlzO1xuICAgICAgZmFicmljLnV0aWwub2JqZWN0LmRlZmF1bHRzKGUub3B0aW9ucywgdGhpcy5nZXREZWZhdWx0UHJvcGVydGllcyh0YXJnZXQsIGUub3B0aW9ucykpO1xuXG4gICAgICBmb3IgKHZhciBrZXkgaW4gZS5vcHRpb25zKSB7XG4gICAgICAgIHZhciB2YWx1ZSA9IGUub3B0aW9uc1trZXldO1xuICAgICAgICBpZiAoa2V5WzBdID09IFwiK1wiKSB7XG4gICAgICAgICAgdmFyIF9rZXkgPSBrZXkuc3Vic3RyKDEpO1xuICAgICAgICAgIHZhciBfYXJyID0gdGFyZ2V0LmdldChfa2V5KTtcbiAgICAgICAgICBpZiAoX2FyciBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICAgICAgICBfYXJyID0gX2Fyci5zbGljZSgpLmNvbmNhdCh2YWx1ZSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIF9hcnIgPSBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKHt9LCBfYXJyLCB2YWx1ZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGUub3B0aW9uc1tfa2V5XSA9IF9hcnI7XG4gICAgICAgICAgZGVsZXRlIGUub3B0aW9uc1trZXldO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGRlbGV0ZSBlLm9wdGlvbnMudHlwZTtcbiAgICAgIGRlbGV0ZSBlLm9wdGlvbnMuYXBwbGljYXRpb247XG4gICAgfVxuICB9KVxufSk7XG5cblxuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9jb3JlL2FwcGxpY2F0aW9uLnByb3RvdHlwZXMuanNcbi8vIG1vZHVsZSBpZCA9IDE5XG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIlxuZmFicmljLlNsaWRlID0gZnVuY3Rpb24oYXBwbGljYXRpb24sIHNsaWRlKXtcblxuXG4gIGlmKGZhYnJpYy5pc0xpa2VseU5vZGUpe1xuICAgIC8vIGZhYnJpYy5DYW52YXMgPSBmYWJyaWMuU2xpZGVDYW52YXM7XG4gICAgdmFyIHcgPSBzbGlkZS5zbGlkZVdpZHRoOyAvL3RvZG98fCBzbGlkZS50ZW1wbGF0ZS53aWR0aDtcbiAgICB2YXIgaCA9IHNsaWRlLnNsaWRlSGVpZ2h0Oy8vdG9kbyB8fCBzbGlkZS50ZW1wbGF0ZS5oZWlnaHQ7XG4gICAgdmFyIHpvb20gPSBmYWJyaWMuU2xpZGVDYW52YXMucHJvdG90eXBlLnpvb20gfHwgMTtcbiAgICB0aGlzLmNhbnZhcyA9IGZhYnJpYy5jcmVhdGVDYW52YXNGb3JOb2RlKHcgKiB6b29tLGggKiB6b29tKTtcbiAgfWVsc2V7XG4gICAgdGhpcy5jYW52YXMgPSAgbmV3IGZhYnJpYy5TbGlkZUNhbnZhcyh7YXBwbGljYXRpb246IGFwcGxpY2F0aW9uLCBpbnRlcmFjdGl2ZTogZmFsc2V9KTtcbiAgfVxuXG4gIHRoaXMub2JqZWN0ID0gc2xpZGU7XG4gLy8gdGhpcy5kYXRhID0gc2xpZGUuZGF0YTtcbiAgdGhpcy5hcHBsaWNhdGlvbiA9IGFwcGxpY2F0aW9uO1xuICB0aGlzLmlkID0gKysgZmFicmljLlNsaWRlLl9zbGlkZXNfaWRfY291bnRlcjtcbn07XG5cbmZhYnJpYy5TbGlkZS5wcm90b3R5cGUgPSBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKHt9LGZhYnJpYy5PYnNlcnZhYmxlLHtcbiAgdGl0bGUgOiAn0J3QvtCy0YvQuSDQodC70LDQudC0J1xufSk7XG5cbmZhYnJpYy5TbGlkZS5fc2xpZGVzX2lkX2NvdW50ZXIgPSAxO1xuXG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLkFwcGxpY2F0aW9uLnByb3RvdHlwZSwge1xuICBkZWZhdWx0T3B0aW9uczogZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuQXBwbGljYXRpb24ucHJvdG90eXBlLmRlZmF1bHRPcHRpb25zLHtcbiAgICBhY3RpdmVTbGlkZTogMFxuICB9KSxcbiAgb3B0aW9uc09yZGVyOiAoZnVuY3Rpb24oKXtcbiAgICB2YXIgb28gPSBmYWJyaWMuQXBwbGljYXRpb24ucHJvdG90eXBlLm9wdGlvbnNPcmRlcjtcbiAgICBvby5wdXNoKFwiYWN0aXZlU2xpZGVcIixcInNsaWRlc1wiKTtcbiAgICByZXR1cm4gb287XG4gIH0pKCksXG4gIGFjdGl2ZVNsaWRlOiAwLFxuICAvKmluaXRpYWxpemU6IGZ1bmN0aW9uIChvcHRpb25zKSB7XG5cbiAgIGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQodGhpcywge1xuICAgbGFzdF9pZDogMSxcbiAgIHNjYWxlVmFsdWU6IDEsXG4gICBhY3RpdmVTbGlkZTogbnVsbCxcbiAgIGhpc3Rvcnk6IG51bGwsXG4gICBzbGlkZXM6IFtdLFxuICAgY2FudmFzOiBudWxsXG4gICB9KTtcblxuICAgdGhpcy5hbGlnbWVudExpbmVYID0gZmFsc2U7XG4gICB0aGlzLmFsaWdtZW50TGluZVkgPSBmYWxzZTtcblxuICAgZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCh0aGlzLG9wdGlvbnMpO1xuICAgZmFicmljLnV0aWwub2JqZWN0LmRlZmF1bHRzKG9wdGlvbnMsdGhpcy5kZWZ1bHRPcHRpb25zKTtcblxuICAgLy8gdGhpcy5zZXRBY2Nlc3ModGhpcy5hY2Nlc3MpO1xuXG4gICBpZihvcHRpb25zLmdyaWRzbmFwcGVyICE9PSB1bmRlZmluZWQpIHtcbiAgIHRoaXMuZ3JpZHNuYXBwZXIgPSBvcHRpb25zLmdyaWRzbmFwcGVyXG4gICB9XG4gICBpZihvcHRpb25zLmhpc3RvcnkgIT09IHVuZGVmaW5lZCkge1xuICAgdGhpcy5oaXN0b3J5ID0gb3B0aW9ucy5oaXN0b3J5O1xuICAgfVxuICAgaWYob3B0aW9ucy5kYXRhKXtcbiAgIHRoaXMuZGF0YSA9IG9wdGlvbnMuZGF0YTtcbiAgIH1cbiAgIGlmKHRoaXMuaGlzdG9yeSkge1xuICAgdGhpcy5oaXN0b3J5ID0gbmV3IEhpc3RvcnkodGhpcyk7XG4gICB0aGlzLmhpc3RvcnkuYXBwbGljYXRpb24gPSB0aGlzLmFwcGxpY2F0aW9uO1xuICAgfVxuXG5cbiAgIGlmKG9wdGlvbnMuY2FudmFzKXtcbiAgIHZhciBfY2FudmFzID0gbmV3IGZhYnJpYy5TbGlkZUNhbnZhcyhkb2N1bWVudC5nZXRFbGVtZW50QnlJZChvcHRpb25zLmNhbnZhcykpO1xuICAgX2NhbnZhcy5hcHBsaWNhdGlvbiA9IHRoaXMuYXBwbGljYXRpb247XG4gICBfY2FudmFzLnByb2plY3QgPSB0aGlzO1xuICAgdGhpcy5zZXRDYW52YXMoX2NhbnZhcyk7XG4gICB9XG5cbiAgIHJldHVybiB0aGlzO1xuICAgfSwqL1xuICBzZXRTbGlkZXM6IGZ1bmN0aW9uIChzbGlkZXMpIHtcbiAgICBzbGlkZXMgPSBmYWJyaWMudXRpbC5vYmplY3QuY2xvbmVEZWVwKHNsaWRlcyk7XG4gICAgdGhpcy5zbGlkZXMgPSBbXTtcblxuICAgIGlmICh0aGlzLmNhbnZhcykge1xuICAgICAgdGhpcy5jYW52YXMuX29iamVjdHMubGVuZ3RoID0gMDtcbiAgICB9XG5cbiAgICBzbGlkZXMuZm9yRWFjaChmdW5jdGlvbihzbGlkZSl7XG4gICAgICB0aGlzLmFkZFNsaWRlKHNsaWRlKVxuICAgIH0uYmluZCh0aGlzKSk7XG5cbiAgICB0aGlzLnByZWxvYWQoKTtcbiAgICB0aGlzLmxhenlMb2FkKCk7XG4gIH0sXG4gIHNldEFjdGl2ZVNsaWRlOiBmdW5jdGlvbihzbGlkZUlkKXtcbiAgICAvLyBjb25zb2xlLmxvZyhcIkAjXCIpO1xuICAgIHJldHVybjtcblxuICAgIGlmKHRoaXMuY2FudmFzLnByb2Nlc3NpbmcpcmV0dXJuO1xuICAgIGlmKHRoaXMuYWN0aXZlU2xpZGUgPT09IHNsaWRlKXJldHVybjtcblxuICAgIHRoaXMuZmlyZShcInNsaWRlOmNoYW5nZTpiZWdpblwiLCB7Y2FudmFzOiB0aGlzLmNhbnZhc30pO1xuICAgIGlmKHRoaXMuYWN0aXZlU2xpZGUpIHtcbiAgICAgIGRlbGV0ZSB0aGlzLmFjdGl2ZVNsaWRlLmNhbnZhcy5taXJyb3JTbGlkZTtcbiAgICB9XG5cbiAgICB0aGlzLnByb2Nlc3NpbmcgPXRydWU7XG4gICAgaWYgKHRoaXMudW5sb2FkVW5hY3RpdmVTbGlkZXMgJiYgdGhpcy5jYW52YXMgJiYgdGhpcy5hY3RpdmVTbGlkZSkge1xuICAgICAgZGVsZXRlIHRoaXMuYWN0aXZlU2xpZGUuY2FudmFzO1xuICAgICAgdGhpcy5hY3RpdmVTbGlkZS5maXJlKFwiY2FudmFzOmNoYW5nZWRcIix7Y2FudmFzOiBudWxsfSk7XG4gICAgICB0aGlzLmFjdGl2ZVNsaWRlLmRhdGEgPSB0aGlzLmNhbnZhcy50b09iamVjdCgpO1xuICAgICAgdGhpcy5jYW52YXMuY2xlYXIoKTtcbiAgICB9XG4gICAgdGhpcy5hY3RpdmVTbGlkZSA9IHNsaWRlO1xuICAgIHRoaXMuYWN0aXZlU2xpZGUuY2FudmFzLm1pcnJvclNsaWRlID0gdGhpcy5jYW52YXM7XG5cblxuXG4gICAgdmFyIF90aGlzID0gdGhpcztcbiAgICB0aGlzLmNhbnZhcy5wcm9jZXNzaW5nID0gdHJ1ZTtcblxuICAgIGlmKHRoaXMuYWN0aXZlU2xpZGUuY2FudmFzLmxvYWRlZCl7XG4gICAgICBfdGhpcy5jYW52YXMubWlycm9yKF90aGlzLmFjdGl2ZVNsaWRlLmNhbnZhcyk7XG4gICAgICBfdGhpcy5jYW52YXMucHJvY2Vzc2luZyA9IGZhbHNlO1xuICAgICAgX3RoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgICAgX3RoaXMuZmlyZShcInNsaWRlOmNoYW5nZWRcIiwge2NhbnZhczogX3RoaXMuY2FudmFzfSk7XG4gICAgICBfdGhpcy5sYXp5TG9hZCgpO1xuICAgIH1lbHNle1xuXG4gICAgICAvLyBfdGhpcy5jYW52YXMuZmlyZShcImxvYWRpbmc6YmVnaW5cIix7dHlwZTpcImN1cnJlbnRcIiAsIHRhcmdldDogX3RoaXMuY2FudmFzfSk7XG4gICAgICB0aGlzLmFjdGl2ZVNsaWRlLmNhbnZhcy5sb2FkKHNsaWRlLm9iamVjdCwgZnVuY3Rpb24gKCkge1xuICAgICAgICBfdGhpcy5jYW52YXMubWlycm9yKF90aGlzLmFjdGl2ZVNsaWRlLmNhbnZhcyk7XG4gICAgICAgIF90aGlzLmNhbnZhcy5wcm9jZXNzaW5nID0gZmFsc2U7XG4gICAgICAgIF90aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICAgICAgX3RoaXMuZmlyZShcInNsaWRlOmNoYW5nZWRcIiwge2NhbnZhczogX3RoaXMuY2FudmFzfSk7XG4gICAgICAgIC8vIF90aGlzLmNhbnZhcy5maXJlKFwibG9hZGluZzplbmRcIix7dHlwZTpcImN1cnJlbnRcIiAsIHRhcmdldDogX3RoaXMuY2FudmFzfSk7XG4gICAgICAgIF90aGlzLmxhenlMb2FkKCk7XG4gICAgICB9KTtcbiAgICB9XG4gIH0sXG4gIHVubG9hZFVuYWN0aXZlU2xpZGVzOiBmYWxzZSxcbiAgbGF6eUxvYWRFbmFibGVkOiB0cnVlLFxuICBsYXp5TG9hZDogZnVuY3Rpb24oKXtcblxuICAgIHZhciBhcHAgPSB0aGlzO1xuICAgIGlmKHRoaXMubGF6eUxvYWRFbmFibGVkKXtcbiAgICAgIHRoaXMuc2xpZGVzLmZvckVhY2goZnVuY3Rpb24oc2xpZGUpe1xuICAgICAgICBpZighc2xpZGUuY2FudmFzLmxvYWRlZCAmJiAhc2xpZGUuY2FudmFzLnByb2Nlc3Npbmcpe1xuICAgICAgICAgIHNsaWRlLmNhbnZhcy5sb2FkKHNsaWRlLm9iamVjdCxmdW5jdGlvbigpe1xuICAgICAgICAgICAgc2xpZGUuZmlyZShcImxvYWRlZFwiKTtcbiAgICAgICAgICAgIGlmKGFwcC5hY3RpdmVTbGlkZSA9PSBzbGlkZS5pZCl7XG4gICAgICAgICAgICAgIHRoaXMuc2V0QWN0aXZlU2xpZGUoc2xpZGUpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBhcHAuZmlyZShcInNsaWRlOmxvYWRpbmc6ZW5kXCIsIHt0YXJnZXQ6IHRoaXN9KTtcblxuICAgICAgICAgICAgZm9yKHZhciBfcyBpbiBhcHAuc2xpZGVzKXtcbiAgICAgICAgICAgICAgaWYoIWFwcC5zbGlkZXNbX3NdLmNhbnZhcy5sb2FkZWQpe1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYXBwLmZpcmUoXCJsb2FkaW5nOmVuZFwiLCB7fSk7XG4gICAgICAgICAgfS5iaW5kKHNsaWRlKSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1lbHNle1xuICAgICAgYXBwLmZpcmUoXCJsb2FkaW5nOmVuZFwiLHt9KTtcbiAgICB9XG4gIH0sXG4gIGFkZFNsaWRlOiBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgIHZhciBzbGlkZSA9IG5ldyBmYWJyaWMuU2xpZGUodGhpcywgb3B0aW9ucyk7XG4gICAgdGhpcy5zbGlkZXMucHVzaChzbGlkZSk7XG4gICAgcmV0dXJuIHNsaWRlO1xuICB9LFxuICByZW1vdmVTbGlkZTogZnVuY3Rpb24gKHNsaWRlKSB7XG4gICAgdmFyIF9zID0gdGhpcy5zbGlkZXM7XG4gICAgdmFyIF9jdXJQb3MgPSBfcy5pbmRleE9mKHNsaWRlKTtcbiAgICBfcy5zcGxpY2UoX2N1clBvcywgMSk7XG5cbiAgICBpZihzbGlkZSA9PSB0aGlzLmFjdGl2ZVNsaWRlKXtcbiAgICAgIGRlbGV0ZSB0aGlzLmFjdGl2ZVNsaWRlIDtcbiAgICB9XG4gIH0sXG4gIC8qKlxuICAgKiBtb3ZlIHNsaWRlIHRvIGFub3RoZXIgcG9zaXRpb25cbiAgICogQHBhcmFtIHNsaWRlXG4gICAqIEBwYXJhbSBuZXdQb3NpdGlvblxuICAgKi9cbiAgbW92ZVNsaWRlOiBmdW5jdGlvbiAoc2xpZGUsbmV3UG9zaXRpb24pIHtcbiAgICB2YXIgX3MgPSB0aGlzLnNsaWRlcztcblxuICAgIHZhciBfY3VyUG9zID0gX3MuaW5kZXhPZihzbGlkZSk7XG4gICAgbmV3UG9zaXRpb24gPSBwYXJzZUludChuZXdQb3NpdGlvbik7XG5cbiAgICBpZiAoX2N1clBvcyA8IG5ld1Bvc2l0aW9uKSB7XG4gICAgICBfcy5zcGxpY2UoX2N1clBvcywgMSk7XG4gICAgICBfcy5zcGxpY2UobmV3UG9zaXRpb24sMCwgc2xpZGUpO1xuICAgIH0gZWxzZSB7XG4gICAgICBfcy5zcGxpY2UoX2N1clBvcywgMSk7XG4gICAgICBfcy5zcGxpY2UobmV3UG9zaXRpb24sIDAsIHNsaWRlKTtcbiAgICB9XG4gIH0sXG4gIC8qKlxuICAgKiByZXBsYWNlIHNsaWRlXG4gICAqIEBwYXJhbSBzbGlkZVxuICAgKiBAcGFyYW0gbmV3UG9zaXRpb24gLSBwb3NpdGlvbiBvZiB0aGUgc2Vjb25kIHNsaWRlXG4gICAqL1xuICByZXBsYWNlU2xpZGU6IGZ1bmN0aW9uIChzbGlkZSxuZXdQb3NpdGlvbikge1xuICAgIHZhciBfcyA9IHRoaXMuc2xpZGVzO1xuICAgIHZhciBfcmVwbGFjZWRTbGlkZSA9IF9zW25ld1Bvc2l0aW9uXTtcbiAgICB2YXIgX2N1clBvcyA9IF9zLmluZGV4T2Yoc2xpZGUpO1xuICAgIGlmIChfY3VyUG9zIDwgbmV3UG9zaXRpb24pIHtcbiAgICAgIF9zLnNwbGljZShuZXdQb3NpdGlvbiwgMSwgc2xpZGUpO1xuICAgICAgX3Muc3BsaWNlKF9jdXJQb3MsIDEsIF9yZXBsYWNlZFNsaWRlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgX3Muc3BsaWNlKF9jdXJQb3MsIDEsIF9yZXBsYWNlZFNsaWRlKTtcbiAgICAgIF9zLnNwbGljZShuZXdQb3NpdGlvbiwgMSwgc2xpZGUpO1xuICAgIH1cbiAgfSxcblxuICBwcmVsb2FkOiBmdW5jdGlvbigpe1xuICAgIGZvcih2YXIgaSBpbiB0aGlzLnNsaWRlcykge1xuICAgICAgdmFyIF9zbGlkZSA9IHRoaXMuc2xpZGVzW2ldO1xuICAgICAgLy8gX3NsaWRlLmNhbnZhcy5wcmVsb2FkKF9zbGlkZS5vYmplY3QsIGZ1bmN0aW9uICgpIHtcbiAgICAgIC8vICAgX3NsaWRlLmZpcmUoXCJtb2RpZmllZFwiKTtcbiAgICAgIC8vIH0pO1xuICAgIH1cbiAgfSxcblxuICBzZXRBY3RpdmVTbGlkZUJ5SW5kZXg6IGZ1bmN0aW9uKGluZGV4KXtcbiAgICB0aGlzLnNldEFjdGl2ZVNsaWRlKHRoaXMuc2xpZGVzW2luZGV4XSlcbiAgfSxcbiAgc2V0QWN0aXZlU2xpZGVCeUlkOiBmdW5jdGlvbihpZCl7XG4gICAgdGhpcy5zZXRBY3RpdmVTbGlkZSggIGZhYnJpYy51dGlsLm9iamVjdC5maW5kV2hlcmUodGhpcy5zbGlkZXMse2lkOiBpZH0pKTtcbiAgfSxcbiAgZHVwbGljYXRlU2xpZGU6IGZ1bmN0aW9uIChzbGlkZURhdGEpIHtcbiAgICBzbGlkZURhdGEgPSBzbGlkZURhdGEuY2FudmFzLnRvT2JqZWN0KCk7XG4gICAgdmFyIF9zbGlkZSA9IHRoaXMuYWRkU2xpZGUoc2xpZGVEYXRhKTtcbiAgICBfc2xpZGUuY2FudmFzLmxvYWQoX3NsaWRlLm9iamVjdCk7XG4gIH0sXG5cbiAgbmV4dFNsaWRlOiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGkgPSB0aGlzLnNsaWRlcy5pbmRleE9mKHRoaXMuYWN0aXZlU2xpZGUpO1xuICAgIGlmIChpIDwgdGhpcy5zbGlkZXMubGVuZ3RoIC0gMSkge1xuICAgICAgdGhpcy5zZXRBY3RpdmVTbGlkZShpICsgMSk7XG4gICAgfVxuICB9LFxuICBwcmV2U2xpZGU6IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgaSA9IHRoaXMuc2xpZGVzLmluZGV4T2YodGhpcy5hY3RpdmVTbGlkZSk7XG4gICAgaWYgKGkgPiAwKSB7XG4gICAgICB0aGlzLnNldEFjdGl2ZVNsaWRlKGkgLSAxKTtcbiAgICB9XG4gIH0sXG4gIGdvdG9TbGlkZTogZnVuY3Rpb24gKHNsaWRlKSB7XG4gICAgdGhpcy5zZXRBY3RpdmVTbGlkZShzbGlkZSAtIDEpO1xuICB9LFxuICBuZXh0U2xpZGVBdmFpbGFibGU6IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgaSA9IHRoaXMuc2xpZGVzLmluZGV4T2YodGhpcy5hY3RpdmVTbGlkZSk7XG4gICAgcmV0dXJuIGkgPCB0aGlzLnNsaWRlcy5sZW5ndGggLSAxXG4gIH0sXG4gIHByZXZTbGlkZUF2YWlsYWJsZTogZnVuY3Rpb24gKCkge1xuICAgIHZhciBpID0gdGhpcy5zbGlkZXMuaW5kZXhPZih0aGlzLmFjdGl2ZVNsaWRlKTtcbiAgICByZXR1cm4gaSA+IDBcbiAgfSxcblxufSk7XG5cblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuU2xpZGVDYW52YXMucHJvdG90eXBlLCB7XG4gIC8qKlxuICAgKiBDb3B5IHRoZSBjb250ZW50IG9mIGFjdGl2ZSBzbGlkZSB0byBtYWluIGNhbnZhcy5cbiAgICogQHBhcmFtIHNsaWRlXG4gICAqL1xuICBtaXJyb3I6IGZ1bmN0aW9uIChzbGlkZSkge1xuICAgIHRoaXMuZGlzY2FyZEFjdGl2ZUdyb3VwKCk7XG4gICAgdGhpcy5kaXNjYXJkQWN0aXZlT2JqZWN0KCk7XG4gICAgLy8gdGhpcy5zbGlkZVdpZHRoID0gc2xpZGUuc2xpZGVXaWR0aDtcbiAgICAvLyB0aGlzLnNsaWRlSGVpZ2h0ID0gc2xpZGUuc2xpZGVIZWlnaHQ7XG4gICAgdGhpcy5zZXRPcmlnaW5hbFNpemUoe3dpZHRoOiBzbGlkZS5vcmlnaW5hbFdpZHRoIHx8IHNsaWRlLndpZHRoLCBoZWlnaHQ6IHNsaWRlLm9yaWdpbmFsSGVpZ2h0IHx8IHNsaWRlLmhlaWdodH0pXG4gICAgdGhpcy5iYWNrZ3JvdW5kSW1hZ2UgPSBzbGlkZS5iYWNrZ3JvdW5kSW1hZ2U7XG5cbiAgICBpZih0aGlzLnJlc2l6YWJsZSkge1xuICAgICAgdGhpcy5vcmlnaW5hbFdpZHRoICA9IHNsaWRlLm9yaWdpbmFsV2lkdGg7XG4gICAgICB0aGlzLm9yaWdpbmFsSGVpZ2h0ICA9IHNsaWRlLm9yaWdpbmFsSGVpZ2h0IDtcbiAgICB9ZWxzZXtcbiAgICAgIHRoaXMuc2V0V2lkdGgoKHNsaWRlLm9yaWdpbmFsV2lkdGggfHwgc2xpZGUud2lkdGgpKiB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzBdKTtcbiAgICAgIHRoaXMuc2V0SGVpZ2h0KChzbGlkZS5vcmlnaW5hbEhlaWdodCB8fCBzbGlkZS5oZWlnaHQpICAqIHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bMF0pO1xuICAgIH1cbiAgICB0aGlzLl9vblJlc2l6ZSgpO1xuICAgIHRoaXMuYWN0aXZlQXJlYSA9IHNsaWRlLmFjdGl2ZUFyZWE7XG4gICAgdGhpcy5vcmlnaW5hbFNsaWRlID0gc2xpZGU7XG5cbiAgICB0aGlzLnRlbXBsYXRlID0gc2xpZGUudGVtcGxhdGU7XG4gICAgdGhpcy5vZmZzZXRzID0gc2xpZGUub2Zmc2V0cztcbiAgICAvLyB0aGlzLl9vYmplY3RzID0gW107XG4gICAgLy8gdGhpcy5sYXllcnMgPSBzbGlkZS5sYXllcnM7XG5cbiAgICBpZih0aGlzLmJhY2tncm91bmRJbWFnZSl7XG4gICAgICB0aGlzLmJhY2tncm91bmRJbWFnZS5jYW52YXMgPSB0aGlzO1xuICAgIH1cbiAgICAvL3RvZG9cbiAgICAvLyBpZih0aGlzLl9iYWNrZ3JvdW5kTGF5ZXIpIHtcbiAgICAvLyAgIGZvciAodmFyIGkgaW4gdGhpcy5fYmFja2dyb3VuZExheWVyKSB7XG4gICAgLy8gICAgIHRoaXMuX2JhY2tncm91bmRMYXllcltpXS5jYW52YXMgPSB0aGlzO1xuICAgIC8vICAgICB0aGlzLl9iYWNrZ3JvdW5kTGF5ZXJbaV0uc2V0Q29vcmRzKCk7XG4gICAgLy8gICB9XG4gICAgLy8gICB0aGlzLnNldEFjdGl2ZUFyZWEodHJ1ZSk7XG4gICAgLy8gfWNkIGZpZXJcblxuICAgIGZvcih2YXIgbGF5ZXJOYW1lIGluIHNsaWRlLmxheWVycykge1xuICAgICAgdGhpcy5sYXllcnNbbGF5ZXJOYW1lXS5vYmplY3RzID0gW107XG4gICAgfVxuICAgIHRoaXMuX29iamVjdHMgPSB0aGlzLmxheWVycy5sb3dlci5vYmplY3RzO1xuXG4gICAgaWYoc2xpZGUubGF5ZXJzKSB7XG4gICAgICBmb3IodmFyIGxheWVyTmFtZSBpbiBzbGlkZS5sYXllcnMpe1xuICAgICAgICBmb3IgKHZhciBpIGluIHNsaWRlLmxheWVyc1tsYXllck5hbWVdLm9iamVjdHMpIHtcbiAgICAgICAgICB0aGlzLmFkZChzbGlkZS5sYXllcnNbbGF5ZXJOYW1lXS5vYmplY3RzW2ldKTtcbiAgICAgICAgfVxuICAgICAgICBzbGlkZS5sYXllcnNbbGF5ZXJOYW1lXS5vYmplY3RzID0gdGhpcy5sYXllcnNbbGF5ZXJOYW1lXS5vYmplY3RzO1xuICAgICAgfVxuICAgICAgc2xpZGUuX29iamVjdHMgPSB0aGlzLl9vYmplY3RzO1xuICAgIH1lbHNle1xuICAgICAgaWYoc2xpZGUuX29iamVjdHMpIHtcbiAgICAgICAgZm9yICh2YXIgaSBpbiBzbGlkZS5fb2JqZWN0cykge1xuICAgICAgICAgIHRoaXMuYWRkKHNsaWRlLl9vYmplY3RzW2ldKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgc2xpZGUuX29iamVjdHMgPSB0aGlzLl9vYmplY3RzO1xuICAgIH1cbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgIHNsaWRlLm9uKCdvYmplY3Q6YWRkZWQnLGZ1bmN0aW9uKGUpe1xuICAgICAgX3RoaXMuYWRkKGUudGFyZ2V0KTtcbiAgICB9KTtcbiAgICB0aGlzLmZpcmUoJ2NoYW5nZWQnLCB7dGFyZ2V0OiBzbGlkZX0pXG4gIH0sXG4gIHByb2plY3Q6IG51bGwsXG4gIHVuaXF1ZTogZmFsc2UsXG4gIHJlcXVpcmVkOiBmYWxzZSxcbiAgc3RhdGVQcm9wZXJ0aWVzOiBbXCJ1bmlxdWVcIixcInJlcXVpcmVkXCJdLFxuICByZW1vdmVTbGlkZTogZnVuY3Rpb24oKXtcbiAgICB0aGlzLnByb2plY3QucmVtb3ZlU2xpZGUodGhpcylcbiAgfSxcbiAgZHVwbGljYXRlU2xpZGU6IGZ1bmN0aW9uKCl7XG4gICAgdGhpcy5wcm9qZWN0LmR1cGxpY2F0ZVNsaWRlKHRoaXMpXG4gIH1cbn0pO1xuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9jb3JlL2FwcGxpY2F0aW9uLnNsaWRlcy5qc1xuLy8gbW9kdWxlIGlkID0gMjBcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiXG5cblxuaWYoIU9iamVjdC52YWx1ZXMpe1xuICBPYmplY3QuZGVmaW5lUHJvcGVydHkoT2JqZWN0LCAndmFsdWVzJywge1xuICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgIGNvbmZpZ3VyYWJsZTogZmFsc2UsXG4gICAgd3JpdGFibGU6IGZhbHNlLFxuICAgIHZhbHVlOiBmdW5jdGlvbihfb2JqZWN0KSB7XG4gICAgICB2YXIgX3ZhbHVlcyA9IFtdO1xuICAgICAgT2JqZWN0LmtleXMoX29iamVjdCkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgIF92YWx1ZXMucHVzaChfb2JqZWN0W2tleV0pO1xuICAgICAgICAvLyB1c2UgdmFsXG4gICAgICB9KTtcbiAgICAgIHJldHVybiBfdmFsdWVzO1xuICAgIH1cbiAgfSk7XG59XG5cblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMse1xuICBlcnJvcnM6IFtdXG59KTtcblxuZmFicmljLnV0aWwub3JkZXIgPSBmdW5jdGlvbihfYXJyYXksY29udGV4dCApe1xuICAoZnVuY3Rpb24gX2NhbGwoKXtcbiAgICBpZighX2FycmF5Lmxlbmd0aClyZXR1cm47XG4gICAgdmFyIGZvbyA9IF9hcnJheS5zaGlmdCgpO1xuICAgIGlmKGZvbyl7XG4gICAgICBpZihmb28ubGVuZ3RoKXtcbiAgICAgICAgZm9vLmNhbGwoY29udGV4dCxfY2FsbCk7XG4gICAgICB9ZWxzZXtcbiAgICAgICAgZm9vLmNhbGwoY29udGV4dCk7XG4gICAgICAgIF9jYWxsKCk7XG4gICAgICB9XG4gICAgfWVsc2V7XG4gICAgICBfY2FsbCgpO1xuICAgIH1cbiAgfSkoKVxufTtcblxuZmFicmljLnV0aWwucHJvbWlzZSA9IHtcbiAgbWFwOiBmdW5jdGlvbiAoZGF0YSwgZm9vKSB7XG5cbiAgICBpZihkYXRhLmNvbnN0cnVjdG9yID09IEFycmF5KXtcbiAgICAgIHJldHVybiBQcm9taXNlLmFsbChkYXRhLm1hcChmb28pKVxuICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzdWx0cywgZXJyb3IpIHtcbiAgICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUocmVzdWx0cyk7XG4gICAgICAgIH0pXG4gICAgfVxuXG4gICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhkYXRhKTtcbiAgICB2YXIgdXJscyA9IE9iamVjdC52YWx1ZXMoZGF0YSk7XG4gICAgcmV0dXJuIFByb21pc2UuYWxsKHVybHMubWFwKGZvbykpXG4gICAgICAudGhlbihmdW5jdGlvbiAocmVzdWx0cywgZXJyb3IpIHtcbiAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgX21hcCA9IHt9O1xuXG4gICAgICAgIGZvcih2YXIgaSA9IDAgOyBpIDwgcmVzdWx0cy5sZW5ndGg7IGkrKyl7XG4gICAgICAgICAgX21hcFtrZXlzW2ldXSA9IHJlc3VsdHNbaV07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShfbWFwKTtcbiAgICAgIH0pXG4gIH0sXG4gIHdyYXA6IGZ1bmN0aW9uIChjb250ZXh0KSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIHdyYXAoZm9vKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgb3B0aW9ucyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywxKTtcbiAgICAgICAgaWYgKCFmb28ubGVuZ3RoKSB7XG4gICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCBmYWlsKSB7XG4gICAgICAgICAgICB2YXIgX3Jlc3VsdCA9IGZvby5jYWxsKGNvbnRleHQpO1xuICAgICAgICAgICAgKF9yZXN1bHQgfHwgX3Jlc3VsdCA9PT0gdW5kZWZpbmVkKSA/IHJlc29sdmUoKSA6IGZhaWwoKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZm9vLmJpbmQoY29udGV4dCkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG59O1xuXG5mYWJyaWMuT2JqZWN0LnByb3RvdHlwZS5zZXQgPSBmdW5jdGlvbihrZXksIHZhbHVlKSB7XG4gIGlmICh0eXBlb2Yga2V5ID09PSAnb2JqZWN0Jykge1xuICAgIHRoaXMuX3NldE9iamVjdChrZXksIHZhbHVlKTtcbiAgfVxuICBlbHNlIHtcbiAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nICYmIGtleSAhPT0gJ2NsaXBUbycpIHtcbiAgICAgIHRoaXMuX3NldChrZXksIHZhbHVlKHRoaXMuZ2V0KGtleSkpKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICB0aGlzLl9zZXQoa2V5LCB2YWx1ZSk7XG4gICAgfVxuICB9XG4gIHJldHVybiB0aGlzO1xufTtcblxuZmFicmljLk9iamVjdC5wcm90b3R5cGUuX3NldE9iamVjdCA9IGZ1bmN0aW9uKG9wdGlvbnMsY2FsbGJhY2spIHtcbiAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhvcHRpb25zKTtcbiAgaWYodGhpcy5vcHRpb25zT3JkZXIpe1xuICAgIHZhciBtaWRkbGVJbmRleCA9IHRoaXMub3B0aW9uc09yZGVyLmluZGV4T2YoXCIqXCIpIHx8IC0xO1xuXG4gICAgdmFyIGkgPSBtaWRkbGVJbmRleCwgcHJvcCAsIGtleUluZGV4O1xuXG4gICAgd2hpbGUoKHByb3AgPSB0aGlzLm9wdGlvbnNPcmRlclstLWldKSl7XG4gICAgICBpZigoa2V5SW5kZXggPSBrZXlzLmluZGV4T2YocHJvcCkpICE9PSAtMSl7XG4gICAgICAgIGtleXMuc3BsaWNlKGtleUluZGV4LCAxKTtcbiAgICAgICAga2V5cy51bnNoaWZ0KHByb3ApO1xuICAgICAgfVxuICAgIH1cbiAgICBpID0gbWlkZGxlSW5kZXg7XG4gICAgd2hpbGUocHJvcCA9IHRoaXMub3B0aW9uc09yZGVyWysraV0pe1xuICAgICAgaWYoKGtleUluZGV4ID0ga2V5cy5pbmRleE9mKHByb3ApKSAhPT0gLTEpe1xuICAgICAgICBrZXlzLnNwbGljZShrZXlJbmRleCwgMSk7XG4gICAgICAgIGtleXMucHVzaChwcm9wKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgfVxuICBmb3IgKHZhciBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHtcbiAgICB2YXIgcHJvcCA9IGtleXNbaV07XG4gICAgaWYodHlwZW9mIG9wdGlvbnNbcHJvcF0gPT0gXCJmdW5jdGlvblwiKXtcbiAgICAgIGtleXMuc3BsaWNlKGksIDEpO1xuICAgICAga2V5cy51bnNoaWZ0KHByb3ApO1xuICAgIH1cbiAgfVxuICB2YXIgcXVldWU7XG4gIGZvciAodmFyIGkgaW4ga2V5cykge1xuICAgIHZhciBfa2V5ID0ga2V5c1tpXTtcbiAgICBpZihvcHRpb25zW19rZXldID09PSB1bmRlZmluZWQgfHwgb3B0aW9uc1tfa2V5XSA9PT0gbnVsbCljb250aW51ZTtcbiAgICB2YXIgX2Zvb05hbWUgPSBcInNldFwiICsgZmFicmljLnV0aWwuc3RyaW5nLmNhcGl0YWxpemUoX2tleSwgdHJ1ZSk7XG4gICAgaWYodGhpc1tfZm9vTmFtZV0gJiYgdGhpc1tfZm9vTmFtZV0ubmFtZSAmJiB0aGlzW19mb29OYW1lXS5uYW1lICE9IFwiYW5vbnltb3VzXCIpe1xuICAgICAgaWYodGhpc1tfZm9vTmFtZV0ubGVuZ3RoID09IDIpe1xuICAgICAgICBpZighcXVldWUpe1xuICAgICAgICAgIHF1ZXVlID0gZmFicmljLnV0aWwucXVldWVMb2FkKDIsY2FsbGJhY2spO1xuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICBxdWV1ZS50b3RhbCArKztcbiAgICAgICAgfVxuICAgICAgICB0aGlzW19mb29OYW1lXShvcHRpb25zW19rZXldLGZ1bmN0aW9uKF9rZXkpe1xuICAgICAgICAgIHF1ZXVlKCk7XG4gICAgICAgIH0uYmluZCh0aGlzLF9rZXkpKTtcbiAgICAgIH1lbHNle1xuICAgICAgICB0aGlzW19mb29OYW1lXShvcHRpb25zW19rZXldKVxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9fc2V0KF9rZXksIG9wdGlvbnNbX2tleV0pO1xuICAgIH1cbiAgfVxuICBpZihxdWV1ZSl7XG4gICAgcXVldWUoKVxuICB9ZWxzZSBpZihjYWxsYmFjayApe1xuICAgIGNhbGxiYWNrKCk7XG4gIH1cbn07XG5cbnZhciBfZ2V0X3BvaW50ZXJfb3ZlcndyaXR0ZW4gPSBmYWJyaWMuQ2FudmFzLnByb3RvdHlwZS5nZXRQb2ludGVyO1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5DYW52YXMucHJvdG90eXBlLCB7XG4gIHNldFdpZHRoOiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICByZXR1cm4gdGhpcy5zZXREaW1lbnNpb25zKHsgd2lkdGg6IHZhbHVlIH0sIHt9KTtcbiAgfSxcbiAgc2V0SGVpZ2h0OiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICByZXR1cm4gdGhpcy5zZXREaW1lbnNpb25zKHsgaGVpZ2h0OiB2YWx1ZSB9LCB7fSk7XG4gIH0sXG4gIC8qKlxuICAgKiBAcHJpdmF0ZVxuICAgKi9cblxuICBfc2V0T2JqZWN0OiBmYWJyaWMuT2JqZWN0LnByb3RvdHlwZS5fc2V0T2JqZWN0LFxuICBvcmlnaW5hbFN0YXRlOiB7fSxcbiAgc3RhdGVQcm9wZXJ0aWVzOiBbXSxcbiAgZWRpdGluZ09iamVjdDogbnVsbCxcbiAgZ2V0T2JqZWN0QnlJRDogZnVuY3Rpb24oX2lkKXtcbiAgICB2YXIgbGF5ZXJzID0gdGhpcy5sYXllcnMgfHwgW3tvYmplY3RzOiB0aGlzLl9vYmplY3RzfV07XG4gICAgZm9yICh2YXIgaSBpbiBsYXllcnMpIHtcbiAgICAgIGZvciAodmFyIGogaW4gbGF5ZXJzW2ldLm9iamVjdHMpIHtcbiAgICAgICAgaWYgKGxheWVyc1tpXS5vYmplY3RzW2pdLmlkID09PSBfaWQpIHtcbiAgICAgICAgICByZXR1cm4gbGF5ZXJzW2ldLm9iamVjdHNbal07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH0sXG4gIC8qXG4gICBBZGQgQ3VzdG9tIE9iamVjdCBUcmFuZm9ybWF0aW9uc1xuICAgKi9cbiAgZ2V0UG9pbnRlcjogZnVuY3Rpb24gKGUsIGlnbm9yZVpvb20sIHVwcGVyQ2FudmFzRWwpIHtcbiAgICB2YXIgcG9pbnRlciA9IF9nZXRfcG9pbnRlcl9vdmVyd3JpdHRlbi5jYWxsKHRoaXMsIGUsIGlnbm9yZVpvb20sIHVwcGVyQ2FudmFzRWwpO1xuICAgIGlmIChlLl9ncm91cCkge1xuICAgICAgcmV0dXJuIHRoaXMuX25vcm1hbGl6ZVBvaW50ZXIoZS5fZ3JvdXAsIHBvaW50ZXIpO1xuICAgIH1cbiAgICByZXR1cm4gcG9pbnRlcjtcbiAgfSxcbiAgX19zZXQgOiBmYWJyaWMuT2JqZWN0LnByb3RvdHlwZS5fc2V0LFxuICBnZXRNb2RpZmllZFN0YXRlczogZnVuY3Rpb24gKHRhcmdldCkge1xuICAgIHZhciBzdGF0ZXMgPSB7XG4gICAgICBvcmlnaW5hbDoge30sXG4gICAgICBtb2RpZmllZDoge31cbiAgICB9O1xuICAgIGZvciAodmFyIHByb3AgaW4gdGFyZ2V0Lm9yaWdpbmFsU3RhdGUpIHtcbiAgICAgIGlmICh0YXJnZXQub3JpZ2luYWxTdGF0ZVtwcm9wXSAhPT0gdGFyZ2V0W3Byb3BdKSB7XG4gICAgICAgIGlmKHRhcmdldC5vcmlnaW5hbFN0YXRlW3Byb3BdIGluc3RhbmNlb2YgT2JqZWN0KXtcbiAgICAgICAgICBpZihKU09OLnN0cmluZ2lmeSh0YXJnZXQub3JpZ2luYWxTdGF0ZVtwcm9wXSkgPT0gSlNPTi5zdHJpbmdpZnkodGFyZ2V0W3Byb3BdKSl7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgc3RhdGVzLm9yaWdpbmFsW3Byb3BdID0gdGFyZ2V0Lm9yaWdpbmFsU3RhdGVbcHJvcF07XG4gICAgICAgIHN0YXRlcy5tb2RpZmllZFtwcm9wXSA9IHRhcmdldFtwcm9wXTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHN0YXRlcztcbiAgfSxcbiAgX2ZpbmFsaXplQ3VycmVudFRyYW5zZm9ybTogZnVuY3Rpb24gKCkge1xuXG4gICAgdmFyIHRyYW5zZm9ybSA9IHRoaXMuX2N1cnJlbnRUcmFuc2Zvcm0sXG4gICAgICB0YXJnZXQgPSB0cmFuc2Zvcm0udGFyZ2V0O1xuXG4gICAgaWYgKHRhcmdldC5fc2NhbGluZykge1xuICAgICAgdGFyZ2V0Ll9zY2FsaW5nID0gZmFsc2U7XG4gICAgfVxuXG4gICAgdGFyZ2V0LnNldENvb3JkcygpO1xuXG4gICAgdGhpcy5fcmVzdG9yZU9yaWdpblhZKHRhcmdldCk7XG4gICAgLy8gb25seSBmaXJlIDptb2RpZmllZCBldmVudCBpZiB0YXJnZXQgY29vcmRpbmF0ZXMgd2VyZSBjaGFuZ2VkIGR1cmluZyBtb3VzZWRvd24tbW91c2V1cFxuICAgIHRoaXMuZmlyZU1vZGlmaWVkSWZDaGFuZ2VkKHRhcmdldCk7XG4gIH0sXG4gIGZpcmVNb2RpZmllZElmQ2hhbmdlZDogZnVuY3Rpb24gKHRhcmdldCkge1xuICAgIGlmICh0aGlzLnN0YXRlZnVsKSB7XG4gICAgICB2YXIgX3N0YXRlcyA9IHRhcmdldC5oYXNTdGF0ZUNoYW5nZWQoKTtcbiAgICAgIGlmKF9zdGF0ZXMpe1xuICAgICAgICB0aGlzLmZpcmUoJ29iamVjdDptb2RpZmllZCcsIHt0YXJnZXQ6IHRhcmdldCAsIHN0YXRlczogX3N0YXRlc30pO1xuICAgICAgICB0YXJnZXQuZmlyZSgnbW9kaWZpZWQnLHtzdGF0ZXM6IF9zdGF0ZXN9KTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIC8vIF9zZXQ6IGZ1bmN0aW9uIChrZXksIHZhbHVlLGNhbGxiYWNrKSB7XG4gIC8vICAgaWYgKHRoaXMuc3BlY2lhbFByb3BlcnRpZXMuaW5kZXhPZihrZXkpICE9PSAtMSkge1xuICAvLyAgICAgdGhpc1tcInNldFwiICsgZmFicmljLnV0aWwuc3RyaW5nLmNhcGl0YWxpemUoa2V5LCB0cnVlKV0odmFsdWUsY2FsbGJhY2spO1xuICAvLyAgIH0gZWxzZSB7XG4gIC8vICAgICBmYWJyaWMuT2JqZWN0LnByb3RvdHlwZS5fc2V0LmNhbGwodGhpcywga2V5LCB2YWx1ZSk7XG4gIC8vICAgfVxuICAvLyAgIHJldHVybiB0aGlzO1xuICAvLyB9LFxuICBnZXQ6IGZhYnJpYy5PYmplY3QucHJvdG90eXBlLmdldCxcbiAgc2V0OiBmYWJyaWMuT2JqZWN0LnByb3RvdHlwZS5zZXQsXG4gIGhhc1N0YXRlQ2hhbmdlZDogZmFicmljLk9iamVjdC5wcm90b3R5cGUuaGFzU3RhdGVDaGFuZ2VkLFxuICAvKiogQ3JlYXRlcyBhIGJvdHRvbSBjYW52YXNcbiAgICogQHByaXZhdGVcbiAgICogQHBhcmFtIHtIVE1MRWxlbWVudH0gW2NhbnZhc0VsXVxuICAgKi9cbiAgX2NyZWF0ZUxvd2VyQ2FudmFzOiBmdW5jdGlvbiAoY2FudmFzRWwpIHtcbiAgICBpZiAodHlwZW9mIGNhbnZhc0VsID09IFwic3RyaW5nXCIpIHtcbiAgICAgIHRoaXMubG93ZXJDYW52YXNFbCA9IGZhYnJpYy51dGlsLmdldEJ5SWQoY2FudmFzRWwpIHx8IHRoaXMuX2NyZWF0ZUNhbnZhc0VsZW1lbnQoKTtcbiAgICB9IGVsc2UgaWYgKGNhbnZhc0VsKSB7XG4gICAgICB0aGlzLmxvd2VyQ2FudmFzRWwgPSBjYW52YXNFbDtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy52aXJ0dWFsID0gdHJ1ZTtcbiAgICAgIHRoaXMubG93ZXJDYW52YXNFbCA9IGZhYnJpYy51dGlsLmNyZWF0ZUNhbnZhc0VsZW1lbnQoKTtcbiAgICB9XG5cbiAgICB0aGlzLl9pbml0Q2FudmFzRWxlbWVudCh0aGlzLmxvd2VyQ2FudmFzRWwpO1xuXG4gICAgZmFicmljLnV0aWwuYWRkQ2xhc3ModGhpcy5sb3dlckNhbnZhc0VsLCAnbG93ZXItY2FudmFzJyk7XG5cbiAgICBpZiAodGhpcy5pbnRlcmFjdGl2ZSkge1xuICAgICAgdGhpcy5fYXBwbHlDYW52YXNTdHlsZSh0aGlzLmxvd2VyQ2FudmFzRWwpO1xuICAgIH1cblxuICAgIHRoaXMuY29udGV4dENvbnRhaW5lciA9IHRoaXMubG93ZXJDYW52YXNFbC5nZXRDb250ZXh0KCcyZCcpO1xuICB9LFxuICBmaW5kVGFyZ2V0OiBmdW5jdGlvbiAoZSwgc2tpcEdyb3VwKSB7XG4gICAgaWYgKHRoaXMuc2tpcFRhcmdldEZpbmQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB2YXIgaWdub3JlWm9vbSA9IHRydWUsXG4gICAgICBwb2ludGVyID0gdGhpcy5nZXRQb2ludGVyKGUsIGlnbm9yZVpvb20pLFxuICAgICAgYWN0aXZlR3JvdXAgPSB0aGlzLmdldEFjdGl2ZUdyb3VwKCksXG4gICAgICBhY3RpdmVPYmplY3QgPSB0aGlzLmdldEFjdGl2ZU9iamVjdCgpO1xuICAgIGlmIChhY3RpdmVHcm91cCAmJiAhc2tpcEdyb3VwICYmIHRoaXMuX2NoZWNrVGFyZ2V0KHBvaW50ZXIsIGFjdGl2ZUdyb3VwKSkge1xuICAgICAgcmV0dXJuIGFjdGl2ZUdyb3VwO1xuICAgIH1cblxuICAgIGlmIChhY3RpdmVPYmplY3QgJiYgdGhpcy5fY2hlY2tUYXJnZXQocG9pbnRlciwgYWN0aXZlT2JqZWN0KSkge1xuICAgICAgLy9hZGRlZCB2aXNjZXJvaWRcbiAgICAgIHRoaXMuX2ZpcmVPdmVyT3V0RXZlbnRzKGFjdGl2ZU9iamVjdCwgZSk7XG4gICAgICByZXR1cm4gYWN0aXZlT2JqZWN0O1xuICAgIH1cblxuICAgIHRoaXMudGFyZ2V0cyA9IFsgXTtcblxuICAgIHZhciB0YXJnZXQgPSB0aGlzLl9zZWFyY2hQb3NzaWJsZVRhcmdldHModGhpcy5fb2JqZWN0cywgcG9pbnRlcik7XG4gICAgdGhpcy5fZmlyZU92ZXJPdXRFdmVudHModGFyZ2V0LCBlKTtcbiAgICByZXR1cm4gdGFyZ2V0O1xuICB9XG59KTtcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuT2JqZWN0LnByb3RvdHlwZSwge1xuICBzZXRBbmdsZTogZnVuY3Rpb24oYW5nbGUpIHtcbiAgICB0aGlzLmFuZ2xlID0gYW5nbGU7XG4gIH0sXG4gIF9fc2V0IDogZmFicmljLk9iamVjdC5wcm90b3R5cGUuX3NldCxcbiAgZ2V0IDogZmFicmljLk9iamVjdC5wcm90b3R5cGUuZ2V0LFxuICBfc2V0OiBmdW5jdGlvbiAoa2V5LCB2YWx1ZSAsY2FsbGJhY2spIHtcbiAgICB2YXIgX2Zvb05hbWUgPSBcInNldFwiICsgZmFicmljLnV0aWwuc3RyaW5nLmNhcGl0YWxpemUoa2V5LCB0cnVlKTtcbiAgICBpZih0aGlzW19mb29OYW1lXSAgJiYgdGhpc1tfZm9vTmFtZV0ubmFtZSAmJiB0aGlzW19mb29OYW1lXS5uYW1lICE9IFwiYW5vbnltb3VzXCIpe1xuICAgICAgLy8gaWYgKHRoaXMuc3BlY2lhbFByb3BlcnRpZXMuaW5kZXhPZihrZXkpICE9PSAtMSkge1xuICAgICAgLy8gaWYodGhpc1tfZm9vTmFtZV0pe1xuICAgICAgdGhpc1tfZm9vTmFtZV0odmFsdWUsY2FsbGJhY2spO1xuICAgIH1lbHNle1xuICAgICAgdGhpcy5fX3NldChrZXksIHZhbHVlKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG4gIGRpc2FibGU6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLnNldCh7XG4gICAgICBzZWxlY3RhYmxlOiBmYWxzZSxcbiAgICAgIGV2ZW50ZWQ6IGZhbHNlLFxuICAgICAgaGFzQ29udHJvbHM6IGZhbHNlLFxuICAgICAgbG9ja01vdmVtZW50WDogdHJ1ZSxcbiAgICAgIGxvY2tNb3ZlbWVudFk6IHRydWVcbiAgICB9KTtcbiAgfSxcbiAgc3RvcmVkOiB0cnVlLFxuICAvKipcbiAgICogU2F2ZXMgc3RhdGUgb2YgYW4gb2JqZWN0XG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc10gT2JqZWN0IHdpdGggYWRkaXRpb25hbCBgc3RhdGVQcm9wZXJ0aWVzYCBhcnJheSB0byBpbmNsdWRlIHdoZW4gc2F2aW5nIHN0YXRlXG4gICAqIEByZXR1cm4ge2ZhYnJpYy5PYmplY3R9IHRoaXNBcmdcbiAgICovXG4gIHNhdmVTdGF0ZTogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgIHRoaXMuc3RhdGVQcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24ocHJvcCkge1xuICAgICAgdmFyIF92YWwgPSB0aGlzLmdldChwcm9wKTtcbiAgICAgIGlmKF92YWwgaW5zdGFuY2VvZiBPYmplY3Qpe1xuICAgICAgICB0aGlzLm9yaWdpbmFsU3RhdGVbcHJvcF0gPSBmYWJyaWMudXRpbC5vYmplY3QuY2xvbmVEZWVwKF92YWwpO1xuICAgICAgfWVsc2V7XG4gICAgICAgIHRoaXMub3JpZ2luYWxTdGF0ZVtwcm9wXSA9IF92YWw7XG4gICAgICB9XG4gICAgfSwgdGhpcyk7XG5cbiAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLnN0YXRlUHJvcGVydGllcykge1xuICAgICAgb3B0aW9ucy5zdGF0ZVByb3BlcnRpZXMuZm9yRWFjaChmdW5jdGlvbihwcm9wKSB7XG4gICAgICAgIHRoaXMub3JpZ2luYWxTdGF0ZVtwcm9wXSA9IHRoaXMuZ2V0KHByb3ApO1xuICAgICAgfSwgdGhpcyk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9LFxuICBoYXNTdGF0ZUNoYW5nZWQ6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBtb2RpZmllZCA9IDA7XG4gICAgdmFyIHN0YXRlcyA9IHtcbiAgICAgIG9yaWdpbmFsOiB7fSxcbiAgICAgIG1vZGlmaWVkOiB7fVxuICAgIH07XG4gICAgZm9yICh2YXIgcHJvcCBpbiB0aGlzLm9yaWdpbmFsU3RhdGUpIHtcbiAgICAgIGlmICh0aGlzLm9yaWdpbmFsU3RhdGVbcHJvcF0gIT09IHRoaXNbcHJvcF0pIHtcbiAgICAgICAgaWYodGhpcy5vcmlnaW5hbFN0YXRlW3Byb3BdIGluc3RhbmNlb2YgT2JqZWN0KXtcbiAgICAgICAgICBpZihKU09OLnN0cmluZ2lmeSh0aGlzLm9yaWdpbmFsU3RhdGVbcHJvcF0pID09IEpTT04uc3RyaW5naWZ5KHRoaXNbcHJvcF0pKXtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBzdGF0ZXMub3JpZ2luYWxbcHJvcF0gPSB0aGlzLm9yaWdpbmFsU3RhdGVbcHJvcF07XG4gICAgICAgIHN0YXRlcy5tb2RpZmllZFtwcm9wXSA9IHRoaXNbcHJvcF07XG4gICAgICAgIG1vZGlmaWVkKys7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBtb2RpZmllZCAmJiBzdGF0ZXM7XG4gIH1cbn0pO1xuXG5mYWJyaWMudXRpbC5nZXRQcm9wb3J0aW9ucyA9IGZ1bmN0aW9uIChwaG90bywgY29udGFpbmVyLCBtb2RlKSB7XG4gIG1vZGUgPSBtb2RlIHx8ICdmaXQnO1xuICB2YXIgX3cgPSBwaG90by5uYXR1cmFsV2lkdGggfHwgcGhvdG8ud2lkdGg7XG4gIHZhciBfaCA9IHBob3RvLm5hdHVyYWxIZWlnaHQgfHwgcGhvdG8uaGVpZ2h0O1xuICBpZiAoIWNvbnRhaW5lci5oZWlnaHQgJiYgIWNvbnRhaW5lci53aWR0aCkge1xuICAgIHJldHVybiB7XG4gICAgICBzY2FsZTogMSxcbiAgICAgIHdpZHRoOiBfdyxcbiAgICAgIGhlaWdodDogX2hcbiAgICB9O1xuICB9XG4gIGlmICghcGhvdG8uaGVpZ2h0ICYmICFwaG90by53aWR0aCkge1xuICAgIHJldHVybiB7XG4gICAgICBzY2FsZTogMC4wMDEsXG4gICAgICB3aWR0aDogY29udGFpbmVyLndpZHRoLFxuICAgICAgaGVpZ2h0OiBjb250YWluZXIuaGVpZ2h0XG4gICAgfTtcbiAgfVxuXG4gIC8vIHZhciBfYXNwID0gX3cgLyBfaCwgX2NfYXNwID0gY29udGFpbmVyLndpZHRoIC8gY29udGFpbmVyLmhlaWdodDtcblxuICAvLyBpZiAoX2FzcCA+IF9jX2FzcCkge1xuICAvLyAgIF9oID0gY29udGFpbmVyLmhlaWdodDtcbiAgLy8gICBfdyA9IF9oICogX2FzcDtcbiAgLy9cbiAgLy8gfSBlbHNlIHtcbiAgLy8gICBfdyA9IGNvbnRhaW5lci53aWR0aDtcbiAgLy8gICBfaCA9IF93IC8gX2FzcDtcbiAgLy8gfVxuICAvLyB2YXIgc2NhbGVYID0gY29udGFpbmVyLndpZHRoIC8gX3c7XG4gIC8vIHZhciBzY2FsZVkgPSBjb250YWluZXIuaGVpZ2h0IC8gX2g7XG4gIHZhciBzY2FsZVggPSBjb250YWluZXIud2lkdGggJiYgY29udGFpbmVyLndpZHRoIC8gX3cgfHwgOTk5O1xuICB2YXIgc2NhbGVZID0gY29udGFpbmVyLmhlaWdodCAmJiBjb250YWluZXIuaGVpZ2h0IC8gX2ggfHwgOTk5O1xuXG4gIHZhciBzY2FsZTtcbiAgaWYgKG1vZGUgPT09ICdjb3ZlcicpIHtcbiAgICBzY2FsZSA9IE1hdGgubWF4KHNjYWxlWCwgc2NhbGVZKTtcbiAgfVxuICBpZiAobW9kZSA9PT0gJ2ZpdCcpIHtcbiAgICBzY2FsZSA9IE1hdGgubWluKHNjYWxlWCwgc2NhbGVZKTtcbiAgfVxuICBpZiAobW9kZSA9PT0gJ2NlbnRlcicpIHtcbiAgICBzY2FsZSA9IDE7XG4gIH1cbiAgcmV0dXJuIHtcbiAgICBzY2FsZTogc2NhbGUsXG4gICAgd2lkdGg6IE1hdGguZmxvb3IoX3cgKiBzY2FsZSksXG4gICAgaGVpZ2h0OiBNYXRoLmZsb29yKF9oICogc2NhbGUpXG4gIH07XG59O1xuXG5mYWJyaWMudXRpbC5VdGY4QXJyYXlUb1N0ciA9IGZ1bmN0aW9uKGFycmF5KSB7XG4gIHZhciBvdXQsIGksIGxlbiwgYztcbiAgdmFyIGNoYXIyLCBjaGFyMztcblxuICBvdXQgPSBcIlwiO1xuICBsZW4gPSBhcnJheS5sZW5ndGg7XG4gIGkgPSAwO1xuICB3aGlsZShpIDwgbGVuKSB7XG4gICAgYyA9IGFycmF5W2krK107XG4gICAgc3dpdGNoKGMgPj4gNClcbiAgICB7XG4gICAgICBjYXNlIDA6IGNhc2UgMTogY2FzZSAyOiBjYXNlIDM6IGNhc2UgNDogY2FzZSA1OiBjYXNlIDY6IGNhc2UgNzpcbiAgICAgIC8vIDB4eHh4eHh4XG4gICAgICBvdXQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShjKTtcbiAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAxMjogY2FzZSAxMzpcbiAgICAgIC8vIDExMHggeHh4eCAgIDEweHggeHh4eFxuICAgICAgY2hhcjIgPSBhcnJheVtpKytdO1xuICAgICAgb3V0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoKChjICYgMHgxRikgPDwgNikgfCAoY2hhcjIgJiAweDNGKSk7XG4gICAgICBicmVhaztcbiAgICAgIGNhc2UgMTQ6XG4gICAgICAgIC8vIDExMTAgeHh4eCAgMTB4eCB4eHh4ICAxMHh4IHh4eHhcbiAgICAgICAgY2hhcjIgPSBhcnJheVtpKytdO1xuICAgICAgICBjaGFyMyA9IGFycmF5W2krK107XG4gICAgICAgIG91dCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKCgoYyAmIDB4MEYpIDw8IDEyKSB8XG4gICAgICAgICAgKChjaGFyMiAmIDB4M0YpIDw8IDYpIHxcbiAgICAgICAgICAoKGNoYXIzICYgMHgzRikgPDwgMCkpO1xuICAgICAgICBicmVhaztcbiAgICB9XG4gIH1cblxuICByZXR1cm4gb3V0O1xufTtcblxuZmFicmljLnV0aWwuY3JlYXRlT2JqZWN0ID0gZnVuY3Rpb24gKHR5cGUsIG9wdGlvbnMsIGNhbGxiYWNrKSB7XG4gIGlmKHR5cGVvZiB0eXBlICE9PSBcInN0cmluZ1wiKXtcbiAgICBjYWxsYmFjayA9IG9wdGlvbnM7XG4gICAgb3B0aW9ucyA9IHR5cGU7XG4gICAgdHlwZSA9IG51bGw7XG4gIH1lbHNle1xuICAgIG9wdGlvbnMudHlwZSA9IHR5cGU7XG4gIH1cbiAgdmFyIGFwcCA9IG9wdGlvbnMuYXBwbGljYXRpb247XG4gIGFwcCAmJiBhcHAuZmlyZShcImVudGl0eTpsb2FkXCIse29wdGlvbnM6IG9wdGlvbnN9KTtcblxuICB2YXIgX2tsYXNzTmFtZSA9IGZhYnJpYy51dGlsLnN0cmluZy5jYW1lbGl6ZShmYWJyaWMudXRpbC5zdHJpbmcuY2FwaXRhbGl6ZSh0eXBlIHx8IG9wdGlvbnMudHlwZSB8fCBhcHAucHJvdG90eXBlcy5PYmplY3QudHlwZSx0cnVlKSk7XG4gIHZhciBfa2xhc3MgPSBmYWJyaWNbX2tsYXNzTmFtZV0gfHwgYXBwLmtsYXNzZXNbX2tsYXNzTmFtZV07XG5cblxuICBpZighX2tsYXNzKXtcbiAgICBjb25zb2xlLmVycm9yKF9rbGFzc05hbWUgKyBcIiBpcyB1bmRlZmluZWRcIik7XG4gICAgcmV0dXJuIGNhbGxiYWNrKG5ldyBmYWJyaWMuUmVjdChvcHRpb25zKSlcbiAgfVxuXG4gIHZhciBlbCA9IF9rbGFzcy5mcm9tT2JqZWN0KG9wdGlvbnMsIGZ1bmN0aW9uIChlbCkge1xuICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKGVsKTtcbiAgICBjYWxsYmFjayA9IG51bGw7XG4gIH0pO1xuICBpZiAoZWwpIHtcbiAgICBjYWxsYmFjayAmJiBjYWxsYmFjayhlbCk7XG4gICAgY2FsbGJhY2sgPSBudWxsO1xuICB9XG4gIHJldHVybiBlbDtcbn07XG5cbmZhYnJpYy51dGlsLmRhdGFVUkl0b0Jsb2IgPSBmdW5jdGlvbiAoZGF0YVVSSSwgZGF0YVRZUEUpIHtcbiAgdmFyIGJpbmFyeSA9IGF0b2IoZGF0YVVSSS5zcGxpdCgnLCcpWzFdKSwgYXJyYXkgPSBbXTtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBiaW5hcnkubGVuZ3RoOyBpKyspIHtcbiAgICBhcnJheS5wdXNoKGJpbmFyeS5jaGFyQ29kZUF0KGkpKTtcbiAgfVxuICByZXR1cm4gbmV3IEJsb2IoW25ldyBVaW50OEFycmF5KGFycmF5KV0sIHt0eXBlOiBkYXRhVFlQRX0pO1xufTtcblxuZmFicmljLnV0aWwuYmxvYlRvRGF0YVVSTCA9IGZ1bmN0aW9uIChibG9iLCBjYWxsYmFjaykge1xuICB2YXIgYSA9IG5ldyBGaWxlUmVhZGVyKCk7XG4gIGEub25sb2FkID0gZnVuY3Rpb24gKGUpIHtcbiAgICBjYWxsYmFjayhlLnRhcmdldC5yZXN1bHQpO1xuICB9O1xuICBhLnJlYWRBc0RhdGFVUkwoYmxvYik7XG59O1xuXG5mYWJyaWMudXRpbC5jcmVhdGVDYW52YXNFbGVtZW50V2l0aFNpemUgPSBmdW5jdGlvbiAoc2l6ZSkge1xuICB2YXIgY2FudmFzID0gZmFicmljLnV0aWwuY3JlYXRlQ2FudmFzRWxlbWVudCgpO1xuICBjYW52YXMud2lkdGggPSBzaXplLndpZHRoO1xuICBjYW52YXMuaGVpZ2h0ID0gc2l6ZS5oZWlnaHQ7XG4gIHJldHVybiBjYW52YXM7XG59O1xuXG5mYWJyaWMudXRpbC5zdHJpbmcudG9EYXNoZWQgPSBmdW5jdGlvbiAoc3RyKSB7XG4gIHJldHVybiBzdHIucmVwbGFjZSgvKFthLXpdKShbQS1aXSkvZywgJyQxLSQyJykudG9Mb3dlckNhc2UoKTtcbn07XG5cbmZhYnJpYy51dGlsLnN0cmluZy51bmNhcGl0YWxpemUgPSBmdW5jdGlvbihzdHJpbmcpe1xuICByZXR1cm4gc3RyaW5nLmNoYXJBdCgwKS50b0xvd2VyQ2FzZSgpICtcbiAgICAoc3RyaW5nLnNsaWNlKDEpKTtcbn07XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL2NvcmUvYmFzZS5qc1xuLy8gbW9kdWxlIGlkID0gMjFcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwidmFyIF9Hcm91cFJlbW92ZU5ldGl2ZSA9IGZhYnJpYy5Hcm91cC5wcm90b3R5cGUucmVtb3ZlO1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5Hcm91cC5wcm90b3R5cGUsIHtcbiAgLyoqXG4gICAqIFJlbW92ZXMgb2JqZWN0IGZyb20gY2FudmFzIHRvIHdoaWNoIGl0IHdhcyBhZGRlZCBsYXN0XG4gICAqIEByZXR1cm4ge2ZhYnJpYy5PYmplY3R9IHRoaXNBcmdcbiAgICogQGNoYWluYWJsZVxuICAgKi9cbiAgcmVtb3ZlOiBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDApIHtcbiAgICAgIHRoaXMuY2FudmFzICYmIHRoaXMuY2FudmFzLnJlbW92ZSh0aGlzKTtcbiAgICB9IGVsc2Uge1xuICAgICAgX0dyb3VwUmVtb3ZlTmV0aXZlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cbn0pO1xuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9jb3JlL2dyb3VwLmV4dC5qc1xuLy8gbW9kdWxlIGlkID0gMjJcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiXG5yZXF1aXJlKFwiLi8uLi9taXhpbnMvcHJvcG9ydGlhbmFsU2l6ZU1peGluXCIpO1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5JbWFnZS5wcm90b3R5cGUsZmFicmljLkltYWdlTWl4aW4sIHtcbiAgYXN5bmM6IHRydWUsXG4gIHRvT2JqZWN0TmF0aXZlOiBmYWJyaWMuSW1hZ2UucHJvdG90eXBlLnRvT2JqZWN0LFxuICB0b09iamVjdDogICAgIGZ1bmN0aW9uKCl7XG4gICAgdmFyIG9iaiA9IGZhYnJpYy5JbWFnZS5wcm90b3R5cGUudG9PYmplY3ROYXRpdmUuYXBwbHkodGhpcyxhcmd1bWVudHMpO1xuICAgIGlmKG9iai5zcmMuaW5kZXhPZihmYWJyaWMudXRpbC5tZWRpYVJvb3QpID09IDApe1xuICAgICAgb2JqLnNyYyA9IG9iai5zcmMucmVwbGFjZShmYWJyaWMudXRpbC5tZWRpYVJvb3QsXCJcIik7XG4gICAgfVxuICAgIHJldHVybiBvYmo7XG4gIH0sXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uIChlbGVtZW50LCBvcHRpb25zLCBjYWxsYmFjaykge1xuICAgIG9wdGlvbnMgfHwgKG9wdGlvbnMgPSB7fSk7XG4gICAgdGhpcy5maWx0ZXJzID0gW107XG4gICAgdGhpcy5yZXNpemVGaWx0ZXJzID0gW107XG5cblxuICAgIGlmIChvcHRpb25zLm9yaWdpbmFsU3JjKSB7XG4gICAgICB0aGlzLl9lZGl0ZWQgPSB0cnVlO1xuICAgICAgZmFicmljLnV0aWwubG9hZEltYWdlKG9wdGlvbnMub3JpZ2luYWxTcmMsIGZ1bmN0aW9uIChpbWcpIHtcbiAgICAgICAgdGhpcy5fb3JpZ2luYWxFbGVtZW50ID0gaW1nO1xuICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICB9XG5cbiAgICB0aGlzLl9pbml0RWxlbWVudChlbGVtZW50LCBvcHRpb25zLCBjYWxsYmFjayAmJiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGZhYnJpYy5PYmplY3QucHJvdG90eXBlLmluaXRpYWxpemUuY2FsbCh0aGlzLCBvcHRpb25zLCBjYWxsYmFjayk7XG4gICAgICB9LmJpbmQodGhpcykpOy8vYWRkaW5nIGNhbGxiYWNrXG4gIH0sXG5cbiAgX2luaXRFbGVtZW50OiBmdW5jdGlvbiAoZWxlbWVudCwgb3B0aW9ucywgY2FsbGJhY2spIHtcbiAgICB0aGlzLnNldEVsZW1lbnQoZmFicmljLnV0aWwuZ2V0QnlJZChlbGVtZW50KSwgY2FsbGJhY2ssIG9wdGlvbnMpO1xuICAgIGZhYnJpYy51dGlsLmFkZENsYXNzKHRoaXMuZ2V0RWxlbWVudCgpLCBmYWJyaWMuSW1hZ2UuQ1NTX0NBTlZBUyk7XG4gIH0sXG4gIC8qKlxuICAgKiBTZXRzIGNyb3NzT3JpZ2luIHZhbHVlIChvbiBhbiBpbnN0YW5jZSBhbmQgY29ycmVzcG9uZGluZyBpbWFnZSBlbGVtZW50KVxuICAgKiBAcmV0dXJuIHtmYWJyaWMuSW1hZ2V9IHRoaXNBcmdcbiAgICogQGNoYWluYWJsZVxuICAgKi9cbiAgc2V0Q3Jvc3NPcmlnaW46IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgIHRoaXMuY3Jvc3NPcmlnaW4gPSB2YWx1ZTtcbiAgICBpZiAodGhpcy5fZWxlbWVudCkge1xuICAgICAgdGhpcy5fZWxlbWVudC5jcm9zc09yaWdpbiA9IHZhbHVlO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfSxcbiAgc2V0RWxlbWVudDogZnVuY3Rpb24gKGVsZW1lbnQsIGNhbGxiYWNrLCBvcHRpb25zKSB7XG5cbiAgICB2YXIgX2NhbGxiYWNrLCBfdGhpcztcblxuICAgIHRoaXMuX2VsZW1lbnQgPSBlbGVtZW50O1xuICAgIHRoaXMuX29yaWdpbmFsRWxlbWVudCA9IGVsZW1lbnQ7XG4gICAgdGhpcy5faW5pdENvbmZpZyhvcHRpb25zKTtcbiAgICAvLyB0aGlzLnNldE9wdGlvbnMob3B0aW9ucyApO1xuICAgIC8vIHRoaXMuX3NldFdpZHRoSGVpZ2h0KHRoaXMpO1xuICAgIC8vIGlmICh0aGlzLl9lbGVtZW50ICYmIHRoaXMuY3Jvc3NPcmlnaW4pIHtcbiAgICAvLyAgIHRoaXMuX2VsZW1lbnQuY3Jvc3NPcmlnaW4gPSB0aGlzLmNyb3NzT3JpZ2luO1xuICAgIC8vIH1cblxuXG4gICAgaWYgKHRoaXMucmVzaXplRmlsdGVycy5sZW5ndGggPT09IDApIHtcbiAgICAgIF9jYWxsYmFjayA9IGNhbGxiYWNrO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIF90aGlzID0gdGhpcztcbiAgICAgIF9jYWxsYmFjayA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgX3RoaXMuYXBwbHlGaWx0ZXJzKGNhbGxiYWNrLCBfdGhpcy5yZXNpemVGaWx0ZXJzLCBfdGhpcy5fZmlsdGVyZWRFbCB8fCBfdGhpcy5fb3JpZ2luYWxFbGVtZW50LCB0cnVlKTtcbiAgICAgIH07XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuZmlsdGVycy5sZW5ndGggIT09IDApIHtcbiAgICAgIHRoaXMuYXBwbHlGaWx0ZXJzKF9jYWxsYmFjayk7XG4gICAgfVxuICAgIGVsc2UgaWYgKF9jYWxsYmFjaykge1xuICAgICAgX2NhbGxiYWNrKHRoaXMpO1xuICAgIH1cbiAgICBpZih0aGlzLmNhbnZhcyl7XG4gICAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG4gIGFjdGlvbnMgOiB7XG4gICAgc291cmNlOiB7XG4gICAgICB0eXBlOiAnZWZmZWN0JyxcbiAgICAgIGNsYXNzTmFtZTogJ2ZhIGZhLWZpbGUtaW1hZ2UtbycsXG4gICAgICB0aXRsZTogXCJzb3VyY2VcIixcbiAgICAgIGFjdGlvblBhcmFtZXRlcnM6IGZ1bmN0aW9uICgkZWwsIGRhdGEpIHtcbiAgICAgICAgZGF0YS50YXJnZXQuYXBwbGljYXRpb24uY3JlYXRlR2FsbGVyeShkYXRhLnRhcmdldCwgJGVsKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn0pO1xuXG5mYWJyaWMudXRpbC5pbml0RmlsdGVycyA9IGZ1bmN0aW9uIChpbWcsIG9iamVjdCwgY2FsbGJhY2spIHtcblxuICAvLyBpZiAoZmFicmljLnZlcnNpb24gPj0gMS42KSB7XG4gIGZhYnJpYy5JbWFnZS5wcm90b3R5cGUuX2luaXRGaWx0ZXJzLmNhbGwob2JqZWN0LCBvYmplY3QuZmlsdGVycywgZnVuY3Rpb24gKGZpbHRlcnMpIHtcbiAgICBvYmplY3QuZmlsdGVycyA9IGZpbHRlcnMgfHwgW107XG4gICAgZmFicmljLkltYWdlLnByb3RvdHlwZS5faW5pdEZpbHRlcnMuY2FsbChvYmplY3QsIG9iamVjdC5yZXNpemVGaWx0ZXJzLCBmdW5jdGlvbiAocmVzaXplRmlsdGVycykge1xuICAgICAgb2JqZWN0LnJlc2l6ZUZpbHRlcnMgPSByZXNpemVGaWx0ZXJzIHx8IFtdO1xuICAgICAgY2FsbGJhY2soaW1nLCBvYmplY3QpO1xuICAgIH0pO1xuICB9KTtcbiAgLy8gfSBlbHNlIHtcbiAgLy8gICBmYWJyaWMuSW1hZ2UucHJvdG90eXBlLl9pbml0RmlsdGVycy5jYWxsKG9iamVjdCwgb2JqZWN0LCBmdW5jdGlvbiAoZmlsdGVycykge1xuICAvLyAgICAgb2JqZWN0LmZpbHRlcnMgPSBmaWx0ZXJzIHx8IFtdO1xuICAvLyAgICAgY2FsbGJhY2soaW1nLCBvYmplY3QpO1xuICAvLyAgIH0pO1xuICAvLyB9XG59O1xuXG5mYWJyaWMudXRpbC5pbml0SW1hZ2VBbmRGaWx0ZXJzID0gZnVuY3Rpb24gKG9iamVjdCwgY2FsbGJhY2spIHtcbiAgaWYgKG9iamVjdC5pbWFnZSkge1xuICAgIHZhciBpbWcgPSBvYmplY3QuaW1hZ2U7XG4gICAgZGVsZXRlIG9iamVjdC5zcmM7XG4gICAgZGVsZXRlIG9iamVjdC5pbWFnZTtcbiAgICBmYWJyaWMudXRpbC5pbml0RmlsdGVycyhpbWcsIG9iamVjdCwgY2FsbGJhY2spO1xuICB9ZWxzZSBpZiAob2JqZWN0LnNyYykge1xuICAgIGZhYnJpYy51dGlsLmxvYWRJbWFnZShvYmplY3Quc3JjLCBmdW5jdGlvbiAoaW1nKSB7XG4gICAgICAvL2RlbGV0ZSBvYmplY3Quc3JjO1xuICAgICAgZmFicmljLnV0aWwuaW5pdEZpbHRlcnMoaW1nLCBvYmplY3QsIGNhbGxiYWNrKTtcbiAgICB9LCBudWxsLCBvYmplY3QuY3Jvc3NPcmlnaW4pO1xuICB9IGVsc2Uge1xuICAgIGZhYnJpYy51dGlsLmluaXRGaWx0ZXJzKG51bGwsIG9iamVjdCwgY2FsbGJhY2spO1xuICB9XG59O1xuXG5mYWJyaWMuSW1hZ2UuZnJvbU9iamVjdCA9IGZ1bmN0aW9uIChvYmplY3QsIGNhbGxiYWNrKSB7XG4gIGZhYnJpYy51dGlsLmluaXRJbWFnZUFuZEZpbHRlcnMob2JqZWN0LCBmdW5jdGlvbiAoaW1nLCBvYmplY3QpIHtcbiAgICB2YXIgaW5zdGFuY2UgPSBuZXcgZmFicmljLkltYWdlKGltZywgb2JqZWN0LCBjYWxsYmFjayk7XG4gIH0pXG59O1xuXG5cbmZhYnJpYy5JbWFnZS5wcm90b3R5cGUuX3RvX29iamVjdF9vdmVyd3JpdHRlbiA9IGZhYnJpYy5JbWFnZS5wcm90b3R5cGUudG9PYmplY3Q7XG5mYWJyaWMuSW1hZ2UucHJvdG90eXBlLnNldFNyYyA9IGZ1bmN0aW9uIChvcHQpIHtcbiAgY29uc29sZS5sb2cob3B0KTtcbn07XG5cbmZhYnJpYy5JbWFnZS5wcm90b3R5cGUudG9PYmplY3QgPSBmdW5jdGlvbiAob3B0KSB7XG4gIHZhciBvYmogPSBmYWJyaWMuSW1hZ2UucHJvdG90eXBlLl90b19vYmplY3Rfb3ZlcndyaXR0ZW4uY2FsbCh0aGlzLCBvcHQpO1xuXG5cbiAgaWYgKHRoaXMuX2VkaXRlZCkge1xuICAgIG9iai5vcmlnaW5hbFNyYyA9IHRoaXMuX29yaWdpbmFsX3NyYyB8fCB0aGlzLl9vcmlnaW5hbEVsZW1lbnQuc3JjIHx8IHRoaXMuX2VsZW1lbnQuc3JjO1xuICAgIG9iai5zcmMgPSB0aGlzLl9lbGVtZW50LnNyYztcbiAgfSBlbHNlIHtcbiAgICBvYmouc3JjID0gdGhpcy5fb3JpZ2luYWxfc3JjIHx8IHRoaXMuX29yaWdpbmFsRWxlbWVudC5zcmMgfHwgdGhpcy5fZWxlbWVudC5zcmM7XG4gIH1cbiAgaWYgKHRoaXMuY29udGVudE9mZnNldHMpIHtcbiAgICBvYmouY29udGVudE9mZnNldHMgPSB0aGlzLmNvbnRlbnRPZmZzZXRzO1xuICB9XG5cblxuICBpZiAoIXRoaXMuaW5jbHVkZURlZmF1bHRWYWx1ZXMpIHtcbiAgICBpZiAoIW9iai5maWx0ZXJzLmxlbmd0aClkZWxldGUgb2JqLmZpbHRlcnM7XG4gIH1cbiAgLy9pZih0aGlzLl9vcmlnaW5hbEVsZW1lbnQpe1xuICAvLyAgICBvYmoudGh1bWIgPSB0aGlzLl9lbGVtZW50LnNyYztcbiAgLy99XG5cbiAgcmV0dXJuIG9iajtcbn07XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL2NvcmUvaW1hZ2UuZXh0LmpzXG4vLyBtb2R1bGUgaWQgPSAyM1xuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCIndXNlIHN0cmljdCc7XG5cbnZhciBpc1ZNTCA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gdHlwZW9mIEdfdm1sQ2FudmFzTWFuYWdlciAhPT0gJ3VuZGVmaW5lZCc7IH1cblxuLy93ZWlyZCBzdHVmZlxuLy8gZGVsZXRlIGZhYnJpYy5SZWN0LnByb3RvdHlwZS50b09iamVjdDtcbi8vIGZhYnJpYy5SZWN0LnByb3RvdHlwZS5zdG9yZVByb3BlcnRpZXMgPSBbXCIqXCIsXCJyeFwiLFwicnlcIl07XG5cbmZhYnJpYy5JTkNMVURFX0FMTCA9IFwiKlwiO1xuXG52YXIgX3RvT2JqZWN0X292ZXJ3cml0dGVuID0gZmFicmljLk9iamVjdC5wcm90b3R5cGUudG9PYmplY3Q7XG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5PYmplY3QucHJvdG90eXBlLCB7XG4gIHN0b3JlUHJvcGVydGllczogWycqJ10sXG4gIGV2ZW50TGlzdGVuZXJzOiB7fSxcbiAgdG9PYmplY3Q6IGZ1bmN0aW9uIChwcm9wZXJ0aWVzVG9JbmNsdWRlKSB7XG4gICAgaWYgKHByb3BlcnRpZXNUb0luY2x1ZGUgPT0gZmFicmljLklOQ0xVREVfQUxMKSB7XG4gICAgICBwcm9wZXJ0aWVzVG9JbmNsdWRlID0gW2ZhYnJpYy5JTkNMVURFX0FMTF07XG4gICAgfVxuXG4gICAgcHJvcGVydGllc1RvSW5jbHVkZSA9IHByb3BlcnRpZXNUb0luY2x1ZGUgfHwgW107XG4gICAgcHJvcGVydGllc1RvSW5jbHVkZSA9IHByb3BlcnRpZXNUb0luY2x1ZGUuY29uY2F0KHRoaXMuc3RvcmVQcm9wZXJ0aWVzKTtcblxuXG4gICAgdmFyIG9iaiA9IF90b09iamVjdF9vdmVyd3JpdHRlbi5jYWxsKHRoaXMsIHByb3BlcnRpZXNUb0luY2x1ZGUpO1xuICAgIGlmIChwcm9wZXJ0aWVzVG9JbmNsdWRlWzBdICE9PSBmYWJyaWMuSU5DTFVERV9BTEwpIHtcbiAgICAgIGlmICghdGhpcy5pbmNsdWRlRGVmYXVsdFZhbHVlcykge1xuICAgICAgICB0aGlzLl9yZW1vdmVEZWZhdWx0VmFsdWVzKG9iaik7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuc3RvcmVQcm9wZXJ0aWVzLmluZGV4T2YoXCIqXCIpID09IC0xKSB7XG4gICAgICBmb3IgKHZhciBpIGluIG9iaikge1xuICAgICAgICBpZiAodGhpcy5zdG9yZVByb3BlcnRpZXMuaW5kZXhPZihpKSA9PSAtMSkge1xuICAgICAgICAgIGRlbGV0ZSBvYmpbaV07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLmZpcmUoXCJiZWZvcmU6b2JqZWN0XCIsIHtvYmplY3Q6IG9ian0pO1xuICAgIHJldHVybiBvYmo7XG4gIH0sXG4gIC8qKlxuICAgKiBTZXRzIG9iamVjdCdzIHByb3BlcnRpZXMgZnJvbSBvcHRpb25zXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc10gT3B0aW9ucyBvYmplY3RcbiAgICovXG4gIHNldE9wdGlvbnM6IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgdGhpcy5fc2V0T2JqZWN0KG9wdGlvbnMpO1xuICAgIC8vIHRoaXMuX2luaXRHcmFkaWVudChvcHRpb25zKTtcbiAgICAvLyB0aGlzLl9pbml0UGF0dGVybihvcHRpb25zKTtcbiAgICAvLyB0aGlzLl9pbml0Q2xpcHBpbmcob3B0aW9ucyk7XG4gIH0sXG4gIF9pbml0RW50aXR5OiBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgIG9wdGlvbnMuYXBwbGljYXRpb24gJiYgb3B0aW9ucy5hcHBsaWNhdGlvbi5maXJlKFwiZW50aXR5OmNyZWF0ZWRcIiwge3RhcmdldDogdGhpcywgb3B0aW9uczogb3B0aW9uc30pO1xuICB9LFxuICBpbml0aWFsaXplOiBmdW5jdGlvbiAob3B0aW9ucywgY2FsbGJhY2spIHtcbiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgICB0aGlzLl9pbml0RW50aXR5KG9wdGlvbnMpO1xuICAgIC8vIGlmKG9wdGlvbnMud2hvbGVDb29yZGluYXRlcyl7XG4gICAgLy8gICB2YXIgY29vcmRpbmF0ZXMgPSBbXCJsZWZ0XCIsXCJ0b3BcIixcIndpZHRoXCIsXCJoZWlnaHRcIl07XG4gICAgLy8gICBmb3IodmFyIGkgaW4gY29vcmRpbmF0ZXMpe1xuICAgIC8vICAgICBpZihvcHRpb25zW2Nvb3JkaW5hdGVzW2ldXSl7XG4gICAgLy8gICAgICAgb3B0aW9uc1tjb29yZGluYXRlc1tpXV0gPSBNYXRoLnJvdW5kKG9wdGlvbnNbY29vcmRpbmF0ZXNbaV1dKTtcbiAgICAvLyAgICAgfVxuICAgIC8vICAgfVxuICAgIC8vIH1cbiAgICB2YXIgX3NlbGYgPSB0aGlzO1xuICAgIHRoaXMuX3NldE9iamVjdChvcHRpb25zLCBmdW5jdGlvbiAoKSB7XG4gICAgICBfc2VsZi5sb2FkZWQgPSB0cnVlO1xuICAgICAgX3NlbGYuZmlyZShcImxvYWRlZFwiKTtcbiAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKF9zZWxmKTtcbiAgICB9KTtcbiAgfSxcbiAgYWRkOiBmdW5jdGlvbiAoY2FudmFzKSB7XG4gICAgY2FudmFzLmFkZCh0aGlzKTtcbiAgfSxcbiAgc2V0OiBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkge1xuICAgIGlmICh0eXBlb2Yga2V5ID09PSAnb2JqZWN0Jykge1xuICAgICAgdGhpcy5fc2V0T2JqZWN0KGtleSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgaWYgKGtleVswXSA9PSBcIiZcIikge1xuICAgICAgICBrZXkgPSBrZXkuc3Vic3RyKDEpO1xuICAgICAgICB0aGlzLl9zZXQoa2V5LCB2YWx1ZSh0aGlzLmdldChrZXkpKSk7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgdGhpcy5fc2V0KGtleSwgdmFsdWUpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfVxufSk7XG5cblxuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5PYmplY3QucHJvdG90eXBlLCB7XG4gIGhhc0JvdW5kc0NvbnRyb2xzOiB0cnVlLFxuICBmbGlwVG9vbHM6ICAgICBmYWxzZSxcbiAgb3JkZXJUb29sczogICAgZmFsc2UsXG4gIHN0cm9rZTogXCJ0cmFuc3BhcmVudFwiLFxuICBvblRvcDogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLmNhbnZhcy5fb2JqZWN0cy5pbmRleE9mKHRoaXMpID09IHRoaXMuY2FudmFzLl9vYmplY3RzLmxlbmd0aCAtIDE7XG4gIH0sXG4gIGZsb3A6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmZsaXBZID0gIXRoaXMuZmxpcFk7XG4gICAgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gIH0sXG4gIGZsaXA6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmZsaXBYID0gIXRoaXMuZmxpcFg7XG4gICAgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gIH0sXG4gIG9uQm90dG9tOiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMuY2FudmFzLl9vYmplY3RzLmluZGV4T2YodGhpcykgPT0gMDtcbiAgfSxcbiAgZHVwbGljYXRlOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgX29iamVjdCA9IHRoaXMudG9PYmplY3QoZmFicmljLklOQ0xVREVfQUxMKTtcbiAgICBfb2JqZWN0LmFjdGl2ZSA9IHRydWU7XG5cbiAgICB2YXIgX2Nsb25lID0gX29iamVjdC5jbG9uZVN5bmMgJiYgX29iamVjdC5jbG9uZVN5bmMoKSB8fCB0aGlzLmNhbnZhcy5jcmVhdGVPYmplY3QoX29iamVjdCk7XG4gICAgcmV0dXJuIF9jbG9uZTtcbiAgfSxcbiAgbWluU3Ryb2tlV2lkdGg6IDAsXG4gIG1heFN0cm9rZVdpZHRoOiBmdW5jdGlvbigpe1xuICAgIHJldHVybiBNYXRoLm1pbih0aGlzLndpZHRoLHRoaXMuaGVpZ2h0KSAvIDI7XG4gIH0sXG4gIGFjdGlvbnM6IHtcbiAgICBib3VuZGluZ1JlY3Q6IHtcbiAgICAgIHR5cGU6ICdsYWJlbCcsXG4gICAgICB0ZW1wbGF0ZTogJzxkdD5MOjwvZHQ+PGRkIGNsYXNzPVwie2xlZnRDbGFzc31cIiB0aXRsZT1cIntsZWZ0fVwiPntyb3VuZExlZnR9PC9kZD48ZHQ+VDo8L2R0PjxkZCBjbGFzcz1cInt0b3BDbGFzc31cIiAgdGl0bGU9XCJ7dG9wfVwiPntyb3VuZFRvcH08L2RkPjxkdD5SOjwvZHQ+PGRkIGNsYXNzPVwie3JpZ2h0Q2xhc3N9XCIgdGl0bGU9XCJ7cmlnaHR9XCI+e3JvdW5kUmlnaHR9PC9kZD48ZHQ+Qjo8L2R0PjxkZCBjbGFzcz1cIntib3R0b21DbGFzc31cIiAgdGl0bGU9XCJ7Ym90dG9tfVwiPntyb3VuZEJvdHRvbX08L2RkPicsXG4gICAgICB2YWx1ZToge1xuICAgICAgICBvYnNlcnZlOiBcIm1vZGlmaWVkIHNjYWxpbmcgbW92aW5nIHJvdGF0aW5nXCIsXG4gICAgICAgIGdldDogZnVuY3Rpb24oKXtcbiAgICAgICAgICB2YXIgX3JlY3QgPSB0aGlzLmdldEJvdW5kaW5nUmVjdCgpO1xuXG4gICAgICAgICAgaWYodGhpcy5tb3ZlbWVudExpbWl0cykge1xuXG4gICAgICAgICAgICBpZiAodGhpcy5tb3ZlbWVudExpbWl0cyA9PSB0aGlzLmNhbnZhcykge1xuICAgICAgICAgICAgICB2YXIgX3YgPSB0aGlzLmNhbnZhcy52aWV3cG9ydFRyYW5zZm9ybTtcbiAgICAgICAgICAgICAgdmFyIF9tbHIgPSB7XG4gICAgICAgICAgICAgICAgbGVmdDogX3ZbNF0sXG4gICAgICAgICAgICAgICAgdG9wOiBfdls1XSxcbiAgICAgICAgICAgICAgICB3aWR0aDogKHRoaXMuY2FudmFzLm9yaWdpbmFsV2lkdGggfHwgdGhpcy5jYW52YXMud2lkdGgpICogX3ZbMF0sXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiAodGhpcy5jYW52YXMub3JpZ2luYWxIZWlnaHQgfHwgdGhpcy5jYW52YXMuaGVpZ2h0KSAgKiBfdlszXSxcbiAgICAgICAgICAgICAgICByaWdodDogMCxcbiAgICAgICAgICAgICAgICBib3R0b206IDBcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgIF9tbHIgPSB0aGlzLm1vdmVtZW50TGltaXRzLmdldEJvdW5kaW5nUmVjdCgpO1xuICAgICAgICAgICAgfVxuXG5cbiAgICAgICAgICAgIF9yZWN0LmJvdHRvbSA9IHRoaXMubW92ZW1lbnRMaW1pdHMuaGVpZ2h0IC0gX3JlY3QuaGVpZ2h0O1xuICAgICAgICAgICAgdmFyIF90ID0gX3JlY3QudG9wIC0gX21sci50b3A7XG4gICAgICAgICAgICB2YXIgX2wgPSBfcmVjdC5sZWZ0IC0gX21sci5sZWZ0O1xuICAgICAgICAgICAgdmFyIF9yID0gX21sci53aWR0aCAtIF9yZWN0LndpZHRoIC0gX2w7XG4gICAgICAgICAgICB2YXIgX2IgPSBfbWxyLmhlaWdodCAtIF9yZWN0LmhlaWdodCAtIF90O1xuICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgX3QgPSBfcmVjdC50b3A7XG4gICAgICAgICAgICBfbCA9IF9yZWN0LmxlZnQ7XG4gICAgICAgICAgICBfYiA9IHRoaXMuY2FudmFzLmhlaWdodCAtIF9yZWN0LmhlaWdodCAtIF9yZWN0LnRvcDtcbiAgICAgICAgICAgIF9yICA9IHRoaXMuY2FudmFzLndpZHRoIC0gX3JlY3Qud2lkdGggLSBfcmVjdC5sZWZ0O1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0b3BDbGFzczogX3QgPiAwID8gXCJwb3NpdGl2ZVwiIDogX3QgPCAwID8gXCJuZWdhdGl2ZVwiIDogXCJ6ZXJvXCIsXG4gICAgICAgICAgICBib3R0b21DbGFzczogX2IgPiAwID8gXCJwb3NpdGl2ZVwiIDogX2IgPCAwID8gXCJuZWdhdGl2ZVwiIDogXCJ6ZXJvXCIsXG4gICAgICAgICAgICBsZWZ0Q2xhc3M6IF9sID4gMCA/IFwicG9zaXRpdmVcIiA6IF9sIDwgMCA/IFwibmVnYXRpdmVcIiA6IFwiemVyb1wiLFxuICAgICAgICAgICAgcmlnaHRDbGFzczogX3IgPiAwID8gXCJwb3NpdGl2ZVwiIDogX3IgPCAwID8gXCJuZWdhdGl2ZVwiIDogXCJ6ZXJvXCIsXG4gICAgICAgICAgICB0b3A6ICAgIF90LFxuICAgICAgICAgICAgbGVmdDogICBfbCxcbiAgICAgICAgICAgIGJvdHRvbTogX2IsXG4gICAgICAgICAgICByaWdodDogIF9yLFxuICAgICAgICAgICAgcm91bmRUb3A6ICAgIE1hdGgucm91bmQoX3QpLFxuICAgICAgICAgICAgcm91bmRMZWZ0OiAgIE1hdGgucm91bmQoX2wpLFxuICAgICAgICAgICAgcm91bmRCb3R0b206IE1hdGgucm91bmQoX2IpLFxuICAgICAgICAgICAgcm91bmRSaWdodDogIE1hdGgucm91bmQoX3IpXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcbiAgICBwb3NpdGlvbjoge1xuICAgICAgdGl0bGU6ICdwb3NpdGlvbicsXG4gICAgICB0eXBlOiAnbWVudScsXG4gICAgICBtZW51OiB7XG4gICAgICAgIG9iamVjdExlZnQ6IHtcbiAgICAgICAgICB0eXBlOiAgICdudW1iZXInLFxuICAgICAgICAgIHRpdGxlOiAgJ2xlZnQnLFxuICAgICAgICAgIHZhbHVlOiB7XG4gICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2YWwpIHtcbiAgICAgICAgICAgICAgdGhpcy5sZWZ0ID0gdmFsO1xuICAgICAgICAgICAgICB0aGlzLmZpcmUoXCJtb2RpZmllZFwiKTtcbiAgICAgICAgICAgICAgdGhpcy5jYW52YXMuZmlyZShcIm9iamVjdDptb2RpZmllZFwiLCB7dGFyZ2V0OiB0aGlzfSk7XG4gICAgICAgICAgICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICByZXR1cm4gdGhpcy5sZWZ0O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9ic2VydmU6IFwibW9kaWZpZWRcIlxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgb2JqZWN0VG9wOiB7XG4gICAgICAgICAgdHlwZTogICAnbnVtYmVyJyxcbiAgICAgICAgICB0aXRsZTogICd0b3AnLFxuICAgICAgICAgIHZhbHVlOiB7XG4gICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2YWwpIHtcbiAgICAgICAgICAgICAgdGhpcy50b3AgPSB2YWw7XG4gICAgICAgICAgICAgIHRoaXMuZmlyZShcIm1vZGlmaWVkXCIpO1xuICAgICAgICAgICAgICB0aGlzLmNhbnZhcy5maXJlKFwib2JqZWN0Om1vZGlmaWVkXCIsIHt0YXJnZXQ6IHRoaXN9KTtcbiAgICAgICAgICAgICAgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIHJldHVybiB0aGlzLnRvcDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvYnNlcnZlOiBcIm1vZGlmaWVkXCJcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuICAgIGRpbWVuc2lvbnM6IHtcbiAgICAgIHRpdGxlOiAnZGltZW5zaW9ucycsXG4gICAgICB0eXBlOiAnbWVudScsXG4gICAgICBtZW51OntcbiAgICAgICAgb2JqZWN0V2lkdGg6IHtcbiAgICAgICAgICB0eXBlOiAgICdudW1iZXInLFxuICAgICAgICAgIHRpdGxlOiAgJ3dpZHRoJyxcbiAgICAgICAgICB2YWx1ZToge1xuICAgICAgICAgICAgc2V0OiBmdW5jdGlvbih2YWwpe1xuICAgICAgICAgICAgICB0aGlzLnNhdmVTdGF0ZSgpO1xuICAgICAgICAgICAgICB0aGlzLmRpbWVuc2lvbnNXaWR0aFZhbHVlID0gdmFsO1xuICAgICAgICAgICAgICB0aGlzLnNjYWxlVG9XaWR0aCh2YWwgKiAgdGhpcy5jYW52YXMuZ2V0Wm9vbSgpKTtcbiAgICAgICAgICAgICAgdGhpcy5jYW52YXMuZmlyZU1vZGlmaWVkSWZDaGFuZ2VkKHRoaXMpO1xuICAgICAgICAgICAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuZGltZW5zaW9uc1dpZHRoVmFsdWU7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICBpZih0aGlzLmRpbWVuc2lvbnNXaWR0aFZhbHVlKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5kaW1lbnNpb25zV2lkdGhWYWx1ZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICByZXR1cm4gTWF0aC5yb3VuZCh0aGlzLmdldEJvdW5kaW5nUmVjdCgpLndpZHRoIC8gdGhpcy5jYW52YXMuZ2V0Wm9vbSgpKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvYnNlcnZlOiBcIm1vZGlmaWVkXCJcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIG9iamVjdEhlaWdodDoge1xuICAgICAgICAgIHR5cGU6ICAgJ251bWJlcicsXG4gICAgICAgICAgdGl0bGU6ICAnaGVpZ2h0JyxcbiAgICAgICAgICB2YWx1ZToge1xuICAgICAgICAgICAgc2V0OiBmdW5jdGlvbih2YWwpe1xuICAgICAgICAgICAgICB0aGlzLnNhdmVTdGF0ZSgpO1xuICAgICAgICAgICAgICB0aGlzLnNjYWxlVG9IZWlnaHQodmFsICogIHRoaXMuY2FudmFzLmdldFpvb20oKSk7XG4gICAgICAgICAgICAgIHRoaXMuZGltZW5zaW9uc0hlaWdodFZhbHVlID0gdmFsO1xuICAgICAgICAgICAgICB0aGlzLmNhbnZhcy5maXJlTW9kaWZpZWRJZkNoYW5nZWQodGhpcyk7XG4gICAgICAgICAgICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgICAgICAgICAgICBkZWxldGUgdGhpcy5kaW1lbnNpb25zSGVpZ2h0VmFsdWU7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICBpZih0aGlzLmRpbWVuc2lvbnNIZWlnaHRWYWx1ZSl7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGltZW5zaW9uc0hlaWdodFZhbHVlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHJldHVybiBNYXRoLnJvdW5kKHRoaXMuZ2V0Qm91bmRpbmdSZWN0KCkuaGVpZ2h0IC8gdGhpcy5jYW52YXMuZ2V0Wm9vbSgpKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvYnNlcnZlOiBcIm1vZGlmaWVkXCJcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuICAgIGNlbnRlcjoge1xuICAgICAgY2xhc3NOYW1lOiAgJ2ZhIGZhLWJ1bGxzZXllJyxcbiAgICAgIHRpdGxlOiAnQ2VudGVyJyxcbiAgICAgIGFjdGlvbjogZnVuY3Rpb24oKXtcbiAgICAgICAgdGhpcy5jZW50ZXIoKTtcbiAgICAgICAgdGhpcy5zZXRDb29yZHMoKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIG9iamVjdEZsaXA6IHtcbiAgICAgIGNsYXNzTmFtZTogICdmYSBmYS1hcnJvd3MtaCcsXG4gICAgICB0aXRsZTogICAgICAnZmxpcCcsXG4gICAgICBhY3Rpb246ICAgICAnZmxpcCdcbiAgICB9LFxuICAgIGZsb3A6IHtcbiAgICAgIGNsYXNzTmFtZTogICdmYSBmYS1hcnJvd3MtdicsXG4gICAgICB0aXRsZTogICAgICAnZmxvcCdcbiAgICB9LFxuICAgIGJyaW5nRm9yd2FyZDoge1xuICAgICAgdGl0bGU6ICAgICAgJ2JyaW5nIGZvcndhcmQnLFxuICAgICAgY2xhc3NOYW1lOiAgJ2ZhIGZhLWxldmVsLXVwJyxcbiAgICAgIGRpc2FibGVkOiAgICdvblRvcCdcbiAgICB9LFxuICAgIHNlbmRCYWNrd2FyZHM6IHtcbiAgICAgIHRpdGxlOiAgICAgICdzZW5kIGJhY2t3YXJkcycsXG4gICAgICBjbGFzc05hbWU6ICAnZmEgZmEtbGV2ZWwtZG93bicsXG4gICAgICBkaXNhYmxlZDogICAnb25Cb3R0b20nXG4gICAgfSxcbiAgICByZW1vdmU6IHtcbiAgICAgIGNsYXNzTmFtZTogICdmYSBmYS10cmFzaCcsXG4gICAgICB0aXRsZTogICAgICAncmVtb3ZlJyxcbiAgICAgIGtleTogICAgICAgIFwiRGVsZXRlXCJcbiAgICB9LFxuICAgIGR1cGxpY2F0ZToge1xuICAgICAgY2xhc3NOYW1lOiAgJ2ZhIGZhLWNsb25lJyxcbiAgICAgIHRpdGxlOiAgICAgICdkdXBsaWNhdGUnXG4gICAgfVxuICB9XG59KTtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vY29yZS9vYmplY3QuZXh0LmpzXG4vLyBtb2R1bGUgaWQgPSAyNFxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCIndXNlIHN0cmljdCc7XG5cblxuLyoqXG4gKiBAcHJpdmF0ZVxuICogQHBhcmFtIHtTdHJpbmd9IGV2ZW50TmFtZVxuICogQHBhcmFtIHtGdW5jdGlvbn0gaGFuZGxlclxuICovXG5mdW5jdGlvbiBfcmVtb3ZlRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIGhhbmRsZXIpIHtcbiAgaWYgKCF0aGlzLl9fZXZlbnRMaXN0ZW5lcnNbZXZlbnROYW1lXSkge1xuICAgIHJldHVybjtcbiAgfVxuICB2YXIgZXZlbnRMaXN0ZW5lciA9IHRoaXMuX19ldmVudExpc3RlbmVyc1tldmVudE5hbWVdO1xuICBpZiAoaGFuZGxlcikge1xuICAgIGV2ZW50TGlzdGVuZXIuc3BsaWNlKGV2ZW50TGlzdGVuZXIuaW5kZXhPZihoYW5kbGVyKSwgMSlcbiAgfVxuICBlbHNlIHtcbiAgICBldmVudExpc3RlbmVyLmxlbmd0aCA9IDA7XG4gIH1cbn1cblxuZmFicmljLkNhbnZhcy5wcm90b3R5cGUuc3RvcE9ic2VydmluZyA9IGZhYnJpYy5PYmplY3QucHJvdG90eXBlLnN0b3BPYnNlcnZpbmcgPSBmdW5jdGlvbiBzdG9wT2JzZXJ2aW5nKGV2ZW50TmFtZSwgaGFuZGxlcikge1xuICBpZiAoIXRoaXMuX19ldmVudExpc3RlbmVycykge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIHJlbW92ZSBhbGwga2V5L3ZhbHVlIHBhaXJzIChldmVudCBuYW1lIC0+IGV2ZW50IGhhbmRsZXIpXG4gIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAwKSB7XG4gICAgZm9yIChldmVudE5hbWUgaW4gdGhpcy5fX2V2ZW50TGlzdGVuZXJzKSB7XG4gICAgICBfcmVtb3ZlRXZlbnRMaXN0ZW5lci5jYWxsKHRoaXMsIGV2ZW50TmFtZSk7XG4gICAgfVxuICB9XG4gIC8vIG9uZSBvYmplY3Qgd2l0aCBrZXkvdmFsdWUgcGFpcnMgd2FzIHBhc3NlZFxuICBlbHNlIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAxICYmIHR5cGVvZiBhcmd1bWVudHNbMF0gPT09ICdvYmplY3QnKSB7XG4gICAgZm9yICh2YXIgcHJvcCBpbiBldmVudE5hbWUpIHtcbiAgICAgIF9yZW1vdmVFdmVudExpc3RlbmVyLmNhbGwodGhpcywgcHJvcCwgZXZlbnROYW1lW3Byb3BdKTtcbiAgICB9XG4gIH1cbiAgZWxzZSB7XG4gICAgX3JlbW92ZUV2ZW50TGlzdGVuZXIuY2FsbCh0aGlzLCBldmVudE5hbWUsIGhhbmRsZXIpO1xuICB9XG4gIHJldHVybiB0aGlzO1xufVxuXG5cbmZhYnJpYy5PYnNlcnZhYmxlLm9uID0gZmFicmljLkNhbnZhcy5wcm90b3R5cGUub24gPSBmYWJyaWMuT2JqZWN0LnByb3RvdHlwZS5vbiA9IGZ1bmN0aW9uIChldmVudE5hbWUsIGhhbmRsZXIscHJpb3JpdHkpIHtcbiAgaWYgKGV2ZW50TmFtZS5jb25zdHJ1Y3RvciA9PSBPYmplY3QpIHtcbiAgICBmb3IgKHZhciBpIGluIGV2ZW50TmFtZSkge1xuICAgICAgdGhpcy5vbihpLCBldmVudE5hbWVbaV0scHJpb3JpdHkpXG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9XG4gIHZhciBldmVudHMgPSBldmVudE5hbWUuc3BsaXQoXCIgXCIpO1xuICBmb3IgKHZhciBpIGluIGV2ZW50cykge1xuICAgIGV2ZW50TmFtZSA9IGV2ZW50c1tpXTtcbiAgICB0aGlzLm9ic2VydmUoZXZlbnROYW1lLCBoYW5kbGVyKTtcbiAgICBpZihwcmlvcml0eSl7XG4gICAgICB0aGlzLl9fZXZlbnRMaXN0ZW5lcnNbZXZlbnROYW1lXS51bnNoaWZ0KHRoaXMuX19ldmVudExpc3RlbmVyc1tldmVudE5hbWVdLnBvcCgpKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHRoaXM7XG59O1xuZmFicmljLkNhbnZhcy5wcm90b3R5cGUub2ZmID0gZmFicmljLk9iamVjdC5wcm90b3R5cGUub2ZmID0gZnVuY3Rpb24gKGV2ZW50TmFtZSwgaGFuZGxlcikge1xuICB2YXIgZXZlbnRzID0gZXZlbnROYW1lLnNwbGl0KFwiIFwiKTtcbiAgZm9yICh2YXIgaSBpbiBldmVudHMpIHtcbiAgICB0aGlzLnN0b3BPYnNlcnZpbmcoZXZlbnRzW2ldLCBoYW5kbGVyKVxuICB9XG4gIHJldHVybiB0aGlzO1xufTtcblxuXG5mYWJyaWMuQ2FudmFzLnByb3RvdHlwZS5maXJlID0gZmFicmljLk9iamVjdC5wcm90b3R5cGUuZmlyZSA9IGZ1bmN0aW9uIGZpcmUoZXZlbnROYW1lLCBvcHRpb25zKSB7XG4gIGlmICghdGhpcy5fX2V2ZW50TGlzdGVuZXJzKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIGxpc3RlbmVyc0ZvckV2ZW50ID0gdGhpcy5fX2V2ZW50TGlzdGVuZXJzW2V2ZW50TmFtZV07XG4gIGlmIChsaXN0ZW5lcnNGb3JFdmVudCkge1xuICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBsaXN0ZW5lcnNGb3JFdmVudC5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgbGlzdGVuZXJzRm9yRXZlbnRbaV0uY2FsbCh0aGlzLCBvcHRpb25zIHx8IHt9KTtcbiAgICB9XG4gIH1cblxuICB2YXIgbGlzdGVuZXJzRm9yRXZlbnRBbGwgPSB0aGlzLl9fZXZlbnRMaXN0ZW5lcnNbJyonXTtcbiAgaWYgKGxpc3RlbmVyc0ZvckV2ZW50QWxsKSB7XG4gICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG4gICAgb3B0aW9ucy5ldmVudE5hbWUgPSBldmVudE5hbWU7XG4gICAgb3B0aW9ucy5saXN0ZW5lcnMgPSBsaXN0ZW5lcnNGb3JFdmVudDtcbiAgICBmb3IgKGkgPSAwLCBsZW4gPSBsaXN0ZW5lcnNGb3JFdmVudEFsbC5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgbGlzdGVuZXJzRm9yRXZlbnRBbGxbaV0uY2FsbCh0aGlzLCBvcHRpb25zKTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gdGhpcztcbn07XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL2NvcmUvb2JzZXJ2ZS5qc1xuLy8gbW9kdWxlIGlkID0gMjVcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiJ3VzZSBzdHJpY3QnO1xuXG5yZXF1aXJlKFwiLi9zdGF0aWMtY2FudmFzLmV4dFwiKTtcblxuLyoqXG4gKiAjIFNsaWRlQ2FudmFzXG4gKiBJbmhlcml0ZWQgZnJvbSBmYWJyaWMuQ2FudmFzXG4gKlxuICpcblxuICMjIG1ldGhvZDogbG9hZFxuXG5NYXRob2QgYWxsb3dzIHRvIGFkZCBuZXcgb2JqZWN0cyBhbmQgc2V0IG5ldyBhdHRyaWJ1dGVzIG9mIGNhbnZhcy5cblxuIGBgYGphdmFzY3JpcHRcbiBsb2FkIDogKHtcbiAgICBiYWNrZ3JvdW5kSW1hZ2U6IHN0cmluZyxcbiAgICBvYmplY3RzOiBbRmFicmljU2hhcGVPcHRpb25zXSxcbiAgICBjdXN0b21TeW5jT3B0aW9uOiBhbnksXG4gICAgY3VzdG9tQXN5bmNPcHRpb246IGFueVxuICB9LGNhbGxiYWNrKSA6IHZvaWRcbiBgYGBcblxuIFRvIGV4dGVuZCBsb2FkaW5nIGJlaGF2aW9yIGFuZCB1c2UgY3VzdG9tIG9wdGlvbnMgaXQgaXMgcG9zc2libGUgdG8gZGVmaW5lICoqc2V0IGZ1Y250aW9ucyoqIGluIENhbnZhcyBwcm90b3R5cGUuXG5cbiBgYGBqYXZhc2NyaXB0XG4gLy8gQ2FudmFzIFByb3RvdHlwZVxuIHNldEN1c3RvbUFzeW5jT3B0aW9uOiBmdW5jdGlvbih2YWwsY2FsbGJhY2spe1xuICB0aGlzLmRvQXN5bmNNZXRob2QodmFsLGNhbGxiYWNrKVxufVxuIHNldEN1c3RvbVN5bmNPcHRpb246IGZ1bmN0aW9uKHZhbCl7XG4gIHRoaXMuY3VzdG9tU3luY090aW9uID0gdmFsO1xufVxuIGBgYFxuXG4gIyMjIGF0dHJpYnV0ZTogYmFja2dyb3VuZEltYWdlUHJvcGVydGllc1xuXG4gZGVmYXVsdCBhdHRyaWJ1dGVzIGZvciBiYWNrZ3JvdW5kIGltYWdlXG5cbiAjIyMgZnJlZURyYXdpbmdCcnVzaFxuXG4gZGVmYXVsdCBhY3RpdmUgZHJhd2luZyBicnVzaFxuXG4gYGBgXG4gZnJlZURyYXdpbmdCcnVzaDogXCJQYWludEJ1Y2tldEJydXNoXCIgfCBcIlBhaW50UGVuQnJ1c2hcIiB8IFwiUGVuY2lsQnJ1c2hcIlxuIGBgYFxuXG4gIyMjIGF0dHJpYnV0ZTogb25TbGlkZUxvYWRlZFxuXG4gb25TbGlkZUxvYWRlZCBjYWxscyBhcyBhIGNhbGxiYWNrIGZvciBsb2FkIGZ1Y250aW9uXG5cbiAjIyMgYXR0cmlidXRlOiBiYWNrZ3JvdW5kUG9zaXRpb25cblxuIG9uU2xpZGVMb2FkZWQgY2FsbHMgYXMgYSBjYWxsYmFjayBmb3IgbG9hZCBmdWNudGlvblxuXG4gYGBgXG4gYmFja2dyb3VuZFBvc2l0aW9uOiAnbWFudWFsJyB8ICdyZXNpemUnIHwgJ2ZpdCcgfCAnY292ZXInIHwgJ2NlbnRlcidcbiBgYGBcblxuIC0gbWFudWFsIC0gYmFja2dyb3VuZCB3aWxsIG5lIG5vdCBzY2FsZWQgYW5kIHB1dCBhdCBsZWZ0IHRvcCBjb3JuZXJcbiAtIHJlc2l6ZSAtIGNhbnZhcyB3aWxsIGJlIHJlc2l6ZWQgYWNjb3JkaW5nIHRvIGltYWdlIHNpemVcbiAtIGZpdCAtIHdpbGwgYmUgc2NhbGVkIHRvIGZpdCBjYW52YXMgc2l6ZVxuIC0gY292ZXIgLSB3aWxsIGJlIHNjYWxlZCB0byBjb3ZlciBhbGwgY2FudmFzIHNpemVcbiAtIGNlbnRlciAtIGJhY2tvZ3J1bmQgd2lsbCBiZSBub3Qgc2NhbGVkIGJ1dCBwdXQgaW4gdGhlIG1pZGRsZVxuXG4gIyMjIG1ldGhvZDogc2V0SW50ZXJhY3RpdmVNb2RlXG5cbiBzd2l0Y2ggYmV0d2VlbiBkcmF3aW5nIGFuZCBoYW5kKCBtb3ZpbmcgY3VudmFzIGJ5IG1vdXNlKSBtb2Rlc1xuXG4gYGBgamF2YXNjcmlwdFxuIGNhbnZhcy5zZXRJbnRlcmFjdGl2ZU1vZGUoIG1vZGUgOiBcImhhbmRcIiB8IFwibWl4ZWRcIikgOiB2b2lkXG4gYGBgXG5cbiAjIyMgZHJhd2luZ0NvbG9yXG5cbiBkcmF3aW5nIGNvbG9yIHVzaW5nIGJ5IGJydXNoZXNcblxuICovXG5mYWJyaWMuU2xpZGVDYW52YXMgPSBmYWJyaWMudXRpbC5jcmVhdGVDbGFzcyhmYWJyaWMuQ2FudmFzLGZhYnJpYy5QbHVnaW5zTWl4aW4sIHtcbiAgdHlwZTogJ3NsaWRlLWNhbnZhcycsXG4gIC8qKlxuICAgKiBpbml0aWFsaXplZCB3aWR0aCBvZiB0aGUgY2FudmFzXG4gICAqL1xuICB3aWR0aDogMTYwICxcbiAgLyoqXG4gICAqIGluaXRpYWxpemVkIGhlaWdodCBvZiB0aGUgY2FudmFzXG4gICAqL1xuICBoZWlnaHQ6IDkwLFxuICAvKipcbiAgICogb3V0cHV0IHF1YWxpdHlcbiAgICovXG4gIGRvdHNQZXJVbml0OiAxLFxuICBzY2FsZTogMSxcbiAgbG9hZGVkOiBmYWxzZSxcbiAgLyoqXG4gICAqIGFsbG93IHVzZXIgdG8gaW50ZXJhY3Qgd2l0aCBjYW52YXNcbiAgICovXG4gIGludGVyYWN0aXZlOiB0cnVlLFxuICAvKipcbiAgICogZmlsbCBub3QgdGhlIHNsaWRlIGFyZWEsIGJ1dCB3aG9sZSBjYW52YXMgd2l0aCBiYWNrZ3JvdW5kIGNvbG9yXG4gICAqL1xuICBhZGRUZXh0VG9vbDogZmFsc2UsXG4gIGRlZmF1bHRUZXh0OiBcInRleHRcIixcbiAgZGVmYXVsdFRleHRUeXBlOiBcInRleHRcIixcbiAgdGh1bWJTaXplOiB7XG4gICAgd2lkdGg6IDUwLFxuICAgIGhlaWdodDogMTAwXG4gIH0sXG4gIHN0b3JlUHJvcGVydGllczogWycqJywnYmFja2dyb3VuZEltYWdlJywnd2lkdGgnLCdoZWlnaHQnXSxcbiAgY29udGV4dFRvcEltYWdlU21vb3RoaW5nRW5hYmxlZDogdHJ1ZSxcbiAgcGx1Z2luczoge1xuICAgIGluaXRpYWxpemU6IFtcbiAgICBdLFxuICAgIHByZWxvYWRlcnM6IFtcbiAgICBdLFxuICAgIGxvYWRlcnM6IFtdLFxuICAgIHNhdmVycyA6IFtcbiAgICAgIGZ1bmN0aW9uIHNlcmlhbGl6ZVRodW1iKHByb3BlcnRpZXNUb0luY2x1ZGUsIF9kYXRhKXtcbiAgICAgICAgaWYocHJvcGVydGllc1RvSW5jbHVkZS5pbmRleE9mKCd0aHVtYicpICE9PSAtMSl7XG4gICAgICAgICAgdmFyIHNpemUgPSBmYWJyaWMudXRpbC5nZXRQcm9wb3J0aW9ucyh0aGlzLmdldE9yaWdpbmFsU2l6ZSgpLCB0aGlzLnRodW1iU2l6ZSwgJ2ZpdCcpO1xuICAgICAgICAgIHZhciBjYW52YXMgPSBmYWJyaWMudXRpbC5jcmVhdGVDYW52YXNFbGVtZW50KCk7XG4gICAgICAgICAgY2FudmFzLndpZHRoID0gc2l6ZS53aWR0aDtcbiAgICAgICAgICBjYW52YXMuaGVpZ2h0ID0gc2l6ZS5oZWlnaHQ7XG4gICAgICAgICAgdGhpcy5yZW5kZXJUaHVtYihjYW52YXMpO1xuICAgICAgICAgIF9kYXRhLnRodW1iID0gY2FudmFzLnRvRGF0YVVSTCgpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgZnVuY3Rpb24gc2VyaWFsaXplVGVtcGxhdGUocHJvcGVydGllc1RvSW5jbHVkZSwgX2RhdGEpIHtcbiAgICAgICAgaWYgKHByb3BlcnRpZXNUb0luY2x1ZGUuaW5kZXhPZigndGVtcGxhdGUnKSAhPT0gLTEpIHtcbiAgICAgICAgICBpZiAodGhpcy50ZW1wbGF0ZSkge1xuICAgICAgICAgICAgZm9yICh2YXIgaSBpbiBfZGF0YS50ZW1wbGF0ZSkge1xuICAgICAgICAgICAgICBpZiAoSlNPTi5zdHJpbmdpZnkoX2RhdGFbaV0pID09IEpTT04uc3RyaW5naWZ5KF9kYXRhLnRlbXBsYXRlW2ldKSkge1xuICAgICAgICAgICAgICAgIGRlbGV0ZSBfZGF0YVtpXTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgX2RhdGEudGVtcGxhdGUgPSB0aGlzLnRlbXBsYXRlLmlkO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIF1cbiAgfSxcbiAgc2V0QmFja2dyb3VuZENvbG9yOiBmdW5jdGlvbihiYWNrZ3JvdW5kQ29sb3IsIGNhbGxiYWNrKSB7XG4gICAgcmV0dXJuIHRoaXMuX19zZXRCZ092ZXJsYXlDb2xvcignYmFja2dyb3VuZENvbG9yJywgYmFja2dyb3VuZENvbG9yLCBmdW5jdGlvbigpe1xuICAgICAgdGhpcy5yZW5kZXJBbGwoKTtcbiAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKClcbiAgICB9LmJpbmQodGhpcykpO1xuICB9LFxuICBzZXRJbnRlcmFjdGl2ZTogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgdGhpcy5pbnRlcmFjdGl2ZSA9IHZhbHVlO1xuICB9LFxuICBfaW5pdE9wdGlvbnM6IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgdGhpcy53aWR0aCA9IHRoaXMud2lkdGggfHwgcGFyc2VJbnQodGhpcy5sb3dlckNhbnZhc0VsLndpZHRoLCAxMCkgfHwgMDtcbiAgICB0aGlzLmhlaWdodCA9IHRoaXMuaGVpZ2h0IHx8IHBhcnNlSW50KHRoaXMubG93ZXJDYW52YXNFbC5oZWlnaHQsIDEwKSB8fCAwO1xuXG4gICAgaWYgKCF0aGlzLmxvd2VyQ2FudmFzRWwuc3R5bGUpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmxvd2VyQ2FudmFzRWwud2lkdGggPSB0aGlzLndpZHRoO1xuICAgIHRoaXMubG93ZXJDYW52YXNFbC5oZWlnaHQgPSB0aGlzLmhlaWdodDtcblxuICAgIHRoaXMubG93ZXJDYW52YXNFbC5zdHlsZS53aWR0aCA9IHRoaXMud2lkdGggKyAncHgnO1xuICAgIHRoaXMubG93ZXJDYW52YXNFbC5zdHlsZS5oZWlnaHQgPSB0aGlzLmhlaWdodCArICdweCc7XG5cbiAgICB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtID0gdGhpcy52aWV3cG9ydFRyYW5zZm9ybS5zbGljZSgpO1xuICB9LFxuICBfY3JlYXRlVXBwZXJDYW52YXM6IGZ1bmN0aW9uICgpIHtcbiAgICBmYWJyaWMuQ2FudmFzLnByb3RvdHlwZS5fY3JlYXRlVXBwZXJDYW52YXMuY2FsbCh0aGlzKTtcbiAgICB2YXIgY3R4ID0gdGhpcy5jb250ZXh0VG9wO1xuXG4gICAgaWYoY3R4LmltYWdlU21vb3RoaW5nRW5hYmxlZCl7XG4gICAgICBjdHguaW1hZ2VTbW9vdGhpbmdFbmFibGVkID0gdGhpcy5jb250ZXh0VG9wSW1hZ2VTbW9vdGhpbmdFbmFibGVkO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjdHgud2Via2l0SW1hZ2VTbW9vdGhpbmdFbmFibGVkID0gdGhpcy5jb250ZXh0VG9wSW1hZ2VTbW9vdGhpbmdFbmFibGVkO1xuICAgIGN0eC5tb3pJbWFnZVNtb290aGluZ0VuYWJsZWQgICAgPSB0aGlzLmNvbnRleHRUb3BJbWFnZVNtb290aGluZ0VuYWJsZWQ7XG4gICAgY3R4Lm1zSW1hZ2VTbW9vdGhpbmdFbmFibGVkICAgICA9IHRoaXMuY29udGV4dFRvcEltYWdlU21vb3RoaW5nRW5hYmxlZDtcbiAgICBjdHgub0ltYWdlU21vb3RoaW5nRW5hYmxlZCAgICAgID0gdGhpcy5jb250ZXh0VG9wSW1hZ2VTbW9vdGhpbmdFbmFibGVkO1xuICB9LFxuICBfb25Nb3VzZVVwSW5EcmF3aW5nTW9kZTogZnVuY3Rpb24oZSkge1xuICAgIHRoaXMuX2lzQ3VycmVudGx5RHJhd2luZyA9IGZhbHNlO1xuICAgIGlmICh0aGlzLmNsaXBUbykge1xuICAgICAgdGhpcy5jb250ZXh0VG9wLnJlc3RvcmUoKTtcbiAgICB9XG4gICAgdmFyIHBvaW50ZXIgPSB0aGlzLmdldFBvaW50ZXIoZSk7XG4gICAgdGhpcy5mcmVlRHJhd2luZ0JydXNoLm9uTW91c2VVcChwb2ludGVyKTtcbiAgICB0aGlzLl9oYW5kbGVFdmVudChlLCAndXAnKTtcbiAgfSxcbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKGVsLCBvcHRpb25zLGNhbGxiYWNrKSB7XG4gICAgaWYoZWwgJiYgZWwuY29uc3RydWN0b3IgPT0gT2JqZWN0KXtcbiAgICAgIGNhbGxiYWNrPSBvcHRpb25zO1xuICAgICAgb3B0aW9ucyA9IGVsO1xuICAgICAgZWwgPSBudWxsO1xuICAgIH1cbiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcblxuXG5cbiAgICBpZihvcHRpb25zLmFwcGxpY2F0aW9uKXtcbiAgICAgIG9wdGlvbnMuYXBwbGljYXRpb24uZmlyZShcImVudGl0eTpjcmVhdGVkXCIse3RhcmdldCA6IHRoaXMgLCBvcHRpb25zIDogb3B0aW9uc30pO1xuICAgIH1cblxuICAgIHRoaXMuaWQgPSBmYWJyaWMuU2xpZGVDYW52YXMuX19pZGNvdW50ZXIrKztcblxuICAgIHRoaXMuX29iamVjdHMgPSBbXTtcbiAgICB0aGlzLl9jcmVhdGVMb3dlckNhbnZhcyhlbCk7XG5cblxuICAgIGlmKCF0aGlzLnZpcnR1YWwpe1xuICAgICAgdGhpcy5jcmVhdGVkID0gdHJ1ZTtcblxuXG4gICAgICB0aGlzLl9jdXJyZW50VHJhbnNmb3JtID0gbnVsbDtcbiAgICAgIHRoaXMuX2dyb3VwU2VsZWN0b3IgPSBudWxsO1xuICAgICAgdGhpcy5faW5pdFdyYXBwZXJFbGVtZW50KCk7XG4gICAgICB0aGlzLl9jcmVhdGVVcHBlckNhbnZhcygpO1xuICAgICAgdGhpcy5faW5pdEV2ZW50TGlzdGVuZXJzKCk7XG4gICAgICB0aGlzLl9pbml0UmV0aW5hU2NhbGluZygpO1xuICAgICAgdGhpcy5jYWxjT2Zmc2V0KCk7XG4gICAgICB0aGlzLmluaXRMYXllcnMoKTtcblxuXG5cbiAgICAgIHRoaXMuX2NyZWF0ZUNhY2hlQ2FudmFzKCk7XG4gICAgICB0aGlzLl9zZXRJbWFnZVNtb290aGluZygpO1xuICAgICAgdGhpcy5faW5pdFJldGluYVNjYWxpbmcoKTtcbiAgICB9ZWxzZXtcbiAgICAgIHRoaXMuaW5pdExheWVycygpO1xuICAgIH1cblxuICAgIHRoaXMucGx1Z2lucy5pbml0aWFsaXplLmZvckVhY2goZnVuY3Rpb24oaW5pdGlhbGl6ZXIpe1xuICAgICAgaW5pdGlhbGl6ZXIuY2FsbCh0aGlzLCBvcHRpb25zKTtcbiAgICB9LmJpbmQodGhpcykpO1xuXG4gICAgaWYob3B0aW9uc1tcIithY3Rpb25zXCJdKSB7XG4gICAgICB0aGlzLnNldChcIithY3Rpb25zXCIsIG9wdGlvbnNbXCIrYWN0aW9uc1wiXSlcbiAgICB9XG4gICAgaWYob3B0aW9ucy5hY3Rpb25zKXtcbiAgICAgIHRoaXMuc2V0KFwiYWN0aW9uc1wiLG9wdGlvbnMuYWN0aW9ucylcbiAgICB9XG5cblxuICAgIGlmKG9wdGlvbnMgJiYgb3B0aW9ucy5vblJlc2l6ZSl7XG4gICAgICB0aGlzLm9uUmVzaXplID0gb3B0aW9ucy5vblJlc2l6ZTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5yZXF1ZXN0QW5pbUZyYW1lKSB7XG4gICAgICB0aGlzLmFkZFZpZGVvc1N1cHBvcnQoKTtcbiAgICB9XG5cbiAgICB0aGlzLl9pbml0T3B0aW9ucygpO1xuXG4gICAgdGhpcy5fc2V0T2JqZWN0KG9wdGlvbnMpO1xuXG4gICAgdGhpcy5jYWxjT2Zmc2V0KCk7XG5cbiAgICAvLyB0aGlzLmxvYWQob3B0aW9ucyxjYWxsYmFjayk7XG5cbiAgICB0aGlzLmZpcmUoXCJjcmVhdGVkXCIpO1xuICAgIC8vIGlmKHRoaXMuYXBwbGljYXRpb24pe1xuICAgIC8vICAgdGhpcy5hcHBsaWNhdGlvbi5maXJlKFwiY2FudmFzOmNyZWF0ZWRcIix7dGFyZ2V0IDogdGhpc30pO1xuICAgIC8vIH1cbiAgfSxcbiAgaW5pdExheWVyczogZnVuY3Rpb24oKXtcbiAgICBpZih0aGlzLnVwcGVyQ2FudmFzRWwpe1xuICAgICAgdGhpcy53cmFwcGVyRWwuYXBwZW5kQ2hpbGQodGhpcy51cHBlckNhbnZhc0VsKTtcbiAgICB9XG4gICAgLy90b2RvIGZyb20gbGF5ZXJzIG1vZHVsZVxuICB9LFxuICBjcmVhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmNyZWF0ZWQgPSB0cnVlO1xuICAgIHRoaXMuX2luaXRJbnRlcmFjdGl2ZSgpO1xuICAgIHRoaXMuX2NyZWF0ZUNhY2hlQ2FudmFzKCk7XG4gIH0sXG4gIHRvT2JqZWN0OiBmdW5jdGlvbiAocHJvcGVydGllc1RvSW5jbHVkZSkge1xuXG4gICAgcHJvcGVydGllc1RvSW5jbHVkZSA9IChwcm9wZXJ0aWVzVG9JbmNsdWRlIHx8IFtdKS5jb25jYXQodGhpcy5zdG9yZVByb3BlcnRpZXMpO1xuXG4gICAgdmFyIF9zZWxmID0gIHRoaXM7XG4gICAgdmFyIF9vYmpzID0gdGhpcy5nZXRPYmplY3RzKCk7XG5cbiAgICBfb2JqcyA9IGZhYnJpYy51dGlsLm9iamVjdC5maWx0ZXIoX29ianMse3N0b3JlZDogdHJ1ZX0pO1xuICAgIF9vYmpzID0gX29ianMubWFwKGZ1bmN0aW9uKGluc3RhbmNlKSB7XG4gICAgICByZXR1cm4gaW5zdGFuY2UudG9PYmplY3QoX3NlbGYub2JqZWN0c1Byb3BlcnRpZXNUb0luY2x1ZGUpO1xuICAgIH0pO1xuXG4gICAgdmFyIF9kYXRhID0ge1xuICAgICAgb2JqZWN0czogX29ianNcbiAgICB9O1xuXG4gICAgZmFicmljLnV0aWwucG9wdWxhdGVXaXRoUHJvcGVydGllcyh0aGlzLCBfZGF0YSwgdGhpcy5wcm9wZXJ0aWVzVG9JbmNsdWRlKTtcbiAgICAvL1xuICAgIC8vIGZvcih2YXIgaSBpbiBwcm9wZXJ0aWVzVG9JbmNsdWRlKXtcbiAgICAvLyAgIHZhciBfcHJvcCA9IHByb3BlcnRpZXNUb0luY2x1ZGVbaV07XG4gICAgLy8gICBfZGF0YVtfcHJvcF0gPSB0aGlzW19wcm9wXTtcbiAgICAvLyB9XG5cbiAgICBpZihwcm9wZXJ0aWVzVG9JbmNsdWRlLmluZGV4T2YoJ2JhY2tncm91bmRJbWFnZScpICE9PSAtMSl7XG4gICAgICBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKF9kYXRhLCB0aGlzLl9fc2VyaWFsaXplQmdPdmVybGF5KCkpO1xuICAgIH1cblxuICAgIGlmKHByb3BlcnRpZXNUb0luY2x1ZGUuaW5kZXhPZignd2lkdGgnKSAhPT0gLTEgJiYgdGhpcy5vcmlnaW5hbFdpZHRoKXtcbiAgICAgIF9kYXRhLndpZHRoID0gdGhpcy5vcmlnaW5hbFdpZHRoO1xuICAgIH1cbiAgICBpZihwcm9wZXJ0aWVzVG9JbmNsdWRlLmluZGV4T2YoJ2hlaWdodCcpICE9PSAtMSAmJiB0aGlzLm9yaWdpbmFsSGVpZ2h0KXtcbiAgICAgIF9kYXRhLmhlaWdodCA9IHRoaXMub3JpZ2luYWxIZWlnaHQ7XG4gICAgfVxuXG4gICAgdGhpcy5wbHVnaW5zLnNhdmVycy5mb3JFYWNoKGZ1bmN0aW9uKHNhdmVyKXtcbiAgICAgIHNhdmVyLmNhbGwodGhpcywgcHJvcGVydGllc1RvSW5jbHVkZSwgX2RhdGEpO1xuICAgIH0uYmluZCh0aGlzKSk7XG4gICAgdGhpcy5maXJlKFwiYmVmb3JlOm9iamVjdFwiLHtvYmplY3Q6IF9kYXRhfSk7XG5cbiAgICByZXR1cm4gX2RhdGE7XG4gIH0sXG4gIHNldFRlbXBsYXRlOiBmdW5jdGlvbih0ZW1wbGF0ZSl7XG5cbiAgICB0aGlzLnRlbXBsYXRlID0gdGVtcGxhdGU7XG4gICAgaWYoIXRlbXBsYXRlKXJldHVybjtcblxuICAgIHRoaXMuc2V0V2lkdGgodGhpcy5zbGlkZVdpZHRoIHx8IHRlbXBsYXRlLndpZHRoKTtcbiAgICB0aGlzLnNldEhlaWdodCh0aGlzLnNsaWRlSGVpZ2h0IHx8IHRlbXBsYXRlLmhlaWdodCk7XG4gICAgdGhpcy5vcmlnaW5hbEhlaWdodCA9IHRoaXMuaGVpZ2h0O1xuICAgIHRoaXMub3JpZ2luYWxXaWR0aCA9IHRoaXMud2lkdGg7XG5cbiAgICB0aGlzLnNldChmYWJyaWMudXRpbC5vYmplY3QucmVhcnJhbmdlKHRlbXBsYXRlLFtcImFyZWFzXCIsXCJoZWxwZXJzXCIsXCJvZmZzZXRzXCJdKSk7XG5cbiAgICB0aGlzLl91cGRhdGVfY2xpcF9yZWN0KCk7XG4gICAgdGhpcy5fdXBkYXRlX2JhY2tncm91bmRfaW1hZ2UoKTtcbiAgICB0aGlzLmZpcmUoXCJtb2RpZmllZFwiLHt0eXBlOiBcInRlbXBsYXRlXCJ9KTtcbiAgICB0aGlzLnJlbmRlckFsbCgpO1xuICB9LFxuICBhZGRUZXh0OiBmdW5jdGlvbiAodGV4dCwgb3B0aW9ucykge1xuICAgIHRoaXMuY3JlYXRlT2JqZWN0KHtcbiAgICAgIHBvc2l0aW9uOiBcImNlbnRlclwiLFxuICAgICAgdGV4dDogdGV4dCxcbiAgICAgIHR5cGU6ICAgdGhpcy5kZWZhdWx0VGV4dFR5cGUsXG4gICAgICBjbGlwVG86IHRoaXMuYWN0aXZlQXJlYSxcbiAgICAgIG1vdmVtZW50TGltaXRzIDogdGhpcy5hY3RpdmVBcmVhXG4gICAgfSk7XG4gIH0sXG4gIC8qKlxuICAgKiBBZGRpdGlvbmFsIEV2ZW50IExpc3RlbmVyc1xuICAgKiAgLSBsb2FkaW5nOmVuZFxuICAgKiAgLSB0YXJnZXQ6bW9kaWZpZWQgLSBjb3VsZGJlIHVzZWQgdG8gZGV0ZWN0IGFjdGl2ZSBvYmplY3QgY2hhbmdlc1xuICAgKiAgLSB0YXJnZXQ6Y2hhbmdlZFxuICAgKiAgLSB0YXJnZXQ6Y2xlYXJlZFxuICAgKi9cbiAgZXZlbnRMaXN0ZW5lcnM6IHtcbiAgICAnb2JqZWN0Om1vdmluZyc6IGZ1bmN0aW9uIChvYmopIHtcbiAgICAgIHRoaXMuZmlyZSgndGFyZ2V0Om1vZGlmaWVkJywgdGhpcywgb2JqKVxuICAgIH0sXG4gICAgJ3NlbGVjdGlvbjpjbGVhcmVkJzogZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICBpZighdGhpcy50YXJnZXQpcmV0dXJuO1xuICAgICAgdGhpcy50YXJnZXQuZmlyZSgnZGVzZWxlY3RlZCcsIGV2ZW50KTtcbiAgICAgIHRoaXMudGFyZ2V0ID0gbnVsbDtcbiAgICAgIHRoaXMuZmlyZSgndGFyZ2V0OmNsZWFyZWQnLCBldmVudCk7XG4gICAgfSxcbiAgICAnb2JqZWN0OnNlbGVjdGVkJzogZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICBldmVudC5wcmV2aW91cyA9IHRoaXMudGFyZ2V0O1xuICAgICAgdGhpcy50YXJnZXQgPSBldmVudC50YXJnZXQ7XG4gICAgICBpZihldmVudC5wcmV2aW91cyl7XG4gICAgICAgIGV2ZW50LnByZXZpb3VzLmZpcmUoJ2Rlc2VsZWN0ZWQnLCBldmVudCk7XG4gICAgICB9XG4gICAgICB0aGlzLmZpcmUoJ3RhcmdldDpjaGFuZ2VkJywgZXZlbnQpO1xuICAgIH0sXG4gICAgJ2dyb3VwOnNlbGVjdGVkJzogZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICB0aGlzLnRhcmdldCA9IGV2ZW50LnRhcmdldDtcbiAgICAgIHRoaXMuZmlyZSgndGFyZ2V0OmNoYW5nZWQnLCBldmVudCk7XG4gICAgfVxuICB9XG59KTtcbmZhYnJpYy5TbGlkZUNhbnZhcy5fX2lkY291bnRlciA9IDA7XG5mYWJyaWMuU2xpZGVDYW52YXMuZnJvbUpzb24gPSBmdW5jdGlvbih1cmwsY2FsbGJhY2sgLCBlbGVtZW50KXtcbiAgZmFicmljLnV0aWwuZGF0YS5sb2FkSnNvbih1cmwsZnVuY3Rpb24oZGF0YSl7XG4gICAgbmV3IGZhYnJpYy5TbGlkZUNhbnZhcyhlbGVtZW50LGRhdGEsY2FsbGJhY2spXG4gIH0pXG59O1xuXG5mYWJyaWMuU2xpZGVDYW52YXMucHJvdG90eXBlLmFjdGlvbnMgPSBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKHt9LCB7XG4gIHNlbGVjdEFsbDoge1xuICAgdGl0bGU6ICdzZWxlY3RBbGwnLFxuICAgdHlwZTogJ2tleSdcbiAgfSxcbiAgYmFja2dyb3VuZENvbG9yIDoge1xuICAgIHR5cGU6IFwiY29sb3JcIlxuICB9LFxuICBhZGRUZXh0OiB7XG4gICAgY2xhc3NOYW1lOiAgJ2ZhIGZhLWZvbnQnLFxuICAgIHRpdGxlOiAndGV4dCcsXG4gICAgYWN0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLmFkZFRleHQodGhpcy5kZWZhdWx0VGV4dCx7fSk7XG4gICAgfVxuICB9XG59KTtcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuQXBwbGljYXRpb24ucHJvdG90eXBlLCB7XG4gIHNldFNsaWRlOiBmdW5jdGlvbiAodmFsdWUsIGNhbGxiYWNrKSB7XG4gICAgdmFyIF9jYW52YXMgPSB0aGlzLmNhbnZhcztcbiAgICBpZiAoX2NhbnZhcy5sb2FkKSB7XG4gICAgICBfY2FudmFzLmxvYWQodmFsdWUsIGNhbGxiYWNrKTtcbiAgICB9IGVsc2Uge1xuICAgICAgX2NhbnZhcy5jcmVhdGVPYmplY3RzKHZhbHVlLCBjYWxsYmFjayk7XG4gICAgfVxuICB9XG59KTtcblxuZmFicmljLkFwcGxpY2F0aW9uLnByb3RvdHlwZS5jYW52YXNDbGFzcyA9ICdTbGlkZUNhbnZhcyc7XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL2NvcmUvc2xpZGUuanNcbi8vIG1vZHVsZSBpZCA9IDI2XG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsInZhciB0ZXh0SW5pdGlhbGl6ZSA9IGZhYnJpYy5UZXh0LnByb3RvdHlwZS5pbml0aWFsaXplO1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5UZXh0LnByb3RvdHlwZSwge1xuICB0ZXh0SW5pdGlhbGl6ZTogdGV4dEluaXRpYWxpemUsXG4gIGVkaXRUb29sOiBmYWxzZSxcbiAgYWR2YW5jZWRDb2xvcnNUb29sczogZmFsc2UsXG4gIHRleHRGb250U2l6ZVRvb2xzOiBmYWxzZSxcbiAgdGV4dEFsaWdtZW50VG9vbHM6IGZhbHNlLFxuICBhZHZhbmNlZFRleHRTdHlsZVRvb2xzOiBmYWxzZSxcbiAgcmFzdGVyaXplVG9vbDogZmFsc2UsXG4gIHJhc3Rlcml6ZUtsYXNzOiBmYWJyaWMuSW1hZ2UsXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uICh0ZXh0LCBvcHRpb25zKSB7XG4gICAgdGhpcy5faW5pdEVudGl0eShvcHRpb25zKTtcbiAgICB0aGlzLnRleHRJbml0aWFsaXplKHRleHQsIG9wdGlvbnMpO1xuICAgIC8vIHRoaXMudXBkYXRlQ2FjaGUoKTtcbiAgfSxcbiAgICBfcmVuZGVyX2NhY2hlOiBmdW5jdGlvbiAoY3R4KSB7XG4gIGN0eC5zYXZlKCk7XG4gIGN0eC5zY2FsZShcbiAgICB0aGlzLnNjYWxlWCAqICh0aGlzLmZsaXBYID8gLTEgOiAxKSxcbiAgICB0aGlzLnNjYWxlWSAqICh0aGlzLmZsaXBZID8gLTEgOiAxKVxuICApO1xuICB0aGlzLnRyYW5zZm9ybShjdHgpO1xuICB0aGlzLl9zZXRTaGFkb3coY3R4KTtcbiAgY3R4LnRyYW5zbGF0ZSgtdGhpcy53aWR0aCAvIDIsIC10aGlzLmhlaWdodCAvIDIpO1xuICBjdHguZHJhd0ltYWdlKHRoaXMuX2NhY2hlLCAwLCAwLCB0aGlzLndpZHRoLCB0aGlzLmhlaWdodCk7XG4gIGN0eC5yZXN0b3JlKCk7XG59LFxuICB1cGRhdGVDYWNoZTogZnVuY3Rpb24gKCkge1xuXG4gICAgdmFyIHNpemUgPSB7XG4gICAgICB3aWR0aDogdGhpcy53aWR0aCAqIHRoaXMuY2FudmFzLmRvdHNQZXJVbml0LFxuICAgICAgaGVpZ2h0OiB0aGlzLmhlaWdodCAqIHRoaXMuY2FudmFzLmRvdHNQZXJVbml0XG4gICAgfTtcblxuICAgIHZhciBfY2xpcFRvID0gdGhpcy5jbGlwVG87XG4gICAgZGVsZXRlIHRoaXMuY2xpcFRvO1xuICAgIHRoaXMuX2NhY2hlID0gZmFicmljLnV0aWwuY3JlYXRlQ2FudmFzRWxlbWVudFdpdGhTaXplKHNpemUpO1xuICAgIHZhciBjdHggPSB0aGlzLl9jYWNoZS5nZXRDb250ZXh0KFwiMmRcIik7XG4gICAgY3R4LnNjYWxlKFxuICAgICAgdGhpcy5jYW52YXMuZG90c1BlclVuaXQsXG4gICAgICB0aGlzLmNhbnZhcy5kb3RzUGVyVW5pdCk7XG4gICAgY3R4LnRyYW5zbGF0ZSh0aGlzLndpZHRoIC8gMiwgdGhpcy5oZWlnaHQgLyAyKTtcblxuICAgIHRoaXMucmVuZGVyKGN0eCwgdHJ1ZSk7XG4gICAgdGhpcy5yZW5kZXIgPSB0aGlzLl9yZW5kZXJfY2FjaGU7XG4gICAgdGhpcy5jbGlwVG8gPSBfY2xpcFRvO1xuXG4gIH0sXG4gIHJhc3Rlcml6ZVRleHQ6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLnVwZGF0ZUNhY2hlKCk7XG4gICAgdmFyIGltZyA9IGZhYnJpYy51dGlsLmNyZWF0ZUltYWdlKCk7XG5cbiAgICBpbWcub25sb2FkID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIG9iaiA9IHRoaXMudG9PYmplY3QoKTtcbiAgICAgIG9iai53aWR0aCA9IGltZy53aWR0aDtcbiAgICAgIG9iai5oZWlnaHQgPSBpbWcuaGVpZ2h0O1xuICAgICAgb2JqLnNjYWxlWCA9IHRoaXMuc2NhbGVYICogKHRoaXMuaGVpZ2h0IC8gaW1nLmhlaWdodCk7XG4gICAgICBvYmouc2NhbGVZID0gdGhpcy5zY2FsZVkgKiAodGhpcy53aWR0aCAvIGltZy53aWR0aCApO1xuICAgICAgb2JqLnJhc3Rlcml6ZWRUeXBlID0gb2JqLnR5cGU7XG4gICAgICBkZWxldGUgb2JqLnR5cGU7XG5cbiAgICAgIHZhciBlbCA9IG5ldyB0aGlzLnJhc3Rlcml6ZUtsYXNzKGltZywgb2JqKTtcbiAgICAgIHRoaXMuY2FudmFzLmFkZChlbCk7XG4gICAgICB0aGlzLmNhbnZhcy5yZW1vdmUodGhpcyk7XG4gICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5jYW52YXMuc2V0QWN0aXZlT2JqZWN0KGVsKTtcbiAgICAgICAgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gICAgICB9LmJpbmQodGhpcykpXG4gICAgfS5iaW5kKHRoaXMpO1xuICAgIGltZy5zcmMgPSB0aGlzLl9jYWNoZS50b0RhdGFVUkwoKTtcbiAgICAvL3RoaXMub24oJ21vZGlmaWVkJyx0aGlzLnVwZGF0ZUNhY2hlLmJpbmQodGhpcykpO1xuICB9LFxuICBnZXRTdHlsZTogZnVuY3Rpb24gKHN0eWxlTmFtZSkge1xuICAgIHZhciBvYmplY3QgPSB0aGlzO1xuICAgIHJldHVybiAob2JqZWN0LmdldFNlbGVjdGlvblN0eWxlcyAmJiBvYmplY3QuaXNFZGl0aW5nKVxuICAgICAgPyAob2JqZWN0LmdldFNlbGVjdGlvblN0eWxlcygpW3N0eWxlTmFtZV0gfHwgb2JqZWN0W3N0eWxlTmFtZV0pXG4gICAgICA6IChvYmplY3Rbc3R5bGVOYW1lXSB8fCBvYmplY3RbJ19fJyArIHN0eWxlTmFtZV0gfHwgJycpO1xuICB9LFxuICBnZXRQYXR0ZXJuOiBmdW5jdGlvbiAodXJsKSB7XG4gICAgdmFyIF9maWxsID0gdGhpcy5nZXRTdHlsZSgnZmlsbCAnKTtcbiAgICByZXR1cm4gX2ZpbGwgJiYgX2ZpbGwuc291cmNlO1xuICB9LFxuICBzZXRQYXR0ZXJuOiBmdW5jdGlvbiAodXJsKSB7XG4gICAgaWYgKCF1cmwpIHtcbiAgICAgIHRoaXMuc2V0U3R5bGUoJ2ZpbGwnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gdmFyIF90ZXh0dXJlID0gXy5maW5kV2hlcmUodGhpcy5wcm9qZWN0LnRleHR1cmVzLCB7aWQ6IHVybH0pO1xuICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgIGZhYnJpYy51dGlsLmxvYWRJbWFnZSh1cmwsIGZ1bmN0aW9uKGltZykge1xuICAgICAgICBfdGhpcy5zZXRTdHlsZSgnZmlsbCcsIG5ldyBmYWJyaWMuUGF0dGVybih7XG4gICAgICAgICAgc291cmNlOiBpbWcsXG4gICAgICAgICAgcmVwZWF0OiAncmVwZWF0J1xuICAgICAgICB9KSk7XG4gICAgICB9KTtcbiAgICB9XG4gIH0sXG4gIGdldE9wYWNpdHk6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5nZXRTdHlsZSgnb3BhY2l0eScpICogMTAwO1xuICB9LFxuICBzZXRPcGFjaXR5OiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICB0aGlzLnNldFN0eWxlKCdvcGFjaXR5JywgcGFyc2VJbnQodmFsdWUsIDEwKSAvIDEwMCk7XG4gIH0sXG4gIGdldFJhZGl1czogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLmdldCgncmFkaXVzJyk7XG4gIH0sXG4gIHNldFNoYWRvdzogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgIHJldHVybiB0aGlzLnNldFByb3BlcnR5KCdzaGFkb3cnLCBvcHRpb25zID8gbmV3IGZhYnJpYy5TaGFkb3cob3B0aW9ucykgOiBudWxsKTtcbiAgfSxcbiAgc2V0UHJvcGVydHk6IGZ1bmN0aW9uIChwcm9wLCB2YWx1ZSkge1xuICAgIHRoaXNbcHJvcF0gPSB2YWx1ZTtcbiAgICB0aGlzLmNhbnZhcyAmJiB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgfSxcbiAgc2V0UmFkaXVzOiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICB0aGlzLnNldFByb3BlcnR5KCdyYWRpdXMnLCB2YWx1ZSk7XG4gIH0sXG4gIGdldFNwYWNpbmc6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5nZXQoJ3NwYWNpbmcnKTtcbiAgfSxcbiAgc2V0U3BhY2luZzogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgdGhpcy5zZXRQcm9wZXJ0eSgnc3BhY2luZycsIHZhbHVlKTtcbiAgfSxcbiAgZ2V0UmV2ZXJ0ZWQ6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5nZXQoJ3JldmVydGVkJyk7XG4gIH0sXG4gIHNldFJldmVydGVkOiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICB0aGlzLnNldFByb3BlcnR5KCdyZXZlcnRlZCcsIHZhbHVlKTtcbiAgfSxcbiAgZ2V0RmlsbDogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLmdldFN0eWxlKCdmaWxsJyk7XG4gIH0sXG4gIHNldEZpbGw6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgIHRoaXMuc2V0U3R5bGUoJ2ZpbGwnLCB2YWx1ZSk7XG4gIH0sXG4gIGdldFRleHQ6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5nZXQoJ3RleHQnKTtcbiAgfSxcbiAgc2V0VGV4dDogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgdGhpcy5zZXRQcm9wZXJ0eSgndGV4dCcsIHZhbHVlKTtcbiAgfSxcbiAgZ2V0VGV4dEFsaWduOiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0KCd0ZXh0QWxpZ24nKTtcbiAgfSxcbiAgc2V0VGV4dEFsaWduOiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICB0aGlzLnNldFByb3BlcnR5KCd0ZXh0QWxpZ24nLCB2YWx1ZS50b0xvd2VyQ2FzZSgpKTtcbiAgfSxcbiAgZ2V0Rm9udEZhbWlseTogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLmdldCgnZm9udEZhbWlseScpO1xuICB9LFxuICBzZXRGb250RmFtaWx5OiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICB0aGlzLnNldFN0eWxlKCdmb250RmFtaWx5JywgdmFsdWUpO1xuICB9LFxuICBnZXRTdHlsZXM6IGZ1bmN0aW9uKCl7XG4gICAgcmV0dXJuIHRoaXMuc3R5bGVzIHx8IHtcbiAgICAgICAgZmlsbCA6ICAgICAgICAgICAgICAgIHRoaXMuZmlsbCxcbiAgICAgICAgZm9udFNpemUgOiAgICAgICAgICAgIHRoaXMuZm9udFNpemUsXG4gICAgICAgIHRleHRCYWNrZ3JvdW5kQ29sb3IgOiB0aGlzLnRleHRCYWNrZ3JvdW5kQ29sb3IsXG4gICAgICAgIHRleHREZWNvcmF0aW9uIDogICAgICB0aGlzLnRleHREZWNvcmF0aW9uLFxuICAgICAgICBmb250RmFtaWx5IDogICAgICAgICAgdGhpcy5mb250RmFtaWx5LFxuICAgICAgICBmb250V2VpZ2h0IDogICAgICAgICAgdGhpcy5mb250V2VpZ2h0LFxuICAgICAgICBmb250U3R5bGUgOiAgICAgICAgICAgdGhpcy5mb250U3R5bGUsXG4gICAgICAgIHN0cm9rZSA6ICAgICAgICAgICAgICB0aGlzLnN0cm9rZSxcbiAgICAgICAgc3Ryb2tlV2lkdGggOiAgICAgICAgIHRoaXMuc3Ryb2tlV2lkdGhcbiAgICAgIH07XG4gIH0sXG4gIGdldEJnQ29sb3I6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5nZXQoJ2JhY2tncm91bmRDb2xvcicpO1xuICB9LFxuICBzZXRCZ0NvbG9yOiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICB0aGlzLnNldFByb3BlcnR5KCdiYWNrZ3JvdW5kQ29sb3InLCB2YWx1ZSk7XG4gIH0sXG4gIGdldFRleHRCZ0NvbG9yOiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0KCd0ZXh0QmFja2dyb3VuZENvbG9yJyk7XG4gIH0sXG4gIHNldFRleHRCZ0NvbG9yOiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICB0aGlzLnNldFByb3BlcnR5KCd0ZXh0QmFja2dyb3VuZENvbG9yJywgdmFsdWUpO1xuICB9LFxuICBnZXRTdHJva2U6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5nZXRTdHlsZSgnc3Ryb2tlJyk7XG4gIH0sXG4gIHNldFN0cm9rZTogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgdGhpcy5zZXRTdHlsZSgnc3Ryb2tlJywgdmFsdWUpO1xuICB9LFxuICBnZXRTdHJva2VXaWR0aDogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLmdldFN0eWxlKCdzdHJva2VXaWR0aCcpO1xuICB9LFxuICBzZXRTdHJva2VXaWR0aDogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgdGhpcy5zZXRTdHlsZSgnc3Ryb2tlV2lkdGgnLCBwYXJzZUludCh2YWx1ZSwgMTApKTtcbiAgfSxcbiAgZGVjcmVhc2VGb250U2l6ZTogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuc2V0U3R5bGUoJ2ZvbnRTaXplJywgcGFyc2VJbnQodGhpcy5nZXRTdHlsZSgnZm9udFNpemUnKSkgLSAxKTtcbiAgfSxcbiAgaW5jcmVhc2VGb250U2l6ZTogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuc2V0U3R5bGUoJ2ZvbnRTaXplJywgcGFyc2VJbnQodGhpcy5nZXRTdHlsZSgnZm9udFNpemUnKSkgKyAxKTtcbiAgfSxcbiAgZ2V0Rm9udFNpemU6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5nZXRTdHlsZSgnZm9udFNpemUnKTtcbiAgfSxcbiAgc2V0Rm9udFNpemU6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgIHRoaXMuc2V0U3R5bGUoJ2ZvbnRTaXplJywgcGFyc2VJbnQodmFsdWUsIDEwKSk7XG4gIH0sXG4gIGdldExpbmVIZWlnaHQ6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5nZXRTdHlsZSgnbGluZUhlaWdodCcpO1xuICB9LFxuICBzZXRMaW5lSGVpZ2h0OiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICB0aGlzLnNldFN0eWxlKCdsaW5lSGVpZ2h0JywgcGFyc2VGbG9hdCh2YWx1ZSwgMTApKTtcbiAgfSxcbiAgYWRkVGV4dDogZnVuY3Rpb24gKHRleHQsb3B0aW9ucykge1xuXG4gICAgdmFyIF9tYXRjaCA9IHRoaXMudGV4dC5tYXRjaCgvXFxuL2cpO1xuICAgIHZhciBfbGluZUluZGV4ID0gX21hdGNoICYmIF9tYXRjaC5sZW5ndGggfHwgMDtcbiAgICB2YXIgY2hhckluZGV4ID0gdGhpcy50ZXh0Lmxlbmd0aCAtIHRoaXMudGV4dC5sYXN0SW5kZXhPZihcIlxcblwiKSAtIDE7XG5cbiAgICBpZighdGhpcy5zdHlsZXNbX2xpbmVJbmRleF0pe1xuICAgICAgdGhpcy5zdHlsZXNbX2xpbmVJbmRleF0gPSB7fVxuICAgIH1cblxuICAgIGlmKCF0aGlzLnN0eWxlc1tfbGluZUluZGV4XVtjaGFySW5kZXhdKXtcbiAgICAgIHRoaXMuc3R5bGVzW19saW5lSW5kZXhdW2NoYXJJbmRleF0gPSB7fVxuICAgIH1cbiAgICBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKHRoaXMuc3R5bGVzW19saW5lSW5kZXhdW2NoYXJJbmRleF0sb3B0aW9ucyk7XG4gICAgdGhpcy50ZXh0ICs9dGV4dDtcbiAgICAvLyB0aGlzLnN0eWxlcztcbiAgfSxcbiAgZ2V0Qm9sZDogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLmdldFN0eWxlKCdmb250V2VpZ2h0JykgPT09IFwiYm9sZFwiO1xuICB9LFxuICBzZXRCb2xkOiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICB0aGlzLnNldFN0eWxlKCdmb250V2VpZ2h0JywgdmFsdWUgPyAnYm9sZCcgOiAnJyk7XG4gIH0sXG4gIGdldEl0YWxpYzogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLmdldFN0eWxlKCdmb250U3R5bGUnKSA9PT0gJ2l0YWxpYyc7XG4gIH0sXG4gIHNldEl0YWxpYzogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgdGhpcy5zZXRTdHlsZSgnZm9udFN0eWxlJywgdmFsdWUgPyAnaXRhbGljJyA6ICcnICk7XG4gIH0sXG4gIGdldFVuZGVybGluZTogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLmdldFN0eWxlKCd0ZXh0RGVjb3JhdGlvbicpLmluZGV4T2YoJ3VuZGVybGluZScpID4gLTE7XG4gIH0sXG4gIHNldFVuZGVybGluZTogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgdmFsdWUgPSB2YWx1ZSA/ICh0aGlzLmdldFN0eWxlKCd0ZXh0RGVjb3JhdGlvbicpICsgJyB1bmRlcmxpbmUnKVxuICAgICAgOiB0aGlzLmdldFN0eWxlKCd0ZXh0RGVjb3JhdGlvbicpLnJlcGxhY2UoJ3VuZGVybGluZScsICcnKTtcblxuICAgIHRoaXMuc2V0U3R5bGUoJ3RleHREZWNvcmF0aW9uJywgdmFsdWUpO1xuICB9LFxuICBnZXRMaW5ldGhyb3VnaDogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLmdldFN0eWxlKCd0ZXh0RGVjb3JhdGlvbicpLmluZGV4T2YoJ2xpbmUtdGhyb3VnaCcpID4gLTE7XG4gIH0sXG4gIHNldExpbmV0aHJvdWdoOiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICB2YWx1ZSA9IHZhbHVlID8gKHRoaXMuZ2V0U3R5bGUoJ3RleHREZWNvcmF0aW9uJykgKyAnIGxpbmUtdGhyb3VnaCcpXG4gICAgICA6IHRoaXMuZ2V0U3R5bGUoJ3RleHREZWNvcmF0aW9uJykucmVwbGFjZSgnbGluZS10aHJvdWdoJywgJycpO1xuXG4gICAgdGhpcy5zZXRTdHlsZSgndGV4dERlY29yYXRpb24nLCB2YWx1ZSk7XG4gIH0sXG4gIGdldE92ZXJsaW5lOiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0U3R5bGUoJ3RleHREZWNvcmF0aW9uJykuaW5kZXhPZignb3ZlcmxpbmUnKSA+IC0xO1xuICB9LFxuICBzZXRPdmVybGluZTogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgdmFsdWUgPSB2YWx1ZSA/ICh0aGlzLmdldFN0eWxlKCd0ZXh0RGVjb3JhdGlvbicpICsgJyBvdmVybGluZScpXG4gICAgICA6IHRoaXMuZ2V0U3R5bGUoJ3RleHREZWNvcmF0aW9uJykucmVwbGFjZSgnb3ZlcmxpbicsICcnKTtcblxuICAgIHRoaXMuc2V0U3R5bGUoJ3RleHREZWNvcmF0aW9uJywgdmFsdWUpO1xuICB9LFxuICBzZXRTdHlsZTogZnVuY3Rpb24gKHN0eWxlTmFtZSwgdmFsdWUpIHtcbiAgICB2YXIgb2JqZWN0ID0gdGhpcztcbiAgICB2YXIgX29sZCA9IGZhYnJpYy51dGlsLm9iamVjdC5jbG9uZURlZXAob2JqZWN0LmdldFN0eWxlcygpKTtcbiAgICAvL3ZhciBfb2xkID0gZmFicmljLnV0aWwub2JqZWN0LmRlZXBFeHRlbmQoe30sIG9iamVjdC5nZXRTdHlsZXMpOy8vZ2V0U2VsZWN0aW9uU3R5bGVzKCk7XG4gICAgaWYgKG9iamVjdC5zZXRTZWxlY3Rpb25TdHlsZXMgJiYgb2JqZWN0LmlzRWRpdGluZykge1xuICAgICAgdmFyIHN0eWxlID0ge307XG4gICAgICBpZiAodmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBzdHlsZVtzdHlsZU5hbWVdID0gdmFsdWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBkZWxldGUgc3R5bGVbc3R5bGVOYW1lXTtcbiAgICAgIH1cbiAgICAgIG9iamVjdC5zZXRTZWxlY3Rpb25TdHlsZXMoc3R5bGUpO1xuICAgICAgb2JqZWN0LnNldENvb3JkcygpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIGlmICh2YWx1ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIG9iamVjdFtzdHlsZU5hbWVdID0gdmFsdWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBkZWxldGUgb2JqZWN0W3N0eWxlTmFtZV07XG4gICAgICB9XG4gICAgICBmb3IgKHZhciBpIGluIG9iamVjdC5zdHlsZXMpIHtcbiAgICAgICAgZm9yICh2YXIgaiBpbiBvYmplY3Quc3R5bGVzW2ldKSB7XG4gICAgICAgICAgaWYgKG9iamVjdC5zdHlsZXNbaV1bal1bc3R5bGVOYW1lXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBkZWxldGUgb2JqZWN0LnN0eWxlc1tpXVtqXVtzdHlsZU5hbWVdO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHZhciBzdHlsZXNfZGF0YSA9IG9iamVjdC5nZXRTdHlsZXMoKTtcblxuICAgIGlmKHRoaXMudHlwZSAhPSBcInRleHRcIil7XG4gICAgICB0aGlzLnN0eWxlcyA9IGZhYnJpYy51dGlsLm9iamVjdC5jbG9uZURlZXAoc3R5bGVzX2RhdGEpO1xuICAgIH1cblxuICAgIHRoaXMuc2V0Q29vcmRzKCk7XG5cbiAgICB0aGlzLmZpcmUoXCJzdHlsZXM6bW9kaWZpZWRcIiwge1xuICAgICAgb3JpZ2luYWw6IF9vbGQsXG4gICAgICBtb2RpZmllZDogc3R5bGVzX2RhdGFcbiAgICB9KTtcbiAgICB0aGlzLmNhbnZhcyAmJiB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICAvKlxuICAgICB0aGlzLnByb2plY3QuaGlzdG9yeS5hZGQoe1xuICAgICBzbGlkZTogdGhpcy5zbGlkZSxcbiAgICAgb2JqZWN0OiB0aGlzLFxuICAgICB1bmRvOiBfb2xkLFxuICAgICByZWRvOiBzdHlsZXNfZGF0YSxcbiAgICAgdHlwZTogJ3N0eWxlZCcsXG4gICAgIHVuZG9GbjogZnVuY3Rpb24oKXtcbiAgICAgdGhpcy5vYmplY3QuZGF0YS5zdHlsZXMgPSB0aGlzLnVuZG87XG4gICAgIHRoaXMub2JqZWN0LmZhYnJpYy5zZXQoJ3N0eWxlcycsdGhpcy51bmRvKTtcbiAgICAgdGhpcy5vYmplY3QuZmFicmljLnNldENvb3JkcygpO1xuICAgICB0aGlzLm9iamVjdC5zbGlkZS5yZW5kZXIoKTtcbiAgICAgfSxcbiAgICAgcmVkb0ZuOiAgZnVuY3Rpb24oKXtcbiAgICAgdGhpcy5vYmplY3QuZGF0YS5zdHlsZXMgPSB0aGlzLnJlZG87XG4gICAgIHRoaXMub2JqZWN0LmZhYnJpYy5zZXQoJ3N0eWxlcycsdGhpcy5yZWRvKTtcbiAgICAgdGhpcy5vYmplY3QuZmFicmljLnNldENvb3JkcygpO1xuICAgICB0aGlzLm9iamVjdC5zbGlkZS5yZW5kZXIoKTtcbiAgICAgfVxuICAgICB9KTsqL1xuICB9LFxuXG4gIGdlbmVyYXRlVGV4dFN0eWxlOiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICdmb250LXN0eWxlJzogdGhpcy5pc0l0YWxpYygpID8gJ2l0YWxpYycgOiAnbm9ybWFsJyxcbiAgICAgICdmb250LXdlaWdodCc6IHRoaXMuaXNCb2xkKCkgPyA3MDAgOiA0MDAsXG4gICAgICAndGV4dC1kZWNvcmF0aW9uJzogKHRoaXMuaXNMaW5ldGhyb3VnaCgpID8gJ2xpbmUtdGhyb3VnaCAnIDogJycgKSArXG4gICAgICAodGhpcy5pc092ZXJsaW5lKCkgPyAnb3ZlcmxpbmUgJyA6ICcnICkgK1xuICAgICAgKHRoaXMuaXNVbmRlcmxpbmUoKSA/ICd1bmRlcmxpbmUgJyA6ICcnKVxuICAgIH1cbiAgfSxcbiAgYWN0aW9uczoge1xuICAgIHJhc3Rlcml6ZVRleHQ6IHtcbiAgICAgIGluc2VydDogJ3Jhc3Rlcml6ZVRvb2wnLFxuICAgICAgY2xhc3NOYW1lOiAnYnV0dG9uLWVhc2VsJyxcbiAgICAgIHRpdGxlOiAncmFzdGVyaXplVGV4dCcsXG4gICAvLyAgIGFjdGlvbjogX1RFWC5yYXN0ZXJpemVUZXh0XG4gICAgfSxcbiAgICBmaWxsOiB7XG4gICAgICB0eXBlOiAnY29sb3InLFxuICAgICAgdGl0bGU6ICdmaWxsJyxcbiAgICAgIGluc2VydDogJyFhZHZhbmNlZENvbG9yc1Rvb2xzJyxcbiAgICAgIHZhbHVlOiAnZmlsbCdcbiAgICB9LFxuICAgIHRleHRCZ2NvbG9yOiB7XG4gICAgICB0eXBlOiAnY29sb3InLFxuICAgICAgdGl0bGU6ICdiZ0NvbG9yJyxcbiAgICAgIHZhbHVlOiAnYmdDb2xvcidcbiAgICB9LFxuICAgIHRleHRUZXh0Ymdjb2xvcjoge1xuICAgICAgdHlwZTogJ2NvbG9yJyxcbiAgICAgIHRpdGxlOiAndGV4dEJnQ29sb3InLFxuICAgICAgdmFsdWU6ICd0ZXh0QmdDb2xvcidcbiAgICB9LFxuICAgIHRleHRGaWxsOiB7XG4gICAgICB0eXBlOiAnY29sb3InLFxuICAgICAgdGl0bGU6ICdmaWxsJyxcbiAgICAgIHZhbHVlOiAnZmlsbCdcbiAgICB9LFxuICAgIHRleHRCb2xkOiB7XG4gICAgICB0eXBlOiBcImNoZWNrYm94XCIsXG4gICAgICB0aXRsZTogJ2JvbGQnLFxuICAgICAgdmFsdWU6ICdib2xkJyxcbiAgICAgIGNsYXNzTmFtZTogJ2ZhIGZhLWJvbGQnXG4gICAgfSxcbiAgICB0ZXh0SXRhbGljOiB7XG4gICAgICB0eXBlOiBcImNoZWNrYm94XCIsXG4gICAgICB0aXRsZTogJ2l0YWxpYycsXG4gICAgICB2YWx1ZTogJ2l0YWxpYycsXG4gICAgICBjbGFzc05hbWU6ICdmYSBmYS1pdGFsaWMnXG4gICAgfSxcbiAgICB0ZXh0VW5kZXJsaW5lOiB7XG4gICAgICB0eXBlOiBcImNoZWNrYm94XCIsXG4gICAgICB0aXRsZTogJ1VuZGVybGluZScsXG4gICAgICB2YWx1ZTogJ3VuZGVybGluZScsXG4gICAgICBjbGFzc05hbWU6ICdmYSBmYS11bmRlcmxpbmUnXG4gICAgfSxcbiAgICB0ZXh0TGluZXRocm91Z2g6IHtcbiAgICAgIHR5cGU6IFwiY2hlY2tib3hcIixcbiAgICAgIGluc2VydDogJ2FkdmFuY2VkVGV4dFN0eWxlVG9vbHMnLFxuICAgICAgdGl0bGU6ICdMaW5ldGhyb3VnaCcsXG4gICAgICB2YWx1ZTogJ2xpbmV0aHJvdWdoJyxcbiAgICAgIGNsYXNzTmFtZTogJ3RleHQtbGluZXRocm91Z2ggZmEgZmEtc3RyaWtldGhyb3VnaCdcbiAgICB9LFxuICAgIHRleHRPdmVybGluZToge1xuICAgICAgdHlwZTogXCJjaGVja2JveFwiLFxuICAgICAgaW5zZXJ0OiAnYWR2YW5jZWRUZXh0U3R5bGVUb29scycsXG4gICAgICB0aXRsZTogJ292ZXJsaW5lJyxcbiAgICAgIHZhbHVlOiAnb3ZlcmxpbmUnLFxuICAgICAgY2xhc3NOYW1lOiAndGV4dC1vdmVybGluZSBmYSBmYS1vdmVybGluZSdcbiAgICB9LFxuICAgIHRleHRBbGlnbjoge1xuICAgICAgdHlwZTogJ29wdGlvbnMnLFxuICAgICAgdGl0bGU6ICd0ZXh0IGFsaWduJyxcbiAgICAgIGluc2VydDogJ3RleHRBbGlnbWVudFRvb2xzJyxcbiAgICAgIHZhbHVlOiBcInRleHRBbGlnblwiLFxuICAgICAgbWVudToge1xuICAgICAgICB0ZXh0QWxpZ25DZW50ZXI6IHtcbiAgICAgICAgICB0aXRsZTogJ2FsaWduIGNlbnRlcicsXG4gICAgICAgICAgb3B0aW9uOiAnY2VudGVyJyxcbiAgICAgICAgICBjbGFzc05hbWU6ICdmYSBmYS1hbGlnbi1jZW50ZXInXG4gICAgICAgIH0sXG4gICAgICAgIHRleHRBbGlnbkxlZnQ6IHtcbiAgICAgICAgICB0aXRsZTogJ2FsaWduIGxlZnQnLFxuICAgICAgICAgIG9wdGlvbjogJ2xlZnQnLFxuICAgICAgICAgIGNsYXNzTmFtZTogJ2ZhIGZhLWFsaWduLWxlZnQnXG4gICAgICAgIH0sXG4gICAgICAgIHRleHRBbGlnblJpZ2h0OiB7XG4gICAgICAgICAgdGl0bGU6ICdhbGlnbiByaWdodCcsXG4gICAgICAgICAgb3B0aW9uOiAncmlnaHQnLFxuICAgICAgICAgIGNsYXNzTmFtZTogJ2ZhIGZhLWFsaWduLXJpZ2h0J1xuICAgICAgICB9LFxuICAgICAgICB0ZXh0QWxpZ25KdXN0aWZ5OiB7XG4gICAgICAgICAgdGl0bGU6ICdhbGlnbiBqdXN0aWZ5JyxcbiAgICAgICAgICBvcHRpb246ICdqdXN0aWZ5JyxcbiAgICAgICAgICBjbGFzc05hbWU6ICdmYSBmYS1hbGlnbi1qdXN0aWZ5J1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcbiAgICBmb250RmFtaWx5OiB7XG4gICAgICB0eXBlOiAnZm9udEZhbWlseScsXG4gICAgICB0aXRsZTogJ2ZvbnQgZmFtaWx5JyxcbiAgICAgIGNsYXNzTmFtZTogJ2ZhIGZhLXRleHQnLFxuICAgICAgdmFsdWU6ICdmb250RmFtaWx5JyxcbiAgICAgIGRhdGE6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiB0aGlzLmFwcGxpY2F0aW9uLl9mb250c1xuICAgICAgfVxuICAgIH0sXG4gICAgdGV4dEZvbnRTaXplOiB7XG4gICAgICBpbnNlcnQ6ICd0ZXh0Rm9udFNpemVUb29scycsXG4gICAgICB0eXBlOiAnbnVtYmVyJyxcbiAgICAgIHRpdGxlOiAnZm9udFNpemUnLFxuICAgICAgdmFsdWU6ICdmb250U2l6ZSdcbiAgICB9LFxuICAgIC8qdGV4dEZvbnQ6IHtcbiAgICAgaW5zZXJ0OiAndGV4dEZvbnRTaXplVG9vbHMnLFxuICAgICB0eXBlOiAnbWVudScsXG4gICAgIHRpdGxlOiAnZm9udCcsXG4gICAgIGNsYXNzTmFtZTogJ2ZhIGZhLWZvbnQnLFxuICAgICBtZW51OiB7XG4gICAgIHRleHRGb250U2l6ZURlY3JlYXNlOiB7XG4gICAgIHRpdGxlOiAnZGVjcmVhc2VGb250U2l6ZScsXG4gICAgIGFjdGlvbjogX1RFWC5kZWNyZWFzZUZvbnRTaXplLFxuICAgICBjbGFzc05hbWU6ICdmYSBmYS1mb250IGZvbnQtc2l6ZS1kZWNyZWFzZSdcbiAgICAgfSxcbiAgICAgdGV4dEZvbnRTaXplSW5jcmVhc2U6IHtcbiAgICAgdGl0bGU6ICdpbmNyZWFzZUZvbnRTaXplJyxcbiAgICAgYWN0aW9uOiBfVEVYLmluY3JlYXNlRm9udFNpemUsXG4gICAgIGNsYXNzTmFtZTogJ2ZhIGZhLWZvbnQgZm9udC1zaXplLWluY3JlYXNlJ1xuICAgICB9XG4gICAgIH1cbiAgICAgfSovXG4gICAgYWR2YW5jZWRDb2xvcnNUb29sczoge1xuICAgICAgY2xhc3NOYW1lOiAnY29sb3JzJyxcbiAgICAgIHR5cGU6ICdtZW51JyxcbiAgICAgIHRpdGxlOiAnY29sb3JzJyxcbiAgICAgIHRvZ2dsZWQ6IHRydWUsXG4gICAgICBtZW51OiBbXCJmaWxsXCIsXCJ0ZXh0Qmdjb2xvclwiLFwidGV4dFRleHRiZ2NvbG9yXCIsXCJ0ZXh0RmlsbFwiXVxuICAgIH0sXG4gICAgdGV4dFN0eWxlOiB7XG4gICAgICB0eXBlOiAnbWVudScsXG4gICAgICB0aXRsZTogJ3RleHQgc3R5bGUnLFxuICAgICAgdG9nZ2xlZDogdHJ1ZSxcbiAgICAgIGNsYXNzTmFtZTogJ2ZhIGZhLWZvbnQnLFxuICAgICAgc3R5bGU6ICdnZW5lcmF0ZVRleHRTdHlsZScsXG4gICAgICBtZW51OiBbXG4gICAgICAgIFwidGV4dEJvbGRcIixcInRleHRJdGFsaWNcIixcInRleHRVbmRlcmxpbmVcIixcInRleHRMaW5ldGhyb3VnaFwiLFxuICAgICAgICBcInRleHRPdmVybGluZVwiLFwidGV4dEFsaWduXCIsXCJmb250RmFtaWx5XCIsXCJ0ZXh0Rm9udFNpemVcIlxuICAgICAgXVxuICAgIH1cbiAgfVxufSk7XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLklUZXh0LnByb3RvdHlwZSwge1xuICBpbml0SGlkZGVuVGV4dGFyZWFfbmF0aXZlOiBmYWJyaWMuSVRleHQucHJvdG90eXBlLmluaXRIaWRkZW5UZXh0YXJlYSxcbiAgaW5pdEhpZGRlblRleHRhcmVhOiBmdW5jdGlvbigpe1xuICAgIHRoaXMuaW5pdEhpZGRlblRleHRhcmVhX25hdGl2ZSgpO1xuICAgIHRoaXMuaGlkZGVuVGV4dGFyZWEuc3R5bGUud2lkdGggPSBcIjk5OTlweFwiO1xuICB9LFxuICAvKipcbiAgICogRXhpdHMgZnJvbSBlZGl0aW5nIHN0YXRlXG4gICAqIEByZXR1cm4ge2ZhYnJpYy5JVGV4dH0gdGhpc0FyZ1xuICAgKiBAY2hhaW5hYmxlXG4gICAqL1xuICBleGl0RWRpdGluZzogZnVuY3Rpb24oKSB7XG4gICAgLy8gdmFyIGlzVGV4dENoYW5nZWQgPSAodGhpcy5fdGV4dEJlZm9yZUVkaXQgIT09IHRoaXMudGV4dCk7XG4gICAgdGhpcy5zZWxlY3RlZCA9IGZhbHNlO1xuICAgIHRoaXMuaXNFZGl0aW5nID0gZmFsc2U7XG4gICAgdGhpcy5zZWxlY3RhYmxlID0gdHJ1ZTtcblxuICAgIHRoaXMuc2VsZWN0aW9uRW5kID0gdGhpcy5zZWxlY3Rpb25TdGFydDtcbiAgICB0aGlzLmhpZGRlblRleHRhcmVhICYmIHRoaXMuY2FudmFzICYmIHRoaXMuaGlkZGVuVGV4dGFyZWEucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLmhpZGRlblRleHRhcmVhKTtcbiAgICB0aGlzLmhpZGRlblRleHRhcmVhID0gbnVsbDtcblxuICAgIHRoaXMuYWJvcnRDdXJzb3JBbmltYXRpb24oKTtcbiAgICB0aGlzLl9yZXN0b3JlRWRpdGluZ1Byb3BzKCk7XG4gICAgdGhpcy5fY3VycmVudEN1cnNvck9wYWNpdHkgPSAwO1xuXG4gICAgdGhpcy5maXJlKCdlZGl0aW5nOmV4aXRlZCcpO1xuICAgIC8vIGlzVGV4dENoYW5nZWQgJiYgdGhpcy5maXJlKCdtb2RpZmllZCcpO1xuICAgIGlmICh0aGlzLmNhbnZhcykge1xuICAgICAgdGhpcy5jYW52YXMub2ZmKCdtb3VzZTptb3ZlJywgdGhpcy5tb3VzZU1vdmVIYW5kbGVyKTtcbiAgICAgIHRoaXMuY2FudmFzLmZpcmUoJ3RleHQ6ZWRpdGluZzpleGl0ZWQnLCB7IHRhcmdldDogdGhpcyB9KTtcbiAgICAgIHRoaXMuY2FudmFzLmZpcmVNb2RpZmllZElmQ2hhbmdlZCh0aGlzKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG4gIG1heFN0cm9rZVdpZHRoOiBmdW5jdGlvbigpe1xuICAgIHJldHVybiBNYXRoLmNlaWwoIHRoaXMuZ2V0Rm9udFNpemUoKSAvIDEwKTtcbiAgfSxcbiAgYWN0aW9uczoge1xuICAgIGVudGVyRWRpdGluZzoge1xuICAgICAgaW5zZXJ0OiAgICAgJ2VkaXRUb29sJyxcbiAgICAgIGNsYXNzTmFtZTogICdmYSBmYS1wZW5jaWwtc3F1YXJlLW8nLFxuICAgICAgdGl0bGU6ICAgICAgJ2VkaXQnXG4gICAgICAvL2FjdGlvbjogICAgIF9URVguZW50ZXJFZGl0aW5nXG4gICAgfVxuICB9XG59KTtcblxuXG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL2NvcmUvdGV4dC5leHQuanNcbi8vIG1vZHVsZSBpZCA9IDI3XG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIid1c2Ugc3RyaWN0JztcblxuXG4vKipcbiAgICogRHJhdyBDU1MzIGJvcmRlciBpbWFnZSBvbiBjYW52YXMuXG4gICAqIEBwYXJhbSBjYW52YXMgICAge0hUTUxDYW52YXNFbGVtZW50fVxuICAgKiBAcGFyYW0gaW1nICAgICAgIHtIVE1MSW1hZ2VFbGVtZW50fSBib3JkZXItaW1hZ2Utc291cmNlIGltYWdlXG4gICAqIEBwYXJhbSBvcHRpb25zICAge09iamVjdH1cbiAgICogICAgICBzbGljZSB7QXJyYXl9IGJvcmRlci1pbWFnZS1zbGljZSB2YWx1ZXNcbiAgICogICAgICB3aWR0aCB7QXJyYXl9IGJvcmRlci1pbWFnZS13aWR0aCB2YWx1ZXNcbiAgICogICAgICBvdXRzZXQge0FycmF5fSBib3JkZXItaW1hZ2Utb3V0c2V0IHZhbHVlc1xuICAgKiAgICAgIHJlcGVhdCB7QXJyYXl9IGJvcmRlci1pbWFnZS1yZXBlYXQgdmFsdWVzXG4gICAqIEBwYXJhbSBzaXplICAgICAge09iamVjdH1cbiAgICovXG4gICBmYWJyaWMudXRpbC5kcmF3Qm9yZGVySW1hZ2UgID0gZnVuY3Rpb24oY2FudmFzLCBpbWcsIG9wdGlvbnMpe1xuXG5cbiAgICB2YXIgb3B0aW9ucyA9IGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoe1xuICAgICAgXCJzbGljZVwiOiAgICAgICAgWzI1LDI1LDI1LDI1XSxcbiAgICAgIFwid2lkdGhcIjogICAgICAgIFsyNSwyNSwyNSwyNV0sXG4gICAgICBcImZpbGxcIjogICAgICAgICBmYWxzZSxcbiAgICAgIFwicmVwZWF0XCI6ICAgICAgIFtcInJvdW5kXCIsXCJyb3VuZFwiXSxcbiAgICAgIFwib3V0c2V0X3ZhbHVlc1wiXHQ6IFswLCAwLCAwLCAwXSxcbiAgICAgIFwic2xpY2VfdW5pdHNcIiAgIDogWzAsIDAsIDAsIDBdLFxuICAgICAgXCJ3aWR0aF91bml0c1wiXHQ6IFswLCAwLCAwLCAwXSxcbiAgICAgIFwib3V0c2V0X3VuaXRzXCJcdDogWzAsIDAsIDAsIDBdLFxuICAgICAgXCJzaXplXCJcdFx0XHQ6IFtjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHRdXG4gICAgfSxvcHRpb25zKVxuXG5cbiAgICB2YXIgdyA9IGltZy53aWR0aDtcbiAgICB2YXIgaCA9IGltZy5oZWlnaHQ7XG5cbiAgICB2YXIgY3R4ID0gY2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcbiAgICB2YXIgc2xpY2UgPSBvcHRpb25zLnNsaWNlO1xuICAgIHZhciB3aWR0aCA9IG9wdGlvbnMud2lkdGg7XG5cbiAgICB2YXIgdzIgPSBvcHRpb25zLnNpemVbMF07XG4gICAgdmFyIGgyID0gb3B0aW9ucy5zaXplWzFdO1xuXG5cbiAgICBpZihvcHRpb25zLnNsaWNlX3VuaXRzWzBdID09IDEpc2xpY2VbMF0gKj0gIGggLyAxMDA7XG4gICAgaWYob3B0aW9ucy5zbGljZV91bml0c1sxXSA9PSAxKXNsaWNlWzFdICo9ICB3IC8gMTAwO1xuICAgIGlmKG9wdGlvbnMuc2xpY2VfdW5pdHNbMl0gPT0gMSlzbGljZVsyXSAqPSAgaCAvIDEwMDtcbiAgICBpZihvcHRpb25zLnNsaWNlX3VuaXRzWzNdID09IDEpc2xpY2VbM10gKj0gIHcgLyAxMDA7XG5cbiAgICBpZihvcHRpb25zLndpZHRoX3VuaXRzWzBdID09IDEpd2lkdGhbMF0gKj0gaDIgLyAxMDA7XG4gICAgaWYob3B0aW9ucy53aWR0aF91bml0c1sxXSA9PSAxKXdpZHRoWzFdICo9IHcyIC8gMTAwO1xuICAgIGlmKG9wdGlvbnMud2lkdGhfdW5pdHNbMl0gPT0gMSl3aWR0aFsyXSAqPSBoMiAvIDEwMDtcbiAgICBpZihvcHRpb25zLndpZHRoX3VuaXRzWzNdID09IDEpd2lkdGhbM10gKj0gdzIgLyAxMDA7XG5cblxuICAgIGZ1bmN0aW9uIGRyYXdTaWRlKHNpZGUsc2xpY2VPZmZzZXQsc2xpY2VXaWR0aCwgZHJhd09mZnNldCxkcmF3V2lkdGgpe1xuICAgICAgdmFyIGQ7XG4gICAgICBpZihzaWRlID09IDApIHtcbiAgICAgICAgZCA9IFtzbGljZVszXSArIHNsaWNlT2Zmc2V0LCAwLCBzbGljZVdpZHRoLCAgc2xpY2VbMF0sXG4gICAgICAgICAgd2lkdGhbM10gKyBkcmF3T2Zmc2V0LCAwLCBkcmF3V2lkdGgsICB3aWR0aFswXV1cbiAgICAgIH1cbiAgICAgIGlmKHNpZGUgPT0gMil7XG4gICAgICAgIGQgPSBbc2xpY2VbM10gKyBzbGljZU9mZnNldCwgaCAtIHNsaWNlWzJdICxzbGljZVdpZHRoLCAgc2xpY2VbMl0sXG4gICAgICAgICAgd2lkdGhbM10gKyBkcmF3T2Zmc2V0LCBoMiAtIHdpZHRoWzJdLGRyYXdXaWR0aCwgd2lkdGhbMl1dXG4gICAgICB9XG4gICAgICBpZihzaWRlID09IDEpIHtcbiAgICAgICAgZCA9IFsgdyAtIHNsaWNlWzFdLCBzbGljZVswXSArIHNsaWNlT2Zmc2V0LCAgc2xpY2VbMV0sIHNsaWNlV2lkdGgsXG4gICAgICAgICAgdzIgLSB3aWR0aFsxXSwgd2lkdGhbMF0gKyBkcmF3T2Zmc2V0LHdpZHRoWzFdLCBkcmF3V2lkdGhdO1xuICAgICAgfVxuICAgICAgaWYoc2lkZSA9PSAzKSB7XG4gICAgICAgIGQgPSBbIDAsIHNsaWNlWzBdICsgc2xpY2VPZmZzZXQsICBzbGljZVszXSwgc2xpY2VXaWR0aCxcbiAgICAgICAgICAwLCB3aWR0aFswXSArIGRyYXdPZmZzZXQsIHdpZHRoWzNdLGRyYXdXaWR0aF07XG4gICAgICB9XG4gICAgICBjdHguZHJhd0ltYWdlKGltZyxkWzBdLGRbMV0sZFsyXSxkWzNdLGRbNF0sZFs1XSxkWzZdLGRbN10pXG4gICAgfVxuXG5cbiAgICBmdW5jdGlvbiBfZHJhd19ib3JkZXJfc2lkZShzaWRlKXtcbiAgICAgIHZhciBfdG9wX3dpZHRoLCBfdG9wX3NsaWNlLCByZXBlYXQ7XG4gICAgICBpZihzaWRlID09IDAgfHwgc2lkZSA9PSAyKXtcbiAgICAgICAgX3RvcF93aWR0aCA9IHcyIC0gd2lkdGhbMV0tIHdpZHRoWzNdO1xuICAgICAgICBfdG9wX3NsaWNlICA9ICB3IC0gc2xpY2VbMV0gLSBzbGljZVszXTtcbiAgICAgICAgcmVwZWF0ID0gb3B0aW9ucy5yZXBlYXRbMF07XG4gICAgICB9ZWxzZXtcbiAgICAgICAgX3RvcF93aWR0aCA9IGgyIC0gd2lkdGhbMF0tIHdpZHRoWzJdO1xuICAgICAgICBfdG9wX3NsaWNlICA9ICBoIC0gc2xpY2VbMF0gLSBzbGljZVsyXTtcbiAgICAgICAgcmVwZWF0ID0gb3B0aW9ucy5yZXBlYXRbMV07XG4gICAgICB9XG5cblxuICAgICAgaWYocmVwZWF0ID09IFwic3RyZXRjaFwiKXtcbiAgICAgICAgcmV0dXJuIGRyYXdTaWRlKHNpZGUsIDAsICBfdG9wX3NsaWNlICwgIDAsICAgICBfdG9wX3dpZHRoKTtcbiAgICAgIH1cblxuICAgICAgdmFyIF9hc3BlY3QgPSAgIHNsaWNlW3NpZGVdIC8gd2lkdGhbc2lkZV07XG4gICAgICB2YXIgX29uZV93aWR0aCA9ICBfdG9wX3NsaWNlICogIHdpZHRoW3NpZGVdIC8gc2xpY2Vbc2lkZV0gO1xuICAgICAgdmFyIGNvdW50ID0gMTtcbiAgICAgIHZhciBfbGVmdCA9IDA7XG5cbiAgICAgIGlmKHJlcGVhdCA9PSBcInJlcGVhdFwiKXtcblxuICAgICAgICB2YXIgX3Jlc3QgPSBfb25lX3dpZHRoIC0gX3RvcF93aWR0aCAlIF9vbmVfd2lkdGggLyAyO1xuICAgICAgICB2YXIgX3Jlc3RfYXNwZWN0ICA9IF9hc3BlY3QgKiBfcmVzdDtcbiAgICAgICAgY291bnQgPSAgTWF0aC5mbG9vcihfdG9wX3dpZHRoIC8gX29uZV93aWR0aCk7XG5cblxuICAgICAgICBpZihfcmVzdCA+IDApe1xuICAgICAgICAgIGRyYXdTaWRlKHNpZGUsIF9yZXN0X2FzcGVjdCAsICBfdG9wX3NsaWNlIC0gX3Jlc3RfYXNwZWN0LCAgMCwgICAgIF9vbmVfd2lkdGggLSBfcmVzdClcbiAgICAgICAgfVxuXG4gICAgICAgIF9sZWZ0ID0gIF9vbmVfd2lkdGggLSBfcmVzdDtcblxuICAgICAgICBmb3IodmFyIGkgPSAwIDsgaTwgY291bnQ7aSArKyl7XG4gICAgICAgICAgZHJhd1NpZGUoIHNpZGUsMCwgICBfdG9wX3NsaWNlICwgIF9sZWZ0LCAgICAgX29uZV93aWR0aCk7XG4gICAgICAgICAgX2xlZnQgKz1fb25lX3dpZHRoO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYoX3Jlc3QgPiAwKXtcbiAgICAgICAgICBkcmF3U2lkZShzaWRlLCAgMCAsICAgIF90b3Bfc2xpY2UgLSBfcmVzdF9hc3BlY3QsICBfbGVmdCwgICAgX29uZV93aWR0aCAtIF9yZXN0ICk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmKHJlcGVhdCA9PSBcInJvdW5kXCIpe1xuXG4gICAgICAgIF9sZWZ0ID0gMDtcbiAgICAgICAgY291bnQgPSAgTWF0aC5tYXgoMSxNYXRoLnJvdW5kKF90b3Bfd2lkdGggLyBfb25lX3dpZHRoKSk7XG4gICAgICAgIF9vbmVfd2lkdGggPSBfdG9wX3dpZHRoIC8gY291bnQ7XG5cbiAgICAgICAgd2hpbGUoX2xlZnQgPCBfdG9wX3dpZHRoKXtcbiAgICAgICAgICBkcmF3U2lkZShzaWRlLDAsICAgICBfdG9wX3NsaWNlICwgIF9sZWZ0LCAgICAgX29uZV93aWR0aCApO1xuICAgICAgICAgIF9sZWZ0ICs9X29uZV93aWR0aDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIF9kcmF3X2JvcmRlcl9zaWRlKDApO1xuICAgIF9kcmF3X2JvcmRlcl9zaWRlKDIpO1xuICAgIF9kcmF3X2JvcmRlcl9zaWRlKDEpO1xuICAgIF9kcmF3X2JvcmRlcl9zaWRlKDMpO1xuXG4gIC8vdG9wIGxlZnRcbiAgICBjdHguZHJhd0ltYWdlKGltZywgMCwgMCwgc2xpY2VbM10sIHNsaWNlWzBdLCAwLCAwLCB3aWR0aFszXSwgd2lkdGhbMF0pO1xuICAvL3RvcCByaWdodFxuICAgIGN0eC5kcmF3SW1hZ2UoaW1nLCB3IC0gc2xpY2VbMV0sIDAsIHNsaWNlWzFdLCBzbGljZVswXSxcbiAgICAgIHcyIC0gd2lkdGhbMV0sIDAsIHdpZHRoWzFdLCB3aWR0aFswXSk7XG4gIC8vYm90dG9tIGxlZnRcbiAgICBjdHguZHJhd0ltYWdlKGltZywgMCwgaCAtIHNsaWNlWzJdLCBzbGljZVszXSwgc2xpY2VbMl0sXG4gICAgICAwLCBoMiAtIHdpZHRoWzJdLCB3aWR0aFszXSwgd2lkdGhbMl0pO1xuXG4gIC8vYm90dG9tIHJpZ2h0XG4gICAgY3R4LmRyYXdJbWFnZShpbWcsIHcgLSBzbGljZVsxXSwgaCAtIHNsaWNlWzJdLCBzbGljZVsxXSwgc2xpY2VbMl0sXG4gICAgICB3MiAtIHdpZHRoWzFdLCBoMiAtIHdpZHRoWzJdLCB3aWR0aFsxXSwgd2lkdGhbMl0pO1xuXG4gIH1cblxuICAvKlxuICAgdmFyIEZyYW1lID0gZnVuY3Rpb24ocHJvamVjdCxkYXRhKXtcblxuICAgaWYoZGF0YS5ib3JkZXJfaW1hZ2Upe1xuICAgZGF0YS5ib3JkZXJfaW1hZ2UgPSBtaXhpbigge1xuICAgXCJzbGljZVwiOiAgICAgICAgICBbMjUsMjUsMjUsMjVdLFxuICAgXCJ3aWR0aFwiOiAgICAgICAgICBbMjUsMjUsMjUsMjVdLFxuICAgXCJmaWxsXCI6ICAgICAgICAgICBmYWxzZSxcbiAgIFwicmVwZWF0XCI6ICAgICAgICAgW1wicm91bmRcIixcInJvdW5kXCJdLFxuICAgXCJvdXRzZXRcIlx0OiAgICAgWzAsIDAsIDAsIDBdLFxuICAgXCJzbGljZV91bml0c1wiICAgOiBbMCwgMCwgMCwgMF0sXG4gICBcIndpZHRoX3VuaXRzXCJcdDogWzAsIDAsIDAsIDBdLFxuICAgXCJvdXRzZXRfdW5pdHNcIlx0OiBbMCwgMCwgMCwgMF1cbiAgIH0sIGRhdGEuYm9yZGVyX2ltYWdlKVxuICAgfVxuXG5cbiAgIHRoaXMuc3VwZXJjbGFzcy5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMscHJvamVjdCxkYXRhKTtcbiAgIHRoaXMuX2FkZF9yb290KFwibWFza1wiKTtcbiAgIHRoaXMuX2FkZF9yb290KFwiaW1hZ2VcIik7XG4gICB0aGlzLmV4YW1wbGUgPSB0aGlzLl9nZXRfZXhhbXBsZSgpO1xuXG4gICB9OyovXG4gIGZhYnJpYy51dGlsLmdldE9mZnNldHNDbGlwUGF0aCA9IGZ1bmN0aW9uKG8pIHtcblxuICAgIHJldHVybiBbJ00nLCBvWzNdLCBvWzBdLCAnTCcsIDEwMCAtIG9bMV0sIG9bMF0sICdMJywgMTAwIC0gb1sxXSwgMTAwIC0gb1syXSwgJ0wnLCBvWzNdLCAxMDAgLSBvWzJdLCAneiddLmpvaW4oXCIgXCIpO1xuICB9O1xuXG4gIGZhYnJpYy51dGlsLmdldFJhZGl1c0NsaXBQYXRoID0gZnVuY3Rpb24ocmFkaXVzLHJhZGl1c191bml0cywgd2lkdGgsaGVpZ2h0KSB7XG5cbiAgdmFyIGJyICA9IHJhZGl1cztcbiAgdmFyIGJydSA9IHJhZGl1c191bml0cyB8fCBbMSwxLDEsMSwxLDEsMSwxXTtcblxuXG5cbiAgdmFyIHMgPSB7XG4gICAgXCJ0b3AtbGVmdC1oXCI6ICAgICBiclswXSAqIChicnVbMF0gPyBoZWlnaHQgLyAxMDAgOiAxKSxcbiAgICBcInRvcC1sZWZ0LXdcIjogICAgIGJyWzFdICogKGJydVsxXSA/IHdpZHRoIC8gMTAwIDogMSksXG4gICAgXCJ0b3AtcmlnaHQtaFwiOiAgICBiclsyXSAqIChicnVbMl0gPyBoZWlnaHQgLyAxMDAgOiAxKSxcbiAgICBcInRvcC1yaWdodC13XCI6ICAgIGJyWzNdICogKGJydVszXSA/IHdpZHRoIC8gMTAwIDogMSksXG4gICAgXCJib3R0b20tcmlnaHQtd1wiOiBicls0XSAqIChicnVbNF0gPyB3aWR0aCAvIDEwMCA6IDEpLFxuICAgIFwiYm90dG9tLXJpZ2h0LWhcIjogYnJbNV0gKiAoYnJ1WzVdID8gaGVpZ2h0IC8gMTAwIDogMSksXG4gICAgXCJib3R0b20tbGVmdC13XCI6ICBicls2XSAqIChicnVbNl0gPyB3aWR0aCAvIDEwMCA6IDEpLFxuICAgIFwiYm90dG9tLWxlZnQtaFwiOiAgYnJbN10gKiAoYnJ1WzddID8gaGVpZ2h0IC8gMTAwIDogMSlcbiAgfTtcblxuICByZXR1cm4gW1xuICAgIFwiTVwiLCAwLCBzW1widG9wLWxlZnQtaFwiXSxcbiAgICBcIkNcIiwgMCwgc1tcInRvcC1sZWZ0LWhcIl0sIDAsIDAsIHNbXCJ0b3AtbGVmdC13XCJdLCAwLFxuICAgIFwiSFwiLCB3aWR0aCAtIHNbXCJ0b3AtcmlnaHQtd1wiXSxcbiAgICBcIkNcIiwgd2lkdGggLSBzW1widG9wLXJpZ2h0LXdcIl0sIDAsIHdpZHRoLCAwLCB3aWR0aCwgc1tcInRvcC1yaWdodC1oXCJdLFxuICAgIFwiVlwiLCBoZWlnaHQgLSBzW1wiYm90dG9tLXJpZ2h0LWhcIl0sXG4gICAgXCJDXCIsIHdpZHRoLCBoZWlnaHQgLSBzW1wiYm90dG9tLXJpZ2h0LWhcIl0sIHdpZHRoLCBoZWlnaHQsIHdpZHRoIC0gc1tcImJvdHRvbS1yaWdodC13XCJdLCBoZWlnaHQsXG4gICAgXCJIXCIsIHNbXCJib3R0b20tbGVmdC13XCJdLFxuICAgIFwiQ1wiLCBzW1wiYm90dG9tLWxlZnQtd1wiXSwgaGVpZ2h0LCAwLCBoZWlnaHQsIDAsIGhlaWdodCAtIHNbXCJib3R0b20tbGVmdC1oXCJdLFxuICAgIFwiWlwiXG4gIF0uam9pbihcIiBcIik7XG59O1xuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9tb2R1bGVzL2JvcmRlckltYWdlLmpzXG4vLyBtb2R1bGUgaWQgPSAyOFxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCIndXNlIHN0cmljdCc7XG5cblxudmFyIF9iaW5kRXZlbnRzID0gZmFicmljLkNhbnZhcy5wcm90b3R5cGUuX2JpbmRFdmVudHM7XG52YXIgX29uTW91c2VEb3duX292ZXJ3cml0dGVuID0gZmFicmljLkNhbnZhcy5wcm90b3R5cGUuX29uTW91c2VEb3duO1xudmFyIF9vbk1vdXNlVXBfb3ZlcndyaXR0ZW4gPSBmYWJyaWMuQ2FudmFzLnByb3RvdHlwZS5fb25Nb3VzZVVwO1xudmFyIF9pbml0RXZlbnRMaXN0ZW5lcnNfb3ZlcndyaXR0ZW4gPSBmYWJyaWMuQ2FudmFzLnByb3RvdHlwZS5faW5pdEV2ZW50TGlzdGVuZXJzO1xudmFyIHJlbW92ZUxpc3RlbmVyc19vdmVyd3JpdHRlbiA9IGZhYnJpYy5DYW52YXMucHJvdG90eXBlLnJlbW92ZUxpc3RlbmVycztcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuQ2FudmFzLnByb3RvdHlwZSwge1xuICB0YXBob2xkVGhyZXNob2xkOiAyMDAwLFxuICBfYmluZEV2ZW50czogZnVuY3Rpb24gKCkge1xuICAgIF9iaW5kRXZlbnRzLmNhbGwodGhpcyk7XG4gICAgdGhpcy5fb25DbGljayA9IHRoaXMuX29uQ2xpY2suYmluZCh0aGlzKTtcbiAgICB0aGlzLl9vbkRvdWJsZUNsaWNrID0gdGhpcy5fb25Eb3VibGVDbGljay5iaW5kKHRoaXMpO1xuICAgIHRoaXMuX29uVGFwSG9sZCA9IHRoaXMuX29uVGFwSG9sZC5iaW5kKHRoaXMpO1xuICB9LFxuXG4gIF9vbkRvdWJsZUNsaWNrOiBmdW5jdGlvbiAoZSkge1xuICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgIHZhciB0YXJnZXQgPSBzZWxmLmZpbmRUYXJnZXQoZSk7XG4gICAgc2VsZi5maXJlKCdtb3VzZTpkYmxjbGljaycsIHtcbiAgICAgIHRhcmdldDogdGFyZ2V0LFxuICAgICAgZTogZVxuICAgIH0pO1xuXG4gICAgaWYgKHRhcmdldCAmJiAhc2VsZi5pc0RyYXdpbmdNb2RlKSB7XG4gICAgICAvLyBUbyB1bmlmeSB0aGUgYmVoYXZpb3IsIHRoZSBvYmplY3QncyBkb3VibGUgY2xpY2sgZXZlbnQgZG9lcyBub3QgZmlyZSBvbiBkcmF3aW5nIG1vZGUuXG4gICAgICB0YXJnZXQuZmlyZSgnZGJsY2xpY2snLCB7XG4gICAgICAgIGU6IGVcbiAgICAgIH0pO1xuICAgIH1cbiAgfSxcblxuICBfb25Ecm9wOiBmdW5jdGlvbiAoZSkge1xuICAgIHZhciBfem9vbSA9IHRoaXMuZ2V0Wm9vbSgpO1xuICAgIGUueCAvPSBfem9vbTtcbiAgICBlLnkgLz0gX3pvb207XG4gICAgZS5vZmZzZXRYIC89IF96b29tO1xuICAgIGUub2Zmc2V0WSAvPSBfem9vbTtcbiAgICBlLndpZHRoID0gZS5oZWxwZXIud2lkdGgoKSAvIF96b29tO1xuICAgIGUuaGVpZ2h0ID0gZS5oZWxwZXIuaGVpZ2h0KCkgLyBfem9vbTtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICB0aGlzLmZpcmUoJ21vdXNlOmRyb3AnLCBlKTtcblxuICB9LFxuXG4gIF9vbkRyYWdNb3ZlOiBmdW5jdGlvbiAoZSkge1xuICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgIHZhciB0YXJnZXQgPSBzZWxmLmZpbmRUYXJnZXQoZS5vcmlnaW5hbEV2ZW50KTtcbiAgICBzZWxmLmZpcmUoJ21vdXNlOmRyYWdtb3ZlJywge1xuICAgICAgdGFyZ2V0OiB0YXJnZXQsXG4gICAgICBlOiBlLFxuICAgICAgZGF0YTogZS5kYXRhXG4gICAgfSk7XG4gICAgaWYgKHRhcmdldCAmJiAhc2VsZi5pc0RyYXdpbmdNb2RlKSB7XG4gICAgICAvLyBUbyB1bmlmeSB0aGUgYmVoYXZpb3IsIHRoZSBvYmplY3QncyBkb3VibGUgY2xpY2sgZXZlbnQgZG9lcyBub3QgZmlyZSBvbiBkcmF3aW5nIG1vZGUuXG4gICAgICB0YXJnZXQuZmlyZSgnb2JqZWN0OmRyYWdtb3ZlJywge1xuICAgICAgICBlOiBlLFxuICAgICAgICBkYXRhOiBlLmRhdGFcbiAgICAgIH0pO1xuICAgIH1cbiAgICBpZiAodGhpcy5fbGFzdF90YXJnZXQgPT0gdGFyZ2V0KXJldHVybjtcbiAgICBpZiAodGhpcy5fbGFzdF90YXJnZXQpIHtcbiAgICAgIHNlbGYuZmlyZSgnbW91c2U6ZHJhZ2xlYXZlJywge1xuICAgICAgICB0YXJnZXQ6IHRoaXMuX2xhc3RfdGFyZ2V0LFxuICAgICAgICBlOiBlLFxuICAgICAgICBkYXRhOiBlLmRhdGFcbiAgICAgIH0pO1xuICAgICAgdGhpcy5fbGFzdF90YXJnZXQuZmlyZSgnb2JqZWN0OmRyYWdsZWF2ZScsIHtcbiAgICAgICAgZTogZSxcbiAgICAgICAgZGF0YTogZS5kYXRhXG4gICAgICB9KTtcbiAgICAgIHRoaXMuX2xhc3RfdGFyZ2V0ID0gZmFsc2U7XG4gICAgfVxuICAgIGlmICh0YXJnZXQpIHtcblxuICAgICAgc2VsZi5maXJlKCdtb3VzZTpkcmFnZW50ZXInLCB7XG4gICAgICAgIHRhcmdldDogdGFyZ2V0LFxuICAgICAgICBlOiBlLFxuICAgICAgICBkYXRhOiBlLmRhdGFcbiAgICAgIH0pO1xuICAgICAgdGFyZ2V0LmZpcmUoJ29iamVjdDpkcmFnZW50ZXInLCB7XG4gICAgICAgIGU6IGUsXG4gICAgICAgIGRhdGE6IGUuZGF0YVxuICAgICAgfSk7XG5cbiAgICAgIHRoaXMuX2xhc3RfdGFyZ2V0ID0gdGFyZ2V0O1xuICAgIH1cblxuICB9LFxuXG4gIF9vbkNsaWNrOiBmdW5jdGlvbiAoZSkge1xuICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgIHZhciB0YXJnZXQgPSBzZWxmLmZpbmRUYXJnZXQoZSk7XG4gICAgc2VsZi5maXJlKCdtb3VzZTpjbGljaycsIHtcbiAgICAgIHRhcmdldDogdGFyZ2V0LFxuICAgICAgZTogZVxuICAgIH0pO1xuXG4gICAgaWYgKHRhcmdldCAmJiAhc2VsZi5pc0RyYXdpbmdNb2RlKSB7XG4gICAgICBpZiAoXG4gICAgICAgIHRhcmdldC5vcmlnaW5hbFN0YXRlLmxlZnQgPT0gdGFyZ2V0LmxlZnQgJiZcbiAgICAgICAgdGFyZ2V0Lm9yaWdpbmFsU3RhdGUudG9wID09IHRhcmdldC50b3AgJiZcbiAgICAgICAgdGFyZ2V0Lm9yaWdpbmFsU3RhdGUuc2NhbGVYID09IHRhcmdldC5zY2FsZVggJiZcbiAgICAgICAgdGFyZ2V0Lm9yaWdpbmFsU3RhdGUuc2NhbGVZID09IHRhcmdldC5zY2FsZVkgJiZcbiAgICAgICAgdGFyZ2V0Lm9yaWdpbmFsU3RhdGUuYW5nbGUgPT0gdGFyZ2V0LmFuZ2xlXG4gICAgICApIHtcbiAgICAgICAgLy8gVG8gdW5pZnkgdGhlIGJlaGF2aW9yLCB0aGUgb2JqZWN0J3MgZG91YmxlIGNsaWNrIGV2ZW50IGRvZXMgbm90IGZpcmUgb24gZHJhd2luZyBtb2RlLlxuICAgICAgICB0YXJnZXQuZmlyZSgnb2JqZWN0OmNsaWNrJywge1xuICAgICAgICAgIGU6IGVcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICB9LFxuXG4gIF9vblRhcEhvbGQ6IGZ1bmN0aW9uIChlKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgdmFyIHRhcmdldCA9IHNlbGYuZmluZFRhcmdldChlKTtcbiAgICBzZWxmLmZpcmUoJ3RvdWNoOnRhcGhvbGQnLCB7XG4gICAgICB0YXJnZXQ6IHRhcmdldCxcbiAgICAgIGU6IGVcbiAgICB9KTtcblxuICAgIGlmICh0YXJnZXQgJiYgIXNlbGYuaXNEcmF3aW5nTW9kZSkge1xuICAgICAgLy8gVG8gdW5pZnkgdGhlIGJlaGF2aW9yLCB0aGUgb2JqZWN0J3MgdGFwIGhvbGQgZXZlbnQgZG9lcyBub3QgZmlyZSBvbiBkcmF3aW5nIG1vZGUuXG4gICAgICB0YXJnZXQuZmlyZSgndGFwaG9sZCcsIHtcbiAgICAgICAgZTogZVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgaWYgKGUudHlwZSA9PT0gJ3RvdWNoZW5kJyAmJiBzZWxmLnRvdWNoU3RhcnRUaW1lciAhPSBudWxsKSB7XG4gICAgICBjbGVhclRpbWVvdXQoc2VsZi50b3VjaFN0YXJ0VGltZXIpO1xuICAgIH1cbiAgfSxcblxuICBfb25Nb3VzZURvd246IGZ1bmN0aW9uIChlKSB7XG4gICAgX29uTW91c2VEb3duX292ZXJ3cml0dGVuLmNhbGwodGhpcywgZSk7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIGlmIChlLnR5cGUgPT09ICd0b3VjaHN0YXJ0Jykge1xuICAgICAgdmFyIHRvdWNoU3RhcnRUaW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICBzZWxmLl9vblRhcEhvbGQoZSk7XG4gICAgICAgIHNlbGYuaXNMb25nVGFwID0gdHJ1ZTtcbiAgICAgIH0sIHNlbGYudGFwaG9sZFRocmVzaG9sZCk7XG4gICAgICBzZWxmLnRvdWNoU3RhcnRUaW1lciA9IHRvdWNoU3RhcnRUaW1lcjtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBBZGQgcmlnaHQgY2xpY2sgc3VwcG9ydFxuICAgIGlmIChlLndoaWNoID09PSAzKSB7XG4gICAgICB2YXIgdGFyZ2V0ID0gdGhpcy5maW5kVGFyZ2V0KGUpO1xuICAgICAgc2VsZi5maXJlKCdtb3VzZTpkb3duJywge3RhcmdldDogdGFyZ2V0LCBlOiBlfSk7XG4gICAgICBpZiAodGFyZ2V0ICYmICFzZWxmLmlzRHJhd2luZ01vZGUpIHtcbiAgICAgICAgLy8gVG8gdW5pZnkgdGhlIGJlaGF2aW9yLCB0aGUgb2JqZWN0J3MgbW91c2UgZG93biBldmVudCBkb2VzIG5vdCBmaXJlIG9uIGRyYXdpbmcgbW9kZS5cbiAgICAgICAgdGFyZ2V0LmZpcmUoJ21vdXNlZG93bicsIHtcbiAgICAgICAgICBlOiBlXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgfSxcblxuICBfb25Nb3VzZVVwOiBmdW5jdGlvbiAoZSkge1xuXG4gICAgX29uTW91c2VVcF9vdmVyd3JpdHRlbi5jYWxsKHRoaXMsIGUpO1xuXG4gICAgaWYgKGUudHlwZSA9PT0gJ3RvdWNoZW5kJykge1xuICAgICAgLy8gUHJvY2VzcyB0YXAgaG9sZC5cbiAgICAgIGlmICh0aGlzLnRvdWNoU3RhcnRUaW1lciAhPSBudWxsKSB7XG4gICAgICAgIGNsZWFyVGltZW91dCh0aGlzLnRvdWNoU3RhcnRUaW1lcik7XG4gICAgICB9XG4gICAgICAvLyBQcm9jZXNzIGxvbmcgdGFwLlxuICAgICAgaWYgKHRoaXMuaXNMb25nVGFwKSB7XG4gICAgICAgIHRoaXMuX29uTG9uZ1RhcEVuZChlKTtcbiAgICAgICAgdGhpcy5pc0xvbmdUYXAgPSBmYWxzZTtcbiAgICAgIH1cbiAgICAgIC8vIFByb2Nlc3MgZG91YmxlIGNsaWNrXG4gICAgICB2YXIgbm93ID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gICAgICB2YXIgbGFzdFRvdWNoID0gdGhpcy5sYXN0VG91Y2ggfHwgbm93ICsgMTtcbiAgICAgIHZhciBkZWx0YSA9IG5vdyAtIGxhc3RUb3VjaDtcbiAgICAgIGlmIChkZWx0YSA8IDMwMCAmJiBkZWx0YSA+IDApIHtcbiAgICAgICAgLy8gQWZ0ZXIgd2UgZGV0Y3QgYSBkb3VibGV0YXAsIHN0YXJ0IG92ZXJcbiAgICAgICAgdGhpcy5sYXN0VG91Y2ggPSBudWxsO1xuXG4gICAgICAgIHRoaXMuX29uRG91YmxlVGFwKGUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5sYXN0VG91Y2ggPSBub3c7XG4gICAgICB9XG4gICAgfVxuICB9LFxuXG4gIF9vbkRvdWJsZVRhcDogZnVuY3Rpb24gKGUpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICB2YXIgdGFyZ2V0ID0gc2VsZi5maW5kVGFyZ2V0KGUpO1xuICAgIHNlbGYuZmlyZSgndG91Y2g6ZG91YmxldGFwJywge1xuICAgICAgdGFyZ2V0OiB0YXJnZXQsXG4gICAgICBlOiBlXG4gICAgfSk7XG5cbiAgICBpZiAodGFyZ2V0ICYmICFzZWxmLmlzRHJhd2luZ01vZGUpIHtcbiAgICAgIC8vIFRvIHVuaWZ5IHRoZSBiZWhhdmlvciwgdGhlIG9iamVjdCdzIGRvdWJsZSB0YXAgZXZlbnQgZG9lcyBub3QgZmlyZSBvbiBkcmF3aW5nIG1vZGUuXG4gICAgICB0YXJnZXQuZmlyZSgnb2JqZWN0OmRvdWJsZXRhcCcsIHtcbiAgICAgICAgZTogZVxuICAgICAgfSk7XG4gICAgfVxuICB9LFxuXG4gIF9vbkxvbmdUYXBFbmQ6IGZ1bmN0aW9uIChlKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgdmFyIHRhcmdldCA9IHNlbGYuZmluZFRhcmdldChlKTtcbiAgICBzZWxmLmZpcmUoJ3RvdWNoOmxvbmd0YXBlbmQnLCB7XG4gICAgICB0YXJnZXQ6IHRhcmdldCxcbiAgICAgIGU6IGVcbiAgICB9KTtcblxuICAgIGlmICh0YXJnZXQgJiYgIXNlbGYuaXNEcmF3aW5nTW9kZSkge1xuICAgICAgLy8gVG8gdW5pZnkgdGhlIGJlaGF2aW9yLCB0aGUgb2JqZWN0J3MgbG9uZyB0YXAgZW5kIGV2ZW50IGRvZXMgbm90IGZpcmUgb24gZHJhd2luZyBtb2RlLlxuICAgICAgdGFyZ2V0LmZpcmUoJ29iamVjdDpsb25ndGFwZW5kJywge1xuICAgICAgICBlOiBlXG4gICAgICB9KTtcbiAgICB9XG4gIH0sXG5cbiAgX2luaXRFdmVudExpc3RlbmVyczogZnVuY3Rpb24gKCkge1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICBfaW5pdEV2ZW50TGlzdGVuZXJzX292ZXJ3cml0dGVuLmNhbGwoc2VsZik7XG5cbiAgICBmYWJyaWMudXRpbC5hZGRMaXN0ZW5lcihzZWxmLnVwcGVyQ2FudmFzRWwsICdjbGljaycsIHNlbGYuX29uQ2xpY2spO1xuICAgIGZhYnJpYy51dGlsLmFkZExpc3RlbmVyKHNlbGYudXBwZXJDYW52YXNFbCwgJ2RibGNsaWNrJywgc2VsZi5fb25Eb3VibGVDbGljayk7XG5cbiAgICBzZWxmLm9uKCdvYmplY3Q6c2NhbGluZycsIGZ1bmN0aW9uIChlKSB7XG4gICAgICBpZiAoZS50YXJnZXQgJiYgZS50YXJnZXQuX3NjYWxpbmdfZXZlbnRzX2VuYWJsZWQpIHtcbiAgICAgICAgZS50YXJnZXQuZmlyZShcInNjYWxpbmdcIiwgZS5lKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBzZWxmLm9uKCdvYmplY3Q6c2VsZWN0ZWQnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgaWYgKGUudGFyZ2V0KSB7XG4gICAgICAgIGUudGFyZ2V0LmZpcmUoXCJvYmplY3Q6c2VsZWN0ZWRcIiwgZS5lKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBzZWxmLm9uKCdtb3VzZTpvdmVyJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgIGlmIChlLnRhcmdldCkge1xuICAgICAgICBlLnRhcmdldC5maXJlKFwibW91c2U6b3ZlclwiLCBlLmUpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgc2VsZi5vbignbW91c2U6b3V0JywgZnVuY3Rpb24gKGUpIHtcbiAgICAgIGlmIChlLnRhcmdldCkge1xuICAgICAgICBlLnRhcmdldC5maXJlKFwibW91c2U6b3V0XCIsIGUuZSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgfSxcblxuICByZW1vdmVMaXN0ZW5lcnM6IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgcmVtb3ZlTGlzdGVuZXJzX292ZXJ3cml0dGVuLmNhbGwoc2VsZik7XG5cblxuICAgIGZhYnJpYy51dGlsLnJlbW92ZUxpc3RlbmVyKHNlbGYudXBwZXJDYW52YXNFbCwgJ2NsaWNrJywgc2VsZi5fb25DbGljayk7XG4gICAgZmFicmljLnV0aWwucmVtb3ZlTGlzdGVuZXIoc2VsZi51cHBlckNhbnZhc0VsLCAnZGJsY2xpY2snLCBzZWxmLl9vbkRvdWJsZUNsaWNrKTtcbiAgfVxufSk7XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL21vZHVsZXMvY2FudmFzLmV2ZW50cy5qc1xuLy8gbW9kdWxlIGlkID0gMjlcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiJ3VzZSBzdHJpY3QnO1xuXG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLkNhbnZhcy5wcm90b3R5cGUsIHtcbiAgIC8vIGVuYWJsZUNsaXBBcmVhWm9vbWluZzogZnVuY3Rpb24oKXtcbiAgICAgIC8vdG9kb1xuICAgICAgLy8gdGhpcy5vbigndmlld3BvcnQ6c2NhbGVkJywgZnVuY3Rpb24oKXtcbiAgICAgIC8vICAgaWYgKCF0aGlzLmxheWVyKFwiYmFja2dyb3VuZFwiKS5vYmplY3RzKSByZXR1cm47XG4gICAgICAvLyAgIHRoaXMuX2JhY2tncm91bmRMYXllclswXS5zZXRDb29yZHMoKTtcbiAgICAgIC8vIH0pO1xuICAgLy8gfSxcbiAgICBfZmFicmljX2NsaXBfZnVuY3Rpb246IGZ1bmN0aW9uIChjdHgyKSB7XG5cbiAgICAgIHZhciBjbGlwUmVjdCA9IHRoaXMuY2xpcFJlY3Q7XG4gICAgICBjdHgyLnNhdmUoKTtcbiAgICAgIGNsaXBSZWN0LnJlbmRlcihjdHgyKTtcbiAgICAgIGN0eDIucmVzdG9yZSgpO1xuXG4gICAgfVxuICB9KTtcblxuZmFicmljLk9iamVjdC5wcm90b3R5cGUuc2V0Q2xpcFRvID0gZnVuY3Rpb24odmFsKSB7XG4gIGlmICh0eXBlb2YgdmFsICE9PSAnc3RyaW5nJykge1xuICAgIHRoaXMuY2xpcFRvID0gdmFsO1xuICB9XG5cbiAgdmFyIGZ1bmN0aW9uQm9keSA9IGZhYnJpYy51dGlsLmdldEZ1bmN0aW9uQm9keSh2YWwpO1xuICBpZiAodHlwZW9mIGZ1bmN0aW9uQm9keSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICB0aGlzLmNsaXBUbyA9IG5ldyBGdW5jdGlvbignY3R4JywgZnVuY3Rpb25Cb2R5KTtcbiAgfVxufTtcblxuLyoqXG4gKiBAcHJpdmF0ZVxuICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXSBPcHRpb25zIG9iamVjdFxuICovXG5mYWJyaWMuT2JqZWN0LnByb3RvdHlwZS5faW5pdENsaXBwaW5nID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgaWYgKCFvcHRpb25zLmNsaXBUbyB8fCB0eXBlb2Ygb3B0aW9ucy5jbGlwVG8gIT09ICdzdHJpbmcnKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIGlmIChvcHRpb25zLmNsaXBUb1swXSA9PSAnIycpIHtcbiAgICAvLyAgdmFyIF9pZCA9IG9wdGlvbnMuY2xpcFRvWzBdLnN1YnN0cmluZygxKTtcbiAgICB0aGlzLmNsaXBUbyA9IG9wdGlvbnMuY2xpcFRvO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBmdW5jdGlvbkJvZHkgPSBmYWJyaWMudXRpbC5nZXRGdW5jdGlvbkJvZHkob3B0aW9ucy5jbGlwVG8pO1xuICBpZiAodHlwZW9mIGZ1bmN0aW9uQm9keSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICB0aGlzLmNsaXBUbyA9IG5ldyBGdW5jdGlvbignY3R4JywgZnVuY3Rpb25Cb2R5KTtcbiAgfVxufTtcbmZhYnJpYy5PYmplY3QucHJvdG90eXBlLmdldENsaXBUbyA9IGZ1bmN0aW9uICgpIHtcbiAgcmV0dXJuIFwiI1wiICsgdGhpcy5jbGlwVG8uaWQ7XG59O1xuXG5mYWJyaWMudXRpbC5jbGlwQ29udGV4dCA9IGZ1bmN0aW9uIChyZWNlaXZlciwgY3R4KSB7XG5cbiAgaWYgKHJlY2VpdmVyLmNsaXBUby5jb25zdHJ1Y3RvciA9PT0gU3RyaW5nKSB7XG4gICAgaWYgKHJlY2VpdmVyLmNsaXBUbyA9PT0gXCJjYW52YXNcIikge1xuICAgICAgcmVjZWl2ZXIuY2xpcFRvID0gcmVjZWl2ZXIuY2FudmFzO1xuICAgIH1cbiAgICBlbHNle1xuXG4gICAgICB2YXIgX2lkID0gcmVjZWl2ZXIuY2xpcFRvLnN1YnN0cmluZygxKTtcblxuICAgICAgdmFyIF9jbGlwQ3R4ID0gcmVjZWl2ZXIuY2FudmFzLmdldE9iamVjdEJ5SUQoX2lkKTtcbiAgICAgIGlmKF9jbGlwQ3R4KXtcbiAgICAgICAgcmVjZWl2ZXIuY2xpcFRvID0gX2NsaXBDdHg7XG4gICAgICB9ZWxzZXtcbiAgICAgICAgY29uc29sZS53YXJuKFwiZXJyb3I6IGNsaXBUbyBub3QgZm91bmRcIiArIHJlY2VpdmVyLmNsaXBUbyk7XG4gICAgICAgIGRlbGV0ZSByZWNlaXZlci5jbGlwVG87XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuXG5cbiAgY3R4LnNhdmUoKTtcbiAgY3R4LmJlZ2luUGF0aCgpO1xuXG4gIGlmIChyZWNlaXZlci5jbGlwVG8uY29uc3RydWN0b3IgPT09IEZ1bmN0aW9uKSB7XG4gICAgcmVjZWl2ZXIuY2xpcFRvKGN0eCk7XG4gIH0gZWxzZSB7XG4gICAgZmFicmljLnV0aWwuX2NsaXBUb09iamVjdChyZWNlaXZlciwgY3R4KTtcbiAgICBjdHguY2xpcCgpO1xuICB9XG5cbn07XG5cbmZhYnJpYy51dGlsLl9jbGlwVG9PYmplY3QgPSBmdW5jdGlvbiAocmVjZWl2ZXIsIGN0eCkge1xuICBjdHguc2F2ZSgpO1xuICBjdHguYmVnaW5QYXRoKCk7XG5cbiAgdmFyIGZyb21MZWZ0ID0gZmFsc2U7XG4gIHZhciBjZW50ZXIgPSBmcm9tTGVmdCA/IHJlY2VpdmVyLl9nZXRMZWZ0VG9wQ29vcmRzKCkgOiByZWNlaXZlci5nZXRDZW50ZXJQb2ludCgpO1xuICBjdHgudHJhbnNmb3JtKDEsIE1hdGgudGFuKGZhYnJpYy51dGlsLmRlZ3JlZXNUb1JhZGlhbnMoLXJlY2VpdmVyLnNrZXdZKSksIDAsIDEsIDAsIDApO1xuICBjdHgudHJhbnNmb3JtKDEsIDAsIE1hdGgudGFuKGZhYnJpYy51dGlsLmRlZ3JlZXNUb1JhZGlhbnMoLXJlY2VpdmVyLnNrZXdYKSksIDEsIDAsIDApO1xuICBjdHguc2NhbGUoXG4gICAgKDEgLyByZWNlaXZlci5zY2FsZVgpICogKHJlY2VpdmVyLmZsaXBYID8gLTEgOiAxKSxcbiAgICAoMSAvIHJlY2VpdmVyLnNjYWxlWSkgKiAocmVjZWl2ZXIuZmxpcFkgPyAtMSA6IDEpXG4gICk7XG4gIGN0eC5yb3RhdGUoZmFicmljLnV0aWwuZGVncmVlc1RvUmFkaWFucygtcmVjZWl2ZXIuYW5nbGUpKTtcbiAgY3R4LnRyYW5zbGF0ZSgtY2VudGVyLngsIC1jZW50ZXIueSk7XG5cblxuICBpZiAocmVjZWl2ZXIuY2xpcFRvLnBvaW50cykge1xuICAgIHZhciBwcyA9IHJlY2VpdmVyLmNsaXBUby5wb2ludHM7XG4gICAgY3R4Lm1vdmVUbyhwc1swXS54LCBwc1swXS55KTtcbiAgICBmb3IgKHZhciBqID0gMTsgaiA8IHBzLmxlbmd0aDsgaisrKSB7XG4gICAgICBjdHgubGluZVRvKHBzW2pdLngsIHBzW2pdLnkpO1xuICAgIH1cbiAgICAvL2N0eC5zdHJva2UoKTtcbiAgfSBlbHNlIGlmIChyZWNlaXZlci5jbGlwVG8udHlwZSA9PSBcInBhdGhcIikge1xuXG4gICAgY3R4Lmdsb2JhbEFscGhhID0gMDtcbiAgICByZWNlaXZlci5jbGlwVG8udHJhbnNmb3JtKGN0eCk7XG4gICAgcmVjZWl2ZXIuY2xpcFRvLl9yZW5kZXIoY3R4KTtcbiAgfSBlbHNlIGlmIChyZWNlaXZlci5jbGlwVG8udHlwZSA9PSBcInNsaWRlLWNhbnZhc1wiKSB7XG4gICAgY3R4LnJlY3QoMCwwLCByZWNlaXZlci5jbGlwVG8ud2lkdGgsIHJlY2VpdmVyLmNsaXBUby5oZWlnaHQpO1xuICB9ZWxzZSB7XG4gICAgY3R4LnRyYW5zbGF0ZShyZWNlaXZlci5jbGlwVG8ubGVmdCwgcmVjZWl2ZXIuY2xpcFRvLnRvcCk7XG4gICAgY3R4LnJvdGF0ZSgtKHJlY2VpdmVyLmNsaXBUby5hbmdsZSAqIC0xKSAqIE1hdGguUEkgLyAxODApO1xuICAgIGN0eC5yZWN0KDAsMCwgcmVjZWl2ZXIuY2xpcFRvLndpZHRoLCByZWNlaXZlci5jbGlwVG8uaGVpZ2h0KTtcbiAgfVxuXG4gIGN0eC5jbG9zZVBhdGgoKTtcbiAgY3R4LnJlc3RvcmUoKTtcbn07XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL21vZHVsZXMvY2xpcFRvLmpzXG4vLyBtb2R1bGUgaWQgPSAzMFxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCIndXNlIHN0cmljdCc7XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLHtcbiAgZGVidWdUaW1lb3V0OiAwXG59KTtcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuQXBwbGljYXRpb24ucHJvdG90eXBlLCB7XG4gIHNldERlYnVnOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5vbihcInJlYWR5XCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuZW5hYmxlRGVidWdnaW5nKCk7XG4gICAgfSlcbiAgfSxcblxuICBlbmFibGVEZWJ1Z2dpbmc6IGZ1bmN0aW9uKCl7XG4gICAgaWYoZmFicmljLmRlYnVnKXtcblxuICAgICAgdmFyIF9vcGVyYW5kID0gXCJjb2xvcjogIzJFQzA2QzsgZm9udC1zdHlsZTogaXRhbGljO1wiO1xuICAgICAgY29uc29sZS5pbmZvKFwiZGVidWcgZW5hYmxlZC4gKHVzZSAlY2FwcCVjLCAlY3Byb2plY3QlYywgJWNjYW52YXMlYywgJWN0YXJnZXQlYyBpbiBjb25zb2xlKVwiLFxuICAgICAgICBfb3BlcmFuZCwgXCJjb2xvcjogIzIwMjAyMFwiLFxuICAgICAgICBfb3BlcmFuZCwgXCJjb2xvcjogIzIwMjAyMFwiLFxuICAgICAgICBfb3BlcmFuZCwgXCJjb2xvcjogIzIwMjAyMFwiLFxuICAgICAgICBfb3BlcmFuZCwgXCJjb2xvcjogIzIwMjAyMFwiKTtcblxuICAgICAgd2luZG93LmFwcCA9IHRoaXM7XG4gICAgICB3aW5kb3cuY2FudmFzID0gdGhpcy5jYW52YXM7XG4gICAgICB3aW5kb3cucHJvamVjdCA9IHRoaXMucHJvamVjdDtcbiAgICAgIHdpbmRvdy50YXJnZXQgPSBudWxsO1xuICAgICAgdGhpcy5jYW52YXMgJiYgdGhpcy5jYW52YXMub24oXCJ0YXJnZXQ6Y2hhbmdlZFwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHdpbmRvdy50YXJnZXQgPSB0aGlzLnRhcmdldDtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxufSk7XG5cbmZhYnJpYy5PYmplY3QucHJvdG90eXBlLmRlYnVnID0gZnVuY3Rpb24obm9Cb3JkZXJzKXtcbiAgdmFyIGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIik7XG4gIGNhbnZhcy53aWR0aCA9IG5vQm9yZGVycyA/dGhpcy53aWR0aDogdGhpcy53aWR0aCArIDI7XG4gIGNhbnZhcy5oZWlnaHQgPSBub0JvcmRlcnMgP3RoaXMuaGVpZ2h0IDogdGhpcy5oZWlnaHQgKyAyO1xuXG4gIHZhciBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgaWYoIW5vQm9yZGVycyl7XG4gICAgY3R4LmxpbmVXaWR0aD0xO1xuICAgIGN0eC5zdHJva2VTdHlsZT1cInllbGxvd1wiO1xuICAgIGN0eC5zdHJva2VSZWN0KDAsMCx0aGlzLndpZHRoICsgMix0aGlzLmhlaWdodCsgMik7XG4gICAgY3R4LnNldExpbmVEYXNoKFs0LDRdKTtcbiAgICBjdHguc3Ryb2tlU3R5bGU9XCIjMDAwMDAwXCI7XG4gICAgY3R4LnN0cm9rZVJlY3QoMCwwLHRoaXMud2lkdGggKyAyLHRoaXMuaGVpZ2h0KyAyKTtcbiAgfVxuICBjdHgudHJhbnNsYXRlKHRoaXMud2lkdGgvMiAgKyAxLHRoaXMuaGVpZ2h0LzIgKyAxKTtcbiAgdmFyIF9jbGlwVG8gPSB0aGlzLmNsaXBUbztcbiAgZGVsZXRlIHRoaXMuY2xpcFRvO1xuICB0aGlzLnJlbmRlcihjdHgsdHJ1ZSk7XG4gIHRoaXMuY2xpcFRvID0gX2NsaXBUbztcbiAgd2luZG93Lm9wZW4oY2FudmFzLnRvRGF0YVVSTCgpLFwiX2JsYW5rXCIpO1xufTtcblxuXG5mYWJyaWMuQXBwbGljYXRpb24ucHJvdG90eXBlLmxvZ0V2ZW50cyA9IGZhYnJpYy5PYmplY3QucHJvdG90eXBlLmxvZ0V2ZW50cyA9IGZ1bmN0aW9uIGV2ZW50c0xvZ2dlcihvcHRpb25zKXtcbiAgdmFyIF9jb3VudGVyID0ge307XG4gIGZvcih2YXIgaSBpbiBvcHRpb25zKXtcbiAgICBfY291bnRlcltpXSA9IDA7XG4gICAgdGhpcy5vbihvcHRpb25zW2ldLGZ1bmN0aW9uKGksIGV2ZW50KSB7XG4gICAgICBjb25zb2xlLmxvZyhpICsgXCIgXCIgKyArK19jb3VudGVyW2ldLGV2ZW50KTtcbiAgICB9LmJpbmQodGhpcyxpKSk7XG4gIH1cbn07XG5cblxuXG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL21vZHVsZXMvZGVidWcuanNcbi8vIG1vZHVsZSBpZCA9IDMxXG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIid1c2Ugc3RyaWN0JztcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuU2xpZGVDYW52YXMucHJvdG90eXBlLCB7XG4gIHNldERyb3BwYWJsZTogZnVuY3Rpb24odmFsKXtcbiAgICB0aGlzLmRyb3BwYWJsZSA9IHZhbDtcbiAgICBpZih0aGlzLmRyb3BwYWJsZSl7XG4gICAgICB0aGlzLmluaXREcmFnQW5kRHJvcCgpO1xuICAgIH1cbiAgfSxcbiAgZHJvcHBhYmxlOiBmYWxzZSwgLy97fVxuICBpc0Ryb3BBdmFpbGFibGU6IGZ1bmN0aW9uIChkcm9wcGFibGUsIGRhdGEpIHtcblxuICAgIGZvciAodmFyIGkgaW4gZHJvcHBhYmxlKSB7XG4gICAgICBpZiAoZHJvcHBhYmxlW2ldLmNvbnN0cnVjdG9yID09IEFycmF5KSB7XG4gICAgICAgIGlmIChkcm9wcGFibGVbaV0uaW5kZXhPZihkYXRhW2ldKSA9PSAtMSlyZXR1cm4gZmFsc2U7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZihkcm9wcGFibGVbaV0gPT0gXCIqXCIpY29udGludWU7XG4gICAgICAgIGlmIChkcm9wcGFibGVbaV0gIT0gZGF0YVtpXSkgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgICAvL3JldHVybiAodGhpcy5zdXBwb3J0ZWRUeXBlcyA9PSBcIipcIiB8fCB0aGlzLnN1cHBvcnRlZFR5cGVzLmluZGV4T2YodHlwZSkhPSAtMSlcbiAgfSxcbiAgZHJvcDogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgIGRhdGEgPSBmYWJyaWMudXRpbC5vYmplY3QuY2xvbmUoZGF0YSk7XG5cbiAgICBpZiAoZGF0YS5jYXRlZ29yeSA9PSBcImJhY2tncm91bmRcIikge1xuICAgICAgdGhpcy5zZXRCYWNrZ3JvdW5kSW1hZ2UoZGF0YS5zcmMsIHRoaXMucmVuZGVyQWxsLmJpbmQodGhpcykpXG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgZGF0YS5hY3RpdmUgPSB0cnVlO1xuICAgICAgX3RoaXMuY3JlYXRlT2JqZWN0KGRhdGEpO1xuICAgIH1cblxuXG4gICAgLy9mYWJyaWMudXRpbC5jcmVhdGVPYmplY3QoZGF0YSwgZnVuY3Rpb24gKGVsKSB7XG4gICAgLy8gIGFwcC5jYW52YXMuYWRkKGVsKTtcbiAgICAvLyAgYXBwLmNhbnZhcy5zZXRBY3RpdmVPYmplY3QoZWwpO1xuICAgIC8vfSk7XG4gIH0sXG4gIGluaXREcmFnQW5kRHJvcDogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMub24oXCJtb3VzZTpkcm9wXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICB2YXIgX3ggPSAoZS54IC0gZS5vZmZzZXRYKTtcbiAgICAgIHZhciBfeSA9IChlLnkgLSBlLm9mZnNldFkpXG4gICAgICB2YXIgX3cgPSAoZS5kYXRhLndpZHRoIHx8IGUud2lkdGggICk7XG4gICAgICB2YXIgX2ggPSAoZS5kYXRhLmhlaWdodCB8fCBlLmhlaWdodCApO1xuXG4gICAgICBpZiAoZS5kYXRhLnNjYWxlWCkge1xuICAgICAgICB2YXIgX3NjYWxlWCA9IGUuZGF0YS5zY2FsZVggLyB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzBdXG5cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIF9zY2FsZVggPSAxO1xuICAgICAgICBfdyAvPSB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzBdXG4gICAgICB9XG5cbiAgICAgIGlmIChlLmRhdGEuc2NhbGVZKSB7XG4gICAgICAgIHZhciBfc2NhbGVZID0gZS5kYXRhLnNjYWxlWSAvIHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bM107XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBfc2NhbGVZID0gMTtcbiAgICAgICAgX2ggLz0gdGhpcy52aWV3cG9ydFRyYW5zZm9ybVszXVxuICAgICAgfVxuXG4gICAgICB2YXIgX3N0cm9rZSA9IGUuZGF0YS5zdHJva2VXaWR0aCB8fCAwO1xuICAgICAgaWYgKGUuZGF0YS5sZWZ0KSB7XG4gICAgICAgIF94ICs9IChlLmRhdGEubGVmdCArIF9zdHJva2UpIC8gdGhpcy52aWV3cG9ydFRyYW5zZm9ybVswXTtcbiAgICAgIH1cbiAgICAgIGlmIChlLmRhdGEudG9wKSB7XG4gICAgICAgIF95ICs9IChlLmRhdGEudG9wICsgX3N0cm9rZSkgLyB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzNdO1xuICAgICAgfVxuXG5cbiAgICAgIGUuZGF0YSA9IGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoe30sIGUuZGF0YSwge1xuICAgICAgICBzY2FsZVg6IF9zY2FsZVgsXG4gICAgICAgIHNjYWxlWTogX3NjYWxlWSxcbiAgICAgICAgbGVmdDogX3gsXG4gICAgICAgIHRvcDogX3ksXG4gICAgICAgIHdpZHRoOiBfdyxcbiAgICAgICAgaGVpZ2h0OiBfaCxcbiAgICAgICAgb3JpZ2luYWxXaWR0aDogZS5kYXRhLndpZHRoLFxuICAgICAgICBvcmlnaW5hbEhlaWdodDogZS5kYXRhLmhlaWdodFxuICAgICAgfSk7XG5cbiAgICAgIHRoaXMuZmlyZShcImJlZm9yZTpkcm9wXCIsZSk7XG5cbiAgICAgIGUudGFyZ2V0ID0gdGhpcy5maW5kVGFyZ2V0KGUub3JpZ2luYWxFdmVudCk7XG4gICAgICBpZiAoZS50YXJnZXQgJiYgIXRoaXMuaXNEcmF3aW5nTW9kZSkge1xuICAgICAgICAvLyBUbyB1bmlmeSB0aGUgYmVoYXZpb3IsIHRoZSBvYmplY3QncyBkb3VibGUgY2xpY2sgZXZlbnQgZG9lcyBub3QgZmlyZSBvbiBkcmF3aW5nIG1vZGUuXG4gICAgICAgIGUudGFyZ2V0LmZpcmUoJ29iamVjdDpkcm9wJywgZSk7XG4gICAgICB9XG5cblxuICAgICAgaWYgKGUudGFyZ2V0ICYmIGUudGFyZ2V0LmRyb3BwYWJsZSkge1xuICAgICAgICBpZiAodGhpcy5pc0Ryb3BBdmFpbGFibGUoZS50YXJnZXQuZHJvcHBhYmxlLCBlLmRhdGEpKSB7XG4gICAgICAgICAgZS50YXJnZXQuZGVhY3RpdmF0ZSgpO1xuICAgICAgICAgIGUudGFyZ2V0LmRyb3AoZS5kYXRhKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKHRoaXMuZHJvcHBhYmxlICYmIHRoaXMuaXNEcm9wQXZhaWxhYmxlKHRoaXMuZHJvcHBhYmxlLCBlLmRhdGEpKSB7XG4gICAgICAgICAgdGhpcy5kcm9wKGUuZGF0YSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgICB0aGlzLm9uKFwibW91c2U6ZHJhZ2VudGVyXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICBpZiAoZS50YXJnZXQgJiYgZS50YXJnZXQuZHJvcHBhYmxlKSB7XG4gICAgICAgIGlmICh0aGlzLmlzRHJvcEF2YWlsYWJsZShlLnRhcmdldC5kcm9wcGFibGUsIGUuZGF0YSkpIHtcbiAgICAgICAgICBlLnRhcmdldC5hY3RpdmF0ZSgpO1xuICAgICAgICAgIGUuZS5oZWxwZXIuY3NzKFwiY3Vyc29yXCIsIFwiYWxpYXNcIik7XG4gICAgICAgICAgdGhpcy5zZXRDdXJzb3IoXCJhbGlhc1wiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBlLmUuaGVscGVyLmNzcyhcImN1cnNvclwiLCBcIm5vdC1hbGxvd2VkXCIpO1xuICAgICAgICAgIHRoaXMuc2V0Q3Vyc29yKFwibm90LWFsbG93ZWRcIik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgICB0aGlzLm9uKFwibW91c2U6ZHJhZ2xlYXZlXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICBpZiAoZS50YXJnZXQgJiYgZS50YXJnZXQuZHJvcHBhYmxlKSB7XG4gICAgICAgIGlmICh0aGlzLmlzRHJvcEF2YWlsYWJsZShlLnRhcmdldC5kcm9wcGFibGUsIGUuZGF0YSkpIHtcbiAgICAgICAgICB0aGlzLl9hY3RpdmF0ZWQgPSBmYWxzZTtcbiAgICAgICAgICBlLnRhcmdldC5kZWFjdGl2YXRlKClcbiAgICAgICAgfVxuICAgICAgICBlLmUuaGVscGVyLmNzcyhcImN1cnNvclwiLCBcInBvaW50ZXJcIik7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cbn0pO1xuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9tb2R1bGVzL2Ryb3BwYWJsZS5qc1xuLy8gbW9kdWxlIGlkID0gMzJcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiaWYodHlwZW9mIFdlYkZvbnQgPT0gXCJ1bmRlZmluZWRcIil7XG4gIGZhYnJpYy53ZWJGb250c0xvYWRlciA9IHJlcXVpcmUoXCIuLy4uLy4uL3BsdWdpbnMvd2ViZm9udC5qc1wiKTtcbn1lbHNle1xuICBmYWJyaWMud2ViRm9udHNMb2FkZXIgPSBXZWJGb250O1xufVxuXG4vL9C40L3RgtC10YDQtdGB0L3QsNGPINCx0LjQsdC70LjQvtGC0LXQutCwXG4vLyBodHRwOi8vb3BlbnR5cGUuanMub3JnL2luZGV4Lmh0bWxcbi8vdG9kbyBhZGQgc3RlcFxuLy9cbi8vIGZhYnJpYy5BcHBsaWNhdGlvbi5wcm90b3R5cGUuc3RlcHMuc3BsaWNlKDMsMCxcImxvYWRXZWJmb250c1wiKTtcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuQXBwbGljYXRpb24ucHJvdG90eXBlLCB7XG4gIC8vIHNldFdlYmZvbnRzOiBmdW5jdGlvbiAoY2FsbGJhY2spIHtcbiAgLy9cbiAgLy8gfSxcbiAgc2V0Rm9udHM6IGZ1bmN0aW9uIChmb250cywgY2FsbGJhY2spIHtcbiAgICB0aGlzLmZvbnRzID0gZm9udHM7XG4gICAgaWYoZmFicmljLmlzTGlrZWx5Tm9kZSl7XG4gICAgICAvL3RvZG8g0YjRgNC40YTRgtGLINC90LUg0LPRgNGD0LfRj9GC0YHRjyDQvdCwINGB0LXRgNCy0LXRgNC1XG4gICAgICByZXR1cm4gY2FsbGJhY2soKTtcbiAgICB9XG4gICAgLy8gaWYoIWZvbnRzIHx8ICFmb250cy5sZW5ndGgpe1xuICAgIC8vICAgcmV0dXJuIGNhbGxiYWNrKCk7XG4gICAgLy8gfVxuICAgIHRoaXMuZmlyZShcImxvYWRpbmdcIix7dHlwZTogXCJ3ZWJmb250c1wifSk7XG5cbiAgICB0aGlzLl9mb250cyA9IFtdO1xuXG4gICAgZm9yKHZhciBpIGluIHRoaXMuZm9udHMpe1xuICAgICAgdGhpcy5fZm9udHMgPSB0aGlzLl9mb250cy5jb25jYXQodGhpcy5mb250c1tpXSk7XG4gICAgfVxuICAgIHRoaXMuX2ZvbnRzID0gZmFicmljLnV0aWwub2JqZWN0LnNvcnRCeSh0aGlzLl9mb250cywgZnVuY3Rpb24oZm9udCl7IHJldHVybiBmb250OyB9KTtcblxuICAgIGlmKGZhYnJpYy53ZWJGb250c0xvYWRlciAmJiAodGhpcy5mb250cy5nb29nbGUgJiYgdGhpcy5mb250cy5nb29nbGUubGVuZ3RoIHx8IHRoaXMuZm9udHMuY3VzdG9tICYmIHRoaXMuZm9udHMuY3VzdG9tLmxlbmd0aCkgKXtcbiAgICAgIHZhciBmb250c19vcHRpb25zID0ge1xuICAgICAgICBhY3RpdmU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgaWYodGhpcy5mb250cy5nb29nbGUgJiYgdGhpcy5mb250cy5nb29nbGUubGVuZ3RoKXtcbiAgICAgICAgZm9udHNfb3B0aW9ucy5nb29nbGUgPSAge1xuICAgICAgICAgIGZhbWlsaWVzOiB0aGlzLmZvbnRzLmdvb2dsZVxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgaWYodGhpcy5mb250cy5jdXN0b20gJiYgdGhpcy5mb250cy5jdXN0b20ubGVuZ3RoKXtcbiAgICAgICAgZm9udHNfb3B0aW9ucy5jdXN0b20gPSAge1xuICAgICAgICAgIGZhbWlsaWVzOiB0aGlzLmZvbnRzLmN1c3RvbVxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICBmYWJyaWMud2ViRm9udHNMb2FkZXIubG9hZChmb250c19vcHRpb25zKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY2FsbGJhY2soKTtcbiAgICB9XG4gICAgaWYgKHRoaXMud2FpdEZvcldlYmZvbnRzKSB7XG4gICAgICBmYWJyaWMudXRpbC5mb250cy53YWl0Rm9yKHRoaXMud2FpdEZvcldlYmZvbnRzLCBjYWxsYmFjaylcbiAgICB9XG4gIH0sXG4gIGZvbnRzOiB7XG4gICAgc3RhbmRhcnQ6IFtcbiAgICAgICdBcmlhbCcsXG4gICAgICAnQXJpYWwgQmxhY2snLFxuICAgICAgJ0NvbWljIFNhbnMgTVMnLFxuICAgICAgJ0NvdXJpZXIgTmV3JyxcbiAgICAgICdHZW9yZ2lhJyxcbiAgICAgICdJbXBhY3QnLFxuICAgICAgJ0x1Y2lkYSBDb25zb2xlJyxcbiAgICAgICdUYWhvbWEnLFxuICAgICAgJ1RpbWVzIE5ldyBSb21hbicsXG4gICAgICAnR2VuZXZhJyxcbiAgICAgICdzYW5zLXNlcmlmJyxcbiAgICAgICdzZXJpZicsXG4gICAgICAnbW9ub3NwYWNlJyxcbiAgICAgICdjdXJzaXZlJ1xuICAgIF0sXG4gICAgZ29vZ2xlOiBbXSxcbiAgICBjdXN0b206IFtdXG4gIH1cbn0pO1xuXG5cbmZhYnJpYy51dGlsLmZvbnRzID0ge1xuICB3YWl0Rm9yOiBmdW5jdGlvbiAoZm9udHMsIGNhbGxiYWNrKSB7XG4gICAgdmFyIGxvYWRlZEZvbnRzID0gMDtcbiAgICBmb3IgKHZhciBpID0gMCwgbCA9IGZvbnRzLmxlbmd0aDsgaSA8IGw7ICsraSkge1xuICAgICAgKGZ1bmN0aW9uIChmb250KSB7XG4gICAgICAgIHZhciBub2RlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuICAgICAgICAvLyBDaGFyYWN0ZXJzIHRoYXQgdmFyeSBzaWduaWZpY2FudGx5IGFtb25nIGRpZmZlcmVudCBmb250c1xuICAgICAgICBub2RlLmlubmVySFRNTCA9ICdnaUl0VDFXUXlAIS0vIyc7XG4gICAgICAgIC8vIFZpc2libGUgLSBzbyB3ZSBjYW4gbWVhc3VyZSBpdCAtIGJ1dCBub3Qgb24gdGhlIHNjcmVlblxuICAgICAgICBub2RlLnN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJztcbiAgICAgICAgbm9kZS5zdHlsZS5sZWZ0ID0gJy0xMDAwMHB4JztcbiAgICAgICAgbm9kZS5zdHlsZS50b3AgPSAnLTEwMDAwcHgnO1xuICAgICAgICAvLyBMYXJnZSBmb250IHNpemUgbWFrZXMgZXZlbiBzdWJ0bGUgY2hhbmdlcyBvYnZpb3VzXG4gICAgICAgIG5vZGUuc3R5bGUuZm9udFNpemUgPSAnMzAwcHgnO1xuICAgICAgICAvLyBSZXNldCBhbnkgZm9udCBwcm9wZXJ0aWVzXG4gICAgICAgIG5vZGUuc3R5bGUuZm9udEZhbWlseSA9ICdzYW5zLXNlcmlmJztcbiAgICAgICAgbm9kZS5zdHlsZS5mb250VmFyaWFudCA9ICdub3JtYWwnO1xuICAgICAgICBub2RlLnN0eWxlLmZvbnRTdHlsZSA9ICdub3JtYWwnO1xuICAgICAgICBub2RlLnN0eWxlLmZvbnRXZWlnaHQgPSAnbm9ybWFsJztcbiAgICAgICAgbm9kZS5zdHlsZS5sZXR0ZXJTcGFjaW5nID0gJzAnO1xuICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKG5vZGUpO1xuXG4gICAgICAgIC8vIFJlbWVtYmVyIHdpZHRoIHdpdGggbm8gYXBwbGllZCB3ZWIgZm9udFxuICAgICAgICB2YXIgd2lkdGggPSBub2RlLm9mZnNldFdpZHRoO1xuXG4gICAgICAgIG5vZGUuc3R5bGUuZm9udEZhbWlseSA9IGZvbnQ7XG5cbiAgICAgICAgdmFyIGludGVydmFsO1xuXG4gICAgICAgIGZ1bmN0aW9uIGNoZWNrRm9udCgpIHtcbiAgICAgICAgICAvLyBDb21wYXJlIGN1cnJlbnQgd2lkdGggd2l0aCBvcmlnaW5hbCB3aWR0aFxuICAgICAgICAgIGlmIChub2RlICYmIG5vZGUub2Zmc2V0V2lkdGggIT0gd2lkdGgpIHtcbiAgICAgICAgICAgICsrbG9hZGVkRm9udHM7XG4gICAgICAgICAgICBub2RlLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQobm9kZSk7XG4gICAgICAgICAgICBub2RlID0gbnVsbDtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBJZiBhbGwgZm9udHMgaGF2ZSBiZWVuIGxvYWRlZFxuICAgICAgICAgIGlmIChsb2FkZWRGb250cyA+PSBmb250cy5sZW5ndGgpIHtcbiAgICAgICAgICAgIGlmIChpbnRlcnZhbCkge1xuICAgICAgICAgICAgICBjbGVhckludGVydmFsKGludGVydmFsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChsb2FkZWRGb250cyA9PSBmb250cy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgICAgICAgfSwgNTApXG4gICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghY2hlY2tGb250KCkpIHtcbiAgICAgICAgICBpbnRlcnZhbCA9IHNldEludGVydmFsKGNoZWNrRm9udCwgNTApO1xuICAgICAgICB9XG4gICAgICB9KShmb250c1tpXSk7XG4gICAgfVxuICB9XG59O1xuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9tb2R1bGVzL2ZvbnRzLmpzXG4vLyBtb2R1bGUgaWQgPSAzM1xuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCIndXNlIHN0cmljdCc7XG5cblxuZmFicmljLnV0aWwubWVkaWFSb290ID0gXCJcIjtcbmZhYnJpYy51dGlsLmFkZE5vQ2FjaGUgPSBmYWxzZTtcblxuZmFicmljLnV0aWwuX2xvYWRJbWFnZV9vdmVyd3JpdHRlbiA9IGZhYnJpYy51dGlsLmxvYWRJbWFnZTtcblxuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5BcHBsaWNhdGlvbi5wcm90b3R5cGUsIHtcbiAgb3B0aW9uc09yZGVyOiAoZnVuY3Rpb24oKXtcbiAgICB2YXIgb28gPSBmYWJyaWMuQXBwbGljYXRpb24ucHJvdG90eXBlLm9wdGlvbnNPcmRlcjtcbiAgICBvby5zcGxpY2Uob28uaW5kZXhPZihcImNhbnZhc0NvbnRhaW5lclwiKSwwLFwibWVkaWFSb290XCIpO1xuICAgIHJldHVybiBvbztcbiAgfSkoKSxcbiAgc2V0TWVkaWFSb290OiBmdW5jdGlvbiAoX21lZGlhUm9vdCkge1xuICAgIGlmIChfbWVkaWFSb290KSB7XG4gICAgICB2YXIgX2Rpcm5hbWU7XG4gICAgICBpZiAoZmFicmljLmlzTGlrZWx5Tm9kZSkge1xuICAgICAgICBfZGlybmFtZSA9IF9fZGlybmFtZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIF9kaXJuYW1lID0gZmFicmljLnV0aWwucGF0aC5nZXRQYXJlbnREaXJlY3RvcnlVcmwod2luZG93LmxvY2F0aW9uLmhyZWYpO1xuICAgICAgfVxuXG4gICAgLy8gIGlmICgoX21lZGlhUm9vdC5pbmRleE9mKFwiLi9cIikgPT0gMCkpIHtcbiAgICAvLyAgfVxuICAgICAgdmFyIF9sYXN0ID0gX21lZGlhUm9vdFtfbWVkaWFSb290Lmxlbmd0aCAtIDFdO1xuICAgICAgaWYgKF9sYXN0ICE9IFwiL1wiICYmIF9sYXN0ICE9IFwiXFxcXFwiKSB7XG4gICAgICAgIF9tZWRpYVJvb3QgKz0gXCIvXCJcbiAgICAgIH1cbiAgICAgIF9tZWRpYVJvb3QgPSBmYWJyaWMudXRpbC5wYXRoLnJlc29sdmUoX2Rpcm5hbWUgKyBfbWVkaWFSb290KTtcbiAgICAgIGZhYnJpYy51dGlsLm1lZGlhUm9vdCA9IF9tZWRpYVJvb3Q7XG4gICAgfVxuICB9XG59KTtcblxuXG5cblxuLy8gaWYoIWZhYnJpYy5pc0xpa2VseU5vZGUpe1xuLy9cbi8vICAgdmFyIFVSTCA9IHJlcXVpcmUoJ3VybCcpLFxuLy8gICAgIEhUVFAgPSByZXF1aXJlKCdodHRwJyksXG4vLyAgICAgSFRUUFMgPSByZXF1aXJlKCdodHRwcycpLFxuLy8gICAgIEltYWdlID0gcmVxdWlyZSgnY2FudmFzJykuSW1hZ2U7XG4vL1xuLy8gICAvKiogQHByaXZhdGUgKi9cbi8vICAgdmFyIHJlcXVlc3QgPSBmdW5jdGlvbiAodXJsLCBlbmNvZGluZywgY2FsbGJhY2spIHtcbi8vICAgICB2YXIgb1VSTCA9IFVSTC5wYXJzZSh1cmwpO1xuLy9cbi8vICAgICAvLyBkZXRlY3QgaWYgaHR0cCBvciBodHRwcyBpcyB1c2VkXG4vLyAgICAgaWYgKCAhb1VSTC5wb3J0ICkge1xuLy8gICAgICAgb1VSTC5wb3J0ID0gKCBvVVJMLnByb3RvY29sLmluZGV4T2YoJ2h0dHBzOicpID09PSAwICkgPyA0NDMgOiA4MDtcbi8vICAgICB9XG4vL1xuLy8gICAgIC8vIGFzc2lnbiByZXF1ZXN0IGhhbmRsZXIgYmFzZWQgb24gcHJvdG9jb2xcbi8vICAgICB2YXIgcmVxSGFuZGxlciA9IChvVVJMLnByb3RvY29sLmluZGV4T2YoJ2h0dHBzOicpID09PSAwICkgPyBIVFRQUyA6IEhUVFAsXG4vLyAgICAgICByZXEgPSByZXFIYW5kbGVyLnJlcXVlc3Qoe1xuLy8gICAgICAgICBob3N0bmFtZTogb1VSTC5ob3N0bmFtZSxcbi8vICAgICAgICAgcG9ydDogb1VSTC5wb3J0LFxuLy8gICAgICAgICBwYXRoOiBvVVJMLnBhdGgsXG4vLyAgICAgICAgIG1ldGhvZDogJ0dFVCdcbi8vICAgICAgIH0sIGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4vLyAgICAgICAgIHZhciBib2R5ID0gJyc7XG4vLyAgICAgICAgIGlmIChlbmNvZGluZykge1xuLy8gICAgICAgICAgIHJlc3BvbnNlLnNldEVuY29kaW5nKGVuY29kaW5nKTtcbi8vICAgICAgICAgfVxuLy8gICAgICAgICByZXNwb25zZS5vbignZW5kJywgZnVuY3Rpb24gKCkge1xuLy8gICAgICAgICAgIGNhbGxiYWNrKGJvZHkpO1xuLy8gICAgICAgICB9KTtcbi8vICAgICAgICAgcmVzcG9uc2Uub24oJ2RhdGEnLCBmdW5jdGlvbiAoY2h1bmspIHtcbi8vICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzQ29kZSA9PT0gMjAwKSB7XG4vLyAgICAgICAgICAgICBib2R5ICs9IGNodW5rO1xuLy8gICAgICAgICAgIH1cbi8vICAgICAgICAgfSk7XG4vLyAgICAgICB9KTtcbi8vXG4vLyAgICAgcmVxLm9uKCdlcnJvcicsIGZ1bmN0aW9uKGVycikge1xuLy8gICAgICAgaWYgKGVyci5lcnJubyA9PT0gcHJvY2Vzcy5FQ09OTlJFRlVTRUQpIHtcbi8vICAgICAgICAgZmFicmljLmxvZygnRUNPTk5SRUZVU0VEOiBjb25uZWN0aW9uIHJlZnVzZWQgdG8gJyArIG9VUkwuaG9zdG5hbWUgKyAnOicgKyBvVVJMLnBvcnQpO1xuLy8gICAgICAgfVxuLy8gICAgICAgZWxzZSB7XG4vLyAgICAgICAgIGZhYnJpYy5sb2coZXJyLm1lc3NhZ2UpO1xuLy8gICAgICAgfVxuLy8gICAgICAgY2FsbGJhY2sobnVsbCk7XG4vLyAgICAgfSk7XG4vL1xuLy8gICAgIHJlcS5lbmQoKTtcbi8vICAgfVxuLy9cbi8vICAgLyoqIEBwcml2YXRlICovXG4vLyAgIHZhciByZXF1ZXN0RnMgPSBmdW5jdGlvbiAocGF0aCwgY2FsbGJhY2spIHtcbi8vICAgICB2YXIgZnMgPSByZXF1aXJlKCdmcycpO1xuLy8gICAgIGZzLnJlYWRGaWxlKHBhdGgsIGZ1bmN0aW9uIChlcnIsIGRhdGEpIHtcbi8vICAgICAgIGlmIChlcnIpIHtcbi8vICAgICAgICAgZmFicmljLmxvZyhlcnIpO1xuLy8gICAgICAgICB0aHJvdyBlcnI7XG4vLyAgICAgICB9XG4vLyAgICAgICBlbHNlIHtcbi8vICAgICAgICAgY2FsbGJhY2soZGF0YSk7XG4vLyAgICAgICB9XG4vLyAgICAgfSk7XG4vLyAgIH07XG4vL1xuLy8gICBmYWJyaWMudXRpbC5sb2FkSW1hZ2UgPSBmdW5jdGlvbih1cmwsIGNhbGxiYWNrLCBjb250ZXh0KSB7XG4vL1xuLy9cbi8vICAgICB2YXIgaW1nID0gbmV3IEltYWdlKCk7XG4vLyAgICAgaW1nLm9uZXJyb3IgPSBmdW5jdGlvbigpe1xuLy8gICAgICAgY29uc29sZS5sb2coXCJlcnJvclwiKTtcbi8vICAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrLmNhbGwoY29udGV4dCwgbnVsbCwgdHJ1ZSk7XG4vLyAgICAgfTtcbi8vICAgICBpbWcub25sb2FkID0gZnVuY3Rpb24oKXtcbi8vICAgICAgIGNvbnNvbGUubG9nKFwic3VjY2Vzc1wiKTtcbi8vICAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrLmNhbGwoY29udGV4dCwgaW1nKTtcbi8vICAgICB9O1xuLy9cbi8vICAgICBmdW5jdGlvbiBjcmVhdGVJbWFnZUFuZENhbGxCYWNrKGRhdGEpIHtcbi8vICAgICAgIGlmIChkYXRhKSB7XG4vLyAgICAgICAgIGltZy5zcmMgPSBkYXRhO1xuLy8gICAgICAgICAvLyBwcmVzZXJ2aW5nIG9yaWdpbmFsIHVybCwgd2hpY2ggc2VlbXMgdG8gYmUgbG9zdCBpbiBub2RlLWNhbnZhc1xuLy8gICAgICAgICBpbWcuX3NyYyA9IHVybDtcbi8vICAgICAgIH1cbi8vICAgICAgIGVsc2Uge1xuLy8gICAgICAgICBpbWcgPSBudWxsO1xuLy8gICAgICAgICBjYWxsYmFjayAmJiBjYWxsYmFjay5jYWxsKGNvbnRleHQsIG51bGwsIHRydWUpO1xuLy8gICAgICAgfVxuLy8gICAgIH1cbi8vXG4vLyAgICAgaWYgKHVybCAmJiAodXJsIGluc3RhbmNlb2YgQnVmZmVyIHx8IHVybC5pbmRleE9mKCdkYXRhJykgPT09IDApKSB7XG4vLyAgICAgICBpbWcuc3JjID0gaW1nLl9zcmMgPSB1cmw7XG4vLyAgICAgfVxuLy8gICAgIGVsc2UgaWYgKHVybCAmJiB1cmwuaW5kZXhPZignaHR0cCcpICE9PSAwKSB7XG4vLyAgICAgICB2YXIgcGF0aCA9IHJlcXVpcmUoXCJwYXRoXCIpO1xuLy8gICAgICAgdXJsID0gZmFicmljLnV0aWwuZ2V0VVJMKHVybCk7XG4vLyAgICAgICB1cmwgPSAgIHBhdGgucmVzb2x2ZShmYWJyaWMudXRpbC5tZWRpYVJvb3QsIHVybCk7XG4vLyAgICAgICBpbWcuc3JjID0gIHVybDtcbi8vICAgICAgIC8vIHJlcXVlc3RGcyh1cmwsIGNyZWF0ZUltYWdlQW5kQ2FsbEJhY2spO1xuLy8gICAgIH1cbi8vICAgICBlbHNlIGlmICh1cmwpIHtcbi8vICAgICAgIHJlcXVlc3QodXJsLCAnYmluYXJ5JywgY3JlYXRlSW1hZ2VBbmRDYWxsQmFjayk7XG4vLyAgICAgfVxuLy8gICAgIGVsc2Uge1xuLy8gICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2suY2FsbChjb250ZXh0LCB1cmwpO1xuLy8gICAgIH1cbi8vICAgfTtcbi8vIH1lbHNle1xuICBmYWJyaWMudXRpbC5sb2FkUmVzb3VyY2VzID0gZnVuY3Rpb24gKHJlc291cmNlcywgY2FsbGJhY2ssIGNvbnRleHQsIGNyb3NzT3JpZ2luKSB7XG5cbiAgICB2YXIgbG9hZGVkUmVzb3VyY2VzID0ge307XG4gICAgdmFyIGxvYWRlciA9IGZhYnJpYy51dGlsLnF1ZXVlTG9hZChPYmplY3Qua2V5cyhyZXNvdXJjZXMpLmxlbmd0aCxmdW5jdGlvbigpe1xuICAgICAgY2FsbGJhY2sobG9hZGVkUmVzb3VyY2VzKTtcbiAgICB9KTtcbiAgICBmb3IodmFyIGkgaW4gcmVzb3VyY2VzKXtcbiAgICAgIChmdW5jdGlvbihpKXtcbiAgICAgICAgZmFicmljLnV0aWwubG9hZEltYWdlKHJlc291cmNlc1tpXSwgZnVuY3Rpb24oaW1hZ2Upe1xuICAgICAgICAgIGxvYWRlZFJlc291cmNlc1tpXSA9IGltYWdlO1xuICAgICAgICAgIGxvYWRlcigpO1xuICAgICAgICB9LCBjb250ZXh0LCBjcm9zc09yaWdpbik7XG4gICAgICB9KGkpKTtcbiAgICB9XG4gIH07XG5cbiAgZmFicmljLnV0aWwubG9hZEltYWdlID0gZnVuY3Rpb24gKHVybCwgY2FsbGJhY2ssIGNvbnRleHQsIGNyb3NzT3JpZ2luKSB7XG4gICAgdXJsID0gZmFicmljLnV0aWwuZ2V0VVJMKHVybCk7XG4gICAgZnVuY3Rpb24gX2NoZWNrX2Vycm9ycyhpbWcpe1xuICAgICAgLy/QuNC30L7QsdGA0LDQttC10L3QuNC1INC90LUg0LHRi9C70L4g0LfQsNCz0YDRg9C20LXQvdC+XG4gICAgICBpZiAoaW1nKSB7XG4gICAgICAgIGNhbGxiYWNrLmNhbGwodGhpcyxpbWcpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZmFicmljLmVycm9ycy5wdXNoKHt0eXBlOiBcImltYWdlXCIsIG1lc3NhZ2U6IFwiSW1hZ2Ugd2FzIG5vdCBsb2FkZWRcIn0pO1xuICAgICAgICBmYWJyaWMudXRpbC5fbG9hZEltYWdlX292ZXJ3cml0dGVuKGZhYnJpYy5tZWRpYS5lcnJvciwgY2FsbGJhY2ssIGNvbnRleHQsIGNyb3NzT3JpZ2luIHx8ICdBbm9ueW1vdXMnKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZihmYWJyaWMuZGVidWdUaW1lb3V0KXtcbiAgICAgIHNldFRpbWVvdXQoZmFicmljLnV0aWwuX2xvYWRJbWFnZV9vdmVyd3JpdHRlbi5iaW5kKHRoaXMsdXJsLCBfY2hlY2tfZXJyb3JzICwgY29udGV4dCwgY3Jvc3NPcmlnaW4gfHwgJ0Fub255bW91cycpLGZhYnJpYy5kZWJ1Z1RpbWVvdXQpXG4gICAgfWVsc2V7XG4gICAgICBmYWJyaWMudXRpbC5fbG9hZEltYWdlX292ZXJ3cml0dGVuKHVybCwgX2NoZWNrX2Vycm9ycyAsIGNvbnRleHQsIGNyb3NzT3JpZ2luIHx8ICdBbm9ueW1vdXMnKTtcbiAgICB9XG4gIH07XG5cblxuZmFicmljLnV0aWwuZ2V0VVJMID0gZnVuY3Rpb24odXJsKXtcbiAgaWYgKHVybC5pbmRleE9mKCdibG9iJykgIT09IDAgJiYgdXJsLmluZGV4T2YoJ2RhdGEnKSAhPT0gMCAmJiB1cmwuaW5kZXhPZignOi8vJykgPT0gLTEpIHtcbiAgICB1cmwgPSBmYWJyaWMudXRpbC5tZWRpYVJvb3QgKyB1cmw7XG4gIH1cbiAgaWYgKGZhYnJpYy51dGlsLmFkZE5vQ2FjaGUgJiYgL14oaHR0cHxodHRwcylcXDpcXC9cXC8vLnRlc3QodXJsKSkge1xuICAgIHVybCArPSAnP25vLWNhY2hlPScgKyBuZXcgRGF0ZSgpLmdldFRpbWUoKVxuICB9XG4gIHJldHVybiB1cmw7XG59O1xuXG5cbmZhYnJpYy51dGlsLmxvYWRWaWRlbyA9IGZ1bmN0aW9uIChzb3VyY2VzLCBjYWxsYmFjaywgY29udGV4dCwgY3Jvc3NPcmlnaW4pIHtcblxuICBmdW5jdGlvbiBsb2FkSXQodXJsKXtcbiAgICB2aWRlby5zcmMgPSBmYWJyaWMudXRpbC5nZXRVUkwodXJsKTtcbiAgICB2aWRlby5hZGRFdmVudExpc3RlbmVyKFwibG9hZGVkZGF0YVwiLCBmdW5jdGlvbigpe1xuICAgICAgY2FsbGJhY2sodmlkZW8pO1xuICAgIH0sIHRydWUpO1xuICAgIHZpZGVvLmxvYWQoKTtcbiAgfVxuXG5cblxuXG4gIHZhciB2aWRlbyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3ZpZGVvJyk7XG5cblxuICAvL3RyeWluZyB0byBmaW5kIHRoZSBtb3N0IHN1aXRhYmxlIHNvdXJjZSBmb3IgY3VycmVudCBicm93c2VyXG4gIGZvciAodmFyIHR5cGUgaW4gc291cmNlcykge1xuICAgIGlmKHZpZGVvLmNhblBsYXlUeXBlKHR5cGUpID09IFwieWVzXCIpe1xuICAgICAgdGhpcy5tZWRpYVR5cGUgPSB0eXBlO1xuICAgICAgbG9hZEl0KHNvdXJjZXNbdHlwZV0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgfVxuICBmb3IgKHZhciB0eXBlIGluIHNvdXJjZXMpIHtcbiAgICBpZih2aWRlby5jYW5QbGF5VHlwZSh0eXBlKSA9PSBcIm1heWJlXCIpe1xuICAgICAgdGhpcy5tZWRpYVR5cGUgPSB0eXBlO1xuICAgICAgbG9hZEl0KHNvdXJjZXNbdHlwZV0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgfVxuICBjb25zb2xlLndhcm4oXCJ2aWRlbyBzb3VyY2VzIGZvcm1hdHMgaXMgbm90IHN1cHBvcnRlZFwiKVxuXG5cbn07XG5cbmZhYnJpYy51dGlsLl9sb2FkU1ZHRnJvbVVSTF9vdmVyd3JpdHRlbiA9IGZhYnJpYy5sb2FkU1ZHRnJvbVVSTDtcbmZhYnJpYy5sb2FkU1ZHRnJvbVVSTCA9IGZ1bmN0aW9uICh1cmwsIGNhbGxiYWNrLCByZXZpdmVyKSB7XG4gIGlmICh1cmwuaW5kZXhPZignZGF0YScpICE9PSAwICYmIHVybC5pbmRleE9mKCc6Ly8nKSA9PSAtMSkge1xuICAgIHVybCA9IGZhYnJpYy51dGlsLm1lZGlhUm9vdCArIHVybDtcbiAgfVxuICBpZiAoZmFicmljLnV0aWwuYWRkTm9DYWNoZSAmJiAvXihodHRwfGh0dHBzKVxcOlxcL1xcLy8udGVzdCh1cmwpKSB7XG4gICAgdXJsICs9ICc/bm8tY2FjaGU9JyArIG1vbWVudCgpLmZvcm1hdCgneCcpO1xuICB9XG4gIGZhYnJpYy51dGlsLl9sb2FkU1ZHRnJvbVVSTF9vdmVyd3JpdHRlbih1cmwsIGZ1bmN0aW9uKGRhdGEpe1xuICAgICBpZihkYXRhKXtcbiAgICAgICByZXR1cm4gY2FsbGJhY2soZGF0YSk7XG4gICAgIH1cblxuICAgIHZhciB4bWwgPSBqUXVlcnkucGFyc2VYTUwoYXRvYihmYWJyaWMubWVkaWEuZXJyb3Iuc3Vic3RyKDI2KSkpO1xuXG4gICAgZmFicmljLnBhcnNlU1ZHRG9jdW1lbnQoeG1sLmRvY3VtZW50RWxlbWVudCwgZnVuY3Rpb24gKHJlc3VsdHMsIG9wdGlvbnMpIHtcbiAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKHJlc3VsdHMsIG9wdGlvbnMpO1xuICAgIH0sIHJldml2ZXIpO1xuXG4gIH0sIHJldml2ZXIpO1xufTtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vbW9kdWxlcy9mcm9tVVJMLmpzXG4vLyBtb2R1bGUgaWQgPSAzNFxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCJcbi8qXG5leHBvcnQgaW50ZXJmYWNlIEdhbGxlcnlEYXRhIDoge1xuIHRhcmdldDogZmFicmljanMgb2JqZWN0XG59XG4qL1xuXG5cbmZhYnJpYy5BcHBsaWNhdGlvbi5wcm90b3R5cGUuc2V0RWxlbWVudEZyb21NZW51ID0gZnVuY3Rpb24gKHNlbGVjdGVkRGF0YSkge1xuICB0aGlzLmNhbnZhcy5jcmVhdGVJbWFnZU9iamVjdChzZWxlY3RlZERhdGEuaW1hZ2UsIHRoaXMudXBsb2FkQ2xhc3MpO1xufTtcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuQXBwbGljYXRpb24ucHJvdG90eXBlLCB7XG4gIGRyYWdnYWJsZUFyZWE6IFwiLmZmLWNvbnRhaW5lclwiLFxuICAvKmNyZWF0ZUdhbGxlcnk6IGZ1bmN0aW9uICh0YXJnZXQsICRlbCwgb3B0aW9ucykge1xuICAgIGlmICgkZWwuY29uc3RydWN0b3IgPT09IFN0cmluZykge1xuICAgICAgJGVsID0gJChcIiNcIiArICRlbCk7XG4gICAgfVxuICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuXG4gICAgaWYgKHRhcmdldC5nYWxsZXJ5Q2F0ZWdvcnkpIHtcbiAgICAgIG9wdGlvbnMuY2F0ZWdvcnkgPSB0YXJnZXQuZ2FsbGVyeUNhdGVnb3J5O1xuICAgIH1cblxuICAgICRlbC5lbXB0eSgpO1xuICAgIHZhciBsaWJyYXJ5ID0gdGhpcy5nZXRMaWJyYXJ5RWxlbWVudHMob3B0aW9ucyk7XG5cblxuICAgIHRoaXMuY3JlYXRlRWxlbWVudHNMaXN0KCRlbCwgbGlicmFyeSk7XG5cbiAgICBfLmVhY2gobGlicmFyeSwgZnVuY3Rpb24gKGxpYnJhcnlJdGVtKSB7XG4gICAgICB2YXIgaW1nID0gbmV3IEltYWdlKCk7XG4gICAgICBpbWcuc3JjID0gZmFicmljLnV0aWwubWVkaWFSb290ICsgbGlicmFyeUl0ZW0uc3JjO1xuXG4gICAgICB2YXIgJGltZyA9ICQoaW1nKS53aWR0aCgxMDApLmhlaWdodCgxMDApXG4gICAgICAgIC5jbGljayhmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICB2YXIgc2VsZWN0ZWREYXRhID0ge1xuICAgICAgICAgICAgaW1hZ2U6IGltZyxcbiAgICAgICAgICAgIGRhdGE6IGxpYnJhcnlJdGVtLFxuICAgICAgICAgICAgb3B0aW9uczogb3B0aW9uc1xuICAgICAgICAgIH07XG4gICAgICAgICAgdGFyZ2V0LnNldEVsZW1lbnRGcm9tTWVudShzZWxlY3RlZERhdGEpO1xuICAgICAgICB9KTtcblxuICAgICAgJGVsLmFwcGVuZCgkaW1nKTtcbiAgICB9KTtcbiAgfSwqL1xuICBnZXRGb250c0xpYnJhcnk6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gXy5tYXAodGhpcy5fZm9udHMsZnVuY3Rpb24oZm9udE5hbWUpe1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZm9udEZhbWlseTogZm9udE5hbWUsXG4gICAgICAgIGZvbnRTaXplOiAyNSxcbiAgICAgICAgY2F0ZWdvcnk6IFwiZm9udEZhbWlseVwiLFxuICAgICAgICB0ZXh0OiBmb250TmFtZSxcbiAgICAgICAgdHlwZTogXCJ0ZXh0XCJcbiAgICAgIH1cbiAgICB9KVxuICB9LFxuICBfYWRkQ2FudmFzRWw6IGZ1bmN0aW9uIChlbCwgZWxlbWVudCwkaW5uZXJFbCl7XG5cbiAgICAvLyBlbGVtZW50ID0gZmFicmljLnV0aWwub2JqZWN0LmNsb25lRGVlcChlbGVtZW50KTtcblxuICAgIHZhciBjYW52YXNFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIik7XG4gICAgY2FudmFzRWwud2lkdGggPSAxNTY7XG4gICAgY2FudmFzRWwuaGVpZ2h0ID0gODY7XG5cbiAgICB2YXIgX2Zha2VfY2FudmFzID0gbmV3IGZhYnJpYy5TdGF0aWNDYW52YXMoY2FudmFzRWwse2FwcGxpY2F0aW9uOiB0aGlzfSk7XG4gICAgX2Zha2VfY2FudmFzLmNsZWFyKCk7XG5cbiAgICBlbGVtZW50LnBvc2l0aW9uID0gXCJjZW50ZXJcIjtcblxuICAgIF9mYWtlX2NhbnZhcy5jcmVhdGVPYmplY3QoZWxlbWVudCxmdW5jdGlvbihfb2JqZWN0KXtcbiAgICAgIHZhciBiID0gX29iamVjdC5nZXRCb3VuZGluZ1JlY3QoKTtcbiAgICAgLyogX29iamVjdC5zZXQoe1xuICAgICAgICBsZWZ0IDogODAgLSBiLndpZHRoLzIgLSBfb2JqZWN0LnN0cm9rZVdpZHRoICogMixcbiAgICAgICAgdG9wIDogNDUgLSBiLmhlaWdodC8yIC0gX29iamVjdC5zdHJva2VXaWR0aCAqIDJcbiAgICAgIH0pOyovXG5cbiAgICAgIGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZWxlbWVudCx7XG4gICAgICAgIHNjYWxlWDogX29iamVjdC5zY2FsZVgsXG4gICAgICAgIHNjYWxlWTogX29iamVjdC5zY2FsZVksXG4gICAgICAgIHdpZHRoOiBfb2JqZWN0LndpZHRoLFxuICAgICAgICBoZWlnaHQ6IF9vYmplY3QuaGVpZ2h0LFxuICAgICAgICBsZWZ0OiBfb2JqZWN0LmxlZnQsXG4gICAgICAgIHRvcDogX29iamVjdC50b3AsXG4gICAgICAgIHN0cm9rZVdpZHRoOiBfb2JqZWN0LnN0cm9rZVdpZHRoXG4gICAgICB9KTtcblxuICAgICAgZGVsZXRlIGVsZW1lbnQucG9zaXRpb247XG5cbiAgICAgIF9mYWtlX2NhbnZhcy5hZGQoX29iamVjdCk7XG4gICAgICBfZmFrZV9jYW52YXMucmVuZGVyQWxsKCk7XG5cbiAgICAgICRpbm5lckVsWzBdLnNyYyA9IGNhbnZhc0VsLnRvRGF0YVVSTCgpO1xuXG4gICAgICBkZWxldGUgX29iamVjdC5jYW52YXM7XG4gICAgICBlbFswXS5kYXRhID0gZWxlbWVudDtcbiAgICAgIGVsWzBdLmVsZW1lbnQgPSBfb2JqZWN0O1xuXG4gICAgfSk7XG4gIH0sXG4gIHVwZGF0ZUVsZW1lbnRzTGlzdDogZnVuY3Rpb24gKCRlbCwgbGlicmFyeSwgb3B0aW9ucykge1xuXG4gICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgZm9yICh2YXIgaSBpbiBsaWJyYXJ5KSB7XG4gICAgICB2YXIgZWxlbWVudCA9IGxpYnJhcnlbaV07XG4gICAgICB2YXIgZWwgPSAkKFwiPHNwYW4+XCIpXG4gICAgICAgIC5hZGRDbGFzcyhcImxpc3QtaXRlbVwiKTtcblxuICAgICAgZWxbMF0uZGF0YSA9IGVsZW1lbnQ7XG5cbiAgICAgIGlmIChvcHRpb25zLmVsZW1lbnQpIHtcbiAgICAgICAgZWxlbWVudCA9IG9wdGlvbnMuZWxlbWVudChlbGVtZW50KTtcbiAgICAgIH1cblxuICAgICAgaWYgKGVsZW1lbnQudGl0bGUpIHtcbiAgICAgICAgdmFyICRzcGFuID0gJChcIjxzcGFuPlwiKS50ZXh0KGVsZW1lbnQudGl0bGUpLmFkZENsYXNzKFwiZWxlbWVudC10aXRsZVwiKTtcbiAgICAgICAgZWwuYXBwZW5kKCRzcGFuKTtcbiAgICAgIH1cbiAgICAgIHZhciAkaW5uZXJFbCA9IG51bGw7XG5cbiAgICAgIGlmIChvcHRpb25zLnJlbmRlcikge1xuICAgICAgICAkaW5uZXJFbCA9IG9wdGlvbnMucmVuZGVyKGVsZW1lbnQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKGVsZW1lbnQuY2F0ZWdvcnkgPT0gXCJmb250RmFtaWx5XCIpIHtcbiAgICAgICAgICAkaW5uZXJFbCA9ICQoXCI8c3Bhbj5cIikuY3NzKHtcbiAgICAgICAgICAgIFwiY29sb3JcIjogZWxlbWVudC5maWxsIHx8IGZhYnJpYy5UZXh0LnByb3RvdHlwZS5maWxsLFxuICAgICAgICAgICAgXCJmb250LWZhbWlseVwiOiBlbGVtZW50LmZvbnRGYW1pbHksXG4gICAgICAgICAgICBcImZvbnQtc2l6ZVwiOiBlbGVtZW50LmZvbnRTaXplXG4gICAgICAgICAgfSkudGV4dChlbGVtZW50LnRleHQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHN3aXRjaCAoZWxlbWVudC50eXBlKSB7XG4gICAgICAgICAgICBjYXNlIFwiaW1hZ2VcIjpcbiAgICAgICAgICAgICAgJGlubmVyRWwgPSAkKFwiPGltZz5cIikuYXR0cih7XG4gICAgICAgICAgICAgICAgc3JjOiBmYWJyaWMudXRpbC5tZWRpYVJvb3QgKyBlbGVtZW50LnNyY1xuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgZWxbMF0uZWxlbWVudCA9ICRpbm5lckVsWzBdO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgXCJ2aWRlb1wiOlxuICAgICAgICAgICAgICAkaW5uZXJFbCA9ICQoXCI8dmlkZW8+XCIpO1xuICAgICAgICAgICAgICBmb3IgKHZhciB0eXBlIGluIGVsZW1lbnQuc3JjKSB7XG4gICAgICAgICAgICAgICAgJGlubmVyRWwuYXBwZW5kKCQoXCI8c291cmNlPlwiKS5hdHRyKHtcbiAgICAgICAgICAgICAgICAgIHNyYzogZmFicmljLnV0aWwubWVkaWFSb290ICsgZWxlbWVudC5zcmNbdHlwZV0sXG4gICAgICAgICAgICAgICAgICB0eXBlOiB0eXBlXG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGVsWzBdLmVsZW1lbnQgPSAkaW5uZXJFbFswXTtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAkaW5uZXJFbCA9ICQoXCI8aW1nIHdpZHRoPTE2MCBoZWlnaHQ9OTA+XCIpO1xuICAgICAgICAgICAgICB0aGlzLl9hZGRDYW52YXNFbChlbCwgZWxlbWVudCwgJGlubmVyRWwpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKCRpbm5lckVsLmNvbnN0cnVjdG9yID09IEFycmF5KSB7XG4gICAgICAgIHZhciBfc3BhbiA9ICQoXCI8c3Bhbj5cIik7XG4gICAgICAgIF9zcGFuLmFwcGVuZCgkaW5uZXJFbCk7XG4gICAgICAgICRpbm5lckVsID0gX3NwYW47XG4gICAgICB9XG4gICAgICBlbC5hcHBlbmQoJGlubmVyRWwpO1xuXG5cbiAgICAgIGlmIChvcHRpb25zLmRyYWdnYWJsZSkge1xuICAgICAgICAkaW5uZXJFbC5kcmFnZ2FibGUoe1xuICAgICAgICAgIGRyYWdnYWJsZTogXCJoZWxwZXJcIixcbiAgICAgICAgICBkcm9wcGFibGU6IFwiLmNhbnZhcy1jb250YWluZXJcIixcbiAgICAgICAgICBuZ01vZGVsOiBlbGVtZW50LFxuICAgICAgICAgIG9uTW92ZTogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGFwcC5jYW52YXMuX29uRHJhZ01vdmUgJiYgYXBwLmNhbnZhcy5fb25EcmFnTW92ZShkYXRhLiRldmVudCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBvbkRyb3A6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICBhcHAuY2FudmFzLl9vbkRyb3AoZGF0YS4kZXZlbnQpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZHJhZ2dhYmxlQXJlYTogYXBwLmRyYWdnYWJsZUFyZWFcbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICAgICRpbm5lckVsLmNsaWNrKG9wdGlvbnMuYWN0aXZhdGUuYmluZCh0aGlzLCBlbFswXSkpO1xuICAgICAgJGVsLmFwcGVuZChlbCk7XG4gICAgfVxuICB9LFxuICBjcmVhdGVFbGVtZW50c0xpc3Q6IGZ1bmN0aW9uICgkZWwsIGxpYnJhcnksIG9wdGlvbnMpIHtcbiAgICBvcHRpb25zID0gZmFicmljLnV0aWwub2JqZWN0LmRlZmF1bHRzKG9wdGlvbnMgfHwge30sIHtcbiAgICAgIGRyYWdnYWJsZTogdHJ1ZSxcbiAgICAgIGFjdGl2YXRlOiBmdW5jdGlvbiAoZWwpIHtcbiAgICAgICAgaWYgKHRoaXMudGFyZ2V0ICYmIHRoaXMudGFyZ2V0LnNldEVsZW1lbnQpIHtcbiAgICAgICAgICB0aGlzLnRhcmdldC5zZXRFbGVtZW50KGVsLmRhdGEpO1xuICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgdGhpcy5jYW52YXMuY3JlYXRlT2JqZWN0KGZhYnJpYy51dGlsLm9iamVjdC5kZWVwRXh0ZW5kKHtcbiAgICAgICAgICAgIHBvc2l0aW9uOiBcImNlbnRlclwiXG4gICAgICAgICAgfSwgZWwuZGF0YSkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gICAgdGhpcy51cGRhdGVFbGVtZW50c0xpc3QoJGVsLCBsaWJyYXJ5LCBvcHRpb25zKTtcbiAgfVxufSk7XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL21vZHVsZXMvZ2FsbGVyeS5qc1xuLy8gbW9kdWxlIGlkID0gMzVcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiJ3VzZSBzdHJpY3QnO1xuXG52YXIgSGlzdG9yeSA9IHJlcXVpcmUoJy4vLi4vcGx1Z2lucy9oaXN0b3J5Jyk7XG5cbkhpc3RvcnkucHJvdG90eXBlLmluc2VydFJlY29yZHMgPSBmYWxzZTtcbkhpc3RvcnkucHJvdG90eXBlLmFjdGlvbnMgPSB7XG4gIHVuZG86IHtcbiAgICBrZXlDb2RlOiAneicsXG4gICAgY3RybEtleTogIHRydWUsXG4gICAgb2JzZXJ2ZTogJ2NoYW5nZWQnLFxuICAgIGNsYXNzTmFtZTogJ2ZhIGZhLXVuZG8nLFxuICAgIHRpdGxlOiAndW5kbycsXG4gICAgZW5hYmxlZDogJ2NhblVuZG8nLFxuICAgIGFjdGlvbjogZnVuY3Rpb24oKXtcbiAgICAgIHRoaXMudW5kbygpO1xuICAgIH1cbiAgfSxcbiAgcmVjb3Jkczoge1xuICAgIHRpdGxlOiAgICAgICAgICBcInJlY29yZHNcIixcbiAgICBpdGVtQ2xhc3NOYW1lOiAgXCJmaWx0ZXJzLXNlbGVjdG9yXCIsXG4gICAgY2xhc3NOYW1lOiAgICAgIFwiZmEgZmEtaGlzdG9yeVwiLFxuICAgIHR5cGU6ICAgICAgICAgICBcInNlbGVjdFwiLFxuICAgIHRlbXBsYXRlU2VsZWN0aW9uOiBmdW5jdGlvbihzdGF0ZSwgY29udGFpbmVyKSB7XG4gICAgICBpZiAoc3RhdGUuYW55KSB7XG4gICAgICAgIHJldHVybiBzdGF0ZS50ZXh0O1xuICAgICAgfVxuICAgICAgcmV0dXJuICQoJzxzcGFuPicgKyBzdGF0ZS5pZCArIFwiOlwiICsgc3RhdGUudHlwZSArICc8L3NwYW4+Jyk7XG4gICAgfSxcbiAgICB0ZW1wbGF0ZVJlc3VsdDogZnVuY3Rpb24oc3RhdGUsIGNvbnRhaW5lcixkYXRhKSB7XG4gICAgICBpZighc3RhdGUudHlwZSlyZXR1cm47XG4gICAgICB2YXIgX2tleXMgPSBzdGF0ZS5vcmlnaW5hbFN0YXRlICYmIE9iamVjdC5rZXlzKHN0YXRlLm9yaWdpbmFsU3RhdGUpLmpvaW4oJywnKSB8fCAnJztcbiAgICAgIHZhciB0eXBlID0gc3RhdGUub2JqZWN0ICYmIHN0YXRlLm9iamVjdC50eXBlIHx8ICcnO1xuICAgICAgcmV0dXJuICQoXCI8c3Bhbj57aWR9Ont0eXBlfSh7b3R5cGV9IHtrZXlzfSk8L3NwYW4+XCIuZm9ybWF0KGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoe2tleXMgOiBfa2V5cywgb3R5cGU6IHR5cGV9LHN0YXRlKSkpO1xuICAgICAgLy8gaWYoc3RhdGUuaWQgIT0gXCJub25lXCIpe1xuICAgICAgLy8gICB2YXIgJGNhbnZhcyA9ICQoJzxjYW52YXM+Jyk7XG4gICAgICAvLyAgICRlbC5wcmVwZW5kKCRjYW52YXMpO1xuICAgICAgLy8gfVxuICAgICAgLy8gcmV0dXJuICRlbDtcbiAgICB9LFxuICAgIHZhbHVlOiAgICAgIHtcbiAgICAgIG9ic2VydmU6ICdjaGFuZ2VkJyxcbiAgICAgIHNldCA6IGZ1bmN0aW9uKHZhbCxmaWx0ZXJzRGF0YSl7XG4gICAgICAgIHRoaXMuZ290byh2YWwpO1xuICAgICAgfSxcbiAgICAgIGdldDogZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuIHRoaXMucmVjb3Jkc1t0aGlzLmN1cnJlbnRdLmlkO1xuICAgICAgfSxcbiAgICAgIG9wdGlvbnM6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiB0aGlzLnJlY29yZHM7XG4gICAgICB9XG4gICAgfVxuICB9LFxuICByZWRvOiB7XG4gICAga2V5Q29kZTogJ3knLFxuICAgIGN0cmxLZXk6ICB0cnVlLFxuICAgIG9ic2VydmU6ICdjaGFuZ2VkJyxcbiAgICBjbGFzc05hbWU6ICdmYSBmYS1yZXBlYXQnLFxuICAgIHRpdGxlOiAncmVkbycsXG4gICAgZW5hYmxlZDogJ2NhblJlZG8nLFxuICAgIGFjdGlvbjogZnVuY3Rpb24oKXtcbiAgICAgIHRoaXMucmVkbygpO1xuICAgIH1cbiAgfVxufTtcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuU2xpZGVDYW52YXMucHJvdG90eXBlLmFjdGlvbnMsIHtcbiAgaGlzdG9yeToge1xuICAgIHRpdGxlOiAnaGlzdG9yeScsXG4gICAgdHlwZTogJ21lbnUnLFxuICAgIHRhcmdldDogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuaGlzdG9yeTtcbiAgICB9LFxuICAgIG1lbnU6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLmFjdGlvbnM7XG4gICAgfVxuICB9XG59KTtcblxuXG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLkNhbnZhcy5wcm90b3R5cGUsIHtcbiAgaW5zZXJ0SGlzdG9yeTogZmFsc2UsXG4gIG9uT2JqZWN0TW9kaWZpZWQ6IGZ1bmN0aW9uIChlKSB7XG4gICAgaWYgKCF0aGlzLmhpc3RvcnkuZW5hYmxlZCB8fCB0aGlzLnByb2Nlc3NpbmcgfHwgdGhpcy5oaXN0b3J5LnByb2Nlc3NpbmcpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgdmFyIF9jYW52YXMgPSBlLnRhcmdldC5jYW52YXMgfHwgZS50YXJnZXQud3JhcHBlckVsICYmIGUudGFyZ2V0O1xuXG4gICAgdGhpcy5oaXN0b3J5LmFkZCh7XG4gICAgICBjYW52YXM6ICBlLnRhcmdldC5jYW52YXMub3JpZ2luYWxTbGlkZSB8fCBlLnRhcmdldC5jYW52YXMsXG4gICAgICBvcmlnaW5hbFN0YXRlOiAgZS5zdGF0ZXMub3JpZ2luYWwsXG4gICAgICBtb2RpZmllZFN0YXRlOiAgZS5zdGF0ZXMubW9kaWZpZWQsXG4gICAgICBvYmplY3Q6IGUudGFyZ2V0LFxuICAgICAgdHlwZTogJ29iamVjdDptb2RpZmllZCcsXG4gICAgICB1bmRvOiBmdW5jdGlvbiAoX2FjdGlvbikge1xuICAgICAgICBfYWN0aW9uLm9iamVjdC5zZXQoX2FjdGlvbi5vcmlnaW5hbFN0YXRlKTtcbiAgICAgICAgaWYoX2FjdGlvbi5jYW52YXMubWlycm9yU2xpZGUgPT0gdGhpcy5jYW52YXMpe1xuICAgICAgICAgIF9hY3Rpb24ub2JqZWN0LnNldENvb3JkcygpO1xuICAgICAgICAgIHZhciBfY2FudmFzID0gdGhpcy5jYW52YXMgfHwgdGhpcztcbiAgICAgICAgICBfY2FudmFzLnJlbmRlckFsbCgpO1xuICAgICAgICB9XG4gICAgICAgIF9hY3Rpb24uY2FudmFzLmZpcmUoJ29iamVjdDptb2RpZmllZCcsIHsgdGFyZ2V0OiBfYWN0aW9uLm9iamVjdCB9KTtcbiAgICAgICAgX2FjdGlvbi5vYmplY3QuZmlyZSgnbW9kaWZpZWQnKTtcbiAgICAgICAgX2FjdGlvbi5jYW52YXMucmVuZGVyQWxsKCk7XG4gICAgICB9LFxuICAgICAgcmVkbzogZnVuY3Rpb24gKF9hY3Rpb24pIHtcbiAgICAgICAgX2FjdGlvbi5vYmplY3Quc2V0KF9hY3Rpb24ubW9kaWZpZWRTdGF0ZSk7XG4gICAgICAgIF9hY3Rpb24ub2JqZWN0LnNldENvb3JkcygpO1xuICAgICAgICBpZihfYWN0aW9uLmNhbnZhcy5taXJyb3JTbGlkZSA9PSB0aGlzLmNhbnZhcyl7XG4gICAgICAgICAgX2FjdGlvbi5vYmplY3Quc2V0Q29vcmRzKCk7XG4gICAgICAgICAgdmFyIF9jYW52YXMgPSB0aGlzLmNhbnZhcyB8fCB0aGlzO1xuICAgICAgICAgIF9jYW52YXMucmVuZGVyQWxsKCk7XG4gICAgICAgIH1cbiAgICAgICAgX2FjdGlvbi5jYW52YXMuZmlyZSgnb2JqZWN0Om1vZGlmaWVkJywgeyB0YXJnZXQ6IF9hY3Rpb24ub2JqZWN0IH0pO1xuICAgICAgICBfYWN0aW9uLm9iamVjdC5maXJlKCdtb2RpZmllZCcpO1xuICAgICAgICBfYWN0aW9uLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSxcbiAgY2xlYXJIaXN0b3J5OiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5oaXN0b3J5LmNsZWFyKCk7XG4gIH0sXG4gIGRpc2FibGVIaXN0b3J5OiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5oaXN0b3J5LmVuYWJsZWQgPSBmYWxzZTtcbiAgfSxcbiAgX2FkZF9vYmplY3RfaGlzdG9yeV9hY3Rpb246IGZ1bmN0aW9uIChfYWN0aW9uKSB7XG4gICAgdmFyIF9jYW52YXMgPSB0aGlzLmNhbnZhcyB8fCB0aGlzO1xuICAgIGlmKHRoaXMuY2FudmFzICYmIF9hY3Rpb24uY2FudmFzLm1pcnJvclNsaWRlID09IHRoaXMuY2FudmFzKXtcbiAgICAgIF9jYW52YXMuYWRkKF9hY3Rpb24ub2JqZWN0KTtcbiAgICAgIF9jYW52YXMuc2V0QWN0aXZlT2JqZWN0KF9hY3Rpb24ub2JqZWN0KTtcbiAgICAgIF9jYW52YXMucmVuZGVyQWxsKCk7XG4gICAgfWVsc2V7XG4gICAgICBfYWN0aW9uLmNhbnZhcy5hZGQoX2FjdGlvbi5vYmplY3QpO1xuICAgIH1cbiAgICBfYWN0aW9uLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgfSxcblxuICBfcmVtb3ZlX29iamVjdF9oaXN0b3J5X2FjdGlvbjogZnVuY3Rpb24gKF9hY3Rpb24pIHtcbiAgICBfYWN0aW9uLmNhbnZhcy5yZW1vdmUoX2FjdGlvbi5vYmplY3QpO1xuICAgIF9hY3Rpb24uY2FudmFzLnJlbmRlckFsbCgpO1xuICAgIGlmKHRoaXMuY2FudmFzICYmIF9hY3Rpb24uY2FudmFzLm1pcnJvclNsaWRlID09IHRoaXMuY2FudmFzKXtcbiAgICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgIH1cbiAgfSxcblxuICBvbk9iamVjdFJlbW92ZWQ6IGZ1bmN0aW9uIChlKSB7XG4gICAgaWYgKCF0aGlzLmhpc3RvcnkuZW5hYmxlZCB8fCB0aGlzLnByb2Nlc3NpbmcgfHwgdGhpcy5oaXN0b3J5LnByb2Nlc3NpbmcpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgdGhpcy5oaXN0b3J5LmFkZCh7XG4gICAgICBjYW52YXM6IGUudGFyZ2V0LmNhbnZhcy5vcmlnaW5hbFNsaWRlIHx8IGUudGFyZ2V0LmNhbnZhcyxcbiAgICAgIG9iamVjdDogZS50YXJnZXQsXG4gICAgICB0eXBlOiAnb2JqZWN0OnJlbW92ZWQnLFxuICAgICAgcmVkbzogdGhpcy5fcmVtb3ZlX29iamVjdF9oaXN0b3J5X2FjdGlvbixcbiAgICAgIHVuZG86IHRoaXMuX2FkZF9vYmplY3RfaGlzdG9yeV9hY3Rpb25cbiAgICB9KTtcbiAgfSxcbiAgb25EcmF3QWZ0ZXI6IGZ1bmN0aW9uKGV2ZW50KXtcbiAgICBpZiAoIXRoaXMuaGlzdG9yeS5lbmFibGVkIHx8IHRoaXMucHJvY2Vzc2luZyB8fCB0aGlzLmhpc3RvcnkucHJvY2Vzc2luZykge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICB0aGlzLmhpc3RvcnkuYWRkKHRoaXMuZnJlZURyYXdpbmdCcnVzaC5nZXRIaXN0b3J5UmVjb3JkKGV2ZW50KSlcbiAgfSxcbiAgb25PYmplY3RBZGRlZDogZnVuY3Rpb24gKGUpIHtcbiAgICBpZiAoIXRoaXMuaGlzdG9yeS5lbmFibGVkIHx8IHRoaXMucHJvY2Vzc2luZyB8fCB0aGlzLmhpc3RvcnkucHJvY2Vzc2luZykge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICB0aGlzLmhpc3RvcnkuYWRkKHtcbiAgICAgIGNhbnZhczogIGUudGFyZ2V0LmNhbnZhcy5vcmlnaW5hbFNsaWRlIHx8IGUudGFyZ2V0LmNhbnZhcyxcbiAgICAgIG9iamVjdDogZS50YXJnZXQsXG4gICAgICB0eXBlOiAnb2JqZWN0OmFkZGVkJyxcbiAgICAgIHVuZG86IHRoaXMuX3JlbW92ZV9vYmplY3RfaGlzdG9yeV9hY3Rpb24sXG4gICAgICByZWRvOiB0aGlzLl9hZGRfb2JqZWN0X2hpc3RvcnlfYWN0aW9uXG4gICAgfSk7XG4gIH0sXG4gIGluaXRIaXN0b3J5OiBmdW5jdGlvbiAoaGlzdG9yeSkge1xuICAgIGlmKCFoaXN0b3J5KXtcbiAgICAgIGhpc3RvcnkgPSBuZXcgSGlzdG9yeSh0aGlzKTtcbiAgICAgIGhpc3RvcnkuYXBwbGljYXRpb24gPSB0aGlzLmFwcGxpY2F0aW9uO1xuICAgIH1cblxuICAgIHRoaXMuaGlzdG9yeSA9IGhpc3Rvcnk7XG4gICAgdGhpcy5vbih7XG4gICAgICAnbG9hZGluZzpiZWdpbic6ICAgIHRoaXMuY2xlYXJIaXN0b3J5LFxuICAgICAgJ2RyYXc6YWZ0ZXInOiAgICAgICB0aGlzLm9uRHJhd0FmdGVyLFxuICAgICAgJ29iamVjdDptb2RpZmllZCc6ICB0aGlzLm9uT2JqZWN0TW9kaWZpZWQsXG4gICAgICAnb2JqZWN0OmFkZGVkJzogICAgIHRoaXMub25PYmplY3RBZGRlZCxcbiAgICAgICdvYmplY3Q6cmVtb3ZlZCc6ICAgdGhpcy5vbk9iamVjdFJlbW92ZWRcbiAgICB9KTtcblxuICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgdGhpcy5oaXN0b3J5Lm9uKCdjaGFuZ2VkJywgZnVuY3Rpb24oZSl7XG4gICAgICBpZih0aGlzLmFjdGl2ZUFjdGlvbi5jYW52YXMpe1xuICAgICAgICB0aGlzLmFjdGl2ZUFjdGlvbi5jYW52YXMubW9tZW50ID0gZS5hY3Rpb24ubW9tZW50O1xuICAgICAgfVxuICAgIH0pO1xuICAgIHZhciBwcm90byA9IHRoaXMuYXBwbGljYXRpb24ucHJvdG90eXBlcy5IaXN0b3J5O1xuICAgIGlmKHByb3RvKXtcbiAgICAgIGlmKHByb3RvLmV2ZW50TGlzdGVuZXJzKXtcbiAgICAgICAgaGlzdG9yeS5vbihwcm90by5ldmVudExpc3RlbmVycyk7XG4gICAgICB9XG4gICAgfVxuICB9LFxuICBlbmFibGVIaXN0b3J5OiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5oaXN0b3J5LmVuYWJsZWQgPSB0cnVlO1xuICB9XG59KTtcblxuZmFicmljLkhJU1RPUllfT1BUSU9OUyA9IHtcbiAgSU5ESVZJRFVBTDogMCxcbiAgU0hBUkVEOiAxXG59O1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5BcHBsaWNhdGlvbi5wcm90b3R5cGUsIHtcbiAgaGlzdG9yeTogdHJ1ZSxcbiAgc2V0SGlzdG9yeTogZnVuY3Rpb24oaGlzdG9yeU9wdGlvbil7XG5cbiAgICBpZihoaXN0b3J5T3B0aW9uID09PSBmYWJyaWMuSElTVE9SWV9PUFRJT05TLlNIQVJFRCl7XG4gICAgICB0aGlzLmhpc3RvcnkgPSBuZXcgSGlzdG9yeSh0aGlzKTtcbiAgICAgIHRoaXMuZW5hYmxlSGlzdG9yeSgpO1xuXG4gICAgICB0aGlzLm9uKFwicmVhZHlcIixmdW5jdGlvbigpe1xuICAgICAgICBpZiAodGhpcy5jYW52YXMpIHtcbiAgICAgICAgICB0aGlzLmNhbnZhcy5pbml0SGlzdG9yeSh0aGlzLmhpc3RvcnkpO1xuICAgICAgICB9XG4gICAgICB9KVxuXG4gICAgfVxuICAgIGlmKGhpc3RvcnlPcHRpb24gPT09IGZhYnJpYy5ISVNUT1JZX09QVElPTlMuSU5ESVZJRFVBTCl7XG4gICAgICAvL3RvZG8gdW5zdXBwb3J0ZWRcbiAgICB9XG5cbiAgfSxcbiAgYWN0aW9uczogZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuQXBwbGljYXRpb24ucHJvdG90eXBlLmFjdGlvbnMse1xuICAgIGhpc3Rvcnk6IHtcbiAgICAgIGluc2VydDogJ2hpc3RvcnlUb29scycsXG4gICAgICB0aXRsZTogJ2hpc3RvcnknLFxuICAgICAgdHlwZTogJ21lbnUnLFxuICAgICAgdGFyZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmhpc3Rvcnk7XG4gICAgICB9LFxuICAgICAgbWVudTogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5hY3Rpb25zO1xuICAgICAgfVxuICAgIH1cbiAgfSksXG4gIF9kZWZhdWx0X2V2ZW50X2xpc3RlbmVycyA6IHtcbiAgICBcInNsaWRlOmNoYW5nZTpiZWdpblwiIDogZnVuY3Rpb24oKXtcbiAgICAgIHRoaXMucHJvY2Vzc2luZyA9IHRydWUgO1xuICAgICAgaWYodGhpcy5oaXN0b3J5KXtcbiAgICAgICAgdGhpcy5oaXN0b3J5LnByb2Nlc3NpbmcgPSB0cnVlIDtcbiAgICAgIH1cbiAgICB9LFxuICAgIFwic2xpZGU6Y2hhbmdlZFwiIDogZnVuY3Rpb24oKXtcbiAgICAgIHRoaXMucHJvY2Vzc2luZyA9IGZhbHNlO1xuICAgICAgaWYodGhpcy5oaXN0b3J5KXtcbiAgICAgICAgdGhpcy5oaXN0b3J5LnByb2Nlc3NpbmcgPSBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIGhpc3RvcnlUb29sczogZmFsc2UsXG4gIGVuYWJsZUhpc3Rvcnk6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmhpc3RvcnkuZW5hYmxlZCA9IHRydWU7XG4gIH1cbn0pO1xuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9tb2R1bGVzL2hpc3RvcnkuanNcbi8vIG1vZHVsZSBpZCA9IDM2XG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIid1c2Ugc3RyaWN0Jztcblxue1xuXG4gIC8qXG4gICBmYWJyaWMuSW1hZ2UuZmlsdGVycy5SZWRpZnkgPSBmYWJyaWMudXRpbC5jcmVhdGVDbGFzcyhmYWJyaWMuSW1hZ2UuZmlsdGVycy5CYXNlRmlsdGVyLCB7XG4gICB0eXBlOiAnUmVkaWZ5JyxcbiAgIGFwcGx5VG86IGZ1bmN0aW9uIChjYW52YXNFbCkge1xuICAgdmFyIGNvbnRleHQgPSBjYW52YXNFbC5nZXRDb250ZXh0KCcyZCcpLFxuICAgaW1hZ2VEYXRhID0gY29udGV4dC5nZXRJbWFnZURhdGEoMCwgMCxcbiAgIGNhbnZhc0VsLndpZHRoLCBjYW52YXNFbC5oZWlnaHQpLFxuICAgZGF0YSA9IGltYWdlRGF0YS5kYXRhO1xuICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IGRhdGEubGVuZ3RoOyBpIDwgbGVuOyBpICs9IDQpIHtcbiAgIGRhdGFbaSArIDFdID0gMDtcbiAgIGRhdGFbaSArIDJdID0gMDtcbiAgIH1cbiAgIGNvbnRleHQucHV0SW1hZ2VEYXRhKGltYWdlRGF0YSwgMCwgMCk7XG4gICB9XG4gICB9KTtcbiAgIGZhYnJpYy5JbWFnZS5maWx0ZXJzLlJlZGlmeS5mcm9tT2JqZWN0ID0gZnVuY3Rpb24gKG9iamVjdCkge1xuICAgcmV0dXJuIG5ldyBmYWJyaWMuSW1hZ2UuZmlsdGVycy5SZWRpZnkob2JqZWN0KTtcbiAgIH07XG4gICAqL1xuXG4gIGZhYnJpYy5JbWFnZS5maWx0ZXJzLlNoYXJwZW4gPSBmYWJyaWMudXRpbC5jcmVhdGVDbGFzcyhmYWJyaWMuSW1hZ2UuZmlsdGVycy5Db252b2x1dGUsIHtcbiAgICB0eXBlOiAnU2hhcnBlbicsXG4gICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwgeyB9O1xuXG4gICAgICB0aGlzLm9wYXF1ZSA9IG9wdGlvbnMub3BhcXVlO1xuICAgICAgdGhpcy5tYXRyaXggPSBvcHRpb25zLm1hdHJpeCB8fCBbXG4gICAgICAgICAgMCwgLTEsIDAsXG4gICAgICAgICAgLTEsIDUsIC0xLFxuICAgICAgICAgIDAsIC0xLCAwXG4gICAgICAgIF07XG4gICAgfVxuICB9KTtcbiAgZmFicmljLkltYWdlLmZpbHRlcnMuU2hhcnBlbi5mcm9tT2JqZWN0ID0gZnVuY3Rpb24gKG9iamVjdCkge1xuICAgIHJldHVybiBuZXcgZmFicmljLkltYWdlLmZpbHRlcnMuU2hhcnBlbihvYmplY3QpO1xuICB9O1xuXG4gIGZhYnJpYy5JbWFnZS5maWx0ZXJzLkJsdXIgPSBmYWJyaWMudXRpbC5jcmVhdGVDbGFzcyhmYWJyaWMuSW1hZ2UuZmlsdGVycy5Db252b2x1dGUsIHtcbiAgICB0eXBlOiAnQmx1cicsXG4gICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwgeyB9O1xuXG4gICAgICB2YXIgX3YgPSAxIC8gOTtcbiAgICAgIHRoaXMub3BhcXVlID0gb3B0aW9ucy5vcGFxdWU7XG4gICAgICB0aGlzLm1hdHJpeCA9IG9wdGlvbnMubWF0cml4IHx8IFtcbiAgICAgICAgICBfdiwgX3YsIF92LFxuICAgICAgICAgIF92LCBfdiwgX3YsXG4gICAgICAgICAgX3YsIF92LCBfdlxuICAgICAgICBdO1xuICAgIH1cbiAgfSk7XG4gIGZhYnJpYy5JbWFnZS5maWx0ZXJzLkJsdXIuZnJvbU9iamVjdCA9IGZ1bmN0aW9uIChvYmplY3QpIHtcbiAgICByZXR1cm4gbmV3IGZhYnJpYy5JbWFnZS5maWx0ZXJzLkJsdXIob2JqZWN0KTtcbiAgfTtcblxuICBmYWJyaWMuSW1hZ2UuZmlsdGVycy5FbWJvc3MgPSBmYWJyaWMudXRpbC5jcmVhdGVDbGFzcyhmYWJyaWMuSW1hZ2UuZmlsdGVycy5Db252b2x1dGUsIHtcbiAgICB0eXBlOiAnRW1ib3NzJyxcbiAgICBpbml0aWFsaXplOiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7IH07XG5cbiAgICAgIHRoaXMub3BhcXVlID0gb3B0aW9ucy5vcGFxdWU7XG4gICAgICB0aGlzLm1hdHJpeCA9IG9wdGlvbnMubWF0cml4IHx8IFtcbiAgICAgICAgICAxLCAgIDEsICAgMSxcbiAgICAgICAgICAxLCAwLjcsICAtMSxcbiAgICAgICAgICAtMSwgIC0xLCAgLTFcbiAgICAgICAgXTtcbiAgICB9XG4gIH0pO1xuICBmYWJyaWMuSW1hZ2UuZmlsdGVycy5FbWJvc3MuZnJvbU9iamVjdCA9IGZ1bmN0aW9uIChvYmplY3QpIHtcbiAgICByZXR1cm4gbmV3IGZhYnJpYy5JbWFnZS5maWx0ZXJzLkVtYm9zcyhvYmplY3QpO1xuICB9O1xuXG5cbiAgZmFicmljLkltYWdlLmZpbHRlcnMuTWFzay5wcm90b3R5cGUubWFza0ZpbHRlciA9IHRydWU7XG5cbiAgdmFyIHByb3RvdHlwZU9wdGlvbnMgPSB7XG4gICAgQnJpZ2h0bmVzczoge1xuICAgICAgXCJicmlnaHRuZXNzXCI6IHt2YWx1ZTogMTAwLCBtaW46IDAsIG1heDogMjU1fVxuICAgIH0sXG4gICAgTm9pc2U6IHtcbiAgICAgIFwibm9pc2VcIjoge3ZhbHVlOiAxMDAsIG1pbjogMCwgbWF4OiAxMDAwfVxuICAgIH0sXG4gICAgQ29udm9sdXRlOiB7XG4gICAgICBcIm9wYXF1ZVwiOiB7dmFsdWU6IHRydWUsIHR5cGU6IFwiYm9vbGVhblwiIH0sXG4gICAgICBcIm1hdHJpeFwiOiB7dmFsdWU6IFsxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxXSwgdHlwZTogXCJtYXRyaXhcIiB9XG4gICAgfSxcbiAgICBCbHVyOiB7fSxcbiAgICBTaGFycGVuOiB7fSxcbiAgICBFbWJvc3M6IHt9LFxuICAgIE11bHRpcGx5OiB7XG4gICAgICBcImNvbG9yXCI6IHt0eXBlOiAnY29sb3InLCB2YWx1ZTogXCIjRjBGXCJ9XG4gICAgfSxcbiAgICBQaXhlbGF0ZToge1xuICAgICAgXCJibG9ja3NpemVcIjoge3ZhbHVlOiA0LCBtaW46IDIsIG1heDogMjB9XG4gICAgfSxcbiAgICBUaW50OiB7XG4gICAgICBcImNvbG9yXCI6ICB7dHlwZTogJ2NvbG9yJywgdmFsdWU6IFwiIzM1MTNCMFwifSxcbiAgICAgIFwib3BhY2l0eVwiOiB7dmFsdWU6IDEsIG1pbjogMCwgbWF4OiAxLCBzdGVwOiAwLjF9XG4gICAgfSxcbiAgICBNYXNrOiB7XG4gICAgICBtYXNrOiB7XG4gICAgICAgIHR5cGU6ICdpbWFnZScsXG4gICAgICAgIHZhbHVlOiB7XG4gICAgICAgICAgc3JjOiAgXCJwaG90b3MvZXhwbG9zaW9uLnBuZ1wiXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBjaGFubmVsOiB7IHZhbHVlOiAwfVxuICAgIH0sXG4gICAgQmxlbmQ6IHtcbiAgICAgIFwiY29sb3JcIjoge3R5cGU6ICdjb2xvcicsIHZhbHVlOiBcIiMzNTEzQjBcIn0sXG4gICAgICBcIm1vZGVcIjoge1xuICAgICAgICB2YWx1ZTogXCJhZGRcIixcbiAgICAgICAgb3B0aW9uczogW1xuICAgICAgICAgIHt2YWx1ZTogXCJhZGRcIiwgdGl0bGU6IFwiQWRkXCJ9LFxuICAgICAgICAgIHt2YWx1ZTogXCJkaWZmXCIsIHRpdGxlOiBcIkRpZmZcIn0sXG4gICAgICAgICAge3ZhbHVlOiBcInN1YnRyYWN0XCIsIHRpdGxlOiBcIlN1YnRyYWN0XCJ9LFxuICAgICAgICAgIHt2YWx1ZTogXCJtdWx0aXBseVwiLCB0aXRsZTogXCJNdWx0aXBseVwifSxcbiAgICAgICAgICB7dmFsdWU6IFwic2NyZWVuXCIsIHRpdGxlOiBcIlNjcmVlblwifSxcbiAgICAgICAgICB7dmFsdWU6IFwibGlnaHRlblwiLCB0aXRsZTogXCJMaWdodGVuXCJ9LFxuICAgICAgICAgIHt2YWx1ZTogXCJkYXJrZW5cIiwgdGl0bGU6IFwiRGFya2VuXCJ9XG4gICAgICAgIF1cbiAgICAgIH1cbiAgICB9XG4gIH07XG5cblxuICBmb3IodmFyIGkgaW4gcHJvdG90eXBlT3B0aW9ucyl7XG4gICAgZmFicmljLkltYWdlLmZpbHRlcnNbaV0ucHJvdG90eXBlLm9wdGlvbnMgPSBwcm90b3R5cGVPcHRpb25zW2ldO1xuICB9XG5cblxuXG59XG5cblxuXG5cbmZhYnJpYy5JbWFnZS5nZXRGaWx0ZXJzTGlzdCA9IGZ1bmN0aW9uKGVsKXtcblxuICBlbCA9IGVsIHx8IGZhYnJpYy5JbWFnZS5wcm90b3R5cGU7XG4gIHZhciBmaWx0ZXJMaXN0ID0gW107XG4gIGZvcih2YXIgaSBpbiBlbC5hdmFpbGFibGVGaWx0ZXJzKXtcbiAgICB2YXIgX2YgPSBmYWJyaWMuSW1hZ2UuZmlsdGVyc1tlbC5hdmFpbGFibGVGaWx0ZXJzW2ldXTtcblxuICAgIHZhciBfZGF0YSA9IHtcbiAgICAgIHR5cGU6ICAgICBlbC5hdmFpbGFibGVGaWx0ZXJzW2ldXG4gICAgfTtcbiAgICBpZihfZi5wcm90b3R5cGUuY3VzdG9tKXtcbiAgICAgIGlmKCFlbC5jdXN0b21GaWx0ZXJzKXtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgfVxuICAgIGlmKF9mLnByb3RvdHlwZS5tYXNrRmlsdGVyKXtcbiAgICAgIGlmKCFlbC5tYXNrRmlsdGVyKXtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgfVxuICAgIGlmKF9mLnByb3RvdHlwZS5jYW1hbil7XG4gICAgICBpZighZWwuY2FtYW5GaWx0ZXJzKXtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBfZGF0YS5jYW1hbiA9IHRydWU7XG4gICAgfWVsc2V7XG4gICAgICBpZighZWwuZmFicmljRmlsdGVycyl7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgIH1cbiAgICBpZihfZi5wcm90b3R5cGUub3B0aW9ucyl7XG4gICAgICBfZGF0YS5vcHRpb25zID0gZmFicmljLnV0aWwub2JqZWN0LmNsb25lKF9mLnByb3RvdHlwZS5vcHRpb25zKTtcbiAgICB9XG4gICAgX2RhdGEudGV4dCA9IF9mLnByb3RvdHlwZS50aXRsZSB8fCBlbC5hdmFpbGFibGVGaWx0ZXJzW2ldO1xuXG4gICAgZmlsdGVyTGlzdC5wdXNoKF9kYXRhKVxuICB9XG4gIHJldHVybiBmaWx0ZXJMaXN0O1xufTtcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuSW1hZ2UucHJvdG90eXBlLCB7XG4gIGNhbWFuRmlsdGVyczogZmFsc2UsXG4gIGZhYnJpY0ZpbHRlcnM6IHRydWUsXG4gIGN1c3RvbUZpbHRlcnM6IGZhbHNlLFxuICBtYXNrRmlsdGVyOiBmYWxzZSxcbiAgZ2V0RmlsdGVyc0RhdGEgOiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIF9maWx0ZXJzID0gZmFicmljLkltYWdlLmdldEZpbHRlcnNMaXN0KHRoaXMpO1xuICAgIGZvciAodmFyIGkgaW4gdGhpcy5maWx0ZXJzKSB7XG4gICAgICB2YXIgX2YgPSBmYWJyaWMudXRpbC5vYmplY3QuZmluZFdoZXJlKF9maWx0ZXJzLHt0eXBlOiBmYWJyaWMudXRpbC5zdHJpbmcuY2FwaXRhbGl6ZSh0aGlzLmZpbHRlcnNbaV0udHlwZSl9KVxuICAgICAgaWYoX2Ype1xuICAgICAgICBfZi5lbmFibGVkID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIF9maWx0ZXJzO1xuICB9LFxuICBhdmFpbGFibGVGaWx0ZXJzOiBbXG4gICAgLy9mYWJyaWNKU1xuICAgIFwiR3JheXNjYWxlXCIsXG4gICAgXCJTZXBpYVwiLFxuICAgIFwiU2VwaWEyXCIsXG4gICAgXCJJbnZlcnRcIixcbiAgICBcIkJsdXJcIixcbiAgICBcIlNoYXJwZW5cIixcbiAgICBcIkVtYm9zc1wiLFxuICAgIFwiQmxlbmRcIixcbiAgICBcIlRpbnRcIixcbiAgICBcIk11bHRpcGx5XCIsXG4gICAgLy9cIkNvbnZvbHV0ZVwiLFxuICAgIFwiTm9pc2VcIixcbiAgICBcIkJyaWdodG5lc3NcIixcbiAgICBcIlBpeGVsYXRlXCIsXG4gICAgXCJHcmFkaWVudFRyYW5zcGFyZW5jeVwiLFxuICAgIFwiTWFza1wiXG4gIF0sXG4gIGdldEZpbHRlcjogZnVuY3Rpb24gKGZpbHRlck5hbWUpIHtcbiAgICBmaWx0ZXJOYW1lID0gZmFicmljLnV0aWwuc3RyaW5nLnVuY2FwaXRhbGl6ZShmaWx0ZXJOYW1lKTtcbiAgICBmb3IodmFyIGkgaW4gdGhpcy5maWx0ZXJzKXtcbiAgICAgIGlmKGZhYnJpYy51dGlsLnN0cmluZy51bmNhcGl0YWxpemUodGhpcy5maWx0ZXJzW2ldLnR5cGUpID09PSBmaWx0ZXJOYW1lKXtcbiAgICAgICAgcmV0dXJuIHRoaXMuZmlsdGVyc1tpXTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9LFxuICBzZXRGaWx0ZXI6IGZ1bmN0aW9uIChmaWx0ZXIpIHtcblxuICAgIHZhciBfb2xkX2ZpbHRlciA9IGZhbHNlO1xuICAgIGlmKGZpbHRlci5yZXBsYWNlKXtcbiAgICAgIHRoaXMuZmlsdGVycyA9IFtdO1xuICAgIH1lbHNle1xuICAgICAgX29sZF9maWx0ZXIgPSBmYWJyaWMudXRpbC5vYmplY3QuZmluZFdoZXJlKHRoaXMuZmlsdGVycywge3R5cGU6IGZpbHRlci50eXBlfSk7XG4gICAgICBfb2xkX2ZpbHRlciA9IF9vbGRfZmlsdGVyICYmIF9vbGRfZmlsdGVyLnRvT2JqZWN0KCkgfHwgZmFsc2U7XG4gICAgfVxuXG5cbiAgICBpZihmaWx0ZXIudHlwZSl7XG4gICAgICB2YXIgX3R5cGUgPSBmYWJyaWMudXRpbC5zdHJpbmcuY2FwaXRhbGl6ZShmaWx0ZXIudHlwZSx0cnVlKTtcbiAgICAgIHZhciBfbmV3X2ZpbHRlciA9IGZpbHRlci5vcHRpb25zICYmIGZhYnJpYy51dGlsLm9iamVjdC5jbG9uZShmaWx0ZXIub3B0aW9ucyk7XG5cblxuICAgIH1lbHNle1xuICAgICAgX3R5cGUgPSBmYWxzZTtcbiAgICAgIF9uZXdfZmlsdGVyID0gZmFsc2U7XG4gICAgfVxuXG4gICAgLyogdGhpcy5wcm9qZWN0Lmhpc3RvcnkuYWRkKHtcbiAgICAgZGF0YTogICBbJC5leHRlbmQodHJ1ZSwge30sIHRoaXMuZGF0YSldLFxuICAgICBzbGlkZTogIHRoaXMuc2xpZGUsXG4gICAgIG9iamVjdDogdGhpcyxcbiAgICAgcmVkbzogICBmaWx0ZXIsXG4gICAgIHVuZG86ICAgX29sZF9maWx0ZXIgLFxuICAgICB0eXBlOiAgIFwiZmlsdGVyXCIsXG4gICAgIHVuZG9GbjogZnVuY3Rpb24oYWN0aW9uKXtcbiAgICAgYWN0aW9uLm9iamVjdC5fc2V0X2ZpbHRlcihhY3Rpb24udW5kbyk7XG4gICAgIH0sXG4gICAgIHJlZG9GbjogIGZ1bmN0aW9uKGFjdGlvbil7XG4gICAgIGFjdGlvbi5vYmplY3QuX3NldF9maWx0ZXIoYWN0aW9uLnJlZG8pO1xuICAgICB9XG4gICAgIH0pO1xuICAgICAqL1xuICAgIHRoaXMuX3NldF9maWx0ZXIoX3R5cGUsIF9uZXdfZmlsdGVyLCBfb2xkX2ZpbHRlcik7XG5cbiAgfSxcblxuICBfc2V0X2ZpbHRlcjogZnVuY3Rpb24gKF90eXBlLCBfbmV3X2ZpbHRlcikge1xuXG4gICAgaWYoX3R5cGUpe1xuICAgICAgdmFyIF9vbGRfZmlsdGVyID0gdGhpcy5nZXRGaWx0ZXIoX3R5cGUpO1xuICAgIH1cblxuICAgIGlmIChfb2xkX2ZpbHRlciAmJiBfbmV3X2ZpbHRlcikge1xuICAgICAgZm9yICh2YXIgaSBpbiBfbmV3X2ZpbHRlcikge1xuICAgICAgICBfb2xkX2ZpbHRlcltpXSA9IF9uZXdfZmlsdGVyW2ldO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoX29sZF9maWx0ZXIgJiYgIV9uZXdfZmlsdGVyKSB7XG4gICAgICB0aGlzLmZpbHRlcnMuc3BsaWNlKHRoaXMuZmlsdGVycy5pbmRleE9mKF9vbGRfZmlsdGVyKSwgMSk7XG4gICAgfVxuICAgIGlmICghX29sZF9maWx0ZXIgJiYgX25ld19maWx0ZXIpIHtcbiAgICAgIHRoaXMuZmlsdGVycy5wdXNoKG5ldyBmYWJyaWMuSW1hZ2UuZmlsdGVyc1tfdHlwZV0oX25ld19maWx0ZXIpKTtcbiAgICB9XG4gICAgdGhpcy5hcHBseUZpbHRlcnModGhpcy5jYW52YXMucmVuZGVyQWxsLmJpbmQodGhpcy5jYW52YXMpKTtcbiAgfSxcblxuICBpbnNlcnRJbWFnZUZpbHRlcnM6IGZhbHNlLFxuICBhY3Rpb25zIDogZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuSW1hZ2UucHJvdG90eXBlLmFjdGlvbnMsIHtcbiAgICBpbWFnZUZpbHRlcnM6IHtcbiAgICAgIHRpdGxlOiBcItGE0LjQu9GM0YLRgFwiLFxuICAgICAgaXRlbUNsYXNzTmFtZTogXCJmaWx0ZXJzLXNlbGVjdG9yXCIsXG4gICAgICBjbGFzc05hbWU6IFwiZmEgZmEtZmlsdGVyXCIsXG4gICAgICB0eXBlOiBcInNlbGVjdFwiLFxuICAgICAgdGVtcGxhdGVTZWxlY3Rpb246IGZ1bmN0aW9uIChzdGF0ZSwgY29udGFpbmVyKSB7XG4gICAgICAgIGlmIChzdGF0ZS5hbnkpIHtcbiAgICAgICAgICByZXR1cm4gc3RhdGUudGV4dDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gJCgnPHNwYW4+PHNwYW4gY2xhc3M9XCJjb2xvci1zcGFuXCIgc3R5bGU9XCJiYWNrZ3JvdW5kLWNvbG9yOicgKyBzdGF0ZS50ZXh0ICsgJ1wiPjwvc3Bhbj4nICsgc3RhdGUudGV4dCArICc8L3NwYW4+Jyk7XG4gICAgICB9LFxuICAgICAgdGVtcGxhdGVSZXN1bHQ6IGZ1bmN0aW9uIChzdGF0ZSwgY29udGFpbmVyLCBkYXRhKSB7XG4gICAgICAgIHZhciAkZWwgPSAkKCc8c3Bhbj4nICsgc3RhdGUudGV4dCArICc8L3NwYW4+Jyk7XG4gICAgICAgIGlmIChzdGF0ZS5pZCAhPSBcIm5vbmVcIikge1xuICAgICAgICAgIHZhciAkY2FudmFzID0gJCgnPGNhbnZhcz4nKTtcbiAgICAgICAgICBmYWJyaWMudXRpbC5kcmF3RmlsdGVyKCRjYW52YXNbMF0sIGRhdGEudGFyZ2V0Ll9lbGVtZW50LCBzdGF0ZS5pZCwge1xuICAgICAgICAgICAgaGVpZ2h0OiAyMlxuICAgICAgICAgIH0pO1xuICAgICAgICAgICRlbC5wcmVwZW5kKCRjYW52YXMpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAkZWw7XG4gICAgICB9LFxuICAgICAgdmFsdWU6IHtcbiAgICAgICAgc2V0OiBmdW5jdGlvbiAodmFsLCBmaWx0ZXJzRGF0YSkge1xuICAgICAgICAgIHZhciBvcHRpb25zID0gZmFsc2U7XG4gICAgICAgICAgaWYgKHZhbCA9PSBcIm5vbmVcIikge1xuICAgICAgICAgICAgdmFsID0gZmFsc2U7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhciBfZiA9IF8uZmluZFdoZXJlKGZpbHRlcnNEYXRhLCB7aWQ6IHZhbH0pO1xuICAgICAgICAgICAgX2YuZW5hYmxlZCA9ICFfZi5lbmFibGVkO1xuICAgICAgICAgICAgZm9yICh2YXIgaSBpbiBfZi5vcHRpb25zKSB7XG4gICAgICAgICAgICAgIGlmICgkLmlzTnVtZXJpYyhfZi5vcHRpb25zW2ldKSkge1xuICAgICAgICAgICAgICAgIF9mLm9wdGlvbnNbaV0gPSBwYXJzZUZsb2F0KF9mLm9wdGlvbnNbaV0pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoX2YuZW5hYmxlZCkge1xuICAgICAgICAgICAgICBvcHRpb25zID0ge307XG4gICAgICAgICAgICAgIGZvciAodmFyIGkgaW4gX2Yub3B0aW9ucykge1xuICAgICAgICAgICAgICAgIG9wdGlvbnNbaV0gPSBfZi5vcHRpb25zW2ldLnZhbHVlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cblxuICAgICAgICAgIH1cbiAgICAgICAgICB0aGlzLnNldEZpbHRlcih7XG4gICAgICAgICAgICB0eXBlOiB2YWwsXG4gICAgICAgICAgICBvcHRpb25zOiBvcHRpb25zLFxuICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZVxuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5maWx0ZXJzLmxlbmd0aCA/IGZhYnJpYy51dGlsLnN0cmluZy5jYXBpdGFsaXplKHRoaXMuZmlsdGVyc1swXS50eXBlLCB0cnVlKSA6IFwibm9uZVwiXG4gICAgICAgIH0sXG4gICAgICAgIG9wdGlvbnM6IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgIHZhciBfZmlsdGVycyA9IHRoaXMuZ2V0RmlsdGVyc0RhdGEoKTtcbiAgICAgICAgICBmb3IgKHZhciBpIGluIF9maWx0ZXJzKSB7XG4gICAgICAgICAgICBfZmlsdGVyc1tpXS5pZCA9IF9maWx0ZXJzW2ldLnR5cGU7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBbe1xuICAgICAgICAgICAgaWQ6ICdub25lJyxcbiAgICAgICAgICAgIHRleHQ6ICdvcmlnaW5hbCcsXG4gICAgICAgICAgICBlbmFibGVkOiAhdGhpcy5maWx0ZXJzIHx8ICF0aGlzLmZpbHRlcnMubGVuZ3RoXG4gICAgICAgICAgfV0uY29uY2F0KF9maWx0ZXJzKTtcblxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9KVxufSk7XG5cbi8vXG4vLyBmYWJyaWMuSW1hZ2UuZmlsdGVyTWFuYWdlciA9IHtcbi8vXG4vLyAgIC8vaGlkZTogZnVuY3Rpb24ob2JqZWN0KXtcbi8vICAgLy9cbi8vICAgLy99LFxuLy8gICBzaG93OiBmdW5jdGlvbiAob2JqZWN0KSB7XG4vLyAgICAgdGhpcy5hY3RpdmVPYmplY3QgPSBvYmplY3Q7XG4vLyAgICAgdGhpcy5maXJlKCdzaG93Jywgb2JqZWN0KTtcbi8vICAgICB0aGlzLm9uKCd0YXJnZXQ6Y2hhbmdlZCcsIG9iamVjdClcbi8vICAgfVxuLy8gLy8gfTtcblxuXG5cbi8vIGZhYnJpYy51dGlsLm9ic2VydmFibGUoZmFicmljLkltYWdlLmZpbHRlck1hbmFnZXIpO1xuXG5mYWJyaWMudXRpbC5kcmF3RmlsdGVyID0gZnVuY3Rpb24oZWxlbWVudCxzcmMsIGZpbHRlck5hbWUgLG9wdGlvbnMpe1xuICBpZihzcmMuY29uc3RydWN0b3IgPT09IFN0cmluZyl7XG4gICAgZmFicmljLnV0aWwubG9hZEltYWdlKHNyYyxmdW5jdGlvbihlbCl7XG4gICAgICBmYWJyaWMudXRpbC5fZHJhd0ZpbHRlcihlbGVtZW50LCBlbCwgZmlsdGVyTmFtZSAsb3B0aW9ucyk7XG4gICAgfSlcbiAgfWVsc2V7XG4gICAgZmFicmljLnV0aWwuX2RyYXdGaWx0ZXIoZWxlbWVudCxzcmMsIGZpbHRlck5hbWUgLG9wdGlvbnMpO1xuICB9XG59O1xuXG5mYWJyaWMudXRpbC5fZHJhd0ZpbHRlciA9IGZ1bmN0aW9uKGVsZW1lbnQsIGVsLCBmaWx0ZXJOYW1lICxvcHRpb25zKXtcblxuICB2YXIgY3R4ID1lbGVtZW50LmdldENvbnRleHQoXCIyZFwiKTtcbiAgaWYob3B0aW9ucyl7XG4gICAgaWYob3B0aW9ucy53aWR0aCAmJiBvcHRpb25zLmhlaWdodCl7XG4gICAgICBlbGVtZW50LndpZHRoID0gb3B0aW9ucy53aWR0aDtcbiAgICAgIGVsZW1lbnQuaGVpZ2h0ID0gb3B0aW9ucy5oZWlnaHQ7XG4gICAgfWVsc2UgaWYob3B0aW9ucy53aWR0aCl7XG4gICAgICBlbGVtZW50LndpZHRoID0gb3B0aW9ucy53aWR0aDtcbiAgICAgIGVsZW1lbnQuaGVpZ2h0ID0gb3B0aW9ucy53aWR0aCAqIChlbC5oZWlnaHQgLyBlbC53aWR0aCk7XG4gICAgfWVsc2UgaWYob3B0aW9ucy5oZWlnaHQpe1xuICAgICAgZWxlbWVudC5oZWlnaHQgPSBvcHRpb25zLmhlaWdodDtcbiAgICAgIGVsZW1lbnQud2lkdGggPSBvcHRpb25zLmhlaWdodCAqIChlbC53aWR0aCAvIGVsLmhlaWdodCk7XG4gICAgfVxuICB9XG5cbiAgY3R4LmRyYXdJbWFnZShlbCwwLDAsZWxlbWVudC53aWR0aCxlbGVtZW50LmhlaWdodCk7XG4gIGlmKCFmaWx0ZXJOYW1lKXJldHVybjtcbiAgZmlsdGVyTmFtZSA9IGZhYnJpYy51dGlsLnN0cmluZy5jYXBpdGFsaXplKGZpbHRlck5hbWUsdHJ1ZSk7XG5cbiAgaWYoZmFicmljLkltYWdlLmZpbHRlcnNbZmlsdGVyTmFtZV0pe1xuICAgIHZhciBfZmlsdGVyID0gbmV3IGZhYnJpYy5JbWFnZS5maWx0ZXJzW2ZpbHRlck5hbWVdKClcbiAgfWVsc2V7XG4gICAgdmFyIF9maWx0ZXIgPWZhYnJpYy5JbWFnZS5maWx0ZXJzW2ZpbHRlck5hbWVdLmNyZWF0ZSh7fSk7XG4gIH1cblxuICAvL3ZhciBfZmlsdGVyID0gbmV3IGZhYnJpYy5JbWFnZS5maWx0ZXJzW2ZpbHRlck5hbWVdO1xuICBpZihfZmlsdGVyKXtcbiAgICB2YXIgX2ZvID0gZmFicmljLkltYWdlLmZpbHRlcnNbZmlsdGVyTmFtZV0ucHJvdG90eXBlLm9wdGlvbnM7XG4gICAgdmFyIGZpbHRlck9wdGlvbnMgPSB7fTtcbiAgICBmb3IodmFyIGkgaW4gX2ZvKXtcbiAgICAgIGZpbHRlck9wdGlvbnNbaV0gPSBfZm9baV0udmFsdWU7XG5cbiAgICB9XG4gICAgZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChfZmlsdGVyLGZpbHRlck9wdGlvbnMpO1xuICAgIF9maWx0ZXIuaW1hZ2VEYXRhID0gY3R4LmdldEltYWdlRGF0YSgwLDAsZWxlbWVudC53aWR0aCxlbGVtZW50LmhlaWdodCk7XG4gICAgX2ZpbHRlci5hcHBseVRvKGVsZW1lbnQpO1xuICB9XG59O1xuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9tb2R1bGVzL2ltYWdlLmZpbHRlcnMuanNcbi8vIG1vZHVsZSBpZCA9IDM3XG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIi8qKlxuKiBJbnRlcmFjdGl2ZU1vZGUgbWl4aW4uIEFsbG93IHRvIHN3aXRjaCBiZXR3ZWVuIHBhbi9lZGl0L2RyYXdpbmcgY2FudmFzIG1vZGVzLlxuKi9cblxuJ3VzZSBzdHJpY3QnO1xuXG5cbnZhciBfbW91c2VfZG93bl9vdmVyd3JpdHRlbiA9IGZhYnJpYy5DYW52YXMucHJvdG90eXBlLl9vbk1vdXNlRG93bjtcbnZhciBfbW91c2VfdXBfb3ZlcndyaXR0ZW4gPSBmYWJyaWMuQ2FudmFzLnByb3RvdHlwZS5fb25Nb3VzZVVwO1xudmFyIF9tb3VzZV9tb3ZlX292ZXJ3cml0dGVuID0gZmFicmljLkNhbnZhcy5wcm90b3R5cGUuX29uTW91c2VNb3ZlO1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUsIHtcbiAgX2luaXRFdmVudExpc3RlbmVyc19vdmVyd3JpdHRlbjogZmFicmljLkNhbnZhcy5wcm90b3R5cGUuX2luaXRFdmVudExpc3RlbmVycyxcbiAgX2luaXRFdmVudExpc3RlbmVyczogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuX2luaXRFdmVudExpc3RlbmVyc19vdmVyd3JpdHRlbigpO1xuICAgIHRoaXMuX19fb25LZXlEb3duID0gdGhpcy5fb25LZXlEb3duLmJpbmQodGhpcyk7XG4gICAgZmFicmljLnV0aWwuYWRkTGlzdGVuZXIoZmFicmljLndpbmRvdywgJ2tleWRvd24nLCB0aGlzLl9fX29uS2V5RG93bik7XG4gIH0sXG4gIF9yZW1vdmVMaXN0ZW5lcnNfb3ZlcndyaXR0ZW46IGZhYnJpYy5DYW52YXMucHJvdG90eXBlLnJlbW92ZUxpc3RlbmVycyxcbiAgcmVtb3ZlTGlzdGVuZXJzOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5fcmVtb3ZlTGlzdGVuZXJzX292ZXJ3cml0dGVuKCk7XG4gICAgZmFicmljLnV0aWwucmVtb3ZlTGlzdGVuZXIoZmFicmljLndpbmRvdywgJ2tleWRvd24nLCB0aGlzLl9fX29uS2V5RG93bik7XG4gIH0sXG4gIF9vbktleURvd246IGZ1bmN0aW9uIChlKSB7XG4gICAgcmV0dXJuIHRoaXMuX2FwcGx5TWl4ZWRNb2RlKGUpO1xuICB9LFxuICBnZXRJbnRlcmFjdGl2ZU1vZGU6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5pbnRlcmFjdGl2ZU1vZGU7XG4gIH0sXG4gIHNldEludGVyYWN0aXZlTW9kZTogZnVuY3Rpb24gKHRvb2wpIHtcbiAgICAvL3RvZG8gY2hlY2t0aGlzIG91dFxuICAgIC8vIGlmICh0b29sID09PSAnaGFuZCcpIHtcbiAgICAvLyAgIHRoaXMuc2V0Q3Vyc29yKCdwb2ludGVyJyk7XG4gICAgLy8gfVxuICAgIHRoaXMuaXNEcmF3aW5nTW9kZSA9ICh0b29sID09PSAnZHJhdycpO1xuICAgIHRoaXMuaXNIYW5kTW9kZSA9ICh0b29sID09PSAnaGFuZCcpO1xuICAgIHRoaXMuaW50ZXJhY3RpdmUgPSAodG9vbCAhPT0gJ2Rpc2FibGVkJyk7XG4gICAgdGhpcy5pc01peGVkTW9kZSA9ICh0b29sID09PSAnbWl4ZWQnKTtcblxuICAgIGlmICghdGhpcy5pbnRlcmFjdGl2ZSkge1xuICAgICAgdGhpcy51cHBlckNhbnZhc0VsLnN0eWxlLmN1cnNvciA9ICdkZWZhdWx0JztcbiAgICB9XG4gICAgdGhpcy5pbnRlcmFjdGl2ZU1vZGUgPSB0b29sO1xuICB9LFxuXG4gIC8qKlxuICAgKiAgY3VycmVudCBtb2RlXG4gICAqICBAdmFsdWVzIGRlZmF1bHQgfCBoYW5kIHwgc2VsZWN0aW9uXG4gICAqICBAY29tbWVudFxuICAgKiAgICAgIGhhbmQgICAgICAtIG1vdmluZyBjYW52YXNcbiAgICogICAgICBkcmF3IC0gZHJhd2luZyByZWFjdGFuZ2xlc1xuICAgKiAgICAgIHNlbGVjdGlvbiAtIGRlZmF1bHQgYmVoYXZpb3JcbiAgICovXG4gIGludGVyYWN0aXZlTW9kZTogJ2RlZmF1bHQnLFxuXG4gIGlzSGFuZE1vZGU6IGZhbHNlLFxuICBfaGFuZE1vZGVDdXJzb3JNb3ZlOiBmYWxzZSxcbiAgX2hhbmRNb2RlQ3Vyc29yRG93bjogZmFsc2UsXG4gIF9oYW5kTW9kZUN1cnNvclBvc2l0aW9uOiB7eDogMCwgeTogMH0sXG4gIF9oYW5kTW9kZU1vdXNlTW92ZTogZnVuY3Rpb24gKGUpIHtcbiAgICBpZiAodGhpcy5faGFuZE1vZGVDdXJzb3JEb3duID09PSB0cnVlKSB7XG5cbiAgICAgIGlmIChlLnBhZ2VZID09PSB0aGlzLl9oYW5kTW9kZUN1cnNvclBvc2l0aW9uLnkgJiYgZS5wYWdlWCA9PT0gdGhpcy5faGFuZE1vZGVDdXJzb3JQb3NpdGlvbi54KSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgdGhpcy5faGFuZE1vZGVDdXJzb3JNb3ZlID0gdHJ1ZTtcblxuICAgICAgdmFyIHNjcm9sbCA9IHt4OiB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzRdLCB5OiB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzVdfTtcblxuICAgICAgdmFyIG5ld1Njcm9sbCA9IHtcbiAgICAgICAgeDogc2Nyb2xsLnggLSAodGhpcy5faGFuZE1vZGVDdXJzb3JQb3NpdGlvbi54IC0gZS5wYWdlWCksXG4gICAgICAgIHk6IHNjcm9sbC55IC0gKHRoaXMuX2hhbmRNb2RlQ3Vyc29yUG9zaXRpb24ueSAtIGUucGFnZVkpXG4gICAgICB9O1xuXG4gICAgICB2YXIgZGltcyA9IHtcbiAgICAgICAgd2lkdGg6IHRoaXMuc2l6ZS53aWR0aCAqIHRoaXMuem9vbSAtIHRoaXMubG93ZXJDYW52YXNFbC53aWR0aCxcbiAgICAgICAgaGVpZ2h0OiB0aGlzLnNpemUuaGVpZ2h0ICogdGhpcy56b29tIC0gdGhpcy5sb3dlckNhbnZhc0VsLmhlaWdodFxuICAgICAgfTtcbiAgICAgIC8qICB0b2RvIG5lZWQgdG8gYWRkIHNvbWUgcmVzdHJpY3Rpb25zIGxhdGVyXG4gICAgICAgLy9NYXRoLm1heChNYXRoLm1pbigwLG5ld1Njcm9sbC54KSwtZGltcy53aWR0aCk7XG4gICAgICAgLy9NYXRoLm1heChNYXRoLm1pbigwLG5ld1Njcm9sbC55KSwtZGltcy5oZWlnaHQpO1xuICAgICAgICovXG4gICAgICB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzRdID0gbmV3U2Nyb2xsLng7XG4gICAgICB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzVdID0gbmV3U2Nyb2xsLnk7XG5cbiAgICAgIHRoaXMuZmlyZSgndmlld3BvcnQ6dHJhbnNsYXRlJyk7XG5cbiAgICAgIHRoaXMucmVuZGVyQWxsKCk7XG4gICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gdGhpcy5fb2JqZWN0cy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICB0aGlzLl9vYmplY3RzW2ldLnNldENvb3JkcygpO1xuICAgICAgfVxuXG4gICAgICB0aGlzLl9oYW5kTW9kZUN1cnNvclBvc2l0aW9uLnkgPSBlLnBhZ2VZO1xuICAgICAgdGhpcy5faGFuZE1vZGVDdXJzb3JQb3NpdGlvbi54ID0gZS5wYWdlWDtcbiAgICB9XG4gIH0sXG4gIF9oYW5kTW9kZU1vdXNlVXA6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLl9oYW5kTW9kZUN1cnNvckRvd24gPSBmYWxzZTtcbiAgICBpZiAoIXRoaXMuX2hhbmRNb2RlQ3Vyc29yTW92ZSkge1xuXG4gICAgfVxuICB9LFxuICBfaGFuZE1vZGVNb3VzZURvd246IGZ1bmN0aW9uIChlKSB7XG5cbiAgICB0aGlzLl9oYW5kTW9kZUN1cnNvck1vdmUgPSBmYWxzZTtcbiAgICB0aGlzLl9oYW5kTW9kZUN1cnNvckRvd24gPSB0cnVlO1xuICAgIHRoaXMuX2hhbmRNb2RlQ3Vyc29yUG9zaXRpb24gPSB7XG4gICAgICB5OiBlLnBhZ2VZLFxuICAgICAgeDogZS5wYWdlWFxuICAgIH07XG4gIH0sXG4gIGhhbmRNb2RlRW5hYmxlZDogZmFsc2UsXG4gIGhhbmRNb2RlS2V5OiBcIkFsdFwiLFxuICBfYXBwbHlNaXhlZE1vZGU6IGZ1bmN0aW9uIChlKSB7XG4gICAgdGhpcy5fY3VycmVudF90YXJnZXQgPSB0aGlzLmZpbmRUYXJnZXQoZSk7XG5cbiAgICBpZiAodGhpcy5oYW5kTW9kZUVuYWJsZWQgJiYgZS5hbHRLZXkgfHwgZS5rZXkgPT09IHRoaXMuaGFuZE1vZGVLZXkpIHtcbiAgICAgIC8vaWYgc2hpZnQgdXNlIGhhbmQgbW9kZVxuICAgICAgaWYgKCF0aGlzLmlzSGFuZE1vZGUpIHtcbiAgICAgICAgdGhpcy5pc0hhbmRNb2RlID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5pc0RyYXdpbmdNb2RlID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc2V0Q3Vyc29yKCdwb2ludGVyJyk7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmICh0aGlzLmlzTWl4ZWRNb2RlICYmICF0aGlzLl9pc0N1cnJlbnRseURyYXdpbmcgJiYgIXRoaXMuX2N1cnJlbnRUcmFuc2Zvcm0pIHtcblxuICAgICAgdGhpcy5pc0hhbmRNb2RlID0gZmFsc2U7XG5cbiAgICAgIGlmICh0aGlzLl9jdXJyZW50X3RhcmdldCkge1xuICAgICAgICBpZiAodGhpcy5mcmVlRHJhd2luZ0JydXNoICYmIHRoaXMuX2N1cnJlbnRfdGFyZ2V0LmFsbG93RHJhd2luZykge1xuICAgICAgICAgIHZhciBjb3JuZXIgPSB0aGlzLl9jdXJyZW50X3RhcmdldC5fZmluZFRhcmdldENvcm5lcih0aGlzLmdldFBvaW50ZXIoZSwgdHJ1ZSkpO1xuICAgICAgICAgIGlmICghY29ybmVyKSB7XG4gICAgICAgICAgICB0aGlzLmlzRHJhd2luZ01vZGUgPSB0cnVlO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmlzRHJhd2luZ01vZGUgPSBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5pc0RyYXdpbmdNb2RlKSB7XG4gICAgICAgICAgdGhpcy5pc0RyYXdpbmdNb2RlID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmICh0aGlzLmZyZWVEcmF3aW5nQnJ1c2ggJiYgIXRoaXMuaXNEcmF3aW5nTW9kZSkge1xuICAgICAgICAgIHRoaXMuc2V0Q3Vyc29yKHRoaXMuZnJlZURyYXdpbmdDdXJzb3IpO1xuICAgICAgICAgIHRoaXMuaXNEcmF3aW5nTW9kZSA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5pc0hhbmRNb2RlID0gZmFsc2U7XG4gICAgfVxuXG4gIH0sXG4gIF9vbk1vdXNlTW92ZTogZnVuY3Rpb24gKGUpIHtcbiAgICBpZiAoIXRoaXMuaW50ZXJhY3RpdmUpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLl9hcHBseU1peGVkTW9kZShlKTtcblxuICAgIGlmICh0aGlzLmlzSGFuZE1vZGUpIHtcblxuICAgICAgaWYgKHRoaXMuX2N1cnJlbnRfdGFyZ2V0ICYmIHRoaXMuX2N1cnJlbnRfdGFyZ2V0LnNlbGVjdGFibGVfb3ZlcndyaXR0ZW4pIHtcbiAgICAgICAgdGhpcy5fY3VycmVudF90YXJnZXQuc2VsZWN0YWJsZSA9IHRydWU7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLl9oYW5kTW9kZUFjdGl2ZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5faGFuZE1vZGVNb3VzZU1vdmUoZSk7XG4gICAgICB9XG4gICAgICB0aGlzLmZpcmUoJ21vdXNlOm1vdmUnLCB7dGFyZ2V0OiB0aGlzLl9jdXJyZW50X3RhcmdldCwgZTogZX0pO1xuICAgICAgdGhpcy5fY3VycmVudF90YXJnZXQgJiYgdGhpcy5fY3VycmVudF90YXJnZXQuZmlyZSgnbW91c2Vtb3ZlJywge2U6IGV9KTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gX21vdXNlX21vdmVfb3ZlcndyaXR0ZW4uY2FsbCh0aGlzLCBlKTtcbiAgICB9XG4gIH0sIC8qKlxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgX29uU2NhbGU6IGZ1bmN0aW9uIChlLCB0cmFuc2Zvcm0sIHgsIHkpIHtcblxuICAgIHZhciB1c2VVbmlTY2FsZSA9IGUuc2hpZnRLZXkgXiB0aGlzLnNoaWZ0SW52ZXJ0ZWQ7XG4gICAgLy8gcm90YXRlIG9iamVjdCBvbmx5IGlmIHNoaWZ0IGtleSBpcyBub3QgcHJlc3NlZFxuICAgIC8vIGFuZCBpZiBpdCBpcyBub3QgYSBncm91cCB3ZSBhcmUgdHJhbnNmb3JtaW5nXG4gICAgaWYgKCh1c2VVbmlTY2FsZSB8fCB0aGlzLnVuaVNjYWxlVHJhbnNmb3JtKSAmJiAhdHJhbnNmb3JtLnRhcmdldC5nZXQoJ2xvY2tVbmlTY2FsaW5nJykpIHtcbiAgICAgIHRyYW5zZm9ybS5jdXJyZW50QWN0aW9uID0gJ3NjYWxlJztcbiAgICAgIHJldHVybiB0aGlzLl9zY2FsZU9iamVjdCh4LCB5KTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAvLyBTd2l0Y2ggZnJvbSBhIG5vcm1hbCByZXNpemUgdG8gcHJvcG9ydGlvbmFsXG4gICAgICBpZiAoIXRyYW5zZm9ybS5yZXNldCAmJiB0cmFuc2Zvcm0uY3VycmVudEFjdGlvbiA9PT0gJ3NjYWxlJykge1xuICAgICAgICB0aGlzLl9yZXNldEN1cnJlbnRUcmFuc2Zvcm0oZSk7XG4gICAgICB9XG5cbiAgICAgIHRyYW5zZm9ybS5jdXJyZW50QWN0aW9uID0gJ3NjYWxlRXF1YWxseSc7XG4gICAgICByZXR1cm4gdGhpcy5fc2NhbGVPYmplY3QoeCwgeSwgJ2VxdWFsbHknKTtcbiAgICB9XG4gIH0sXG4gIHNoaWZ0SW52ZXJ0ZWQ6IGZhbHNlLFxuICBfc2V0Q3Vyc29yRnJvbUV2ZW50X292ZXJ3cml0dGVuOiBmYWJyaWMuQ2FudmFzLnByb3RvdHlwZS5fc2V0Q3Vyc29yRnJvbUV2ZW50LFxuICBfc2V0Q3Vyc29yRnJvbUV2ZW50OiBmdW5jdGlvbiAoZSwgdGFyZ2V0KSB7XG4gICAgaWYgKHRoaXMuaXNIYW5kTW9kZSkge1xuICAgICAgdGhpcy5zZXRDdXJzb3IoJ3BvaW50ZXInKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fc2V0Q3Vyc29yRnJvbUV2ZW50X292ZXJ3cml0dGVuKGUsIHRhcmdldCk7XG4gICAgfVxuICB9LFxuICBfb25Nb3VzZURvd246IGZ1bmN0aW9uIChlKSB7XG4gICAgaWYgKCF0aGlzLmludGVyYWN0aXZlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cbiAgICB0aGlzLl9hcHBseU1peGVkTW9kZShlKTtcbiAgICBpZiAodGhpcy5pc0hhbmRNb2RlICYmIHRoaXMuX2N1cnJlbnRfdGFyZ2V0KSB7XG4gICAgICB0aGlzLl9jdXJyZW50X3RhcmdldC5zZWxlY3RhYmxlX292ZXJ3cml0dGVuID0gdGhpcy5fY3VycmVudF90YXJnZXQuc2VsZWN0YWJsZTtcbiAgICAgIHRoaXMuX2N1cnJlbnRfdGFyZ2V0LnNlbGVjdGFibGUgPSBmYWxzZTtcbiAgICB9XG5cbiAgICBfbW91c2VfZG93bl9vdmVyd3JpdHRlbi5jYWxsKHRoaXMsIGUpO1xuXG5cbiAgICBpZiAodGhpcy5pc0hhbmRNb2RlKSB7XG5cbiAgICAgIGlmICh0aGlzLl9jdXJyZW50X3RhcmdldCAmJiB0aGlzLl9jdXJyZW50X3RhcmdldC5zZWxlY3RhYmxlX292ZXJ3cml0dGVuKSB7XG4gICAgICAgIHRoaXMuX2N1cnJlbnRfdGFyZ2V0LnNlbGVjdGFibGUgPSB0cnVlO1xuICAgICAgfVxuICAgICAgdGhpcy5faGFuZE1vZGVBY3RpdmUgPSB0cnVlO1xuICAgICAgdGhpcy5faGFuZE1vZGVNb3VzZURvd24oZSk7XG4gICAgfVxuICB9LFxuXG4gIF9vbk1vdXNlVXA6IGZ1bmN0aW9uIChlKSB7XG4gICAgaWYgKCF0aGlzLmludGVyYWN0aXZlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIF9tb3VzZV91cF9vdmVyd3JpdHRlbi5jYWxsKHRoaXMsIGUpO1xuXG4gICAgaWYgKHRoaXMuaXNIYW5kTW9kZSkge1xuICAgICAgdGhpcy5faGFuZE1vZGVBY3RpdmUgPSBmYWxzZTtcbiAgICB9XG4gIH1cbn0pO1xuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9tb2R1bGVzL2ludGVyYWN0aXZlTW9kZS5qc1xuLy8gbW9kdWxlIGlkID0gMzhcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiJ3VzZSBzdHJpY3QnO1xuXG5mYWJyaWMub2JqZWN0c0xpYnJhcnkgPSB7XG4gIHRleHQ6IHtcbiAgICB0aXRsZTogXCJUZXh0XCIsXG4gICAgdHlwZTogXCJpLXRleHRcIixcbiAgICB0ZXh0OiBcItCi0LXQutGB0YJcIlxuICB9LFxuICBsaW5lOiB7XG4gICAgdHlwZTogXCJsaW5lXCIsXG4gICAgc3Ryb2tlV2lkdGg6IDUsXG4gICAgc3Ryb2tlOiBcImJsYWNrXCIsXG4gICAgc2NhbGVYOiAxLFxuICAgIHNjYWxlWTogMSxcbiAgICB4MTogMCxcbiAgICB4MjogMTAwLFxuICAgIHkxOiAwLFxuICAgIHkyOiA1MFxuICB9LFxuICB0cmlhbmdsZToge1xuICAgIHR5cGU6IFwidHJpYW5nbGVcIixcbiAgICB3aWR0aDogZnVuY3Rpb24odyxoKXsgcmV0dXJuIE1hdGgubWluKHcsaCkgLSA0fSxcbiAgICBoZWlnaHQ6IGZ1bmN0aW9uKHcsaCl7IHJldHVybiBNYXRoLm1pbih3LGgpIC0gNH1cbiAgfSxcbiAgcmVjdGFuZ2xlOiB7XG4gICAgdHlwZTogXCJyZWN0XCIsXG4gICAgd2lkdGg6IGZ1bmN0aW9uKHcsaCl7IHJldHVybiBNYXRoLm1pbih3LGgpIC0gNH0sXG4gICAgaGVpZ2h0OiBmdW5jdGlvbih3LGgpeyByZXR1cm4gTWF0aC5taW4odyxoKSAtIDR9XG4gIH0sXG4gIHBvbHlnb246IHtcbiAgICBzY2FsZVg6IDEsXG4gICAgc2NhbGVZOiAxLFxuICAgIHR5cGU6IFwicG9seWdvblwiLFxuICAgIHBvaW50czogZnVuY3Rpb24odyxoKSB7XG4gICAgICByZXR1cm4gW1xuICAgICAgICB7eDogMjUsIHk6IDF9LFxuICAgICAgICB7eDogMzEsIHk6IDE4fSxcbiAgICAgICAge3g6IDQ5LCB5OiAxOH0sXG4gICAgICAgIHt4OiAzNSwgeTogMjl9LFxuICAgICAgICB7eDogNDAsIHk6IDQ2fSxcbiAgICAgICAge3g6IDI1LCB5OiAzNn0sXG4gICAgICAgIHt4OiAxMCwgeTogNDZ9LFxuICAgICAgICB7eDogMTUsIHk6IDI5fSxcbiAgICAgICAge3g6ICAxLCB5OiAxOH0sXG4gICAgICAgIHt4OiAxOSwgeTogMTh9XG4gICAgICBdO1xuICAgIH1cbiAgfSxcbiAgcGF0aDoge1xuICAgIFwidHlwZVwiOiBcInBhdGhcIixcbiAgICBcInBhdGhcIjogIFwibTU4MS4wNzc5NDIsMi41MzczNTljLTIuMDUzMjIzLDAuMDQ3MDcxIC00LjA0MDcxLDAuMTg4MzQ4IC02LjEwODA5MywwLjM1MjkwN2MtMzMuMDU1NDIsMi42NjM5MTggLTYyLjIzNTkwMSwxOS42NDA1NDEgLTc3LjA1NzY3OCw0NC45MjU5NTNsLTcuODU3MywxOS4xMzUzMTljMS42OTg4MjIsLTYuNjMzMTQ0IDQuMzAyOTc5LC0xMy4wNjUzODQgNy44NTczLC0xOS4xMzUzMTljLTI2LjQzMDY5NSwtMjIuMTYyOTMgLTYzLjUzMTY3NywtMzIuMzg4NDQ1IC0xMDAuMTkyMzgzLC0yNy41NzQzNzNjLTM2LjY2MTQ2OSw0Ljc4ODM1MyAtNjguNTAzMDgyLDI0LjA0MTc1OCAtODUuOTAxOTc4LDUxLjkzNTIyNWMtNDkuMTE2NDg2LC0yNC40OTAwMTMgLTExMC4zNDI4OCwtMjIuOTk5NDU0IC0xNTcuNzExODA3LDMuODYwMDkyYy00Ny4zNjkxNjQsMjYuODYwNjggLTcyLjYxNjczLDc0LjQwNTUxIC02NC45NDExNjIsMTIyLjM4MzA4bDUuMDIxMzU1LDE5LjQ5OTY4Yy0yLjI2MzMyOSwtNi4zODUwMSAtMy45NjA3OTMsLTEyLjg4NzY5NSAtNS4wMjEzNTUsLTE5LjQ5OTY4bC0wLjc2MTk0OCwxLjc5ODU2OWMtNDEuMTc5MTY1LDMuNjI1MjQ0IC03NC45NDUzNzUsMjkuNDY1MTM0IC04My43MTYzOTgsNjQuMDU5MjM1Yy04Ljc3MTgwNSwzNC41OTc3NDggOS40NjcwMSw3MC4wODU4NzYgNDUuMTg1NjIxLDg3Ljk2NzAxbDU1Ljc3NjU1OCwxMC45NzMxMTRjLTE5LjQ4MDIxNywxLjI5MTk2MiAtMzguOTE1NTQzLC0yLjUzNDUxNSAtNTUuNzc2NTU4LC0xMC45NzMxMTRjLTI3LjU0NzgsMjQuOTY4MTcgLTMzLjg4ODUxNiw2MS45MzUzMDMgLTE1LjcxNDkyLDkyLjQ2NzgzNGMxOC4xNzM3MzMsMzAuNTI0NzE5IDU2Ljk4ODg5OSw0OC4xMTA2ODcgOTcuMDMwNDU3LDQ0LjExNzM0bDI0LjMzOTcyMiwtNS4yMTEwOWMtNy44Mjc0OTksMi42NTE2MTEgLTE1Ljk2MDk4Myw0LjM3OTA1OSAtMjQuMzM5NzIyLDUuMjExMDljMjIuNzMwMDQyLDMzLjg1NzI2OSA2MC40MjgxOTIsNTguNTU2MjQ0IDEwNC42Njg5Myw2OC4zODM1MTRjNDQuMjQ5MSw5LjgxMzY2IDkxLjI0MDk1Miw0LjAxNDc3MSAxMzAuNDI1OTQ5LC0xNi4wOTQ2MDRjMzEuOTY3MDEsNDAuNzkzODIzIDg4LjcwNzY0Miw2Mi4yMTc0NjggMTQ1LjU5NjMxMyw1NC45OTcwN2M1Ni45MDI0NjYsLTcuMjE5NjY2IDEwMy44MzM5ODQsLTQxLjgxNDI3IDEyMC41MDEzNDMsLTg4Ljc3MDk5Nmw1Ljc4MTQzMywtMjYuMjM5NTMyYy0wLjg2MzcwOCw4LjkwOTU0NiAtMi43NDIyNDksMTcuNjgxMzY2IC01Ljc4MTQzMywyNi4yMzk1MzJjMzkuMTMzMzAxLDIwLjc1MzY2MiA4OC4zNTMzMzMsMjEuOTI3MzA3IDEyOC43ODUwOTUsMy4wNDkzMTZjNDAuNDM5ODE5LC0xOC44NzQwODQgNjUuNjY1NzcxLC01NC44NjkwNDkgNjYuMDM2MTMzLC05NC4wNzgyNDdsLTE0LjQ5NTYwNSwtNTguNTgwNTk3bC01Ny4xMDU3MTMsLTM5LjYzMDc2OGM0NC4xNjM0NTIsMjIuMzc0NTczIDcxLjk5MjYxNSw1Ni40NjcyNTUgNzEuNjAxMzE4LDk4LjIxMTM2NWM1Mi40OTcwNywwLjQ0ODE4MSA5Ny4xMDMzOTQsLTM1Ljk1NjU3MyAxMTcuMTEyNDI3LC03Ny43MjYyODhjMjAuMDExNTk3LC00MS43Njk4MzYgMTIuNDQzNjA0LC04OS4zOTY3NTkgLTE5Ljg2NDkyOSwtMTI1LjE2NDY0MmMxMy40MDExODQsLTI2LjYzNzY5NSAxMi42MDk5ODUsLTU2LjkzNzMzMiAtMi4xODM0NzIsLTgzLjAzNDA4OGMtMTQuNzg2MTk0LC0yNi4wOTc4OTMgLTQyLjA2NTQ5MSwtNDUuNDc2ODkxIC03NC44NzMwNDcsLTUzLjA5ODMzNWMtNy4zNDE0MzEsLTM0LjU4MDkyOSAtMzcuNjAyNjYxLC02Mi40MDQ0ODIgLTc3LjYwMDcwOCwtNzEuNTI2MjkzYy0zOS45OTg0NzQsLTkuMTIxMzY4IC04Mi41ODQ4MzksMi4xMjM5OTIgLTEwOS4zNjQ4MDcsMjguOTI2MTIzbC0xNi4yNTgxNzksMjIuMTk4MTdjNC4xNTc5NTksLTguMDE4NjEyIDkuNTgzOTIzLC0xNS40OTUyMTMgMTYuMjU4MTc5LC0yMi4xOTgxN2MtMTguODc2OTUzLC0yMS4wNjA3MTMgLTQ4LjQ4NjAyMywtMzIuOTU0MDYxIC03OS4zNDg5MzgsLTMyLjE1NTQwMWwwLDB6XCIsXG4gICAgXCJ3aWR0aFwiOiBmdW5jdGlvbih3LGgpe3JldHVybiB3IC0gNCB9LFxuICAgIFwiaGVpZ2h0XCI6IGZ1bmN0aW9uKHcsaCl7cmV0dXJuIGggLSA0fVxuICB9LFxuICBlbGxpcHNlOiB7XG4gICAgXCJ0eXBlXCI6IFwiZWxsaXBzZVwiLFxuICAgIFwicnhcIjogZnVuY3Rpb24odyxoKXtyZXR1cm4gdyAvMiAtIDR9LFxuICAgIFwicnlcIjogZnVuY3Rpb24odyxoKXtyZXR1cm4gaC8gMiAtIDR9XG4gIH0sXG4gIGNpcmNsZToge1xuICAgIHR5cGU6IFwiY2lyY2xlXCIsXG4gICAgcmFkaXVzOiBmdW5jdGlvbih3LGgpeyByZXR1cm4gTWF0aC5taW4odyxoKS8yIC0gNH1cbiAgfVxufTtcblxuZmFicmljLmdldE9iamVjdHNMaXN0ID0gZnVuY3Rpb24odyxoKXtcbiAgdmFyIF9saWIgPSBbXTtcbiAgZm9yKHZhciBpIGluIHRoaXMub2JqZWN0c0xpYnJhcnkpe1xuICAgIHZhciBvID0gX2xpYltpXSA9IGZhYnJpYy51dGlsLm9iamVjdC5jbG9uZURlZXAodGhpcy5vYmplY3RzTGlicmFyeVtpXSk7XG4gICAgby50aXRsZSA9IG8udGl0bGUgfHwgby50eXBlO1xuICAgIGlmKG8ud2lkdGggPT09IDAgKSBvLndpZHRoID0gdztcbiAgICBpZihvLmhlaWdodCA9PT0gMCApIG8uaGVpZ2h0ID0gaDtcbiAgICBmb3IodmFyIGogaW4gbyl7XG4gICAgICBpZihvW2pdLmNvbnN0cnVjdG9yID09IEZ1bmN0aW9uKXtcbiAgICAgICAgb1tqXSA9IG9bal0uY2FsbChvLHcsaCk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJldHVybiBfbGliO1xufTtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vbW9kdWxlcy9saWJyYXJ5LmpzXG4vLyBtb2R1bGUgaWQgPSAzOVxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCJcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuQXBwbGljYXRpb24ucHJvdG90eXBlLCB7XG4gIC8vIGxvYWRlclRlbXBsYXRlOiBcIjxzcGFuIGNsYXNzPSdmYSBmYS1wdWxzZSBmYS1zcGlubmVyIGNhbnZhcy1sb2FkLXNwaW5uZXInPjwvc3Bhbj5cIixcbiAgbG9hZGVySWNvbjogICAnZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCwnICsgcmVxdWlyZSgnYmFzZTY0LWxvYWRlciEuLy4uL21lZGlhL2xvYWRlci5zdmcnKSxcbiAgbG9hZGVyQ29udGFpbmVyOiBudWxsLFxuICBfc2hvd01haW5Mb2FkZXJJbmRpY2F0b3I6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmxvYWRlckVsLnNob3coKTtcbiAgICB0aGlzLmxvYWRlckNvbnRhaW5lci5hZGRDbGFzcyhcInByb2Nlc3NpbmdcIik7XG4gIH0sXG4gIF9oaWRlTWFpbkxvYWRlckluZGljYXRvcjogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMubG9hZGVyRWwuaGlkZSgpO1xuICAgIHRoaXMubG9hZGVyQ29udGFpbmVyLnJlbW92ZUNsYXNzKFwicHJvY2Vzc2luZ1wiKTtcbiAgfSxcbiAgc2V0TG9hZGVyVGVtcGxhdGU6IGZ1bmN0aW9uICh2YWwpIHtcbiAgICBpZih0aGlzLnZpcnR1YWwpIHJldHVybiBmYWxzZTtcbiAgICB0aGlzLmxvYWRlclRlbXBsYXRlID0gdmFsLnJlcGxhY2UoXCJ7bG9hZGVySWNvbn1cIix0aGlzLmxvYWRlckljb24pO1xuICAgIGlmKHZhbCkge1xuICAgICAgdGhpcy5sb2FkZXJDb250YWluZXIgPSAkKHRoaXMubG9hZGVyQ29udGFpbmVyKTtcbiAgICAgIHRoaXMubG9hZGVyRWwgPSAkKHRoaXMubG9hZGVyVGVtcGxhdGUpLmhpZGUoKTtcbiAgICAgIHRoaXMubG9hZGVyQ29udGFpbmVyLmFwcGVuZCh0aGlzLmxvYWRlckVsKTtcbiAgICAgIC8vIHRoaXMub24oXCJsb2FkaW5nOmJlZ2luXCIsIHRoaXMuX3Nob3dNYWluTG9hZGVySW5kaWNhdG9yKTtcbiAgICAgIC8vIHRoaXMub24oXCJsb2FkaW5nOmVuZFwiLCB0aGlzLl9oaWRlTWFpbkxvYWRlckluZGljYXRvcik7XG5cblxuICAgICAgdGhpcy5vbihcInByb2plY3Q6Y2hhbmdlZFwiLGZ1bmN0aW9uKCl7XG4gICAgICAgIHRoaXMucHJvamVjdC5vbihcInNsaWRlOmNoYW5nZTpiZWdpblwiLCB0aGlzLl9zaG93TWFpbkxvYWRlckluZGljYXRvci5iaW5kKHRoaXMpKTtcbiAgICAgICAgdGhpcy5wcm9qZWN0Lm9uKFwic2xpZGU6Y2hhbmdlZFwiLCB0aGlzLl9oaWRlTWFpbkxvYWRlckluZGljYXRvci5iaW5kKHRoaXMpKTtcbiAgICAgIH0pXG5cbiAgICB9XG4gIH1cbn0pO1xuXG5cbi8vIGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLlNsaWRlQ2FudmFzLnByb3RvdHlwZSwge1xuLy8gICAvLyBsb2FkZXJUZW1wbGF0ZTogXCI8c3BhbiBjbGFzcz0nZmEgZmEtcHVsc2UgZmEtc3Bpbm5lciBjYW52YXMtbG9hZC1zcGlubmVyJz48L3NwYW4+XCIsXG4vLyAgIHNldExvYWRlclRlbXBsYXRlOiBmdW5jdGlvbiAodmFsKSB7XG4vLyAgICAgaWYodGhpcy52aXJ0dWFsKSByZXR1cm4gZmFsc2U7XG4vLyAgICAgdGhpcy5sb2FkZXJUZW1wbGF0ZSA9IHZhbDtcbi8vICAgICBpZih2YWwpIHtcbi8vICAgICAgIHRoaXMubG9hZGVyRWwgPSAkKHRoaXMubG9hZGVyVGVtcGxhdGUpLmhpZGUoKTtcbi8vICAgICAgICQodGhpcy53cmFwcGVyRWwpLmFwcGVuZCh0aGlzLmxvYWRlckVsKTtcbi8vICAgICAgIHRoaXMub24oXCJsb2FkaW5nOmJlZ2luXCIsIGZ1bmN0aW9uICgpIHtcbi8vICAgICAgICAgdGhpcy5sb2FkZXJFbC5zaG93KCk7XG4vLyAgICAgICAgICQodGhpcy53cmFwcGVyRWwpLmFkZENsYXNzKFwicHJvY2Vzc2luZ1wiKTtcbi8vICAgICAgIH0pO1xuLy8gICAgICAgdGhpcy5vbihcImxvYWRpbmc6ZW5kXCIsIGZ1bmN0aW9uICgpIHtcbi8vICAgICAgICAgdGhpcy5sb2FkZXJFbC5oaWRlKCk7XG4vLyAgICAgICAgICQodGhpcy53cmFwcGVyRWwpLnJlbW92ZUNsYXNzKFwicHJvY2Vzc2luZ1wiKTtcbi8vICAgICAgIH0pO1xuLy8gICAgIH1cbi8vICAgfVxuLy8gfSk7XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL21vZHVsZXMvbG9hZGVyLmpzXG4vLyBtb2R1bGUgaWQgPSA0MFxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCJyZXF1aXJlKFwiLi9hcmVhc1wiKTtcbnJlcXVpcmUoXCIuL2dyb3Vwc1wiKTtcblxuLy8gdG9kbyDRjdGC0L4g0YPQsdGA0LDRgtGMXG4vL2ZhYnJpYy5tb3ZlbWVudHNMaW1pdHNFYXN5ID0gZmFsc2U7XG52YXIgX3RvT2JqZWN0X292ZXJ3cml0dGVuID0gZmFicmljLk9iamVjdC5wcm90b3R5cGUudG9PYmplY3Q7XG4vL3RvZG8gdXNlIGV2ZW50IFwiYmVmb3JlOm9iamVjdFwiO1xuXG5mYWJyaWMuT2JqZWN0LnByb3RvdHlwZS50b09iamVjdCA9IGZ1bmN0aW9uIChwcm9wZXJ0aWVzVG9JbmNsdWRlKSB7XG4gIHZhciBvYmogPSBfdG9PYmplY3Rfb3ZlcndyaXR0ZW4uY2FsbCh0aGlzLHByb3BlcnRpZXNUb0luY2x1ZGUpO1xuICB2YXIgX3N0b3JlQWxsID0gdGhpcy5zdG9yZVByb3BlcnRpZXMuaW5kZXhPZihcIipcIikgIT0gLTE7XG4gIGlmICh0aGlzLmNsaXBUbyAmJiB0aGlzLmNsaXBUby5pZCAmJiAoX3N0b3JlQWxsIHx8IHRoaXMuc3RvcmVQcm9wZXJ0aWVzLmluZGV4T2YoXCJjbGlwVG9cIikgIT0gLTEpKSB7XG4gICAgb2JqLmNsaXBUbyA9ICcjJyArIHRoaXMuY2xpcFRvLmlkXG4gIH1cbiAgaWYgKCB0aGlzLm1vdmVtZW50TGltaXRzICYmICAoX3N0b3JlQWxsIHx8IHRoaXMuc3RvcmVQcm9wZXJ0aWVzLmluZGV4T2YoXCJtb3ZlbWVudExpbWl0c1wiKSAhPSAtMSkpIHtcbiAgICBvYmoubW92ZW1lbnRMaW1pdHMgPSB0aGlzLm1vdmVtZW50TGltaXRzLmlkID8gJyMnICsgdGhpcy5tb3ZlbWVudExpbWl0cy5pZCA6IHRoaXMubW92ZW1lbnRMaW1pdHM7XG4gIH1cbiAgcmV0dXJuIG9iajtcbn07XG5cbnZhciBfc2NhbGVPYmplY3Rfb3ZlcndyaXR0ZW4gPSBmYWJyaWMuQ2FudmFzLnByb3RvdHlwZS5fc2NhbGVPYmplY3Q7XG5cblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuT2JqZWN0LnByb3RvdHlwZSwge1xuICBzZXRXaG9sZUNvb3JkaW5hdGVzOiBmdW5jdGlvbih2YWwpe1xuICAgIHRoaXMud2hvbGVDb29yZGluYXRlcyA9IHZhbDtcbiAgICB0aGlzLm9uKFwiYWRkZWQgbW9kaWZpZWRcIixmdW5jdGlvbigpe1xuICAgICAgaWYodGhpcy53aG9sZUNvb3JkaW5hdGVzKXtcbiAgICAgICAgdGhpcy5zZXQoe1xuICAgICAgICAgIGxlZnQ6IE1hdGgucm91bmQodGhpcy5sZWZ0KSxcbiAgICAgICAgICB0b3A6IE1hdGgucm91bmQodGhpcy50b3ApLFxuICAgICAgICAgIHdpZHRoOiBNYXRoLnJvdW5kKHRoaXMud2lkdGgpLFxuICAgICAgICAgIGhlaWdodDogTWF0aC5yb3VuZCh0aGlzLmhlaWdodClcbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICB9LHRydWUpXG4gIH0sXG4gIC8vIHNldFRvcDogZnVuY3Rpb24odmFsKXtcbiAgLy8gICBpZih0aGlzLndob2xlQ29vcmRpbmF0ZXMpe1xuICAvLyAgICAgdmFsID0gTWF0aC5yb3VuZCh2YWwpO1xuICAvLyAgIH1cbiAgLy8gICB0aGlzLnRvcCA9IHZhbDtcbiAgLy8gfSxcbiAgLy8gc2V0TGVmdDogZnVuY3Rpb24odmFsKXtcbiAgLy8gICBpZih0aGlzLndob2xlQ29vcmRpbmF0ZXMpe1xuICAvLyAgICAgdmFsID0gTWF0aC5yb3VuZCh2YWwpO1xuICAvLyAgIH1cbiAgLy8gICB0aGlzLmxlZnQgPSB2YWw7XG4gIC8vIH0sXG4gIC8vIHNldFdpZHRoOiBmdW5jdGlvbih3KXtcbiAgLy8gICBpZih0aGlzLndob2xlQ29vcmRpbmF0ZXMpe1xuICAvLyAgICAgdyA9IE1hdGgucm91bmQodyk7XG4gIC8vICAgfVxuICAvLyAgIHRoaXMud2lkdGggPSB3O1xuICAvLyB9LFxuICAvLyBzZXRIZWlnaHQ6IGZ1bmN0aW9uKGgpe1xuICAvLyAgIGlmKHRoaXMud2hvbGVDb29yZGluYXRlcyl7XG4gIC8vICAgICBoID0gTWF0aC5yb3VuZChoKTtcbiAgLy8gICB9XG4gIC8vICAgdGhpcy5oZWlnaHQgPSBoO1xuICAvLyB9LFxuICAvLyBzcGVjaWFsUHJvcGVydGllczogZmFicmljLk9iamVjdC5wcm90b3R5cGUuc3BlY2lhbFByb3BlcnRpZXMuY29uY2F0KFtcIm1vdmVtZW50TGltaXRzXCJdKSxcblxuICBzZXRBY3RpdmU6IGZ1bmN0aW9uKHZhbHVlKXtcbiAgICBpZighdGhpcy5jYW52YXMpe1xuICAgICAgdGhpcy5vbihcImFkZGVkXCIsZnVuY3Rpb24oKXtcbiAgICAgICAgdGhpcy5jYW52YXMuc2V0QWN0aXZlT2JqZWN0KHRoaXMpO1xuICAgICAgfSlcbiAgICB9XG5cbiAgICB0aGlzLmFjdGl2ZSA9IHZhbHVlO1xuXG4gIH0sXG4gIHNldFBvc2l0aW9uOiBmdW5jdGlvbihfcG9zaXRpb24pe1xuICAgIGlmKF9wb3NpdGlvbiA9PT0gXCJjZW50ZXJcIikge1xuICAgICAgdGhpcy5vbihcImFkZGVkXCIsZnVuY3Rpb24oKXtcbiAgICAgICAgdGhpcy5jYW52YXMuZml0T2JqZWN0KHRoaXMpO1xuICAgICAgfSlcbiAgICB9XG4gIH0sXG5cbiAgc2V0TW92ZW1lbnRMaW1pdHM6IGZ1bmN0aW9uICh2YWwpIHtcblxuXG4gICAgaWYoIXRoaXMubW92ZW1lbnRMaW1pdHMpe1xuICAgICAgdGhpcy5vbih7XG4gICAgICAgIGFkZGVkOiBmdW5jdGlvbigpe1xuICAgICAgICAgIGlmKCB0aGlzLmNhbnZhcy5pbnRlcmFjdGl2ZSl7XG4gICAgICAgICAgICB0aGlzLmNhbnZhcy5fY2hlY2tfb2JqZWN0X3Bvc2l0aW9uKHRoaXMpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgcm90YXRlZDogZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgdmFyIHRhcmdldCA9IHRoaXM7XG5cbiAgICAgICAgICBpZiAodGFyZ2V0LnJlc2l6YWJsZSkge1xuICAgICAgICAgICAgaWYgKHBvcy5sZWZ0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgaWYgKHRhcmdldC5sZWZ0IDwgcG9zLmxlZnQpIHtcbiAgICAgICAgICAgICAgICB0YXJnZXQud2lkdGggKz0gdGFyZ2V0LmxlZnQgLSBwb3MubGVmdDtcbiAgICAgICAgICAgICAgICB0YXJnZXQubGVmdCA9IHBvcy5sZWZ0O1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRhcmdldC53aWR0aCAtPSB0YXJnZXQubGVmdCAtIHBvcy5sZWZ0O1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocG9zLnRvcCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgIGlmICh0YXJnZXQudG9wIDwgcG9zLnRvcCkge1xuICAgICAgICAgICAgICAgIHRhcmdldC5oZWlnaHQgKz0gdGFyZ2V0LnRvcCAtIHBvcy50b3A7XG4gICAgICAgICAgICAgICAgdGFyZ2V0LnRvcCA9IHBvcy50b3A7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGFyZ2V0LmhlaWdodCAtPSB0YXJnZXQudG9wIC0gcG9zLnRvcDtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICB0aGlzLmNhbnZhcy5fY2hlY2tfb2JqZWN0X3Bvc2l0aW9uKHRoaXMpXG4gICAgICAgIH0sXG4gICAgICAgIG1vZGlmaWVkOiBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICB0aGlzLmNhbnZhcy5fY2hlY2tfb2JqZWN0X2FmdGVyX21vZGlmaWVkKHRoaXMpXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgICB0aGlzLm1vdmVtZW50TGltaXRzID0gdmFsO1xuXG4gICAvKiBpZih0aGlzLmNhbnZhcyl7XG4gICAgICB0aGlzLl9zZXRNb3ZlbWVudExpbWl0c1N0cmluZygpO1xuICAgIH0qL1xuXG4gIH1cbn0pO1xuXG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLlN0YXRpY0NhbnZhcy5wcm90b3R5cGUsIHtcbiAgZml0T2JqZWN0OiBmdW5jdGlvbiAoZWwpIHtcbiAgICB2YXIgX3JlY3QsIG1heFNpemUsIG8gPSB0aGlzLm9mZnNldHM7XG5cbiAgICBpZighZWwubW92ZW1lbnRMaW1pdHMgfHwgZWwubW92ZW1lbnRMaW1pdHMgPT0gXCJjYW52YXNcIil7XG4gICAgICB2YXIgX3pvb20gPSB0aGlzLmdldFpvb20oKTtcbiAgICAgIHZhciBfdyA9IHRoaXMub3JpZ2luYWxXaWR0aCB8fCB0aGlzLndpZHRoIC8gX3pvb207XG4gICAgICB2YXIgX2ggPSB0aGlzLm9yaWdpbmFsSGVpZ2h0IHx8IHRoaXMuaGVpZ2h0IC8gX3pvb207XG4gICAgICBfcmVjdCA9IHtcbiAgICAgICAgd2lkdGg6IG8gPyAoX3cgLSBvLmxlZnQgLSBvLnJpZ2h0KSA6IF93LFxuICAgICAgICBoZWlnaHQ6IG8gPyhfaCAtIG8udG9wIC0gby5ib3R0b20pIDogX2hcbiAgICAgIH07XG4gICAgICAvKiBvZmZzZXRzID0ge1xuICAgICAgIGxlZnQ6IG8gJiYgby50b3AgfHwwICxcbiAgICAgICB0b3A6ICBvICYmICBvLmxlZnQgfHwwXG4gICAgICAgfSovXG4gICAgfWVsc2UgaWYoZWwubW92ZW1lbnRMaW1pdHMuY29uc3RydWN0b3IgIT09IEZ1bmN0aW9uKXtcbiAgICAgIHZhciBsaW0gPSBlbC5tb3ZlbWVudExpbWl0cztcbiAgICAgIF9yZWN0ID0ge1xuICAgICAgICBsZWZ0OiAgIGxpbS5sZWZ0ICogbGltLnNjYWxlWCxcbiAgICAgICAgd2lkdGg6ICBsaW0ud2lkdGggKiBsaW0uc2NhbGVYICxcbiAgICAgICAgdG9wOiAgICBsaW0udG9wICogbGltLnNjYWxlWSxcbiAgICAgICAgaGVpZ2h0OiBsaW0uaGVpZ2h0ICogbGltLnNjYWxlWVxuICAgICAgfTtcbiAgICAgIC8vbWF4U2l6ZSA9IF9yZWN0O1xuICAgICAgLy8gb2Zmc2V0cyA9IGxpbTtcbiAgICB9XG4gICAgbWF4U2l6ZSA9IHtcbiAgICAgIHdpZHRoOiBfcmVjdC53aWR0aCAqIHRoaXMuZml0SW5kZXgsXG4gICAgICBoZWlnaHQ6IF9yZWN0LmhlaWdodCAqIHRoaXMuZml0SW5kZXhcbiAgICB9O1xuICAgIHZhciBzaXplID0gZmFicmljLnV0aWwuZ2V0UHJvcG9ydGlvbnMoZWwsIG1heFNpemUsICdmaXQnKTtcblxuICAgIGlmKGVsLnJlc2l6YWJsZSl7XG4gICAgICBlbC5zZXRPcHRpb25zKHtcbiAgICAgICAgd2lkdGg6IGVsLndpZHRoICogc2l6ZS5zY2FsZSxcbiAgICAgICAgaGVpZ2h0OiBlbC5oZWlnaHQgKiBzaXplLnNjYWxlXG4gICAgICB9KTtcbiAgICAgIGVsLnVwZGF0ZUVsZW1lbnQoKTtcbiAgICB9ZWxzZXtcbiAgICAgIGVsLnNldE9wdGlvbnMoe1xuICAgICAgICBzY2FsZVg6IHNpemUuc2NhbGUsXG4gICAgICAgIHNjYWxlWTogc2l6ZS5zY2FsZVxuICAgICAgfSk7XG4gICAgfVxuICAgIHRoaXMuY2VudGVyT2JqZWN0KGVsKTtcbiAgICBlbC5zZXRDb29yZHMoKTtcbiAgfSxcbiAgLy9maXggZ2V0Y2VudGVyIGZ1bmN0aW9uXG4gIGNlbnRlck9iamVjdDogZnVuY3Rpb24gKG9iamVjdCkge1xuICAgIHZhciBjZW50ZXI7XG4gICAgaWYgKG9iamVjdC5tb3ZlbWVudExpbWl0cykge1xuXG4gICAgICBjZW50ZXIgPSB0aGlzLl9nZXRNb3ZlbWVudHNMaW1pdHNDZW50ZXIob2JqZWN0Lm1vdmVtZW50TGltaXRzKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY2VudGVyID0gdGhpcy5nZXRDZW50ZXIoKTtcbiAgICB9XG4gICAgdGhpcy5fY2VudGVyT2JqZWN0KG9iamVjdCwgbmV3IGZhYnJpYy5Qb2ludChjZW50ZXIubGVmdCwgY2VudGVyLnRvcCkpO1xuICAgIHRoaXMucmVuZGVyQWxsKCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG4gIGdldENlbnRlcjogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB7XG4gICAgICB0b3A6IHRoaXMub3JpZ2luYWxIZWlnaHQgLyAyIC8gdGhpcy5nZXRab29tKCksXG4gICAgICBsZWZ0OiB0aGlzLm9yaWdpbmFsV2lkdGggLyAyIC8gdGhpcy5nZXRab29tKClcbiAgICB9O1xuICB9LFxuXG4gIG1vdmVtZW50TGltaXRzOiB7XG4gICAgbGVmdDogZmFsc2UsXG4gICAgdG9wOiBmYWxzZSxcbiAgICByaWdodDogZmFsc2UsXG4gICAgYm90dG9tOiBmYWxzZVxuICB9LFxuICBzZXRNb3ZlbWVudExpbWl0czogZnVuY3Rpb24gKF9vZmZzZXRzKSB7XG4gICAgdGhpcy5tb3ZlbWVudExpbWl0cyA9IF9vZmZzZXRzO1xuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG4gIC8vY29udGVudCDRhdC+0YLRjyDQsdGLICDQv9C40LrRgdC10LvRjCDQvtCx0YrQtdC60YLQsCDQtNC+0LvQttC10L0g0LHRi9GC0Ywg0LLQvdGD0YLRgNC4INC30L7QvdGLXG4gIC8vZml0INC30L7QvdCwINC00L7Qu9C20L3QviDQv9C+0LvQvdC+0YHRgtGM0Y4g0L3QsNGF0L7QtNC40YLRgdGPINCy0L3Rg9GC0YDQuCDQvtCx0YrQtdC60YLQsFxuICBtb3ZlbWVudExpbWl0TW9kZTogXCJmaXRcIixcbiAgX2dldE1vdmVtZW50c0xpbWl0c0NlbnRlcjogZnVuY3Rpb24obW92ZW1lbnRMaW1pdHMpe1xuXG4gICAgdmFyIG8gPSB0aGlzLm9mZnNldHM7XG4gICAgaWYgKG1vdmVtZW50TGltaXRzID09PSAnY2FudmFzJykge1xuICAgICAgdmFyIF93ID0gdGhpcy5vcmlnaW5hbFdpZHRoIHx8IHRoaXMud2lkdGg7XG4gICAgICB2YXIgX2ggPSB0aGlzLm9yaWdpbmFsSGVpZ2h0IHx8IHRoaXMuaGVpZ2h0O1xuICAgICAgcmV0dXJuIHt0b3A6IG8udG9wICsgKF9oIC0gby50b3AgLSBvLmJvdHRvbSkgLzIgICwgbGVmdDogIG8ubGVmdCArIChfdyAtIG8ubGVmdCAtIG8ucmlnaHQpIC8yfTtcbiAgICB9ZWxzZXtcbiAgICAgIHZhciBvYmogPSB0aGlzLmdldE9iamVjdEJ5SUQobW92ZW1lbnRMaW1pdHMpO1xuICAgICAgdmFyIF94eSA9IG9iai5nZXRDZW50ZXJQb2ludCgpO1xuICAgICAgcmV0dXJuIHt0b3A6IF94eS55LCBsZWZ0OiBfeHkueH07XG4gICAgfVxuICB9LFxuICBfZ2V0TW92ZW1lbnRzTGltaXRzUmVjdDogZnVuY3Rpb24obW92ZW1lbnRMaW1pdHMpe1xuXG4gICAgdmFyIG8gPSB0aGlzLm9mZnNldHM7XG4gICAgdmFyIF93ID0gdGhpcy5vcmlnaW5hbFdpZHRoIHx8IHRoaXMud2lkdGg7XG4gICAgdmFyIF9oID0gdGhpcy5vcmlnaW5hbEhlaWdodCB8fCB0aGlzLmhlaWdodDtcblxuICAgIGlmKG1vdmVtZW50TGltaXRzLmNvbnN0cnVjdG9yICE9PSBTdHJpbmcpe1xuICAgICAgcmV0dXJuIG1vdmVtZW50TGltaXRzO1xuICAgIH1cblxuICAgIHZhciBzY2FsZSA9IHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bMF07XG5cbiAgICBpZiAobW92ZW1lbnRMaW1pdHMgPT09ICdjYW52YXMnKSB7XG5cbiAgICAgIHZhciByZWN0ID0ge1xuICAgICAgICBsZWZ0OiBvLmxlZnQsXG4gICAgICAgIHRvcDogby50b3AsXG4gICAgICAgIHdpZHRoOiBfdyAtIG8ubGVmdCAtIG8ucmlnaHQsXG4gICAgICAgIGhlaWdodDogX2ggLSBvLnRvcCAtIG8uYm90dG9tLFxuICAgICAgICByaWdodDogby5yaWdodCxcbiAgICAgICAgYm90dG9tOiBvLmJvdHRvbVxuICAgICAgfVxuXG4gICAgICByZWN0LndpZHRoICo9IHNjYWxlO1xuICAgICAgcmVjdC5oZWlnaHQgKj0gc2NhbGU7XG4gICAgICByZXR1cm4gcmVjdDtcbiAgICB9ZWxzZXtcbiAgICAgIHZhciBvYmogPSB0aGlzLmdldE9iamVjdEJ5SUQobW92ZW1lbnRMaW1pdHMpO1xuICAgICAgdmFyIF9zdHJva2Vfd2lkdGggPSBvYmouc3Ryb2tlV2lkdGg7XG4gICAgICBvYmouc3Ryb2tlV2lkdGggPSAwO1xuXG4gICAgICBvYmouc2V0Q29vcmRzKCk7XG4gICAgICB2YXIgcmVjdCA9IG9iai5nZXRCb3VuZGluZ1JlY3QoKTtcblxuICAgICAgb2JqLnN0cm9rZVdpZHRoID0gX3N0cm9rZV93aWR0aDtcblxuXG4gICAgICByZWN0LmxlZnQgLz0gc2NhbGU7XG4gICAgICByZWN0LnRvcCAvPSBzY2FsZTtcbiAgICAgIHJlY3Qud2lkdGggLz0gc2NhbGU7XG4gICAgICByZWN0LmhlaWdodCAvPSBzY2FsZTtcbiAgICAgIHJlY3QubGVmdCAtPSB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzRdIC8gc2NhbGU7XG4gICAgICByZWN0LnRvcCAtPSB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzVdIC8gc2NhbGU7XG5cbiAgICAgIC8vcmVjdC5sZWZ0ICAgKz0gc3cgLzI7XG4gICAgICAvL3JlY3QudG9wICAgICs9IHN3IC8yO1xuICAgICAgLy9yZWN0LndpZHRoICAtPSBzdztcbiAgICAgIC8vcmVjdC5oZWlnaHQgLT0gc3c7XG5cbiAgICAgIHJlY3QucmlnaHQgPSBfdyAtIChyZWN0LmxlZnQgKyByZWN0LndpZHRoKTtcbiAgICAgIHJlY3QuYm90dG9tID0gX2ggLSAocmVjdC50b3AgKyByZWN0LmhlaWdodCk7XG5cbiAgICAgIHJldHVybiByZWN0O1xuICAgIH1cbiAgfSxcbiAgY29udGVudE9mZnNldHMgOiA1LFxuICBnZXRGaXhlZFBvc2l0aW9uOiBmdW5jdGlvbiAodGFyZ2V0LCB4LCB5KSB7XG5cbiAgICB2YXIgX3cgPSB0aGlzLm9yaWdpbmFsV2lkdGggfHwgdGhpcy53aWR0aDtcbiAgICB2YXIgX2ggPSB0aGlzLm9yaWdpbmFsSGVpZ2h0IHx8IHRoaXMuaGVpZ2h0O1xuXG5cbiAgICBpZiAoeCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICB4ID0gdGFyZ2V0LmxlZnQ7XG4gICAgfVxuICAgIGlmICh5ID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHkgPSB0YXJnZXQudG9wO1xuICAgIH1cbiAgICB2YXIgc2NhbGUgPSB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzBdO1xuICAgIHRhcmdldC5zZXRDb29yZHMoKTtcbiAgICB2YXIgYm91bmRzID0gdGFyZ2V0LmdldEJvdW5kaW5nUmVjdCgpO1xuICAgIGJvdW5kcy5sZWZ0IC89IHNjYWxlO1xuICAgIGJvdW5kcy50b3AgLz0gc2NhbGU7XG4gICAgYm91bmRzLndpZHRoIC89IHNjYWxlO1xuICAgIGJvdW5kcy5oZWlnaHQgLz0gc2NhbGU7XG5cbiAgICBib3VuZHMubGVmdCAtPSB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzRdIC8gc2NhbGU7XG4gICAgYm91bmRzLnRvcCAtPSB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzVdIC8gc2NhbGU7XG4gICAgYm91bmRzLnJpZ2h0ID0gX3cgLSAoYm91bmRzLmxlZnQgKyBib3VuZHMud2lkdGgpO1xuICAgIGJvdW5kcy5ib3R0b20gPSBfaCAtIChib3VuZHMudG9wICsgYm91bmRzLmhlaWdodCk7XG5cblxuICAgIHZhciBsaW1pdHMgPSB0aGlzLl9nZXRNb3ZlbWVudHNMaW1pdHNSZWN0KHRhcmdldC5tb3ZlbWVudExpbWl0cyB8fCB0aGlzLm1vdmVtZW50TGltaXRzKTtcbiAgICAvLyB2YXIgbGltaXRzID0gcmVjdCB8fCB0aGlzLm1vdmVtZW50TGltaXRzO1xuXG4gICAgdmFyIG5ld1BvcyA9IHt9O1xuICAgIHZhciBfbCA9IGxpbWl0cy5sZWZ0LCBfciA9IGxpbWl0cy5yaWdodDtcbiAgICB2YXIgX3QgPSBsaW1pdHMudG9wLCBfYiA9IGxpbWl0cy5ib3R0b207XG5cbiAgICBpZiAodGFyZ2V0Lm1vdmVtZW50TGltaXRNb2RlID09PSBcImNvbnRlbnRcIikge1xuICAgICAgX2wgLT0gYm91bmRzLndpZHRoIC0gdGhpcy5jb250ZW50T2Zmc2V0c1xuICAgICAgX3IgLT0gYm91bmRzLndpZHRoIC0gdGhpcy5jb250ZW50T2Zmc2V0c1xuICAgICAgX3QgLT0gYm91bmRzLmhlaWdodCAtIHRoaXMuY29udGVudE9mZnNldHNcbiAgICAgIF9iIC09IGJvdW5kcy5oZWlnaHQgLSB0aGlzLmNvbnRlbnRPZmZzZXRzXG4gICAgfVxuXG4gICAgaWYgKHRhcmdldC5tb3ZlbWVudExpbWl0TW9kZSA9PT0gXCJmaXRcIiAmJiAhdGFyZ2V0LnJlc2l6YWJsZSkge1xuICAgICAgaWYgKF9sICE9PSBmYWxzZSAmJiBfciAhPT0gZmFsc2UpIHtcbiAgICAgICAgdmFyIF93ID0gX3cgLSBfbCAtIF9yO1xuICAgICAgICBpZiAoYm91bmRzLndpZHRoID4gX3cpIHtcbiAgICAgICAgICB2YXIgX2FzcCA9IF93IC8gYm91bmRzLndpZHRoO1xuICAgICAgICAgIG5ld1Bvcy5zY2FsZVggPSBfYXNwO1xuICAgICAgICAgIG5ld1Bvcy5zY2FsZVkgPSBfYXNwO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmIChfdCAhPT0gZmFsc2UgJiYgX2IgIT09IGZhbHNlKSB7XG4gICAgICAgIHZhciBfaCA9IF9oIC0gX3QgLSBfYjtcbiAgICAgICAgaWYgKGJvdW5kcy5oZWlnaHQgPiBfaCkge1xuICAgICAgICAgIHZhciBfYXNwID0gX2ggLyBib3VuZHMuaGVpZ2h0O1xuICAgICAgICAgIHRhcmdldC5zY2FsZVggKj0gX2FzcDtcbiAgICAgICAgICB0YXJnZXQuc2NhbGVZICo9IF9hc3A7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAodGFyZ2V0Lm1vdmVtZW50TGltaXRNb2RlID09PSBcImZpdFwiIHx8IHRhcmdldC5tb3ZlbWVudExpbWl0TW9kZSA9PT0gXCJjb250ZW50XCIpIHtcblxuICAgICAgaWYgKF9sICE9PSBmYWxzZSkge1xuICAgICAgICB2YXIgX2RpZmYgPSBfbCAtIGJvdW5kcy5sZWZ0O1xuICAgICAgICBpZiAoX2RpZmYgPiAwKSB7XG4gICAgICAgICAgbmV3UG9zLmxlZnQgPSB4ICsgX2RpZmY7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKCFuZXdQb3MubGVmdCAmJiBfciAhPT0gZmFsc2UpIHtcbiAgICAgICAgdmFyIF9kaWZmID0gX3IgLSBib3VuZHMucmlnaHQ7XG4gICAgICAgIGlmIChfZGlmZiA+IDApIHtcbiAgICAgICAgICBuZXdQb3MubGVmdCA9IHggLSBfZGlmZjtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAoX3QgIT09IGZhbHNlKSB7XG4gICAgICAgIHZhciBfZGlmZiA9IF90IC0gYm91bmRzLnRvcDtcbiAgICAgICAgaWYgKF9kaWZmID4gMCkge1xuICAgICAgICAgIG5ld1Bvcy50b3AgPSB5ICsgX2RpZmY7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKCFuZXdQb3MudG9wICYmIF9iICE9PSBmYWxzZSkge1xuICAgICAgICB2YXIgX2RpZmYgPSBfYiAtIGJvdW5kcy5ib3R0b207XG4gICAgICAgIGlmIChfZGlmZiA+IDApIHtcbiAgICAgICAgICBuZXdQb3MudG9wID0geSAtIF9kaWZmO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICB9XG5cbiAgICByZXR1cm4gbmV3UG9zO1xuICB9LFxuXG5cbiAgLy8gX3Jlc3RvcmVPcmlnaW5YWU5hdGl2ZTogX3Jlc3RvcmVPcmlnaW5YWU5hdGl2ZSxcbiAgLy8gX3Jlc3RvcmVPcmlnaW5YWTogZnVuY3Rpb24gKHRhcmdldCkge1xuICAvLyAgIHRoaXMuX3Jlc3RvcmVPcmlnaW5YWU5hdGl2ZSh0YXJnZXQpO1xuICAvL1xuICAvLyAgIC8vIGlmICh0YXJnZXQud2hvbGVDb29yZGluYXRlcykge1xuICAvLyAgIC8vICAgdGFyZ2V0LmxlZnQgPSBNYXRoLnJvdW5kKHRhcmdldC5sZWZ0KTtcbiAgLy8gICAvLyAgIHRhcmdldC50b3AgPSBNYXRoLnJvdW5kKHRhcmdldC50b3ApO1xuICAvLyAgIC8vIH1cbiAgLy8gfSxcblxuICAvKipcbiAgICogU2V0cyB0aGUgcG9zaXRpb24gb2YgdGhlIG9iamVjdCB0YWtpbmcgaW50byBjb25zaWRlcmF0aW9uIHRoZSBvYmplY3QncyBvcmlnaW5cbiAgICogQHBhcmFtIHtmYWJyaWMuUG9pbnR9IHBvcyBUaGUgbmV3IHBvc2l0aW9uIG9mIHRoZSBvYmplY3RcbiAgICogQHBhcmFtIHtTdHJpbmd9IG9yaWdpblggSG9yaXpvbnRhbCBvcmlnaW46ICdsZWZ0JywgJ2NlbnRlcicgb3IgJ3JpZ2h0J1xuICAgKiBAcGFyYW0ge1N0cmluZ30gb3JpZ2luWSBWZXJ0aWNhbCBvcmlnaW46ICd0b3AnLCAnY2VudGVyJyBvciAnYm90dG9tJ1xuICAgKiBAcmV0dXJuIHt2b2lkfVxuICAgKi9cbiAgc2V0UG9zaXRpb25CeU9yaWdpbjogZnVuY3Rpb24gKHBvcywgb3JpZ2luWCwgb3JpZ2luWSkge1xuICAgIHZhciBjZW50ZXIgPSB0aGlzLnRyYW5zbGF0ZVRvQ2VudGVyUG9pbnQocG9zLCBvcmlnaW5YLCBvcmlnaW5ZKSxcbiAgICAgIHBvc2l0aW9uID0gdGhpcy50cmFuc2xhdGVUb09yaWdpblBvaW50KGNlbnRlciwgdGhpcy5vcmlnaW5YLCB0aGlzLm9yaWdpblkpO1xuXG4gICAgLy8gaWYgKHRoaXMud2hvbGVDb29yZGluYXRlcykge1xuICAgIC8vICAgcG9zaXRpb24ueCA9IE1hdGgucm91bmQocG9zaXRpb24ueCk7XG4gICAgLy8gICBwb3NpdGlvbi55ID0gTWF0aC5yb3VuZChwb3NpdGlvbi55KTtcbiAgICAvLyB9XG4gICAgdGhpcy5zZXQoJ2xlZnQnLCBwb3NpdGlvbi54KTtcbiAgICB0aGlzLnNldCgndG9wJywgcG9zaXRpb24ueSk7XG4gIH1cbn0pO1xuXG52YXIgX3RyYW5zbGF0ZU9iamVjdF9vdmVyd3JpdHRlbiA9IGZhYnJpYy5DYW52YXMucHJvdG90eXBlLl90cmFuc2xhdGVPYmplY3Q7XG52YXIgX2JlZm9yZVNjYWxlVHJhbnNmb3JtX292ZXJ3cml0dGVuID0gZmFicmljLkNhbnZhcy5wcm90b3R5cGUuX2JlZm9yZVNjYWxlVHJhbnNmb3JtO1xudmFyIF9iZWZvcmVUcmFuc2Zvcm1fb3ZlcndyaXR0ZW4gPSBmYWJyaWMuQ2FudmFzLnByb3RvdHlwZS5fYmVmb3JlVHJhbnNmb3JtO1xudmFyIF9yZXN0b3JlT3JpZ2luWFlOYXRpdmUgPSBmYWJyaWMuQ2FudmFzLnByb3RvdHlwZS5fcmVzdG9yZU9yaWdpblhZO1xuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuU2xpZGVDYW52YXMucHJvdG90eXBlLCB7XG4gIF9iZWZvcmVTY2FsZVRyYW5zZm9ybV9vdmVyd3JpdHRlbjogX2JlZm9yZVNjYWxlVHJhbnNmb3JtX292ZXJ3cml0dGVuLFxuICBfYmVmb3JlU2NhbGVUcmFuc2Zvcm06IGZ1bmN0aW9uIChlLCB0cmFuc2Zvcm0pIHtcbiAgICB0aGlzLl9iZWZvcmVTY2FsZVRyYW5zZm9ybV9vdmVyd3JpdHRlbihlLCB0cmFuc2Zvcm0pO1xuICAgIGlmICghdGhpcy5fY3VycmVudFRyYW5zZm9ybS5vcmlnaW5hbC5vQ29vcmRzKSB7XG4gICAgICB0aGlzLl9jdXJyZW50VHJhbnNmb3JtLm9yaWdpbmFsLm9Db29yZHMgPSBmYWJyaWMudXRpbC5vYmplY3QuY2xvbmVEZWVwKHRoaXMuX2N1cnJlbnRUcmFuc2Zvcm0udGFyZ2V0Lm9Db29yZHMpO1xuICAgIH1cbiAgfSxcbiAgZ2V0Rml4ZWRQb3NpdGlvbkVhc3k6IGZ1bmN0aW9uICh0YXJnZXQsIHgsIHkpIHtcbiAgICB2YXIgX3cgPSB0aGlzLm9yaWdpbmFsV2lkdGggfHwgdGhpcy53aWR0aDtcbiAgICB2YXIgX2ggPSB0aGlzLm9yaWdpbmFsSGVpZ2h0IHx8IHRoaXMuaGVpZ2h0O1xuXG4gICAgaWYgKHggPT09IHVuZGVmaW5lZCkge1xuICAgICAgeCA9IHRhcmdldC5sZWZ0O1xuICAgIH1cbiAgICBpZiAoeSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICB5ID0gdGFyZ2V0LnRvcDtcbiAgICB9XG4gICAgdmFyIHNjYWxlID0gdGhpcy52aWV3cG9ydFRyYW5zZm9ybVswXTtcbiAgICB0YXJnZXQuc2V0Q29vcmRzKCk7XG4gICAgdGFyZ2V0LnJpZ2h0ID0gX3cgLSAodGFyZ2V0LmxlZnQgKyB0YXJnZXQud2lkdGgpO1xuICAgIHRhcmdldC5ib3R0b20gPSBfaCAtICh0YXJnZXQudG9wICsgdGFyZ2V0LmhlaWdodCk7XG5cbiAgICB2YXIgX2RpZmYsIF9hc3AsIHJlY3Q7XG4gICAgdmFyIG5ld1BvcyA9IHtcbiAgICAgIGxlZnQ6IHgsXG4gICAgICB0b3A6IHksXG4gICAgICB3aWR0aDogdGFyZ2V0LndpZHRoLFxuICAgICAgaGVpZ2h0OiB0YXJnZXQuaGVpZ2h0XG4gICAgfTtcblxuICAgIGlmICh0YXJnZXQud2lkdGggPiBfdykge1xuICAgICAgbmV3UG9zLndpZHRoID0gX3c7XG4gICAgfVxuICAgIGlmICh0YXJnZXQuaGVpZ2h0ID4gX2gpIHtcbiAgICAgIG5ld1Bvcy5oZWlnaHQgPSBfaDtcbiAgICB9XG4gICAgaWYgKHRhcmdldC5sZWZ0IDwgMCkge1xuICAgICAgbmV3UG9zLndpZHRoICs9IHRhcmdldC5sZWZ0O1xuICAgICAgbmV3UG9zLmxlZnQgLT0gdGFyZ2V0LmxlZnQ7XG4gICAgfVxuICAgIGlmICh0YXJnZXQucmlnaHQgPCAwKSB7XG4gICAgICBuZXdQb3Mud2lkdGggKz0gdGFyZ2V0LnJpZ2h0O1xuICAgIH1cbiAgICBpZiAodGFyZ2V0LnRvcCA8IDApIHtcbiAgICAgIG5ld1Bvcy5oZWlnaHQgKz0gdGFyZ2V0LnRvcDtcbiAgICB9XG4gICAgaWYgKHRhcmdldC5ib3R0b20gPCAwKSB7XG4gICAgICBuZXdQb3MuaGVpZ2h0ICs9IHRhcmdldC5ib3R0b207XG4gICAgfVxuICAgIHJldHVybiBuZXdQb3M7XG4gIH0sXG4gIC8qKlxuICAgKiDRhNGD0L3QutGG0LjRjiDQvNC+0LbQvdC+INCy0YvQt9Cy0LDRgtGMINGBINC10LLQtdC90YLQvtC8ICAnYWZ0ZXI6cmVuZGVyJy4g0J/QvtC30LLQvtC70Y/QtdGCINC+0YLQvtCx0YDQsNC20LDRgtGMINCy0YvRh9C40YHQu9C10L3QuNGPINC/0LXRgNC10YHQtdGH0LXQvdC40Lkg0LjQt9C80LXQvdGP0LXQvNC+0LPQviDQvtCx0YrQtdC60YLQsCDRgSDRgNCw0LzQutC+0LkuINCy0YvQtNC10LvRj9C10YIg0LrRgNCw0YHQvdGL0LzQuCDQu9C40LjQvdC40Y/QuFxuICAgKiBAcHJpdmF0ZVxuICAgKiBAZXhhbXBsZVxuICAgKiAgZXZlbnRMaXN0ZW5lcnMgOiB7XG4gICAgQ2FudmFzOiB7XG4gICAgICAnYmVmb3JlOnJlbmRlcic6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHRoaXMuY2xlYXJDb250ZXh0KHRoaXMuY29udGV4dFRvcCk7XG4gICAgICB9LFxuICAgICAgJ2FmdGVyOnJlbmRlcic6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHRoaXMuX2RlYnVnX2ludGVyc2VjdGlvbnMoKVxuICAgICAgfVxuICAgIH1cbiAgfVxuICAgKi9cbiAgZHJhd0ludGVyZXN0aW9uTGluZXM6IGZ1bmN0aW9uKCl7XG4gICAgdmFyIHRyID0gdGhpcy5fY3VycmVudFRyYW5zZm9ybTtcbiAgICBpZiAodHIgJiYgdHIuX2ludGVyc2VjdGlvbnMpIHtcbiAgICAgIHZhciBjdHggPSB0aGlzLmNvbnRleHRUb3A7XG4gICAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgICBjdHguc3Ryb2tlU3R5bGUgPSBcInJlZFwiO1xuICAgICAgZm9yKHZhciBpIGluIHRyLl9pbnRlcnNlY3Rpb25zKXtcbiAgICAgICAgdmFyIF9jb29yZCA9IHRyLl9pbnRlcnNlY3Rpb25zW2ldO1xuICAgICAgICBjdHgubW92ZVRvKF9jb29yZC54ICsgNSwgX2Nvb3JkLnkpO1xuICAgICAgICBjdHguYXJjKF9jb29yZC54LCBfY29vcmQueSwgNSwgMCwgMiAqIE1hdGguUEkpO1xuICAgICAgfVxuICAgICAgZm9yKHZhciBpIGluIHRyLmxpbmVzKXtcbiAgICAgICAgdmFyIF9sID0gdHIubGluZXNbaV07XG4gICAgICAgIGN0eC5tb3ZlVG8oX2xbMF0ueCxfbFswXS55KTtcbiAgICAgICAgY3R4LmxpbmVUbyhfbFsxXS54LF9sWzFdLnkpO1xuICAgICAgfVxuICAgICAgZm9yKHZhciBpIGluIHRyLm1sTGluZXMpe1xuICAgICAgICB2YXIgX2wgPSB0ci5tbExpbmVzW2ldO1xuICAgICAgICBjdHgubW92ZVRvKF9sWzBdLngsX2xbMF0ueSk7XG4gICAgICAgIGN0eC5saW5lVG8oX2xbMV0ueCxfbFsxXS55KTtcbiAgICAgIH1cbiAgICAgIGN0eC5zdHJva2UoKTtcbiAgICB9XG4gIH0sXG4gIF9zY2FsZU9iamVjdEVhc3k6IGZ1bmN0aW9uICh4LCB5LCBieSkge1xuICAgIC8vX3NjYWxlT2JqZWN0X292ZXJ3cml0dGVuLmNhbGwodGhpcywgeCwgeSwgYnkpO1xuICAgIHZhciB0ciA9IHRoaXMuX2N1cnJlbnRUcmFuc2Zvcm0sXG4gICAgICB0YXJnZXQgPSB0ci50YXJnZXQsXG4gICAgICBjb3JuZXIgPSB0ci5jb3JuZXI7XG4gICAgaWYoIXRhcmdldC5tb3ZlbWVudExpbWl0cyl7XG4gICAgICByZXR1cm4gX3NjYWxlT2JqZWN0X292ZXJ3cml0dGVuLmNhbGwodGhpcywgeCx5LCBieSk7XG4gICAgfVxuXG5cbiAgICBpZiAodGFyZ2V0Lm1vdmVtZW50TGltaXRNb2RlICE9PSAnZml0JylyZXR1cm47XG4gICAgeCA9IE1hdGgubWluKHRhcmdldC5tb3ZlbWVudExpbWl0cy53aWR0aCwgTWF0aC5tYXgoMCx4KSk7XG4gICAgeSA9IE1hdGgubWluKHRhcmdldC5tb3ZlbWVudExpbWl0cy5oZWlnaHQsIE1hdGgubWF4KDAseSkpO1xuICAgIF9zY2FsZU9iamVjdF9vdmVyd3JpdHRlbi5jYWxsKHRoaXMsIHgseSwgYnkpO1xuICB9LFxuICAvKipcbiAgICogU2NhbGVzIG9iamVjdCBieSBpbnZva2luZyBpdHMgc2NhbGVYL3NjYWxlWSBtZXRob2RzXG4gICAqIEBwcml2YXRlXG4gICAqIEBwYXJhbSB7TnVtYmVyfSB4IHBvaW50ZXIncyB4IGNvb3JkaW5hdGVcbiAgICogQHBhcmFtIHtOdW1iZXJ9IHkgcG9pbnRlcidzIHkgY29vcmRpbmF0ZVxuICAgKiBAcGFyYW0ge1N0cmluZ30gYnkgRWl0aGVyICd4JyBvciAneScgLSBzcGVjaWZpZXMgZGltZW5zaW9uIGNvbnN0cmFpbnQgYnkgd2hpY2ggdG8gc2NhbGUgYW4gb2JqZWN0LlxuICAgKiAgICAgICAgICAgICAgICAgICAgV2hlbiBub3QgcHJvdmlkZWQsIGFuIG9iamVjdCBpcyBzY2FsZWQgYnkgYm90aCBkaW1lbnNpb25zIGVxdWFsbHlcbiAgICovXG4gIF9zY2FsZU9iamVjdDogZnVuY3Rpb24gKHgsIHksIGJ5KSB7XG4gICAgdmFyIF9zY2FsZWQgPSBfc2NhbGVPYmplY3Rfb3ZlcndyaXR0ZW4uY2FsbCh0aGlzLCB4LCB5LCBieSk7XG5cbiAgICB2YXIgdHIgPSB0aGlzLl9jdXJyZW50VHJhbnNmb3JtLFxuICAgICAgdGFyZ2V0ID0gdHIudGFyZ2V0LFxuICAgICAgY29ybmVyID0gdHIuY29ybmVyO1xuICAgIHZhciBfdiA9IHRoaXMudmlld3BvcnRUcmFuc2Zvcm07XG5cbiAgICBpZiAoIXRhcmdldC5tb3ZlbWVudExpbWl0cyB8fCB0YXJnZXQubW92ZW1lbnRMaW1pdE1vZGUgIT09IFwiZml0XCIpe1xuICAgICAgcmV0dXJuIF9zY2FsZWQ7XG4gICAgfVxuICAgIHRhcmdldC5zZXRDb29yZHMoKTtcblxuICAgIHZhciBfc2NhbGUgPSB0aGlzLmdldFpvb20oKTtcblxuICAgIGlmKHRhcmdldC5tb3ZlbWVudExpbWl0cyA9PSB0aGlzKXtcbiAgICAgIHZhciBfdyA9IHRoaXMub3JpZ2luYWxXaWR0aCB8fCB0aGlzLndpZHRoO1xuICAgICAgdmFyIF9oID0gdGhpcy5vcmlnaW5hbEhlaWdodCB8fCB0aGlzLmhlaWdodDtcbiAgICAgIHZhciBfbCA9IHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bNF0gO1xuICAgICAgdmFyIF90ID0gdGhpcy52aWV3cG9ydFRyYW5zZm9ybVs1XSA7XG4gICAgICBfdyAqPSBfc2NhbGU7XG4gICAgICBfaCAqPSBfc2NhbGU7XG4gICAgICB2YXIgX3JjID0ge1xuICAgICAgICB0bDoge3g6IF9sLCB5OiBfdH0sXG4gICAgICAgIHRyOiB7eDogX2wgKyBfdywgeTogX3R9LFxuICAgICAgICBibDoge3g6IF9sLCB5OiBfdCArIF9ofSxcbiAgICAgICAgYnI6IHt4OiBfbCArIF93LCB5OiBfdCArIF9ofVxuICAgICAgfVxuICAgIH1lbHNle1xuICAgICAgdGFyZ2V0Lm1vdmVtZW50TGltaXRzLnNldENvb3JkcygpO1xuICAgICAgdmFyIF9yYyA9IHRhcmdldC5tb3ZlbWVudExpbWl0cy5vQ29vcmRzO1xuICAgIH1cblxuXG4gICAgaWYgKCF0ci5wb2ludGVyT2Zmc2V0KSB7XG4gICAgICB0ci5wb2ludGVyT2Zmc2V0ID0ge1xuICAgICAgICB4OiB4ICogX3ZbMF0gLSB0YXJnZXQub0Nvb3Jkc1tjb3JuZXJdLngsXG4gICAgICAgIHk6IHkgKiBfdlszXSAtIHRhcmdldC5vQ29vcmRzW2Nvcm5lcl0ueVxuICAgICAgfVxuXG4gICAgICB0ci5wb2ludENlbnRlciA9IHRhcmdldC5nZXRDZW50ZXJQb2ludCgpO1xuICAgICAgdHIucG9pbnRDZW50ZXIueCAqPSBfc2NhbGU7XG4gICAgICB0ci5wb2ludENlbnRlci55ICo9IF9zY2FsZTtcbiAgICAgIHRyLnBvaW50T3JpZ2luYWwgPSB0ci5vcmlnaW5hbC5vQ29vcmRzW2Nvcm5lcl07XG4gICAgfVxuXG4gICAgdHIucG9pbnRUcmFuZm9ybWVkID0gdGFyZ2V0Lm9Db29yZHNbY29ybmVyXTtcblxuICAgIHRyLm1sTGluZXMgPSBbXTtcbiAgICB0ci5saW5lcyA9IFtdO1xuICAgIGZ1bmN0aW9uIF9pbnRlcnNlY3Rpb24oY29ybmVyLCBjb29yZGluYXRlKSB7XG4gICAgICB2YXIgX29jO1xuICAgICAgaWYgKGNvb3JkaW5hdGUgPT0gXCJ4XCIgJiYgY29ybmVyWzBdICE9IFwibVwiKSB7XG4gICAgICAgIF9vYyA9IHRyLm9yaWdpbmFsLm9Db29yZHNbXCJtXCIgKyBjb3JuZXJbMF1dO1xuICAgICAgfSBlbHNlIGlmIChjb29yZGluYXRlID09IFwieVwiICYmIGNvcm5lclswXSAhPSBcIm1cIikge1xuICAgICAgICBfb2MgPSB0ci5vcmlnaW5hbC5vQ29vcmRzW1wibVwiICsgY29ybmVyWzFdXTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIF9vYyA9IHRyLnBvaW50Q2VudGVyO1xuICAgICAgICBfb2MgPSB7XG4gICAgICAgICAgeDogX29jLnggKyBfdls0XSxcbiAgICAgICAgICB5OiBfb2MueSArIF92WzVdXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICB2YXIgX3RjID0gdGFyZ2V0Lm9Db29yZHNbY29ybmVyXTtcblxuICAgICAgdHIubGluZXMucHVzaChbX29jLCBfdGNdKTtcbiAgICAgIHRyLm1sTGluZXMucHVzaChbX3JjLnRsLCBfcmMudHJdKTtcbiAgICAgIHRyLm1sTGluZXMucHVzaChbX3JjLnRyLCBfcmMuYnJdKTtcbiAgICAgIHRyLm1sTGluZXMucHVzaChbX3JjLmJyLCBfcmMuYmxdKTtcbiAgICAgIHRyLm1sTGluZXMucHVzaChbX3JjLmJsLCBfcmMudGxdKTtcblxuICAgICAgdmFyIGludGVycyA9IGZhYnJpYy5JbnRlcnNlY3Rpb24uaW50ZXJzZWN0TGluZVBvbHlnb24oX29jLCBfdGMsIFtfcmMudGwsIF9yYy50ciwgX3JjLmJyLCBfcmMuYmxdKTtcbiAgICAgIGlmICghaW50ZXJzLnBvaW50cy5sZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaW50ZXJzLnBvaW50c1swXS5jb29yZGluYXRlID0gY29vcmRpbmF0ZTtcbiAgICAgIHRyLl9pbnRlcnNlY3Rpb25zLnB1c2goaW50ZXJzLnBvaW50c1swXSlcblxuLy8gICAgICAgICBpZiAoY29vcmRpbmF0ZSkge1xuLy8gICAgICAgICAgIHZhciBwMSA9IGludGVycy5wb2ludHNbMF07XG5cbi8vICAgICAgICAgICB2YXIgY29ybmVyMjtcbi8vICAgICAgICAgICBpZiAoY29vcmRpbmF0ZSA9PSBcInhcIikge1xuLy8gICAgICAgICAgICAgY29ybmVyMiA9IChjb3JuZXJbMF0gPT0gXCJ0XCIgPyBcImJcIiA6IFwidFwiKSArIGNvcm5lclsxXTtcbi8vICAgICAgICAgICB9IGVsc2Uge1xuLy8gICAgICAgICAgICAgY29ybmVyMiA9IGNvcm5lclswXSArIChjb3JuZXJbMV0gPT0gXCJsXCIgPyBcInJcIiA6IFwibFwiKTtcbi8vICAgICAgICAgICB9XG4vLyAgICAgICAgICAgdmFyIF9wMiA9IHRhcmdldC5vQ29vcmRzW2Nvcm5lcjJdO1xuLy8gICAgICAgICAgIHZhciBfZGlmZiA9IHt4OiBfdGMueCAtIHAxLngsIHk6IF90Yy55IC0gcDEueX07XG5cbi8vICAgICAgICAgICB2YXIgcDIgPSB7XG4vLyAgICAgICAgICAgICB4OiBfcDIueCAtIF9kaWZmLngsXG4vLyAgICAgICAgICAgICB5OiBfcDIueSAtIF9kaWZmLnlcbi8vICAgICAgICAgICB9O1xuXG4vLyAgICAgICAgICAgdmFyIGl0cyA9IGZhYnJpYy5JbnRlcnNlY3Rpb24uaW50ZXJzZWN0TGluZUxpbmUodHIucG9pbnRDZW50ZXIsIHRyLnBvaW50VHJhbmZvcm1lZCwgcDEsIHAyKTtcbi8vICAgICAgICAgICBpZiAoIWl0cy5wb2ludHNbMF0pIHtcbi8vICAgICAgICAgICAgIHJldHVybjtcbi8vICAgICAgICAgICB9XG4vLyAgICAgICAgICAgdHIuX2ludGVyc2VjdGlvbnMucHVzaChpdHMucG9pbnRzWzBdKTtcbi8vICAgICAgICAgfSBlbHNlIHtcbi8vICAgICAgICAgICB0ci5faW50ZXJzZWN0aW9ucy5wdXNoKGludGVycy5wb2ludHNbMF0pO1xuLy8gICAgICAgICB9XG5cblxuICAgICAgLy9cbiAgICAgIC8vaWYoaW50ZXJzLnBvaW50cy5sZW5ndGgpe1xuICAgICAgLy8gIF9zY2FsZU9iamVjdF9vdmVyd3JpdHRlbi5jYWxsKHRoaXMsIGludGVycy5wb2ludHNbMF0ueCwgIGludGVycy5wb2ludHNbMF0ueSwgYnkpO1xuICAgICAgLy8gIHRhcmdldC5zZXRDb29yZHMoKTtcbiAgICAgIC8vfWVsc2V7XG4gICAgICAvLyAgX3NjYWxlT2JqZWN0X292ZXJ3cml0dGVuLmNhbGwodGhpcywgeCwgeSwgYnkpO1xuICAgICAgLy99XG4gICAgfVxuXG5cbiAgICB0ci5faW50ZXJzZWN0aW9uID0gbnVsbDtcbiAgICB0ci5faW50ZXJzZWN0aW9ucyA9IFtdO1xuICAgIHN3aXRjaCAoY29ybmVyKSB7XG4gICAgICBjYXNlIFwidGxcIjpcbiAgICAgICAgX2ludGVyc2VjdGlvbihcInRsXCIpO1xuICAgICAgICBfaW50ZXJzZWN0aW9uKFwiYmxcIiwgXCJ4XCIpO1xuICAgICAgICBfaW50ZXJzZWN0aW9uKFwidHJcIiwgXCJ5XCIpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJ0clwiOlxuICAgICAgICBfaW50ZXJzZWN0aW9uKFwidHJcIik7XG4gICAgICAgIF9pbnRlcnNlY3Rpb24oXCJ0bFwiLCBcInlcIik7XG4gICAgICAgIF9pbnRlcnNlY3Rpb24oXCJiclwiLCBcInhcIik7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcImJyXCI6XG4gICAgICAgIF9pbnRlcnNlY3Rpb24oXCJiclwiKTtcbiAgICAgICAgX2ludGVyc2VjdGlvbihcInRyXCIsIFwieFwiKTtcbiAgICAgICAgX2ludGVyc2VjdGlvbihcImJsXCIsIFwieVwiKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwiYmxcIjpcbiAgICAgICAgX2ludGVyc2VjdGlvbihcImJsXCIpO1xuICAgICAgICBfaW50ZXJzZWN0aW9uKFwidGxcIiwgXCJ4XCIpO1xuICAgICAgICBfaW50ZXJzZWN0aW9uKFwiYnJcIiwgXCJ5XCIpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJtdFwiOlxuICAgICAgICBfaW50ZXJzZWN0aW9uKFwibXRcIik7XG4gICAgICAgIF9pbnRlcnNlY3Rpb24oXCJ0bFwiLCBcInlcIik7XG4gICAgICAgIF9pbnRlcnNlY3Rpb24oXCJ0clwiLCBcInlcIik7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcIm1iXCI6XG4gICAgICAgIF9pbnRlcnNlY3Rpb24oXCJtYlwiKTtcbiAgICAgICAgX2ludGVyc2VjdGlvbihcImJsXCIsIFwieVwiKTtcbiAgICAgICAgX2ludGVyc2VjdGlvbihcImJyXCIsIFwieVwiKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwibXJcIjpcbiAgICAgICAgX2ludGVyc2VjdGlvbihcIm1yXCIpO1xuICAgICAgICBfaW50ZXJzZWN0aW9uKFwidHJcIiwgXCJ4XCIpO1xuICAgICAgICBfaW50ZXJzZWN0aW9uKFwiYnJcIiwgXCJ4XCIpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJtbFwiOlxuICAgICAgICBfaW50ZXJzZWN0aW9uKFwibWxcIik7XG4gICAgICAgIF9pbnRlcnNlY3Rpb24oXCJ0bFwiLCBcInhcIik7XG4gICAgICAgIF9pbnRlcnNlY3Rpb24oXCJibFwiLCBcInhcIik7XG4gICAgfVxuXG4gICAgaWYgKCF0ci5faW50ZXJzZWN0aW9ucy5sZW5ndGgpIHtcbiAgICAgIHJldHVybiBfc2NhbGVkO1xuICAgIH1cblxuXG4gICAgdmFyIF9uZXdYWSA9IHRyLl9pbnRlcnNlY3Rpb25zWzBdO1xuICAgIHZhciBfbCA9IHRyLl9pbnRlcnNlY3Rpb25zWzBdLmRpc3RhbmNlRnJvbSh0ci5wb2ludE9yaWdpbmFsKTtcblxuICAgIGZvciAodmFyIGkgPSAxOyBpIDwgdHIuX2ludGVyc2VjdGlvbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciBfbDIgPSB0ci5faW50ZXJzZWN0aW9uc1tpXS5kaXN0YW5jZUZyb20odHIucG9pbnRPcmlnaW5hbCk7XG4gICAgICBpZiAoX2wyIDwgX2wpIHtcbiAgICAgICAgX25ld1hZID0gdHIuX2ludGVyc2VjdGlvbnNbaV07XG4gICAgICAgIF9sID0gX2wyO1xuICAgICAgfVxuICAgIH1cbiAgICB0ci5faW50ZXJzZWN0aW9uID0gX25ld1hZO1xuXG5cbiAgICBpZiAoYnkgPT0gXCJlcXVhbGx5XCIpIHtcbiAgICAgIC8vYnkgPSBmYWxzZTtcblxuICAgICAgdmFyIF9kaWZmMiA9IHt4OiBfbmV3WFkueCAtIHRyLnBvaW50Q2VudGVyLngsIHk6IF9uZXdYWS55IC0gdHIucG9pbnRDZW50ZXIueX07XG4gICAgICB2YXIgX2wgPSBNYXRoLnNxcnQoX2RpZmYyLnggKiBfZGlmZjIueCArIF9kaWZmMi55ICogX2RpZmYyLnkpO1xuXG4gICAgICBfbmV3WFkueCAtPSBfZGlmZjIueCAvIF9sICogdGFyZ2V0LnN0cm9rZVdpZHRoO1xuICAgICAgX25ld1hZLnkgLT0gX2RpZmYyLnkgLyBfbCAqIHRhcmdldC5zdHJva2VXaWR0aDtcbiAgICAgIC8vIHNjcnQoeCp4ICsgeSp5KSA9IGF0cm9rZXdpZHRoXG4gICAgICB2YXIgYSA9IDE7XG4gICAgfVxuICAgIC8vcmV0dXJuIF9zY2FsZU9iamVjdF9vdmVyd3JpdHRlbi5jYWxsKHRoaXMsIHgsIHksIGJ5KTtcbiAgICB2YXIgX194ID0gKF9uZXdYWS54ICsgdHIucG9pbnRlck9mZnNldC54ICkgLyBfdlswXTtcbiAgICB2YXIgX195ID0gKF9uZXdYWS55ICsgdHIucG9pbnRlck9mZnNldC55ICkgLyBfdlszXTtcbiAgICByZXR1cm4gX3NjYWxlT2JqZWN0X292ZXJ3cml0dGVuLmNhbGwodGhpcywgX194LCBfX3ksIGJ5KTtcblxuICAgIC8vXG4gICAgLy9pZiAoY29ybmVyID09IFwiYnJcIiB8fCBjb3JuZXIgPT0gXCJ0clwiIHx8IGNvcm5lciA9PSBcIm1yXCIpIHtcbiAgICAvLyAgaWYgKHggPCB0YXJnZXQubW92ZW1lbnRYTWF4TGltaXQpIHtcbiAgICAvLyAgICB4ID0gdGFyZ2V0Lm1vdmVtZW50WE1heExpbWl0O1xuICAgIC8vICB9XG4gICAgLy99XG4gICAgLy9pZiAoY29ybmVyID09IFwiYmxcIiB8fCBjb3JuZXIgPT0gXCJ0bFwiIHx8IGNvcm5lciA9PSBcIm1sXCIpIHtcbiAgICAvLyAgaWYgKHggPiB0YXJnZXQubW92ZW1lbnRYTWluTGltaXQpIHtcbiAgICAvLyAgICB4ID0gdGFyZ2V0Lm1vdmVtZW50WE1pbkxpbWl0O1xuICAgIC8vICB9XG4gICAgLy99XG4gICAgLy9pZiAoY29ybmVyID09IFwiYmxcIiB8fCBjb3JuZXIgPT0gXCJiclwiIHx8IGNvcm5lciA9PSBcIm1iXCIpIHtcbiAgICAvLyAgaWYgKHkgPCB0YXJnZXQubW92ZW1lbnRZTWF4TGltaXQpIHtcbiAgICAvLyAgICB5ID0gdGFyZ2V0Lm1vdmVtZW50WU1heExpbWl0O1xuICAgIC8vICB9XG4gICAgLy99XG4gICAgLy9pZiAoY29ybmVyID09IFwidGxcIiB8fCBjb3JuZXIgPT0gXCJ0clwiIHx8IGNvcm5lciA9PSBcIm10XCIpIHtcbiAgICAvLyAgaWYgKHkgPiB0YXJnZXQubW92ZW1lbnRZTWluTGltaXQpIHtcbiAgICAvLyAgICB5ID0gdGFyZ2V0Lm1vdmVtZW50WU1pbkxpbWl0O1xuICAgIC8vICB9XG4gICAgLy99XG4gICAgLy9cbiAgICAvL19zY2FsZU9iamVjdF9vdmVyd3JpdHRlbi5jYWxsKHRoaXMsIHgsIHksIGJ5KTtcbiAgfSxcbiAgbW92ZW1lbnRMaW1pdHNPbkFkZEFjdGlvbjogJ3RyYW5zbGF0ZScsXG4gIF9jaGVja19vYmplY3RfYWZ0ZXJfbW9kaWZpZWQ6IGZ1bmN0aW9uICh0YXJnZXQpIHtcbiAgICBpZiAoIXRoaXMuX2N1cnJlbnRUcmFuc2Zvcm0pIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdmFyIHBvcyA9IHRoaXMuZ2V0Rml4ZWRQb3NpdGlvbih0YXJnZXQsIHRhcmdldC5sZWZ0LCB0YXJnZXQudG9wKTtcblxuICAgIHN3aXRjaCAodGhpcy5fY3VycmVudFRyYW5zZm9ybS5jb3JuZXIpIHtcbiAgICAgIGNhc2UgXCJtdHJcIjpcbiAgICAgICAgaWYgKHBvcy5sZWZ0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICB0YXJnZXQuc2V0KCdsZWZ0JywgcG9zLmxlZnQpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChwb3MudG9wKSB7XG4gICAgICAgICAgdGFyZ2V0LnNldCgndG9wJywgcG9zLnRvcCk7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwibXJcIjpcbiAgICAgIGNhc2UgXCJiclwiOlxuICAgICAgICBpZiAocG9zLmxlZnQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIHZhciBfbGRpZmYgPSB0YXJnZXQubGVmdCAtIHBvcy5sZWZ0O1xuXG4gICAgICAgIH1cbiAgICAgICAgaWYgKHBvcy50b3AgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIHZhciBfdGRpZmYgPSB0YXJnZXQudG9wIC0gcG9zLnRvcDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChfbGRpZmYgJiYgKCFfdGRpZmYgfHwgTWF0aC5hYnMoX2xkaWZmKSA+IE1hdGguYWJzKF90ZGlmZikpKSB7XG4gICAgICAgICAgaWYgKF9sZGlmZiA8IDApIHtcbiAgICAgICAgICAgIHRhcmdldC53aWR0aCArPSBfbGRpZmY7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRhcmdldC53aWR0aCAtPSBfbGRpZmY7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKF90ZGlmZikge1xuICAgICAgICAgIGlmIChfdGRpZmYgPCAwKSB7XG4gICAgICAgICAgICB0YXJnZXQud2lkdGggKz0gX3RkaWZmO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0YXJnZXQud2lkdGggLT0gX3RkaWZmO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgLy9jb25zb2xlLmxvZyhwb3MsX2xkaWZmLF90ZGlmZilcbiAgICB9XG4gICAgLy8gdGhpcy5fY2hlY2tfb2JqZWN0X3Bvc2l0aW9uKHRhcmdldClcbiAgfSxcbiAgX2NoZWNrX29iamVjdF9wb3NpdGlvbjogZnVuY3Rpb24gKHRhcmdldCkge1xuXG4gICAgdmFyIHBvcyA9IHRoaXMuZ2V0Rml4ZWRQb3NpdGlvbih0YXJnZXQsIHRhcmdldC5sZWZ0LCB0YXJnZXQudG9wKTtcbiAgICBpZiAodGhpcy5tb3ZlbWVudExpbWl0c09uQWRkQWN0aW9uID09ICd0cmFuc2xhdGUnKSB7XG4gICAgICBpZiAocG9zLmxlZnQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0YXJnZXQuc2V0KCdsZWZ0JywgcG9zLmxlZnQpO1xuICAgICAgfVxuICAgICAgaWYgKHBvcy50b3AgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0YXJnZXQuc2V0KCd0b3AnLCBwb3MudG9wKTtcbiAgICAgIH1cbiAgICB9ZWxzZXtcblxuICAgICAgaWYgKHBvcy5sZWZ0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgaWYgKHRhcmdldC5sZWZ0IDwgcG9zLmxlZnQpIHtcbiAgICAgICAgICB0YXJnZXQud2lkdGggKz0gdGFyZ2V0LmxlZnQgLSBwb3MubGVmdDtcbiAgICAgICAgICB0YXJnZXQubGVmdCA9IHBvcy5sZWZ0O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRhcmdldC53aWR0aCAtPSB0YXJnZXQubGVmdCAtIHBvcy5sZWZ0O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAocG9zLnRvcCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGlmICh0YXJnZXQudG9wIDwgcG9zLnRvcCkge1xuICAgICAgICAgIHRhcmdldC5oZWlnaHQgKz0gdGFyZ2V0LnRvcCAtIHBvcy50b3A7XG4gICAgICAgICAgdGFyZ2V0LnRvcCA9IHBvcy50b3A7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGFyZ2V0LmhlaWdodCAtPSB0YXJnZXQudG9wIC0gcG9zLnRvcDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuXG4gICAgaWYgKHBvcy5zY2FsZVgpIHtcbiAgICAgIHRhcmdldC5zY2FsZVggPSB0YXJnZXQuc2NhbGVYICo9IHBvcy5zY2FsZVg7XG4gICAgfVxuICAgIGlmIChwb3Muc2NhbGVZKSB7XG4gICAgICB0YXJnZXQuc2NhbGVZID0gdGFyZ2V0LnNjYWxlWSAqPSBwb3Muc2NhbGVZO1xuICAgIH1cblxuICAgIHRhcmdldC5zZXRDb29yZHMoKTtcblxuICAgIHRoaXMucmVuZGVyQWxsKCk7XG4gICAgLy8gaWYodGFyZ2V0Lndob2xlQ29vcmRpbmF0ZXMpe1xuICAgIC8vICAgdGFyZ2V0LnRvcCA9IE1hdGgucm91bmQodGFyZ2V0LnRvcCk7XG4gICAgLy8gICB0YXJnZXQubGVmdCA9IE1hdGgucm91bmQodGFyZ2V0LmxlZnQpO1xuICAgIC8vICAgdGFyZ2V0LmhlaWdodCA9IE1hdGgucm91bmQodGFyZ2V0LmhlaWdodCk7XG4gICAgLy8gICB0YXJnZXQud2lkdGggPSBNYXRoLnJvdW5kKHRhcmdldC53aWR0aCk7XG4gICAgLy8gfVxuICB9LFxuICBfdHJhbnNsYXRlT2JqZWN0OiBmdW5jdGlvbiAoeCwgeSwgbGltaXRzKSB7XG4gICAgdmFyIHRhcmdldCA9IHRoaXMuX2N1cnJlbnRUcmFuc2Zvcm0udGFyZ2V0O1xuICAgIGlmKHRhcmdldC5iZWZvcmVUcmFuc2xhdGUpe1xuICAgICAgdmFyIF9wb2ludCA9IHRhcmdldC5iZWZvcmVUcmFuc2xhdGUoeCwgeSk7XG4gICAgICBpZighX3BvaW50KXJldHVybiBmYWxzZTtcbiAgICAgIHggPSBfcG9pbnQueDtcbiAgICAgIHkgPSBfcG9pbnQueTtcbiAgICB9XG4gICAgdmFyIF90cmFuc2xhdGVkID0gX3RyYW5zbGF0ZU9iamVjdF9vdmVyd3JpdHRlbi5jYWxsKHRoaXMsIHgsIHksIGxpbWl0cyk7XG5cbiAgICBpZih0aGlzLm1vdmVtZW50TGltaXRzKXtcblxuICAgICAgdmFyIHBvcyA9IHRoaXMuZ2V0Rml4ZWRQb3NpdGlvbih0YXJnZXQsIHgsIHkpO1xuXG4gICAgICBpZiAocG9zLnNjYWxlWCkge1xuICAgICAgICB0YXJnZXQuc2NhbGVYID0gdGhpcy5fY3VycmVudFRyYW5zZm9ybS5zY2FsZVggKj0gcG9zLnNjYWxlWDtcbiAgICAgIH1cbiAgICAgIGlmIChwb3Muc2NhbGVZKSB7XG4gICAgICAgIHRhcmdldC5zY2FsZVkgPSB0aGlzLl9jdXJyZW50VHJhbnNmb3JtLnNjYWxlWSAqPSBwb3Muc2NhbGVZO1xuICAgICAgfVxuXG4gICAgICBpZiAocG9zLnRvcCAhPT0gdW5kZWZpbmVkIHx8IHBvcy5sZWZ0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgX3RyYW5zbGF0ZWQgPSBfdHJhbnNsYXRlT2JqZWN0X292ZXJ3cml0dGVuLmNhbGwodGhpcyxcbiAgICAgICAgICBwb3MubGVmdCAhPT0gdW5kZWZpbmVkID8gcG9zLmxlZnQgOiB4LFxuICAgICAgICAgIHBvcy50b3AgIT09IHVuZGVmaW5lZCA/IHBvcy50b3AgOiB5KTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIF90cmFuc2xhdGVkIHx8IHBvcy5zY2FsZVggfHwgcG9zLnNjYWxlWTtcblxuXG5cbiAgICAvKiBpZiAoIXRhcmdldC5nZXQoJ2xvY2tNb3ZlbWVudFgnKSkge1xuICAgICB2YXIgX3ZhbCA9IHggLSB0aGlzLl9jdXJyZW50VHJhbnNmb3JtLm9mZnNldFg7XG5cbiAgICAgLy9sZWZ0IG9mZnNldFxuICAgICB2YXIgbGltID0gdGhpcy5tb3ZlbWVudExpbWl0cy5taW5YLmNvbnN0cnVjdG9yID09IE51bWJlciA/IHRoaXMubW92ZW1lbnRMaW1pdHMubWluWCA6IC1ib3VuZHMud2lkdGggKyAxO1xuICAgICBpZih0YXJnZXQubW92ZW1lbnRYTWluTGltaXQgJiYgdGFyZ2V0Lm1vdmVtZW50WE1pbkxpbWl0LmNvbnN0cnVjdG9yID09IE51bWJlciAmJiB0YXJnZXQubW92ZW1lbnRYTWluTGltaXQgPiBsaW0gKXtcbiAgICAgbGltID0gdGFyZ2V0Lm1vdmVtZW50WE1pbkxpbWl0IDtcbiAgICAgfVxuXG4gICAgIF92YWwgPSBNYXRoLm1pbihsaW0sIF92YWwpO1xuXG4gICAgIC8vcmlnaHQgb2Zmc2V0XG4gICAgIHZhciBsaW0gPSB0aGlzLm1vdmVtZW50TGltaXRzLm1heFguY29uc3RydWN0b3IgPT0gTnVtYmVyID8gdGhpcy5tb3ZlbWVudExpbWl0cy5tYXhYIDogdGhpcy53aWR0aCArIGJvdW5kcy53aWR0aCAtIDE7XG4gICAgIGlmKHRhcmdldC5tb3ZlbWVudFhNYXhMaW1pdCAmJiB0YXJnZXQubW92ZW1lbnRYTWF4TGltaXQuY29uc3RydWN0b3IgPT0gTnVtYmVyICYmIHRhcmdldC5tb3ZlbWVudFhNYXhMaW1pdCA+IGxpbSApe1xuICAgICBsaW0gPSB0YXJnZXQubW92ZW1lbnRYTWF4TGltaXQgO1xuICAgICB9XG4gICAgIF92YWwgPSBNYXRoLm1heChsaW0gIC0gdGFyZ2V0LndpZHRoICogdGFyZ2V0LnNjYWxlWCwgX3ZhbCk7XG4gICAgIHRhcmdldC5zZXQoJ2xlZnQnLCBfdmFsKTtcbiAgICAgfVxuICAgICBpZiAoIXRhcmdldC5nZXQoJ2xvY2tNb3ZlbWVudFknKSkge1xuICAgICB2YXIgX3ZhbCA9IHkgLSB0aGlzLl9jdXJyZW50VHJhbnNmb3JtLm9mZnNldFk7XG4gICAgIGlmKHRhcmdldC5tb3ZlbWVudFlNaW5MaW1pdCAhPT0gdW5kZWZpbmVkKVxuICAgICBfdmFsID0gTWF0aC5taW4odGFyZ2V0Lm1vdmVtZW50WU1pbkxpbWl0LCBfdmFsKTtcbiAgICAgaWYodGFyZ2V0Lm1vdmVtZW50WU1heExpbWl0ICE9PSB1bmRlZmluZWQpXG4gICAgIF92YWwgPSBNYXRoLm1heCh0YXJnZXQubW92ZW1lbnRZTWF4TGltaXQgIC0gdGFyZ2V0LmhlaWdodCwgX3ZhbCk7XG5cbiAgICAgdGFyZ2V0LnNldCgndG9wJywgX3ZhbCk7XG4gICAgIH1cbiAgICAgKi9cbiAgICAvL21vdmVtZW50TGltaXRzID17XG4gICAgLy8gICAgeG1pbjogMCxcbiAgICAvLyAgICB4bWF4OiAwLFxuICAgIC8vICAgIHltaW46IDAsXG4gICAgLy8gICAgeW1heDogMFxuICAgIC8vfTtcblxuICB9LFxuXG4gIF9iZWZvcmVUcmFuc2Zvcm06IGZ1bmN0aW9uIChlLCB0YXJnZXQpIHtcbiAgICB0YXJnZXQgJiYgdGFyZ2V0Ll9iZWZvcmVUcmFuc2Zvcm0gP1xuICAgICAgdGFyZ2V0Ll9iZWZvcmVUcmFuc2Zvcm0oZSkgOlxuICAgICAgX2JlZm9yZVRyYW5zZm9ybV9vdmVyd3JpdHRlbi5jYWxsKHRoaXMsIGUsIHRhcmdldCk7XG4gIH0sXG4gIF9iZWZvcmVUcmFuc2Zvcm1OYXRpdmU6IF9iZWZvcmVUcmFuc2Zvcm1fb3ZlcndyaXR0ZW4sXG4gIC8qKlxuICAgKiBUcmFuc2xhdGVzIG9iamVjdCBieSBcInNldHRpbmdcIiBpdHMgbGVmdC90b3BcbiAgICogQHByaXZhdGVcbiAgICogQHBhcmFtIHtOdW1iZXJ9IHggcG9pbnRlcidzIHggY29vcmRpbmF0ZVxuICAgKiBAcGFyYW0ge051bWJlcn0geSBwb2ludGVyJ3MgeSBjb29yZGluYXRlXG4gICAqIEByZXR1cm4ge0Jvb2xlYW59IHRydWUgaWYgdGhlIHRyYW5zbGF0aW9uIG9jY3VycmVkXG4gICAqL1xuICBfdHJhbnNsYXRlT2JqZWN0OiBmdW5jdGlvbiAoeCwgeSkge1xuICAgIHZhciB0cmFuc2Zvcm0gPSB0aGlzLl9jdXJyZW50VHJhbnNmb3JtLFxuICAgICAgdGFyZ2V0ID0gdHJhbnNmb3JtLnRhcmdldCxcbiAgICAgIG5ld0xlZnQgPSB4IC0gdHJhbnNmb3JtLm9mZnNldFgsXG4gICAgICBuZXdUb3AgPSB5IC0gdHJhbnNmb3JtLm9mZnNldFksXG4gICAgICBtb3ZlWCA9ICF0YXJnZXQuZ2V0KCdsb2NrTW92ZW1lbnRYJykgJiYgdGFyZ2V0LmxlZnQgIT09IG5ld0xlZnQsXG4gICAgICBtb3ZlWSA9ICF0YXJnZXQuZ2V0KCdsb2NrTW92ZW1lbnRZJykgJiYgdGFyZ2V0LnRvcCAhPT0gbmV3VG9wO1xuXG5cbiAgICAvL3JvdW5kIGNvb3JkaW5hdGVzXG4gICAgLy8gaWYgKHRhcmdldC53aG9sZUNvb3JkaW5hdGVzKSB7XG4gICAgLy8gICBuZXdMZWZ0ID0gTWF0aC5yb3VuZChuZXdMZWZ0KTtcbiAgICAvLyAgIG5ld1RvcCA9IE1hdGgucm91bmQobmV3VG9wKTtcbiAgICAvLyB9XG5cbiAgICBtb3ZlWCAmJiB0YXJnZXQuc2V0KCdsZWZ0JywgbmV3TGVmdCk7XG4gICAgbW92ZVkgJiYgdGFyZ2V0LnNldCgndG9wJywgbmV3VG9wKTtcbiAgICByZXR1cm4gbW92ZVggfHwgbW92ZVk7XG4gIH1cbn0pO1xuXG4vL2ZhYnJpYy5TbGlkZUNhbnZhcy5hZGRQbHVnaW4oXCJsb2FkZXJzXCIsZnVuY3Rpb24oKXtcbi8vICAgIHRoaXMuaW5pdE1vdmVtZW50TGltaXRzKCk7XG4vL30pO1xuXG4vL3RvZG9cbmZhYnJpYy5SZWN0LnByb3RvdHlwZS5zdGF0ZVByb3BlcnRpZXMgICA9IGZhYnJpYy5SZWN0LnByb3RvdHlwZS5zdGF0ZVByb3BlcnRpZXMuY29uY2F0KFtcIm1vdmVtZW50TGltaXRzXCIsXCJjbGlwVG9cIl0pO1xuZmFicmljLk9iamVjdC5wcm90b3R5cGUuc3RhdGVQcm9wZXJ0aWVzID0gZmFicmljLk9iamVjdC5wcm90b3R5cGUuc3RhdGVQcm9wZXJ0aWVzLmNvbmNhdChbXCJtb3ZlbWVudExpbWl0c1wiLFwiY2xpcFRvXCJdKTtcbmZhYnJpYy5JVGV4dC5wcm90b3R5cGUuc3RhdGVQcm9wZXJ0aWVzICA9IGZhYnJpYy5JVGV4dC5wcm90b3R5cGUuc3RhdGVQcm9wZXJ0aWVzLmNvbmNhdChbXCJtb3ZlbWVudExpbWl0c1wiLFwiY2xpcFRvXCJdKTtcbmZhYnJpYy5JbWFnZS5wcm90b3R5cGUuc3RhdGVQcm9wZXJ0aWVzICA9IGZhYnJpYy5JbWFnZS5wcm90b3R5cGUuc3RhdGVQcm9wZXJ0aWVzLmNvbmNhdChbXCJtb3ZlbWVudExpbWl0c1wiLFwiY2xpcFRvXCJdKTtcblxuXG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL21vZHVsZXMvbW92ZW1lbnRMaW1pdHMuanNcbi8vIG1vZHVsZSBpZCA9IDQxXG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIid1c2Ugc3RyaWN0JztcblxuXG52YXIgX3NldF9zYmFja2dyb3VuZF9pbWFnZV9vdmVyd3JpdHRlbiA9IGZhYnJpYy5DYW52YXMucHJvdG90eXBlLnNldEJhY2tncm91bmRJbWFnZTtcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuQ2FudmFzLnByb3RvdHlwZSwge1xuICAvKipcbiAgICogYmFja2dyb3VuZFBvc2l0aW9uXG4gICAqIEB2YWx1ZXMgbWFudWFsIHwgY292ZXIgfCBmaXRcbiAgICovXG4gIGJhY2tncm91bmRQb3NpdGlvbjogJ21hbnVhbCcsXG4gIHNldEJhY2tncm91bmRQb3NpdGlvbjogZnVuY3Rpb24gKHNyYykge1xuICAgIHRoaXMuYmFja2dyb3VuZFBvc2l0aW9uID0gc3JjO1xuICAgIHRoaXMuX3VwZGF0ZV9iYWNrZ3JvdW5kX2ltYWdlKCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG4gIG9mZnNldHM6IHtcbiAgICBsZWZ0OiAwLFxuICAgIHJpZ2h0OiAwLFxuICAgIGJvdHRvbTogMCxcbiAgICB0b3A6IDBcbiAgfSxcblxuICAvLyBzZXRCYWNrZ3JvdW5kSW1hZ2U6IGZ1bmN0aW9uIChzcmMsIGNhbGxiYWNrLCBvcHRpb25zKSB7XG4gIC8vXG4gIC8vICAgX3NldF9zYmFja2dyb3VuZF9pbWFnZV9vdmVyd3JpdHRlbi5jYWxsKHRoaXMsIHNyYywgZnVuY3Rpb24gKCkge1xuICAvLyAgICAgdGhpcy5fdXBkYXRlX2JhY2tncm91bmRfaW1hZ2UoKTtcbiAgLy8gICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKHRoaXMuYmFja2dyb3VuZEltYWdlKTtcbiAgLy8gICB9LmJpbmQodGhpcyksIG9wdGlvbnMpO1xuICAvLyAgIHJldHVybiB0aGlzO1xuICAvLyB9LFxuICBmaWxsQmFja2dyb3VuZENvbG9yT3ZlckNhbnZhczogZmFsc2UsXG4gIF9yZW5kZXJCYWNrZ3JvdW5kT3JPdmVybGF5OiBmdW5jdGlvbihjdHgsIHByb3BlcnR5KSB7XG4gICAgdmFyIG9iamVjdCA9IHRoaXNbcHJvcGVydHkgKyAnQ29sb3InXTtcbiAgICBpZiAob2JqZWN0KSB7XG4gICAgICBjdHguZmlsbFN0eWxlID0gb2JqZWN0LnRvTGl2ZVxuICAgICAgICA/IG9iamVjdC50b0xpdmUoY3R4KVxuICAgICAgICA6IG9iamVjdDtcblxuICAgICAgaWYoIXRoaXMuZmlsbEJhY2tncm91bmRDb2xvck92ZXJDYW52YXMpe1xuICAgICAgICBjdHguZmlsbFJlY3QoXG4gICAgICAgICAgb2JqZWN0Lm9mZnNldFggfHwgdGhpcy52aWV3cG9ydFRyYW5zZm9ybVs0XS8gdGhpcy52aWV3cG9ydFRyYW5zZm9ybVswXSxcbiAgICAgICAgICBvYmplY3Qub2Zmc2V0WSB8fCB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzVdLyB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzBdLFxuICAgICAgICAgIHRoaXMud2lkdGggKiB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzBdLFxuICAgICAgICAgIHRoaXMuaGVpZ2h0ICAqIHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bMF0pO1xuICAgICAgfWVsc2V7XG4gICAgICAgIGN0eC5maWxsUmVjdChcblxuICAgICAgICAgIG9iamVjdC5vZmZzZXRYIHx8IDAsXG4gICAgICAgICAgb2JqZWN0Lm9mZnNldFkgfHwgMCxcbiAgICAgICAgICB0aGlzLm9yaWdpbmFsV2lkdGggLFxuICAgICAgICAgIHRoaXMub3JpZ2luYWxIZWlnaHQpO1xuICAgICAgfVxuICAgIH1cbiAgICBvYmplY3QgPSB0aGlzW3Byb3BlcnR5ICsgJ0ltYWdlJ107XG4gICAgaWYob2JqZWN0ICYmIG9iamVjdC5jb25zdHJ1Y3RvciAhPT0gU3RyaW5nICYmICBvYmplY3QuY29uc3RydWN0b3IgIT09IE9iamVjdCl7XG4gICAgICAgIG9iamVjdC5yZW5kZXIoY3R4KTtcbiAgICB9XG4gIH0sXG4gIGdldEltYWdlRGF0YTogZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICBvcHRpb25zID0gZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCh7XG4gICAgICBjbGlwcGVkX2FyZWE6IGZhbHNlLFxuICAgICAgY2xpcHBlZF9hcmVhX29ubHk6IGZhbHNlLFxuICAgICAgZHJhd19iYWNrZ3JvdW5kOiB0cnVlLFxuICAgICAgZm9ybWF0OiAncG5nJyxcbiAgICAgIHF1YWxpdHk6IDAuOFxuICAgIH0sIG9wdGlvbnMgfHwge30pO1xuXG4gICAgdmFyIHNpemU7XG4gICAgaWYgKG9wdGlvbnMuY2xpcHBlZF9hcmVhKSB7XG4gICAgICBzaXplID0gb3B0aW9ucy5jbGlwcGVkX2FyZWEuZ2V0Qm91bmRpbmdSZWN0KCk7XG4gICAgICB2YXIgX3pvb20gPSB0aGlzLmdldFpvb20oKTtcbiAgICAgIHNpemUubGVmdCAgIC89IF96b29tO1xuICAgICAgc2l6ZS50b3AgICAgLz0gX3pvb207XG4gICAgICBzaXplLndpZHRoICAvPSBfem9vbTtcbiAgICAgIHNpemUuaGVpZ2h0IC89IF96b29tO1xuICAgICAgZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChvcHRpb25zLCBzaXplKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2l6ZSA9IHtcbiAgICAgICAgd2lkdGg6IG9wdGlvbnMud2lkdGggfHwgdGhpcy5vcmlnaW5hbFdpZHRoIHx8IHRoaXMud2lkdGgsXG4gICAgICAgIGhlaWdodDogb3B0aW9ucy5oZWlnaHQgfHwgdGhpcy5vcmlnaW5hbEhlaWdodCB8fCB0aGlzLmhlaWdodCxcbiAgICAgIH07XG5cbiAgICAgIGlmIChvcHRpb25zLmNsaXBwZWRfYXJlYV9vbmx5KSB7XG4gICAgICAgIHNpemUud2lkdGggLT0gdGhpcy5vZmZzZXRzLmxlZnQgKyB0aGlzLm9mZnNldHMucmlnaHQ7XG4gICAgICAgIHNpemUuaGVpZ2h0IC09IHRoaXMub2Zmc2V0cy50b3AgKyB0aGlzLm9mZnNldHMuYm90dG9tO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAob3B0aW9ucy56b29tKSB7XG4gICAgICBzaXplLndpZHRoICo9IG9wdGlvbnMuem9vbTtcbiAgICAgIHNpemUuaGVpZ2h0ICo9IG9wdGlvbnMuem9vbTtcbiAgICB9XG5cbiAgICB2YXIgY2FudmFzID0gZmFicmljLnV0aWwuY3JlYXRlQ2FudmFzRWxlbWVudCgpO1xuICAgIGNhbnZhcy53aWR0aCA9IHNpemUud2lkdGg7XG4gICAgY2FudmFzLmhlaWdodCA9IHNpemUuaGVpZ2h0O1xuXG4gICAgb3B0aW9ucy5sZWZ0ID0gTWF0aC5mbG9vcihvcHRpb25zLmxlZnQpO1xuICAgIG9wdGlvbnMudG9wID0gTWF0aC5mbG9vcihvcHRpb25zLnRvcCk7XG4gICAgb3B0aW9ucy5oZWlnaHQgPSBNYXRoLmNlaWwob3B0aW9ucy5oZWlnaHQpO1xuICAgIG9wdGlvbnMud2lkdGggPSBNYXRoLmNlaWwob3B0aW9ucy53aWR0aCk7XG5cbiAgICB0aGlzLnJlbmRlclRodW1iKGNhbnZhcywgb3B0aW9ucyk7XG5cbiAgICB2YXIgc3JjID0gY2FudmFzLnRvRGF0YVVSTChvcHRpb25zKTtcblxuICAgIHZhciBibG9iID0gZmFicmljLnV0aWwuZGF0YVVSSXRvQmxvYihzcmMsICdpbWFnZS8nICsgb3B0aW9ucy5mb3JtYXQpO1xuICAgIHZhciBvYmplY3RVUkwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpO1xuICAgIHJldHVybiB7XG4gICAgICBkYXRhVVJMOiBzcmMsXG4gICAgICBibG9iOiBibG9iLFxuICAgICAgdXJsOiBvYmplY3RVUkwsXG4gICAgICBjYW52YXM6IGNhbnZhc1xuICAgIH07XG4gIH0sXG4gIGdldE9yaWdpbmFsU2l6ZTogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB7XG4gICAgICB3aWR0aDogdGhpcy5vcmlnaW5hbFdpZHRoLFxuICAgICAgaGVpZ2h0OiB0aGlzLm9yaWdpbmFsSGVpZ2h0XG4gICAgfVxuICB9LFxuXG4gIHJlbmRlclRodW1iOiBmdW5jdGlvbiAoY2FudmFzLCBvcHRpb25zKSB7XG5cbiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7XG4gICAgICAgIG9iamVjdHM6IHRydWUsXG4gICAgICAgIGNsaXBwZWRfYXJlYV9vbmx5OiBmYWxzZSxcbiAgICAgICAgZHJhd19iYWNrZ3JvdW5kOiB0cnVlXG4gICAgICB9O1xuXG4gICAgaWYgKG9wdGlvbnMuem9vbSkge1xuICAgICAgdmFyIF96b29tID0gb3B0aW9ucy56b29tO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoY2FudmFzLndpZHRoKSB7XG4gICAgICAgIHZhciBfem9vbSA9IGNhbnZhcy53aWR0aCAvICh0aGlzLm9yaWdpbmFsV2lkdGggfHwgdGhpcy53aWR0aClcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciBfem9vbSA9IDE7XG4gICAgICB9XG4gICAgfVxuICAgIHZhciBfb2xkX1NjYWxlID0gdGhpcy52aWV3cG9ydFRyYW5zZm9ybVswXTtcbiAgICB2YXIgb2xkX3ggPSB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzRdO1xuICAgIHZhciBvbGRfeSA9IHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bNV07XG4gICAgdGhpcy52aWV3cG9ydFRyYW5zZm9ybVs0XSA9IHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bNV0gPSAwO1xuICAgIHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bMF0gPSB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzNdID0gMTtcblxuICAgIHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bMF0gPSB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzNdID0gX3pvb207XG4gICAgLy90aGlzLl91cGRhdGVfY2xpcF9yZWN0KCk7XG5cbiAgICBpZiAodGhpcy5jbGlwUmVjdCkge1xuICAgICAgdGhpcy5jbGlwUmVjdC5zZXRPcGFjaXR5KDApO1xuICAgIH1cblxuICAgIHZhciBzaXplID0ge1xuICAgICAgd2lkdGg6IHRoaXMub3JpZ2luYWxXaWR0aCB8fCB0aGlzLndpZHRoLFxuICAgICAgaGVpZ2h0OiB0aGlzLm9yaWdpbmFsSGVpZ2h0IHx8IHRoaXMuaGVpZ2h0XG4gICAgfTtcbiAgICBzaXplLndpZHRoID0gTWF0aC5jZWlsKHNpemUud2lkdGggKiBfem9vbSk7XG4gICAgc2l6ZS5oZWlnaHQgPSBNYXRoLmNlaWwoc2l6ZS5oZWlnaHQgKiBfem9vbSk7XG5cbiAgICB2YXIgX2NhbnZhcyA9IGZhYnJpYy51dGlsLmNyZWF0ZUNhbnZhc0VsZW1lbnQoKTtcbiAgICBfY2FudmFzLndpZHRoID0gc2l6ZS53aWR0aDtcbiAgICBfY2FudmFzLmhlaWdodCA9IHNpemUuaGVpZ2h0O1xuXG4gICAgdmFyIGNhbnZhc1RvRHJhd09uID0gX2NhbnZhcy5nZXRDb250ZXh0KCcyZCcpLCBvYmpzVG9SZW5kZXI7XG5cbiAgICB0aGlzLmNsZWFyQ29udGV4dChjYW52YXNUb0RyYXdPbik7XG4gICAgY2FudmFzVG9EcmF3T24uc2F2ZSgpO1xuICAgIGNhbnZhc1RvRHJhd09uLnRyYW5zZm9ybS5hcHBseShjYW52YXNUb0RyYXdPbiwgdGhpcy52aWV3cG9ydFRyYW5zZm9ybSk7XG5cbiAgICBpZiAob3B0aW9ucy5kcmF3X2JhY2tncm91bmQpIHtcbiAgICAgIHRoaXMuX3JlbmRlckJhY2tncm91bmQoY2FudmFzVG9EcmF3T24pO1xuICAgICAgLy9pZiAodGhpcy5fYmFja2dyb3VuZExheWVyKSB7XG4gICAgICAvLyAgdGhpcy5fcmVuZGVyT2JqZWN0cyhjYW52YXNUb0RyYXdPbiwgdGhpcy5fYmFja2dyb3VuZExheWVyKTtcbiAgICAgIC8vfVxuICAgIH1cblxuICAgIGlmICghb3B0aW9ucy5jbGlwcGVkX2FyZWFfb25seSAmJiB0aGlzLmNsaXBUbykge1xuICAgICAgZmFicmljLnV0aWwuY2xpcENvbnRleHQodGhpcywgY2FudmFzVG9EcmF3T24pO1xuICAgIH1cblxuICAgIHZhciBfb2JqZWN0cztcbiAgICBpZiAob3B0aW9ucy5vYmplY3RzICYmIG9wdGlvbnMub2JqZWN0cy5jb25zdHJ1Y3RvciA9PT0gQXJyYXkpIHtcbiAgICAgIF9vYmplY3RzID0gb3B0aW9ucy5vYmplY3RzO1xuICAgIH0gZWxzZSB7XG4gICAgICBfb2JqZWN0cyA9IG9wdGlvbnMub2JqZWN0cyAhPT0gZmFsc2UgPyB0aGlzLl9vYmplY3RzIDogW107XG4gICAgfVxuICAgIGlmIChvcHRpb25zLmNsaXBwZWRfYXJlYSkge1xuICAgICAgX29iamVjdHMgPSBmYWJyaWMudXRpbC5vYmplY3QuY2xvbmUoX29iamVjdHMpO1xuICAgICAgZm9yICh2YXIgaSA9IF9vYmplY3RzLmxlbmd0aDsgaS0tOykge1xuICAgICAgICBpZiAoX29iamVjdHNbaV0uY2xpcFRvICE9PSBvcHRpb25zLmNsaXBwZWRfYXJlYSkge1xuICAgICAgICAgIF9vYmplY3RzLnNwbGljZShpLCAxKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICAvLyBpZiAoZmFicmljLnZlcnNpb24gPj0gMS42KSB7XG4gICAgICB0aGlzLl9yZW5kZXJPYmplY3RzKGNhbnZhc1RvRHJhd09uLCBfb2JqZWN0cyk7XG4gICAgLy8gfSBlbHNlIHtcbiAgICAvLyAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBfb2JqZWN0cy5sZW5ndGg7IGkgPCBsZW5ndGg7ICsraSkge1xuICAgIC8vICAgICB0aGlzLl9kcmF3KGNhbnZhc1RvRHJhd09uLCBfb2JqZWN0c1tpXSk7XG4gICAgLy8gICB9XG4gICAgLy8gfVxuXG5cbiAgICBjYW52YXNUb0RyYXdPbi5yZXN0b3JlKCk7XG4gICAgaWYgKCFvcHRpb25zLmNsaXBwZWRfYXJlYV9vbmx5ICYmIHRoaXMuY2xpcFRvKSB7XG4gICAgICBjYW52YXNUb0RyYXdPbi5yZXN0b3JlKCk7XG4gICAgfVxuICAgIHRoaXMuX3JlbmRlck92ZXJsYXkoY2FudmFzVG9EcmF3T24pO1xuICAgIGNhbnZhc1RvRHJhd09uLnJlc3RvcmUoKTtcbiAgICBpZiAodGhpcy5jbGlwUmVjdCkge1xuICAgICAgdGhpcy5jbGlwUmVjdC5zZXRPcGFjaXR5KDEpO1xuICAgIH1cbiAgICB2YXIgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpO1xuICAgIGlmIChvcHRpb25zLmNsaXBwZWRfYXJlYV9vbmx5ICYmIHRoaXMuY2xpcFJlY3QpIHtcbiAgICAgIHZhciBfcmVjdCA9IHtcbiAgICAgICAgbGVmdDogdGhpcy5jbGlwUmVjdC5sZWZ0ICogX3pvb20sXG4gICAgICAgIHRvcDogdGhpcy5jbGlwUmVjdC50b3AgKiBfem9vbSxcbiAgICAgICAgd2lkdGg6IHRoaXMuY2xpcFJlY3Qud2lkdGggKiBfem9vbSxcbiAgICAgICAgaGVpZ2h0OiB0aGlzLmNsaXBSZWN0LmhlaWdodCAqIF96b29tXG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgX3JlY3QgPSB7XG4gICAgICAgIGxlZnQ6IG9wdGlvbnMubGVmdCAqIF96b29tIHx8IDAsXG4gICAgICAgIHRvcDogb3B0aW9ucy50b3AgKiBfem9vbSB8fCAwLFxuICAgICAgICB3aWR0aDogb3B0aW9ucy53aWR0aCAqIF96b29tIHx8IHNpemUud2lkdGgsXG4gICAgICAgIGhlaWdodDogb3B0aW9ucy5oZWlnaHQgKiBfem9vbSB8fCBzaXplLmhlaWdodFxuICAgICAgfTtcbiAgICB9XG4gICAgaWYgKG9wdGlvbnMuYW5nbGUpIHtcbiAgICAgIGN0eC5yb3RhdGUoLW9wdGlvbnMuYW5nbGUgKiBNYXRoLlBJIC8gMTgwKTtcbiAgICAgIGN0eC5kcmF3SW1hZ2UoX2NhbnZhcyxcbiAgICAgICAgMCwgMCwgX3JlY3Qud2lkdGggKyBfcmVjdC5sZWZ0ICsgX2NhbnZhcy53aWR0aCwgX3JlY3QuaGVpZ2h0ICsgX3JlY3QudG9wICsgX2NhbnZhcy5oZWlnaHQsXG4gICAgICAgIC1fcmVjdC5sZWZ0LCAtX3JlY3QudG9wLCBjYW52YXMud2lkdGggKyBfcmVjdC5sZWZ0ICsgX2NhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCArIF9yZWN0LnRvcCArIF9jYW52YXMuaGVpZ2h0KTtcbiAgICB9IGVsc2Uge1xuICAgICAgY3R4LmRyYXdJbWFnZShfY2FudmFzLCBfcmVjdC5sZWZ0LCBfcmVjdC50b3AsIF9yZWN0LndpZHRoLCBfcmVjdC5oZWlnaHQsIDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7XG4gICAgfVxuXG4gICAgdGhpcy52aWV3cG9ydFRyYW5zZm9ybVswXSA9IHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bM10gPSBfb2xkX1NjYWxlO1xuICAgIC8vIHRoaXMuX3VwZGF0ZV9iYWNrZ3JvdW5kX2ltYWdlKCk7XG4gICAgLy90aGlzLl91cGRhdGVfY2xpcF9yZWN0KCk7XG5cbiAgICB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzRdID0gb2xkX3g7XG4gICAgdGhpcy52aWV3cG9ydFRyYW5zZm9ybVs1XSA9IG9sZF95O1xuXG5cbiAgICByZXR1cm4gY2FudmFzO1xuICB9LFxuXG4gIC8vIHNldE9mZnNldHM6IGZ1bmN0aW9uIChfb2Zmc2V0cykge1xuICAvLyAgIHRoaXMub2Zmc2V0cyA9IF9vZmZzZXRzIHx8IGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoe30sIGZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUub2Zmc2V0cyk7XG4gIC8vICAgLy90aGlzLl91cGRhdGVfY2xpcF9yZWN0KCk7XG4gIC8vICAgcmV0dXJuIHRoaXM7XG4gIC8vIH0sXG4gIGdldFJlY3Q6IGZ1bmN0aW9uIChvcHRpb25zKSB7XG5cblxuICAgIHZhciByZWN0ID0ge307XG5cbiAgICB2YXIgX3cgPSB0aGlzLm9yaWdpbmFsV2lkdGggfHwgdGhpcy53aWR0aDsgLy90aGlzLm9yaWdpbmFsV2lkdGhcbiAgICB2YXIgX2ZsZXhBcnJheSA9IGZhYnJpYy51dGlsLmZsZXgoX3cgLCBbe3ZhbHVlOiBvcHRpb25zLmxlZnQsIGZsZXg6IDB9LHt2YWx1ZTogb3B0aW9ucy53aWR0aCwgZmxleDogMX0se3ZhbHVlOiBvcHRpb25zLnJpZ2h0LCBmbGV4OiAwfV0gKTtcbiAgICByZWN0LmxlZnQgPSBfZmxleEFycmF5WzBdO1xuICAgIHJlY3Qud2lkdGggPSBfZmxleEFycmF5WzFdO1xuICAgIHJlY3QucmlnaHQgPSBfZmxleEFycmF5WzJdO1xuXG4gICAgdmFyIF9oID0gdGhpcy5vcmlnaW5hbEhlaWdodHx8IHRoaXMuaGVpZ2h0OyAgIC8vdGhpcy5vcmlnaW5hbEhlaWdodFxuICAgIHZhciBfZmxleEFycmF5ID0gZmFicmljLnV0aWwuZmxleChfaCAsIFt7dmFsdWU6IG9wdGlvbnMudG9wLCBmbGV4OiAwfSx7dmFsdWU6IG9wdGlvbnMuaGVpZ2h0LCBmbGV4OiAxfSx7dmFsdWU6IG9wdGlvbnMuYm90dG9tLCBmbGV4OiAwfV0gKTtcbiAgICByZWN0LnRvcCA9IF9mbGV4QXJyYXlbMF07XG4gICAgcmVjdC5oZWlnaHQgPSBfZmxleEFycmF5WzFdO1xuICAgIHJlY3QuYm90dG9tID0gX2ZsZXhBcnJheVsyXTtcblxuICAgIHJldHVybiByZWN0O1xuICB9LFxufSk7XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL21vZHVsZXMvcmVuZGVyLmpzXG4vLyBtb2R1bGUgaWQgPSA0MlxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCJcbmlmKHR5cGVvZiBzYXZlQXMgPT0gXCJ1bmRlZmluZWRcIil7XG4gIGZhYnJpYy5zYXZlQXMgID0gcmVxdWlyZShcIi4vLi4vLi4vcGx1Z2lucy9zYXZlQXMuanNcIikuc2F2ZUFzO1xufWVsc2V7XG4gIGZhYnJpYy5zYXZlQXMgPSBzYXZlQXM7XG59XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLlNsaWRlQ2FudmFzLnByb3RvdHlwZSwge1xuICBpbnNlcnRSZW5kZXJBcmVhOiBmYWxzZSxcbiAgaW5zZXJ0UmVuZGVyRnVsbDogZmFsc2UsXG59KTtcblxuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUuYWN0aW9ucywge1xuICByZW5kZXJBcmVhOiB7XG4gICAgY2xhc3NOYW1lOiAnZmEgZmEtZG93bmxvYWQnLFxuICAgIHRpdGxlOiAnZG93bmxvYWQnLFxuICAgIGFjdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgZmFicmljLnNhdmVBcyh0aGlzLmdldEltYWdlRGF0YSh7XG4gICAgICAgIGNsaXBwZWRfYXJlYTogdGhpcy5hY3RpdmVBcmVhLFxuICAgICAgICB6b29tOiB0aGlzLmRvdHNQZXJVbml0LFxuICAgICAgICBjbGlwcGVkX2FyZWFfb25seTogdHJ1ZSxcbiAgICAgICAgZHJhd19iYWNrZ3JvdW5kOiB0cnVlXG4gICAgICB9KS5ibG9iLCB0aGlzLnRpdGxlKTtcbiAgICB9XG4gIH0sXG4gIHJlbmRlckZ1bGw6IHtcbiAgICB0aXRsZTogJ2Rvd25sb2FkIHdpdGggYmFja2dyb3VuZCcsXG4gICAgYWN0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICBmYWJyaWMuc2F2ZUFzKHRoaXMuZ2V0SW1hZ2VEYXRhKHtcbiAgICAgICAgem9vbTogdGhpcy5kb3RzUGVyVW5pdCxcbiAgICAgICAgY2xpcHBlZF9hcmVhX29ubHk6IGZhbHNlLFxuICAgICAgICBkcmF3X2JhY2tncm91bmQ6IHRydWVcbiAgICAgIH0pLmJsb2IsIHRoaXMudGl0bGUpO1xuICAgIH1cbiAgfVxufSk7XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL21vZHVsZXMvc2F2ZUFzLmpzXG4vLyBtb2R1bGUgaWQgPSA0M1xuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCIvKnRvZG9cbmZhYnJpYy5TbGlkZUNhbnZhcy5hZGRQbHVnaW4oXCJpbml0aWFsaXplXCIsZnVuY3Rpb24oKXtcbiAgaWYodHlwZW9mIHRoaXMuZnJlZURyYXdpbmdCcnVzaCA9PSBcInN0cmluZ1wiICl7XG4gICAgdGhpcy5zZXRGcmVlRHJhd2luZ0JydXNoKHRoaXMuZnJlZURyYXdpbmdCcnVzaCk7XG4gIH1cbn0pOyovXG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLlNsaWRlQ2FudmFzLnByb3RvdHlwZSx7XG4gIC8qKlxuICAgKiBbJ1BlbmNpbEJydXNoJywnUmVjdGFuZ2xlQnJ1c2gnXVxuICAgKi9cbiAgYWN0aXZlRHJhd2luZ1Rvb2xzOiBbXSxcbiAgLyoqXG4gICAqXG4gICAgIHtcbiAgICAgIEJydXNoQ2xhc3NOYW1lOiB7XG4gICAgICAgIGNsYXNzTmFtZTogJ2JydXNoIGNsYXNzTmFtZScsXG4gICAgICAgIHRpdGxlOiAnYnJ1c2ggdGl0bGUnXG4gICAgICB9XG4gICAgfVxuICAgKi9cbiAgZHJhd2luZ1Rvb2xzOiB7fSxcbiAgaW5zZXJ0RHJhd2luZ1Rvb2w6IGZhbHNlLFxuICBhY3Rpb25zOiBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUuYWN0aW9ucyx7XG4gICAgZHJhd2luZ1Rvb2w6IHtcbiAgICAgIHRpdGxlOiAnZHJhd2luZy10b29sJyxcbiAgICAgIHR5cGU6ICdvcHRpb25zJyxcbiAgICAgIHZhbHVlOiAnZnJlZURyYXdpbmdCcnVzaCcsXG4gICAgICBtZW51OiBmdW5jdGlvbigpe1xuICAgICAgICB2YXIgX3Rvb2xzID0ge307XG4gICAgICAgIGZvcih2YXIgaSBpbiB0aGlzLmFjdGl2ZURyYXdpbmdUb29scyl7XG4gICAgICAgICAgdmFyIF90b29sID0gdGhpcy5hY3RpdmVEcmF3aW5nVG9vbHNbaV07XG4gICAgICAgICAgX3Rvb2xzW190b29sXSA9IGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoe29wdGlvbjogX3Rvb2x9LHRoaXMuZHJhd2luZ1Rvb2xzW190b29sXSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIF90b29scztcbiAgICAgIH1cbiAgICB9XG4gIH0pLFxuICBmcmVlRHJhd2luZ0JydXNoOiAnUGVuY2lsQnJ1c2gnLFxuICBkcmF3aW5nQ29sb3I6IFswLDAsMCwyNTVdLFxuICBfb25Nb3VzZURvd25JbkRyYXdpbmdNb2RlOiBmdW5jdGlvbihlKSB7XG4gICAgdGhpcy5faXNDdXJyZW50bHlEcmF3aW5nID0gdHJ1ZTtcbiAgICBpZighdGhpcy5mcmVlRHJhd2luZ0JydXNoLnRhcmdldCl7XG4gICAgICB0aGlzLmRpc2NhcmRBY3RpdmVPYmplY3QoZSkucmVuZGVyQWxsKCk7XG4gICAgfVxuICAgIGlmICh0aGlzLmNsaXBUbykge1xuICAgICAgZmFicmljLnV0aWwuY2xpcENvbnRleHQodGhpcywgdGhpcy5jb250ZXh0VG9wKTtcbiAgICB9XG4gICAgdmFyIHBvaW50ZXIgPSB0aGlzLmdldFBvaW50ZXIoZSk7XG4gICAgdGhpcy5mcmVlRHJhd2luZ0JydXNoLm9uTW91c2VEb3duKHBvaW50ZXIpO1xuICAgIHRoaXMuX2hhbmRsZUV2ZW50KGUsICdkb3duJyk7XG4gIH0sXG4gIGdldEZyZWVEcmF3aW5nQnJ1c2g6IGZ1bmN0aW9uKCkge1xuICAgIGlmKCF0aGlzLmZyZWVEcmF3aW5nQnJ1c2gpe1xuICAgICAgcmV0dXJuIFwiU2VsZWN0aW9uXCI7XG4gICAgfVxuICAgIHJldHVybiAgZmFicmljLnV0aWwuc3RyaW5nLmNhcGl0YWxpemUoZmFicmljLnV0aWwuc3RyaW5nLmNhbWVsaXplKHRoaXMuZnJlZURyYXdpbmdCcnVzaC50eXBlKSx0cnVlKTtcbiAgfSxcbiAgc2V0RnJlZURyYXdpbmdCcnVzaDogZnVuY3Rpb24oYnJ1c2gpIHtcblxuICAgIGlmKGJydXNoID09ICdTZWxlY3Rpb24nKXtcbiAgICAgIHRoaXMuaXNEcmF3aW5nTW9kZSA9IGZhbHNlO1xuICAgICAgdGhpcy5mcmVlRHJhd2luZ0JydXNoID0gXCJcIjtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdmFyIGNsYXNzTmFtZSA9IGZhYnJpYy51dGlsLnN0cmluZy5jYXBpdGFsaXplKGZhYnJpYy51dGlsLnN0cmluZy5jYW1lbGl6ZShicnVzaCksdHJ1ZSk7XG4gICAgaWYodGhpc1tcIl9fXCIgKyBjbGFzc05hbWVdKXtcbiAgICAgIHRoaXMuZnJlZURyYXdpbmdCcnVzaCA9IHRoaXNbXCJfX1wiICsgY2xhc3NOYW1lXSA7XG4gICAgfWVsc2V7XG4gICAgICB0aGlzLmZyZWVEcmF3aW5nQnJ1c2ggPSB0aGlzW1wiX19cIiArIGNsYXNzTmFtZV0gPSBuZXcgIGZhYnJpY1tjbGFzc05hbWVdKHRoaXMpO1xuICAgIH1cbiAgICB0aGlzLmZpcmUoXCJicnVzaDpjaGFuZ2VkXCIse2JydXNoOiB0aGlzLmZyZWVEcmF3aW5nQnJ1c2h9KTtcbiAgfSxcbiAgZHJhd1pvb21lZEFyZWEgOiBmdW5jdGlvbihjdHgsbGVmdCwgdG9wICx3aWR0aCwgaGVpZ2h0ICwgcG9pbnRlciApIHtcblxuICAgIHdpZHRoID0gd2lkdGggfHwgOTA7XG4gICAgaGVpZ2h0ID0gaGVpZ2h0IHx8IDkwO1xuXG4gICAgY3R4LnNhdmUoKTtcbiAgICBjdHgudHJhbnNsYXRlKGxlZnQgfHwgMCwgdG9wIHx8IDApO1xuXG4gICAgY3R4LmZpbGxTdHlsZSA9ICdibGFjayc7XG4gICAgY3R4LnN0cm9rZVN0eWxlID0gXCIjZmZmXCI7XG4gICAgY3R4LnN0cm9rZVdpZHRoID0gMTtcbiAgICBjdHguc2V0TGluZURhc2goWzIsIDJdKTtcbiAgICBjdHguZHJhd0ltYWdlKHRoaXMuYmFja2dyb3VuZEltYWdlLl9lbGVtZW50LE1hdGguZmxvb3IocG9pbnRlci54KSAtIDQsIE1hdGguZmxvb3IocG9pbnRlci55KSAtIDQgLCA5ICwgOSwgMCwwICwgd2lkdGgsIHdpZHRoICk7XG4gICAgY3R4LnN0cm9rZVJlY3QoMCwwICwgd2lkdGgsIHdpZHRoKTtcbiAgICBjdHguc3Ryb2tlUmVjdCg0MCAsIDQwICwgMTAsIDEwKTtcbiAgICBjdHgucmVzdG9yZSgpO1xuICB9XG59KTtcblxuZmFicmljLlNsaWRlQ2FudmFzLnByb3RvdHlwZS5kcmF3aW5nVG9vbHMuU2VsZWN0aW9uID0ge1xuICBjbGFzc05hbWU6ICdmYSBmYS1tb3VzZS1wb2ludGVyJyxcbiAgdGl0bGU6ICdTZWxlY3Rpb24nXG59O1xuZmFicmljLlNsaWRlQ2FudmFzLnByb3RvdHlwZS5hY3RpdmVEcmF3aW5nVG9vbHMucHVzaChcIlNlbGVjdGlvblwiKTtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vbW9kdWxlcy9zbGlkZS5kcmF3aW5nLXRvb2xzLmpzXG4vLyBtb2R1bGUgaWQgPSA0NFxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCJmYWJyaWMudXRpbC5jcmVhdGVUaHVtYiA9IGZ1bmN0aW9uKHNsaWRlLCAkZWwpe1xuXG4gIHZhciBfY2FudmFzID0gc2xpZGUuY2FudmFzLFxuICAgICAgZmlyc3REcmF3ID0gdHJ1ZSxcbiAgICAgIG1vZGlmaWVkLFxuICAgICAgX3cgPSArJGVsLmdldEF0dHJpYnV0ZShcIndpZHRoXCIpLFxuICAgICAgX2ggPSArJGVsLmdldEF0dHJpYnV0ZShcImhlaWdodFwiKTtcblxuICBpZiAoX2gpIHtcbiAgICAkZWwuc3R5bGUuaGVpZ2h0ID0gJGVsLmhlaWdodDtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlbmRlclRodW1iKCkge1xuICAgIGlmIChfY2FudmFzLnByb2Nlc3NpbmcgfHwgIV9jYW52YXMubG9hZGVkKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIF9jYW52YXMucmVuZGVyVGh1bWIoJGVsKTtcbiAgICBtb2RpZmllZCA9IF9jYW52YXMubW9kaWZpZWQ7XG4gIH1cblxuICBmdW5jdGlvbiBmb3JjZVJlbmRlclRodW1iKCkge1xuICAgIGlmICh0aGlzLmNhbnZhcykge1xuICAgICAgaWYgKHRoaXMuY2FudmFzLmxvYWRlZCkge1xuICAgICAgICB0aGlzLmNhbnZhcy5yZW5kZXJUaHVtYigkZWwpO1xuICAgICAgfVxuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoZmlyc3REcmF3ICYmIHRoaXMuZGF0YS50aHVtYikge1xuICAgICAgdmFyIGltZyA9IG5ldyBJbWFnZSgpO1xuICAgICAgaW1nLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGN0eCA9ICRlbC5nZXRDb250ZXh0KFwiMmRcIik7XG4gICAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgJGVsLndpZHRoLCAkZWwuaGVpZ2h0KTtcbiAgICAgICAgY3R4LmRyYXdJbWFnZShpbWcsIDAsIDAsICRlbC53aWR0aCwgJGVsLmhlaWdodCk7XG4gICAgICAgIG1vZGlmaWVkID0gdGhpcy5tb2RpZmllZDtcbiAgICAgIH07XG4gICAgICBpbWcuc3JjID0gdGhpcy5kYXRhLnRodW1iO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmIChhdHRycy5mb3JjZSAhPT0gXCJ0cnVlXCIpIHJldHVybjtcbiAgICB2YXIgY2FudmFzID0gbmV3IGZhYnJpYy5TbGlkZUNhbnZhcyhudWxsLCB0aGlzLmRhdGEsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNhbnZhcy5yZW5kZXJUaHVtYigkZWwpO1xuICAgICAgLy9tb2RpZmllZCA9IHNsaWRlLm1vZGlmaWVkO1xuICAgIH0pO1xuICB9XG5cblxuICBmdW5jdGlvbiBzY2FsZVRodW1iKCkge1xuXG4gICAgdmFyIF9jb250YWluZXIgPSB7XG4gICAgICB3aWR0aDogX3csXG4gICAgICBoZWlnaHQ6IF9oLFxuICAgIH07XG5cbiAgICB2YXIgc2l6ZSA9IHtcbiAgICAgIHdpZHRoOiBzbGlkZS5jYW52YXMub3JpZ2luYWxXaWR0aCB8fCBzbGlkZS5jYW52YXMud2lkdGgsXG4gICAgICBoZWlnaHQ6IHNsaWRlLmNhbnZhcy5vcmlnaW5hbEhlaWdodCB8fCBzbGlkZS5jYW52YXMuaGVpZ2h0XG4gICAgfTtcblxuICAgIHZhciBfZml0U2l6ZSA9IGZhYnJpYy51dGlsLmdldFByb3BvcnRpb25zKCBzaXplLF9jb250YWluZXIsXCJmaXRcIik7XG5cbiAgICAkZWwud2lkdGggPSBfZml0U2l6ZS53aWR0aDtcbiAgICAkZWwuaGVpZ2h0ID0gX2ZpdFNpemUuaGVpZ2h0O1xuXG5cbiAgICAkZWwuc3R5bGUud2lkdGggPSBfZml0U2l6ZS53aWR0aCArICdweCc7XG4gICAgJGVsLnN0eWxlLmhlaWdodCA9IF9maXRTaXplLmhlaWdodCAgKyAncHgnO1xuICAgIHJlbmRlclRodW1iKCk7XG4gIH1cblxuICBmdW5jdGlvbiBjYW52YXNDaGFuZ2VkKCkge1xuICAgIC8vIF9jYW52YXMgJiYgX2NhbnZhcy5vZmYoJ2FmdGVyOnJlbmRlcicsIHJlbmRlclRodW1iKTtcbiAgICAvLyBpZiAodGhpcy5jYW52YXMpIHtcbiAgICAgIC8vIF9jYW52YXMgPSBzY29wZS5mZlRodW1iLmNhbnZhcztcbiAgICAgIHRoaXMuY2FudmFzLm9uKCdhZnRlcjpyZW5kZXInLCByZW5kZXJUaHVtYik7XG4gICAgICB0aGlzLmNhbnZhcy5vbihcImRpbWVuc2lvbnM6bW9kaWZpZWRcIiwgc2NhbGVUaHVtYik7XG4gICAgICB0aGlzLmNhbnZhcy5vbihcImxvYWRpbmc6ZW5kXCIsIHNjYWxlVGh1bWIpO1xuICAgIC8vIH1cbiAgfVxuXG5cbiAgJGVsLnNldEF0dHJpYnV0ZShcInRpdGxlXCIsIHNsaWRlLnRpdGxlKTtcbiAgc2xpZGUub24oJ2NhbnZhczpjaGFuZ2VkJywgY2FudmFzQ2hhbmdlZCk7XG4gIHNsaWRlLm9uKCdtb2RpZmllZCcsIGZvcmNlUmVuZGVyVGh1bWIpO1xuXG4gIHNjYWxlVGh1bWIuY2FsbChzbGlkZSk7XG4gIGZvcmNlUmVuZGVyVGh1bWIuY2FsbChzbGlkZSk7XG4gIGNhbnZhc0NoYW5nZWQuY2FsbChzbGlkZSk7XG5cbn07XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL21vZHVsZXMvdGh1bWIuanNcbi8vIG1vZHVsZSBpZCA9IDQ1XG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIid1c2Ugc3RyaWN0JztcbmlmKCFUb29sYmFyKXtcbiAgdmFyIFRvb2xiYXIgPSByZXF1aXJlKCcuLy4uLy4uL3Rvb2xiYXIvc3JjL3Rvb2xiYXInKTtcbiAgcmVxdWlyZSgnLi8uLi8uLi90b29sYmFyL21vZHVsZXMvdG9vbGJhci5jb2xvcnMnKTtcbiAgcmVxdWlyZSgnLi8uLi8uLi90b29sYmFyL21vZHVsZXMvdG9vbGJhci5mb250cycpO1xuICByZXF1aXJlKCcuLy4uLy4uL3Rvb2xiYXIvbW9kdWxlcy90b29sYmFyLm9wdGlvbnMnKTtcbiAgcmVxdWlyZSgnLi8uLi8uLi90b29sYmFyL21vZHVsZXMvdG9vbGJhci5zZWxlY3QnKTtcbiAgcmVxdWlyZSgnLi8uLi8uLi90b29sYmFyL21vZHVsZXMvdG9vbGJhci5lZmZlY3QnKTtcbn1cblxuVG9vbGJhci5wcm90b3R5cGUuc2V0RnVuY3Rpb25DYWxsYmFjayA9IGZ1bmN0aW9uKHRhcmdldCl7XG4gIGlmKHRhcmdldC5jYW52YXMpe1xuICAgIHJldHVybiB0YXJnZXQuY2FudmFzLnJlbmRlckFsbCgpO1xuICB9XG4gIGlmKHRhcmdldC5yZW5kZXJBbGwpe1xuICAgIHJldHVybiB0YXJnZXQucmVuZGVyQWxsKClcbiAgfVxufTtcblxuXG5mYWJyaWMuVG9vbHNNaXhpbiA9IHtcbiAgLyoqXG4gICAqXG4gICAqIEBwYXJhbSB0b29scyBbXCJ4XCIsIFwiKlwiLCBcInlcIl1cbiAgICogQHBhcmFtIHByb3RvXG4gICAqIEByZXR1cm5zIFtcInhcIiwgXCJhXCIsIFwiYlwiLCBcImNcIiwgXCJ5XCJdXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBfZ2V0VG9vbHM6IGZ1bmN0aW9uKHRvb2xzLHByb3RvKXtcbiAgICB2YXIgaW5kZXhPZlN0YXIgPSAtMTtcbiAgICBpZigoaW5kZXhPZlN0YXIgPSB0b29scy5pbmRleE9mKFwiKlwiKSkgPT0gLTEpe1xuICAgICAgcmV0dXJuIHRvb2xzO1xuICAgIH1cblxuICAgIHZhciBrbGFzc25hbWUgPSBmYWJyaWMudXRpbC5zdHJpbmcuY2FwaXRhbGl6ZShmYWJyaWMudXRpbC5zdHJpbmcuY2FtZWxpemUocHJvdG8udHlwZSksdHJ1ZSk7XG4gICAgdmFyIHByb3RvRmFicmljID0gZmFicmljW2tsYXNzbmFtZV0ucHJvdG90eXBlO1xuICAgIHZhciBwcm90b0FwcCA9IHRoaXMuYXBwbGljYXRpb24ucHJvdG90eXBlc1trbGFzc25hbWVdO1xuXG4gICAgdmFyIHRvb2xzMiA9IHByb3RvQXBwICYmIHByb3RvQXBwLnRvb2xzIHx8IHByb3RvRmFicmljLnRvb2xzO1xuICAgIGlmKHRvb2xzMil7XG4gICAgICB0b29scy5zcGxpY2UuYXBwbHkodG9vbHMsIFtpbmRleE9mU3RhciwgMV0uY29uY2F0KHRvb2xzMikpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5fZ2V0VG9vbHModG9vbHMsIHByb3RvRmFicmljLl9fcHJvdG9fXyApO1xuICB9LFxuICBzZXRUb29sczogZnVuY3Rpb24odG9vbHMpe1xuICAgIHRoaXMudG9vbHMgPSB0aGlzLl9nZXRUb29scyh0b29scyAsIHRoaXMuX19wcm90b19fLl9fcHJvdG9fXyk7XG4gICAgdGhpcy5tYWtlQWN0aW9ucygpO1xuICB9LFxuICBfZ2V0QWN0aW9uVmFsdWU6IGZ1bmN0aW9uIChwcm9wZXJ0eSkge1xuICAgIHZhciBvYmplY3QgPSB0aGlzO1xuICAgIGRve1xuICAgICAgaWYob2JqZWN0LmFjdGlvbnMgJiYgb2JqZWN0LmFjdGlvbnNbcHJvcGVydHldKXtcbiAgICAgICAgcmV0dXJuIG9iamVjdC5hY3Rpb25zW3Byb3BlcnR5XTtcbiAgICAgIH1cbiAgICB9d2hpbGUob2JqZWN0ID0gb2JqZWN0Ll9fcHJvdG9fXyk7XG4gICAgcmV0dXJuIG51bGw7XG4gIH0sXG4gIG1ha2VBY3Rpb25zOiBmdW5jdGlvbigpe1xuICAgIHZhciBhY3Rpb25zID0ge307XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIF8uZWFjaCh0aGlzLnRvb2xzLCBmdW5jdGlvbih0b29sKXtcbiAgICAgIHZhciBfdmFsID0gc2VsZi5fZ2V0QWN0aW9uVmFsdWUodG9vbCk7XG4gICAgICBpZihfdmFsKXtcbiAgICAgICAgYWN0aW9uc1t0b29sXSA9IF92YWw7XG4gICAgICB9ZWxzZXtcbiAgICAgICAgY29uc29sZS53YXJuKFwidG9vbCBcIiArIHRvb2wgKyBcIiBpcyB1bmRlZmluZWRcIik7XG4gICAgICB9XG4gICAgfSk7XG4gICAgdGhpcy5nZW5lcmF0ZWRBY3Rpb25zID0gVG9vbGJhci5tYWtlQWN0aW9ucyhhY3Rpb25zLHRoaXMpO1xuICB9XG59O1xuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuQ2FudmFzLnByb3RvdHlwZSxmYWJyaWMuVG9vbHNNaXhpbik7XG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5PYmplY3QucHJvdG90eXBlLGZhYnJpYy5Ub29sc01peGluKTtcbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLkFwcGxpY2F0aW9uLnByb3RvdHlwZSxmYWJyaWMuVG9vbHNNaXhpbik7XG5cblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuQXBwbGljYXRpb24ucHJvdG90eXBlLHtcbiAgdG9vbGJhcjogZmFsc2UsXG4gIHNldEFwcGxpY2F0aW9uVG9vbGJhckNvbnRhaW5lcjogZnVuY3Rpb24oY29udGFpbmVySWQpIHtcbiAgICB0aGlzLmFwcGxpY2F0aW9uVG9vbGJhckNvbnRhaW5lciA9IGNvbnRhaW5lcklkO1xuICAgIG5ldyBmYWJyaWMuVG9vbGJhcih0aGlzLCBjb250YWluZXJJZCk7XG4gIH0sXG4gIHNldENhbnZhc1Rvb2xiYXJDb250YWluZXI6IGZ1bmN0aW9uKGNvbnRhaW5lcklkKSB7XG4gICAgdGhpcy5jYW52YXNUb29sYmFyQ29udGFpbmVyID0gY29udGFpbmVySWQ7XG4gICAgbmV3IGZhYnJpYy5Ub29sYmFyKHRoaXMuY2FudmFzLCBjb250YWluZXJJZCk7XG4gIH0sXG4gIHNldE9iamVjdHNUb29sYmFyT3B0aW9uczogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgIG9wdGlvbnMgPSBfLmRlZmF1bHRzKG9wdGlvbnMgfHwge1xuICAgICAgb3JpZ2luWDogXCJsZWZ0XCIsXG4gICAgICBvcmlnaW5ZOiBcInRvcFwiLFxuICAgICAgbWFyZ2luWDogMCxcbiAgICAgIG1hcmdpblk6IDBcbiAgICB9KTtcblxuICAgIHRoaXMub2JqZWN0c1Rvb2xiYXJPcHRpb25zID0gb3B0aW9ucztcblxuICAgIHZhciBjYW52YXMgPSB0aGlzLmNhbnZhcztcbiAgICBjYW52YXMub24oe1xuICAgICAgJ29iamVjdDptb3ZpbmcnOiBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgdmFyICRtZW51ID0gdGhpcy5nZXRUb29sYmFyQ29udGFpbmVyKCk7XG4gICAgICAgIGNhbnZhcy5zZXRUb29sYmFyQ29vcmRzKCRtZW51LCBjYW52YXMudGFyZ2V0LCBjYW52YXMuYXBwbGljYXRpb24ub2JqZWN0c1Rvb2xiYXJPcHRpb25zKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSxcbiAgc2V0T2JqZWN0c1Rvb2xiYXJDb250YWluZXI6IGZ1bmN0aW9uKGNvbnRhaW5lcklkKSB7XG4gICAgdGhpcy5vYmplY3RzVG9vbGJhckNvbnRhaW5lciA9IGNvbnRhaW5lcklkO1xuXG4gICAgdmFyIGNhbnZhcyA9IHRoaXMuY2FudmFzO1xuXG4gICAgaWYgKGNvbnRhaW5lcklkKSB7XG4gICAgICB0aGlzLiRtZW51ID0gJChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjb250YWluZXJJZCkpLmhpZGUoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy4kbWVudSA9IHRoaXMuJG1lbnUgfHwgJCgnPGRpdj4nKTtcbiAgICAgICQodGhpcy53cmFwcGVyRWwpLnByZXBlbmQodGhpcy4kbWVudSk7XG4gICAgfVxuICAgIHRoaXMuJG1lbnUuaGlkZSgpO1xuXG4gICAgdmFyIF9sYXN0X3RhcmdldCA9IGNhbnZhcy50YXJnZXQ7XG4gICAgY2FudmFzLm9uKHtcbiAgICAgICd0YXJnZXQ6Y2xlYXJlZCc6IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICBpZiAoX2xhc3RfdGFyZ2V0KSB7XG4gICAgICAgICAgdmFyICRtZW51ID0gdGhpcy5nZXRUb29sYmFyQ29udGFpbmVyKCk7XG4gICAgICAgICAgJG1lbnUuaGlkZSgpO1xuICAgICAgICAgIGNhbnZhcy5vYmplY3RUb29sYmFyLmRlc3Ryb3koKTtcbiAgICAgICAgICBkZWxldGUgY2FudmFzLm9iamVjdFRvb2xiYXI7XG4gICAgICAgICAgX2xhc3RfdGFyZ2V0ID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgICd0YXJnZXQ6Y2hhbmdlZCc6IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICBpZiAoX2xhc3RfdGFyZ2V0KSB7XG4gICAgICAgICAgY2FudmFzLm9iamVjdFRvb2xiYXIuZGVzdHJveSgpO1xuICAgICAgICB9XG4gICAgICAgIGNhbnZhcy5jcmVhdGVGbG9hdGVkTWVudSh0aGlzLmFwcGxpY2F0aW9uLm9iamVjdHNUb29sYmFyT3B0aW9ucyk7XG4gICAgICAgIF9sYXN0X3RhcmdldCA9IGV2ZW50LnRhcmdldDtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSxcbiAgc2V0VG9vbGJhck9wdGlvbnM6IGZ1bmN0aW9uKHRvb2xiYXJPcHRpb25zKXtcblxuICAgIGZhYnJpYy51dGlsLm9iamVjdC5kZWVwRXh0ZW5kKFRvb2xiYXIudG9vbHMsIHRvb2xiYXJPcHRpb25zLnRvb2xzKTtcbiAgICBmb3IgKHZhciBrbGFzc05hbWUgaW4gdG9vbGJhck9wdGlvbnMuYWN0aW9ucykge1xuICAgICAgdmFyIGFjdGlvbnMgPSB0b29sYmFyT3B0aW9ucy5hY3Rpb25zW2tsYXNzTmFtZV07XG4gICAgICBpZighZmFicmljW2tsYXNzTmFtZV0ucHJvdG90eXBlLmFjdGlvbnMpe1xuICAgICAgICBmYWJyaWNba2xhc3NOYW1lXS5wcm90b3R5cGUuYWN0aW9ucyA9IHt9XG4gICAgICB9XG4gICAgICB2YXIgcHJvdG9BY3Rpb25zID0gZmFicmljW2tsYXNzTmFtZV0ucHJvdG90eXBlLmFjdGlvbnM7XG5cbiAgICAgIGlmIChhY3Rpb25zLmNvbnN0cnVjdG9yID09IEZ1bmN0aW9uKSB7XG4gICAgICAgIGFjdGlvbnMgPSBhY3Rpb25zLmNhbGwoZmFicmljW2tsYXNzTmFtZV0ucHJvdG90eXBlKVxuICAgICAgfWVsc2V7XG4gICAgICAgIGFjdGlvbnMgPSBmYWJyaWMudXRpbC5vYmplY3QuY2xvbmVEZWVwKGFjdGlvbnMpO1xuICAgICAgfVxuICAgICAvLyB2YXIgJG9yZGVyID0gYWN0aW9uc1tcIiRvcmRlclwiXTtcbiAgICAgLy8gZGVsZXRlIGFjdGlvbnNbXCIkb3JkZXJcIl07XG5cbiAgICAgIGZvciAodmFyIGogaW4gYWN0aW9ucykge1xuICAgICAgICBpZihwcm90b0FjdGlvbnNbal0pe1xuICAgICAgICAgIGlmIChhY3Rpb25zW2pdW1wiJGNsb25lXCJdKSB7XG4gICAgICAgICAgICBwcm90b0FjdGlvbnNbal0gPSBmYWJyaWMudXRpbC5vYmplY3QuZGVlcEV4dGVuZCh7fSwgcHJvdG9BY3Rpb25zW2pdKTtcbiAgICAgICAgICAgIGRlbGV0ZSBhY3Rpb25zW2pdW1wiJGNsb25lXCJdO1xuICAgICAgICAgIH1cbiAgICAgICAgICBmYWJyaWMudXRpbC5vYmplY3QuZGVlcEV4dGVuZChwcm90b0FjdGlvbnNbal0sIGFjdGlvbnNbal0pO1xuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICBwcm90b0FjdGlvbnNbal0gPSBhY3Rpb25zW2pdO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgIC8qIGlmKCRvcmRlcil7XG4gICAgICAgIGZhYnJpY1trbGFzc05hbWVdLnByb3RvdHlwZS5hY3Rpb25zID0gZmFicmljLnV0aWwub2JqZWN0LnJlYXJyYW5nZShwcm90b0FjdGlvbnMsICRvcmRlcik7XG4gICAgICB9Ki9cbiAgICB9XG4gIH0sXG4gIGV2ZW50TGlzdGVuZXJzOiBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kQXJyYXlzT2JqZWN0KGZhYnJpYy5BcHBsaWNhdGlvbi5wcm90b3R5cGUuZXZlbnRMaXN0ZW5lcnMsIHtcbiAgIC8vIFwiY2FudmFzOmNyZWF0ZWRcIiA6IGZ1bmN0aW9uKCl7XG4gICAgLy8gIHRoaXMuaW5pdFRvb2xzKCk7XG4gICAvLyB9LFxuICAgLy8gIFwiY2FudmFzOmNyZWF0ZWRcIjogZnVuY3Rpb24oKXtcbiAgIC8vICAgIHRoaXMuY3JlYXRlVG9vbGJhcnMoKTtcbiAgIC8vICB9XG4gIH0pXG59KTtcblxuZmFicmljLlRvb2xiYXIgPSBUb29sYmFyO1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5DYW52YXMucHJvdG90eXBlLCB7XG4gIHNldFRvb2xiYXJDb29yZHM6IGZ1bmN0aW9uICgkbWVudSwgdGFyZ2V0LCBvcHRpb25zKSB7XG5cbiAgICBvcHRpb25zID0gZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCh7XG4gICAgICBvcmlnaW5YOiBcImxlZnRcIixcbiAgICAgIG9yaWdpblk6IFwidG9wXCIsXG4gICAgICBtYXJnaW5YOiAwLFxuICAgICAgbWFyZ2luWTogMFxuICAgIH0sIG9wdGlvbnMpO1xuXG4gICAgdGFyZ2V0LnNldENvb3JkcygpO1xuICAgIHZhciByID0gdGFyZ2V0LmdldEJvdW5kaW5nUmVjdCgpO1xuXG4gICAgdmFyIF9sZWZ0O1xuICAgIHN3aXRjaCAob3B0aW9ucy5vcmlnaW5YKSB7XG4gICAgICBjYXNlIFwibGVmdFwiOlxuICAgICAgICBfbGVmdCA9IHIubGVmdDtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwicmlnaHRcIjpcbiAgICAgICAgX2xlZnQgPSByLmxlZnQgKyByLndpZHRoO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJjZW50ZXJcIjpcbiAgICAgICAgX2xlZnQgPSByLmxlZnQgKyByLndpZHRoIC8gMjtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICAgIDtcbiAgICB2YXIgX3RvcDtcbiAgICBzd2l0Y2ggKG9wdGlvbnMub3JpZ2luWSkge1xuICAgICAgY2FzZSBcInRvcFwiOlxuICAgICAgICBfdG9wID0gci50b3AgLSAkbWVudS5oZWlnaHQoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwiYm90dG9tXCI6XG4gICAgICAgIF90b3AgPSByLnRvcCArIHIuaGVpZ2h0O1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJjZW50ZXJcIjpcbiAgICAgICAgX3RvcCA9IHIudG9wICsgci5oZWlnaHQgLyAyIC0gJG1lbnUuaGVpZ2h0KCkgLyAyO1xuICAgICAgICBicmVhaztcbiAgICB9XG4gICAgO1xuXG5cbiAgICBfdG9wICs9IG9wdGlvbnMubWFyZ2luWTtcbiAgICBfbGVmdCArPSBvcHRpb25zLm1hcmdpblhcblxuICAgIHZhciBfbWVudUNvbnRhaW5lck9mZnNldCA9ICQoJG1lbnUucGFyZW50cygpWzBdKS5vZmZzZXQoKTtcbiAgICB2YXIgX2NhbnZhc09mZnNldCA9ICQodGhpcy53cmFwcGVyRWwpLm9mZnNldCgpO1xuXG4gICAgX3RvcCArPSBfY2FudmFzT2Zmc2V0LnRvcCAtIF9tZW51Q29udGFpbmVyT2Zmc2V0LnRvcDtcbiAgICBfbGVmdCArPSBfY2FudmFzT2Zmc2V0LmxlZnQgLSBfbWVudUNvbnRhaW5lck9mZnNldC5sZWZ0O1xuXG4gICAgdmFyIGNvb3JkcyA9IHtcbiAgICAgIHRvcDogTWF0aC5tYXgoMywgX3RvcCksXG4gICAgICBsZWZ0OiBNYXRoLm1pbihNYXRoLm1heCgzLCBfbGVmdCksICQodGhpcy53cmFwcGVyRWwpLndpZHRoKCkgLSAkbWVudS53aWR0aCgpIC0gNSlcbiAgICB9O1xuXG5cbiAgICAkKHRoaXMud3JhcHBlckVsKS5vZmZzZXQoKTtcblxuICAgICRtZW51LmNzcyhjb29yZHMpO1xuICAgIHJldHVybiBjb29yZHM7XG4gIH0sXG4gIGdldFRvb2xiYXJDb250YWluZXI6IGZ1bmN0aW9uIChpZCwgb3B0aW9ucykge1xuICAgIHJldHVybiAkKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMuYXBwbGljYXRpb24ub2JqZWN0c1Rvb2xiYXJDb250YWluZXIpKTtcbiAgfSxcbiAgY3JlYXRlRmxvYXRlZE1lbnU6IGZ1bmN0aW9uIChvcHRpb25zKSB7XG5cbiAgICB2YXIgJG1lbnUgPSB0aGlzLmdldFRvb2xiYXJDb250YWluZXIoKTtcblxuICAgICRtZW51LnNob3coKTtcbiAgICAvL3RoaXMudG9vbHNDb250YWluZXIgPSB0aGlzLiRtZW51O1xuICAgLyogdmFyIF90YyA9ICRtZW51LmZpbmQoXCIudG9vbGJhci10b29scy1jb250YWluZXJcIik7XG4gICAgaWYgKF90Yy5sZW5ndGgpIHtcbiAgICAgIHRoaXMudG9vbHNDb250YWluZXIgPSBfdGM7XG4gICAgfSovXG4gICAvLyB0aGlzLnRvb2xzQ29udGFpbmVyLmVtcHR5KCk7XG4gICAgaWYgKHRoaXMudGFyZ2V0LmFjdGlvbnMpIHtcbiAgICAgIHRoaXMub2JqZWN0VG9vbGJhciA9IG5ldyBmYWJyaWMuVG9vbGJhciAodGhpcy50YXJnZXQsICRtZW51LCBvcHRpb25zKTtcbiAgICB9XG4gICAgaWYodGhpcy5hcHBsaWNhdGlvbi5vYmplY3RzVG9vbGJhck9wdGlvbnMpe1xuICAgICAgJG1lbnUuYWRkQ2xhc3MoXCJmbG9hdGVkLW1lbnVcIik7XG4gICAgICB0aGlzLnNldFRvb2xiYXJDb29yZHMoJG1lbnUsIHRoaXMudGFyZ2V0LCB0aGlzLmFwcGxpY2F0aW9uLm9iamVjdHNUb29sYmFyT3B0aW9ucyk7XG5cbiAgICB9XG4gIH1cbn0pO1xuXG5cblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vbW9kdWxlcy90b29sYmFyLmpzXG4vLyBtb2R1bGUgaWQgPSA0NlxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCIndXNlIHN0cmljdCc7XG5cblxuZmFicmljLnV0aWwudXBsb2FkSW1hZ2VNYXhTaXplID0ge1xuICB3aWR0aDogNDAwLFxuICBoZWlnaHQ6IDQwMFxufTtcblxuZmFicmljLnV0aWwudXBsb2FkSW1hZ2VNaW5TaXplID0ge1xuICB3aWR0aDogMTAwLFxuICBoZWlnaHQ6IDEwMFxufTtcblxuZmFicmljLnV0aWwubXVsdGlVcGxvYWQgPSBmYWxzZTtcblxuZmFicmljLnV0aWwucmVhZEZpbGUgPSBmdW5jdGlvbihmaWxlLGNhbGxiYWNrKXtcblxuICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcbiAgcmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uIChlKSB7XG4gICAgdmFyIHJlc3VsdCA9IGUudGFyZ2V0LnJlc3VsdDtcbiAgICB2YXIgdHlwZSA9IHJlc3VsdC5zdWJzdHIoMTEsIHJlc3VsdC5pbmRleE9mKFwiO1wiKSAtIDExKTtcbiAgICB2YXIgaW1nID0gbmV3IEltYWdlKCk7XG4gICAgaW1nLnR5cGUgPSB0eXBlO1xuICAgIGltZy5uYW1lID0gZmlsZS5uYW1lO1xuICAgIGltZy5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XG5cbiAgICAgIGlmKCFmYWJyaWMudXRpbC5tdWx0aVVwbG9hZCl7XG4gICAgICAgIGlmIChmYWJyaWMudXRpbC51cGxvYWRQcmVwcm9jZXNzb3IpIHtcbiAgICAgICAgICBmYWJyaWMudXRpbC51cGxvYWRQcmVwcm9jZXNzb3IoW3RoaXNdLCBmdW5jdGlvbiAodmFsKSB7XG4gICAgICAgICAgICBjYWxsYmFjayh2YWwpO1xuICAgICAgICAgIH0sb3B0aW9ucylcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjYWxsYmFjayh0aGlzKTtcbiAgICAgICAgfVxuICAgICAgfWVsc2V7XG4gICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICB9XG4gICAgfTtcbiAgICBpbWcuc3JjID0gcmVzdWx0O1xuICB9O1xuICByZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlICk7XG59O1xuXG5cbmZhYnJpYy51dGlsLmNyZWF0ZVVwbG9hZElucHV0ID0gZnVuY3Rpb24gKG9wdGlvbnMsIGNvbXBsZXRlLCBwcm9ncmVzcykge1xuXG4gIHZhciBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiKTtcbiAgaW5wdXQuc2V0QXR0cmlidXRlKFwidHlwZVwiLCBcImZpbGVcIik7XG4gIGlucHV0LnNldEF0dHJpYnV0ZShcIm11bHRpcGxlXCIsIHRydWUpO1xuICBpbnB1dC5jbGFzc05hbWUgPSBcImhpZGRlblwiO1xuXG4gICQoaW5wdXQpLmNoYW5nZShmdW5jdGlvbiAoKSB7XG5cbiAgICBpZihpbnB1dC5maWxlcyAmJiBpbnB1dC5maWxlcy5sZW5ndGgpe1xuXG4gICAgICB2YXIgX2xvYWRlciA9IGZhYnJpYy51dGlsLnF1ZXVlTG9hZChpbnB1dC5maWxlcy5sZW5ndGgsZnVuY3Rpb24obG9hZGVkKXtcblxuICAgICAgICBpZihmYWJyaWMudXRpbC5tdWx0aVVwbG9hZCl7XG4gICAgICAgICAgaWYgKGZhYnJpYy51dGlsLnVwbG9hZFByZXByb2Nlc3Nvcikge1xuICAgICAgICAgICAgZmFicmljLnV0aWwudXBsb2FkUHJlcHJvY2Vzc29yKGxvYWRlZCwgZnVuY3Rpb24gKHZhbCkge1xuICAgICAgICAgICAgICBjb21wbGV0ZSh2YWwsb3B0aW9ucyk7XG4gICAgICAgICAgICB9LG9wdGlvbnMpXG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbXBsZXRlKGxvYWRlZCxvcHRpb25zKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1lbHNle1xuICAgICAgICAgIGNvbXBsZXRlKGxvYWRlZFswXSxvcHRpb25zKTtcblxuICAgICAgICB9XG4gICAgICB9LGZ1bmN0aW9uKHRvdGFsLCBjdXJyZW50LCBpbWFnZSl7XG4gICAgICAgIGlmKGZhYnJpYy51dGlsLm11bHRpVXBsb2FkKSB7XG4gICAgICAgICAgaWYgKHByb2dyZXNzKSB7XG4gICAgICAgICAgICBwcm9ncmVzcyh0b3RhbCwgY3VycmVudCwgaW1hZ2UpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG5cblxuXG4gICAgICBmb3IodmFyIGkgPTA7IGk8IGlucHV0LmZpbGVzLmxlbmd0aDsgaSsrKXtcbiAgICAgICAgZmFicmljLnV0aWwucmVhZEZpbGUoaW5wdXQuZmlsZXNbaV0sX2xvYWRlcik7XG4gICAgICB9XG5cblxuXG4gICAgfVxuXG4gIH0pO1xuXG4gIGZhYnJpYy51dGlsLnVwbG9hZElucHV0ID0gaW5wdXQ7XG59O1xuXG5cbi8vZmFicmljLnV0aWwucmVzaXplSW1hZ2UoaW1nLCBjYWxsYmFjayk7XG5mYWJyaWMudXRpbC51cGxvYWRQcmVwcm9jZXNzb3IgPSBudWxsO1xuXG5cbmZhYnJpYy51dGlsLnVwbG9hZEltYWdlID0gZnVuY3Rpb24gKGNiLHByb2dyZXNzLG9wdGlvbnMpIHtcbiAgZmFicmljLnV0aWwuY3JlYXRlVXBsb2FkSW5wdXQob3B0aW9ucyxjYixwcm9ncmVzcyk7XG4gICQoZmFicmljLnV0aWwudXBsb2FkSW5wdXQpLnRyaWdnZXIoJ2NsaWNrJyk7XG59O1xuXG5cbmZhYnJpYy51dGlsLnJlc2l6ZVVwbG9hZGVkSW1hZ2UgPSBmdW5jdGlvbiAoaW1nLCBjYWxsYmFjaykge1xuXG4gIGlmIChpbWcudHlwZSA9PT0gXCJzdmcreG1sXCIpIHtcbiAgICBjYWxsYmFjayhpbWcpO1xuICAgIHJldHVybjtcbiAgfVxuICAvL0hlcmUgd2UgY2FuIHB1dCBhIHJlc3RyaWN0aW9uIHRvIHVwbG9hZCBhIG1pbmltIHNpemVkIGxvZ29cbiAgaWYgKGltZy53aWR0aCA8IGZhYnJpYy51dGlsLnVwbG9hZEltYWdlTWluU2l6ZS53aWR0aCB8fCBpbWcuaGVpZ2h0IDwgZmFicmljLnV0aWwudXBsb2FkSW1hZ2VNaW5TaXplLmhlaWdodCkge1xuICAgIGFsZXJ0KFwiTG9nbyBpcyB0b28gc21hbGwuIE1JbmltdW0gc2l6ZSBpcyBcIiArIGZhYnJpYy51dGlsLnVwbG9hZEltYWdlTWluU2l6ZS53aWR0aCArIFwieFwiICsgZmFicmljLnV0aWwudXBsb2FkSW1hZ2VNaW5TaXplLmhlaWdodCk7XG4gICAgY2FsbGJhY2soZmFsc2UpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGlmIChpbWcud2lkdGggPiBmYWJyaWMudXRpbC51cGxvYWRJbWFnZU1heFNpemUud2lkdGggfHwgaW1nLmhlaWdodCA+IGZhYnJpYy51dGlsLnVwbG9hZEltYWdlTWF4U2l6ZS5oZWlnaHQpIHtcblxuICAgIHZhciBzaXplID0gZmFicmljLnV0aWwuZ2V0UHJvcG9ydGlvbnMoaW1nLCBmYWJyaWMudXRpbC51cGxvYWRJbWFnZU1heFNpemUsIFwiZml0XCIpO1xuXG4gICAgdmFyIGZpbHRlciA9IG5ldyBmYWJyaWMuSW1hZ2UuZmlsdGVycy5SZXNpemVEUCgpO1xuXG4gICAgdmFyIGNhbnZhcyA9IGZhYnJpYy51dGlsLmNyZWF0ZUNhbnZhc0VsZW1lbnRXaXRoU2l6ZShpbWcpO1xuICAgIHZhciBjdHggPSBjYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpO1xuICAgIGN0eC5kcmF3SW1hZ2UoaW1nLCAwLCAwKTtcbiAgICBmaWx0ZXIuYXBwbHlUbyhjYW52YXMsIHNpemUud2lkdGgsIHNpemUuaGVpZ2h0KTtcbiAgICBjYWxsYmFjayhjYW52YXMpO1xuICB9IGVsc2Uge1xuICAgIGNhbGxiYWNrKGltZyk7XG4gIH1cbn07XG5cblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuQ2FudmFzLnByb3RvdHlwZSx7XG4gIHVwbG9hZENsYXNzOiAnSW1hZ2UnLFxuICB1cGxvYWRJbWFnZVRvb2w6IGZhbHNlLFxuICBjcmVhdGVJbWFnZU9iamVjdDogZnVuY3Rpb24gKGltZywgb2JqZWN0VHlwZSkge1xuICAgIGlmICghaW1nKXJldHVybjtcbiAgICB0aGlzLmNyZWF0ZU9iamVjdCh7XG4gICAgICBwb3NpdGlvbjogXCJjZW50ZXJcIixcbiAgICAgIGFjdGl2ZTogdHJ1ZSxcbiAgICAgIHR5cGU6IHRoaXMudXBsb2FkQ2xhc3MsXG4gICAgICBpbWFnZTogaW1nLFxuICAgICAgY2xpcFRvOiB0aGlzLmFjdGl2ZUFyZWEsXG4gICAgICBtb3ZlbWVudExpbWl0czogdGhpcy5hY3RpdmVBcmVhXG4gICAgfSk7XG4gIH0sXG4gIGFjdGlvbnM6IGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLlNsaWRlQ2FudmFzLnByb3RvdHlwZS5hY3Rpb25zLHtcbiAgICB1cGxvYWRJbWFnZToge1xuICAgICAgY2xhc3NOYW1lOiAgJ2ZhIGZhLXVwbG9hZCcsXG4gICAgICBrZXk6ICdVJyxcbiAgICAgIHRpdGxlOiAndXBsb2FkIGltYWdlJyxcbiAgICAgIGFjdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICBmYWJyaWMudXRpbC51cGxvYWRJbWFnZShmdW5jdGlvbihpbWcpe1xuICAgICAgICAgIHRoaXMuY3JlYXRlSW1hZ2VPYmplY3QoaW1nLHRoaXMudXBsb2FkQ2xhc3MpXG4gICAgICAgIH0uYmluZCh0aGlzKSlcbiAgICAgIH1cbiAgICB9XG4gIH0pXG59KTtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vbW9kdWxlcy91cGxvYWQuanNcbi8vIG1vZHVsZSBpZCA9IDQ3XG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIid1c2Ugc3RyaWN0JztcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vbW9kdWxlIHJlc3BvbnNpdmUgYm9yZGVycy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5PYmplY3QucHJvdG90eXBlLCB7XG4gIHJlc3BvbnNpdmVCb3JkZXJzOiBmYWxzZVxufSk7XG5cbmlmKCFmYWJyaWMuU2xpZGVDYW52YXMucHJvdG90eXBlLl9kZWZhdWx0X2V2ZW50X2xpc3RlbmVycyl7XG4gIGZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUuX2RlZmF1bHRfZXZlbnRfbGlzdGVuZXJzID0ge307XG59O1xuXG5mYWJyaWMuT2JqZWN0LnByb3RvdHlwZS51cGRhdGVSZXNwb25zaXZlQm9yZGVyID0gZnVuY3Rpb24oKXtcbiAgaWYodGhpcy5yZXNwb25zaXZlQm9yZGVycyl7XG4gICAgaWYoIXRoaXMub3JpZ2luYWxTdHJva2VXaWR0aCl7XG4gICAgICB0aGlzLm9yaWdpbmFsU3Ryb2tlV2lkdGggPSB0aGlzLnN0cm9rZVdpZHRoO1xuICAgIH1cbiAgICB0aGlzLnN0cm9rZVdpZHRoID0gdGhpcy5jYW52YXMgPyB0aGlzLm9yaWdpbmFsU3Ryb2tlV2lkdGggLyB0aGlzLmNhbnZhcy52aWV3cG9ydFRyYW5zZm9ybVswXSA6IDA7XG4gIH1cbn07XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLlNsaWRlQ2FudmFzLnByb3RvdHlwZSwge1xuICBfZGVmYXVsdF9ldmVudF9saXN0ZW5lcnM6IHtcbiAgICBcImRpbWVuc2lvbnM6bW9kaWZpZWRcIjogZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5jZW50ZXJBbmRab29tT3V0KCk7XG4gICAgfSxcbiAgICAndmlld3BvcnQ6c2NhbGVkJzogZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKHRoaXMuYmFja2dyb3VuZEltYWdlKSB7XG4gICAgICAgIHRoaXMuYmFja2dyb3VuZEltYWdlLnVwZGF0ZVJlc3BvbnNpdmVCb3JkZXIoKTtcbiAgICAgIH1cbiAgICAgIGZvciAodmFyIGkgaW4gdGhpcy5fb2JqZWN0cykge1xuICAgICAgICB0aGlzLl9vYmplY3RzW2ldLnVwZGF0ZVJlc3BvbnNpdmVCb3JkZXIoKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIFwiYmFja2dyb3VuZC1pbWFnZTpsb2FkZWRcIjogZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICBpZiAodGhpcy5hdXRvQ2VudGVyQW5kWm9vbU91dEVuYWJsZWQpIHtcbiAgICAgICAgdGhpcy5jZW50ZXJBbmRab29tT3V0KCk7XG4gICAgICB9XG4gICAgfSxcbiAgICBcImxvYWRpbmc6ZW5kXCI6IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgaWYgKHRoaXMuYXV0b0NlbnRlckFuZFpvb21PdXRFbmFibGVkICYmICh0aGlzLm9yaWdpbmFsSGVpZ2h0IHx8IHRoaXMub3JpZ2luYWxXaWR0aCkpIHtcbiAgICAgICAgdGhpcy5jZW50ZXJBbmRab29tT3V0KCk7XG4gICAgICB9XG4gICAgfSxcbiAgICBcIm9iamVjdDphZGRlZFwiOiBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgIGV2ZW50LnRhcmdldC51cGRhdGVSZXNwb25zaXZlQm9yZGVyKClcbiAgICB9XG4gIH1cbn0pO1xuXG5cbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG5cblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuU2xpZGVDYW52YXMucHJvdG90eXBlLCB7XG4gIHpvb21DdHJsS2V5OiB0cnVlLFxuICBtb3VzZVdoZWVsRW5hYmxlZCA6IGZhbHNlLFxuICBfc2V0Wm9vbU5hdGl2ZSAgOiBmYWJyaWMuQ2FudmFzLnByb3RvdHlwZS5zZXRab29tLFxuICBfem9vbVRvUG9pbnROYXRpdmUgIDogZmFicmljLkNhbnZhcy5wcm90b3R5cGUuem9vbVRvUG9pbnQsXG4gIGNoYW5nZURpbWVuc2lvbk9uWm9vbTogZmFsc2UsXG4gIGRyYXdab29tQXJlYSA6IGZ1bmN0aW9uKF9jdHgsbGVmdCwgdG9wICx3aWR0aCwgaGVpZ2h0ICl7XG4gICAgX2N0eC5zYXZlKCk7XG4gICAgX2N0eC50cmFuc2xhdGUobGVmdCB8fCAwLCB0b3AgfHwgMCk7XG4gICAgdmFyIF9zY2FsZSA9IHRoaXMuZ2V0Wm9vbSgpO1xuICAgIHZhciBfc2l6ZSA9IGZhYnJpYy51dGlsLmdldFByb3BvcnRpb25zKHRoaXMuYmFja2dyb3VuZEltYWdlLCB7d2lkdGg6IHdpZHRoIHx8IDEwMCwgaGVpZ2h0OiBoZWlnaHQgfHwgMTAwfSk7XG4gICAgX2N0eC5nbG9iYWxBbHBoYSA9IDAuNTtcbiAgICBfY3R4LmZpbGxSZWN0KDAsMCxfc2l6ZS53aWR0aCwgX3NpemUuaGVpZ2h0KTtcbiAgICBfY3R4LnN0cm9rZVN0eWxlID0gXCJyZWRcIjtcblxuICAgIHZhciB2ID0gdGhpcy52aWV3cG9ydFRyYW5zZm9ybTtcblxuICAgIHZhciB4MSA9IC12WzRdICogX3NpemUuc2NhbGUgLyBfc2NhbGU7XG4gICAgdmFyIHkxID0gLXZbNV0gKiBfc2l6ZS5zY2FsZSAvIF9zY2FsZTtcbiAgICB2YXIgeDIgPSB4MSArIHRoaXMud2lkdGggKiBfc2l6ZS5zY2FsZSAvIF9zY2FsZTtcbiAgICB2YXIgeTIgPSB5MSArIHRoaXMuaGVpZ2h0ICogX3NpemUuc2NhbGUgLyBfc2NhbGU7XG5cbiAgICB4MSA9IE1hdGgubWF4KHgxLDApO1xuICAgIHkxID0gTWF0aC5tYXgoeTEsMCk7XG4gICAgeDIgPSBNYXRoLm1pbih4Mixfc2l6ZS53aWR0aCk7XG4gICAgeTIgPSBNYXRoLm1pbih5Mixfc2l6ZS5oZWlnaHQpO1xuXG4gICAgX2N0eC5nbG9iYWxBbHBoYSA9IDE7XG4gICAgX2N0eC5iZWdpblBhdGgoKTtcbiAgICBfY3R4Lm1vdmVUbyh4MSx5MSk7XG4gICAgX2N0eC5saW5lVG8oeDIseTEpO1xuICAgIF9jdHgubGluZVRvKHgyLHkyKTtcbiAgICBfY3R4LmxpbmVUbyh4MSx5Mik7XG4gICAgX2N0eC5saW5lVG8oeDEseTEpO1xuXG4gICAgX2N0eC5maWxsKCk7XG4gICAgX2N0eC5jbGlwKCk7XG4gICAgLy8gX2N0eC5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSBcInNvdXJjZS1pblwiO1xuICAgIF9jdHguZHJhd0ltYWdlKHRoaXMuYmFja2dyb3VuZEltYWdlLl9lbGVtZW50LDAsMCxfc2l6ZS53aWR0aCwgX3NpemUuaGVpZ2h0KVxuICAgIC8vIF9jdHguZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gXCJzb3VyY2Utb3ZlclwiO1xuICAgIC8vIF9jdHguZHJhd0ltYWdlKHRoaXMuYmFja2dyb3VuZEltYWdlLl9lbGVtZW50LDAsMCxfc2l6ZS53aWR0aCwgX3NpemUuaGVpZ2h0KVxuICAgIF9jdHguc3Ryb2tlKCk7XG4gICAgX2N0eC5zdHJva2VSZWN0KDAsMCxfc2l6ZS53aWR0aCwgX3NpemUuaGVpZ2h0KTtcbiAgICBfY3R4LnJlc3RvcmUoKTtcbiAgfSxcbiAgc2V0Wm9vbTogZnVuY3Rpb24gKF9zY2FsZSl7XG4gICAgaWYodGhpcy5jaGFuZ2VEaW1lbnNpb25Pblpvb20pe1xuICAgICAgdmFyIF93ID0gTWF0aC5yb3VuZCh0aGlzLm9yaWdpbmFsV2lkdGggKiBfc2NhbGUpO1xuICAgICAgdmFyIF9oID0gTWF0aC5yb3VuZCh0aGlzLm9yaWdpbmFsSGVpZ2h0ICogX3NjYWxlKTtcbiAgICAgIHRoaXMuc2V0RGltZW5zaW9ucyh7XG4gICAgICAgIHdpZHRoOiBfdyxcbiAgICAgICAgaGVpZ2h0OiBfaFxuICAgICAgfSk7XG4gICAgfVxuICAgIHRoaXMuX3pvb21Ub1BvaW50TmF0aXZlKCBuZXcgZmFicmljLlBvaW50KDAsIDApLCBfc2NhbGUpXG4gICAgLy8gIHRoaXMuX3NldFpvb21OYXRpdmUoX3NjYWxlKTtcbiAgICB0aGlzLmZpcmUoJ3ZpZXdwb3J0OnNjYWxlZCcsIHtzY2FsZTogX3NjYWxlfSk7XG4gIH0sXG4gIHpvb21Ub1BvaW50OiBmdW5jdGlvbihwb2ludCwgbmV3Wm9vbSl7XG4gICAgdmFyIF9tYXggPSAgdGhpcy5nZXRNYXhab29tKCk7XG4gICAgdmFyIF9taW4gPSAgdGhpcy5nZXRNaW5ab29tKCkuc2NhbGU7XG4gICAgaWYobmV3Wm9vbSA+IF9tYXgpe1xuICAgICAgbmV3Wm9vbSA9IF9tYXg7XG4gICAgfVxuICAgIGlmKG5ld1pvb20gPCBfbWluKXtcbiAgICAgIG5ld1pvb20gPSBfbWluO1xuICAgIH1cbiAgICB0aGlzLl96b29tVG9Qb2ludE5hdGl2ZSggcG9pbnQsIG5ld1pvb20pO1xuICAgIGZvciAodmFyIGkgaW4gdGhpcy5fb2JqZWN0cykge1xuICAgICAgdGhpcy5fb2JqZWN0c1tpXS5zZXRDb29yZHMoKTtcbiAgICB9XG4gICAgdGhpcy5maXJlKCd2aWV3cG9ydDpzY2FsZWQnLCB7c2NhbGU6IG5ld1pvb219KTtcbiAgfSxcbiAgcmVzZXRWaWV3cG9ydDogZnVuY3Rpb24gKCkge1xuICAgIF9jYW52YXMudmlld3BvcnRUcmFuc2Zvcm1bMF0gPSAxO1xuICAgIF9jYW52YXMudmlld3BvcnRUcmFuc2Zvcm1bM10gPSAxO1xuICAgIF9jYW52YXMudmlld3BvcnRUcmFuc2Zvcm1bNF0gPSAwO1xuICAgIF9jYW52YXMudmlld3BvcnRUcmFuc2Zvcm1bNV0gPSAwO1xuICAgIF9jYW52YXMucmVuZGVyQWxsKCk7XG4gICAgZm9yICh2YXIgaSBpbiB0aGlzLl9vYmplY3RzKSB7XG4gICAgICB0aGlzLl9vYmplY3RzW2ldLnNldENvb3JkcygpO1xuICAgIH1cbiAgfSxcbiAgem9vbVRvUG9pbnRFbmFibGVkOiB0cnVlLFxuICBtaW5ab29tRmFjdG9yOiAxLFxuICBtYXhab29tOiAyMCxcbiAgYXV0b0NlbnRlckFuZFpvb21PdXRFbmFibGVkOiBmYWxzZSxcbiAgZ2V0TWF4Wm9vbTogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLm1heFpvb207XG4gIH0sXG4gIGdldE1pblpvb206IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgX2NvbnRhaW5lclNpemUgPSB7XG4gICAgICB3aWR0aDogJCh0aGlzLndyYXBwZXJFbCkud2lkdGgoKSxcbiAgICAgIGhlaWdodDogJCh0aGlzLndyYXBwZXJFbCkuaGVpZ2h0KClcbiAgICB9O1xuICAgIHZhciBfYmdTaXplID0ge1xuICAgICAgd2lkdGg6IHRoaXMub3JpZ2luYWxXaWR0aCxcbiAgICAgIGhlaWdodDogdGhpcy5vcmlnaW5hbEhlaWdodFxuICAgIH07XG4gICAgdmFyIF9tYXhTaXplID0ge1xuICAgICAgd2lkdGg6IF9jb250YWluZXJTaXplLndpZHRoICogdGhpcy5taW5ab29tRmFjdG9yLFxuICAgICAgaGVpZ2h0OiBfY29udGFpbmVyU2l6ZS5oZWlnaHQgKiB0aGlzLm1pblpvb21GYWN0b3JcbiAgICB9O1xuXG4gICAgcmV0dXJuIGZhYnJpYy51dGlsLmdldFByb3BvcnRpb25zKF9iZ1NpemUsIF9tYXhTaXplLCAnZml0Jyk7XG4gIH0sXG4gIGNlbnRlckFuZFpvb21PdXQ6IGZ1bmN0aW9uICgpIHtcblxuICAgIGlmKHRoaXMudmlydHVhbCl7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHZhciBvcHRpb25zID0gdGhpcy5nZXRNaW5ab29tKCk7XG5cbiAgICB2YXIgX2NvbnRhaW5lclNpemUgPSB7XG4gICAgICB3aWR0aDogJCh0aGlzLndyYXBwZXJFbCkud2lkdGgoKSxcbiAgICAgIGhlaWdodDogJCh0aGlzLndyYXBwZXJFbCkuaGVpZ2h0KClcbiAgICB9O1xuXG4gICAgdmFyIHZwdCA9IHRoaXMudmlld3BvcnRUcmFuc2Zvcm0uc2xpY2UoMCk7XG4gICAgdnB0WzBdID0gb3B0aW9ucy5zY2FsZTtcbiAgICB2cHRbM10gPSBvcHRpb25zLnNjYWxlO1xuICAgIHZwdFs0XSA9IChfY29udGFpbmVyU2l6ZS53aWR0aCAtIG9wdGlvbnMud2lkdGggKSAvIDI7XG4gICAgdnB0WzVdID0gKF9jb250YWluZXJTaXplLmhlaWdodCAtIG9wdGlvbnMuaGVpZ2h0KSAvIDI7XG5cbiAgICB0aGlzLnNldFZpZXdwb3J0VHJhbnNmb3JtKHZwdCk7XG5cblxuICAgIHRoaXMuX3VwZGF0ZV9iYWNrZ3JvdW5kX2ltYWdlKCk7XG4gICAgLy8gdGhpcy5maXJlKFwidmlld3BvcnQ6c2NhbGVkXCIse3NjYWxlOiBvcHRpb25zLnNjYWxlfSlcbiAgICAvL3RoaXMucmVuZGVyQWxsKCk7XG4gIH0sXG4gIGNlbnRlck9uT2JqZWN0OiBmdW5jdGlvbih0YWcpe1xuICAgIHZhciBiciA9IHRhZy5nZXRCb3VuZGluZ1JlY3QoKTtcbiAgICB2YXIgY3QgPSB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtO1xuICAgIGJyLndpZHRoIC89IGN0WzBdO1xuICAgIGJyLmhlaWdodCAvPSBjdFszXTtcbiAgICB2YXIgc2l6ZSA9IHtcbiAgICAgIHdpZHRoOiBici53aWR0aCAqIDEuMSxcbiAgICAgIGhlaWdodDogYnIuaGVpZ2h0ICogMS4xXG4gICAgfTtcblxuICAgIHZhciBwcm9wID0gZmFicmljLnV0aWwuZ2V0UHJvcG9ydGlvbnMoc2l6ZSx0aGlzKTtcbiAgICB2YXIgX3cgPSAodGhpcy53aWR0aCAvIHByb3Auc2NhbGUgLSBzaXplLndpZHRoICkgLyAyO1xuICAgIHZhciBfaCA9ICh0aGlzLmhlaWdodCAvIHByb3Auc2NhbGUgLSBzaXplLmhlaWdodCkgLyAyO1xuICAgIHZhciBfbCA9IChici5sZWZ0ICAtIGN0WzRdKSAvIGN0WzBdO1xuICAgIHZhciBfdCA9IChici50b3AgLSBjdFs1XSkgLyBjdFszXTtcblxuICAgIHZhciB4MSA9IFtcbiAgICAgIHByb3Auc2NhbGUsXG4gICAgICAwLDAsXG4gICAgICBwcm9wLnNjYWxlLFxuICAgICAgLSB0YWcubGVmdCAqIHByb3Auc2NhbGUgKyAodGFnLndpZHRoICogMC4wNSArIF93KSAqIHByb3Auc2NhbGUsXG4gICAgICAtIHRhZy50b3AgKiBwcm9wLnNjYWxlICsgKHRhZy5oZWlnaHQgKiAwLjA1ICsgX2ggKSogcHJvcC5zY2FsZVxuICAgIF07XG4gICAgdmFyIHgyID0gW1xuICAgICAgcHJvcC5zY2FsZSxcbiAgICAgIDAsMCxcbiAgICAgIHByb3Auc2NhbGUsXG4gICAgICAtIF9sICAqIHByb3Auc2NhbGUgKyAoYnIud2lkdGggKiAwLjA1ICsgX3cpICogcHJvcC5zY2FsZSxcbiAgICAgIC0gX3QgICogcHJvcC5zY2FsZSArIChici5oZWlnaHQgKiAwLjA1ICsgX2ggKSogcHJvcC5zY2FsZVxuICAgIF07XG5cbiAgICB0aGlzLnNldFZpZXdwb3J0VHJhbnNmb3JtKHgyKTtcbiAgICB0aGlzLmZpcmUoXCJ2aWV3cG9ydDpzY2FsZWRcIix7c2NhbGU6IHByb3Auc2NhbGV9KVxuICAgIHRoaXMucmVuZGVyQWxsKCk7XG4gIH0sXG5cbiAgX19vbk1vdXNlV2hlZWw6IGZ1bmN0aW9uIChldmVudCkge1xuXG4gICAgaWYoIXRoaXMubW91c2VXaGVlbEVuYWJsZWQgfHwgdGhpcy56b29tQ3RybEtleSAmJiAhZXZlbnQuY3RybEtleSl7XG4gICAgICByZXR1cm47XG4gICAgfVxuLy9GaW5kIG5lYXJlc3QgcG9pbnQsIHRoYXQgaXMgaW5zaWRlIGltYWdlIEVORFxuICAgIHZhciB6b29tU3RlcDsvLyA9IDAuMSAqIGV2ZW50LmRlbHRhWTtcbiAgICBpZiAoZXZlbnQuZGVsdGFZIDwgMCkge1xuICAgICAgem9vbVN0ZXAgPSAxLjE7XG4gICAgfSBlbHNlIHtcbiAgICAgIHpvb21TdGVwID0gMC45O1xuICAgIH1cblxuICAgIHZhciBuZXdab29tID0gdGhpcy5nZXRab29tKCkgKiB6b29tU3RlcDtcbiAgICB2YXIgbWluWm9vbSA9IHRoaXMuZ2V0TWluWm9vbSgpLnNjYWxlO1xuXG5cbiAgICBpZih0aGlzLnpvb21Ub1BvaW50RW5hYmxlZCl7XG4gICAgICB2YXIgcG9pbnQgPSBuZXcgZmFicmljLlBvaW50KGV2ZW50Lm9mZnNldFgsIGV2ZW50Lm9mZnNldFkpO1xuICAgICAgdmFyIF94ID0gdGhpcy52aWV3cG9ydFRyYW5zZm9ybVs0XTtcbiAgICAgIHZhciBfeSA9IHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bNV07XG5cbiAgICAgIC8vIEZpbmQgbmVhcmVzdCBwb2ludCwgdGhhdCBpcyBpbnNpZGUgaW1hZ2UgQkVHSU5cbiAgICAgIC8vIEl0IGlzIG5lZWRlZCB0byBwcmV2ZW50IGNhbnZhcyB0byB6b29tIG91dHNpZGUgaW1hZ2VcbiAgICAgIHZhciBfdyA9IHRoaXMub3JpZ2luYWxXaWR0aCAqIHRoaXMuZ2V0Wm9vbSgpICsgX3g7XG4gICAgICB2YXIgX2ggPSB0aGlzLm9yaWdpbmFsSGVpZ2h0ICogdGhpcy5nZXRab29tKCkgKyBfeTtcblxuXG4gICAgICBpZiAocG9pbnQueCA8IF94KSB7XG4gICAgICAgIHBvaW50LnggPSBfeDtcbiAgICAgIH1cbiAgICAgIGlmIChwb2ludC55IDwgX3kpIHtcbiAgICAgICAgcG9pbnQueSA9IF95O1xuICAgICAgfVxuICAgICAgaWYgKHBvaW50LnggPiBfdykge1xuICAgICAgICBwb2ludC54ID0gX3c7XG4gICAgICB9XG4gICAgICBpZiAocG9pbnQueSA+IF9oKSB7XG4gICAgICAgIHBvaW50LnkgPSBfaDtcbiAgICAgIH1cbiAgICAgIGlmIChtaW5ab29tID4gbmV3Wm9vbSkge1xuICAgICAgICBpZih0aGlzLmF1dG9DZW50ZXJBbmRab29tT3V0RW5hYmxlZCl7XG4gICAgICAgICAgdGhpcy5jZW50ZXJBbmRab29tT3V0KCk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuem9vbVRvUG9pbnQocG9pbnQsIG5ld1pvb20pO1xuICAgICAgfVxuICAgIH1lbHNle1xuICAgICAgdGhpcy5zZXRab29tKG5ld1pvb20pO1xuICAgIH1cblxuXG5cblxuICAgIGZvciAodmFyIGkgaW4gdGhpcy5fb2JqZWN0cykge1xuICAgICAgdGhpcy5fb2JqZWN0c1tpXS5zZXRDb29yZHMoKTtcbiAgICB9XG4gICAgdGhpcy5yZW5kZXJBbGwoKTtcbiAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIHJldHVybiBmYWxzZTsgLy9wcmV2ZW50aW5nIHNjcm9sbCBwYWdlXG4gIH0sXG4gIHNjYWxlRmFjdG9yOiAxLjEsXG4gIGdldE9yaWduYWxDZW50ZXIgOiBmdW5jdGlvbigpe1xuICAgIHZhciBwb2ludCA9IHRoaXMuZ2V0Q2VudGVyKCk7XG4gICAgcG9pbnQubGVmdCArPSB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzRdIDtcbiAgICBwb2ludC50b3AgKz0gdGhpcy52aWV3cG9ydFRyYW5zZm9ybVs1XTtcbiAgICByZXR1cm4gcG9pbnQ7XG4gIH1cbn0pO1xuXG5cblxuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUuYWN0aW9ucywge1xuICB6b29tT3V0OiB7XG4gICAgY2xhc3NOYW1lOiAnZmEgZmEtc2VhcmNoLW1pbnVzJyxcbiAgICB0aXRsZTogJ3pvb20tb3V0JyxcbiAgICBhY3Rpb246IGZ1bmN0aW9uIChtKSB7XG4gICAgICB2YXIgcG9pbnQgPSB0aGlzLmdldE9yaWduYWxDZW50ZXIoKTtcbiAgICAgIHZhciBzY2FsZVZhbHVlID0gdGhpcy5nZXRab29tKCkgLyB0aGlzLnNjYWxlRmFjdG9yO1xuICAgICAgdGhpcy56b29tVG9Qb2ludCh7eDogcG9pbnQubGVmdCwgeTogcG9pbnQudG9wfSxzY2FsZVZhbHVlKTtcbiAgICB9XG4gIH0sXG4gIHpvb21OdW1iZXI6IHtcbiAgICB0eXBlOiAnbnVtYmVyJyxcbiAgICB2YWx1ZToge1xuICAgICAgbWluOiAgZnVuY3Rpb24oKXtyZXR1cm4gMC4wMX0sXG4gICAgICBtYXg6ICBmdW5jdGlvbigpe3JldHVybiAxMH0sXG4gICAgICBzZXQ6IGZ1bmN0aW9uICh2YWwpIHtcbiAgICAgICAgdGhpcy5zZXRab29tKHZhbClcbiAgICAgIH0sXG4gICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0Wm9vbSgpXG4gICAgICB9LFxuICAgICAgb2JzZXJ2ZTogXCJ2aWV3cG9ydDpzY2FsZWRcIlxuICAgIH1cbiAgfSxcbiAgem9vbUluOiB7XG4gICAgY2xhc3NOYW1lOiAnZmEgZmEtc2VhcmNoLXBsdXMnLFxuICAgIHRpdGxlOiAnem9vbS1pbicsXG4gICAgYWN0aW9uOiBmdW5jdGlvbiAobSkge1xuICAgICAgdmFyIHBvaW50ID0gdGhpcy5nZXRPcmlnbmFsQ2VudGVyKCk7XG4gICAgICB2YXIgc2NhbGVWYWx1ZSA9IHRoaXMuZ2V0Wm9vbSgpICogdGhpcy5zY2FsZUZhY3RvcjtcbiAgICAgIHRoaXMuem9vbVRvUG9pbnQoe3g6IHBvaW50LmxlZnQsIHk6IHBvaW50LnRvcH0sc2NhbGVWYWx1ZSk7XG4gICAgfVxuICB9XG4gIC8vIHpvb206IHtcbiAgLy8gICB0aXRsZTogXCJ6b29tXCIsXG4gIC8vICAgbWVudTogem9vbU91dFxuICAvLyB9XG59KTtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vbW9kdWxlcy96b29tLmpzXG4vLyBtb2R1bGUgaWQgPSA0OFxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCIndXNlIHN0cmljdCc7XG5cbnJlcXVpcmUoXCIuLi9taXhpbnMvc3Ryb2tlTWl4aW5cIik7XG5yZXF1aXJlKFwiLi4vbWl4aW5zL2NhY2hlTWl4aW5cIik7XG5yZXF1aXJlKFwiLi4vc2hhcGVzL1BhdGhHcm91cFwiKTtcbnJlcXVpcmUoXCIuLi9taXhpbnMvcHJvcG9ydGlhbmFsU2l6ZU1peGluXCIpO1xucmVxdWlyZShcIi4uL21vZHVsZXMvcmVzaXphYmxlXCIpO1xuXG4vKipcbiAqIEBhdXRob3IgRGVuaXMgUG9ub21hcmV2XG4gKiBAZW1haWwgZGVuLnBvbm9tYXJldkBnbWFpbC5jb21cbiAqL1xuZmFicmljLkNsaXBhcnQgPSBmYWJyaWMudXRpbC5jcmVhdGVDbGFzcyhcbiAgZmFicmljLkdyb3VwLFxuICBmYWJyaWMuU3Ryb2tlTWl4aW4sXG4gIGZhYnJpYy5DYWNoZU1peGluLFxuICBmYWJyaWMuSW1hZ2VNaXhpbiwge1xuICAgIHR5cGU6ICdjbGlwYXJ0JyxcbiAgICBjb2xvcnM6IG51bGwsXG4gICAgZm9ybWF0OiAnc3ZnJyxcbiAgICByZXNpemFibGU6IHRydWUsXG4gICAgcHJvY2Vzc2luZzogZmFsc2UsXG4gICAgc3RhdGVQcm9wZXJ0aWVzOiBmYWJyaWMuR3JvdXAucHJvdG90eXBlLnN0YXRlUHJvcGVydGllcy5jb25jYXQoW1wiY29sb3JzXCJdKSxcbiAgICBvcHRpb25zT3JkZXI6IFtcIipcIixcImNvbG9yc1wiLFwiZWxlbWVudFwiLFwidG9vbHNcIl0sXG4gICAgZ2V0T3JpZ2luYWxTaXplOiBmdW5jdGlvbigpe1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgd2lkdGg6IHRoaXMuZWxlbWVudC53aWR0aCxcbiAgICAgICAgaGVpZ2h0OiB0aGlzLmVsZW1lbnQuaGVpZ2h0XG4gICAgICB9XG4gICAgfSxcbiAgICBpbml0aWFsaXplOiBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgb3B0aW9ucyB8fCAoIG9wdGlvbnMgPSB7fSk7XG5cbiAgICAgIGlmIChvcHRpb25zLmNvbnN0cnVjdG9yICE9IE9iamVjdCkge1xuXG4gICAgICAgIHZhciBfb2JqID0gb3B0aW9ucy50b09iamVjdCgpO1xuICAgICAgICBpZiAob3B0aW9ucy5lbGVtZW50KSB7XG4gICAgICAgICAgX29iai5lbGVtZW50ID0gb3B0aW9ucy5lbGVtZW50LmNsb25lU3luYygpO1xuICAgICAgICAgIF9vYmouZWxlbWVudC5jbGlwVG8gPSBfb2JqLl9mYWJyaWNfc2hhcGU7XG4gICAgICAgIH1cbiAgICAgICAgX29iai5zaGFwZSA9IG9wdGlvbnMuc2hhcGU7XG4gICAgICAgIG9wdGlvbnMgPSBfb2JqO1xuICAgICAgfVxuXG4gICAgICB0aGlzLm9uKHtcbiAgICAgICAgXCJzY2FsaW5nXCI6IHRoaXMudXBkYXRlRWxlbWVudFxuICAgICAgfSk7XG5cbiAgICAgIHRoaXMuaW5pdFNoYXBlKG9wdGlvbnMpO1xuICAgICAgdGhpcy5fZmFicmljX3NoYXBlLnNldCh7XG4gICAgICAgIG9wYWNpdHk6IDAsXG4gICAgICAgIG9yaWdpblggOiAnY2VudGVyJyxcbiAgICAgICAgb3JpZ2luWSA6ICdjZW50ZXInLFxuICAgICAgfSk7XG5cbiAgICAgIHRoaXMuY2FsbFN1cGVyKCdpbml0aWFsaXplJywgW3RoaXMuX2ZhYnJpY19zaGFwZV0sIG9wdGlvbnMpO1xuICAgICAgdGhpcy5fc2V0V2lkdGhIZWlnaHQob3B0aW9ucyk7XG4gICAgfSxcbiAgICBzZXRTaGFwZTogZnVuY3Rpb24oZWwsY2Ipe1xuXG4gICAgICBlbCA9ICBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKHtcbiAgICAgICAgc3Ryb2tlV2lkdGhGdWxsOiB0aGlzLnNoYXBlLnN0cm9rZVdpZHRoRnVsbCxcbiAgICAgICAgc3Ryb2tlV2lkdGhFbXB0eTogdGhpcy5zaGFwZS5zdHJva2VXaWR0aEVtcHR5LFxuICAgICAgICBzdHJva2VXaWR0aEFjdGl2ZTogdGhpcy5zaGFwZS5zdHJva2VXaWR0aEFjdGl2ZSxcbiAgICAgICAgZGFzaEFycmF5IDogdGhpcy5zaGFwZS5kYXNoQXJyYXksXG4gICAgICAgIHN0cm9rZUVtcHR5OiAgdGhpcy5zaGFwZS5zdHJva2VFbXB0eSxcbiAgICAgICAgc3Ryb2tlRnVsbDogIHRoaXMuc2hhcGUuc3Ryb2tlRnVsbCxcbiAgICAgICAgc3Ryb2tlQWN0aXZlOnRoaXMuc2hhcGUuc3Ryb2tlQWN0aXZlXG4gICAgICB9LGVsKTtcblxuICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgIGlmKGVsICYmIGVsLnNyYyAmJiAhZWwucGF0aHMpe1xuICAgICAgICBmYWJyaWMubG9hZFNWR0Zyb21VUkwoZWwuc3JjLGZ1bmN0aW9uKHBhdGhzLG9wdGlvbnMpIHtcbiAgICAgICAgICBlbC5wYXRocyAgPSBwYXRocztcbiAgICAgICAgICBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGVsLG9wdGlvbnMpO1xuICAgICAgICAgIF90aGlzLl9zZXRfc2hhcGUoZWwpO1xuICAgICAgICAgIF90aGlzLmFkZChfdGhpcy5fZmFicmljX3NoYXBlKVxuICAgICAgICAgIF90aGlzLl9hcHBseV9zaGFwZSgpO1xuICAgICAgICAgIGNiICYmIGNiKCk7XG4gICAgICAgIH0pXG4gICAgICB9ZWxzZXtcbiAgICAgICAgX3RoaXMuX3NldF9zaGFwZShlbCk7XG4gICAgICAgIF90aGlzLmFkZChfdGhpcy5fZmFicmljX3NoYXBlKTtcbiAgICAgICAgX3RoaXMuX2FwcGx5X3NoYXBlKCk7XG4gICAgICAgIGNiICYmIGNiKCk7XG4gICAgICB9XG4gICAgfSxcbiAgICBzZXRFbGVtZW50OiBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgaWYodGhpcy5lbGVtZW50KXtcbiAgICAgICAgdGhpcy5yZW1vdmUodGhpcy5lbGVtZW50KTtcbiAgICAgIH1cbiAgICAgIGlmKCFlbGVtZW50KXtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgZWxlbWVudC5zZXQoe1xuICAgICAgICBvcmlnaW5YIDogJ2NlbnRlcicsXG4gICAgICAgIG9yaWdpblkgOiAnY2VudGVyJ1xuICAgICAgfSk7XG4gICAgICB0aGlzLmFkZChlbGVtZW50KTtcbiAgICAgIHRoaXMuZWxlbWVudCA9IGVsZW1lbnQ7XG4gICAgICBpZiAodGhpcy5mb3JtYXQgPT09ICdwbmcnIHx8IHRoaXMuZm9ybWF0ID09PSAnaW1hZ2UvcG5nJyB8fCB0aGlzLmZvcm1hdCA9PT0gJ2pwZWcnIHx8IHRoaXMuZm9ybWF0ID09PSAnaW1hZ2UvanBlZycpIHtcbiAgICAgICAgdGhpcy5fY2FjaGUgPSB0aGlzLmVsZW1lbnQuX2VsZW1lbnQ7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLl9pbml0X2NvbG9yX2FycmF5KCk7XG4gICAgICB9XG4gICAgICB0aGlzLmRpcnR5ID0gdHJ1ZTtcbiAgICAgIHRoaXMuY2FudmFzICYmIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgIH0sXG4gICAgdXBkYXRlRWxlbWVudDogZnVuY3Rpb24gKCkge1xuICAgICAgaWYodGhpcy5lbGVtZW50KXtcbiAgICAgICAgdGhpcy5lbGVtZW50LnNjYWxlWCA9IHRoaXMud2lkdGggLyB0aGlzLmVsZW1lbnQud2lkdGg7XG4gICAgICAgIHRoaXMuZWxlbWVudC5zY2FsZVkgPSB0aGlzLmhlaWdodCAvIHRoaXMuZWxlbWVudC5oZWlnaHQ7XG4gICAgICB9XG4gICAgICBpZih0aGlzLl9mYWJyaWNfc2hhcGUpe1xuICAgICAgICB0aGlzLl9mYWJyaWNfc2hhcGUuc2V0KHtcbiAgICAgICAgICB3aWR0aDogdGhpcy53aWR0aCxcbiAgICAgICAgICBoZWlnaHQ6IHRoaXMuaGVpZ2h0XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgdGhpcy5kaXJ0eSA9IHRydWU7XG4gICAgfSxcbiAgICBfcmVuZGVyOiBmdW5jdGlvbiAoY3R4KSB7XG4gICAgICBjdHguc2F2ZSgpO1xuICAgICAgY3R4LnNjYWxlKHRoaXMuZWxlbWVudC5zY2FsZVgsdGhpcy5lbGVtZW50LnNjYWxlWSlcbiAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gdGhpcy5lbGVtZW50LnBhdGhzLmxlbmd0aDsgaSA8IGw7ICsraSkge1xuICAgICAgICB0aGlzLmVsZW1lbnQucGF0aHNbaV0ucmVuZGVyKGN0eCwgdHJ1ZSk7XG4gICAgICB9XG4gICAgICBjdHgucmVzdG9yZSgpO1xuICAgIH0sXG4gICAgLyoqXG4gICAgICog0LrQvtCx0YrQtdC60YIg0LPQvtGC0L7QstC40YLRgdGPINC6INC30LDQvNC10L3RgyDRhNC+0YLQvlxuICAgICAqL1xuICAgIGFjdGl2YXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLl9hY3RpdmF0ZWQgPSB0cnVlO1xuICAgICAgdGhpcy5fZmFicmljX3NoYXBlLnNldE9wYWNpdHkoMSk7XG4gICAgICB0aGlzLnVwZGF0ZVN0cm9rZSgpO1xuICAgICAgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gICAgfSxcbiAgICAvKipcbiAgICAgKiDQutC+0LHRitC10LrRgiDQvdC1INCz0L7RgtC+0LLQuNGC0YHRjyDQuiDQt9Cw0LzQtdC90YMg0YTQvtGC0L5cbiAgICAgKi9cbiAgICBkZWFjdGl2YXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLl9hY3RpdmF0ZWQgPSBmYWxzZTtcbiAgICAgIHRoaXMudXBkYXRlU3Ryb2tlKCk7XG4gICAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICB9LFxuICAgIF9pbml0X2NvbG9yX2FycmF5OiBmdW5jdGlvbiAoKSB7XG5cbiAgICAgIHRoaXMucHJvY2Vzc2luZyA9IHRydWU7XG4gICAgICB0aGlzLl9jb2xvcnMgPSB0aGlzLmVsZW1lbnQuZXh0cmFjdENvbG9ycygpO1xuXG4gICAgICB0aGlzLmNvbG9ycyA9IHRoaXMuY29sb3JzIHx8IHt9O1xuXG4gICAgICBmb3IgKHZhciBfY29sb3IgaW4gdGhpcy5jb2xvcnMpIHtcbiAgICAgICAgdGhpcy5zZXRDbGlwYXJ0Q29sb3IoX2NvbG9yLCB0aGlzLmNvbG9yc1tfY29sb3JdLHRydWUpXG4gICAgICB9XG4gICAgfSxcbiAgICBzZXRFbGVtZW50RnJvbU1lbnU6IGZ1bmN0aW9uKG9wdGlvbnMpe1xuICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgIGZhYnJpYy5QYXRoR3JvdXAuZnJvbVVSTChvcHRpb25zLmltYWdlLnNyYywgZnVuY3Rpb24gKGVsKSB7XG4gICAgICAgIF90aGlzLnNldEVsZW1lbnQoZWwpO1xuICAgICAgICBfdGhpcy5tYWtlQWN0aW9ucygpO1xuICAgICAgICBfdGhpcy5jYW52YXMuY3JlYXRlRmxvYXRlZE1lbnUoX3RoaXMuYXBwbGljYXRpb24ub2JqZWN0c1Rvb2xiYXJPcHRpb25zKTtcbiAgICAgIH0se1xuICAgICAgICB3aWR0aDogdGhpcy53aWR0aCxcbiAgICAgICAgaGVpZ2h0OiB0aGlzLmhlaWdodFxuICAgICAgfSk7XG4gICAgfSxcbiAgICAvLyByZW5kZXI6IGZ1bmN0aW9uIChjdHgpIHtcbiAgICAvLyAgIC8vIHZhciB4ID0gbm9UcmFuc2Zvcm0gPyAwIDogLSB0aGlzLndpZHRoICogdGhpcy5zY2FsZVggLyAyLFxuICAgIC8vICAgLy8gICB5ID0gbm9UcmFuc2Zvcm0gPyAwIDogLSB0aGlzLmhlaWdodCAqIHRoaXMuc2NhbGVZIC8gMjtcbiAgICAvLyAgIC8vXG4gICAgLy8gICAvLyBjdHguc2F2ZSgpO1xuICAgIC8vICAgLy8gY3R4LnRyYW5zbGF0ZSh4LHkpO1xuICAgIC8vICAgZmFicmljLkdyb3VwLnByb3RvdHlwZS5yZW5kZXIuYXBwbHkodGhpcyxhcmd1bWVudHMpXG4gICAgLy8gICAvLyBjdHgucmVzdG9yZSgpO1xuICAgIC8vIH0sXG4gICAgc2V0Q2xpcGFydENvbG9yOiBmdW5jdGlvbiAoa2V5LCB2YWx1ZSwgcHJldmVudENhY2hlVXBkYXRlKSB7XG5cbiAgICAgIGlmICghdmFsdWUpIHtcbiAgICAgICAgdmFsdWUgPSBrZXk7XG4gICAgICAgIGRlbGV0ZSB0aGlzLmNvbG9yc1trZXldO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5jb2xvcnNba2V5XSA9IHZhbHVlO1xuICAgICAgfVxuICAgICAgdmFyIF9jb2xvcnMgPSB0aGlzLl9jb2xvcnNba2V5XTtcbiAgICAgIGZvciAodmFyIGkgaW4gX2NvbG9ycykge1xuICAgICAgICBpZiAoX2NvbG9yc1tpXS5jb2xvcikge1xuICAgICAgICAgIF9jb2xvcnNbaV0uY29sb3IuZmlsbCA9IHZhbHVlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChfY29sb3JzW2ldLnN0b3ApIHtcbiAgICAgICAgICBfY29sb3JzW2ldLnN0b3AuY29sb3IgPSB2YWx1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICB0aGlzLmRpcnR5ID0gdHJ1ZTtcbiAgICAgIHRoaXMuY2FudmFzICYmIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgIH0sXG4gICAgdG9PYmplY3Q6IGZ1bmN0aW9uIChwcm9wZXJ0aWVzVG9JbmNsdWRlKSB7XG4gICAgICB2YXIgX29iaiA9IHRoaXMuY2FsbFN1cGVyKCd0b09iamVjdCcsIFsnc3JjJywgJ2NvbG9ycyddLmNvbmNhdChwcm9wZXJ0aWVzVG9JbmNsdWRlKSk7XG4gICAgICBkZWxldGUgX29iai5vYmplY3RzO1xuICAgICAgcmV0dXJuIF9vYmo7XG4gICAgfSxcbiAgICBhY3Rpb25zOiAge1xuICAgICAgc291cmNlOiB7XG4gICAgICAgIHR5cGU6ICdlZmZlY3QnLFxuICAgICAgICBjbGFzc05hbWU6ICdmYSBmYS1maWxlLWltYWdlLW8nLFxuICAgICAgICB0aXRsZTogXCJzb3VyY2VcIixcbiAgICAgICAgYWN0aW9uUGFyYW1ldGVyczogZnVuY3Rpb24gKCRlbCwgZGF0YSkge1xuICAgICAgICAgIGRhdGEudGFyZ2V0LmFwcGxpY2F0aW9uLmNyZWF0ZUdhbGxlcnkoZGF0YS50YXJnZXQsICRlbCwgZGF0YSk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBjb2xvcnM6IHtcbiAgICAgICAgdHlwZTogJ21lbnUnLFxuICAgICAgICB0aXRsZTogJ2NvbG9yIG1lbnUnLFxuICAgICAgICBtZW51OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgdmFyIF9tZW51ID0gW107XG4gICAgICAgICAgZm9yICh2YXIga2V5IGluIHRoaXMuX2NvbG9ycykge1xuICAgICAgICAgICAgX21lbnUucHVzaCh7XG4gICAgICAgICAgICAgIHRpdGxlOiBcIkNvbG9yIChcIiArIGtleSArIFwiKVwiLFxuICAgICAgICAgICAgICB2YWx1ZToge1xuICAgICAgICAgICAgICAgIGRlZmF1bHRWYWx1ZToga2V5LFxuICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLmNvbG9yc1trZXldIHx8IGtleSxcbiAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbG9yc1trZXldIHx8IGtleTtcbiAgICAgICAgICAgICAgICB9LmJpbmQodGhpcywga2V5KSxcbiAgICAgICAgICAgICAgICBzZXQ6IHRoaXMuc2V0Q2xpcGFydENvbG9yLmJpbmQodGhpcywga2V5KVxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB0eXBlOiBcImNvbG9yXCJcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBfbWVudTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuKTtcblxuZmFicmljLkNsaXBhcnQuYXN5bmMgPSB0cnVlO1xuXG4vKipcbiAqIENyZWF0ZXMgZmFicmljLlBhdGhHcm91cCBpbnN0YW5jZSBmcm9tIGFuIG9iamVjdCByZXByZXNlbnRhdGlvblxuICogQHN0YXRpY1xuICogQG1lbWJlck9mIGZhYnJpYy5QYXRoR3JvdXBcbiAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3QgT2JqZWN0IHRvIGNyZWF0ZSBhbiBpbnN0YW5jZSBmcm9tXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBDYWxsYmFjayB0byBpbnZva2Ugd2hlbiBhbiBmYWJyaWMuUGF0aEdyb3VwIGluc3RhbmNlIGlzIGNyZWF0ZWRcbiAqL1xuZmFicmljLkNsaXBhcnQuZnJvbU9iamVjdCA9IGZ1bmN0aW9uIChvYmplY3QsIGNhbGxiYWNrKSB7XG4gIGlmICh0eXBlb2Ygb2JqZWN0LnNyYyA9PT0gJ3N0cmluZycpIHtcbiAgICBpZiAob2JqZWN0LmZvcm1hdCA9PT0gJ3BuZycgfHwgb2JqZWN0LmZvcm1hdCA9PT0gXCJpbWFnZS9wbmdcIiB8fCBvYmplY3QuZm9ybWF0ID09PSAnanBlZycgfHwgb2JqZWN0LmZvcm1hdCA9PT0gXCJpbWFnZS9qcGVnXCIpIHtcbiAgICAgIGZhYnJpYy5JbWFnZS5mcm9tVVJMKG9iamVjdC5zcmMsIGZ1bmN0aW9uIChlbCkge1xuICAgICAgICBvYmplY3QuZWxlbWVudCA9IGVsO1xuICAgICAgICBjYWxsYmFjayhuZXcgZmFicmljLkNsaXBhcnQob2JqZWN0KSk7XG4gICAgICB9LCB7XG4gICAgICAgIHdpZHRoOiBvYmplY3Qud2lkdGggfHwgZmFicmljLkNsaXBhcnQucHJvdG90eXBlLndpZHRoLFxuICAgICAgICBoZWlnaHQ6IG9iamVjdC5oZWlnaHQgfHwgZmFicmljLkNsaXBhcnQucHJvdG90eXBlLmhlaWdodFxuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGZhYnJpYy5QYXRoR3JvdXAuZnJvbVVSTChvYmplY3Quc3JjLCBmdW5jdGlvbiAoZWwpIHtcbiAgICAgICAgb2JqZWN0LmVsZW1lbnQgPSBlbDtcbiAgICAgICAgY2FsbGJhY2sobmV3IGZhYnJpYy5DbGlwYXJ0KG9iamVjdCkpO1xuICAgICAgfSwge1xuICAgICAgICB3aWR0aDogb2JqZWN0LndpZHRoIHx8IGZhYnJpYy5DbGlwYXJ0LnByb3RvdHlwZS53aWR0aCxcbiAgICAgICAgaGVpZ2h0OiBvYmplY3QuaGVpZ2h0IHx8IGZhYnJpYy5DbGlwYXJ0LnByb3RvdHlwZS5oZWlnaHRcbiAgICAgIH0pO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gbmV3IGZhYnJpYy5DbGlwYXJ0KG9iamVjdCk7XG4gIH1cbn07XG5cbmZhYnJpYy51dGlsLmNyZWF0ZUFjY2Vzc29ycyhmYWJyaWMuQ2xpcGFydCk7XG5cbmlmIChmYWJyaWMub2JqZWN0c0xpYnJhcnkpIHtcbiAgZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMub2JqZWN0c0xpYnJhcnksIHtcbiAgICBjbGlwYXJ0OiB7XG4gICAgICBcIndpZHRoXCI6IGZ1bmN0aW9uICh3LCBoKSB7XG4gICAgICAgIHZhciBfYXNwID0gTWF0aC5taW4oMjg1IC8gMzY1LCB3IC8gaCk7XG4gICAgICAgIHJldHVybiB3O1xuICAgICAgfSxcbiAgICAgIFwiaGVpZ2h0XCI6IGZ1bmN0aW9uICh3LCBoKSB7XG4gICAgICAgIHZhciBfYXNwID0gTWF0aC5taW4oMjg1IC8gMzY1LCB3IC8gaCk7XG4gICAgICAgIHJldHVybiBoO1xuICAgICAgfSxcbiAgICAgIFwidHlwZVwiOiBcImNsaXBhcnRcIixcbiAgICAgIFwic3JjXCI6IFwiZGF0YTppbWFnZS9zdmcreG1sO3V0Zjg7YmFzZTY0LFBEOTRiV3dnZG1WeWMybHZiajBpTVM0d0lpQmxibU52WkdsdVp6MGlhWE52TFRnNE5Ua3RNU0kvUGdvOElTMHRJRWRsYm1WeVlYUnZjam9nUVdSdlltVWdTV3hzZFhOMGNtRjBiM0lnTVRrdU1DNHdMQ0JUVmtjZ1JYaHdiM0owSUZCc2RXY3RTVzRnTGlCVFZrY2dWbVZ5YzJsdmJqb2dOaTR3TUNCQ2RXbHNaQ0F3S1NBZ0xTMCtDanh6ZG1jZ2VHMXNibk05SW1oMGRIQTZMeTkzZDNjdWR6TXViM0puTHpJd01EQXZjM1puSWlCNGJXeHVjenA0YkdsdWF6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNVGs1T1M5NGJHbHVheUlnZG1WeWMybHZiajBpTVM0eElpQnBaRDBpVEdGNVpYSmZNU0lnZUQwaU1IQjRJaUI1UFNJd2NIZ2lJSFpwWlhkQ2IzZzlJakFnTUNBMU1USWdOVEV5SWlCemRIbHNaVDBpWlc1aFlteGxMV0poWTJ0bmNtOTFibVE2Ym1WM0lEQWdNQ0ExTVRJZ05URXlPeUlnZUcxc09uTndZV05sUFNKd2NtVnpaWEoyWlNJZ2QybGtkR2c5SWpVeE1uQjRJaUJvWldsbmFIUTlJalV4TW5CNElqNEtQR2MrQ2drOGNHRjBhQ0J6ZEhsc1pUMGlabWxzYkRvalJrWTRRelEyT3lJZ1pEMGlUVEUyTXk0eE9Ea3NOamN1TVRRNFF6RXlPUzQyTVRZc05qY3VNVFE0TERFeU1TNHlNaklzTUN3M09TNHlOVFVzTUVNMU1pNDNNVE1zTUN3eU9DNDRPVFFzTVRZdU56ZzNMREk0TGpnNU5DdzFNQzR6TmpFZ0lDQnpOVGd1TnpVMExEVXdMak0yTVN3ME1TNDVOamNzTVRBNUxqRXhOVXd4TmpNdU1UZzVMRFkzTGpFME9Ib2lMejRLQ1R4d1lYUm9JSE4wZVd4bFBTSm1hV3hzT2lOR1JqaERORFk3SWlCa1BTSk5NelEzTGpnME5TdzJOeTR4TkRoRE16Z3hMalF4T1N3Mk55NHhORGdzTXpnNUxqZ3hNaXd3TERRek1TNDNPQ3d3WXpJMkxqVTBNaXd3TERVd0xqTTJNU3d4Tmk0M09EY3NOVEF1TXpZeExEVXdMak0yTVNBZ0lITXROVGd1TnpVMExEVXdMak0yTVMwME1TNDVOamNzTVRBNUxqRXhOVXd6TkRjdU9EUTFMRFkzTGpFME9Ib2lMejRLUEM5blBnbzhaejRLQ1R4d1lYUm9JSE4wZVd4bFBTSm1hV3hzT2lOR1JrVkNSREk3SWlCa1BTSk5Nek14TGpVME1TdzBOakV1TmpNNVF6TXpNUzQxTkRFc05EZzVMalExTXl3ek1URXVOakkyTERVeE1pd3lOVFlzTlRFeWN5MDNOUzQxTkRFdE1qSXVOVFEzTFRjMUxqVTBNUzAxTUM0ek5qRjJMVGd1TXpremFERTFNQzQxT1RrZ0lDQk1Nek14TGpVME1TdzBOakV1TmpNNWVpSXZQZ29KUEhCaGRHZ2djM1I1YkdVOUltWnBiR3c2STBaR1JVSkVNanNpSUdROUlrMDBOVGt1TXpZNExERTRNaTQ1TVdNek5DNDBORFlzTlRZdU16QXpMRFF3TGpBME1pd3hNREl1TkRZM0xEUXdMakEwTWl3eE1ESXVORFkzYUMweE5pNDNPRGNnSUNCak1Dd3dMREUyTGpjNE55dzBNUzQwTkRNc01UWXVOemczTERZM0xqRTBPR3d0TWpVdU1UZ3RPQzR6T1ROak1Dd3dMREUyTGpjNE55d3pOeTQzTnl3eE5pNDNPRGNzTmpjdU1UUTRZekFzTUM0MU1qVXRNalV1TVRndE9DNHpPVE10TWpVdU1UZ3RPQzR6T1RNZ0lDQnpNVEl1TlRrc01qZ3VNekk0TERndU16a3pMRFF4TGprMk4yTXRNQzR4TlRRc01DNDFNREV0TWpVdU1UZ3RPQzR6T1RNdE1qVXVNVGd0T0M0ek9UTnpOeTR6TkRRc01Ua3VOVGcxTERBc016TXVOVGMwYkMwME1TNDVOamN0TVRZdU56ZzNJQ0FnWXpBc01DMDNMamcwTml3eU5TNDJPREV0T0M0ek9UTXNNalV1TVRoakxURTRMak0yTVMweE5pNDNPRGN0TkRFdU9UWTNMVEkxTGpFNExUUXhMamsyTnkweU5TNHhPRWd4TlRVdU1qYzVZekFzTUMweU15NDJNRGNzT0M0ek9UTXROREV1T1RZM0xESTFMakU0SUNBZ1l5MHdMalUwT0N3d0xqVXRPQzR6T1RNdE1qVXVNVGd0T0M0ek9UTXRNalV1TVRoc0xUUXhMamsyTnl3eE5pNDNPRGRqTFRjdU16UTBMVEV6TGprNE9Td3dMVE16TGpVM05Dd3dMVE16TGpVM05ITXRNalV1TURJMkxEZ3VPRGsxTFRJMUxqRTRMRGd1TXpreklDQWdZeTAwTGpFNU55MHhNeTQyTXprc09DNHpPVE10TkRFdU9UWTNMRGd1TXprekxUUXhMamsyTjNNdE1qVXVNVGdzT0M0NU1UZ3RNalV1TVRnc09DNHpPVE5qTUMweU9TNHpOemNzTVRZdU56ZzNMVFkzTGpFME9Dd3hOaTQzT0RjdE5qY3VNVFE0YkMweU5TNHhPQ3c0TGpNNU15QWdJR013TFRJMUxqY3dOU3d4Tmk0M09EY3ROamN1TVRRNExERTJMamM0TnkwMk55NHhORGhJTVRJdU5UbGpNQ3d3TERVdU5UazFMVFEyTGpFMk5DdzBNQzR3TkRJdE1UQXlMalEyTjBnME5Ua3VNelk0ZWlJdlBnbzhMMmMrQ2p4bGJHeHBjSE5sSUhOMGVXeGxQU0ptYVd4c09pTkdSa0UxTkVJN0lpQmplRDBpTWpVMUxqVXhOeUlnWTNrOUlqSXpNQzQ0TWlJZ2NuZzlJakl3T1M0NE16WWlJSEo1UFNJeE9UY3VNalEySWk4K0NqeG5QZ29KQ2drSlBHVnNiR2x3YzJVZ2RISmhibk5tYjNKdFBTSnRZWFJ5YVhnb0xUQXVOakEwTWlBdE1DNDNPVFk0SURBdU56azJPQ0F0TUM0Mk1EUXlJRFl6TGprME56VWdORGs1TGpnNU1qWXBJaUJ6ZEhsc1pUMGlabWxzYkRvalJrWkZRa1F5T3lJZ1kzZzlJakUxTmk0eE1qTWlJR041UFNJeU16UXVNRFkxSWlCeWVEMGlNemN1TnpZNUlpQnllVDBpTkRZdU1UWXpJaTgrQ2drS0NRazhaV3hzYVhCelpTQjBjbUZ1YzJadmNtMDlJbTFoZEhKcGVDZ3RNQzQyTURReUlEQXVOemsyT0NBdE1DNDNPVFk0SUMwd0xqWXdORElnTnpVMUxqa3lNRFFnT1RJdU56QXpNU2tpSUhOMGVXeGxQU0ptYVd4c09pTkdSa1ZDUkRJN0lpQmplRDBpTXpVMExqa3pOeUlnWTNrOUlqSXpOQzR3T0RZaUlISjRQU0l6Tnk0M05qa2lJSEo1UFNJME5pNHhOak1pTHo0S1BDOW5QZ284Y0dGMGFDQnpkSGxzWlQwaVptbHNiRG9qUmtZNFF6UTJPeUlnWkQwaVRUSTFOUzQxTWpRc01qWXdMakU1TjJndE1DNHdNVE5qTFRJNExqY3hNU3d3TFRVMUxqQTBOU3d4T0M0eU5qZ3ROamd1TlRNMkxEUTNMalV4TVNBZ1l5MHhPQzR4TmpNc016a3VNemMwTFRRd0xqVTNNeXc1TVM0NU9UWXROREF1TlRjekxERXhNUzQ1TmpSb01qRTRMakl5T1dNd0xURTVMamsyTnkweU1pNDBNRGt0TnpJdU5Ua3ROREF1TlRjekxURXhNUzQ1TmpRZ0lFTXpNVEF1TlRZNUxESTNPQzQwTmpRc01qZzBMakl6TkN3eU5qQXVNVGszTERJMU5TNDFNalFzTWpZd0xqRTVOM29pTHo0S1BIQmhkR2dnYzNSNWJHVTlJbVpwYkd3NkkwWkdSRVZDTnpzaUlHUTlJazB6TURRdU56azFMRE0yT1M0ek1URmpMVEU1TGpNNU15d3dMVE0yTGpnMU5TdzJMVFE1TGpJM09Dd3hOUzQxT0RoakxURXlMalF5TWkwNUxqVTRPQzB5T1M0NE9EVXRNVFV1TlRnNExUUTVMakkzT0MweE5TNDFPRGdnSUdNdE16Y3VOamd5TERBdE5qZ3VNak1zTWpJdU5UUTNMVFk0TGpJekxEVXdMak0yTVhNek1DNDFORGdzTlRBdU16WXhMRFk0TGpJekxEVXdMak0yTVdNeE5TNDNNamdzTUN3ek1DNHhPRGN0TXk0NU5EY3NOREV1TnpFMkxURXdMalUxTkNBZ1l6UXVOelkwTFRJdU56TXNNVEF1TXpVM0xUSXVOek1zTVRVdU1USXlMREJqTVRFdU5USTVMRFl1TmpBM0xESTFMams0T0N3eE1DNDFOVFFzTkRFdU56RTJMREV3TGpVMU5HTXpOeTQyT0RJc01DdzJPQzR5TXkweU1pNDFORGNzTmpndU1qTXROVEF1TXpZeElDQlRNelF5TGpRM09Dd3pOamt1TXpFeExETXdOQzQzT1RVc016WTVMak14TVhvaUx6NEtQR2MrQ2drOGNHRjBhQ0J6ZEhsc1pUMGlabWxzYkRvak5EWTBOalUxT3lJZ1pEMGlUVEl4TlM0ek5EUXNNemMwTGprNU1Xd3pNeTQwT0N3ME5DNHlNekpqTXk0ek5UZ3NOQzQwTXpjc01UQXVNREkyTERRdU5ETTNMREV6TGpNNE5Dd3diRE16TGpRNExUUTBMakl6TWlBZ0lHTTBMakU0TkMwMUxqVXlPQ3d3TGpJME1TMHhNeTQwTlRrdE5pNDJPVE10TVRNdU5EVTVhQzAwTGpWakxUSXVOVElzTUMwMUxqQXlOaXd3TGpNM09DMDNMalF6TWl3eExqRXlNbXd0TVRRdU1URTJMRFF1TXpZeFl5MDBMamcwTWl3eExqUTVOaTB4TUM0d01qTXNNUzQwT1RZdE1UUXVPRFkxTERBZ0lDQnNMVEUwTGpFeE5pMDBMak0yTVdNdE1pNDBNRGd0TUM0M05EUXROQzQ1TVRNdE1TNHhNakl0Tnk0ME16SXRNUzR4TWpKb0xUUXVORGs1UXpJeE5TNHhNRE1zTXpZeExqVXpNaXd5TVRFdU1UWXNNelk1TGpRMk15d3lNVFV1TXpRMExETTNOQzQ1T1RGNklpOCtDZ2s4WTJseVkyeGxJSE4wZVd4bFBTSm1hV3hzT2lNME5qUTJOVFU3SWlCamVEMGlNVFUwTGpjNU5pSWdZM2s5SWpJek5TNHdNVFlpSUhJOUlqRTJMamM0TnlJdlBnb0pQR05wY21Oc1pTQnpkSGxzWlQwaVptbHNiRG9qTkRZME5qVTFPeUlnWTNnOUlqTTFOaTR5TXpraUlHTjVQU0l5TXpVdU1ERTJJaUJ5UFNJeE5pNDNPRGNpTHo0S0NUeHdZWFJvSUhOMGVXeGxQU0ptYVd4c09pTTBOalEyTlRVN0lpQmtQU0pOTnpjdU16VTRMRE16TlM0d01ERnNORFl1TWpBMkxUTTNMamd3TldNMExqQXhNaTB6TGpJNE15d3hMakV5TXkwNUxqYzJNUzAwTGpBd01TMDRMamsyT1d3dE5qRXVORGM0TERrdU5TQWdJRU0yTXk0eE1qTXNNekV3TGpnMkxEWTVMall4T0N3ek1qTXVNek14TERjM0xqTTFPQ3d6TXpVdU1EQXhlaUl2UGdvSlBIQmhkR2dnYzNSNWJHVTlJbVpwYkd3Nkl6UTJORFkxTlRzaUlHUTlJazB4TWpFdU5Ea3pMRE00TWk0MU56ZHNNalV1TURVeUxUWTJMamd3TjJNeExqa3lNaTAxTGpFeU5TMDBMalE1TkMwNUxqSTFOaTA0TGpNMk5DMDFMak00Tld3dE5EVXVNVGd6TERRMUxqRTRNeUFnSUVNeE1ERXVOVFUxTERNMk5TNDBNRFlzTVRFeExqQTVPQ3d6TnpRdU5EVTFMREV5TVM0ME9UTXNNemd5TGpVM04zb2lMejRLQ1R4d1lYUm9JSE4wZVd4bFBTSm1hV3hzT2lNME5qUTJOVFU3SWlCa1BTSk5NakkyTGpRd05Td3hNRGt1TVRRNWJDMDJMall6TXkwM01pNDJOamRqTFRndU1UQTJMREV1TXpBNExURTJMakExTWl3ekxqQTBOQzB5TXk0NE1URXNOUzR5TURGc01qRXVOVE15TERZNUxqSXpPU0FnSUVNeU1Ua3VNVElzTVRFMkxqRTFOeXd5TWpZdU9UQXpMREV4TkM0Mk1Ea3NNakkyTGpRd05Td3hNRGt1TVRRNWVpSXZQZ29KUEhCaGRHZ2djM1I1YkdVOUltWnBiR3c2SXpRMk5EWTFOVHNpSUdROUlrMHlPVEV1TWpZekxETTJMalE0TW13dE5pNDJNek1zTnpJdU5qWTNZeTB3TGpRNU9DdzFMalEyTERjdU1qZzBMRGN1TURBM0xEZ3VPVEV6TERFdU56Y3liREl4TGpVek1pMDJPUzR5TXprZ0lDQkRNekEzTGpNeE5Td3pPUzQxTWpjc01qazVMak0yT1N3ek55NDNPU3d5T1RFdU1qWXpMRE0yTGpRNE1ub2lMejRLQ1R4d1lYUm9JSE4wZVd4bFBTSm1hV3hzT2lNME5qUTJOVFU3SWlCa1BTSk5Nek0zTGpNNE55dzBPUzR4TlRac0xUSXdMalV3T1N3ME55NDBORGxqTFRJdU1UTTNMRFF1T1RRMkxEUXVOVFE1TERndU9EWTRMRGN1T0RJekxEUXVOVGc0YkRNeUxqY3pMVFF5TGpjNU1TQWdJRU16TlRBdU9UUTJMRFUxTGpBeExETTBOQzR5TnpFc05URXVPU3d6TXpjdU16ZzNMRFE1TGpFMU5ub2lMejRLQ1R4d1lYUm9JSE4wZVd4bFBTSm1hV3hzT2lNME5qUTJOVFU3SWlCa1BTSk5NVGswTGpFMU55dzVOaTQyTURWc0xUSXdMalV3T1MwME55NDBORGxqTFRZdU9EZzBMREl1TnpRMUxURXpMalUxT1N3MUxqZzFNeTB5TUM0d05EUXNPUzR5TkRkc016SXVOek1zTkRJdU56a2dJQ0JETVRnNUxqWXdPQ3d4TURVdU5EY3pMREU1Tmk0eU9UVXNNVEF4TGpVMU1Td3hPVFF1TVRVM0xEazJMall3TlhvaUx6NEtDVHh3WVhSb0lITjBlV3hsUFNKbWFXeHNPaU0wTmpRMk5UVTdJaUJrUFNKTk1qY3lMakl5TkN3ek5DNHlOVE5qTFRVdU5URTRMVEF1TkRBNExURXhMakEzTnkwd0xqWTNPUzB4Tmk0M01EY3RNQzQyTnpsakxUVXVOak1zTUMweE1TNHhPRGtzTUM0eU56RXRNVFl1TnpBM0xEQXVOamM1SUNBZ2JERXlMakUyT1N3eE1ETXVORFJqTUM0Mk16TXNOUzR6T0N3NExqUTBNaXcxTGpNNExEa3VNRGMxTERCTU1qY3lMakl5TkN3ek5DNHlOVE42SWk4K0NnazhjR0YwYUNCemRIbHNaVDBpWm1sc2JEb2pORFkwTmpVMU95SWdaRDBpVFRRek5DNDROamdzTXpNMUxqQXdNV3d0TkRZdU1qQTJMVE0zTGpnd05XTXROQzR3TVRJdE15NHlPRE10TVM0eE1qTXRPUzQzTmpFc05DNHdNREV0T0M0NU5qbHNOakV1TkRjNExEa3VOU0FnSUVNME5Ea3VNVEEwTERNeE1DNDROaXcwTkRJdU5qQTRMRE15TXk0ek16RXNORE0wTGpnMk9Dd3pNelV1TURBeGVpSXZQZ29KUEhCaGRHZ2djM1I1YkdVOUltWnBiR3c2SXpRMk5EWTFOVHNpSUdROUlrMHpPVEF1TnpNekxETTRNaTQxTnpkc0xUSTFMakExTWkwMk5pNDRNRGRqTFRFdU9USXlMVFV1TVRJMUxEUXVORGswTFRrdU1qVTJMRGd1TXpZMExUVXVNemcxYkRRMUxqRTRNeXcwTlM0eE9ETWdJQ0JETkRFd0xqWTNNU3d6TmpVdU5EQTJMRFF3TVM0eE1qa3NNemMwTGpRMU5Td3pPVEF1TnpNekxETTRNaTQxTnpkNklpOCtDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BDOXpkbWMrQ2c9PVwiXG4gICAgfVxuICB9KTtcbn1cblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vc2hhcGVzL2NsaXBhcnQuanNcbi8vIG1vZHVsZSBpZCA9IDQ5XG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIid1c2Ugc3RyaWN0JztcblxuXG5yZXF1aXJlKFwiLi4vbW9kdWxlcy9wYXRoZmluZGVyXCIpO1xuLy9mYWJyaWMucmVxdWlyZShcIlNsaWRlSW1hZ2VcIixbXCJTbGlkZU9iamVjdFwiLyosXCJQYXRoZmluZGVyXCIqL10sZnVuY3Rpb24oKSB7XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLkltYWdlLnByb3RvdHlwZSwge1xuICBjb250ZW50T2Zmc2V0czogbnVsbCxcbiAgLyoqXG4gICAqIEBwcml2YXRlXG4gICAqIEBwYXJhbSB7Q2FudmFzUmVuZGVyaW5nQ29udGV4dDJEfSBjdHggQ29udGV4dCB0byByZW5kZXIgb25cbiAgICogQHBhcmFtIHtCb29sZWFufSBub1RyYW5zZm9ybVxuICAgKi9cbiAgX3JlbmRlcjogZnVuY3Rpb24gKGN0eCwgbm9UcmFuc2Zvcm0pIHtcbiAgICB2YXIgeCwgeSwgaW1hZ2VNYXJnaW5zID0gdGhpcy5fZmluZE1hcmdpbnMoKSwgZWxlbWVudFRvRHJhdztcblxuICAgIHggPSAobm9UcmFuc2Zvcm0gPyB0aGlzLmxlZnQgOiAtdGhpcy53aWR0aCAvIDIpO1xuICAgIHkgPSAobm9UcmFuc2Zvcm0gPyB0aGlzLnRvcCA6IC10aGlzLmhlaWdodCAvIDIpO1xuXG4gICAgaWYgKHRoaXMubWVldE9yU2xpY2UgPT09ICdzbGljZScpIHtcbiAgICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICAgIGN0eC5yZWN0KHgsIHksIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KTtcbiAgICAgIGN0eC5jbGlwKCk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuaXNNb3ZpbmcgPT09IGZhbHNlICYmIHRoaXMucmVzaXplRmlsdGVycy5sZW5ndGggJiYgdGhpcy5fbmVlZHNSZXNpemUoKSkge1xuICAgICAgdGhpcy5fbGFzdFNjYWxlWCA9IHRoaXMuc2NhbGVYO1xuICAgICAgdGhpcy5fbGFzdFNjYWxlWSA9IHRoaXMuc2NhbGVZO1xuICAgICAgZWxlbWVudFRvRHJhdyA9IHRoaXMuYXBwbHlGaWx0ZXJzKG51bGwsIHRoaXMucmVzaXplRmlsdGVycywgdGhpcy5fZmlsdGVyZWRFbCB8fCB0aGlzLl9vcmlnaW5hbEVsZW1lbnQsIHRydWUpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIGVsZW1lbnRUb0RyYXcgPSB0aGlzLl9lbGVtZW50O1xuICAgIH1cbiAgICB0aGlzLl9yZW5kZXJGaWxsKGN0eCk7XG4gICAgZWxlbWVudFRvRHJhdyAmJiBjdHguZHJhd0ltYWdlKGVsZW1lbnRUb0RyYXcsXG4gICAgICB4ICsgaW1hZ2VNYXJnaW5zLm1hcmdpblgsXG4gICAgICB5ICsgaW1hZ2VNYXJnaW5zLm1hcmdpblksXG4gICAgICBpbWFnZU1hcmdpbnMud2lkdGgsXG4gICAgICBpbWFnZU1hcmdpbnMuaGVpZ2h0XG4gICAgKTtcblxuICAgIHRoaXMuX3N0cm9rZShjdHgpO1xuICAgIHRoaXMuX3JlbmRlclN0cm9rZShjdHgpO1xuICB9LFxuICBpbWFnZVRvb2xzOiBmYWxzZSxcbiAgcGhvdG9zaG9wVG9vbHM6IGZhbHNlLFxuICBjbG9uZVN5bmM6IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgX29iamVjdCA9IHRoaXMudG9PYmplY3QoKTtcbiAgICBkZWxldGUgX29iamVjdC5maWx0ZXJzO1xuICAgIHZhciBjbG9uZSA9IG5ldyBmYWJyaWMuSW1hZ2UodGhpcy5fZWxlbWVudCwgX29iamVjdCk7XG4gICAgY2xvbmUuX2ZpbHRlcmVkRWwgPSB0aGlzLl9maWx0ZXJlZEVsO1xuICAgIGNsb25lLmZpbHRlcnMgPSB0aGlzLmZpbHRlcnM7XG4gICAgcmV0dXJuIGNsb25lO1xuICB9LFxuICByZXZlcnRDaGFuZ2VzOiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHBhdGhmaW5kZXIgPSB0aGlzLmNhbnZhcy5nZXRQYXRoZmluZGVyKCk7XG4gICAgaWYgKHBhdGhmaW5kZXIudGFyZ2V0ICYmIHBhdGhmaW5kZXIudGFyZ2V0ID09IHRoaXMpIHtcbiAgICAgIHBhdGhmaW5kZXIuaGlkZSgpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLl9lbGVtZW50ID09IHRoaXMuX29yaWdpbmFsRWxlbWVudCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuZmlsdGVycy5sZW5ndGggPSAwO1xuICAgIGlmICh0aGlzLl9maWx0ZXJlZEVsKSB7XG4gICAgICBkZWxldGUgdGhpcy5fZmlsdGVyZWRFbDtcbiAgICB9XG4gICAgZGVsZXRlIHRoaXMuX2VkaXRlZDtcbiAgICB0aGlzLl9lbGVtZW50ID0gdGhpcy5fb3JpZ2luYWxFbGVtZW50O1xuXG4gICAgdGhpcy5maXJlKFwiY29udGVudDptb2RpZmllZFwiLCB7XG4gICAgICBib3VuZHM6IHttaW5YOiAwLCBtaW5ZOiAwLCBtYXhYOiB0aGlzLl9lbGVtZW50LndpZHRoLCBtYXhZOiB0aGlzLl9lbGVtZW50LmhlaWdodH1cbiAgICB9KTtcblxuXG4gICAgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gIH0sXG4gIGV4dHJhY3RDb2xvcnM6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBfY29sb3JzID0gZmFicmljLk1hZ2ljV2FuZC5leHRyYWN0Q29sb3JzKHRoaXMuX2VsZW1lbnQpO1xuICAgIHZhciBjb2xvcnMgPSB7fTtcbiAgICBmb3IodmFyIGkgaW4gX2NvbG9ycyl7XG4gICAgICB2YXIgX3N0ciA9IFwicmdiKFwiICsgX2NvbG9yc1tpXS5qb2luKFwiLFwiKSArIFwiKVwiO1xuICAgICAgY29sb3JzW19zdHJdID0ge307XG4gICAgfVxuICAgIHJldHVybiBjb2xvcnM7XG4gIH0sXG4gIGFjdGlvbnM6IGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoIGZhYnJpYy5JbWFnZS5wcm90b3R5cGUuYWN0aW9ucywge1xuICAgIHBob3Rvc2hvcFRvb2xzOiB7XG4gICAgICB0eXBlOiAnZWZmZWN0JyxcbiAgICAgIGVmZmVjdFRwbDogJzxkaXYgaWQ9XCJlZGl0b3ItdG9vbHNcIiBjbGFzcz1cImlubGluZS1hY3Rpb25zIGNvbXBhY3RcIj48L2Rpdj4nICtcbiAgICAgICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJjaGVja2JvYXJkXCIgPjxkaXYgaWQ9XCJwYXRoZmluZGVyXCI+PC9kaXY+PC9kaXY+JyxcbiAgICAgIGNsYXNzTmFtZTogJ2ZhIGZhLXBlbmNpbC1zcXVhcmUtbycsXG4gICAgICB0aXRsZTogXCJhZHZhbmNlZCB0b29sc1wiLFxuICAgICAgYWN0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBwYXRoZmluZGVyID0gdGhpcy5jYW52YXMuZ2V0UGF0aGZpbmRlcigpO1xuICAgICAgICBwYXRoZmluZGVyLnRhcmdldCA9IHRoaXM7XG4gICAgICAgIHBhdGhmaW5kZXIuc2V0UGljdHVyZSh0aGlzLl9lbGVtZW50KTtcbiAgICAgICAgcGF0aGZpbmRlci5zaG93KCk7XG4gICAgICB9LFxuICAgICAgYWN0aW9uUGFyYW1ldGVyczogZnVuY3Rpb24gKGVsLCBkYXRhKSB7XG5cbiAgICAgICAgdmFyIHBhdGhmaW5kZXIgPSB0aGlzLmNhbnZhcy5nZXRQYXRoZmluZGVyKCk7XG4gICAgICAgIHBhdGhmaW5kZXIuY2FudmFzID0gdGhpcy5jYW52YXM7XG5cbiAgICAgICAgbmV3IGZhYnJpYy5Ub29sYmFyKHBhdGhmaW5kZXIsICdlZGl0b3ItdG9vbHMnKTtcblxuXG4gICAgICAgIHBhdGhmaW5kZXIuc2V0Q29udGFpbmVyKCdwYXRoZmluZGVyJyk7XG5cbiAgICAgICAgLy8gaWYgKHBhdGhmaW5kZXIudGFyZ2V0KXBhdGhmaW5kZXIuaGlkZSgpO1xuICAgICAgICBwYXRoZmluZGVyLnRhcmdldCA9IHRoaXM7XG4gICAgICAgIHBhdGhmaW5kZXIuc2V0UGljdHVyZSh0aGlzLl9lbGVtZW50KTtcbiAgICAgICAgcGF0aGZpbmRlci5zaG93KCk7XG4gICAgICB9XG4gICAgfSxcbiAgICByZXZlcnRDaGFuZ2VzOiB7XG4gICAgICBjbGFzc05hbWU6ICdmYSBmYS1oaXN0b3J5JyxcbiAgICAgIHRpdGxlOiBcInJldmVydCB0byBvcmlnbmFsIGltYWdlXCIsXG4gICAgICBhY3Rpb246IFwicmV2ZXJ0Q2hhbmdlc1wiLFxuICAgICAgb2JzZXJ2ZTogXCJjb250ZW50Om1vZGlmaWVkXCIsXG4gICAgICB2aXNpYmxlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiAhIXRoaXMuX2ZpbHRlcmVkRWwgfHwgdGhpcy5fZWRpdGVkO1xuICAgICAgfVxuICAgIH1cbiAgfSlcbn0pO1xuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9zaGFwZXMvaW1hZ2UucGhvdG9zaG9wLXRvb2xzLmpzXG4vLyBtb2R1bGUgaWQgPSA1MFxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCJcbi8vIHJlcXVpcmUoXCIuLi9tb2R1bGVzL3BhdGhmaW5kZXJcIik7XG5yZXF1aXJlKFwiLi4vZmlsdGVycy9yZW1vdmVXaGl0ZVwiKTtcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuSW1hZ2UucHJvdG90eXBlLCB7XG4gIHJlbW92ZVdoaXRlOiBmdW5jdGlvbiAodGhyZXNob2xkLCByZW1vdmVBbGwsIGNhbGxiYWNrKSB7XG5cblxuICAgIHZhciByd2YgPSBfLmZpbmRXaGVyZSh0aGlzLmZpbHRlcnMsIHt0eXBlOiAnUmVtb3ZlV2hpdGVEUCd9KTtcblxuICAgIGlmIChyd2YpIHtcbiAgICAgIHJ3Zi5vcHRpb25zLmNvbG9yVGhyZXNob2xkID0gdGhyZXNob2xkO1xuICAgICAgcndmLm9wdGlvbnMuZnJvbUNvcm5lcnMgPSAhcmVtb3ZlQWxsO1xuICAgIH0gZWxzZSB7XG4gICAgICByd2YgPSBuZXcgZmFicmljLkltYWdlLmZpbHRlcnMuUmVtb3ZlV2hpdGVEUCh7XG4gICAgICAgIGZyb21Db3JuZXJzOiAhcmVtb3ZlQWxsLFxuICAgICAgICBibHVyUmFkaXVzOiAyLFxuICAgICAgICBjb2xvclRocmVzaG9sZDogdGhyZXNob2xkXG4gICAgICB9KTtcbiAgICAgIHRoaXMuZmlsdGVycy5wdXNoKHJ3Zik7XG4gICAgfVxuXG4gICAgdmFyIF90aGlzID0gdGhpcztcbiAgICB0aGlzLmFwcGx5RmlsdGVycyhmdW5jdGlvbiAoKSB7XG4gICAgICAvL190aGlzLndpZHRoID0gX3RoaXMuX2VsZW1lbnQud2lkdGg7XG4gICAgICAvL190aGlzLmhlaWdodCA9IF90aGlzLl9lbGVtZW50LmhlaWdodDtcbiAgICAgIF90aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICAgIF90aGlzLmZpcmUoXCJjb250ZW50Om1vZGlmaWVkXCIsIHtmaWx0ZXI6IHJ3ZiwgYm91bmRzOiByd2YuYm91bmRzfSk7XG4gICAgICBjYWxsYmFjayAmJiBjYWxsYmFjaygpO1xuICAgIH0pO1xuICB9LFxuICByZW1vdmVXaGl0ZUFsbDogdHJ1ZSxcblxuICBhY3Rpb25zOiBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5JbWFnZS5wcm90b3R5cGUuYWN0aW9ucywge1xuICAgIHJlbW92ZVdoaXRlRnJvbUJvcmRlcnM6IHtcbiAgICAgIHRpdGxlOiAnUmVtb3ZlIEJhY2tncm91bmQnLFxuICAgICAgdHlwZTogJ2VmZmVjdCcsXG4gICAgICBjbGFzc05hbWU6IFwiZmEgZmEtZG90LWNpcmNsZS1vXCIsXG4gICAgICBlZmZlY3RUcGw6ICc8YnV0dG9uIGlkPVwic2VsZWN0LWNvbG9ycy1hY3Rpb24tYnV0dG9uXCIgY2xhc3M9XCJmYSBmYS1jaGVja1wiPjwvYnV0dG9uPicgK1xuICAgICAgJzxpbnB1dCBpZD1cInNlbGVjdC1jb2xvcnMtY2hlY2tib3hcIiB0eXBlPVwiY2hlY2tib3hcIj4nICtcbiAgICAgICc8aW5wdXQgaWQ9XCJzZWxlY3QtY29sb3JzLXRocmVzaG9sZFwiIHR5cGU9XCJyYW5nZVwiICAgbWluPVwiMVwiIG1heD1cIjI1NVwiPicsXG4gICAgICBhY3Rpb25QYXJhbWV0ZXJzOiBmdW5jdGlvbiAoZWwsIGRhdGEpIHtcbiAgICAgICAgdmFyXG4gICAgICAgICAgYWN0aW9uQ2hrID0gZWwuZmluZCgnI3NlbGVjdC1jb2xvcnMtY2hlY2tib3gnKSxcbiAgICAgICAgICBhY3Rpb25CdG4gPSBlbC5maW5kKCcjc2VsZWN0LWNvbG9ycy1hY3Rpb24tYnV0dG9uJyk7XG4gICAgICAgIGRhdGEudGhyZXNob2xkRWwgPSBlbC5maW5kKCcjc2VsZWN0LWNvbG9ycy10aHJlc2hvbGQnKTtcblxuICAgICAgICBkYXRhLnJlbW92ZVdoaXRlQWxsID0gYWN0aW9uQ2hrLmlzKFwiOmNoZWNrZWRcIik7XG4gICAgICAgIGFjdGlvbkNoay5jaGFuZ2UoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGRhdGEucmVtb3ZlV2hpdGVBbGwgPSBhY3Rpb25DaGsuaXMoXCI6Y2hlY2tlZFwiKVxuICAgICAgICB9KTtcbiAgICAgICAgYWN0aW9uQnRuLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBkYXRhLmFjdGlvbigpO1xuICAgICAgICB9KTtcbiAgICAgICAgaWYgKCFkYXRhLl9fYWN0aW9uKSB7XG5cbiAgICAgICAgICBkYXRhLl9fYWN0aW9uID0gZGF0YS5hY3Rpb247XG4gICAgICAgICAgZGF0YS5hY3Rpb24gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBkYXRhLl9fYWN0aW9uKHBhcnNlSW50KGRhdGEudGhyZXNob2xkRWwudmFsKCkpLCBkYXRhLnJlbW92ZVdoaXRlQWxsKVxuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBhY3Rpb246IFwicmVtb3ZlV2hpdGVcIixcbiAgICAgIGluc2VydDogJ2ltYWdlVG9vbHMnXG4gICAgfVxuICB9KVxufSk7XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL3NoYXBlcy9pbWFnZS5yZW1vdmUtd2hpdGUuanNcbi8vIG1vZHVsZSBpZCA9IDUxXG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIid1c2Ugc3RyaWN0JztcblxudmFyIHBhdGhfaW5pdGlhbGl6ZV9vdmVyd3JpdHRlbiA9IGZhYnJpYy5QYXRoLnByb3RvdHlwZS5pbml0aWFsaXplO1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5QYXRoLnByb3RvdHlwZSwge1xuICBhY2N1cmFjeTogMCxcbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKHBhdGgsIG9wdGlvbnMpIHtcbiAgICB0aGlzLmNhbGxTdXBlcignaW5pdGlhbGl6ZScsIG9wdGlvbnMpO1xuICAgIHBhdGhfaW5pdGlhbGl6ZV9vdmVyd3JpdHRlbi5jYWxsKHRoaXMsIHBhdGgsIG9wdGlvbnMpO1xuICAgIHRoaXMuX3NldF9hY2N1cmFjeSh0aGlzLmFjY3VyYWN5LCB0aGlzLnBhdGgpO1xuICB9LFxuICB0cmFuc2xhdGU6IGZ1bmN0aW9uIChwYXRoLCB0cmFuc2xhdGVYLCB0cmFuc2xhdGVZKSB7XG4gICAgdmFyIGN1cnJlbnQ7XG4gICAgLy9pZih0aGlzLnBhdGhbMF1bMF0gPT09IFwibVwiKXtcbiAgICAvLyAgcmV0dXJuO1xuICAgIC8vfVxuICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBwYXRoLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7XG5cbiAgICAgIGN1cnJlbnQgPSBwYXRoW2ldO1xuXG4gICAgICBzd2l0Y2ggKGN1cnJlbnRbMF0pIHsgLy8gZmlyc3QgbGV0dGVyXG4gICAgICAgIGNhc2UgJ0wnOiAvLyBsaW5ldG8sIGFic29sdXRlXG4gICAgICAgICAgY3VycmVudFsxXSArPSB0cmFuc2xhdGVYO1xuICAgICAgICAgIGN1cnJlbnRbMl0gKz0gdHJhbnNsYXRlWTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnSCc6XG4gICAgICAgICAgY3VycmVudFsxXSArPSB0cmFuc2xhdGVYO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdWJzogLy8gdmVyaWNhbCBsaW5ldG8sIGFic29sdXRlXG4gICAgICAgICAgY3VycmVudFsxXSArPSB0cmFuc2xhdGVZO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdNJzpcbiAgICAgICAgICBjdXJyZW50WzFdICs9IHRyYW5zbGF0ZVg7XG4gICAgICAgICAgY3VycmVudFsyXSArPSB0cmFuc2xhdGVZO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdDJzpcbiAgICAgICAgICBjdXJyZW50WzFdICs9IHRyYW5zbGF0ZVg7XG4gICAgICAgICAgY3VycmVudFsyXSArPSB0cmFuc2xhdGVZO1xuICAgICAgICAgIGN1cnJlbnRbM10gKz0gdHJhbnNsYXRlWDtcbiAgICAgICAgICBjdXJyZW50WzRdICs9IHRyYW5zbGF0ZVk7XG4gICAgICAgICAgY3VycmVudFs1XSArPSB0cmFuc2xhdGVYO1xuICAgICAgICAgIGN1cnJlbnRbNl0gKz0gdHJhbnNsYXRlWTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnUyc6XG4gICAgICAgICAgY3VycmVudFsxXSArPSB0cmFuc2xhdGVYO1xuICAgICAgICAgIGN1cnJlbnRbMl0gKz0gdHJhbnNsYXRlWTtcbiAgICAgICAgICBjdXJyZW50WzNdICs9IHRyYW5zbGF0ZVg7XG4gICAgICAgICAgY3VycmVudFs0XSArPSB0cmFuc2xhdGVZO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdRJzogLy8gcXVhZHJhdGljQ3VydmVUbywgYWJzb2x1dGVcbiAgICAgICAgICBjdXJyZW50WzFdICs9IHRyYW5zbGF0ZVg7XG4gICAgICAgICAgY3VycmVudFsyXSArPSB0cmFuc2xhdGVZO1xuICAgICAgICAgIGN1cnJlbnRbM10gKz0gdHJhbnNsYXRlWDtcbiAgICAgICAgICBjdXJyZW50WzRdICs9IHRyYW5zbGF0ZVk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ1QnOlxuICAgICAgICAgIGN1cnJlbnRbMV0gKz0gdHJhbnNsYXRlWDtcbiAgICAgICAgICBjdXJyZW50WzJdICs9IHRyYW5zbGF0ZVk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ0EnOlxuICAgICAgICAgIGN1cnJlbnRbMV0gKz0gdHJhbnNsYXRlWDsvL3RvZG8/P1xuICAgICAgICAgIGN1cnJlbnRbMl0gKz0gdHJhbnNsYXRlWTsvL3RvZG8gPz9cbiAgICAgICAgICBjdXJyZW50WzZdICs9IHRyYW5zbGF0ZVg7XG4gICAgICAgICAgY3VycmVudFs3XSArPSB0cmFuc2xhdGVZO1xuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgX3NldF9hY2N1cmFjeTogZnVuY3Rpb24gKGFjY3VyYWN5LCBwYXRoKSB7XG4gICAgZm9yICh2YXIgaSA9MCA7IGkgPCBwYXRoLmxlbmd0aDsgaSsrKSB7XG4gICAgICBmb3IgKHZhciBqID0gMTsgaiA8IHBhdGhbaV0ubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgcGF0aFtpXVtqXSA9ICtwYXRoW2ldW2pdLnRvRml4ZWQodGhpcy5hY2N1cmFjeSk7XG4gICAgICB9XG4gICAgfVxuICB9LFxuICBzZXRBY2N1cmFjeTogZnVuY3Rpb24gKGFjY3VyYWN5KSB7XG4gICAgdGhpcy5hY2N1cmFjeSA9IGFjY3VyYWN5O1xuICAgIGlmKCF0aGlzLl9wb2ludHMpcmV0dXJuO1xuICAgIHRoaXMuX3NldF9hY2N1cmFjeShhY2N1cmFjeSwgdGhpcy5wYXRoKTtcbiAgfSxcbiAgc3RvcmVQYXRoQXNTdHJpbmc6IGZhbHNlLFxuICBfdG9PYmplY3Rfb3ZlcndyaXR0ZW46IGZhYnJpYy5QYXRoLnByb3RvdHlwZS50b09iamVjdCxcbi8vdG9kbyB1c2UgZXZlbnQgXCJiZWZvcmU6b2JqZWN0XCI7XG4gIHRvT2JqZWN0OiBmdW5jdGlvbiAocHJvcGVydGllc1RvSW5jbHVkZSkge1xuXG4gICAgaWYodGhpcy5hY2N1cmFjeSl7XG4gICAgICB0aGlzLl9zZXRfYWNjdXJhY3kodGhpcy5hY2N1cmFjeSx0aGlzLnBhdGgpO1xuICAgICAgdGhpcy5sZWZ0ID0gK3RoaXMubGVmdC50b0ZpeGVkKHRoaXMuYWNjdXJhY3kpO1xuICAgICAgdGhpcy50b3AgID0gK3RoaXMudG9wLnRvRml4ZWQodGhpcy5hY2N1cmFjeSk7XG4gICAgICB0aGlzLnBhdGhPZmZzZXQueCA9ICt0aGlzLnBhdGhPZmZzZXQueC50b0ZpeGVkKHRoaXMuYWNjdXJhY3kpO1xuICAgICAgdGhpcy5wYXRoT2Zmc2V0LnkgPSArdGhpcy5wYXRoT2Zmc2V0LnkudG9GaXhlZCh0aGlzLmFjY3VyYWN5KTtcbiAgICB9XG5cbiAgICB2YXIgX29iaiA9IHRoaXMuX3RvT2JqZWN0X292ZXJ3cml0dGVuKHByb3BlcnRpZXNUb0luY2x1ZGUpO1xuXG4gICAgaWYgKHRoaXMuc3RvcmVQcm9wZXJ0aWVzLmluZGV4T2YoXCIqXCIpID09IC0xKSB7XG5cbiAgICAgIGlmIChfb2JqLnBhdGhPZmZzZXQgJiYgdGhpcy5zdG9yZVByb3BlcnRpZXMuaW5kZXhPZihcInBhdGhPZmZzZXRcIikgPT0gLTEpIHtcbiAgICAgICAgdGhpcy50cmFuc2xhdGUoX29iai5wYXRoLCBfb2JqLnBhdGhPZmZzZXQueCwgX29iai5wYXRoT2Zmc2V0LnkpXG4gICAgICAgIHRoaXMuX3NldF9hY2N1cmFjeSh0aGlzLmFjY3VyYWN5LF9vYmoucGF0aCk7XG4gICAgICB9XG5cbiAgICAgIGZvciAodmFyIGkgaW4gX29iaikge1xuICAgICAgICBpZiAodGhpcy5zdG9yZVByb3BlcnRpZXMuaW5kZXhPZihpKSA9PSAtMSkge1xuICAgICAgICAgIGRlbGV0ZSBfb2JqW2ldO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBjb25zb2xlLmxvZyhcIiEhIVwiKVxuICAgIH1cbiAgICBpZiAodGhpcy5zdG9yZVBhdGhBc1N0cmluZykge1xuICAgICAgX29iai5wYXRoID0gX29iai5wYXRoLmpvaW4oJycpXG4gICAgfVxuICAgIHJldHVybiBfb2JqO1xuICB9XG59KTtcblxuLyoqXG4gKiBDcmVhdGVzIGFuIGluc3RhbmNlIG9mIGZhYnJpYy5QYXRoIGZyb20gYW4gb2JqZWN0XG4gKiBAc3RhdGljXG4gKiBAbWVtYmVyT2YgZmFicmljLlBhdGhcbiAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3RcbiAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIHRvIGludm9rZSB3aGVuIGFuIGZhYnJpYy5QYXRoIGluc3RhbmNlIGlzIGNyZWF0ZWRcbiAqL1xuZmFicmljLlBhdGguZnJvbU9iamVjdCA9IGZ1bmN0aW9uIChvYmplY3QsIGNhbGxiYWNrKSB7XG4gIC8qIGlmICh0eXBlb2Ygb2JqZWN0LnBhdGggPT09ICdzdHJpbmcnKSB7XG4gICBmYWJyaWMubG9hZFNWR0Zyb21VUkwob2JqZWN0LnBhdGgsIGZ1bmN0aW9uIChlbGVtZW50cykge1xuICAgdmFyIHBhdGggPSBlbGVtZW50c1swXSxcbiAgIHBhdGhVcmwgPSBvYmplY3QucGF0aDtcblxuICAgZGVsZXRlIG9iamVjdC5wYXRoO1xuXG4gICBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKHBhdGgsIG9iamVjdCk7XG4gICBwYXRoLnNldFNvdXJjZVBhdGgocGF0aFVybCk7XG5cbiAgIGNhbGxiYWNrKHBhdGgpO1xuICAgfSk7XG4gICB9XG4gICBlbHNlIHsqL1xuXG4gIHZhciBfc2NhbGVkID0gb2JqZWN0LnNjYWxlWCB8fCBvYmplY3Quc2NhbGVZO1xuXG4gIHZhciBwYXRoID0gbmV3IGZhYnJpYy5QYXRoKG9iamVjdC5wYXRoLCBvYmplY3QpO1xuXG4gIGlmKCFfc2NhbGVkKXtcbiAgICBpZihvYmplY3Qud2lkdGgpe1xuICAgICAgcGF0aC5zY2FsZVggPSBvYmplY3Qud2lkdGggLyBwYXRoLndpZHRoO1xuICAgIH1cbiAgICBpZihvYmplY3QuaGVpZ2h0KXtcbiAgICAgIHBhdGguc2NhbGVZID0gb2JqZWN0LmhlaWdodCAvIHBhdGguaGVpZ2h0O1xuICAgIH1cbiAgfVxuXG4gIGNhbGxiYWNrICYmIGNhbGxiYWNrKHBhdGgpO1xuICByZXR1cm4gcGF0aDtcbiAgLy8gfVxufTtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vc2hhcGVzL3BhdGguanNcbi8vIG1vZHVsZSBpZCA9IDUyXG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIlxuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4vLyBMaXN0U3R5bGVcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuVGV4dGJveC5wcm90b3R5cGUsIHtcbiAgc3RhdGVQcm9wZXJ0aWVzOiBmYWJyaWMuUmVjdC5wcm90b3R5cGUuc3RhdGVQcm9wZXJ0aWVzLmNvbmNhdChbXCJsaXN0U3R5bGVUeXBlXCIsXCJsaXN0U3R5bGVGb3JtYXRcIixcImxpc3RUZXh0UGFkZGluZ1wiLFwidGV4dFBhZGRpbmdcIl0pLFxuICBsaXN0U3R5bGVUeXBlOiBcIm5vbmVcIixcbiAgbGlzdFN0eWxlRm9ybWF0OiBcIk4uXCIsXG4gIGxpc3RUZXh0UGFkZGluZzogNDAsXG4gIHRleHRQYWRkaW5nOiAwLFxuICBzZXRUZXh0UGFkZGluZzogZnVuY3Rpb24odmFsKXtcbiAgICB0aGlzLnRleHRQYWRkaW5nID0gdmFsO1xuICAgIHRoaXMuX2luaXREaW1lbnNpb25zKCk7XG4gIH0sXG4gIHNldExpc3RTdHlsZVR5cGU6IGZ1bmN0aW9uKHZhbCl7XG4gICAgdGhpcy5saXN0U3R5bGVUeXBlID0gdmFsO1xuICAgIHRoaXMuc2V0VGV4dFBhZGRpbmcodmFsID09PSBcIm5vbmVcIiA/IDA6IHRoaXMubGlzdFRleHRQYWRkaW5nKTtcbiAgfSxcbiAgLyoqXG4gICAqIFdyYXBzIHRleHQgdXNpbmcgdGhlICd3aWR0aCcgcHJvcGVydHkgb2YgVGV4dGJveC4gRmlyc3QgdGhpcyBmdW5jdGlvblxuICAgKiBzcGxpdHMgdGV4dCBvbiBuZXdsaW5lcywgc28gd2UgcHJlc2VydmUgbmV3bGluZXMgZW50ZXJlZCBieSB0aGUgdXNlci5cbiAgICogVGhlbiBpdCB3cmFwcyBlYWNoIGxpbmUgdXNpbmcgdGhlIHdpZHRoIG9mIHRoZSBUZXh0Ym94IGJ5IGNhbGxpbmdcbiAgICogX3dyYXBMaW5lKCkuXG4gICAqIEBwYXJhbSB7Q2FudmFzUmVuZGVyaW5nQ29udGV4dDJEfSBjdHggQ29udGV4dCB0byB1c2UgZm9yIG1lYXN1cmVtZW50c1xuICAgKiBAcGFyYW0ge1N0cmluZ30gdGV4dCBUaGUgc3RyaW5nIG9mIHRleHQgdGhhdCBpcyBzcGxpdCBpbnRvIGxpbmVzXG4gICAqIEByZXR1cm5zIHtBcnJheX0gQXJyYXkgb2YgbGluZXNcbiAgICovXG4gIF93cmFwVGV4dDogZnVuY3Rpb24oY3R4LCB0ZXh0KSB7XG4gICAgdmFyIGxpbmVzID0gdGV4dC5zcGxpdCh0aGlzLl9yZU5ld2xpbmUpLCB3cmFwcGVkID0gW10sIGk7XG5cblxuICAgIHRoaXMuX3BhcmFncmFwaHMgPSB7fTtcblxuICAgIGZvciAoaSA9IDA7IGkgPCBsaW5lcy5sZW5ndGg7IGkrKykge1xuICAgICAgdGhpcy5fcGFyYWdyYXBoc1t3cmFwcGVkLmxlbmd0aF0gPSB0aGlzLmxpc3RTdHlsZUZvcm1hdC5yZXBsYWNlKFwiTlwiLGkgKyAxKVxuICAgICAgd3JhcHBlZCA9IHdyYXBwZWQuY29uY2F0KHRoaXMuX3dyYXBMaW5lKGN0eCwgbGluZXNbaV0sIGkpKTtcbiAgICB9XG5cbiAgICByZXR1cm4gd3JhcHBlZDtcbiAgfSxcblxuXG4gIC8qKlxuICAgKiBXcmFwcyBhIGxpbmUgb2YgdGV4dCB1c2luZyB0aGUgd2lkdGggb2YgdGhlIFRleHRib3ggYW5kIGEgY29udGV4dC5cbiAgICogQHBhcmFtIHtDYW52YXNSZW5kZXJpbmdDb250ZXh0MkR9IGN0eCBDb250ZXh0IHRvIHVzZSBmb3IgbWVhc3VyZW1lbnRzXG4gICAqIEBwYXJhbSB7U3RyaW5nfSB0ZXh0IFRoZSBzdHJpbmcgb2YgdGV4dCB0byBzcGxpdCBpbnRvIGxpbmVzXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBsaW5lSW5kZXhcbiAgICogQHJldHVybnMge0FycmF5fSBBcnJheSBvZiBsaW5lKHMpIGludG8gd2hpY2ggdGhlIGdpdmVuIHRleHQgaXMgd3JhcHBlZFxuICAgKiB0by5cbiAgICovXG4gIF93cmFwTGluZTogZnVuY3Rpb24oY3R4LCB0ZXh0LCBsaW5lSW5kZXgpIHtcbiAgICB2YXIgbGluZVdpZHRoICAgICAgICA9IDAsXG4gICAgICBsaW5lcyAgICAgICAgICAgID0gW10sXG4gICAgICBsaW5lICAgICAgICAgICAgID0gJycsXG4gICAgICB3b3JkcyAgICAgICAgICAgID0gdGV4dC5zcGxpdCgnICcpLFxuICAgICAgd29yZCAgICAgICAgICAgICA9ICcnLFxuICAgICAgb2Zmc2V0ICAgICAgICAgICA9IDAsXG4gICAgICBpbmZpeCAgICAgICAgICAgID0gJyAnLFxuICAgICAgd29yZFdpZHRoICAgICAgICA9IDAsXG4gICAgICBpbmZpeFdpZHRoICAgICAgID0gMCxcbiAgICAgIGxhcmdlc3RXb3JkV2lkdGggPSAwLFxuICAgICAgbGluZUp1c3RTdGFydGVkID0gdHJ1ZSxcbiAgICAgIGFkZGl0aW9uYWxTcGFjZSA9IHRoaXMuX2dldFdpZHRoT2ZDaGFyU3BhY2luZygpO1xuXG5cblxuICAgIHZhciBfdGV4dEFyZWFXaWR0aCA9IHRoaXMud2lkdGg7XG4gICAgaWYodGhpcy50ZXh0UGFkZGluZyl7XG4gICAgICBfdGV4dEFyZWFXaWR0aCAtPSB0aGlzLnRleHRQYWRkaW5nXG4gICAgfVxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgd29yZHMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHdvcmQgPSB3b3Jkc1tpXTtcbiAgICAgIHdvcmRXaWR0aCA9IHRoaXMuX21lYXN1cmVUZXh0KGN0eCwgd29yZCwgbGluZUluZGV4LCBvZmZzZXQpO1xuXG4gICAgICBvZmZzZXQgKz0gd29yZC5sZW5ndGg7XG5cbiAgICAgIGxpbmVXaWR0aCArPSBpbmZpeFdpZHRoICsgd29yZFdpZHRoIC0gYWRkaXRpb25hbFNwYWNlO1xuXG4gICAgICBpZiAobGluZVdpZHRoID49IF90ZXh0QXJlYVdpZHRoICYmICFsaW5lSnVzdFN0YXJ0ZWQpIHtcbiAgICAgICAgbGluZXMucHVzaChsaW5lKTtcbiAgICAgICAgbGluZSA9ICcnO1xuICAgICAgICBsaW5lV2lkdGggPSB3b3JkV2lkdGg7XG4gICAgICAgIGxpbmVKdXN0U3RhcnRlZCA9IHRydWU7XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgbGluZVdpZHRoICs9IGFkZGl0aW9uYWxTcGFjZTtcbiAgICAgIH1cblxuICAgICAgaWYgKCFsaW5lSnVzdFN0YXJ0ZWQpIHtcbiAgICAgICAgbGluZSArPSBpbmZpeDtcbiAgICAgIH1cbiAgICAgIGxpbmUgKz0gd29yZDtcblxuICAgICAgaW5maXhXaWR0aCA9IHRoaXMuX21lYXN1cmVUZXh0KGN0eCwgaW5maXgsIGxpbmVJbmRleCwgb2Zmc2V0KTtcbiAgICAgIG9mZnNldCsrO1xuICAgICAgbGluZUp1c3RTdGFydGVkID0gZmFsc2U7XG4gICAgICAvLyBrZWVwIHRyYWNrIG9mIGxhcmdlc3Qgd29yZFxuICAgICAgaWYgKHdvcmRXaWR0aCA+IGxhcmdlc3RXb3JkV2lkdGgpIHtcbiAgICAgICAgbGFyZ2VzdFdvcmRXaWR0aCA9IHdvcmRXaWR0aDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpICYmIGxpbmVzLnB1c2gobGluZSk7XG5cbiAgICBpZiAobGFyZ2VzdFdvcmRXaWR0aCA+IHRoaXMuZHluYW1pY01pbldpZHRoKSB7XG4gICAgICB0aGlzLmR5bmFtaWNNaW5XaWR0aCA9IGxhcmdlc3RXb3JkV2lkdGggLSBhZGRpdGlvbmFsU3BhY2U7XG4gICAgfVxuXG4gICAgcmV0dXJuIGxpbmVzO1xuICB9LFxuICAvKipcbiAgICogQHByaXZhdGVcbiAgICogQHBhcmFtIHtOdW1iZXJ9IGxpbmVXaWR0aCBXaWR0aCBvZiB0ZXh0IGxpbmVcbiAgICogQHJldHVybiB7TnVtYmVyfSBMaW5lIGxlZnQgb2Zmc2V0XG4gICAqL1xuICBfZ2V0TGluZUxlZnRPZmZzZXQ6IGZ1bmN0aW9uKGxpbmVXaWR0aCkge1xuICAgIGlmICh0aGlzLnRleHRBbGlnbiA9PT0gJ2NlbnRlcicpIHtcbiAgICAgIHJldHVybiAodGhpcy53aWR0aCAtIGxpbmVXaWR0aCkgLyAyICsgdGhpcy50ZXh0UGFkZGluZy8yO1xuICAgIH1cbiAgICBpZiAodGhpcy50ZXh0QWxpZ24gPT09ICdyaWdodCcpIHtcbiAgICAgIHJldHVybiB0aGlzLndpZHRoIC0gbGluZVdpZHRoO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy50ZXh0UGFkZGluZztcbiAgfSxcbiAgLyoqXG4gICAqIEBwcml2YXRlXG4gICAqIEBwYXJhbSB7Q2FudmFzUmVuZGVyaW5nQ29udGV4dDJEfSBjdHggQ29udGV4dCB0byByZW5kZXIgb25cbiAgICogQHBhcmFtIHtTdHJpbmd9IG1ldGhvZCBNZXRob2QgbmFtZSAoXCJmaWxsVGV4dFwiIG9yIFwic3Ryb2tlVGV4dFwiKVxuICAgKi9cbiAgX3JlbmRlclRleHRDb21tb246IGZ1bmN0aW9uKGN0eCwgbWV0aG9kKSB7XG5cbiAgICB2YXIgbGluZUhlaWdodHMgPSAwLCBsZWZ0ID0gdGhpcy5fZ2V0TGVmdE9mZnNldCgpLCB0b3AgPSB0aGlzLl9nZXRUb3BPZmZzZXQoKTtcblxuICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSB0aGlzLl90ZXh0TGluZXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgIHZhciBoZWlnaHRPZkxpbmUgPSB0aGlzLl9nZXRIZWlnaHRPZkxpbmUoY3R4LCBpKSxcbiAgICAgICAgbWF4SGVpZ2h0ID0gaGVpZ2h0T2ZMaW5lIC8gdGhpcy5saW5lSGVpZ2h0LFxuICAgICAgICBsaW5lV2lkdGggPSB0aGlzLl9nZXRMaW5lV2lkdGgoY3R4LCBpKSxcbiAgICAgICAgbGVmdE9mZnNldCA9IHRoaXMuX2dldExpbmVMZWZ0T2Zmc2V0KGxpbmVXaWR0aCk7XG5cblxuICAgICAgdGhpcy5fcmVuZGVyVGV4dExpbmUoXG4gICAgICAgIG1ldGhvZCxcbiAgICAgICAgY3R4LFxuICAgICAgICB0aGlzLl90ZXh0TGluZXNbaV0sXG4gICAgICAgIGxlZnQgKyBsZWZ0T2Zmc2V0LFxuICAgICAgICB0b3AgKyBsaW5lSGVpZ2h0cyArIG1heEhlaWdodCxcbiAgICAgICAgaVxuICAgICAgKTtcbiAgICAgIGxpbmVIZWlnaHRzICs9IGhlaWdodE9mTGluZTtcbiAgICB9XG4gIH0sXG5cblxuICAvKipcbiAgICogQHByaXZhdGVcbiAgICogQHBhcmFtIHtTdHJpbmd9IG1ldGhvZCBNZXRob2QgbmFtZSAoXCJmaWxsVGV4dFwiIG9yIFwic3Ryb2tlVGV4dFwiKVxuICAgKiBAcGFyYW0ge0NhbnZhc1JlbmRlcmluZ0NvbnRleHQyRH0gY3R4IENvbnRleHQgdG8gcmVuZGVyIG9uXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBsaW5lIFRleHQgdG8gcmVuZGVyXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBsZWZ0IExlZnQgcG9zaXRpb24gb2YgdGV4dFxuICAgKiBAcGFyYW0ge051bWJlcn0gdG9wIFRvcCBwb3NpdGlvbiBvZiB0ZXh0XG4gICAqIEBwYXJhbSB7TnVtYmVyfSBsaW5lSW5kZXggSW5kZXggb2YgYSBsaW5lIGluIGEgdGV4dFxuICAgKi9cbiAgX3JlbmRlclRleHRMaW5lOiBmdW5jdGlvbihtZXRob2QsIGN0eCwgbGluZSwgbGVmdCwgdG9wLCBsaW5lSW5kZXgpIHtcblxuXG5cbiAgICAvLyBsaWZ0IHRoZSBsaW5lIGJ5IHF1YXJ0ZXIgb2YgZm9udFNpemVcbiAgICB0b3AgLT0gdGhpcy5mb250U2l6ZSAqIHRoaXMuX2ZvbnRTaXplRnJhY3Rpb247XG5cbiAgICBzd2l0Y2godGhpcy5saXN0U3R5bGVUeXBlKXtcbiAgICAgIGNhc2UgXCJkZWNpbWFsXCI6XG4gICAgICAgIGlmKCB0aGlzLl9wYXJhZ3JhcGhzW2xpbmVJbmRleF0pe1xuICAgICAgICAgIC8vIGxpZnQgdGhlIGxpbmUgYnkgcXVhcnRlciBvZiBmb250U2l6ZVxuICAgICAgICAgIHRoaXMuX3JlbmRlckNoYXJzKG1ldGhvZCwgY3R4LCB0aGlzLl9wYXJhZ3JhcGhzW2xpbmVJbmRleF0gLCBsZWZ0IC0gdGhpcy50ZXh0UGFkZGluZyAsIHRvcCAgLCBsaW5lSW5kZXgsIDApO1xuICAgICAgICB9XG4gICAgfVxuXG5cbiAgICAvLyBzaG9ydC1jaXJjdWl0XG4gICAgdmFyIGxpbmVXaWR0aCA9IHRoaXMuX2dldExpbmVXaWR0aChjdHgsIGxpbmVJbmRleCk7XG4gICAgaWYgKHRoaXMudGV4dEFsaWduICE9PSAnanVzdGlmeScgfHwgdGhpcy53aWR0aCA8IGxpbmVXaWR0aCkge1xuXG4gICAgICB0aGlzLl9yZW5kZXJDaGFycyhtZXRob2QsIGN0eCwgbGluZSwgbGVmdCwgdG9wLCBsaW5lSW5kZXgpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuXG4gICAgLy8gc3RyZXRjaCB0aGUgbGluZVxuICAgIHZhciB3b3JkcyA9IGxpbmUuc3BsaXQoL1xccysvKSxcbiAgICAgIGNoYXJPZmZzZXQgPSAwLFxuICAgICAgd29yZHNXaWR0aCA9IHRoaXMuX2dldFdpZHRoT2ZXb3JkcyhjdHgsIHdvcmRzLmpvaW4oJycpLCBsaW5lSW5kZXgsIDApLFxuICAgICAgd2lkdGhEaWZmID0gdGhpcy53aWR0aCAtIHdvcmRzV2lkdGggLSB0aGlzLnRleHRQYWRkaW5nLFxuICAgICAgbnVtU3BhY2VzID0gd29yZHMubGVuZ3RoIC0gMSxcbiAgICAgIHNwYWNlV2lkdGggPSBudW1TcGFjZXMgPiAwID8gd2lkdGhEaWZmIC8gbnVtU3BhY2VzIDogMCxcbiAgICAgIGxlZnRPZmZzZXQgPSAwLCB3b3JkO1xuXG4gICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHdvcmRzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICB3aGlsZSAobGluZVtjaGFyT2Zmc2V0XSA9PT0gJyAnICYmIGNoYXJPZmZzZXQgPCBsaW5lLmxlbmd0aCkge1xuICAgICAgICBjaGFyT2Zmc2V0Kys7XG4gICAgICB9XG4gICAgICB3b3JkID0gd29yZHNbaV07XG4gICAgICB0aGlzLl9yZW5kZXJDaGFycyhtZXRob2QsIGN0eCwgd29yZCwgbGVmdCArIGxlZnRPZmZzZXQsIHRvcCwgbGluZUluZGV4LCBjaGFyT2Zmc2V0KTtcbiAgICAgIGxlZnRPZmZzZXQgKz0gdGhpcy5fZ2V0V2lkdGhPZldvcmRzKGN0eCwgd29yZCwgbGluZUluZGV4LCBjaGFyT2Zmc2V0KSArIHNwYWNlV2lkdGg7XG4gICAgICBjaGFyT2Zmc2V0ICs9IHdvcmQubGVuZ3RoO1xuICAgIH1cbiAgfSxcbiAgdG9nZ2xlTGlzdFN0eWxlVHlwZTogZnVuY3Rpb24oKXtcbiAgICB0aGlzLnNldExpc3RTdHlsZVR5cGUodGhpcy5saXN0U3R5bGVUeXBlID09IFwibm9uZVwiID8gXCJkZWNpbWFsXCIgOiBcIm5vbmVcIik7XG4gICAgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gIH0sXG4gIGFjdGlvbnM6IHtcbiAgICB0b2dnbGVMaXN0U3R5bGVUeXBlOiB7XG4gICAgICBjbGFzc05hbWU6ICdmYSBmYS1saXN0LW9sJyxcbiAgICAgIHRpdGxlOiAnb3JkZXJlZCBsaXN0J1xuICAgIH1cbiAgfVxuXG59KVxuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9zaGFwZXMvdGV4dGJveC5saXN0LmpzXG4vLyBtb2R1bGUgaWQgPSA1M1xuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCJcbnZhciBwYXRoID0gcmVxdWlyZShcIi4vcGF0aFwiKTtcbnZhciB1dGlsID0gcmVxdWlyZShcIi4vdXRpbFwiKTtcbnZhciBvYmplY3QgPSByZXF1aXJlKFwiLi9vYmplY3RcIik7XG5cbmZ1bmN0aW9uIGlzU2VydmVyKCkge1xuICByZXR1cm4gISAodHlwZW9mIHdpbmRvdyAhPSAndW5kZWZpbmVkJyAmJiB3aW5kb3cuZG9jdW1lbnQpO1xufVxuXG5cbmlmIChpc1NlcnZlcigpKSB7XG4gIHZhciBmcyA9IHJlcXVpcmUoJ2ZzJyk7XG59XG5cblxuZnVuY3Rpb24gX2xvYWRfanNvbiAodmFsdWUsIGNhbGxiYWNrX3N1Y2Nlc3MsIGNhbGxiYWNrX2Vycm9yKXtcblxuICB2YXIgb3V0cHV0ID0gbnVsbDtcbiAgdmFyIGVycm9ycyA9IFtdO1xuXG4gIGlmICh2YWx1ZS5jb25zdHJ1Y3RvciA9PSBTdHJpbmcpIHtcblxuICAgIHZhciBmaWxlbmFtZSwgcmVnZXhfZGF0YSwgaW5pdF9wcm9wZXJ0eTtcbiAgICByZWdleF9kYXRhID0gL14oW14jXSopIz8oLiopJC8uZXhlYyh2YWx1ZSk7XG5cbiAgICBmaWxlbmFtZSA9IHJlZ2V4X2RhdGFbMV07XG4gICAgaW5pdF9wcm9wZXJ0eSA9IHJlZ2V4X2RhdGFbMl07XG4gICAgdXRpbHMuZ2V0SW5saW5lSnNvbihmaWxlbmFtZSwgXCJqc29uXCIsIF9sb2FkSnNvbl9kYXRhLCBmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgIGVycm9ycy5wdXNoKGVycm9yKTtcbiAgICAgIGlmIChjYWxsYmFja19lcnJvcikge1xuICAgICAgICBjYWxsYmFja19lcnJvcihlcnJvcilcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJmaWxlOiBcXFwiXCIgKyBmaWxlbmFtZSArIFwiXFxcIi4gXCIgKyBlcnJvci5tZXNzYWdlKVxuICAgICAgfVxuICAgIH0pO1xuICB9IGVsc2Uge1xuICAgIF9sb2FkSnNvbl9kYXRhKHZhbHVlKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9sb2FkSnNvbl9kYXRhKGRhdGEpIHtcbiAgICAvKlxuICAgICDQt9Cw0LzQtdC90LAg0LfQsNC/0LjRgdC10LkgXCJ1cmwoLi9wYXRoL3RvL2ZpbGUpICDQvdCwIFwiLi4vLi4vcGF0aC90by9maWxlXCJcbiAgICAgdXJsINC90LDRh9C40L3QsNGO0YnQuNC10YHRjyDRgSAuLyDQvtGC0L3QvtGB0LjRgtC10LvRjNC90L4g0YDQvtC00LjRgtC10LvRjNC60L7Qs9C+IGpzb24g0YTQsNC50LvQsFxuXG4gICAgIHVybCDRgSBcIi9cIiDQtNC+0LHQsNCy0LvRj9C10YLRgdGPIEFQUF9TVEFUSUNfUEFUSFxuICAgICAqL1xuICAgIHV0aWxzLnJlY291cnNpdmUoZGF0YSxcbiAgICAgIGZ1bmN0aW9uIChwcm9wZXJ0eSwgdmFsdWUsIHBhcmVudCkge1xuICAgICAgICBpZiAoL151cmxcXCguKlxcKSQvLnRlc3QodmFsdWUpKSB7XG4gICAgICAgICAgdmFyIHJlZ2V4X2RhdGEgPSAvXnVybFxcKChcXC4/XFwvKT8oLiopXFwpJC8uZXhlYyh2YWx1ZSk7XG4gICAgICAgICAgdmFyIHVybCA9IHJlZ2V4X2RhdGFbMl07XG5cbiAgICAgICAgICBpZiAocmVnZXhfZGF0YVsxXSA9PSBcIi9cIikge1xuICAgICAgICAgICAgdXJsID0gd2luZG93LkFQUF9TVEFUSUNfUEFUSCArIHVybDtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHJlZ2V4X2RhdGFbMV0gPT0gXCIuL1wiKSB7XG4gICAgICAgICAgICB1cmwgPSBwYXRoLmdldFBhcmVudERpcmVjdG9yeVVybChmaWxlbmFtZSkgKyB1cmw7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcGFyZW50W3Byb3BlcnR5XSA9IHBhdGgucmVzb2x2ZSh1cmwpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgKTtcblxuXG4gICAgdmFyIGxvYWRlciA9IHV0aWwucXVldWVMb2FkKDEsIGZ1bmN0aW9uIGZpbmFsaXplKCkge1xuXG4gICAgICBpZiAoaW5pdF9wcm9wZXJ0eSkge1xuICAgICAgICB2YXIgcHJvcF9hcnIgPSBpbml0X3Byb3BlcnR5LnNwbGl0KFwiL1wiKTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wX2Fyci5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIGRhdGEgPSBkYXRhW3Byb3BfYXJyW2ldXTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAoZXJyb3JzLmxlbmd0aCkge1xuICAgICAgICBpZiAoY2FsbGJhY2tfZXJyb3IpIGNhbGxiYWNrX2Vycm9yKGVycm9ycyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoY2FsbGJhY2tfc3VjY2VzcykgY2FsbGJhY2tfc3VjY2VzcyhkYXRhKTtcbiAgICAgICAgb3V0cHV0ID0gZGF0YTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8qKlxuICAgICAqIHJlbW92ZSBjb21tZW50c1xuICAgICAqL1xuICAgIHV0aWxzLnJlY291cnNpdmUoZGF0YSwgZnVuY3Rpb24gKHByb3BlcnR5LCB2YWx1ZSwgcGFyZW50KSB7XG4gICAgICAvKlxuICAgICAgIHJlbW92ZSBjb21tZW50cyBsaWtlXG4gICAgICAgW1wiQGNvbW1lbnQoKVwiXVxuICAgICAgIFwiQGNvbW1lbnRcIjoge31cbiAgICAgICAqL1xuICAgICAgaWYgKC9eXFwvXFwvLiokLy50ZXN0KHZhbHVlKSB8fCAvXkBjb21tZW50XFwoLipcXCkkLy50ZXN0KHZhbHVlKSB8fCBwcm9wZXJ0eSA9PSBcIkBjb21tZW50XCIpIHtcbiAgICAgICAgaWYgKHBhcmVudC5jb25zdHJ1Y3RvciA9PSBBcnJheSkge1xuICAgICAgICAgIHBhcmVudC5zcGxpY2UocHJvcGVydHksIDEpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGRlbGV0ZSBwYXJlbnRbcHJvcGVydHldO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKC9eQGV4dGVuZC4qJC8udGVzdChwcm9wZXJ0eSkpIHtcblxuICAgICAgICBsb2FkZXIudG90YWwrKztcbiAgICAgICAgX2xvYWRfanNvbih2YWx1ZSwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICB2YXIgZXh0X2RhdGEgPSBvYmplY3QuZGVlcEV4dGVuZChkYXRhLCBwYXJlbnQpO1xuICAgICAgICAgIG9iamVjdC5kZWVwRXh0ZW5kKHBhcmVudCwgZXh0X2RhdGEpO1xuICAgICAgICAgIGRlbGV0ZSBwYXJlbnRbXCJAZXh0ZW5kXCJdO1xuICAgICAgICAgIGxvYWRlcigpO1xuICAgICAgICB9LCBmdW5jdGlvbiAoZGF0YSwgZXJyb3IpIHtcbiAgICAgICAgICBlcnJvcnMucHVzaChlcnJvcik7XG4gICAgICAgICAgbG9hZGVyKCk7XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIGlmICgvXkBleHRlbmRcXCguKlxcKSQvLnRlc3QodmFsdWUpKSB7XG4gICAgICAgIHZhciBfcmVnX2RhdGEgPSAvXkBleHRlbmRcXCgoXFwuXFwvKT8oLiopXFwpJC8uZXhlYyh2YWx1ZSk7XG4gICAgICAgIHZhciB1cmwgPSBfcmVnX2RhdGFbMl07XG4gICAgICAgIGlmIChfcmVnX2RhdGFbMV0pIHtcbiAgICAgICAgICB1cmwgPSBwYXRoLmdldFBhcmVudERpcmVjdG9yeVVybChmaWxlbmFtZSkgKyB1cmw7XG4gICAgICAgIH1cbiAgICAgICAgbG9hZGVyLnRvdGFsKys7XG4gICAgICAgIF9sb2FkX2pzb24odXJsLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgIHBhcmVudFtwcm9wZXJ0eV0gPSBkYXRhO1xuICAgICAgICAgIGxvYWRlcigpO1xuICAgICAgICB9LCBmdW5jdGlvbiAoZGF0YSwgZXJyb3IpIHtcbiAgICAgICAgICBlcnJvcnMucHVzaChlcnJvcik7XG4gICAgICAgICAgbG9hZGVyKCk7XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIGlmICgvXkBtaXhpblxcKC4qXFwpJC8udGVzdCh2YWx1ZSkpIHtcbiAgICAgICAgdmFyIF9yZWdfZGF0YSA9IC9eQG1peGluXFwoKFxcLlxcLyk/KC4qKVxcKSQvLmV4ZWModmFsdWUpO1xuICAgICAgICB2YXIgdXJsID0gX3JlZ19kYXRhWzJdO1xuICAgICAgICBpZiAoX3JlZ19kYXRhWzFdKSB7XG4gICAgICAgICAgdXJsID0gcGF0aC5nZXRQYXJlbnREaXJlY3RvcnlVcmwoZmlsZW5hbWUpICsgdXJsO1xuICAgICAgICB9XG4gICAgICAgIGxvYWRlci50b3RhbCsrO1xuICAgICAgICBfbG9hZF9qc29uKHVybCwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICBpZiAocGFyZW50LmNvbnN0cnVjdG9yID09IEFycmF5KSB7XG4gICAgICAgICAgICBwYXJlbnQuc3BsaWNlKHByb3BlcnR5LCAxKTtcbiAgICAgICAgICAgIGZvciAodmFyIGkgaW4gZGF0YSkge1xuICAgICAgICAgICAgICBwYXJlbnQucHVzaChkYXRhW2ldKVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBkZWxldGUgcGFyZW50W3Byb3BlcnR5XTtcbiAgICAgICAgICAgIGZvciAodmFyIGkgaW4gZGF0YSkge1xuICAgICAgICAgICAgICBwYXJlbnRbaV0gPSBkYXRhW2ldO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBsb2FkZXIoKTtcbiAgICAgICAgfSwgZnVuY3Rpb24gKGRhdGEsIGVycm9yKSB7XG4gICAgICAgICAgZXJyb3JzLnB1c2goZXJyb3IpO1xuICAgICAgICAgIGxvYWRlcigpO1xuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSBpZiAoL15AbG9hZFxcKCguKilcXCkkLy50ZXN0KHZhbHVlKSkge1xuICAgICAgICB2YXIgX3JlZ19kYXRhID0gL15AbG9hZFxcKChcXC4/XFwvKT8oLiopXFwpJC8uZXhlYyh2YWx1ZSk7XG4gICAgICAgIHZhciB1cmwgPSBfcmVnX2RhdGFbMl07XG4gICAgICAgIGlmIChfcmVnX2RhdGFbMV0gPT0gXCIvXCIpIHtcbiAgICAgICAgICB1cmwgPSB3aW5kb3cuQVBQX1NUQVRJQ19QQVRIICsgdXJsO1xuICAgICAgICB9XG4gICAgICAgIGlmIChfcmVnX2RhdGFbMV0gPT0gXCIuL1wiKSB7XG4gICAgICAgICAgdXJsID0gcGF0aC5nZXRQYXJlbnREaXJlY3RvcnlVcmwoZmlsZW5hbWUpICsgdXJsO1xuICAgICAgICB9XG5cbiAgICAgICAgbG9hZGVyLnRvdGFsKys7XG4gICAgICAgIHV0aWxzLmdldElubGluZUpzb24odXJsLCBcImh0bWxcIiwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICBwYXJlbnRbcHJvcGVydHldID0gZGF0YTtcbiAgICAgICAgICBsb2FkZXIoKTtcbiAgICAgICAgfSwgZnVuY3Rpb24gKGRhdGEsIGVycm9yKSB7XG4gICAgICAgICAgZXJyb3JzLnB1c2goZXJyb3IpO1xuICAgICAgICAgIGxvYWRlcigpO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgIH0pO1xuICAgIGxvYWRlcigpO1xuXG4gIH1cblxuICByZXR1cm4gb3V0cHV0O1xufVxuXG52YXIgdXRpbHMgPSB7XG4gIENBQ0hFRF9KU09OIDoge30sXG4gIGxvYWRKc29uU3luYzogZnVuY3Rpb24oc3JjKXtcbiAgICB2YXIgZGF0YTtcbiAgICBfbG9hZF9qc29uKHNyYyxmdW5jdGlvbihfZGF0YSl7XG4gICAgICBkYXRhID0gX2RhdGE7XG4gICAgfSk7XG4gICAgcmV0dXJuIGRhdGE7XG4gIH0sXG5cbiAgLyoqXG4gICDQv9C+0LfQstC+0LvRj9C10YIg0LjRgdC/0L7Qu9GM0LfQvtCy0LDRgtGMINC60L7QvdGB0YLRgNGD0LrRhtC40Lgg0LLQuNC00LBcbiAgINGA0LDRgdGI0LjRgNC40YLRjCDQtNCw0L3QvdGL0LUg0LjQtyDRhNCw0LnQu9CwIHRlbXBsYXRlLmpzb25cbiAgIFwiQGV4dGVuZFwiIDogXCJ1cmwoZGF0YS90ZW1wbGF0ZS5qc29uKVwiLFxuICAgXCJAZXh0ZW5kXCIgOiBcInVybChkYXRhL3RlbXBsYXRlLmpzb24jc2V0dGluZ3Mvc3RhZ2VzKVwiLFxuXG4gICAvL9C30LDQvNC10L3QuNGC0Ywg0YHRgtGA0L7QutGDINC90LDQtNCw0L3QvdGL0LUg0LjQtyDRhNCw0LnQu9CwXG4gICBcInN0YWdlc1wiOiAgICAgICBcInVybChkYXRhL3RlbXBsYXRlLmpzb24jc2V0dGluZ3Mvc3RhZ2VzKVwiLFxuXG4gICAqIEBwYXJhbSBmaWxlbmFtZVxuICAgKiBAcGFyYW0gY2FsbGJhY2tfc3VjY2Vzc1xuICAgKiBAcGFyYW0gY2FsbGJhY2tfZXJyb3JcbiAgICovXG4gIGxvYWRKc29uOiBmdW5jdGlvbiAodmFsdWUscmVzb2x2ZV9jYixmYWlsX2NiKSB7XG4gICAgICByZXR1cm4gX2xvYWRfanNvbih2YWx1ZSxmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgcmVzb2x2ZV9jYiAmJiByZXNvbHZlX2NiKGRhdGEpO1xuICAgICAgfSxmdW5jdGlvbihlcnIpe1xuICAgICAgICBmYWlsX2NiICYmIGZhaWxfY2IoZXJyKTtcbiAgICAgIH0pO1xuICB9LFxuXG4gIHJlbW92ZUNvbW1lbnRzOiBmdW5jdGlvbiAoc3RyKSB7XG4gICAgc3RyID0gc3RyLnJlcGxhY2UoL15cXHMqKFxcL1xcLy4qfCg/OlxcL1xcKltcXHNcXFNdKj8pXFwqXFwvXFxzKikkL2dtLFwiXCIpO1xuICAgIHJldHVybiBzdHI7XG4gIH0sXG4gIC8qKlxuICAgKlxuICAgKiBAcGFyYW0gb2JqZWN0XG4gICAqIEBwYXJhbSBjcml0ZXJpYSAtINCy0YvQv9C+0LvQvdGP0YLRjCDRhNGD0L3QutGG0LjRjiDRgdC+INCy0YHQtdC80Lgg0L7QsdGK0LXQutGC0LDQvNC4XG4gICAqL1xuICByZWNvdXJzaXZlOiBmdW5jdGlvbiAob2JqZWN0LCBjcml0ZXJpYSkge1xuICAgIHZhciByZWFkZWQgPSBbXTtcbiAgICBpZiAoIW9iamVjdCkgcmV0dXJuO1xuICAgIHJldHVybiAoZnVuY3Rpb24gc3ViX3JlY291cnNpdmUob2JqZWN0KSB7XG4gICAgICBpZiAocmVhZGVkLmluZGV4T2Yob2JqZWN0KSAhPSAtMSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICByZWFkZWQucHVzaChvYmplY3QpO1xuXG5cbiAgICAgIGlmIChvYmplY3QgaW5zdGFuY2VvZiBBcnJheSkge1xuICAgICAgICBmb3IgKHZhciBwcm9wID0gb2JqZWN0Lmxlbmd0aDsgcHJvcC0tOykge1xuICAgICAgICAgIGlmIChvYmplY3RbcHJvcF0gJiYgKG9iamVjdFtwcm9wXS5jb25zdHJ1Y3RvciA9PSBPYmplY3QgfHwgb2JqZWN0W3Byb3BdLmNvbnN0cnVjdG9yID09IEFycmF5KSkge1xuICAgICAgICAgICAgc3ViX3JlY291cnNpdmUob2JqZWN0W3Byb3BdKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmFyIGJyZWFrXyA9IGNyaXRlcmlhKHByb3AsIG9iamVjdFtwcm9wXSwgb2JqZWN0KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGZvciAodmFyIHByb3AgaW4gb2JqZWN0KSB7XG4gICAgICAgICAgaWYgKG9iamVjdFtwcm9wXSAmJiAob2JqZWN0W3Byb3BdLmNvbnN0cnVjdG9yID09IE9iamVjdCB8fCBvYmplY3RbcHJvcF0uY29uc3RydWN0b3IgPT0gQXJyYXkpKSB7XG4gICAgICAgICAgICBzdWJfcmVjb3Vyc2l2ZShvYmplY3RbcHJvcF0pO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB2YXIgYnJlYWtfID0gY3JpdGVyaWEocHJvcCwgb2JqZWN0W3Byb3BdLCBvYmplY3QpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pKG9iamVjdCk7XG4gIH0sXG5cbiAgcGFyc2VDU1Y6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgdmFyIHJvd3MgPSBkYXRhLnNwbGl0KC9cXG4vKTtcbiAgICB2YXIgY29sdW1ucyA9IHJvd3NbMF0uc3BsaXQoJywnKTtcbiAgICByb3dzLnNwbGljZSgwLCAxKTtcblxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcm93cy5sZW5ndGg7IGkrKykge1xuICAgICAgdmFyIG91dHB1dF9yb3dfZGF0YSA9IHt9O1xuICAgICAgdmFyIHJvd19kYXRhID0gW107XG5cblxuICAgICAgdmFyIF9xdW90ZSA9IGZhbHNlLCBsYXN0ID0gLTE7XG4gICAgICB2YXIgaiA9IC0xO1xuICAgICAgdmFyIHN0ciA9IHJvd3NbaV07XG4gICAgICB3aGlsZSAoKytqIDwgc3RyLmxlbmd0aCkge1xuICAgICAgICBpZiAoIV9xdW90ZSkge1xuICAgICAgICAgIGlmIChzdHJbal0gPT0gJ1xcJycgfHwgc3RyW2pdID09ICdcXFwiJykge1xuICAgICAgICAgICAgX3F1b3RlID0gc3RyW2pdO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoc3RyW2pdID09IFwiLFwiKSB7XG4gICAgICAgICAgICB2YXIgX3ZhbCA9IHN0ci5zdWJzdHJpbmcobGFzdCwgaik7XG4gICAgICAgICAgICBpZiAoX3ZhbFswXSA9PSAnXFxcIicgJiYgX3ZhbFtfdmFsLmxlbmd0aCAtIDFdID09ICdcXFwiJykge1xuICAgICAgICAgICAgICBfdmFsID0gX3ZhbC5zdWJzdHJpbmcoMSwgX3ZhbC5sZW5ndGggLSAxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJvd19kYXRhLnB1c2goX3ZhbCk7XG4gICAgICAgICAgICBsYXN0ID0gaiArIDE7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmIChzdHJbal0gPT0gX3F1b3RlKSB7XG4gICAgICAgICAgICBfcXVvdGUgPSBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgZm9yICh2YXIgaiBpbiByb3dfZGF0YSkge1xuICAgICAgICBvdXRwdXRfcm93X2RhdGFbY29sdW1uc1tqXV0gPSByb3dfZGF0YVtqXTtcbiAgICAgIH1cbiAgICAgIHJvd3NbaV0gPSBvdXRwdXRfcm93X2RhdGE7XG4gICAgfVxuICAgIHJldHVybiByb3dzO1xuICB9LFxuICBwYXJzZURhdGE6IGZ1bmN0aW9uIChkYXRhLCBkYXRhVHlwZSkge1xuICAgIHZhciBfcGFyc2VkO1xuICAgIGlmIChkYXRhVHlwZSA9PSBcImNzdlwiKSB7XG4gICAgICBfcGFyc2VkID0gdXRpbHMucGFyc2VDU1YoZGF0YSk7XG4gICAgfSBlbHNlIGlmIChkYXRhVHlwZSA9PSBcImpzb25cIikge1xuICAgICAgX3BhcnNlZCA9IGRhdGEudHJpbSgpO1xuICAgICAgLy9pZiAoZGF0YVswXSAhPSBcIntcIiAmJiBkYXRhWzBdICE9IFwiW1wiKSB7XG4gICAgICAvLyAgcmV0dXJuIGZhbHNlO1xuICAgICAgLy99XG5cbiAgICAgIF9wYXJzZWQgPSB1dGlscy5yZW1vdmVDb21tZW50cyhfcGFyc2VkKTtcbiAgICAgIC8vZGF0YSAgPSBkYXRhLnJlcGxhY2UoL1xcbi9nLFwiXCIpXG5cbiAgICAgIHRyeXtcbiAgICAgICAgdmFyIF9wYXJzZWQgPSBKU09OLnBhcnNlKF9wYXJzZWQpOy8vPSBKU09OLnBhcnNlKGRhdGEucmVwbGFjZSgvXFwvXFwqW1xcc1xcU10qP1xcKlxcL3xcXC9cXC8uKi9nLFwiXCIpKTtcbiAgICAgIH1jYXRjaChlKXtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBzdGF0dXM6IFwiZXJyb3JcIixcbiAgICAgICAgICBtZXNzYWdlOiBlLnRvU3RyaW5nKCksXG4gICAgICAgICAgZGF0YTogIGRhdGFcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIC8vdmFyIHNjcmlwdCA9ICQoXCI8c2NyaXB0IHR5cGU9J3RleHQvanNvbicgaWQ9J1wiICsgdXJsICsgXCInPlwiICsgSlNPTi5zdHJpbmdpZnkoZGF0YSkgKyBcIjwvc2NyaXB0PlwiKTtcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgIHN0YXR1czogXCJzdWNjZXNzXCIsXG4gICAgICBkYXRhOiBfcGFyc2VkXG4gICAgfTtcbiAgfSxcbiAgbG9hZDogZnVuY3Rpb24gKHVybCwgZGF0YVR5cGUsIGNhbGxiYWNrX3N1Y2Nlc3MsIGNhbGxiYWNrX2Vycm9yKSB7XG4gICAgLy90b2RvXG4gICAgaWYgKGlzU2VydmVyKCkpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHZhciBkYXRhID0gZnMucmVhZEZpbGVTeW5jKHVybCwgJ3V0ZjgnKTtcbiAgICAgICAgZGF0YSA9IGRhdGEucmVwbGFjZSgvXlxcdUZFRkYvLCAnJyk7XG4gICAgICAgIHZhciBfcGFyc2VkID0gdXRpbHMucGFyc2VEYXRhKGRhdGEsIGRhdGFUeXBlKTtcbiAgICAgICAgaWYoX3BhcnNlZC5zdGF0dXMgPT0gXCJlcnJvclwiKXtcbiAgICAgICAgICBjYWxsYmFja19lcnJvcih7XG4gICAgICAgICAgICBzdGF0dXM6ICAgXCJlcnJvclwiLFxuICAgICAgICAgICAgbWVzc2FnZTogIF9wYXJzZWQubWVzc2FnZSxcbiAgICAgICAgICAgIGRhdGE6ICAgICBfcGFyc2VkLmRhdGFcbiAgICAgICAgICB9KTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY2FsbGJhY2tfc3VjY2VzcyhfcGFyc2VkLmRhdGEpO1xuICAgICAgfSBjYXRjaCAoZSkge1xuXG4gICAgICAgIGlmIChlLmNvZGUgPT09ICdFTk9FTlQnKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ0ZpbGUgbm90IGZvdW5kIScpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRocm93IGU7XG4gICAgICAgIH1cbiAgICAgICAgY2FsbGJhY2tfZXJyb3IoZGF0YSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcblxuICAgICAgdmFyIGh0dHBSZXF1ZXN0ID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG5cbiAgICAgIGh0dHBSZXF1ZXN0Lm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGh0dHBSZXF1ZXN0LnJlYWR5U3RhdGUgPT09IDQpIHtcbiAgICAgICAgICBpZiAoaHR0cFJlcXVlc3Quc3RhdHVzID09PSAyMDApIHtcbiAgICAgICAgICAgIHZhciBkYXRhID0gaHR0cFJlcXVlc3QucmVzcG9uc2VUZXh0O1xuICAgICAgICAgICAgdmFyIF9wYXJzZWQgPSB1dGlscy5wYXJzZURhdGEoZGF0YSwgZGF0YVR5cGUpO1xuICAgICAgICAgICAgaWYoX3BhcnNlZC5zdGF0dXMgPT0gXCJlcnJvclwiKXtcbiAgICAgICAgICAgICAgY2FsbGJhY2tfZXJyb3Ioe1xuICAgICAgICAgICAgICAgIHN0YXR1czogaHR0cFJlcXVlc3Quc3RhdHVzLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICBfcGFyc2VkLm1lc3NhZ2UsXG4gICAgICAgICAgICAgICAgcmVzcG9uc2U6IGh0dHBSZXF1ZXN0LnJlc3BvbnNlVGV4dFxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FsbGJhY2tfc3VjY2VzcyhfcGFyc2VkLmRhdGEpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjYWxsYmFja19lcnJvcih1cmwsIGh0dHBSZXF1ZXN0KVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIGh0dHBSZXF1ZXN0Lm9wZW4oJ0dFVCcsIHVybCk7XG4gICAgICBodHRwUmVxdWVzdC5zZW5kKCk7XG4gICAgfVxuICB9LFxuICAvKipcbiAgICog0J/QvtC30LLQvtC70Y/QtdGC0LfQsNCz0YDRg9C20LDRgtGMIGpzb24g0YTQsNC50LvRiyAsINGB0L7QtNC10YDQttCw0YnQuNC1INGB0YHRi9C70LrQuCDQvdCwINC00YDRg9Cz0LjQtSBqc29uINGE0LDQudC70YsuXG4gICAqINCy0LzQtdGB0YLQviDRgdGB0YvQu9C+0Log0YLQuNC/0LBcbiAgICogIFwicHJvcGVydHlcIiA6IFwidXJsKGNodW5rLmpzb24pXCJcbiAgICogINCx0YPQtNC10YIg0LfQsNCz0YDRg9C20LXQvdC+INGB0L7QtNC10YDQttC40LzQvtC1INGE0LDQudC70LBcbiAgICogIFwicHJvcGVydHlcIiA6IHsuLi59XG4gICAqXG4gICAqICDQtdGB0LvQuCDRg9C60LDQt9Cw0YLRjCDRj9C60L7RgNGMXG4gICAqICBcInByb3BlcnR5XCIgOiBcInVybChjaHVuay5qc29uI3NldHRpbmdzL2NodW5rLzAvdGV4dClcIlxuICAgKlxuICAgKiDRgtC+INCx0YPQtNC10YIg0LfQsNCz0YDRg9C20LXQvdC+INGB0L7QtNC10YDQttC40LzQvtC1INC/0L7Qu9GPIHNldHRpbmdzLmNodW5rWzBdLnRleHQg0LjQtyDRhNCw0LnQu9CwIGNodW5rLmpzb25cbiAgICpcbiAgICpcbiAgICogQHBhcmFtIGZpbGVuYW1lICDQv9GD0YLRjCDQuiDQvtGB0L3QvtCy0L3QvtC80YMganNvbiDRhNCw0LnQu9GDXG4gICAqIEBwYXJhbSBjYWxsYmFjayAg0LHRg9C00LXRgiDQstGL0LfQstCw0L0g0L/QvtGB0LvQtSDQvtC60L7QvdGH0LDQvdC40Y8g0LfQsNCz0YDRg9C30LrQuCDQstGB0LXRhSDRhNCw0LnQu9C+0LJcbiAgICovXG4gIGdldElubGluZUpzb246IGZ1bmN0aW9uICh1cmwsIGRhdGFUeXBlLCBjYWxsYmFja19zdWNjZXNzLCBjYWxsYmFja19lcnJvcikge1xuXG4gICAgaWYgKGRhdGFUeXBlLmNvbnN0cnVjdG9yICE9IFN0cmluZykge1xuICAgICAgY2FsbGJhY2tfZXJyb3IgPSBjYWxsYmFja19zdWNjZXNzO1xuICAgICAgY2FsbGJhY2tfc3VjY2VzcyA9IGRhdGFUeXBlO1xuICAgICAgZGF0YVR5cGUgPSBcImpzb25cIjtcbiAgICB9XG5cblxuICAgIGlmICh0eXBlb2YgdXRpbHMuQ0FDSEVEX0pTT04gIT09IFwidW5kZWZpbmVkXCIgJiYgdXRpbHMuQ0FDSEVEX0pTT04gJiYgdXRpbHMuQ0FDSEVEX0pTT05bdXJsXSkge1xuICAgICAgY2FsbGJhY2tfc3VjY2Vzcyh1dGlscy5DQUNIRURfSlNPTlt1cmxdKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiAkICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICBpZiAodHlwZW9mIGRvY3VtZW50ICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgIHZhciBpbmxpbmUgPSAkKFwic2NyaXB0W2lkPSdcIiArIHVybCArIFwiJ11cIik7XG4gICAgICAgIGlmIChpbmxpbmUubGVuZ3RoID4gMCkge1xuICAgICAgICAgIHZhciBfZGF0YSA9XG4gICAgICAgICAgICBpbmxpbmVbMF0uaW5uZXJUZXh0IHx8IC8vYWxsXG4gICAgICAgICAgICBpbmxpbmVbMF0udGV4dENvbnRlbnQgfHwgLy9maXJlZm94XG4gICAgICAgICAgICBpbmxpbmVbMF0udGV4dDsgLy9pZThcbiAgICAgICAgICBpZiAoZGF0YVR5cGUgPT0gXCJqc29uXCIpIHtcblxuICAgICAgICAgICAgdmFyIF9kYXRhID0gdXRpbHMucmVtb3ZlQ29tbWVudHMoX2RhdGEpO1xuICAgICAgICAgICAgY2FsbGJhY2tfc3VjY2VzcyhKU09OLnBhcnNlKF9kYXRhKSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNhbGxiYWNrX3N1Y2Nlc3MoX2RhdGEpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgdXRpbHMubG9hZCh1cmwsIGRhdGFUeXBlLCBjYWxsYmFja19zdWNjZXNzLCBjYWxsYmFja19lcnJvcik7XG4gIH1cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gdXRpbHM7XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL3V0aWwvZGF0YS5qc1xuLy8gbW9kdWxlIGlkID0gNTRcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiXG5cbm1vZHVsZS5leHBvcnRzID0ge1xuXG4gIGxvYWRTY3JpcHQ6IGZ1bmN0aW9uIChyZXF1aXJlbWVudCwgaGVscGVyLCBlcnJvcikge1xuICAgIHZhciBoZWFkID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2hlYWQnKVswXTtcbiAgICB2YXIgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7XG4gICAgc2NyaXB0LnR5cGUgPSAndGV4dC9qYXZhc2NyaXB0JztcbiAgICBzY3JpcHQub25lcnJvciA9IGVycm9yO1xuICAgIHNjcmlwdC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAodGhpcy5yZWFkeVN0YXRlID09ICdjb21wbGV0ZScpIHtcbiAgICAgICAgaGVscGVyKHNjcmlwdCwgX19zcmMpO1xuICAgICAgfVxuICAgIH07XG4gICAgc2NyaXB0LmFkZEV2ZW50TGlzdGVuZXIoXCJsb2FkXCIsIGhlbHBlciwgdHJ1ZSk7XG4gICAgc2NyaXB0LnNyYyA9IHJlcXVpcmVtZW50O1xuICAgIGhlYWQuYXBwZW5kQ2hpbGQoc2NyaXB0KTtcbiAgfSxcbiAgc2NyaXB0VVJMOiBmdW5jdGlvbiAoKSB7XG5cbiAgICBpZiAoZG9jdW1lbnQuY3VycmVudFNjcmlwdCkge1xuICAgICAgcmV0dXJuIGRvY3VtZW50LmN1cnJlbnRTY3JpcHQuc3JjO1xuICAgIH1cbiAgICB2YXIgc2NyaXB0cyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdzY3JpcHQnKTtcbiAgICBmb3IgKHZhciBpID0gc2NyaXB0cy5sZW5ndGggLSAxOyBpLS07KSB7XG4gICAgICBpZiAoc2NyaXB0c1tpXS5zcmMpIHtcbiAgICAgICAgcmV0dXJuIHNjcmlwdHNbaV0uc3JjO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn07XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL3V0aWwvbG9hZGVyLmpzXG4vLyBtb2R1bGUgaWQgPSA1NVxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCJcbnZhciBkZWVwRGlmZk1hcHBlciA9IHtcbiAgVkFMVUVfQ1JFQVRFRDogJ2NyZWF0ZWQnLFxuICBWQUxVRV9VUERBVEVEOiAndXBkYXRlZCcsXG4gIFZBTFVFX0RFTEVURUQ6ICdkZWxldGVkJyxcbiAgVkFMVUVfVU5DSEFOR0VEOiAndW5jaGFuZ2VkJyxcbiAgbWFwOiBmdW5jdGlvbihvYmoxLCBvYmoyKSB7XG4gICAgaWYgKHRoaXMuaXNGdW5jdGlvbihvYmoxKSB8fCB0aGlzLmlzRnVuY3Rpb24ob2JqMikpIHtcbiAgICAgIHRocm93ICdJbnZhbGlkIGFyZ3VtZW50LiBGdW5jdGlvbiBnaXZlbiwgb2JqZWN0IGV4cGVjdGVkLic7XG4gICAgfVxuICAgIGlmICh0aGlzLmlzVmFsdWUob2JqMSkgfHwgdGhpcy5pc1ZhbHVlKG9iajIpKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICAnX21hcF90eXBlJzogdGhpcy5jb21wYXJlVmFsdWVzKG9iajEsIG9iajIpLFxuICAgICAgICAnX21hcF9kYXRhJzogKG9iajIgPT09IHVuZGVmaW5lZCkgPyBvYmoxIDogb2JqMlxuICAgICAgfTtcbiAgICB9XG5cblxuICAgIGlmKF8uaXNBcnJheShvYmoyKSl7XG4gICAgICB2YXIgX2FycmF5ID0gdHJ1ZTtcbiAgICAgIHZhciBkaWZmID0gW107XG4gICAgfWVsc2V7XG4gICAgICB2YXIgZGlmZiA9IHt9O1xuICAgIH1cblxuXG4gICAgZm9yICh2YXIga2V5IGluIG9iajEpIHtcbiAgICAgIGlmICh0aGlzLmlzRnVuY3Rpb24ob2JqMVtrZXldKSkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cblxuICAgICAgdmFyIHZhbHVlMiA9IHVuZGVmaW5lZDtcbiAgICAgIGlmICgndW5kZWZpbmVkJyAhPSB0eXBlb2Yob2JqMltrZXldKSkge1xuICAgICAgICB2YWx1ZTIgPSBvYmoyW2tleV07XG4gICAgICB9XG5cbiAgICAgIGRpZmZba2V5XSA9IHRoaXMubWFwKG9iajFba2V5XSwgdmFsdWUyKTtcbiAgICB9XG4gICAgZm9yICh2YXIga2V5IGluIG9iajIpIHtcbiAgICAgIGlmICh0aGlzLmlzRnVuY3Rpb24ob2JqMltrZXldKSB8fCAoJ3VuZGVmaW5lZCcgIT0gdHlwZW9mKGRpZmZba2V5XSkpKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuXG4gICAgICB2YXIgX3ZhbCA9IHRoaXMubWFwKHVuZGVmaW5lZCwgb2JqMltrZXldKTtcbiAgICAgIGlmKF9hcnJheSl7XG4gICAgICAgIGRpZmYucHVzaChfdmFsKTtcbiAgICAgIH1lbHNle1xuICAgICAgICBkaWZmW2tleV0gPSBfdmFsXG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgICdfbWFwX3R5cGUnOiAnJyxcbiAgICAgICdfbWFwX2RhdGEnOiBkaWZmXG4gICAgfTtcblxuICB9LFxuICBjb21wYXJlVmFsdWVzOiBmdW5jdGlvbih2YWx1ZTEsIHZhbHVlMikge1xuICAgIGlmICh2YWx1ZTEgPT09IHZhbHVlMikge1xuICAgICAgcmV0dXJuIHRoaXMuVkFMVUVfVU5DSEFOR0VEO1xuICAgIH1cbiAgICBpZiAoJ3VuZGVmaW5lZCcgPT0gdHlwZW9mKHZhbHVlMSkpIHtcbiAgICAgIHJldHVybiB0aGlzLlZBTFVFX0NSRUFURUQ7XG4gICAgfVxuICAgIGlmICgndW5kZWZpbmVkJyA9PSB0eXBlb2YodmFsdWUyKSkge1xuICAgICAgcmV0dXJuIHRoaXMuVkFMVUVfREVMRVRFRDtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5WQUxVRV9VUERBVEVEO1xuICB9LFxuICBpc0Z1bmN0aW9uOiBmdW5jdGlvbihvYmopIHtcbiAgICByZXR1cm4ge30udG9TdHJpbmcuYXBwbHkob2JqKSA9PT0gJ1tvYmplY3QgRnVuY3Rpb25dJztcbiAgfSxcbiAgaXNBcnJheTogZnVuY3Rpb24ob2JqKSB7XG4gICAgcmV0dXJuIHt9LnRvU3RyaW5nLmFwcGx5KG9iaikgPT09ICdbb2JqZWN0IEFycmF5XSc7XG4gIH0sXG4gIGlzT2JqZWN0OiBmdW5jdGlvbihvYmopIHtcbiAgICByZXR1cm4ge30udG9TdHJpbmcuYXBwbHkob2JqKSA9PT0gJ1tvYmplY3QgT2JqZWN0XSc7XG4gIH0sXG4gIGlzVmFsdWU6IGZ1bmN0aW9uKG9iaikge1xuICAgIHJldHVybiAhdGhpcy5pc09iamVjdChvYmopICYmICF0aGlzLmlzQXJyYXkob2JqKTtcbiAgfVxufTtcblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gIGRpZmZlcmVuY2VNYXA6IGRlZXBEaWZmTWFwcGVyLm1hcC5iaW5kKGRlZXBEaWZmTWFwcGVyKSxcbiAgc3ludGF4SGlnaGxpZ2h0OiBmdW5jdGlvbiAoanNvbikge1xuICAgIGlmICh0eXBlb2YganNvbiAhPSAnc3RyaW5nJykge1xuICAgICAganNvbiA9IEpTT04uc3RyaW5naWZ5KGpzb24sIG51bGwsIDIpO1xuICAgIH1cbiAgICBqc29uID0ganNvbi5yZXBsYWNlKC8mL2csICcmYW1wOycpLnJlcGxhY2UoLzwvZywgJyZsdDsnKS5yZXBsYWNlKC8+L2csICcmZ3Q7Jyk7XG5cbiAgICBqc29uID0ganNvbi5yZXBsYWNlKC8oXCIoXFxcXHVbYS16QS1aMC05XXs0fXxcXFxcW151XXxbXlxcXFxcIl0pKlwiKFxccyo6KT98XFxiKHRydWV8ZmFsc2V8bnVsbClcXGJ8LT9cXGQrKD86XFwuXFxkKik/KD86W2VFXVsrXFwtXT9cXGQrKT8pL2csIGZ1bmN0aW9uIChtYXRjaCkge1xuICAgICAgdmFyIGNscyA9ICdudW1iZXInO1xuICAgICAgaWYgKC9eXCIvLnRlc3QobWF0Y2gpKSB7XG4gICAgICAgIGlmICgvOiQvLnRlc3QobWF0Y2gpKSB7XG4gICAgICAgICAgY2xzID0gJ2tleSc7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY2xzID0gJ3N0cmluZyc7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAoL3RydWV8ZmFsc2UvLnRlc3QobWF0Y2gpKSB7XG4gICAgICAgIGNscyA9ICdib29sZWFuJztcbiAgICAgIH0gZWxzZSBpZiAoL251bGwvLnRlc3QobWF0Y2gpKSB7XG4gICAgICAgIGNscyA9ICdudWxsJztcbiAgICAgIH1cbiAgICAgIHJldHVybiAnPHNwYW4gY2xhc3M9XCInICsgY2xzICsgJ1wiPicgKyBtYXRjaCArICc8L3NwYW4+JztcbiAgICB9KTtcbiAgICByZXR1cm4ganNvbiA9IGpzb24ucmVwbGFjZSgvW14sXFxuXVteXFxuXSovZywgZnVuY3Rpb24gKG1hdGNoKSB7XG4gICAgICByZXR1cm4gJzxzcGFuPicgKyBtYXRjaCArICc8L3NwYW4+JztcbiAgICB9KTtcbiAgfSxcbiAgZGlmZmVyZW5jZUhpZ2hsaWdodDogZnVuY3Rpb24gIChqc29uLG91dHB1dCl7XG5cbiAgICBpZihvdXRwdXQpe1xuICAgICAgb3V0cHV0LmVtcHR5KCk7XG4gICAgfWVsc2V7XG4gICAgICBvdXRwdXQgPSAkKFwiPHByZT5cIik7XG4gICAgfVxuXG5cbiAgICBmdW5jdGlvbiBwcmludE9iamVjdChqc29uLGxldmVsLG91dHB1dCxjb21tYSxvYmplY3RJbmRleCl7XG4gICAgICB2YXIgX2VsID0gJChcIjxwPlwiKTtcblxuICAgICAgX2VsLmFwcGVuZCgkKFwiPHNwYW4+XCIpLmFkZENsYXNzKFwib2JqZWN0LWtleVwiKS5hcHBlbmQoXG4gICAgICAgICQoXCI8c3Bhbj5cIikudGV4dChuZXcgQXJyYXkobGV2ZWwpLmpvaW4oJyAnKSApXG4gICAgICApKTtcbiAgICAgIGlmKG9iamVjdEluZGV4KXtcbiAgICAgICAgX2VsLmFwcGVuZChcbiAgICAgICAgICAkKFwiPHNwYW4+XCIpLnRleHQoJ1wiJykuYWRkQ2xhc3MoXCJpbnZpc2libGVcIiksXG4gICAgICAgICAgJChcIjxzcGFuPlwiKS5hZGRDbGFzcyhcImtleVwiKS50ZXh0KG9iamVjdEluZGV4KSxcbiAgICAgICAgICAkKFwiPHNwYW4+XCIpLnRleHQoJ1wiJykuYWRkQ2xhc3MoXCJpbnZpc2libGVcIiksXG4gICAgICAgICAgJChcIjxzcGFuPlwiKS50ZXh0KCc6ICcpXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIGlmKGpzb24gJiYganNvbi5fbWFwX3R5cGUgIT09IHVuZGVmaW5lZCl7XG4gICAgICAgIF9lbC5hZGRDbGFzcyhqc29uLl9tYXBfdHlwZSk7XG5cbiAgICAgICAgaWYoXy5pc0FycmF5KGpzb24uX21hcF9kYXRhKSl7XG4gICAgICAgICAgX2VsLmFwcGVuZCgkKFwiPHNwYW4+XCIpLnRleHQoXCJbXCIpKTtcbiAgICAgICAgICB2YXIgX2xhc3Rfa2V5ID0ganNvbi5fbWFwX2RhdGEubGVuZ3RoIC0gMTtcbiAgICAgICAgICBmb3IodmFyIGkgaW4ganNvbi5fbWFwX2RhdGEpe1xuICAgICAgICAgICAgcHJpbnRPYmplY3QoanNvbi5fbWFwX2RhdGFbaV0sbGV2ZWwgKyAxLF9lbCxpICE9IF9sYXN0X2tleSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIF9lbC5hcHBlbmQoJChcIjxwPlwiKS50ZXh0KG5ldyBBcnJheShsZXZlbCApLmpvaW4oJyAnKSArIFwiXVwiICsgKGNvbW1hID8gXCIsXCIgOiBcIlwiKSkpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYoXy5pc09iamVjdChqc29uLl9tYXBfZGF0YSkpe1xuICAgICAgICAgIF9lbC5hcHBlbmQoJChcIjxzcGFuPlwiKS50ZXh0KFwie1wiKSk7XG4gICAgICAgICAgdmFyIF9sYXN0X2tleSA9IE9iamVjdC5rZXlzKGpzb24uX21hcF9kYXRhKS5wb3AoKTtcbiAgICAgICAgICBmb3IodmFyIGkgaW4ganNvbi5fbWFwX2RhdGEpe1xuICAgICAgICAgICAgcHJpbnRPYmplY3QoanNvbi5fbWFwX2RhdGFbaV0sbGV2ZWwgKyAxLF9lbCxpICE9IF9sYXN0X2tleSxpKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgX2VsLmFwcGVuZCgkKFwiPHA+XCIpLnRleHQobmV3IEFycmF5KGxldmVsICkuam9pbignICcpICsgXCJ9XCIgKyAoY29tbWEgPyBcIixcIiA6IFwiXCIpKSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZXtcblxuICAgICAgICAgIGlmKF8uaXNOdWxsKGpzb24uX21hcF9kYXRhKSl7XG4gICAgICAgICAgICBfZWwuYXBwZW5kKFxuICAgICAgICAgICAgICAkKFwiPHNwYW4+XCIpLnRleHQoSlNPTi5zdHJpbmdpZnkoanNvbi5fbWFwX2RhdGEsIG51bGwsIDIpKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSBpZihqc29uLl9tYXBfZGF0YS5jb25zdHJ1Y3RvciA9PT0gU3RyaW5nICl7XG4gICAgICAgICAgICBfZWwuYXBwZW5kKFxuICAgICAgICAgICAgICAkKFwiPHNwYW4+XCIpLnRleHQoJ1wiJyksXG4gICAgICAgICAgICAgICQoXCI8c3Bhbj5cIikuYWRkQ2xhc3MoJ3N0cmluZycpLnRleHQoanNvbi5fbWFwX2RhdGEpLFxuICAgICAgICAgICAgICAkKFwiPHNwYW4+XCIpLnRleHQoJ1wiJylcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2UgaWYoanNvbi5fbWFwX2RhdGEuY29uc3RydWN0b3IgPT09IE51bWJlciB8fCBqc29uLl9tYXBfZGF0YS5jb25zdHJ1Y3RvciA9PT0gQm9vbGVhbil7XG4gICAgICAgICAgICBfZWwuYXBwZW5kKFxuICAgICAgICAgICAgICAkKFwiPHNwYW4+XCIpLmFkZENsYXNzKCdudW1iZXInKS50ZXh0KGpzb24uX21hcF9kYXRhKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZXtcbiAgICAgICAgICAgIF9lbC5hcHBlbmQoXG4gICAgICAgICAgICAgICQoXCI8c3Bhbj5cIikudGV4dChKU09OLnN0cmluZ2lmeShqc29uLl9tYXBfZGF0YSwgbnVsbCwgMikpXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZihjb21tYSl7XG4gICAgICAgICAgICBfZWwuYXBwZW5kKFxuICAgICAgICAgICAgICAkKFwiPHNwYW4+XCIpLnRleHQoXCIsXCIpXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cblxuXG4gICAgICAgIH1cbiAgICAgIH1lbHNle1xuICAgICAgICBfZWwuYXBwZW5kKFxuICAgICAgICAgICQoXCI8c3Bhbj5cIikudGV4dChKU09OLnN0cmluZ2lmeShqc29uLCBudWxsLCAyKSlcbiAgICAgICAgKVxuXG4gICAgICAgIGlmKGNvbW1hKXtcbiAgICAgICAgICBfZWwuYXBwZW5kKFxuICAgICAgICAgICAgJChcIjxzcGFuPlwiKS50ZXh0KFwiLFwiKVxuICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgfVxuXG4gICAgICBvdXRwdXQuYXBwZW5kKF9lbCk7XG5cbiAgICB9XG4gICAgcHJpbnRPYmplY3QoanNvbiwxLG91dHB1dCk7XG4gICAgcmV0dXJuIG91dHB1dDtcbiAgfVxufTtcblxuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi91dGlsL3N5bnRheC5qc1xuLy8gbW9kdWxlIGlkID0gNTZcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwibW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbigpIHtcclxuXHR0aHJvdyBuZXcgRXJyb3IoXCJkZWZpbmUgY2Fubm90IGJlIHVzZWQgaW5kaXJlY3RcIik7XHJcbn07XHJcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vICh3ZWJwYWNrKS9idWlsZGluL2FtZC1kZWZpbmUuanNcbi8vIG1vZHVsZSBpZCA9IDU3XG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIi8qIGdsb2JhbHMgX193ZWJwYWNrX2FtZF9vcHRpb25zX18gKi9cclxubW9kdWxlLmV4cG9ydHMgPSBfX3dlYnBhY2tfYW1kX29wdGlvbnNfXztcclxuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gKHdlYnBhY2spL2J1aWxkaW4vYW1kLW9wdGlvbnMuanNcbi8vIG1vZHVsZSBpZCA9IDU4XG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIm1vZHVsZS5leHBvcnRzID0gXCJQSE4yWnlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpSUhacFpYZENiM2c5SWpBZ01DQXlNaUF5TWlJK1BHY2dkSEpoYm5ObWIzSnRQU0p0WVhSeWFYZ29MakF6T1RZMUlEQWdNQ0F1TURNNU5qVWdNUzR4TmpNZ01TNHhOak1wSWlCbWFXeHNQU0lqTkdRMFpEUmtJajQ4Y0dGMGFDQmtQU0p0TWpVd0xqSWdPREV1TmpGak9UY3VORE1nTUNBeE56a3VOelVnTkRNdU5ETWdNVGM1TGpjMUlEazBMamd6SURBZ01USXVORFE1TFRRdU9UTTBJREkwTGpRME9TMHhNeTQyTkRVZ016VXVORFkxYkRNMUxqUXdNaUF4TUM0ME1EUmpPQzQyTVRNdE1UUXVNakkzSURFekxqVXpNeTB5T1M0Mk1qa2dNVE11TlRNekxUUTFMamcyT1NBd0xUY3lMamsyTlMwNU5DNDBOaTB4TXpBdU1USXRNakUxTGpBMExURXpNQzR4TWkweE1qQXVOVGNnTUMweU1UVXVNRFFnTlRjdU1UWXRNakUxTGpBMElERXpNQzR4TWlBd0lESTJMamt4T0NBeE1pNDVNellnTlRFdU5qUXpJRE0xTGpFNUlEY3lMakUzTFRZdU9UVXhJRFF1TlRBeUxURXpMamMxTmlBeE1DNDFNREl0TVRndU9ETTJJREU0TGprNE5DMHhNQzQwTlRNZ01UY3VORFE1TFRFd0xqWTJJRE01TGpBNUxTNDJORFVnTmpRdU16VWdPUzQwTXpNZ01qTXVOemt4SURjdU1USTFJRE15TGpVNE1pQTFMalk1TXlBek5TNHlOQzB6TGpNMU5DQTJMak15TWkweE9DNHhNeUE1TGpVeE5DMHpNaTR6T0RVZ01USXVOVGsyTFRNdU5EZzJMamMxT0MwM0xqQTBJREV1TlRNeExURXdMalU0TWlBeUxqTTNNUzA1TGpRNE5DQXlMakkwTFRFMUxqTTFNeUF4TVM0M01qVXRNVE11TVRNZ01qRXVNak1nTVM0NU1ESWdPQzR4TVRFZ09TNHhOalFnTVRNdU5UazJJREUzTGpFMklERXpMalU1TmlBeExqTTBJREFnTWk0M01Ea3RMakUySURRdU1EWTRMUzQwTmpjZ015NHpNaTB1TnpreElEWXVOalUyTFRFdU5URTRJRGt1T1RNeUxUSXVNakkzSURJeExqRXhMVFF1TlRZMElEUTFMakF5TFRrdU56UXlJRFUyTGpBNExUTXdMalE0TWlBNExqUTROaTB4TlM0NU1ESWdOeTR4T1RVdE16WXVOVEUyTFRRdU1ETXROalF1T0RVdE5TNDNNalV0TVRRdU5ETTFMVFl1TXpnMUxUSTFMalUyTkMweExqazBOeTB6TXk0eElEUXVPVFkxTFRndU5EVXhJREUyTGpFMExURXlMakl3TnlBeU1pNHhPUzB4TXk0ME5qY2dNelV1TnpBMUlERTVMamt3TWlBNE1pNDROU0F6TWk0ek5UUWdNVE0xTGpVNUlETXpMamcyT1d3dE1UQXVOVEEwTFRNMUxqYzBZeTA0Tnk0NE55MDFMamMxT0MweE5UZ3VOVFl0TkRZdU5EVXRNVFU0TGpVMkxUazBMakEzTGpBd01ERXROVEV1TkNBNE1pNHpNaTA1TkM0NE15QXhOemt1TnpVdE9UUXVPRE1pTHo0OGNHRjBhQ0JrUFNKdE5EZzNMalUzSURJMk9TNDJNMnd0TWpJeUxqQTFMVFkxTGpJM1l5MHhMakV4TlMwdU16TTRMVEl1TWpRMExTNDBPREl0TXk0ek56TXRMalE0TWkwekxqRXhNeUF3TFRZdU1UVTRJREV1TWpJM0xUZ3VORE0wSURNdU5TMHpMakE1TmlBekxqQTRMVFF1TWpVNElEY3VOakV6TFRNdU1ESWdNVEV1TnpnNWJEWTFMakkzSURJeU1pNHhZekV1TXpRZ05DNDJNVE1nTlM0ek5USWdOeTQ1T0RJZ01UQXVNVFF6SURndU5TNDBOVE11TURRM0xqZzVNUzR3TmpRZ01TNHpNakl1TURZMElEUXVNekE1SURBZ09DNHpNRGN0TWk0ek16Z2dNVEF1TkRNNUxUWXVNVFl5YkRVMExqQTRMVGs0TGpBMElEazRMakF6TFRVMExqQTVZelF1TWpJMUxUSXVNekl5SURZdU5qSTVMVFl1T1RVeElEWXVNUzB4TVM0M01qY3RMalV4TkMwMExqYzROeTB6TGpnM05DMDRMamd3TlMwNExqVXdNaTB4TUM0eE56WWlMejQ4TDJjK1BDOXpkbWMrQ2c9PVwiXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi4vfi9iYXNlNjQtbG9hZGVyIS4vbWVkaWEvbGFzc28uc3ZnXG4vLyBtb2R1bGUgaWQgPSA1OVxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCJtb2R1bGUuZXhwb3J0cyA9IFwiUEQ5NGJXd2dkbVZ5YzJsdmJqMGlNUzR3SWlCbGJtTnZaR2x1WnowaWRYUm1MVGdpUHo0OGMzWm5JSGRwWkhSb1BTY3hPRGh3ZUNjZ2FHVnBaMmgwUFNjeE9EaHdlQ2NnZUcxc2JuTTlJbWgwZEhBNkx5OTNkM2N1ZHpNdWIzSm5Mekl3TURBdmMzWm5JaUIyYVdWM1FtOTRQU0l3SURBZ01UQXdJREV3TUNJZ2NISmxjMlZ5ZG1WQmMzQmxZM1JTWVhScGJ6MGllRTFwWkZsTmFXUWlJR05zWVhOelBTSjFhV3d0YzNCcGJpSStQSEpsWTNRZ2VEMGlNQ0lnZVQwaU1DSWdkMmxrZEdnOUlqRXdNQ0lnYUdWcFoyaDBQU0l4TURBaUlHWnBiR3c5SW01dmJtVWlJR05zWVhOelBTSmlheUkrUEM5eVpXTjBQanhuSUhSeVlXNXpabTl5YlQwaWRISmhibk5zWVhSbEtEVXdJRFV3S1NJK1BHY2dkSEpoYm5ObWIzSnRQU0p5YjNSaGRHVW9NQ2tnZEhKaGJuTnNZWFJsS0RNMElEQXBJajQ4WTJseVkyeGxJR040UFNJd0lpQmplVDBpTUNJZ2NqMGlPQ0lnWm1sc2JEMGlJMk5tWm1aa1ppSStQR0Z1YVcxaGRHVWdZWFIwY21saWRYUmxUbUZ0WlQwaWIzQmhZMmwwZVNJZ1puSnZiVDBpTVNJZ2RHODlJakF1TVNJZ1ltVm5hVzQ5SWpCeklpQmtkWEk5SWpGeklpQnlaWEJsWVhSRGIzVnVkRDBpYVc1a1pXWnBibWwwWlNJK1BDOWhibWx0WVhSbFBqeGhibWx0WVhSbFZISmhibk5tYjNKdElHRjBkSEpwWW5WMFpVNWhiV1U5SW5SeVlXNXpabTl5YlNJZ2RIbHdaVDBpYzJOaGJHVWlJR1p5YjIwOUlqRXVOU0lnZEc4OUlqRWlJR0psWjJsdVBTSXdjeUlnWkhWeVBTSXhjeUlnY21Wd1pXRjBRMjkxYm5ROUltbHVaR1ZtYVc1cGRHVWlQand2WVc1cGJXRjBaVlJ5WVc1elptOXliVDQ4TDJOcGNtTnNaVDQ4TDJjK1BHY2dkSEpoYm5ObWIzSnRQU0p5YjNSaGRHVW9ORFVwSUhSeVlXNXpiR0YwWlNnek5DQXdLU0krUEdOcGNtTnNaU0JqZUQwaU1DSWdZM2s5SWpBaUlISTlJamdpSUdacGJHdzlJaU5qWm1abVpHWWlQanhoYm1sdFlYUmxJR0YwZEhKcFluVjBaVTVoYldVOUltOXdZV05wZEhraUlHWnliMjA5SWpFaUlIUnZQU0l3TGpFaUlHSmxaMmx1UFNJd0xqRXljeUlnWkhWeVBTSXhjeUlnY21Wd1pXRjBRMjkxYm5ROUltbHVaR1ZtYVc1cGRHVWlQand2WVc1cGJXRjBaVDQ4WVc1cGJXRjBaVlJ5WVc1elptOXliU0JoZEhSeWFXSjFkR1ZPWVcxbFBTSjBjbUZ1YzJadmNtMGlJSFI1Y0dVOUluTmpZV3hsSWlCbWNtOXRQU0l4TGpVaUlIUnZQU0l4SWlCaVpXZHBiajBpTUM0eE1uTWlJR1IxY2owaU1YTWlJSEpsY0dWaGRFTnZkVzUwUFNKcGJtUmxabWx1YVhSbElqNDhMMkZ1YVcxaGRHVlVjbUZ1YzJadmNtMCtQQzlqYVhKamJHVStQQzluUGp4bklIUnlZVzV6Wm05eWJUMGljbTkwWVhSbEtEa3dLU0IwY21GdWMyeGhkR1VvTXpRZ01Da2lQanhqYVhKamJHVWdZM2c5SWpBaUlHTjVQU0l3SWlCeVBTSTRJaUJtYVd4c1BTSWpZMlptWm1SbUlqNDhZVzVwYldGMFpTQmhkSFJ5YVdKMWRHVk9ZVzFsUFNKdmNHRmphWFI1SWlCbWNtOXRQU0l4SWlCMGJ6MGlNQzR4SWlCaVpXZHBiajBpTUM0eU5YTWlJR1IxY2owaU1YTWlJSEpsY0dWaGRFTnZkVzUwUFNKcGJtUmxabWx1YVhSbElqNDhMMkZ1YVcxaGRHVStQR0Z1YVcxaGRHVlVjbUZ1YzJadmNtMGdZWFIwY21saWRYUmxUbUZ0WlQwaWRISmhibk5tYjNKdElpQjBlWEJsUFNKelkyRnNaU0lnWm5KdmJUMGlNUzQxSWlCMGJ6MGlNU0lnWW1WbmFXNDlJakF1TWpWeklpQmtkWEk5SWpGeklpQnlaWEJsWVhSRGIzVnVkRDBpYVc1a1pXWnBibWwwWlNJK1BDOWhibWx0WVhSbFZISmhibk5tYjNKdFBqd3ZZMmx5WTJ4bFBqd3ZaejQ4WnlCMGNtRnVjMlp2Y20wOUluSnZkR0YwWlNneE16VXBJSFJ5WVc1emJHRjBaU2d6TkNBd0tTSStQR05wY21Oc1pTQmplRDBpTUNJZ1kzazlJakFpSUhJOUlqZ2lJR1pwYkd3OUlpTmpabVptWkdZaVBqeGhibWx0WVhSbElHRjBkSEpwWW5WMFpVNWhiV1U5SW05d1lXTnBkSGtpSUdaeWIyMDlJakVpSUhSdlBTSXdMakVpSUdKbFoybHVQU0l3TGpNM2N5SWdaSFZ5UFNJeGN5SWdjbVZ3WldGMFEyOTFiblE5SW1sdVpHVm1hVzVwZEdVaVBqd3ZZVzVwYldGMFpUNDhZVzVwYldGMFpWUnlZVzV6Wm05eWJTQmhkSFJ5YVdKMWRHVk9ZVzFsUFNKMGNtRnVjMlp2Y20waUlIUjVjR1U5SW5OallXeGxJaUJtY205dFBTSXhMalVpSUhSdlBTSXhJaUJpWldkcGJqMGlNQzR6TjNNaUlHUjFjajBpTVhNaUlISmxjR1ZoZEVOdmRXNTBQU0pwYm1SbFptbHVhWFJsSWo0OEwyRnVhVzFoZEdWVWNtRnVjMlp2Y20wK1BDOWphWEpqYkdVK1BDOW5QanhuSUhSeVlXNXpabTl5YlQwaWNtOTBZWFJsS0RFNE1Da2dkSEpoYm5Oc1lYUmxLRE0wSURBcElqNDhZMmx5WTJ4bElHTjRQU0l3SWlCamVUMGlNQ0lnY2owaU9DSWdabWxzYkQwaUkyTm1abVprWmlJK1BHRnVhVzFoZEdVZ1lYUjBjbWxpZFhSbFRtRnRaVDBpYjNCaFkybDBlU0lnWm5KdmJUMGlNU0lnZEc4OUlqQXVNU0lnWW1WbmFXNDlJakF1TlhNaUlHUjFjajBpTVhNaUlISmxjR1ZoZEVOdmRXNTBQU0pwYm1SbFptbHVhWFJsSWo0OEwyRnVhVzFoZEdVK1BHRnVhVzFoZEdWVWNtRnVjMlp2Y20wZ1lYUjBjbWxpZFhSbFRtRnRaVDBpZEhKaGJuTm1iM0p0SWlCMGVYQmxQU0p6WTJGc1pTSWdabkp2YlQwaU1TNDFJaUIwYnowaU1TSWdZbVZuYVc0OUlqQXVOWE1pSUdSMWNqMGlNWE1pSUhKbGNHVmhkRU52ZFc1MFBTSnBibVJsWm1sdWFYUmxJajQ4TDJGdWFXMWhkR1ZVY21GdWMyWnZjbTArUEM5amFYSmpiR1UrUEM5blBqeG5JSFJ5WVc1elptOXliVDBpY205MFlYUmxLREl5TlNrZ2RISmhibk5zWVhSbEtETTBJREFwSWo0OFkybHlZMnhsSUdONFBTSXdJaUJqZVQwaU1DSWdjajBpT0NJZ1ptbHNiRDBpSTJObVptWmtaaUkrUEdGdWFXMWhkR1VnWVhSMGNtbGlkWFJsVG1GdFpUMGliM0JoWTJsMGVTSWdabkp2YlQwaU1TSWdkRzg5SWpBdU1TSWdZbVZuYVc0OUlqQXVOakp6SWlCa2RYSTlJakZ6SWlCeVpYQmxZWFJEYjNWdWREMGlhVzVrWldacGJtbDBaU0krUEM5aGJtbHRZWFJsUGp4aGJtbHRZWFJsVkhKaGJuTm1iM0p0SUdGMGRISnBZblYwWlU1aGJXVTlJblJ5WVc1elptOXliU0lnZEhsd1pUMGljMk5oYkdVaUlHWnliMjA5SWpFdU5TSWdkRzg5SWpFaUlHSmxaMmx1UFNJd0xqWXljeUlnWkhWeVBTSXhjeUlnY21Wd1pXRjBRMjkxYm5ROUltbHVaR1ZtYVc1cGRHVWlQand2WVc1cGJXRjBaVlJ5WVc1elptOXliVDQ4TDJOcGNtTnNaVDQ4TDJjK1BHY2dkSEpoYm5ObWIzSnRQU0p5YjNSaGRHVW9NamN3S1NCMGNtRnVjMnhoZEdVb016UWdNQ2tpUGp4amFYSmpiR1VnWTNnOUlqQWlJR041UFNJd0lpQnlQU0k0SWlCbWFXeHNQU0lqWTJabVptUm1JajQ4WVc1cGJXRjBaU0JoZEhSeWFXSjFkR1ZPWVcxbFBTSnZjR0ZqYVhSNUlpQm1jbTl0UFNJeElpQjBiejBpTUM0eElpQmlaV2RwYmowaU1DNDNOWE1pSUdSMWNqMGlNWE1pSUhKbGNHVmhkRU52ZFc1MFBTSnBibVJsWm1sdWFYUmxJajQ4TDJGdWFXMWhkR1UrUEdGdWFXMWhkR1ZVY21GdWMyWnZjbTBnWVhSMGNtbGlkWFJsVG1GdFpUMGlkSEpoYm5ObWIzSnRJaUIwZVhCbFBTSnpZMkZzWlNJZ1puSnZiVDBpTVM0MUlpQjBiejBpTVNJZ1ltVm5hVzQ5SWpBdU56VnpJaUJrZFhJOUlqRnpJaUJ5WlhCbFlYUkRiM1Z1ZEQwaWFXNWtaV1pwYm1sMFpTSStQQzloYm1sdFlYUmxWSEpoYm5ObWIzSnRQand2WTJseVkyeGxQand2Wno0OFp5QjBjbUZ1YzJadmNtMDlJbkp2ZEdGMFpTZ3pNVFVwSUhSeVlXNXpiR0YwWlNnek5DQXdLU0krUEdOcGNtTnNaU0JqZUQwaU1DSWdZM2s5SWpBaUlISTlJamdpSUdacGJHdzlJaU5qWm1abVpHWWlQanhoYm1sdFlYUmxJR0YwZEhKcFluVjBaVTVoYldVOUltOXdZV05wZEhraUlHWnliMjA5SWpFaUlIUnZQU0l3TGpFaUlHSmxaMmx1UFNJd0xqZzNjeUlnWkhWeVBTSXhjeUlnY21Wd1pXRjBRMjkxYm5ROUltbHVaR1ZtYVc1cGRHVWlQand2WVc1cGJXRjBaVDQ4WVc1cGJXRjBaVlJ5WVc1elptOXliU0JoZEhSeWFXSjFkR1ZPWVcxbFBTSjBjbUZ1YzJadmNtMGlJSFI1Y0dVOUluTmpZV3hsSWlCbWNtOXRQU0l4TGpVaUlIUnZQU0l4SWlCaVpXZHBiajBpTUM0NE4zTWlJR1IxY2owaU1YTWlJSEpsY0dWaGRFTnZkVzUwUFNKcGJtUmxabWx1YVhSbElqNDhMMkZ1YVcxaGRHVlVjbUZ1YzJadmNtMCtQQzlqYVhKamJHVStQQzluUGp3dlp6NDhMM04yWno0PVwiXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi4vfi9iYXNlNjQtbG9hZGVyIS4vbWVkaWEvbG9hZGVyLnN2Z1xuLy8gbW9kdWxlIGlkID0gNjBcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwibW9kdWxlLmV4cG9ydHMgPSBcIlBITjJaeUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSGRwWkhSb1BTSXlOQ0lnYUdWcFoyaDBQU0l5TkNJZ2RtbGxkMEp2ZUQwaU1DQXdJREkwSURJMElqNDhjR0YwYUNCa1BTSk5NakV1TVRReklEa3VOalkzWXkwdU56TXpMVEV1TXpreUxURXVPVEUwTFRNdU1EVXRNeTQyTVRjdE5DNDNOVE10TWk0NU56Y3RNaTQ1TnpndE5TNDBOemd0TXk0NU1UUXROaTQzT0RVdE15NDVNVFF0TGpReE5DQXdMUzQzTURndU1EazBMUzQ0Tmk0eU5EWnNMVEV1TXpZeElERXVNelpqTFRFdU9EazVMUzR5TXpZdE15NDBNaTR4TURZdE5DNHlPVFF1T1RnekxTNDROell1T0RjMUxURXVNVFkwSURJdU1UVTVMUzQzT1RJZ015NDFNak11TkRreUlERXVPREEySURJdU16QTFJRFF1TURRNUlEVXVPVEExSURVdU16YzFMakF6T0M0ek1qTXVNVFUzTGpZek9DNDBNRFV1T0RnMUxqVTRPQzQxT0RnZ01TNDFNelV1TlRnMklESXVNVEl4SURCekxqVTRPQzB4TGpVek15NHdNREl0TWk0eE1UbGpMUzQxT0RndExqVTROeTB4TGpVek55MHVOVGc0TFRJdU1USXpMUzR3TURGc0xTNHhOeTR5TlRaakxUSXVNRE14TFM0M05qVXRNeTR6T1RVdE1TNDRNamd0TkM0eU16SXRNaTQ1YkRNdU9EYzVMVE11T0RjMVl5NDBPVFlnTWk0M015QTJMalF6TWlBNExqWTNOaUE1TGpFM09DQTVMakUzT0d3dE55NHhNVFVnTnk0eE1EZGpMUzR5TXpRdU1UVXpMVEl1TnprNExTNHpNVFl0Tmk0eE5UWXRNeTQyTnpVdE15NHpPVE10TXk0ek9UTXRNeTR4TnpVdE5TNHlOekV0TXk0d01qY3ROUzQwT1Roc01TNDROVGt0TVM0NE5UWmpMUzQwTXprdExqTTFPUzB1T1RJMUxURXVNVEF6TFRFdU1UUXhMVEV1TmpnNWJDMHlMakV6TkNBeUxqRXpNV010TGpRME5TNDBORFl0TGpZNE5TQXhMakEyTkMwdU5qZzFJREV1T0RJZ01DQXhMall6TkNBeExqRXlNU0F6TGpreE5TQXpMamN4TXlBMkxqVXdOaUF5TGpjMk5DQXlMamMyTkNBMUxqVTRJRFF1TWpReklEY3VORE15SURRdU1qUXpMalkwT0NBd0lERXVNVGd0TGpFNU5TQXhMalUwTnkwdU5UWXliRGd1TURnMkxUZ3VNRGM0WXk0NU1TNDROelF0TGpjM09DQXpMalV6T0MwdU56YzRJRFF1TmpRNElEQWdNUzR4TURRdU9EazJJREV1T1RrNUlESWdNUzQ1T1RrZ01TNHhNRFVnTUNBeUxTNDRPVFlnTWkweUlEQXRNeTR4T0RRdE1TNDBNalV0Tmk0NE1TMHlMamcxTnkwNUxqTTBlbTB0TVRZdU1qQTVMVFV1TXpjeFl5NDFNamN0TGpVeklERXVORGN4TFM0M09URWdNaTQyTlRZdExqYzJNV3d0TXk0eU1Ea2dNeTR5TURaakxTNHlNell0TGprM09DMHVNRFE1TFRFdU9EUTFMalUxTXkweUxqUTBOWHB0T1M0eU9USWdOQzR3Tnpsc0xTNHdNeTB1TURJNVl5MHhMakk1TWkweExqSTVNaTB6TGpnd015MDBMak0xTmkwekxqQTVOaTAxTGpBMk15NDNNVFV0TGpjeE5TQXpMalE0T0NBeExqVXlNU0ExTGpBMk1pQXpMakE1Tmk0NE5qSXVPRFl5SURJdU1EZzRJREl1TWpRM0lESXVPVE0zSURNdU5EVTRMVEV1TnpFM0xURXVNRGMwTFRNdU5Ea3hMVEV1TkRZNUxUUXVPRGN6TFRFdU5EWXllaUl2UGp3dmMzWm5QZz09XCJcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuLi9+L2Jhc2U2NC1sb2FkZXIhLi9tZWRpYS9wYWludC1idWNrZXQuc3ZnXG4vLyBtb2R1bGUgaWQgPSA2MVxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCJtb2R1bGUuZXhwb3J0cyA9IFwiaVZCT1J3MEtHZ29BQUFBTlNVaEVVZ0FBQUVBQUFBQkFDQVlBQUFDcWFYSGVBQUFBQkhOQ1NWUUlDQWdJZkFoa2lBQUFBQWx3U0ZsekFBQU5sQUFBRFpRQkVMRC9mQUFBQUJsMFJWaDBVMjltZEhkaGNtVUFkM2QzTG1sdWEzTmpZWEJsTG05eVo1dnVQQm9BQUFYUFNVUkJWSGljNWR0L3lGNWxHUWZ3ejdVNTU1YWF0cEVvcGs2eUxiYTE2SWVnRENrMEMwa0Qyd29KRFpyOUliVWcwellpK3lNU1F2dEZoaEcxYU9JL09mL1FMTEVnY2dnenpjcEJjMUNUMm9xc1hOaHFzem5icnY2NDd4ZmZQWHVmN1htZWM1N3o3cDFmdURtY2MrNGYxL1c5cjNPZisxelhkU0l6dlJvUUVmUHh1Y3o4L0dIWFh3MEVSTVJDL0FSek0vT3RrKy9ObWg2UnVrTkVYSWd0dUhpcSt5YzBBUkh4TmtYNWkvclZPV0VKaUlncnNSbG40WWwrOVU1SUFpTGlldndZcCtKYitGaS91aWNjQVJHeERoc3hSMW4xMStKUXYvb25kU1hZdUJFUnMvQU5yTVgvY0dObWJqeFd1eE9DZ0lpWWkzdXhDdnV3S2pNZkdhVHRqQ2NnSXM3QWc3Z016K09xekh4cTBQWXptb0NJT0JlUFlDbWV4ZnN5Yzhjd2ZSeXhDRWJFNG9oNGJUc2lqZzhSc1JTUEs4ci9HcGNPcXp4VFc4RFZ1RE1pL294dCtGMHQyL0JNWnI0NHN0UXRJU0l1VTh6K0RQeFVlZWIzanRSWlpoNVdjQnIraFp5aUhNUU9QSURiY1IyVzQrVGVmc1pWbElWdWY1WG5Ic3dab00yU1d2L3BJKzcxYWZEbDJ1QXAzSXdOeW03cVAzMkllUm5QNEQ1OEFSL0VZc3h1V2ZtMWRSS3l5aGdEdGh1YWdMUHhFZzdnM0VuWEE0dndmcXhYWGoyL25UUWp2V1UvbnE3MTF0ZDJpd1lWdkdmY2lVazVpTFZEdGgrT2dOcG9RMjMwbFFFR21GMW4vTnBxQWZjcGE4YkxmWWpaV3kzcSs5WENyc1E1ZmZxZVUwMTlndERWSTFoT1h3TDYrZ01pNHMxVmliMTRRMmJ1bWJMaVVSQVJKMWRpbG1KWkxVdHhvYW0zNFM5NFplSGRwanhXNnlwQmUvQ0J6Tnc4Z2h4THNCMWJzOGNmY0N6bWZxUXd0NzdsWjNrZTNvNGJjQWNleGs1VFcwdmlMMWplWUx6aExhQXl0eEtQNFRsY2tKa0hobVYvR0VURTZZcUZUTGFZZWJndU0zYzE2SGMwQzZqa1BLNnd0NlpOSytpeU9Jb0ZEUEk1ZkVjOTNoSVJNZW9zSEs4WWhJQUg4WHVGeGF2SEswNzNPQ1lCbVhrSVg2Mm50NDVYbk80eHFFZm9IdndkS3lQaWtqSEswemtHSWlBejkrT3VldnJaOFluVFBZYnhDZDZ0YklxdWlZZzNqVW1lempFd0FabjVBcjVYMjl3eU5vazZ4ckJlNGE4ckRzY2JJdUtzTWNqVE9ZWWlvTzdHZm9pNStOUllKT29ZbzhRRjdxekhteUxpMURhRm1RNE1UVUJtYnNYUGNDWnViRjJpampGcVpHaGllL3pwaUpqUm51V1JDTWpNbitNM09BOGZibFdpanRFa05qaXhGc3pvN1hFVEFqYmhUMWhSUTlFekVpTVRrSmtIOGJWNk9tTzN4MDNENHh2d1QxeGVzekZtSEJvUmtDVktkSGM5blpGclFSc0pFbmZodjFnZEVSZTAwRituYUV4QVpqNlBIeWl4Z1p1YjlqY21MT3A3cHlXbjR4dVZpTTArTERnT25LQnpjQVcraVQ5NnhiMCtlR1JvaEVFMzFVRnVteWFsWDRlUEtCOXJleHdlVi9pRDR0YTdkSndFWEZ3SCt3Zm1kYVQwUmZnTUhsVSsweWRIc1I5VFhzOUxqdHBIeXdJOVdnVzRhVXdLejhaSzVWdGtlODhzL3h2M0s5R21oUVAzMmJLQVYwMHl1Vmt0OVhtYWtoT3dFYnQ3bE42cDVBRysxNGc1Q20wVEVFcGdNNVdzalZIN09RK2ZVUEovWHBxazhDRThpZHV3b2hXWjJ5U2dDdi9SS3V3VFF4TDNUbnhSeVNlWVBNc3Y0aUY4SEdlM0xtK0xpaS9HR3NWeE9pSDg3VmpXcC80OEpXSGlPL2hyajlMUDRidTRCdlBiVnJwVkFxcmk5MWZ6N0JmZS9pWGVvaVF1cjFIQ2JmdDY2bXpGbCtyYlpLZ01raWFsMFE4VE5UNndCUXVVYkpCZjRSZEtidEZ5dkJ1WDRCVGwxVFNybWpzbC9XYXprb1B3VUdidUhGbVFKbWc0K3hNTDNyMTRUWjg2YzVVYzNvbVozb1RWT0wycldSN0xJNkRzcnhPN0RHQ3lTazVRNG9ycFZucHlhZkl4TkJFWTJaV0RQVWZQMXVPWkRjWnNIdzBzNENRbG9mS2dZOHdxM3FIRUZRL2gvT21lOVZZZWdhcllKeFd6UHFDa3ZGMnY1aFhpOWZnUXZsMlZIeWpsYmtZUlVCVzkxWkdKa244ejlXdnhYZE90Y0c5cDViL0JpRGhIY1lhOFIvRU56RmQ4aFU4cWk5L0NhaTNiTW5OWjR3RmJST3MvVHRaRXFnV1p1YnZuMmc0bFFmTDhiSkR5MWpaYS8ya3FDM2IzWGxOMmc3Q2k3VEdiWURyK0dqdGxHc2JzaTA0SXFQLzFYRjVQdDNjeDVxRG95Z0xXS1J1bkxVb1M5SEdEcmdqWW80VFJWbVhicTI1RC9COVBMZm8zRU1FWml3QUFBQUJKUlU1RXJrSmdnZz09XCJcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuLi9+L2Jhc2U2NC1sb2FkZXIhLi9tZWRpYS9wb2x5Z29uLnBuZ1xuLy8gbW9kdWxlIGlkID0gNjJcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiLyoqXG4gKiBGb250IFNlbGVjdG9yIC0galF1ZXJ5IHBsdWdpbiAwLjFcbiAqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTIgQ2hyaXMgRHllclxuICpcbiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKlxuICogUmVkaXN0cmlidXRpb24gYW5kIHVzZSBpbiBzb3VyY2UgYW5kIGJpbmFyeSBmb3Jtcywgd2l0aCBvciB3aXRob3V0IG1vZGlmaWNhdGlvbiwgYXJlIHBlcm1pdHRlZCBwcm92aWRlZCB0aGF0IHRoZSBmb2xsb3dpbmdcbiAqIGNvbmRpdGlvbnMgYXJlIG1ldDpcbiAqXG4gKiBSZWRpc3RyaWJ1dGlvbnMgb2Ygc291cmNlIGNvZGUgbXVzdCByZXRhaW4gdGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nXG4gKiBkaXNjbGFpbWVyLiBSZWRpc3RyaWJ1dGlvbnMgaW4gYmluYXJ5IGZvcm0gbXVzdCByZXByb2R1Y2UgdGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UsIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zXG4gKiBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyIGluIHRoZSBkb2N1bWVudGF0aW9uIGFuZC9vciBvdGhlciBtYXRlcmlhbHMgcHJvdmlkZWQgd2l0aCB0aGUgZGlzdHJpYnV0aW9uLlxuICpcbiAqIFRISVMgU09GVFdBUkUgSVMgUFJPVklERUQgQlkgVEhFIENPUFlSSUdIVCBIT0xERVJTIEFORCBDT05UUklCVVRPUlMgXCJBUyBJU1wiIEFORCBBTlkgRVhQUkVTUyBPUiBJTVBMSUVEIFdBUlJBTlRJRVMsIElOQ0xVRElORyxcbiAqIEJVVCBOT1QgTElNSVRFRCBUTywgVEhFIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkgQU5EIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFSRSBESVNDTEFJTUVELiBJTiBOT1xuICogRVZFTlQgU0hBTEwgVEhFIENPUFlSSUdIVCBIT0xERVIgT1IgQ09OVFJJQlVUT1JTIEJFIExJQUJMRSBGT1IgQU5ZIERJUkVDVCwgSU5ESVJFQ1QsIElOQ0lERU5UQUwsIFNQRUNJQUwsIEVYRU1QTEFSWSwgT1JcbiAqIENPTlNFUVVFTlRJQUwgREFNQUdFUyAoSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFBST0NVUkVNRU5UIE9GIFNVQlNUSVRVVEUgR09PRFMgT1IgU0VSVklDRVM7IExPU1MgT0YgVVNFLCBEQVRBLCBPUiBQUk9GSVRTO1xuICogT1IgQlVTSU5FU1MgSU5URVJSVVBUSU9OKSBIT1dFVkVSIENBVVNFRCBBTkQgT04gQU5ZIFRIRU9SWSBPRiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQ09OVFJBQ1QsIFNUUklDVCBMSUFCSUxJVFksIE9SIFRPUlRcbiAqIChJTkNMVURJTkcgTkVHTElHRU5DRSBPUiBPVEhFUldJU0UpIEFSSVNJTkcgSU4gQU5ZIFdBWSBPVVQgT0YgVEhFIFVTRSBPRiBUSElTIFNPRlRXQVJFLCBFVkVOIElGIEFEVklTRUQgT0YgVEhFIFBPU1NJQklMSVRZIE9GXG4gKiBTVUNIIERBTUFHRS5cbiAqXG4gKi9cblxuXG5cbihmdW5jdGlvbiAoZmFjdG9yeSkge1xuICBpZiAodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KHJlcXVpcmUoJ2pxdWVyeScpKTtcbiAgfSBlbHNlIHtcbiAgICBmYWN0b3J5KGpRdWVyeSk7XG4gIH1cbn0oXG4gICAgZnVuY3Rpb24oICQgKSB7XG5cbiAgJ3VzZSBzdHJpY3QnO1xuICAvL2lmKF8gJiYgXy5zdHlsZVNoZWV0Q29udGFpbnMgJiYgIV8uc3R5bGVTaGVldENvbnRhaW5zKCcuZm9udFNlbGVjdCcpKXtcbiAgLy8gIF8ubGlua0NTUyhfLnNjcmlwdFVSTCgpICsgXCIvLi4vLi4vY3NzL2pxdWVyeS5mb250U2VsZWN0b3IuY3NzXCIpO1xuICAvL31cblxuICB2YXIgc2V0dGluZ3M7XG5cbiAgdmFyIG1ldGhvZHMgPSB7XG4gICAgaW5pdCA6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcblxuICAgICAgc2V0dGluZ3MgPSAkLmV4dGVuZCgge1xuICAgICAgICAnaGlkZV9mYWxsYmFja3MnIDogZmFsc2UsXG4gICAgICAgICdzZWxlY3RlZCcgOiBmdW5jdGlvbihzdHlsZSkge30sXG4gICAgICAgICdvcGVuZWQnIDogZnVuY3Rpb24oKSB7fSxcbiAgICAgICAgJ2Nsb3NlZCcgOiBmdW5jdGlvbigpIHt9LFxuICAgICAgICAnaW5pdGlhbCcgOiAnJyxcbiAgICAgICAgJ2ZvbnRzJyA6IFtdXG4gICAgICB9LCBvcHRpb25zKTtcblxuICAgICAgdmFyIHJvb3QgPSB0aGlzO1xuICAgICAgdmFyICRyb290ID0gJCh0aGlzKTtcbiAgICAgIHJvb3Quc2VsZWN0ZWRDYWxsYmFjayA9IHNldHRpbmdzWydzZWxlY3RlZCddO1xuICAgICAgcm9vdC5vcGVuZWRDYWxsYmFjayA9IHNldHRpbmdzWydvcGVuZWQnXTtcbiAgICAgIHJvb3QuY2xvc2VkQ2FsbGJhY2sgPSBzZXR0aW5nc1snY2xvc2VkJ107XG4gICAgICB2YXIgdmlzaWJsZSA9IGZhbHNlO1xuICAgICAgdmFyIHNlbGVjdGVkID0gZmFsc2U7XG4gICAgICB2YXIgb3BlbmVkQ2xhc3MgPSAnZm9udFNlbGVjdE9wZW4nO1xuXG4gICAgICB2YXIgZGlzcGxheU5hbWUgPSBmdW5jdGlvbihmb250KSB7XG4gICAgICAgIGlmIChzZXR0aW5nc1snaGlkZV9mYWxsYmFja3MnXSl7XG4gICAgICAgICAgdmFyIGluZGV4ID0gZm9udC5pbmRleE9mKCcsJyk7XG4gICAgICAgICAgaWYoaW5kZXggPT0gLTEgKXJldHVybiBmb250O1xuICAgICAgICAgIHJldHVybiBmb250LnN1YnN0cigwLCBpbmRleCk7XG4gICAgICAgIH1lbHNlXG4gICAgICAgICAgcmV0dXJuIGZvbnQ7XG4gICAgICB9XG5cblxuICAgICAgdmFyIHNlbGVjdCA9IGZ1bmN0aW9uKGZvbnQsaW5pdGlhbCkge1xuICAgICAgICByb290LmZpbmQoJ3NwYW4nKS5odG1sKGRpc3BsYXlOYW1lKGZvbnQpLnJlcGxhY2UoL1tcIiddezF9L2dpLFwiXCIpKTtcbiAgICAgICAgcm9vdC5jc3MoJ2ZvbnQtZmFtaWx5JywgZm9udCk7XG4gICAgICAgIHNlbGVjdGVkID0gZm9udDtcblxuICAgICAgICBpZighaW5pdGlhbClyb290LnNlbGVjdGVkQ2FsbGJhY2soc2VsZWN0ZWQpO1xuICAgICAgfVxuXG4gICAgICB2YXIgcG9zaXRpb25VbCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgbGVmdCwgdG9wO1xuICAgICAgICBsZWZ0ID0gJChyb290KS5vZmZzZXQoKS5sZWZ0O1xuICAgICAgICB0b3AgPSAkKHJvb3QpLm9mZnNldCgpLnRvcCArICQocm9vdCkub3V0ZXJIZWlnaHQoKTtcblxuICAgICAgICAkKHVsKS5jc3Moe1xuICAgICAgICAgICdwb3NpdGlvbic6ICdhYnNvbHV0ZScsXG4gICAgICAgICAgJ2xlZnQnOiBsZWZ0ICsgJ3B4JyxcbiAgICAgICAgICAndG9wJzogdG9wICsgJ3B4JyxcbiAgICAgICAgICAnd2lkdGgnOiAkKHJvb3QpLm91dGVyV2lkdGgoKSArICdweCdcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIHZhciBjbG9zZVVsID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHVsLnNsaWRlVXAoJ2Zhc3QnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICB2aXNpYmxlID0gZmFsc2U7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRyb290LnJlbW92ZUNsYXNzKG9wZW5lZENsYXNzKTtcblxuICAgICAgICByb290LmNsb3NlZENhbGxiYWNrKCk7XG4gICAgICB9XG5cbiAgICAgIHZhciBvcGVuVWkgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdWwuc2xpZGVEb3duKCdmYXN0JywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgdmlzaWJsZSA9IHRydWU7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRyb290LmFkZENsYXNzKG9wZW5lZENsYXNzKTtcblxuICAgICAgICByb290Lm9wZW5lZENhbGxiYWNrKCk7XG4gICAgICB9XG5cbiAgICAgIC8vIFNldHVwIG1hcmt1cFxuICAgICAgJHJvb3QucHJlcGVuZCgnPHNwYW4+JyArIHNldHRpbmdzWydpbml0aWFsJ10ucmVwbGFjZSgvJy9nLCcmIzAzOTsnKSArICc8L3NwYW4+Jyk7XG4gICAgICB2YXIgdWwgPSAkKCc8dWwgY2xhc3M9XCJmb250U2VsZWN0VWxcIj48L3VsPicpLmFwcGVuZFRvKCdib2R5Jyk7XG4gICAgICB1bC5oaWRlKCk7XG4gICAgICBwb3NpdGlvblVsKCk7XG5cbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2V0dGluZ3NbJ2ZvbnRzJ10ubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdmFyIGl0ZW0gPSAkKCc8bGk+JyArIGRpc3BsYXlOYW1lKHNldHRpbmdzWydmb250cyddW2ldKSArICc8L2xpPicpLmFwcGVuZFRvKHVsKTtcbiAgICAgICAgaXRlbS5jc3MoJ2ZvbnQtZmFtaWx5Jywgc2V0dGluZ3NbJ2ZvbnRzJ11baV0pO1xuICAgICAgICBpdGVtWzBdLmRhdGEgPSBzZXR0aW5nc1snZm9udHMnXVtpXTtcbiAgICAgIH1cblxuICAgICAgaWYgKHNldHRpbmdzWydpbml0aWFsJ10gIT0gJycpXG4gICAgICAgIHNlbGVjdChzZXR0aW5nc1snaW5pdGlhbCddLHRydWUpO1xuXG4gICAgICB1bC5maW5kKCdsaScpLmNsaWNrKGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIGlmICghdmlzaWJsZSlcbiAgICAgICAgICByZXR1cm47XG5cbiAgICAgICAgcG9zaXRpb25VbCgpO1xuICAgICAgICBjbG9zZVVsKCk7XG5cbiAgICAgICAgc2VsZWN0KHRoaXMuZGF0YSk7XG4gICAgICB9KTtcblxuICAgICAgJHJvb3QuY2xpY2soZnVuY3Rpb24oZXZlbnQpIHtcblxuICAgICAgICBpZiAodmlzaWJsZSlcbiAgICAgICAgICByZXR1cm47XG5cbiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG5cbiAgICAgICAgcG9zaXRpb25VbCgpO1xuICAgICAgICBvcGVuVWkoKTtcbiAgICAgIH0pO1xuXG4gICAgICAkKCdodG1sJykuY2xpY2soZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmICh2aXNpYmxlKVxuICAgICAgICB7XG4gICAgICAgICAgY2xvc2VVbCgpO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgIH0sXG4gICAgc2VsZWN0ZWQgOiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiB0aGlzLmRhdGE7XG4gICAgfSxcbiAgICBzZWxlY3QgOiBmdW5jdGlvbihmb250KSB7XG4gICAgICB0aGlzLmZpbmQoJ3NwYW4nKS5odG1sKGZvbnQuc3Vic3RyKDAsIGZvbnQuaW5kZXhPZignLCcpKS5yZXBsYWNlKC9bXCInXXsxfS9naSxcIlwiKSk7XG4gICAgICB0aGlzLmNzcygnZm9udC1mYW1pbHknLCBmb250KTtcbiAgICAgIHZhciBzZWxlY3RlZCA9IGZhbHNlO1xuICAgICAgc2VsZWN0ZWQgPSBmb250O1xuICAgIH1cbiAgfTtcbiAgJC5mb250U2VsZWN0b3IgPSB7XG5cbiAgfTtcblxuICAkLmZuLmZvbnRTZWxlY3RvciA9IGZ1bmN0aW9uKG1ldGhvZCkge1xuICAgIGlmICggbWV0aG9kc1ttZXRob2RdICkge1xuICAgICAgcmV0dXJuIG1ldGhvZHNbIG1ldGhvZCBdLmFwcGx5KCB0aGlzLCBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbCggYXJndW1lbnRzLCAxICkpO1xuICAgIH0gZWxzZSBpZiAoIHR5cGVvZiBtZXRob2QgPT09ICdvYmplY3QnIHx8ICEgbWV0aG9kICkge1xuICAgICAgcmV0dXJuIG1ldGhvZHMuaW5pdC5hcHBseSggdGhpcywgYXJndW1lbnRzICk7XG4gICAgfSBlbHNlIHtcbiAgICAgICQuZXJyb3IoICdNZXRob2QgJyArICBtZXRob2QgKyAnIGRvZXMgbm90IGV4aXN0IG9uIGpRdWVyeS5mb250U2VsZWN0b3InICk7XG4gICAgfVxuICB9XG59KSk7XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuLi9wbHVnaW5zLyQuZm9udFNlbGVjdG9yLmpzXG4vLyBtb2R1bGUgaWQgPSA2M1xuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCIvKlxuICogalF1ZXJ5IE1pbmlDb2xvcnM6IEEgdGlueSBjb2xvciBwaWNrZXIgYnVpbHQgb24galF1ZXJ5XG4gKlxuICogQ29weXJpZ2h0OiBDb3J5IExhVmlza2EgZm9yIEEgQmVhdXRpZnVsIFNpdGUsIExMQzogaHR0cDovL3d3dy5hYmVhdXRpZnVsc2l0ZS5uZXQvXG4gKlxuICogQ29udHJpYnV0ZTogaHR0cHM6Ly9naXRodWIuY29tL2NsYXZpc2thL2pxdWVyeS1taW5pY29sb3JzXG4gKlxuICogQGxpY2Vuc2U6IGh0dHA6Ly9vcGVuc291cmNlLm9yZy9saWNlbnNlcy9NSVRcbiAqXG4gKi9cblxuXG5cbihmdW5jdGlvbiAoZmFjdG9yeSkge1xuICBpZiAodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KHJlcXVpcmUoJ2pxdWVyeScpKTtcbiAgfSBlbHNlIHtcbiAgICBmYWN0b3J5KGpRdWVyeSk7XG4gIH1cbn0oXG4gIGZ1bmN0aW9uICgkKSB7XG5cbiAgICAndXNlIHN0cmljdCc7XG4gICAgLy9pZihfICYmIF8uc3R5bGVTaGVldENvbnRhaW5zICYmICFfLnN0eWxlU2hlZXRDb250YWlucygnLm1pbmljb2xvcnMnKSl7XG4gICAgLy8gIF8ubGlua0NTUyhfLnNjcmlwdFVSTCgpICsgXCIvLi4vLi4vY3NzL2pxdWVyeS5taW5pY29sb3JzLmNzc1wiKTtcbiAgICAvL31cblxuICAgIC8vIERlZmF1bHRzXG4gICAgJC5taW5pY29sb3JzID0ge1xuICAgICAgZGVmYXVsdHM6IHtcbiAgICAgICAgYW5pbWF0aW9uU3BlZWQ6IDUwLFxuICAgICAgICBhbmltYXRpb25FYXNpbmc6ICdzd2luZycsXG4gICAgICAgIGNoYW5nZTogbnVsbCxcbiAgICAgICAgY2hhbmdlRGVsYXk6IDAsXG4gICAgICAgIGNvbnRyb2w6ICdodWUnLFxuICAgICAgICBkYXRhVXJpczogdHJ1ZSxcbiAgICAgICAgZGVmYXVsdFZhbHVlOiAnJyxcbiAgICAgICAgZm9ybWF0OiAnaGV4JyxcbiAgICAgICAgaGlkZTogbnVsbCxcbiAgICAgICAgaGlkZVNwZWVkOiAxMDAsXG4gICAgICAgIGlubGluZTogZmFsc2UsXG4gICAgICAgIGtleXdvcmRzOiAnJyxcbiAgICAgICAgbGV0dGVyQ2FzZTogJ2xvd2VyY2FzZScsXG4gICAgICAgIG9wYWNpdHk6IGZhbHNlLFxuICAgICAgICBwb3NpdGlvbjogJ2JvdHRvbSBsZWZ0JyxcbiAgICAgICAgc2hvdzogbnVsbCxcbiAgICAgICAgc2hvd1NwZWVkOiAxMDAsXG4gICAgICAgIHRoZW1lOiAnZGVmYXVsdCcsXG4gICAgICAgIHN3YXRjaGVzOiBbXVxuICAgICAgfVxuICAgIH07XG5cbiAgICAvLyBQdWJsaWMgbWV0aG9kc1xuICAgICQuZXh0ZW5kKCQuZm4sIHtcbiAgICAgIG1pbmljb2xvcnM6IGZ1bmN0aW9uKG1ldGhvZCwgZGF0YSkge1xuXG4gICAgICAgIHN3aXRjaChtZXRob2QpIHtcblxuICAgICAgICAgIC8vIERlc3Ryb3kgdGhlIGNvbnRyb2xcbiAgICAgICAgICBjYXNlICdkZXN0cm95JzpcbiAgICAgICAgICAgICQodGhpcykuZWFjaCggZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgIGRlc3Ryb3koJCh0aGlzKSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiAkKHRoaXMpO1xuXG4gICAgICAgICAgLy8gSGlkZSB0aGUgY29sb3IgcGlja2VyXG4gICAgICAgICAgY2FzZSAnaGlkZSc6XG4gICAgICAgICAgICBoaWRlKCk7XG4gICAgICAgICAgICByZXR1cm4gJCh0aGlzKTtcblxuICAgICAgICAgIC8vIEdldC9zZXQgb3BhY2l0eVxuICAgICAgICAgIGNhc2UgJ29wYWNpdHknOlxuICAgICAgICAgICAgLy8gR2V0dGVyXG4gICAgICAgICAgICBpZiggZGF0YSA9PT0gdW5kZWZpbmVkICkge1xuICAgICAgICAgICAgICAvLyBHZXR0ZXJcbiAgICAgICAgICAgICAgcmV0dXJuICQodGhpcykuYXR0cignZGF0YS1vcGFjaXR5Jyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAvLyBTZXR0ZXJcbiAgICAgICAgICAgICAgJCh0aGlzKS5lYWNoKCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB1cGRhdGVGcm9tSW5wdXQoJCh0aGlzKS5hdHRyKCdkYXRhLW9wYWNpdHknLCBkYXRhKSk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuICQodGhpcyk7XG5cbiAgICAgICAgICAvLyBHZXQgYW4gUkdCKEEpIG9iamVjdCBiYXNlZCBvbiB0aGUgY3VycmVudCBjb2xvci9vcGFjaXR5XG4gICAgICAgICAgY2FzZSAncmdiT2JqZWN0JzpcbiAgICAgICAgICAgIHJldHVybiByZ2JPYmplY3QoJCh0aGlzKSwgbWV0aG9kID09PSAncmdiYU9iamVjdCcpO1xuXG4gICAgICAgICAgLy8gR2V0IGFuIFJHQihBKSBzdHJpbmcgYmFzZWQgb24gdGhlIGN1cnJlbnQgY29sb3Ivb3BhY2l0eVxuICAgICAgICAgIGNhc2UgJ3JnYlN0cmluZyc6XG4gICAgICAgICAgY2FzZSAncmdiYVN0cmluZyc6XG4gICAgICAgICAgICByZXR1cm4gcmdiU3RyaW5nKCQodGhpcyksIG1ldGhvZCA9PT0gJ3JnYmFTdHJpbmcnKTtcblxuICAgICAgICAgIC8vIEdldC9zZXQgc2V0dGluZ3Mgb24gdGhlIGZseVxuICAgICAgICAgIGNhc2UgJ3NldHRpbmdzJzpcbiAgICAgICAgICAgIGlmKCBkYXRhID09PSB1bmRlZmluZWQgKSB7XG4gICAgICAgICAgICAgIHJldHVybiAkKHRoaXMpLmRhdGEoJ21pbmljb2xvcnMtc2V0dGluZ3MnKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIC8vIFNldHRlclxuICAgICAgICAgICAgICAkKHRoaXMpLmVhY2goIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9ICQodGhpcykuZGF0YSgnbWluaWNvbG9ycy1zZXR0aW5ncycpIHx8IHt9O1xuICAgICAgICAgICAgICAgIGRlc3Ryb3koJCh0aGlzKSk7XG4gICAgICAgICAgICAgICAgJCh0aGlzKS5taW5pY29sb3JzKCQuZXh0ZW5kKHRydWUsIHNldHRpbmdzLCBkYXRhKSk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuICQodGhpcyk7XG5cbiAgICAgICAgICAvLyBTaG93IHRoZSBjb2xvciBwaWNrZXJcbiAgICAgICAgICBjYXNlICdzaG93JzpcbiAgICAgICAgICAgIHNob3coICQodGhpcykuZXEoMCkgKTtcbiAgICAgICAgICAgIHJldHVybiAkKHRoaXMpO1xuXG4gICAgICAgICAgLy8gR2V0L3NldCB0aGUgaGV4IGNvbG9yIHZhbHVlXG4gICAgICAgICAgY2FzZSAndmFsdWUnOlxuICAgICAgICAgICAgaWYoIGRhdGEgPT09IHVuZGVmaW5lZCApIHtcbiAgICAgICAgICAgICAgLy8gR2V0dGVyXG4gICAgICAgICAgICAgIHJldHVybiAkKHRoaXMpLnZhbCgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgLy8gU2V0dGVyXG4gICAgICAgICAgICAgICQodGhpcykuZWFjaCggZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYoIHR5cGVvZihkYXRhKSA9PT0gJ29iamVjdCcgKSB7XG4gICAgICAgICAgICAgICAgICBpZiggZGF0YS5vcGFjaXR5ICkge1xuICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmF0dHIoJ2RhdGEtb3BhY2l0eScsIGtlZXBXaXRoaW4oZGF0YS5vcGFjaXR5LCAwLCAxKSk7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICBpZiggZGF0YS5jb2xvciApIHtcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS52YWwoZGF0YS5jb2xvcik7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICQodGhpcykudmFsKGRhdGEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB1cGRhdGVGcm9tSW5wdXQoJCh0aGlzKSk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuICQodGhpcyk7XG5cbiAgICAgICAgICAvLyBJbml0aWFsaXplcyB0aGUgY29udHJvbFxuICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICBpZiggbWV0aG9kICE9PSAnY3JlYXRlJyApIGRhdGEgPSBtZXRob2Q7XG4gICAgICAgICAgICAkKHRoaXMpLmVhY2goIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICBpbml0KCQodGhpcyksIGRhdGEpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gJCh0aGlzKTtcblxuICAgICAgICB9XG5cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHZhciBpbnB1dFRleHQsIGdsb2JhbFNldHRpbmdzLCBnbG9iYWxUYXJnZXQgLCBnbG9iYWxJbnB1dCA7XG4gICAgLy8gSW5pdGlhbGl6ZSBpbnB1dCBlbGVtZW50c1xuICAgIGZ1bmN0aW9uIGluaXQoaW5wdXQsIHNldHRpbmdzKSB7XG5cbiAgICAgIHZhciBtaW5pY29sb3JzID0gJCgnPGRpdiBjbGFzcz1cIm1pbmljb2xvcnNcIiAvPicpLFxuICAgICAgICBkZWZhdWx0cyA9ICQubWluaWNvbG9ycy5kZWZhdWx0cyxcbiAgICAgICAgc2l6ZSxcbiAgICAgICAgc3dhdGNoZXMsXG4gICAgICAgIHRleHRQYW5lbCxcbiAgICAgICAgc3dhdGNoLFxuICAgICAgICBwYW5lbCxcbiAgICAgICAgZ2xvYmFsVGFyZ2V0ID0gaW5wdXQsXG4gICAgICAgIGk7XG5cbiAgICAgIC8vIERvIG5vdGhpbmcgaWYgYWxyZWFkeSBpbml0aWFsaXplZFxuICAgICAgaWYoIGlucHV0LmRhdGEoJ21pbmljb2xvcnMtaW5pdGlhbGl6ZWQnKSApIHJldHVybjtcblxuICAgICAgLy8gSGFuZGxlIHNldHRpbmdzXG4gICAgICBnbG9iYWxTZXR0aW5ncyA9IHNldHRpbmdzID0gJC5leHRlbmQodHJ1ZSwge30sIGRlZmF1bHRzLCBzZXR0aW5ncyk7XG5cbiAgICAgIC8vIFRoZSB3cmFwcGVyXG4gICAgICBtaW5pY29sb3JzXG4gICAgICAgIC5hZGRDbGFzcygnbWluaWNvbG9ycy10aGVtZS0nICsgc2V0dGluZ3MudGhlbWUpXG4gICAgICAgIC50b2dnbGVDbGFzcygnbWluaWNvbG9ycy13aXRoLW9wYWNpdHknLCBzZXR0aW5ncy5vcGFjaXR5KVxuICAgICAgICAudG9nZ2xlQ2xhc3MoJ21pbmljb2xvcnMtbm8tZGF0YS11cmlzJywgc2V0dGluZ3MuZGF0YVVyaXMgIT09IHRydWUpO1xuXG4gICAgICAvLyBDdXN0b20gcG9zaXRpb25pbmdcbiAgICAgIGlmKCBzZXR0aW5ncy5wb3NpdGlvbiAhPT0gdW5kZWZpbmVkICkge1xuICAgICAgICAkLmVhY2goc2V0dGluZ3MucG9zaXRpb24uc3BsaXQoJyAnKSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgbWluaWNvbG9ycy5hZGRDbGFzcygnbWluaWNvbG9ycy1wb3NpdGlvbi0nICsgdGhpcyk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBJbnB1dCBzaXplXG4gICAgICBpZiggc2V0dGluZ3MuZm9ybWF0ID09PSAncmdiJyApIHtcbiAgICAgICAgc2l6ZSA9IHNldHRpbmdzLm9wYWNpdHkgPyAnMjUnIDogJzIwJztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHNpemUgPSBzZXR0aW5ncy5rZXl3b3JkcyA/ICcxMScgOiAnNyc7XG4gICAgICB9XG4gICAgICAgZ2xvYmFsSW5wdXQgPSBpbnB1dDtcbiAgICAgIC8vIFRoZSBpbnB1dFxuICAgICAgaW5wdXRcbiAgICAgICAgLmFkZENsYXNzKCdtaW5pY29sb3JzLWlucHV0JylcbiAgICAgICAgLmRhdGEoJ21pbmljb2xvcnMtaW5pdGlhbGl6ZWQnLCBmYWxzZSlcbiAgICAgICAgLmRhdGEoJ21pbmljb2xvcnMtc2V0dGluZ3MnLCBzZXR0aW5ncylcbiAgICAgICAgLnByb3AoJ3NpemUnLCBzaXplKVxuICAgICAgICAud3JhcChtaW5pY29sb3JzKVxuICAgICAgICAuYWZ0ZXIoXG4gICAgICAgICc8ZGl2IGNsYXNzPVwibWluaWNvbG9ycy1wYW5lbCBtaW5pY29sb3JzLXNsaWRlci0nICsgc2V0dGluZ3MuY29udHJvbCArICdcIj4nICtcbiAgICAgICAgJzxkaXYgY2xhc3M9XCJtaW5pY29sb3JzLXNsaWRlciBtaW5pY29sb3JzLXNwcml0ZVwiPicgK1xuICAgICAgICAnPGRpdiBjbGFzcz1cIm1pbmljb2xvcnMtcGlja2VyXCI+PC9kaXY+JyArXG4gICAgICAgICc8L2Rpdj4nICtcbiAgICAgICAgJzxkaXYgY2xhc3M9XCJtaW5pY29sb3JzLW9wYWNpdHktc2xpZGVyIG1pbmljb2xvcnMtc3ByaXRlXCI+JyArXG4gICAgICAgICc8ZGl2IGNsYXNzPVwibWluaWNvbG9ycy1waWNrZXJcIj48L2Rpdj4nICtcbiAgICAgICAgJzwvZGl2PicgK1xuICAgICAgICAnPGRpdiBjbGFzcz1cIm1pbmljb2xvcnMtZ3JpZCBtaW5pY29sb3JzLXNwcml0ZVwiPicgK1xuICAgICAgICAnPGRpdiBjbGFzcz1cIm1pbmljb2xvcnMtZ3JpZC1pbm5lclwiPjwvZGl2PicgK1xuICAgICAgICAnPGRpdiBjbGFzcz1cIm1pbmljb2xvcnMtcGlja2VyXCI+PGRpdj48L2Rpdj48L2Rpdj4nICtcbiAgICAgICAgJzwvZGl2PicgK1xuICAgICAgICAnPC9kaXY+J1xuICAgICAgKTtcblxuICAgICAgLy8gVGhlIHN3YXRjaFxuICAgICAgaWYoICFzZXR0aW5ncy5pbmxpbmUgKSB7XG4gICAgICAgIGlucHV0LmFmdGVyKCc8c3BhbiBjbGFzcz1cIm1pbmljb2xvcnMtc3dhdGNoIG1pbmljb2xvcnMtc3ByaXRlIG1pbmljb2xvcnMtaW5wdXQtc3dhdGNoXCI+PHNwYW4gY2xhc3M9XCJtaW5pY29sb3JzLXN3YXRjaC1jb2xvclwiPjwvc3Bhbj48L3NwYW4+Jyk7XG4gICAgICAgIGlucHV0Lm5leHQoJy5taW5pY29sb3JzLWlucHV0LXN3YXRjaCcpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICBpbnB1dC5mb2N1cygpO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gUHJldmVudCB0ZXh0IHNlbGVjdGlvbiBpbiBJRVxuICAgICAgcGFuZWwgPSBpbnB1dC5wYXJlbnQoKS5maW5kKCcubWluaWNvbG9ycy1wYW5lbCcpO1xuICAgICAgcGFuZWwub24oJ3NlbGVjdHN0YXJ0JywgZnVuY3Rpb24oKSB7IHJldHVybiBmYWxzZTsgfSkuZW5kKCk7XG5cbiAgICAgIC8vIFN3YXRjaGVzXG4gICAgICBpZiAoc2V0dGluZ3Muc3dhdGNoZXMgJiYgc2V0dGluZ3Muc3dhdGNoZXMubGVuZ3RoICE9PSAwKSB7XG4gICAgICAgIGlmIChzZXR0aW5ncy5zd2F0Y2hlcy5sZW5ndGggPiA3KSB7XG4gICAgICAgICAgc2V0dGluZ3Muc3dhdGNoZXMubGVuZ3RoID0gNztcbiAgICAgICAgfVxuICAgICAgICBwYW5lbC5hZGRDbGFzcygnbWluaWNvbG9ycy13aXRoLXN3YXRjaGVzJyk7XG4gICAgICAgIHN3YXRjaGVzID0gJCgnPHVsIGNsYXNzPVwibWluaWNvbG9ycy1zd2F0Y2hlc1wiPjwvdWw+JylcbiAgICAgICAgICAuYXBwZW5kVG8ocGFuZWwpO1xuICAgICAgICBmb3IoaSA9IDA7IGkgPCBzZXR0aW5ncy5zd2F0Y2hlcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgIHN3YXRjaCA9IHNldHRpbmdzLnN3YXRjaGVzW2ldO1xuICAgICAgICAgIHN3YXRjaCA9IGlzUmdiKHN3YXRjaCkgPyBwYXJzZVJnYihzd2F0Y2gsIHRydWUpIDogaGV4MnJnYihwYXJzZUhleChzd2F0Y2gsIHRydWUpKTtcbiAgICAgICAgICAkKCc8bGkgY2xhc3M9XCJtaW5pY29sb3JzLXN3YXRjaCBtaW5pY29sb3JzLXNwcml0ZVwiPjxzcGFuIGNsYXNzPVwibWluaWNvbG9ycy1zd2F0Y2gtY29sb3JcIj48L3NwYW4+PC9saT4nKVxuICAgICAgICAgICAgLmFwcGVuZFRvKHN3YXRjaGVzKVxuICAgICAgICAgICAgLmRhdGEoJ3N3YXRjaC1jb2xvcicsIHNldHRpbmdzLnN3YXRjaGVzW2ldKVxuICAgICAgICAgICAgLmZpbmQoJy5taW5pY29sb3JzLXN3YXRjaC1jb2xvcicpXG4gICAgICAgICAgICAuY3NzKHtcbiAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiByZ2IyaGV4KHN3YXRjaCksXG4gICAgICAgICAgICAgIG9wYWNpdHk6IHN3YXRjaC5hXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICBzZXR0aW5ncy5zd2F0Y2hlc1tpXSA9IHN3YXRjaDtcbiAgICAgICAgfVxuXG4gICAgICB9XG5cblxuICAgICAgLy8gU3dhdGNoZXNcbiAgICAgIGlmIChzZXR0aW5ncy50ZXh0KSB7XG4gICAgICAgIHBhbmVsLmFkZENsYXNzKCdtaW5pY29sb3JzLXdpdGgtdGV4dCcpO1xuICAgICAgICB0ZXh0UGFuZWwgPSAkKCc8ZGl2IGNsYXNzPVwibWluaWNvbG9ycy10ZXh0XCI+PC9kaXY+JylcbiAgICAgICAgICAuYXBwZW5kVG8ocGFuZWwpO1xuICAgICAgICBpbnB1dFRleHQgPSAkKCc8aW5wdXQgdHlwZT1cInRleHRcIj4nKVxuICAgICAgICAgIC5hcHBlbmRUbyh0ZXh0UGFuZWwpO1xuXG4gICAgICAgICQoaW5wdXRUZXh0KS5jaGFuZ2UoZnVuY3Rpb24oKXtcbiAgICAgICAgICBpbnB1dC52YWwoaW5wdXRUZXh0LnZhbCgpKTtcbiAgICAgICAgICB1cGRhdGVGcm9tSW5wdXQoaW5wdXQsIHRydWUpO1xuICAgICAgICB9KVxuXG4gICAgICB9XG5cbiAgICAgIC8vIElubGluZSBjb250cm9sc1xuICAgICAgaWYoIHNldHRpbmdzLmlubGluZSApIGlucHV0LnBhcmVudCgpLmFkZENsYXNzKCdtaW5pY29sb3JzLWlubGluZScpO1xuXG4gICAgICB1cGRhdGVGcm9tSW5wdXQoaW5wdXQsIGZhbHNlKTtcblxuICAgICAgaW5wdXQuZGF0YSgnbWluaWNvbG9ycy1pbml0aWFsaXplZCcsIHRydWUpO1xuXG4gICAgfVxuXG4gICAgLy8gUmV0dXJucyB0aGUgaW5wdXQgYmFjayB0byBpdHMgb3JpZ2luYWwgc3RhdGVcbiAgICBmdW5jdGlvbiBkZXN0cm95KGlucHV0KSB7XG5cbiAgICAgIHZhciBtaW5pY29sb3JzID0gaW5wdXQucGFyZW50KCk7XG5cbiAgICAgIC8vIFJldmVydCB0aGUgaW5wdXQgZWxlbWVudFxuICAgICAgaW5wdXRcbiAgICAgICAgLnJlbW92ZURhdGEoJ21pbmljb2xvcnMtaW5pdGlhbGl6ZWQnKVxuICAgICAgICAucmVtb3ZlRGF0YSgnbWluaWNvbG9ycy1zZXR0aW5ncycpXG4gICAgICAgIC5yZW1vdmVQcm9wKCdzaXplJylcbiAgICAgICAgLnJlbW92ZUNsYXNzKCdtaW5pY29sb3JzLWlucHV0Jyk7XG5cbiAgICAgIC8vIFJlbW92ZSB0aGUgd3JhcCBhbmQgZGVzdHJveSB3aGF0ZXZlciByZW1haW5zXG4gICAgICBtaW5pY29sb3JzLmJlZm9yZShpbnB1dCkucmVtb3ZlKCk7XG5cbiAgICB9XG5cbiAgICAvLyBTaG93cyB0aGUgc3BlY2lmaWVkIGRyb3Bkb3duIHBhbmVsXG4gICAgZnVuY3Rpb24gc2hvdyhpbnB1dCkge1xuXG4gICAgICB2YXIgbWluaWNvbG9ycyA9IGlucHV0LnBhcmVudCgpLFxuICAgICAgICBwYW5lbCA9IG1pbmljb2xvcnMuZmluZCgnLm1pbmljb2xvcnMtcGFuZWwnKSxcbiAgICAgICAgc2V0dGluZ3MgPSBpbnB1dC5kYXRhKCdtaW5pY29sb3JzLXNldHRpbmdzJyk7XG5cbiAgICAgIC8vIERvIG5vdGhpbmcgaWYgdW5pbml0aWFsaXplZCwgZGlzYWJsZWQsIGlubGluZSwgb3IgYWxyZWFkeSBvcGVuXG4gICAgICBpZiggIWlucHV0LmRhdGEoJ21pbmljb2xvcnMtaW5pdGlhbGl6ZWQnKSB8fFxuICAgICAgICBpbnB1dC5wcm9wKCdkaXNhYmxlZCcpIHx8XG4gICAgICAgIG1pbmljb2xvcnMuaGFzQ2xhc3MoJ21pbmljb2xvcnMtaW5saW5lJykgfHxcbiAgICAgICAgbWluaWNvbG9ycy5oYXNDbGFzcygnbWluaWNvbG9ycy1mb2N1cycpXG4gICAgICApIHJldHVybjtcblxuICAgICAgaGlkZSgpO1xuXG4gICAgICBtaW5pY29sb3JzLmFkZENsYXNzKCdtaW5pY29sb3JzLWZvY3VzJyk7XG4gICAgICBwYW5lbFxuICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAuZmFkZUluKHNldHRpbmdzLnNob3dTcGVlZCwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaWYoIHNldHRpbmdzLnNob3cgKSBzZXR0aW5ncy5zaG93LmNhbGwoaW5wdXQuZ2V0KDApKTtcbiAgICAgICAgfSk7XG5cbiAgICB9XG5cbiAgICAvLyBIaWRlcyBhbGwgZHJvcGRvd24gcGFuZWxzXG4gICAgZnVuY3Rpb24gaGlkZSgpIHtcblxuICAgICAgJCgnLm1pbmljb2xvcnMtZm9jdXMnKS5lYWNoKCBmdW5jdGlvbigpIHtcblxuICAgICAgICB2YXIgbWluaWNvbG9ycyA9ICQodGhpcyksXG4gICAgICAgICAgaW5wdXQgPSBtaW5pY29sb3JzLmZpbmQoJy5taW5pY29sb3JzLWlucHV0JyksXG4gICAgICAgICAgcGFuZWwgPSBtaW5pY29sb3JzLmZpbmQoJy5taW5pY29sb3JzLXBhbmVsJyksXG4gICAgICAgICAgc2V0dGluZ3MgPSBpbnB1dC5kYXRhKCdtaW5pY29sb3JzLXNldHRpbmdzJyk7XG5cbiAgICAgICAgcGFuZWwuZmFkZU91dChzZXR0aW5ncy5oaWRlU3BlZWQsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGlmKCBzZXR0aW5ncy5oaWRlICkgc2V0dGluZ3MuaGlkZS5jYWxsKGlucHV0LmdldCgwKSk7XG4gICAgICAgICAgbWluaWNvbG9ycy5yZW1vdmVDbGFzcygnbWluaWNvbG9ycy1mb2N1cycpO1xuICAgICAgICB9KTtcblxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gTW92ZXMgdGhlIHNlbGVjdGVkIHBpY2tlclxuICAgIGZ1bmN0aW9uIG1vdmUodGFyZ2V0LCBldmVudCwgYW5pbWF0ZSkge1xuXG4gICAgICB2YXIgaW5wdXQgPSAgdGFyZ2V0LnBhcmVudHMoJy5taW5pY29sb3JzJykuZmluZCgnLm1pbmljb2xvcnMtaW5wdXQnKSxcbiAgICAgICAgc2V0dGluZ3MgPSBpbnB1dC5kYXRhKCdtaW5pY29sb3JzLXNldHRpbmdzJyksXG4gICAgICAgIHBpY2tlciA9IHRhcmdldC5maW5kKCdbY2xhc3MkPS1waWNrZXJdJyksXG4gICAgICAgIG9mZnNldFggPSB0YXJnZXQub2Zmc2V0KCkubGVmdCxcbiAgICAgICAgb2Zmc2V0WSA9IHRhcmdldC5vZmZzZXQoKS50b3AsXG4gICAgICAgIHggPSBNYXRoLnJvdW5kKGV2ZW50LnBhZ2VYIC0gb2Zmc2V0WCksXG4gICAgICAgIHkgPSBNYXRoLnJvdW5kKGV2ZW50LnBhZ2VZIC0gb2Zmc2V0WSksXG4gICAgICAgIGR1cmF0aW9uID0gYW5pbWF0ZSA/IHNldHRpbmdzLmFuaW1hdGlvblNwZWVkIDogMCxcbiAgICAgICAgd3gsIHd5LCByLCBwaGk7XG5cbiAgICAgIC8vIFRvdWNoIHN1cHBvcnRcbiAgICAgIGlmKCBldmVudC5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzICkge1xuICAgICAgICB4ID0gZXZlbnQub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWCAtIG9mZnNldFg7XG4gICAgICAgIHkgPSBldmVudC5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VZIC0gb2Zmc2V0WTtcbiAgICAgIH1cblxuICAgICAgLy8gQ29uc3RyYWluIHBpY2tlciB0byBpdHMgY29udGFpbmVyXG4gICAgICBpZiggeCA8IDAgKSB4ID0gMDtcbiAgICAgIGlmKCB5IDwgMCApIHkgPSAwO1xuICAgICAgaWYoIHggPiB0YXJnZXQud2lkdGgoKSApIHggPSB0YXJnZXQud2lkdGgoKTtcbiAgICAgIGlmKCB5ID4gdGFyZ2V0LmhlaWdodCgpICkgeSA9IHRhcmdldC5oZWlnaHQoKTtcblxuICAgICAgLy8gQ29uc3RyYWluIGNvbG9yIHdoZWVsIHZhbHVlcyB0byB0aGUgd2hlZWxcbiAgICAgIGlmKCB0YXJnZXQucGFyZW50KCkuaXMoJy5taW5pY29sb3JzLXNsaWRlci13aGVlbCcpICYmIHBpY2tlci5wYXJlbnQoKS5pcygnLm1pbmljb2xvcnMtZ3JpZCcpICkge1xuICAgICAgICB3eCA9IDc1IC0geDtcbiAgICAgICAgd3kgPSA3NSAtIHk7XG4gICAgICAgIHIgPSBNYXRoLnNxcnQod3ggKiB3eCArIHd5ICogd3kpO1xuICAgICAgICBwaGkgPSBNYXRoLmF0YW4yKHd5LCB3eCk7XG4gICAgICAgIGlmKCBwaGkgPCAwICkgcGhpICs9IE1hdGguUEkgKiAyO1xuICAgICAgICBpZiggciA+IDc1ICkge1xuICAgICAgICAgIHIgPSA3NTtcbiAgICAgICAgICB4ID0gNzUgLSAoNzUgKiBNYXRoLmNvcyhwaGkpKTtcbiAgICAgICAgICB5ID0gNzUgLSAoNzUgKiBNYXRoLnNpbihwaGkpKTtcbiAgICAgICAgfVxuICAgICAgICB4ID0gTWF0aC5yb3VuZCh4KTtcbiAgICAgICAgeSA9IE1hdGgucm91bmQoeSk7XG4gICAgICB9XG5cbiAgICAgIC8vIE1vdmUgdGhlIHBpY2tlclxuICAgICAgaWYoIHRhcmdldC5pcygnLm1pbmljb2xvcnMtZ3JpZCcpICkge1xuICAgICAgICBwaWNrZXJcbiAgICAgICAgICAuc3RvcCh0cnVlKVxuICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgIHRvcDogeSArICdweCcsXG4gICAgICAgICAgICBsZWZ0OiB4ICsgJ3B4J1xuICAgICAgICAgIH0sIGR1cmF0aW9uLCBzZXR0aW5ncy5hbmltYXRpb25FYXNpbmcsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdXBkYXRlRnJvbUNvbnRyb2woaW5wdXQsIHRhcmdldCk7XG4gICAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBwaWNrZXJcbiAgICAgICAgICAuc3RvcCh0cnVlKVxuICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgIHRvcDogeSArICdweCdcbiAgICAgICAgICB9LCBkdXJhdGlvbiwgc2V0dGluZ3MuYW5pbWF0aW9uRWFzaW5nLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHVwZGF0ZUZyb21Db250cm9sKGlucHV0LCB0YXJnZXQpO1xuICAgICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgfVxuXG4gICAgLy8gU2V0cyB0aGUgaW5wdXQgYmFzZWQgb24gdGhlIGNvbG9yIHBpY2tlciB2YWx1ZXNcbiAgICBmdW5jdGlvbiB1cGRhdGVGcm9tQ29udHJvbChpbnB1dCwgdGFyZ2V0KSB7XG5cbiAgICAgIGZ1bmN0aW9uIGdldENvb3JkcyhwaWNrZXIsIGNvbnRhaW5lcikge1xuXG4gICAgICAgIHZhciBsZWZ0LCB0b3A7XG4gICAgICAgIGlmKCAhcGlja2VyLmxlbmd0aCB8fCAhY29udGFpbmVyICkgcmV0dXJuIG51bGw7XG4gICAgICAgIGxlZnQgPSBwaWNrZXIub2Zmc2V0KCkubGVmdDtcbiAgICAgICAgdG9wID0gcGlja2VyLm9mZnNldCgpLnRvcDtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHg6IGxlZnQgLSBjb250YWluZXIub2Zmc2V0KCkubGVmdCArIChwaWNrZXIub3V0ZXJXaWR0aCgpIC8gMiksXG4gICAgICAgICAgeTogdG9wIC0gY29udGFpbmVyLm9mZnNldCgpLnRvcCArIChwaWNrZXIub3V0ZXJIZWlnaHQoKSAvIDIpXG4gICAgICAgIH07XG5cbiAgICAgIH1cblxuICAgICAgdmFyIGh1ZSwgc2F0dXJhdGlvbiwgYnJpZ2h0bmVzcywgeCwgeSwgciwgcGhpLFxuXG4gICAgICAgIGhleCA9IGlucHV0LnZhbCgpLFxuICAgICAgICBvcGFjaXR5ID0gaW5wdXQuYXR0cignZGF0YS1vcGFjaXR5JyksXG5cbiAgICAgIC8vIEhlbHBmdWwgcmVmZXJlbmNlc1xuICAgICAgICBtaW5pY29sb3JzID0gaW5wdXQucGFyZW50KCksXG4gICAgICAgIHNldHRpbmdzID0gaW5wdXQuZGF0YSgnbWluaWNvbG9ycy1zZXR0aW5ncycpLFxuICAgICAgICBzd2F0Y2ggPSBtaW5pY29sb3JzLmZpbmQoJy5taW5pY29sb3JzLWlucHV0LXN3YXRjaCcpLFxuXG4gICAgICAvLyBQYW5lbCBvYmplY3RzXG4gICAgICAgIGdyaWQgPSBtaW5pY29sb3JzLmZpbmQoJy5taW5pY29sb3JzLWdyaWQnKSxcbiAgICAgICAgc2xpZGVyID0gbWluaWNvbG9ycy5maW5kKCcubWluaWNvbG9ycy1zbGlkZXInKSxcbiAgICAgICAgb3BhY2l0eVNsaWRlciA9IG1pbmljb2xvcnMuZmluZCgnLm1pbmljb2xvcnMtb3BhY2l0eS1zbGlkZXInKSxcblxuICAgICAgLy8gUGlja2VyIG9iamVjdHNcbiAgICAgICAgZ3JpZFBpY2tlciA9IGdyaWQuZmluZCgnW2NsYXNzJD0tcGlja2VyXScpLFxuICAgICAgICBzbGlkZXJQaWNrZXIgPSBzbGlkZXIuZmluZCgnW2NsYXNzJD0tcGlja2VyXScpLFxuICAgICAgICBvcGFjaXR5UGlja2VyID0gb3BhY2l0eVNsaWRlci5maW5kKCdbY2xhc3MkPS1waWNrZXJdJyksXG5cbiAgICAgIC8vIFBpY2tlciBwb3NpdGlvbnNcbiAgICAgICAgZ3JpZFBvcyA9IGdldENvb3JkcyhncmlkUGlja2VyLCBncmlkKSxcbiAgICAgICAgc2xpZGVyUG9zID0gZ2V0Q29vcmRzKHNsaWRlclBpY2tlciwgc2xpZGVyKSxcbiAgICAgICAgb3BhY2l0eVBvcyA9IGdldENvb3JkcyhvcGFjaXR5UGlja2VyLCBvcGFjaXR5U2xpZGVyKTtcblxuICAgICAgLy8gSGFuZGxlIGNvbG9yc1xuICAgICAgaWYoIHRhcmdldC5pcygnLm1pbmljb2xvcnMtZ3JpZCwgLm1pbmljb2xvcnMtc2xpZGVyLCAubWluaWNvbG9ycy1vcGFjaXR5LXNsaWRlcicpICkge1xuXG4gICAgICAgIC8vIERldGVybWluZSBIU0IgdmFsdWVzXG4gICAgICAgIHN3aXRjaChzZXR0aW5ncy5jb250cm9sKSB7XG5cbiAgICAgICAgICBjYXNlICd3aGVlbCc6XG4gICAgICAgICAgICAvLyBDYWxjdWxhdGUgaHVlLCBzYXR1cmF0aW9uLCBhbmQgYnJpZ2h0bmVzc1xuICAgICAgICAgICAgeCA9IChncmlkLndpZHRoKCkgLyAyKSAtIGdyaWRQb3MueDtcbiAgICAgICAgICAgIHkgPSAoZ3JpZC5oZWlnaHQoKSAvIDIpIC0gZ3JpZFBvcy55O1xuICAgICAgICAgICAgciA9IE1hdGguc3FydCh4ICogeCArIHkgKiB5KTtcbiAgICAgICAgICAgIHBoaSA9IE1hdGguYXRhbjIoeSwgeCk7XG4gICAgICAgICAgICBpZiggcGhpIDwgMCApIHBoaSArPSBNYXRoLlBJICogMjtcbiAgICAgICAgICAgIGlmKCByID4gNzUgKSB7XG4gICAgICAgICAgICAgIHIgPSA3NTtcbiAgICAgICAgICAgICAgZ3JpZFBvcy54ID0gNjkgLSAoNzUgKiBNYXRoLmNvcyhwaGkpKTtcbiAgICAgICAgICAgICAgZ3JpZFBvcy55ID0gNjkgLSAoNzUgKiBNYXRoLnNpbihwaGkpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHNhdHVyYXRpb24gPSBrZWVwV2l0aGluKHIgLyAwLjc1LCAwLCAxMDApO1xuICAgICAgICAgICAgaHVlID0ga2VlcFdpdGhpbihwaGkgKiAxODAgLyBNYXRoLlBJLCAwLCAzNjApO1xuICAgICAgICAgICAgYnJpZ2h0bmVzcyA9IGtlZXBXaXRoaW4oMTAwIC0gTWF0aC5mbG9vcihzbGlkZXJQb3MueSAqICgxMDAgLyBzbGlkZXIuaGVpZ2h0KCkpKSwgMCwgMTAwKTtcbiAgICAgICAgICAgIGhleCA9IGhzYjJoZXgoe1xuICAgICAgICAgICAgICBoOiBodWUsXG4gICAgICAgICAgICAgIHM6IHNhdHVyYXRpb24sXG4gICAgICAgICAgICAgIGI6IGJyaWdodG5lc3NcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBVcGRhdGUgVUlcbiAgICAgICAgICAgIHNsaWRlci5jc3MoJ2JhY2tncm91bmRDb2xvcicsIGhzYjJoZXgoeyBoOiBodWUsIHM6IHNhdHVyYXRpb24sIGI6IDEwMCB9KSk7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGNhc2UgJ3NhdHVyYXRpb24nOlxuICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIGh1ZSwgc2F0dXJhdGlvbiwgYW5kIGJyaWdodG5lc3NcbiAgICAgICAgICAgIGh1ZSA9IGtlZXBXaXRoaW4ocGFyc2VJbnQoZ3JpZFBvcy54ICogKDM2MCAvIGdyaWQud2lkdGgoKSksIDEwKSwgMCwgMzYwKTtcbiAgICAgICAgICAgIHNhdHVyYXRpb24gPSBrZWVwV2l0aGluKDEwMCAtIE1hdGguZmxvb3Ioc2xpZGVyUG9zLnkgKiAoMTAwIC8gc2xpZGVyLmhlaWdodCgpKSksIDAsIDEwMCk7XG4gICAgICAgICAgICBicmlnaHRuZXNzID0ga2VlcFdpdGhpbigxMDAgLSBNYXRoLmZsb29yKGdyaWRQb3MueSAqICgxMDAgLyBncmlkLmhlaWdodCgpKSksIDAsIDEwMCk7XG4gICAgICAgICAgICBoZXggPSBoc2IyaGV4KHtcbiAgICAgICAgICAgICAgaDogaHVlLFxuICAgICAgICAgICAgICBzOiBzYXR1cmF0aW9uLFxuICAgICAgICAgICAgICBiOiBicmlnaHRuZXNzXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gVXBkYXRlIFVJXG4gICAgICAgICAgICBzbGlkZXIuY3NzKCdiYWNrZ3JvdW5kQ29sb3InLCBoc2IyaGV4KHsgaDogaHVlLCBzOiAxMDAsIGI6IGJyaWdodG5lc3MgfSkpO1xuICAgICAgICAgICAgbWluaWNvbG9ycy5maW5kKCcubWluaWNvbG9ycy1ncmlkLWlubmVyJykuY3NzKCdvcGFjaXR5Jywgc2F0dXJhdGlvbiAvIDEwMCk7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGNhc2UgJ2JyaWdodG5lc3MnOlxuICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIGh1ZSwgc2F0dXJhdGlvbiwgYW5kIGJyaWdodG5lc3NcbiAgICAgICAgICAgIGh1ZSA9IGtlZXBXaXRoaW4ocGFyc2VJbnQoZ3JpZFBvcy54ICogKDM2MCAvIGdyaWQud2lkdGgoKSksIDEwKSwgMCwgMzYwKTtcbiAgICAgICAgICAgIHNhdHVyYXRpb24gPSBrZWVwV2l0aGluKDEwMCAtIE1hdGguZmxvb3IoZ3JpZFBvcy55ICogKDEwMCAvIGdyaWQuaGVpZ2h0KCkpKSwgMCwgMTAwKTtcbiAgICAgICAgICAgIGJyaWdodG5lc3MgPSBrZWVwV2l0aGluKDEwMCAtIE1hdGguZmxvb3Ioc2xpZGVyUG9zLnkgKiAoMTAwIC8gc2xpZGVyLmhlaWdodCgpKSksIDAsIDEwMCk7XG4gICAgICAgICAgICBoZXggPSBoc2IyaGV4KHtcbiAgICAgICAgICAgICAgaDogaHVlLFxuICAgICAgICAgICAgICBzOiBzYXR1cmF0aW9uLFxuICAgICAgICAgICAgICBiOiBicmlnaHRuZXNzXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gVXBkYXRlIFVJXG4gICAgICAgICAgICBzbGlkZXIuY3NzKCdiYWNrZ3JvdW5kQ29sb3InLCBoc2IyaGV4KHsgaDogaHVlLCBzOiBzYXR1cmF0aW9uLCBiOiAxMDAgfSkpO1xuICAgICAgICAgICAgbWluaWNvbG9ycy5maW5kKCcubWluaWNvbG9ycy1ncmlkLWlubmVyJykuY3NzKCdvcGFjaXR5JywgMSAtIChicmlnaHRuZXNzIC8gMTAwKSk7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAvLyBDYWxjdWxhdGUgaHVlLCBzYXR1cmF0aW9uLCBhbmQgYnJpZ2h0bmVzc1xuICAgICAgICAgICAgaHVlID0ga2VlcFdpdGhpbigzNjAgLSBwYXJzZUludChzbGlkZXJQb3MueSAqICgzNjAgLyBzbGlkZXIuaGVpZ2h0KCkpLCAxMCksIDAsIDM2MCk7XG4gICAgICAgICAgICBzYXR1cmF0aW9uID0ga2VlcFdpdGhpbihNYXRoLmZsb29yKGdyaWRQb3MueCAqICgxMDAgLyBncmlkLndpZHRoKCkpKSwgMCwgMTAwKTtcbiAgICAgICAgICAgIGJyaWdodG5lc3MgPSBrZWVwV2l0aGluKDEwMCAtIE1hdGguZmxvb3IoZ3JpZFBvcy55ICogKDEwMCAvIGdyaWQuaGVpZ2h0KCkpKSwgMCwgMTAwKTtcbiAgICAgICAgICAgIGhleCA9IGhzYjJoZXgoe1xuICAgICAgICAgICAgICBoOiBodWUsXG4gICAgICAgICAgICAgIHM6IHNhdHVyYXRpb24sXG4gICAgICAgICAgICAgIGI6IGJyaWdodG5lc3NcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBVcGRhdGUgVUlcbiAgICAgICAgICAgIGdyaWQuY3NzKCdiYWNrZ3JvdW5kQ29sb3InLCBoc2IyaGV4KHsgaDogaHVlLCBzOiAxMDAsIGI6IDEwMCB9KSk7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICB9XG5cbiAgICAgICAgLy8gSGFuZGxlIG9wYWNpdHlcbiAgICAgICAgaWYoIHNldHRpbmdzLm9wYWNpdHkgKSB7XG4gICAgICAgICAgb3BhY2l0eSA9IHBhcnNlRmxvYXQoMSAtIChvcGFjaXR5UG9zLnkgLyBvcGFjaXR5U2xpZGVyLmhlaWdodCgpKSkudG9GaXhlZCgyKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBvcGFjaXR5ID0gMTtcbiAgICAgICAgfVxuXG4gICAgICAgIHVwZGF0ZUlucHV0KGlucHV0LCBoZXgsIG9wYWNpdHkpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIC8vIFNldCBzd2F0Y2ggY29sb3JcbiAgICAgICAgc3dhdGNoLmZpbmQoJ3NwYW4nKS5jc3Moe1xuICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogaGV4LFxuICAgICAgICAgIG9wYWNpdHk6IG9wYWNpdHlcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gSGFuZGxlIGNoYW5nZSBldmVudFxuICAgICAgICBkb0NoYW5nZShpbnB1dCwgaGV4LCBvcGFjaXR5KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBTZXRzIHRoZSB2YWx1ZSBvZiB0aGUgaW5wdXQgYW5kIGRvZXMgdGhlIGFwcHJvcHJpYXRlIGNvbnZlcnNpb25zXG4gICAgLy8gdG8gcmVzcGVjdCBzZXR0aW5ncywgYWxzbyB1cGRhdGVzIHRoZSBzd2F0Y2hcbiAgICBmdW5jdGlvbiB1cGRhdGVJbnB1dChpbnB1dCwgdmFsdWUsIG9wYWNpdHkpIHtcbiAgICAgIHZhciByZ2IsXG5cbiAgICAgIC8vIEhlbHBmdWwgcmVmZXJlbmNlc1xuICAgICAgICBtaW5pY29sb3JzID0gaW5wdXQucGFyZW50KCksXG4gICAgICAgIHNldHRpbmdzID0gaW5wdXQuZGF0YSgnbWluaWNvbG9ycy1zZXR0aW5ncycpLFxuICAgICAgICBzd2F0Y2ggPSBtaW5pY29sb3JzLmZpbmQoJy5taW5pY29sb3JzLWlucHV0LXN3YXRjaCcpO1xuXG4gICAgICBpZiggc2V0dGluZ3Mub3BhY2l0eSApIGlucHV0LmF0dHIoJ2RhdGEtb3BhY2l0eScsIG9wYWNpdHkpO1xuXG4gICAgICAvLyBTZXQgY29sb3Igc3RyaW5nXG4gICAgICBpZiggc2V0dGluZ3MuZm9ybWF0ID09PSAncmdiJyApIHtcbiAgICAgICAgLy8gUmV0dXJucyBSR0IoQSkgc3RyaW5nXG5cbiAgICAgICAgLy8gQ2hlY2tzIGZvciBpbnB1dCBmb3JtYXQgYW5kIGRvZXMgdGhlIGNvbnZlcnNpb25cbiAgICAgICAgaWYgKCBpc1JnYih2YWx1ZSkgKSB7XG4gICAgICAgICAgcmdiID0gcGFyc2VSZ2IodmFsdWUsIHRydWUpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIHJnYiA9IGhleDJyZ2IocGFyc2VIZXgodmFsdWUsIHRydWUpKTtcbiAgICAgICAgfVxuXG5cbiAgICAgICAgb3BhY2l0eSA9IGlucHV0LmF0dHIoJ2RhdGEtb3BhY2l0eScpID09PSAnJyA/IDEgOiBrZWVwV2l0aGluKCBwYXJzZUZsb2F0KCBpbnB1dC5hdHRyKCdkYXRhLW9wYWNpdHknKSApLnRvRml4ZWQoMiksIDAsIDEgKTtcbiAgICAgICAgaWYoIGlzTmFOKCBvcGFjaXR5ICkgfHwgIXNldHRpbmdzLm9wYWNpdHkgKSBvcGFjaXR5ID0gMTtcblxuICAgICAgICBpZiggaW5wdXQubWluaWNvbG9ycygncmdiT2JqZWN0JykuYSA8PSAxICYmIHJnYiAmJiBzZXR0aW5ncy5vcGFjaXR5KSB7XG4gICAgICAgICAgLy8gU2V0IFJHQkEgc3RyaW5nIGlmIGFscGhhXG4gICAgICAgICAgdmFsdWUgPSAncmdiYSgnICsgcmdiLnIgKyAnLCAnICsgcmdiLmcgKyAnLCAnICsgcmdiLmIgKyAnLCAnICsgcGFyc2VGbG9hdCggb3BhY2l0eSApICsgJyknO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIFNldCBSR0Igc3RyaW5nIChhbHBoYSA9IDEpXG4gICAgICAgICAgdmFsdWUgPSAncmdiKCcgKyByZ2IuciArICcsICcgKyByZ2IuZyArICcsICcgKyByZ2IuYiArICcpJztcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gUmV0dXJucyBoZXggY29sb3JcblxuICAgICAgICAvLyBDaGVja3MgZm9yIGlucHV0IGZvcm1hdCBhbmQgZG9lcyB0aGUgY29udmVyc2lvblxuICAgICAgICBpZiAoIGlzUmdiKHZhbHVlKSApIHtcbiAgICAgICAgICB2YWx1ZSA9IHJnYlN0cmluZzJoZXgodmFsdWUpO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFsdWUgPSBjb252ZXJ0Q2FzZSggdmFsdWUsIHNldHRpbmdzLmxldHRlckNhc2UgKTtcbiAgICAgIH1cblxuXG5cblxuICAgICAgLy8gVXBkYXRlIHZhbHVlIGZyb20gcGlja2VyXG4gICAgICAvL2dsb2JhbElucHV0LnZhbCggdmFsdWUgKTtcbiAgICAgIGlucHV0LnZhbCggdmFsdWUgKTtcblxuICAgICAgaWYoaW5wdXRUZXh0KXtcbiAgICAgICAgaW5wdXRUZXh0LnZhbCh2YWx1ZSk7XG4gICAgICB9XG5cblxuICAgICAgLy8gU2V0IHN3YXRjaCBjb2xvclxuICAgICAgc3dhdGNoLmZpbmQoJ3NwYW4nKS5jc3Moe1xuICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IHZhbHVlLFxuICAgICAgICBvcGFjaXR5OiBvcGFjaXR5XG4gICAgICB9KTtcblxuICAgICAgLy8gSGFuZGxlIGNoYW5nZSBldmVudFxuICAgICAgZG9DaGFuZ2UoaW5wdXQsIHZhbHVlLCBvcGFjaXR5KTtcbiAgICB9XG5cbiAgICAvLyBTZXRzIHRoZSBjb2xvciBwaWNrZXIgdmFsdWVzIGZyb20gdGhlIGlucHV0XG4gICAgZnVuY3Rpb24gdXBkYXRlRnJvbUlucHV0KGlucHV0LCBwcmVzZXJ2ZUlucHV0VmFsdWUpIHtcbiAgICAgdmFyICBzZXR0aW5ncyA9IGdsb2JhbFNldHRpbmdzO1xuICAgICAgdmFyIGhleCxcbiAgICAgICAgaHNiLFxuICAgICAgICBvcGFjaXR5LFxuICAgICAgICBrZXl3b3JkcyxcbiAgICAgICAgYWxwaGEsXG4gICAgICAgIHZhbHVlLFxuICAgICAgICB4LCB5LCByLCBwaGksXG5cbiAgICAgIC8vIEhlbHBmdWwgcmVmZXJlbmNlc1xuICAgICAgICBtaW5pY29sb3JzID0gaW5wdXQucGFyZW50KCksXG4gICAgICAvLyAgc2V0dGluZ3MgPSBpbnB1dC5kYXRhKCdtaW5pY29sb3JzLXNldHRpbmdzJyksXG4gICAgICAgIHN3YXRjaCA9IG1pbmljb2xvcnMuZmluZCgnLm1pbmljb2xvcnMtaW5wdXQtc3dhdGNoJyksXG5cbiAgICAgIC8vIFBhbmVsIG9iamVjdHNcbiAgICAgICAgZ3JpZCA9IG1pbmljb2xvcnMuZmluZCgnLm1pbmljb2xvcnMtZ3JpZCcpLFxuICAgICAgICBzbGlkZXIgPSBtaW5pY29sb3JzLmZpbmQoJy5taW5pY29sb3JzLXNsaWRlcicpLFxuICAgICAgICBvcGFjaXR5U2xpZGVyID0gbWluaWNvbG9ycy5maW5kKCcubWluaWNvbG9ycy1vcGFjaXR5LXNsaWRlcicpLFxuXG4gICAgICAvLyBQaWNrZXIgb2JqZWN0c1xuICAgICAgICBncmlkUGlja2VyID0gZ3JpZC5maW5kKCdbY2xhc3MkPS1waWNrZXJdJyksXG4gICAgICAgIHNsaWRlclBpY2tlciA9IHNsaWRlci5maW5kKCdbY2xhc3MkPS1waWNrZXJdJyksXG4gICAgICAgIG9wYWNpdHlQaWNrZXIgPSBvcGFjaXR5U2xpZGVyLmZpbmQoJ1tjbGFzcyQ9LXBpY2tlcl0nKTtcblxuICAgICAgLy8gRGV0ZXJtaW5lIGhleC9IU0IgdmFsdWVzXG4gICAgICBpZiggaXNSZ2IoaW5wdXQudmFsKCkpICkge1xuICAgICAgICAvLyBJZiBpbnB1dCB2YWx1ZSBpcyBhIHJnYihhKSBzdHJpbmcsIGNvbnZlcnQgaXQgdG8gaGV4IGNvbG9yIGFuZCB1cGRhdGUgb3BhY2l0eVxuICAgICAgICBoZXggPSByZ2JTdHJpbmcyaGV4KGlucHV0LnZhbCgpKTtcbiAgICAgICAgYWxwaGEgPSBrZWVwV2l0aGluKHBhcnNlRmxvYXQoZ2V0QWxwaGEoaW5wdXQudmFsKCkpKS50b0ZpeGVkKDIpLCAwLCAxKTtcbiAgICAgICAgaWYoIGFscGhhICkge1xuICAgICAgICAgIGlucHV0LmF0dHIoJ2RhdGEtb3BhY2l0eScsIGFscGhhKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaGV4ID0gY29udmVydENhc2UocGFyc2VIZXgoaW5wdXQudmFsKCksIHRydWUpLCBzZXR0aW5ncy5sZXR0ZXJDYXNlKTtcbiAgICAgIH1cblxuICAgICAgaWYoICFoZXggKXtcbiAgICAgICAgaGV4ID0gY29udmVydENhc2UocGFyc2VJbnB1dChzZXR0aW5ncy5kZWZhdWx0VmFsdWUsIHRydWUpLCBzZXR0aW5ncy5sZXR0ZXJDYXNlKTtcbiAgICAgIH1cbiAgICAgIGhzYiA9IGhleDJoc2IoaGV4KTtcblxuICAgICAgLy8gR2V0IGFycmF5IG9mIGxvd2VyY2FzZSBrZXl3b3Jkc1xuICAgICAga2V5d29yZHMgPSAhc2V0dGluZ3Mua2V5d29yZHMgPyBbXSA6ICQubWFwKHNldHRpbmdzLmtleXdvcmRzLnNwbGl0KCcsJyksIGZ1bmN0aW9uKGEpIHtcbiAgICAgICAgcmV0dXJuICQudHJpbShhLnRvTG93ZXJDYXNlKCkpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIFNldCBjb2xvciBzdHJpbmdcbiAgICAgIGlmKCBpbnB1dC52YWwoKSAhPT0gJycgJiYgJC5pbkFycmF5KGlucHV0LnZhbCgpLnRvTG93ZXJDYXNlKCksIGtleXdvcmRzKSA+IC0xICkge1xuICAgICAgICB2YWx1ZSA9IGNvbnZlcnRDYXNlKGlucHV0LnZhbCgpKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhbHVlID0gaXNSZ2IoaW5wdXQudmFsKCkpID8gcGFyc2VSZ2IoaW5wdXQudmFsKCkpIDogaGV4O1xuICAgICAgfVxuXG4gICAgICAvLyBVcGRhdGUgaW5wdXQgdmFsdWVcbiAgICAgIGlmKCAhcHJlc2VydmVJbnB1dFZhbHVlICl7XG4gICAgICAgIGdsb2JhbElucHV0LnZhbCh2YWx1ZSk7XG5cbiAgICAgICAgaW5wdXRUZXh0ICYmIGlucHV0VGV4dC52YWwodmFsdWUpO1xuICAgICAgfVxuICAgICAgZ2xvYmFsU2V0dGluZ3MgPSBzZXR0aW5nc1xuICAgICAgLy8gRGV0ZXJtaW5lIG9wYWNpdHkgdmFsdWVcbiAgICAgIGlmKCBzZXR0aW5ncy5vcGFjaXR5ICkge1xuICAgICAgICAvLyBHZXQgZnJvbSBkYXRhLW9wYWNpdHkgYXR0cmlidXRlIGFuZCBrZWVwIHdpdGhpbiAwLTEgcmFuZ2VcbiAgICAgICAgb3BhY2l0eSA9IGlucHV0LmF0dHIoJ2RhdGEtb3BhY2l0eScpID09PSAnJyA/IDEgOiBrZWVwV2l0aGluKHBhcnNlRmxvYXQoaW5wdXQuYXR0cignZGF0YS1vcGFjaXR5JykpLnRvRml4ZWQoMiksIDAsIDEpO1xuICAgICAgICBpZiggaXNOYU4ob3BhY2l0eSkgKSBvcGFjaXR5ID0gMTtcbiAgICAgICAgaW5wdXQuYXR0cignZGF0YS1vcGFjaXR5Jywgb3BhY2l0eSk7XG4gICAgICAgIHN3YXRjaC5maW5kKCdzcGFuJykuY3NzKCdvcGFjaXR5Jywgb3BhY2l0eSk7XG5cbiAgICAgICAgLy8gU2V0IG9wYWNpdHkgcGlja2VyIHBvc2l0aW9uXG4gICAgICAgIHkgPSBrZWVwV2l0aGluKG9wYWNpdHlTbGlkZXIuaGVpZ2h0KCkgLSAob3BhY2l0eVNsaWRlci5oZWlnaHQoKSAqIG9wYWNpdHkpLCAwLCBvcGFjaXR5U2xpZGVyLmhlaWdodCgpKTtcbiAgICAgICAgb3BhY2l0eVBpY2tlci5jc3MoJ3RvcCcsIHkgKyAncHgnKTtcbiAgICAgIH1cblxuICAgICAgLy8gU2V0IG9wYWNpdHkgdG8gemVybyBpZiBpbnB1dCB2YWx1ZSBpcyB0cmFuc3BhcmVudFxuICAgICAgaWYoIGlucHV0LnZhbCgpLnRvTG93ZXJDYXNlKCkgPT09ICd0cmFuc3BhcmVudCcgKSB7XG4gICAgICAgIHN3YXRjaC5maW5kKCdzcGFuJykuY3NzKCdvcGFjaXR5JywgMCk7XG4gICAgICB9XG5cbiAgICAgIC8vIFVwZGF0ZSBzd2F0Y2hcbiAgICAgIHN3YXRjaC5maW5kKCdzcGFuJykuY3NzKCdiYWNrZ3JvdW5kQ29sb3InLCBoZXgpO1xuXG4gICAgICAvLyBEZXRlcm1pbmUgcGlja2VyIGxvY2F0aW9uc1xuICAgICAgc3dpdGNoKHNldHRpbmdzLmNvbnRyb2wpIHtcblxuICAgICAgICBjYXNlICd3aGVlbCc6XG4gICAgICAgICAgLy8gU2V0IGdyaWQgcG9zaXRpb25cbiAgICAgICAgICByID0ga2VlcFdpdGhpbihNYXRoLmNlaWwoaHNiLnMgKiAwLjc1KSwgMCwgZ3JpZC5oZWlnaHQoKSAvIDIpO1xuICAgICAgICAgIHBoaSA9IGhzYi5oICogTWF0aC5QSSAvIDE4MDtcbiAgICAgICAgICB4ID0ga2VlcFdpdGhpbig3NSAtIE1hdGguY29zKHBoaSkgKiByLCAwLCBncmlkLndpZHRoKCkpO1xuICAgICAgICAgIHkgPSBrZWVwV2l0aGluKDc1IC0gTWF0aC5zaW4ocGhpKSAqIHIsIDAsIGdyaWQuaGVpZ2h0KCkpO1xuICAgICAgICAgIGdyaWRQaWNrZXIuY3NzKHtcbiAgICAgICAgICAgIHRvcDogeSArICdweCcsXG4gICAgICAgICAgICBsZWZ0OiB4ICsgJ3B4J1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgLy8gU2V0IHNsaWRlciBwb3NpdGlvblxuICAgICAgICAgIHkgPSAxNTAgLSAoaHNiLmIgLyAoMTAwIC8gZ3JpZC5oZWlnaHQoKSkpO1xuICAgICAgICAgIGlmKCBoZXggPT09ICcnICkgeSA9IDA7XG4gICAgICAgICAgc2xpZGVyUGlja2VyLmNzcygndG9wJywgeSArICdweCcpO1xuXG4gICAgICAgICAgLy8gVXBkYXRlIHBhbmVsIGNvbG9yXG4gICAgICAgICAgc2xpZGVyLmNzcygnYmFja2dyb3VuZENvbG9yJywgaHNiMmhleCh7IGg6IGhzYi5oLCBzOiBoc2IucywgYjogMTAwIH0pKTtcbiAgICAgICAgICBicmVhaztcblxuICAgICAgICBjYXNlICdzYXR1cmF0aW9uJzpcbiAgICAgICAgICAvLyBTZXQgZ3JpZCBwb3NpdGlvblxuICAgICAgICAgIHggPSBrZWVwV2l0aGluKCg1ICogaHNiLmgpIC8gMTIsIDAsIDE1MCk7XG4gICAgICAgICAgeSA9IGtlZXBXaXRoaW4oZ3JpZC5oZWlnaHQoKSAtIE1hdGguY2VpbChoc2IuYiAvICgxMDAgLyBncmlkLmhlaWdodCgpKSksIDAsIGdyaWQuaGVpZ2h0KCkpO1xuICAgICAgICAgIGdyaWRQaWNrZXIuY3NzKHtcbiAgICAgICAgICAgIHRvcDogeSArICdweCcsXG4gICAgICAgICAgICBsZWZ0OiB4ICsgJ3B4J1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgLy8gU2V0IHNsaWRlciBwb3NpdGlvblxuICAgICAgICAgIHkgPSBrZWVwV2l0aGluKHNsaWRlci5oZWlnaHQoKSAtIChoc2IucyAqIChzbGlkZXIuaGVpZ2h0KCkgLyAxMDApKSwgMCwgc2xpZGVyLmhlaWdodCgpKTtcbiAgICAgICAgICBzbGlkZXJQaWNrZXIuY3NzKCd0b3AnLCB5ICsgJ3B4Jyk7XG5cbiAgICAgICAgICAvLyBVcGRhdGUgVUlcbiAgICAgICAgICBzbGlkZXIuY3NzKCdiYWNrZ3JvdW5kQ29sb3InLCBoc2IyaGV4KHsgaDogaHNiLmgsIHM6IDEwMCwgYjogaHNiLmIgfSkpO1xuICAgICAgICAgIG1pbmljb2xvcnMuZmluZCgnLm1pbmljb2xvcnMtZ3JpZC1pbm5lcicpLmNzcygnb3BhY2l0eScsIGhzYi5zIC8gMTAwKTtcbiAgICAgICAgICBicmVhaztcblxuICAgICAgICBjYXNlICdicmlnaHRuZXNzJzpcbiAgICAgICAgICAvLyBTZXQgZ3JpZCBwb3NpdGlvblxuICAgICAgICAgIHggPSBrZWVwV2l0aGluKCg1ICogaHNiLmgpIC8gMTIsIDAsIDE1MCk7XG4gICAgICAgICAgeSA9IGtlZXBXaXRoaW4oZ3JpZC5oZWlnaHQoKSAtIE1hdGguY2VpbChoc2IucyAvICgxMDAgLyBncmlkLmhlaWdodCgpKSksIDAsIGdyaWQuaGVpZ2h0KCkpO1xuICAgICAgICAgIGdyaWRQaWNrZXIuY3NzKHtcbiAgICAgICAgICAgIHRvcDogeSArICdweCcsXG4gICAgICAgICAgICBsZWZ0OiB4ICsgJ3B4J1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgLy8gU2V0IHNsaWRlciBwb3NpdGlvblxuICAgICAgICAgIHkgPSBrZWVwV2l0aGluKHNsaWRlci5oZWlnaHQoKSAtIChoc2IuYiAqIChzbGlkZXIuaGVpZ2h0KCkgLyAxMDApKSwgMCwgc2xpZGVyLmhlaWdodCgpKTtcbiAgICAgICAgICBzbGlkZXJQaWNrZXIuY3NzKCd0b3AnLCB5ICsgJ3B4Jyk7XG5cbiAgICAgICAgICAvLyBVcGRhdGUgVUlcbiAgICAgICAgICBzbGlkZXIuY3NzKCdiYWNrZ3JvdW5kQ29sb3InLCBoc2IyaGV4KHsgaDogaHNiLmgsIHM6IGhzYi5zLCBiOiAxMDAgfSkpO1xuICAgICAgICAgIG1pbmljb2xvcnMuZmluZCgnLm1pbmljb2xvcnMtZ3JpZC1pbm5lcicpLmNzcygnb3BhY2l0eScsIDEgLSAoaHNiLmIgLyAxMDApKTtcbiAgICAgICAgICBicmVhaztcblxuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIC8vIFNldCBncmlkIHBvc2l0aW9uXG4gICAgICAgICAgeCA9IGtlZXBXaXRoaW4oTWF0aC5jZWlsKGhzYi5zIC8gKDEwMCAvIGdyaWQud2lkdGgoKSkpLCAwLCBncmlkLndpZHRoKCkpO1xuICAgICAgICAgIHkgPSBrZWVwV2l0aGluKGdyaWQuaGVpZ2h0KCkgLSBNYXRoLmNlaWwoaHNiLmIgLyAoMTAwIC8gZ3JpZC5oZWlnaHQoKSkpLCAwLCBncmlkLmhlaWdodCgpKTtcbiAgICAgICAgICBncmlkUGlja2VyLmNzcyh7XG4gICAgICAgICAgICB0b3A6IHkgKyAncHgnLFxuICAgICAgICAgICAgbGVmdDogeCArICdweCdcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIC8vIFNldCBzbGlkZXIgcG9zaXRpb25cbiAgICAgICAgICB5ID0ga2VlcFdpdGhpbihzbGlkZXIuaGVpZ2h0KCkgLSAoaHNiLmggLyAoMzYwIC8gc2xpZGVyLmhlaWdodCgpKSksIDAsIHNsaWRlci5oZWlnaHQoKSk7XG4gICAgICAgICAgc2xpZGVyUGlja2VyLmNzcygndG9wJywgeSArICdweCcpO1xuXG4gICAgICAgICAgLy8gVXBkYXRlIHBhbmVsIGNvbG9yXG4gICAgICAgICAgZ3JpZC5jc3MoJ2JhY2tncm91bmRDb2xvcicsIGhzYjJoZXgoeyBoOiBoc2IuaCwgczogMTAwLCBiOiAxMDAgfSkpO1xuICAgICAgICAgIGJyZWFrO1xuXG4gICAgICB9XG5cbiAgICAgIC8vIEZpcmUgY2hhbmdlIGV2ZW50LCBidXQgb25seSBpZiBtaW5pY29sb3JzIGlzIGZ1bGx5IGluaXRpYWxpemVkXG4gICAgICBpZiggaW5wdXQuZGF0YSgnbWluaWNvbG9ycy1pbml0aWFsaXplZCcpICkge1xuICAgICAgICBkb0NoYW5nZShpbnB1dCwgdmFsdWUsIG9wYWNpdHkpO1xuICAgICAgfVxuXG4gICAgfVxuXG4gICAgLy8gUnVucyB0aGUgY2hhbmdlIGFuZCBjaGFuZ2VEZWxheSBjYWxsYmFja3NcbiAgICBmdW5jdGlvbiBkb0NoYW5nZShpbnB1dCwgdmFsdWUsIG9wYWNpdHkpIHtcblxuICAgICAgdmFyIHNldHRpbmdzID0gaW5wdXQuZGF0YSgnbWluaWNvbG9ycy1zZXR0aW5ncycpLFxuICAgICAgICBsYXN0Q2hhbmdlID0gaW5wdXQuZGF0YSgnbWluaWNvbG9ycy1sYXN0Q2hhbmdlJyksXG4gICAgICAgIG9iaixcbiAgICAgICAgc2VsLFxuICAgICAgICBpO1xuXG4gICAgICAvLyBPbmx5IHJ1biBpZiBpdCBhY3R1YWxseSBjaGFuZ2VkXG4gICAgICBpZiggIWxhc3RDaGFuZ2UgfHwgbGFzdENoYW5nZS52YWx1ZSAhPT0gdmFsdWUgfHwgbGFzdENoYW5nZS5vcGFjaXR5ICE9PSBvcGFjaXR5ICkge1xuXG4gICAgICAgIC8vIFJlbWVtYmVyIGxhc3QtY2hhbmdlZCB2YWx1ZVxuICAgICAgICBpbnB1dC5kYXRhKCdtaW5pY29sb3JzLWxhc3RDaGFuZ2UnLCB7XG4gICAgICAgICAgdmFsdWU6IHZhbHVlLFxuICAgICAgICAgIG9wYWNpdHk6IG9wYWNpdHlcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gQ2hlY2sgYW5kIHNlbGVjdCBhcHBsaWNhYmxlIHN3YXRjaFxuICAgICAgICBpZiAoc2V0dGluZ3Muc3dhdGNoZXMgJiYgc2V0dGluZ3Muc3dhdGNoZXMubGVuZ3RoICE9PSAwKSB7XG4gICAgICAgICAgaWYoIWlzUmdiKHZhbHVlKSkge1xuICAgICAgICAgICAgb2JqID0gaGV4MnJnYih2YWx1ZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgb2JqID0gcGFyc2VSZ2IodmFsdWUsIHRydWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBzZWwgPSAtMTtcbiAgICAgICAgICBmb3IoaSA9IDA7IGkgPCBzZXR0aW5ncy5zd2F0Y2hlcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgaWYgKG9iai5yID09PSBzZXR0aW5ncy5zd2F0Y2hlc1tpXS5yICYmIG9iai5nID09PSBzZXR0aW5ncy5zd2F0Y2hlc1tpXS5nICYmIG9iai5iID09PSBzZXR0aW5ncy5zd2F0Y2hlc1tpXS5iICYmIG9iai5hID09PSBzZXR0aW5ncy5zd2F0Y2hlc1tpXS5hKSB7XG4gICAgICAgICAgICAgIHNlbCA9IGk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuICAgICAgICAgIGlucHV0LnBhcmVudCgpLmZpbmQoJy5taW5pY29sb3JzLXN3YXRjaGVzIC5taW5pY29sb3JzLXN3YXRjaCcpLnJlbW92ZUNsYXNzKCdzZWxlY3RlZCcpO1xuICAgICAgICAgIGlmIChpICE9PSAtMSkge1xuICAgICAgICAgICAgaW5wdXQucGFyZW50KCkuZmluZCgnLm1pbmljb2xvcnMtc3dhdGNoZXMgLm1pbmljb2xvcnMtc3dhdGNoJykuZXEoaSkuYWRkQ2xhc3MoJ3NlbGVjdGVkJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gRmlyZSBjaGFuZ2UgZXZlbnRcbiAgICAgICAgaWYoIHNldHRpbmdzLmNoYW5nZSApIHtcbiAgICAgICAgICBpZiggc2V0dGluZ3MuY2hhbmdlRGVsYXkgKSB7XG4gICAgICAgICAgICAvLyBDYWxsIGFmdGVyIGEgZGVsYXlcbiAgICAgICAgICAgIGNsZWFyVGltZW91dChpbnB1dC5kYXRhKCdtaW5pY29sb3JzLWNoYW5nZVRpbWVvdXQnKSk7XG4gICAgICAgICAgICBpbnB1dC5kYXRhKCdtaW5pY29sb3JzLWNoYW5nZVRpbWVvdXQnLCBzZXRUaW1lb3V0KCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgc2V0dGluZ3MuY2hhbmdlLmNhbGwoaW5wdXQuZ2V0KDApLCB2YWx1ZSwgb3BhY2l0eSk7XG4gICAgICAgICAgICB9LCBzZXR0aW5ncy5jaGFuZ2VEZWxheSkpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBDYWxsIGltbWVkaWF0ZWx5XG4gICAgICAgICAgICBzZXR0aW5ncy5jaGFuZ2UuY2FsbChpbnB1dC5nZXQoMCksIHZhbHVlLCBvcGFjaXR5KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaW5wdXQudHJpZ2dlcignY2hhbmdlJykudHJpZ2dlcignaW5wdXQnKTtcbiAgICAgIH1cblxuICAgIH1cblxuICAgIC8vIEdlbmVyYXRlcyBhbiBSR0IoQSkgb2JqZWN0IGJhc2VkIG9uIHRoZSBpbnB1dCdzIHZhbHVlXG4gICAgZnVuY3Rpb24gcmdiT2JqZWN0KGlucHV0KSB7XG4gICAgICB2YXIgaGV4ID0gcGFyc2VIZXgoJChpbnB1dCkudmFsKCksIHRydWUpLFxuICAgICAgICByZ2IgPSBoZXgycmdiKGhleCksXG4gICAgICAgIG9wYWNpdHkgPSAkKGlucHV0KS5hdHRyKCdkYXRhLW9wYWNpdHknKTtcbiAgICAgIGlmKCAhcmdiICkgcmV0dXJuIG51bGw7XG4gICAgICBpZiggb3BhY2l0eSAhPT0gdW5kZWZpbmVkICkgJC5leHRlbmQocmdiLCB7IGE6IHBhcnNlRmxvYXQob3BhY2l0eSkgfSk7XG4gICAgICByZXR1cm4gcmdiO1xuICAgIH1cblxuICAgIC8vIEdlbmVyYXRlcyBhbiBSR0IoQSkgc3RyaW5nIGJhc2VkIG9uIHRoZSBpbnB1dCdzIHZhbHVlXG4gICAgZnVuY3Rpb24gcmdiU3RyaW5nKGlucHV0LCBhbHBoYSkge1xuICAgICAgdmFyIGhleCA9IHBhcnNlSGV4KCQoaW5wdXQpLnZhbCgpLCB0cnVlKSxcbiAgICAgICAgcmdiID0gaGV4MnJnYihoZXgpLFxuICAgICAgICBvcGFjaXR5ID0gJChpbnB1dCkuYXR0cignZGF0YS1vcGFjaXR5Jyk7XG4gICAgICBpZiggIXJnYiApIHJldHVybiBudWxsO1xuICAgICAgaWYoIG9wYWNpdHkgPT09IHVuZGVmaW5lZCApIG9wYWNpdHkgPSAxO1xuICAgICAgaWYoIGFscGhhICkge1xuICAgICAgICByZXR1cm4gJ3JnYmEoJyArIHJnYi5yICsgJywgJyArIHJnYi5nICsgJywgJyArIHJnYi5iICsgJywgJyArIHBhcnNlRmxvYXQob3BhY2l0eSkgKyAnKSc7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gJ3JnYignICsgcmdiLnIgKyAnLCAnICsgcmdiLmcgKyAnLCAnICsgcmdiLmIgKyAnKSc7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQ29udmVydHMgdG8gdGhlIGxldHRlciBjYXNlIHNwZWNpZmllZCBpbiBzZXR0aW5nc1xuICAgIGZ1bmN0aW9uIGNvbnZlcnRDYXNlKHN0cmluZywgbGV0dGVyQ2FzZSkge1xuICAgICAgcmV0dXJuIGxldHRlckNhc2UgPT09ICd1cHBlcmNhc2UnID8gc3RyaW5nLnRvVXBwZXJDYXNlKCkgOiBzdHJpbmcudG9Mb3dlckNhc2UoKTtcbiAgICB9XG5cbiAgICAvLyBQYXJzZXMgYSBzdHJpbmcgYW5kIHJldHVybnMgYSB2YWxpZCBoZXggc3RyaW5nIHdoZW4gcG9zc2libGVcbiAgICBmdW5jdGlvbiBwYXJzZUhleChzdHJpbmcsIGV4cGFuZCkge1xuICAgICAgc3RyaW5nID0gc3RyaW5nLnJlcGxhY2UoL14jL2csICcnKTtcbiAgICAgIGlmKCAhc3RyaW5nLm1hdGNoKC9eW0EtRjAtOV17Myw2fS9pZykgKSByZXR1cm4gJyc7XG4gICAgICBpZiggc3RyaW5nLmxlbmd0aCAhPT0gMyAmJiBzdHJpbmcubGVuZ3RoICE9PSA2ICkgcmV0dXJuICcnO1xuICAgICAgaWYoIHN0cmluZy5sZW5ndGggPT09IDMgJiYgZXhwYW5kICkge1xuICAgICAgICBzdHJpbmcgPSBzdHJpbmdbMF0gKyBzdHJpbmdbMF0gKyBzdHJpbmdbMV0gKyBzdHJpbmdbMV0gKyBzdHJpbmdbMl0gKyBzdHJpbmdbMl07XG4gICAgICB9XG4gICAgICByZXR1cm4gJyMnICsgc3RyaW5nO1xuICAgIH1cblxuICAgIC8vIFBhcnNlcyBhIHN0cmluZyBhbmQgcmV0dXJucyBhIHZhbGlkIFJHQihBKSBzdHJpbmcgd2hlbiBwb3NzaWJsZVxuICAgIGZ1bmN0aW9uIHBhcnNlUmdiKHN0cmluZywgb2JqKSB7XG5cbiAgICAgIHZhciB2YWx1ZXMgPSBzdHJpbmcucmVwbGFjZSgvW15cXGQsLl0vZywgJycpLFxuICAgICAgICByZ2JhID0gdmFsdWVzLnNwbGl0KCcsJyk7XG5cbiAgICAgIHJnYmFbMF0gPSBrZWVwV2l0aGluKHBhcnNlSW50KHJnYmFbMF0sIDEwKSwgMCwgMjU1KTtcbiAgICAgIHJnYmFbMV0gPSBrZWVwV2l0aGluKHBhcnNlSW50KHJnYmFbMV0sIDEwKSwgMCwgMjU1KTtcbiAgICAgIHJnYmFbMl0gPSBrZWVwV2l0aGluKHBhcnNlSW50KHJnYmFbMl0sIDEwKSwgMCwgMjU1KTtcbiAgICAgIGlmKCByZ2JhWzNdICkge1xuICAgICAgICByZ2JhWzNdID0ga2VlcFdpdGhpbihwYXJzZUZsb2F0KHJnYmFbM10sIDEwKSwgMCwgMSk7XG4gICAgICB9XG5cbiAgICAgIC8vIFJldHVybiBSR0JBIG9iamVjdFxuICAgICAgaWYoIG9iaiApIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICByOiByZ2JhWzBdLFxuICAgICAgICAgIGc6IHJnYmFbMV0sXG4gICAgICAgICAgYjogcmdiYVsyXSxcbiAgICAgICAgICBhOiByZ2JhWzNdID8gcmdiYVszXSA6IG51bGxcbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgLy8gUmV0dXJuIFJHQkEgc3RyaW5nXG4gICAgICBpZiggdHlwZW9mKHJnYmFbM10pICE9PSAndW5kZWZpbmVkJyAmJiByZ2JhWzNdIDw9IDEgKSB7XG4gICAgICAgIHJldHVybiAncmdiYSgnICsgcmdiYVswXSArICcsICcgKyByZ2JhWzFdICsgJywgJyArIHJnYmFbMl0gKyAnLCAnICsgcmdiYVszXSArICcpJztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiAncmdiKCcgKyByZ2JhWzBdICsgJywgJyArIHJnYmFbMV0gKyAnLCAnICsgcmdiYVsyXSArICcpJztcbiAgICAgIH1cblxuICAgIH1cblxuICAgIC8vIFBhcnNlcyBhIHN0cmluZyBhbmQgcmV0dXJucyBhIHZhbGlkIGNvbG9yIHN0cmluZyB3aGVuIHBvc3NpYmxlXG4gICAgZnVuY3Rpb24gcGFyc2VJbnB1dChzdHJpbmcsIGV4cGFuZCkge1xuICAgICAgaWYoIGlzUmdiKHN0cmluZykgKSB7XG4gICAgICAgIC8vIFJldHVybnMgYSB2YWxpZCByZ2IoYSkgc3RyaW5nXG4gICAgICAgIHJldHVybiBwYXJzZVJnYihzdHJpbmcpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHBhcnNlSGV4KHN0cmluZywgZXhwYW5kKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBLZWVwcyB2YWx1ZSB3aXRoaW4gbWluIGFuZCBtYXhcbiAgICBmdW5jdGlvbiBrZWVwV2l0aGluKHZhbHVlLCBtaW4sIG1heCkge1xuICAgICAgaWYoIHZhbHVlIDwgbWluICkgdmFsdWUgPSBtaW47XG4gICAgICBpZiggdmFsdWUgPiBtYXggKSB2YWx1ZSA9IG1heDtcbiAgICAgIHJldHVybiB2YWx1ZTtcbiAgICB9XG5cbiAgICAvLyBDaGVja3MgaWYgYSBzdHJpbmcgaXMgYSB2YWxpZCBSR0IoQSkgc3RyaW5nXG4gICAgZnVuY3Rpb24gaXNSZ2Ioc3RyaW5nKSB7XG4gICAgICB2YXIgcmdiID0gc3RyaW5nLm1hdGNoKC9ecmdiYT9bXFxzK10/XFwoW1xccytdPyhcXGQrKVtcXHMrXT8sW1xccytdPyhcXGQrKVtcXHMrXT8sW1xccytdPyhcXGQrKVtcXHMrXT8vaSk7XG4gICAgICByZXR1cm4gKHJnYiAmJiByZ2IubGVuZ3RoID09PSA0KSA/IHRydWUgOiBmYWxzZTtcbiAgICB9XG5cbiAgICAvLyBGdW5jdGlvbiB0byBnZXQgYWxwaGEgZnJvbSBhIFJHQihBKSBzdHJpbmdcbiAgICBmdW5jdGlvbiBnZXRBbHBoYShyZ2JhKSB7XG4gICAgICByZ2JhID0gcmdiYS5tYXRjaCgvXnJnYmE/W1xccytdP1xcKFtcXHMrXT8oXFxkKylbXFxzK10/LFtcXHMrXT8oXFxkKylbXFxzK10/LFtcXHMrXT8oXFxkKylbXFxzK10/LFtcXHMrXT8oXFxkKyhcXC5cXGR7MSwyfSk/fFxcLlxcZHsxLDJ9KVtcXHMrXT8vaSk7XG4gICAgICByZXR1cm4gKHJnYmEgJiYgcmdiYS5sZW5ndGggPT09IDYpID8gcmdiYVs0XSA6ICcxJztcbiAgICB9XG5cbiAgICAvLyBDb252ZXJ0cyBhbiBIU0Igb2JqZWN0IHRvIGFuIFJHQiBvYmplY3RcbiAgICBmdW5jdGlvbiBoc2IycmdiKGhzYikge1xuICAgICAgdmFyIHJnYiA9IHt9O1xuICAgICAgdmFyIGggPSBNYXRoLnJvdW5kKGhzYi5oKTtcbiAgICAgIHZhciBzID0gTWF0aC5yb3VuZChoc2IucyAqIDI1NSAvIDEwMCk7XG4gICAgICB2YXIgdiA9IE1hdGgucm91bmQoaHNiLmIgKiAyNTUgLyAxMDApO1xuICAgICAgaWYocyA9PT0gMCkge1xuICAgICAgICByZ2IuciA9IHJnYi5nID0gcmdiLmIgPSB2O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIHQxID0gdjtcbiAgICAgICAgdmFyIHQyID0gKDI1NSAtIHMpICogdiAvIDI1NTtcbiAgICAgICAgdmFyIHQzID0gKHQxIC0gdDIpICogKGggJSA2MCkgLyA2MDtcbiAgICAgICAgaWYoIGggPT09IDM2MCApIGggPSAwO1xuICAgICAgICBpZiggaCA8IDYwICkgeyByZ2IuciA9IHQxOyByZ2IuYiA9IHQyOyByZ2IuZyA9IHQyICsgdDM7IH1cbiAgICAgICAgZWxzZSBpZiggaCA8IDEyMCApIHtyZ2IuZyA9IHQxOyByZ2IuYiA9IHQyOyByZ2IuciA9IHQxIC0gdDM7IH1cbiAgICAgICAgZWxzZSBpZiggaCA8IDE4MCApIHtyZ2IuZyA9IHQxOyByZ2IuciA9IHQyOyByZ2IuYiA9IHQyICsgdDM7IH1cbiAgICAgICAgZWxzZSBpZiggaCA8IDI0MCApIHtyZ2IuYiA9IHQxOyByZ2IuciA9IHQyOyByZ2IuZyA9IHQxIC0gdDM7IH1cbiAgICAgICAgZWxzZSBpZiggaCA8IDMwMCApIHtyZ2IuYiA9IHQxOyByZ2IuZyA9IHQyOyByZ2IuciA9IHQyICsgdDM7IH1cbiAgICAgICAgZWxzZSBpZiggaCA8IDM2MCApIHtyZ2IuciA9IHQxOyByZ2IuZyA9IHQyOyByZ2IuYiA9IHQxIC0gdDM7IH1cbiAgICAgICAgZWxzZSB7IHJnYi5yID0gMDsgcmdiLmcgPSAwOyByZ2IuYiA9IDA7IH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHI6IE1hdGgucm91bmQocmdiLnIpLFxuICAgICAgICBnOiBNYXRoLnJvdW5kKHJnYi5nKSxcbiAgICAgICAgYjogTWF0aC5yb3VuZChyZ2IuYilcbiAgICAgIH07XG4gICAgfVxuXG4gICAgLy8gQ29udmVydHMgYW4gUkdCIHN0cmluZyB0byBhIGhleCBzdHJpbmdcbiAgICBmdW5jdGlvbiByZ2JTdHJpbmcyaGV4KHJnYil7XG4gICAgICByZ2IgPSByZ2IubWF0Y2goL15yZ2JhP1tcXHMrXT9cXChbXFxzK10/KFxcZCspW1xccytdPyxbXFxzK10/KFxcZCspW1xccytdPyxbXFxzK10/KFxcZCspW1xccytdPy9pKTtcbiAgICAgIHJldHVybiAocmdiICYmIHJnYi5sZW5ndGggPT09IDQpID8gJyMnICtcbiAgICAgICgnMCcgKyBwYXJzZUludChyZ2JbMV0sMTApLnRvU3RyaW5nKDE2KSkuc2xpY2UoLTIpICtcbiAgICAgICgnMCcgKyBwYXJzZUludChyZ2JbMl0sMTApLnRvU3RyaW5nKDE2KSkuc2xpY2UoLTIpICtcbiAgICAgICgnMCcgKyBwYXJzZUludChyZ2JbM10sMTApLnRvU3RyaW5nKDE2KSkuc2xpY2UoLTIpIDogJyc7XG4gICAgfVxuXG4gICAgLy8gQ29udmVydHMgYW4gUkdCIG9iamVjdCB0byBhIGhleCBzdHJpbmdcbiAgICBmdW5jdGlvbiByZ2IyaGV4KHJnYikge1xuICAgICAgdmFyIGhleCA9IFtcbiAgICAgICAgcmdiLnIudG9TdHJpbmcoMTYpLFxuICAgICAgICByZ2IuZy50b1N0cmluZygxNiksXG4gICAgICAgIHJnYi5iLnRvU3RyaW5nKDE2KVxuICAgICAgXTtcbiAgICAgICQuZWFjaChoZXgsIGZ1bmN0aW9uKG5yLCB2YWwpIHtcbiAgICAgICAgaWYgKHZhbC5sZW5ndGggPT09IDEpIGhleFtucl0gPSAnMCcgKyB2YWw7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiAnIycgKyBoZXguam9pbignJyk7XG4gICAgfVxuXG4gICAgLy8gQ29udmVydHMgYW4gSFNCIG9iamVjdCB0byBhIGhleCBzdHJpbmdcbiAgICBmdW5jdGlvbiBoc2IyaGV4KGhzYikge1xuICAgICAgcmV0dXJuIHJnYjJoZXgoaHNiMnJnYihoc2IpKTtcbiAgICB9XG5cbiAgICAvLyBDb252ZXJ0cyBhIGhleCBzdHJpbmcgdG8gYW4gSFNCIG9iamVjdFxuICAgIGZ1bmN0aW9uIGhleDJoc2IoaGV4KSB7XG4gICAgICB2YXIgaHNiID0gcmdiMmhzYihoZXgycmdiKGhleCkpO1xuICAgICAgaWYoIGhzYi5zID09PSAwICkgaHNiLmggPSAzNjA7XG4gICAgICByZXR1cm4gaHNiO1xuICAgIH1cblxuICAgIC8vIENvbnZlcnRzIGFuIFJHQiBvYmplY3QgdG8gYW4gSFNCIG9iamVjdFxuICAgIGZ1bmN0aW9uIHJnYjJoc2IocmdiKSB7XG4gICAgICB2YXIgaHNiID0geyBoOiAwLCBzOiAwLCBiOiAwIH07XG4gICAgICB2YXIgbWluID0gTWF0aC5taW4ocmdiLnIsIHJnYi5nLCByZ2IuYik7XG4gICAgICB2YXIgbWF4ID0gTWF0aC5tYXgocmdiLnIsIHJnYi5nLCByZ2IuYik7XG4gICAgICB2YXIgZGVsdGEgPSBtYXggLSBtaW47XG4gICAgICBoc2IuYiA9IG1heDtcbiAgICAgIGhzYi5zID0gbWF4ICE9PSAwID8gMjU1ICogZGVsdGEgLyBtYXggOiAwO1xuICAgICAgaWYoIGhzYi5zICE9PSAwICkge1xuICAgICAgICBpZiggcmdiLnIgPT09IG1heCApIHtcbiAgICAgICAgICBoc2IuaCA9IChyZ2IuZyAtIHJnYi5iKSAvIGRlbHRhO1xuICAgICAgICB9IGVsc2UgaWYoIHJnYi5nID09PSBtYXggKSB7XG4gICAgICAgICAgaHNiLmggPSAyICsgKHJnYi5iIC0gcmdiLnIpIC8gZGVsdGE7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaHNiLmggPSA0ICsgKHJnYi5yIC0gcmdiLmcpIC8gZGVsdGE7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGhzYi5oID0gLTE7XG4gICAgICB9XG4gICAgICBoc2IuaCAqPSA2MDtcbiAgICAgIGlmKCBoc2IuaCA8IDAgKSB7XG4gICAgICAgIGhzYi5oICs9IDM2MDtcbiAgICAgIH1cbiAgICAgIGhzYi5zICo9IDEwMC8yNTU7XG4gICAgICBoc2IuYiAqPSAxMDAvMjU1O1xuICAgICAgcmV0dXJuIGhzYjtcbiAgICB9XG5cbiAgICAvLyBDb252ZXJ0cyBhIGhleCBzdHJpbmcgdG8gYW4gUkdCIG9iamVjdFxuICAgIGZ1bmN0aW9uIGhleDJyZ2IoaGV4KSB7XG4gICAgICBoZXggPSBwYXJzZUludCgoKGhleC5pbmRleE9mKCcjJykgPiAtMSkgPyBoZXguc3Vic3RyaW5nKDEpIDogaGV4KSwgMTYpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgLyoganNoaW50IGlnbm9yZTpzdGFydCAqL1xuICAgICAgICByOiBoZXggPj4gMTYsXG4gICAgICAgIGc6IChoZXggJiAweDAwRkYwMCkgPj4gOCxcbiAgICAgICAgYjogKGhleCAmIDB4MDAwMEZGKVxuICAgICAgICAvKiBqc2hpbnQgaWdub3JlOmVuZCAqL1xuICAgICAgfTtcbiAgICB9XG5cbiAgICAvLyBIYW5kbGUgZXZlbnRzXG4gICAgJChkb2N1bWVudClcbiAgICAgIC8vIEhpZGUgb24gY2xpY2tzIG91dHNpZGUgb2YgdGhlIGNvbnRyb2xcbiAgICAgIC5vbignbW91c2Vkb3duLm1pbmljb2xvcnMgdG91Y2hzdGFydC5taW5pY29sb3JzJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgaWYoICEkKGV2ZW50LnRhcmdldCkucGFyZW50cygpLmFkZChldmVudC50YXJnZXQpLmhhc0NsYXNzKCdtaW5pY29sb3JzJykgKSB7XG4gICAgICAgICAgaGlkZSgpO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgICAgLy8gU3RhcnQgbW92aW5nXG4gICAgICAub24oJ21vdXNlZG93bi5taW5pY29sb3JzIHRvdWNoc3RhcnQubWluaWNvbG9ycycsICcubWluaWNvbG9ycy1ncmlkLCAubWluaWNvbG9ycy1zbGlkZXIsIC5taW5pY29sb3JzLW9wYWNpdHktc2xpZGVyJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgdmFyIHRhcmdldCA9ICQodGhpcyk7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICQoZG9jdW1lbnQpLmRhdGEoJ21pbmljb2xvcnMtdGFyZ2V0JywgdGFyZ2V0KTtcbiAgICAgICAgbW92ZSh0YXJnZXQsIGV2ZW50LCB0cnVlKTtcbiAgICAgIH0pXG4gICAgICAvLyBNb3ZlIHBpY2tlcnNcbiAgICAgIC5vbignbW91c2Vtb3ZlLm1pbmljb2xvcnMgdG91Y2htb3ZlLm1pbmljb2xvcnMnLCBmdW5jdGlvbihldmVudCkge1xuICAgICAgICB2YXIgdGFyZ2V0ID0gJChkb2N1bWVudCkuZGF0YSgnbWluaWNvbG9ycy10YXJnZXQnKTtcbiAgICAgICAgaWYoIHRhcmdldCApIG1vdmUodGFyZ2V0LCBldmVudCk7XG4gICAgICB9KVxuICAgICAgLy8gU3RvcCBtb3ZpbmdcbiAgICAgIC5vbignbW91c2V1cC5taW5pY29sb3JzIHRvdWNoZW5kLm1pbmljb2xvcnMnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgJCh0aGlzKS5yZW1vdmVEYXRhKCdtaW5pY29sb3JzLXRhcmdldCcpO1xuICAgICAgfSlcbiAgICAgIC8vIFNlbGVjdGVkIGEgc3dhdGNoXG4gICAgICAub24oJ2NsaWNrLm1pbmljb2xvcnMnLCAnLm1pbmljb2xvcnMtc3dhdGNoZXMgbGknLCBmdW5jdGlvbihldmVudCkge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB2YXIgdGFyZ2V0ID0gJCh0aGlzKSwgaW5wdXQgPSB0YXJnZXQucGFyZW50cygnLm1pbmljb2xvcnMnKS5maW5kKCcubWluaWNvbG9ycy1pbnB1dCcpLCBjb2xvciA9IHRhcmdldC5kYXRhKCdzd2F0Y2gtY29sb3InKTtcbiAgICAgICAgdXBkYXRlSW5wdXQoaW5wdXQsIGNvbG9yLCBnZXRBbHBoYShjb2xvcikpO1xuICAgICAgICB1cGRhdGVGcm9tSW5wdXQoaW5wdXQpO1xuICAgICAgfSlcbiAgICAgIC8vIFNob3cgcGFuZWwgd2hlbiBzd2F0Y2ggaXMgY2xpY2tlZFxuICAgICAgLm9uKCdtb3VzZWRvd24ubWluaWNvbG9ycyB0b3VjaHN0YXJ0Lm1pbmljb2xvcnMnLCAnLm1pbmljb2xvcnMtaW5wdXQtc3dhdGNoJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgdmFyIGlucHV0ID0gJCh0aGlzKS5wYXJlbnQoKS5maW5kKCcubWluaWNvbG9ycy1pbnB1dCcpO1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBpZiggaW5wdXQucGFyZW50KCkuZmluZCgnLm1pbmljb2xvcnMtcGFuZWwnKS5jc3MoXCJkaXNwbGF5XCIpICE9PSBcIm5vbmVcIil7XG4gICAgICAgICAgLy90b2RvXG4gICAgICAgICAgLy9oaWRlKCk7XG4gICAgICAgIH1lbHNle1xuICAgICAgICAgIHNob3coaW5wdXQpO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgICAgLy8gU2hvdyBvbiBmb2N1c1xuICAgICAgLm9uKCdmb2N1cy5taW5pY29sb3JzJywgJy5taW5pY29sb3JzLWlucHV0JywgZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBpbnB1dCA9ICQodGhpcyk7XG4gICAgICAgIGlmKCAhaW5wdXQuZGF0YSgnbWluaWNvbG9ycy1pbml0aWFsaXplZCcpICkgcmV0dXJuO1xuICAgICAgICBzaG93KGlucHV0KTtcbiAgICAgIH0pXG4gICAgICAvLyBVcGRhdGUgdmFsdWUgb24gYmx1clxuICAgICAgLm9uKCdibHVyLm1pbmljb2xvcnMnLCAnLm1pbmljb2xvcnMtaW5wdXQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGlucHV0ID0gJCh0aGlzKSxcbiAgICAgICAgICBzZXR0aW5ncyA9IGlucHV0LmRhdGEoJ21pbmljb2xvcnMtc2V0dGluZ3MnKSxcbiAgICAgICAgICBrZXl3b3JkcyxcbiAgICAgICAgICBoZXgsXG4gICAgICAgICAgcmdiYSxcbiAgICAgICAgICBzd2F0Y2hPcGFjaXR5LFxuICAgICAgICAgIHZhbHVlO1xuXG4gICAgICAgIGlmKCAhaW5wdXQuZGF0YSgnbWluaWNvbG9ycy1pbml0aWFsaXplZCcpICkgcmV0dXJuO1xuXG4gICAgICAgIC8vIEdldCBhcnJheSBvZiBsb3dlcmNhc2Uga2V5d29yZHNcbiAgICAgICAga2V5d29yZHMgPSAhc2V0dGluZ3Mua2V5d29yZHMgPyBbXSA6ICQubWFwKHNldHRpbmdzLmtleXdvcmRzLnNwbGl0KCcsJyksIGZ1bmN0aW9uKGEpIHtcbiAgICAgICAgICByZXR1cm4gJC50cmltKGEudG9Mb3dlckNhc2UoKSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFNldCBjb2xvciBzdHJpbmdcbiAgICAgICAgaWYoIGlucHV0LnZhbCgpICE9PSAnJyAmJiAkLmluQXJyYXkoaW5wdXQudmFsKCkudG9Mb3dlckNhc2UoKSwga2V5d29yZHMpID4gLTEgKSB7XG4gICAgICAgICAgdmFsdWUgPSBpbnB1dC52YWwoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBHZXQgUkdCQSB2YWx1ZXMgZm9yIGVhc3kgY29udmVyc2lvblxuICAgICAgICAgIGlmKCBpc1JnYihpbnB1dC52YWwoKSkgKSB7XG4gICAgICAgICAgICByZ2JhID0gcGFyc2VSZ2IoaW5wdXQudmFsKCksIHRydWUpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBoZXggPSBwYXJzZUhleChpbnB1dC52YWwoKSwgdHJ1ZSk7XG4gICAgICAgICAgICByZ2JhID0gaGV4ID8gaGV4MnJnYihoZXgpIDogbnVsbDtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBDb252ZXJ0IHRvIGZvcm1hdFxuICAgICAgICAgIGlmKCByZ2JhID09PSBudWxsICkge1xuICAgICAgICAgICAgdmFsdWUgPSBzZXR0aW5ncy5kZWZhdWx0VmFsdWU7XG4gICAgICAgICAgfSBlbHNlIGlmKCBzZXR0aW5ncy5mb3JtYXQgPT09ICdyZ2InICkge1xuICAgICAgICAgICAgdmFsdWUgPSBzZXR0aW5ncy5vcGFjaXR5ID9cbiAgICAgICAgICAgICAgcGFyc2VSZ2IoJ3JnYmEoJyArIHJnYmEuciArICcsJyArIHJnYmEuZyArICcsJyArIHJnYmEuYiArICcsJyArIGlucHV0LmF0dHIoJ2RhdGEtb3BhY2l0eScpICsgJyknKSA6XG4gICAgICAgICAgICAgIHBhcnNlUmdiKCdyZ2IoJyArIHJnYmEuciArICcsJyArIHJnYmEuZyArICcsJyArIHJnYmEuYiArICcpJyk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhbHVlID0gcmdiMmhleChyZ2JhKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBVcGRhdGUgc3dhdGNoIG9wYWNpdHlcbiAgICAgICAgc3dhdGNoT3BhY2l0eSA9IHNldHRpbmdzLm9wYWNpdHkgPyBpbnB1dC5hdHRyKCdkYXRhLW9wYWNpdHknKSA6IDE7XG4gICAgICAgIGlmKCB2YWx1ZS50b0xvd2VyQ2FzZSgpID09PSAndHJhbnNwYXJlbnQnICkgc3dhdGNoT3BhY2l0eSA9IDA7XG4gICAgICAgIGlucHV0XG4gICAgICAgICAgLmNsb3Nlc3QoJy5taW5pY29sb3JzJylcbiAgICAgICAgICAuZmluZCgnLm1pbmljb2xvcnMtaW5wdXQtc3dhdGNoID4gc3BhbicpXG4gICAgICAgICAgLmNzcygnb3BhY2l0eScsIHN3YXRjaE9wYWNpdHkpO1xuXG4gICAgICAgIC8vIFNldCBpbnB1dCB2YWx1ZVxuICAgICAgICBpbnB1dC52YWwodmFsdWUpO1xuXG4gICAgICAgIC8vIElzIGl0IGJsYW5rP1xuICAgICAgICBpZiggaW5wdXQudmFsKCkgPT09ICcnICkgaW5wdXQudmFsKHBhcnNlSW5wdXQoc2V0dGluZ3MuZGVmYXVsdFZhbHVlLCB0cnVlKSk7XG5cbiAgICAgICAgLy8gQWRqdXN0IGNhc2VcbiAgICAgICAgaW5wdXQudmFsKCBjb252ZXJ0Q2FzZShpbnB1dC52YWwoKSwgc2V0dGluZ3MubGV0dGVyQ2FzZSkgKTtcblxuICAgICAgfSlcbiAgICAgIC8vIEhhbmRsZSBrZXlwcmVzc2VzXG4gICAgICAub24oJ2tleWRvd24ubWluaWNvbG9ycycsICcubWluaWNvbG9ycy1pbnB1dCcsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgIHZhciBpbnB1dCA9ICQodGhpcyk7XG4gICAgICAgIGlmKCAhaW5wdXQuZGF0YSgnbWluaWNvbG9ycy1pbml0aWFsaXplZCcpICkgcmV0dXJuO1xuICAgICAgICBzd2l0Y2goZXZlbnQua2V5Q29kZSkge1xuICAgICAgICAgIGNhc2UgOTogLy8gdGFiXG4gICAgICAgICAgICBoaWRlKCk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIDEzOiAvLyBlbnRlclxuICAgICAgICAgIGNhc2UgMjc6IC8vIGVzY1xuICAgICAgICAgICAgaGlkZSgpO1xuICAgICAgICAgICAgaW5wdXQuYmx1cigpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgICAvLyBVcGRhdGUgb24ga2V5dXBcbiAgICAgIC5vbigna2V5dXAubWluaWNvbG9ycycsICcubWluaWNvbG9ycy1pbnB1dCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgaW5wdXQgPSAkKHRoaXMpO1xuICAgICAgICBpZiggIWlucHV0LmRhdGEoJ21pbmljb2xvcnMtaW5pdGlhbGl6ZWQnKSApIHJldHVybjtcbiAgICAgICAgdXBkYXRlRnJvbUlucHV0KGlucHV0LCB0cnVlKTtcbiAgICAgIH0pXG4gICAgICAvLyBVcGRhdGUgb24gcGFzdGVcbiAgICAgIC5vbigncGFzdGUubWluaWNvbG9ycycsICcubWluaWNvbG9ycy1pbnB1dCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgaW5wdXQgPSAkKHRoaXMpO1xuICAgICAgICBpZiggIWlucHV0LmRhdGEoJ21pbmljb2xvcnMtaW5pdGlhbGl6ZWQnKSApIHJldHVybjtcbiAgICAgICAgc2V0VGltZW91dCggZnVuY3Rpb24oKSB7XG4gICAgICAgICAgdXBkYXRlRnJvbUlucHV0KGlucHV0LCB0cnVlKTtcbiAgICAgICAgfSwgMSk7XG4gICAgICB9KTtcblxuICB9KSk7XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuLi9wbHVnaW5zLyQubWluaWNvbG9ycy5qc1xuLy8gbW9kdWxlIGlkID0gNjRcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiLyogRmlsZVNhdmVyLmpzXG4gKiBBIHNhdmVBcygpIEZpbGVTYXZlciBpbXBsZW1lbnRhdGlvbi5cbiAqIDEuMS4yMDE1MDcxNlxuICpcbiAqIEJ5IEVsaSBHcmV5LCBodHRwOi8vZWxpZ3JleS5jb21cbiAqIExpY2Vuc2U6IFgxMS9NSVRcbiAqICAgU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9lbGlncmV5L0ZpbGVTYXZlci5qcy9ibG9iL21hc3Rlci9MSUNFTlNFLm1kXG4gKi9cblxuLypnbG9iYWwgc2VsZiAqL1xuLypqc2xpbnQgYml0d2lzZTogdHJ1ZSwgaW5kZW50OiA0LCBsYXhicmVhazogdHJ1ZSwgbGF4Y29tbWE6IHRydWUsIHNtYXJ0dGFiczogdHJ1ZSwgcGx1c3BsdXM6IHRydWUgKi9cblxuLyohIEBzb3VyY2UgaHR0cDovL3B1cmwuZWxpZ3JleS5jb20vZ2l0aHViL0ZpbGVTYXZlci5qcy9ibG9iL21hc3Rlci9GaWxlU2F2ZXIuanMgKi9cblxuXG5cbnZhciBpc0xpa2VseU5vZGUgPSB0eXBlb2YgQnVmZmVyICE9PSAndW5kZWZpbmVkJyAmJiB0eXBlb2Ygd2luZG93ID09PSAndW5kZWZpbmVkJztcblxuXG5cbnZhciBzYXZlQXMgPSAhaXNMaWtlbHlOb2RlICYmICAoZnVuY3Rpb24odmlldykge1xuICAgICAgICBcInVzZSBzdHJpY3RcIjtcbiAgICAgICAgLy8gSUUgPDEwIGlzIGV4cGxpY2l0bHkgdW5zdXBwb3J0ZWRcbiAgICAgICAgaWYgKHR5cGVvZiBuYXZpZ2F0b3IgIT09IFwidW5kZWZpbmVkXCIgJiYgL01TSUUgWzEtOV1cXC4vLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB2YXJcbiAgICAgICAgICAgIGRvYyA9IHZpZXcuZG9jdW1lbnRcbiAgICAgICAgLy8gb25seSBnZXQgVVJMIHdoZW4gbmVjZXNzYXJ5IGluIGNhc2UgQmxvYi5qcyBoYXNuJ3Qgb3ZlcnJpZGRlbiBpdCB5ZXRcbiAgICAgICAgICAgICwgZ2V0X1VSTCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB2aWV3LlVSTCB8fCB2aWV3LndlYmtpdFVSTCB8fCB2aWV3O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLCBzYXZlX2xpbmsgPSBkb2MuY3JlYXRlRWxlbWVudE5TKFwiaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbFwiLCBcImFcIilcbiAgICAgICAgICAgICwgY2FuX3VzZV9zYXZlX2xpbmsgPSBcImRvd25sb2FkXCIgaW4gc2F2ZV9saW5rXG4gICAgICAgICAgICAsIGNsaWNrID0gZnVuY3Rpb24obm9kZSkge1xuICAgICAgICAgICAgICAgIHZhciBldmVudCA9IG5ldyBNb3VzZUV2ZW50KFwiY2xpY2tcIik7XG4gICAgICAgICAgICAgICAgbm9kZS5kaXNwYXRjaEV2ZW50KGV2ZW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICwgd2Via2l0X3JlcV9mcyA9IHZpZXcud2Via2l0UmVxdWVzdEZpbGVTeXN0ZW1cbiAgICAgICAgICAgICwgcmVxX2ZzID0gdmlldy5yZXF1ZXN0RmlsZVN5c3RlbSB8fCB3ZWJraXRfcmVxX2ZzIHx8IHZpZXcubW96UmVxdWVzdEZpbGVTeXN0ZW1cbiAgICAgICAgICAgICwgdGhyb3dfb3V0c2lkZSA9IGZ1bmN0aW9uKGV4KSB7XG4gICAgICAgICAgICAgICAgKHZpZXcuc2V0SW1tZWRpYXRlIHx8IHZpZXcuc2V0VGltZW91dCkoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IGV4O1xuICAgICAgICAgICAgICAgIH0sIDApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLCBmb3JjZV9zYXZlYWJsZV90eXBlID0gXCJhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW1cIlxuICAgICAgICAgICAgLCBmc19taW5fc2l6ZSA9IDBcbiAgICAgICAgLy8gU2VlIGh0dHBzOi8vY29kZS5nb29nbGUuY29tL3AvY2hyb21pdW0vaXNzdWVzL2RldGFpbD9pZD0zNzUyOTcjYzcgYW5kXG4gICAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9lbGlncmV5L0ZpbGVTYXZlci5qcy9jb21taXQvNDg1OTMwYSNjb21taXRjb21tZW50LTg3NjgwNDdcbiAgICAgICAgLy8gZm9yIHRoZSByZWFzb25pbmcgYmVoaW5kIHRoZSB0aW1lb3V0IGFuZCByZXZvY2F0aW9uIGZsb3dcbiAgICAgICAgICAgICwgYXJiaXRyYXJ5X3Jldm9rZV90aW1lb3V0ID0gNTAwIC8vIGluIG1zXG4gICAgICAgICAgICAsIHJldm9rZSA9IGZ1bmN0aW9uKGZpbGUpIHtcbiAgICAgICAgICAgICAgICB2YXIgcmV2b2tlciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGZpbGUgPT09IFwic3RyaW5nXCIpIHsgLy8gZmlsZSBpcyBhbiBvYmplY3QgVVJMXG4gICAgICAgICAgICAgICAgICAgICAgICBnZXRfVVJMKCkucmV2b2tlT2JqZWN0VVJMKGZpbGUpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgeyAvLyBmaWxlIGlzIGEgRmlsZVxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsZS5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgaWYgKHZpZXcuY2hyb21lKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldm9rZXIoKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KHJldm9rZXIsIGFyYml0cmFyeV9yZXZva2VfdGltZW91dCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLCBkaXNwYXRjaCA9IGZ1bmN0aW9uKGZpbGVzYXZlciwgZXZlbnRfdHlwZXMsIGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgZXZlbnRfdHlwZXMgPSBbXS5jb25jYXQoZXZlbnRfdHlwZXMpO1xuICAgICAgICAgICAgICAgIHZhciBpID0gZXZlbnRfdHlwZXMubGVuZ3RoO1xuICAgICAgICAgICAgICAgIHdoaWxlIChpLS0pIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGxpc3RlbmVyID0gZmlsZXNhdmVyW1wib25cIiArIGV2ZW50X3R5cGVzW2ldXTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBsaXN0ZW5lciA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpc3RlbmVyLmNhbGwoZmlsZXNhdmVyLCBldmVudCB8fCBmaWxlc2F2ZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZXgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvd19vdXRzaWRlKGV4KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICwgYXV0b19ib20gPSBmdW5jdGlvbihibG9iKSB7XG4gICAgICAgICAgICAgICAgLy8gcHJlcGVuZCBCT00gZm9yIFVURi04IFhNTCBhbmQgdGV4dC8qIHR5cGVzIChpbmNsdWRpbmcgSFRNTClcbiAgICAgICAgICAgICAgICBpZiAoL15cXHMqKD86dGV4dFxcL1xcUyp8YXBwbGljYXRpb25cXC94bWx8XFxTKlxcL1xcUypcXCt4bWwpXFxzKjsuKmNoYXJzZXRcXHMqPVxccyp1dGYtOC9pLnRlc3QoYmxvYi50eXBlKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEJsb2IoW1wiXFx1ZmVmZlwiLCBibG9iXSwge3R5cGU6IGJsb2IudHlwZX0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gYmxvYjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICwgRmlsZVNhdmVyID0gZnVuY3Rpb24oYmxvYiwgbmFtZSwgbm9fYXV0b19ib20pIHtcbiAgICAgICAgICAgICAgICBpZiAoIW5vX2F1dG9fYm9tKSB7XG4gICAgICAgICAgICAgICAgICAgIGJsb2IgPSBhdXRvX2JvbShibG9iKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gRmlyc3QgdHJ5IGEuZG93bmxvYWQsIHRoZW4gd2ViIGZpbGVzeXN0ZW0sIHRoZW4gb2JqZWN0IFVSTHNcbiAgICAgICAgICAgICAgICB2YXJcbiAgICAgICAgICAgICAgICAgICAgZmlsZXNhdmVyID0gdGhpc1xuICAgICAgICAgICAgICAgICAgICAsIHR5cGUgPSBibG9iLnR5cGVcbiAgICAgICAgICAgICAgICAgICAgLCBibG9iX2NoYW5nZWQgPSBmYWxzZVxuICAgICAgICAgICAgICAgICAgICAsIG9iamVjdF91cmxcbiAgICAgICAgICAgICAgICAgICAgLCB0YXJnZXRfdmlld1xuICAgICAgICAgICAgICAgICAgICAsIGRpc3BhdGNoX2FsbCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGF0Y2goZmlsZXNhdmVyLCBcIndyaXRlc3RhcnQgcHJvZ3Jlc3Mgd3JpdGUgd3JpdGVlbmRcIi5zcGxpdChcIiBcIikpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gb24gYW55IGZpbGVzeXMgZXJyb3JzIHJldmVydCB0byBzYXZpbmcgd2l0aCBvYmplY3QgVVJMc1xuICAgICAgICAgICAgICAgICAgICAsIGZzX2Vycm9yID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBkb24ndCBjcmVhdGUgbW9yZSBvYmplY3QgVVJMcyB0aGFuIG5lZWRlZFxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJsb2JfY2hhbmdlZCB8fCAhb2JqZWN0X3VybCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9iamVjdF91cmwgPSBnZXRfVVJMKCkuY3JlYXRlT2JqZWN0VVJMKGJsb2IpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRhcmdldF92aWV3KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0X3ZpZXcubG9jYXRpb24uaHJlZiA9IG9iamVjdF91cmw7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuZXdfdGFiID0gdmlldy5vcGVuKG9iamVjdF91cmwsIFwiX2JsYW5rXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuZXdfdGFiID09IHVuZGVmaW5lZCAmJiB0eXBlb2Ygc2FmYXJpICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vQXBwbGUgZG8gbm90IGFsbG93IHdpbmRvdy5vcGVuLCBzZWUgaHR0cDovL2JpdC5seS8xa1pmZlJJXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpZXcubG9jYXRpb24uaHJlZiA9IG9iamVjdF91cmxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWxlc2F2ZXIucmVhZHlTdGF0ZSA9IGZpbGVzYXZlci5ET05FO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGF0Y2hfYWxsKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXZva2Uob2JqZWN0X3VybCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLCBhYm9ydGFibGUgPSBmdW5jdGlvbihmdW5jKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGVzYXZlci5yZWFkeVN0YXRlICE9PSBmaWxlc2F2ZXIuRE9ORSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZnVuYy5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLCBjcmVhdGVfaWZfbm90X2ZvdW5kID0ge2NyZWF0ZTogdHJ1ZSwgZXhjbHVzaXZlOiBmYWxzZX1cbiAgICAgICAgICAgICAgICAgICAgLCBzbGljZVxuICAgICAgICAgICAgICAgICAgICA7XG4gICAgICAgICAgICAgICAgZmlsZXNhdmVyLnJlYWR5U3RhdGUgPSBmaWxlc2F2ZXIuSU5JVDtcbiAgICAgICAgICAgICAgICBpZiAoIW5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZSA9IFwiZG93bmxvYWRcIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGNhbl91c2Vfc2F2ZV9saW5rKSB7XG4gICAgICAgICAgICAgICAgICAgIG9iamVjdF91cmwgPSBnZXRfVVJMKCkuY3JlYXRlT2JqZWN0VVJMKGJsb2IpO1xuICAgICAgICAgICAgICAgICAgICBzYXZlX2xpbmsuaHJlZiA9IG9iamVjdF91cmw7XG4gICAgICAgICAgICAgICAgICAgIHNhdmVfbGluay5kb3dubG9hZCA9IG5hbWU7XG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjbGljayhzYXZlX2xpbmspO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGF0Y2hfYWxsKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXZva2Uob2JqZWN0X3VybCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWxlc2F2ZXIucmVhZHlTdGF0ZSA9IGZpbGVzYXZlci5ET05FO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBPYmplY3QgYW5kIHdlYiBmaWxlc3lzdGVtIFVSTHMgaGF2ZSBhIHByb2JsZW0gc2F2aW5nIGluIEdvb2dsZSBDaHJvbWUgd2hlblxuICAgICAgICAgICAgICAgIC8vIHZpZXdlZCBpbiBhIHRhYiwgc28gSSBmb3JjZSBzYXZlIHdpdGggYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtXG4gICAgICAgICAgICAgICAgLy8gaHR0cDovL2NvZGUuZ29vZ2xlLmNvbS9wL2Nocm9taXVtL2lzc3Vlcy9kZXRhaWw/aWQ9OTExNThcbiAgICAgICAgICAgICAgICAvLyBVcGRhdGU6IEdvb2dsZSBlcnJhbnRseSBjbG9zZWQgOTExNTgsIEkgc3VibWl0dGVkIGl0IGFnYWluOlxuICAgICAgICAgICAgICAgIC8vIGh0dHBzOi8vY29kZS5nb29nbGUuY29tL3AvY2hyb21pdW0vaXNzdWVzL2RldGFpbD9pZD0zODk2NDJcbiAgICAgICAgICAgICAgICBpZiAodmlldy5jaHJvbWUgJiYgdHlwZSAmJiB0eXBlICE9PSBmb3JjZV9zYXZlYWJsZV90eXBlKSB7XG4gICAgICAgICAgICAgICAgICAgIHNsaWNlID0gYmxvYi5zbGljZSB8fCBibG9iLndlYmtpdFNsaWNlO1xuICAgICAgICAgICAgICAgICAgICBibG9iID0gc2xpY2UuY2FsbChibG9iLCAwLCBibG9iLnNpemUsIGZvcmNlX3NhdmVhYmxlX3R5cGUpO1xuICAgICAgICAgICAgICAgICAgICBibG9iX2NoYW5nZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBTaW5jZSBJIGNhbid0IGJlIHN1cmUgdGhhdCB0aGUgZ3Vlc3NlZCBtZWRpYSB0eXBlIHdpbGwgdHJpZ2dlciBhIGRvd25sb2FkXG4gICAgICAgICAgICAgICAgLy8gaW4gV2ViS2l0LCBJIGFwcGVuZCAuZG93bmxvYWQgdG8gdGhlIGZpbGVuYW1lLlxuICAgICAgICAgICAgICAgIC8vIGh0dHBzOi8vYnVncy53ZWJraXQub3JnL3Nob3dfYnVnLmNnaT9pZD02NTQ0MFxuICAgICAgICAgICAgICAgIGlmICh3ZWJraXRfcmVxX2ZzICYmIG5hbWUgIT09IFwiZG93bmxvYWRcIikge1xuICAgICAgICAgICAgICAgICAgICBuYW1lICs9IFwiLmRvd25sb2FkXCI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICh0eXBlID09PSBmb3JjZV9zYXZlYWJsZV90eXBlIHx8IHdlYmtpdF9yZXFfZnMpIHtcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0X3ZpZXcgPSB2aWV3O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoIXJlcV9mcykge1xuICAgICAgICAgICAgICAgICAgICBmc19lcnJvcigpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGZzX21pbl9zaXplICs9IGJsb2Iuc2l6ZTtcbiAgICAgICAgICAgICAgICByZXFfZnModmlldy5URU1QT1JBUlksIGZzX21pbl9zaXplLCBhYm9ydGFibGUoZnVuY3Rpb24oZnMpIHtcbiAgICAgICAgICAgICAgICAgICAgZnMucm9vdC5nZXREaXJlY3RvcnkoXCJzYXZlZFwiLCBjcmVhdGVfaWZfbm90X2ZvdW5kLCBhYm9ydGFibGUoZnVuY3Rpb24oZGlyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2F2ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRpci5nZXRGaWxlKG5hbWUsIGNyZWF0ZV9pZl9ub3RfZm91bmQsIGFib3J0YWJsZShmdW5jdGlvbihmaWxlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUuY3JlYXRlV3JpdGVyKGFib3J0YWJsZShmdW5jdGlvbih3cml0ZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlci5vbndyaXRlZW5kID0gZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXRfdmlldy5sb2NhdGlvbi5ocmVmID0gZmlsZS50b1VSTCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVzYXZlci5yZWFkeVN0YXRlID0gZmlsZXNhdmVyLkRPTkU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGF0Y2goZmlsZXNhdmVyLCBcIndyaXRlZW5kXCIsIGV2ZW50KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXZva2UoZmlsZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVyLm9uZXJyb3IgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3IgPSB3cml0ZXIuZXJyb3I7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVycm9yLmNvZGUgIT09IGVycm9yLkFCT1JUX0VSUikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmc19lcnJvcigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIndyaXRlc3RhcnQgcHJvZ3Jlc3Mgd3JpdGUgYWJvcnRcIi5zcGxpdChcIiBcIikuZm9yRWFjaChmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlcltcIm9uXCIgKyBldmVudF0gPSBmaWxlc2F2ZXJbXCJvblwiICsgZXZlbnRdO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXIud3JpdGUoYmxvYik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlc2F2ZXIuYWJvcnQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXIuYWJvcnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlc2F2ZXIucmVhZHlTdGF0ZSA9IGZpbGVzYXZlci5ET05FO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVzYXZlci5yZWFkeVN0YXRlID0gZmlsZXNhdmVyLldSSVRJTkc7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBmc19lcnJvcik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksIGZzX2Vycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICBkaXIuZ2V0RmlsZShuYW1lLCB7Y3JlYXRlOiBmYWxzZX0sIGFib3J0YWJsZShmdW5jdGlvbihmaWxlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZGVsZXRlIGZpbGUgaWYgaXQgYWxyZWFkeSBleGlzdHNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWxlLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBhYm9ydGFibGUoZnVuY3Rpb24oZXgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXguY29kZSA9PT0gZXguTk9UX0ZPVU5EX0VSUikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYXZlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnNfZXJyb3IoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgICAgIH0pLCBmc19lcnJvcik7XG4gICAgICAgICAgICAgICAgfSksIGZzX2Vycm9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICwgRlNfcHJvdG8gPSBGaWxlU2F2ZXIucHJvdG90eXBlXG4gICAgICAgICAgICAsIHNhdmVBcyA9IGZ1bmN0aW9uKGJsb2IsIG5hbWUsIG5vX2F1dG9fYm9tKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBGaWxlU2F2ZXIoYmxvYiwgbmFtZSwgbm9fYXV0b19ib20pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgO1xuICAgICAgICAvLyBJRSAxMCsgKG5hdGl2ZSBzYXZlQXMpXG4gICAgICAgIGlmICh0eXBlb2YgbmF2aWdhdG9yICE9PSBcInVuZGVmaW5lZFwiICYmIG5hdmlnYXRvci5tc1NhdmVPck9wZW5CbG9iKSB7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oYmxvYiwgbmFtZSwgbm9fYXV0b19ib20pIHtcbiAgICAgICAgICAgICAgICBpZiAoIW5vX2F1dG9fYm9tKSB7XG4gICAgICAgICAgICAgICAgICAgIGJsb2IgPSBhdXRvX2JvbShibG9iKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5hdmlnYXRvci5tc1NhdmVPck9wZW5CbG9iKGJsb2IsIG5hbWUgfHwgXCJkb3dubG9hZFwiKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cblxuICAgICAgICBGU19wcm90by5hYm9ydCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdmFyIGZpbGVzYXZlciA9IHRoaXM7XG4gICAgICAgICAgICBmaWxlc2F2ZXIucmVhZHlTdGF0ZSA9IGZpbGVzYXZlci5ET05FO1xuICAgICAgICAgICAgZGlzcGF0Y2goZmlsZXNhdmVyLCBcImFib3J0XCIpO1xuICAgICAgICB9O1xuICAgICAgICBGU19wcm90by5yZWFkeVN0YXRlID0gRlNfcHJvdG8uSU5JVCA9IDA7XG4gICAgICAgIEZTX3Byb3RvLldSSVRJTkcgPSAxO1xuICAgICAgICBGU19wcm90by5ET05FID0gMjtcblxuICAgICAgICBGU19wcm90by5lcnJvciA9XG4gICAgICAgICAgICBGU19wcm90by5vbndyaXRlc3RhcnQgPVxuICAgICAgICAgICAgICAgIEZTX3Byb3RvLm9ucHJvZ3Jlc3MgPVxuICAgICAgICAgICAgICAgICAgICBGU19wcm90by5vbndyaXRlID1cbiAgICAgICAgICAgICAgICAgICAgICAgIEZTX3Byb3RvLm9uYWJvcnQgPVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZTX3Byb3RvLm9uZXJyb3IgPVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGU19wcm90by5vbndyaXRlZW5kID1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bGw7XG5cbiAgICAgICAgcmV0dXJuIHNhdmVBcztcbiAgICB9KFxuICAgICAgICB0eXBlb2Ygc2VsZiAhPT0gXCJ1bmRlZmluZWRcIiAmJiBzZWxmXG4gICAgICAgIHx8IHR5cGVvZiB3aW5kb3cgIT09IFwidW5kZWZpbmVkXCIgJiYgd2luZG93XG4gICAgICAgIHx8IHRoaXMuY29udGVudFxuICAgICkpO1xuLy8gYHNlbGZgIGlzIHVuZGVmaW5lZCBpbiBGaXJlZm94IGZvciBBbmRyb2lkIGNvbnRlbnQgc2NyaXB0IGNvbnRleHRcbi8vIHdoaWxlIGB0aGlzYCBpcyBuc0lDb250ZW50RnJhbWVNZXNzYWdlTWFuYWdlclxuLy8gd2l0aCBhbiBhdHRyaWJ1dGUgYGNvbnRlbnRgIHRoYXQgY29ycmVzcG9uZHMgdG8gdGhlIHdpbmRvd1xuXG5pZiAodHlwZW9mIG1vZHVsZSAhPT0gXCJ1bmRlZmluZWRcIiAmJiBtb2R1bGUuZXhwb3J0cykge1xuICAgIG1vZHVsZS5leHBvcnRzLnNhdmVBcyA9IHNhdmVBcztcbn0gZWxzZSBpZiAoKHR5cGVvZiBkZWZpbmUgIT09IFwidW5kZWZpbmVkXCIgJiYgZGVmaW5lICE9PSBudWxsKSAmJiAoZGVmaW5lLmFtZCAhPSBudWxsKSkge1xuICAgIGRlZmluZShbXSwgZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBzYXZlQXM7XG4gICAgfSk7XG59XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuLi9wbHVnaW5zL3NhdmVBcy5qc1xuLy8gbW9kdWxlIGlkID0gNjVcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiLyogV2ViIEZvbnQgTG9hZGVyIHYxLjYuMjYgLSAoYykgQWRvYmUgU3lzdGVtcywgR29vZ2xlLiBMaWNlbnNlOiBBcGFjaGUgMi4wICovKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gYWEoYSxiLGMpe3JldHVybiBhLmNhbGwuYXBwbHkoYS5iaW5kLGFyZ3VtZW50cyl9ZnVuY3Rpb24gYmEoYSxiLGMpe2lmKCFhKXRocm93IEVycm9yKCk7aWYoMjxhcmd1bWVudHMubGVuZ3RoKXt2YXIgZD1BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsMik7cmV0dXJuIGZ1bmN0aW9uKCl7dmFyIGM9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKTtBcnJheS5wcm90b3R5cGUudW5zaGlmdC5hcHBseShjLGQpO3JldHVybiBhLmFwcGx5KGIsYyl9fXJldHVybiBmdW5jdGlvbigpe3JldHVybiBhLmFwcGx5KGIsYXJndW1lbnRzKX19ZnVuY3Rpb24gcChhLGIsYyl7cD1GdW5jdGlvbi5wcm90b3R5cGUuYmluZCYmLTEhPUZ1bmN0aW9uLnByb3RvdHlwZS5iaW5kLnRvU3RyaW5nKCkuaW5kZXhPZihcIm5hdGl2ZSBjb2RlXCIpP2FhOmJhO3JldHVybiBwLmFwcGx5KG51bGwsYXJndW1lbnRzKX12YXIgcT1EYXRlLm5vd3x8ZnVuY3Rpb24oKXtyZXR1cm4rbmV3IERhdGV9O2Z1bmN0aW9uIGNhKGEsYil7dGhpcy5hPWE7dGhpcy5tPWJ8fGE7dGhpcy5jPXRoaXMubS5kb2N1bWVudH12YXIgZGE9ISF3aW5kb3cuRm9udEZhY2U7ZnVuY3Rpb24gdChhLGIsYyxkKXtiPWEuYy5jcmVhdGVFbGVtZW50KGIpO2lmKGMpZm9yKHZhciBlIGluIGMpYy5oYXNPd25Qcm9wZXJ0eShlKSYmKFwic3R5bGVcIj09ZT9iLnN0eWxlLmNzc1RleHQ9Y1tlXTpiLnNldEF0dHJpYnV0ZShlLGNbZV0pKTtkJiZiLmFwcGVuZENoaWxkKGEuYy5jcmVhdGVUZXh0Tm9kZShkKSk7cmV0dXJuIGJ9ZnVuY3Rpb24gdShhLGIsYyl7YT1hLmMuZ2V0RWxlbWVudHNCeVRhZ05hbWUoYilbMF07YXx8KGE9ZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KTthLmluc2VydEJlZm9yZShjLGEubGFzdENoaWxkKX1mdW5jdGlvbiB2KGEpe2EucGFyZW50Tm9kZSYmYS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGEpfVxuICBmdW5jdGlvbiB3KGEsYixjKXtiPWJ8fFtdO2M9Y3x8W107Zm9yKHZhciBkPWEuY2xhc3NOYW1lLnNwbGl0KC9cXHMrLyksZT0wO2U8Yi5sZW5ndGg7ZSs9MSl7Zm9yKHZhciBmPSExLGc9MDtnPGQubGVuZ3RoO2crPTEpaWYoYltlXT09PWRbZ10pe2Y9ITA7YnJlYWt9Znx8ZC5wdXNoKGJbZV0pfWI9W107Zm9yKGU9MDtlPGQubGVuZ3RoO2UrPTEpe2Y9ITE7Zm9yKGc9MDtnPGMubGVuZ3RoO2crPTEpaWYoZFtlXT09PWNbZ10pe2Y9ITA7YnJlYWt9Znx8Yi5wdXNoKGRbZV0pfWEuY2xhc3NOYW1lPWIuam9pbihcIiBcIikucmVwbGFjZSgvXFxzKy9nLFwiIFwiKS5yZXBsYWNlKC9eXFxzK3xcXHMrJC8sXCJcIil9ZnVuY3Rpb24geShhLGIpe2Zvcih2YXIgYz1hLmNsYXNzTmFtZS5zcGxpdCgvXFxzKy8pLGQ9MCxlPWMubGVuZ3RoO2Q8ZTtkKyspaWYoY1tkXT09YilyZXR1cm4hMDtyZXR1cm4hMX1cbiAgZnVuY3Rpb24geihhKXtpZihcInN0cmluZ1wiPT09dHlwZW9mIGEuZilyZXR1cm4gYS5mO3ZhciBiPWEubS5sb2NhdGlvbi5wcm90b2NvbDtcImFib3V0OlwiPT1iJiYoYj1hLmEubG9jYXRpb24ucHJvdG9jb2wpO3JldHVyblwiaHR0cHM6XCI9PWI/XCJodHRwczpcIjpcImh0dHA6XCJ9ZnVuY3Rpb24gZWEoYSl7cmV0dXJuIGEubS5sb2NhdGlvbi5ob3N0bmFtZXx8YS5hLmxvY2F0aW9uLmhvc3RuYW1lfVxuICBmdW5jdGlvbiBBKGEsYixjKXtmdW5jdGlvbiBkKCl7ayYmZSYmZiYmKGsoZyksaz1udWxsKX1iPXQoYSxcImxpbmtcIix7cmVsOlwic3R5bGVzaGVldFwiLGhyZWY6YixtZWRpYTpcImFsbFwifSk7dmFyIGU9ITEsZj0hMCxnPW51bGwsaz1jfHxudWxsO2RhPyhiLm9ubG9hZD1mdW5jdGlvbigpe2U9ITA7ZCgpfSxiLm9uZXJyb3I9ZnVuY3Rpb24oKXtlPSEwO2c9RXJyb3IoXCJTdHlsZXNoZWV0IGZhaWxlZCB0byBsb2FkXCIpO2QoKX0pOnNldFRpbWVvdXQoZnVuY3Rpb24oKXtlPSEwO2QoKX0sMCk7dShhLFwiaGVhZFwiLGIpfVxuICBmdW5jdGlvbiBCKGEsYixjLGQpe3ZhciBlPWEuYy5nZXRFbGVtZW50c0J5VGFnTmFtZShcImhlYWRcIilbMF07aWYoZSl7dmFyIGY9dChhLFwic2NyaXB0XCIse3NyYzpifSksZz0hMTtmLm9ubG9hZD1mLm9ucmVhZHlzdGF0ZWNoYW5nZT1mdW5jdGlvbigpe2d8fHRoaXMucmVhZHlTdGF0ZSYmXCJsb2FkZWRcIiE9dGhpcy5yZWFkeVN0YXRlJiZcImNvbXBsZXRlXCIhPXRoaXMucmVhZHlTdGF0ZXx8KGc9ITAsYyYmYyhudWxsKSxmLm9ubG9hZD1mLm9ucmVhZHlzdGF0ZWNoYW5nZT1udWxsLFwiSEVBRFwiPT1mLnBhcmVudE5vZGUudGFnTmFtZSYmZS5yZW1vdmVDaGlsZChmKSl9O2UuYXBwZW5kQ2hpbGQoZik7c2V0VGltZW91dChmdW5jdGlvbigpe2d8fChnPSEwLGMmJmMoRXJyb3IoXCJTY3JpcHQgbG9hZCB0aW1lb3V0XCIpKSl9LGR8fDVFMyk7cmV0dXJuIGZ9cmV0dXJuIG51bGx9O2Z1bmN0aW9uIEMoKXt0aGlzLmE9MDt0aGlzLmM9bnVsbH1mdW5jdGlvbiBEKGEpe2EuYSsrO3JldHVybiBmdW5jdGlvbigpe2EuYS0tO0UoYSl9fWZ1bmN0aW9uIEYoYSxiKXthLmM9YjtFKGEpfWZ1bmN0aW9uIEUoYSl7MD09YS5hJiZhLmMmJihhLmMoKSxhLmM9bnVsbCl9O2Z1bmN0aW9uIEcoYSl7dGhpcy5hPWF8fFwiLVwifUcucHJvdG90eXBlLmM9ZnVuY3Rpb24oYSl7Zm9yKHZhciBiPVtdLGM9MDtjPGFyZ3VtZW50cy5sZW5ndGg7YysrKWIucHVzaChhcmd1bWVudHNbY10ucmVwbGFjZSgvW1xcV19dKy9nLFwiXCIpLnRvTG93ZXJDYXNlKCkpO3JldHVybiBiLmpvaW4odGhpcy5hKX07ZnVuY3Rpb24gSChhLGIpe3RoaXMuYz1hO3RoaXMuZj00O3RoaXMuYT1cIm5cIjt2YXIgYz0oYnx8XCJuNFwiKS5tYXRjaCgvXihbbmlvXSkoWzEtOV0pJC9pKTtjJiYodGhpcy5hPWNbMV0sdGhpcy5mPXBhcnNlSW50KGNbMl0sMTApKX1mdW5jdGlvbiBmYShhKXtyZXR1cm4gSShhKStcIiBcIisoYS5mK1wiMDBcIikrXCIgMzAwcHggXCIrSihhLmMpfWZ1bmN0aW9uIEooYSl7dmFyIGI9W107YT1hLnNwbGl0KC8sXFxzKi8pO2Zvcih2YXIgYz0wO2M8YS5sZW5ndGg7YysrKXt2YXIgZD1hW2NdLnJlcGxhY2UoL1snXCJdL2csXCJcIik7LTEhPWQuaW5kZXhPZihcIiBcIil8fC9eXFxkLy50ZXN0KGQpP2IucHVzaChcIidcIitkK1wiJ1wiKTpiLnB1c2goZCl9cmV0dXJuIGIuam9pbihcIixcIil9ZnVuY3Rpb24gSyhhKXtyZXR1cm4gYS5hK2EuZn1mdW5jdGlvbiBJKGEpe3ZhciBiPVwibm9ybWFsXCI7XCJvXCI9PT1hLmE/Yj1cIm9ibGlxdWVcIjpcImlcIj09PWEuYSYmKGI9XCJpdGFsaWNcIik7cmV0dXJuIGJ9XG4gIGZ1bmN0aW9uIGdhKGEpe3ZhciBiPTQsYz1cIm5cIixkPW51bGw7YSYmKChkPWEubWF0Y2goLyhub3JtYWx8b2JsaXF1ZXxpdGFsaWMpL2kpKSYmZFsxXSYmKGM9ZFsxXS5zdWJzdHIoMCwxKS50b0xvd2VyQ2FzZSgpKSwoZD1hLm1hdGNoKC8oWzEtOV0wMHxub3JtYWx8Ym9sZCkvaSkpJiZkWzFdJiYoL2JvbGQvaS50ZXN0KGRbMV0pP2I9NzovWzEtOV0wMC8udGVzdChkWzFdKSYmKGI9cGFyc2VJbnQoZFsxXS5zdWJzdHIoMCwxKSwxMCkpKSk7cmV0dXJuIGMrYn07ZnVuY3Rpb24gaGEoYSxiKXt0aGlzLmM9YTt0aGlzLmY9YS5tLmRvY3VtZW50LmRvY3VtZW50RWxlbWVudDt0aGlzLmg9Yjt0aGlzLmE9bmV3IEcoXCItXCIpO3RoaXMuaj0hMSE9PWIuZXZlbnRzO3RoaXMuZz0hMSE9PWIuY2xhc3Nlc31mdW5jdGlvbiBpYShhKXthLmcmJncoYS5mLFthLmEuYyhcIndmXCIsXCJsb2FkaW5nXCIpXSk7TChhLFwibG9hZGluZ1wiKX1mdW5jdGlvbiBNKGEpe2lmKGEuZyl7dmFyIGI9eShhLmYsYS5hLmMoXCJ3ZlwiLFwiYWN0aXZlXCIpKSxjPVtdLGQ9W2EuYS5jKFwid2ZcIixcImxvYWRpbmdcIildO2J8fGMucHVzaChhLmEuYyhcIndmXCIsXCJpbmFjdGl2ZVwiKSk7dyhhLmYsYyxkKX1MKGEsXCJpbmFjdGl2ZVwiKX1mdW5jdGlvbiBMKGEsYixjKXtpZihhLmomJmEuaFtiXSlpZihjKWEuaFtiXShjLmMsSyhjKSk7ZWxzZSBhLmhbYl0oKX07ZnVuY3Rpb24gamEoKXt0aGlzLmM9e319ZnVuY3Rpb24ga2EoYSxiLGMpe3ZhciBkPVtdLGU7Zm9yKGUgaW4gYilpZihiLmhhc093blByb3BlcnR5KGUpKXt2YXIgZj1hLmNbZV07ZiYmZC5wdXNoKGYoYltlXSxjKSl9cmV0dXJuIGR9O2Z1bmN0aW9uIE4oYSxiKXt0aGlzLmM9YTt0aGlzLmY9Yjt0aGlzLmE9dCh0aGlzLmMsXCJzcGFuXCIse1wiYXJpYS1oaWRkZW5cIjpcInRydWVcIn0sdGhpcy5mKX1mdW5jdGlvbiBPKGEpe3UoYS5jLFwiYm9keVwiLGEuYSl9ZnVuY3Rpb24gUChhKXtyZXR1cm5cImRpc3BsYXk6YmxvY2s7cG9zaXRpb246YWJzb2x1dGU7dG9wOi05OTk5cHg7bGVmdDotOTk5OXB4O2ZvbnQtc2l6ZTozMDBweDt3aWR0aDphdXRvO2hlaWdodDphdXRvO2xpbmUtaGVpZ2h0Om5vcm1hbDttYXJnaW46MDtwYWRkaW5nOjA7Zm9udC12YXJpYW50Om5vcm1hbDt3aGl0ZS1zcGFjZTpub3dyYXA7Zm9udC1mYW1pbHk6XCIrSihhLmMpK1wiO1wiKyhcImZvbnQtc3R5bGU6XCIrSShhKStcIjtmb250LXdlaWdodDpcIisoYS5mK1wiMDBcIikrXCI7XCIpfTtmdW5jdGlvbiBRKGEsYixjLGQsZSxmKXt0aGlzLmc9YTt0aGlzLmo9Yjt0aGlzLmE9ZDt0aGlzLmM9Yzt0aGlzLmY9ZXx8M0UzO3RoaXMuaD1mfHx2b2lkIDB9US5wcm90b3R5cGUuc3RhcnQ9ZnVuY3Rpb24oKXt2YXIgYT10aGlzLmMubS5kb2N1bWVudCxiPXRoaXMsYz1xKCksZD1uZXcgUHJvbWlzZShmdW5jdGlvbihkLGUpe2Z1bmN0aW9uIGsoKXtxKCktYz49Yi5mP2UoKTphLmZvbnRzLmxvYWQoZmEoYi5hKSxiLmgpLnRoZW4oZnVuY3Rpb24oYSl7MTw9YS5sZW5ndGg/ZCgpOnNldFRpbWVvdXQoaywyNSl9LGZ1bmN0aW9uKCl7ZSgpfSl9aygpfSksZT1uZXcgUHJvbWlzZShmdW5jdGlvbihhLGQpe3NldFRpbWVvdXQoZCxiLmYpfSk7UHJvbWlzZS5yYWNlKFtlLGRdKS50aGVuKGZ1bmN0aW9uKCl7Yi5nKGIuYSl9LGZ1bmN0aW9uKCl7Yi5qKGIuYSl9KX07ZnVuY3Rpb24gUihhLGIsYyxkLGUsZixnKXt0aGlzLnY9YTt0aGlzLkI9Yjt0aGlzLmM9Yzt0aGlzLmE9ZDt0aGlzLnM9Z3x8XCJCRVNic3d5XCI7dGhpcy5mPXt9O3RoaXMudz1lfHwzRTM7dGhpcy51PWZ8fG51bGw7dGhpcy5vPXRoaXMuaj10aGlzLmg9dGhpcy5nPW51bGw7dGhpcy5nPW5ldyBOKHRoaXMuYyx0aGlzLnMpO3RoaXMuaD1uZXcgTih0aGlzLmMsdGhpcy5zKTt0aGlzLmo9bmV3IE4odGhpcy5jLHRoaXMucyk7dGhpcy5vPW5ldyBOKHRoaXMuYyx0aGlzLnMpO2E9bmV3IEgodGhpcy5hLmMrXCIsc2VyaWZcIixLKHRoaXMuYSkpO2E9UChhKTt0aGlzLmcuYS5zdHlsZS5jc3NUZXh0PWE7YT1uZXcgSCh0aGlzLmEuYytcIixzYW5zLXNlcmlmXCIsSyh0aGlzLmEpKTthPVAoYSk7dGhpcy5oLmEuc3R5bGUuY3NzVGV4dD1hO2E9bmV3IEgoXCJzZXJpZlwiLEsodGhpcy5hKSk7YT1QKGEpO3RoaXMuai5hLnN0eWxlLmNzc1RleHQ9YTthPW5ldyBIKFwic2Fucy1zZXJpZlwiLEsodGhpcy5hKSk7YT1cbiAgICBQKGEpO3RoaXMuby5hLnN0eWxlLmNzc1RleHQ9YTtPKHRoaXMuZyk7Tyh0aGlzLmgpO08odGhpcy5qKTtPKHRoaXMubyl9dmFyIFM9e0Q6XCJzZXJpZlwiLEM6XCJzYW5zLXNlcmlmXCJ9LFQ9bnVsbDtmdW5jdGlvbiBVKCl7aWYobnVsbD09PVQpe3ZhciBhPS9BcHBsZVdlYktpdFxcLyhbMC05XSspKD86XFwuKFswLTldKykpLy5leGVjKHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50KTtUPSEhYSYmKDUzNj5wYXJzZUludChhWzFdLDEwKXx8NTM2PT09cGFyc2VJbnQoYVsxXSwxMCkmJjExPj1wYXJzZUludChhWzJdLDEwKSl9cmV0dXJuIFR9Ui5wcm90b3R5cGUuc3RhcnQ9ZnVuY3Rpb24oKXt0aGlzLmYuc2VyaWY9dGhpcy5qLmEub2Zmc2V0V2lkdGg7dGhpcy5mW1wic2Fucy1zZXJpZlwiXT10aGlzLm8uYS5vZmZzZXRXaWR0aDt0aGlzLkE9cSgpO2xhKHRoaXMpfTtcbiAgZnVuY3Rpb24gbWEoYSxiLGMpe2Zvcih2YXIgZCBpbiBTKWlmKFMuaGFzT3duUHJvcGVydHkoZCkmJmI9PT1hLmZbU1tkXV0mJmM9PT1hLmZbU1tkXV0pcmV0dXJuITA7cmV0dXJuITF9ZnVuY3Rpb24gbGEoYSl7dmFyIGI9YS5nLmEub2Zmc2V0V2lkdGgsYz1hLmguYS5vZmZzZXRXaWR0aCxkOyhkPWI9PT1hLmYuc2VyaWYmJmM9PT1hLmZbXCJzYW5zLXNlcmlmXCJdKXx8KGQ9VSgpJiZtYShhLGIsYykpO2Q/cSgpLWEuQT49YS53P1UoKSYmbWEoYSxiLGMpJiYobnVsbD09PWEudXx8YS51Lmhhc093blByb3BlcnR5KGEuYS5jKSk/VihhLGEudik6VihhLGEuQik6bmEoYSk6VihhLGEudil9ZnVuY3Rpb24gbmEoYSl7c2V0VGltZW91dChwKGZ1bmN0aW9uKCl7bGEodGhpcyl9LGEpLDUwKX1mdW5jdGlvbiBWKGEsYil7c2V0VGltZW91dChwKGZ1bmN0aW9uKCl7dih0aGlzLmcuYSk7dih0aGlzLmguYSk7dih0aGlzLmouYSk7dih0aGlzLm8uYSk7Yih0aGlzLmEpfSxhKSwwKX07ZnVuY3Rpb24gVyhhLGIsYyl7dGhpcy5jPWE7dGhpcy5hPWI7dGhpcy5mPTA7dGhpcy5vPXRoaXMuaj0hMTt0aGlzLnM9Y312YXIgWD1udWxsO1cucHJvdG90eXBlLmc9ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5hO2IuZyYmdyhiLmYsW2IuYS5jKFwid2ZcIixhLmMsSyhhKS50b1N0cmluZygpLFwiYWN0aXZlXCIpXSxbYi5hLmMoXCJ3ZlwiLGEuYyxLKGEpLnRvU3RyaW5nKCksXCJsb2FkaW5nXCIpLGIuYS5jKFwid2ZcIixhLmMsSyhhKS50b1N0cmluZygpLFwiaW5hY3RpdmVcIildKTtMKGIsXCJmb250YWN0aXZlXCIsYSk7dGhpcy5vPSEwO29hKHRoaXMpfTtcbiAgVy5wcm90b3R5cGUuaD1mdW5jdGlvbihhKXt2YXIgYj10aGlzLmE7aWYoYi5nKXt2YXIgYz15KGIuZixiLmEuYyhcIndmXCIsYS5jLEsoYSkudG9TdHJpbmcoKSxcImFjdGl2ZVwiKSksZD1bXSxlPVtiLmEuYyhcIndmXCIsYS5jLEsoYSkudG9TdHJpbmcoKSxcImxvYWRpbmdcIildO2N8fGQucHVzaChiLmEuYyhcIndmXCIsYS5jLEsoYSkudG9TdHJpbmcoKSxcImluYWN0aXZlXCIpKTt3KGIuZixkLGUpfUwoYixcImZvbnRpbmFjdGl2ZVwiLGEpO29hKHRoaXMpfTtmdW5jdGlvbiBvYShhKXswPT0tLWEuZiYmYS5qJiYoYS5vPyhhPWEuYSxhLmcmJncoYS5mLFthLmEuYyhcIndmXCIsXCJhY3RpdmVcIildLFthLmEuYyhcIndmXCIsXCJsb2FkaW5nXCIpLGEuYS5jKFwid2ZcIixcImluYWN0aXZlXCIpXSksTChhLFwiYWN0aXZlXCIpKTpNKGEuYSkpfTtmdW5jdGlvbiBwYShhKXt0aGlzLmo9YTt0aGlzLmE9bmV3IGphO3RoaXMuaD0wO3RoaXMuZj10aGlzLmc9ITB9cGEucHJvdG90eXBlLmxvYWQ9ZnVuY3Rpb24oYSl7dGhpcy5jPW5ldyBjYSh0aGlzLmosYS5jb250ZXh0fHx0aGlzLmopO3RoaXMuZz0hMSE9PWEuZXZlbnRzO3RoaXMuZj0hMSE9PWEuY2xhc3NlcztxYSh0aGlzLG5ldyBoYSh0aGlzLmMsYSksYSl9O1xuICBmdW5jdGlvbiByYShhLGIsYyxkLGUpe3ZhciBmPTA9PS0tYS5oOyhhLmZ8fGEuZykmJnNldFRpbWVvdXQoZnVuY3Rpb24oKXt2YXIgYT1lfHxudWxsLGs9ZHx8bnVsbHx8e307aWYoMD09PWMubGVuZ3RoJiZmKU0oYi5hKTtlbHNle2IuZis9Yy5sZW5ndGg7ZiYmKGIuaj1mKTt2YXIgaCxtPVtdO2ZvcihoPTA7aDxjLmxlbmd0aDtoKyspe3ZhciBsPWNbaF0sbj1rW2wuY10scj1iLmEseD1sO3IuZyYmdyhyLmYsW3IuYS5jKFwid2ZcIix4LmMsSyh4KS50b1N0cmluZygpLFwibG9hZGluZ1wiKV0pO0wocixcImZvbnRsb2FkaW5nXCIseCk7cj1udWxsO251bGw9PT1YJiYoWD13aW5kb3cuRm9udEZhY2U/KHg9L0dlY2tvLipGaXJlZm94XFwvKFxcZCspLy5leGVjKHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50KSk/NDI8cGFyc2VJbnQoeFsxXSwxMCk6ITA6ITEpO1g/cj1uZXcgUShwKGIuZyxiKSxwKGIuaCxiKSxiLmMsbCxiLnMsbik6cj1uZXcgUihwKGIuZyxiKSxwKGIuaCxiKSxiLmMsbCxiLnMsYSxcbiAgICBuKTttLnB1c2gocil9Zm9yKGg9MDtoPG0ubGVuZ3RoO2grKyltW2hdLnN0YXJ0KCl9fSwwKX1mdW5jdGlvbiBxYShhLGIsYyl7dmFyIGQ9W10sZT1jLnRpbWVvdXQ7aWEoYik7dmFyIGQ9a2EoYS5hLGMsYS5jKSxmPW5ldyBXKGEuYyxiLGUpO2EuaD1kLmxlbmd0aDtiPTA7Zm9yKGM9ZC5sZW5ndGg7YjxjO2IrKylkW2JdLmxvYWQoZnVuY3Rpb24oYixkLGMpe3JhKGEsZixiLGQsYyl9KX07ZnVuY3Rpb24gc2EoYSxiKXt0aGlzLmM9YTt0aGlzLmE9Yn1mdW5jdGlvbiB0YShhLGIsYyl7dmFyIGQ9eihhLmMpO2E9KGEuYS5hcGl8fFwiZmFzdC5mb250cy5uZXQvanNhcGlcIikucmVwbGFjZSgvXi4qaHR0cChzPyk6KFxcL1xcLyk/LyxcIlwiKTtyZXR1cm4gZCtcIi8vXCIrYStcIi9cIitiK1wiLmpzXCIrKGM/XCI/dj1cIitjOlwiXCIpfVxuICBzYS5wcm90b3R5cGUubG9hZD1mdW5jdGlvbihhKXtmdW5jdGlvbiBiKCl7aWYoZltcIl9fbXRpX2ZudExzdFwiK2RdKXt2YXIgYz1mW1wiX19tdGlfZm50THN0XCIrZF0oKSxlPVtdLGg7aWYoYylmb3IodmFyIG09MDttPGMubGVuZ3RoO20rKyl7dmFyIGw9Y1ttXS5mb250ZmFtaWx5O3ZvaWQgMCE9Y1ttXS5mb250U3R5bGUmJnZvaWQgMCE9Y1ttXS5mb250V2VpZ2h0PyhoPWNbbV0uZm9udFN0eWxlK2NbbV0uZm9udFdlaWdodCxlLnB1c2gobmV3IEgobCxoKSkpOmUucHVzaChuZXcgSChsKSl9YShlKX1lbHNlIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtiKCl9LDUwKX12YXIgYz10aGlzLGQ9Yy5hLnByb2plY3RJZCxlPWMuYS52ZXJzaW9uO2lmKGQpe3ZhciBmPWMuYy5tO0IodGhpcy5jLHRhKGMsZCxlKSxmdW5jdGlvbihlKXtlP2EoW10pOihmW1wiX19Nb25vdHlwZUNvbmZpZ3VyYXRpb25fX1wiK2RdPWZ1bmN0aW9uKCl7cmV0dXJuIGMuYX0sYigpKX0pLmlkPVwiX19Nb25vdHlwZUFQSVNjcmlwdF9fXCIrXG4gICAgZH1lbHNlIGEoW10pfTtmdW5jdGlvbiB1YShhLGIpe3RoaXMuYz1hO3RoaXMuYT1ifXVhLnByb3RvdHlwZS5sb2FkPWZ1bmN0aW9uKGEpe3ZhciBiLGMsZD10aGlzLmEudXJsc3x8W10sZT10aGlzLmEuZmFtaWxpZXN8fFtdLGY9dGhpcy5hLnRlc3RTdHJpbmdzfHx7fSxnPW5ldyBDO2I9MDtmb3IoYz1kLmxlbmd0aDtiPGM7YisrKUEodGhpcy5jLGRbYl0sRChnKSk7dmFyIGs9W107Yj0wO2ZvcihjPWUubGVuZ3RoO2I8YztiKyspaWYoZD1lW2JdLnNwbGl0KFwiOlwiKSxkWzFdKWZvcih2YXIgaD1kWzFdLnNwbGl0KFwiLFwiKSxtPTA7bTxoLmxlbmd0aDttKz0xKWsucHVzaChuZXcgSChkWzBdLGhbbV0pKTtlbHNlIGsucHVzaChuZXcgSChkWzBdKSk7RihnLGZ1bmN0aW9uKCl7YShrLGYpfSl9O2Z1bmN0aW9uIHZhKGEsYixjKXthP3RoaXMuYz1hOnRoaXMuYz1iK3dhO3RoaXMuYT1bXTt0aGlzLmY9W107dGhpcy5nPWN8fFwiXCJ9dmFyIHdhPVwiLy9mb250cy5nb29nbGVhcGlzLmNvbS9jc3NcIjtmdW5jdGlvbiB4YShhLGIpe2Zvcih2YXIgYz1iLmxlbmd0aCxkPTA7ZDxjO2QrKyl7dmFyIGU9YltkXS5zcGxpdChcIjpcIik7Mz09ZS5sZW5ndGgmJmEuZi5wdXNoKGUucG9wKCkpO3ZhciBmPVwiXCI7Mj09ZS5sZW5ndGgmJlwiXCIhPWVbMV0mJihmPVwiOlwiKTthLmEucHVzaChlLmpvaW4oZikpfX1cbiAgZnVuY3Rpb24geWEoYSl7aWYoMD09YS5hLmxlbmd0aCl0aHJvdyBFcnJvcihcIk5vIGZvbnRzIHRvIGxvYWQhXCIpO2lmKC0xIT1hLmMuaW5kZXhPZihcImtpdD1cIikpcmV0dXJuIGEuYztmb3IodmFyIGI9YS5hLmxlbmd0aCxjPVtdLGQ9MDtkPGI7ZCsrKWMucHVzaChhLmFbZF0ucmVwbGFjZSgvIC9nLFwiK1wiKSk7Yj1hLmMrXCI/ZmFtaWx5PVwiK2Muam9pbihcIiU3Q1wiKTswPGEuZi5sZW5ndGgmJihiKz1cIiZzdWJzZXQ9XCIrYS5mLmpvaW4oXCIsXCIpKTswPGEuZy5sZW5ndGgmJihiKz1cIiZ0ZXh0PVwiK2VuY29kZVVSSUNvbXBvbmVudChhLmcpKTtyZXR1cm4gYn07ZnVuY3Rpb24gemEoYSl7dGhpcy5mPWE7dGhpcy5hPVtdO3RoaXMuYz17fX1cbiAgdmFyIEFhPXtsYXRpbjpcIkJFU2Jzd3lcIixcImxhdGluLWV4dFwiOlwiXFx1MDBlN1xcdTAwZjZcXHUwMGZjXFx1MDExZlxcdTAxNWZcIixjeXJpbGxpYzpcIlxcdTA0MzlcXHUwNDRmXFx1MDQxNlwiLGdyZWVrOlwiXFx1MDNiMVxcdTAzYjJcXHUwM2EzXCIsa2htZXI6XCJcXHUxNzgwXFx1MTc4MVxcdTE3ODJcIixIYW51bWFuOlwiXFx1MTc4MFxcdTE3ODFcXHUxNzgyXCJ9LEJhPXt0aGluOlwiMVwiLGV4dHJhbGlnaHQ6XCIyXCIsXCJleHRyYS1saWdodFwiOlwiMlwiLHVsdHJhbGlnaHQ6XCIyXCIsXCJ1bHRyYS1saWdodFwiOlwiMlwiLGxpZ2h0OlwiM1wiLHJlZ3VsYXI6XCI0XCIsYm9vazpcIjRcIixtZWRpdW06XCI1XCIsXCJzZW1pLWJvbGRcIjpcIjZcIixzZW1pYm9sZDpcIjZcIixcImRlbWktYm9sZFwiOlwiNlwiLGRlbWlib2xkOlwiNlwiLGJvbGQ6XCI3XCIsXCJleHRyYS1ib2xkXCI6XCI4XCIsZXh0cmFib2xkOlwiOFwiLFwidWx0cmEtYm9sZFwiOlwiOFwiLHVsdHJhYm9sZDpcIjhcIixibGFjazpcIjlcIixoZWF2eTpcIjlcIixsOlwiM1wiLHI6XCI0XCIsYjpcIjdcIn0sQ2E9e2k6XCJpXCIsaXRhbGljOlwiaVwiLG46XCJuXCIsbm9ybWFsOlwiblwifSxcbiAgICBEYT0vXih0aGlufCg/Oig/OmV4dHJhfHVsdHJhKS0/KT9saWdodHxyZWd1bGFyfGJvb2t8bWVkaXVtfCg/Oig/OnNlbWl8ZGVtaXxleHRyYXx1bHRyYSktPyk/Ym9sZHxibGFja3xoZWF2eXxsfHJ8YnxbMS05XTAwKT8obnxpfG5vcm1hbHxpdGFsaWMpPyQvO1xuICBmdW5jdGlvbiBFYShhKXtmb3IodmFyIGI9YS5mLmxlbmd0aCxjPTA7YzxiO2MrKyl7dmFyIGQ9YS5mW2NdLnNwbGl0KFwiOlwiKSxlPWRbMF0ucmVwbGFjZSgvXFwrL2csXCIgXCIpLGY9W1wibjRcIl07aWYoMjw9ZC5sZW5ndGgpe3ZhciBnO3ZhciBrPWRbMV07Zz1bXTtpZihrKWZvcih2YXIgaz1rLnNwbGl0KFwiLFwiKSxoPWsubGVuZ3RoLG09MDttPGg7bSsrKXt2YXIgbDtsPWtbbV07aWYobC5tYXRjaCgvXltcXHctXSskLykpe3ZhciBuPURhLmV4ZWMobC50b0xvd2VyQ2FzZSgpKTtpZihudWxsPT1uKWw9XCJcIjtlbHNle2w9blsyXTtsPW51bGw9PWx8fFwiXCI9PWw/XCJuXCI6Q2FbbF07bj1uWzFdO2lmKG51bGw9PW58fFwiXCI9PW4pbj1cIjRcIjtlbHNlIHZhciByPUJhW25dLG49cj9yOmlzTmFOKG4pP1wiNFwiOm4uc3Vic3RyKDAsMSk7bD1bbCxuXS5qb2luKFwiXCIpfX1lbHNlIGw9XCJcIjtsJiZnLnB1c2gobCl9MDxnLmxlbmd0aCYmKGY9Zyk7Mz09ZC5sZW5ndGgmJihkPWRbMl0sZz1bXSxkPWQ/ZC5zcGxpdChcIixcIik6XG4gICAgZywwPGQubGVuZ3RoJiYoZD1BYVtkWzBdXSkmJihhLmNbZV09ZCkpfWEuY1tlXXx8KGQ9QWFbZV0pJiYoYS5jW2VdPWQpO2ZvcihkPTA7ZDxmLmxlbmd0aDtkKz0xKWEuYS5wdXNoKG5ldyBIKGUsZltkXSkpfX07ZnVuY3Rpb24gRmEoYSxiKXt0aGlzLmM9YTt0aGlzLmE9Yn12YXIgR2E9e0FyaW1vOiEwLENvdXNpbmU6ITAsVGlub3M6ITB9O0ZhLnByb3RvdHlwZS5sb2FkPWZ1bmN0aW9uKGEpe3ZhciBiPW5ldyBDLGM9dGhpcy5jLGQ9bmV3IHZhKHRoaXMuYS5hcGkseihjKSx0aGlzLmEudGV4dCksZT10aGlzLmEuZmFtaWxpZXM7eGEoZCxlKTt2YXIgZj1uZXcgemEoZSk7RWEoZik7QShjLHlhKGQpLEQoYikpO0YoYixmdW5jdGlvbigpe2EoZi5hLGYuYyxHYSl9KX07ZnVuY3Rpb24gSGEoYSxiKXt0aGlzLmM9YTt0aGlzLmE9Yn1IYS5wcm90b3R5cGUubG9hZD1mdW5jdGlvbihhKXt2YXIgYj10aGlzLmEuaWQsYz10aGlzLmMubTtiP0IodGhpcy5jLCh0aGlzLmEuYXBpfHxcImh0dHBzOi8vdXNlLnR5cGVraXQubmV0XCIpK1wiL1wiK2IrXCIuanNcIixmdW5jdGlvbihiKXtpZihiKWEoW10pO2Vsc2UgaWYoYy5UeXBla2l0JiZjLlR5cGVraXQuY29uZmlnJiZjLlR5cGVraXQuY29uZmlnLmZuKXtiPWMuVHlwZWtpdC5jb25maWcuZm47Zm9yKHZhciBlPVtdLGY9MDtmPGIubGVuZ3RoO2YrPTIpZm9yKHZhciBnPWJbZl0saz1iW2YrMV0saD0wO2g8ay5sZW5ndGg7aCsrKWUucHVzaChuZXcgSChnLGtbaF0pKTt0cnl7Yy5UeXBla2l0LmxvYWQoe2V2ZW50czohMSxjbGFzc2VzOiExLGFzeW5jOiEwfSl9Y2F0Y2gobSl7fWEoZSl9fSwyRTMpOmEoW10pfTtmdW5jdGlvbiBJYShhLGIpe3RoaXMuYz1hO3RoaXMuZj1iO3RoaXMuYT1bXX1JYS5wcm90b3R5cGUubG9hZD1mdW5jdGlvbihhKXt2YXIgYj10aGlzLmYuaWQsYz10aGlzLmMubSxkPXRoaXM7Yj8oYy5fX3dlYmZvbnRmb250ZGVja21vZHVsZV9ffHwoYy5fX3dlYmZvbnRmb250ZGVja21vZHVsZV9fPXt9KSxjLl9fd2ViZm9udGZvbnRkZWNrbW9kdWxlX19bYl09ZnVuY3Rpb24oYixjKXtmb3IodmFyIGc9MCxrPWMuZm9udHMubGVuZ3RoO2c8azsrK2cpe3ZhciBoPWMuZm9udHNbZ107ZC5hLnB1c2gobmV3IEgoaC5uYW1lLGdhKFwiZm9udC13ZWlnaHQ6XCIraC53ZWlnaHQrXCI7Zm9udC1zdHlsZTpcIitoLnN0eWxlKSkpfWEoZC5hKX0sQih0aGlzLmMseih0aGlzLmMpKyh0aGlzLmYuYXBpfHxcIi8vZi5mb250ZGVjay5jb20vcy9jc3MvanMvXCIpK2VhKHRoaXMuYykrXCIvXCIrYitcIi5qc1wiLGZ1bmN0aW9uKGIpe2ImJmEoW10pfSkpOmEoW10pfTt2YXIgWT1uZXcgcGEod2luZG93KTtZLmEuYy5jdXN0b209ZnVuY3Rpb24oYSxiKXtyZXR1cm4gbmV3IHVhKGIsYSl9O1kuYS5jLmZvbnRkZWNrPWZ1bmN0aW9uKGEsYil7cmV0dXJuIG5ldyBJYShiLGEpfTtZLmEuYy5tb25vdHlwZT1mdW5jdGlvbihhLGIpe3JldHVybiBuZXcgc2EoYixhKX07WS5hLmMudHlwZWtpdD1mdW5jdGlvbihhLGIpe3JldHVybiBuZXcgSGEoYixhKX07WS5hLmMuZ29vZ2xlPWZ1bmN0aW9uKGEsYil7cmV0dXJuIG5ldyBGYShiLGEpfTt2YXIgWj17bG9hZDpwKFkubG9hZCxZKX07XCJmdW5jdGlvblwiPT09dHlwZW9mIGRlZmluZSYmZGVmaW5lLmFtZD9kZWZpbmUoZnVuY3Rpb24oKXtyZXR1cm4gWn0pOlwidW5kZWZpbmVkXCIhPT10eXBlb2YgbW9kdWxlJiZtb2R1bGUuZXhwb3J0cz9tb2R1bGUuZXhwb3J0cz1aOih3aW5kb3cuV2ViRm9udD1aLHdpbmRvdy5XZWJGb250Q29uZmlnJiZZLmxvYWQod2luZG93LldlYkZvbnRDb25maWcpKTt9KCkpO1xuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi4vcGx1Z2lucy93ZWJmb250LmpzXG4vLyBtb2R1bGUgaWQgPSA2NlxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCJmYWJyaWMuZGVidWcgPSBERVZFTE9QTUVOVDtcbmZhYnJpYy5leHRlbnNpb25zID0gW107XG5mYWJyaWMudXRpbC5kYXRhID0gcmVxdWlyZSgnLi91dGlsL2RhdGEnKTtcbmZhYnJpYy51dGlsLnBhdGggPSByZXF1aXJlKCcuL3V0aWwvcGF0aCcpO1xuZmFicmljLnV0aWwuY29tcGlsZSA9IHJlcXVpcmUoJy4vdXRpbC9jb21waWxlJyk7XG5mYWJyaWMudXRpbC5sb2FkZXIgPSByZXF1aXJlKCcuL3V0aWwvbG9hZGVyJyk7XG5mYWJyaWMudXRpbC5zeW50YXggPSByZXF1aXJlKFwiLi91dGlsL3N5bnRheFwiKTtcbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLnV0aWwub2JqZWN0LHJlcXVpcmUoJy4vdXRpbC9vYmplY3QuanMnKSk7XG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy51dGlsLHJlcXVpcmUoJy4vdXRpbC91dGlsLmpzJykpO1xuXG4vL3JlcXVpcmUoJy4vbW9kdWxlcycpO1xuXG5yZXF1aXJlKCcuL2NvcmUvYmFzZScpO1xucmVxdWlyZSgnLi9jb3JlL29ic2VydmUnKTtcbnJlcXVpcmUoJy4vY29yZS9hcHBsaWNhdGlvbicpO1xucmVxdWlyZSgnLi9jb3JlL3N0YXRpYy1jYW52YXMuZXh0Jyk7XG5yZXF1aXJlKCcuL2NvcmUvc2xpZGUnKTtcbnJlcXVpcmUoJy4vY29yZS9hcHBsaWNhdGlvbi5zbGlkZXMnKTtcbnJlcXVpcmUoJy4vY29yZS9hcHBsaWNhdGlvbi5wcm90b3R5cGVzJyk7XG5yZXF1aXJlKCcuL2NvcmUvb2JqZWN0LmV4dCcpO1xucmVxdWlyZSgnLi9jb3JlL3RleHQuZXh0Jyk7XG5yZXF1aXJlKCcuL2NvcmUvZ3JvdXAuZXh0Jyk7XG5yZXF1aXJlKCcuL2NvcmUvaW1hZ2UuZXh0Jyk7XG5yZXF1aXJlKCcuL21vZHVsZXMvdG9vbGJhcicpO1xucmVxdWlyZSgnLi9tb2R1bGVzL2NhbnZhcy5ldmVudHMnKTtcbnJlcXVpcmUoJy4vbW9kdWxlcy9pbWFnZS5maWx0ZXJzJyk7XG5yZXF1aXJlKCcuL21vZHVsZXMvZm9udHMnKTtcbnJlcXVpcmUoJy4vbW9kdWxlcy9nYWxsZXJ5Jyk7XG5yZXF1aXJlKCcuL21vZHVsZXMvbGlicmFyeScpO1xucmVxdWlyZSgnLi9tb2R1bGVzL2RlYnVnJyk7XG5yZXF1aXJlKCcuL21vZHVsZXMvZnJvbVVSTCcpO1xucmVxdWlyZSgnLi9tb2R1bGVzL3VwbG9hZCcpO1xucmVxdWlyZSgnLi9tb2R1bGVzL2xvYWRlcicpO1xucmVxdWlyZSgnLi9tb2R1bGVzL2Ryb3BwYWJsZScpO1xucmVxdWlyZSgnLi9tb2R1bGVzL3JlbmRlcicpO1xucmVxdWlyZSgnLi9tb2R1bGVzL3RodW1iJyk7XG5yZXF1aXJlKCcuL21vZHVsZXMvY2xpcFRvJyk7XG5yZXF1aXJlKCcuL21vZHVsZXMvbW92ZW1lbnRMaW1pdHMnKTtcbnJlcXVpcmUoJy4vbW9kdWxlcy9oaXN0b3J5Jyk7XG5yZXF1aXJlKCcuL21vZHVsZXMvem9vbScpO1xucmVxdWlyZSgnLi9tb2R1bGVzL2ludGVyYWN0aXZlTW9kZScpO1xucmVxdWlyZSgnLi9tb2R1bGVzL2JvcmRlckltYWdlJyk7XG5yZXF1aXJlKCcuL21vZHVsZXMvc2F2ZUFzJyk7XG5yZXF1aXJlKCcuL21vZHVsZXMvc2xpZGUuZHJhd2luZy10b29scycpO1xucmVxdWlyZSgnLi9icnVzaGVzL0Jhc2VCcnVzaCcpO1xucmVxdWlyZSgnLi9icnVzaGVzL1BlbmNpbEJydXNoJyk7XG5yZXF1aXJlKCcuL2JydXNoZXMvUmVjdGFuZ2xlQnJ1c2gnKTtcbnJlcXVpcmUoJy4vYnJ1c2hlcy9Qb2x5Z29uQnJ1c2gnKTtcbnJlcXVpcmUoJy4vYnJ1c2hlcy9QYWludFBlbkJydXNoJyk7XG5yZXF1aXJlKCcuL2JydXNoZXMvUGFpbnRCdWNrZXRCcnVzaCcpO1xucmVxdWlyZSgnLi9icnVzaGVzL1BvaW50c0JydXNoJyk7XG5yZXF1aXJlKCcuL3NoYXBlcy9wYXRoJyk7XG5yZXF1aXJlKCcuL3NoYXBlcy9jbGlwYXJ0Jyk7XG5yZXF1aXJlKCcuL3NoYXBlcy9pbWFnZS5waG90b3Nob3AtdG9vbHMnKTtcbnJlcXVpcmUoJy4vc2hhcGVzL2ltYWdlLnJlbW92ZS13aGl0ZScpO1xucmVxdWlyZSgnLi9zaGFwZXMvdGV4dGJveC5saXN0Jyk7XG5cblxuaWYoIWZhYnJpYy5pc0xpa2VseU5vZGUpe1xuICAvKipcbiAgICogaW5saW5lIHNjcmlwdCBpbWFnZXNcbiAgICogQHR5cGUge3tlcnJvcjogc3RyaW5nfX1cbiAgICovXG4gIGZhYnJpYy5tZWRpYSA9IHtcbiAgICAvKipcbiAgICAgKiByZXBsYWNlIGltYWdlcyBsb2FkZWQgd2l0aCBlcnJvcnNcbiAgICAgKi9cbiAgICBlcnJvcjogJ2RhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsJyArIHJlcXVpcmUoJ2Jhc2U2NC1sb2FkZXIhLi9tZWRpYS9lcnJvci1idXR0b24uc3ZnJylcbiAgfTtcbn1cblxubW9kdWxlLmV4cG9ydHMgID0gZmFicmljO1xuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9maWVyYS5qc1xuLy8gbW9kdWxlIGlkID0gNjdcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiJ3VzZSBzdHJpY3QnO1xuXG5cbmZhYnJpYy5SZW1vdmVXaGl0ZURQID0gZmFicmljLkltYWdlLmZpbHRlcnMuUmVtb3ZlV2hpdGVEUCA9ICBmYWJyaWMudXRpbC5jcmVhdGVDbGFzcyhmYWJyaWMuSW1hZ2UuZmlsdGVycy5CYXNlRmlsdGVyLHtcbiAgICB0eXBlOiAnUmVtb3ZlV2hpdGVEUCcsXG4gICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgICBpZihvcHRpb25zKWRlbGV0ZSBvcHRpb25zLnR5cGU7XG4gICAgICAgIHRoaXMub3B0aW9ucyA9IGZhYnJpYy51dGlsLm9iamVjdC5kZWZhdWx0cyhvcHRpb25zIHx8IHt9LHtcbiAgICAgICAgICAgICAgICBmcm9tQ29ybmVycyA6IHRydWUsXG4gICAgICAgICAgICAgICAgYmx1clJhZGl1czogMixcbiAgICAgICAgICAgICAgICBjb2xvclRocmVzaG9sZDogMzJcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB0aGlzLnBhdGhmaW5kZXIgPSBuZXcgZmFicmljLlBhdGhmaW5kZXIodGhpcy5vcHRpb25zKTtcbiAgICB9LFxuICAgIGFwcGx5VG86IGZ1bmN0aW9uKGNhbnZhc0VsKSB7XG5cbiAgICAgICAgdmFyIHBhdGhmaW5kZXIgPSB0aGlzLnBhdGhmaW5kZXI7XG5cbiAgICAgICAgcGF0aGZpbmRlci5jb2xvclRocmVzaG9sZCA9IHRoaXMub3B0aW9ucy5jb2xvclRocmVzaG9sZDtcbiAgICAgICAgcGF0aGZpbmRlci5zZXRQaWN0dXJlKGNhbnZhc0VsKTtcbiAgICAgICAgcGF0aGZpbmRlci5zZWxlY3RCYWNrZ3JvdW5kKHRoaXMub3B0aW9ucy5mcm9tQ29ybmVycyk7XG4gICAgICAgIGlmKHBhdGhmaW5kZXIubWFzay5jb3VudCApIHtcbiAgICAgICAgICBwYXRoZmluZGVyLl9maWxsKFswLCAwLCAwLCAwXSk7XG4gICAgICAgICAgcGF0aGZpbmRlci5tYXNrID0gZmFicmljLk1hZ2ljV2FuZC5pbnZlcnRNYXNrKHBhdGhmaW5kZXIubWFzayk7XG4gICAgICAgICAgLy90b2RvIGludmVydGluZyBtYXNrXG5cbiAgICAgICAgICBpZihwYXRoZmluZGVyLm1hc2suY291bnQpe1xuICAgICAgICAgICAgdmFyIF93aWR0aCA9IHBhdGhmaW5kZXIubWFzay5ib3VuZHMubWF4WCAtIHBhdGhmaW5kZXIubWFzay5ib3VuZHMubWluWCArIDE7XG4gICAgICAgICAgICB2YXIgX2hlaWdodCA9IHBhdGhmaW5kZXIubWFzay5ib3VuZHMubWF4WSAtIHBhdGhmaW5kZXIubWFzay5ib3VuZHMubWluWSArIDE7XG4gICAgICAgICAgICB2YXIgY3R4ID0gY2FudmFzRWwuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICAgICAgICAgIHZhciBpbWFnZURhdGEgPSBwYXRoZmluZGVyLmVkaXRlZEltYWdlQ2FudmFzLmdldENvbnRleHQoJzJkJykuZ2V0SW1hZ2VEYXRhKHBhdGhmaW5kZXIubWFzay5ib3VuZHMubWluWCwgcGF0aGZpbmRlci5tYXNrLmJvdW5kcy5taW5ZLCBfd2lkdGgsIF9oZWlnaHQpO1xuICAgICAgICAgICAgY2FudmFzRWwud2lkdGggID0gX3dpZHRoO1xuICAgICAgICAgICAgY2FudmFzRWwuaGVpZ2h0ID0gX2hlaWdodDtcbiAgICAgICAgICAgIGN0eC5wdXRJbWFnZURhdGEoaW1hZ2VEYXRhLCAwLCAwKTtcbiAgICAgICAgICAgIHRoaXMuYm91bmRzID0gcGF0aGZpbmRlci5tYXNrLmJvdW5kcztcbiAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgIHZhciBjdHggPSBjYW52YXNFbC5nZXRDb250ZXh0KCcyZCcpO1xuICAgICAgICAgICAgY2FudmFzRWwud2lkdGggID0gMTtcbiAgICAgICAgICAgIGNhbnZhc0VsLmhlaWdodCA9IDE7XG4gICAgICAgICAgICBjdHguY2xlYXJSZWN0KDAsMCwxLDEpO1xuICAgICAgICAgICAgdGhpcy5ib3VuZHMgPSB7XG4gICAgICAgICAgICAgIG1heFg6IDAsXG4gICAgICAgICAgICAgIG1heFk6IDAsXG4gICAgICAgICAgICAgIG1pblg6IDAsXG4gICAgICAgICAgICAgIG1pblk6IDBcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuXG5cbiAgICAgICAgICAgIC8vY2xpcCB0aGUgaW1hZ2VcbiAgICAgICAgcGF0aGZpbmRlci5jbGVhck1lbW9yeSgpO1xuXG4gICAgfSxcbiAgICB0b09iamVjdDogZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKHRoaXMuY2FsbFN1cGVyKCd0b09iamVjdCcpLCB0aGlzLm9wdGlvbnMpO1xuICAgIH1cbn0pO1xuXG5mYWJyaWMuSW1hZ2UuZmlsdGVycy5SZW1vdmVXaGl0ZURQLmZyb21PYmplY3QgPSBmdW5jdGlvbihvYmplY3QpIHtcbiAgICByZXR1cm4gbmV3IGZhYnJpYy5JbWFnZS5maWx0ZXJzLlJlbW92ZVdoaXRlRFAob2JqZWN0KTtcbn07XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL2ZpbHRlcnMvcmVtb3ZlV2hpdGUuanNcbi8vIG1vZHVsZSBpZCA9IDY4XG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIlxuZmFicmljLkNhY2hlTWl4aW4gPSB7XG4gIGNhY2hpbmc6IHRydWUsXG4gIGRpcnR5OiB0cnVlLFxuICByZW5kZXI6IGZ1bmN0aW9uICggY3R4KSB7XG5cbiAgICBjdHguc2F2ZSgpO1xuICAgIGlmICh0aGlzLnRyYW5zZm9ybU1hdHJpeCkge1xuICAgICAgY3R4LnRyYW5zZm9ybS5hcHBseShjdHgsIHRoaXMudHJhbnNmb3JtTWF0cml4KTtcbiAgICB9XG4gICAgdGhpcy50cmFuc2Zvcm0oY3R4KTtcblxuICAgIHRoaXMuX3NldFNoYWRvdyhjdHgpO1xuICAgIHRoaXMuY2xpcFRvICYmIGZhYnJpYy51dGlsLmNsaXBDb250ZXh0KHRoaXMsIGN0eCk7XG5cbiAgICBjdHgudHJhbnNsYXRlKC10aGlzLndpZHRoIC8gMiwgLXRoaXMuaGVpZ2h0IC8gMik7XG5cbiAgICBpZiAodGhpcy5jYWNoaW5nKSB7XG4gICAgICBpZighdGhpcy5fY2FjaGUpe1xuICAgICAgICB0aGlzLl9jYWNoZSA9IGZhYnJpYy51dGlsLmNyZWF0ZUNhbnZhc0VsZW1lbnRXaXRoU2l6ZSh0aGlzKTtcbiAgICAgIH1cbiAgICAgIGlmKHRoaXMuZGlydHkpe1xuICAgICAgICB0aGlzLl9jYWNoZS53aWR0aCA9IHRoaXMud2lkdGg7XG4gICAgICAgIHRoaXMuX2NhY2hlLmhlaWdodCA9IHRoaXMuaGVpZ2h0O1xuICAgICAgICB2YXIgY2FjaGVDdHggPSB0aGlzLl9jYWNoZS5nZXRDb250ZXh0KFwiMmRcIik7XG4gICAgICAgIGNhY2hlQ3R4LmNsZWFyUmVjdCgwLDAsdGhpcy5fY2FjaGUud2lkdGgsdGhpcy5fY2FjaGUuaGVpZ2h0KVxuICAgICAgICB0aGlzLl9yZW5kZXIoY2FjaGVDdHgpO1xuICAgICAgICB0aGlzLmRpcnR5ID0gZmFsc2U7XG4gICAgICB9XG5cbiAgICAgIGN0eC5kcmF3SW1hZ2UodGhpcy5fY2FjaGUsIDAsIDAsIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0LDAsIDAsIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KTtcbiAgICB9ZWxzZXtcbiAgICAgIHRoaXMuX3JlbmRlcihjdHgpO1xuICAgIH1cblxuICAgIHRoaXMuY2xpcFRvICYmIGN0eC5yZXN0b3JlKCk7XG4gICAgY3R4LnJlc3RvcmUoKTtcbiAgfVxuXG59O1xuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9taXhpbnMvY2FjaGVNaXhpbi5qc1xuLy8gbW9kdWxlIGlkID0gNjlcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiZmFicmljLlN0cm9rZU1peGluID0ge1xuICBzaGFwZToge1xuICAgIHN0cm9rZVdpZHRoRnVsbDogMCxcbiAgICBzdHJva2VXaWR0aEVtcHR5OiAyLFxuICAgIHN0cm9rZVdpZHRoQWN0aXZlOiAyLFxuICAgIHN0cm9rZURhc2hBcnJheSA6IFs1LDVdLFxuICAgIGZpbGw6IFwidHJhbnNwYXJlbnRcIixcbiAgICBzdHJva2VFbXB0eTogIFwicmVkXCIsXG4gICAgc3Ryb2tlRnVsbDogICBcInJlZFwiLFxuICAgIHN0cm9rZUFjdGl2ZTogXCJncmVlblwiXG4gIH0sXG4gIHNldFNoYXBlOiBmdW5jdGlvbihlbCxjYil7XG5cbiAgICBlbCA9ICBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKHtcbiAgICAgIHN0cm9rZVdpZHRoRnVsbDogdGhpcy5zaGFwZS5zdHJva2VXaWR0aEZ1bGwsXG4gICAgICBzdHJva2VXaWR0aEVtcHR5OiB0aGlzLnNoYXBlLnN0cm9rZVdpZHRoRW1wdHksXG4gICAgICBzdHJva2VXaWR0aEFjdGl2ZTogdGhpcy5zaGFwZS5zdHJva2VXaWR0aEFjdGl2ZSxcbiAgICAgIGRhc2hBcnJheSA6IHRoaXMuc2hhcGUuZGFzaEFycmF5LFxuICAgICAgc3Ryb2tlRW1wdHk6ICB0aGlzLnNoYXBlLnN0cm9rZUVtcHR5LFxuICAgICAgc3Ryb2tlRnVsbDogIHRoaXMuc2hhcGUuc3Ryb2tlRnVsbCxcbiAgICAgIHN0cm9rZUFjdGl2ZTp0aGlzLnNoYXBlLnN0cm9rZUFjdGl2ZVxuICAgIH0sZWwpO1xuXG5cbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgIGlmKGVsICYmIGVsLnNyYyAmJiAhZWwucGF0aHMpe1xuICAgICAgZmFicmljLmxvYWRTVkdGcm9tVVJMKGVsLnNyYyxmdW5jdGlvbihwYXRocyxvcHRpb25zKSB7XG4gICAgICAgIGVsLnBhdGhzICA9IHBhdGhzO1xuICAgICAgICBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGVsLG9wdGlvbnMpO1xuICAgICAgICBfdGhpcy5fc2V0X3NoYXBlKGVsKTtcbiAgICAgICAgX3RoaXMuYWRkKF90aGlzLl9mYWJyaWNfc2hhcGUpXG4gICAgICAgIF90aGlzLl9hcHBseV9zaGFwZSgpO1xuICAgICAgICBjYiAmJiBjYigpO1xuICAgICAgfSlcbiAgICB9ZWxzZXtcbiAgICAgIF90aGlzLl9zZXRfc2hhcGUoZWwpO1xuICAgICAgX3RoaXMuYWRkKF90aGlzLl9mYWJyaWNfc2hhcGUpO1xuICAgICAgX3RoaXMuX2FwcGx5X3NoYXBlKCk7XG4gICAgICBjYiAmJiBjYigpO1xuICAgIH1cbiAgfSxcbiAgaW5pdFNoYXBlOiBmdW5jdGlvbihvcHRpb25zKXtcblxuICAgIHZhciBfc2hhcGVPcHRpb25zID0gZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChvcHRpb25zLnNoYXBlIHx8IHt9ICwgdGhpcy5zaGFwZSk7XG5cbiAgICB0aGlzLl9mYWJyaWNfc2hhcGUgPSAgbmV3IGZhYnJpYy5SZWN0KGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoe30sX3NoYXBlT3B0aW9ucyx7XG4gICAgICB3aWR0aDogICAgICAgICAgICBvcHRpb25zLndpZHRoLFxuICAgICAgaGVpZ2h0OiAgICAgICAgICAgb3B0aW9ucy5oZWlnaHQsXG4gICAgICBzdHJva2U6ICAgICAgICAgICBfc2hhcGVPcHRpb25zLnN0cm9rZUVtcHR5LFxuICAgICAgc3Ryb2tlV2lkdGg6ICAgICAgX3NoYXBlT3B0aW9ucy5zdHJva2VXaWR0aEVtcHR5XG4gICAgfSkpO1xuICB9LFxuXG4gIC8qKlxuICAgKiDvv73vv73vv73vv73vv73vv73vv73vv73vv73vv73vv73vv73vv73vv70g77+977+977+977+977+9IO+/ve+/vSDvv73vv73vv73vv73vv73vv73vv70g77+977+977+977+977+977+977+9IO+/ve+/ve+/ve+/vVxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgX2FwcGx5X3NoYXBlOiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHNoYXBlID0gdGhpcy5zaGFwZTtcblxuICAgIHZhciBfb2ZmID0gc2hhcGUgJiYgc2hhcGUub2Zmc2V0cztcblxuICAgIGlmICghX29mZikge1xuICAgICAgX29mZiA9IFswLCAwLCAwLCAwXTtcbiAgICB9XG5cbiAgICB2YXIgX29mZl91bml0cyA9IHNoYXBlICYmIHNoYXBlLm9mZnNldHNfdW5pdHM7XG5cbiAgICBpZiAoIV9vZmZfdW5pdHMpIHtcbiAgICAgIC8vaWYgKGZyYW1lLmJvcmRlcl9pbWFnZSkge3RvZG9cbiAgICAgIC8vICAgIF9vZmZfdW5pdHMgPSBmcmFtZS5ib3JkZXJfaW1hZ2Uud2lkdGhfdW5pdHMgfHwgWzAsIDAsIDAsIDBdO1xuICAgICAgLy99IGVsc2Uge1xuICAgICAgX29mZl91bml0cyA9IFsxLCAxLCAxLCAxXTtcbiAgICAgIC8vfVxuICAgIH1cblxuICAgIC8qZWxzZSBpZihzaGFwZS5vZmZzZXRzICYmIHNoYXBlLm9mZnNldHNfdW5pdHMpe1xuICAgICB2YXIgcyA9IHRoaXMuc2xpZGUuc2NhbGVWYWx1ZTtcbiAgICAgdGhpcy5fZmFicmljX3NoYXBlID0gbmV3IGZhYnJpYy5SZWN0KHtcbiAgICAgb3JpZ2luWDogJ2NlbnRlcicsXG4gICAgIG9yaWdpblk6ICdjZW50ZXInLFxuICAgICB3aWR0aDogICh0aGlzLmRhdGEuZ2VvbWV0cnkud2lkdGggLSBzaGFwZS5vZmZzZXRzWzNdIC0gc2hhcGUub2Zmc2V0c1sxXSkgKiBzLFxuICAgICBoZWlnaHQ6ICh0aGlzLmRhdGEuZ2VvbWV0cnkuaGVpZ2h0IC1zaGFwZS5vZmZzZXRzWzBdIC0gc2hhcGUub2Zmc2V0c1syXSkgKiBzXG4gICAgIH0pOyovXG5cbiAgICBfb2ZmID0ge1xuICAgICAgdG9wOiAgIF9vZmZbMF0gKiAoX29mZl91bml0c1swXSA/IHRoaXMuaGVpZ2h0IC8gMTAwIDogMSkgfHwgMCxcbiAgICAgIHJpZ2h0OiBfb2ZmWzFdICogKF9vZmZfdW5pdHNbMV0gPyB0aGlzLndpZHRoIC8gMTAwIDogMSkgfHwgMCxcbiAgICAgIGJvdHRvbTpfb2ZmWzJdICogKF9vZmZfdW5pdHNbMl0gPyB0aGlzLmhlaWdodCAvIDEwMCA6IDEpIHx8IDAsXG4gICAgICBsZWZ0OiAgX29mZlszXSAqIChfb2ZmX3VuaXRzWzNdID8gdGhpcy53aWR0aCAvIDEwMCA6IDEpIHx8IDBcbiAgICB9O1xuXG5cbiAgICB2YXIgX3cgPSAodGhpcy53aWR0aCAtIF9vZmYubGVmdCAtIF9vZmYucmlnaHQgKTsvLyAqdGhpcy5zbGlkZS5zY2FsZVZhbHVlO1xuICAgIHZhciBfaCA9ICh0aGlzLmhlaWdodCAtIF9vZmYudG9wIC0gX29mZi5ib3R0b20pOy8vICp0aGlzLnNsaWRlLnNjYWxlVmFsdWU7XG5cblxuICAgIC8vaWYodGhpcy5yZXNvdXJjZXMuZnJhbWUuZGF0YS5zaGFwZSAmJiB0aGlzLnJlc291cmNlcy5mcmFtZS5kYXRhLnNoYXBlLnJhZGl1cyl7XG4gICAgLy9cbiAgICAvLyAgICB0aGlzLl9mYWJyaWNfc2hhcGUuc2V0KHtcbiAgICAvLyAgICAgICAgbGVmdDogLXRoaXMud2lkdGgvMiAgKyBfb2ZmLmxlZnQgLFxuICAgIC8vICAgICAgICB0b3A6ICAtdGhpcy5oZWlnaHQvMiArIF9vZmYudG9wICxcbiAgICAvLyAgICAgICAgd2lkdGg6IF93IC0gX29mZi5sZWZ0IC1fb2ZmLnJpZ2h0LFxuICAgIC8vICAgICAgICBoZWlnaHQ6ICBfaCAtIF9vZmYudG9wIC1fb2ZmLmJvdHRvbSxcbiAgICAvLyAgICAgICAgc2NhbGVYOiAgMSxcbiAgICAvLyAgICAgICAgc2NhbGVZOiAgMVxuICAgIC8vICAgIH0pO1xuICAgIC8vfWVsc2V7XG5cblxuICAgIGlmKHRoaXMuc2hhcGUucGF0aCB8fCB0aGlzLnNoYXBlLnBhdGhzIHx8IHRoaXMuc2hhcGUub2Zmc2V0cyl7XG4gICAgICB2YXIgX3N3ID0gdGhpcy5zaGFwZS53aWR0aCB8fCB0aGlzLl9mYWJyaWNfc2hhcGUud2lkdGg7XG4gICAgICB2YXIgX3NoID0gdGhpcy5zaGFwZS5oZWlnaHQgfHwgdGhpcy5fZmFicmljX3NoYXBlLmhlaWdodDtcblxuICAgICAgaWYodGhpcy5fZmFicmljX3NoYXBlLnN0cm9rZVdpZHRoKXtcbiAgICAgICAgX3N3ICs9IHRoaXMuX2ZhYnJpY19zaGFwZS5zdHJva2VXaWR0aCA7XG4gICAgICAgIF9zaCArPSB0aGlzLl9mYWJyaWNfc2hhcGUuc3Ryb2tlV2lkdGggO1xuICAgICAgfVxuXG4gICAgICB2YXIgb3B0aW9ucyA9IHtcbiAgICAgICAgbGVmdDogICAtdGhpcy53aWR0aCAvIDIgKyBfb2ZmLmxlZnQsXG4gICAgICAgIHRvcDogICAgLXRoaXMuaGVpZ2h0IC8gMiArIF9vZmYudG9wLFxuICAgICAgICBzY2FsZVg6IF93IC8gMTAwIC8gKF9zdyAvIDEwMCksLy8gKiAoc2hhcGUuc2NhbGVYIHx8IDEpLFxuICAgICAgICBzY2FsZVk6IF9oIC8gMTAwIC8gKF9zaCAvIDEwMCksLy8gKiAoc2hhcGUuc2NhbGVZIHx8IDEpXG4gICAgICAgIGFuZ2xlOiAwXG4gICAgICB9O1xuICAgIH1lbHNle1xuICAgICAgdmFyIG9wdGlvbnMgPSB7XG4gICAgICAgIGxlZnQ6ICAgLXRoaXMud2lkdGggLyAyICsgX29mZi5sZWZ0LFxuICAgICAgICB0b3A6ICAgIC10aGlzLmhlaWdodCAvIDIgKyBfb2ZmLnRvcCxcbiAgICAgICAgd2lkdGg6ICAgIF93LC8vICogKHNoYXBlLnNjYWxlWCB8fCAxKSxcbiAgICAgICAgaGVpZ2h0OiAgIF9oLC8vICogKHNoYXBlLnNjYWxlWSB8fCAxKVxuICAgICAgICBhbmdsZTogMFxuICAgICAgfTtcbiAgICB9XG5cbiAgICB0aGlzLl9mYWJyaWNfc2hhcGUuc2V0KG9wdGlvbnMpO1xuXG4gICAgdGhpcy51cGRhdGVTdHJva2UoKTtcbiAgICB0aGlzLmNhbnZhcyAmJiB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgfSxcbiAgX3NldF9zaGFwZTogZnVuY3Rpb24gKHNoYXBlKSB7XG5cbiAgICBpZih0aGlzLl9mYWJyaWNfc2hhcGUpe1xuICAgICAgdGhpcy5yZW1vdmUodGhpcy5fZmFicmljX3NoYXBlKTtcbiAgICAgIGRlbGV0ZSB0aGlzLl9mYWJyaWNfc2hhcGU7XG4gICAgfVxuICAgIHZhciBfZmFicmljX3NoYXBlO1xuICAgIHZhciBfb3B0aW9ucyA9IHtcbiAgICAgIGZpbGw6ICAgICAgICAgICAgIFwidHJhbnNwYXJlbnRcIixcbiAgICAgIHN0cm9rZURhc2hBcnJheSA6IHRoaXMuc2hhcGUuZGFzaEFycmF5LFxuICAgIH07XG5cbiAgICB0aGlzLnNoYXBlID0gc2hhcGU7XG5cbiAgICBpZighc2hhcGUpe1xuICAgICAgX2ZhYnJpY19zaGFwZSA9IG5ldyBmYWJyaWMuUmVjdCh7XG4gICAgICAgIHdpZHRoOiB0aGlzLndpZHRoLFxuICAgICAgICBoZWlnaHQ6IHRoaXMuaGVpZ2h0XG4gICAgICB9KTtcbiAgICAgIF9mYWJyaWNfc2hhcGUuc2V0KF9vcHRpb25zKVxuICAgIH1lbHNlIGlmIChzaGFwZS5wYXRocykge1xuXG4gICAgICBmb3IodmFyIGkgaW4gc2hhcGUucGF0aHMpe1xuICAgICAgICBzaGFwZS5wYXRoc1tpXS5zZXQoX29wdGlvbnMpXG4gICAgICB9XG5cbiAgICAgIF9mYWJyaWNfc2hhcGUgPSBmYWJyaWMudXRpbC5ncm91cFNWR0VsZW1lbnRzKHNoYXBlLnBhdGhzLCBzaGFwZSk7XG4gICAgICAvL3RoaXMuX29iamVjdHMudW5zaGlmdCh0aGlzLl9vYmplY3RzLnBvcCgpKTtcbiAgICB9ZWxzZSB7XG4gICAgICB2YXIgcGF0aDtcblxuICAgICAgaWYgKHNoYXBlLnJhZGl1cykge1xuICAgICAgICBwYXRoID0gZmFicmljLnV0aWwuZ2V0UmFkaXVzQ2xpcFBhdGgoc2hhcGUucmFkaXVzLCBzaGFwZS5yYWRpdXNfdW5pdHMsIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KTtcbiAgICAgICAgX2ZhYnJpY19zaGFwZSA9IG5ldyBmYWJyaWMuUGF0aChwYXRoLCBfb3B0aW9ucyk7XG4gICAgICB9IGVsc2UgaWYgKHNoYXBlLnBhdGgpIHtcbiAgICAgICAgX2ZhYnJpY19zaGFwZSA9IG5ldyBmYWJyaWMuUGF0aChzaGFwZS5wYXRoLCBfb3B0aW9ucyk7XG4gICAgICAgIC8vfSBlbHNlIGlmKHNoYXBlLm9mZnNldHMpe1xuICAgICAgICAvLyAgcGF0aCA9IGZhYnJpYy51dGlsLmdldE9mZnNldHNDbGlwUGF0aChzaGFwZS5vZmZzZXRzLCBzaGFwZS5vZmZzZXRzX3VuaXRzKVxuICAgICAgfWVsc2V7XG4gICAgICAgIHBhdGggPSAgJ00gMCAwIEwge3dpZHRofSAwIEwge3dpZHRofSB7aGVpZ2h0fSBMIDAge2hlaWdodH0geicuZm9ybWF0KGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoe1xuICAgICAgICAgIHdpZHRoOiAgICAgICAgICAgIDEwMCxcbiAgICAgICAgICBoZWlnaHQ6ICAgICAgICAgICAxMDBcbiAgICAgICAgfSxzaGFwZSkpO1xuXG4gICAgICAgIF9mYWJyaWNfc2hhcGUgPSBuZXcgZmFicmljLlBhdGgocGF0aCwgX29wdGlvbnMpO1xuICAgICAgICAvL1xuICAgICAgICAvL19mYWJyaWNfc2hhcGUgPSAgbmV3IGZhYnJpYy5SZWN0KGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoe1xuICAgICAgICAvLyAgd2lkdGg6ICAgICAgICAgICAgMTAwLFxuICAgICAgICAvLyAgaGVpZ2h0OiAgICAgICAgICAgMTAwXG4gICAgICAgIC8vfSxzaGFwZSkpO1xuXG4gICAgICB9XG4gICAgfVxuXG5cbiAgICBfZmFicmljX3NoYXBlLnNldCh7XG4gICAgICBzY2FsZVg6IHRoaXMud2lkdGggIC8gX2ZhYnJpY19zaGFwZS53aWR0aCxcbiAgICAgIHNjYWxlWTogdGhpcy5oZWlnaHQgLyBfZmFicmljX3NoYXBlLmhlaWdodCxcbiAgICAgIHBlclBpeGVsVGFyZ2V0RmluZDogdHJ1ZSxcbiAgICAgIHNlbGVjdGFibGU6IGZhbHNlLFxuICAgICAgb3JpZ2luWDogXCJsZWZ0XCIsXG4gICAgICBvcmlnaW5ZOiBcInRvcFwiXG4gICAgfSk7XG5cblxuXG4gICAgdGhpcy5fZmFicmljX3NoYXBlID0gIF9mYWJyaWNfc2hhcGU7XG5cblxuICAgIGlmKHRoaXMuZWxlbWVudCl7XG4gICAgICB0aGlzLmVsZW1lbnQuY2xpcFRvID0gdGhpcy5fZmFicmljX3NoYXBlO1xuICAgIH1cblxuXG4gICAgdGhpcy51cGRhdGVTdHJva2UoKTtcblxuICB9LFxuXG4gIHVwZGF0ZVN0cm9rZTogZnVuY3Rpb24oKXtcblxuICAgIHZhciBfc3Ryb2tlID0gdGhpcy5zaGFwZS5zdHJva2U7XG4gICAgdmFyIF9zdyA9IDA7XG4gICAgaWYoKHRoaXMuX2FjdGl2YXRlZCB8fCB0aGlzLl9jbGlwbW9kZSApJiYgdGhpcy5zaGFwZS5zdHJva2VXaWR0aEFjdGl2ZSl7XG4gICAgICBfc3cgPSB0aGlzLnNoYXBlLnN0cm9rZVdpZHRoQWN0aXZlXG4gICAgfWVsc2UgaWYodGhpcy5lbGVtZW50ICYmIHRoaXMuc2hhcGUuc3Ryb2tlV2lkdGhGdWxsKXtcbiAgICAgIF9zdyA9IHRoaXMuc2hhcGUuc3Ryb2tlV2lkdGhGdWxsO1xuICAgIH1lbHNlIGlmKCF0aGlzLmVsZW1lbnQgJiYgdGhpcy5zaGFwZS5zdHJva2VXaWR0aEVtcHR5KXtcbiAgICAgIF9zdyA9IHRoaXMuc2hhcGUuc3Ryb2tlV2lkdGhFbXB0eTtcbiAgICB9XG4gICAgaWYoKHRoaXMuX2FjdGl2YXRlZCB8fCB0aGlzLl9jbGlwbW9kZSkgJiYgdGhpcy5zaGFwZS5zdHJva2VBY3RpdmUpe1xuICAgICAgX3N0cm9rZSA9IHRoaXMuc2hhcGUuc3Ryb2tlQWN0aXZlXG4gICAgfWVsc2UgaWYodGhpcy5lbGVtZW50ICYmIHRoaXMuc2hhcGUuc3Ryb2tlRnVsbCl7XG4gICAgICBfc3Ryb2tlID0gdGhpcy5zaGFwZS5zdHJva2VGdWxsO1xuICAgIH1lbHNlIGlmKCF0aGlzLmVsZW1lbnQgJiYgdGhpcy5zaGFwZS5zdHJva2VFbXB0eSl7XG4gICAgICBfc3Ryb2tlID0gdGhpcy5zaGFwZS5zdHJva2VFbXB0eTtcbiAgICB9XG5cblxuICAgIHZhciBfc3Ryb2tlV2lkdGggPSBfc3cgLyBNYXRoLm1heCh0aGlzLl9mYWJyaWNfc2hhcGUuc2NhbGVYLHRoaXMuX2ZhYnJpY19zaGFwZS5zY2FsZVkpO1xuXG4gICAgaWYodGhpcy5zaGFwZSl7XG4gICAgICBpZih0aGlzLnNoYXBlLnBhdGhzICl7XG4gICAgICAgIGZvcih2YXIgaSBpbiB0aGlzLl9mYWJyaWNfc2hhcGUucGF0aHMpe1xuICAgICAgICAgIHRoaXMuX2ZhYnJpY19zaGFwZS5wYXRoc1tpXS5zZXRTdHJva2VXaWR0aChfc3Ryb2tlV2lkdGgpXG4gICAgICAgICAgdGhpcy5fZmFicmljX3NoYXBlLnBhdGhzW2ldLnNldFN0cm9rZShfc3Ryb2tlKVxuICAgICAgICB9XG4gICAgICB9ZWxzZXtcbiAgICAgICAgdGhpcy5fZmFicmljX3NoYXBlLnNldFN0cm9rZVdpZHRoKF9zdHJva2VXaWR0aClcbiAgICAgICAgdGhpcy5fZmFicmljX3NoYXBlLnNldFN0cm9rZShfc3Ryb2tlKVxuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgLyoqXG4gICAqINC60L7QsdGK0LXQutGCINCz0L7RgtC+0LLQuNGC0YHRjyDQuiDQt9Cw0LzQtdC90YMg0YTQvtGC0L5cbiAgICovXG4gIGFjdGl2YXRlOiBmdW5jdGlvbigpe1xuICAgIHRoaXMuX2FjdGl2YXRlZCA9IHRydWU7XG4gICAgdGhpcy5fZmFicmljX3NoYXBlLnNldE9wYWNpdHkoMSk7XG4gICAgdGhpcy51cGRhdGVTdHJva2UoKTtcbiAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgfSxcbiAgLyoqXG4gICAqINC60L7QsdGK0LXQutGCINC90LUg0LPQvtGC0L7QstC40YLRgdGPINC6INC30LDQvNC10L3RgyDRhNC+0YLQvlxuICAgKi9cbiAgZGVhY3RpdmF0ZTogZnVuY3Rpb24oKXtcbiAgICB0aGlzLl9hY3RpdmF0ZWQgPSBmYWxzZTtcbiAgICB0aGlzLnVwZGF0ZVN0cm9rZSgpO1xuICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICB9LFxufVxuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9taXhpbnMvc3Ryb2tlTWl4aW4uanNcbi8vIG1vZHVsZSBpZCA9IDcwXG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIid1c2Ugc3RyaWN0JztcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuU3RhdGljQ2FudmFzLnByb3RvdHlwZSwge1xuICBvZmZzZXRzOiB7bGVmdDogMCwgdG9wOiAwLCByaWdodDogMCwgYm90dG9tOiAwfVxufSk7XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLlNsaWRlQ2FudmFzLnByb3RvdHlwZSwge1xuICBkZWZhdWx0T3B0aW9uczogZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuU2xpZGVDYW52YXMucHJvdG90eXBlLmRlZmF1bHRPcHRpb25zLHtcbiAgICBvZmZzZXRzOiB7bGVmdCA6IDAsdG9wIDogMCwgcmlnaHQ6IDAsIGJvdHRvbTowfVxuICB9KSxcbiAgZXZlbnRMaXN0ZW5lcnM6IGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmRBcnJheXNPYmplY3QoZmFicmljLlNsaWRlQ2FudmFzLnByb3RvdHlwZS5ldmVudExpc3RlbmVycywge1xuICAgIFwiYmVmb3JlOmRyb3BcIjogZnVuY3Rpb24oZSl7XG4gICAgICAvL3RvZG87XG4gICAgICBpZighdGhpcy5fYmFja2dyb3VuZExheWVyKXtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdmFyIHBvaW50ZXIgPSB0aGlzLmdldFBvaW50ZXIoZS5vcmlnaW5hbEV2ZW50LCB0cnVlKTtcbiAgICAgIHZhciB0YXJnZXQgPSB0aGlzLl9zZWFyY2hQb3NzaWJsZVRhcmdldHModGhpcy5fYmFja2dyb3VuZExheWVyLCBwb2ludGVyKTtcbiAgICAgIGlmICh0YXJnZXQpIHtcbiAgICAgICAgdGhpcy5zZXRBY3RpdmVBcmVhKHRhcmdldCk7XG4gICAgICAgIGUuZGF0YS5jbGlwVG8gPSBcIiNcIiArIHRhcmdldC5pZDtcbiAgICAgICAgZS5kYXRhLm1vdmVtZW50TGltaXRzID0gXCIjXCIgKyB0YXJnZXQuaWQ7XG4gICAgICB9XG4gICAgfVxuICB9KSxcbiAgX3VwZGF0ZV9jbGlwX3JlY3Q6IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAodGhpcy5hcmVhcyB8fCAhdGhpcy5sYXllcnMuYmFja2dyb3VuZC5vYmplY3RzWzBdKSByZXR1cm47XG4gICAgdmFyIGdlb21ldHJ5ID0gdGhpcy5nZXRSZWN0KHRoaXMub2Zmc2V0cyk7XG4gICAgdGhpcy5sYXllcnMuYmFja2dyb3VuZC5vYmplY3RzWzBdLnNldChnZW9tZXRyeSk7XG4gIH0sXG4gIC8vb2Zmc2V0czoge2xlZnQgOiAwLHRvcCA6IDAsIHJpZ2h0OiAwLCBib3R0b206MH0sXG4gIHNldEhlbHBlcnM6IGZ1bmN0aW9uIChoZWxwZXJzLCBjYWxsYmFjaykge1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICBpZihoZWxwZXJzKXtcbiAgICAgIGZvciAodmFyIGkgaW4gaGVscGVycyl7XG4gICAgICAgIGZhYnJpYy51dGlsLmNyZWF0ZU9iamVjdChoZWxwZXJzW2ldLGZ1bmN0aW9uKGhlbHBlcil7XG4gICAgICAgICAgc2VsZi5sYXllcnMuYmFja2dyb3VuZC5vYmplY3RzLnB1c2goaGVscGVyKTtcbiAgICAgICAgICBzZWxmLnJlbmRlckFsbCgpO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gICAgY2FsbGJhY2sgJiYgY2FsbGJhY2soKTtcbiAgfSxcbiAgYXJlYUFjdGl2YXRpbmc6IGZhbHNlLFxuICBhZGRFbGVtZW50c0luc2lkZUFjdGl2ZUFyZWE6IGZhbHNlLFxuICBhcmVhUHJvcGVydGllczoge1xuICAgIG9yaWdpblg6ICdsZWZ0JyxcbiAgICBvcmlnaW5ZOiAndG9wJyxcbiAgICBmaWxsOiAndHJhbnNwYXJlbnQnLFxuICAgIHN0cm9rZURhc2hBcnJheTogWzUsIDVdLFxuICAgIHN0cm9rZVdpZHRoOiAxLFxuICAgIHN0cm9rZTogJ2JsYWNrJyxcbiAgICByZXNpemFibGU6IHRydWVcbiAgICAvL3NlbGVjdGFibGU6IGZhbHNlXG4gIH0sXG4gIHNldEFyZWFQcm9wZXJ0eTogZnVuY3Rpb24gKHByb3BlcnR5LCB2YWx1ZSkge1xuICAgIHRoaXNbXCJhcmVhX1wiICsgcHJvcGVydHldID0gdmFsdWU7XG4gICAgZm9yICh2YXIgaSBpbiB0aGlzLmxheWVycy5iYWNrZ3JvdW5kLm9iamVjdHMpIHtcbiAgICAgIHRoaXMubGF5ZXJzLmJhY2tncm91bmQub2JqZWN0c1tpXVtwcm9wZXJ0eV0gPSB2YWx1ZTtcbiAgICB9XG4gICAgdGhpcy5yZW5kZXJBbGwoKTtcbiAgfSxcbiAgc2V0QWN0aXZlQXJlYTogZnVuY3Rpb24gKGFyZWEpIHtcbiAgICBpZiAoYXJlYSA9PT0gdHJ1ZSkge1xuICAgICAgYXJlYSA9IHRoaXMubGF5ZXJzLmJhY2tncm91bmQub2JqZWN0c1swXSB8fCBudWxsO1xuICAgIH1cbiAgICBpZiAodGhpcy5hY3RpdmVBcmVhKSB7XG4gICAgICB0aGlzLmFjdGl2ZUFyZWEuc2V0U3Ryb2tlKFwiIzAwMFwiKTtcbiAgICB9XG4gICAgdGhpcy5hY3RpdmVBcmVhID0gYXJlYTtcbiAgICBpZiAoYXJlYSkge1xuICAgICAgYXJlYS5zZXRTdHJva2UoXCIjQjdGMUVEXCIpO1xuICAgIH1cbiAgfSxcbiAgc2V0QXJlYUFjdGl2YXRpbmc6IGZ1bmN0aW9uICh2YWx1ZS8qLCBmb3JjZSovKSB7XG4gICAgLy90b2RvIGZvcmNlXG4gICAgdmFyIGZvcmNlID0gdHJ1ZTtcbiAgICBpZiAoZm9yY2UgfHwgKHZhbHVlICYmICF0aGlzLmFyZWFBY3RpdmF0aW5nKSkge1xuICAgICAgdGhpcy5hcmVhQWN0aXZhdGluZyA9IHRydWU7XG4gICAgICB0aGlzLm9uKFwib2JqZWN0Om1vZGlmaWVkXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGlmKHRoaXMuZWRpdGluZ09iamVjdCl7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vdG9kbyBldmVudCEg0L3QtSDRitC+0YLQtdC7INCx0Ysg0Y3RgtC+INGC0YPRgiDQuNGB0L/QvtC70YzQvtCy0LDRgtGMLNC90L4g0YDQsNCx0L7RgtCw0LXRglxuICAgICAgICB2YXIgcG9pbnRlciA9IHRoaXMuZ2V0UG9pbnRlcihldmVudCwgdHJ1ZSk7XG4gICAgICAgIHZhciB0YXJnZXQgPSB0aGlzLl9zZWFyY2hQb3NzaWJsZVRhcmdldHModGhpcy5sYXllcnMuYmFja2dyb3VuZC5vYmplY3RzLCBwb2ludGVyKTtcbiAgICAgICAgaWYodGhpcy5fY3VycmVudFRyYW5zZm9ybSAmJiB0YXJnZXQgJiYgdGhpcy50YXJnZXQubW92ZW1lbnRMaW1pdHMgIT0gdGFyZ2V0KXtcbiAgICAgICAgICB0aGlzLnRhcmdldC5tb3ZlbWVudExpbWl0cyA9IHRoaXMudGFyZ2V0LmNsaXBUbyA9IHRhcmdldDtcbiAgICAgICAgICB0aGlzLnNldEFjdGl2ZUFyZWEodGFyZ2V0KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICB0aGlzLm9uKFwibW91c2U6ZG93blwiLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICB2YXIgcG9pbnRlciA9IHRoaXMuZ2V0UG9pbnRlcihlLmUsIHRydWUpO1xuICAgICAgICB2YXIgdGFyZ2V0ID0gdGhpcy5fc2VhcmNoUG9zc2libGVUYXJnZXRzKHRoaXMubGF5ZXJzLmJhY2tncm91bmQub2JqZWN0cywgcG9pbnRlcik7XG4gICAgICAgIGlmICh0YXJnZXQpIHtcbiAgICAgICAgICB0aGlzLnNldEFjdGl2ZUFyZWEodGFyZ2V0KTtcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9XG4gIH0sXG4gIF91cGRhdGVfYXJlYV9nZW9tZXRyeTogZnVuY3Rpb24oZWwsb3B0aW9ucyl7XG4gICAgaWYgKG9wdGlvbnMucGF0aCkge1xuXG4gICAgICBvcHRpb25zLndpZHRoID0gb3B0aW9ucy53aWR0aCB8fCBlbC53aWR0aDtcbiAgICAgIHZhciBnZW9tZXRyeSA9IHRoaXMuZ2V0UmVjdChvcHRpb25zKTtcbiAgICAgIHZhciBfc2NhbGUgPSBlbC53aWR0aCAvIGdlb21ldHJ5LndpZHRoO1xuICAgICAgZWwuc2V0KHtcbiAgICAgICAgbGVmdDogZ2VvbWV0cnkubGVmdCAsLy8vKiBlbC5sZWZ0ICogX3NjYWxlKi8sXG4gICAgICAgIHRvcDogZ2VvbWV0cnkudG9wICwvLysgZWwudG9wICogX3NjYWxlLFxuICAgICAgICBzY2FsZVg6IF9zY2FsZSxcbiAgICAgICAgc2NhbGVZOiBfc2NhbGVcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB2YXIgZ2VvbWV0cnkgPSB0aGlzLmdldFJlY3Qob3B0aW9ucyk7XG5cbiAgICBpZihvcHRpb25zLnNyYyl7XG4gICAgICB2YXIgX3NjYWxlID0gZ2VvbWV0cnkud2lkdGggLyBpbWcud2lkdGg7XG4gICAgICBlbC5zZXQoe1xuICAgICAgICBsZWZ0OiBnZW9tZXRyeS5sZWZ0LC8vICsgZWwubGVmdCAqIF9zY2FsZSxcbiAgICAgICAgdG9wOiBnZW9tZXRyeS50b3AgLC8vKyBlbC50b3AgKiBfc2NhbGUsXG4gICAgICAgIHN0cm9rZVdpZHRoOiB0aGlzLmFyZWFQcm9wZXJ0aWVzLnN0cm9rZVdpZHRoIC8gX3NjYWxlLFxuICAgICAgICBzY2FsZVg6IF9zY2FsZSxcbiAgICAgICAgc2NhbGVZOiBfc2NhbGVcbiAgICAgIH0pO1xuICAgIH1lbHNle1xuICAgICAgZWwuc2V0KGdlb21ldHJ5KTtcbiAgICB9XG4gIH0sXG4gIGNyZWF0ZUFyZWE6IGZ1bmN0aW9uIChhcmVhLCBjYWxsYmFjaykge1xuXG4gICAgdmFyIF90aGlzID0gdGhpcztcblxuICAgIHZhciBfZmluYWxpemUgPSBmdW5jdGlvbiAocGF0aCwgYXJlYSkge1xuICAgICAgcGF0aC5pZCA9IGFyZWEuaWQ7XG4gICAgICBhcmVhLmluc3RhbmNlID0gcGF0aDtcbiAgICAgIHBhdGgubGF5ZXIgPSBcImJhY2tncm91bmRcIjtcbiAgICAgIF90aGlzLmFkZChwYXRoKTtcbiAgICAgIHRoaXMuX3VwZGF0ZV9hcmVhX2dlb21ldHJ5KHBhdGgsYXJlYSk7XG4gICAgICAvLyBfdGhpcy5fYmFja2dyb3VuZExheWVyLnB1c2gocGF0aCk7XG4gICAgICAvLyBwYXRoLmNhbnZhcyA9IF90aGlzO1xuICAgICAgY2FsbGJhY2soKTtcbiAgICB9LmJpbmQodGhpcyk7XG5cblxuICAgIHZhciBwYXRoLCByZWN0YXJlYTtcbiAgICBpZiAoYXJlYS5wYXRoKSB7XG4gICAgICBwYXRoID0gbmV3IGZhYnJpYy5QYXRoKGFyZWEucGF0aCwgdGhpcy5hcmVhUHJvcGVydGllcyk7XG4gICAgICBhcmVhLnRvcCA9IHBhdGgudG9wO1xuICAgICAgYXJlYS5sZWZ0ID0gcGF0aC5sZWZ0O1xuICAgICAgYXJlYS53aWR0aCA9IHBhdGgud2lkdGg7XG4gICAgICBhcmVhLmhlaWdodCA9IHBhdGguaGVpZ2h0O1xuICAgICAgX2ZpbmFsaXplKHBhdGgsIGFyZWEpO1xuICAgIH0gZWxzZSBpZiAoYXJlYS5zcmMpIHtcbiAgICAgIHZhciBjbGlwRmlsbGVyID0gbmV3IGZhYnJpYy5QYXRoZmluZGVyKHt9KTtcbiAgICAgIGZhYnJpYy51dGlsLmxvYWRJbWFnZShhcmVhLnNyYywgZnVuY3Rpb24gKGltZykge1xuICAgICAgICBjbGlwRmlsbGVyLnNldEltYWdlKGltZyk7XG4gICAgICAgIGNsaXBGaWxsZXIubWFzayA9IE1hZ2ljV2FuZC5zZWxlY3RCYWNrZ3JvdW5kKGNsaXBGaWxsZXIuZ2V0SW5mbygpLCBudWxsLCAxNSk7XG5cbiAgICAgICAgdmFyIGNvbnRvdXJzID0gY2xpcEZpbGxlci5nZXRDb250b3VycygpO1xuICAgICAgICB2YXIgY2xpcFBvaW50cyA9IGNvbnRvdXJzWzFdLnBvaW50cztcbiAgICAgICAgdmFyIHBhdGhEYXRhID0gZmFicmljLlBlbmNpbEJydXNoLnByb3RvdHlwZS5jb252ZXJ0UG9pbnRzVG9TVkdQYXRoKGNsaXBQb2ludHMpLmpvaW4oJycpOy8vdG9kb1xuICAgICAgICBwYXRoID0gbmV3IGZhYnJpYy5QYXRoKHBhdGhEYXRhLCBfdGhpcy5hcmVhUHJvcGVydGllcyk7XG5cbiAgICAgICAgX2ZpbmFsaXplKHBhdGgsIGFyZWEpO1xuICAgICAgfSk7XG5cbiAgICB9IGVsc2Uge1xuICAgICAgcGF0aCA9IG5ldyBmYWJyaWMuUmVjdCh0aGlzLmFyZWFQcm9wZXJ0aWVzKTtcbiAgICAgIF9maW5hbGl6ZShwYXRoLCBhcmVhKTtcbiAgICB9XG5cblxuXG4gICAgaWYoKCBhcmVhLnJpZ2h0IHx8IGFyZWEuYm90dG9tIHx8IGFyZWEucGF0aCApICYmICghdGhpcy5vcmlnaW5hbFdpZHRoICB8fCAhdGhpcy5vcmlnaW5hbEhlaWdodCkgKXtcbiAgICAgIHRoaXMub24oXCJiYWNrZ3JvdW5kLWltYWdlOmxvYWRlZFwiLGZ1bmN0aW9uKCl7XG4gICAgICAgIHRoaXMuX3VwZGF0ZV9hcmVhX2dlb21ldHJ5KHBhdGgsYXJlYSk7XG4gICAgICB0aGlzLnJlbmRlckFsbCgpO1xuICAgICAgfS5iaW5kKHRoaXMpKVxuICAgIH1cblxuICAgIC8qXG4gICAgIGFwcC5jYW52YXMuc2V0T2Zmc2V0cyh7XG4gICAgIHJpZ2h0OiAgMSxcbiAgICAgbGVmdDogICAxLFxuICAgICB0b3A6ICAgIDEsXG4gICAgIGJvdHRvbTogMVxuICAgICB9KTtcblxuXG4gICAgIGFwcC5jYW52YXMuY2xpcFRvID0gZnVuY3Rpb24gKGN0eCkge1xuICAgICB2YXIgem9vbSA9IGFwcC5jYW52YXNfY29uZmlnLndpZHRoIC8gYXBwLmNhbnZhcy5iYWNrZ3JvdW5kSW1hZ2UuZmlsdGVyc1swXS5wYXRoZmluZGVyLm1hc2sud2lkdGg7XG4gICAgIGN0eC5zYXZlKCk7XG4gICAgIGN0eC5zY2FsZSh6b29tLCB6b29tKTtcbiAgICAgYXBwLmNsaXBGaWxsZXIudHJhY2VJbm5lcihjdHgpO1xuICAgICBjdHgucmVzdG9yZSgpO1xuICAgICB9OyovXG4gIH0sXG4gIHJlbW92ZUFyZWE6IGZ1bmN0aW9uIChhcmVhLCBjYWxsYmFjaykge1xuXG4gICAgdmFyIG9ianMgPSB0aGlzLmdldE9iamVjdHMoKTtcbiAgICBmb3IgKHZhciBpIGluIG9ianMpIHtcbiAgICAgIGlmIChvYmpzW2ldLm1vdmVtZW50TGltaXRzID09IGFyZWEpIHtcbiAgICAgICAgZGVsZXRlIG9ianNbaV0ubW92ZW1lbnRMaW1pdHM7XG4gICAgICB9XG4gICAgICBpZiAob2Jqc1tpXS5jbGlwVG8gPT0gYXJlYSkge1xuICAgICAgICAvL2lmKG9ianNbaV0ub2xjQ2xpcFRvSUQpe1xuICAgICAgICAvLyAgICBvYmpzW2ldLmNsaXBUb0lEID0gb2Jqc1tpXS5vbGRDbGlwVG9JRDtcbiAgICAgICAgLy99XG4gICAgICAgIGRlbGV0ZSBvYmpzW2ldLmNsaXBUbztcbiAgICAgICAgLy9vYmpzW2ldLm9sY0NsaXBUb0lEID0gYXJlYS5pZDtcbiAgICAgIH1cbiAgICB9XG4gICAgYXJlYS5yZW1vdmUoKTtcbiAgfSxcbiAgLyoqXG4gICAqXG4gICAqIEBwYXJhbSBvZmZzZXRzIDoge3RvcDogbnVtYmVyLCByaWdodDogbnVtYmVyLCBib3R0b206IG51bWJlciwgbGVmdDogbnVtYmVyfSB8IG51bWJlciB8IFs/bnVtYmVyLD9udW1iZXIsP251bWJlciw/bnVtYmVyXVxuICAgKiBAcGFyYW0gY2FsbGJhY2tcbiAgICovXG4gIHNldE9mZnNldHM6IGZ1bmN0aW9uIChvZmZzZXRzLCBjYWxsYmFjaykge1xuXG4gICAgaWYgKG9mZnNldHMuY29uc3RydWN0b3IgPT09IE51bWJlcikge1xuICAgICAgdGhpcy5vZmZzZXRzID0ge3RvcDogb2Zmc2V0cywgcmlnaHQ6IG9mZnNldHMsIGJvdHRvbTogb2Zmc2V0cywgbGVmdDogb2Zmc2V0c307XG4gICAgfWVsc2UgaWYgKG9mZnNldHMubGVuZ3RoKSB7XG4gICAgICBzd2l0Y2gob2Zmc2V0cy5sZW5ndGgpe1xuICAgICAgICBjYXNlIDA6IHRoaXMub2Zmc2V0cyA9IHt0b3A6IDAsIHJpZ2h0OiAwLCBib3R0b206IDAsIGxlZnQ6IDB9OyBicmVhaztcbiAgICAgICAgY2FzZSAxOiB0aGlzLm9mZnNldHMgPSB7dG9wOiBvZmZzZXRzWzBdLCByaWdodDogb2Zmc2V0c1swXSwgYm90dG9tOiBvZmZzZXRzWzBdLCBsZWZ0OiBvZmZzZXRzWzBdfTsgYnJlYWs7XG4gICAgICAgIGNhc2UgMjogdGhpcy5vZmZzZXRzID0ge3RvcDogb2Zmc2V0c1swXSwgcmlnaHQ6IG9mZnNldHNbMV0sIGJvdHRvbTogb2Zmc2V0c1swXSwgbGVmdDogb2Zmc2V0c1sxXX07IGJyZWFrO1xuICAgICAgICBjYXNlIDM6IHRoaXMub2Zmc2V0cyA9IHt0b3A6IG9mZnNldHNbMF0sIHJpZ2h0OiBvZmZzZXRzWzFdLCBib3R0b206IG9mZnNldHNbMl0sIGxlZnQ6IG9mZnNldHNbMV19OyBicmVhaztcbiAgICAgICAgY2FzZSA0OiB0aGlzLm9mZnNldHMgPSB7dG9wOiBvZmZzZXRzWzBdLCByaWdodDogb2Zmc2V0c1sxXSwgYm90dG9tOiBvZmZzZXRzWzJdLCBsZWZ0OiBvZmZzZXRzWzNdfTsgYnJlYWs7XG4gICAgICB9XG4gICAgfWVsc2V7XG4gICAgICB0aGlzLm9mZnNldHMgPSBvZmZzZXRzO1xuICAgIH1cblxuICAgIHRoaXMuc2V0QXJlYXMoW3RoaXMub2Zmc2V0c10sIGNhbGxiYWNrKTtcbiAgfSxcbiAgc2V0QXJlYXM6IGZ1bmN0aW9uIChhcmVhcywgY2FsbGJhY2spIHtcbiAgICBhcmVhcyA9IGFyZWFzIHx8IFtdO1xuICAgIGlmICh0aGlzLmFyZWFzKSB7XG4gICAgICBmb3IgKHZhciBpID0gdGhpcy5hcmVhcy5sZW5ndGg7IGktLTspIHtcbiAgICAgICAgdGhpcy5yZW1vdmVBcmVhKHRoaXMuYXJlYXNbaV0uaW5zdGFuY2UpO1xuICAgICAgfVxuICAgIH1cbiAgICB0aGlzLmFyZWFzID0gYXJlYXM7XG5cbiAgICB2YXIgY2IgPSBmYWJyaWMudXRpbC5xdWV1ZUxvYWQoYXJlYXMubGVuZ3RoICsgMSwgZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKHRoaXMuYXJlYUFjdGl2YXRpbmcpIHtcbiAgICAgICAgaWYgKHRoaXMubGF5ZXJzLmJhY2tncm91bmQub2JqZWN0c1swXSkge1xuICAgICAgICAgIHRoaXMuc2V0QWN0aXZlQXJlYSh0cnVlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLmFjdGl2ZUFyZWEgPSBudWxsO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHZhciBvYmpzID0gdGhpcy5nZXRPYmplY3RzKCk7XG4vL3dvcmsgd2l0aCBvYmplY3RcbiAgICAgIGlmICghYXJlYXMubGVuZ3RoKSB7XG4gICAgICAgIG9ianMubGVuZ3RoICYmIHRoaXMuY2xlYXIoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgLyogdG9kbyA6INC/0YDQuNC80LXQvdC40YLRjCDRgtC10LrRg9GJ0YPRjiDQt9C+0L3RgyDQutC+INCy0YHQtdC8INC+0LHRitC10LrRgtCw0LxcbiAgICAgICB2YXIgX2FyZWEgPSB0aGlzLmFjdGl2ZUFyZWEgfHwgdGhpcy5sYXllcnMuYmFja2dyb3VuZC5vYmplY3RzWzBdO1xuICAgICAgICBmb3IgKHZhciBpIGluIG9ianMpIHtcbiAgICAgICAgICB2YXIgb2JqID0gb2Jqc1tpXTtcbiAgICAgICAgICBvYmouY2xpcFRvID0gX2FyZWE7XG4gICAgICAgICAgb2JqLnNldE1vdmVtZW50TGltaXRzKF9hcmVhKTtcbiAgICAgICAgICBvYmouc2V0Q29vcmRzKCk7XG4gICAgICAgIH0qL1xuICAgICAgfVxuICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2suY2FsbCh0aGlzKTtcbiAgICB9LmJpbmQodGhpcykpO1xuXG4gICAgZm9yICh2YXIgaSBpbiBhcmVhcykge1xuICAgICAgaWYgKCFhcmVhc1tpXS5pZCkge1xuICAgICAgICBhcmVhc1tpXS5pZCA9IFwiX19cIiArIGk7XG4gICAgICB9XG4gICAgICB0aGlzLmNyZWF0ZUFyZWEoYXJlYXNbaV0sIGNiKTtcbiAgICB9XG4gICAgY2IoKTtcblxuICAgIHRoaXMucmVuZGVyQWxsKCk7XG4gIH1cbn0pXG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL21vZHVsZXMvYXJlYXMuanNcbi8vIG1vZHVsZSBpZCA9IDcxXG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIid1c2Ugc3RyaWN0JztcblxuXG4vLyBmYWJyaWMucmVxdWlyZSgnU2xpZGVHcm91cCcsWydTbGlkZU9iamVjdCddLCBmdW5jdGlvbigpIHtcbnZhciBfT0JKID0gZmFicmljLk9iamVjdC5wcm90b3R5cGU7XG52YXIgX2hhbmRsZUdyb3VwaW5nX292ZXJ3cml0dGVuID0gZmFicmljLkNhbnZhcy5wcm90b3R5cGUuX2hhbmRsZUdyb3VwaW5nO1xuZmFicmljLk9iamVjdC5wcm90b3R5cGUuZ3JvdXBhYmxlID0gdHJ1ZTtcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuQ2FudmFzLnByb3RvdHlwZSwge1xuICAvKipcbiAgICogRGVhY3RpdmF0ZXMgYWxsIG9iamVjdHMgYW5kIGRpc3BhdGNoZXMgYXBwcm9wcmlhdGUgZXZlbnRzXG4gICAqIEByZXR1cm4ge2ZhYnJpYy5DYW52YXN9IHRoaXNBcmdcbiAgICogQGNoYWluYWJsZVxuICAgKi9cbiAgZGVhY3RpdmF0ZUFsbFdpdGhEaXNwYXRjaDogZnVuY3Rpb24gKGUpIHtcbiAgICB2YXIgYWN0aXZlR3JvdXAgPSB0aGlzLmdldEFjdGl2ZUdyb3VwKCksXG4gICAgICBhY3RpdmVPYmplY3QgPSB0aGlzLmdldEFjdGl2ZU9iamVjdCgpO1xuICAgIHZhciBfdGFyZ2V0ID0gYWN0aXZlT2JqZWN0IHx8IGFjdGl2ZUdyb3VwO1xuICAgIGlmIChfdGFyZ2V0KSB7XG4gICAgICB0aGlzLmZpcmUoJ2JlZm9yZTpzZWxlY3Rpb246Y2xlYXJlZCcsIHsgdGFyZ2V0OiBfdGFyZ2V0LCBlOiBlIH0pO1xuICAgIH1cbiAgICB0aGlzLmRlYWN0aXZhdGVBbGwoKTtcbiAgICBpZiAoX3RhcmdldCkge1xuICAgICAgdGhpcy5maXJlKCdzZWxlY3Rpb246Y2xlYXJlZCcsIHsgZTogZSwgdGFyZ2V0OiBfdGFyZ2V0IH0pO1xuICAgICAgX3RhcmdldC5maXJlKCdkZXNlbGVjdGVkJyk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9LFxuXG4gIC8qKlxuICAgKiBEaXZpZGVzIG9iamVjdHMgaW4gdHdvIGdyb3Vwcywgb25lIHRvIHJlbmRlciBpbW1lZGlhdGVseVxuICAgKiBhbmQgb25lIHRvIHJlbmRlciBhcyBhY3RpdmVHcm91cC5cbiAgICogcmV0dXJuIG9iamVjdHMgdG8gcmVuZGVyIGltbWVkaWF0ZWx5IGFuZCBwdXNoZXMgdGhlIG90aGVyIGluIHRoZSBhY3RpdmVHcm91cC5cbiAgICovXG4gIF9jaG9vc2VPYmplY3RzVG9SZW5kZXI6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBhY3RpdmVHcm91cCA9IHRoaXMuZ2V0QWN0aXZlR3JvdXAoKSxcbiAgICAgIGFjdGl2ZU9iamVjdCA9IHRoaXMuZ2V0QWN0aXZlT2JqZWN0KCksXG4gICAgICBvYmplY3QsIG9ianNUb1JlbmRlciA9IFsgXSwgYWN0aXZlR3JvdXBPYmplY3RzID0gWyBdO1xuXG4gICAgaWYgKGFjdGl2ZUdyb3VwICYmICF0aGlzLnByZXNlcnZlT2JqZWN0U3RhY2tpbmcpIHtcbiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSB0aGlzLl9vYmplY3RzLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICAgIG9iamVjdCA9IHRoaXMuX29iamVjdHNbaV07XG4gICAgICAgIGlmICghYWN0aXZlR3JvdXAuY29udGFpbnMob2JqZWN0KSkge1xuICAgICAgICAgIGlmKCFvYmplY3QuaGlkZGVuQWN0aXZlKXtcbiAgICAgICAgICAgIG9ianNUb1JlbmRlci5wdXNoKG9iamVjdCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIGFjdGl2ZUdyb3VwT2JqZWN0cy5wdXNoKG9iamVjdCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChhY3RpdmVHcm91cCkge1xuICAgICAgICAvLyBhY3RpdmVHcm91cC5fc2V0KCdfb2JqZWN0cycsIGFjdGl2ZUdyb3VwT2JqZWN0cyk7XG4gICAgICAgIG9ianNUb1JlbmRlci5wdXNoKGFjdGl2ZUdyb3VwKTtcbiAgICAgIH1cbiAgICAgIGFjdGl2ZU9iamVjdCAmJiBvYmpzVG9SZW5kZXIucHVzaChhY3RpdmVPYmplY3QpO1xuICAgICAgLy8gYWN0aXZlR3JvdXAuX3NldCgnX29iamVjdHMnLCBhY3RpdmVHcm91cE9iamVjdHMpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIG9ianNUb1JlbmRlciA9IHRoaXMuX29iamVjdHM7XG4gICAgfVxuICAgIHJldHVybiBvYmpzVG9SZW5kZXI7XG4gIH0sXG4gIC8qKlxuICAgKiBhZGRpbmcgYmVmb3JlOnNlbGVjdGlvbjpjcmVhdGVkIGV2ZW50XG4gICAqIEBwcml2YXRlXG4gICAqIEBwYXJhbSB7RXZlbnR9IGUgRXZlbnQgb2JqZWN0XG4gICAqIEBwYXJhbSB7ZmFicmljLk9iamVjdH0gdGFyZ2V0XG4gICAqL1xuICBfaGFuZGxlR3JvdXBpbmc6IGZ1bmN0aW9uIChlLCB0YXJnZXQpIHtcbiAgICB0aGlzLmZpcmUoXCJiZWZvcmU6c2VsZWN0aW9uOmNyZWF0ZWRcIik7XG4gICAgX2hhbmRsZUdyb3VwaW5nX292ZXJ3cml0dGVuLmNhbGwodGhpcywgZSwgdGFyZ2V0KTtcbiAgfSxcbiAgLyoqXG4gICAqIEBwcml2YXRlXG4gICAqIEBwYXJhbSB7RXZlbnR9IGUgbW91c2UgZXZlbnRcbiAgICovXG4gIF9ncm91cFNlbGVjdGVkT2JqZWN0czogZnVuY3Rpb24gKGUpIHtcblxuICAgIHZhciBncm91cCA9IHRoaXMuX2NvbGxlY3RPYmplY3RzKCk7XG5cbiAgICBncm91cCA9IGZhYnJpYy51dGlsLm9iamVjdC5maWx0ZXIoZ3JvdXAse2dyb3VwYWJsZTogdHJ1ZX0pO1xuXG4gICAgLy8gZG8gbm90IGNyZWF0ZSBncm91cCBmb3IgMSBlbGVtZW50IG9ubHlcbiAgICBpZiAoZ3JvdXAubGVuZ3RoID09PSAxKSB7XG4gICAgICB0aGlzLnNldEFjdGl2ZU9iamVjdChncm91cFswXSwgZSk7XG4gICAgfVxuICAgIGVsc2UgaWYgKGdyb3VwLmxlbmd0aCA+IDEpIHtcbiAgICAgIGdyb3VwID0gbmV3IGZhYnJpYy5Hcm91cChncm91cC5yZXZlcnNlKCksIHtcbiAgICAgICAgY2FudmFzOiB0aGlzXG4gICAgICB9KTtcbiAgICAgIGdyb3VwLmFkZFdpdGhVcGRhdGUoKTtcbiAgICAgIHRoaXMuc2V0QWN0aXZlR3JvdXAoZ3JvdXAsIGUpO1xuICAgICAgZ3JvdXAuc2F2ZUNvb3JkcygpO1xuICAgICAgdGhpcy5maXJlKCdzZWxlY3Rpb246Y3JlYXRlZCcsIHsgdGFyZ2V0OiBncm91cCB9KTtcbiAgICAgIHRoaXMucmVuZGVyQWxsKCk7XG4gICAgfVxuICB9XG59KTtcblxuX09CSi5jbG9uZVN5bmMgPSBmdW5jdGlvbigpe1xuICB2YXIgX2tsYXNzID0gZmFicmljW2ZhYnJpYy51dGlsLnN0cmluZy5jYW1lbGl6ZShmYWJyaWMudXRpbC5zdHJpbmcuY2FwaXRhbGl6ZSh0aGlzLnR5cGUpKV07XG4gIGlmKF9rbGFzcy5hc3luYyl7XG4gICAgdmFyIF9vYmogPSBuZXcgX2tsYXNzLmZyb21PYmplY3QodGhpcyk7XG4gIH1lbHNle1xuICAgIHZhciBfb2JqID0gdGhpcy5jbG9uZSgpO1xuICB9XG4gIF9vYmouY2FudmFzID0gdGhpcy5jYW52YXM7XG4gIHJldHVybiBfb2JqO1xufTtcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuR3JvdXAucHJvdG90eXBlLCB7XG4gIGdyb3VwU2VsZWN0YWJsZTogdHJ1ZSxcbiAgY2xvbmVTeW5jOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgX2Nsb25lZE9iamVjdHMgPSB0aGlzLl9vYmplY3RzLm1hcChmdW5jdGlvbihvYmplY3Qpe1xuICAgICAgcmV0dXJuIG9iamVjdC5jbG9uZVN5bmMoKTtcbiAgICB9KTtcblxuXG4gICAgdmFyIG9iamVjdCA9IHRoaXMudG9PYmplY3QoKTtcbiAgICBkZWxldGUgb2JqZWN0Lm9iamVjdHM7XG5cbiAgICByZXR1cm4gbmV3IGZhYnJpYy5Hcm91cChfY2xvbmVkT2JqZWN0cywgb2JqZWN0LCB0cnVlKTtcblxuICAgIC8vIGZhYnJpYy51dGlsLmVubGl2ZW5PYmplY3RzKG9iamVjdC5vYmplY3RzLCBmdW5jdGlvbiAoZW5saXZlbmVkT2JqZWN0cykge1xuICAgIC8vICAgZGVsZXRlIG9iamVjdC5vYmplY3RzO1xuICAgIC8vICAgY2FsbGJhY2sgJiYgY2FsbGJhY2sobmV3IGZhYnJpYy5Hcm91cChlbmxpdmVuZWRPYmplY3RzLCBvYmplY3QsIHRydWUpKTtcbiAgICAvLyB9KTtcbiAgfSxcbiAgX2NhbGNCb3VuZHMgOiBmdW5jdGlvbiAob25seVdpZHRoSGVpZ2h0KSB7XG4gICAgdmFyIGFYID0gW10sXG4gICAgICBhWSA9IFtdLFxuICAgICAgbywgcHJvcCxcbiAgICAgIHByb3BzID0gWyd0cicsICdicicsICdibCcsICd0bCddO1xuXG4gICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHRoaXMuX29iamVjdHMubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHtcbiAgICAgIG8gPSB0aGlzLl9vYmplY3RzW2ldO1xuICAgICAgaWYgKG8ubm90U2VsZWN0YWJsZUluVGhlR3JvdXApIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBvLnNldENvb3JkcygpO1xuICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBwcm9wcy5sZW5ndGg7IGorKykge1xuICAgICAgICBwcm9wID0gcHJvcHNbal07XG4gICAgICAgIGFYLnB1c2goby5vQ29vcmRzW3Byb3BdLngpO1xuICAgICAgICBhWS5wdXNoKG8ub0Nvb3Jkc1twcm9wXS55KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLnNldCh0aGlzLl9nZXRCb3VuZHMoYVgsIGFZLCBvbmx5V2lkdGhIZWlnaHQpKTtcbiAgfSxcbiAgaW5pdGlhbGl6ZV9vdmVyd3JpdHRlbjogZmFicmljLkdyb3VwLnByb3RvdHlwZS5pbml0aWFsaXplLFxuICBpc1NlbGVjdGlvbkdyb3VwOiBmdW5jdGlvbigpe1xuICAgIHJldHVybiB0aGlzLmNhbnZhcy5fb2JqZWN0cy5pbmRleE9mKHRoaXMpID09PSAtMVxuICB9LFxuICAvL2Nsb25lOiBmdW5jdGlvbihjYWxsYmFjayl7XG4gIC8vICBpZihjYWxsYmFjayA9PT0gdHJ1ZSB8fCBjYWxsYmFjay5jb25zdHJ1Y3RvciA9PT0gT2JqZWN0KXtcbiAgLy8gICAgdmFyIF9mcmFtZSA9IG5ldyBmYWJyaWMuR3JvdXAodGhpcyk7XG4gIC8vICAgIGlmKGNhbGxiYWNrLmNvbnN0cnVjdG9yID09PSBPYmplY3Qpe1xuICAvLyAgICAgIF9mcmFtZS5zZXQoY2FsbGJhY2spO1xuICAvLyAgICAgIHJldHVybiBfZnJhbWU7XG4gIC8vICAgIH1cbiAgLy8gIH1cbiAgLy8gIHJldHVybiB0aGlzLmNhbGxTdXBlcignY2xvbmUnLGNhbGxiYWNrKTtcbiAgLy99LFxuICBpbml0aWFsaXplOiBmdW5jdGlvbihvYmplY3RzLG9wdGlvbnMpe1xuICAgIGlmKG9iamVjdHMuY29uc3RydWN0b3IgIT0gQXJyYXkpe1xuICAgICAgdmFyIGVsID0gb2JqZWN0cztcbiAgICAgIG9wdGlvbnMgPSBlbC50b09iamVjdCgpO1xuICAgICAgb2JqZWN0cyA9IFtdO1xuICAgICAgZm9yKHZhciBpIGluIGVsLl9vYmplY3RzKXtcbiAgICAgICAgb2JqZWN0cy5wdXNoKGVsLl9vYmplY3RzW2ldLmNsb25lU3luYygpKVxuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMuaW5pdGlhbGl6ZV9vdmVyd3JpdHRlbihvYmplY3RzLG9wdGlvbnMpO1xuICAgIGlmKHRoaXMudHlwZSA9PSAnZ3JvdXAnKXtcbiAgICAgIHRoaXMub24oXCJkYmxjbGlja1wiLCBmdW5jdGlvbigpe1xuICAgICAgICBpZih0aGlzLmNhbnZhcy5fb2JqZWN0cy5pbmRleE9mKHRoaXMpID09PSAtMSl7XG4gICAgICAgICAgdGhpcy5ncm91cFNlbGVjdGVkRWxlbWVudHMoKTtcbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgdGhpcy51bmdyb3VwKCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfSxcbiAgdW5ncm91cCA6IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuY2FudmFzLmRpc2NhcmRBY3RpdmVHcm91cCgpO1xuICAgIHRoaXMuX3Jlc3RvcmVPYmplY3RzU3RhdGUoKTtcbiAgICB0aGlzLmNhbnZhcy5yZW1vdmUodGhpcyk7XG4gICAgZm9yKHZhciBpIGluIHRoaXMuX29iamVjdHMpe1xuICAgICAgdGhpcy5jYW52YXMuYWRkKHRoaXMuX29iamVjdHNbaV0pO1xuICAgICAgdGhpcy5fb2JqZWN0c1tpXS5jbGlwVG8gPSB0aGlzLmNsaXBUbztcbiAgICAgIC8vdGhpcy5fb2JqZWN0c1tpXS5hY3RpdmUgPSB0cnVlO1xuICAgIH1cbiAgICB2YXIgZ3JvdXAgPSBuZXcgZmFicmljLkdyb3VwKHRoaXMuX29iamVjdHMsIHtcbiAgICAgIGNhbnZhczogdGhpcy5jYW52YXNcbiAgICB9KTtcbiAgICBncm91cC5hZGRXaXRoVXBkYXRlKCk7XG4gICAgdGhpcy5jYW52YXMuc2V0QWN0aXZlR3JvdXAoZ3JvdXApO1xuICAgIGdyb3VwLnNhdmVDb29yZHMoKTtcbiAgICB0aGlzLmNhbnZhcy5maXJlKCdzZWxlY3Rpb246Y3JlYXRlZCcsIHsgdGFyZ2V0OiBncm91cCB9KTtcbiAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcblxuICAgIC8vdmFyIF9ncm91cCA9IG5ldyBmYWJyaWMuR3JvdXAodGhpcy5fb2JqZWN0cyk7XG4gICAgLy9fZ3JvdXAuY2FudmFzID0gdGhpcy5jYW52YXM7XG4gICAgLy90aGlzLmNhbnZhcy5zZXRBY3RpdmVPYmplY3QoX2dyb3VwKTtcbiAgfSxcblxuICBncm91cFNlbGVjdGVkRWxlbWVudHM6IGZ1bmN0aW9uKCl7XG5cblxuXG4gICAgdmFyIGVsID0gdGhpcy5jbG9uZVN5bmMoKTtcbiAgICB0aGlzLmNhbnZhcy5hZGQoZWwpO1xuICAgIHRoaXMuY2FudmFzLmRpc2NhcmRBY3RpdmVHcm91cCgpO1xuICAgIHRoaXMuY2FudmFzLnNldEFjdGl2ZU9iamVjdChlbCk7XG5cbiAgICBmb3IodmFyIGkgaW4gdGhpcy5fb2JqZWN0cyl7XG4gICAgICB0aGlzLmNhbnZhcy5yZW1vdmUodGhpcy5fb2JqZWN0c1tpXS5vcmlnaW5hbE9iamVjdCk7XG4gICAgfVxuXG5cbiAgfSxcbiAgYWN0aW9uczoge1xuXG4gICAgb2JqZWN0UmVtb3ZlOiB7XG4gICAgICBjbGFzc05hbWU6ICAnZmEgZmEtdHJhc2gnLFxuICAgICAgdGl0bGU6ICAgICAgJ0RlbGV0ZScsXG4gICAgICBrZXk6ICAgICAgICBcIkRlbGV0ZVwiLFxuICAgICAgYWN0aW9uOiAgICAgZnVuY3Rpb24oKXtcbiAgICAgICAgaWYodGhpcy5pc1NlbGVjdGlvbkdyb3VwKCkpe1xuICAgICAgICAgIGZvcih2YXIgaSBpbiB0aGlzLl9vYmplY3RzKXtcbiAgICAgICAgICAgIHZhciBfb2JqID0gdGhpcy5fb2JqZWN0c1tpXTtcbiAgICAgICAgICAgIHRoaXMuY2FudmFzLnJlbW92ZShfb2JqLm9yaWdpbmFsT2JqZWN0KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy5jYW52YXMuZGlzY2FyZEFjdGl2ZUdyb3VwKCk7XG4gICAgICAgICAgdGhpcy5jYW52YXMuZGlzY2FyZEFjdGl2ZU9iamVjdCgpO1xuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICB0aGlzLmNhbnZhcy5yZW1vdmUodGhpcyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gICAgICB9XG4gICAgfSxcbiAgICBvYmplY3REdXBsaWNhdGU6IHtcbiAgICAgIGNsYXNzTmFtZTogICdmYSBmYS1jbG9uZScsXG4gICAgICBpbnNlcnQ6ICAgICAnZHVwbGljYXRlVG9vbCcsXG4gICAgICB0aXRsZTogICAgICAnRHVwbGljYXRlJyxcbiAgICAgIGFjdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZih0aGlzLmlzU2VsZWN0aW9uR3JvdXAoKSl7XG4gICAgICAgICAgdGhpcy5jYW52YXMuZmlyZSgnYmVmb3JlOnNlbGVjdGlvbjpjbGVhcmVkJywgeyB0YXJnZXQ6IHRoaXMsIGU6IG51bGwgfSk7XG4gICAgICAgICAgdGhpcy5jYW52YXMuZGlzY2FyZEFjdGl2ZUdyb3VwKCk7XG4gICAgICAgICAgdGhpcy5kdXBsaWNhdGUoZnVuY3Rpb24oZWwpe1xuICAgICAgICAgICAgZWwudW5ncm91cCgpO1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gICAgICAgIH1lbHNle1xuICAgICAgICAgIHRoaXMuZHVwbGljYXRlKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuICAgIHNlbGVjdEdyb3VwOiB7XG4gICAgICB0aXRsZTogJ9Cz0YDRg9C/0L/QsCcsXG4gICAgICBjbGFzc05hbWU6ICdmYSBmYS1vYmplY3QtZ3JvdXAnLFxuICAgICAgdmlzaWJsZTogZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuIHRoaXMuaXNTZWxlY3Rpb25Hcm91cCgpO1xuICAgICAgfSxcbiAgICAgIGFjdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmdyb3VwU2VsZWN0ZWRFbGVtZW50cygpO1xuICAgICAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICAgIH1cbiAgICAgIC8vdmlzaWJsZTogSURFLmdyb3VwQXZhaWxhYmxlXG4gICAgfSxcbiAgICB1bnNlbGVjdEdyb3VwOiB7XG4gICAgICB0aXRsZTogJ9Cz0YDRg9C/0L/QsCcsXG4gICAgICBjbGFzc05hbWU6ICdmYSBmYS1vYmplY3QtdW5ncm91cCcsXG4gICAgICB2aXNpYmxlOiBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gdGhpcy5jYW52YXMuX29iamVjdHMuaW5kZXhPZih0aGlzKSAhPT0gLTFcbiAgICAgIH0sXG4gICAgICBhY3Rpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy51bmdyb3VwKCk7XG4gICAgICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgICAgfVxuICAgIH1cbiAgfVxufSk7XG5cblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuU2xpZGVDYW52YXMucHJvdG90eXBlLHtcbiAgZXZlbnRMaXN0ZW5lcnM6IGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmRBcnJheXNPYmplY3QoZmFicmljLlNsaWRlQ2FudmFzLnByb3RvdHlwZS5ldmVudExpc3RlbmVycywge1xuICAgICdzZWxlY3Rpb246Y3JlYXRlZCc6IGZ1bmN0aW9uKGV2ZW50KXtcbiAgICAgIHRoaXMuX29uU2VsZWN0aW9uQ3JlYXRlZChldmVudCk7XG4gICAgfVxuICB9KSxcbiAgX29uU2VsZWN0aW9uTW9kaWZpZWQ6IGZ1bmN0aW9uICgpIHtcbiAgICBmb3IgKHZhciBpIGluIHRoaXMuX29iamVjdHMpIHtcbiAgICAgIHZhciBjb3B5ID0gdGhpcy5fb2JqZWN0c1tpXS5jbG9uZVN5bmMoKTtcbiAgICAgIGNvcHkuZ3JvdXAgPSB0aGlzO1xuICAgICAgdGhpcy5fcmVzdG9yZU9iamVjdFN0YXRlKGNvcHkpO1xuICAgICAgdGhpcy5fb2JqZWN0c1tpXS5vcmlnaW5hbE9iamVjdC5zZXQoe1xuICAgICAgICBsZWZ0OiBjb3B5LmxlZnQsXG4gICAgICAgIHRvcDogY29weS50b3AsXG4gICAgICAgIGFuZ2xlOiBjb3B5LmFuZ2xlLFxuICAgICAgICBzY2FsZVg6IGNvcHkuc2NhbGVYLFxuICAgICAgICBzY2FsZVk6IGNvcHkuc2NhbGVZLFxuICAgICAgICBza2V3WDogY29weS5za2V3WCxcbiAgICAgICAgc2tld1k6IGNvcHkuc2tld1ksXG4gICAgICAgIHdpZHRoOiBjb3B5LndpZHRoLFxuICAgICAgICBoZWlnaHQ6IGNvcHkuaGVpZ2h0XG4gICAgICB9KTtcbiAgICB9XG4gIH0sXG4gIF9vblNlbGVjdGlvbkRlc2VsZWN0ZWQ6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgZm9yICh2YXIgaSBpbiB0aGlzLl9vYmplY3RzKSB7XG4gICAgICB2YXIgX29iaiA9IHRoaXMuX29iamVjdHNbaV07XG4gICAgICBfb2JqLm9yaWdpbmFsT2JqZWN0LnNldENvb3JkcygpO1xuICAgICAgX29iai5vcmlnaW5hbE9iamVjdC5ldmVudGVkID0gdHJ1ZTtcbiAgICAgIGRlbGV0ZSBfb2JqLm9yaWdpbmFsT2JqZWN0LmhpZGRlbkFjdGl2ZTtcbiAgICB9XG4gIH0sXG4gIF9vblNlbGVjdGlvbkNyZWF0ZWQ6IGZ1bmN0aW9uIChlbCkge1xuXG4gICAgdmFyIGdyb3VwICA9IGVsLnRhcmdldDtcblxuICAgIHZhciBvcmlnaW5hbE9iamVjdHMgPSBbXVxuICAgIGZvcih2YXIgaSBpbiBncm91cC5fb2JqZWN0cyl7XG4gICAgICB2YXIgX29iaiA9IGdyb3VwLl9vYmplY3RzW2ldO1xuICAgICAgb3JpZ2luYWxPYmplY3RzLnB1c2goX29iai5vcmlnaW5hbE9iamVjdCB8fCBfb2JqKVxuICAgIH1cblxuICAgIGdyb3VwLmRlc3Ryb3koKTtcbiAgICBncm91cC5fb2JqZWN0cyA9IFtdO1xuXG4gICAgdmFyIF9jbGlwVG8gPSBvcmlnaW5hbE9iamVjdHNbMF0uY2xpcFRvO1xuXG4gICAgZm9yICh2YXIgaSBpbiBvcmlnaW5hbE9iamVjdHMpIHtcbiAgICAgIHZhciBvcmlnaW5hbCA9IG9yaWdpbmFsT2JqZWN0c1tpXTtcblxuICAgICAgaWYgKF9jbGlwVG8gIT0gb3JpZ2luYWwuY2xpcFRvKSB7XG4gICAgICAgIF9jbGlwVG8gPSBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgdmFyIF9vYmogPSBvcmlnaW5hbC5jbG9uZVN5bmMoKTtcblxuICAgICAgX29iai5zZXQoe1xuICAgICAgICBjbGlwVG86IG51bGwsXG4gICAgICAgIG9yaWdpbmFsT2JqZWN0OiBvcmlnaW5hbFxuICAgICAgfSk7XG4gICAgICBvcmlnaW5hbC5zZXQoe1xuICAgICAgICBhY3RpdmU6ZmFsc2UsXG4gICAgICAgIGV2ZW50ZWQ6IGZhbHNlLFxuICAgICAgICBoaWRkZW5BY3RpdmU6IHRydWVcbiAgICAgIH0pO1xuXG4gICAgICBncm91cC5hZGRXaXRoVXBkYXRlKF9vYmopO1xuICAgICAgZ3JvdXAuc2V0Q29vcmRzKCk7XG4gICAgfVxuXG4gICAgZ3JvdXAuY2xpcFRvID0gIF9jbGlwVG87XG5cbiAgICBncm91cC5vbih7XG4gICAgICBcIm1vZGlmaWVkXCI6IHRoaXMuX29uU2VsZWN0aW9uTW9kaWZpZWQsXG4gICAgICAnZGVzZWxlY3RlZCc6IHRoaXMuX29uU2VsZWN0aW9uRGVzZWxlY3RlZFxuICAgIH0pO1xuXG4gIH1cbn0pO1xuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9tb2R1bGVzL2dyb3Vwcy5qc1xuLy8gbW9kdWxlIGlkID0gNzJcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiJ3VzZSBzdHJpY3QnO1xuXG5mYWJyaWMuTWFnaWNXYW5kID0gcmVxdWlyZSgnLi4vcGx1Z2lucy9tYWdpY3dhbmQnKTtcblxudmFyIE1hZ2ljV2FuZCA9IGZhYnJpYy5NYWdpY1dhbmQgO1xuXG4vKipcbiAqIFBhdGhmaW5kZXIgKFBhdGhmaW5kZXIpIEludGVyZmFjZSBmb3IgTWFnaWNXYW5kIHNlbGVjdGlvbiB0b29sXG4gKiBAcGFyYW0gb3B0aW9uc1xuICogQGNvbnN0cnVjdG9yXG4gKi9cbmZ1bmN0aW9uIFBhdGhmaW5kZXIob3B0aW9ucykge1xuICB0aGlzLmluaXRpYWxpemUob3B0aW9ucyk7XG59XG5cblBhdGhmaW5kZXIucHJvdG90eXBlID0ge1xuICB0eXBlOiAncGF0aGZpbmRlcicsXG4gIGtlZXBPbGRTZWxlY3Rpb246IHRydWUsXG4gIGFscGhhQ2hhbm5lbDogdHJ1ZSxcbiAgcGF0aGZpbmRlck1vZGU6ICduZXcnLFxuICBzZWxlY3Rpb25Ub29sOiAnbWFnaWMnLFxuICBhZGphY2VudFBpeGVsczogdHJ1ZSxcbiAgYXN5bmM6IGZhbHNlLFxuICBwYXRoZmluZGVyVG9vbHM6IGZhbHNlLFxuICBibHVyUmFkaXVzOiAwLFxuICBoYXRjaExlbmd0aDogNCxcbiAgY29sb3JUaHJlc2hvbGQ6IDE1LFxuICBzaW1wbGlmeVRvbGVyYW50OiAwLFxuICBzaW1wbGlmeUNvdW50OiAzMCxcbiAgaGF0Y2hPZmZzZXQ6IDAsXG4gIGltYWdlSW5mbzogbnVsbCxcbiAgbWFzazogbnVsbCxcbiAgZG93blBvaW50OiBudWxsLFxuICBhbGxvd0RyYXc6IGZhbHNlLFxuICBzaGFwZVNlbGVjdGlvblRvb2xzOiBmYWxzZSxcbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKG9wdGlvbnMpIHtcblxuICAgIG9wdGlvbnMuYXBwbGljYXRpb24gJiYgb3B0aW9ucy5hcHBsaWNhdGlvbi5maXJlKCdlbnRpdHk6Y3JlYXRlZCcse3RhcmdldCA6IHRoaXMsb3B0aW9ucyA6IG9wdGlvbnN9KVxuXG4gICAgZm9yICh2YXIgaSBpbiBvcHRpb25zKSB7XG4gICAgICB0aGlzW2ldID0gb3B0aW9uc1tpXTtcbiAgICB9XG4gIH0sXG4gIGFzeW5jcm9ub3VzOiBmdW5jdGlvbiAoY2IpIHtcbiAgICBpZiAodGhpcy5hc3luYykge1xuICAgICAgc2V0VGltZW91dChjYik7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNiKCk7XG4gICAgfVxuICB9LFxuICBmaWxsV2l0aEN1cnJlbnRDb2xvcjogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuZmlsbCh0aGlzLmNvbG9yKTtcbiAgfSxcbiAgY2xlYXJNZW1vcnk6IGZ1bmN0aW9uICgpIHtcbiAgICBkZWxldGUgdGhpcy5yZXN1bHRDYW52YXM7XG4gICAgZGVsZXRlIHRoaXMuZWRpdGVkSW1hZ2VDYW52YXM7XG4gICAgZGVsZXRlIHRoaXMudGVzdF9waWN0dXJlO1xuICAgIGRlbGV0ZSB0aGlzLm1hc2s7XG4gIH0sXG4gIGhpZGU6IGZ1bmN0aW9uICgpIHtcbiAgICBpZiAodGhpcy5lZGl0ZWRJbWFnZUNhbnZhcykge1xuICAgICAgdGhpcy5lZGl0ZWRJbWFnZUNhbnZhcy5yZW1vdmUoKTtcbiAgICAgIHRoaXMucmVzdWx0Q2FudmFzLnJlbW92ZSgpO1xuICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLmludGVydmFsKTtcbiAgICAgIHRoaXMuY2xlYXJNZW1vcnkoKTtcbiAgICAgIHRoaXMuZmlyZSgnaGlkZGVuJyk7XG4gICAgfVxuICB9LFxuICBzZXRDb250YWluZXI6IGZ1bmN0aW9uIChjb250YWluZXIpIHtcbiAgICBpZiAoY29udGFpbmVyLmNvbnN0cnVjdG9yID09PSBTdHJpbmcpIHtcbiAgICAgIGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGNvbnRhaW5lcik7XG4gICAgfVxuICAgIHRoaXMuY29udGFpbmVyID0gY29udGFpbmVyO1xuXG4gICAgdGhpcy50ZXN0X3BpY3R1cmUgPSBuZXcgSW1hZ2UoKTtcbiAgICB0aGlzLnRlc3RfcGljdHVyZS5vbmxvYWQgPSB0aGlzLmluaXRDYW52YXMuYmluZCh0aGlzKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfSxcbiAgZ2V0U2VsZWN0aW9uVG9vbDogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLnNlbGVjdGlvblRvb2w7XG4gIH0sXG4gIHNldFNlbGVjdGlvblRvb2w6IGZ1bmN0aW9uICh0b29sKSB7XG4gICAgdGhpcy5zZWxlY3Rpb25Ub29sID0gdG9vbDtcbiAgICB0aGlzLmRvd25Qb2ludCA9IGZhbHNlIDtcbiAgICB0aGlzLmZpcmUoJ3Rvb2w6Y2hhbmdlZCcsIHRvb2wpO1xuICB9LFxuICBnZXRUaHJlc2hvbGQ6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5jb2xvclRocmVzaG9sZDtcbiAgfSxcbiAgc2V0VGhyZXNob2xkOiBmdW5jdGlvbiAodGhyZXMpIHtcbiAgICBpZih0aHJlcyAhPT0gdW5kZWZpbmVkKXtcbiAgICAgIHRoaXMuY29sb3JUaHJlc2hvbGQgPSB0aHJlcztcbiAgICB9XG4gICAgaWYgKHRoaXMuZG93blBvaW50KSB7XG4gICAgICB0aGlzLmRyYXdNYXNrKHRoaXMuZG93blBvaW50LngsIHRoaXMuZG93blBvaW50LnksIHRoaXMuYWRqYWNlbnRQaXhlbHMpO1xuICAgIH1cbiAgICB0aGlzLmZpcmUoJ3RocmVzaG9sZDpjaGFuZ2VkJywge3RocmVzaG9sZDogdGhpcy5jb2xvclRocmVzaG9sZH0pO1xuICB9LFxuICBzZXRQaWN0dXJlOiBmdW5jdGlvbiAoaW1nKSB7XG4gICAgdGhpcy5zZXRJbWFnZShpbWcpO1xuICAgIHZhciBjdnMgPSBmYWJyaWMudXRpbC5jcmVhdGVDYW52YXNFbGVtZW50KCk7XG5cbiAgICBjdnMub25tb3VzZXVwID0gdGhpcy5vbk1vdXNlVXAuYmluZCh0aGlzKTtcbiAgICBjdnMub25tb3VzZWRvd24gPSB0aGlzLm9uTW91c2VEb3duLmJpbmQodGhpcyk7XG4gICAgY3ZzLm9ubW91c2Vtb3ZlID0gdGhpcy5vbk1vdXNlTW92ZS5iaW5kKHRoaXMpO1xuICAgIGN2cy5vbmNvbnRleHRtZW51ID0gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH07XG4gICAgdGhpcy5pbml0Q2FudmFzKGN2cyk7XG4gIH0sXG4gIGxvYWQ6IGZ1bmN0aW9uIChmaWxlKSB7XG4gICAgaWYgKCFmaWxlKXJldHVybjtcblxuICAgIGlmIChmaWxlLmNvbnN0cnVjdG9yID09PSBTdHJpbmcpIHtcbiAgICAgIFBhdGhmaW5kZXIudGVzdF9waWN0dXJlLnNldEF0dHJpYnV0ZSgnc3JjJyxmaWxlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XG4gICAgICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgdGhpcy50ZXN0X3BpY3R1cmUuc2V0QXR0cmlidXRlKCdzcmMnLCBlLnRhcmdldC5yZXN1bHQpO1xuICAgICAgfS5iaW5kKHRoaXMpO1xuICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSk7XG4gICAgfVxuICB9LFxuICBpbml0Q2FudmFzOiBmdW5jdGlvbiAoY3ZzKSB7XG4gICAgdmFyIGltZyA9IHRoaXMuZWRpdGVkSW1hZ2VDYW52YXM7XG4gICAgaWYodGhpcy5yZXN1bHRDYW52YXMpe1xuICAgICAgJCh0aGlzLnJlc3VsdENhbnZhcykucmVtb3ZlKClcbiAgICB9XG4gICAgdGhpcy5yZXN1bHRDYW52YXMgPSBjdnM7XG4gICAgdGhpcy5jcmVhdGVTZWxlY3Rpb25EcmF3Q2FudmFzKCk7XG5cblxuICAgIHRoaXMuY29udGV4dCA9IGN2cy5nZXRDb250ZXh0KCcyZCcpO1xuICAgIGN2cy53aWR0aCA9IGltZy53aWR0aDtcbiAgICBjdnMuaGVpZ2h0ID0gaW1nLmhlaWdodDtcbiAgICAvL3RoaXMuc2V0SW1hZ2UoaW1nKTtcbiAgfSxcbiAgc2V0SW1hZ2U6IGZ1bmN0aW9uIChpbWcpIHtcbiAgICB0aGlzLl90ZXN0X3RvZG9faW1nID0gaW1nO1xuICAgIC8vdGhpcy5tYXNrID0gbnVsbDsvL01hZ2ljV2FuZC5jcmVhdGVNYXNrKGltZy53aWR0aCxpbWcuaGVpZ2h0KTtcbiAgICB0aGlzLmVkaXRlZEltYWdlQ2FudmFzID0gZmFicmljLnV0aWwuY3JlYXRlQ2FudmFzRWxlbWVudCgpO1xuICAgIHRoaXMuZWRpdGVkSW1hZ2VDYW52YXMud2lkdGggPSBpbWcud2lkdGg7XG4gICAgdGhpcy5lZGl0ZWRJbWFnZUNhbnZhcy5oZWlnaHQgPSBpbWcuaGVpZ2h0O1xuICAgIHRoaXMuZWRpdGVkSW1hZ2VDYW52YXMuZ2V0Q29udGV4dCgnMmQnKS5kcmF3SW1hZ2UoaW1nLCAwLCAwKTtcbiAgICB0aGlzLmluaXRDYW52YXMoZmFicmljLnV0aWwuY3JlYXRlQ2FudmFzRWxlbWVudCgpKVxuICB9LFxuICBnZXRJbmZvOiBmdW5jdGlvbiAoKSB7XG5cbiAgICB2YXIgY3R4ID0gdGhpcy5lZGl0ZWRJbWFnZUNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xuICAgIHZhciBpbWFnZUluZm8gPSBjdHguZ2V0SW1hZ2VEYXRhKDAsIDAsIHRoaXMuZWRpdGVkSW1hZ2VDYW52YXMud2lkdGgsIHRoaXMuZWRpdGVkSW1hZ2VDYW52YXMuaGVpZ2h0KTtcbiAgICBpbWFnZUluZm8uYnl0ZXMgPSA0O1xuICAgIHJldHVybiBpbWFnZUluZm87XG4gIH0sXG4gIGdldE1vdXNlUG9zaXRpb246IGZ1bmN0aW9uIChlKSB7XG4gICAgdmFyIHNjYWxlID0gdGhpcy5yZXN1bHRDYW52YXMud2lkdGggLyAkKHRoaXMucmVzdWx0Q2FudmFzKS53aWR0aCgpO1xuICAgIHZhciB0YXJnZXQgPSBlLnRhcmdldCB8fCBlLnNyY0VsZW1lbnQsXG4gICAgICByZWN0ID0gdGFyZ2V0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLFxuICAgICAgb2Zmc2V0WCA9IGUuY2xpZW50WCAtIHJlY3QubGVmdCxcbiAgICAgIG9mZnNldFkgPSBlLmNsaWVudFkgLSByZWN0LnRvcDtcbiAgICByZXR1cm4ge3g6IE1hdGgucm91bmQob2Zmc2V0WCAqIHNjYWxlKSwgeTogTWF0aC5yb3VuZChvZmZzZXRZICogc2NhbGUpfTtcbiAgfSxcbiAgcmFkaXVzOiAyMCxcbiAgcmVzZXRTZWxlY3Rpb25EcmF3Q2FudmFzOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5zZWxlY3Rpb25EcmF3Q29udGV4dC5maWxsU3R5bGUgPSBcImJsYWNrXCI7XG4gICAgLy90aGlzLnNlbGVjdGlvbkRyYXdDb250ZXh0KDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7XG4gICAgdGhpcy5zZWxlY3Rpb25EcmF3Q29udGV4dC5maWxsUmVjdCgwLDAsdGhpcy5zZWxlY3Rpb25EcmF3Q2FudmFzLndpZHRoLHRoaXMuc2VsZWN0aW9uRHJhd0NhbnZhcy5oZWlnaHQpO1xuICAgIHRoaXMuc2VsZWN0aW9uRHJhd0NvbnRleHQuZmlsbFN0eWxlID0gXCJ3aGl0ZVwiO1xuICAgIHRoaXMuc2VsZWN0aW9uRHJhd0NvbnRleHQuc3Ryb2tlU3R5bGUgPSBcIndoaXRlXCI7XG4gIH0sXG4gIGNyZWF0ZVNlbGVjdGlvbkRyYXdDYW52YXM6IGZ1bmN0aW9uICgpIHtcblxuICAgIGlmKHRoaXMuc2VsZWN0aW9uRHJhd0NhbnZhcyApe1xuICAgICAgJCh0aGlzLnNlbGVjdGlvbkRyYXdDYW52YXMgKS5yZW1vdmUoKTtcbiAgICB9XG4gICAgdGhpcy5zZWxlY3Rpb25EcmF3Q2FudmFzID0gZmFicmljLnV0aWwuY3JlYXRlQ2FudmFzRWxlbWVudCgpO1xuICAgIHRoaXMuc2VsZWN0aW9uRHJhd0NhbnZhcy53aWR0aCAgPSB0aGlzLnJlc3VsdENhbnZhcy53aWR0aDtcbiAgICB0aGlzLnNlbGVjdGlvbkRyYXdDYW52YXMuaGVpZ2h0ID0gdGhpcy5yZXN1bHRDYW52YXMuaGVpZ2h0O1xuICAgIHRoaXMuc2VsZWN0aW9uRHJhd0NvbnRleHQgPSB0aGlzLnNlbGVjdGlvbkRyYXdDYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpO1xuICAgIHRoaXMucmVzZXRTZWxlY3Rpb25EcmF3Q2FudmFzKCk7XG4gIH0sXG4gIF9vbk1vdXNlRG93bjogZnVuY3Rpb24gKHBvaW50KSB7XG4gICAgcG9pbnQueCA9IE1hdGgubWluKE1hdGgubWF4KDAsIHBhcnNlSW50KHBvaW50LngpKSwgdGhpcy5yZXN1bHRDYW52YXMud2lkdGggLSAxKTtcbiAgICBwb2ludC55ID0gTWF0aC5taW4oTWF0aC5tYXgoMCwgcGFyc2VJbnQocG9pbnQueSkpLCB0aGlzLnJlc3VsdENhbnZhcy5oZWlnaHQgLSAxKTtcbiAgICB0aGlzLmFsbG93RHJhdyA9IHRydWU7XG4gICAgdGhpcy5kcmF3aW5nVG9vbHNbdGhpcy5zZWxlY3Rpb25Ub29sXS5tb3VzZURvd24uY2FsbCh0aGlzLHBvaW50KTtcbiAgfSxcbiAgb25Nb3VzZURvd246IGZ1bmN0aW9uIChlKSB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgdGhpcy5fb25Nb3VzZURvd24odGhpcy5nZXRNb3VzZVBvc2l0aW9uKGUpKTtcblxuICB9LFxuICBfb25Nb3VzZU1vdmU6IGZ1bmN0aW9uIChwKSB7XG4gICAgcC54ID0gTWF0aC5taW4oTWF0aC5tYXgoMCwgcGFyc2VJbnQocC54KSksIHRoaXMucmVzdWx0Q2FudmFzLndpZHRoIC0gMSk7XG4gICAgcC55ID0gTWF0aC5taW4oTWF0aC5tYXgoMCwgcGFyc2VJbnQocC55KSksIHRoaXMucmVzdWx0Q2FudmFzLmhlaWdodCAtIDEpO1xuICAgIHRoaXMuZHJhd2luZ1Rvb2xzW3RoaXMuc2VsZWN0aW9uVG9vbF0ubW91c2VNb3ZlLmNhbGwodGhpcyxwKTtcbiAgfSxcbiAgb25Nb3VzZU1vdmU6IGZ1bmN0aW9uIChlKSB7XG4gICAgdmFyIHAgPSB0aGlzLmdldE1vdXNlUG9zaXRpb24oZSk7XG4gICAgdGhpcy5fb25Nb3VzZU1vdmUocCk7XG4gIH0sXG4gIGNvbG9yOiBbMjU1LCAwLCAwLCAyNTVdLFxuICBvbk1vdXNlVXA6IGZ1bmN0aW9uIChlKSB7XG4gICAgdGhpcy5hbGxvd0RyYXcgPSBmYWxzZTtcbiAgICB0aGlzLmRyYXdpbmdUb29sc1t0aGlzLnNlbGVjdGlvblRvb2xdLm1vdXNlVXAuY2FsbCh0aGlzLGUpO1xuICB9LFxuICBhcHBseU1hc2s6IGZ1bmN0aW9uIChjYW52YXMsIGxlZnQsIHRvcCkge1xuICAgIGlmIChjYW52YXMud2lkdGggPT09IDAgfHwgY2FudmFzLmhlaWdodCA9PT0gMCkge1xuICAgICAgZGVsZXRlIHRoaXMubWFzaztcbiAgICAgIHRoaXMucmVuZGVyKCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHZhciBpbmZvID0gdGhpcy5nZXRJbmZvKCksXG4gICAgICBtYXNrID0gTWFnaWNXYW5kLm1hc2tTZWxlY3Rpb24oY2FudmFzLGxlZnQsdG9wKSA7XG5cbiAgICB0aGlzLm1hc2sgPSBtYXNrO1xuICAgIHRoaXMuZmlyZSgnc2VsZWN0aW9uOmNoYW5nZWQnLCB7bWFzazogbWFzaywgdGFyZ2V0OiB0aGlzLnRhcmdldH0pO1xuICB9LFxuICBzZXRQYXRoZmluZGVyTW9kZTogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgdGhpcy5wYXRoZmluZGVyTW9kZSA9IHZhbHVlO1xuICB9LFxuICBnZXRQYXRoZmluZGVyTW9kZTogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLnBhdGhmaW5kZXJNb2RlO1xuICB9LFxuICBtb2RpZnlTZWxlY3Rpb246IGZ1bmN0aW9uIChtYXNrLCBwYXRoZmluZGVyTW9kZSwgbm9FdmVudHMpIHtcbiAgICB0aGlzLnNob3VsZE1vZGlmeSA9IGZhbHNlO1xuICAgIGlmKHRoaXMuc2VsZWN0aW9uT2JqZWN0KXtcbiAgICAgIHRoaXMuc2VsZWN0aW9uT2JqZWN0LnJlbW92ZSgpO1xuICAgIH1cbiAgICB0aGlzLmRvd25Qb2ludCA9IGZhbHNlO1xuICAgIGlmIChtYXNrID09PSB1bmRlZmluZWQpIHtcbiAgICAgIG1hc2sgPSB0aGlzLm1hc2s7XG4gICAgfVxuICAgIGlmIChwYXRoZmluZGVyTW9kZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICBwYXRoZmluZGVyTW9kZSA9IHRoaXMucGF0aGZpbmRlck1vZGU7XG4gICAgfVxuICAgIGlmIChwYXRoZmluZGVyTW9kZSAhPT0gJ25ldycgJiYgdGhpcy5vbGRNYXNrKSB7XG4gICAgICBtYXNrID0gTWFnaWNXYW5kW3BhdGhmaW5kZXJNb2RlXShtYXNrLCB0aGlzLm9sZE1hc2spO1xuICAgIH1cbiAgICBpZiAodGhpcy5ibHVyUmFkaXVzKSB7XG4gICAgICBtYXNrID0gTWFnaWNXYW5kLmdhdXNzQmx1ck9ubHlCb3JkZXIobWFzaywgdGhpcy5ibHVyUmFkaXVzKTtcbiAgICB9XG4gICAgLy9pZiAocGF0aGZpbmRlck1vZGUgIT09ICduZXcnICYmIHRoaXMub2xkTWFzayB8fCB0aGlzLmJsdXJSYWRpdXMpIHtcbiAgICAvLyAgbWFzay5jYWNoZUluZCA9IE1hZ2ljV2FuZC5nZXRCb3JkZXJJbmRpY2VzKG1hc2spO1xuICAgIC8vfVxuXG4gICAgaWYobWFzayAmJiBtYXNrLmNvdW50ICYmIHRoaXMua2VlcE9sZFNlbGVjdGlvbil7XG4gICAgICBtYXNrLm1ha2VDYWNoZSgpO1xuICAgICAgdGhpcy5vbGRNYXNrID0gbWFzaztcbiAgICB9ZWxzZXtcbiAgICAgIGRlbGV0ZSB0aGlzLm9sZE1hc2sgO1xuICAgIH1cblxuXG4gICAgdGhpcy5tYXNrID0gTWFnaWNXYW5kLmNyZWF0ZU1hc2sodGhpcy5lZGl0ZWRJbWFnZUNhbnZhcy53aWR0aCwgdGhpcy5lZGl0ZWRJbWFnZUNhbnZhcy5oZWlnaHQpO1xuICAgIGlmICghbm9FdmVudHMpIHtcbiAgICAgIHRoaXMuZmlyZSgnc2VsZWN0aW9uOmNoYW5nZWQnLCB7bWFzazogbWFzaywgdGFyZ2V0OiB0aGlzLnRhcmdldH0pO1xuICAgIH1cbiAgICB0aGlzLnJlbmRlcigpO1xuICB9LFxuICBjcmVhdGVTZWxlY3Rpb246IGZ1bmN0aW9uIChtYXNrKSB7XG4gICAgaWYgKHRoaXMuc2hvdWxkTW9kaWZ5KSB7XG4gICAgICB0aGlzLm1vZGlmeVNlbGVjdGlvbigpO1xuICAgIH1cblxuICAgIHRoaXMubWFzayA9IG1hc2sgfHwgTWFnaWNXYW5kLmNyZWF0ZU1hc2sodGhpcy5lZGl0ZWRJbWFnZUNhbnZhcy53aWR0aCwgdGhpcy5lZGl0ZWRJbWFnZUNhbnZhcy5oZWlnaHQpO1xuICAgIHRoaXMucmVuZGVyKCk7XG4gIH0sXG4gIHNldFNlbGVjdGlvbjogZnVuY3Rpb24gKG1hc2spIHtcbiAgICB0aGlzLm1hc2sgPSBtYXNrO1xuICAgIHRoaXMucmVuZGVyKCk7XG4gICAgdGhpcy5maXJlKCdzZWxlY3Rpb246Y2hhbmdlZCcsIHttYXNrOiBtYXNrLCB0YXJnZXQ6IHRoaXMudGFyZ2V0fSk7XG4gIH0sXG4gIGZpbGw6IGZ1bmN0aW9uIChjb2xvciwgY2FsbGJhY2spIHtcbiAgICB0aGlzLmFzeW5jcm9ub3VzKGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuX2ZpbGwoY29sb3IsIGZhbHNlKTtcbiAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrLmNhbGwodGhpcyk7XG4gICAgfS5iaW5kKHRoaXMpLCAwKTtcbiAgfSxcbiAgX2ZpbGw6IGZ1bmN0aW9uIChjb2xvciwgaW52ZXJ0LCBjYW52YXMpIHtcblxuXG4gICAgaWYgKCF0aGlzLm1hc2spIHJldHVybjtcblxuXG4gICAgY2FudmFzID0gY2FudmFzIHx8IHRoaXMuZWRpdGVkSW1hZ2VDYW52YXM7XG4gICAgdmFyIGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpOy8vYi5taW5YLCBiLm1pblksIGIubWF4WCAtIGIubWluWCwgYi5tYXhZIC0gYi5taW5ZKTtcblxuICAgIE1hZ2ljV2FuZC5maWxsTWFzayhjdHgsIHRoaXMubWFzaywgY29sb3IpO1xuXG4gICAgdGhpcy5maXJlKCdpbWFnZTpjaGFuZ2VkJywgdGhpcy5lZGl0ZWRJbWFnZUNhbnZhcyk7XG4gIH0sXG4gIGhhdGNoVGljazogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuaGF0Y2hPZmZzZXQgPSAodGhpcy5oYXRjaE9mZnNldCArIDEpICUgKHRoaXMuaGF0Y2hMZW5ndGggKiAyKTtcbiAgICB0aGlzLnJlbmRlcih0cnVlKTtcbiAgfSxcbiAgc2hvdzogZnVuY3Rpb24gKCkge1xuICAgIHdoaWxlICh0aGlzLmNvbnRhaW5lci5sYXN0Q2hpbGQpIHtcbiAgICAgIHRoaXMuY29udGFpbmVyLnJlbW92ZUNoaWxkKHRoaXMuY29udGFpbmVyLmxhc3RDaGlsZCk7XG4gICAgfVxuICAgIHRoaXMuY29udGFpbmVyLmFwcGVuZENoaWxkKHRoaXMuZWRpdGVkSW1hZ2VDYW52YXMpO1xuICAgIHRoaXMuY29udGFpbmVyLmFwcGVuZENoaWxkKHRoaXMucmVzdWx0Q2FudmFzKTtcbiAgICB0aGlzLmludGVydmFsID0gc2V0SW50ZXJ2YWwodGhpcy5oYXRjaFRpY2suYmluZCh0aGlzKSwgMzAwKTtcblxuICAgIHRoaXMuZmlyZSgnc2hvdycpO1xuICB9LFxuICBjbGVhcjogZnVuY3Rpb24gKGludmVydCwgY2FudmFzLCBjYWxsYmFjaykge1xuICAgIHRoaXMuYXN5bmNyb25vdXMoZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5fZmlsbChbMCwgMCwgMCwgMF0sIGludmVydCwgY2FudmFzKTtcbiAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrLmNhbGwodGhpcyk7XG4gICAgfS5iaW5kKHRoaXMpLCAwKTtcbiAgfSxcbiAgcmVuZGVyOiBmdW5jdGlvbiAobm9Cb3JkZXIpIHtcbiAgICBpZiAoIXRoaXMuY29udGV4dCB8fCAhdGhpcy5tYXNrKXJldHVybjtcblxuICAgIHZhciBjdHggPSB0aGlzLmNvbnRleHQ7XG4gICAgaWYgKCFub0JvcmRlcikge1xuICAgICAgdGhpcy5tYXNrLmNhY2hlSW5kID0gTWFnaWNXYW5kLmdldEJvcmRlckluZGljZXModGhpcy5tYXNrKTtcbiAgICB9XG4gICAgY3R4LmNsZWFyUmVjdCgwLCAwLCB0aGlzLm1hc2sud2lkdGgsIHRoaXMubWFzay5oZWlnaHQpO1xuXG4gICAgdmFyIF9uZXdfY29sb3IgPSAoIXRoaXMub2xkTWFzayB8fCB0aGlzLnBhdGhmaW5kZXJNb2RlID09IFwibmV3XCIgfHwgdGhpcy5wYXRoZmluZGVyTW9kZSA9PSBcImFkZFwifHwgdGhpcy5wYXRoZmluZGVyTW9kZSA9PSBcImV4Y2x1ZGVcIilcbiAgICAgID8gdGhpcy5uZXdNYXNrQ29sb3IgOiB0aGlzLnJlbW92ZWRNYXNrQ29sb3I7XG5cbiAgICB2YXIgX2ludGVyc2VjdGlvbl9jb2xvcjtcbiAgICBpZih0aGlzLnBhdGhmaW5kZXJNb2RlID09IFwiYWRkXCIgfHwgdGhpcy5wYXRoZmluZGVyTW9kZSA9PSBcIm5ld1wifHwgdGhpcy5wYXRoZmluZGVyTW9kZSA9PSBcImludGVyc2VjdFwiKXtcbiAgICAgIF9pbnRlcnNlY3Rpb25fY29sb3IgPSB0aGlzLm5ld01hc2tDb2xvcjtcbiAgICB9ZWxzZXtcbiAgICAgIF9pbnRlcnNlY3Rpb25fY29sb3IgPSB0aGlzLnJlbW92ZWRNYXNrQ29sb3IgOy8vaW50ZXJzZWN0aW9uUmVtb3ZlZE1hc2tDb2xvcjtcbiAgICB9XG4gICAgdmFyIF9vbGRfY29sb3I7XG4gICAgaWYodGhpcy5wYXRoZmluZGVyTW9kZSA9PSBcImV4Y2x1ZGVcIiB8fCB0aGlzLnBhdGhmaW5kZXJNb2RlID09IFwic3Vic3RyYWN0XCJ8fCB0aGlzLnBhdGhmaW5kZXJNb2RlID09IFwiYWRkXCIpe1xuICAgICAgX29sZF9jb2xvciA9IHRoaXMubmV3TWFza0NvbG9yO1xuICAgIH1lbHNle1xuICAgICAgX29sZF9jb2xvciA9IHRoaXMucmVtb3ZlZE1hc2tDb2xvcjtcbiAgICB9XG5cbiAgICB0aGlzLm9sZE1hc2sgJiYgdGhpcy5vbGRNYXNrLnJlbmRlcihjdHgse1xuICAgICAgZmlsbDogX29sZF9jb2xvclxuICAgIH0pO1xuXG5cbiAgICB0aGlzLm1hc2sucmVuZGVyKGN0eCx7XG4gICAgICBmaWxsOiBfbmV3X2NvbG9yLFxuICAgICAgaW50ZXJzZWN0aW9uQ29sb3IgOiBfaW50ZXJzZWN0aW9uX2NvbG9yLFxuICAgICAgb3V0ZXJJbnRlcnNlY3Rpb25Db2xvciA6IF9vbGRfY29sb3IsXG4gICAgICAvLyBvdXRlckZpbGwgOiBcInJnYmEoMCwwLDAsMC41KVwiXG4gICAgfSk7XG5cbiAgICBpZih0aGlzLnJlbmRlckJvcmRlcil7XG4gICAgICB0aGlzLm9sZE1hc2sgJiYgdGhpcy5vbGRNYXNrLnJlbmRlckJvcmRlcihjdHgse30pO1xuXG4gICAgICB0aGlzLm1hc2sucmVuZGVyQm9yZGVyKGN0eCx7XG4gICAgICAgIGhhdGNoT2Zmc2V0OiB0aGlzLmhhdGNoT2Zmc2V0XG4gICAgICB9KTtcbiAgICB9XG5cbiAgfSxcbiAgcmVuZGVyQm9yZGVyOiB0cnVlLFxuICBpbnRlcnNlY3Rpb25SZW1vdmVkTWFza0NvbG9yOiAnI2ZmYWFhYScsXG4gIHJlbW92ZWRNYXNrQ29sb3I6ICcjYWFhYWZmJyxcbiAgbmV3TWFza0NvbG9yOiAgJyNhYUZGYWEnICxcbiAgcmVuZGVyTWFzazogZnVuY3Rpb24gKGN0eCwgbWFzaywgY29sb3IsIGxlZnQsIHRvcCkge1xuICAgIG1hc2sgPSBtYXNrIHx8IHRoaXMubWFzaztcbiAgICBtYXNrICYmIG1hc2sucmVuZGVyKGN0eCx7XG4gICAgICBpbnRlcnNlY3Rpb25Db2xvcjogJyNmZmYnLFxuICAgICAgb3V0ZXJJbnRlcnNlY3Rpb25Db2xvcjogJyMwMDAnLFxuICAgICAgZmlsbCA6Y29sb3IgfHwgJyNmZmYnLFxuICAgICAgbGVmdCA6IGxlZnQsXG4gICAgICB0b3AgOiB0b3BcbiAgICB9KVxuICB9LFxuICBnZXRDb250b3VyczogZnVuY3Rpb24gKCkge1xuICAgIGlmICghdGhpcy5fX2NzKSB7XG4gICAgICB0aGlzLl9fY3MgPSBNYWdpY1dhbmQudHJhY2VDb250b3Vycyh0aGlzLm1hc2spO1xuICAgICAgdGhpcy5fX2NzID0gTWFnaWNXYW5kLnNpbXBsaWZ5Q29udG91cnModGhpcy5fX2NzLCB0aGlzLnNpbXBsaWZ5VG9sZXJhbnQsIHRoaXMuc2ltcGxpZnlDb3VudCk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLl9fY3M7XG4gIH0sXG4gIHRyYWNlSW5uZXI6IGZ1bmN0aW9uIChjdHgpIHtcblxuICAgIHZhciBjcyA9IHRoaXMuZ2V0Q29udG91cnMoKTtcbiAgICB2YXIgY3R4ID0gY3R4IHx8IHRoaXMuY29udGV4dDtcbiAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjcy5sZW5ndGg7IGkrKykge1xuICAgICAgaWYgKCFjc1tpXS5pbm5lcikgY29udGludWU7XG4gICAgICB2YXIgcHMgPSBjc1tpXS5wb2ludHM7XG4gICAgICBjdHgubW92ZVRvKHBzWzBdLngsIHBzWzBdLnkpO1xuICAgICAgZm9yICh2YXIgaiA9IDE7IGogPCBwcy5sZW5ndGg7IGorKykge1xuICAgICAgICBjdHgubGluZVRvKHBzW2pdLngsIHBzW2pdLnkpO1xuICAgICAgfVxuICAgIH1cbiAgICBjdHguc3Ryb2tlKCk7XG4gIH0sXG4gIGdldENvbG9yOiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuICdyZ2JhKCcgKyB0aGlzLmNvbG9yLmpvaW4oJywgJykgKyAnKSc7XG4gIH0sXG4gIHNldENvbG9yOiBmdW5jdGlvbiAoY29sb3IpIHtcbiAgICB2YXIgX2FyciA9IGNvbG9yLnN1YnN0cmluZyhjb2xvci5pbmRleE9mKCcoJykgKyAxLCBjb2xvci5sZW5ndGggLSAxKS5zcGxpdCgnLCAnKTtcbiAgICBmb3IgKHZhciBpIGluIF9hcnIpIHtcbiAgICAgIF9hcnJbaV0gPSBwYXJzZUZsb2F0KF9hcnJbaV0pO1xuICAgIH1cbiAgICBfYXJyWzNdID0gTWF0aC5yb3VuZChfYXJyWzNdICogMjU1KTtcbiAgICB0aGlzLmNvbG9yID0gX2FycjtcbiAgfSxcbiAgdHJhY2U6IGZ1bmN0aW9uIChjdHgpIHtcbiAgICB2YXIgaW5mbyA9IHRoaXMuZ2V0SW5mbygpO1xuICAgIHZhciBjcyA9IE1hZ2ljV2FuZC50cmFjZUNvbnRvdXJzKHRoaXMubWFzayk7XG4gICAgY3MgPSBNYWdpY1dhbmQuc2ltcGxpZnlDb250b3VycyhjcywgdGhpcy5zaW1wbGlmeVRvbGVyYW50LCB0aGlzLnNpbXBsaWZ5Q291bnQpO1xuXG4gICAgLy8gZHJhdyBjb250b3Vyc1xuICAgIHZhciBjdHggPSBjdHggfHwgdGhpcy5jb250ZXh0O1xuICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgaW5mby53aWR0aCwgaW5mby5oZWlnaHQpO1xuICAgIC8vaW5uZXJcbiAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjcy5sZW5ndGg7IGkrKykge1xuICAgICAgaWYgKCFjc1tpXS5pbm5lcikgY29udGludWU7XG4gICAgICB2YXIgcHMgPSBjc1tpXS5wb2ludHM7XG4gICAgICBjdHgubW92ZVRvKHBzWzBdLngsIHBzWzBdLnkpO1xuICAgICAgZm9yICh2YXIgaiA9IDE7IGogPCBwcy5sZW5ndGg7IGorKykge1xuICAgICAgICBjdHgubGluZVRvKHBzW2pdLngsIHBzW2pdLnkpO1xuICAgICAgfVxuICAgIH1cbiAgICBjdHguc3Ryb2tlU3R5bGUgPSAncmVkJztcbiAgICBjdHguc3Ryb2tlKCk7XG4gICAgLy9vdXRlclxuICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAoY3NbaV0uaW5uZXIpIGNvbnRpbnVlO1xuICAgICAgdmFyIHBzID0gY3NbaV0ucG9pbnRzO1xuICAgICAgY3R4Lm1vdmVUbyhwc1swXS54LCBwc1swXS55KTtcbiAgICAgIGZvciAodmFyIGogPSAxOyBqIDwgcHMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgY3R4LmxpbmVUbyhwc1tqXS54LCBwc1tqXS55KTtcbiAgICAgIH1cbiAgICB9XG4gICAgY3R4LnN0cm9rZVN0eWxlID0gJ2JsdWUnO1xuICAgIGN0eC5zdHJva2UoKTtcbiAgfSxcbiAgcmVtb3ZlTm9pc2U6IGZ1bmN0aW9uICh0aHJlc2hvbGQpIHtcblxuICAgIGlmKCF0aGlzLm1hc2sgfHwgIXRoaXMubWFzay5jb3VudClyZXR1cm47XG4gICAgdGhpcy5jcmVhdGVTZWxlY3Rpb25EcmF3Q2FudmFzKCk7XG4gICAgLy90aGlzLnJlbmRlck1hc2sodGhpcy5zZWxlY3Rpb25EcmF3Q29udGV4dCwgdGhpcy5tYXNrKTtcblxuICAgIHZhciBjcyA9IE1hZ2ljV2FuZC50cmFjZUNvbnRvdXJzKHRoaXMubWFzayk7XG4gICAgY3MgPSBNYWdpY1dhbmQuc2ltcGxpZnlDb250b3VycyhjcywgdGhpcy5zaW1wbGlmeVRvbGVyYW50LCB0aGlzLnNpbXBsaWZ5Q291bnQpO1xuXG4gICAgdmFyIGN0eCA9IHRoaXMuc2VsZWN0aW9uRHJhd0NvbnRleHQsIHYgPSB0aGlzLmNhbnZhcy52aWV3cG9ydFRyYW5zZm9ybTtcblxuICAgIC8vICBjcyA9IE1hZ2ljV2FuZC5zaW1wbGlmeUNvbnRvdXJzKGNzLCB0aGlzLnNpbXBsaWZ5VG9sZXJhbnQsIHRoaXMuc2ltcGxpZnlDb3VudCk7XG5cbiAgICBjdHguc2F2ZSgpO1xuICAgIGN0eC50cmFuc2xhdGUoMC41LDAuNSk7XG4gICAgY3R4LmZpbGxTdHlsZT0gXCIjZmZmXCI7XG4gICAgLy9jdHguZmlsbFN0eWxlPSBcIiMwZjBcIjtcbiAgICBjdHguc3Ryb2tlU3R5bGU9IFwiI2ZmZlwiO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY3MubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmICghY3NbaV0uaW5uZXIgJiYgY3NbaV0ucG9pbnRzLmxlbmd0aCA+IHRocmVzaG9sZCkge1xuICAgICAgICB2YXIgcHMgPSBjc1tpXS5wb2ludHM7XG4gICAgICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICAgICAgY3R4Lm1vdmVUbyhwc1swXS54LCBwc1swXS55KTtcbiAgICAgICAgZm9yICh2YXIgaiA9IDE7IGogPCBwcy5sZW5ndGg7IGorKykge1xuICAgICAgICAgIGN0eC5saW5lVG8ocHNbal0ueCwgcHNbal0ueSk7XG4gICAgICAgIH1cbiAgICAgICAgY3R4LmNsb3NlUGF0aCgpO1xuICAgICAgICBjdHguZmlsbCgpO1xuICAgICAgfVxuXG4gICAgfVxuICAgIHRoaXMubWFzayA9IE1hZ2ljV2FuZC5tYXNrU2VsZWN0aW9uKCB0aGlzLnNlbGVjdGlvbkRyYXdDYW52YXMpO1xuICAgIHRoaXMuc2V0U2VsZWN0aW9uKHRoaXMubWFzayk7XG5cbiAgICBjdHgucmVzdG9yZSgpO1xuICB9LFxuXG4gIHRvb2xzOiBbXG4gICAgXCJhZGphY2VudFBpeGVsc1wiLFxuICAgIFwicGF0aGZpbmRlclJhZGl1c1wiLFxuICAgIFwicGF0aGZpbmRlclRocmVzaG9sZFwiLFxuICAgIFwic2VsZWN0aW9uVG9vbFwiLFxuICAgIFwicGF0aGZpbmRlclwiLFxuICAgIFwiZmlsbFdpdGhDdXJyZW50Q29sb3JcIixcbiAgICBcImNsZWFyXCIsXG4gICAgXCJwYXRoZmluZGVyQ29sb3JcIlxuICBdLFxuICBhY3Rpb25zIDoge1xuXG4gICAgY2FuY2VsU2VsZWN0aW9uOiB7XG4gICAgICB2aXNpYmxlOiBmYWxzZSxcbiAgICAgIGtleTogICdFc2NhcGUnLFxuICAgICAgYWN0aW9uOiBmdW5jdGlvbigpe1xuICAgICAgICBkZWxldGUgdGhpcy5zaG91bGRNb2RpZnk7XG4gICAgICAgIHRoaXMubWFzayA9IE1hZ2ljV2FuZC5jcmVhdGVNYXNrKHRoaXMuZWRpdGVkSW1hZ2VDYW52YXMud2lkdGgsIHRoaXMuZWRpdGVkSW1hZ2VDYW52YXMuaGVpZ2h0KTtcbiAgICAgIH1cbiAgICB9LFxuICAgIG1vZGlmeVNlbGVjdGlvbjoge1xuICAgICAgdmlzaWJsZTogZmFsc2UsXG4gICAgICBrZXk6ICAnRW50ZXInLFxuICAgICAgYWN0aW9uOiBmdW5jdGlvbigpe1xuICAgICAgICBpZih0aGlzLnNob3VsZE1vZGlmeSl7XG4gICAgICAgICAgdGhpcy5tb2RpZnlTZWxlY3Rpb24oKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG4gICAgYWRqYWNlbnRQaXhlbHM6IHtcbiAgICAgIGNsYXNzTmFtZTogJ2J1dHRvbi1hZGphY2VudCcsXG4gICAgICB0aXRsZTogJ3NlbGV0IGFsbCcsXG4gICAgICB0eXBlOiAnY2hlY2tib3gnLFxuICAgICAgdmFsdWU6ICdhZGphY2VudFBpeGVscycsXG4gICAgICB2aXNpYmxlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGlvblRvb2wgPT09ICdtYWdpYyc7XG4gICAgICB9LFxuICAgICAgb2JzZXJ2ZTogJ3Rvb2w6Y2hhbmdlZCdcbiAgICB9LFxuICAgIHBhdGhmaW5kZXJSYWRpdXM6IHtcbiAgICAgIHRpdGxlOiAncmFkaXVzJyxcbiAgICAgIHR5cGU6ICdyYW5nZScsXG4gICAgICB2YWx1ZToge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5yYWRpdXNcbiAgICAgICAgfSxcbiAgICAgICAgc2V0OiBmdW5jdGlvbiAodmFsKSB7XG4gICAgICAgICAgdGhpcy5yYWRpdXMgPSB2YWw7XG4gICAgICAgIH0sXG4gICAgICAgIG1pbjogMSxcbiAgICAgICAgbWF4OiAyNTVcbiAgICAgIH0sXG4gICAgICB2aXNpYmxlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGlvblRvb2wgPT09ICdicnVzaCc7XG4gICAgICB9LFxuICAgICAgb2JzZXJ2ZTogJ3Rvb2w6Y2hhbmdlZCdcbiAgICB9LFxuICAgIHBhdGhmaW5kZXJUaHJlc2hvbGQ6IHtcbiAgICAgIHRpdGxlOiAnVGhyZXNob2xkJyxcbiAgICAgIHR5cGU6ICdyYW5nZScsXG4gICAgICB2YWx1ZToge1xuICAgICAgICBvYnNlcnZlOiAndGhyZXNob2xkOmNoYW5nZWQnLFxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5jb2xvclRocmVzaG9sZFxuICAgICAgICB9LFxuICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2YWwpIHtcbiAgICAgICAgICB0aGlzLnNldFRocmVzaG9sZCh2YWwpO1xuICAgICAgICB9LFxuICAgICAgICBtaW46IDAsXG4gICAgICAgIG1heDogMjU1XG4gICAgICB9LFxuICAgICAgdmlzaWJsZTogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zZWxlY3Rpb25Ub29sID09PSAnbWFnaWMnO1xuICAgICAgfSxcbiAgICAgIG9ic2VydmU6ICd0b29sOmNoYW5nZWQnXG4gICAgfSxcbiAgICBzZWxlY3Rpb25Ub29sOiB7XG4gICAgICB0aXRsZTogJ3NlbGVjdGlvbi10b29sJyxcbiAgICAgIHR5cGU6ICdvcHRpb25zJyxcbiAgICAgIHZhbHVlOiAnc2VsZWN0aW9uVG9vbCcsXG4gICAgICBtZW51OiB7XG4gICAgICAgIHNlbGVjdGlvblRvb2xCcnVzaDoge1xuICAgICAgICAgIGNsYXNzTmFtZTogJ2ZhIGZhLXBhaW50LWJydXNoJyxcbiAgICAgICAgICB0aXRsZTogJ3NlbGVjdC1icnVzaCcsXG4gICAgICAgICAgb3B0aW9uOiAnYnJ1c2gnXG4gICAgICAgIH0sXG4gICAgICAgIHNlbGVjdGlvblRvb2xSZWN0YW5nbGU6IHtcbiAgICAgICAgICBjbGFzc05hbWU6ICdmYSBmYS1zcXVhcmUnLFxuICAgICAgICAgIHRpdGxlOiAnc2VsZWN0LXJlY3RhbmdsZScsXG4gICAgICAgICAgb3B0aW9uOiAncmVjdGFuZ2xlJ1xuICAgICAgICB9LFxuICAgICAgICBzZWxlY3Rpb25FbGxpcHRpY2FsOiB7XG4gICAgICAgICAgY2xhc3NOYW1lOiAnZmEgZmEtY2lyY2xlJyxcbiAgICAgICAgICB0aXRsZTogJ3NlbGVjdC1jaXJjbGUnLFxuICAgICAgICAgIG9wdGlvbjogJ2NpcmNsZSdcbiAgICAgICAgfSxcbiAgICAgICAgc2VsZWN0aW9uVG9vbE1hZ2ljOiB7XG4gICAgICAgICAgY2xhc3NOYW1lOiAnZmEgZmEtbWFnaWMnLFxuICAgICAgICAgIHRpdGxlOiAnc2VsZWN0LW1hZ2ljJyxcbiAgICAgICAgICBvcHRpb246ICdtYWdpYydcbiAgICAgICAgfSxcbiAgICAgICAgc2VsZWN0aW9uVG9vbExhc3NvOiB7XG4gICAgICAgICAgdXNlOiAnc2hhcGVTZWxlY3Rpb25Ub29scycsXG4gICAgICAgICAgdGl0bGU6ICdzZWxlY3QtbGFzc28nLFxuICAgICAgICAgIG9wdGlvbjogJ2xhc3NvJyxcbiAgICAgICAgICBpY29uOiAnZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCwnKyByZXF1aXJlKCdiYXNlNjQtbG9hZGVyIS4vLi4vbWVkaWEvbGFzc28uc3ZnJylcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG4gICAgcGF0aGZpbmRlcjoge1xuICAgICAgdGl0bGU6ICdwYXRoZmluZGVyJyxcbiAgICAgIHR5cGU6ICdvcHRpb25zJyxcbiAgICAgIHZhbHVlOiAncGF0aGZpbmRlck1vZGUnLFxuICAgICAgbWVudToge1xuICAgICAgICBwYXRoZmluZGVyTmV3OiB7XG4gICAgICAgICAgdGl0bGU6ICdwYXRoZmluZGVyLW5ldycsXG4gICAgICAgICAgb3B0aW9uOiAnbmV3J1xuICAgICAgICB9LFxuICAgICAgICBwYXRoZmluZGVyRXhjbHVkZToge1xuICAgICAgICAgIHRpdGxlOiAncGF0aGZpbmRlci1leGNsdWRlJyxcbiAgICAgICAgICBvcHRpb246ICdleGNsdWRlJ1xuICAgICAgICB9LFxuICAgICAgICBwYXRoZmluZGVyU3Vic3RyYWN0OiB7XG4gICAgICAgICAgdGl0bGU6ICdwYXRoZmluZGVyLXN1YnN0cmFjdCcsXG4gICAgICAgICAgb3B0aW9uOiAnc3Vic3RyYWN0J1xuICAgICAgICB9LFxuICAgICAgICBwYXRoZmluZGVyQWRkOiB7XG4gICAgICAgICAgdGl0bGU6ICdwYXRoZmluZGVyLWFkZCcsXG4gICAgICAgICAgb3B0aW9uOiAnYWRkJ1xuICAgICAgICB9LFxuICAgICAgICBwYXRoZmluZGVySW50ZXJzZWN0OiB7XG4gICAgICAgICAgdGl0bGU6ICdwYXRoZmluZGVyLWludGVyc2VjdCcsXG4gICAgICAgICAgb3B0aW9uOiAnaW50ZXJzZWN0J1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcbiAgICBmaWxsV2l0aEN1cnJlbnRDb2xvcjoge1xuICAgICAgdGl0bGU6ICdmaWxsV2l0aEN1cnJlbnRDb2xvcicsXG4gICAgICBjbGFzc05hbWU6ICdmYSBmYS1wYWludC1icnVzaCdcbiAgICB9LFxuICAgIGNsZWFyOiB7XG4gICAgICBjbGFzc05hbWU6ICdmYSBmYS1lcmFzZXInLFxuICAgICAgaWQ6ICAgICAnUGF0aGZpbmRlci1jbGVhcicsXG4gICAgICB0aXRsZTogICdjbGVhcidcbiAgICB9LFxuICAgIHBhdGhmaW5kZXJDb2xvcjoge1xuICAgICAgdGl0bGU6ICAnY29sb3InLFxuICAgICAgdHlwZTogICAnY29sb3InLFxuICAgICAgdmFsdWU6ICAnY29sb3InXG4gICAgfVxuICB9XG59O1xuXG5mYWJyaWMudXRpbC5vYnNlcnZhYmxlKFBhdGhmaW5kZXIucHJvdG90eXBlKTtcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChQYXRoZmluZGVyLnByb3RvdHlwZSwgZmFicmljLlRvb2xzTWl4aW4sIHtcbiAgc2VsZWN0QmFja2dyb3VuZDogZnVuY3Rpb24gKGZyb21Db3JuZXJzKSB7XG4gICAgdmFyIGluZm8gPSB0aGlzLmdldEluZm8oKSwgbWFzaztcblxuICAgIGlmIChmcm9tQ29ybmVycykge1xuICAgICAgdmFyIG1hc2sxID0gTWFnaWNXYW5kLnNlbGVjdEJhY2tncm91bmQoaW5mbywgWzI1NSwgMjU1LCAyNTUsIGZhbHNlXSwgdGhpcy5jb2xvclRocmVzaG9sZCk7XG4gICAgICB2YXIgbWFzazIgPSBNYWdpY1dhbmQuc2VsZWN0QmFja2dyb3VuZChpbmZvLCBbZmFsc2UsIGZhbHNlLCBmYWxzZSwgMF0sIHRoaXMuY29sb3JUaHJlc2hvbGQpO1xuICAgICAgbWFzayA9IE1hZ2ljV2FuZC5hZGQobWFzazEsIG1hc2syKTtcbiAgICB9IGVsc2Uge1xuICAgICAgbWFzayA9IE1hZ2ljV2FuZC5zZWxlY3RBbGxCeUNvbG9yKGluZm8sIFsyNTUsIDI1NSwgMjU1LCAyNTVdLCB0aGlzLmNvbG9yVGhyZXNob2xkKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5ibHVyUmFkaXVzKSB7XG4gICAgICBtYXNrID0gTWFnaWNXYW5kLmdhdXNzQmx1ck9ubHlCb3JkZXIobWFzaywgdGhpcy5ibHVyUmFkaXVzKTtcbiAgICB9XG4gICAgdGhpcy5zZXRTZWxlY3Rpb24obWFzayk7XG4gIH0sXG4gIGNvbG9yU2VsZWN0aW9uOiBmdW5jdGlvbiAoY29sb3JzLCB0aHJlc2hvbGQpIHtcbiAgICB2YXIgaW5mbyA9IHRoaXMuZ2V0SW5mbygpLCBtYXNrMixcbiAgICAgIG1hc2sgPSBNYWdpY1dhbmQuY3JlYXRlTWFzayhpbmZvLndpZHRoLCBpbmZvLmhlaWdodCk7XG4gICAgZm9yICh2YXIgaSBpbiBjb2xvcnMpIHtcbiAgICAgIHZhciBfY29sb3IgPSBuZXcgZmFicmljLkNvbG9yKGNvbG9yc1tpXSkuX3NvdXJjZTtcbiAgICAgIF9jb2xvclszXSA9IE1hdGgucm91bmQoX2NvbG9yWzNdICogMjU1KTtcbiAgICAgIG1hc2syID0gTWFnaWNXYW5kLnNlbGVjdEFsbEJ5Q29sb3IoaW5mbywgX2NvbG9yLCB0aHJlc2hvbGRbaV0pXG4gICAgICBtYXNrID0gTWFnaWNXYW5kLmFkZChtYXNrLCBtYXNrMik7XG4gICAgfVxuICAgIGRlbGV0ZSB0aGlzLm9sZE1hc2s7XG4gICAgdGhpcy5tb2RpZnlTZWxlY3Rpb24obWFzayk7XG4gIH0sXG4gIHNtYXJ0U2VsZWN0aW9uOiBmdW5jdGlvbiAodGhyZXNob2xkKSB7XG4gICAgdmFyIGluZm8gPSB0aGlzLmdldEluZm8oKSwgbWFzaztcbiAgICBtYXNrID0gTWFnaWNXYW5kLnNlbGVjdEJhY2tncm91bmQoaW5mbywgbnVsbCwgdGhyZXNob2xkIHx8IHRoaXMuY29sb3JUaHJlc2hvbGQpO1xuICAgIG1hc2sgPSBNYWdpY1dhbmQuaW52ZXJ0TWFzayhtYXNrKTtcbiAgICBkZWxldGUgdGhpcy5vbGRNYXNrO1xuICAgIHRoaXMubW9kaWZ5U2VsZWN0aW9uKG1hc2spO1xuICB9XG59KTtcblxuXG5QYXRoZmluZGVyLnByb3RvdHlwZS5kcmF3aW5nVG9vbHMgPSB7XG4gIGJydXNoOiB7XG4gICAgbW91c2VVcDogZnVuY3Rpb24oKXtcbiAgICAgIHRoaXMubW9kaWZ5U2VsZWN0aW9uKCk7XG4gICAgICB0aGlzLnJlc2V0U2VsZWN0aW9uRHJhd0NhbnZhcygpO1xuICAgIH0sXG4gICAgbW91c2VNb3ZlOiBmdW5jdGlvbihwKXtcbiAgICAgIGlmICghdGhpcy5hbGxvd0RyYXcpIHJldHVybjtcbiAgICAgIHRoaXMuZHJhd0NpcmNsZShwLngsIHAueSwgdGhpcy5yYWRpdXMpO1xuICAgIH0sXG4gICAgbW91c2VEb3duOiBmdW5jdGlvbihwb2ludCl7XG4gICAgICB0aGlzLmNyZWF0ZVNlbGVjdGlvbigpO1xuICAgICAgdGhpcy5kb3duUG9pbnQgPSBwb2ludDtcbiAgICAgIHRoaXMuY3JlYXRlU2VsZWN0aW9uRHJhd0NhbnZhcygpO1xuICAgICAgdGhpcy5kcmF3Q2lyY2xlKHBvaW50LngsIHBvaW50LnksIHRoaXMucmFkaXVzKTtcbiAgICB9LFxuICAgIHV0aWxzOiB7XG4gICAgICBkcmF3Q2lyY2xlOiBmdW5jdGlvbiAoeCwgeSwgcikge1xuICAgICAgICB2YXIgY3R4ID0gdGhpcy5zZWxlY3Rpb25EcmF3Q29udGV4dCxcbiAgICAgICAgICB2ID0gdGhpcy5jYW52YXMudmlld3BvcnRUcmFuc2Zvcm07XG4gICAgICAgIGN0eC5zYXZlKCk7XG4gICAgICAgIC8vICBjdHgudHJhbnNmb3JtKHZbMF0sIHZbMV0sIHZbMl0sIHZbM10sIHZbNF0sIHZbNV0pO1xuICAgICAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgICAgIGN0eC5hcmMoeCwgeSwgdGhpcy5yYWRpdXMsIDAsIE1hdGguUEkgKiAyLCBmYWxzZSk7XG4gICAgICAgIGN0eC5jbG9zZVBhdGgoKTtcbiAgICAgICAgY3R4LmZpbGwoKTtcbiAgICAgICAgY3R4LnJlc3RvcmUoKTtcbiAgICAgICAgTWFnaWNXYW5kLm1hc2tTZWxlY3Rpb24oIHRoaXMuc2VsZWN0aW9uRHJhd0NhbnZhcywgMCwwLCB0aGlzLm1hc2ssICdhZGQnKTtcbiAgICAgICAgdGhpcy5zZXRTZWxlY3Rpb24odGhpcy5tYXNrKTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIG1hZ2ljOiB7XG4gICAgbW91c2VVcDogZnVuY3Rpb24oKXtcbiAgICAgIHRoaXMuc2hvdWxkTW9kaWZ5ID0gdHJ1ZTtcbiAgICB9LFxuICAgIG1vdXNlTW92ZTogZnVuY3Rpb24gKHApe1xuICAgICAgaWYgKCF0aGlzLmFsbG93RHJhdykgcmV0dXJuO1xuICAgICAgdmFyIGRpc3QgPSBwLnggLSB0aGlzLmRvd25Qb2ludC54O1xuXG4gICAgICB2YXIgdmFsID0gdGhpcy5faW5pdF90aHJlcyArIGRpc3Q7XG4gICAgICB2YXIgdGhyZXMgPSBNYXRoLm1pbihNYXRoLm1heCh2YWwsIDEpLCAyNTUpO1xuICAgICAgaWYgKHRocmVzICE9IHRoaXMuY29sb3JUaHJlc2hvbGQpIHtcbiAgICAgICAgdGhpcy5zZXRUaHJlc2hvbGQodGhyZXMpO1xuICAgICAgfVxuICAgIH0sXG4gICAgbW91c2VEb3duOiBmdW5jdGlvbiAocG9pbnQpe1xuICAgICAgaWYgKHRoaXMuc2hvdWxkTW9kaWZ5KSB7XG4gICAgICAgIHRoaXMubW9kaWZ5U2VsZWN0aW9uKCk7XG4gICAgICB9XG4gICAgICB0aGlzLmRvd25Qb2ludCA9IHBvaW50O1xuICAgICAgdGhpcy5jb2xvclRocmVzaG9sZCA9IDE1O1xuICAgICAgdGhpcy5maXJlKCd0aHJlc2hvbGQ6Y2hhbmdlZCcsIHt0aHJlc2hvbGQ6IHRoaXMuY29sb3JUaHJlc2hvbGR9KTtcbiAgICAgIHRoaXMuX2luaXRfdGhyZXMgPSB0aGlzLmNvbG9yVGhyZXNob2xkO1xuICAgICAgdGhpcy5kcmF3TWFzayh0aGlzLmRvd25Qb2ludC54LCB0aGlzLmRvd25Qb2ludC55LCB0aGlzLmFkamFjZW50UGl4ZWxzKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9LFxuICAgIHV0aWxzOntcbiAgICAgIGRyYXdNYXNrOiBmdW5jdGlvbiAoeCwgeSwgYWRqYWNlbnRQaXhlbHMpIHtcbiAgICAgICAgdGhpcy5hc3luY3Jvbm91cyh0aGlzLl9kcmF3TWFzay5iaW5kKHRoaXMsIHgsIHksIGFkamFjZW50UGl4ZWxzKSwgMCk7XG4gICAgICB9LFxuICAgICAgX2RyYXdNYXNrOiBmdW5jdGlvbiAoeCwgeSwgYWRqYWNlbnRQaXhlbHMpIHtcbiAgICAgICAgTWFnaWNXYW5kLmFscGhhQ2hhbm5lbCA9IHRoaXMuYWxwaGFDaGFubmVsO1xuICAgICAgICB2YXIgaW5mbyA9IHRoaXMuZ2V0SW5mbygpLCBtYXNrO1xuICAgICAgICBpZiAoYWRqYWNlbnRQaXhlbHMpIHtcbiAgICAgICAgICBNYWdpY1dhbmQuZmxvb2RGaWxsKGluZm8sIHgsIHksIHRoaXMuY29sb3JUaHJlc2hvbGQse30sbnVsbCxmdW5jdGlvbihtYXNrKXtcbiAgICAgICAgICAgIHRoaXMuc2V0U2VsZWN0aW9uKG1hc2spO1xuICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbWFzayA9IE1hZ2ljV2FuZC5zZWxlY3RBbGwoaW5mbywgeCwgeSwgdGhpcy5jb2xvclRocmVzaG9sZCk7XG4gICAgICAgICAgdGhpcy5zZXRTZWxlY3Rpb24obWFzayk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIHJlY3RhbmdsZToge1xuICAgIG1vdXNlRG93bjogZnVuY3Rpb24ocG9pbnQpIHtcbiAgICAgIGlmICh0aGlzLnNob3VsZE1vZGlmeSkge1xuICAgICAgICB0aGlzLm1vZGlmeVNlbGVjdGlvbigpO1xuICAgICAgfVxuICAgICAgdGhpcy5kb3duUG9pbnQgPSBwb2ludDtcbiAgICAgIHRoaXMuc2hvdWxkTW9kaWZ5ID0gdHJ1ZTtcbiAgICB9LFxuICAgIG1vdXNlVXA6IGZ1bmN0aW9uKCl7XG4gICAgICAvL3RoaXMubW9kaWZ5U2VsZWN0aW9uKCk7XG4gICAgICAvL3RoaXMucmVzZXRTZWxlY3Rpb25EcmF3Q2FudmFzKCk7XG4gICAgfSxcbiAgICBtb3VzZU1vdmU6IGZ1bmN0aW9uKHApe1xuICAgICAgaWYgKCF0aGlzLmFsbG93RHJhdykgcmV0dXJuO1xuICAgICAgdGhpcy5kcmF3UmVjdGFuZ2xlKHRoaXMuZG93blBvaW50LngsIHRoaXMuZG93blBvaW50LnksIHAueCwgcC55KTtcbiAgICB9LFxuICAgIHV0aWxzOntcbiAgICAgIGRyYXdSZWN0YW5nbGU6IGZ1bmN0aW9uICh4LCB5LCB4MiwgeTIpIHtcbiAgICAgICAgdmFyIGluZm8gPSB0aGlzLmdldEluZm8oKSxcbiAgICAgICAgICBtYXNrID0gTWFnaWNXYW5kLnNlbGVjdFJlY3RhbmdsZShpbmZvLCB4LCB5LCB4MiwgeTIpO1xuICAgICAgICB0aGlzLnNldFNlbGVjdGlvbihtYXNrKTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIGNpcmNsZToge1xuICAgIG1vdXNlRG93bjogZnVuY3Rpb24ocG9pbnQpIHtcbiAgICAgIGlmICh0aGlzLnNob3VsZE1vZGlmeSkge1xuICAgICAgICB0aGlzLm1vZGlmeVNlbGVjdGlvbigpO1xuICAgICAgfVxuICAgICAgdGhpcy5kb3duUG9pbnQgPSBwb2ludDtcbiAgICAgIHRoaXMuY3JlYXRlU2VsZWN0aW9uRHJhd0NhbnZhcygpO1xuICAgICAgdGhpcy5zZWxlY3Rpb25PYmplY3QgPSBuZXcgZmFicmljLkVsbGlwc2Uoe1xuICAgICAgICBsZWZ0OiBwb2ludC54ICsgdGhpcy50YXJnZXQubGVmdCxcbiAgICAgICAgdG9wOiAgcG9pbnQueSArIHRoaXMudGFyZ2V0LnRvcCxcbiAgICAgICAgcng6MSxcbiAgICAgICAgcnk6MSxcbiAgICAgICAgaGFzQm9yZGVyczogZmFsc2UsXG4gICAgICAgIG9yaWdpblg6ICdjZW50ZXInLFxuICAgICAgICBvcmlnaW5ZOiAnY2VudGVyJyxcbiAgICAgICAgc3Ryb2tlV2lkdGg6IDEsXG4gICAgICAgIGZpbGw6ICd0cmFuc3BhcmVudCcsXG4gICAgICAgIHN0cm9rZTogJ3RyYW5zcGFyZW50J1xuICAgICAgfSk7XG4gICAgICB0aGlzLmNhbnZhcy5hZGQodGhpcy5zZWxlY3Rpb25PYmplY3QpO1xuICAgICAgdGhpcy51cGRhdGVTaGFwZSgpO1xuICAgIH0sXG4gICAgbW91c2VVcDogZnVuY3Rpb24oKXtcbiAgICAgIHRoaXMuY2FudmFzLnNldEludGVyYWN0aXZlTW9kZShcIm1peGVkXCIpO1xuICAgICAgdGhpcy5zZWxlY3Rpb25PYmplY3Quc2V0Q29vcmRzKCk7XG4gICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgdGhpcy5zZWxlY3Rpb25PYmplY3Qub24oJ3NjYWxpbmcgbW92aW5nIHJvdGF0aW5nJyxmdW5jdGlvbigpe1xuICAgICAgICBfdGhpcy51cGRhdGVTaGFwZSgpO1xuICAgICAgfSk7XG4gICAgICB0aGlzLmNhbnZhcy5zZXRBY3RpdmVPYmplY3QodGhpcy5zZWxlY3Rpb25PYmplY3QpO1xuICAgICAgdGhpcy5zaG91bGRNb2RpZnkgPSB0cnVlO1xuICAgICAgLy8gIHRoaXMubW9kaWZ5U2VsZWN0aW9uKCk7XG4gICAgICAvLyAgdGhpcy5yZXNldFNlbGVjdGlvbkRyYXdDYW52YXMoKTtcbiAgICB9LFxuICAgIG1vdXNlTW92ZTogZnVuY3Rpb24ocCl7XG4gICAgICBpZiAoIXRoaXMuYWxsb3dEcmF3KSByZXR1cm47XG4gICAgICB0aGlzLnNlbGVjdGlvbk9iamVjdC5zZXQoe1xuICAgICAgICByeDogTWF0aC5hYnMoKHAueCArIHRoaXMudGFyZ2V0LmxlZnQgLSAgdGhpcy5zZWxlY3Rpb25PYmplY3QuZ2V0KCdsZWZ0JykpKSAsXG4gICAgICAgIHJ5OiBNYXRoLmFicygocC55ICsgdGhpcy50YXJnZXQudG9wICAtIHRoaXMuc2VsZWN0aW9uT2JqZWN0LmdldCgndG9wJykpKVxuICAgICAgfSk7XG5cbiAgICAgIHRoaXMudXBkYXRlU2hhcGUoKTtcblxuICAgIH0sXG4gICAgdXRpbHM6e1xuICAgICAgdXBkYXRlU2hhcGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5yZXNldFNlbGVjdGlvbkRyYXdDYW52YXMoKTtcbiAgICAgICAgdGhpcy5zZWxlY3Rpb25PYmplY3QuZmlsbCA9ICd3aGl0ZSc7XG4gICAgICAgIHRoaXMuc2VsZWN0aW9uRHJhd0NvbnRleHQuc2F2ZSgpO1xuICAgICAgICB0aGlzLnNlbGVjdGlvbkRyYXdDb250ZXh0LnRyYW5zbGF0ZSgtdGhpcy50YXJnZXQubGVmdCwgLSB0aGlzLnRhcmdldC50b3ApO1xuICAgICAgICB0aGlzLnNlbGVjdGlvbk9iamVjdC5yZW5kZXIodGhpcy5zZWxlY3Rpb25EcmF3Q29udGV4dCk7XG4gICAgICAgIHRoaXMuc2VsZWN0aW9uRHJhd0NvbnRleHQucmVzdG9yZSgpO1xuICAgICAgICB0aGlzLnNlbGVjdGlvbk9iamVjdC5maWxsID0gJ3RyYW5zcGFyZW50JztcbiAgICAgICAgdGhpcy5tYXNrID0gTWFnaWNXYW5kLm1hc2tTZWxlY3Rpb24oIHRoaXMuc2VsZWN0aW9uRHJhd0NhbnZhcyk7XG4gICAgICAgIHRoaXMuc2V0U2VsZWN0aW9uKHRoaXMubWFzayk7XG4gICAgICB9XG4gICAgfVxuICB9LFxuICBsYXNzbzoge1xuICAgIG1vdXNlVXA6IGZ1bmN0aW9uKCl7XG4gICAgICBpZih0aGlzLnJlYWR5VG9DbG9zZVBhdGgpIHtcbiAgICAgICAgdGhpcy5fY2xvc2VQYXRoKCk7XG4gICAgICB9XG4gICAgfSxcbiAgICBtb3VzZU1vdmU6IGZ1bmN0aW9uKHApe1xuICAgICAgaWYgKCF0aGlzLmFsbG93RHJhdykgcmV0dXJuO1xuICAgICAgdGhpcy5kcmF3TGluZSh0aGlzLl9sYXN0X3BvaW50LCBwKVxuICAgICAgdGhpcy5fcG9pbnRzLnB1c2gocCk7XG4gICAgICB0aGlzLl9sYXN0X3BvaW50ID0gcDtcbiAgICB9LFxuICAgIG1vdXNlRG93bjogZnVuY3Rpb24ocG9pbnQpe1xuICAgICAgaWYoIXRoaXMuZG93blBvaW50KXtcbiAgICAgICAgdGhpcy5jcmVhdGVTZWxlY3Rpb24oKTtcbiAgICAgICAgdGhpcy5jcmVhdGVTZWxlY3Rpb25EcmF3Q2FudmFzKCk7XG4gICAgICAgIHRoaXMuX3BhdGhfb3V0ID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZG93blBvaW50ID0gcG9pbnQ7XG4gICAgICAgIHRoaXMuX3BvaW50cyA9IFtdO1xuICAgICAgICB0aGlzLnNlbGVjdGlvbkRyYXdDb250ZXh0LmJlZ2luUGF0aCgpO1xuICAgICAgICB0aGlzLmNhbnZhcy5vbignbW91c2U6bW92ZScsIHRoaXMuX2NoYW5nZUN1cnNvck92ZXJDbG9zZVBvaW50KTtcbiAgICAgIH1cbiAgICAgIGlmKHRoaXMuX2xhc3RfcG9pbnQpe1xuICAgICAgICBpZih0aGlzLnJlYWR5VG9DbG9zZVBhdGgpe1xuICAgICAgICAgIHRoaXMuX2Nsb3NlUGF0aCgpO1xuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICB0aGlzLmRyYXdMaW5lKHRoaXMuX2xhc3RfcG9pbnQsIHBvaW50KVxuICAgICAgICAgIHRoaXMuX2xhc3RfcG9pbnQgPSBwb2ludDtcbiAgICAgICAgICB0aGlzLl9wb2ludHMucHVzaChwb2ludCk7XG4gICAgICAgIH1cbiAgICAgIH1lbHNle1xuXG4gICAgICAgIHRoaXMuZHJhd0xpbmUoe3g6cG9pbnQueCAtIDAuNSx5OiBwb2ludC55fSwge3g6cG9pbnQueCArIDAuNSx5OiBwb2ludC55IH0pXG4gICAgICAgIHRoaXMuX2xhc3RfcG9pbnQgPSB7eDpwb2ludC54ICsgMC41LHk6IHBvaW50LnkgfTtcbiAgICAgICAgdGhpcy5fcG9pbnRzLnB1c2gocG9pbnQpO1xuICAgICAgICB0aGlzLnNob3VsZE1vZGlmeSA9IHRydWU7XG4gICAgICB9XG4gICAgfSxcbiAgICB1dGlsczoge1xuICAgICAgZHJhd0xpbmU6IGZ1bmN0aW9uIChwMSAscDIgKSB7XG4gICAgICAgIHZhciBjdHggPSB0aGlzLnNlbGVjdGlvbkRyYXdDb250ZXh0LFxuICAgICAgICAgIHYgPSB0aGlzLmNhbnZhcy52aWV3cG9ydFRyYW5zZm9ybTtcbiAgICAgICAgY3R4LnNhdmUoKTtcbiAgICAgICAgLy9jdHgudHJhbnNmb3JtKHZbMF0sIHZbMV0sIHZbMl0sIHZbM10sIHZbNF0sIHZbNV0pO1xuICAgICAgICBjdHgubW92ZVRvKHAxLngscDEueSk7XG4gICAgICAgIGN0eC5saW5lVG8ocDIueCxwMi55KTtcbiAgICAgICAgY3R4LnN0cm9rZSgpO1xuICAgICAgICBjdHgucmVzdG9yZSgpO1xuICAgICAgICBNYWdpY1dhbmQubWFza1NlbGVjdGlvbih0aGlzLnNlbGVjdGlvbkRyYXdDYW52YXMsMCwwLHRoaXMubWFzaywnYWRkJyk7XG4gICAgICAgIHRoaXMuc2V0U2VsZWN0aW9uKHRoaXMubWFzayk7XG4gICAgICB9LFxuICAgICAgX2Nsb3NlUGF0aDogIGZ1bmN0aW9uIChlKSB7XG5cbiAgICAgICAgdGhpcy5hbGxvd0RyYXcgPSBmYWxzZTtcbiAgICAgICAgdmFyIGN0eCA9IHRoaXMuc2VsZWN0aW9uRHJhd0NvbnRleHQ7XG4gICAgICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICAgICAgY3R4Lm1vdmVUbyh0aGlzLl9wb2ludHNbMF0ueCx0aGlzLl9wb2ludHNbMF0ueSlcbiAgICAgICAgZm9yKHZhciBpID0gMSA7IGkgPCB0aGlzLl9wb2ludHMubGVuZ3RoO2kgKyspe1xuICAgICAgICAgIGN0eC5saW5lVG8odGhpcy5fcG9pbnRzW2ldLngsdGhpcy5fcG9pbnRzW2ldLnkpXG4gICAgICAgIH1cbiAgICAgICAgY3R4LmNsb3NlUGF0aCgpO1xuICAgICAgICBjdHguZmlsbCgpO1xuICAgICAgICBNYWdpY1dhbmQubWFza1NlbGVjdGlvbih0aGlzLnNlbGVjdGlvbkRyYXdDYW52YXMsMCwwLHRoaXMubWFzaywnYWRkJyk7XG4gICAgICAgIHRoaXMuc2V0U2VsZWN0aW9uKHRoaXMubWFzayk7XG4gICAgICAgIHRoaXMucmVzZXRTZWxlY3Rpb25EcmF3Q2FudmFzKCk7XG4gICAgICAgIHRoaXMuX3BvaW50cyA9IFtdO1xuICAgICAgICBkZWxldGUgdGhpcy5kb3duUG9pbnQ7XG4gICAgICAgIGRlbGV0ZSB0aGlzLnJlYWR5VG9DbG9zZVBhdGg7XG4gICAgICAgIGRlbGV0ZSB0aGlzLl9sYXN0X3BvaW50O1xuICAgICAgICB0aGlzLmNhbnZhcy5vZmYoJ21vdXNlOm1vdmUnLCB0aGlzLl9jaGFuZ2VDdXJzb3JPdmVyQ2xvc2VQb2ludCk7XG4gICAgICAgIHRoaXMuY2FudmFzLmZyZWVEcmF3aW5nQ3Vyc29yID0gJ2Nyb3NzaGFpcic7XG4gICAgICAgIHRoaXMuY2FudmFzLnNldEN1cnNvcih0aGlzLmNhbnZhcy5mcmVlRHJhd2luZ0N1cnNvcik7XG4gICAgICAgIC8vIHRoaXMuZHJhd0xpbmUodGhpcy5fbGFzdF9wb2ludCwgdGhpcy5kb3duUG9pbnQpO1xuICAgICAgfSxcbiAgICAgIF9jaGFuZ2VDdXJzb3JPdmVyQ2xvc2VQb2ludDogIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHZhciBjYW52YXMgPSB0aGlzLFxuICAgICAgICAgIHBhdGhmaW5kZXIgPSBjYW52YXMucGF0aGZpbmRlcjtcbiAgICAgICAgaWYoIXBhdGhmaW5kZXIudGFyZ2V0KXJldHVybjtcbiAgICAgICAgdmFyIGl2dCA9IGZhYnJpYy51dGlsLmludmVydFRyYW5zZm9ybShjYW52YXMudmlld3BvcnRUcmFuc2Zvcm0pLFxuICAgICAgICAgIHAgPSBmYWJyaWMudXRpbC50cmFuc2Zvcm1Qb2ludChjYW52YXMuZ2V0UG9pbnRlcihlLmUsIHRydWUpLCBpdnQpO1xuICAgICAgICBwLnggLT0gcGF0aGZpbmRlci50YXJnZXQubGVmdDtcbiAgICAgICAgcC55IC09IHBhdGhmaW5kZXIudGFyZ2V0LnRvcDtcbiAgICAgICAgaWYgKCBwYXRoZmluZGVyLmRvd25Qb2ludCAmJiBwYXRoZmluZGVyLmRvd25Qb2ludC5kaXN0YW5jZUZyb20ocCkgPCAxMCkge1xuICAgICAgICAgIGlmKCFwYXRoZmluZGVyLl9wYXRoX291dCl7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIHBhdGhmaW5kZXIucmVhZHlUb0Nsb3NlUGF0aCA9IHRydWU7XG4gICAgICAgICAgY2FudmFzLmZyZWVEcmF3aW5nQ3Vyc29yID0gY2FudmFzLnRhcmdldEN1cnNvcjtcbiAgICAgICAgICBjYW52YXMuc2V0Q3Vyc29yKGNhbnZhcy5mcmVlRHJhd2luZ0N1cnNvcik7XG4gICAgICAgICAgLy9jb25zb2xlLmxvZyhjYW52YXMuZnJlZURyYXdpbmdDdXJzb3IpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHBhdGhmaW5kZXIuX3BhdGhfb3V0ID0gdHJ1ZTtcbiAgICAgICAgICBwYXRoZmluZGVyLnJlYWR5VG9DbG9zZVBhdGggPSBmYWxzZTtcbiAgICAgICAgICBjYW52YXMuZnJlZURyYXdpbmdDdXJzb3IgPSAnY3Jvc3NoYWlyJztcbiAgICAgICAgICBjYW52YXMuc2V0Q3Vyc29yKGNhbnZhcy5mcmVlRHJhd2luZ0N1cnNvcik7XG4gICAgICAgICAgLy8gY29uc29sZS5sb2coY2FudmFzLmZyZWVEcmF3aW5nQ3Vyc29yKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxufTtcbmZvcih2YXIgaSBpbiBQYXRoZmluZGVyLnByb3RvdHlwZS5kcmF3aW5nVG9vbHMpe1xuICBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKFBhdGhmaW5kZXIucHJvdG90eXBlLCBQYXRoZmluZGVyLnByb3RvdHlwZS5kcmF3aW5nVG9vbHNbaV0udXRpbHMpXG59XG5mYWJyaWMuUGF0aGZpbmRlciA9IFBhdGhmaW5kZXI7XG5cblxuXG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLlNsaWRlQ2FudmFzLnByb3RvdHlwZSwge1xuICBwYXRoZmluZGVyOiBmYWxzZSxcbiAgc2V0UGF0aGZpbmRlcjogZnVuY3Rpb24gKHZhbCkge1xuICAgIGlmICh2YWwpIHtcbiAgICAgIHRoaXMucGF0aGZpbmRlciA9IG5ldyBmYWJyaWMuUGF0aGZpbmRlcigncGF0aGZpbmRlcicpO1xuICAgICAgdGhpcy5wYXRoZmluZGVyLmNhbnZhcyA9IHRoaXM7XG4gICAgfVxuICB9LFxuICBnZXRQYXRoZmluZGVyOiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMucGF0aGZpbmRlciB8fCB0aGlzLmFwcGxpY2F0aW9uICYmIHRoaXMuYXBwbGljYXRpb24ucGF0aGZpbmRlcjtcbiAgfVxufSk7XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLkFwcGxpY2F0aW9uLnByb3RvdHlwZSwge1xuICBpbml0UGF0aGZpbmRlcjogZnVuY3Rpb24gKCkge1xuICAgIC8vaWYodGhpcy5wYXRoZmluZGVyKXtcblxuICAgICAgdGhpcy5wYXRoZmluZGVyID0gbmV3IGZhYnJpYy5QYXRoZmluZGVyKHtcbiAgICAgICAgYXBwbGljYXRpb246IHRoaXNcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLnBhdGhmaW5kZXIub24oXCJpbWFnZTpjaGFuZ2VkXCIsIGZ1bmN0aW9uIChpbWcpIHtcbiAgICAgICAgdmFyIGRhdGFVcmwgPSBpbWcudG9EYXRhVVJMKCk7XG4gICAgICAgIGlmICghdGhpcy50YXJnZXQuX29yaWdpbmFsRWxlbWVudCkge1xuICAgICAgICAgIHRoaXMudGFyZ2V0Ll9vcmlnaW5hbEVsZW1lbnQgPSB0aGlzLnRhcmdldC5fZWxlbWVudDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnRhcmdldC5fZWxlbWVudCA9IG5ldyBJbWFnZSgpO1xuXG4gICAgICAgIHRoaXMudGFyZ2V0Ll9lbGVtZW50Lm9ubG9hZCA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgdGhpcy50YXJnZXQuZmlyZShcImNvbnRlbnQ6bW9kaWZpZWRcIilcbiAgICAgICAgICB0aGlzLnRhcmdldC5jYW52YXMgJiYgdGhpcy50YXJnZXQuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgICAgICB9LmJpbmQodGhpcyk7XG5cbiAgICAgICAgdGhpcy50YXJnZXQuX2VsZW1lbnQuc3JjID0gZGF0YVVybDtcbiAgICAgICAgdGhpcy50YXJnZXQuX2VkaXRlZCA9IHRydWVcbiAgICAgICAgaWYodGhpcy50YXJnZXQuZGlydHkgIT09IFwidW5kZWZpbmVkXCIpe1xuICAgICAgICAgIHRoaXMudGFyZ2V0LmRpcnR5ID0gdHJ1ZTtcbiAgICAgICAgfVxuXG5cbiAgICAgIH0pO1xuICAgIC8vfVxuICB9XG59KTtcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuQXBwbGljYXRpb24ucHJvdG90eXBlLCB7XG4gIGV2ZW50TGlzdGVuZXJzOiBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kQXJyYXlzT2JqZWN0KGZhYnJpYy5BcHBsaWNhdGlvbi5wcm90b3R5cGUuZXZlbnRMaXN0ZW5lcnMsIHtcbiAgICBcInJlYWR5XCI6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuaW5pdFBhdGhmaW5kZXIoKTtcbiAgICB9XG4gIH0pXG59KTtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vbW9kdWxlcy9wYXRoZmluZGVyLmpzXG4vLyBtb2R1bGUgaWQgPSA3M1xuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCIndXNlIHN0cmljdCc7XG5cblxudmFyIF9zZXRfb2JqZWN0X3NjYWxlX292ZXJ3cml0dGVuID0gZmFicmljLkNhbnZhcy5wcm90b3R5cGUuX3NldE9iamVjdFNjYWxlO1xudmFyIF9zZXR1cF9jdXJyZW50X3RyYW5zZm9ybSA9IGZhYnJpYy5DYW52YXMucHJvdG90eXBlLl9zZXR1cEN1cnJlbnRUcmFuc2Zvcm07XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLkNhbnZhcy5wcm90b3R5cGUsIHtcbiAgX3NldHVwQ3VycmVudFNjYWxlVHJhbnNmb3JtOiBfc2V0dXBfY3VycmVudF90cmFuc2Zvcm0sXG4gIF9zZXR1cEN1cnJlbnRUcmFuc2Zvcm06IGZ1bmN0aW9uIChlLCB0YXJnZXQpIHtcbiAgICBpZiAoIXRhcmdldClyZXR1cm47XG4gICAgaWYgKHRhcmdldC5zZXR1cEN1cnJlbnRUcmFuc2Zvcm0pIHtcbiAgICAgIHJldHVybiB0YXJnZXQuc2V0dXBDdXJyZW50VHJhbnNmb3JtKGUpO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAodGFyZ2V0LnJlc2l6YWJsZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5fc2V0dXBDdXJyZW50UmVzaXplVHJhbnNmb3JtKGUsIHRhcmdldCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gdGhpcy5fc2V0dXBDdXJyZW50U2NhbGVUcmFuc2Zvcm0uY2FsbCh0aGlzLCBlLCB0YXJnZXQpO1xuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgX3NldE9iamVjdFNjYWxlOiBmdW5jdGlvbiAobG9jYWxNb3VzZSwgdHJhbnNmb3JtLCBsb2NrU2NhbGluZ1gsIGxvY2tTY2FsaW5nWSwgYnksIGxvY2tTY2FsaW5nRmxpcCwgX2RpbSkge1xuXG4gICAgdmFyIHQgPSB0cmFuc2Zvcm0udGFyZ2V0O1xuXG4gICAgaWYgKCFfZGltKSB7XG4gICAgICB2YXIgc3Ryb2tlV2lkdGggPSB0LnN0cm9rZSA/IHQuc3Ryb2tlV2lkdGggOiAwO1xuICAgICAgX2RpbSA9IHtcbiAgICAgICAgeDogKHQud2lkdGggKyAoc3Ryb2tlV2lkdGggLyAyKSksXG4gICAgICAgIHk6ICh0LmhlaWdodCArIChzdHJva2VXaWR0aCAvIDIpKVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmICh0LnNldE9iamVjdFNjYWxlKSB7XG4gICAgICByZXR1cm4gdC5zZXRPYmplY3RTY2FsZShsb2NhbE1vdXNlLCB0cmFuc2Zvcm0sXG4gICAgICAgIGxvY2tTY2FsaW5nWCwgbG9ja1NjYWxpbmdZLCBieSwgbG9ja1NjYWxpbmdGbGlwLCBfZGltKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICBpZiAodC5yZXNpemFibGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3NldE9iamVjdFNpemUobG9jYWxNb3VzZSwgdHJhbnNmb3JtLFxuICAgICAgICAgIGxvY2tTY2FsaW5nWCwgbG9ja1NjYWxpbmdZLCBieSwgbG9ja1NjYWxpbmdGbGlwLCBfZGltKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBfc2V0X29iamVjdF9zY2FsZV9vdmVyd3JpdHRlbi5jYWxsKHRoaXMsIGxvY2FsTW91c2UsIHRyYW5zZm9ybSxcbiAgICAgICAgICBsb2NrU2NhbGluZ1gsIGxvY2tTY2FsaW5nWSwgYnksIGxvY2tTY2FsaW5nRmxpcCwgX2RpbSk7XG4gICAgICB9XG4gICAgfVxuICB9LFxuICBfc2V0T2JqZWN0U2l6ZTogZnVuY3Rpb24gKGxvY2FsTW91c2UsIHRyYW5zZm9ybSwgbG9ja1NjYWxpbmdYLCBsb2NrU2NhbGluZ1ksIGJ5LCBsb2NrU2NhbGluZ0ZsaXAsIF9kaW0pIHtcblxuICAgIHZhciB0YXJnZXQgPSB0cmFuc2Zvcm0udGFyZ2V0LCBmb3JiaWRTY2FsaW5nWCA9IGZhbHNlLCBmb3JiaWRTY2FsaW5nWSA9IGZhbHNlO1xuICAgIHZhciBfc3Ryb2tlID0gdHJhbnNmb3JtLnRhcmdldC5zdHJva2VXaWR0aCB8fCAwO1xuICAgIHRyYW5zZm9ybS5uZXdXaWR0aCA9IHRoaXMud2lkdGggKiAoKGxvY2FsTW91c2UueCAvIHRyYW5zZm9ybS5zY2FsZVgpIC8gKHRoaXMud2lkdGggKyBfc3Ryb2tlKSk7XG4gICAgdHJhbnNmb3JtLm5ld0hlaWdodCA9IHRoaXMuaGVpZ2h0ICogKChsb2NhbE1vdXNlLnkgLyB0cmFuc2Zvcm0uc2NhbGVZKSAvICh0aGlzLmhlaWdodCArIF9zdHJva2UpKTtcblxuICAgIGlmKHRoaXMud2hvbGVDb29yZGluYXRlcyB8fCB0YXJnZXQud2hvbGVDb29yZGluYXRlcyl7XG4gICAgICB0cmFuc2Zvcm0ubmV3V2lkdGggPSBNYXRoLnJvdW5kKHRyYW5zZm9ybS5uZXdXaWR0aCk7XG4gICAgICB0cmFuc2Zvcm0ubmV3SGVpZ2h0ID0gTWF0aC5yb3VuZCh0cmFuc2Zvcm0ubmV3SGVpZ2h0KTtcbiAgICB9XG4gICAgaWYodHJhbnNmb3JtLm5ld0hlaWdodCA8IDAgKXtcbiAgICAgIHRhcmdldC50b3AgPSB0cmFuc2Zvcm0udG9wIC0gdHJhbnNmb3JtLm5ld0hlaWdodDtcbiAgICB9XG4gICAgaWYgKHRhcmdldC5taW5XaWR0aCAmJiB0cmFuc2Zvcm0ubmV3V2lkdGggPD0gdGFyZ2V0Lm1pbldpZHRoKSB7XG4gICAgICB0cmFuc2Zvcm0ubmV3V2lkdGggPSB0YXJnZXQubWluV2lkdGg7XG4gICAgfVxuICAgIGlmICh0YXJnZXQubWluSGVpZ2h0ICYmIHRyYW5zZm9ybS5uZXdIZWlnaHQgPD0gdGFyZ2V0Lm1pbkhlaWdodCkge1xuICAgICAgdHJhbnNmb3JtLm5ld0hlaWdodCA9IHRhcmdldC5taW5IZWlnaHQ7XG4gICAgfVxuICAgIGlmIChsb2NrU2NhbGluZ0ZsaXAgJiYgdHJhbnNmb3JtLm5ld1dpZHRoIDwgdGFyZ2V0LndpZHRoKSB7XG4gICAgICBmb3JiaWRTY2FsaW5nWCA9IHRydWU7XG4gICAgfVxuICAgIGlmIChsb2NrU2NhbGluZ0ZsaXAgJiYgdHJhbnNmb3JtLm5ld0hlaWdodCA8IHRhcmdldC5oZWlnaHQpIHtcbiAgICAgIGZvcmJpZFNjYWxpbmdZID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBpZiAoYnkgPT09ICdlcXVhbGx5Jykge1xuICAgICAgZm9yYmlkU2NhbGluZ1ggfHwgZm9yYmlkU2NhbGluZ1kgfHwgdGhpcy5fcmVzaXplT2JqZWN0RXF1YWxseShsb2NhbE1vdXNlLCB0YXJnZXQsIHRyYW5zZm9ybSwgX2RpbSk7XG4gICAgfVxuICAgIGVsc2UgaWYgKCFieSkge1xuICAgICAgZm9yYmlkU2NhbGluZ1ggfHwgdGFyZ2V0LnNldFdpZHRoKHRyYW5zZm9ybS5uZXdXaWR0aCk7XG4gICAgICBmb3JiaWRTY2FsaW5nWSB8fCB0YXJnZXQuc2V0SGVpZ2h0KHRyYW5zZm9ybS5uZXdIZWlnaHQpO1xuICAgIH1cbiAgICBlbHNlIGlmIChieSA9PT0gJ3gnICYmICF0YXJnZXQuZ2V0KCdsb2NrVW5pU2NhbGluZycpKSB7XG4gICAgICBmb3JiaWRTY2FsaW5nWCB8fCB0YXJnZXQuc2V0V2lkdGgodHJhbnNmb3JtLm5ld1dpZHRoKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoYnkgPT09ICd5JyAmJiAhdGFyZ2V0LmdldCgnbG9ja1VuaVNjYWxpbmcnKSkge1xuICAgICAgZm9yYmlkU2NhbGluZ1kgfHwgdGFyZ2V0LnNldEhlaWdodCh0cmFuc2Zvcm0ubmV3SGVpZ2h0KTtcbiAgICB9XG4gICAgcmV0dXJuICFmb3JiaWRTY2FsaW5nWCAmJiAhZm9yYmlkU2NhbGluZ1k7XG4gICAgLy90cmFuc2Zvcm0ubmV3V2lkdGggLT0gX3N0cm9rZTtcbiAgICAvL3RyYW5zZm9ybS5uZXdIZWlnaHQgLT0gX3N0cm9rZTtcbiAgfSxcbiAgX3NldHVwQ3VycmVudFJlc2l6ZVRyYW5zZm9ybTogZnVuY3Rpb24gKGUsIHRhcmdldCkge1xuICAgIHRoaXMuX3NldHVwQ3VycmVudFNjYWxlVHJhbnNmb3JtKGUsIHRhcmdldCk7XG4gICAgdGhpcy5fY3VycmVudFRyYW5zZm9ybS5vcmlnaW5hbC5oZWlnaHQgPSB0YXJnZXQuaGVpZ2h0O1xuICAgIHRoaXMuX2N1cnJlbnRUcmFuc2Zvcm0ub3JpZ2luYWwud2lkdGggPSB0YXJnZXQud2lkdGg7XG4gIH0sXG4gIF9yZXNpemVPYmplY3RFcXVhbGx5OiBmdW5jdGlvbiAobG9jYWxNb3VzZSwgdGFyZ2V0LCB0cmFuc2Zvcm0sIF9kaW0pIHtcblxuICAgIHZhciBkaXN0ID0gbG9jYWxNb3VzZS55ICsgbG9jYWxNb3VzZS54LFxuICAgICAgbGFzdERpc3QgPSBfZGltLnkgKiB0cmFuc2Zvcm0ub3JpZ2luYWwuaGVpZ2h0IC8gdGFyZ2V0LmhlaWdodCArXG4gICAgICAgIF9kaW0ueCAqIHRyYW5zZm9ybS5vcmlnaW5hbC53aWR0aCAvIHRhcmdldC53aWR0aDtcblxuICAgIHRyYW5zZm9ybS5uZXdXaWR0aCA9IHRyYW5zZm9ybS5vcmlnaW5hbC53aWR0aCAqIGRpc3QgLyBsYXN0RGlzdDtcbiAgICB0cmFuc2Zvcm0ubmV3SGVpZ2h0ID0gdHJhbnNmb3JtLm9yaWdpbmFsLmhlaWdodCAqIGRpc3QgLyBsYXN0RGlzdDtcblxuICAgIHZhciByYXRpbyA9IHRyYW5zZm9ybS5vcmlnaW5hbC5oZWlnaHQgLyB0cmFuc2Zvcm0ub3JpZ2luYWwud2lkdGg7XG4gICAgaWYgKHJhdGlvID4gMSkge1xuICAgICAgaWYgKHRhcmdldC5taW5XaWR0aCAmJiB0cmFuc2Zvcm0ubmV3V2lkdGggPD0gdGFyZ2V0Lm1pbldpZHRoKSB7XG4gICAgICAgIHRyYW5zZm9ybS5uZXdXaWR0aCA9IHRhcmdldC5taW5XaWR0aDtcbiAgICAgICAgdHJhbnNmb3JtLm5ld0hlaWdodCA9IHRhcmdldC5taW5IZWlnaHQgKiByYXRpbztcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHRhcmdldC5taW5IZWlnaHQgJiYgdHJhbnNmb3JtLm5ld0hlaWdodCA8PSB0YXJnZXQubWluSGVpZ2h0KSB7XG4gICAgICAgIHRyYW5zZm9ybS5uZXdIZWlnaHQgPSB0YXJnZXQubWluSGVpZ2h0O1xuICAgICAgICB0cmFuc2Zvcm0ubmV3V2lkdGggPSB0YXJnZXQubWluV2lkdGggLyByYXRpbztcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0YXJnZXQuc2V0V2lkdGgodHJhbnNmb3JtLm5ld1dpZHRoKTtcbiAgICB0YXJnZXQuc2V0SGVpZ2h0KHRyYW5zZm9ybS5uZXdIZWlnaHQpO1xuICB9XG59KTtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vbW9kdWxlcy9yZXNpemFibGUuanNcbi8vIG1vZHVsZSBpZCA9IDc0XG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIlxudmFyIHV0aWxzID0gcmVxdWlyZSgnLi8uLi91dGlsL3V0aWwuanMnKTtcbnV0aWxzLm9iamVjdCA9IHJlcXVpcmUoJy4vLi4vdXRpbC9vYmplY3QuanMnKTtcblxuXG4vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcbiAqKiBEUEhpc3RvcnlcbiAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cblxuXG52YXIgRFBIaXN0b3J5ID0gZnVuY3Rpb24gKHBhcmVudCwgaW5pdEFjdGlvbikge1xuICAgIHRoaXMucGFyZW50ID0gcGFyZW50O1xuICAgIHRoaXMuY2xlYXIoaW5pdEFjdGlvbik7XG59O1xuXG5EUEhpc3RvcnkucHJvdG90eXBlLnNldFJlY29yZHMgPSBmdW5jdGlvbiAocmVjb3JkcyxjdXJyZW50KSB7XG4gIHRoaXMuY2FuVW5kbyA9IHJlY29yZHMubGVuZ3RoO1xuICB0aGlzLmNhblJlZG8gPSBmYWxzZTtcblxuICBpZighcmVjb3Jkcy5sZW5ndGgpe1xuICAgIHJlY29yZHMgPSBbe1xuICAgICAgdHlwZTogJ2luaXRpYWxpemVkJyxcbiAgICAgIGlkOiAwLFxuICAgICAgdGV4dCA6ICdpbml0aWFsaXplZCdcbiAgICB9XVxuICB9XG4gIHRoaXMucmVjb3JkcyA9IHJlY29yZHM7XG4gIHRoaXMubGVuZ3RoID0gdGhpcy5yZWNvcmRzLmxlbmd0aCA7XG4gIHRoaXMuY3VycmVudCA9IGN1cnJlbnQgPT09IHVuZGVmaW5lZCA/IHJlY29yZHMubGVuZ3RoIC0gMSA6IGN1cnJlbnQ7XG4gIHRoaXMuYWN0aXZlQWN0aW9uID0gdGhpcy5yZWNvcmRzW3RoaXMuY3VycmVudF07XG4gIHRoaXMuZmlyZShcImNoYW5nZWRcIix7YWN0aW9uOiB0aGlzLmFjdGl2ZUFjdGlvbn0pO1xuICByZXR1cm4gdGhpcztcbn07XG5cbkRQSGlzdG9yeS5wcm90b3R5cGUucmVzdG9yZSA9IGZ1bmN0aW9uICgpIHtcbiAgdGhpcy5zZXRSZWNvcmRzKHRoaXMuc2F2ZWQucmVjb3Jkcyx0aGlzLnNhdmVkLmN1cnJlbnQpO1xuICByZXR1cm4gdGhpcztcbn07XG5cbkRQSGlzdG9yeS5wcm90b3R5cGUuc2F2ZSA9IGZ1bmN0aW9uICgpIHtcbiAgdGhpcy5zYXZlZCA9IHtcbiAgICBjdXJyZW50OiB0aGlzLmN1cnJlbnQsXG4gICAgcmVjb3JkczogdXRpbHMub2JqZWN0LmNsb25lRGVlcCh0aGlzLnJlY29yZHMpXG4gIH1cbiAgcmV0dXJuIHRoaXM7XG59O1xuXG5EUEhpc3RvcnkucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24gKGluaXRBY3Rpb24pIHtcbiAgICBpZiAoaW5pdEFjdGlvbikge1xuICAgICAgICBpbml0QWN0aW9uLmlkID0gMDtcbiAgICB9IGVsc2Uge1xuICAgICAgICBpbml0QWN0aW9uID0ge1xuICAgICAgICAgICAgdHlwZTogJ2luaXRpYWxpemVkJyxcbiAgICAgICAgICAgIGlkOiAwLFxuICAgICAgICAgIHRleHQgOiAnaW5pdGlhbGl6ZWQnXG4gICAgICAgIH1cbiAgICB9XG4gICAgdGhpcy5yZWNvcmRzID0gW2luaXRBY3Rpb25dO1xuICAgIHRoaXMuY3VycmVudCA9IDA7XG4gICAgdGhpcy5jYW5VbmRvID0gZmFsc2U7XG4gICAgdGhpcy5jYW5SZWRvID0gZmFsc2U7XG4gICAgdGhpcy5hY3RpdmVBY3Rpb24gPSB0aGlzLnJlY29yZHNbdGhpcy5jdXJyZW50XTtcbiAgdGhpcy5maXJlKFwiY2hhbmdlZFwiLHthY3Rpb246IHRoaXMuYWN0aXZlQWN0aW9ufSk7XG4gIHJldHVybiB0aGlzO1xufTtcblxuXG5EUEhpc3RvcnkucHJvdG90eXBlLmFkZCA9IGZ1bmN0aW9uKGFjdGlvbil7XG5cblxuICAgIGlmICghdGhpcy5lbmFibGVkIHx8IHRoaXMucHJvY2Vzc2luZykge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGFjdGlvbi5tb21lbnQgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgICB0aGlzLmNhblVuZG8gPSB0cnVlO1xuICAgIHRoaXMuY2FuUmVkbyA9IGZhbHNlO1xuICAgIHRoaXMucmVjb3Jkcy5zcGxpY2UodGhpcy5jdXJyZW50KyAxKTtcbiAgICB0aGlzLnJlY29yZHMucHVzaChhY3Rpb24pO1xuICAgIHRoaXMubGVuZ3RoID0gdGhpcy5yZWNvcmRzLmxlbmd0aDtcbiAgICBhY3Rpb24uaWQgPSB0aGlzLmxlbmd0aCAtIDE7XG4gICAgYWN0aW9uLnRleHQgPSBhY3Rpb24udHlwZSB8fCBhY3Rpb24udGV4dDtcbiAgICB0aGlzLmN1cnJlbnQgPSB0aGlzLmxlbmd0aCAtIDE7XG5cbiAgdGhpcy5hY3RpdmVBY3Rpb24gPSB0aGlzLnJlY29yZHNbdGhpcy5jdXJyZW50XTtcbiAgdGhpcy5maXJlKFwiY2hhbmdlZFwiLHthY3Rpb246IGFjdGlvbn0pO1xuICByZXR1cm4gdGhpcztcbn07XG5EUEhpc3RvcnkucHJvdG90eXBlLmRpc2FibGUgPSBmdW5jdGlvbigpe1xuICB0aGlzLmVuYWJsZWQgPSBmYWxzZTtcbiAgcmV0dXJuIHRoaXM7XG59O1xuRFBIaXN0b3J5LnByb3RvdHlwZS5lbmFibGUgPSBmdW5jdGlvbigpe1xuICB0aGlzLmVuYWJsZWQgPSB0cnVlO1xuICByZXR1cm4gdGhpcztcbn07XG5EUEhpc3RvcnkucHJvdG90eXBlLnVuZG8gPSBmdW5jdGlvbihub0ZpcmUpe1xuICAgIHRoaXMuY2FuUmVkbyA9IHRydWU7XG4gICAgdmFyIF9hY3Rpb24gPSB0aGlzLnJlY29yZHNbdGhpcy5jdXJyZW50XTtcbiAgICB0aGlzLmN1cnJlbnQtLTtcbiAgdGhpcy5wcm9jZXNzaW5nID0gdHJ1ZTtcbiAgICBfYWN0aW9uLnVuZG8uY2FsbCh0aGlzLnBhcmVudCxfYWN0aW9uKTtcbiAgdGhpcy5wcm9jZXNzaW5nID0gZmFsc2U7XG4gICAgaWYodGhpcy5jdXJyZW50ID09IDApe1xuICAgICAgICB0aGlzLmNhblVuZG8gPSBmYWxzZTtcbiAgICB9XG4gICAgaWYoIW5vRmlyZSl7XG4gICAgICB0aGlzLmFjdGl2ZUFjdGlvbiA9IHRoaXMucmVjb3Jkc1t0aGlzLmN1cnJlbnRdO1xuICAgICAgdGhpcy5maXJlKFwiY2hhbmdlZFwiLHthY3Rpb246IF9hY3Rpb259KTtcbiAgICB9XG4gIHJldHVybiB0aGlzO1xufTtcblxuRFBIaXN0b3J5LnByb3RvdHlwZS5nb3RvID0gZnVuY3Rpb24oaW5kZXgpe1xuICAgIGlmKGluZGV4ID09IHRoaXMuY3VycmVudClyZXR1cm47XG4gICAgaWYoaW5kZXggPCB0aGlzLmN1cnJlbnQpe1xuICAgICAgICBmb3IodmFyIGkgPSB0aGlzLmN1cnJlbnQgLSBpbmRleCA7aS0tOyApe1xuICAgICAgICAgICAgdGhpcy51bmRvKHRydWUpO1xuICAgICAgICB9XG4gICAgfWlmKGluZGV4ID4gdGhpcy5jdXJyZW50KXtcbiAgICAgICAgZm9yKHZhciBpID0gaW5kZXggLSB0aGlzLmN1cnJlbnQgO2ktLTsgKXtcbiAgICAgICAgICAgIHRoaXMucmVkbyh0cnVlKTtcbiAgICAgICAgfVxuICAgIH1cbiAgdGhpcy5hY3RpdmVBY3Rpb24gPSB0aGlzLnJlY29yZHNbdGhpcy5jdXJyZW50XTtcbiAgdGhpcy5maXJlKFwiY2hhbmdlZFwiLHthY3Rpb246IHRoaXMuYWN0aXZlQWN0aW9ufSk7XG4gIHJldHVybiB0aGlzO1xufTtcblxuRFBIaXN0b3J5LnByb3RvdHlwZS5yZWRvID0gZnVuY3Rpb24obm9GaXJlKXtcbiAgICBpZih0aGlzLmN1cnJlbnQgPT0gdGhpcy5sZW5ndGggLSAxKXtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgdGhpcy5wcm9jZXNzaW5nID0gdHJ1ZTtcbiAgICB0aGlzLmNhblVuZG8gPSB0cnVlO1xuICAgIHRoaXMuY3VycmVudCsrO1xuICAgIHZhciBfYWN0aW9uID0gdGhpcy5yZWNvcmRzW3RoaXMuY3VycmVudF07XG5cbiAgICBfYWN0aW9uLnJlZG8uY2FsbCh0aGlzLnBhcmVudCxfYWN0aW9uKTtcblxuICAgIGlmKHRoaXMuY3VycmVudCA9PSB0aGlzLmxlbmd0aCAtIDEpe1xuICAgICAgICB0aGlzLmNhblJlZG8gPSBmYWxzZTtcbiAgICB9XG4gIHRoaXMucHJvY2Vzc2luZyA9IGZhbHNlO1xuICBpZighbm9GaXJlKSB7XG4gICAgdGhpcy5hY3RpdmVBY3Rpb24gPSB0aGlzLnJlY29yZHNbdGhpcy5jdXJyZW50XTtcbiAgICB0aGlzLmZpcmUoXCJjaGFuZ2VkXCIse2FjdGlvbjogX2FjdGlvbn0pO1xuICB9XG4gIHJldHVybiB0aGlzO1xufTtcbnV0aWxzLm9ic2VydmFibGUoRFBIaXN0b3J5LnByb3RvdHlwZSk7XG5tb2R1bGUuZXhwb3J0cyA9IERQSGlzdG9yeTtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vcGx1Z2lucy9oaXN0b3J5LmpzXG4vLyBtb2R1bGUgaWQgPSA3NVxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCJcbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLlBhdGhHcm91cC5wcm90b3R5cGUse1xuICBpbml0aWFsaXplX292ZXJ3cml0dGVuOiBmYWJyaWMuUGF0aEdyb3VwLnByb3RvdHlwZS5pbml0aWFsaXplLFxuICBpbml0aWFsaXplOiBmdW5jdGlvbihwYXRocywgb3B0aW9ucyl7XG5cbiAgICBpZihwYXRocy5jb25zdHJ1Y3RvciAhPSBBcnJheSl7XG4gICAgICBvcHRpb25zID0gcGF0aHMudG9PYmplY3QoKTtcbiAgICAgIGRlbGV0ZSBvcHRpb25zLnBhdGhzO1xuICAgICAgcGF0aHMgPSBwYXRocy5wYXRocztcbiAgICB9XG5cbiAgICB0aGlzLmluaXRpYWxpemVfb3ZlcndyaXR0ZW4ocGF0aHMsIG9wdGlvbnMpO1xuICB9LFxuICBleHRyYWN0Q29sb3JzOiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIF9jb2xvcnMgPSB7fTtcbiAgICB2YXIgX3BhdGhzID0gdGhpcy5wYXRocztcbiAgICBmb3IgKHZhciBpIGluIF9wYXRocykge1xuICAgICAgaWYgKF9wYXRoc1tpXS5maWxsLnR5cGUpIHtcbiAgICAgICAgZm9yICh2YXIgaiBpbiBfcGF0aHNbaV0uZmlsbC5jb2xvclN0b3BzKSB7XG4gICAgICAgICAgdmFyIF9jb2xvciA9IF9wYXRoc1tpXS5maWxsLmNvbG9yU3RvcHNbal0uY29sb3I7XG4gICAgICAgICAgaWYgKCFfY29sb3JzW19jb2xvcl0pIF9jb2xvcnNbX2NvbG9yXSA9IFtdO1xuICAgICAgICAgIF9jb2xvcnNbX2NvbG9yXS5wdXNoKHtvYmplY3Q6IF9wYXRoc1tpXSwgc3RvcDogX3BhdGhzW2ldLmZpbGwuY29sb3JTdG9wc1tqXX0pO1xuICAgICAgICB9XG5cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciBfY29sb3IgPSBfcGF0aHNbaV0uZmlsbDtcbiAgICAgICAgaWYgKCFfY29sb3JzW19jb2xvcl0pIF9jb2xvcnNbX2NvbG9yXSA9IFtdO1xuICAgICAgICBfY29sb3JzW19jb2xvcl0ucHVzaCh7b2JqZWN0OiBfcGF0aHNbaV0sIGNvbG9yOiBfcGF0aHNbaV19KTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIF9jb2xvcnM7XG4gIH1cbn0pXG5cbmZhYnJpYy5QYXRoR3JvdXAuZnJvbUVsZW1lbnRzID0gZnVuY3Rpb24gKGVsZW1lbnRzLCBvYmplY3QsIHVybCkge1xuICB2YXIgX29wdGlvbnMgPSB7XG4gICAgdG9CZVBhcnNlZDogdHJ1ZSxcbiAgICAvL29yaWdpblg6IFwiY2VudGVyXCIsXG4gICAgLy9vcmlnaW5ZOiBcImNlbnRlclwiXG4gIH07XG5cbiAgLy/RgdC80LXRidCw0LXQvCDRjdC70LXQvNC10L3RgtGLINGC0LDQuiwg0YfRgtC+0LHRiyDQuNGFINC60L7QvtGA0LjQvdCw0YLRiyDQvdCw0YfQuNC90LDQu9C40YHRjCDQvtGCIDAuMFxuICBpZiAoZWxlbWVudHMubGVuZ3RoKSB7XG5cbiAgICB2YXIgbWluWCA9IEluZmluaXR5LFxuICAgICAgbWluWSA9IEluZmluaXR5O1xuICAgIGZvciAodmFyIGkgaW4gZWxlbWVudHMpIHtcbiAgICAgIG1pblggPSBNYXRoLm1pbihlbGVtZW50c1tpXS5sZWZ0LCBtaW5YKTtcbiAgICAgIG1pblkgPSBNYXRoLm1pbihlbGVtZW50c1tpXS50b3AsIG1pblkpO1xuICAgIH1cblxuXG4gICAgbWluWCA9IE1hdGgubWF4KG1pblgsIDApO1xuICAgIG1pblkgPSBNYXRoLm1heChtaW5ZLCAwKTtcbiAgICAvKiBmb3IgKHZhciBpIGluIGVsZW1lbnRzKSB7XG4gICAgIGVsZW1lbnRzW2ldLnRyYW5zbGF0ZSgtbWluWCwgLW1pblkpO1xuICAgICBlbGVtZW50c1tpXS5sZWZ0IC09IG1pblg7XG4gICAgIGVsZW1lbnRzW2ldLnBhdGhPZmZzZXQueCAtPSBtaW5YO1xuICAgICBlbGVtZW50c1tpXS50b3AgLT0gbWluWTtcbiAgICAgZWxlbWVudHNbaV0ucGF0aE9mZnNldC55IC09IG1pblk7XG4gICAgIH0qL1xuICB9XG5cbiAgdmFyIGVsID0gZmFicmljLnV0aWwuZ3JvdXBTVkdFbGVtZW50cyhlbGVtZW50cywgX29wdGlvbnMsIHVybCk7XG5cbiAgdmFyIHNjYWxlWCA9IG9iamVjdC53aWR0aCA/IG9iamVjdC53aWR0aCAvIGVsLndpZHRoIDogbnVsbCxcbiAgICBzY2FsZVkgPSBvYmplY3QuaGVpZ2h0ID8gb2JqZWN0LmhlaWdodCAvIGVsLmhlaWdodCA6IG51bGw7XG4gIGlmIChzY2FsZVggJiYgIXNjYWxlWSkge1xuICAgIHNjYWxlWSA9IHNjYWxlWDtcbiAgfVxuICBpZiAoc2NhbGVZICYmICFzY2FsZVgpIHtcbiAgICBzY2FsZVggPSBzY2FsZVk7XG4gIH1cbiAgaWYgKCFzY2FsZVkgJiYgIXNjYWxlWCkge1xuICAgIHNjYWxlWCA9IHNjYWxlWSA9IDE7XG4gIH1cblxuICBkZWxldGUgb2JqZWN0LmhlaWdodDtcbiAgZGVsZXRlIG9iamVjdC53aWR0aDtcbiAgZWwuc2V0KGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQob2JqZWN0LCB7XG4gICAgLy9sZWZ0OiAwLCB0b3A6IDAsXG4gICAgc2NhbGVYOiBzY2FsZVgsXG4gICAgc2NhbGVZOiBzY2FsZVlcbiAgfSkpO1xuICBlbC5zZXRMZWZ0KG9iamVjdC5sZWZ0KTtcbiAgZWwuc2V0VG9wKG9iamVjdC50b3ApO1xuICByZXR1cm4gZWw7XG59O1xuXG4vLyBmYWJyaWMuUGF0aEdyb3VwLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbihjdHgsbm9UcmFuc2Zvcm0pIHtcbi8vICAgaWYgKCF0aGlzLnZpc2libGUpIHtcbi8vICAgICByZXR1cm47XG4vLyAgIH1cbi8vICAgdmFyIHggPSBub1RyYW5zZm9ybSA/IDAgOiAtIHRoaXMud2lkdGggKiB0aGlzLnNjYWxlWCAvIDIsXG4vLyAgICAgeSA9IG5vVHJhbnNmb3JtID8gMCA6IC0gdGhpcy5oZWlnaHQgKiB0aGlzLnNjYWxlWSAvIDI7XG4vL1xuLy8gICBjdHguc2F2ZSgpO1xuLy8gICBjdHgudHJhbnNsYXRlKHgseSk7XG4vL1xuLy8gICBpZiAodGhpcy50cmFuc2Zvcm1NYXRyaXgpIHtcbi8vICAgICBjdHgudHJhbnNmb3JtLmFwcGx5KGN0eCwgdGhpcy50cmFuc2Zvcm1NYXRyaXgpO1xuLy8gICB9XG4vLyAgIHRoaXMudHJhbnNmb3JtKGN0eCk7XG4vL1xuLy8gICB0aGlzLl9zZXRTaGFkb3coY3R4KTtcbi8vICAgdGhpcy5jbGlwVG8gJiYgZmFicmljLnV0aWwuY2xpcENvbnRleHQodGhpcywgY3R4KTtcbi8vICAgY3R4LnRyYW5zbGF0ZSgtdGhpcy53aWR0aC8yLCAtdGhpcy5oZWlnaHQvMik7XG4vLyAgIGZvciAodmFyIGkgPSAwLCBsID0gdGhpcy5wYXRocy5sZW5ndGg7IGkgPCBsOyArK2kpIHtcbi8vICAgICB0aGlzLnBhdGhzW2ldLnJlbmRlcihjdHgsIHRydWUpO1xuLy8gICB9XG4vLyAgIHRoaXMuY2xpcFRvICYmIGN0eC5yZXN0b3JlKCk7XG4vLyAgIGN0eC5yZXN0b3JlKCk7XG4vLyB9XG5cblxuXG5cblxuXG5mYWJyaWMuUGF0aEdyb3VwLmZyb21VUkwgPSBmdW5jdGlvbiAodXJsLCBjYWxsYmFjaywgb2JqZWN0KSB7XG5cbiAgZmFicmljLmxvYWRTVkdGcm9tVVJMKHVybCxmdW5jdGlvbihlbHMpe1xuXG4gICAgdmFyIGVsID0gbmV3IGZhYnJpYy5QYXRoR3JvdXAoZWxzLCB7dG9CZVBhcnNlZDp0cnVlfSk7XG5cbiAgICAvLyAvL9GB0LzQtdGJ0LDQtdC8INGN0LvQtdC80LXQvdGC0Ysg0YLQsNC6LCDRh9GC0L7QsdGLINC40YUg0LrQvtC+0YDQuNC90LDRgtGLINC90LDRh9C40L3QsNC70LjRgdGMINC+0YIgMC4wXG4gICAgLy8gaWYgKGVsLnBhdGhzLmxlbmd0aCkge1xuICAgIC8vXG4gICAgLy8gICB2YXIgbWluWCA9IEluZmluaXR5LFxuICAgIC8vICAgICBtaW5ZID0gSW5maW5pdHk7XG4gICAgLy8gICB2YXIgbWF4WCA9IC1JbmZpbml0eSxcbiAgICAvLyAgICAgbWF4WSA9IC1JbmZpbml0eTtcbiAgICAvL1xuICAgIC8vICAgZm9yICh2YXIgaSBpbiBlbC5wYXRocykge1xuICAgIC8vICAgICB2YXIgX3AgPSBlbC5wYXRoc1tpXTtcbiAgICAvLyAgICAgbWluWCA9IE1hdGgubWluKF9wLmxlZnQsIG1pblgpO1xuICAgIC8vICAgICBtaW5ZID0gTWF0aC5taW4oX3AudG9wLCBtaW5ZKTtcbiAgICAvLyAgICAgbWF4WCA9IE1hdGgubWF4KF9wLmxlZnQgKyBfcC53aWR0aCwgbWF4WCk7XG4gICAgLy8gICAgIG1heFkgPSBNYXRoLm1heChfcC50b3AgKyBfcC5oZWlnaHQsIG1heFkpO1xuICAgIC8vICAgfVxuICAgIC8vXG4gICAgLy8gICB2YXIgX1cgPSBtYXhYIC0gbWluWDtcbiAgICAvLyAgIHZhciBfSCA9IG1heFkgLSBtaW5ZO1xuICAgIC8vICAgLy9cbiAgICAvLyAgIC8vXG4gICAgLy8gICAvLyBtaW5YID0gTWF0aC5tYXgobWluWCwgMCk7XG4gICAgLy8gICAvLyBtaW5ZID0gTWF0aC5tYXgobWluWSwgMCk7XG4gICAgLy8gICAvKiBmb3IgKHZhciBpIGluIGVsZW1lbnRzKSB7XG4gICAgLy8gICAgZWxlbWVudHNbaV0udHJhbnNsYXRlKC1taW5YLCAtbWluWSk7XG4gICAgLy8gICAgZWxlbWVudHNbaV0ubGVmdCAtPSBtaW5YO1xuICAgIC8vICAgIGVsZW1lbnRzW2ldLnBhdGhPZmZzZXQueCAtPSBtaW5YO1xuICAgIC8vICAgIGVsZW1lbnRzW2ldLnRvcCAtPSBtaW5ZO1xuICAgIC8vICAgIGVsZW1lbnRzW2ldLnBhdGhPZmZzZXQueSAtPSBtaW5ZO1xuICAgIC8vICAgIH0qL1xuICAgIC8vIH1lbHNle1xuICAgIC8vICAgX1cgPSAxO1xuICAgIC8vICAgX0ggPSAxO1xuICAgIC8vIH1cblxuICAgIHZhciBzY2FsZVggPSBvYmplY3Qud2lkdGggPyBvYmplY3Qud2lkdGggLyBlbC53aWR0aCA6IG51bGwsXG4gICAgICBzY2FsZVkgPSBvYmplY3QuaGVpZ2h0ID8gb2JqZWN0LmhlaWdodCAvIGVsLmhlaWdodCA6IG51bGw7XG4gICAgaWYgKHNjYWxlWCAmJiAhc2NhbGVZKSB7XG4gICAgICBzY2FsZVkgPSBzY2FsZVg7XG4gICAgfVxuICAgIGlmIChzY2FsZVkgJiYgIXNjYWxlWCkge1xuICAgICAgc2NhbGVYID0gc2NhbGVZO1xuICAgIH1cbiAgICBpZiAoIXNjYWxlWSAmJiAhc2NhbGVYKSB7XG4gICAgICBzY2FsZVggPSBzY2FsZVkgPSAxO1xuICAgIH1cbiAgICAvLyBjb25zb2xlLmxvZyhvYmplY3Qud2lkdGgsZWwud2lkdGgsb2JqZWN0LmhlaWdodCxlbC5oZWlnaHQpXG4gICAgLy8gY29uc29sZS5sb2coZWwpO1xuICAgIGVsLnNldCgge1xuICAgICAgc2NhbGVYOiBzY2FsZVggLFxuICAgICAgc2NhbGVZOiBzY2FsZVlcbiAgICB9KTtcblxuICAgIGNhbGxiYWNrKGVsKTtcbiAgfSk7XG5cbiAgLy8gZmFicmljLmxvYWRTVkdGcm9tVVJMKHVybCxmdW5jdGlvbihlbHMpe1xuICAvLyAgIGNhbGxiYWNrKGZhYnJpYy5QYXRoR3JvdXAuZnJvbUVsZW1lbnRzKGVscywgb2JqZWN0KSk7XG4gIC8vIH0pO1xufTtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vc2hhcGVzL1BhdGhHcm91cC5qc1xuLy8gbW9kdWxlIGlkID0gNzZcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiaWYoISQubWluaWNvbG9ycyl7XG4gICAgcmVxdWlyZShcIi4uLy4uL3BsdWdpbnMvJC5taW5pY29sb3JzXCIpO1xufVxuXG5pZih0eXBlb2YgVG9vbGJhciA9PT0gXCJ1bmRlZmluZWRcIil7XG4gIHZhciBUb29sYmFyID0gcmVxdWlyZShcIi4uL3NyYy90b29sYmFyXCIpO1xufVxuXG5Ub29sYmFyLnByb3RvdHlwZS5jb2xvcnBpY2tlciA9IGZ1bmN0aW9uIChlbCwgb3B0aW9ucykge1xuICBvcHRpb25zLmZvcm1hdCA9ICdyZ2InO1xuICBvcHRpb25zLm9wYWNpdHkgPSB0cnVlO1xuICBlbC5taW5pY29sb3JzKG9wdGlvbnMpO1xufTtcblxuVG9vbGJhci5wcm90b3R5cGUuY29sb3JwaWNrZXJPcHRpb25zID0ge1xuICBwb3NpdGlvbjogXCJyaWdodCBib3R0b21cIlxufTtcblxuVG9vbGJhci5wcm90b3R5cGUudG9vbHMuY29sb3IgPSB7XG4gIHRlbXBsYXRlOlxuICAgICc8ZGl2IGNsYXNzPVwib2JqZWN0LW1lbnUtaXRlbVwiIHRpdGxlPVwie3RpdGxlfVwiPicgK1xuICAgICc8ZGl2IGNsYXNzPVwiYnRuIGJ1dHRvbi17aWR9IHtjbGFzc05hbWV9XCI+JyArXG4gICAgJzxpbnB1dCB0eXBlPVwidGV4dFwiIGRhdGEtZm9ybWF0PVwicmdiYVwiIGRhdGEtb3BhY2l0eT1cInRydWVcIiBkYXRhLXRleHQ9XCJ0cnVlXCIgZGF0YS1jb250cm9sPVwic2F0dXJhdGlvblwiIGRhdGEtc3dhdGNoZXM9XCIjZmZmfCMwMDB8I2YwMHwjMGYwfCMwMGZ8I2ZmMHwjMGZmXCIgIHZhbHVlPVwie3ZhbHVlQ3VycmVudH1cIiB0cmFuc2NsdWRlPicsXG4gIHBvc3Q6IGZ1bmN0aW9uICgkaXRlbSwgZGF0YSwgb3B0aW9ucywgdHJhbnNjbHVkZSkge1xuICAgIHZhciB0YXJnZXQgPSBkYXRhLnRhcmdldDtcblxuICAgIHZhciBfdmlzaWJsZSA9IGZhbHNlO1xuICAgIHRoaXMuY29sb3JwaWNrZXIodHJhbnNjbHVkZSwge1xuICAgICAgLy8gdmFsdWU6ICAgICAgICBkYXRhLnZhbHVlLmdldCgpICwvL3x8IGRhdGEudmFsdWUuZ2V0KCksXG4gICAgICBkZWZhdWx0VmFsdWU6IC8qZGF0YS52YWx1ZS5kZWZhdWx0VmFsdWUgfHwqLyBkYXRhLnZhbHVlLmdldCgpLFxuICAgICAgY29udHJvbDogICAgICB0cmFuc2NsdWRlLmF0dHIoJ2RhdGEtY29udHJvbCcpIHx8ICdodWUnLFxuICAgICAgZm9ybWF0OiAgICAgICB0cmFuc2NsdWRlLmF0dHIoJ2RhdGEtZm9ybWF0JykgfHwgJ2hleCcsXG4gICAgICBrZXl3b3JkczogICAgIHRyYW5zY2x1ZGUuYXR0cignZGF0YS1rZXl3b3JkcycpIHx8ICcnLFxuICAgICAgaW5saW5lOiAgICAgICB0cmFuc2NsdWRlLmF0dHIoJ2RhdGEtaW5saW5lJykgPT09ICd0cnVlJyxcbiAgICAgIGxldHRlckNhc2U6ICAgdHJhbnNjbHVkZS5hdHRyKCdkYXRhLWxldHRlckNhc2UnKSB8fCAnbG93ZXJjYXNlJyxcbiAgICAgIG9wYWNpdHk6ICAgICAgdHJhbnNjbHVkZS5hdHRyKCdkYXRhLW9wYWNpdHknKSxcbiAgICAgIHBvc2l0aW9uOiAgICAgdHJhbnNjbHVkZS5hdHRyKCdkYXRhLXBvc2l0aW9uJykgfHwgdGhpcy5jb2xvcnBpY2tlck9wdGlvbnMucG9zaXRpb24sXG4gICAgICBzd2F0Y2hlczogICAgIHRyYW5zY2x1ZGUuYXR0cignZGF0YS1zd2F0Y2hlcycpID8gdHJhbnNjbHVkZS5hdHRyKCdkYXRhLXN3YXRjaGVzJykuc3BsaXQoJ3wnKSA6IFtdLFxuICAgICAgdGV4dDogICAgIHRyYW5zY2x1ZGUuYXR0cignZGF0YS10ZXh0JyksXG4gICAgICBoaWRlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIF92aXNpYmxlID0gZmFsc2VcbiAgICAgIH0sXG4gICAgICBzaG93OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIF92aXNpYmxlID0gdHJ1ZTtcbiAgICAgIH0sXG4gICAgICBjaGFuZ2U6IGZ1bmN0aW9uICh2YWx1ZSwgb3BhY2l0eSkge1xuICAgICAgICBkYXRhLnZhbHVlLnNldCh2YWx1ZSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB2YXIgX2VsID0gJCh0cmFuc2NsdWRlLnBhcmVudHMoKVswXSkuZmluZChcIi5taW5pY29sb3JzLXBhbmVsXCIpO1xuXG4gICAgdmFyIF9ISURFID0gZnVuY3Rpb24oZSl7XG4gICAgICBpZihfdmlzaWJsZSAmJiAkKGUudGFyZ2V0KS5wYXJlbnRzKCkuaW5kZXgoX2VsKSA9PSAtMSl7XG4gICAgICAgIHRyYW5zY2x1ZGUubWluaWNvbG9ycyhcImhpZGVcIik7XG4gICAgICB9XG4gICAgfTtcbiAgICAkKFwiYm9keVwiKS5vbihcIm1vdXNlZG93blwiLF9ISURFKVxuICB9XG59O1xuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi4vdG9vbGJhci9tb2R1bGVzL3Rvb2xiYXIuY29sb3JzLmpzXG4vLyBtb2R1bGUgaWQgPSA3N1xuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCJcbmlmKHR5cGVvZiBUb29sYmFyID09PSBcInVuZGVmaW5lZFwiKXtcbiAgdmFyIFRvb2xiYXIgPSByZXF1aXJlKFwiLi4vc3JjL3Rvb2xiYXJcIik7XG59XG5cblRvb2xiYXIucHJvdG90eXBlLmNvbG9ycGlja2VyID0gZnVuY3Rpb24gKGVsLCBvcHRpb25zKSB7XG4gIG9wdGlvbnMuZm9ybWF0ID0gJ3JnYic7XG4gIG9wdGlvbnMub3BhY2l0eSA9IHRydWU7XG4gIGVsLm1pbmljb2xvcnMob3B0aW9ucyk7XG59O1xuXG5Ub29sYmFyLnByb3RvdHlwZS50b29scy5lZmZlY3QgPSB7XG4gIHNjb3BlOiBmdW5jdGlvbiAoZGF0YSwgb3B0aW9ucykge1xuICAgIHJldHVybiB7XG4gICAgICBidXR0b25zVGl0bGU6IG9wdGlvbnMuYnV0dG9ucyAmJiBvcHRpb25zLmJ1dHRvbnMudGl0bGUgfHwgZmFsc2UsXG4gICAgICBpc1BhcmFtZXRlcnM6ICEhZGF0YS5hY3Rpb25QYXJhbWV0ZXJzLFxuICAgICAgYnV0dG9uc2NDbGFzc05hbWU6IChvcHRpb25zLmJ1dHRvbnMgJiYgb3B0aW9ucy5idXR0b25zLmNsYXNzTmFtZSB8fCAnJylcbiAgICB9XG4gIH0sXG4gIHRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cIm9iamVjdC1tZW51LWl0ZW1cIiB0aXRsZT1cInt0aXRsZX1cIj4nICtcbiAgICAgICc8YnV0dG9uIGNsYXNzPVwiYnRuIGJ1dHRvbi17aWR9IHtjbGFzc05hbWV9IHtidXR0b25zY0NsYXNzTmFtZX1cIj4nICtcbiAgICAgICc8c3BhbiBkcC1pZj1cImJ1dHRvbnNUaXRsZVwiIGNsYXNzPVwiYnV0dG9uLXRpdGxlXCI+e3RpdGxlfTwvc3Bhbj4nICtcbiAgICAgICc8L2J1dHRvbj4nICtcbiAgICAgICc8ZGl2IGRwLWlmPVwiaXNQYXJhbWV0ZXJzXCIgY2xhc3M9XCJtZW51LWFjdGlvbi1wYXJhbWV0ZXJzXCIgc3R5bGU9XCJkaXNwbGF5OiBub25lXCIgdHJhbnNjbHVkZT48L2Rpdj4nICtcbiAgICAnPC9kaXY+JyxcbiAgICBwb3N0OiBmdW5jdGlvbiAoJGl0ZW0sIGRhdGEsIG9wdGlvbnMsIHRyYW5zY2x1ZGUpIHtcblxuICAgIGlmKGRhdGEuY29udGFpbmVyKXtcbiAgICAgIHRyYW5zY2x1ZGUgPSAkKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGRhdGEuY29udGFpbmVyKSk7XG4gICAgfVxuXG4gICAgdmFyICR0cGw7XG4gICAgdmFyIGZvbyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmIChkYXRhLmVmZmVjdFRwbCkge1xuICAgICAgICAkdHBsID0gJChkYXRhLmVmZmVjdFRwbCk7XG4gICAgICAgIHRyYW5zY2x1ZGUuaHRtbCgkdHBsKTtcbiAgICAgIH1cbiAgICAgIGlmIChkYXRhLmFjdGlvblBhcmFtZXRlcnNJZCkge1xuICAgICAgICAkdHBsID0gJChcIiNcIiArIGRhdGEuYWN0aW9uUGFyYW1ldGVyc0lkKS5jbG9uZSgpO1xuICAgICAgICB0cmFuc2NsdWRlLmh0bWwoJHRwbCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gZGF0YS5hY3Rpb25QYXJhbWV0ZXJzLmNhbGwoZGF0YS50YXJnZXQsIHRyYW5zY2x1ZGUsIGRhdGEsIG9wdGlvbnMpO1xuICAgIH07XG4gICAgdGhpcy50b2dnbGVCeUJ1dHRvbigkaXRlbSwgdHJhbnNjbHVkZSwgZm9vICxkYXRhKTtcbiAgfVxufTtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4uL3Rvb2xiYXIvbW9kdWxlcy90b29sYmFyLmVmZmVjdC5qc1xuLy8gbW9kdWxlIGlkID0gNzhcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiXG5pZighJC5mb250U2VsZWN0b3Ipe1xuICByZXF1aXJlKFwiLi4vLi4vcGx1Z2lucy8kLmZvbnRTZWxlY3RvclwiKTtcbn1cblxuaWYodHlwZW9mIFRvb2xiYXIgPT09IFwidW5kZWZpbmVkXCIpe1xuICB2YXIgVG9vbGJhciA9IHJlcXVpcmUoXCIuLi9zcmMvdG9vbGJhclwiKTtcbn1cblxuVG9vbGJhci5wcm90b3R5cGUuZm9udHMgPSBbXG4gICdBcmlhbCxIZWx2ZXRpY2Esc2Fucy1zZXJpZicsXG4gICdBcmlhbCBCbGFjayxHYWRnZXQsc2Fucy1zZXJpZicsXG4gICdDb21pYyBTYW5zIE1TLGN1cnNpdmUnLFxuICAnQ291cmllciBOZXcsQ291cmllcixtb25vc3BhY2UnLFxuICAnR2VvcmdpYSxzZXJpZicsXG4gICdJbXBhY3QsQ2hhcmNvYWwsc2Fucy1zZXJpZicsXG4gICdMdWNpZGEgQ29uc29sZSxNb25hY28sbW9ub3NwYWNlJyxcbiAgJ0x1Y2lkYSBTYW5zIFVuaWNvZGUsTHVjaWRhIEdyYW5kZSxzYW5zLXNlcmlmJyxcbiAgJ1BhbGF0aW5vIExpbm90eXBlLEJvb2sgQW50aXF1YSxQYWxhdGlubyxzZXJpZicsXG4gICdUYWhvbWEsR2VuZXZhLHNhbnMtc2VyaWYnLFxuICAnVGltZXMgTmV3IFJvbWFuLFRpbWVzLHNlcmlmJyxcbiAgJ1RyZWJ1Y2hldCBNUyxIZWx2ZXRpY2Esc2Fucy1zZXJpZicsXG4gICdWZXJkYW5hLEdlbmV2YSxzYW5zLXNlcmlmJyxcbiAgJ0dpbGwgU2FucyxHZW5ldmEsc2Fucy1zZXJpZidcbl07XG5cblxuVG9vbGJhci5wcm90b3R5cGUudG9vbHMuZm9udEZhbWlseSA9IHtcbiAgc2NvcGU6IGZ1bmN0aW9uIChkYXRhLCBvcHRpb25zKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIC8vY3VycmVudFZhbHVlOiBkYXRhLnZhbHVlLmdldCgpLFxuICAgICAgb25jaGFuZ2U6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGRhdGEudmFsdWUuc2V0KHBhcnNlRmxvYXQoJChlLnRhcmdldCkudmFsKCkpKTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIHRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cIm9iamVjdC1tZW51LWl0ZW0gb2JqZWN0LW1lbnUtZm9udC1mYW1pbHlcIiB0aXRsZT1cInt0aXRsZX1cIj4nICtcbiAgJzxkaXYgY2xhc3M9XCJmb250U2VsZWN0XCIgdHJhbnNjbHVkZT48ZGl2IGNsYXNzPVwiYXJyb3ctZG93blwiPicsXG4gICAgcG9zdDogZnVuY3Rpb24gKCRpdGVtLCBkYXRhLCBvcHRpb25zLCB0cmFuc2NsdWRlKSB7XG5cbiAgICB0cmFuc2NsdWRlLmZvbnRTZWxlY3Rvcih7XG4gICAgICAnaGlkZV9mYWxsYmFja3MnOiB0cnVlLFxuICAgICAgJ2luaXRpYWwnOiBkYXRhLnZhbHVlLmdldCgpLC8vJ0NvdXJpZXIgTmV3LENvdXJpZXIgTmV3LENvdXJpZXIsbW9ub3NwYWNlJyxcbiAgICAgICdzZWxlY3RlZCc6IGRhdGEudmFsdWUuc2V0LmJpbmQoZGF0YS50YXJnZXQpLFxuICAgICAgJ2ZvbnRzJzogZGF0YS5kYXRhXG4gICAgfSk7XG4gIH1cbn07XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuLi90b29sYmFyL21vZHVsZXMvdG9vbGJhci5mb250cy5qc1xuLy8gbW9kdWxlIGlkID0gNzlcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiO1xuaWYodHlwZW9mIFRvb2xiYXIgPT09IFwidW5kZWZpbmVkXCIpe1xuICB2YXIgVG9vbGJhciA9IHJlcXVpcmUoXCIuLi9zcmMvdG9vbGJhclwiKTtcbn1cblxuVG9vbGJhci5wcm90b3R5cGUudXBkYXRlU2VsZWN0ZWRPcHRpb24gPSBmdW5jdGlvbihkYXRhKXtcbiAgdmFyICRjaGVja2VkID0gZGF0YS4kaXRlbS5maW5kKFwiOmNoZWNrZWRcIik7XG4gIHZhciAkY2hlY2tlZE9wdGlvbkVsID0gJCgkY2hlY2tlZC5wYXJlbnRzKClbMF0pO1xuXG5cbiAgdmFyIHNlbE9wdGlvbiA9IGRhdGEuJGl0ZW0uZmluZCgnLmJ0bi1zZWxlY3RlZC1vcHRpb24nKTtcbiAgc2VsT3B0aW9uLmh0bWwoICRjaGVja2VkT3B0aW9uRWwuZmluZChcImxhYmVsXCIpWzBdLm91dGVySFRNTCApO1xufTtcblxuVG9vbGJhci5wcm90b3R5cGUudG9vbHMub3B0aW9uID0ge1xuICBzY29wZTogZnVuY3Rpb24gKGRhdGEsIG9wdGlvbnMpIHtcbiAgICB2YXIgX3NlbGYgPSB0aGlzO1xuICAgIHJldHVybiB7XG4gICAgICBwYXJlbnRJZDogZGF0YS5wYXJlbnQuaWQsXG4gICAgICB2YWx1ZUN1cnJlbnQ6IGRhdGEucGFyZW50LnZhbHVlLmdldCgpID09PSBkYXRhLm9wdGlvbixcbiAgICAgIG9uY2hhbmdlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8v0L7Qv9GC0LjQvNC40LfQuNGA0L7QstCw0YLRjFxuXG4gICAgICAgIHZhciAkY2hlY2tlZCA9IGRhdGEuJGl0ZW0uZmluZChcIjpjaGVja2VkXCIpO1xuICAgICAgICB2YXIgX3ZhbHVlID0gJGNoZWNrZWQudmFsKCk7XG4gICAgICAgIGlmIChfdmFsdWUgPT0gZGF0YS5vcHRpb24pIHtcbiAgICAgICAgICBkYXRhLnBhcmVudC52YWx1ZS5zZXQoX3ZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgICBfc2VsZi51cGRhdGVTZWxlY3RlZE9wdGlvbihkYXRhLnBhcmVudCk7XG4gICAgICB9XG4gICAgfVxuICB9LFxuICB0ZW1wbGF0ZTpcbiAgICAnPGRpdiBjbGFzcz1cIm9iamVjdC1tZW51LWl0ZW0gb2JqZWN0LW1lbnUtb3B0aW9uIFwiIHRpdGxlPVwie3RpdGxlfVwiID4nICtcbiAgICAnPGlucHV0IHR5cGU9XCJyYWRpb1wiIGlkPVwidG9vbC17aWR9XCIgZHAtY2hlY2tlZD1cInt2YWx1ZUN1cnJlbnR9XCIgbmFtZT1cIntwYXJlbnRJZH1cIiB2YWx1ZT1cIntvcHRpb259XCIgb25jaGFuZ2U9XCJvbmNoYW5nZSgpXCI+JyArXG4gICAgJzxsYWJlbCBjbGFzcz1cImJ0biBidXR0b24te2lkfSB7Y2xhc3NOYW1lfVwiIGZvcj1cInRvb2wte2lkfVwiPicgK1xuICAgICAgJzxpbWcgZHAtaWY9XCJpY29uXCIgZHAtc3JjPVwiaWNvblwiPicgK1xuICAgICAgJzxzcGFuIGRwLWluY2x1ZGU9XCJzdmdcIiBkcC1pZj1cInN2Z1wiPjwvc3Bhbj4nICtcbiAgICAgICc8c3BhbiBkcC1pZj1cInRpdGxlXCIgY2xhc3M9XCJvcHRpb24tdGl0bGVcIj57dGl0bGV9PC9zcGFuPidcbn07XG5cblRvb2xiYXIucHJvdG90eXBlLnRvb2xzLm9wdGlvbnMgPSB7XG4gIHNjb3BlOiBmdW5jdGlvbiAoZGF0YSwgb3B0aW9ucykge1xuICAgIHJldHVybiB7XG4gICAgICBjbGFzc05hbWU6IGRhdGEuY2xhc3NOYW1lIHx8ICdpdGVtcy1jb2x1bW4nLFxuICAgICAgYnV0dG9uc1RpdGxlOiBvcHRpb25zLmJ1dHRvbnMgJiYgb3B0aW9ucy5idXR0b25zLnRpdGxlIHx8IGZhbHNlLFxuICAgICAgYnV0dG9uc0NsYXNzTmFtZTogKG9wdGlvbnMuYnV0dG9ucy5jbGFzc05hbWUgfHwgJycpXG4gICAgfVxuICB9LFxuICB0ZW1wbGF0ZTpcbiAgJzxkaXYgY2xhc3M9XCJvYmplY3QtbWVudS1pdGVtIG9iamVjdC1tZW51LW9wdGlvbnMge2NsYXNzTmFtZX1cIiB0aXRsZT1cInt0aXRsZX1cIj4nICtcbiAgJzxkaXYgY2xhc3M9XCJidG4tc2VsZWN0ZWQtb3B0aW9uXCI+PC9kaXY+JyArXG4gICc8ZGl2IGNsYXNzPVwib2JqZWN0LW1lbnUtb3B0aW9ucy1jb250YWluZXJcIiB0cmFuc2NsdWRlPicsXG4gIHBvc3Q6IGZ1bmN0aW9uICgkaXRlbSwgZGF0YSwgb3B0aW9ucywgdHJhbnNjbHVkZSkge1xuICAgIHRoaXMuZ2VuZXJhdGVNZW51KGRhdGEudGFyZ2V0LCB0cmFuc2NsdWRlLCBvcHRpb25zLCBkYXRhLm1lbnUpO1xuICAgIHRoaXMudXBkYXRlU2VsZWN0ZWRPcHRpb24oZGF0YSk7XG4gIH1cbn07XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuLi90b29sYmFyL21vZHVsZXMvdG9vbGJhci5vcHRpb25zLmpzXG4vLyBtb2R1bGUgaWQgPSA4MFxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCI7XG5pZih0eXBlb2YgVG9vbGJhciA9PT0gXCJ1bmRlZmluZWRcIil7XG4gIHZhciBUb29sYmFyID0gcmVxdWlyZShcIi4uL3NyYy90b29sYmFyXCIpO1xufVxuXG5Ub29sYmFyLnByb3RvdHlwZS50b29scy5zZWxlY3QgPSAge1xuICBzY29wZTogZnVuY3Rpb24gKGRhdGEsIG9wdGlvbnMpIHtcbiAgICByZXR1cm4ge1xuICAgICAgZ2V0SW5wdXRWYWx1ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gcGFyc2VGbG9hdChkYXRhLiRpdGVtLmZpbmQoXCJpbnB1dFwiKS52YWwoKSk7XG4gICAgICB9LFxuICAgICAgZ2V0VmFsdWU6IGRhdGEudmFsdWUuZ2V0LFxuICAgICAgc2V0VmFsdWU6IGRhdGEudmFsdWUuc2V0LFxuICAgICAgb25jaGFuZ2U6IGZ1bmN0aW9uIChlLG1vZGVsKSB7XG4gICAgICAgIGRhdGEudmFsdWUuc2V0KGUucGFyYW1zLmRhdGEuaWQsbW9kZWwpO1xuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgdGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwib2JqZWN0LW1lbnUtaXRlbSBvYmplY3QtbWVudS1zZWxlY3Qge2l0ZW1DbGFzc05hbWV9XCIgdGl0bGU9XCJ7dGl0bGV9XCIgPjxsYWJlbCBmb3I9XCJ4eHhcIiBjbGFzcz1cImJ0biBidXR0b24te2lkfSB7Y2xhc3NOYW1lfVwiPjwvbGFiZWw+PHNlbGVjdCBpZD1cInh4eFwiPicsXG4gIHBvc3Q6IGZ1bmN0aW9uICgkaXRlbSwgZGF0YSwgb3B0aW9ucywgdG9vbCwgdmFsKSB7XG4gICAgdmFyIG1vZGVsID0gIGRhdGEudmFsdWUub3B0aW9ucygpO1xuICAgIHZhciBfdmFsID0gZGF0YS52YWx1ZS5nZXQoKTtcbiAgICB2YXIgX3NlbGVjdCA9ICRpdGVtLmZpbmQoXCJzZWxlY3RcIik7XG4gICAgX3NlbGVjdC5kcFNlbGVjdCh7XG4gICAgICBtaW5pbXVtUmVzdWx0c0ZvclNlYXJjaDogSW5maW5pdHksXG4gICAgICBkcm9wZG93blBhcmVudDogJChcImJvZHlcIiksXG4gICAgICBkYXRhOiAgbW9kZWwsXG4gICAgICB0ZW1wbGF0ZVNlbGVjdGlvbjogZnVuY3Rpb24oc3RhdGUsIGNvbnRhaW5lcikge1xuICAgICAgICByZXR1cm4gZGF0YS50ZW1wbGF0ZVNlbGVjdGlvbihzdGF0ZSwgY29udGFpbmVyLGRhdGEpO1xuICAgICAgfSxcbiAgICAgIHRlbXBsYXRlUmVzdWx0OiBmdW5jdGlvbihzdGF0ZSwgY29udGFpbmVyKXtcbiAgICAgICAgcmV0dXJuIGRhdGEudGVtcGxhdGVSZXN1bHQoc3RhdGUsIGNvbnRhaW5lcixkYXRhKTtcbiAgICAgIH0sXG4gICAgfSkub24oXCJzZWxlY3QyOnNlbGVjdFwiLCBmdW5jdGlvbihlKSB7XG4gICAgICBkYXRhLm9uY2hhbmdlKGUsIG1vZGVsKTtcbiAgICB9KTtcbiAgICBfc2VsZWN0LmRwU2VsZWN0KFwidmFsXCIsW192YWxdKTtcbiAgfVxufVxuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi4vdG9vbGJhci9tb2R1bGVzL3Rvb2xiYXIuc2VsZWN0LmpzXG4vLyBtb2R1bGUgaWQgPSA4MVxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCJtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoXCJmc1wiKTtcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyBleHRlcm5hbCBcImZzXCJcbi8vIG1vZHVsZSBpZCA9IDgyXG4vLyBtb2R1bGUgY2h1bmtzID0gMCJdLCJtYXBwaW5ncyI6Ijs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7O0E7Ozs7QUNoRUE7Ozs7OztBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7O0FDOXZCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O0FDNU5BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OztBQ25SQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7OztBQzFTQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUNuSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O0FDcEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7O0FDM0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7O0FDcHBEQTs7Ozs7O0FDQUE7Ozs7OztBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7OztBQzNDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7O0FDMUZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7OztBQ3BJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7QUMvRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7OztBQzFGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7OztBQzdOQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7OztBQzlQQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7O0FDNU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7OztBQ3hLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7O0FDM1ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7OztBQ3ZnQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7OztBQ2pCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7QUNuS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7QUM5U0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7O0FDOUZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7QUN2WkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7OztBQzdnQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7O0FDaE5BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7OztBQzVRQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7OztBQ2hJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7OztBQ3BFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7O0FDN0hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7OztBQzNJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7OztBQzFQQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7OztBQ3JNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7O0FDeFFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7OztBQ3JhQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7OztBQ2xQQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7OztBQy9FQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7O0FDckRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7QUNqN0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7OztBQ2pSQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7QUNwQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7O0FDaEdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7O0FDekZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7O0FDN1FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7QUMvSkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7QUMvVUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7OztBQ2hTQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7QUM5SEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7OztBQ2xFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7OztBQzFKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7OztBQ3pOQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O0FDbGFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUMvQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O0FDOU1BO0FBQ0E7QUFDQTs7Ozs7OztBQ0ZBO0FBQ0E7Ozs7Ozs7O0FDREE7Ozs7OztBQ0FBOzs7Ozs7QUNBQTs7Ozs7O0FDQUE7Ozs7OztBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUNyTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O0FDcHBDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBOzs7Ozs7O0FDclFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBOzs7Ozs7O0FDakJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7O0FDdkVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7QUM5REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7O0FDdkNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7QUM5UUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7O0FDM1JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7QUM5V0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7QUMxOUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7OztBQ3hIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O0FDdkpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7OztBQ3ZMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUMzREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUM3Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O0FDL0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O0FDekRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OztBQ3RDQTs7O0EiLCJzb3VyY2VSb290IjoiIn0=