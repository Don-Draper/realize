/*! Fiera.js Copyright 2016, www.homeTLT.ru (Denis Ponomarev <ponomarevtlt@gmail.com>) */
var fiera =
/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// identity function for calling harmony imports with the correct context
/******/ 	__webpack_require__.i = function(value) { return value; };
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, {
/******/ 				configurable: false,
/******/ 				enumerable: true,
/******/ 				get: getter
/******/ 			});
/******/ 		}
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = 46);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ (function(module, exports) {

module.exports = fabric;

/***/ }),
/* 1 */
/***/ (function(module, exports, __webpack_require__) {

var _ = __webpack_require__(4);

var utils = {
  /**
   *
   * @param arr
   * @param arr2
   * @returns {{}}
   * @example
   *    x = {a: 1 ,b: 1, c: [1,2]}
   *    y = {a: 2 ,  c : 3 , d : 1}
   *
   *    extendArraysObject(x,y) = {a: [1,2] b : [1] c : [1,2,3], d [1] }
   */
  extendArraysObject : function(arr,arr2){
    var newArray = {};

    for(var i in arr){
      if(arr[i].constructor == Array){
        newArray[i]  = [].concat(arr[i]);
      }else{
        newArray[i] = [arr[i]];
      }
    }

    for(var i in arr2){
      if(newArray[i]){
        newArray[i].push(arr2[i]);
      }else{
        newArray[i] = [arr2[i]];
      }
    }
    return newArray;
  },
  filterValues: function (array, values) {
    var new_array = [];
    for (var i in array) {
      var _new_object = {};
      for (var j in values) {
        _new_object[values[j]] = array[i][values[j]]
      }
      new_array.push(_new_object);
    }
    return new_array;
  },

  /**
   *  Тасование Фишера–Йетса,случайное тасование множества
   * @param object
   * @returns {*}
   */
  shuffle: function (object) {
    if (!object.length) return;
    var i = object.length;
    while (--i) {
      var j = Math.floor(Math.random() * (i + 1));
      var temp = object[i];
      object[i] = object[j];
      object[j] = temp;
    }

    return object; // for convenience, in case we want a reference to the array
  },
  /**
   * Dependency: underscore.js ( http://documentcloud.github.com/underscore/ )
   *
   * Mix it in with underscore.js:
   * _.mixin({deepExtend: deepExtend});
   *
   * Call it like this:
   * var myObj = utils.deepExtend(grandparent, child, grandchild, greatgrandchild)
   *
   * Notes:
   * Keep it DRY.
   * This function is especially useful if you're working with JSON config documents. It allows you to create a default
   * config document with the most common settings, then override those settings for specific cases. It accepts any
   * number of objects as arguments, giving you fine-grained control over your config document hierarchy.
   *
   * Special Features and Considerations:
   * - parentRE allows you to concatenate strings. example:
   *   var obj = utils.deepExtend({url: "www.example.com"}, {url: "http://#{_}/path/to/file.html"});
   *   console.log(obj.url);
   *   output: "http://www.example.com/path/to/file.html"
   *
   * - parentRE also acts as a placeholder, which can be useful when you need to change one value in an array, while
   *   leaving the others untouched. example:
   *   var arr = utils.deepExtend([100,    {id: 1234}, true,  "foo",  [250, 500]],
   *                          ["#{_}", "#{_}",     false, "#{_}", "#{_}"]);
   *   console.log(arr);
   *   output: [100, {id: 1234}, false, "foo", [250, 500]]
   *
   * - The previous example can also be written like this:
   *   var arr = utils.deepExtend([100,    {id:1234},   true,  "foo",  [250, 500]],
   *                          ["#{_}", {},          false, "#{_}", []]);
   *   console.log(arr);
   *   output: [100, {id: 1234}, false, "foo", [250, 500]]
   *
   * - And also like this:
   *   var arr = utils.deepExtend([100,    {id:1234},   true,  "foo",  [250, 500]],
   *                          ["#{_}", {},          false]);
   *   console.log(arr);
   *   output: [100, {id: 1234}, false, "foo", [250, 500]]
   *
   * - Array order is important. example:
   *   var arr = utils.deepExtend([1, 2, 3, 4], [1, 4, 3, 2]);
   *   console.log(arr);
   *   output: [1, 4, 3, 2]
   *
   * - You can remove an array element set in a parent object by setting the same index value to null in a child object.
   *   example:
   *   var obj = utils.deepExtend({arr: [1, 2, 3, 4]}, {arr: ["#{_}", null]});
   *   console.log(obj.arr);
   *   output: [1, 3, 4]
   *
   **/
  deepExtend: function (/*obj_1, [obj_2], [obj_N]*/) {
    if (arguments.length < 1 || typeof arguments[0] !== 'object') {
      return false;
    }

    if (arguments.length < 2) return arguments[0];

    var target = arguments[0];

    // convert arguments to array and cut off target object
    var args = Array.prototype.slice.call(arguments, 1);

    var key, val, src, clone, tmpBuf;

    args.forEach(function (obj) {
      if (typeof obj !== 'object') return;

      for (key in obj) {
        if (!(key in obj)) continue;

        src = target[key];
        val = utils.cloneDeep(obj[key]);


        if (typeof src !== 'object' || src === null) {
          target[key] = val;
        }else if (Array.isArray(val)) {
          clone = (Array.isArray(src)) ? src : [];

          val.forEach(function(item){
            clone.push(utils.cloneDeep(item));
          });

          target[key] = clone;
          //todo  если заимствуем массив , то ссохраняем значения из обоих массивов
          //target[key] = utils.deepExtend(clone, val);

        } else {
          clone = (!Array.isArray(src)) ? src : {};
          target[key] = utils.deepExtend(clone, val);
        }

      }
    });

    return target;
  },
  cloneDeep: function (val) {

    if (typeof val === 'undefined') {
      return undefined;
    }

    if (val === null) {
      return null;
    } else if (val instanceof Date) {
      return new Date(val.getTime());
    } else if (val instanceof RegExp) {
      return new RegExp(val);
    }

    if(val.cloneSync){
      return val.cloneSync();
    }else if(val.constructor == Object){
      return utils.deepExtend({}, val);
    }else if(val.constructor == Array){
      var clone = [];
      for(var i =0 ;i < val.length; i++){
        clone.push(utils.cloneDeep(val[i]));
      }
      return clone;
    }else{
      return val;
    }
  },
  rearrange: function (object, keys) {
    var _newOrder = {};
    for (var i in keys) {
      if(object[keys[i]] !== undefined){
        _newOrder[keys[i]] = object[keys[i]]
      }
    }
    // for (i in object) {
    //   delete object[i];
    // }
    // for (i in _newOrder) {
    //   object[i] = _newOrder[i];
    // }
    return _newOrder;
  },
  sortBy: _.sortBy,
  defaults: _.defaults,
  where: _.where,
  findWhere: _.findWhere,
  filter: _.filter,
  pick: _.pick,
  extend: function (destination) {
    // JScript DontEnum bug is not taken care of
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];
      for (var property in source) {
        destination[property] = source[property];
      }
    }
    return destination;
  }
};
module.exports =  utils;


/***/ }),
/* 2 */
/***/ (function(module, exports, __webpack_require__) {

var objectUtils = __webpack_require__(1)
_ = __webpack_require__(4);

var utils = {
  /**
   * will divide total width for every object in columnts array
   *
   *
   * @example
   *     var _flexArray = fabric.util.flex(200 , [{flex: 0},{value: 100, flex: 1},{flex: 0}] );
   * @param total
   * @param columns
   * @returns {Array}
   * @example [50,100,50]
   */
  flex: function (total,columns){
    var _return = [];
    var split = 0;
    columns.forEach(function(column, index){
      if(column.value === undefined){
        split++;
      }else{
        total -= column.value;
      }
    });
    var _w = total / split;
    columns.forEach(function(column){
      _return.push(column.value === undefined ? _w :  column.value );
    });
    return _return;
  },
  worker: function (foo) {
    if (window.Worker) {
      var str = foo.toString();
      var eventArg = str.substring(str.indexOf("(") + 1,str.indexOf(","));
      var postMessageArg = str.substring(str.indexOf(",") + 1,str.indexOf(")"));
      var _functionBody = str.substring(str.indexOf("{") + 1);
      str = "onmessage=function(" + eventArg + "){" + postMessageArg + "= postMessage;" + _functionBody;
      var blob = new Blob([str]);
      //"onmessage = function(e) { postMessage('msg from worker'); }"]);
      var blobURL = window.URL.createObjectURL(blob);
      return new Worker(blobURL);
    } else {
      var worker = {
        terminate: function () {
        },
        postMessage: function (data) {
          setTimeout(function () {
            foo({data: data}, function (responseData) {
              worker.onmessage && worker.onmessage({data: responseData});
            })
          });
        }
      };
      return worker;
    }
  },
  observable: function (obj) {
    _.extend(obj, {

      fire: function fire(eventName, options) {
        if (!this.__eventListeners) {
          return;
        }
        var listenersForEvent = this.__eventListeners[eventName];
        if (!listenersForEvent) {
          return;
        }
        for (var i = 0, len = listenersForEvent.length; i < len; i++) {
          listenersForEvent[i].call(this, options || {});
        }
        return this;
      },
      on: function (eventName, handler) {
        if (eventName.constructor == Object) {
          for (var i in eventName) {
            this.on(i, eventName[i])
          }
          return this;
        }
        var events = eventName.split(" ");
        for (var i in events) {
          this.observe(events[i], handler)
        }
        return this;
      },
      observe: function (eventName, handler) {
        if (!this.__eventListeners) {
          this.__eventListeners = {};
        }
        if (arguments.length === 1) {
          for (var prop in eventName) {
            this.on(prop, eventName[prop]);
          }
        }
        else {
          if (!this.__eventListeners[eventName]) {
            this.__eventListeners[eventName] = [];
          }
          this.__eventListeners[eventName].push(handler);
        }
        return this;
      },
      off: function stopObserving(eventName, handler) {
        function _removeEventListener(eventName, handler) {
          if (!this.__eventListeners[eventName]) {
            return;
          }

          if (handler) {
            var idx = this.__eventListeners[eventName].indexOf(handler);
            if (idx !== -1) {
              this.__eventListeners[eventName].splice(idx, 1);
            }
          }
          else {
            this.__eventListeners[eventName].length = 0;
          }
        }

        if (!this.__eventListeners) {
          return;
        }
        if (arguments.length === 0) {
          this.__eventListeners = {};
        }
        else if (arguments.length === 1 && typeof arguments[0] === 'object') {
          for (var prop in eventName) {
            _removeEventListener.call(this, prop, eventName[prop]);
          }
        }
        else {
          _removeEventListener.call(this, eventName, handler);
        }
        return this;
      }
    })
  },
  inOrder: function (array, foo, callback) {
    var _index = 0;
    function _inOrderIndex() {
      if (++_index < array.length) {
        foo(array[_index], _index, _inOrderIndex)
      } else {
        callback && callback();
      }
    }
    foo(array[_index], _index, _inOrderIndex)
  },
  /**
   * возвращает объект с ключами строки url
   * @returns {{}}
   */
  queryString: function (query) {
    if(query) {
      query = query.substr(query.indexOf("?") + 1) ;
    }else{
      query = window.location.search.substring(1);
    }
    var obj = {};
    var _length = 0;
    if (!query)return obj;
    var vars = query.split("&");
    for (var i = 0; i < vars.length; i++) {
      var pair = vars[i].split("=");
      var _vname = pair[0], val = pair[1];
      if (typeof obj[_vname] === "undefined") {
        obj[_vname] = val || "";
        Object.defineProperty(obj, _length, {value: _vname, enumerable: false});
        _length++;
        // If second entry with this name
      } else if (typeof obj[_vname] === "string") {
        var arr = [obj[_vname], val];
        obj[_vname] = arr;
        Object.defineProperty(obj, _length, {value: _vname, enumerable: false});
        _length++;
        // If third or later entry with this name
      } else {
        obj[_vname].push(val);
        Object.defineProperty(obj, _length, {value: _vname, enumerable: false});
        _length++;
      }
    }
    Object.defineProperty(obj, "length", {value: _length, enumerable: false});
    return obj;
  },
  copyValue: function (value) {
    if (value == null) {
      return null
    }
    if (value == undefined) {
      return undefined
    }
    switch (value.constructor) {
      case Object:
        return objectUtils.deepExtend({}, value);
      case Array:
        return objectUtils.deepExtend([], value);
      case String:
      case Number:
      case Boolean:
        return value;
      default:
        //console.log(value.constructor);
        return objectUtils.deepExtend({}, value);
    }
  },
  clearValue: function (value) {
    switch (value.constructor) {
      case Object:
        for (var member in value) delete value[member];
        break;
      case Array:
        value.length = 0;
        break;
      default:
        delete value;
    }
  },
  objectsDifference: function (prev, now) {
    var changes = {};
    for (var prop in now) {
      if (!prev || prev[prop] !== now[prop]) {
        if (typeof now[prop] == "object") {
          var c = utils.objectsDifference(prev[prop], now[prop]);
          if (!_.isEmpty(c)) // underscore
            changes[prop] = c;
        } else {
          changes[prop] = now[prop];
        }
      }
    }
    return changes;
  },
  splitBy: function (query, delimiter) {
    var traceQueries = [];
    var r = 0,
      f = 0,
      _p_start = 0;
    if (query == "") return [];
    for (var i = 0; i < query.length; i++) {
      var c = query[i];
      if (c == "(") {
        r++;
        f = 1;
      } else if (c == ")") {
        r--;
      }
      if (r == 0 && f == 1) f = 0;
      if (delimiter.indexOf(c) != -1 && r == 0 && f == 0) {
        traceQueries.push(query.substring(_p_start, i));
        _p_start = i + 1;
      }
    }
    traceQueries.push(query.substring(_p_start));
    return traceQueries;
  },
  queueLoad: function (total, completeCB, progressCB) {
    var loader = function (el) {
      loader.loaded.push(el);
      loader.progressCB && loader.progressCB(loader.loaded.length, loader.total, el, loader.loaded);

      if (loader.loaded.length == loader.total) {
        loader.completeCB && loader.completeCB(loader.loaded);
        loader.fire("loaded");
      }
    };
    loader.completeCB = completeCB;
    loader.progressCB = progressCB;
    loader.total = total;
    loader.loaded = [];
    utils.observable(loader);

    return loader;
  }
};
module.exports =  utils;


/***/ }),
/* 3 */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(fabric) {var utils = __webpack_require__(2);
utils.compile = __webpack_require__(5);
utils.object = __webpack_require__(1);

function capitalize(string, firstLetterOnly) {
  return string.charAt(0).toUpperCase() +
    (firstLetterOnly ? string.slice(1) : string.slice(1).toLowerCase());
}

function toDashed (str) {
  return str.replace(/([a-z])([A-Z])/g, '$1-$2').toLowerCase();
}


var Toolbar = function(PARENT, el, options, menu){
  this.buttons = [];
  //todo это не совсем хорошо. нельзя создать улбраы с разными конфигами кнопок
  // this.tools = utils.object.cloneDeep(this.tools);

  if (options) {
    if (options.button) {
      utils.object.extend(this.tools.button, options.button);
    }
  }
  this.actions = Toolbar.makeActions(PARENT, menu);

  if(el.constructor == String){
    el = $(document.getElementById(el));
  }
  if(el.length && Object.keys(this.actions).length){
    this.generateMenu(PARENT, el, options, this.actions);
    this.onCreate();
    el.show();
  }
  Toolbar.initKeys(this.actions);
};


Toolbar._getKeyString = function (config) {
  var string = "";

  if (config.ctrlKey)string += "Ctrl + ";
  if (config.altKey)string += "Alt + ";
  if (config.shiftKey)string += "Shift + ";

  var _code = config.key;
  if(_code){
    string += config.key;
  }
  return string;
};

Toolbar.makeActions = function (PARENT, actions) {
  if (!PARENT._actionsReady) {

    actions = actions || PARENT.actions;

    var result = {};

    for (var i in actions) {
      var _action = this.makeAction(i, actions[i], PARENT);
      if(_action){
        result[i] = _action;
      }
    }
    PARENT._actionsReady = true;
    PARENT.actions = result;
  }
  return PARENT.actions;
};
Toolbar.makeAction = function (id, _ORIGINAL, parent) {

  var self = this;

  if (_ORIGINAL.constructor === Function) {
    _ORIGINAL = _ORIGINAL.call(target);
  }

  var target;

  if (_ORIGINAL.target && _ORIGINAL.target.constructor == Function) {
    target = _ORIGINAL.target.call(parent);
  } else {
    target = _ORIGINAL.target || parent;
  }

  var ___target = _ORIGINAL.target;
  var ___parent = _ORIGINAL.parent;
  delete _ORIGINAL.parent;
  delete _ORIGINAL.target;
  var RES = utils.object.cloneDeep(_ORIGINAL);
  _ORIGINAL.parent = ___parent;
  _ORIGINAL.target = ___target;


  RES.parent = ___parent;
  RES.target = target;
  RES.id = toDashed(id);


  function createGetter(property,useParent) {
    if (property.constructor == String) {
      var negative = false;
      if (property[0] == "!") {
        property = property.substr(1);
        negative = true;
      }
      if(useParent){
        return function () {
          return parent && !!parent[property] ^ negative;
        }
      }else{
        return function () {
          return target && !!target[property] ^ negative;
        }
      }
    }
    if (property.constructor == Function) {
      return property.bind(target);
    }
    return null;
  }


  var _insert = _ORIGINAL.insert;
  if (!_insert || _insert.constructor == String) {

    if(_ORIGINAL.parent){
      var insertproperty = fabric.util.string.capitalize(fabric.util.string.camelize(_ORIGINAL.parent.id))
    }else{
      var insertproperty = _insert || "insert" + fabric.util.string.capitalize(id,true);
    }

    if(target[insertproperty] !== undefined){
      _insert = target[insertproperty]// createGetter(insertproperty,true)()
    }else{
      _insert = true;
    }
  }

  if(!_insert)return;

  if (!RES.type) {
    if (RES.menu) {
      RES.type = "menu";
    }else{
      RES.type = "button";
    }
  }
  if (!RES.action) {
    if(RES.type == "button"){
      RES.action = id;
    }
  }


  if (RES.action) {
    if (RES.action.constructor == String) {
      RES.action = target[RES.action];
    }
    //RES = RES.action.bind(target);
    //RES.action = RES.action.bind(target);
    //_.extend(RES, _act);
    //arguments for action function
    if (_ORIGINAL.args) {
      RES._action = RES.action.bind(target, _ORIGINAL.args);
    } else {
      RES._action = RES.action.bind(target);
    }
    RES.action = function(){
      if(RES.disabled)return;
      RES._action.apply(this,arguments);
    }
  }


  if (_ORIGINAL.menu && _ORIGINAL.menu.constructor == Function) {
    RES.menu = _ORIGINAL.menu.bind(target);
  }
  if (_ORIGINAL.active) {
    RES.active = createGetter(_ORIGINAL.active);
  }
  if (_ORIGINAL.visible) {
    RES.visible = createGetter(_ORIGINAL.visible);
  }
  if (_ORIGINAL.enabled) {
    RES.enabled = createGetter(_ORIGINAL.enabled);
  }
  if (!_ORIGINAL.value) {
    switch(_ORIGINAL.type){
      case "color":
      case "text":
      case "number":
      case "range":
      case "label":
      case "select":
      case "checkbox":
        _ORIGINAL.value = id;
      // console.log(id, _ORIGINAL);
    }
  }
  if (_ORIGINAL.value) {
    var _set, _get, _options;
    if (_ORIGINAL.value.constructor == String) {

      var setFunctionName = "set" + capitalize(_ORIGINAL.value, true),
        getFunctionName = "get" + capitalize(_ORIGINAL.value, true),
        minName = "min" + capitalize(_ORIGINAL.value, true),
        maxName = "max" + capitalize(_ORIGINAL.value, true),
        setFoo = function(val){
          target[setFunctionName](val);
          // todo self.setFunctionCallback(target);
        },
        getFoo = target[getFunctionName],
        minFoo = target[minName],
        maxFoo = target[maxName];

      _set = setFoo || (_ORIGINAL.args ?
          function (val, args) {
            this[_ORIGINAL.value][args] = val;
          } :
          function (val) {
            this[_ORIGINAL.value] = val;
          });

      _get = getFoo || (_ORIGINAL.args ?
          function (args) {
            return this[_ORIGINAL.value][args];
          } :
          function () {
            return this[_ORIGINAL.value];
          });


      RES.value = {
        min: minFoo,
        max: maxFoo
      }

    } else {
      _set = _ORIGINAL.value.set;
      _get = _ORIGINAL.value.get;
      _options = _ORIGINAL.value.options;
    }

    if(RES.value.min !== undefined && RES.value.min.constructor == String){
      RES.value.min = target[RES.value.min];
    }
    if(RES.value.max !== undefined && RES.value.max.constructor == String){
      RES.value.max = target[RES.value.max];
    }
    if(RES.value.step !== undefined && RES.value.step.constructor == String){
      RES.value.step = target[RES.value.step];
    }
    var _min = RES.value.min, _max = RES.value.max, _step = RES.value.step;

    if (_set) {
      RES.value.set = ( _ORIGINAL.args ? _set.bind(target, _ORIGINAL.args) : _set.bind(target));
    }
    if (_get) {
      RES.value.get = ( _ORIGINAL.args ? _get.bind(target, _ORIGINAL.args) : _get.bind(target));
    }
    if (_min && _min.constructor == Function) {
      RES.value.min = ( _ORIGINAL.args ? _min.bind(target, _ORIGINAL.args) : _min.bind(target));
    }
    if (_max && _max.constructor == Function) {
      RES.value.max = ( _ORIGINAL.args ? _max.bind(target, _ORIGINAL.args) : _max.bind(target));
    }
    if (_step && _step.constructor == Function) {
      RES.value.step = ( _ORIGINAL.args ? _step.bind(target, _ORIGINAL.args) : _step.bind(target));
    }
    if (_options) {
      RES.value.options = ( _ORIGINAL.args ? _options.bind(target, _ORIGINAL.args) : _options.bind(target));
    }
  }

  if (_ORIGINAL.data) {
    RES.data = _ORIGINAL.data.call(target);
  }
  if (RES.menu) {
    if (_ORIGINAL.menu.constructor === Function){
      RES.menu =  _ORIGINAL.menu.call(target);
    }
    if (RES.type == "options") {
      for (var i in RES.menu) {
        RES.menu[i].parent = RES;
        RES.menu[i].type = "option";
        if(!RES.menu[i].title){
          RES.menu[i].title = i;
        }
        if(!RES.menu[i].option) {
          RES.menu[i].option = i;
        }
      }
    }
    for (var i in RES.menu) {
      if(RES.menu[i].constructor == String){
        RES.menu[i] = fabric.util.object.clone(RES.target.actions[RES.menu[i]]);
        RES.menu[i].parent = RES;
      }
      RES.menu[i] = Toolbar.makeAction(i, RES.menu[i], target);
      if(!RES.menu[i]){
        delete RES.menu[i];
      }
    }
  }



  if (_ORIGINAL.keyboard !== false && (_ORIGINAL.key || _ORIGINAL.shiftKey || _ORIGINAL.altKey || _ORIGINAL.ctrlKey || _ORIGINAL.metaKey)) {
    if(_ORIGINAL.keyCode && _ORIGINAL.keyCode.constructor == String){
      RES.keyCode = _ORIGINAL.keyCode.toUpperCase().charCodeAt(0);
      RES.key = String.fromCharCode(RES.keyCode);
    }
    RES.keyboard = true
  };

  return RES;
};

Toolbar.getButtons = function (actions) {
  var _buttons = [];
  for(var i in actions){
    var action = actions[i];
    if(action.keyboard){
      action.title += " (" + Toolbar._getKeyString(action) + ")";
      _buttons.push(action);
    }
    if (actions.menu) {
      _buttons = _buttons.concat(Toolbar.getButtons(actions.menu));
    }
  };

  return _buttons;
};
Toolbar.initKeys = function (actions) {

  var buttons = Toolbar.getButtons(actions);

  var self = this;
  $("body").on( "keydown",function (e) {
    for (var i in buttons) {
      var _config = buttons[i];

      if(_config.enabled && !_config.enabled()){
        continue;
      }
      if(_config.disabled || _config.disabled){
        continue;
      }
      if ((!_config.disabled && !_config.hidden) &&
        (_config.keyCode == e.keyCode || _config.key == e.key) &&
        (_config.ctrlKey === undefined || _config.ctrlKey == e.ctrlKey ) &&
        (_config.altKey === undefined || _config.altKey == e.altKey ) &&
        (_config.shiftKey === undefined || _config.shiftKey == e.shiftKey ) &&
        (_config.metaKey === undefined || _config.metaKey == e.metaKey )) {

        e.preventDefault();
        e.stopPropagation();
        if (_config.option !== undefined) {
          _config.action.call(_config.target, _config.option, e)
        } else {
          _config.action.call(_config.target, e)
        }
      }
    }
  });

  //$(window).on("mousewheel", function (event) {
  //  for (var i in self.buttons) {
  //    var data = self.buttons[i];
  //    if (!data.mousewheel)continue;
  //    if (!data.ctrlKey || data.ctrlKey && event.ctrlKey) {
  //      if (event.deltaY > 0 && data.mousewheel == ">") {
  //        data.action.call(target, data.option || event, event)
  //      }
  //      if (event.deltaY < 0 && data.mousewheel == "<") {
  //        data.action.call(target, data.option || event, event)
  //      }
  //      event.preventDefault();
  //      event.stopPropagation();
  //      return false;
  //    }
  //  }
  //});

};

Toolbar.prototype = {

  // setFunctionCallback: function(){},
  tools: {

    "label": {
      scope: function (data, options) {
        return {
          getValue: data.value.get,
          valueCurrent: data.value.get()
        }
      },
      template: '<div class="object-menu-item object-menu-label" title="{title}">',
      render: function ($item, data, options, tool, val) {
        var scope = fabric.util.object.defaults(tool.scope.call(this, data, options),data);
        $item.html(data.template.format(data.value.get()));
        utils.compile.compileElement($item,scope);
      }
    },
    "select": {
      scope: function (data, options) {
        return {
          getInputValue: function () {
            return parseFloat(data.$item.find("input").val());
          },
          getValue: data.value.get,
          setValue: data.value.set,
          onchange: function (e,model) {
            data.value.set(e.params.data.id,model);
          }
        }
      },
      template: '<div class="object-menu-item object-menu-select {itemClassName}" title="{title}" ><label for="xxx" class="btn button-{id} {className}"></label><select id="xxx">',
      post: function ($item, data, options, tool, val) {
        var model =  data.value.options();
        var _val = data.value.get();
        var _select = $item.find("select");
        _select.dpSelect({
          minimumResultsForSearch: Infinity,
          dropdownParent: $("body"),
          data:  model,
          templateSelection: function(state, container) {
            return data.templateSelection(state, container,data);
          },
          templateResult: function(state, container){
            return data.templateResult(state, container,data);
          },
        }).on("select2:select", function(e) {
          data.onchange(e, model);
        });
        _select.dpSelect("val",[_val]);
      }
    },
    "number": {
      scope: function (data, options) {
        return {
          getInputValue: function(){
            return parseFloat(data.$item.find("input").val());
          },
          getValue: data.value.get,
          setValue: data.value.set,
          minValue: data.value.min && data.value.min(),
          maxValue: data.value.max && data.value.max(),
          valueCurrent: data.value.get(),
          onchange: function (e) {
            data.value.set(parseFloat($(e.target).val()));
          }
        }
      },
      template: '<div class="object-menu-item object-menu-number" title="{title}">' +
      '<input type="number" min="{minValue}" max="{maxValue}" value="{valueCurrent}" onchange="onchange(event)">',
      render: function ($item, data, options, tool, val) {
        $item.find("input").val(data.value.get());
      }
    },
    "range": {
      scope: function (data, options) {
        return {
          minValue: data.value.min ? typeof data.value.min == "function" ? data.value.min() : data.value.min: 0,
          maxValue: data.value.max ? typeof data.value.max == "function" ? data.value.max() : data.value.max: 1,
          valueStep: data.value.step ? typeof data.value.step == "function" ? data.value.step() : data.value.step: 0.1,
          valueCurrent: data.value.get(),
          onchange: function (e) {
            data.value.set(parseFloat($(e.target).val()));
          }
        }
      },
      template: '<div class="object-menu-item object-menu-range" title="{title}">' +
      '<input type="range" step="{valueStep}" min="{minValue}" max="{maxValue}" value="{valueCurrent}" onchange="onchange(event)">',
      render: function ($item, data, options, tool, val) {
        $item.find("input").val(data.value.get());
      }
    },
    "checkbox": {
      scope: function (data, options) {
        return {
          onchange: function (e) {
            data.value.set(e.target.checked)
          },
          valueCurrent: data.value.get()
        }
      },
      template:
      '<div class="object-menu-item object-menu-checkbox" title="{title}">' +
      '<input type="checkbox" onchange="onchange(event)" dp-checked="{valueCurrent}" id="checkbox-{id}">' +
      '<label for="checkbox-{id}"  class="btn button-{id} {className}">',
      render: function ($item, data, options, tool, val) {
        $item.find("input").val(val);
      }
    },
    "menu": {
      template: '<div class="object-menu-item object-menu-menu" title="{title}">' +
      '<label dp-if="title" for="button-{id}">{title}</label>' +
      '<button class="btn button-menu-trigger button-{id} {className}" id="button-{id}"/>' +
      '<div class="object-menu submenu" transclude/>',
      post: function ($item, data, options, transclude) {
        //$item.find(".button-menu-trigger").click(function () {
        //  $item.find(".object-menu").toggle();
        //})
        if (data.hovered) {
          $item.addClass("hovered");
          this.toggleByHover($item, transclude, null, data)
        }
        if (data.toggled) {
          $item.addClass("toggled");
          this.toggleByButton($item, transclude)
        };
        this.generateMenu(data.target, transclude, options, data.menu);
      }
    },
    "effect": {
      scope: function (data, options) {
        return {
          buttonsTitle: options.buttons && options.buttons.title || false,
          isParameters: !!data.actionParameters,
          buttonscClassName: (options.buttons && options.buttons.className || '')
        }
      },
      template: '<div class="object-menu-item" title="{title}">' +
      '<button class="btn button-{id} {className} {buttonscClassName}">' +
      '<span dp-if="buttonsTitle" class="button-title">{title}</span>' +
      '</button>' +
      '<div dp-if="isParameters" class="menu-action-parameters" style="display: none" transclude></div>' +
      '</div>',
      post: function ($item, data, options, transclude) {


        var foo = function () {

          if (data.effectTpl) {
            var $tpl = $(data.effectTpl);
            transclude.html($tpl);
          }

          if (data.actionParametersId) {
            var $tpl = $("#" + data.actionParametersId).clone();
            transclude.html($tpl);
          }
          return data.actionParameters.call(data.target, transclude, data, options);
        }


        this.toggleByButton($item, transclude, foo ,data);
      }
    },
    "button": {
      scope: function (data, options) {
        return {
          buttonsTitle: options.buttons && options.buttons.title || false,
          buttonscClassName: (options.buttons && options.buttons.className || '')
        }
      },
      template:
      '<div class="object-menu-item" title="{title}">' +
      '<button class="btn button-{id} {className} {buttonscClassName}"  onclick="!disabled && action(option)">' +
      '<img dp-if="icon" dp-src="icon">' +
      '<span dp-include="svg" dp-if="svg"></span>' +
      '<span dp-if="buttonsTitle" class="button-title">{title}</span>'
    }
  },
  onCreate: function () {

  },
  destroy: function (target) {
    for (var i = this.buttons.length;i--;) {
      var _config = this.buttons[i];
      if(target && _config.target != target ){
        continue;
      }
      this.buttons.splice(i,1);
    }
  },
  createInput: function ($item, data, type) {

    var target = data.target;
    var $input = $("<input>")
      .attr("type", type)
      .attr("min", data.value.min())
      .attr("max", data.value.max());

    $input.val(data.value.get());
    if (data.value.observe) {
      target.on(data.value.observe, function (val) {
        $input.val(data.value.get());
      });
    }
    $input.change(function (e) {
      data.value.set(parseFloat($input.val()))
    });
    $item.append($input);
  },
  initItem: function ($item, data) {

    if (data.active) {
      if (data.active.call(data.target, data.option)) {
        $item.addClass("active");
      }
    }

    if (data.visible !== undefined) {
      if (data.visible.constructor == Function) {
        if (!data.visible.call(data.target)) {
          $item.hide();
        }
      } else if (!data.visible) {
        $item.hide();
      }
    }

    data.disabled = false;
    if (data.enabled !== undefined) {
      if (data.enabled.constructor == Function) {
        if (!data.enabled.call(data.target)) {
          $item.attr("disabled", true);
          data.disabled = true;
        }
      }
    }

    if (data.observe) {
      //todo
      if (data.visible && data.visible.constructor == Function) {
        data.target && data.target.on(data.observe, function () {
          if (!data.visible.call(data.target)) {
            $item.hide();
            data.hidden = true;
          } else {
            $item.show();
            data.hidden = false;
          }
        });
      }

      if (data.type == "options") {
        data.target && data.target.on(data.observe, function () {
          var _val = data.value.get();
          $("[name=" + data.id + "]").prop("checked",false);
          $("[name=" + data.id + "][value=" + _val +"]").prop("checked",true);
        });
      }

      if (data.enabled && data.enabled.constructor == Function) {
        data.target && data.target.on(data.observe, function () {
          if (!data.enabled.call(data.target)) {
            $item.attr("disabled", true);
            data.disabled = true;
          } else {
            $item.removeAttr("disabled");
            data.disabled = false;
          }
        });
      }
    }
  },
  toggleByHover: function ($item, $toggleElement, foo,data) {

    var onClose;

    $toggleElement.hide();
    $item.mouseout(function () {
      $toggleElement.hide();
      onClose && onClose();
    });
    $item.mouseover(function () {
      $toggleElement.show();
      onClose = foo && foo();
    });

    $item.click(function () {
      if (data && data.immediately) {
        data.action();
      }
    });
  },
  toggleByButton: function ($item, $toggleElement, foo,data) {

    var onClose;
    var _try_hide = function (e) {
      var _parents = $(e.target).parents();
      for (var i in _parents) {
        if (_parents[i] === $item[0]) {
          return false;
        }
      }
      if ($toggleElement.css("display") !== "none") {
        $toggleElement.hide();
        onClose && onClose();
      }
    };

    $toggleElement.click(function (e) {
      e.stopPropagation();
    });
    $toggleElement.hide();
    $item.click(function () {

      if ($toggleElement.css("display") !== "none") {
        $toggleElement.hide();
        onClose && onClose();
        $(window).off("click", _try_hide);
      } else {
        $toggleElement.show();
        $(window).on("click", _try_hide);

        onClose = foo && foo();

        if(data && data.immediately){
          data.action();
        }
      }
    })
  },
  generateMenu: function (target, $el, options, menu) {

    options = options || {
        title: false
      };
    options.buttons = options.buttons || {
        className: "",
        title: false
      };

    $el.empty();

    for (var i in menu) {
      var data = menu[i];
      if (!data || data.insert !== undefined && !data.insert) {
        continue;
      }
      data.type = data.type || "button";

      //todo непонятно зачем аргумент target в начале
      var target = data.target;

      var tool = this.tools[data.type];

      if (!tool) {
        console.warn("tool undefined");
        return;
      }
      var scope = data;
      if (tool.scope) {
        scope = fabric.util.object.defaults(tool.scope.call(this, data, options),data);
      }

      var $item = $(tool.template.format(scope));
      var transclude = $item.find("[transclude]");
      scope.$item = data.$item = $item;
      if(data.template){
        $item.html(data.template.format(data.value.get()));
      }

      utils.compile.compileElement($item,scope);

      if (data.value && data.value.observe) {

        target.on(data.value.observe, function (val) {

          if (tool.post) {
            tool.post.call(this,$item, scope, options, transclude.length ? transclude : null);
          }
          if(tool.render){
            tool.render.call(this, $item, data, options, tool, val);
          }
          //this.fire(data.type + ":render",{item: $item, data: data, options: options, tool: tool, val: val})
        });
      }

      this.initItem($item, data);

      if (tool.post) {
        tool.post.call(this,$item, scope, options, transclude.length ? transclude : null);
      }

      this.fire(data.type + ":created",{item: $item, data: data, options: options, tool: tool});

      $el.append($item);
    }
  }
};
utils.observable(Toolbar.prototype);


Toolbar.single = function(data,element){
  data.$item = element;
  data.type = data.type || "button";

  var tool = Toolbar.prototype.tools[data.type];

  Toolbar.prototype.initItem(element,data);

  if (data.value && data.value.observe) {
    data.target.on(data.value.observe, function (val) {
      tool.render( element, data, {}, tool, val)
    });
  }

  if(tool.post){
    var transclude = element.find("[transclude]");

    tool.post.call(Toolbar.prototype, element, data, {}, transclude.length ? transclude : null);
  }

  var scope = data;
  if(tool.scope){
    scope = _.defaults(data, tool.scope.call(Toolbar.prototype, data, {}));
  }

  element.eachSelf("*",function(){
    var nodes=[], values=[];
    for (var att, i = 0, atts = this.attributes, n = atts.length; i < n; i++){
      att = atts[i];
      nodes.push(att.nodeName);
      values.push(att.nodeValue);
      this.setAttribute(att.nodeName,att.nodeValue.format(scope));
    }
  });
  utils.compile.compileElement(element,scope);
};


module.exports = Toolbar;




/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 4 */
/***/ (function(module, exports) {

//     Underscore.js 1.8.3
//     http://underscorejs.org
//     (c) 2009-2015 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
//     Underscore may be freely distributed under the MIT license.


  // Save bytes in the minified (but not gzipped) version:
  var ArrayProto = Array.prototype, ObjProto = Object.prototype, FuncProto = Function.prototype;

  // Create quick reference variables for speed access to core prototypes.
  var
    push             = ArrayProto.push,
    slice            = ArrayProto.slice,
    toString         = ObjProto.toString,
    hasOwnProperty   = ObjProto.hasOwnProperty;

  // All **ECMAScript 5** native function implementations that we hope to use
  // are declared here.
  var
    nativeIsArray      = Array.isArray,
    nativeKeys         = Object.keys,
    nativeBind         = FuncProto.bind,
    nativeCreate       = Object.create;

  // Naked function reference for surrogate-prototype-swapping.
  var Ctor = function(){};

  // Create a safe reference to the Underscore object for use below.
  var _ = function(obj) {
    if (obj instanceof _) return obj;
    if (!(this instanceof _)) return new _(obj);
    this._wrapped = obj;
  };

  // Current version.
  _.VERSION = '1.8.3';

  // Internal function that returns an efficient (for current engines) version
  // of the passed-in callback, to be repeatedly applied in other Underscore
  // functions.
  var optimizeCb = function(func, context, argCount) {
    if (context === void 0) return func;
    switch (argCount == null ? 3 : argCount) {
      case 1: return function(value) {
        return func.call(context, value);
      };
      case 2: return function(value, other) {
        return func.call(context, value, other);
      };
      case 3: return function(value, index, collection) {
        return func.call(context, value, index, collection);
      };
      case 4: return function(accumulator, value, index, collection) {
        return func.call(context, accumulator, value, index, collection);
      };
    }
    return function() {
      return func.apply(context, arguments);
    };
  };

  // A mostly-internal function to generate callbacks that can be applied
  // to each element in a collection, returning the desired result — either
  // identity, an arbitrary callback, a property matcher, or a property accessor.
  var cb = function(value, context, argCount) {
    if (value == null) return _.identity;
    if (_.isFunction(value)) return optimizeCb(value, context, argCount);
    if (_.isObject(value)) return _.matcher(value);
    return _.property(value);
  };
  _.iteratee = function(value, context) {
    return cb(value, context, Infinity);
  };

  // An internal function for creating assigner functions.
  var createAssigner = function(keysFunc, undefinedOnly) {
    return function(obj) {
      var length = arguments.length;
      if (length < 2 || obj == null) return obj;
      for (var index = 1; index < length; index++) {
        var source = arguments[index],
            keys = keysFunc(source),
            l = keys.length;
        for (var i = 0; i < l; i++) {
          var key = keys[i];
          if (!undefinedOnly || obj[key] === void 0) obj[key] = source[key];
        }
      }
      return obj;
    };
  };

  // An internal function for creating a new object that inherits from another.
  var baseCreate = function(prototype) {
    if (!_.isObject(prototype)) return {};
    if (nativeCreate) return nativeCreate(prototype);
    Ctor.prototype = prototype;
    var result = new Ctor;
    Ctor.prototype = null;
    return result;
  };

  var property = function(key) {
    return function(obj) {
      return obj == null ? void 0 : obj[key];
    };
  };

  // Helper for collection methods to determine whether a collection
  // should be iterated as an array or as an object
  // Related: http://people.mozilla.org/~jorendorff/es6-draft.html#sec-tolength
  // Avoids a very nasty iOS 8 JIT bug on ARM-64. #2094
  var MAX_ARRAY_INDEX = Math.pow(2, 53) - 1;
  var getLength = property('length');
  var isArrayLike = function(collection) {
    var length = getLength(collection);
    return typeof length == 'number' && length >= 0 && length <= MAX_ARRAY_INDEX;
  };

  // Collection Functions
  // --------------------

  // The cornerstone, an `each` implementation, aka `forEach`.
  // Handles raw objects in addition to array-likes. Treats all
  // sparse array-likes as if they were dense.
  _.each = _.forEach = function(obj, iteratee, context) {
    iteratee = optimizeCb(iteratee, context);
    var i, length;
    if (isArrayLike(obj)) {
      for (i = 0, length = obj.length; i < length; i++) {
        iteratee(obj[i], i, obj);
      }
    } else {
      var keys = _.keys(obj);
      for (i = 0, length = keys.length; i < length; i++) {
        iteratee(obj[keys[i]], keys[i], obj);
      }
    }
    return obj;
  };

  // Return the results of applying the iteratee to each element.
  _.map = _.collect = function(obj, iteratee, context) {
    iteratee = cb(iteratee, context);
    var keys = !isArrayLike(obj) && _.keys(obj),
        length = (keys || obj).length,
        results = Array(length);
    for (var index = 0; index < length; index++) {
      var currentKey = keys ? keys[index] : index;
      results[index] = iteratee(obj[currentKey], currentKey, obj);
    }
    return results;
  };

  // Create a reducing function iterating left or right.
  function createReduce(dir) {
    // Optimized iterator function as using arguments.length
    // in the main function will deoptimize the, see #1991.
    function iterator(obj, iteratee, memo, keys, index, length) {
      for (; index >= 0 && index < length; index += dir) {
        var currentKey = keys ? keys[index] : index;
        memo = iteratee(memo, obj[currentKey], currentKey, obj);
      }
      return memo;
    }

    return function(obj, iteratee, memo, context) {
      iteratee = optimizeCb(iteratee, context, 4);
      var keys = !isArrayLike(obj) && _.keys(obj),
          length = (keys || obj).length,
          index = dir > 0 ? 0 : length - 1;
      // Determine the initial value if none is provided.
      if (arguments.length < 3) {
        memo = obj[keys ? keys[index] : index];
        index += dir;
      }
      return iterator(obj, iteratee, memo, keys, index, length);
    };
  }

  // **Reduce** builds up a single result from a list of values, aka `inject`,
  // or `foldl`.
  _.reduce = _.foldl = _.inject = createReduce(1);

  // The right-associative version of reduce, also known as `foldr`.
  _.reduceRight = _.foldr = createReduce(-1);

  // Return the first value which passes a truth test. Aliased as `detect`.
  _.find = _.detect = function(obj, predicate, context) {
    var key;
    if (isArrayLike(obj)) {
      key = _.findIndex(obj, predicate, context);
    } else {
      key = _.findKey(obj, predicate, context);
    }
    if (key !== void 0 && key !== -1) return obj[key];
  };

  // Return all the elements that pass a truth test.
  // Aliased as `select`.
  _.filter = _.select = function(obj, predicate, context) {
    var results = [];
    predicate = cb(predicate, context);
    _.each(obj, function(value, index, list) {
      if (predicate(value, index, list)) results.push(value);
    });
    return results;
  };

  // Return all the elements for which a truth test fails.
  _.reject = function(obj, predicate, context) {
    return _.filter(obj, _.negate(cb(predicate)), context);
  };

  // Determine whether all of the elements match a truth test.
  // Aliased as `all`.
  _.every = _.all = function(obj, predicate, context) {
    predicate = cb(predicate, context);
    var keys = !isArrayLike(obj) && _.keys(obj),
        length = (keys || obj).length;
    for (var index = 0; index < length; index++) {
      var currentKey = keys ? keys[index] : index;
      if (!predicate(obj[currentKey], currentKey, obj)) return false;
    }
    return true;
  };

  // Determine if at least one element in the object matches a truth test.
  // Aliased as `any`.
  _.some = _.any = function(obj, predicate, context) {
    predicate = cb(predicate, context);
    var keys = !isArrayLike(obj) && _.keys(obj),
        length = (keys || obj).length;
    for (var index = 0; index < length; index++) {
      var currentKey = keys ? keys[index] : index;
      if (predicate(obj[currentKey], currentKey, obj)) return true;
    }
    return false;
  };

  // Determine if the array or object contains a given item (using `===`).
  // Aliased as `includes` and `include`.
  _.contains = _.includes = _.include = function(obj, item, fromIndex, guard) {
    if (!isArrayLike(obj)) obj = _.values(obj);
    if (typeof fromIndex != 'number' || guard) fromIndex = 0;
    return _.indexOf(obj, item, fromIndex) >= 0;
  };

  // Invoke a method (with arguments) on every item in a collection.
  _.invoke = function(obj, method) {
    var args = slice.call(arguments, 2);
    var isFunc = _.isFunction(method);
    return _.map(obj, function(value) {
      var func = isFunc ? method : value[method];
      return func == null ? func : func.apply(value, args);
    });
  };

  // Convenience version of a common use case of `map`: fetching a property.
  _.pluck = function(obj, key) {
    return _.map(obj, _.property(key));
  };

  // Convenience version of a common use case of `filter`: selecting only objects
  // containing specific `key:value` pairs.
  _.where = function(obj, attrs) {
    return _.filter(obj, _.matcher(attrs));
  };

  // Convenience version of a common use case of `find`: getting the first object
  // containing specific `key:value` pairs.
  _.findWhere = function(obj, attrs) {
    return _.find(obj, _.matcher(attrs));
  };

  // Return the maximum element (or element-based computation).
  _.max = function(obj, iteratee, context) {
    var result = -Infinity, lastComputed = -Infinity,
        value, computed;
    if (iteratee == null && obj != null) {
      obj = isArrayLike(obj) ? obj : _.values(obj);
      for (var i = 0, length = obj.length; i < length; i++) {
        value = obj[i];
        if (value > result) {
          result = value;
        }
      }
    } else {
      iteratee = cb(iteratee, context);
      _.each(obj, function(value, index, list) {
        computed = iteratee(value, index, list);
        if (computed > lastComputed || computed === -Infinity && result === -Infinity) {
          result = value;
          lastComputed = computed;
        }
      });
    }
    return result;
  };

  // Return the minimum element (or element-based computation).
  _.min = function(obj, iteratee, context) {
    var result = Infinity, lastComputed = Infinity,
        value, computed;
    if (iteratee == null && obj != null) {
      obj = isArrayLike(obj) ? obj : _.values(obj);
      for (var i = 0, length = obj.length; i < length; i++) {
        value = obj[i];
        if (value < result) {
          result = value;
        }
      }
    } else {
      iteratee = cb(iteratee, context);
      _.each(obj, function(value, index, list) {
        computed = iteratee(value, index, list);
        if (computed < lastComputed || computed === Infinity && result === Infinity) {
          result = value;
          lastComputed = computed;
        }
      });
    }
    return result;
  };

  // Shuffle a collection, using the modern version of the
  // [Fisher-Yates shuffle](http://en.wikipedia.org/wiki/Fisher–Yates_shuffle).
  _.shuffle = function(obj) {
    var set = isArrayLike(obj) ? obj : _.values(obj);
    var length = set.length;
    var shuffled = Array(length);
    for (var index = 0, rand; index < length; index++) {
      rand = _.random(0, index);
      if (rand !== index) shuffled[index] = shuffled[rand];
      shuffled[rand] = set[index];
    }
    return shuffled;
  };

  // Sample **n** random values from a collection.
  // If **n** is not specified, returns a single random element.
  // The internal `guard` argument allows it to work with `map`.
  _.sample = function(obj, n, guard) {
    if (n == null || guard) {
      if (!isArrayLike(obj)) obj = _.values(obj);
      return obj[_.random(obj.length - 1)];
    }
    return _.shuffle(obj).slice(0, Math.max(0, n));
  };

  // Sort the object's values by a criterion produced by an iteratee.
  _.sortBy = function(obj, iteratee, context) {
    iteratee = cb(iteratee, context);
    return _.pluck(_.map(obj, function(value, index, list) {
      return {
        value: value,
        index: index,
        criteria: iteratee(value, index, list)
      };
    }).sort(function(left, right) {
      var a = left.criteria;
      var b = right.criteria;
      if (a !== b) {
        if (a > b || a === void 0) return 1;
        if (a < b || b === void 0) return -1;
      }
      return left.index - right.index;
    }), 'value');
  };

  // An internal function used for aggregate "group by" operations.
  var group = function(behavior) {
    return function(obj, iteratee, context) {
      var result = {};
      iteratee = cb(iteratee, context);
      _.each(obj, function(value, index) {
        var key = iteratee(value, index, obj);
        behavior(result, value, key);
      });
      return result;
    };
  };

  // Groups the object's values by a criterion. Pass either a string attribute
  // to group by, or a function that returns the criterion.
  _.groupBy = group(function(result, value, key) {
    if (_.has(result, key)) result[key].push(value); else result[key] = [value];
  });

  // Indexes the object's values by a criterion, similar to `groupBy`, but for
  // when you know that your index values will be unique.
  _.indexBy = group(function(result, value, key) {
    result[key] = value;
  });

  // Counts instances of an object that group by a certain criterion. Pass
  // either a string attribute to count by, or a function that returns the
  // criterion.
  _.countBy = group(function(result, value, key) {
    if (_.has(result, key)) result[key]++; else result[key] = 1;
  });

  // Safely create a real, live array from anything iterable.
  _.toArray = function(obj) {
    if (!obj) return [];
    if (_.isArray(obj)) return slice.call(obj);
    if (isArrayLike(obj)) return _.map(obj, _.identity);
    return _.values(obj);
  };

  // Return the number of elements in an object.
  _.size = function(obj) {
    if (obj == null) return 0;
    return isArrayLike(obj) ? obj.length : _.keys(obj).length;
  };

  // Split a collection into two arrays: one whose elements all satisfy the given
  // predicate, and one whose elements all do not satisfy the predicate.
  _.partition = function(obj, predicate, context) {
    predicate = cb(predicate, context);
    var pass = [], fail = [];
    _.each(obj, function(value, key, obj) {
      (predicate(value, key, obj) ? pass : fail).push(value);
    });
    return [pass, fail];
  };

  // Array Functions
  // ---------------

  // Get the first element of an array. Passing **n** will return the first N
  // values in the array. Aliased as `head` and `take`. The **guard** check
  // allows it to work with `_.map`.
  _.first = _.head = _.take = function(array, n, guard) {
    if (array == null) return void 0;
    if (n == null || guard) return array[0];
    return _.initial(array, array.length - n);
  };

  // Returns everything but the last entry of the array. Especially useful on
  // the arguments object. Passing **n** will return all the values in
  // the array, excluding the last N.
  _.initial = function(array, n, guard) {
    return slice.call(array, 0, Math.max(0, array.length - (n == null || guard ? 1 : n)));
  };

  // Get the last element of an array. Passing **n** will return the last N
  // values in the array.
  _.last = function(array, n, guard) {
    if (array == null) return void 0;
    if (n == null || guard) return array[array.length - 1];
    return _.rest(array, Math.max(0, array.length - n));
  };

  // Returns everything but the first entry of the array. Aliased as `tail` and `drop`.
  // Especially useful on the arguments object. Passing an **n** will return
  // the rest N values in the array.
  _.rest = _.tail = _.drop = function(array, n, guard) {
    return slice.call(array, n == null || guard ? 1 : n);
  };

  // Trim out all falsy values from an array.
  _.compact = function(array) {
    return _.filter(array, _.identity);
  };

  // Internal implementation of a recursive `flatten` function.
  var flatten = function(input, shallow, strict, startIndex) {
    var output = [], idx = 0;
    for (var i = startIndex || 0, length = getLength(input); i < length; i++) {
      var value = input[i];
      if (isArrayLike(value) && (_.isArray(value) || _.isArguments(value))) {
        //flatten current level of array or arguments object
        if (!shallow) value = flatten(value, shallow, strict);
        var j = 0, len = value.length;
        output.length += len;
        while (j < len) {
          output[idx++] = value[j++];
        }
      } else if (!strict) {
        output[idx++] = value;
      }
    }
    return output;
  };

  // Flatten out an array, either recursively (by default), or just one level.
  _.flatten = function(array, shallow) {
    return flatten(array, shallow, false);
  };

  // Return a version of the array that does not contain the specified value(s).
  _.without = function(array) {
    return _.difference(array, slice.call(arguments, 1));
  };

  // Produce a duplicate-free version of the array. If the array has already
  // been sorted, you have the option of using a faster algorithm.
  // Aliased as `unique`.
  _.uniq = _.unique = function(array, isSorted, iteratee, context) {
    if (!_.isBoolean(isSorted)) {
      context = iteratee;
      iteratee = isSorted;
      isSorted = false;
    }
    if (iteratee != null) iteratee = cb(iteratee, context);
    var result = [];
    var seen = [];
    for (var i = 0, length = getLength(array); i < length; i++) {
      var value = array[i],
          computed = iteratee ? iteratee(value, i, array) : value;
      if (isSorted) {
        if (!i || seen !== computed) result.push(value);
        seen = computed;
      } else if (iteratee) {
        if (!_.contains(seen, computed)) {
          seen.push(computed);
          result.push(value);
        }
      } else if (!_.contains(result, value)) {
        result.push(value);
      }
    }
    return result;
  };

  // Produce an array that contains the union: each distinct element from all of
  // the passed-in arrays.
  _.union = function() {
    return _.uniq(flatten(arguments, true, true));
  };

  // Produce an array that contains every item shared between all the
  // passed-in arrays.
  _.intersection = function(array) {
    var result = [];
    var argsLength = arguments.length;
    for (var i = 0, length = getLength(array); i < length; i++) {
      var item = array[i];
      if (_.contains(result, item)) continue;
      for (var j = 1; j < argsLength; j++) {
        if (!_.contains(arguments[j], item)) break;
      }
      if (j === argsLength) result.push(item);
    }
    return result;
  };

  // Take the difference between one array and a number of other arrays.
  // Only the elements present in just the first array will remain.
  _.difference = function(array) {
    var rest = flatten(arguments, true, true, 1);
    return _.filter(array, function(value){
      return !_.contains(rest, value);
    });
  };

  // Zip together multiple lists into a single array -- elements that share
  // an index go together.
  _.zip = function() {
    return _.unzip(arguments);
  };

  // Complement of _.zip. Unzip accepts an array of arrays and groups
  // each array's elements on shared indices
  _.unzip = function(array) {
    var length = array && _.max(array, getLength).length || 0;
    var result = Array(length);

    for (var index = 0; index < length; index++) {
      result[index] = _.pluck(array, index);
    }
    return result;
  };

  // Converts lists into objects. Pass either a single array of `[key, value]`
  // pairs, or two parallel arrays of the same length -- one of keys, and one of
  // the corresponding values.
  _.object = function(list, values) {
    var result = {};
    for (var i = 0, length = getLength(list); i < length; i++) {
      if (values) {
        result[list[i]] = values[i];
      } else {
        result[list[i][0]] = list[i][1];
      }
    }
    return result;
  };

  // Generator function to create the findIndex and findLastIndex functions
  function createPredicateIndexFinder(dir) {
    return function(array, predicate, context) {
      predicate = cb(predicate, context);
      var length = getLength(array);
      var index = dir > 0 ? 0 : length - 1;
      for (; index >= 0 && index < length; index += dir) {
        if (predicate(array[index], index, array)) return index;
      }
      return -1;
    };
  }

  // Returns the first index on an array-like that passes a predicate test
  _.findIndex = createPredicateIndexFinder(1);
  _.findLastIndex = createPredicateIndexFinder(-1);

  // Use a comparator function to figure out the smallest index at which
  // an object should be inserted so as to maintain order. Uses binary search.
  _.sortedIndex = function(array, obj, iteratee, context) {
    iteratee = cb(iteratee, context, 1);
    var value = iteratee(obj);
    var low = 0, high = getLength(array);
    while (low < high) {
      var mid = Math.floor((low + high) / 2);
      if (iteratee(array[mid]) < value) low = mid + 1; else high = mid;
    }
    return low;
  };

  // Generator function to create the indexOf and lastIndexOf functions
  function createIndexFinder(dir, predicateFind, sortedIndex) {
    return function(array, item, idx) {
      var i = 0, length = getLength(array);
      if (typeof idx == 'number') {
        if (dir > 0) {
            i = idx >= 0 ? idx : Math.max(idx + length, i);
        } else {
            length = idx >= 0 ? Math.min(idx + 1, length) : idx + length + 1;
        }
      } else if (sortedIndex && idx && length) {
        idx = sortedIndex(array, item);
        return array[idx] === item ? idx : -1;
      }
      if (item !== item) {
        idx = predicateFind(slice.call(array, i, length), _.isNaN);
        return idx >= 0 ? idx + i : -1;
      }
      for (idx = dir > 0 ? i : length - 1; idx >= 0 && idx < length; idx += dir) {
        if (array[idx] === item) return idx;
      }
      return -1;
    };
  }

  // Return the position of the first occurrence of an item in an array,
  // or -1 if the item is not included in the array.
  // If the array is large and already in sort order, pass `true`
  // for **isSorted** to use binary search.
  _.indexOf = createIndexFinder(1, _.findIndex, _.sortedIndex);
  _.lastIndexOf = createIndexFinder(-1, _.findLastIndex);

  // Generate an integer Array containing an arithmetic progression. A port of
  // the native Python `range()` function. See
  // [the Python documentation](http://docs.python.org/library/functions.html#range).
  _.range = function(start, stop, step) {
    if (stop == null) {
      stop = start || 0;
      start = 0;
    }
    step = step || 1;

    var length = Math.max(Math.ceil((stop - start) / step), 0);
    var range = Array(length);

    for (var idx = 0; idx < length; idx++, start += step) {
      range[idx] = start;
    }

    return range;
  };

  // Function (ahem) Functions
  // ------------------

  // Determines whether to execute a function as a constructor
  // or a normal function with the provided arguments
  var executeBound = function(sourceFunc, boundFunc, context, callingContext, args) {
    if (!(callingContext instanceof boundFunc)) return sourceFunc.apply(context, args);
    var self = baseCreate(sourceFunc.prototype);
    var result = sourceFunc.apply(self, args);
    if (_.isObject(result)) return result;
    return self;
  };

  // Create a function bound to a given object (assigning `this`, and arguments,
  // optionally). Delegates to **ECMAScript 5**'s native `Function.bind` if
  // available.
  _.bind = function(func, context) {
    if (nativeBind && func.bind === nativeBind) return nativeBind.apply(func, slice.call(arguments, 1));
    if (!_.isFunction(func)) throw new TypeError('Bind must be called on a function');
    var args = slice.call(arguments, 2);
    var bound = function() {
      return executeBound(func, bound, context, this, args.concat(slice.call(arguments)));
    };
    return bound;
  };

  // Partially apply a function by creating a version that has had some of its
  // arguments pre-filled, without changing its dynamic `this` context. _ acts
  // as a placeholder, allowing any combination of arguments to be pre-filled.
  _.partial = function(func) {
    var boundArgs = slice.call(arguments, 1);
    var bound = function() {
      var position = 0, length = boundArgs.length;
      var args = Array(length);
      for (var i = 0; i < length; i++) {
        args[i] = boundArgs[i] === _ ? arguments[position++] : boundArgs[i];
      }
      while (position < arguments.length) args.push(arguments[position++]);
      return executeBound(func, bound, this, this, args);
    };
    return bound;
  };

  // Bind a number of an object's methods to that object. Remaining arguments
  // are the method names to be bound. Useful for ensuring that all callbacks
  // defined on an object belong to it.
  _.bindAll = function(obj) {
    var i, length = arguments.length, key;
    if (length <= 1) throw new Error('bindAll must be passed function names');
    for (i = 1; i < length; i++) {
      key = arguments[i];
      obj[key] = _.bind(obj[key], obj);
    }
    return obj;
  };

  // Memoize an expensive function by storing its results.
  _.memoize = function(func, hasher) {
    var memoize = function(key) {
      var cache = memoize.cache;
      var address = '' + (hasher ? hasher.apply(this, arguments) : key);
      if (!_.has(cache, address)) cache[address] = func.apply(this, arguments);
      return cache[address];
    };
    memoize.cache = {};
    return memoize;
  };

  // Delays a function for the given number of milliseconds, and then calls
  // it with the arguments supplied.
  _.delay = function(func, wait) {
    var args = slice.call(arguments, 2);
    return setTimeout(function(){
      return func.apply(null, args);
    }, wait);
  };

  // Defers a function, scheduling it to run after the current call stack has
  // cleared.
  _.defer = _.partial(_.delay, _, 1);

  // Returns a function, that, when invoked, will only be triggered at most once
  // during a given window of time. Normally, the throttled function will run
  // as much as it can, without ever going more than once per `wait` duration;
  // but if you'd like to disable the execution on the leading edge, pass
  // `{leading: false}`. To disable execution on the trailing edge, ditto.
  _.throttle = function(func, wait, options) {
    var context, args, result;
    var timeout = null;
    var previous = 0;
    if (!options) options = {};
    var later = function() {
      previous = options.leading === false ? 0 : _.now();
      timeout = null;
      result = func.apply(context, args);
      if (!timeout) context = args = null;
    };
    return function() {
      var now = _.now();
      if (!previous && options.leading === false) previous = now;
      var remaining = wait - (now - previous);
      context = this;
      args = arguments;
      if (remaining <= 0 || remaining > wait) {
        if (timeout) {
          clearTimeout(timeout);
          timeout = null;
        }
        previous = now;
        result = func.apply(context, args);
        if (!timeout) context = args = null;
      } else if (!timeout && options.trailing !== false) {
        timeout = setTimeout(later, remaining);
      }
      return result;
    };
  };

  // Returns a function, that, as long as it continues to be invoked, will not
  // be triggered. The function will be called after it stops being called for
  // N milliseconds. If `immediate` is passed, trigger the function on the
  // leading edge, instead of the trailing.
  _.debounce = function(func, wait, immediate) {
    var timeout, args, context, timestamp, result;

    var later = function() {
      var last = _.now() - timestamp;

      if (last < wait && last >= 0) {
        timeout = setTimeout(later, wait - last);
      } else {
        timeout = null;
        if (!immediate) {
          result = func.apply(context, args);
          if (!timeout) context = args = null;
        }
      }
    };

    return function() {
      context = this;
      args = arguments;
      timestamp = _.now();
      var callNow = immediate && !timeout;
      if (!timeout) timeout = setTimeout(later, wait);
      if (callNow) {
        result = func.apply(context, args);
        context = args = null;
      }

      return result;
    };
  };

  // Returns the first function passed as an argument to the second,
  // allowing you to adjust arguments, run code before and after, and
  // conditionally execute the original function.
  _.wrap = function(func, wrapper) {
    return _.partial(wrapper, func);
  };

  // Returns a negated version of the passed-in predicate.
  _.negate = function(predicate) {
    return function() {
      return !predicate.apply(this, arguments);
    };
  };

  // Returns a function that is the composition of a list of functions, each
  // consuming the return value of the function that follows.
  _.compose = function() {
    var args = arguments;
    var start = args.length - 1;
    return function() {
      var i = start;
      var result = args[start].apply(this, arguments);
      while (i--) result = args[i].call(this, result);
      return result;
    };
  };

  // Returns a function that will only be executed on and after the Nth call.
  _.after = function(times, func) {
    return function() {
      if (--times < 1) {
        return func.apply(this, arguments);
      }
    };
  };

  // Returns a function that will only be executed up to (but not including) the Nth call.
  _.before = function(times, func) {
    var memo;
    return function() {
      if (--times > 0) {
        memo = func.apply(this, arguments);
      }
      if (times <= 1) func = null;
      return memo;
    };
  };

  // Returns a function that will be executed at most one time, no matter how
  // often you call it. Useful for lazy initialization.
  _.once = _.partial(_.before, 2);

  // Object Functions
  // ----------------

  // Keys in IE < 9 that won't be iterated by `for key in ...` and thus missed.
  var hasEnumBug = !{toString: null}.propertyIsEnumerable('toString');
  var nonEnumerableProps = ['valueOf', 'isPrototypeOf', 'toString',
                      'propertyIsEnumerable', 'hasOwnProperty', 'toLocaleString'];

  function collectNonEnumProps(obj, keys) {
    var nonEnumIdx = nonEnumerableProps.length;
    var constructor = obj.constructor;
    var proto = (_.isFunction(constructor) && constructor.prototype) || ObjProto;

    // Constructor is a special case.
    var prop = 'constructor';
    if (_.has(obj, prop) && !_.contains(keys, prop)) keys.push(prop);

    while (nonEnumIdx--) {
      prop = nonEnumerableProps[nonEnumIdx];
      if (prop in obj && obj[prop] !== proto[prop] && !_.contains(keys, prop)) {
        keys.push(prop);
      }
    }
  }

  // Retrieve the names of an object's own properties.
  // Delegates to **ECMAScript 5**'s native `Object.keys`
  _.keys = function(obj) {
    if (!_.isObject(obj)) return [];
    if (nativeKeys) return nativeKeys(obj);
    var keys = [];
    for (var key in obj) if (_.has(obj, key)) keys.push(key);
    // Ahem, IE < 9.
    if (hasEnumBug) collectNonEnumProps(obj, keys);
    return keys;
  };

  // Retrieve all the property names of an object.
  _.allKeys = function(obj) {
    if (!_.isObject(obj)) return [];
    var keys = [];
    for (var key in obj) keys.push(key);
    // Ahem, IE < 9.
    if (hasEnumBug) collectNonEnumProps(obj, keys);
    return keys;
  };

  // Retrieve the values of an object's properties.
  _.values = function(obj) {
    var keys = _.keys(obj);
    var length = keys.length;
    var values = Array(length);
    for (var i = 0; i < length; i++) {
      values[i] = obj[keys[i]];
    }
    return values;
  };

  // Returns the results of applying the iteratee to each element of the object
  // In contrast to _.map it returns an object
  _.mapObject = function(obj, iteratee, context) {
    iteratee = cb(iteratee, context);
    var keys =  _.keys(obj),
          length = keys.length,
          results = {},
          currentKey;
      for (var index = 0; index < length; index++) {
        currentKey = keys[index];
        results[currentKey] = iteratee(obj[currentKey], currentKey, obj);
      }
      return results;
  };

  // Convert an object into a list of `[key, value]` pairs.
  _.pairs = function(obj) {
    var keys = _.keys(obj);
    var length = keys.length;
    var pairs = Array(length);
    for (var i = 0; i < length; i++) {
      pairs[i] = [keys[i], obj[keys[i]]];
    }
    return pairs;
  };

  // Invert the keys and values of an object. The values must be serializable.
  _.invert = function(obj) {
    var result = {};
    var keys = _.keys(obj);
    for (var i = 0, length = keys.length; i < length; i++) {
      result[obj[keys[i]]] = keys[i];
    }
    return result;
  };

  // Return a sorted list of the function names available on the object.
  // Aliased as `methods`
  _.functions = _.methods = function(obj) {
    var names = [];
    for (var key in obj) {
      if (_.isFunction(obj[key])) names.push(key);
    }
    return names.sort();
  };

  // Extend a given object with all the properties in passed-in object(s).
  _.extend = createAssigner(_.allKeys);

  // Assigns a given object with all the own properties in the passed-in object(s)
  // (https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object/assign)
  _.extendOwn = _.assign = createAssigner(_.keys);

  // Returns the first key on an object that passes a predicate test
  _.findKey = function(obj, predicate, context) {
    predicate = cb(predicate, context);
    var keys = _.keys(obj), key;
    for (var i = 0, length = keys.length; i < length; i++) {
      key = keys[i];
      if (predicate(obj[key], key, obj)) return key;
    }
  };

  // Return a copy of the object only containing the whitelisted properties.
  _.pick = function(object, oiteratee, context) {
    var result = {}, obj = object, iteratee, keys;
    if (obj == null) return result;
    if (_.isFunction(oiteratee)) {
      keys = _.allKeys(obj);
      iteratee = optimizeCb(oiteratee, context);
    } else {
      keys = flatten(arguments, false, false, 1);
      iteratee = function(value, key, obj) { return key in obj; };
      obj = Object(obj);
    }
    for (var i = 0, length = keys.length; i < length; i++) {
      var key = keys[i];
      var value = obj[key];
      if (iteratee(value, key, obj)) result[key] = value;
    }
    return result;
  };

   // Return a copy of the object without the blacklisted properties.
  _.omit = function(obj, iteratee, context) {
    if (_.isFunction(iteratee)) {
      iteratee = _.negate(iteratee);
    } else {
      var keys = _.map(flatten(arguments, false, false, 1), String);
      iteratee = function(value, key) {
        return !_.contains(keys, key);
      };
    }
    return _.pick(obj, iteratee, context);
  };

  // Fill in a given object with default properties.
  _.defaults = createAssigner(_.allKeys, true);

  // Creates an object that inherits from the given prototype object.
  // If additional properties are provided then they will be added to the
  // created object.
  _.create = function(prototype, props) {
    var result = baseCreate(prototype);
    if (props) _.extendOwn(result, props);
    return result;
  };

  // Create a (shallow-cloned) duplicate of an object.
  _.clone = function(obj) {
    if (!_.isObject(obj)) return obj;
    return _.isArray(obj) ? obj.slice() : _.extend({}, obj);
  };

  // Invokes interceptor with the obj, and then returns obj.
  // The primary purpose of this method is to "tap into" a method chain, in
  // order to perform operations on intermediate results within the chain.
  _.tap = function(obj, interceptor) {
    interceptor(obj);
    return obj;
  };

  // Returns whether an object has a given set of `key:value` pairs.
  _.isMatch = function(object, attrs) {
    var keys = _.keys(attrs), length = keys.length;
    if (object == null) return !length;
    var obj = Object(object);
    for (var i = 0; i < length; i++) {
      var key = keys[i];
      if (attrs[key] !== obj[key] || !(key in obj)) return false;
    }
    return true;
  };


  // Internal recursive comparison function for `isEqual`.
  var eq = function(a, b, aStack, bStack) {
    // Identical objects are equal. `0 === -0`, but they aren't identical.
    // See the [Harmony `egal` proposal](http://wiki.ecmascript.org/doku.php?id=harmony:egal).
    if (a === b) return a !== 0 || 1 / a === 1 / b;
    // A strict comparison is necessary because `null == undefined`.
    if (a == null || b == null) return a === b;
    // Unwrap any wrapped objects.
    if (a instanceof _) a = a._wrapped;
    if (b instanceof _) b = b._wrapped;
    // Compare `[[Class]]` names.
    var className = toString.call(a);
    if (className !== toString.call(b)) return false;
    switch (className) {
      // Strings, numbers, regular expressions, dates, and booleans are compared by value.
      case '[object RegExp]':
      // RegExps are coerced to strings for comparison (Note: '' + /a/i === '/a/i')
      case '[object String]':
        // Primitives and their corresponding object wrappers are equivalent; thus, `"5"` is
        // equivalent to `new String("5")`.
        return '' + a === '' + b;
      case '[object Number]':
        // `NaN`s are equivalent, but non-reflexive.
        // Object(NaN) is equivalent to NaN
        if (+a !== +a) return +b !== +b;
        // An `egal` comparison is performed for other numeric values.
        return +a === 0 ? 1 / +a === 1 / b : +a === +b;
      case '[object Date]':
      case '[object Boolean]':
        // Coerce dates and booleans to numeric primitive values. Dates are compared by their
        // millisecond representations. Note that invalid dates with millisecond representations
        // of `NaN` are not equivalent.
        return +a === +b;
    }

    var areArrays = className === '[object Array]';
    if (!areArrays) {
      if (typeof a != 'object' || typeof b != 'object') return false;

      // Objects with different constructors are not equivalent, but `Object`s or `Array`s
      // from different frames are.
      var aCtor = a.constructor, bCtor = b.constructor;
      if (aCtor !== bCtor && !(_.isFunction(aCtor) && aCtor instanceof aCtor &&
                               _.isFunction(bCtor) && bCtor instanceof bCtor)
                          && ('constructor' in a && 'constructor' in b)) {
        return false;
      }
    }
    // Assume equality for cyclic structures. The algorithm for detecting cyclic
    // structures is adapted from ES 5.1 section 15.12.3, abstract operation `JO`.

    // Initializing stack of traversed objects.
    // It's done here since we only need them for objects and arrays comparison.
    aStack = aStack || [];
    bStack = bStack || [];
    var length = aStack.length;
    while (length--) {
      // Linear search. Performance is inversely proportional to the number of
      // unique nested structures.
      if (aStack[length] === a) return bStack[length] === b;
    }

    // Add the first object to the stack of traversed objects.
    aStack.push(a);
    bStack.push(b);

    // Recursively compare objects and arrays.
    if (areArrays) {
      // Compare array lengths to determine if a deep comparison is necessary.
      length = a.length;
      if (length !== b.length) return false;
      // Deep compare the contents, ignoring non-numeric properties.
      while (length--) {
        if (!eq(a[length], b[length], aStack, bStack)) return false;
      }
    } else {
      // Deep compare objects.
      var keys = _.keys(a), key;
      length = keys.length;
      // Ensure that both objects contain the same number of properties before comparing deep equality.
      if (_.keys(b).length !== length) return false;
      while (length--) {
        // Deep compare each member
        key = keys[length];
        if (!(_.has(b, key) && eq(a[key], b[key], aStack, bStack))) return false;
      }
    }
    // Remove the first object from the stack of traversed objects.
    aStack.pop();
    bStack.pop();
    return true;
  };

  // Perform a deep comparison to check if two objects are equal.
  _.isEqual = function(a, b) {
    return eq(a, b);
  };

  // Is a given array, string, or object empty?
  // An "empty" object has no enumerable own-properties.
  _.isEmpty = function(obj) {
    if (obj == null) return true;
    if (isArrayLike(obj) && (_.isArray(obj) || _.isString(obj) || _.isArguments(obj))) return obj.length === 0;
    return _.keys(obj).length === 0;
  };

  // Is a given value a DOM element?
  _.isElement = function(obj) {
    return !!(obj && obj.nodeType === 1);
  };

  // Is a given value an array?
  // Delegates to ECMA5's native Array.isArray
  _.isArray = nativeIsArray || function(obj) {
    return toString.call(obj) === '[object Array]';
  };

  // Is a given variable an object?
  _.isObject = function(obj) {
    var type = typeof obj;
    return type === 'function' || type === 'object' && !!obj;
  };

  // Add some isType methods: isArguments, isFunction, isString, isNumber, isDate, isRegExp, isError.
  _.each(['Arguments', 'Function', 'String', 'Number', 'Date', 'RegExp', 'Error'], function(name) {
    _['is' + name] = function(obj) {
      return toString.call(obj) === '[object ' + name + ']';
    };
  });


  // Optimize `isFunction` if appropriate. Work around some typeof bugs in old v8,
  // IE 11 (#1621), and in Safari 8 (#1929).
  if (typeof /./ != 'function' && typeof Int8Array != 'object') {
    _.isFunction = function(obj) {
      return typeof obj == 'function' || false;
    };
  }

  // Is a given object a finite number?
  _.isFinite = function(obj) {
    return isFinite(obj) && !isNaN(parseFloat(obj));
  };

  // Is the given value `NaN`? (NaN is the only number which does not equal itself).
  _.isNaN = function(obj) {
    return _.isNumber(obj) && obj !== +obj;
  };

  // Is a given value a boolean?
  _.isBoolean = function(obj) {
    return obj === true || obj === false || toString.call(obj) === '[object Boolean]';
  };

  // Is a given value equal to null?
  _.isNull = function(obj) {
    return obj === null;
  };

  // Is a given variable undefined?
  _.isUndefined = function(obj) {
    return obj === void 0;
  };

  // Shortcut function for checking if an object has a given property directly
  // on itself (in other words, not on a prototype).
  _.has = function(obj, key) {
    return obj != null && hasOwnProperty.call(obj, key);
  };

  // Keep the identity function around for default iteratees.
  _.identity = function(value) {
    return value;
  };

  // Predicate-generating functions. Often useful outside of Underscore.
  _.constant = function(value) {
    return function() {
      return value;
    };
  };

  _.noop = function(){};

  _.property = property;

  // Generates a function for a given object that returns a given property.
  _.propertyOf = function(obj) {
    return obj == null ? function(){} : function(key) {
      return obj[key];
    };
  };

  // Returns a predicate for checking whether an object has a given set of
  // `key:value` pairs.
  _.matcher = _.matches = function(attrs) {
    attrs = _.extendOwn({}, attrs);
    return function(obj) {
      return _.isMatch(obj, attrs);
    };
  };

  // Run a function **n** times.
  _.times = function(n, iteratee, context) {
    var accum = Array(Math.max(0, n));
    iteratee = optimizeCb(iteratee, context, 1);
    for (var i = 0; i < n; i++) accum[i] = iteratee(i);
    return accum;
  };

  // Return a random integer between min and max (inclusive).
  _.random = function(min, max) {
    if (max == null) {
      max = min;
      min = 0;
    }
    return min + Math.floor(Math.random() * (max - min + 1));
  };

  // A (possibly faster) way to get the current timestamp as an integer.
  _.now = Date.now || function() {
    return new Date().getTime();
  };

   // List of HTML entities for escaping.
  var escapeMap = {
    '&': '&amp;',
    '<': '&lt;',
    '>': '&gt;',
    '"': '&quot;',
    "'": '&#x27;',
    '`': '&#x60;'
  };
  var unescapeMap = _.invert(escapeMap);

  // Functions for escaping and unescaping strings to/from HTML interpolation.
  var createEscaper = function(map) {
    var escaper = function(match) {
      return map[match];
    };
    // Regexes for identifying a key that needs to be escaped
    var source = '(?:' + _.keys(map).join('|') + ')';
    var testRegexp = RegExp(source);
    var replaceRegexp = RegExp(source, 'g');
    return function(string) {
      string = string == null ? '' : '' + string;
      return testRegexp.test(string) ? string.replace(replaceRegexp, escaper) : string;
    };
  };
  _.escape = createEscaper(escapeMap);
  _.unescape = createEscaper(unescapeMap);

  // If the value of the named `property` is a function then invoke it with the
  // `object` as context; otherwise, return it.
  _.result = function(object, property, fallback) {
    var value = object == null ? void 0 : object[property];
    if (value === void 0) {
      value = fallback;
    }
    return _.isFunction(value) ? value.call(object) : value;
  };

  // Generate a unique integer id (unique within the entire client session).
  // Useful for temporary DOM ids.
  var idCounter = 0;
  _.uniqueId = function(prefix) {
    var id = ++idCounter + '';
    return prefix ? prefix + id : id;
  };

  // By default, Underscore uses ERB-style template delimiters, change the
  // following template settings to use alternative delimiters.
  _.templateSettings = {
    evaluate    : /<%([\s\S]+?)%>/g,
    interpolate : /<%=([\s\S]+?)%>/g,
    escape      : /<%-([\s\S]+?)%>/g
  };

  // When customizing `templateSettings`, if you don't want to define an
  // interpolation, evaluation or escaping regex, we need one that is
  // guaranteed not to match.
  var noMatch = /(.)^/;

  // Certain characters need to be escaped so that they can be put into a
  // string literal.
  var escapes = {
    "'":      "'",
    '\\':     '\\',
    '\r':     'r',
    '\n':     'n',
    '\u2028': 'u2028',
    '\u2029': 'u2029'
  };

  var escaper = /\\|'|\r|\n|\u2028|\u2029/g;

  var escapeChar = function(match) {
    return '\\' + escapes[match];
  };

  // JavaScript micro-templating, similar to John Resig's implementation.
  // Underscore templating handles arbitrary delimiters, preserves whitespace,
  // and correctly escapes quotes within interpolated code.
  // NB: `oldSettings` only exists for backwards compatibility.
  _.template = function(text, settings, oldSettings) {
    if (!settings && oldSettings) settings = oldSettings;
    settings = _.defaults({}, settings, _.templateSettings);

    // Combine delimiters into one regular expression via alternation.
    var matcher = RegExp([
      (settings.escape || noMatch).source,
      (settings.interpolate || noMatch).source,
      (settings.evaluate || noMatch).source
    ].join('|') + '|$', 'g');

    // Compile the template source, escaping string literals appropriately.
    var index = 0;
    var source = "__p+='";
    text.replace(matcher, function(match, escape, interpolate, evaluate, offset) {
      source += text.slice(index, offset).replace(escaper, escapeChar);
      index = offset + match.length;

      if (escape) {
        source += "'+\n((__t=(" + escape + "))==null?'':_.escape(__t))+\n'";
      } else if (interpolate) {
        source += "'+\n((__t=(" + interpolate + "))==null?'':__t)+\n'";
      } else if (evaluate) {
        source += "';\n" + evaluate + "\n__p+='";
      }

      // Adobe VMs need the match returned to produce the correct offest.
      return match;
    });
    source += "';\n";

    // If a variable is not specified, place data values in local scope.
    if (!settings.variable) source = 'with(obj||{}){\n' + source + '}\n';

    source = "var __t,__p='',__j=Array.prototype.join," +
      "print=function(){__p+=__j.call(arguments,'');};\n" +
      source + 'return __p;\n';

    try {
      var render = new Function(settings.variable || 'obj', '_', source);
    } catch (e) {
      e.source = source;
      throw e;
    }

    var template = function(data) {
      return render.call(this, data, _);
    };

    // Provide the compiled source as a convenience for precompilation.
    var argument = settings.variable || 'obj';
    template.source = 'function(' + argument + '){\n' + source + '}';

    return template;
  };

  // Add a "chain" function. Start chaining a wrapped Underscore object.
  _.chain = function(obj) {
    var instance = _(obj);
    instance._chain = true;
    return instance;
  };

  // OOP
  // ---------------
  // If Underscore is called as a function, it returns a wrapped object that
  // can be used OO-style. This wrapper holds altered versions of all the
  // underscore functions. Wrapped objects may be chained.

  // Helper function to continue chaining intermediate results.
  var result = function(instance, obj) {
    return instance._chain ? _(obj).chain() : obj;
  };

  // Add your own custom functions to the Underscore object.
  _.mixin = function(obj) {
    _.each(_.functions(obj), function(name) {
      var func = _[name] = obj[name];
      _.prototype[name] = function() {
        var args = [this._wrapped];
        push.apply(args, arguments);
        return result(this, func.apply(_, args));
      };
    });
  };

  // Add all of the Underscore functions to the wrapper object.
  _.mixin(_);

  // Add all mutator Array functions to the wrapper.
  _.each(['pop', 'push', 'reverse', 'shift', 'sort', 'splice', 'unshift'], function(name) {
    var method = ArrayProto[name];
    _.prototype[name] = function() {
      var obj = this._wrapped;
      method.apply(obj, arguments);
      if ((name === 'shift' || name === 'splice') && obj.length === 0) delete obj[0];
      return result(this, obj);
    };
  });

  // Add all accessor Array functions to the wrapper.
  _.each(['concat', 'join', 'slice'], function(name) {
    var method = ArrayProto[name];
    _.prototype[name] = function() {
      return result(this, method.apply(this._wrapped, arguments));
    };
  });

  // Extracts the result from a wrapped and chained object.
  _.prototype.value = function() {
    return this._wrapped;
  };

  // Provide unwrapping proxy for some methods used in engine operations
  // such as arithmetic and JSON stringification.
  _.prototype.valueOf = _.prototype.toJSON = _.prototype.value;

  _.prototype.toString = function() {
    return '' + this._wrapped;
  };

  module.exports = _;


/***/ }),
/* 5 */
/***/ (function(module, exports) {


String.prototype.format  = function () {
  var str = this.toString();
  if (arguments.length) {
    var type = typeof arguments[0]
      , args = type == 'string' || type == 'number' ? Array.prototype.slice.call(arguments) : arguments[0]
    //
    // for (var arg in args) str = str.replace(new RegExp('\\{' + arg + '\\}', 'gi'), args[arg])

    str = str.replace(/\{([^}]*)\}/g,function(a,b){
      return utils.evalInContext(b,args)
    })
  }

  return str
};

utils = {
  extractVariables: function (str) {
    return str.match(/(?!(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$)[$A-Z\_a-z\xaa\xb5\xba\xc0-\xd6\xd8-\xf6\xf8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u08a0\u08a2-\u08ac\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097f\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58\u0c59\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d60\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f0\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191c\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19c1-\u19c7\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua697\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa80-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uabc0-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc][$A-Z\_a-z\xaa\xb5\xba\xc0-\xd6\xd8-\xf6\xf8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u08a0\u08a2-\u08ac\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097f\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58\u0c59\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d60\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f0\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191c\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19c1-\u19c7\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua697\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa80-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uabc0-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc0-9\u0300-\u036f\u0483-\u0487\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u0669\u0670\u06d6-\u06dc\u06df-\u06e4\u06e7\u06e8\u06ea-\u06ed\u06f0-\u06f9\u0711\u0730-\u074a\u07a6-\u07b0\u07c0-\u07c9\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0859-\u085b\u08e4-\u08fe\u0900-\u0903\u093a-\u093c\u093e-\u094f\u0951-\u0957\u0962\u0963\u0966-\u096f\u0981-\u0983\u09bc\u09be-\u09c4\u09c7\u09c8\u09cb-\u09cd\u09d7\u09e2\u09e3\u09e6-\u09ef\u0a01-\u0a03\u0a3c\u0a3e-\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a66-\u0a71\u0a75\u0a81-\u0a83\u0abc\u0abe-\u0ac5\u0ac7-\u0ac9\u0acb-\u0acd\u0ae2\u0ae3\u0ae6-\u0aef\u0b01-\u0b03\u0b3c\u0b3e-\u0b44\u0b47\u0b48\u0b4b-\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b66-\u0b6f\u0b82\u0bbe-\u0bc2\u0bc6-\u0bc8\u0bca-\u0bcd\u0bd7\u0be6-\u0bef\u0c01-\u0c03\u0c3e-\u0c44\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0c66-\u0c6f\u0c82\u0c83\u0cbc\u0cbe-\u0cc4\u0cc6-\u0cc8\u0cca-\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0ce6-\u0cef\u0d02\u0d03\u0d3e-\u0d44\u0d46-\u0d48\u0d4a-\u0d4d\u0d57\u0d62\u0d63\u0d66-\u0d6f\u0d82\u0d83\u0dca\u0dcf-\u0dd4\u0dd6\u0dd8-\u0ddf\u0df2\u0df3\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0e50-\u0e59\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0ed0-\u0ed9\u0f18\u0f19\u0f20-\u0f29\u0f35\u0f37\u0f39\u0f3e\u0f3f\u0f71-\u0f84\u0f86\u0f87\u0f8d-\u0f97\u0f99-\u0fbc\u0fc6\u102b-\u103e\u1040-\u1049\u1056-\u1059\u105e-\u1060\u1062-\u1064\u1067-\u106d\u1071-\u1074\u1082-\u108d\u108f-\u109d\u135d-\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b4-\u17d3\u17dd\u17e0-\u17e9\u180b-\u180d\u1810-\u1819\u18a9\u1920-\u192b\u1930-\u193b\u1946-\u194f\u19b0-\u19c0\u19c8\u19c9\u19d0-\u19d9\u1a17-\u1a1b\u1a55-\u1a5e\u1a60-\u1a7c\u1a7f-\u1a89\u1a90-\u1a99\u1b00-\u1b04\u1b34-\u1b44\u1b50-\u1b59\u1b6b-\u1b73\u1b80-\u1b82\u1ba1-\u1bad\u1bb0-\u1bb9\u1be6-\u1bf3\u1c24-\u1c37\u1c40-\u1c49\u1c50-\u1c59\u1cd0-\u1cd2\u1cd4-\u1ce8\u1ced\u1cf2-\u1cf4\u1dc0-\u1de6\u1dfc-\u1dff\u200c\u200d\u203f\u2040\u2054\u20d0-\u20dc\u20e1\u20e5-\u20f0\u2cef-\u2cf1\u2d7f\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua620-\ua629\ua66f\ua674-\ua67d\ua69f\ua6f0\ua6f1\ua802\ua806\ua80b\ua823-\ua827\ua880\ua881\ua8b4-\ua8c4\ua8d0-\ua8d9\ua8e0-\ua8f1\ua900-\ua909\ua926-\ua92d\ua947-\ua953\ua980-\ua983\ua9b3-\ua9c0\ua9d0-\ua9d9\uaa29-\uaa36\uaa43\uaa4c\uaa4d\uaa50-\uaa59\uaa7b\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uaaeb-\uaaef\uaaf5\uaaf6\uabe3-\uabea\uabec\uabed\uabf0-\uabf9\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\ufe33\ufe34\ufe4d-\ufe4f\uff10-\uff19\uff3f]*/gi);
  },
  evalInContext: function (js) {
    js = js.replace(/\s+/g, '');


    var keys = [], values = [];

    for (var i = 1; i < arguments.length; i++) {
      keys = keys.concat(Object.keys(arguments[i]));
      for (var j in arguments[i]) {
        values.push(arguments[i][j]);
      }
    }

    //
    //if(_.isCorrectVariableName(js) && keys.indexOf(js) === -1){
    //  keys.push(js);
    //  values.push(undefined);
    //}

    var arr = utils.extractVariables(js);
    //console.log(arr);
    for (var i in arr) {
      if (keys.indexOf(arr[i]) === -1) {
        keys.push(arr[i]);
        values.push(undefined);
      }
    }
    js = "var foo = function(" + keys.join(",") + "){ var __return__value = " + js + " ;return __return__value;}; foo;";
    try {
      var foo = eval(js);
      return foo.apply(this, values);
    } catch (e) {
      return undefined;
    }

  },
  compileElement: function ($item, scope) {

    function _eachSelf(el, selector, foo) {
      el.find(selector).each(foo);
      if (el.is(selector)) {
        foo.call(el[0]);
      }
    }

    //.addBack('selector')
    _eachSelf($item, "[onclick]", function () {
      var onClick = $(this).attr("onclick");
      $(this).removeAttr("onclick");
      $(this).click(function (event) {
        utils.evalInContext(onClick, scope, {event: event});
      })
    })


    _eachSelf($item, "[onchange]", function () {
      var onChange = $(this).attr("onchange");
      $(this).removeAttr("onchange");
      $(this).change(function (event) {
        utils.evalInContext(onChange, scope, {event: event});
      })
    });

    _eachSelf($item, "[dp-checked]", function () {
      var _val = $(this).attr("dp-checked");
      var val = utils.evalInContext(_val, scope);
      if (val) {
        $(this).attr("checked", "checked");
      } else {
        $(this).removeAttr("checked");
      }

    });
    _eachSelf($item, "[dp-src]", function () {
      var _val = $(this).attr("dp-src");
      var val = utils.evalInContext(_val, scope);
      if (val) {
        $(this).attr("src", val);
      }

    });
    _eachSelf($item, "[dp-if]", function () {
      var _val = $(this).attr("dp-if");
      if (_val === "false") {
        $(this).remove();
      }
      if (_val === "true") {

      } else {
        var val = utils.evalInContext(_val, scope);
        if (!val) {
          $(this).remove();
        }
      }
    });
    _eachSelf($item, "[dp-include]", function () {
      var _el = $(this);
      var _val = _el.attr("dp-include");
      var val = utils.evalInContext(_val, scope);
      _el.load(val);
    });
  },
  parseTemplate: function (tpl, scope) {
    var $item = $(tpl.format(scope));
    _.compileElement($item, scope);
    return $item;
  }
};
module.exports = utils;


/***/ }),
/* 6 */
/***/ (function(module, exports) {

module.exports = {
  resolve: function (path) {
    var chunks = path.split("/");
    var prev = 0;
    for (var i = chunks.length; i-- > 0;) {
      if (chunks[i] == "..") {
        prev++;
      } else {
        while (prev > 0) {
          chunks.splice(i, 1);
          chunks.splice(i--, 1);
          prev--;
        }
      }
    }
    return chunks.join("/");
  },
  getParentDirectoryUrl: function (url) {
    return url.substr(0, url.lastIndexOf("/") + 1);
  }
}


/***/ }),
/* 7 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

var Bezier = __webpack_require__(10);
__webpack_require__(52);

fabric.BezierMixin = {
  curveCornerSize: 4,
  curveCornerStyle: "rect",
  outlineTop: 0,
  outlineBottom: 0,


  _renderBezier: function (ctx,_outline ,x,y) {
    _outline = _outline || this.outline;
    ctx.beginPath();
    var _this = this;
    // ctx.save();
    // ctx.translate(this._transalate.x, this._transalate.y);
    var doc = function (c) {
      _this.drawCurve(ctx, c);
    };
    _outline.curves.forEach(doc);

    ctx.closePath();

    this._renderFill(ctx);
    this._renderStroke(ctx);
  },
  drawBezierControls: function (ctx, p1, p2, p3, p4) {
    var pts = this.points;
    ctx.save();
    ctx.globalAlpha = this.isMoving ? this.borderOpacityWhenMoving : 1;
    ctx.strokeStyle = ctx.fillStyle = this.cornerColor;
    ctx.scale(this.canvas.viewportTransform[0], this.canvas.viewportTransform[3]);
    ctx.translate(-this.width / 2 * this.scaleX, -this.height / 2 * this.scaleY);
    ctx.beginPath();
    ctx.moveTo(p1.x * this.scaleX, p1.y * this.scaleY);
    ctx.lineTo(p2.x * this.scaleX, p2.y * this.scaleY);
    if (pts.length === 3) {
      ctx.moveTo(p2.x * this.scaleX, p2.y * this.scaleY);
      ctx.lineTo(p3.x * this.scaleX, p3.y * this.scaleY);
    }
    else {
      ctx.moveTo(p3.x * this.scaleX, p3.y * this.scaleY);
      ctx.lineTo(p4.x * this.scaleX, p4.y * this.scaleY);
    }
    ctx.closePath();
    ctx.stroke();
    ctx.scale(this.scaleX, this.scaleY);
    ctx.beginPath();
    this.drawCurve(ctx, p1.curve);
    ctx.stroke();
    ctx.restore();
  },
  drawCurve: function (ctx, curve, offset) {
    offset = offset || {x: 0, y: 0};
    var ox = offset.x;
    var oy = offset.y;
    var p = curve.points, i;
    //ctx.moveTo(p[0].x + ox, p[0].y + oy);
    ctx.lineTo(p[0].x + ox, p[0].y + oy);
    if (p.length === 3) {
      ctx.quadraticCurveTo(
        p[1].x + ox, p[1].y + oy,
        p[2].x + ox, p[2].y + oy
      );
    }
    if (p.length === 4) {
      ctx.bezierCurveTo(
        p[1].x + ox, p[1].y + oy,
        p[2].x + ox, p[2].y + oy,
        p[3].x + ox, p[3].y + oy
      );
    }
  },
  drawLine: function (ctx, p1, p2, offset) {
    offset = offset || {x: 0, y: 0};
    var ox = offset.x;
    var oy = offset.y;
    ctx.beginPath();
    ctx.moveTo(p1.x + ox, p1.y + oy);
    ctx.lineTo(p2.x + ox, p2.y + oy);
    ctx.stroke();
  },
  drawPoint: function (ctx, p, offset) {
    offset = offset || {x: 0, y: 0};
    var ox = offset.x;
    var oy = offset.y;
    ctx.beginPath();
    ctx.arc(p.x + ox, p.y + oy, 5, 0, 2 * Math.PI);
    ctx.stroke();
  },
  drawPoints: function (ctx, points, offset) {
    offset = offset || {x: 0, y: 0};
    points.forEach(function (p) {
      this.drawCircle(ctx, p, 3, offset);
    }.bind(this));
  },
  drawArc: function (ctx, p, offset) {
    offset = offset || {x: 0, y: 0};
    var ox = offset.x;
    var oy = offset.y;
    ctx.beginPath();
    ctx.moveTo(p.x + ox, p.y + oy);
    ctx.arc(p.x + ox, p.y + oy, p.r, p.s, p.e);
    ctx.lineTo(p.x + ox, p.y + oy);
    ctx.fill();
    ctx.stroke();
  },
  drawCircle: function (ctx, p, r, offset) {
    offset = offset || {x: 0, y: 0};
    var ox = offset.x;
    var oy = offset.y;
    ctx.beginPath();
    ctx.arc(p.x + ox, p.y + oy, r, 0, 2 * Math.PI);
    ctx.stroke();
  },
  drawbbox: function (ctx, bbox, offset) {
    offset = offset || {x: 0, y: 0};
    var ox = offset.x;
    var oy = offset.y;
    ctx.beginPath();
    ctx.moveTo(bbox.x.min + ox, bbox.y.min + oy);
    ctx.lineTo(bbox.x.min + ox, bbox.y.max + oy);
    ctx.lineTo(bbox.x.max + ox, bbox.y.max + oy);
    ctx.lineTo(bbox.x.max + ox, bbox.y.min + oy);
    ctx.closePath();
    ctx.stroke();
  },
  drawHull: function (ctx, hull, offset) {
    ctx.beginPath();
    if (hull.length === 6) {
      ctx.moveTo(hull[0].x, hull[0].y);
      ctx.lineTo(hull[1].x, hull[1].y);
      ctx.lineTo(hull[2].x, hull[2].y);
      ctx.moveTo(hull[3].x, hull[3].y);
      ctx.lineTo(hull[4].x, hull[4].y);
    } else {
      ctx.moveTo(hull[0].x, hull[0].y);
      ctx.lineTo(hull[1].x, hull[1].y);
      ctx.lineTo(hull[2].x, hull[2].y);
      ctx.lineTo(hull[3].x, hull[3].y);
      ctx.moveTo(hull[4].x, hull[4].y);
      ctx.lineTo(hull[5].x, hull[5].y);
      ctx.lineTo(hull[6].x, hull[6].y);
      ctx.moveTo(hull[7].x, hull[7].y);
      ctx.lineTo(hull[8].x, hull[8].y);
    }
    ctx.stroke();
  },
  drawShape: function (ctx, shape, offset) {
    offset = offset || {x: 0, y: 0};
    var order = shape.forward.points.length - 1;
    ctx.beginPath();
    ctx.moveTo(offset.x + shape.startcap.points[0].x, offset.y + shape.startcap.points[0].y);
    ctx.lineTo(offset.x + shape.startcap.points[3].x, offset.y + shape.startcap.points[3].y);
    if (order === 3) {
      ctx.bezierCurveTo(
        offset.x + shape.forward.points[1].x, offset.y + shape.forward.points[1].y,
        offset.x + shape.forward.points[2].x, offset.y + shape.forward.points[2].y,
        offset.x + shape.forward.points[3].x, offset.y + shape.forward.points[3].y
      );
    } else {
      ctx.quadraticCurveTo(
        offset.x + shape.forward.points[1].x, offset.y + shape.forward.points[1].y,
        offset.x + shape.forward.points[2].x, offset.y + shape.forward.points[2].y
      );
    }
    ctx.lineTo(offset.x + shape.endcap.points[3].x, offset.y + shape.endcap.points[3].y);
    if (order === 3) {
      ctx.bezierCurveTo(
        offset.x + shape.back.points[1].x, offset.y + shape.back.points[1].y,
        offset.x + shape.back.points[2].x, offset.y + shape.back.points[2].y,
        offset.x + shape.back.points[3].x, offset.y + shape.back.points[3].y
      );
    } else {
      ctx.quadraticCurveTo(
        offset.x + shape.back.points[1].x, offset.y + shape.back.points[1].y,
        offset.x + shape.back.points[2].x, offset.y + shape.back.points[2].y
      );
    }
    ctx.closePath();
    ctx.fill();
    ctx.stroke();
  },
  // initBezier: function () {
  //   this.curve = new Bezier(0, 0, 0, 1, 1, 1, 0, 1);
  //   this.outline = this.curve.outline(this.bezierOutline[0], this.bezierOutline[1]);
  // },
  // bezierType: "quadraticByPoints",
  // defaultShape: "arc",//line
  setPoints: function (points) {

    if(points && points[0] !== undefined && points[0].x === undefined){
      var _NEW_points = [];
      for(var i=0; i < points.length ;i+=2){
        _NEW_points.push({x: points[i] , y: points[i + 1]});
      }
      points = _NEW_points;
    }


    // if(this.defaultShape == "curve"){
    //   points = [0, 0, this.width/2, -this.width/2, this.width/2, this.width/2, this.width, 0];
    // }else if(this.defaultShape == "arc"){
    //   points = [0, 0, this.width*0.16, -this.width*0.43, this.width *(1 - 0.16), -this.width*0.43, this.width, 0];
    // }else{
    //   points = [0, 0, this.width / 3, 1, this.width / 3 * 2, 1, this.width, 0];
    // }
    var _intervals = this.closed && points.length > 1 ? points.length : points.length - 1;
    this.points = [].concat(points);
    if(this.points.length > 1 && this.bezierControls){
      for(var i = 0 ; i < _intervals; i ++ ){
        var p2 = this.points[i + 1] || this.points[0];
        var p1 = this.points[i];
        var _cp = p1.c;
        if(_cp){
          if(p1.c2){
            this._makeCubic(p1, p1.c,p1.c2, p2);
          }else{
            this._makeCurve(p1, p1.c, p2);
          }
        }else{
          _cp = {
            x: (p1.x + p2.x)/2,
            y: (p1.y + p2.y)/2
          }
        }
      }
    }
  },
  // setPoint: function (order, _point) {
  //   var _points = this.points;
  //   _points[order].x = _point.x;
  //   _points[order].y = _point.y;
  //
  //   if(order == 0 ){
  //     var _p1 = _points[1], _p2 =  _points[0];
  //   }
  //   if(order == 1 ){
  //     var _p1 = _points[0], _p2 =  _points[1];
  //   }
  //   if(_points.length == 3){
  //     if(order == 2 ){
  //       var _p1 = _points[1], _p2 =  _points[2];
  //     }
  //   }else{
  //     if(order == 2 ){
  //       var _p1 = _points[3], _p2 =  _points[2];
  //     }
  //     if(order == 3 ){
  //       var _p1 = _points[2], _p2 =  _points[3];
  //     }
  //   }
  //   if (_p1.x - _p2.x < 1) {
  //     if(_p1.x <  _p2.x){
  //       _p2.x++;
  //     }else{
  //       _p2.x--;
  //     }
  //   }
  //   if (_p1.y - _p2.y < 1) {
  //     if(_p1.y <  _p2.y){
  //       _p2.y++;
  //     }else{
  //       _p2.y--;
  //     }
  //   }
  //   this.curve.update();
  //   this.outline = this.curve.outline(this.bezierOutline[0], this.bezierOutline[1]);
  //   this.updateBbox();
  //   this.canvas.renderAll();
  // }

  setExtraControls: function(controls){
    this.addPointsControls(controls);
  },

  addPointsControls: function(controls){

    var pts = this.points,
      _last = pts.length - 1;
    for(var i in pts){
      controls["p" + (+i + 1)] = {
        action: "shape",
        visible: true,
        x: pts[i].x,
        y: pts[i].y,
        area:  (this.extensionAreaEnabled && (i == 0 || i == _last))? this.cornerSize : this.cornerAreaSize,
        size : this.cornerSize,
        style: this.cornerStyle
      };

      if(this.bezierControls) {
        if (pts[i].c2) {

          controls[ "d" + (+i + 1)] ={
            action: "shape",
            visible: true,
            x: pts[i].c2.x,
            y: pts[i].c2.y,
            size: this.curveCornerSize + 2,
            area: this.cornerAreaSize,
            style: "rect"
          }

        }

        if (pts[i].c) {
          controls["c" + (+i + 1)] = {
            action: "shape",
            visible: true,
            x: pts[i].c.x,
            y: pts[i].c.y,
            size: this.curveCornerSize + 2,
            area: this.cornerAreaSize,
            style: "rect"
          }
        } else {
          var p2 = pts[+i + 1] || this.closed && pts[0];
          if(p2){
            controls["c" + (+i + 1)] = {
              action: "shape",
              visible: true,
              x: (pts[i].x + p2.x) / 2,
              y: (pts[i].y + p2.y) / 2,
              area: this.cornerAreaSize,
              size: this.curveCornerSize,
              style: "circle"
            }
          }
        }
      }
    }
  },
  drawBezierShapeControls: function(ctx){
    for(var i = 0 ; i < this.points.length ; i++){
      if(this.points[i].c2){
        this.drawBezierControls(ctx, this.points[i],this.points[i].c,this.points[i].c2,this.points[i + 1]);
      }
    }
  },
  bezierControls: false,
  _makeCurveByIndex: function (index) {
    this._makeCurve(this.points[index],this.points[index].c,this.points[index + 1] || this.points[0])
  },
  _makeCubic: function (p1, c1,c2,p2) {
    p1.curve = new Bezier(p1.x,p1.y , c1.x ,c1.y , c2.x,c2.y , p2.x,p2.y);
    if(this.outlineTop || this.outlineBottom){
      p1.outline = p1.curve.outline(this.outlineBottom, this.outlineTop);
    }
  },
  _makeCurve: function (_curPoint, c1,_p2) {
    _curPoint.c = {x: c1.x,y : c1.y};
    _curPoint.curve = Bezier.quadraticFromPoints.apply(this,[_curPoint,c1,_p2]);
    if(this.outlineTop || this.outlineBottom){
      _curPoint.outline = _curPoint.curve.outline(this.outlineTop, this.outlineBottom);
    }
  },
  _update_curve: function (_pointIndex) {
    var _p1 = this.points[_pointIndex ];
    if(!_p1.c){
      return;
    }
    var _p2 = this.points[_pointIndex + 1] || this.points[0];

    if(_p1.c2){
      _p1.curve.points[0].x = _p1.x;
      _p1.curve.points[0].y = _p1.y;
      _p1.curve.points[1].x = _p1.c.x;
      _p1.curve.points[1].y = _p1.c.y;
      _p1.curve.points[2].x = _p1.c2.x;
      _p1.curve.points[2].y = _p1.c2.y;
      _p1.curve.points[3].x = _p2.x;
      _p1.curve.points[3].y = _p2.y;
      _p1.curve.update();
      _p1.outline = _p1.curve.outline(this.outlineBottom, this.outlineTop);
    }else{
      var bezier_pointers = Bezier.getABC(2, _p1, _p1.c, _p2 , 0.5);
      _p1.curve.points[0].x = _p1.x;
      _p1.curve.points[0].y = _p1.y;
      _p1.curve.points[1].x = bezier_pointers.A.x;
      _p1.curve.points[1].y = bezier_pointers.A.y;
      _p1.curve.points[2].x = _p2.x;
      _p1.curve.points[2].y = _p2.y;
      _p1.curve.update();
      if(this.outlineTop || this.outlineBottom) {
        _p1.outline = _p1.curve.outline(this.outlineBottom, this.outlineTop);
      }
    }
  },
  setPoint: function (order, _point) {

    var dragPointer,
      _curvepointer = order[0] == "c",
      pIndex1 = +order.substr(1) - 1,
      p1 = this.points[pIndex1],
      pIndex2 = this.points[pIndex1 + 1] ? pIndex1 + 1 : (this.closed ? 0 : -1),
      p2 = pIndex2 !== -1 && this.points[pIndex2],
      pIndex0 = this.points[pIndex1 - 1] ? pIndex1 - 1 : (this.closed ? this.points.length - 1 : -1),
      p0 = pIndex0 !== -1 && this.points[pIndex0];

    if (this.pointsLimits) {
      _point.x = Math.max(0, Math.min(_point.x, this.width));
      _point.y = Math.max(0, Math.min(_point.y, this.height));
    }
    var _curvepointer2 = order[0] == "d";
    if(_curvepointer2){
      dragPointer =  p1.c2;
    }else{
      if(_curvepointer){

        if(!p1.c){
          this._makeCurve(p1, _point, p2);
        }
        dragPointer = p1.c
      }else{
        dragPointer = p1;
      }
    }
    if(dragPointer){
      dragPointer.x = _point.x;
      dragPointer.y = _point.y;
    }
    for(var i in this.points){
      this.points[i].c && this._update_curve(+i);
    }
    this.updateBbox();
    this.fire("shape:modified");
    this.canvas && this.canvas.renderAll();
  }
};

fabric.util.object.defaults(fabric.BezierMixin,  fabric.ShapeMixin);

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 8 */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(fabric) {
fabric.CacheMixin = {
  caching: true,
  dirty: true,
  render: function ( ctx) {

    ctx.save();
    if (this.transformMatrix) {
      ctx.transform.apply(ctx, this.transformMatrix);
    }
    this.transform(ctx);

    this._setShadow(ctx);
    this.clipTo && fabric.util.clipContext(this, ctx);

    ctx.translate(-this.width / 2, -this.height / 2);

    if (this.caching) {
      if(!this._cache){
        this._cache = fabric.util.createCanvasElementWithSize(this);
      }
      if(this.dirty){
        this._cache.width = this.width;
        this._cache.height = this.height;
        var cacheCtx = this._cache.getContext("2d");
        cacheCtx.clearRect(0,0,this._cache.width,this._cache.height)
        this._render(cacheCtx);
        this.dirty = false;
      }

      ctx.drawImage(this._cache, 0, 0, this.width, this.height,0, 0, this.width, this.height);
    }else{
      this._render(ctx);
    }

    this.clipTo && ctx.restore();
    ctx.restore();
  }

};

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 9 */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(fabric) {fabric.StrokeMixin = {
  shape: {
    strokeWidthFull: 0,
    strokeWidthEmpty: 2,
    strokeWidthActive: 2,
    strokeDashArray : [5,5],
    fill: "transparent",
    strokeEmpty:  "red",
    strokeFull:   "red",
    strokeActive: "green"
  },
  setShape: function(el,cb){

    el =  fabric.util.object.extend({
      strokeWidthFull: this.shape.strokeWidthFull,
      strokeWidthEmpty: this.shape.strokeWidthEmpty,
      strokeWidthActive: this.shape.strokeWidthActive,
      dashArray : this.shape.dashArray,
      strokeEmpty:  this.shape.strokeEmpty,
      strokeFull:  this.shape.strokeFull,
      strokeActive:this.shape.strokeActive
    },el);


    var _this = this;
    if(el && el.src && !el.paths){
      fabric.loadSVGFromURL(el.src,function(paths,options) {
        el.paths  = paths;
        fabric.util.object.extend(el,options);
        _this._set_shape(el);
        _this.add(_this._fabric_shape)
        _this._apply_shape();
        cb && cb();
      })
    }else{
      _this._set_shape(el);
      _this.add(_this._fabric_shape);
      _this._apply_shape();
      cb && cb();
    }
  },
  initShape: function(options){

    var _shapeOptions = fabric.util.object.extend(options.shape || {} , this.shape);

    this._fabric_shape =  new fabric.Rect(fabric.util.object.extend({},_shapeOptions,{
      width:            options.width,
      height:           options.height,
      stroke:           _shapeOptions.strokeEmpty,
      strokeWidth:      _shapeOptions.strokeWidthEmpty
    }));
  },

  /**
   * �������������� ����� �� ������� ������� ����
   * @private
   */
  _apply_shape: function () {
    var shape = this.shape;

    var _off = shape && shape.offsets;

    if (!_off) {
      _off = [0, 0, 0, 0];
    }

    var _off_units = shape && shape.offsets_units;

    if (!_off_units) {
      //if (frame.border_image) {todo
      //    _off_units = frame.border_image.width_units || [0, 0, 0, 0];
      //} else {
      _off_units = [1, 1, 1, 1];
      //}
    }

    /*else if(shape.offsets && shape.offsets_units){
     var s = this.slide.scaleValue;
     this._fabric_shape = new fabric.Rect({
     originX: 'center',
     originY: 'center',
     width:  (this.data.geometry.width - shape.offsets[3] - shape.offsets[1]) * s,
     height: (this.data.geometry.height -shape.offsets[0] - shape.offsets[2]) * s
     });*/

    _off = {
      top:   _off[0] * (_off_units[0] ? this.height / 100 : 1) || 0,
      right: _off[1] * (_off_units[1] ? this.width / 100 : 1) || 0,
      bottom:_off[2] * (_off_units[2] ? this.height / 100 : 1) || 0,
      left:  _off[3] * (_off_units[3] ? this.width / 100 : 1) || 0
    };


    var _w = (this.width - _off.left - _off.right );// *this.slide.scaleValue;
    var _h = (this.height - _off.top - _off.bottom);// *this.slide.scaleValue;


    //if(this.resources.frame.data.shape && this.resources.frame.data.shape.radius){
    //
    //    this._fabric_shape.set({
    //        left: -this.width/2  + _off.left ,
    //        top:  -this.height/2 + _off.top ,
    //        width: _w - _off.left -_off.right,
    //        height:  _h - _off.top -_off.bottom,
    //        scaleX:  1,
    //        scaleY:  1
    //    });
    //}else{


    if(this.shape.path || this.shape.paths || this.shape.offsets){
      var _sw = this.shape.width || this._fabric_shape.width;
      var _sh = this.shape.height || this._fabric_shape.height;

      if(this._fabric_shape.strokeWidth){
        _sw += this._fabric_shape.strokeWidth ;
        _sh += this._fabric_shape.strokeWidth ;
      }

      var options = {
        left:   -this.width / 2 + _off.left,
        top:    -this.height / 2 + _off.top,
        scaleX: _w / 100 / (_sw / 100),// * (shape.scaleX || 1),
        scaleY: _h / 100 / (_sh / 100),// * (shape.scaleY || 1)
        angle: 0
      };
    }else{
      var options = {
        left:   -this.width / 2 + _off.left,
        top:    -this.height / 2 + _off.top,
        width:    _w,// * (shape.scaleX || 1),
        height:   _h,// * (shape.scaleY || 1)
        angle: 0
      };
    }

    this._fabric_shape.set(options);

    this.updateStroke();
    this.canvas && this.canvas.renderAll();
  },
  _set_shape: function (shape) {

    if(this._fabric_shape){
      this.remove(this._fabric_shape);
      delete this._fabric_shape;
    }
    var _fabric_shape;
    var _options = {
      fill:             "transparent",
      strokeDashArray : this.shape.dashArray,
    };

    this.shape = shape;

    if(!shape){
      _fabric_shape = new fabric.Rect({
        width: this.width,
        height: this.height
      });
      _fabric_shape.set(_options)
    }else if (shape.paths) {

      for(var i in shape.paths){
        shape.paths[i].set(_options)
      }

      _fabric_shape = fabric.util.groupSVGElements(shape.paths, shape);
      //this._objects.unshift(this._objects.pop());
    }else {
      var path;

      if (shape.radius) {
        path = fabric.util.getRadiusClipPath(shape.radius, shape.radius_units, this.width, this.height);
        _fabric_shape = new fabric.Path(path, _options);
      } else if (shape.path) {
        _fabric_shape = new fabric.Path(shape.path, _options);
        //} else if(shape.offsets){
        //  path = fabric.util.getOffsetsClipPath(shape.offsets, shape.offsets_units)
      }else{
        path =  'M 0 0 L {width} 0 L {width} {height} L 0 {height} z'.format(fabric.util.object.extend({
          width:            100,
          height:           100
        },shape));

        _fabric_shape = new fabric.Path(path, _options);
        //
        //_fabric_shape =  new fabric.Rect(fabric.util.object.extend({
        //  width:            100,
        //  height:           100
        //},shape));

      }
    }


    _fabric_shape.set({
      scaleX: this.width  / _fabric_shape.width,
      scaleY: this.height / _fabric_shape.height,
      perPixelTargetFind: true,
      selectable: false,
      originX: "left",
      originY: "top"
    });



    this._fabric_shape =  _fabric_shape;


    if(this.element){
      this.element.clipTo = this._fabric_shape;
    }


    this.updateStroke();

  },

  updateStroke: function(){

    var _stroke = this.shape.stroke;
    var _sw = 0;
    if((this._activated || this._clipmode )&& this.shape.strokeWidthActive){
      _sw = this.shape.strokeWidthActive
    }else if(this.element && this.shape.strokeWidthFull){
      _sw = this.shape.strokeWidthFull;
    }else if(!this.element && this.shape.strokeWidthEmpty){
      _sw = this.shape.strokeWidthEmpty;
    }
    if((this._activated || this._clipmode) && this.shape.strokeActive){
      _stroke = this.shape.strokeActive
    }else if(this.element && this.shape.strokeFull){
      _stroke = this.shape.strokeFull;
    }else if(!this.element && this.shape.strokeEmpty){
      _stroke = this.shape.strokeEmpty;
    }


    var _strokeWidth = _sw / Math.max(this._fabric_shape.scaleX,this._fabric_shape.scaleY);

    if(this.shape){
      if(this.shape.paths ){
        for(var i in this._fabric_shape.paths){
          this._fabric_shape.paths[i].setStrokeWidth(_strokeWidth)
          this._fabric_shape.paths[i].setStroke(_stroke)
        }
      }else{
        this._fabric_shape.setStrokeWidth(_strokeWidth)
        this._fabric_shape.setStroke(_stroke)
      }
    }
  },
  /**
   * кобъект готовится к замену фото
   */
  activate: function(){
    this._activated = true;
    this._fabric_shape.setOpacity(1);
    this.updateStroke();
    this.canvas.renderAll();
  },
  /**
   * кобъект не готовится к замену фото
   */
  deactivate: function(){
    this._activated = false;
    this.updateStroke();
    this.canvas.renderAll();
  },
}

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 10 */
/***/ (function(module, exports, __webpack_require__) {

/**
  A javascript Bezier curve library by Pomax.

  Based on http://pomax.github.io/bezierinfo

  This code is MIT licensed.
**/
var Bezier = (function() {
  "use strict";

  // math-inlining.
  var abs = Math.abs,
      min = Math.min,
      max = Math.max,
      acos = Math.acos,
      sqrt = Math.sqrt,
      pi = Math.PI,
      // a zero coordinate, which is surprisingly useful
      ZERO = {x:0,y:0,z:0};




      // math-inlining.
      var abs = Math.abs,
        cos = Math.cos,
        sin = Math.sin,
        acos = Math.acos,
        atan2 = Math.atan2,
        sqrt = Math.sqrt,
        pow = Math.pow,
      // cube root function yielding real roots
        crt = function(v) { return (v<0) ? -pow(-v,1/3) : pow(v,1/3); },
      // trig constants
        pi = Math.PI,
        tau = 2*pi,
        quart = pi/2,
      // float precision significant decimal
        epsilon = 0.000001;

      // Bezier utility functions
      var utils = {
        // Legendre-Gauss abscissae with n=24 (x_i values, defined at i=n as the roots of the nth order Legendre polynomial Pn(x))
        Tvalues: [
          -0.0640568928626056260850430826247450385909,
           0.0640568928626056260850430826247450385909,
          -0.1911188674736163091586398207570696318404,
           0.1911188674736163091586398207570696318404,
          -0.3150426796961633743867932913198102407864,
           0.3150426796961633743867932913198102407864,
          -0.4337935076260451384870842319133497124524,
           0.4337935076260451384870842319133497124524,
          -0.5454214713888395356583756172183723700107,
           0.5454214713888395356583756172183723700107,
          -0.6480936519369755692524957869107476266696,
           0.6480936519369755692524957869107476266696,
          -0.7401241915785543642438281030999784255232,
           0.7401241915785543642438281030999784255232,
          -0.8200019859739029219539498726697452080761,
           0.8200019859739029219539498726697452080761,
          -0.8864155270044010342131543419821967550873,
           0.8864155270044010342131543419821967550873,
          -0.9382745520027327585236490017087214496548,
           0.9382745520027327585236490017087214496548,
          -0.9747285559713094981983919930081690617411,
           0.9747285559713094981983919930081690617411,
          -0.9951872199970213601799974097007368118745,
           0.9951872199970213601799974097007368118745
        ],
        // Legendre-Gauss weights with n=24 (w_i values, defined by a function linked to in the Bezier primer article)
        Cvalues: [
          0.1279381953467521569740561652246953718517,
          0.1279381953467521569740561652246953718517,
          0.1258374563468282961213753825111836887264,
          0.1258374563468282961213753825111836887264,
          0.1216704729278033912044631534762624256070,
          0.1216704729278033912044631534762624256070,
          0.1155056680537256013533444839067835598622,
          0.1155056680537256013533444839067835598622,
          0.1074442701159656347825773424466062227946,
          0.1074442701159656347825773424466062227946,
          0.0976186521041138882698806644642471544279,
          0.0976186521041138882698806644642471544279,
          0.0861901615319532759171852029837426671850,
          0.0861901615319532759171852029837426671850,
          0.0733464814110803057340336152531165181193,
          0.0733464814110803057340336152531165181193,
          0.0592985849154367807463677585001085845412,
          0.0592985849154367807463677585001085845412,
          0.0442774388174198061686027482113382288593,
          0.0442774388174198061686027482113382288593,
          0.0285313886289336631813078159518782864491,
          0.0285313886289336631813078159518782864491,
          0.0123412297999871995468056670700372915759,
          0.0123412297999871995468056670700372915759
        ],
        arcfn: function(t, derivativeFn) {
          var d = derivativeFn(t);
          var l = d.x*d.x + d.y*d.y;
          if(typeof d.z !== "undefined") {
            l += d.z*d.z;
          }
          return sqrt(l);
        },

        between: function(v, m, M) {
          return (m <= v && v <= M) || utils.approximately(v, m) || utils.approximately(v, M);
        },

        approximately: function(a,b,precision) {
          return abs(a-b) <= (precision || epsilon);
        },
        length: function(derivativeFn) {
          var z=0.5,sum=0,len=utils.Tvalues.length,i,t;
          for(i=0; i<len; i++) {
            t = z * utils.Tvalues[i] + z;
            sum += utils.Cvalues[i] * utils.arcfn(t,derivativeFn);
          }
          return z * sum;
        },

        map: function(v, ds,de, ts,te) {
          var d1 = de-ds, d2 = te-ts, v2 =  v-ds, r = v2/d1;
          return ts + d2*r;
        },

        lerp: function(r, v1, v2) {
          var ret = {
            x: v1.x + r*(v2.x-v1.x),
            y: v1.y + r*(v2.y-v1.y)
          };
          if(!!v1.z && !!v2.z) {
            ret.z =  v1.z + r*(v2.z-v1.z);
          }
          return ret;
        },

        pointToString: function(p) {
          var s = p.x+"/"+p.y;
          if(typeof p.z !== "undefined") {
            s += "/"+p.z;
          }
          return s;
        },

        pointsToString: function(points) {
          return "[" + points.map(utils.pointToString).join(", ") + "]";
        },

        copy: function(obj) {
          return JSON.parse(JSON.stringify(obj));
        },

        angle: function(o,v1,v2) {
          var dx1 = v1.x - o.x,
            dy1 = v1.y - o.y,
            dx2 = v2.x - o.x,
            dy2 = v2.y - o.y,
            cross = dx1*dy2 - dy1*dx2,
            m1 = sqrt(dx1*dx1+dy1*dy1),
            m2 = sqrt(dx2*dx2+dy2*dy2),
            dot;
          dx1/=m1; dy1/=m1; dx2/=m2; dy2/=m2;
          dot = dx1*dx2 + dy1*dy2;
          return atan2(cross, dot);
        },

        // round as string, to avoid rounding errors
        round: function(v, d) {
          var s = '' + v;
          var pos = s.indexOf(".");
          return parseFloat(s.substring(0,pos+1+d));
        },

        dist: function(p1, p2) {
          var dx = p1.x - p2.x,
            dy = p1.y - p2.y;
          return sqrt(dx*dx+dy*dy);
        },

        closest: function(LUT, point) {
          var mdist = pow(2,63), mpos, d;
          LUT.forEach(function(p, idx) {
            d = utils.dist(point, p);
            if (d<mdist) {
              mdist = d;
              mpos = idx;
            }
          });
          return { mdist:mdist, mpos:mpos };
        },

        abcratio: function(t, n) {
          // see ratio(t) note on http://pomax.github.io/bezierinfo/#abc
          if (n!==2 && n!==3) {
            return false;
          }
          if (typeof t === "undefined") {
            t = 0.5;
          } else if (t===0 || t===1) {
            return t;
          }
          var bottom = pow(t,n) + pow(1-t,n), top = bottom - 1;
          return abs(top/bottom);
        },

        projectionratio: function(t, n) {
          // see u(t) note on http://pomax.github.io/bezierinfo/#abc
          if (n!==2 && n!==3) {
            return false;
          }
          if (typeof t === "undefined") {
            t = 0.5;
          } else if (t===0 || t===1) {
            return t;
          }
          var top = pow(1-t, n), bottom = pow(t,n) + top;
          return top/bottom;
        },

        lli8: function(x1,y1,x2,y2,x3,y3,x4,y4) {
          var nx=(x1*y2-y1*x2)*(x3-x4)-(x1-x2)*(x3*y4-y3*x4),
            ny=(x1*y2-y1*x2)*(y3-y4)-(y1-y2)*(x3*y4-y3*x4),
            d=(x1-x2)*(y3-y4)-(y1-y2)*(x3-x4);
          if(d==0) { return false; }
          return { x: nx/d, y: ny/d };
        },

        lli4: function(p1,p2,p3,p4) {
          var x1 = p1.x, y1 = p1.y,
            x2 = p2.x, y2 = p2.y,
            x3 = p3.x, y3 = p3.y,
            x4 = p4.x, y4 = p4.y;
          return utils.lli8(x1,y1,x2,y2,x3,y3,x4,y4);
        },

        lli: function(v1, v2) {
          return utils.lli4(v1,v1.c,v2,v2.c);
        },

        makeline: function(p1,p2) {
          var x1 = p1.x, y1 = p1.y, x2 = p2.x, y2 = p2.y, dx = (x2-x1)/3, dy = (y2-y1)/3;
          return new Bezier(x1, y1, x1+dx, y1+dy, x1+2*dx, y1+2*dy, x2, y2);
        },

        findbbox: function(sections) {
          var mx=99999999,my=mx,MX=-mx,MY=MX;
          sections.forEach(function(s) {
            var bbox = s.bbox();
            if(mx > bbox.x.min) mx = bbox.x.min;
            if(my > bbox.y.min) my = bbox.y.min;
            if(MX < bbox.x.max) MX = bbox.x.max;
            if(MY < bbox.y.max) MY = bbox.y.max;
          });
          return {
            x: { min: mx, mid:(mx+MX)/2, max: MX, size:MX-mx },
            y: { min: my, mid:(my+MY)/2, max: MY, size:MY-my }
          }
        },

        shapeintersections: function(s1, bbox1, s2, bbox2) {
          if(!utils.bboxoverlap(bbox1, bbox2)) return [];
          var intersections = [];
          var a1 = [s1.startcap, s1.forward, s1.back, s1.endcap];
          var a2 = [s2.startcap, s2.forward, s2.back, s2.endcap];
          a1.forEach(function(l1) {
            if(l1.virtual) return;
            a2.forEach(function(l2) {
              if(l2.virtual) return;
              var iss = l1.intersects(l2);
              if(iss.length>0) {
                iss.c1 = l1;
                iss.c2 = l2;
                iss.s1 = s1;
                iss.s2 = s2;
                intersections.push(iss);
              }
            });
          });
          return intersections;
        },

        makeshape: function(forward, back) {
          var bpl = back.points.length;
          var fpl = forward.points.length;
          var start  = utils.makeline(back.points[bpl-1], forward.points[0]);
          var end    = utils.makeline(forward.points[fpl-1], back.points[0]);
          var shape  = {
            startcap: start,
            forward: forward,
            back: back,
            endcap: end,
            bbox: utils.findbbox([start, forward, back, end])
          };
          var self = utils;
          shape.intersections = function(s2) {
            return self.shapeintersections(shape,shape.bbox,s2,s2.bbox);
          };
          return shape;
        },

        getminmax: function(curve, d, list) {
          if(!list) return { min:0, max:0 };
          var min=0xFFFFFFFFFFFFFFFF, max=-min,t,c;
          if(list.indexOf(0)===-1) { list = [0].concat(list); }
          if(list.indexOf(1)===-1) { list.push(1); }
          for(var i=0,len=list.length; i<len; i++) {
            t = list[i];
            c = curve.get(t);
            if(c[d] < min) { min = c[d]; }
            if(c[d] > max) { max = c[d]; }
          }
          return { min:min, mid:(min+max)/2, max:max, size:max-min };
        },

        align: function(points, line) {
          var tx = line.p1.x,
            ty = line.p1.y,
            a = -atan2(line.p2.y-ty, line.p2.x-tx),
            d = function(v) {
              return {
                x: (v.x-tx)*cos(a) - (v.y-ty)*sin(a),
                y: (v.x-tx)*sin(a) + (v.y-ty)*cos(a)
              };
            };
          return points.map(d);
        },

        roots: function(points, line) {
          line = line || {p1:{x:0,y:0},p2:{x:1,y:0}};
          var order = points.length - 1;
          var p = utils.align(points, line);
          var reduce = function(t) { return 0<=t && t <=1; };

          if (order === 2) {
            var a = p[0].y,
              b = p[1].y,
              c = p[2].y,
              d = a - 2*b + c;
            if(d!==0) {
              var m1 = -sqrt(b*b-a*c),
                m2 = -a+b,
                v1 = -( m1+m2)/d,
                v2 = -(-m1+m2)/d;
              return [v1, v2].filter(reduce);
            }
            else if(b!==c && d===0) {
              return [ (2*b-c)/2*(b-c) ].filter(reduce);
            }
            return [];
          }

          // see http://www.trans4mind.com/personal_development/mathematics/polynomials/cubicAlgebra.htm
          var pa = p[0].y,
            pb = p[1].y,
            pc = p[2].y,
            pd = p[3].y,
            d = (-pa + 3*pb - 3*pc + pd),
            a = (3*pa - 6*pb + 3*pc) / d,
            b = (-3*pa + 3*pb) / d,
            c = pa / d,
            p = (3*b - a*a)/3,
            p3 = p/3,
            q = (2*a*a*a - 9*a*b + 27*c)/27,
            q2 = q/2,
            discriminant = q2*q2 + p3*p3*p3,
            u1,v1,x1,x2,x3;
          if (discriminant < 0) {
            var mp3 = -p/3,
              mp33 = mp3*mp3*mp3,
              r = sqrt( mp33 ),
              t = -q/(2*r),
              cosphi = t<-1 ? -1 : t>1 ? 1 : t,
              phi = acos(cosphi),
              crtr = crt(r),
              t1 = 2*crtr;
            x1 = t1 * cos(phi/3) - a/3;
            x2 = t1 * cos((phi+tau)/3) - a/3;
            x3 = t1 * cos((phi+2*tau)/3) - a/3;
            return [x1, x2, x3].filter(reduce);
          } else if(discriminant === 0) {
            u1 = q2 < 0 ? crt(-q2) : -crt(q2);
            x1 = 2*u1-a/3;
            x2 = -u1 - a/3;
            return [x1,x2].filter(reduce);
          } else {
            var sd = sqrt(discriminant);
            u1 = crt(-q2+sd);
            v1 = crt(q2+sd);
            return [u1-v1-a/3].filter(reduce);;
          }
        },

        droots: function(p) {
          // quadratic roots are easy
          if(p.length === 3) {
            var a = p[0],
              b = p[1],
              c = p[2],
              d = a - 2*b + c;
            if(d!==0) {
              var m1 = -sqrt(b*b-a*c),
                m2 = -a+b,
                v1 = -( m1+m2)/d,
                v2 = -(-m1+m2)/d;
              return [v1, v2];
            }
            else if(b!==c && d===0) {
              return [ (2*b-c)/(2*(b-c)) ];
            }
            return [];
          }

          // linear roots are even easier
          if(p.length === 2) {
            var a = p[0], b = p[1];
            if(a!==b) { return [a/(a-b)]; }
            return [];
          }
        },

        inflections: function(points) {
          var p = utils.align(points, { p1: points[0], p2: points[3] }),
            a = p[2].x * p[1].y,
            b = p[3].x * p[1].y,
            c = p[1].x * p[2].y,
            d = p[3].x * p[2].y,
            v1 = 18 * (-3*a + 2*b + 3*c - d),
            v2 = 18 * (3*a - b - 3*c),
            v3 = 18 * (c - a);

          if (utils.approximately(v1,0)) return [];

          var trm = v2*v2 - 4*v1*v3,
            sq = Math.sqrt(trm),
            d = 2 * v1;

          if (utils.approximately(d,0)) return [];

          return [(sq-v2)/d, -(v2+sq)/d].filter(function(r) {
            return (0 <= r && r <= 1);
          });
        },

        bboxoverlap: function(b1,b2) {
          var dims=['x','y'],len=dims.length,i,dim,l,t,d
          for(i=0; i<len; i++) {
            dim = dims[i];
            l = b1[dim].mid;
            t = b2[dim].mid;
            d = (b1[dim].size + b2[dim].size)/2;
            if(abs(l-t) >= d) return false;
          }
          return true;
        },

        expandbox: function(bbox, _bbox) {
          if(_bbox.x.min < bbox.x.min) { bbox.x.min = _bbox.x.min; }
          if(_bbox.y.min < bbox.y.min) { bbox.y.min = _bbox.y.min; }
          if(_bbox.z && _bbox.z.min < bbox.z.min) { bbox.z.min = _bbox.z.min; }
          if(_bbox.x.max > bbox.x.max) { bbox.x.max = _bbox.x.max; }
          if(_bbox.y.max > bbox.y.max) { bbox.y.max = _bbox.y.max; }
          if(_bbox.z && _bbox.z.max > bbox.z.max) { bbox.z.max = _bbox.z.max; }
          bbox.x.mid = (bbox.x.min + bbox.x.max)/2;
          bbox.y.mid = (bbox.y.min + bbox.y.max)/2;
          if(bbox.z) { bbox.z.mid = (bbox.z.min + bbox.z.max)/2; }
          bbox.x.size = bbox.x.max - bbox.x.min;
          bbox.y.size = bbox.y.max - bbox.y.min;
          if(bbox.z) { bbox.z.size = bbox.z.max - bbox.z.min; }
        },

        pairiteration: function(c1,c2) {
          var c1b = c1.bbox(),
            c2b = c2.bbox(),
            r = 100000,
            threshold = 0.5;
          if(c1b.x.size + c1b.y.size < threshold && c2b.x.size + c2b.y.size < threshold) {
            return [ ((r * (c1._t1+c1._t2)/2)|0)/r + "/" + ((r * (c2._t1+c2._t2)/2)|0)/r ];
          }
          var cc1 = c1.split(0.5),
            cc2 = c2.split(0.5),
            pairs = [
              {left: cc1.left, right: cc2.left },
              {left: cc1.left, right: cc2.right },
              {left: cc1.right, right: cc2.right },
              {left: cc1.right, right: cc2.left }];
          pairs = pairs.filter(function(pair) {
            return utils.bboxoverlap(pair.left.bbox(),pair.right.bbox());
          });
          var results = [];
          if(pairs.length === 0) return results;
          pairs.forEach(function(pair) {
            results = results.concat(
              utils.pairiteration(pair.left, pair.right)
            );
          })
          results = results.filter(function(v,i) {
            return results.indexOf(v) === i;
          });
          return results;
        },

        getccenter: function(p1,p2,p3) {
          var dx1 = (p2.x - p1.x),
            dy1 = (p2.y - p1.y),
            dx2 = (p3.x - p2.x),
            dy2 = (p3.y - p2.y);
          var dx1p = dx1 * cos(quart) - dy1 * sin(quart),
            dy1p = dx1 * sin(quart) + dy1 * cos(quart),
            dx2p = dx2 * cos(quart) - dy2 * sin(quart),
            dy2p = dx2 * sin(quart) + dy2 * cos(quart);
          // chord midpoints
          var mx1 = (p1.x + p2.x)/2,
            my1 = (p1.y + p2.y)/2,
            mx2 = (p2.x + p3.x)/2,
            my2 = (p2.y + p3.y)/2;
          // midpoint offsets
          var mx1n = mx1 + dx1p,
            my1n = my1 + dy1p,
            mx2n = mx2 + dx2p,
            my2n = my2 + dy2p;
          // intersection of these lines:
          var arc = utils.lli8(mx1,my1,mx1n,my1n, mx2,my2,mx2n,my2n),
            r = utils.dist(arc,p1),
          // arc start/end values, over mid point:
            s = atan2(p1.y - arc.y, p1.x - arc.x),
            m = atan2(p2.y - arc.y, p2.x - arc.x),
            e = atan2(p3.y - arc.y, p3.x - arc.x),
            _;
          // determine arc direction (cw/ccw correction)
          if (s<e) {
            // if s<m<e, arc(s, e)
            // if m<s<e, arc(e, s + tau)
            // if s<e<m, arc(e, s + tau)
            if (s>m || m>e) { s += tau; }
            if (s>e) { _=e; e=s; s=_; }
          } else {
            // if e<m<s, arc(e, s)
            // if m<e<s, arc(s, e + tau)
            // if e<s<m, arc(s, e + tau)
            if (e<m && m<s) { _=e; e=s; s=_; } else { e += tau; }
          }
          // assign and done.
          arc.s = s;
          arc.e = e;
          arc.r = r;
          return arc;
        }
      };



    /**
     * Poly Bezier
     * @param {[type]} curves [description]
     */
    var PolyBezier = function(curves) {
      this.curves = [];
      this._3d = false;
      if(!!curves) {
        this.curves = curves;
        this._3d = this.curves[0]._3d;
      }
    }

    PolyBezier.prototype = {
      valueOf: function() {
        return this.toString();
      },
      toString: function() {
        return utils.pointsToString(this.points);
      },
      addCurve: function(curve) {
        this.curves.push(curve);
        this._3d = this._3d || curve._3d;
      },
      length: function() {
        return this.curves.map(function(v) { return v.length(); }).reduce(function(a,b) { return a+b; });
      },
      curve: function(idx) {
        return this.curves[idx];
      },
      bbox: function() {
        var c = this.curves;
        var bbox = c[0].bbox();
        for(var i=1; i<c.length; i++) {
          utils.expandbox(bbox, c[i].bbox());
        }
        return bbox;
      },
      offset: function(d) {
        var offset = [];
        this.curves.forEach(function(v) {
          offset = offset.concat(v.offset(d));
        });
        return new PolyBezier(offset);
      }
    };




  /**
   * Bezier curve constructor. The constructor argument can be one of three things:
   *
   * 1. array/4 of {x:..., y:..., z:...}, z optional
   * 2. numerical array/8 ordered x1,y1,x2,y2,x3,y3,x4,y4
   * 3. numerical array/12 ordered x1,y1,z1,x2,y2,z2,x3,y3,z3,x4,y4,z4
   *
   */
  var Bezier = function(coords) {
    var args = (coords && coords.forEach) ? coords : [].slice.call(arguments);
    var coordlen = false;
    if(typeof args[0] === "object") {
      coordlen = args.length;
      var newargs = [];
      args.forEach(function(point) {
        ['x','y','z'].forEach(function(d) {
          if(typeof point[d] !== "undefined") {
            newargs.push(point[d]);
          }
        });
      });
      args = newargs;
    }
    var higher = false;
    var len = args.length;
    if (coordlen) {
      if(coordlen>4) {
        if (arguments.length !== 1) {
          throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");
        }
        higher = true;
      }
    } else {
      if(len!==6 && len!==8 && len!==9 && len!==12) {
        if (arguments.length !== 1) {
          throw new Error("Only new Bezier(point[]) is accepted for 4th and higher order curves");
        }
      }
    }
    var _3d = (!higher && (len === 9 || len === 12)) || (coords && coords[0] && typeof coords[0].z !== "undefined");
    this._3d = _3d;
    var points = [];
    for(var idx=0, step=(_3d ? 3 : 2); idx<len; idx+=step) {
      var point = {
        x: args[idx],
        y: args[idx+1]
      };
      if(_3d) { point.z = args[idx+2] };
      points.push(point);
    }
    this.order = points.length - 1;
    this.points = points;
    var dims = ['x','y'];
    if(_3d) dims.push('z');
    this.dims = dims;
    this.dimlen = dims.length;
    (function(curve) {
      var a = utils.align(points, {p1:points[0], p2:points[curve.order]});
      for(var i=0; i<a.length; i++) {
        if(abs(a[i].y) > 0.0001) {
          curve._linear = false;
          return;
        }
      }
      curve._linear = true;
    }(this));
    this._t1 = 0;
    this._t2 = 1;
    this.update();
  };

  Bezier.fromSVG = function(svgString) {
    var list = svgString.match(/[-+]?\d*\.?\d+(?:[eE][-+]?\d+)?/g).map(parseFloat);
    var relative = /[cq]/.test(svgString);
    if(!relative) return new Bezier(list);
    list = list.map(function(v,i) {
      return i < 2 ? v : v + list[i % 2];
    });
    return new Bezier(list);
  };

  Bezier.getABC = function (n,S,B,E,t) {
    if(typeof t === "undefined") { t = 0.5; }
    var u = utils.projectionratio(t,n),
        um = 1-u,
        C = {
          x: u*S.x + um*E.x,
          y: u*S.y + um*E.y
        },
        s = utils.abcratio(t,n),
        A = {
          x: B.x + (B.x-C.x)/s,
          y: B.y + (B.y-C.y)/s
        };
    return { A:A, B:B, C:C };
  }

  Bezier.quadraticFromPoints = function(p1,p2,p3, t) {
    if(typeof t === "undefined") { t = 0.5; }
    // shortcuts, although they're really dumb
    if(t===0) { return new Bezier(p2,p2,p3); }
    if(t===1) { return new Bezier(p1,p2,p2); }
    // real fitting.
    var abc = Bezier.getABC(2,p1,p2,p3,t);
    return new Bezier(p1, abc.A, p3);
  };

  Bezier.cubicFromPoints = function(S,B,E, t,d1) {
    if(typeof t === "undefined") { t = 0.5; }
    var abc = Bezier.getABC(3,S,B,E,t);
    if(typeof d1 === "undefined") { d1 = utils.dist(B,abc.C); }
    var d2 = d1 * (1-t)/t;

    var selen = utils.dist(S,E),
        lx = (E.x-S.x)/selen,
        ly = (E.y-S.y)/selen,
        bx1 = d1 * lx,
        by1 = d1 * ly,
        bx2 = d2 * lx,
        by2 = d2 * ly;
    // derivation of new hull coordinates
    var e1  = { x: B.x - bx1, y: B.y - by1 },
        e2  = { x: B.x + bx2, y: B.y + by2 },
        A = abc.A,
        v1  = { x: A.x + (e1.x-A.x)/(1-t), y: A.y + (e1.y-A.y)/(1-t) },
        v2  = { x: A.x + (e2.x-A.x)/(t), y: A.y + (e2.y-A.y)/(t) },
        nc1 = { x: S.x + (v1.x-S.x)/(t), y: S.y + (v1.y-S.y)/(t) },
        nc2 = { x: E.x + (v2.x-E.x)/(1-t), y: E.y + (v2.y-E.y)/(1-t) };
    // ...done
    return new Bezier(S,nc1,nc2,E);
  };

  var getUtils = function() {
    return utils;
  };

  Bezier.getUtils = getUtils;

  Bezier.prototype = {
    getUtils: getUtils,
    valueOf: function() {
      return this.toString();
    },
    toString: function() {
      return utils.pointsToString(this.points);
    },
    toSVG: function(relative) {
      if(this._3d) return false;
      var p = this.points,
          x = p[0].x,
          y = p[0].y,
          s = ["M", x, y, (this.order===2 ? "Q":"C")];
      for(var i=1, last=p.length; i<last; i++) {
        s.push(p[i].x);
        s.push(p[i].y);
      }
      return s.join(" ");
    },
    update: function() {
      // one-time compute derivative coordinates
      this.dpoints = [];
      for(var p=this.points, d=p.length, c=d-1; d>1; d--, c--) {
        var list = [];
        for(var j=0, dpt; j<c; j++) {
          dpt = {
            x: c * (p[j+1].x - p[j].x),
            y: c * (p[j+1].y - p[j].y)
          };
          if(this._3d) {
            dpt.z = c * (p[j+1].z - p[j].z);
          }
          list.push(dpt);
        }
        this.dpoints.push(list);
        p = list;
      };
      this.computedirection();
    },
    computedirection: function() {
      var points = this.points;
      var angle = utils.angle(points[0], points[this.order], points[1]);
      this.clockwise = angle > 0;
    },
    length: function() {
      return utils.length(this.derivative.bind(this));
    },
    _lut: [],
    getLUT: function(steps) {
      steps = steps || 100;
      if (this._lut.length === steps) { return this._lut; }
      this._lut = [];
      for(var t=0; t<=steps; t++) {
        this._lut.push(this.compute(t/steps));
      }
      return this._lut;
    },
    on: function(point, error) {
      error = error || 5;
      var lut = this.getLUT(), hits = [], c, t=0;
      for(var i=0; i<lut.length; i++) {
        c = lut[i];
        if (utils.dist(c,point) < error) {
          hits.push(c)
          t += i / lut.length;
        }
      }
      if(!hits.length) return false;
      return t /= hits.length;
    },
    project: function(point) {
      // step 1: coarse check
      var LUT = this.getLUT(), l = LUT.length-1,
          closest = utils.closest(LUT, point),
          mdist = closest.mdist,
          mpos = closest.mpos;
      if (mpos===0 || mpos===l) {
        var t = mpos/l, pt = this.compute(t);
        pt.t = t;
        pt.d = mdist;
        return pt;
      }

      // step 2: fine check
      var ft, t, p, d,
          t1 = (mpos-1)/l,
          t2 = (mpos+1)/l,
          step = 0.1/l;
      mdist += 1;
      for(t=t1,ft=t; t<t2+step; t+=step) {
        p = this.compute(t);
        d = utils.dist(point, p);
        if (d<mdist) {
          mdist = d;
          ft = t;
        }
      }
      p = this.compute(ft);
      p.t = ft;
      p.d = mdist;
      return p;
    },
    get: function(t) {
      return this.compute(t);
    },
    point: function(idx) {
      return this.points[idx];
    },
    compute: function(t) {
      // shortcuts
      if(t===0) { return this.points[0]; }
      if(t===1) { return this.points[this.order]; }

      var p = this.points;
      var mt = 1-t;

      // linear?
      if(this.order===1) {
        ret = {
          x: mt*p[0].x + t*p[1].x,
          y: mt*p[0].y + t*p[1].y
        };
        if (this._3d) { ret.z = mt*p[0].z + t*p[1].z; }
        return ret;
      }

      // quadratic/cubic curve?
      if(this.order<4) {
        var mt2 = mt*mt,
            t2 = t*t,
            a,b,c,d = 0;
        if(this.order===2) {
          p = [p[0], p[1], p[2], ZERO];
          a = mt2;
          b = mt*t*2;
          c = t2;
        }
        else if(this.order===3) {
          a = mt2*mt;
          b = mt2*t*3;
          c = mt*t2*3;
          d = t*t2;
        }
        var ret = {
          x: a*p[0].x + b*p[1].x + c*p[2].x + d*p[3].x,
          y: a*p[0].y + b*p[1].y + c*p[2].y + d*p[3].y
        };
        if(this._3d) {
          ret.z = a*p[0].z + b*p[1].z + c*p[2].z + d*p[3].z;
        }
        return ret;
      }

      // higher order curves: use de Casteljau's computation
      var dCpts = JSON.parse(JSON.stringify(this.points));
      while(dCpts.length > 1) {
        for (var i=0; i<dCpts.length-1; i++) {
          dCpts[i] = {
            x: dCpts[i].x + (dCpts[i+1].x - dCpts[i].x) * t,
            y: dCpts[i].y + (dCpts[i+1].y - dCpts[i].y) * t
          };
          if (typeof dCpts[i].z !== "undefined") {
            dCpts[i] = dCpts[i].z + (dCpts[i+1].z - dCpts[i].z) * t
          }
        }
        dCpts.splice(dCpts.length-1, 1);
      }
      return dCpts[0];
    },
    raise: function() {
      var p = this.points, np = [p[0]], i, k=p.length, pi, pim;
      for (var i=1; i<k; i++) {
        pi = p[i];
        pim = p[i-1];
        np[i] = {
          x: (k-i)/k * pi.x + i/k * pim.x,
          y: (k-i)/k * pi.y + i/k * pim.y
        };
      }
      np[k] = p[k-1];
      return new Bezier(np);
    },
    derivative: function(t) {
      var mt = 1-t,
          a,b,c=0,
          p = this.dpoints[0];
      if(this.order===2) { p = [p[0], p[1], ZERO]; a = mt; b = t; }
      if(this.order===3) { a = mt*mt; b = mt*t*2; c = t*t; }
      var ret = {
        x: a*p[0].x + b*p[1].x + c*p[2].x,
        y: a*p[0].y + b*p[1].y + c*p[2].y
      };
      if(this._3d) {
        ret.z = a*p[0].z + b*p[1].z + c*p[2].z;
      }
      return ret;
    },
    inflections: function() {
      return utils.inflections(this.points);
    },
    normal: function(t) {
      return this._3d ? this.__normal3(t) : this.__normal2(t);
    },
    __normal2: function(t) {
      var d = this.derivative(t);
      var q = sqrt(d.x*d.x + d.y*d.y)
      return { x: -d.y/q, y: d.x/q };
    },
    __normal3: function() {
      // see http://stackoverflow.com/questions/25453159
      var r1 = this.derivative(t),
          r2 = this.derivative(t+0.01),
          q1 = sqrt(r1.x*r1.x + r1.y*r1.y + r1.z*r1.z),
          q2 = sqrt(r2.x*r2.x + r2.y*r2.y + r2.z*r2.z);
      r1.x /= q1; r1.y /= q1; r1.z /= q1;
      r2.x /= q2; r2.y /= q2; r2.z /= q2;
      // cross product
      var c = {
        x: r2.y*r1.z - r2.z*r1.y,
        y: r2.z*r1.x - r2.x*r1.z,
        z: r2.x*r1.y - r2.y*r1.x
      };
      var m = sqrt(c.x*c.x + c.y*c.y + c.z*c.z);
      c.x /= m; c.y /= m; c.z /= m;
      // rotation matrix
      var R = [   c.x*c.x,   c.x*c.y-c.z, c.x*c.z+c.y,
                c.x*c.y+c.z,   c.y*c.y,   c.y*c.z-c.x,
                c.x*c.z-c.y, c.y*c.z+c.x,   c.z*c.z    ];
      // normal vector:
      var n = {
        x: R[0] * r1.x + R[1] * r1.y + R[2] * r1.z,
        y: R[3] * r1.x + R[4] * r1.y + R[5] * r1.z,
        z: R[6] * r1.x + R[7] * r1.y + R[8] * r1.z
      };
      return n;
    },
    hull: function(t) {
      var p = this.points,
          _p = [],
          pt,
          q = [],
          idx = 0,
          i=0,
          l=0;
      q[idx++] = p[0];
      q[idx++] = p[1];
      q[idx++] = p[2];
      if(this.order === 3) { q[idx++] = p[3]; }
      // we lerp between all points at each iteration, until we have 1 point left.
      while(p.length>1) {
        _p = [];
        for(i=0, l=p.length-1; i<l; i++) {
          pt = utils.lerp(t,p[i],p[i+1]);
          q[idx++] = pt;
          _p.push(pt);
        }
        p = _p;
      }
      return q;
    },
    split: function(t1, t2) {
      // shortcuts
      if(t1===0 && !!t2) { return this.split(t2).left; }
      if(t2===1) { return this.split(t1).right; }

      // no shortcut: use "de Casteljau" iteration.
      var q = this.hull(t1);
      var result = {
        left: this.order === 2 ? new Bezier([q[0],q[3],q[5]]) : new Bezier([q[0],q[4],q[7],q[9]]),
        right: this.order === 2 ? new Bezier([q[5],q[4],q[2]]) : new Bezier([q[9],q[8],q[6],q[3]]),
        span: q
      };

      // make sure we bind _t1/_t2 information!
      result.left._t1  = utils.map(0,  0,1, this._t1,this._t2);
      result.left._t2  = utils.map(t1, 0,1, this._t1,this._t2);
      result.right._t1 = utils.map(t1, 0,1, this._t1,this._t2);
      result.right._t2 = utils.map(1,  0,1, this._t1,this._t2);

      // if we have no t2, we're done
      if(!t2) { return result; }

      // if we have a t2, split again:
      t2 = utils.map(t2,t1,1,0,1);
      var subsplit = result.right.split(t2);
      return subsplit.left;
    },
    extrema: function() {
      var dims = this.dims,
          result={},
          roots=[],
          p, mfn;
      dims.forEach(function(dim) {
        mfn = function(v) { return v[dim]; };
        p = this.dpoints[0].map(mfn);
        result[dim] = utils.droots(p);
        if(this.order === 3) {
          p = this.dpoints[1].map(mfn);
          result[dim] = result[dim].concat(utils.droots(p));
        }
        result[dim] = result[dim].filter(function(t) { return (t>=0 && t<=1); });
        roots = roots.concat(result[dim].sort());
      }.bind(this));
      roots.sort();
      result.values = roots;
      return result;
    },
    bbox: function() {
      var extrema = this.extrema(), result = {};
      this.dims.forEach(function(d) {
        result[d] = utils.getminmax(this, d, extrema[d]);
      }.bind(this));
      return result;
    },
    overlaps: function(curve) {
      var lbbox = this.bbox(),
          tbbox = curve.bbox();
      return utils.bboxoverlap(lbbox,tbbox);
    },
    offset: function(t, d) {
      if(typeof d !== "undefined") {
        var c = this.get(t);
        var n = this.normal(t);
        var ret = {
          c: c,
          n: n,
          x: c.x + n.x * d,
          y: c.y + n.y * d
        };
        if(this._3d) {
          ret.z = c.z + n.z * d;
        };
        return ret;
      }
      if(this._linear) {
        var nv = this.normal(0);
        var coords = this.points.map(function(p) {
          var ret = {
            x: p.x + t * nv.x,
            y: p.y + t * nv.y
          };
          if(p.z && n.z) { ret.z = p.z + t * nv.z; }
          return ret;
        });
        return [new Bezier(coords)];
      }
      var reduced = this.reduce();
      return reduced.map(function(s) {
        return s.scale(t);
      });
    },
    simple: function() {
      if(this.order===3) {
        var a1 = utils.angle(this.points[0], this.points[3], this.points[1]);
        var a2 = utils.angle(this.points[0], this.points[3], this.points[2]);
        if(a1>0 && a2<0 || a1<0 && a2>0) return false;
      }
      var n1 = this.normal(0);
      var n2 = this.normal(1);
      var s = n1.x*n2.x + n1.y*n2.y;
      if(this._3d) { s += n1.z*n2.z; }
      var angle = abs(acos(s));
      return angle < pi/3;
    },
    reduce: function() {
      var i, t1=0, t2=0, step=0.01, segment, pass1=[], pass2=[];
      // first pass: split on extrema
      var extrema = this.extrema().values;
      if(extrema.indexOf(0)===-1) { extrema = [0].concat(extrema); }
      if(extrema.indexOf(1)===-1) { extrema.push(1); }
      for(t1=extrema[0], i=1; i<extrema.length; i++) {
        t2 = extrema[i];
        segment = this.split(t1,t2);
        segment._t1 = t1;
        segment._t2 = t2;
        pass1.push(segment);
        t1 = t2;
      }
      // second pass: further reduce these segments to simple segments
      pass1.forEach(function(p1) {
        t1=0;
        t2=0;
        while(t2 <= 1) {
          for(t2=t1+step; t2<=1+step; t2+=step) {
            segment = p1.split(t1,t2);
            if(!segment.simple()) {
              t2 -= step;
              if(abs(t1-t2)<step) {
                // we can never form a reduction
                return [];
              }
              segment = p1.split(t1,t2);
              segment._t1 = utils.map(t1,0,1,p1._t1,p1._t2);
              segment._t2 = utils.map(t2,0,1,p1._t1,p1._t2);
              pass2.push(segment);
              t1 = t2;
              break;
            }
          }
        }
        if(t1<1) {
          segment = p1.split(t1,1);
          segment._t1 = utils.map(t1,0,1,p1._t1,p1._t2);
          segment._t2 = p1._t2;
          pass2.push(segment);
        }
      });
      return pass2;
    },
    scale: function(d) {
      var order = this.order;
      var distanceFn = false
      if(typeof d === "function") { distanceFn = d; }
      if(distanceFn && order === 2) { return this.raise().scale(distanceFn); }

      // TODO: add special handling for degenerate (=linear) curves.
      var clockwise = this.clockwise;
      var r1 = distanceFn ? distanceFn(0) : d;
      var r2 = distanceFn ? distanceFn(1) : d;
      var v = [ this.offset(0,10), this.offset(1,10) ];
      var o = utils.lli4(v[0], v[0].c, v[1], v[1].c);
      if(!o) { console.log("cannot scale this curve. Try reducing it first."); return this;}
      // move all points by distance 'd' wrt the origin 'o'
      var points=this.points, np=[];

      // move end points by fixed distance along normal.
      [0,1].forEach(function(t) {
        var p = np[t*order] = utils.copy(points[t*order]);
        p.x += (t?r2:r1) * v[t].n.x;
        p.y += (t?r2:r1) * v[t].n.y;
      }.bind(this));

      if (!distanceFn) {
        // move control points to lie on the intersection of the offset
        // derivative vector, and the origin-through-control vector
        [0,1].forEach(function(t) {
          if(this.order===2 && !!t) return;
          var p = np[t*order];
          var d = this.derivative(t);
          var p2 = { x: p.x + d.x, y: p.y + d.y };
          np[t+1] = utils.lli4(p, p2, o, points[t+1]);
        }.bind(this));
        return new Bezier(np);
      }

      // move control points by "however much necessary to
      // ensure the correct tangent to endpoint".
      [0,1].forEach(function(t) {
        if(this.order===2 && !!t) return;
        var p = points[t+1];
        var ov = {
          x: p.x - o.x,
          y: p.y - o.y
        };
        var rc = distanceFn ? distanceFn((t+1)/order) : d;
        if(distanceFn && !clockwise) rc = -rc;
        var m = sqrt(ov.x*ov.x + ov.y*ov.y);
        ov.x /= m;
        ov.y /= m;
        np[t+1] = {
          x: p.x + rc*ov.x,
          y: p.y + rc*ov.y
        }
      }.bind(this));
      return new Bezier(np);
    },
    outline: function(d1, d2, d3, d4) {
      d2 = (typeof d2 === "undefined") ? d1 : d2;
      var reduced = this.reduce(),
          len = reduced.length,
          fcurves = [],
          bcurves = [],
          p,
          alen = 0,
          tlen = this.length();

      var graduated = (typeof d3 !== "undefined" && typeof d4 !== "undefined");

      function linearDistanceFunction(s,e, tlen,alen,slen) {
        return function (v) {
          var f1 = alen/tlen, f2 = (alen+slen)/tlen, d = e-s;
          return utils.map(v, 0,1, s+f1*d, s+f2*d);
        };
      };

      // form curve oulines
      reduced.forEach(function(segment) {
        slen = segment.length();
        if (graduated) {
          fcurves.push(segment.scale(  linearDistanceFunction( d1, d3, tlen,alen,slen)  ));
          bcurves.push(segment.scale(  linearDistanceFunction(-d2,-d4, tlen,alen,slen)  ));
        } else {
          fcurves.push(segment.scale( d1));
          bcurves.push(segment.scale(-d2));
        }
        alen += slen;
      });

      // reverse the "return" outline
      bcurves = bcurves.map(function(s) {
        p = s.points;
        if(p[3]) { s.points = [p[3],p[2],p[1],p[0]]; }
        else { s.points = [p[2],p[1],p[0]]; }
        return s;
      }).reverse();

      // form the endcaps as lines
      var fs = fcurves[0].points[0],
          fe = fcurves[len-1].points[fcurves[len-1].points.length-1],
          bs = bcurves[len-1].points[bcurves[len-1].points.length-1],
          be = bcurves[0].points[0],
          ls = utils.makeline(bs,fs),
          le = utils.makeline(fe,be),
          segments = [ls].concat(fcurves).concat([le]).concat(bcurves),
          slen = segments.length;

      return new PolyBezier(segments);
    },
    outlineshapes: function(d1,d2) {
      d2 = d2 || d1;
      var outline = this.outline(d1,d2).curves;
      var shapes = [];
      for(var i=1, len=outline.length; i < len/2; i++) {
        var shape = utils.makeshape(outline[i], outline[len-i]);
        shape.startcap.virtual = (i > 1);
        shape.endcap.virtual = (i < len/2-1);
        shapes.push(shape);
      }
      return shapes;
    },
    intersects: function(curve) {
      if(!curve) return this.selfintersects();
      if(curve.p1 && curve.p2) {
        return this.lineIntersects(curve);
      }
      if(curve instanceof Bezier) { curve = curve.reduce(); }
      return this.curveintersects(this.reduce(), curve);
    },
    lineIntersects: function(line) {
      var mx = min(line.p1.x, line.p2.x),
          my = min(line.p1.y, line.p2.y),
          MX = max(line.p1.x, line.p2.x),
          MY = max(line.p1.y, line.p2.y),
          self=this;
      return utils.roots(this.points, line).filter(function(t) {
        var p = self.get(t);
        return utils.between(p.x, mx, MX) && utils.between(p.y, my, MY);
      });
    },
    selfintersects: function() {
      var reduced = this.reduce();
      // "simple" curves cannot intersect with their direct
      // neighbour, so for each segment X we check whether
      // it intersects [0:x-2][x+2:last].
      var i,len=reduced.length-2,results=[],result,left,right;
      for(i=0; i<len; i++) {
        left = reduced.slice(i,i+1);
        right = reduced.slice(i+2);
        result = this.curveintersects(left, right);
        results = results.concat( result );
      }
      return results;
    },
    curveintersects: function(c1,c2) {
      var pairs = [];
      // step 1: pair off any overlapping segments
      c1.forEach(function(l) {
        c2.forEach(function(r) {
          if(l.overlaps(r)) {
            pairs.push({ left: l, right: r });
          }
        });
      });
      // step 2: for each pairing, run through the convergence algorithm.
      var intersections = [];
      pairs.forEach(function(pair) {
        var result = utils.pairiteration(pair.left, pair.right);
        if(result.length > 0) {
          intersections = intersections.concat(result);
        }
      });
      return intersections;
    },
    arcs: function(errorThreshold) {
      errorThreshold = errorThreshold || 0.5;
      var circles = [];
      return this._iterate(errorThreshold, circles);
    },
    _error: function(pc, np1, s, e) {
      var q = (e - s) / 4,
          c1 = this.get(s + q),
          c2 = this.get(e - q),
          ref = utils.dist(pc, np1),
          d1  = utils.dist(pc, c1),
          d2  = utils.dist(pc, c2);
      return abs(d1-ref) + abs(d2-ref);
    },
    _iterate: function(errorThreshold, circles) {
      var s = 0, e = 1, safety;
      // we do a binary search to find the "good `t` closest to no-longer-good"
      do {
        safety=0;

        // step 1: start with the maximum possible arc
        e = 1;

        // points:
        var np1 = this.get(s), np2, np3, arc, prev_arc;

        // booleans:
        var curr_good = false, prev_good = false, done;

        // numbers:
        var m = e, prev_e = 1, step = 0;

        // step 2: find the best possible arc
        do {
          prev_good = curr_good;
          prev_arc = arc;
          m = (s + e)/2;
          step++;

          np2 = this.get(m);
          np3 = this.get(e);

          arc = utils.getccenter(np1, np2, np3);
          var error = this._error(arc, np1, s, e);
          curr_good = (error <= errorThreshold);

          done = prev_good && !curr_good;
          if(!done) prev_e = e;

          // this arc is fine: we can move 'e' up to see if we can find a wider arc
          if(curr_good) {
            // if e is already at max, then we're done for this arc.
            if (e >= 1) {
              prev_e = 1;
              prev_arc = arc;
              break;
            }
            // if not, move it up by half the iteration distance
            e = e + (e-s)/2;
          }

          // this is a bad arc: we need to move 'e' down to find a good arc
          else {
            e = m;
          }
        }
        while(!done && safety++<100);

        if(safety>=100) {
          console.error("arc abstraction somehow failed...");
          break;
        }

        // console.log("[F] arc found", s, prev_e, prev_arc.x, prev_arc.y, prev_arc.s, prev_arc.e);

        prev_arc = (prev_arc ? prev_arc : arc);
        circles.push(prev_arc);
        s = prev_e;
      }
      while(e < 1);
      return circles;
    },

    /**
     * edited Denis Ponomarev www.hometlt.ru
     */
    getTbyLength: function(length, accuracy , offsetT ){
      offsetT = offsetT || 0;
      accuracy = accuracy || 0.005;
      if(length == 0 )return offsetT;
      var pt1 = this.get(offsetT), pt2, t= offsetT,  dx , dy;
      var dist = 0;
      do{
        t+= accuracy;
        pt2 = this.get(t);
        dx = pt2.x - pt1.x;
        dy = pt2.y - pt1.y;
        dist += Math.sqrt(dx * dx + dy * dy);
        pt1 = pt2;
        if(t >= 1){
          return this.length();
        }
      } while(dist <  length);

      return t;
    }
  };
  return Bezier;
}());

if (true) {
  module.exports = Bezier;
}


/***/ }),
/* 11 */
/***/ (function(module, exports, __webpack_require__) {


var utils = __webpack_require__(2);
utils.object = __webpack_require__(1);


/***********************************************************************************************************************
 ** DPHistory
 ***********************************************************************************************************************/


var DPHistory = function (parent, initAction) {
    this.parent = parent;
    this.clear(initAction);
};

DPHistory.prototype.setRecords = function (records,current) {
  this.canUndo = records.length;
  this.canRedo = false;

  if(!records.length){
    records = [{
      type: 'initialized',
      id: 0,
      text : 'initialized'
    }]
  }
  this.records = records;
  this.length = this.records.length ;
  this.current = current === undefined ? records.length - 1 : current;
  this.activeAction = this.records[this.current];
  this.fire("changed",{action: this.activeAction});
  return this;
};

DPHistory.prototype.restore = function () {
  this.setRecords(this.saved.records,this.saved.current);
  return this;
};

DPHistory.prototype.save = function () {
  this.saved = {
    current: this.current,
    records: utils.object.cloneDeep(this.records)
  }
  return this;
};

DPHistory.prototype.clear = function (initAction) {
    if (initAction) {
        initAction.id = 0;
    } else {
        initAction = {
            type: 'initialized',
            id: 0,
          text : 'initialized'
        }
    }
    this.records = [initAction];
    this.current = 0;
    this.canUndo = false;
    this.canRedo = false;
    this.activeAction = this.records[this.current];
  this.fire("changed",{action: this.activeAction});
  return this;
};


DPHistory.prototype.add = function(action){


    if (!this.enabled || this.processing) {
      return false;
    }

    action.moment = new Date().getTime();
    this.canUndo = true;
    this.canRedo = false;
    this.records.splice(this.current+ 1);
    this.records.push(action);
    this.length = this.records.length;
    action.id = this.length - 1;
    action.text = action.type || action.text;
    this.current = this.length - 1;

  this.activeAction = this.records[this.current];
  this.fire("changed",{action: action});
  return this;
};
DPHistory.prototype.disable = function(){
  this.enabled = false;
  return this;
};
DPHistory.prototype.enable = function(){
  this.enabled = true;
  return this;
};
DPHistory.prototype.undo = function(noFire){
    this.canRedo = true;
    var _action = this.records[this.current];
    this.current--;
  this.processing = true;
    _action.undo.call(this.parent,_action);
  this.processing = false;
    if(this.current == 0){
        this.canUndo = false;
    }
    if(!noFire){
      this.activeAction = this.records[this.current];
      this.fire("changed",{action: _action});
    }
  return this;
};

DPHistory.prototype.goto = function(index){
    if(index == this.current)return;
    if(index < this.current){
        for(var i = this.current - index ;i--; ){
            this.undo(true);
        }
    }if(index > this.current){
        for(var i = index - this.current ;i--; ){
            this.redo(true);
        }
    }
  this.activeAction = this.records[this.current];
  this.fire("changed",{action: this.activeAction});
  return this;
};

DPHistory.prototype.redo = function(noFire){
    if(this.current == this.length - 1){
        return;
    }
  this.processing = true;
    this.canUndo = true;
    this.current++;
    var _action = this.records[this.current];

    _action.redo.call(this.parent,_action);

    if(this.current == this.length - 1){
        this.canRedo = false;
    }
  this.processing = false;
  if(!noFire) {
    this.activeAction = this.records[this.current];
    this.fire("changed",{action: _action});
  }
  return this;
};
utils.observable(DPHistory.prototype);
module.exports = DPHistory;


/***/ }),
/* 12 */
/***/ (function(module, exports) {

module.exports = $;

/***/ }),
/* 13 */
/***/ (function(module, exports) {

module.exports = "PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgo8c3ZnCiAgICB4bWxuczppbmtzY2FwZT0iaHR0cDovL3d3dy5pbmtzY2FwZS5vcmcvbmFtZXNwYWNlcy9pbmtzY2FwZSIKICAgIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyIKICAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgIHhtbG5zOnNvZGlwb2RpPSJodHRwOi8vc29kaXBvZGkuc291cmNlZm9yZ2UubmV0L0RURC9zb2RpcG9kaS0wLmR0ZCIKICAgIHhtbG5zOmNjPSJodHRwOi8vY3JlYXRpdmVjb21tb25zLm9yZy9ucyMiCiAgICB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIKICAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgICB4bWxuczpuczE9Imh0dHA6Ly9zb3ppLmJhaWVyb3VnZS5mciIKICAgIGlkPSJzdmc0ODg4IgogICAgc29kaXBvZGk6ZG9jbmFtZT0id2FybmluZ19idXR0b24uc3ZnIgogICAgdmlld0JveD0iMCAwIDQwMCA0MDAiCiAgICB2ZXJzaW9uPSIxLjEiCiAgICBpbmtzY2FwZTp2ZXJzaW9uPSIwLjQ4LjAgcjk2NTQiCiAgPgogIDxkZWZzCiAgICAgIGlkPSJkZWZzNDg5MCIKICAgID4KICAgIDxsaW5lYXJHcmFkaWVudAogICAgICAgIGlkPSJsaW5lYXJHcmFkaWVudDg0MTEiCiAgICAgICAgeTI9IjM2Ny44OCIKICAgICAgICBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIKICAgICAgICB5MT0iMjg3LjQ5IgogICAgICAgIHgyPSIzMTUuNDciCiAgICAgICAgeDE9IjI0MS40MSIKICAgICAgICBpbmtzY2FwZTpjb2xsZWN0PSJhbHdheXMiCiAgICAgID4KICAgICAgPHN0b3AKICAgICAgICAgIGlkPSJzdG9wNDE1OCIKICAgICAgICAgIHN0eWxlPSJzdG9wLWNvbG9yOiNmZmZmZmYiCiAgICAgICAgICBvZmZzZXQ9IjAiCiAgICAgIC8+CiAgICAgIDxzdG9wCiAgICAgICAgICBpZD0ic3RvcDQxNjAiCiAgICAgICAgICBzdHlsZT0ic3RvcC1jb2xvcjojZmZmZmZmO3N0b3Atb3BhY2l0eTowIgogICAgICAgICAgb2Zmc2V0PSIxIgogICAgICAvPgogICAgPC9saW5lYXJHcmFkaWVudAogICAgPgogICAgPGZpbHRlcgogICAgICAgIGlkPSJmaWx0ZXI2MTI2IgogICAgICAgIGNvbG9yLWludGVycG9sYXRpb24tZmlsdGVycz0ic1JHQiIKICAgICAgICBpbmtzY2FwZTpjb2xsZWN0PSJhbHdheXMiCiAgICAgID4KICAgICAgPGZlR2F1c3NpYW5CbHVyCiAgICAgICAgICBpZD0iZmVHYXVzc2lhbkJsdXI2MTI4IgogICAgICAgICAgc3RkRGV2aWF0aW9uPSIwLjUzMDM1NzEzIgogICAgICAgICAgaW5rc2NhcGU6Y29sbGVjdD0iYWx3YXlzIgogICAgICAvPgogICAgPC9maWx0ZXIKICAgID4KICAgIDxsaW5lYXJHcmFkaWVudAogICAgICAgIGlkPSJsaW5lYXJHcmFkaWVudDg0MTMiCiAgICAgICAgeTI9IjM5MS40NSIKICAgICAgICBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIKICAgICAgICB5MT0iMzAwLjg2IgogICAgICAgIHgyPSIzNDIiCiAgICAgICAgeDE9IjI3NS42MSIKICAgICAgICBpbmtzY2FwZTpjb2xsZWN0PSJhbHdheXMiCiAgICAgID4KICAgICAgPHN0b3AKICAgICAgICAgIGlkPSJzdG9wNzIwMSIKICAgICAgICAgIHN0eWxlPSJzdG9wLWNvbG9yOiM1NTAwMDAiCiAgICAgICAgICBvZmZzZXQ9IjAiCiAgICAgIC8+CiAgICAgIDxzdG9wCiAgICAgICAgICBpZD0ic3RvcDcyMDMiCiAgICAgICAgICBzdHlsZT0ic3RvcC1jb2xvcjojZmYwMDAwIgogICAgICAgICAgb2Zmc2V0PSIxIgogICAgICAvPgogICAgPC9saW5lYXJHcmFkaWVudAogICAgPgogICAgPHJhZGlhbEdyYWRpZW50CiAgICAgICAgaWQ9InJhZGlhbEdyYWRpZW50ODQxNSIKICAgICAgICBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIKICAgICAgICBjeD0iMzEyLjc4IgogICAgICAgIGN5PSIzODYuNTciCiAgICAgICAgcj0iNTMuMDM2IgogICAgICAgIGdyYWRpZW50VHJhbnNmb3JtPSJtYXRyaXgoLS41OTMyNyAtLjU5MzI3IC43MTUwNSAtLjcxNTA1IDI0My4yNyA4NDkuMDMpIgogICAgICAgIGlua3NjYXBlOmNvbGxlY3Q9ImFsd2F5cyIKICAgICAgPgogICAgICA8c3RvcAogICAgICAgICAgaWQ9InN0b3A3MTEzLTciCiAgICAgICAgICBzdHlsZT0ic3RvcC1jb2xvcjojZmZmZmZmO3N0b3Atb3BhY2l0eTouNDA4MTYiCiAgICAgICAgICBvZmZzZXQ9IjAiCiAgICAgIC8+CiAgICAgIDxzdG9wCiAgICAgICAgICBpZD0ic3RvcDcxMTUtNyIKICAgICAgICAgIHN0eWxlPSJzdG9wLWNvbG9yOiNmZmZmZmY7c3RvcC1vcGFjaXR5OjAiCiAgICAgICAgICBvZmZzZXQ9IjEiCiAgICAgIC8+CiAgICA8L3JhZGlhbEdyYWRpZW50CiAgICA+CiAgICA8bGluZWFyR3JhZGllbnQKICAgICAgICBpZD0ibGluZWFyR3JhZGllbnQxMDQ0OSIKICAgICAgICB5Mj0iMzM4LjgyIgogICAgICAgIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIgogICAgICAgIHkxPSIyODYuNjciCiAgICAgICAgZ3JhZGllbnRUcmFuc2Zvcm09Im1hdHJpeCguOTU1MzQgMCAwIC45NTUzNCAxMzYuMTIgMTQuMDU1KSIKICAgICAgICB4Mj0iMzAwLjI3IgogICAgICAgIHgxPSIyNTUuMzIiCiAgICAgICAgaW5rc2NhcGU6Y29sbGVjdD0iYWx3YXlzIgogICAgICA+CiAgICAgIDxzdG9wCiAgICAgICAgICBpZD0ic3RvcDQxNTAiCiAgICAgICAgICBzdHlsZT0ic3RvcC1jb2xvcjojZmZmZmZmIgogICAgICAgICAgb2Zmc2V0PSIwIgogICAgICAvPgogICAgICA8c3RvcAogICAgICAgICAgaWQ9InN0b3A0MTUyIgogICAgICAgICAgc3R5bGU9InN0b3AtY29sb3I6I2ZmZmZmZjtzdG9wLW9wYWNpdHk6MCIKICAgICAgICAgIG9mZnNldD0iMSIKICAgICAgLz4KICAgIDwvbGluZWFyR3JhZGllbnQKICAgID4KICAgIDxmaWx0ZXIKICAgICAgICBpZD0iZmlsdGVyMTE0MjgiCiAgICAgICAgY29sb3ItaW50ZXJwb2xhdGlvbi1maWx0ZXJzPSJzUkdCIgogICAgICAgIGlua3NjYXBlOmNvbGxlY3Q9ImFsd2F5cyIKICAgICAgPgogICAgICA8ZmVHYXVzc2lhbkJsdXIKICAgICAgICAgIGlkPSJmZUdhdXNzaWFuQmx1cjExNDMwIgogICAgICAgICAgc3RkRGV2aWF0aW9uPSIxLjI0MzQ2NzgiCiAgICAgICAgICBpbmtzY2FwZTpjb2xsZWN0PSJhbHdheXMiCiAgICAgIC8+CiAgICA8L2ZpbHRlcgogICAgPgogIDwvZGVmcwogID4KICA8c29kaXBvZGk6bmFtZWR2aWV3CiAgICAgIGlkPSJiYXNlIgogICAgICBib3JkZXJjb2xvcj0iIzY2NjY2NiIKICAgICAgaW5rc2NhcGU6cGFnZXNoYWRvdz0iMiIKICAgICAgaW5rc2NhcGU6d2luZG93LXk9Ii04IgogICAgICBwYWdlY29sb3I9IiNmZmZmZmYiCiAgICAgIGlua3NjYXBlOndpbmRvdy1oZWlnaHQ9Ijk4OCIKICAgICAgaW5rc2NhcGU6d2luZG93LW1heGltaXplZD0iMSIKICAgICAgaW5rc2NhcGU6em9vbT0iMC43MDcxMDY3OCIKICAgICAgaW5rc2NhcGU6d2luZG93LXg9Ii04IgogICAgICBzaG93Z3JpZD0iZmFsc2UiCiAgICAgIGJvcmRlcm9wYWNpdHk9IjEuMCIKICAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ibGF5ZXIxIgogICAgICBpbmtzY2FwZTpjeD0iMzA0Ljg5NDA5IgogICAgICBpbmtzY2FwZTpjeT0iMzQxLjUyMTg2IgogICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9IjE2ODAiCiAgICAgIGlua3NjYXBlOnBhZ2VvcGFjaXR5PSIwLjAiCiAgICAgIGlua3NjYXBlOmRvY3VtZW50LXVuaXRzPSJweCIKICAvPgogIDxnCiAgICAgIGlkPSJsYXllcjEiCiAgICAgIGlua3NjYXBlOmxhYmVsPSJMYXllciAxIgogICAgICBpbmtzY2FwZTpncm91cG1vZGU9ImxheWVyIgogICAgICB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwIC02NTIuMzYpIgogICAgPgogICAgPGcKICAgICAgICBpZD0iZzExNDMyIgogICAgICAgIGlua3NjYXBlOmV4cG9ydC15ZHBpPSI5MCIKICAgICAgICBpbmtzY2FwZTpleHBvcnQteGRwaT0iOTAiCiAgICAgICAgdHJhbnNmb3JtPSJtYXRyaXgoMi45MDUxIDAgMCAyLjkwNTEgLTEwMDEuOSAtNzguOTYxKSIKICAgICAgPgogICAgICA8cGF0aAogICAgICAgICAgaWQ9InBhdGg3Mjc2IgogICAgICAgICAgc29kaXBvZGk6cng9IjUzLjAzNTcxMyIKICAgICAgICAgIHNvZGlwb2RpOnJ5PSI1My4wMzU3MTMiCiAgICAgICAgICBzdHlsZT0iZmlsbDojOTk5OTk5IgogICAgICAgICAgc29kaXBvZGk6dHlwZT0iYXJjIgogICAgICAgICAgZD0ibTM1Ni43OSAzNDYuMTFjMCAyOS4yOTEtMjMuNzQ1IDUzLjAzNi01My4wMzYgNTMuMDM2cy01My4wMzYtMjMuNzQ1LTUzLjAzNi01My4wMzYgMjMuNzQ1LTUzLjAzNiA1My4wMzYtNTMuMDM2IDUzLjAzNiAyMy43NDUgNTMuMDM2IDUzLjAzNnoiCiAgICAgICAgICB0cmFuc2Zvcm09Im1hdHJpeCguOTczNTQgMCAwIC45NzM1NCAxMjAuMDkgLTEyLjYyOCkiCiAgICAgICAgICBzb2RpcG9kaTpjeT0iMzQ2LjExMjE4IgogICAgICAgICAgc29kaXBvZGk6Y3g9IjMwMy43NSIKICAgICAgLz4KICAgICAgPHBhdGgKICAgICAgICAgIGlkPSJwYXRoNzI3OCIKICAgICAgICAgIHNvZGlwb2RpOnJ4PSI1My4wMzU3MTMiCiAgICAgICAgICBzb2RpcG9kaTpyeT0iNTMuMDM1NzEzIgogICAgICAgICAgc3R5bGU9ImZpbGw6dXJsKCNsaW5lYXJHcmFkaWVudDg0MTEpIgogICAgICAgICAgc29kaXBvZGk6dHlwZT0iYXJjIgogICAgICAgICAgZD0ibTM1Ni43OSAzNDYuMTFjMCAyOS4yOTEtMjMuNzQ1IDUzLjAzNi01My4wMzYgNTMuMDM2cy01My4wMzYtMjMuNzQ1LTUzLjAzNi01My4wMzYgMjMuNzQ1LTUzLjAzNiA1My4wMzYtNTMuMDM2IDUzLjAzNiAyMy43NDUgNTMuMDM2IDUzLjAzNnoiCiAgICAgICAgICB0cmFuc2Zvcm09Im1hdHJpeCguOTU5NjAgMCAwIC45NTk2MCAxMjQuMzMgLTcuODAxNCkiCiAgICAgICAgICBzb2RpcG9kaTpjeT0iMzQ2LjExMjE4IgogICAgICAgICAgc29kaXBvZGk6Y3g9IjMwMy43NSIKICAgICAgLz4KICAgICAgPHBhdGgKICAgICAgICAgIGlkPSJwYXRoNzI4MCIKICAgICAgICAgIHNvZGlwb2RpOnJ4PSI1My4wMzU3MTMiCiAgICAgICAgICBzb2RpcG9kaTpyeT0iNTMuMDM1NzEzIgogICAgICAgICAgc3R5bGU9ImZpbHRlcjp1cmwoI2ZpbHRlcjYxMjYpO2ZpbGw6I2VjZWNlYyIKICAgICAgICAgIHNvZGlwb2RpOnR5cGU9ImFyYyIKICAgICAgICAgIGQ9Im0zNTYuNzkgMzQ2LjExYzAgMjkuMjkxLTIzLjc0NSA1My4wMzYtNTMuMDM2IDUzLjAzNnMtNTMuMDM2LTIzLjc0NS01My4wMzYtNTMuMDM2IDIzLjc0NS01My4wMzYgNTMuMDM2LTUzLjAzNiA1My4wMzYgMjMuNzQ1IDUzLjAzNiA1My4wMzZ6IgogICAgICAgICAgdHJhbnNmb3JtPSJtYXRyaXgoLjg3MzU1IDAgMCAuODczNTUgMTUwLjQ3IDIxLjk4MSkiCiAgICAgICAgICBzb2RpcG9kaTpjeT0iMzQ2LjExMjE4IgogICAgICAgICAgc29kaXBvZGk6Y3g9IjMwMy43NSIKICAgICAgLz4KICAgICAgPHBhdGgKICAgICAgICAgIGlkPSJwYXRoNzI4MiIKICAgICAgICAgIHNvZGlwb2RpOnJ4PSI1My4wMzU3MTMiCiAgICAgICAgICBzb2RpcG9kaTpyeT0iNTMuMDM1NzEzIgogICAgICAgICAgc3R5bGU9ImZpbHRlcjp1cmwoI2ZpbHRlcjYxMjYpO2ZpbGw6Izk5OTk5OSIKICAgICAgICAgIHNvZGlwb2RpOnR5cGU9ImFyYyIKICAgICAgICAgIGQ9Im0zNTYuNzkgMzQ2LjExYzAgMjkuMjkxLTIzLjc0NSA1My4wMzYtNTMuMDM2IDUzLjAzNnMtNTMuMDM2LTIzLjc0NS01My4wMzYtNTMuMDM2IDIzLjc0NS01My4wMzYgNTMuMDM2LTUzLjAzNiA1My4wMzYgMjMuNzQ1IDUzLjAzNiA1My4wMzZ6IgogICAgICAgICAgdHJhbnNmb3JtPSJtYXRyaXgoLjgzODM4IDAgMCAuODM4MzggMTYxLjE1IDM0LjE1MikiCiAgICAgICAgICBzb2RpcG9kaTpjeT0iMzQ2LjExMjE4IgogICAgICAgICAgc29kaXBvZGk6Y3g9IjMwMy43NSIKICAgICAgLz4KICAgICAgPHBhdGgKICAgICAgICAgIGlkPSJwYXRoNzI4NCIKICAgICAgICAgIHNvZGlwb2RpOnJ4PSI1My4wMzU3MTMiCiAgICAgICAgICBzb2RpcG9kaTpyeT0iNTMuMDM1NzEzIgogICAgICAgICAgc3R5bGU9ImZpbGw6dXJsKCNsaW5lYXJHcmFkaWVudDg0MTMpIgogICAgICAgICAgc29kaXBvZGk6dHlwZT0iYXJjIgogICAgICAgICAgZD0ibTM1Ni43OSAzNDYuMTFjMCAyOS4yOTEtMjMuNzQ1IDUzLjAzNi01My4wMzYgNTMuMDM2cy01My4wMzYtMjMuNzQ1LTUzLjAzNi01My4wMzYgMjMuNzQ1LTUzLjAzNiA1My4wMzYtNTMuMDM2IDUzLjAzNiAyMy43NDUgNTMuMDM2IDUzLjAzNnoiCiAgICAgICAgICB0cmFuc2Zvcm09Im1hdHJpeCguODA1ODcgMCAwIC44MDU4NyAxNzEuMDMgNDUuNDA1KSIKICAgICAgICAgIHNvZGlwb2RpOmN5PSIzNDYuMTEyMTgiCiAgICAgICAgICBzb2RpcG9kaTpjeD0iMzAzLjc1IgogICAgICAvPgogICAgICA8cGF0aAogICAgICAgICAgaWQ9InBhdGg3Mjg2IgogICAgICAgICAgc29kaXBvZGk6cng9IjUzLjAzNTcxMyIKICAgICAgICAgIHNvZGlwb2RpOnJ5PSI1My4wMzU3MTMiCiAgICAgICAgICBzdHlsZT0iZmlsbDp1cmwoI3JhZGlhbEdyYWRpZW50ODQxNSkiCiAgICAgICAgICBzb2RpcG9kaTp0eXBlPSJhcmMiCiAgICAgICAgICBkPSJtMzU2Ljc5IDM0Ni4xMWMwIDI5LjI5MS0yMy43NDUgNTMuMDM2LTUzLjAzNiA1My4wMzZzLTUzLjAzNi0yMy43NDUtNTMuMDM2LTUzLjAzNiAyMy43NDUtNTMuMDM2IDUzLjAzNi01My4wMzYgNTMuMDM2IDIzLjc0NSA1My4wMzYgNTMuMDM2eiIKICAgICAgICAgIHRyYW5zZm9ybT0ibWF0cml4KC43NTgyNSAwIDAgLjc1ODI1IDE4Ni43NSA2My45MDYpIgogICAgICAgICAgc29kaXBvZGk6Y3k9IjM0Ni4xMTIxOCIKICAgICAgICAgIHNvZGlwb2RpOmN4PSIzMDMuNzUiCiAgICAgIC8+CiAgICAgIDxwYXRoCiAgICAgICAgICBpZD0icGF0aDcyODgiCiAgICAgICAgICBzdHlsZT0ib3BhY2l0eTouMzE3NzE7ZmlsbDp1cmwoI2xpbmVhckdyYWRpZW50MTA0NDkpIgogICAgICAgICAgaW5rc2NhcGU6Y29ubmVjdG9yLWN1cnZhdHVyZT0iMCIKICAgICAgICAgIGQ9Im00MTQuOCAyODQuMTVjLTEzLjMzMSAwLjMwMDY5LTI2LjE4NiA3LjM1OC0zMy4zMzYgMTkuNzQyLTcuNjkwMyAxMy4zMi02LjcxMzkgMjkuMjY2IDEuMTU0NSA0MS4zMzEgMC44NTMwNi0yNi41MzIgMjEuMTMyLTQ2LjUxNSA0Ni4zMjQtNDUuMDU0IDguMjU4OSAwLjQ3OTA3IDE2LjA1NCAzLjIwMDEgMjIuODU5IDcuNTkwOC0zLjI1NzgtNy40NDk4LTguODE3MS0xMy45NTMtMTYuMzk0LTE4LjMyNy02LjQ4NjctMy43NDUxLTEzLjYyNS01LjQzOTMtMjAuNjA4LTUuMjgxOHoiCiAgICAgIC8+CiAgICAgIDxwYXRoCiAgICAgICAgICBpZD0icmVjdDczNzAiCiAgICAgICAgICBkPSJtNDAyLjg4IDMwMC4wOS0xMS41ODEgMTEuNTgxIDEzLjI5NSAxMy4yOTUtMTMuMjk1IDEzLjI4MSAxMS41ODEgMTEuNTgxIDEzLjI4MS0xMy4yOTUgMTMuMjk1IDEzLjI5NSAxMS41ODEtMTEuNTgxLTEzLjI4MS0xMy4yODEgMTMuMjgxLTEzLjI5NS0xMS41ODEtMTEuNTgxLTEzLjI5NSAxMy4yODEtMTMuMjgxLTEzLjI4MXoiCiAgICAgICAgICBzdHlsZT0iZmlsdGVyOnVybCgjZmlsdGVyMTE0MjgpO2ZpbGw6IzFhMWExYSIKICAgICAgICAgIGlua3NjYXBlOmNvbm5lY3Rvci1jdXJ2YXR1cmU9IjAiCiAgICAgIC8+CiAgICAgIDxwYXRoCiAgICAgICAgICBpZD0icGF0aDEwNDU3IgogICAgICAgICAgc3R5bGU9ImZpbGw6I2ZmZmZmZiIKICAgICAgICAgIGlua3NjYXBlOmNvbm5lY3Rvci1jdXJ2YXR1cmU9IjAiCiAgICAgICAgICBkPSJtNDAzLjQ1IDMwMS4xNS0xMS4wODcgMTEuMDg3IDEyLjcyOCAxMi43MjgtMTIuNzI4IDEyLjcxNCAxMS4wODcgMTEuMDg3IDEyLjcxNC0xMi43MjggMTIuNzI4IDEyLjcyOCAxMS4wODctMTEuMDg3LTEyLjcxNC0xMi43MTQgMTIuNzE0LTEyLjcyOC0xMS4wODctMTEuMDg3LTEyLjcyOCAxMi43MTQtMTIuNzE0LTEyLjcxNHoiCiAgICAgIC8+CiAgICA8L2cKICAgID4KICA8L2cKICA+CiAgPG1ldGFkYXRhCiAgICA+CiAgICA8cmRmOlJERgogICAgICA+CiAgICAgIDxjYzpXb3JrCiAgICAgICAgPgogICAgICAgIDxkYzpmb3JtYXQKICAgICAgICAgID5pbWFnZS9zdmcreG1sPC9kYzpmb3JtYXQKICAgICAgICA+CiAgICAgICAgPGRjOnR5cGUKICAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIKICAgICAgICAvPgogICAgICAgIDxjYzpsaWNlbnNlCiAgICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbGljZW5zZXMvcHVibGljZG9tYWluLyIKICAgICAgICAvPgogICAgICAgIDxkYzpwdWJsaXNoZXIKICAgICAgICAgID4KICAgICAgICAgIDxjYzpBZ2VudAogICAgICAgICAgICAgIHJkZjphYm91dD0iaHR0cDovL29wZW5jbGlwYXJ0Lm9yZy8iCiAgICAgICAgICAgID4KICAgICAgICAgICAgPGRjOnRpdGxlCiAgICAgICAgICAgICAgPk9wZW5jbGlwYXJ0PC9kYzp0aXRsZQogICAgICAgICAgICA+CiAgICAgICAgICA8L2NjOkFnZW50CiAgICAgICAgICA+CiAgICAgICAgPC9kYzpwdWJsaXNoZXIKICAgICAgICA+CiAgICAgICAgPGRjOnRpdGxlCiAgICAgICAgICA+ZXJyb3IgYnV0dG9uPC9kYzp0aXRsZQogICAgICAgID4KICAgICAgICA8ZGM6ZGF0ZQogICAgICAgICAgPjIwMTEtMDItMjRUMTc6NDU6NDU8L2RjOmRhdGUKICAgICAgICA+CiAgICAgICAgPGRjOmRlc2NyaXB0aW9uCiAgICAgICAgLz4KICAgICAgICA8ZGM6c291cmNlCiAgICAgICAgICA+aHR0cHM6Ly9vcGVuY2xpcGFydC5vcmcvZGV0YWlsLzEyMjQyNS9lcnJvci1idXR0b24tYnktcmljYXJkb21haWE8L2RjOnNvdXJjZQogICAgICAgID4KICAgICAgICA8ZGM6Y3JlYXRvcgogICAgICAgICAgPgogICAgICAgICAgPGNjOkFnZW50CiAgICAgICAgICAgID4KICAgICAgICAgICAgPGRjOnRpdGxlCiAgICAgICAgICAgICAgPnJpY2FyZG9tYWlhPC9kYzp0aXRsZQogICAgICAgICAgICA+CiAgICAgICAgICA8L2NjOkFnZW50CiAgICAgICAgICA+CiAgICAgICAgPC9kYzpjcmVhdG9yCiAgICAgICAgPgogICAgICAgIDxkYzpzdWJqZWN0CiAgICAgICAgICA+CiAgICAgICAgICA8cmRmOkJhZwogICAgICAgICAgICA+CiAgICAgICAgICAgIDxyZGY6bGkKICAgICAgICAgICAgICA+YnV0dG9uPC9yZGY6bGkKICAgICAgICAgICAgPgogICAgICAgICAgICA8cmRmOmxpCiAgICAgICAgICAgICAgPmNhbmNlbDwvcmRmOmxpCiAgICAgICAgICAgID4KICAgICAgICAgICAgPHJkZjpsaQogICAgICAgICAgICAgID5jaXJjbGU8L3JkZjpsaQogICAgICAgICAgICA+CiAgICAgICAgICAgIDxyZGY6bGkKICAgICAgICAgICAgICA+ZGVsZXRlPC9yZGY6bGkKICAgICAgICAgICAgPgogICAgICAgICAgICA8cmRmOmxpCiAgICAgICAgICAgICAgPnJlZDwvcmRmOmxpCiAgICAgICAgICAgID4KICAgICAgICAgICAgPHJkZjpsaQogICAgICAgICAgICAgID5yb3VuZDwvcmRmOmxpCiAgICAgICAgICAgID4KICAgICAgICAgIDwvcmRmOkJhZwogICAgICAgICAgPgogICAgICAgIDwvZGM6c3ViamVjdAogICAgICAgID4KICAgICAgPC9jYzpXb3JrCiAgICAgID4KICAgICAgPGNjOkxpY2Vuc2UKICAgICAgICAgIHJkZjphYm91dD0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbGljZW5zZXMvcHVibGljZG9tYWluLyIKICAgICAgICA+CiAgICAgICAgPGNjOnBlcm1pdHMKICAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vY3JlYXRpdmVjb21tb25zLm9yZy9ucyNSZXByb2R1Y3Rpb24iCiAgICAgICAgLz4KICAgICAgICA8Y2M6cGVybWl0cwogICAgICAgICAgICByZGY6cmVzb3VyY2U9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zI0Rpc3RyaWJ1dGlvbiIKICAgICAgICAvPgogICAgICAgIDxjYzpwZXJtaXRzCiAgICAgICAgICAgIHJkZjpyZXNvdXJjZT0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjRGVyaXZhdGl2ZVdvcmtzIgogICAgICAgIC8+CiAgICAgIDwvY2M6TGljZW5zZQogICAgICA+CiAgICA8L3JkZjpSREYKICAgID4KICA8L21ldGFkYXRhCiAgPgo8L3N2Zwo+Cg=="

/***/ }),
/* 14 */
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(34);
__webpack_require__(40);
__webpack_require__(45);
__webpack_require__(37);
__webpack_require__(44);
__webpack_require__(42);
__webpack_require__(41);
__webpack_require__(39);
__webpack_require__(33);
__webpack_require__(36);
__webpack_require__(43);
__webpack_require__(38);
__webpack_require__(35);
__webpack_require__(67);
__webpack_require__(83);
__webpack_require__(62);
__webpack_require__(60);
__webpack_require__(82);
__webpack_require__(56);
__webpack_require__(68);
__webpack_require__(85);
__webpack_require__(75);
__webpack_require__(74);
__webpack_require__(73);
__webpack_require__(55);
__webpack_require__(80);
__webpack_require__(66);
__webpack_require__(84);
__webpack_require__(58);
__webpack_require__(78);
__webpack_require__(76);
__webpack_require__(71);
__webpack_require__(69);
__webpack_require__(70);
__webpack_require__(86);
__webpack_require__(54);
__webpack_require__(65);
__webpack_require__(79);
__webpack_require__(61);
__webpack_require__(72);
__webpack_require__(77);
__webpack_require__(63);
__webpack_require__(57);
__webpack_require__(81);
__webpack_require__(64);
__webpack_require__(59);
__webpack_require__(26);
__webpack_require__(29);
__webpack_require__(32);
__webpack_require__(31);
__webpack_require__(28);
__webpack_require__(27);
__webpack_require__(30);
__webpack_require__(47);
__webpack_require__(48);
__webpack_require__(93);
__webpack_require__(94);
__webpack_require__(98);
__webpack_require__(103);
__webpack_require__(101);
__webpack_require__(100);
__webpack_require__(105);
__webpack_require__(97);
__webpack_require__(87);
__webpack_require__(90);
__webpack_require__(95);
__webpack_require__(89);
__webpack_require__(91);
__webpack_require__(106);
__webpack_require__(96);
__webpack_require__(88);
__webpack_require__(99);
__webpack_require__(102);
__webpack_require__(104);
__webpack_require__(92);
__webpack_require__(111);
__webpack_require__(110);
__webpack_require__(112);
__webpack_require__(114);

/***/ }),
/* 15 */
/***/ (function(module, exports, __webpack_require__) {


var path = __webpack_require__(6);
var util = __webpack_require__(2);
var object = __webpack_require__(1);

function isServer() {
  return ! (typeof window != 'undefined' && window.document);
}


if (isServer()) {
  var fs = __webpack_require__(116);
}


function _load_json (value, callback_success, callback_error){

  var output = null;
  var errors = [];

  if (value.constructor == String) {

    var filename, regex_data, init_property;
    regex_data = /^([^#]*)#?(.*)$/.exec(value);

    filename = regex_data[1];
    init_property = regex_data[2];
    utils.getInlineJson(filename, "json", _loadJson_data, function (error) {
      errors.push(error);
      if (callback_error) {
        callback_error(error)
      } else {
        console.error("file: \"" + filename + "\". " + error.message)
      }
    });
  } else {
    _loadJson_data(value);
  }

  function _loadJson_data(data) {
    /*
     замена записей "url(./path/to/file)  на "../../path/to/file"
     url начинающиеся с ./ относительно родителького json файла

     url с "/" добавляется APP_STATIC_PATH
     */
    utils.recoursive(data,
      function (property, value, parent) {
        if (/^url\(.*\)$/.test(value)) {
          var regex_data = /^url\((\.?\/)?(.*)\)$/.exec(value);
          var url = regex_data[2];

          if (regex_data[1] == "/") {
            url = window.APP_STATIC_PATH + url;
          }
          if (regex_data[1] == "./") {
            url = path.getParentDirectoryUrl(filename) + url;
          }

          parent[property] = path.resolve(url);
        }
      }
    );


    var loader = util.queueLoad(1, function finalize() {

      if (init_property) {
        var prop_arr = init_property.split("/");
        for (var i = 0; i < prop_arr.length; i++) {
          data = data[prop_arr[i]];
        }
      }

      if (errors.length) {
        if (callback_error) callback_error(errors);
      } else {
        if (callback_success) callback_success(data);
        output = data;
      }
    });

    /**
     * remove comments
     */
    utils.recoursive(data, function (property, value, parent) {
      /*
       remove comments like
       ["@comment()"]
       "@comment": {}
       */
      if (/^\/\/.*$/.test(value) || /^@comment\(.*\)$/.test(value) || property == "@comment") {
        if (parent.constructor == Array) {
          parent.splice(property, 1);
        } else {
          delete parent[property];
        }
      } else if (/^@extend.*$/.test(property)) {

        loader.total++;
        _load_json(value, function (data) {
          var ext_data = object.deepExtend(data, parent);
          object.deepExtend(parent, ext_data);
          delete parent["@extend"];
          loader();
        }, function (data, error) {
          errors.push(error);
          loader();
        });
      } else if (/^@extend\(.*\)$/.test(value)) {
        var _reg_data = /^@extend\((\.\/)?(.*)\)$/.exec(value);
        var url = _reg_data[2];
        if (_reg_data[1]) {
          url = path.getParentDirectoryUrl(filename) + url;
        }
        loader.total++;
        _load_json(url, function (data) {
          parent[property] = data;
          loader();
        }, function (data, error) {
          errors.push(error);
          loader();
        });
      } else if (/^@mixin\(.*\)$/.test(value)) {
        var _reg_data = /^@mixin\((\.\/)?(.*)\)$/.exec(value);
        var url = _reg_data[2];
        if (_reg_data[1]) {
          url = path.getParentDirectoryUrl(filename) + url;
        }
        loader.total++;
        _load_json(url, function (data) {
          if (parent.constructor == Array) {
            parent.splice(property, 1);
            for (var i in data) {
              parent.push(data[i])
            }
          } else {
            delete parent[property];
            for (var i in data) {
              parent[i] = data[i];
            }
          }
          loader();
        }, function (data, error) {
          errors.push(error);
          loader();
        });
      } else if (/^@load\((.*)\)$/.test(value)) {
        var _reg_data = /^@load\((\.?\/)?(.*)\)$/.exec(value);
        var url = _reg_data[2];
        if (_reg_data[1] == "/") {
          url = window.APP_STATIC_PATH + url;
        }
        if (_reg_data[1] == "./") {
          url = path.getParentDirectoryUrl(filename) + url;
        }

        loader.total++;
        utils.getInlineJson(url, "html", function (data) {
          parent[property] = data;
          loader();
        }, function (data, error) {
          errors.push(error);
          loader();
        });
      }

    });
    loader();

  }

  return output;
}

var utils = {
  CACHED_JSON : {},
  loadJsonSync: function(src){
    var data;
    _load_json(src,function(_data){
      data = _data;
    });
    return data;
  },

  /**
   позволяет использовать конструкции вида
   расширить данные из файла template.json
   "@extend" : "url(data/template.json)",
   "@extend" : "url(data/template.json#settings/stages)",

   //заменить строку наданные из файла
   "stages":       "url(data/template.json#settings/stages)",

   * @param filename
   * @param callback_success
   * @param callback_error
   */
  loadJson: function (value,resolve_cb,fail_cb) {
      return _load_json(value,function(data){
        resolve_cb && resolve_cb(data);
      },function(err){
        fail_cb && fail_cb(err);
      });
  },

  removeComments: function (str) {
    str = str.replace(/^\s*(\/\/.*|(?:\/\*[\s\S]*?)\*\/\s*)$/gm,"");
    return str;
  },
  /**
   *
   * @param object
   * @param criteria - выполнять функцию со всеми объектами
   */
  recoursive: function (object, criteria) {
    var readed = [];
    if (!object) return;
    return (function sub_recoursive(object) {
      if (readed.indexOf(object) != -1) {
        return;
      }
      readed.push(object);


      if (object instanceof Array) {
        for (var prop = object.length; prop--;) {
          if (object[prop] && (object[prop].constructor == Object || object[prop].constructor == Array)) {
            sub_recoursive(object[prop]);
          } else {
            var break_ = criteria(prop, object[prop], object);
          }
        }
      } else {
        for (var prop in object) {
          if (object[prop] && (object[prop].constructor == Object || object[prop].constructor == Array)) {
            sub_recoursive(object[prop]);
          } else {
            var break_ = criteria(prop, object[prop], object);
          }
        }
      }
    })(object);
  },

  parseCSV: function (data) {
    var rows = data.split(/\n/);
    var columns = rows[0].split(',');
    rows.splice(0, 1);

    for (var i = 0; i < rows.length; i++) {
      var output_row_data = {};
      var row_data = [];


      var _quote = false, last = -1;
      var j = -1;
      var str = rows[i];
      while (++j < str.length) {
        if (!_quote) {
          if (str[j] == '\'' || str[j] == '\"') {
            _quote = str[j];
          }
          if (str[j] == ",") {
            var _val = str.substring(last, j);
            if (_val[0] == '\"' && _val[_val.length - 1] == '\"') {
              _val = _val.substring(1, _val.length - 1);
            }
            row_data.push(_val);
            last = j + 1;
          }
        } else {
          if (str[j] == _quote) {
            _quote = false;
          }
        }
      }

      for (var j in row_data) {
        output_row_data[columns[j]] = row_data[j];
      }
      rows[i] = output_row_data;
    }
    return rows;
  },
  parseData: function (data, dataType) {
    var _parsed;
    if (dataType == "csv") {
      _parsed = utils.parseCSV(data);
    } else if (dataType == "json") {
      _parsed = data.trim();
      //if (data[0] != "{" && data[0] != "[") {
      //  return false;
      //}

      _parsed = utils.removeComments(_parsed);
      //data  = data.replace(/\n/g,"")

      try{
        var _parsed = JSON.parse(_parsed);//= JSON.parse(data.replace(/\/\*[\s\S]*?\*\/|\/\/.*/g,""));
      }catch(e){
        return {
          status: "error",
          message: e.toString(),
          data:  data
        };
      }
      //var script = $("<script type='text/json' id='" + url + "'>" + JSON.stringify(data) + "</script>");
    }
    return {
      status: "success",
      data: _parsed
    };
  },
  load: function (url, dataType, callback_success, callback_error) {
    //todo
    if (isServer()) {
      try {
        var data = fs.readFileSync(url, 'utf8');
        data = data.replace(/^\uFEFF/, '');
        var _parsed = utils.parseData(data, dataType);
        if(_parsed.status == "error"){
          callback_error({
            status:   "error",
            message:  _parsed.message,
            data:     _parsed.data
          });
          return;
        }
        callback_success(_parsed.data);
      } catch (e) {

        if (e.code === 'ENOENT') {
          console.log('File not found!');
        } else {
          throw e;
        }
        callback_error(data);
      }
    } else {

      var httpRequest = new XMLHttpRequest();

      httpRequest.onreadystatechange = function () {
        if (httpRequest.readyState === 4) {
          if (httpRequest.status === 200) {
            var data = httpRequest.responseText;
            var _parsed = utils.parseData(data, dataType);
            if(_parsed.status == "error"){
              callback_error({
                status: httpRequest.status,
                message:  _parsed.message,
                response: httpRequest.responseText
              });
              return;
            }
            callback_success(_parsed.data);
          } else {
            callback_error(url, httpRequest)
          }
        }
      };
      httpRequest.open('GET', url);
      httpRequest.send();
    }
  },
  /**
   * Позволяетзагружать json файлы , содержащие ссылки на другие json файлы.
   * вместо ссылок типа
   *  "property" : "url(chunk.json)"
   *  будет загружено содержимое файла
   *  "property" : {...}
   *
   *  если указать якорь
   *  "property" : "url(chunk.json#settings/chunk/0/text)"
   *
   * то будет загружено содержимое поля settings.chunk[0].text из файла chunk.json
   *
   *
   * @param filename  путь к основному json файлу
   * @param callback  будет вызван после окончания загрузки всех файлов
   */
  getInlineJson: function (url, dataType, callback_success, callback_error) {

    if (dataType.constructor != String) {
      callback_error = callback_success;
      callback_success = dataType;
      dataType = "json";
    }


    if (typeof utils.CACHED_JSON !== "undefined" && utils.CACHED_JSON && utils.CACHED_JSON[url]) {
      callback_success(utils.CACHED_JSON[url]);
      return;
    }
    if (typeof $ !== "undefined") {
      if (typeof document !== "undefined") {
        var inline = $("script[id='" + url + "']");
        if (inline.length > 0) {
          var _data =
            inline[0].innerText || //all
            inline[0].textContent || //firefox
            inline[0].text; //ie8
          if (dataType == "json") {

            var _data = utils.removeComments(_data);
            callback_success(JSON.parse(_data));
          } else {
            callback_success(_data);
          }
          return;
        }
      }
    }
    utils.load(url, dataType, callback_success, callback_error);
  }
};

module.exports = utils;


/***/ }),
/* 16 */
/***/ (function(module, exports, __webpack_require__) {

if (typeof _ === 'undefined' && typeof exports !== 'undefined') {
  _ = __webpack_require__(4);
  module.exports = _;
}

module.exports = {

  loadScript: function (requirement, helper, error) {
    var head = document.getElementsByTagName('head')[0];
    var script = document.createElement('script');
    script.type = 'text/javascript';
    script.onerror = error;
    script.onreadystatechange = function () {
      if (this.readyState == 'complete') {
        helper(script, __src);
      }
    };
    script.addEventListener("load", helper, true);
    script.src = requirement;
    head.appendChild(script);
  },
  scriptURL: function () {

    if (document.currentScript) {
      return document.currentScript.src;
    }
    var scripts = document.getElementsByTagName('script');
    for (var i = scripts.length - 1; i--;) {
      if (scripts[i].src) {
        return scripts[i].src;
      }
    }
    return false;
  }
};


/***/ }),
/* 17 */
/***/ (function(module, exports) {

module.exports = function() {
	throw new Error("define cannot be used indirect");
};


/***/ }),
/* 18 */
/***/ (function(module, exports) {

/* WEBPACK VAR INJECTION */(function(__webpack_amd_options__) {/* globals __webpack_amd_options__ */
module.exports = __webpack_amd_options__;

/* WEBPACK VAR INJECTION */}.call(exports, {}))

/***/ }),
/* 19 */
/***/ (function(module, exports) {

module.exports = "PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0ZWQgYnkgSWNvTW9vbi5pbyAtLT4KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4KPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB2ZXJzaW9uPSIxLjEiIHdpZHRoPSIxNnB4IiBoZWlnaHQ9IjE2cHgiIHZpZXdCb3g9IjAgMCAxNiAxNiI+CjxwYXRoIGZpbGw9IiMwMDAwMDAiIGQ9Ik0xNSAxYy0xLjgtMS44LTMuNy0wLjctNC42IDAuMS0wLjQgMC40LTAuNyAwLjktMC43IDEuNXYwYzAgMS4xLTEuMSAxLjgtMi4xIDEuNWwtMC4xLTAuMS0wLjcgMC44IDAuNyAwLjctNiA2LTAuOCAyLjMtMC43IDAuNyAxLjUgMS41IDAuOC0wLjggMi4zLTAuOCA2LTYgMC43IDAuNyAwLjctMC42LTAuMS0wLjJjLTAuMy0xIDAuNC0yLjEgMS41LTIuMXYwYzAuNiAwIDEuMS0wLjIgMS40LTAuNiAwLjktMC45IDItMi44IDAuMi00LjZ6TTMuOSAxMy42bC0yIDAuNy0wLjIgMC4xIDAuMS0wLjIgMC43LTIgNS44LTUuOCAxLjUgMS41LTUuOSA1Ljd6Ii8+Cjwvc3ZnPgo="

/***/ }),
/* 20 */
/***/ (function(module, exports) {

module.exports = "PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMiAyMiI+PGcgdHJhbnNmb3JtPSJtYXRyaXgoLjAzOTY1IDAgMCAuMDM5NjUgMS4xNjMgMS4xNjMpIiBmaWxsPSIjNGQ0ZDRkIj48cGF0aCBkPSJtMjUwLjIgODEuNjFjOTcuNDMgMCAxNzkuNzUgNDMuNDMgMTc5Ljc1IDk0LjgzIDAgMTIuNDQ5LTQuOTM0IDI0LjQ0OS0xMy42NDUgMzUuNDY1bDM1LjQwMiAxMC40MDRjOC42MTMtMTQuMjI3IDEzLjUzMy0yOS42MjkgMTMuNTMzLTQ1Ljg2OSAwLTcyLjk2NS05NC40Ni0xMzAuMTItMjE1LjA0LTEzMC4xMi0xMjAuNTcgMC0yMTUuMDQgNTcuMTYtMjE1LjA0IDEzMC4xMiAwIDI2LjkxOCAxMi45MzYgNTEuNjQzIDM1LjE5IDcyLjE3LTYuOTUxIDQuNTAyLTEzLjc1NiAxMC41MDItMTguODM2IDE4Ljk4NC0xMC40NTMgMTcuNDQ5LTEwLjY2IDM5LjA5LS42NDUgNjQuMzUgOS40MzMgMjMuNzkxIDcuMTI1IDMyLjU4MiA1LjY5MyAzNS4yNC0zLjM1NCA2LjMyMi0xOC4xMyA5LjUxNC0zMi4zODUgMTIuNTk2LTMuNDg2Ljc1OC03LjA0IDEuNTMxLTEwLjU4MiAyLjM3MS05LjQ4NCAyLjI0LTE1LjM1MyAxMS43MjUtMTMuMTMgMjEuMjMgMS45MDIgOC4xMTEgOS4xNjQgMTMuNTk2IDE3LjE2IDEzLjU5NiAxLjM0IDAgMi43MDktLjE2IDQuMDY4LS40NjcgMy4zMi0uNzkxIDYuNjU2LTEuNTE4IDkuOTMyLTIuMjI3IDIxLjExLTQuNTY0IDQ1LjAyLTkuNzQyIDU2LjA4LTMwLjQ4MiA4LjQ4Ni0xNS45MDIgNy4xOTUtMzYuNTE2LTQuMDMtNjQuODUtNS43MjUtMTQuNDM1LTYuMzg1LTI1LjU2NC0xLjk0Ny0zMy4xIDQuOTY1LTguNDUxIDE2LjE0LTEyLjIwNyAyMi4xOS0xMy40NjcgMzUuNzA1IDE5LjkwMiA4Mi44NSAzMi4zNTQgMTM1LjU5IDMzLjg2OWwtMTAuNTA0LTM1Ljc0Yy04Ny44Ny01Ljc1OC0xNTguNTYtNDYuNDUtMTU4LjU2LTk0LjA3LjAwMDEtNTEuNCA4Mi4zMi05NC44MyAxNzkuNzUtOTQuODMiLz48cGF0aCBkPSJtNDg3LjU3IDI2OS42M2wtMjIyLjA1LTY1LjI3Yy0xLjExNS0uMzM4LTIuMjQ0LS40ODItMy4zNzMtLjQ4Mi0zLjExMyAwLTYuMTU4IDEuMjI3LTguNDM0IDMuNS0zLjA5NiAzLjA4LTQuMjU4IDcuNjEzLTMuMDIgMTEuNzg5bDY1LjI3IDIyMi4xYzEuMzQgNC42MTMgNS4zNTIgNy45ODIgMTAuMTQzIDguNS40NTMuMDQ3Ljg5MS4wNjQgMS4zMjIuMDY0IDQuMzA5IDAgOC4zMDctMi4zMzggMTAuNDM5LTYuMTYybDU0LjA4LTk4LjA0IDk4LjAzLTU0LjA5YzQuMjI1LTIuMzIyIDYuNjI5LTYuOTUxIDYuMS0xMS43MjctLjUxNC00Ljc4Ny0zLjg3NC04LjgwNS04LjUwMi0xMC4xNzYiLz48L2c+PC9zdmc+Cg=="

/***/ }),
/* 21 */
/***/ (function(module, exports) {

module.exports = "PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48c3ZnIHdpZHRoPScxODhweCcgaGVpZ2h0PScxODhweCcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2aWV3Qm94PSIwIDAgMTAwIDEwMCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pZFlNaWQiIGNsYXNzPSJ1aWwtc3BpbiI+PHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjEwMCIgaGVpZ2h0PSIxMDAiIGZpbGw9Im5vbmUiIGNsYXNzPSJiayI+PC9yZWN0PjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDUwIDUwKSI+PGcgdHJhbnNmb3JtPSJyb3RhdGUoMCkgdHJhbnNsYXRlKDM0IDApIj48Y2lyY2xlIGN4PSIwIiBjeT0iMCIgcj0iOCIgZmlsbD0iI2NmZmZkZiI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0ib3BhY2l0eSIgZnJvbT0iMSIgdG89IjAuMSIgYmVnaW49IjBzIiBkdXI9IjFzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSI+PC9hbmltYXRlPjxhbmltYXRlVHJhbnNmb3JtIGF0dHJpYnV0ZU5hbWU9InRyYW5zZm9ybSIgdHlwZT0ic2NhbGUiIGZyb209IjEuNSIgdG89IjEiIGJlZ2luPSIwcyIgZHVyPSIxcyIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiPjwvYW5pbWF0ZVRyYW5zZm9ybT48L2NpcmNsZT48L2c+PGcgdHJhbnNmb3JtPSJyb3RhdGUoNDUpIHRyYW5zbGF0ZSgzNCAwKSI+PGNpcmNsZSBjeD0iMCIgY3k9IjAiIHI9IjgiIGZpbGw9IiNjZmZmZGYiPjxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9Im9wYWNpdHkiIGZyb209IjEiIHRvPSIwLjEiIGJlZ2luPSIwLjEycyIgZHVyPSIxcyIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiPjwvYW5pbWF0ZT48YW5pbWF0ZVRyYW5zZm9ybSBhdHRyaWJ1dGVOYW1lPSJ0cmFuc2Zvcm0iIHR5cGU9InNjYWxlIiBmcm9tPSIxLjUiIHRvPSIxIiBiZWdpbj0iMC4xMnMiIGR1cj0iMXMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIj48L2FuaW1hdGVUcmFuc2Zvcm0+PC9jaXJjbGU+PC9nPjxnIHRyYW5zZm9ybT0icm90YXRlKDkwKSB0cmFuc2xhdGUoMzQgMCkiPjxjaXJjbGUgY3g9IjAiIGN5PSIwIiByPSI4IiBmaWxsPSIjY2ZmZmRmIj48YW5pbWF0ZSBhdHRyaWJ1dGVOYW1lPSJvcGFjaXR5IiBmcm9tPSIxIiB0bz0iMC4xIiBiZWdpbj0iMC4yNXMiIGR1cj0iMXMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIj48L2FuaW1hdGU+PGFuaW1hdGVUcmFuc2Zvcm0gYXR0cmlidXRlTmFtZT0idHJhbnNmb3JtIiB0eXBlPSJzY2FsZSIgZnJvbT0iMS41IiB0bz0iMSIgYmVnaW49IjAuMjVzIiBkdXI9IjFzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSI+PC9hbmltYXRlVHJhbnNmb3JtPjwvY2lyY2xlPjwvZz48ZyB0cmFuc2Zvcm09InJvdGF0ZSgxMzUpIHRyYW5zbGF0ZSgzNCAwKSI+PGNpcmNsZSBjeD0iMCIgY3k9IjAiIHI9IjgiIGZpbGw9IiNjZmZmZGYiPjxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9Im9wYWNpdHkiIGZyb209IjEiIHRvPSIwLjEiIGJlZ2luPSIwLjM3cyIgZHVyPSIxcyIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiPjwvYW5pbWF0ZT48YW5pbWF0ZVRyYW5zZm9ybSBhdHRyaWJ1dGVOYW1lPSJ0cmFuc2Zvcm0iIHR5cGU9InNjYWxlIiBmcm9tPSIxLjUiIHRvPSIxIiBiZWdpbj0iMC4zN3MiIGR1cj0iMXMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIj48L2FuaW1hdGVUcmFuc2Zvcm0+PC9jaXJjbGU+PC9nPjxnIHRyYW5zZm9ybT0icm90YXRlKDE4MCkgdHJhbnNsYXRlKDM0IDApIj48Y2lyY2xlIGN4PSIwIiBjeT0iMCIgcj0iOCIgZmlsbD0iI2NmZmZkZiI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0ib3BhY2l0eSIgZnJvbT0iMSIgdG89IjAuMSIgYmVnaW49IjAuNXMiIGR1cj0iMXMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIj48L2FuaW1hdGU+PGFuaW1hdGVUcmFuc2Zvcm0gYXR0cmlidXRlTmFtZT0idHJhbnNmb3JtIiB0eXBlPSJzY2FsZSIgZnJvbT0iMS41IiB0bz0iMSIgYmVnaW49IjAuNXMiIGR1cj0iMXMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIj48L2FuaW1hdGVUcmFuc2Zvcm0+PC9jaXJjbGU+PC9nPjxnIHRyYW5zZm9ybT0icm90YXRlKDIyNSkgdHJhbnNsYXRlKDM0IDApIj48Y2lyY2xlIGN4PSIwIiBjeT0iMCIgcj0iOCIgZmlsbD0iI2NmZmZkZiI+PGFuaW1hdGUgYXR0cmlidXRlTmFtZT0ib3BhY2l0eSIgZnJvbT0iMSIgdG89IjAuMSIgYmVnaW49IjAuNjJzIiBkdXI9IjFzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSI+PC9hbmltYXRlPjxhbmltYXRlVHJhbnNmb3JtIGF0dHJpYnV0ZU5hbWU9InRyYW5zZm9ybSIgdHlwZT0ic2NhbGUiIGZyb209IjEuNSIgdG89IjEiIGJlZ2luPSIwLjYycyIgZHVyPSIxcyIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiPjwvYW5pbWF0ZVRyYW5zZm9ybT48L2NpcmNsZT48L2c+PGcgdHJhbnNmb3JtPSJyb3RhdGUoMjcwKSB0cmFuc2xhdGUoMzQgMCkiPjxjaXJjbGUgY3g9IjAiIGN5PSIwIiByPSI4IiBmaWxsPSIjY2ZmZmRmIj48YW5pbWF0ZSBhdHRyaWJ1dGVOYW1lPSJvcGFjaXR5IiBmcm9tPSIxIiB0bz0iMC4xIiBiZWdpbj0iMC43NXMiIGR1cj0iMXMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIj48L2FuaW1hdGU+PGFuaW1hdGVUcmFuc2Zvcm0gYXR0cmlidXRlTmFtZT0idHJhbnNmb3JtIiB0eXBlPSJzY2FsZSIgZnJvbT0iMS41IiB0bz0iMSIgYmVnaW49IjAuNzVzIiBkdXI9IjFzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSI+PC9hbmltYXRlVHJhbnNmb3JtPjwvY2lyY2xlPjwvZz48ZyB0cmFuc2Zvcm09InJvdGF0ZSgzMTUpIHRyYW5zbGF0ZSgzNCAwKSI+PGNpcmNsZSBjeD0iMCIgY3k9IjAiIHI9IjgiIGZpbGw9IiNjZmZmZGYiPjxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9Im9wYWNpdHkiIGZyb209IjEiIHRvPSIwLjEiIGJlZ2luPSIwLjg3cyIgZHVyPSIxcyIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiPjwvYW5pbWF0ZT48YW5pbWF0ZVRyYW5zZm9ybSBhdHRyaWJ1dGVOYW1lPSJ0cmFuc2Zvcm0iIHR5cGU9InNjYWxlIiBmcm9tPSIxLjUiIHRvPSIxIiBiZWdpbj0iMC44N3MiIGR1cj0iMXMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIj48L2FuaW1hdGVUcmFuc2Zvcm0+PC9jaXJjbGU+PC9nPjwvZz48L3N2Zz4="

/***/ }),
/* 22 */
/***/ (function(module, exports) {

module.exports = "PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNMjEuMTQzIDkuNjY3Yy0uNzMzLTEuMzkyLTEuOTE0LTMuMDUtMy42MTctNC43NTMtMi45NzctMi45NzgtNS40NzgtMy45MTQtNi43ODUtMy45MTQtLjQxNCAwLS43MDguMDk0LS44Ni4yNDZsLTEuMzYxIDEuMzZjLTEuODk5LS4yMzYtMy40Mi4xMDYtNC4yOTQuOTgzLS44NzYuODc1LTEuMTY0IDIuMTU5LS43OTIgMy41MjMuNDkyIDEuODA2IDIuMzA1IDQuMDQ5IDUuOTA1IDUuMzc1LjAzOC4zMjMuMTU3LjYzOC40MDUuODg1LjU4OC41ODggMS41MzUuNTg2IDIuMTIxIDBzLjU4OC0xLjUzMy4wMDItMi4xMTljLS41ODgtLjU4Ny0xLjUzNy0uNTg4LTIuMTIzLS4wMDFsLS4xNy4yNTZjLTIuMDMxLS43NjUtMy4zOTUtMS44MjgtNC4yMzItMi45bDMuODc5LTMuODc1Yy40OTYgMi43MyA2LjQzMiA4LjY3NiA5LjE3OCA5LjE3OGwtNy4xMTUgNy4xMDdjLS4yMzQuMTUzLTIuNzk4LS4zMTYtNi4xNTYtMy42NzUtMy4zOTMtMy4zOTMtMy4xNzUtNS4yNzEtMy4wMjctNS40OThsMS44NTktMS44NTZjLS40MzktLjM1OS0uOTI1LTEuMTAzLTEuMTQxLTEuNjg5bC0yLjEzNCAyLjEzMWMtLjQ0NS40NDYtLjY4NSAxLjA2NC0uNjg1IDEuODIgMCAxLjYzNCAxLjEyMSAzLjkxNSAzLjcxMyA2LjUwNiAyLjc2NCAyLjc2NCA1LjU4IDQuMjQzIDcuNDMyIDQuMjQzLjY0OCAwIDEuMTgtLjE5NSAxLjU0Ny0uNTYybDguMDg2LTguMDc4Yy45MS44NzQtLjc3OCAzLjUzOC0uNzc4IDQuNjQ4IDAgMS4xMDQuODk2IDEuOTk5IDIgMS45OTkgMS4xMDUgMCAyLS44OTYgMi0yIDAtMy4xODQtMS40MjUtNi44MS0yLjg1Ny05LjM0em0tMTYuMjA5LTUuMzcxYy41MjctLjUzIDEuNDcxLS43OTEgMi42NTYtLjc2MWwtMy4yMDkgMy4yMDZjLS4yMzYtLjk3OC0uMDQ5LTEuODQ1LjU1My0yLjQ0NXptOS4yOTIgNC4wNzlsLS4wMy0uMDI5Yy0xLjI5Mi0xLjI5Mi0zLjgwMy00LjM1Ni0zLjA5Ni01LjA2My43MTUtLjcxNSAzLjQ4OCAxLjUyMSA1LjA2MiAzLjA5Ni44NjIuODYyIDIuMDg4IDIuMjQ3IDIuOTM3IDMuNDU4LTEuNzE3LTEuMDc0LTMuNDkxLTEuNDY5LTQuODczLTEuNDYyeiIvPjwvc3ZnPg=="

/***/ }),
/* 23 */
/***/ (function(module, exports) {

module.exports = "iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAANlAAADZQBELD/fAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAXPSURBVHic5dt/yF5lGQfwz7U555aatpEopk6yLba16IegDCk0C0kD2woJDZr9IbUg0zYi+yMSQvtFhhG1aOI/Of/QLLEgcggzzcpBc1CT2oqsXNhqsznbrv647xffPXuf7Xmec57z7p1fuDmcc+4f1/W9r3Of+1zXdSIzvRoQEfPxucz8/GHXXw0ERMRC/ARzM/Otk+/Nmh6RukNEXIgtuHiq+yc0ARHxNkX5i/rVOWEJiIgrsRln4Yl+9U5IAiLievwYp+Jb+Fi/uiccARGxDhsxR1n11+JQv/ondSXYuBERs/ANrMX/cGNmbjxWuxOCgIiYi3uxCvuwKjMfGaTtjCcgIs7Ag7gMz+OqzHxq0PYzmoCIOBePYCmexfsyc8cwfRyxCEbE4oh4bTsijg8RsRSPK8r/GpcOqzxTW8DVuDMi/oxt+F0t2/BMZr44stQtISIuU8z+DPxUeeb3jtRZZh5WcBr+hZyiHMQOPIDbcR2W4+TefsZVlIVuf5XnHswZoM2SWv/pI+71afDl2uAp3IwNym7qP32IeRnP4D58AR/EYsxuWfm1dRKyyhgDthuagLPxEg7g3EnXA4vwfqxXXj2/nTQjvWU/nq711td2iwYVvGfciUk5iLVDth+OgNpoQ230lQEGmF1n/NpqAfcpa8bLfYjZWy3q+9XCrsQ5ffqeU019gtDVI1hOXwL6+gMi4s1Vib14Q2bumbLiURARJ1dilmJZLUtxoam34S94ZeHdpjxW6ypBe/CBzNw8ghxLsB1bs8cfcCzmfqQwt77lZ3ke3o4bcAcexk5TW0viL1jeYLzhLaAytxKP4TlckJkHhmV/GETE6YqFTLaYebguM3c16Hc0C6jkPK6wt6ZNK+iyOIoFDPI5fEc93hIRMeosHK8YhIAH8XuFxavHK073OCYBmXkIX62nt45XnO4xqEfoHvwdKyPikjHK0zkGIiAz9+OuevrZ8YnTPYbxCd6tbIquiYg3jUmezjEwAZn5Ar5X29wyNok6xrBe4a8rDscbIuKsMcjTOYYioO7Gfoi5+NRYJOoYo8QF7qzHmyLi1DaFmQ4MTUBmbsXPcCZubF2ijjFqZGhie/zpiJjRnuWRCMjMn+M3OA8fblWijtEkNjixFszo7XETAjbhT1hRQ9EzEiMTkJkH8bV6OmO3x03D4xvwT1xeszFmHBoRkCVKdHc9nZFrQRsJEnfhv1gdERe00F+naExAZj6PHyixgZub9jcmLOp7pyWn4xuViM0+LDgOnKBzcAW+iT96xb0+eGRohEE31UFumyalX4ePKB9rexweV/iD4ta7dJwEXFwH+wfmdaT0RfgMHlU+0ydHsR9TXs9LjtpHywI9WgW4aUwKz8ZK5Vtke88s/xv3K9GmhQP32bKAV00yuVkt9XmakhOwEbt7lN6p5AG+14g5Cm0TEEpgM5WsjVH7OQ+fUPJ/Xpqk8CE8iduwohWZ2ySgCv/RKuwTQxL3TnxRySeYPMsv4iF8HGe3Lm+Lii/GGsVxOiH87VjWp/48JWHiO/hrj9LP4bu4BvPbVrpVAqri91fz7Bfe/iXeoiQur1HCbft66mzFl+rbZKgMkial0Q8TNT6wBQuUbJBf4RdKbtFyvBuX4BTl1TSrmjsl/WazkoPwUGbuHFmQJmg4+xML3r14TZ86c5Uc3omZ3oTVOL2rWR7LI6DsrxO7DGCySk5Q4orpVnpyafIxNBEY2ZWDPUfP1uOZDcZsHw0s4CQlofKgY8wq3qHEFQ/h/Ome9VYegarYJxWzPqCkvF2v5hXi9fgQvl2VHyjlbkYRUBW91ZGJkn8z9WvxXdOtcG9p5b/BiDhHcYa8R/ENzFd8hU8qi9/Cai3bMnNZ4wFbROs/TtZEqgWZubvn2g4lQfL8bJDy1jZa/2kqC3b3XlN2g7Ci7TGbYDr+GjtlGsbsi04IqP/1XF5Pt3cx5qDoygLWKRunLUoS9HGDrgjYo4TRVmXbq25D/B9PLfo3EMEZiwAAAABJRU5ErkJggg=="

/***/ }),
/* 24 */
/***/ (function(module, exports) {

module.exports = "iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAEZ0FNQQAAsY58+1GTAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAN2SURBVHjaVJJPaBxVAMZf8NBWBYV6V1ragyAIKQoWJIogevGgtYp6KhIkJgubLNnZeTPzdubtmzebHZKdhCSdhcmf3fyBSNhLEtCQzC1uSJYe0vxZkuxmd00aPFjTHsSqnwdtrYfv9n0/foePSClbstnsdU3TjuLx+INsNnvmuu6Z67pnnPMz27YfUErnHcchkUiEcM6JbdtE0zQCgBAp5Quc80tdXV0jvu+jVquh2Wyi0Wig2WwiDENwzmeklKS9vf0q5/w1KeV/ANu2XxRCtHHOv/M8D3t7ezg9PUWj0UClUsHw8PBDz/M+1nX9KqX0MJVK3WeMva7r+hMDYhjGzWQy+ev6+jo2Nzexu7uLk5MTlMtlKIqymU6nLzHGlhcXF7G0tARK6feapp0DQEgmk7lIKZ2YmZlBrVZDX18ffN9HtVpFsVj8gzF2O51OtzqOsz43N4ejoyP4vo94PN722OC9sbGxh5VKBfPz8+ju7l5KJBI/raysQFGUnxljbzDG3lRVtVdRlIO1tTWEYYjBwcE5AIRQSm8FQYDj42Pk83n09PR4iqI4HR0dj4QQZcdxnrMs6xql9GZnZ2e4urqK7e1tTExMVAAQEo/HY7lcDvV6HYVCAZRSqarqF7quL9u2/bWUssW27ZcYY23RaHQ1DEPs7OwgCIJ/ALquJ8bHx3+v1WqYnp5GIpFQTdN8i3P+gZTyopSSSCmJZVnXI5HIZhiGKJVKyOVyPwIghDH2Ded8a3l5GeVyGUNDQ/eklF8KIc49HqfT6RbTNPt93/9rf38fk5OToJR+C4AQwzA+jMVitz3Pe3R4eIhisQjP8+4xxj63LKtNVdV3DcPQ+vv7USqVcOfOHbiu+4sQ4goAQpLJ5NuWZfVwzkujo6OoVqvY2NhAEASYnZ1FLpdDEASoVqvY2tqCEAIDAwOG67oXABAihLhMKf2Ec55MpVIbAwMDCMMQjUYDjUYD9XodBwcHWFhYgOM4v3HOJ4UQr0gpnzzxvGVZ11RV/Ypz3huNRseTyeTdqampPwuFAvL5PEZGRu5HIpEfDMNIZTKZV6WUzzwNILZtP29ZVqumaZ9RSm8ZhmFQSodisZjf29ubU1VVUkpvcM6vSCmfdRyH/A/wb84LIS6bpvmOrusfaZr2qa7rNwzDeN80zVbbtl+WUl54qk8AkL8HAJl1ZCYr0CyqAAAAAElFTkSuQmCC"

/***/ }),
/* 25 */
/***/ (function(module, exports) {

module.exports = "PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTYuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4PSIwcHgiIHk9IjBweCIgd2lkdGg9IjE2cHgiIGhlaWdodD0iMTZweCIgdmlld0JveD0iMCAwIDM5NiAzOTYiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDM5NiAzOTY7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4KPGc+Cgk8Zz4KCQk8cGF0aCBkPSJNMzg2LDE4Mi42NjVoLTExLjE5OWMtNy4zNTUtODUuMzk3LTc2LjA2Ny0xNTQuMTA4LTE2MS40NjctMTYxLjQ2NlYxMGMwLTUuNTIyLTQuNDc5LTEwLTEwLTEwaC0xMC42NjkgICAgYy01LjUyMiwwLTEwLDQuNDc4LTEwLDEwdjExLjE5OUM5Ny4yNjgsMjguNTU2LDI4LjU1Nyw5Ny4yNjgsMjEuMTk5LDE4Mi42NjVIMTBjLTUuNTIyLDAtMTAsNC40NzgtMTAsMTB2MTAuNjcgICAgYzAsNS41MjIsNC40NzgsMTAsMTAsMTBoMTEuMTk5YzcuMzU3LDg1LjM5Niw3Ni4wNjgsMTU0LjEwOCwxNjEuNDY2LDE2MS40NjZWMzg2YzAsNS41MjEsNC40NzgsMTAsMTAsMTBoMTAuNjY5ICAgIGM1LjUyMSwwLDEwLTQuNDc5LDEwLTEwdi0xMS4xOTljODUuMzk3LTcuMzU1LDE1NC4xMDktNzYuMDY3LDE2MS40NjctMTYxLjQ2NkgzODZjNS41MjIsMCwxMC00LjQ3OCwxMC0xMHYtMTAuNjcgICAgQzM5NiwxODcuMTQzLDM5MS41MjIsMTgyLjY2NSwzODYsMTgyLjY2NXogTTIxMy4zMzQsMzQzLjk5MnYtNDAuMDY0YzQ3LjEwNC02Ljc2MSw4My44MzItNDMuNDg3LDkwLjU5NC05MC41OTNoNDAuMDY0ICAgIGMtMy40ODEsMzMuMjg1LTE4LjQwNyw2NC41NzItNDIuMjQ3LDg4LjQxMUMyNzcuOTA1LDMyNS41ODYsMjQ2LjYxOCwzNDAuNTEyLDIxMy4zMzQsMzQzLjk5MnogTTE4Mi42NjUsMzQzLjk5MiAgICBjLTMzLjI4NS0zLjQ4MS02NC41NzItMTguNDA3LTg4LjQxMS00Mi4yNDZzLTM4Ljc2NS01NS4xMjYtNDIuMjQ2LTg4LjQxMWg0MC4wNjRjNi43NjEsNDcuMTAzLDQzLjQ5LDgzLjgzMiw5MC41OTMsOTAuNTkzICAgIFYzNDMuOTkyTDE4Mi42NjUsMzQzLjk5MnogTTE4Mi42NjUsNTIuMDA4djQwLjA2NGMtNDcuMTAzLDYuNzYxLTgzLjgzMiw0My40OS05MC41OTMsOTAuNTkzSDUyLjAwOCAgICBjMy40ODEtMzMuMjg1LDE4LjQwNy02NC41NzIsNDIuMjQ2LTg4LjQxMVMxNDkuMzgsNTUuNDg5LDE4Mi42NjUsNTIuMDA4eiBNMTI0LjEwOCwxOThjMC00MC43NDQsMzMuMTQ3LTczLjg5Miw3My44OTItNzMuODkyICAgIHM3My44OTIsMzMuMTQ3LDczLjg5Miw3My44OTJTMjM4Ljc0NCwyNzEuODkzLDE5OCwyNzEuODkzUzEyNC4xMDgsMjM4Ljc0NCwxMjQuMTA4LDE5OHogTTIxMy4zMzQsNTIuMDA4ICAgIGMzMy4yODQsMy40OCw2NC41NzEsMTguNDA2LDg4LjQxMSw0Mi4yNDZjMjMuODQsMjMuODM5LDM4Ljc2Niw1NS4xMjYsNDIuMjQ3LDg4LjQxMWgtNDAuMDY0ICAgIGMtNi43NjItNDcuMTAzLTQzLjQ4OC04My44MzItOTAuNTk0LTkwLjU5M1Y1Mi4wMDhMMjEzLjMzNCw1Mi4wMDh6IiBmaWxsPSIjMDAwMDAwIi8+Cgk8L2c+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPC9zdmc+Cg=="

/***/ }),
/* 26 */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(fabric) {fabric.util.object.extend(fabric.BaseBrush.prototype, {
  useDrawingColor: true,
  setOptions: function (options) {
    for (var prop in options) {
      this[prop] = options[prop];
    }
  },
  type: "base-brush",
  initialize: function (canvas, options) {
    this.canvas = canvas;
    options = options || {};
    this.canvas.application.fire("entity:created", {target: this, options: options})
    this.setOptions(options);
  },
  convertColor: function (color, type) {
    type = type || "name";
    if (color instanceof Array) {
      if (type == "source") {
        return color;
      }
      color = "#" + fabric.Color.fromSource(color).toHex();
    }
    if (type == "hex" || type == "source") {
      if (fabric.Color.colorNameMap[color]) {
        color = fabric.Color.colorNameMap[color];
      }
      if (type == "source") {
        if (color == "transparent") {
          return [0, 0, 0, 0];
        }
        var _source = fabric.Color.fromHex(color).getSource()
        _source[3] *= 255;
        return _source;
      }
    }
    return color;
  },
  getColor: function (type) {
    var color = this.useDrawingColor && this.canvas.drawingColor || this.color;
    return this.convertColor(color, type);
  }
});

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 27 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {


fabric.MagicWand = __webpack_require__(108);

  /**
   * PencilBrush class
   * @class fabric.PencilBrush
   * @extends fabric.BaseBrush
   */
  fabric.PaintBucketBrush = fabric.util.createClass(fabric.BaseBrush, /** @lends fabric.PencilBrush.prototype */ {
    type: 'paint-bucket-brush',
    /**
     * Constructor
     * @param {fabric.Canvas} canvas
     * @return {fabric.PencilBrush} Instance of a pencil brush
     */
    initialize: function(canvas) {
      this.callSuper('initialize', canvas);
      this._points = [];
    },
    getTarget: function(){
      return this.canvas.drawingContext;
    },
    onMouseUp: function() {},
    onMouseMove: function() {},
    onMouseDown: function(pointer) {
      this._fill(pointer);
    },
    _fill: function(pointer){
      pointer = {
        x: Math.floor(pointer.x),
        y: Math.floor(pointer.y)
      };

      var info = this.getTarget().getImageData(0,0,this.getTarget().canvas.width,this.getTarget().canvas.height);

      fabric.MagicWand.floodFill(info, pointer.x , pointer.y, 1,{},null,function(mask){
        var _color = this.getColor('source');
        var _target = this.getTarget();
        var _w = mask.bounds.maxX - mask.bounds.minX + 1, _h = mask.bounds.maxY - mask.bounds.minY + 1;
        var oldImageData = _target.getImageData( mask.bounds.minX,mask.bounds.minY,_w, _h);

        mask.render(_target,{
          intersectionColor : _color,
          fill : _color,
          cache: false,
          left : mask.bounds.minX,
          top : mask.bounds.minY
        });

        this.canvas.fire("draw:after",{
          target: this.getTarget() ,
          redo: _target.getImageData( mask.bounds.minX,mask.bounds.minY,_w, _h),
          undo: oldImageData ,
          left : mask.bounds.minX,
          top : mask.bounds.minY,
          color: this.getColor().slice()
        });

        this.canvas.renderAll();
      }.bind(this));
    },
    getHistoryRecord: function(event) {

      return {
        canvas:   this.canvas,
        object:   event.target ,
        type:     "draw:bucket",
        left:     event.left ,
        top:      event.top ,
        undoData: event.undo,
        redoData: event.redo,
        color:    this.convertColor(event.color,"source"  ),
        undo: function(_action){
          _action.object.putImageData(_action.undoData, _action.left,_action.top);
          _action.canvas.renderAll();
        },
        redo: function(_action){
          _action.object.putImageData(_action.redoData, _action.left,_action.top);
          _action.canvas.renderAll();
        }
      }
    }
  });

fabric.SlideCanvas.prototype.drawingTools.PaintBucketBrush = {
  icon:  'data:image/svg+xml;base64,' + __webpack_require__(22),
  title: 'Bucket Brush'
};
fabric.SlideCanvas.prototype.activeDrawingTools.push("PaintBucketBrush");

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 28 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {


  /**
   * PencilBrush class
   * @class fabric.PencilBrush
   * @extends fabric.BaseBrush
   */
  fabric.PaintPenBrush = fabric.util.createClass(fabric.BaseBrush, /** @lends fabric.PencilBrush.prototype */ {
    type: 'paint-pen-brush',

    /**
     * Constructor
     * @param {fabric.Canvas} canvas
     * @return {fabric.PencilBrush} Instance of a pencil brush
     */
    initialize: function(canvas) {
      this.callSuper('initialize', canvas);
      this._points = [];
    },
    getTarget: function(){
      return this.canvas.drawingContext;
    },
    /**
     * Inovoked on mouse down
     * @param {Object} pointer
     */
    onMouseDown: function(pointer) {
      this._reset();
      this._fill(pointer);
    },

    /**
     * Inovoked on mouse move
     * @param {Object} pointer
     */
    onMouseMove: function(pointer) {
      this._fill(pointer);
    },
    /**
     * Invoked on mouse up
     */
    onMouseUp: function() {
      this.canvas.fire("draw:after",{
        target: this.getTarget() ,
        points: this._points.slice() ,
        color: this.getColor('source')
      });
    },
    _fill: function(pointer){
      pointer = {
        x: Math.floor(pointer.x),
        y: Math.floor(pointer.y)
      };

      if(_.findWhere(this._points,pointer)){
        return;
      }

      // this.getTarget().fillRect(pointer.x , pointer.y  ,1,1);
      var _data = this.getTarget().getImageData(pointer.x , pointer.y  ,1,1);
      pointer.color = Array.prototype.slice.call(_data.data);
      this._points.push(pointer);
      var _color = this.getColor('source');




      _data.data[0] = _color[0];
      _data.data[1] = _color[1];
      _data.data[2] = _color[2];
      _data.data[3] = _color[3];

      this.getTarget().putImageData(_data, pointer.x , pointer.y);
      this.canvas.renderAll();
    },
    undoPaintAction: function(_action){
      var ctx = _action.object;
      for(var i in _action.points){
        var _p  =_action.points[i], _c = _action.brush.getActionColor(_p.color);
        if(_c[3] == 0) {
          ctx.clearRect(_p.x,_p.y  ,1,1);
        }else{
          ctx.fillStyle = "rgba(" + _c[0] + "," + _c[1] + "," + _c[2] + "," + _c[3] +  ")";
          ctx.fillRect(_p.x,_p.y  ,1,1);
        }
      }
      _action.canvas.renderAll();
    },
    redoPaintAction: function(_action){

      var ctx = _action.object, _c = _action.brush.getActionColor(_action.color);
      var pts = _action.points;
      if(_c[3] == 0) {
        for(var i in pts){
          ctx.clearRect(pts[i].x,pts[i].y  ,1,1);
        }
      }else{
        ctx.fillStyle = "rgba(" + _c[0] + "," + _c[1] + "," + _c[2] + "," + _c[3] + ")";
        for(var i in pts){
          ctx.fillRect(pts[i].x,pts[i].y ,1,1);
        }
      }
      _action.canvas.renderAll();
    },
    /**
     * Clear points array and set contextTop canvas style.
     * @private
     */
    _reset: function() {
      this._points.length = 0;
      this.getTarget().fillStyle = this.color;
    },
    getHistoryRecord: function(event){

      return {
        canvas:   this.canvas,
        type:     "draw:pen",
        object:   event.target ,
        points:   event.points ,
        brush:   this,
        color:    event.color,
        undo:     this.undoPaintAction,
        redo:     this.redoPaintAction
      }
    }
  });

fabric.SlideCanvas.prototype.drawingTools.PaintPenBrush = {
  className: 'fa fa-paint-brush',
  title: 'Pen Brush'
};
fabric.SlideCanvas.prototype.activeDrawingTools.push("PaintPenBrush");

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 29 */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.PencilBrush.prototype.initialize = function(canvas) {
  this.callSuper('initialize', canvas);
  this._points = [ ];
};
fabric.PencilBrush.prototype.type = 'pencil-brush';

fabric.PencilBrush.prototype._render = function() {
  var ctx  = this.canvas.contextTop, v = this.canvas.viewportTransform, p1 = this._points[0], p2 = this._points[1];
  ctx.save();
  ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);
  ctx.beginPath();
  ctx.lineWidth = 1 / this.canvas.viewportTransform[0];
  if (this._points.length === 2 && p1.x === p2.x && p1.y === p2.y) {
    p1.x -= 0.5 / this.canvas.viewportTransform[0];
    p2.x += 0.5 / this.canvas.viewportTransform[0];
  }
  ctx.moveTo(p1.x, p1.y);
  for (var i = 1, len = this._points.length; i < len; i++) {
    var midPoint = p1.midPointFrom(p2);
    ctx.quadraticCurveTo(p1.x, p1.y, midPoint.x, midPoint.y);
    p1 = this._points[i];
    p2 = this._points[i + 1];
  }
  ctx.lineTo(p1.x, p1.y);
  ctx.stroke();
  ctx.restore();
};

fabric.PencilBrush.prototype.createPath = function(pathData) {
  var path = new fabric.Path(pathData, {
    stroke: this.getColor(),
    strokeWidth: this.width,
    application: this.canvas.application
  });
  if (this.shadow) {
    this.shadow.affectStroke = true;
    path.setShadow(this.shadow);
  }
  return path;
};
fabric.PencilBrush.prototype.minLength = 3;

fabric.PencilBrush.prototype.accuracy = 0;
fabric.PencilBrush.prototype._finalizeAndAddPath = function() {
  if(this._points.length < 2)return;
  var ctx = this.canvas.contextTop;
  ctx.closePath();
  this.canvas.clearContext(this.canvas.contextTop);
  if(this.accuracy){
    for(var i in this._points){
      this._points[i].x = +this._points[i].x.toFixed(this.accuracy);
      this._points[i].y = +this._points[i].y.toFixed(this.accuracy);
    }
    for(i = this._points.length - 1; i--; ){
      if(this._points[i].x == this._points[i + 1].x &&  this._points[i].y == this._points[i + 1].y){
        this._points.splice(i,1);
      }
    }
  }
  if(this._points.length < 2)return;
  var pathData = this.convertPointsToSVGPath(this._points).join('');
  if (this._points.length < this.minLength || pathData === 'M 0 0 Q 0 0 0 0 L 0 0') {
    return this.canvas.renderAll();
  }
  var path = this.createPath(pathData);
  this.canvas.add(path);
  path.setCoords();
  this._resetShadow();
  this.canvas.renderAll();
  this.canvas.fire('path:created', { path: path });
};


fabric.SlideCanvas.prototype.drawingTools.PencilBrush = {
  className: 'fa fa-pencil',
  title: 'Pencil Brush'
};
fabric.SlideCanvas.prototype.activeDrawingTools.push("PencilBrush");

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 30 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.PointsBrush = fabric.util.createClass(fabric.BaseBrush, {
  type: "points-brush",
  maximumPoints : 0,
  initialize: function (canvas) {
    this.callSuper('initialize', canvas);
    this.reset();
  },
  currentPoint : 1,
  getPoints: function(){
    return fabric.util.object.where(this.canvas._objects,{type: "material-point"});
  },
  checkPosition: null,
  onMouseDown: function (pointer) {

  },
  onMouseMove: function (pointer) {
  },
  reset: function(){
  },
  onMouseUp: function (pointer) {
    var _points = this.getPoints();

    var pos = {
      left: pointer.x -0.5,
      top: pointer.y  -0.5,
    };

    var _correct = this.checkPosition ? this.checkPosition(pointer) : true ;

    if(!_correct){
      this.canvas.fire("point:rejected",{point : pointer});
      return;
    }

    if(this.maximumPoints && _points.length >= this.maximumPoints){
      if(this.currentPoint > this.maximumPoints){
        this.currentPoint = 1;
      }
      if(this.wholeCoordinates){
        pointer.x = Math.round(pointer.x) + 0.5;
        pointer.y = Math.round(pointer.y)  + 0.5;
      }

      var _obj = fabric.util.object.findWhere(_points,{number : this.currentPoint++});

      var states = {
        original : {
          left: _obj.left,
          top: _obj.top
        },
        modified:  {
          left: pointer.x - 0.5,
          top: pointer.y - 0.5
        }
      };

      _obj.set(states.modified).setCoords().fire("modified",{states: states});
      this.canvas.fire("object:modified",{target : _obj, states: states});
      this.canvas.setActiveObject(_obj);
      this.canvas.renderAll();
      return;
    }else{
      this.currentPoint = 1;
      while(fabric.util.object.findWhere(_points,{number : this.currentPoint})){
        this.currentPoint++;
      }
    }

    var _obj = new fabric.MaterialPoint({
      number: this.currentPoint ,
      application: this.canvas.application,
      left: pos.left,
      top: pos.top
    });

    this.currentPoint++;
    this.canvas.add(_obj);
    this.canvas.fire("point:created",{point : _obj})
    this.canvas.setActiveObject(_obj);
    this.canvas.renderAll();
  },
  _render: function () {
  }
});

fabric.SlideCanvas.prototype.drawingTools.PointsBrush = {
  className: 'fa fa-circle-o',
  title: 'Points Brush'
};

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 31 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {


  /**
   * PencilBrush class
   * @class fabric.RectangleBrush
   * @extends fabric.BaseBrush
   */
  fabric.PolygonBrush = fabric.util.createClass(fabric.BaseBrush, /** @lends fabric.RectangleBrush.prototype */ {
    resultObjectType: "Polyline",
    type: "polygon-brush",
    virtualObject: false,
    maximumPoints : 0,
    individualDrawing: true,
    /**
     * Constructor
     * @param {fabric.Canvas} canvas
     * @return {fabric.RectangleBrush} Instance of a pencil brush
     */
    initialize: function (canvas) {
      this.callSuper('initialize', canvas);
      this.reset();
    },
    /**
     * Inovoked on mouse down
     * @param {Object} pointer
     */
    onMouseDown: function (pointer) {


      if(this.individualDrawing || !this.target){
        var _point = {x: pointer.x, y: pointer.y};
        this.points.push(_point);
        if(!this.virtualObject){
          this.target = this.canvas.createObject(
            fabric.util.object.extend({},
              this.resultObjectProperties, {
                type: this.resultObjectType,
                points: [_point],
                active: true
              }
            )
          );
        }
      }else{
        this._create_active_point(pointer);
      }

      if(this.virtualObject) {
        this._setBrushStyles();
        this._setShadow();
        this._render();
      }else{
        this.canvas.renderAll();
      }
    },

    _create_active_point: function (pointer) {
      var _point = {x: pointer.x, y: pointer.y};
      this.activePoint =  _point;
      this.activeTargetPoint =  {x: pointer.x - this.target.left, y : pointer.y - this.target.top};
      this.points.push(this.activePoint);
      this.target.addPoint(this.activeTargetPoint);
    },
    /**
     * Inovoked on mouse move
     * @param {Object} pointer
     */
    onMouseMove: function (pointer) {


      var _p =  {x: pointer.x - this.target.left, y : pointer.y - this.target.top};


      if(this.activePoint){
        this.activePoint.x = pointer.x;
        this.activePoint.y = pointer.y;
        var _order = this.target.points.length ;

        this.target.setPoint("p" + _order, {
          x : pointer.x - this.target.left,
          y : pointer.y - this.target.top
        });
      }else{
        var _dist = fabric.Point.prototype.distanceFrom.call(this.points[0],_p)
        if(_dist > 10){
          this._create_active_point(pointer);
        }
      }
      this.canvas.renderAll();
    },
    reset: function(){
      this.points = [];
      this.target = null;
      this.activePoint = null;
      this.activeTargetPoint = null;
    },
    /**
     * Invoked on mouse up
     */
    onMouseUp: function () {
      this.target.updateBbox();
      if(this.points.length == this.maximumPoints){
        this.reset();
      }
      this.activePoint = null;
      this.canvas.renderAll();
    },

    /**
     * Draw a smooth path on the topCanvas using quadraticCurveTo
     * @private
     */
    _render: function () {
      this.canvas.fire("before:brush:render",{target: this});

      var ctx = this.canvas.contextTop,
        v = this.canvas.viewportTransform;

      ctx.save();
      ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);

      var _klass_proto = fabric[this.resultObjectType].prototype;

      ctx.lineWidth = _klass_proto.strokeWidth;
      ctx.strokeStyle = _klass_proto.stroke;
      ctx.fillStyle = _klass_proto.fill;

      ctx.beginPath();
      ctx.moveTo(this.points[0].x,this.points[0].y);
      for(var i = 1; i < this.points.length; i++){
        ctx.lineTo(this.points[i].x,this.points[i].y)
      }
      ctx.closePath();
      ctx.fill();
      ctx.stroke();
      ctx.restore();
      this.canvas.fire("brush:render",{target: this})
    },
    drawingLimits: null, /*{
      left: 0,
      width: 0,
      height: 0,
      top: 0
    },*/
    minHeight: 50,
    minWidth: 50,
    _checkRectangle: function(_rect){


      var dl = this.drawingLimits;
      if(dl && dl == "backgroundImage"){
        dl= this.canvas.backgroundImage;
      }

      _rect = {
        left: _rect.left,
        top: _rect.top,
        width: _rect.width,
        height: _rect.height,
      };

      _rect.left  -= fabric.Rect.prototype.strokeWidth / 2;
      _rect.top   -= fabric.Rect.prototype.strokeWidth / 2;

      if(dl){
        if(_rect.left + _rect.width < dl.left ||
          _rect.top  + _rect.height < dl.top ||
          _rect.left > dl.width ||
          _rect.top > dl.height){
          return false;
        }

        if(_rect.top < dl.top){
          _rect.height +=_rect.top ;
          _rect.top = dl.top;
        }
        if(_rect.left < dl.left){
          _rect.width += _rect.left;
          _rect.left = dl.left;
        }
      }

      if(this.minWidth && _rect.width < this.minWidth){
        _rect.width = this.minWidth;
      }
      if(this.minHeight && _rect.height < this.minHeight){
        _rect.height = this.minHeight;
      }


      if(dl) {
        var _xdiff = _rect.left + _rect.width - dl.width;
        if (_xdiff > 0) {
          _rect.width -= _xdiff;
          if (this.minWidth && _rect.width < this.minWidth) {
            _rect.left -= this.minWidth - _rect.width;
            _rect.width = this.minWidth;
          }
        }
        var _ydiff = _rect.top + _rect.height - dl.height;
        if (_ydiff > 0) {
          _rect.height -= _ydiff;
          if (this.minHeight && _rect.height < this.minHeight) {
            _rect.top -= this.minHeight - _rect.height;
            _rect.height = this.minHeight;
          }
        }
      }
      return _rect;
    },
    resultObjectProperties: {}
  });


fabric.SlideCanvas.prototype.drawingTools.PolygonBrush = {
  icon: 'data:image/png;base64,'+ __webpack_require__(23),
  title: 'Polygon Brush'
};
fabric.SlideCanvas.prototype.activeDrawingTools.push("PolygonBrush");



/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 32 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {


/**
 * PencilBrush class
 * @class fabric.RectangleBrush
 * @extends fabric.BaseBrush
 */
fabric.RectangleBrush = fabric.util.createClass(fabric.BaseBrush, /** @lends fabric.RectangleBrush.prototype */ {
  resultObjectType: "Rect",
  type: "rectangle-brush",
  /**
   * Constructor
   * @param {fabric.Canvas} canvas
   * @return {fabric.RectangleBrush} Instance of a pencil brush
   */
  initialize: function (canvas) {
    this.callSuper('initialize', canvas);
  },

  /**
   * Inovoked on mouse down
   * @param {Object} pointer
   */
  onMouseDown: function (pointer) {
    //prepare for drawing
    delete this.p2;

    this.p1 = new fabric.Point(pointer.x, pointer.y);
    this._setBrushStyles();
    this._setShadow();
    this.canvas.contextTop.moveTo(this.p1.x, this.p1.y);
    this._render();
  },

  /**
   * Inovoked on mouse move
   * @param {Object} pointer
   */
  onMouseMove: function (pointer) {

    this.p2 = new fabric.Point(pointer.x, pointer.y);

    if(this.drawingObject){
      var _rect = this._getRect();
      this.drawingObject.set(_rect);
      this.drawingObject.fire("scaling");
    }else{

      if (this.p1.x === this.p2.x && this.p1.y === this.p2.y) {
        delete this.p2;
      } else {

        if(this.resultObjectType){
          var _rect = this._getRect();
          this.drawingObject = this._createRectangle(_rect);
        }
      }
    }
    this.canvas.renderLayer("lower");
  },

  /**
   * Invoked on mouse up
   */
  onMouseUp: function () {
    if(this.drawingObject){
      var _rect = this._getRect();
      var _rect2 = this._checkRectangle(_rect);

      this.canvas.layers.lower.objects.splice(this.canvas.layers.lower.objects.indexOf(this.drawingObject), 1);

      this.drawingObject.set(_rect2);
      this.canvas.add(this.drawingObject);
      this.canvas.setActiveObject(this.drawingObject);
      this.drawingObject.setCoords();
      delete this.drawingObject;
    }
    this.canvas.renderAll();
    // this._finalizeAndAddPath();
  },

  /**
   * Draw a smooth path on the topCanvas using quadraticCurveTo
   * @private
   */
  _render: function () {
    this.canvas.fire("before:brush:render",{target: this})
    if (!this.p2) {
      return;
    }
    var ctx = this.canvas.contextTop,
      v = this.canvas.viewportTransform,
      p1 = this.p1,
      p2 = this.p2;

    ctx.save();
    ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);
    ctx.beginPath();
    if(this.application){
      var _klass_proto = this.application.getDefaultProperties(fabric[this.resultObjectType].prototype) || {};
      ctx.lineWidth = _klass_proto.strokeWidth;
      ctx.strokeStyle = _klass_proto.stroke;
      ctx.fillStyle = _klass_proto.fill;
    }

    var _rect = this._getRect();
    ctx.rect(_rect.left, _rect.top, _rect.width, _rect.height);

    ctx.fill();
    ctx.stroke();
    ctx.restore();
    this.canvas.fire("brush:render",{target: this})
  },
  _getRect: function () {

    var x1, x2, y1, y2;
    if (this.p1.x < this.p2.x) {
      x1 = this.p1.x, x2 = this.p2.x;
    } else {
      x2 = this.p1.x, x1 = this.p2.x;
    }
    if (this.p1.y < this.p2.y) {
      y1 = this.p1.y, y2 = this.p2.y;
    } else {
      y2 = this.p1.y, y1 = this.p2.y;
    }
    return {
      left: x1,
      top: y1,
      width: x2 - x1,
      height: y2 - y1
    };
  },
  drawingLimits: null, /*{
   left: 0,
   width: 0,
   height: 0,
   top: 0
   },*/
  minHeight: 50,
  minWidth: 50,
  _checkRectangle: function(_rect){


    var dl = this.drawingLimits;
    if(dl && dl == "backgroundImage"){
      dl= this.canvas.backgroundImage;
    }

    _rect = {
      left: _rect.left,
      top: _rect.top,
      width: _rect.width,
      height: _rect.height,
    };

    // _rect.left  -= fabric.Rect.prototype.strokeWidth / 2;
    // _rect.top   -= fabric.Rect.prototype.strokeWidth / 2;

    if(dl){
      if(_rect.left + _rect.width < dl.left ||
        _rect.top  + _rect.height < dl.top ||
        _rect.left > dl.width ||
        _rect.top > dl.height){
        return false;
      }

      if(_rect.top < dl.top){
        _rect.height +=_rect.top ;
        _rect.top = dl.top;
      }
      if(_rect.left < dl.left){
        _rect.width += _rect.left;
        _rect.left = dl.left;
      }
    }

    if(this.minWidth && _rect.width < this.minWidth){
      _rect.width = this.minWidth;
    }
    if(this.minHeight && _rect.height < this.minHeight){
      _rect.height = this.minHeight;
    }


    if(dl) {
      var _xdiff = _rect.left + _rect.width - dl.width;
      if (_xdiff > 0) {
        _rect.width -= _xdiff;
        if (this.minWidth && _rect.width < this.minWidth) {
          _rect.left -= this.minWidth - _rect.width;
          _rect.width = this.minWidth;
        }
      }
      var _ydiff = _rect.top + _rect.height - dl.height;
      if (_ydiff > 0) {
        _rect.height -= _ydiff;
        if (this.minHeight && _rect.height < this.minHeight) {
          _rect.top -= this.minHeight - _rect.height;
          _rect.height = this.minHeight;
        }
      }
    }
    return _rect;
  },
  _createRectangle: function(rect){
    this.canvas.setActiveObject(false);
    rect.active = true;
    rect.application = this.application;
    rect.canvas = this.canvas;
    var _object = fabric.util.createObject(this.resultObjectType,rect);
    this.canvas.layers.lower.objects.push(_object);
    _object.updateResponsiveBorder();
    this.canvas.renderAll();
    return _object;
  }

  /**
   * On mouseup after drawing the path on contextTop canvas
   * we use the points captured to create an new fabric rect object
   * and add it to the fabric canvas.
   */
  // _finalizeAndAddPath: function () {
  //
  //   if (!this.p2) {
  //     return false;
  //   }
  //   var ctx = this.canvas.contextTop;
  //   ctx.closePath();
  //
  //
  //   this.canvas.clearContext(this.canvas.contextTop);
  //   this._resetShadow();
  //
  //   // var _rect = this._getRect();
  //   var _rect2 = this._checkRectangle(_rect);
  //   if(_rect2){
  //     // if(this.resultObjectType){
  //     //   this._createRectangle(_rect2);
  //     // }
  //     this.canvas.fire('rect:created', {rect: _rect2, original: _rect});
  //   }else{
  //     this.canvas.fire('rect:rejected', {rect: _rect});
  //   }
  //   this.canvas.renderLayer(this.layers.lower);
  // }
});


fabric.SlideCanvas.prototype.drawingTools.RectangleBrush = {
  className: 'fa fa-pencil-square',
  title: 'select-brush'
};
fabric.SlideCanvas.prototype.activeDrawingTools.push("RectangleBrush");

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 33 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {


/**
 * Точка запуска приложенич
 */
fabric.Application = function(options) {
  this.init(options);
};

fabric.Application.prototype = fabric.util.object.extend({},fabric.Observable,fabric.PluginsMixin,{
  init: function(options){

    options = options || {};
    this.options =  fabric.util.object.clone(options);
    if(this.options.callback){
      this.callback = this.options.callback;
      delete this.options.callback;
    }
    if(this.options.initialize){
      this.initialize = this.options.initialize;
    }

    if(this.options.prototypes){
      fabric.util.object.deepExtend(this.prototypes, this.options.prototypes);
      delete this.options.prototypes;
    }

    if(this.options.plugins){
      fabric.util.object.extend(this.plugins, this.options.plugins);
      delete this.options.plugins;
    }

    if(this.options.canvasContainer){
      this.canvasContainer = this.options.canvasContainer;
      delete this.options.canvasContainer;
    }

    this.initEventListeners();

    if(this.options.loaderTemplate){
      this.setLoaderTemplate(this.loaderTemplate || this.options.loaderTemplate);
    }

    if(this.options.credentials || this.credentials){
      this.printBanner();
    }

    this.fire("loading:begin",{});

    fabric.util.order([
      this.runPlugins.bind(this,"preloaders"),
      this.preloader,
      this.loadConfiguration,
      this.runPlugins.bind(this,"configuration"),
      this.createApp,
      this.initialize,
      this.loadSlide,
      this.runPlugins.bind(this,"postloaders"),
      this.onApplicationCreated,
      this.postloader,
      this.callback && function(){
        setTimeout(this.callback.bind(this),0)
      }
    ],this)
  },
  credentials: false,
  ready : false,
  onApplicationCreated: function(){
    this.ready = true;
    this.fire("loading:end",{});
  },
  canvasClass: 'SlideCanvas',
  resizable: false,
  history: true,
  /**
   * functions will be called on different application creation stages
   */
  plugins: {
    preloaders: [],
    configuration: [],
    canvas: [],
    postloaders: []
  },
  printBanner: function(){
    if(this.credentials){
      console.info("%cFiera Canvas Editor%c by %cDenis Ponomarev%c %c%6$s%c / %c%9$s%c", "color: #ffa500", "color: #202020", "color: #2EC06C", "color: #202020", "color: #337ab7", "www.hometlt.ru", "color: #202020", "color: #337ab7", "ponomarevtlt@gmail.com", "color: #202020");
    }
  },
  eventListeners: {
    "canvas:created": function(){
      this.setResizable();
    },
    "entity:created": []
  },
  onSlideLoaded: function () {},
  onCanvasCreated: function () {},
  callback: function () {},
  loadConfiguration: function (resolve,error) {
    if(!this.options.configuration){
      return resolve();
    }
    var _app = this;
    fabric.util.promise
      .map(
        this.options.configuration,
        function(value){
          return new Promise(function(resolve,fail) {
            fabric.util.data.loadJson(value,resolve,fail);
          });
        }
      )
      .then(function(results){
        fabric.util.object.extend(_app,results)
      })
      .then(resolve,error);
  },
  setCanvasContainer: function (id) {
    if(this._appCreated){
      this.createCanvas(this.canvasContainer, this.canvas);
      this.project.setCanvas(this.canvas);
    }else{
      this.canvasContainer = id;
    }
  },
  loadSlide: function () {
    var _canvas = this.canvas;
    if (this.slide) {
      if (_canvas.load) {
        _canvas.load(this.slide, this.onSlideLoaded.bind(this));
      } else {
        _canvas.createObjects(this.slide,this.onSlideLoaded.bind(this));
      }
    }
    //
    // if(_canvas){
    //   _canvas.fire("loading:end",{type: "application" ,target: this});
    // }
  },
  createApp: function (callback) {

    fabric.util.object.extend(this, this.options);
    this.createCanvas();
    // this.runPlugins.bind(this,"canvas"),

    var _canvas = this.canvas;


    if (this.project) {
      var _project = this.project;

      this.project = new fabric.Project({application: this});
      this.fire("project:changed");

      if(this.history){
        this.project.initHistory();
        this.project.enableHistory();
      }
      _canvas && this.project.setCanvas(_canvas);

      if (_project !== true) {
        this.project.load(_project);
      }
    }else if (this.canvas){
      if(this.history){
        _canvas.initHistory();
        _canvas.enableHistory();
      }
    }

    this.fire("created");
    callback();
  },
  createCanvas: function () {
    if(!this.canvasContainer){
      return ;//callback();
    }
    if (this.canvasContainer.constructor == String) {
      var el = document.getElementById(this.canvasContainer);
    } else {
      el = this.canvasContainer;
    }
    // var _canvas_options = this.canvas ;

    this.canvas = new fabric[this.canvasClass](el, {application: this});
    // if(_canvas_options){
    //   this.canvas.load(_canvas_options);
    // }
    this.fire("canvas:created");
    this.onCanvasCreated();
  },
  dispose: function(){
    this.canvas.dispose();
  },
  setResizable: function(){
    if(this.options.onResize){
      this.onResize = this.options.onResize;
      delete this.options.onResize;
    }
    if(this.options.resizable){
      this.resizable = this.options.resizable;
      delete this.options.resizable;
    }
    if (this.resizable) {
      this.canvas.onResize = function () {
        var _parent = $(this.wrapperEl.parentNode);

        var _offset = $(this.wrapperEl).position();
        var _margin  = this.application.widthMargin || 0;
        var _w =  _parent.width() - _margin, _h = _parent.height();
        if (this.application.onResize) {
          this.application.onResize({
            width: _w ,
            height: _h
          }, {
            width: this.originalWidth ,
            height: this.originalHeight
          });
          this.calcOffset();
        } else {
          this.setDimensions({
            width: _w - _offset.left  - _margin,
            height: _h - _offset.top
          });
        }
      }
    }
    if(this.canvas){
      this.canvas.onResize();
    }
  }
});

fabric.Application.addPlugin = fabric.PluginsMixin.addPlugin.bind(fabric.Application);

fabric.app = function(options){
  return new fabric.Application(options);
};


/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 34 */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(fabric) {


if(!Object.values){
  Object.defineProperty(Object, 'values', {
    enumerable: false,
    configurable: false,
    writable: false,
    value: function(_object) {
      var _values = [];
      Object.keys(_object).forEach(function (key) {
        _values.push(_object[key]);
        // use val
      });
      return _values;
    }
  });
}


fabric.util.object.extend(fabric,{
  errors: []
});

fabric.util.order = function(_array,context ){
  (function _call(){
    if(!_array.length)return;
    var foo = _array.shift();
    if(foo){
      if(foo.length){
        foo.call(context,_call);
      }else{
        foo.call(context);
        _call();
      }
    }else{
      _call();
    }
  })()
};

fabric.util.promise = {
  map: function (data, foo) {

    if(data.constructor == Array){
      return Promise.all(data.map(foo))
        .then(function (results, error) {
          if (error) {
            return Promise.reject(error);
          }
          return Promise.resolve(results);
        })
    }

    var keys = Object.keys(data);
    var urls = Object.values(data);
    return Promise.all(urls.map(foo))
      .then(function (results, error) {
        if (error) {
          return Promise.reject(error);
        }
        var _map = {};

        for(var i = 0 ; i < results.length; i++){
          _map[keys[i]] = results[i];
        }
        return Promise.resolve(_map);
      })
  },
  wrap: function (context) {
    return function wrap(foo) {
      return function () {
        var options = Array.prototype.slice.call(arguments,1);
        if (!foo.length) {
          return new Promise(function (resolve, fail) {
            var _result = foo.call(context);
            (_result || _result === undefined) ? resolve() : fail();
          });
        } else {
          return new Promise(foo.bind(context));
        }
      }
    }
  }
};



fabric.Object.prototype.set = function(key, value) {
  if (typeof key === 'object') {
    this._setObject(key, value);
  }
  else {
    if (typeof value === 'function' && key !== 'clipTo') {
      this._set(key, value(this.get(key)));
    }
    else {
      this._set(key, value);
    }
  }
  return this;
};

fabric.Object.prototype._setObject = function(options,callback) {
  var keys = Object.keys(options);
  if(this.optionsOrder){
    for(var i = this.optionsOrder.length; i--;){
      var prop = this.optionsOrder[i];
      var ii = keys.indexOf(prop);
      if(ii != -1){
        keys.splice(ii, 1);
        keys.unshift(prop);
      }
    }
  }
  for (var i = 0; i < keys.length; i++) {
    var prop = keys[i];
    if(typeof options[prop] == "function"){
      keys.splice(i, 1);
      keys.unshift(prop);
    }
  }
  var queue;
  for (var i in keys) {
    var _key = keys[i];
    if(options[_key] === undefined || options[_key] === null)continue;
    var _fooName = "set" + fabric.util.string.capitalize(_key, true);
    if(this[_fooName] && this[_fooName].name && this[_fooName].name != "anonymous"){
      if(this[_fooName].length == 2){
        if(!queue){
          queue = fabric.util.queueLoad(2,callback);
        }else{
          queue.total ++;
        }
        this[_fooName](options[_key],function(_key){
          queue();
        }.bind(this,_key));
      }else{
        this[_fooName](options[_key])
      }
    } else {
      this.__set(_key, options[_key]);
    }
  }
  if(queue){
    queue()
  }else if(callback ){
    callback();
  }
};

var _get_pointer_overwritten = fabric.Canvas.prototype.getPointer;

fabric.util.object.extend(fabric.Canvas.prototype, {
  setWidth: function (value) {
    return this.setDimensions({ width: value }, {});
  },
  setHeight: function (value) {
    return this.setDimensions({ height: value }, {});
  },
  /**
   * @private
   */

  _setObject: fabric.Object.prototype._setObject,
  originalState: {},
  stateProperties: [],
  specialProperties: ["backgroundImage","objects"],
  editingObject: null,
  getObjectByID: function(_id){
    var layers = this.layers || [{objects: this._objects}];
    for (var i in layers) {
      for (var j in layers[i].objects) {
        if (layers[i].objects[j].id === _id) {
          return layers[i].objects[j];
        }
      }
    }
    return null;
  },
  /*
   Add Custom Object Tranformations
   */
  getPointer: function (e, ignoreZoom, upperCanvasEl) {
    var pointer = _get_pointer_overwritten.call(this, e, ignoreZoom, upperCanvasEl);
    if (e._group) {
      return this._normalizePointer(e._group, pointer);
    }
    return pointer;
  },
  __set : fabric.Object.prototype._set,
  getModifiedStates: function (target) {
    var states = {
      original: {},
      modified: {}
    };
    for (var prop in target.originalState) {
      if (target.originalState[prop] !== target[prop]) {
        if(target.originalState[prop] instanceof Object){
          if(JSON.stringify(target.originalState[prop]) == JSON.stringify(target[prop])){
            continue;
          }
        }
        states.original[prop] = target.originalState[prop];
        states.modified[prop] = target[prop];
      }
    }
    return states;
  },
  fireModifiedIfChanged: function (target) {
    if (this.stateful) {
      var _states = target.hasStateChanged();
      if(_states){
        this.fire('object:modified', {target: target , states: _states});
        target.fire('modified',{states: _states});
      }
    }
  },
  _set: function (key, value,callback) {
    if (this.specialProperties.indexOf(key) !== -1) {
      this["set" + fabric.util.string.capitalize(key, true)](value,callback);
    } else {
      fabric.Object.prototype._set.call(this, key, value);
    }
    return this;
  },
  get: fabric.Object.prototype.get,
  set: fabric.Object.prototype.set,
  hasStateChanged: fabric.Object.prototype.hasStateChanged,
  /** Creates a bottom canvas
   * @private
   * @param {HTMLElement} [canvasEl]
   */
  _createLowerCanvas: function (canvasEl) {
    if (typeof canvasEl == "string") {
      this.lowerCanvasEl = fabric.util.getById(canvasEl) || this._createCanvasElement();
    } else if (canvasEl) {
      this.lowerCanvasEl = canvasEl;
    } else {
      this.virtual = true;
      this.lowerCanvasEl = fabric.util.createCanvasElement();
    }

    this._initCanvasElement(this.lowerCanvasEl);

    fabric.util.addClass(this.lowerCanvasEl, 'lower-canvas');

    if (this.interactive) {
      this._applyCanvasStyle(this.lowerCanvasEl);
    }

    this.contextContainer = this.lowerCanvasEl.getContext('2d');
  },
  findTarget: function (e, skipGroup) {
    if (this.skipTargetFind) {
      return;
    }

    var ignoreZoom = true,
      pointer = this.getPointer(e, ignoreZoom),
      activeGroup = this.getActiveGroup(),
      activeObject = this.getActiveObject();
    if (activeGroup && !skipGroup && this._checkTarget(pointer, activeGroup)) {
      return activeGroup;
    }

    if (activeObject && this._checkTarget(pointer, activeObject)) {
      //added visceroid
      this._fireOverOutEvents(activeObject, e);
      return activeObject;
    }

    this.targets = [ ];

    var target = this._searchPossibleTargets(this._objects, pointer);
    this._fireOverOutEvents(target, e);
    return target;
  }
});

fabric.util.object.extend(fabric.Object.prototype, {
  setAngle: function(angle) {
    this.angle = angle;
  },
  __set : fabric.Object.prototype._set,
  get : fabric.Object.prototype.get,
  _set: function (key, value ,callback) {
    var _fooName = "set" + fabric.util.string.capitalize(key, true);
    if(this[_fooName]  && this[_fooName].name && this[_fooName].name != "anonymous"){
      // if (this.specialProperties.indexOf(key) !== -1) {
      // if(this[_fooName]){
      this[_fooName](value,callback);
    }else{
      this.__set(key, value);
    }
    return this;
  },
  disable: function () {
    this.set({
      selectable: false,
      evented: false,
      hasControls: false,
      lockMovementX: true,
      lockMovementY: true
    });
  },
  stored: true,
  /**
   * Saves state of an object
   * @param {Object} [options] Object with additional `stateProperties` array to include when saving state
   * @return {fabric.Object} thisArg
   */
  saveState: function(options) {
    this.stateProperties.forEach(function(prop) {
      var _val = this.get(prop);
      if(_val instanceof Object){
        this.originalState[prop] = fabric.util.object.cloneDeep(_val);
      }else{
        this.originalState[prop] = _val;
      }
    }, this);

    if (options && options.stateProperties) {
      options.stateProperties.forEach(function(prop) {
        this.originalState[prop] = this.get(prop);
      }, this);
    }
    return this;
  },
  hasStateChanged: function() {
    var modified = 0;
    var states = {
      original: {},
      modified: {}
    };
    for (var prop in this.originalState) {
      if (this.originalState[prop] !== this[prop]) {
        if(this.originalState[prop] instanceof Object){
          if(JSON.stringify(this.originalState[prop]) == JSON.stringify(this[prop])){
            continue;
          }
        }
        states.original[prop] = this.originalState[prop];
        states.modified[prop] = this[prop];
        modified++;
      }
    }
    return modified && states;
  }
});

fabric.util.getProportions = function (photo, container, mode) {
  mode = mode || 'fit';
  var _w = photo.naturalWidth || photo.width;
  var _h = photo.naturalHeight || photo.height;
  if (!container.height && !container.width) {
    return {
      scale: 1,
      width: _w,
      height: _h
    };
  }
  if (!photo.height && !photo.width) {
    return {
      scale: 0.001,
      width: container.width,
      height: container.height
    };
  }

  // var _asp = _w / _h, _c_asp = container.width / container.height;

  // if (_asp > _c_asp) {
  //   _h = container.height;
  //   _w = _h * _asp;
  //
  // } else {
  //   _w = container.width;
  //   _h = _w / _asp;
  // }
  // var scaleX = container.width / _w;
  // var scaleY = container.height / _h;
  var scaleX = container.width && container.width / _w || 999;
  var scaleY = container.height && container.height / _h || 999;

  var scale;
  if (mode === 'cover') {
    scale = Math.max(scaleX, scaleY);
  }
  if (mode === 'fit') {
    scale = Math.min(scaleX, scaleY);
  }
  if (mode === 'center') {
    scale = 1;
  }
  return {
    scale: scale,
    width: Math.floor(_w * scale),
    height: Math.floor(_h * scale)
  };
};

fabric.util.Utf8ArrayToStr = function(array) {
  var out, i, len, c;
  var char2, char3;

  out = "";
  len = array.length;
  i = 0;
  while(i < len) {
    c = array[i++];
    switch(c >> 4)
    {
      case 0: case 1: case 2: case 3: case 4: case 5: case 6: case 7:
      // 0xxxxxxx
      out += String.fromCharCode(c);
      break;
      case 12: case 13:
      // 110x xxxx   10xx xxxx
      char2 = array[i++];
      out += String.fromCharCode(((c & 0x1F) << 6) | (char2 & 0x3F));
      break;
      case 14:
        // 1110 xxxx  10xx xxxx  10xx xxxx
        char2 = array[i++];
        char3 = array[i++];
        out += String.fromCharCode(((c & 0x0F) << 12) |
          ((char2 & 0x3F) << 6) |
          ((char3 & 0x3F) << 0));
        break;
    }
  }

  return out;
};

fabric.util.createObject = function (type, options, callback) {
  if(typeof type !== "string"){
    callback = options;
    options = type;
    type = null;
  }else{
    options.type = type;
  }
  var app = options.application;
  app && app.fire("entity:load",{options: options});

  var _klassName = fabric.util.string.camelize(fabric.util.string.capitalize(type || options.type || app.prototypes.Object.type,true));
  var _klass = fabric[_klassName] || app.klasses[_klassName];


  if(!_klass){
    console.error(_klassName + " is undefined");
    return callback(new fabric.Rect(options))
  }

  var el = _klass.fromObject(options, function (el) {
    callback && callback(el);
    callback = null;
  });
  if (el) {
    callback && callback(el);
    callback = null;
  }
  return el;
};

fabric.util.dataURItoBlob = function (dataURI, dataTYPE) {
  var binary = atob(dataURI.split(',')[1]), array = [];
  for (var i = 0; i < binary.length; i++) {
    array.push(binary.charCodeAt(i));
  }
  return new Blob([new Uint8Array(array)], {type: dataTYPE});
};

fabric.util.blobToDataURL = function (blob, callback) {
  var a = new FileReader();
  a.onload = function (e) {
    callback(e.target.result);
  };
  a.readAsDataURL(blob);
};

fabric.util.createCanvasElementWithSize = function (size) {
  var canvas = fabric.util.createCanvasElement();
  canvas.width = size.width;
  canvas.height = size.height;
  return canvas;
};

fabric.util.string.toDashed = function (str) {
  return str.replace(/([a-z])([A-Z])/g, '$1-$2').toLowerCase();
};

fabric.util.string.uncapitalize = function(string){
  return string.charAt(0).toLowerCase() +
    (string.slice(1));
};

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 35 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.util.object.extend(fabric,{
  debugTimeout: 0
});

fabric.Application.prototype.enableDebugging = function(){
  if(fabric.debug){

    var _operand = "color: #2EC06C; font-style: italic;";
    console.info("debug enabled. (use %capp%c, %cproject%c, %ccanvas%c, %ctarget%c in console)",
      _operand, "color: #202020",
      _operand, "color: #202020",
      _operand, "color: #202020",
      _operand, "color: #202020");

    window.app = this;
    window.canvas = this.canvas;
    window.project = this.project;
    window.target = null;
    this.canvas && this.canvas.on("target:changed", function () {
      window.target = this.target;
    });
  }
};
fabric.Application.addPlugin("postloaders","enableDebugging");

fabric.Object.prototype.debug = function(noBorders){
  var canvas = document.createElement("canvas");
  canvas.width = noBorders ?this.width: this.width + 2;
  canvas.height = noBorders ?this.height : this.height + 2;

  var ctx = canvas.getContext('2d');
  if(!noBorders){
    ctx.lineWidth=1;
    ctx.strokeStyle="yellow";
    ctx.strokeRect(0,0,this.width + 2,this.height+ 2);
    ctx.setLineDash([4,4]);
    ctx.strokeStyle="#000000";
    ctx.strokeRect(0,0,this.width + 2,this.height+ 2);
  }
  ctx.translate(this.width/2  + 1,this.height/2 + 1);
  var _clipTo = this.clipTo;
  delete this.clipTo;
  this.render(ctx,true);
  this.clipTo = _clipTo;
  window.open(canvas.toDataURL(),"_blank");
};


fabric.Application.prototype.logEvents = fabric.Object.prototype.logEvents = function eventsLogger(options){
  var _counter = {};
  for(var i in options){
    _counter[i] = 0;
    this.on(options[i],function(i, event) {
      console.log(i + " " + ++_counter[i],event);
    }.bind(this,i));
  }
}

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 36 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

if (!String.prototype.splice) {
  /**
   * {JSDoc}
   *
   * The splice() method changes the content of a string by removing a range of
   * characters and/or adding new characters.
   *
   * @this {String}
   * @param {number} start Index at which to start changing the string.
   * @param {number} delCount An integer indicating the number of old chars to remove.
   * @param {string} newSubStr The String that is spliced in.
   * @return {string} A new string with the spliced substring.
   */
  String.prototype.splice = function(start, delCount, newSubStr) {
    return this.slice(0, start) + newSubStr + this.slice(start + Math.abs(delCount));
  };
}


__webpack_require__(49);
fabric.util.syntax = __webpack_require__(115);

fabric.DemoApplication = function(options) {
  this.init(options);
};

fabric.DemoApplication.prototype = {
  credentials: true,
  loaderContainer: ".xx-container",
  loaderTemplate: "<span class='canvas-load-spinner'><img src='{loaderIcon}'></span>",
  __proto__: fabric.Application.prototype,
  useMarkDown: false,
  libraryTool: false,
  codeBlock: true,
  util: {
    mediaRoot: '../media/'
  },
  resizable: true,
  prototypes: {
    Text: {
      fontFamily: "Open Sans"
    },
    Object: {
      // originX: "center",
      // originY: "center",
      includeDefaultValues: false,
      // orderTools   : true,
      // flipTools : true,
      // duplicateTool : true,
      transparentCorners: false,
      borderScaleFactor: 0.5,
      borderColor: "orange",
      cornerColor: "orange"
    },
    SlideCanvas: {
      historyTools: true,
      droppable: true,
      includeDefaultValues: false,
      defaultArea: "#__0",
      insertZoomTools: true,
      backgroundPosition: "cover"
    }
  },
  saveData: function(){

    if(this.project){
      this.savedData = this.project.toObject();
    }else{
      this.savedData = this.canvas.toObject(this.canvas.propertiesToInclude)
    }
    var input = fabric.util.syntax.syntaxHighlight(JSON.stringify(this.slide || {},null,' ').replace(/"(\w+)"\s*:/g, '$1:'));
    this.$diffEl1.html(input);
    var _difference = fabric.util.syntax.differenceMap(this.slide || {},this.savedData);
    fabric.util.syntax.differenceHighlight(_difference,this.$diffEl);

    var size = this.$diffEl.text().length;
    this.$outputSize.text(size)
  },
  actions: {
    save: {
      title: "done",
      insert : "codeBlock",
      className: 'fa fa-floppy-o',
      action: function(){
        this.$codeBlock.show();
        this.saveData();
      }
    }
  },
  toolbar: {
    application:  "application-menu",
    canvas:       "slide-menu",
    objects:  {
      container: "object-menu",
      marginY: -50
    }
  },
  slidesList: false,
  onCanvasCreated: function(){
    this.addTitle(this.options.title || document.title);
    //if (this.$container.attr("data-selector") !== undefined) {
    //  this.createSelector();
    //}
    if(this.slidesList){
      this.createSlidesList();
    }

    this.canvas.on('viewport:scaled',function(e){
      $(this.wrapperEl).css("background-size" ,
        "{scale}px {scale}px,{scale}px {scale}px, {scale2}px {scale2}px, {scale2}px {scale2}px"
          .format({scale: e.scale * 100 , scale2: e.scale * 20.04 }))
    })
  },
  createCodeBlock: function (callback) {

    var app = this;
    this.$codeBlock = $("#code-block");
    this.$diffEl = $("<pre>");
    this.$diffEl1 = $("<pre>");
    this.$diffEl.attr("contenteditable",true);
    var $closeButton = $("<button class='btn fa fa-times'></button>");
    $closeButton.click(function(){
      app.$codeBlock.hide();
    });


    var $loadButton = $("<button class='btn fa fa-play-circle  load-button'></button>");
    $loadButton.click(function(){
      // console.log();
      app.slide = app.savedData;
      app.canvas.load(app.savedData,function(){
        app.saveData();
      });
    });
    this.$codeBlock.find(".code-column").remove();
    this.$codeBlock.append(
      $("<div class='code-column'><h2>Input data</h2>").append(this.$diffEl1),
      $("<div class='code-column'><h2>Output data <span id='size'></span></h2>").append(this.$diffEl),
      $loadButton,
      $closeButton
    );
    this.$outputSize = this.$codeBlock.find("#size");

    this.$codeBlock.draggable({
      excludeElements : "pre",
    }).dpResizable();
  },
  setContainer: function (callback) {



    this.$ffcontainer = $(".ff-container");
    this.$container = $(".xx-container");
    if(!this.$container.length){
      this.$container = $("<div>").addClass("ff-container");
      $("body").append(this.$container);
    }


    this.$container.append($(
      '<div class="bottom-interface">' +
        '<div class="bottom-buttons">' +
          '<div id="slide-menu" class="inline-actions compact"></div>' +
          '<div id="application-menu" class="inline-actions compact"></div>' +
        '</div>' +
      '</div>' +
      '<div id="object-menu" class="inline-actions compact"></div>' +
      '<div id="code-block"></div>'
    ));

    this.canvasContainer = fabric.util.createCanvasElement();
    this.$container.append($(this.canvasContainer));
    //todo
    this.options.canvasContainer = this.canvasContainer;
    callback();
  },
  postloader: function(){
    if(this.codeBlock){
      this.createCodeBlock();
    }

    this.createHelp(this.article);
  },
  preloader: function(callback){
    if (document.body){
      return this.setContainer(callback);
    }

    if (document.readyState === "complete") {
      this.setContainer(callback);
    }else{
      window.addEventListener("load", function(){
        this.setContainer(callback);
      }.bind(this),true);
    }
  },
  libraryOpened: false,
  createTab: function (tab,options) {
    if(!this.$tabs){
      this.$aside = $("<aside>");
      this.$container.append(this.$aside);
      this.$tabs = $('<div class="ff-tabs">');
      this.$aside.append(this.$tabs);
    }

    var valueID = fabric.util.string.camelize(tab);
    var panelID = "fiera-panel-" + fabric.util.string.camelize(tab);
    var tabID = "fiera-tab-" + fabric.util.string.camelize(tab);
    var $input = $('<input type="radio" name="tabs">').attr("id",tabID).val(valueID);
    var $label = $('<label>').attr("for",tabID).attr("title",tab).text(tab);

    if(!this.libraryOpened) {
      $input.attr("checked","true");
    }
    this.$tabs.append($input,$label);

    var _this = this;
    $label.click(function(){
      if(!_this.libraryOpened || _this.selectedTab == $input.val()){
        _this.libraryOpened = !_this.libraryOpened;
        _this.$ffcontainer.toggleClass("library-opened");
      }
      _this.selectedTab = $input.val();
      _this.$aside.find(".elements").hide().filter("#" + panelID).show();
    });

    if(this.libraryOpened === true || this.libraryOpened === "tab") {
      this.$ffcontainer.addClass("library-opened");
      this.libraryOpened = true;
      this.selectedTab = valueID;
    }

    var $elementsList = $("<div>").addClass("elements").attr("id",panelID);
    this.$aside.append($elementsList);

    if(this.selectedTab != valueID){
      $elementsList.hide();
    }

    return {
      options: options,
      tab: tab,
      label: $label,
      input: $input,
      list: $elementsList
    }
  },
  createFontsList: function () {
    var library = [];
    for(var i in this._fonts) {
      library.push({
        fontFamily: this._fonts[i],
        fontSize: 25,
        category: "fontFamily",
        text: this._fonts[i],
        type: "text"
      })
    }
    this.createElementsList("Fonts",library);
  },
  _addCanvasEl: function (el, element,$innerEl){

    // element = fabric.util.object.cloneDeep(element);

    var canvasEl = document.createElement("canvas");
    canvasEl.width = 156;
    canvasEl.height = 86;

    var _fake_canvas = new fabric.SlideCanvas(canvasEl,{application: this});
    _fake_canvas.clear();

    _fake_canvas.createObject(element,function(_object){
      var b = _object.getBoundingRect();
      _object.set({
        left : 80 - b.width/2 - _object.strokeWidth * 2,
        top : 45 - b.height/2 - _object.strokeWidth * 2
      });
      element.scaleX = _object.scaleX;
      element.scaleY = _object.scaleY;
      element.width = _object.width;
      element.height = _object.height;
      element.left = _object.left;
      element.top = _object.top;
      element.strokeWidth = _object.strokeWidth;

      _fake_canvas.renderAll();

      $innerEl[0].src = canvasEl.toDataURL();

      delete _object.canvas;
      el[0].data = element;
      el[0].element = _object;

    });
  },
  updateElementsList: function(list, library){

    var app = this;
    for (var i in library) {
      var element = library[i];
      var el = $("<span>")
        .addClass("list-item");

      el[0].data = element;

      if(list.options.element){
        element = list.options.element(element);
      }



      if(element.title){
        var $span = $("<span>").text(element.title).addClass("element-title");
        el.append($span);
      }
      var $innerEl = null;

      if(list.options.render){
        $innerEl = list.options.render(element);
      }else{
        if(element.category == "fontFamily"){
          $innerEl = $("<span>").css({
            "color": element.fill || fabric.Text.prototype.fill,
            "font-family": element.fontFamily,
            "font-size":   element.fontSize
          }).text(element.text);
        }else{

          switch (element.type) {
            case "image":
              $innerEl = $("<img>").attr({
                src: fabric.util.mediaRoot + element.src
              });
              el[0].element = $innerEl[0];
              break;
            case "video":
              $innerEl = $("<video>");
              for (var type in element.src) {
                $innerEl.append($("<source>").attr({
                  src: fabric.util.mediaRoot + element.src[type],
                  type: type
                }));
              }
              el[0].element = $innerEl[0];
              break;
            default:
              $innerEl = $("<img width=160 height=90>");
              this._addCanvasEl(el, element,$innerEl);
          }
        }
      }
      if($innerEl.constructor == Array){
        var _span = $("<span>");
        _span.append($innerEl);
        $innerEl = _span;
      }
      el.append($innerEl);


      if(list.options.draggable){
        $innerEl.draggable({
          draggable: "helper",
          droppable: ".canvas-container",
          ngModel: element,
          onMove: function (data) {
            app.canvas._onDragMove && app.canvas._onDragMove(data.$event);
          },
          onDrop: function (data) {
            app.canvas._onDrop(data.$event);
          },
          draggableArea: ".ff-container"
        })
      };

      $innerEl.click(list.options.activate.bind(this,el[0]));

      list.list.append(el);

    }
  },
  createElementsList: function (tab,library,options) {
    options = fabric.util.object.defaults(options || {},{
      draggable: true,
      activate: function (el) {
        if(this.target && this.target.setElement){
          this.target.setElement(el.data);
        }else{

          this.canvas.createObject(fabric.util.object.deepExtend({
            position: "center"
          },el.data));
        }
      }
    });
    var list = this.createTab(tab, options);
    this.updateElementsList(list, library);
    return list;
  },
  createSelector: function () {
    var app = this;
    var list = {
      "Clipart":      "clipart.html",
      "Filters":      "filters.html",
      "Gridsnapper":  "gridsnapper.html",
      "Bubbles":      "bubbles.html",
      "Photo":        "photo.html",
      "Placeholder":  "placeholder.html",
      "Video":        "video.html",
      "Project":      "project.html",
      "TextFrame":    "textFrame.html",
      "Filler":       "gnt-solutions/index.html",
      "Frames":       "frames.html"
    };

    if (!app.$selector) {
      app.$selector = $("<div>").addClass("selector");


      var $span = $("<span>").text("▼").click(function () {
        app.$selector.addClass("opened");
        window.addEventListener("click", function closeSelector() {
          $(".selector").removeClass("opened");
        }, true);
      });

      app.$selector.append($span);

      app.$container.append(app.$selector);
      app.$selectorList = $("<div>").addClass("selector-list");
      app.$selector.append(app.$selectorList);

      for (var i in list) {
        var $a = $("<a>").attr("href", app.demoRoot + list[i]).text(i);
        app.$selectorList.append($a);
      }
    }
  },
  demoRoot: "",
  createSlidesList: function () {

    var $bottom = this.$container.find(".bottom-interface");
    var $bottomButtons = $bottom.find(".bottom-buttons");

    this.$slidesButton = $("<div>").addClass("slides-button fa fa-map-o");
    var $slideList = this.$slidesList = $("<div>").addClass("slides-list");
    var $slideListInner = $("<div>").addClass("slides-list-inner");
    $slideList.append($slideListInner);

    $bottom.append(this.$slidesList);
    $bottomButtons.append(this.$slidesButton);

    this.$container.addClass("slides-opened");
    this.$slidesButton.click(function(){
      this.$container.toggleClass("slides-opened");
    }.bind(this));

    var project = this.project;

    project.slides.forEach(function(_slide){

      var _canvasEl = fabric.util.createCanvasElement();
      _canvasEl.setAttribute("height",150);
      fabric.util.createThumb(_slide,_canvasEl);

      var $slide = $("<div>")
        .addClass("slide")
        .click(function(){
          project.setActiveSlide(_slide)
        })
        .append(_canvasEl)
        .append($("<span>").html(_slide.title));

      $slideListInner.append($slide);
    });

  },
  __useMarkDown: function (el,_content) {

    var md = MarkDownIt({
      highlight: function (str, lang) {
        if (lang && hljs.getLanguage(lang)) {
          try {
            return hljs.highlight(lang, str).value;
          } catch (__) {}
        }

        return ''; // use external default escaping
      }
    });
    // var hljs = re?quire('highlight.js'); // https://highlightjs.org/


    el.html(md.render(_content));
  },
  createHelp: function (helpFile) {
    var app = this;

    if (!helpFile) {
      var article = $("article");
      var _content = article.html();
      article.remove();
    }

    app.$helpArticle = $("<article>").addClass("help-article").hide();
    app.$helpTitle = $("<div>").addClass("help-title");
    app.$helpContent = $("<div>").addClass("help-content").addClass("markdown-body");

    app.$helpArticle.append(app.$helpTitle, app.$helpContent);


    app.$helpOpenButton = $("<a>")/*.attr("href", "#help")*/.addClass("help-button").text("?");
    app.$helpCloseButton = $("<a>")/*.attr("href", "#")*/.addClass("help-button").text("×");

    app.$helpOpenButton.click(function () {
      app.$helpArticle.show();
      app.$helpOpenButton.hide();
      app.$helpCloseButton.show();
      app.helpContentCallback && app.helpContentCallback();
    });
    app.$helpCloseButton.click(function () {
      app.$helpArticle.hide();
      app.$helpOpenButton.show();
      app.$helpCloseButton.hide();
    }).hide();

    //
    // if (true) {
    //   console.log(true);
    //   // fabric.util.data.loadJson()
    //
    //   // fabric.util.loadJson()
    //   // fabric.util.loadJson()
    // }



    if (helpFile) {
      if(helpFile.startsWith("dox:")){
        fabric.util.data.loadJson(helpFile.substr(4),function(data){
          app.$container.append(app.$helpArticle);
          var $fullPre = $("<pre class='language-javascript'>");
          // app.$helpContent.append($fullPre);
          data.forEach(function(item,index){
            if(!item.code){
              item.code = "";
            }
            var lines = item.code.split("\n");
            for(var i = lines.length ; i--;) {
              if(lines[i].trim().length == 0){
                lines.splice(i,1);
              }
            }

            if(_.findWhere(item.tags,{type: "collapsed"})){
              var _ident = lines[0].length - lines[0].trim().length;
              var tail = "";
              for(var i = 1 ; i < lines.length ; i++) {
                if (lines[i].length - lines[i].trim().length < _ident) {
                  tail = lines.splice(i).join("\n")
                  break;
                }
              }
              var _code = lines.join("\n");

              var $spoilerTrigger = $("<div class='spoiler-trigger'>");
              var $spoiler = $("<div class='spoiler'>").text(_code.substr(_code.indexOf("{")  ,_code.lastIndexOf("}")  ));
              $fullPre.append(
                "/**/,",
                _code.substr(0,_code.indexOf("{") ),
                $spoilerTrigger,
                $spoiler,
                _code.substr(_code.lastIndexOf("}") + 1),
                "\n",
                tail
              );
            }else{
              var _code = lines.join("\n");
              $fullPre.append(
                "/**/,",
                _code
              );
            }
          });

          // $fullPre[0].textContent = "";
          hljs.highlightBlock($fullPre[0]);

          var lines = $fullPre.html().split('<span class="hljs-comment">/**/</span>,');
          lines.splice(0,1);

          for(var i = 0; i < lines.length ; i++) {
            var item = data[i];


            item.tags.forEach(function(tag){
              item.tags[tag.type] = tag;
            })
            var $line = $("<div class='dox-line'>");
            var $left = $("<div class='dox-left-column'>{description.full}</div>".format(item));
            var $code = $("<pre>").html(lines[i]);
            $line.append($left, $code);
            app.$helpContent.append($line);

            if(item.tags.collapsed){
              $code.find(".spoiler-trigger").append($code.find(".spoiler")).click(function(){
                $(this).toggleClass("collapsed")
              })
            }


            if(item.tags.module){
              var $popup = $("<div class='popup'>@module: {tags.module.string}</div>".format(item));
              $($code.children()[0]).addClass("xxx").prepend($popup);
            }
          }


          // hljs.highlightBlock($fullPre[0] );


          app.$container.append(app.$helpOpenButton);
          app.$container.append(app.$helpCloseButton);
        });
      }else{

        app.$helpContent.load(helpFile, function () {


          setTimeout(function () {
            var h1 = $("<h1>").text(document.title);
            app.$helpTitle.append(h1);
            if(/\.md$/.test(helpFile)){
              app.__useMarkDown(app.$helpContent,app.$helpContent.text())
            }
          });

          app.$container.append(app.$helpArticle);
          app.$container.append(app.$helpOpenButton);
          app.$container.append(app.$helpCloseButton);
        });

      }
    } else {
      if(app.useMarkDown && MarkDownIt){
        this.__useMarkDown(app.$helpContent,_content);
      }else{
        app.$helpContent.html(_content);
      }
      var h1 = $("<h1>").text(document.title);
      app.$helpTitle.append(h1);

      app.$container.append(app.$helpArticle);
      app.$container.append(app.$helpOpenButton);
      app.$container.append(app.$helpCloseButton);
    }
  },
  addTitle: function (title) {
    var app = this;
    app.title = app.title || title;
    if (!app.title)return;
    //if (app.$title) {
    //    app.text(app.title);
    //} else {
    app.$title = $("<div>").addClass("title");//.text(app.title);
    //    //app.$container.append(app.$title);
    $(".canvas-container").prepend(app.$title);
    //}
    // app.titleObject = new fabric.Text(app.title, {
    //   top: 32,
    //   left: 60,
    //   fontSize: 20,
    //   fill: "white",
    //   fontFamily: "Open Sans",
    //   evented: false,
    //   layer: "interface",
    //   selectable: false
    // });
    // app.canvas.add(app.titleObject);
    // app.canvas.renderAll();
    // app.$title.width(app.titleObject.width + 20);
    // app.$title.height(app.titleObject.height);
  },
  uploadAction: function (img, options) {
    if (!img)return;
    var obj = new fabric.TransformedImage(img, options || {
        width: 300,
        height: (img.height / img.width ) * 300
      });
    this.canvas.add(obj);
    obj.center();
    obj.setCoords();
  }
};

fabric.demo = function(options){
  return new fabric.DemoApplication(options);
};

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 37 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {


var _bindEvents = fabric.Canvas.prototype._bindEvents;
var _onMouseDown_overwritten = fabric.Canvas.prototype._onMouseDown;
var _onMouseUp_overwritten = fabric.Canvas.prototype._onMouseUp;
var _initEventListeners_overwritten = fabric.Canvas.prototype._initEventListeners;
var removeListeners_overwritten = fabric.Canvas.prototype.removeListeners;

fabric.util.object.extend(fabric.Canvas.prototype, {
  tapholdThreshold: 2000,
  _bindEvents: function () {
    _bindEvents.call(this);
    this._onClick = this._onClick.bind(this);
    this._onDoubleClick = this._onDoubleClick.bind(this);
    this._onTapHold = this._onTapHold.bind(this);
  },

  _onDoubleClick: function (e) {
    var self = this;

    var target = self.findTarget(e);
    self.fire('mouse:dblclick', {
      target: target,
      e: e
    });

    if (target && !self.isDrawingMode) {
      // To unify the behavior, the object's double click event does not fire on drawing mode.
      target.fire('dblclick', {
        e: e
      });
    }
  },

  _onDrop: function (e) {
    var _zoom = this.getZoom();
    e.x /= _zoom;
    e.y /= _zoom;
    e.offsetX /= _zoom;
    e.offsetY /= _zoom;
    e.width = e.helper.width() / _zoom;
    e.height = e.helper.height() / _zoom;
    var self = this;
    e.target = self.findTarget(e.originalEvent);

    self.fire('mouse:drop', e);

    if (e.target && !self.isDrawingMode) {
      // To unify the behavior, the object's double click event does not fire on drawing mode.
      e.target.fire('object:drop', e);
    }
  },

  _onDragMove: function (e) {
    var self = this;

    var target = self.findTarget(e.originalEvent);
    self.fire('mouse:dragmove', {
      target: target,
      e: e,
      data: e.data
    });
    if (target && !self.isDrawingMode) {
      // To unify the behavior, the object's double click event does not fire on drawing mode.
      target.fire('object:dragmove', {
        e: e,
        data: e.data
      });
    }
    if (this._last_target == target)return;
    if (this._last_target) {
      self.fire('mouse:dragleave', {
        target: this._last_target,
        e: e,
        data: e.data
      });
      this._last_target.fire('object:dragleave', {
        e: e,
        data: e.data
      });
      this._last_target = false;
    }
    if (target) {

      self.fire('mouse:dragenter', {
        target: target,
        e: e,
        data: e.data
      });
      target.fire('object:dragenter', {
        e: e,
        data: e.data
      });

      this._last_target = target;
    }

  },

  _onClick: function (e) {
    var self = this;

    var target = self.findTarget(e);
    self.fire('mouse:click', {
      target: target,
      e: e
    });

    if (target && !self.isDrawingMode) {
      if (
        target.originalState.left == target.left &&
        target.originalState.top == target.top &&
        target.originalState.scaleX == target.scaleX &&
        target.originalState.scaleY == target.scaleY &&
        target.originalState.angle == target.angle
      ) {
        // To unify the behavior, the object's double click event does not fire on drawing mode.
        target.fire('object:click', {
          e: e
        });
      }
    }
  },

  _onTapHold: function (e) {
    var self = this;

    var target = self.findTarget(e);
    self.fire('touch:taphold', {
      target: target,
      e: e
    });

    if (target && !self.isDrawingMode) {
      // To unify the behavior, the object's tap hold event does not fire on drawing mode.
      target.fire('taphold', {
        e: e
      });
    }

    if (e.type === 'touchend' && self.touchStartTimer != null) {
      clearTimeout(self.touchStartTimer);
    }
  },

  _onMouseDown: function (e) {
    _onMouseDown_overwritten.call(this, e);
    var self = this;
    if (e.type === 'touchstart') {
      var touchStartTimer = setTimeout(function () {
        self._onTapHold(e);
        self.isLongTap = true;
      }, self.tapholdThreshold);
      self.touchStartTimer = touchStartTimer;
      return;
    }

    // Add right click support
    if (e.which === 3) {
      var target = this.findTarget(e);
      self.fire('mouse:down', {target: target, e: e});
      if (target && !self.isDrawingMode) {
        // To unify the behavior, the object's mouse down event does not fire on drawing mode.
        target.fire('mousedown', {
          e: e
        });
      }
    }
  },

  _onMouseUp: function (e) {

    _onMouseUp_overwritten.call(this, e);

    if (e.type === 'touchend') {
      // Process tap hold.
      if (this.touchStartTimer != null) {
        clearTimeout(this.touchStartTimer);
      }
      // Process long tap.
      if (this.isLongTap) {
        this._onLongTapEnd(e);
        this.isLongTap = false;
      }
      // Process double click
      var now = new Date().getTime();
      var lastTouch = this.lastTouch || now + 1;
      var delta = now - lastTouch;
      if (delta < 300 && delta > 0) {
        // After we detct a doubletap, start over
        this.lastTouch = null;

        this._onDoubleTap(e);
      } else {
        this.lastTouch = now;
      }
    }
  },

  _onDoubleTap: function (e) {
    var self = this;

    var target = self.findTarget(e);
    self.fire('touch:doubletap', {
      target: target,
      e: e
    });

    if (target && !self.isDrawingMode) {
      // To unify the behavior, the object's double tap event does not fire on drawing mode.
      target.fire('object:doubletap', {
        e: e
      });
    }
  },

  _onLongTapEnd: function (e) {
    var self = this;

    var target = self.findTarget(e);
    self.fire('touch:longtapend', {
      target: target,
      e: e
    });

    if (target && !self.isDrawingMode) {
      // To unify the behavior, the object's long tap end event does not fire on drawing mode.
      target.fire('object:longtapend', {
        e: e
      });
    }
  },

  _initEventListeners: function () {
    var self = this;
    _initEventListeners_overwritten.call(self);

    fabric.util.addListener(self.upperCanvasEl, 'click', self._onClick);
    fabric.util.addListener(self.upperCanvasEl, 'dblclick', self._onDoubleClick);

    self.on('object:scaling', function (e) {
      if (e.target && e.target._scaling_events_enabled) {
        e.target.fire("scaling", e.e);
      }
    });
    self.on('object:selected', function (e) {
      if (e.target) {
        e.target.fire("object:selected", e.e);
      }
    });
    self.on('mouse:over', function (e) {
      if (e.target) {
        e.target.fire("mouse:over", e.e);
      }
    });

    self.on('mouse:out', function (e) {
      if (e.target) {
        e.target.fire("mouse:out", e.e);
      }
    });

  },

  removeListeners: function () {
    var self = this;
    removeListeners_overwritten.call(self);


    fabric.util.removeListener(self.upperCanvasEl, 'click', self._onClick);
    fabric.util.removeListener(self.upperCanvasEl, 'dblclick', self._onDoubleClick);
  }
});

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 38 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

var isVML = function() { return typeof G_vmlCanvasManager !== 'undefined'; };

delete fabric.Rect.prototype.toObject;
fabric.Rect.prototype.storeProperties = ["*","rx","ry"];

fabric.INCLUDE_ALL = "*";

var _toObject_overwritten = fabric.Object.prototype.toObject;
fabric.SlideObject = {
  eventListeners: {},
  toObject: function (propertiesToInclude) {
    if(propertiesToInclude == fabric.INCLUDE_ALL){
      propertiesToInclude = [fabric.INCLUDE_ALL];
    }

    propertiesToInclude = propertiesToInclude || [];
    propertiesToInclude = propertiesToInclude.concat(this.storeProperties);


    var obj = _toObject_overwritten.call(this,propertiesToInclude);
    if(propertiesToInclude[0] !== fabric.INCLUDE_ALL){
      if (!this.includeDefaultValues) {
        this._removeDefaultValues(obj);
      }
    }

    if(this.storeProperties.indexOf("*") == -1) {
      for (var i in obj) {
        if (this.storeProperties.indexOf(i) == -1) {
          delete obj[i];
        }
      }
    }

    this.fire("before:object",{object: obj});
    return obj;
  },
  storeProperties: ['*'],
  optionsOrder: ["specialProperties"],

  /**
   * Sets object's properties from options
   * @param {Object} [options] Options object
   */
  setOptions: function(options) {
    this._setObject(options);
    // this._initGradient(options);
    // this._initPattern(options);
    // this._initClipping(options);
  },
  hasBoundsControls: true,
  _initEntity: function(options){
    options.application && options.application.fire("entity:created",{target: this, options: options});
  },
  initialize: function(options,callback){
    options = options || {};
    this._initEntity(options);
    // if(options.wholeCoordinates){
    //   var coordinates = ["left","top","width","height"];
    //   for(var i in coordinates){
    //     if(options[coordinates[i]]){
    //       options[coordinates[i]] = Math.round(options[coordinates[i]]);
    //     }
    //   }
    // }
    var _self = this;
    this._setObject(options,function(){
      _self.loaded = true;
      _self.fire("loaded");
      callback && callback(_self);
    });
  },
  flipTools:     false,
  orderTools:    false,
  add: function(canvas) {
    canvas.add(this);
  },
  set: function(key, value) {
    if (typeof key === 'object') {
      this._setObject(key);
    }
    else {
      if (key[0] == "&") {
        key = key.substr(1);
        this._set(key, value(this.get(key)));
      }
      else {
        this._set(key, value);
      }
    }
    return this;
  },
  stroke: "transparent",
  onTop: function () {
    return this.canvas._objects.indexOf(this) == this.canvas._objects.length - 1;
  },
  flop: function () {
    this.flipY = !this.flipY;
    this.canvas.renderAll();
  },
  flip: function () {
    this.flipX = !this.flipX;
    this.canvas.renderAll();
  },
  onBottom: function () {
    return this.canvas._objects.indexOf(this) == 0;
  },
  duplicate: function() {
    var _object = this.toObject(fabric.INCLUDE_ALL);
    _object.active = true;

    var _clone = _object.cloneSync && _object.cloneSync() || this.canvas.createObject(_object);
    return _clone;
  },
  insertDuplicate: false,
  insertRemove: false,
  insertBoundingRect: false,
  insertDimensions: false,
  insertPosition: false,
  minStrokeWidth: 0,
  maxStrokeWidth: function(){
    return Math.min(this.width,this.height) / 2;
  },
  actions: {
    boundingRect: {
      type: 'label',
      template: '<dt>L:</dt><dd class="{leftClass}" title="{left}">{roundLeft}</dd><dt>T:</dt><dd class="{topClass}"  title="{top}">{roundTop}</dd><dt>R:</dt><dd class="{rightClass}" title="{right}">{roundRight}</dd><dt>B:</dt><dd class="{bottomClass}"  title="{bottom}">{roundBottom}</dd>',
      value: {
        observe: "modified scaling moving rotating",
        get: function(){
          var _rect = this.getBoundingRect();

          if(this.movementLimits) {

            if (this.movementLimits == this.canvas) {
              var _v = this.canvas.viewportTransform;
              var _mlr = {
                left: _v[4],
                top: _v[5],
                width: (this.canvas.originalWidth || this.canvas.width) * _v[0],
                height: (this.canvas.originalHeight || this.canvas.height)  * _v[3],
                right: 0,
                bottom: 0
              }
            }else{
              _mlr = this.movementLimits.getBoundingRect();
            }


            _rect.bottom = this.movementLimits.height - _rect.height;
            var _t = _rect.top - _mlr.top;
            var _l = _rect.left - _mlr.left;
            var _r = _mlr.width - _rect.width - _l;
            var _b = _mlr.height - _rect.height - _t;
          }else{
            _t = _rect.top;
            _l = _rect.left;
            _b = this.canvas.height - _rect.height - _rect.top;
            _r  = this.canvas.width - _rect.width - _rect.left;
          }

          return {
            topClass: _t > 0 ? "positive" : _t < 0 ? "negative" : "zero",
            bottomClass: _b > 0 ? "positive" : _b < 0 ? "negative" : "zero",
            leftClass: _l > 0 ? "positive" : _l < 0 ? "negative" : "zero",
            rightClass: _r > 0 ? "positive" : _r < 0 ? "negative" : "zero",
            top:    _t,
            left:   _l,
            bottom: _b,
            right:  _r,
            roundTop:    Math.round(_t),
            roundLeft:   Math.round(_l),
            roundBottom: Math.round(_b),
            roundRight:  Math.round(_r)
          }
        }
      }
    },
    position: {
      title: 'position',
      type: 'menu',
      menu: {
        objectLeft: {
          type:   'number',
          title:  'left',
          value: {
            set: function (val) {
              this.left = val;
              this.fire("modified");
              this.canvas.fire("object:modified", {target: this});
              this.canvas.renderAll();
            },
            get: function () {
              return this.left;
            },
            observe: "modified"
          }
        },
        objectTop: {
          type:   'number',
          title:  'top',
          value: {
            set: function (val) {
              this.top = val;
              this.fire("modified");
              this.canvas.fire("object:modified", {target: this});
              this.canvas.renderAll();
            },
            get: function () {
              return this.top;
            },
            observe: "modified"
          }
        }
      }
    },
    dimensions: {
      title: 'dimensions',
      type: 'menu',
      menu:{
        objectWidth: {
          type:   'number',
          title:  'width',
          value: {
            set: function(val){
              this.saveState();
              this.dimensionsWidthValue = val;
              this.scaleToWidth(val *  this.canvas.getZoom());
              this.canvas.fireModifiedIfChanged(this);
              this.canvas.renderAll();
              delete this.dimensionsWidthValue;
            },
            get: function(){
              if(this.dimensionsWidthValue){
                return this.dimensionsWidthValue;
              }
              return Math.round(this.getBoundingRect().width / this.canvas.getZoom());
            },
            observe: "modified"
          }
        },
        objectHeight: {
          type:   'number',
          title:  'height',
          value: {
            set: function(val){
              this.saveState();
              this.scaleToHeight(val *  this.canvas.getZoom());
              this.dimensionsHeightValue = val;
              this.canvas.fireModifiedIfChanged(this);
              this.canvas.renderAll();
              delete this.dimensionsHeightValue;
            },
            get: function(){
              if(this.dimensionsHeightValue){
                return this.dimensionsHeightValue;
              }
              return Math.round(this.getBoundingRect().height / this.canvas.getZoom());
            },
            observe: "modified"
          }
        }
      }
    },
    center: {
      className:  'fa fa-bullseye',
      title: 'Center',
      action: function(){
        this.center();
        this.setCoords();
      }
    },
    objectFlip: {
      className:  'fa fa-arrows-h',
      insert:     'flipTools',
      title:      'flip',
      action:     'flip'
    },
    flop: {
      className:  'fa fa-arrows-v',
      insert:     'flipTools',
      title:      'flop'
    },
    bringForward: {
      insert:     'orderTools',
      title:      'bring forward',
      className:  'fa fa-level-up',
      disabled:   'onTop'
    },
    sendBackwards: {
      insert:     'orderTools',
      title:      'send backwards',
      className:  'fa fa-level-down',
      disabled:   'onBottom'
    },
    remove: {
      className:  'fa fa-trash',
      title:      'remove',
      key:        "Delete"
    },
    duplicate: {
      className:  'fa fa-clone',
      title:      'duplicate'
    }
  }
};
fabric.util.object.extend(fabric.Object.prototype, fabric.SlideObject);

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 39 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {


/**
 * @private
 * @param {String} eventName
 * @param {Function} handler
 */
function _removeEventListener(eventName, handler) {
  if (!this.__eventListeners[eventName]) {
    return;
  }
  var eventListener = this.__eventListeners[eventName];
  if (handler) {
    eventListener.splice(eventListener.indexOf(handler), 1)
  }
  else {
    eventListener.length = 0;
  }
}

fabric.Canvas.prototype.stopObserving = fabric.Object.prototype.stopObserving = function stopObserving(eventName, handler) {
  if (!this.__eventListeners) {
    return;
  }

  // remove all key/value pairs (event name -> event handler)
  if (arguments.length === 0) {
    for (eventName in this.__eventListeners) {
      _removeEventListener.call(this, eventName);
    }
  }
  // one object with key/value pairs was passed
  else if (arguments.length === 1 && typeof arguments[0] === 'object') {
    for (var prop in eventName) {
      _removeEventListener.call(this, prop, eventName[prop]);
    }
  }
  else {
    _removeEventListener.call(this, eventName, handler);
  }
  return this;
}


fabric.Observable.on = fabric.Canvas.prototype.on = fabric.Object.prototype.on = function (eventName, handler,priority) {
  if (eventName.constructor == Object) {
    for (var i in eventName) {
      this.on(i, eventName[i],priority)
    }
    return this;
  }
  var events = eventName.split(" ");
  for (var i in events) {
    eventName = events[i];
    this.observe(eventName, handler);
    if(priority){
      this.__eventListeners[eventName].unshift(this.__eventListeners[eventName].pop());
    }
  }
  return this;
};
fabric.Canvas.prototype.off = fabric.Object.prototype.off = function (eventName, handler) {
  var events = eventName.split(" ");
  for (var i in events) {
    this.stopObserving(events[i], handler)
  }
  return this;
};


fabric.Canvas.prototype.fire = fabric.Object.prototype.fire = function fire(eventName, options) {
  if (!this.__eventListeners) {
    return;
  }

  var listenersForEvent = this.__eventListeners[eventName];
  if (listenersForEvent) {
    for (var i = 0, len = listenersForEvent.length; i < len; i++) {
      listenersForEvent[i].call(this, options || {});
    }
  }

  var listenersForEventAll = this.__eventListeners['*'];
  if (listenersForEventAll) {
    options = options || {};
    options.eventName = eventName;
    options.listeners = listenersForEvent;
    for (i = 0, len = listenersForEventAll.length; i < len; i++) {
      listenersForEventAll[i].call(this, options);
    }
  }

  return this;
};

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 40 */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(fabric) {fabric.PluginsMixin = {
  runPlugins: function (pluginTypes, resolve, error) {

    var self = this;

    var plugins = this.plugins[pluginTypes].map(function(foo){
      var l = foo.length;
      if(!foo.length){
        var _result = foo.call(self);
        // (_result || _result === undefined) ? resolve() : fail();
        return _result;
      }else{
        return foo;
      }
    });

    for(var i = plugins.length ; i--;){
      if(typeof plugins[i] !== "function"){
        plugins.splice(i,1);
      }
    }
    if(plugins.length) {
      var wrap = fabric.util.promise.wrap(this);
      var _counter = plugins.length;
      for(var i in plugins){
        plugins[i].call(self,function(){
          if(!--_counter){
            resolve();
          }
        })
      }
    }else{
      resolve();
    }

  },
  addPlugin: function (type, name) {
    if(name.constructor == String){
      this.prototype.plugins[type].push(this.prototype[name]);
    }else{
      this.prototype.plugins[type].push(name);
    }
    return this;
  }
};

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 41 */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(fabric) {
fabric.util.object.extend(fabric.Project.prototype, {
  setAccess: function (access) {


    access = fabric.util.object.extend(this._access_properties, access || {});


    if (!access.guidlines)
      access["guidlines.edit"] = false;
    if (!access.photo)
      access["photo.edit"] = false;
    if (!access.text)
      access["text.edit"] = false;
    if (!access.clipart)
      access["clipart.edit"] = false;
    if (!access.background)
      access["background.edit"] = false;

    access.history = false;
    for (var i in access) {
      if (access[i]) {
        access.history = true;
        break;
      }
    }

    this.access = access;
  },
  _access_properties: {
    /**
     * оторажение инструментов и панелей с рамками и масками
     */
    "frames": true,
    /**
     * добавление и удаление ресурсов проекта (рамок, фото, бэкраундов, клипартов,масок)
     */
    "resources": true,
    /**
     * возможность добавления, удаления и перемещения фото
     */
    "photo": true,
    /**
     * возможность редактирования контента фотографий
     */
    "photo.edit": true,
    /**
     * возможность добавления, удаления и перемещения текста
     */
    "text": true,
    /**
     * возможность редактирования контента тектовых элементов
     */
    "text.edit": true,
    /**
     * возожность добавления, удаления и перемещения слайдов
     */
    "slides": true,
    /**
     * отображение гайдлайнов
     */
    "guidlines": true,
    /**
     * редактирование  гайдлайнов
     */
    "guidlines.edit": true,
    /**
     * доступность функций : перемещение по слоям и удаление
     */
    "edit": true,
    /**
     * доступность функции группировка и возможность работы с группами
     */
    "group": true,
    /**
     * возможность добавления, удаления и перемещения клипартов
     */
    "clipart": true,
    /**
     * возможность редактирования контента клипарта
     */
    "clipart.edit": true,
    /**
     * возможность добавления, удаления и перемещения , бэкграундов
     */
    "background": true,
    /**
     * возможность редактирования контента бэкграундов
     */
    "background.edit": true,
    /**
     * возможность редатирования размеров страниц и отступов
     */

    "template": true,
    /**
     * возможность редатирования данных о проекте
     */
    "general": true,
    /**
     * инструмент история (устанавливается автоматически)
     */
    "history": true

  }
});

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 42 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {
var History = __webpack_require__(11);

/**
 * Project class. Used for slides manipulation. add/remove/set active slide/move/replace slides
 * keep all information about current project
 * @param data
 * @constructor
 */
fabric.Project = function (options) {
  this.loaded = false;
  options = options || {};
  options.application.fire('entity:created',{target : this, options : options });
  this.initialize(fabric.util.object.deepExtend({},options));

};

fabric.Project.prototype = {
  type: "project",
  activeSlide: null,
  removeSlide: function (slide) {
    var _s = this.slides;
    var _curPos = _s.indexOf(slide);
    _s.splice(_curPos, 1);

    if(slide == this.activeSlide){
      delete this.activeSlide ;
    }
  },
  /**
   * move slide to another position
   * @param slide
   * @param newPosition
   */
  moveSlide: function (slide,newPosition) {
    var _s = this.slides;

    var _curPos = _s.indexOf(slide);
    newPosition = parseInt(newPosition);

    if (_curPos < newPosition) {
      _s.splice(_curPos, 1);
      _s.splice(newPosition,0, slide);
    } else {
      _s.splice(_curPos, 1);
      _s.splice(newPosition, 0, slide);
    }
  },
  /**
   * replace slide
   * @param slide
   * @param newPosition - position of the second slide
   */
  replaceSlide: function (slide,newPosition) {
    var _s = this.slides;
    var _replacedSlide = _s[newPosition];
    var _curPos = _s.indexOf(slide);
    if (_curPos < newPosition) {
      _s.splice(newPosition, 1, slide);
      _s.splice(_curPos, 1, _replacedSlide);
    } else {
      _s.splice(_curPos, 1, _replacedSlide);
      _s.splice(newPosition, 1, slide);
    }
  },
  storeProperties: ["title", "manifest", "limits", "templates"],
  toObject: function(propertiesToInclude,canvasPropertiesToInclude) {
    var _slidesData = [];
    for(var i in this.slides){
      _slidesData.push(this.slides[i].canvas.toObject(canvasPropertiesToInclude));
      //delete _slidesData[i].thumb;
    }
    var object = {};

    for(var i in this.storeProperties){
      var _prop = this.storeProperties[i];
      object[_prop] = this[_prop]
    }

    for(var i in propertiesToInclude){
      var _prop = propertiesToInclude[i];
      object[_prop] = this[_prop];
    }

    object.slides = _slidesData;

    return object;
  },
  updateSlideTemplate: function(slide) {
    slide.canvas.setTemplate(slide.canvas.template);
    this.canvas.template = slide.canvas.template;
    if(this.activeSlide  == slide){
      this.canvas.setTemplate(slide.canvas.template);
    }
  },
  updateTemplate: function(template) {
    for(var i in this.slides){
      if(this.slides[i].canvas.template == template){
        this.updateSlideTemplate(this.slides[i]);
      }
    }
  },
  defaultTemplate:  "",
  slides: [],
  url: "",
  title: "",
  manifest: {
    format: ""
  },
  limits: {
    max: 10,
    min: 2
  },
  templates: [],
  dpi: 200,
  _id_counter: 0,
  setCanvas: function (canvas) {
    this.canvas = canvas;
    this.canvas.project = this;
    if(this.history) {
      canvas.initHistory(this.history);
    }
    this.fire("canvas:initilized");
    // canvas.on('after:render', this.mirrorModified.bind(this) );
  },
  initialize: function (options) {

    fabric.util.object.extend(this, {
      last_id: 1,
      scaleValue: 1,
      activeSlide: null,
      history: null,
      slides: [],
      canvas: null
    });

    this.aligmentLineX = false;
    this.aligmentLineY = false;

    fabric.util.object.extend(this,options);
    fabric.util.object.defaults(options,this.defultOptions);

    // this.setAccess(this.access);

    if(options.gridsnapper !== undefined) {
      this.gridsnapper = options.gridsnapper
    }
    if(options.history !== undefined) {
      this.history = options.history;
    }
    if(options.data){
      this.data = options.data;
    }
    if(this.history) {
      this.history = new History(this);
      this.history.application = this.application;
    }


    if(options.canvas){
      var _canvas = new fabric.SlideCanvas(document.getElementById(options.canvas));
      _canvas.application = this.application;
      _canvas.project = this;
      this.setCanvas(_canvas);
    }

    return this;
  },
  load: function (data) {
    this.fire("loading",{type: "project"});

    data = data && fabric.util.object.cloneDeep(data) || this.data;
    // this.history && this.history.disable();
    this.activeSlide = null;
    this.slides = [];

    if (this.canvas) {
      this.canvas._objects.length = 0;
    }
    delete this.activeSlide;

    if(data.templates !== undefined){
      this.templates = data.templates;
    }

    for(var i in data.slides){
      this.addSlide(data.slides[i]);
    }
    delete data.slides;
    fabric.util.object.extend(this,data);

    this.preload();
    if(this.canvas){
      this.setActiveSlideByIndex(0);
    }else{
      this.lazyLoad();
    }
  },
  unloadUnactiveSlides: false,
  lazyLoadEnabled: true,
  setActiveSlide: function(slide){
    if(this.canvas.processing)return;
    if(this.activeSlide === slide)return;

    this.fire("slide:change:begin", {canvas: this.canvas});
    if(this.activeSlide) {
      delete this.activeSlide.canvas.mirrorSlide;
    }

    this.processing =true;
    if (this.unloadUnactiveSlides && this.canvas && this.activeSlide) {
      delete this.activeSlide.canvas;
      this.activeSlide.fire("canvas:changed",{canvas: null});
      this.activeSlide.data = this.canvas.toObject();
      this.canvas.clear();
    }
    this.activeSlide = slide;
    this.activeSlide.canvas.mirrorSlide = this.canvas;



    var _this = this;
    this.canvas.processing = true;

    if(this.activeSlide.canvas.loaded){
      _this.canvas.mirror(_this.activeSlide.canvas);
      _this.canvas.processing = false;
      _this.canvas.renderAll();
      _this.fire("slide:changed", {canvas: _this.canvas});
      _this.lazyLoad();
    }else{

      // _this.canvas.fire("loading:begin",{type:"current" , target: _this.canvas});
      this.activeSlide.canvas.load(slide.object, function () {
        _this.canvas.mirror(_this.activeSlide.canvas);
        _this.canvas.processing = false;
        _this.canvas.renderAll();
        _this.fire("slide:changed", {canvas: _this.canvas});
        // _this.canvas.fire("loading:end",{type:"current" , target: _this.canvas});
        _this.lazyLoad();
      });
    };
  },
  preload: function(){
    for(var i in this.slides) {
      var _slide = this.slides[i];
      // _slide.canvas.preload(_slide.object, function () {
      //   _slide.fire("modified");
      // });
    }
  },
  lazyLoad: function(){

    var _proj = this;
    if(this.lazyLoadEnabled){
      for(var i in this.slides){
        var _slide = this.slides[i];
        if(!_slide.canvas.loaded && !_slide.canvas.processing){
          _slide.canvas.load(_slide.object,function(){
            // this.fire("modified");
            _proj.fire("silde:loading:end", {target: this});
            for(var _s in _proj.slides){
              if(!_proj.slides[_s].canvas.loaded){
                return;
              }
            }
            _proj.fire("loading:end", {});
          });
        }
      }
    }else{
      _proj.fire("loading:end",{});
    }
  },
  mirrorModified: function(){
    this.activeSlide && this.activeSlide.fire("modified");
  },
  setActiveSlideByIndex: function(index){
    this.setActiveSlide(this.slides[index])
  },
  setActiveSlideById: function(id){
    this.setActiveSlide(  fabric.util.object.findWhere(this.slides,{id: id}));
  },
  getTemplate: function(id){
    id = id || this.defaultTemplate;
    for(var i in this.templates){
      if(this.templates[i].id == id)
        return this.templates[i];
    }
  },
  initHistory: function(){
    this.history = new History(this);
    this.history.application = this.application;

  },
  duplicateSlide: function (slideData) {

    slideData = slideData.canvas.toObject();
    var _slide = this.addSlide(slideData);
    _slide.canvas.load(_slide.object);
  },
  addSlide: function (slide) {

    slide = slide || {
        title : 'Новый Слайд'
      };
    slide.template = slide.template || this.defaultTemplate;
    if(slide.template) {
      slide.template = this.getTemplate(slide.template);
    }

    if(fabric.isLikelyNode){
      // fabric.Canvas = fabric.SlideCanvas;
      var w = slide.slideWidth || slide.template.width;
      var h = slide.slideHeight || slide.template.height;
      var zoom = fabric.SlideCanvas.prototype.zoom || 1;
      var _canvas = fabric.createCanvasForNode(w * zoom,h * zoom);
    }else{
      var _canvas =  new fabric.SlideCanvas({project: this, interactive: false});
    }

    var _object = {
      object: slide,
      data: slide.data,
      project: this,
      id:   ++this._id_counter,
      canvas : _canvas
    };

    fabric.util.observable(_object);

    this.slides.push(_object);
    return _object;
  },
  getPrice: function () {
    var _price = 0;
    for (var i in this.slides) {
      _price += parseFloat(this.slides[i].data.price) || 0;
    }
    return _price;
  },
  nextSlide: function () {
    var i = this.slides.indexOf(this.activeSlide);
    if (i < this.slides.length - 1) {
      this.setActiveSlide(i + 1);
    }
  },
  prevSlide: function () {
    var i = this.slides.indexOf(this.activeSlide);
    if (i > 0) {
      this.setActiveSlide(i - 1);
    }
  },
  gotoSlide: function (slide) {
    this.setActiveSlide(slide - 1);
  },
  nextSlideAvailable: function () {
    var i = this.slides.indexOf(this.activeSlide);
    return i < this.slides.length - 1
  },
  prevSlideAvailable: function () {
    var i = this.slides.indexOf(this.activeSlide);
    return i > 0
  },
  actions: {
    save: {
      title: "save project",
      className: 'fa fa-floppy-o',
      action: function () {
        var data = this.toObject();
        this.application.api.save(data);
      }
    }
  }
};
fabric.util.object.extend(fabric.Project.prototype,fabric.Observable);

fabric.util.object.extend(fabric.SlideCanvas.prototype, {
  /**
   * Copy the content of active slide to main canvas.
   * @param slide
   */
  mirror: function (slide) {
    this.discardActiveGroup();
    this.discardActiveObject();
    // this.slideWidth = slide.slideWidth;
    // this.slideHeight = slide.slideHeight;
    this.setOriginalSize({width: slide.originalWidth || slide.width, height: slide.originalHeight || slide.height})
    this.backgroundImage = slide.backgroundImage;
    this.setWidth((slide.originalWidth || slide.width)* this.viewportTransform[0]);
    this.setHeight((slide.originalHeight || slide.height)  * this.viewportTransform[0]);
    this._onResize();
    this.activeArea = slide.activeArea;
    this.originalSlide = slide;

    this.template = slide.template;
    this.offsets = slide.offsets;
    // this._objects = [];
    // this.layers = slide.layers;

    if(this.backgroundImage){
      this.backgroundImage.canvas = this;
    }
    //todo
    // if(this._backgroundLayer) {
    //   for (var i in this._backgroundLayer) {
    //     this._backgroundLayer[i].canvas = this;
    //     this._backgroundLayer[i].setCoords();
    //   }
    //   this.setActiveArea(true);
    // }cd fier

    for(var layerName in slide.layers) {
      this.layers[layerName].objects = [];
    }
    this._objects = this.layers.lower.objects;

    if(slide.layers) {
      for(var layerName in slide.layers){
        for (var i in slide.layers[layerName].objects) {
          this.add(slide.layers[layerName].objects[i]);
        }
        slide.layers[layerName].objects = this.layers[layerName].objects;
      }
      slide._objects = this._objects;
    }else{
      if(slide._objects) {
        for (var i in slide._objects) {
          this.add(slide._objects[i]);
        }
      }
      slide._objects = this._objects;
    }
    this.fire('changed', {target: slide})
  },
  project: null,
  unique: false,
  required: false,
  stateProperties: ["unique","required"],
  removeSlide: function(){
    this.project.removeSlide(this)
  },
  duplicateSlide: function(){
    this.project.duplicateSlide(this)
  }
});

fabric.util.createAccessors(fabric.Canvas);

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 43 */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(fabric, __dirname) {
fabric.Application.prototype.eventListeners["entity:created"].push(function(e){
  var target = e.target;

  target.application = this;
  fabric.util.object.defaults(e.options, this.getDefaultProperties(target,e.options));

  for(var key in e.options){
    var value = e.options[key];
    if(key[0] == "+"){
      var _key = key.substr(1);
      var _arr = target.get(_key);
      if(_arr instanceof Array){
        _arr = _arr.slice().concat(value);
      }else{
        _arr = fabric.util.object.extend({},_arr,value);
      }
      e.options[_key] = _arr;
      delete e.options[key];
    }
  }

  delete e.options.type;
  delete e.options.application;
});





fabric.util.object.extend(fabric.Application.prototype, {
  getDefaultProperties: function(proto){
    if(!this.prototypes)return;

    var klassname = fabric.util.string.capitalize(fabric.util.string.camelize(proto.type),true);

    var _protoProperties = proto.__proto__ && proto.__proto__.type && this.getDefaultProperties(proto.__proto__) || {};
    var _defaultProperties = fabric.util.object.clone(this.prototypes[klassname]);

    fabric.util.object.extend(_protoProperties,_defaultProperties);

    return _protoProperties;
  },
  /**
   * default prototypes propertes for objects
   */
  prototypes: {
    Object: {
      includeDefaultValues: false
    },
    Canvas: {
      includeDefaultValues: false
    }
  },
  initUtils: function () {

    if(!this.options.util){
      return;
    }
    fabric.util.object.extend(this.util || {},this.options.util);

    var _mediaRoot = this.options.util.mediaRoot;
    if(_mediaRoot){
      if((_mediaRoot.indexOf("./") == 0)){
        var _dirname;
        if(fabric.isLikelyNode){
          _dirname = __dirname;
        }else{
          _dirname = window.location.href + "/../"
        }
        _mediaRoot = fabric.util.path.resolve(_dirname + _mediaRoot);
      }
      var _last = _mediaRoot[_mediaRoot.length - 1];
      if(_last != "/" && _last != "\\"){
        _mediaRoot +="/"
      }
      _mediaRoot = fabric.util.path.resolve(_dirname + _mediaRoot);
      fabric.util.mediaRoot = _mediaRoot;
    }

    if (this.options['util']) {
      fabric.util.object.extend(fabric.util, this.options['util']);
    }
    if (this.options['fabric']) {
      fabric.util.object.extend(fabric, this.options['fabric']);
    }
    delete this.options['fabric'];
    delete this.options['util'];
  },
  initPrototypes: function () {

    var _prototypes = fabric.util.object.deepExtend({}, this.prototypes ,this.options.prototypes);

    this.prototypes = _prototypes;
    this.klasses = {};


    if(_prototypes.eventListeners){
      _prototypes.eventListeners.$extend = 'array';
    }

    for (var klassName in _prototypes) {
      var _proto = _prototypes[klassName];

      for (var j in _proto) {
        if (_proto[j] && _proto[j]["$extend"]) {
          var _extend = _proto[j]["$extend"];
          if( _extend == "array"){
            _proto[j] = fabric.util.object.extendArraysObject(fabric[klassName].prototype[j],_proto[j]);
          } else if( _extend == "deep"){
            _proto[j] = fabric.util.object.deepExtend(fabric[klassName].prototype[j],_proto[j]);
          }else{
            _proto[j] = fabric.util.object.extend(fabric[klassName].prototype[j],_proto[j]);
          }
          delete _proto[j]["$extend"];
        }
      }


      if(_proto["$super"]){
        var _superklass = fabric[_proto["$super"] || klassName] ;
        delete _proto["$super"];

        var _fromObject = _proto.fromObject || _superklass.fromObject ;
        delete _proto.fromObject;
        var _klass = this.klasses[klassName] = fabric.util.createClass(_superklass, _proto);
        _klass.fromObject = _fromObject.bind(_klass);
      }

    //   if (klassName.actions && _proto.actions.constructor == Function) {
    //     fabric[klassName].prototype.actions = _proto.actions.call(fabric[klassName].prototype)
    //   }
    }

    if (_prototypes.Application) {
      fabric.util.object.deepExtend(this, _prototypes.Application);
    }

    // delete this.options['prototypes'];

    if (this.actions && this.actions.constructor == Function) {
      this.actions = this.actions.call(this)
    }
  }
});

fabric.Application
  .addPlugin("configuration","initUtils")
  .addPlugin("configuration","initPrototypes");



/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0), "/"))

/***/ }),
/* 44 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.SlideCanvas = fabric.util.createClass(fabric.Canvas,fabric.PluginsMixin, {
  type: 'slide-canvas',
  _createUpperCanvasNative: fabric.Canvas.prototype._createUpperCanvas,
  width: 160 ,
  height: 90,
  dotsPerUnit: 1,
  scale: 1,
  loaded: false,
  insertBackgroundColor: false,
  plugins: {
    initialize: [
      function initZooming(options) {
        this.enableClipAreaZooming && this.enableClipAreaZooming();
      }
    ],
    preloaders: [
      function initTemplate(options){
        this.template && this.setTemplate(this.template);
      }
    ],
    loaders: [],
    savers : [
      function serializeThumb(propertiesToInclude, _data){
        if(propertiesToInclude.indexOf('thumb') !== -1){
          var size = fabric.util.getProportions(this.getOriginalSize(), this.thumbSize, 'fit');
          var canvas = fabric.util.createCanvasElement();
          canvas.width = size.width;
          canvas.height = size.height;
          this.renderThumb(canvas);
          _data.thumb = canvas.toDataURL();
        }
      },
      function serializeTemplate(propertiesToInclude, _data) {
        if (propertiesToInclude.indexOf('template') !== -1) {
          if (this.template) {
            for (var i in _data.template) {
              if (JSON.stringify(_data[i]) == JSON.stringify(_data.template[i])) {
                delete _data[i];
              }
            }
            _data.template = this.template.id;
          }
        }
      }
    ]
  },
  setInteractive: function (value) {
    this.interactive = value;
  }, /**
   * @private
   * @param {Object} [options] Options object
   */
  _initOptions: function (options) {
    this.width = this.width || parseInt(this.lowerCanvasEl.width, 10) || 0;
    this.height = this.height || parseInt(this.lowerCanvasEl.height, 10) || 0;

    if (!this.lowerCanvasEl.style) {
      return;
    }

    this.lowerCanvasEl.width = this.width;
    this.lowerCanvasEl.height = this.height;

    this.lowerCanvasEl.style.width = this.width + 'px';
    this.lowerCanvasEl.style.height = this.height + 'px';

    this.viewportTransform = this.viewportTransform.slice();
  },
  contextTopImageSmoothingEnabled: true,
  _createUpperCanvas: function () {
    this._createUpperCanvasNative();
    var ctx = this.contextTop;

    if(ctx.imageSmoothingEnabled){
      ctx.imageSmoothingEnabled = this.contextTopImageSmoothingEnabled;
      return;
    }
    ctx.webkitImageSmoothingEnabled = this.contextTopImageSmoothingEnabled;
    ctx.mozImageSmoothingEnabled    = this.contextTopImageSmoothingEnabled;
    ctx.msImageSmoothingEnabled     = this.contextTopImageSmoothingEnabled;
    ctx.oImageSmoothingEnabled      = this.contextTopImageSmoothingEnabled;
  },
  /**
   * @private
   * @param {Event} e Event object fired on mouseup
   */
  _onMouseUpInDrawingMode: function(e) {
    this._isCurrentlyDrawing = false;
    if (this.clipTo) {
      this.contextTop.restore();
    }
    var pointer = this.getPointer(e);
    this.freeDrawingBrush.onMouseUp(pointer);
    this._handleEvent(e, 'up');
  },
  initialize: function (el, options,callback) {
    if(el && el.constructor == Object){
      callback= options;
      options = el;
      el = null;
    }
    options = options || {};


    if(options.project){
      if(!options.application){
        options.application = options.project.application;
      }
    }

    if(options.application){
      options.application.fire("entity:created",{target : this , options : options});
    }

    this.id = fabric.SlideCanvas.__idcounter++;

    this._objects = [];
    this._createLowerCanvas(el);


    if(!this.virtual){
      this.created = true;


      this._currentTransform = null;
      this._groupSelector = null;
      this._initWrapperElement();
      this._createUpperCanvas();
      this._initEventListeners();
      this._initRetinaScaling();
      this.calcOffset();
      this.initLayers();

      //todo from layers module
      this.layers.upper = {
        zindex:     99,
        transform:  false,
        objects:    [],
        canvas:     this.upperCanvasEl,
        context:    this.contextTop
      };



      this._createCacheCanvas();
      this._setImageSmoothing();
      this._initRetinaScaling();
    }else{
      this.initLayers();
    }

    this.plugins.initialize.forEach(function(initializer){
      initializer.call(this, options);
    }.bind(this));

    if(options["+actions"]) {
      this.set("+actions", options["+actions"])
    }
    if(options.actions){
      this.set("actions",options.actions)
    }


    if(options && options.onResize){
      this.onResize = options.onResize;
    }

    if (this.requestAnimFrame) {
      this.addVideosSupport();
    }

    this._initOptions();

    this._setObject(options);

    this.calcOffset();

    this.on({
      'object:moving': function (obj) {
        this.fire('target:modified', this, obj)
      },
      'selection:cleared': function (event) {
        this.target.fire('deselected', event);
        this.target = null;
        this.fire('target:cleared', event);
      },
      'object:selected': function (event) {
        event.previous = this.target;
        this.target = event.target;
        if(event.previous){
          event.previous.fire('deselected', event);
        }
        this.fire('target:changed', event);
      },
      'group:selected': function (event) {
        this.target = event.target;
        this.fire('target:changed', event);
      }
    });

    // this.load(options,callback);

    this.fire("created");
    // if(this.application){
    //   this.application.fire("canvas:created",{target : this});
    // }
  },
  create: function () {
    this.created = true;
    this._initInteractive();
    this._createCacheCanvas();
  },
  storeProperties: ['*','backgroundImage','width','height'],
  toObject: function (propertiesToInclude) {

    propertiesToInclude = (propertiesToInclude || []).concat(this.storeProperties);

    var _self =  this;
    var _objs = this.getObjects();

    _objs = fabric.util.object.filter(_objs,{stored: true});
    _objs = _objs.map(function(instance) {
      return instance.toObject(_self.objectsPropertiesToInclude);
    });

    var _data = {
      objects: _objs
    };

    fabric.util.populateWithProperties(this, _data, this.propertiesToInclude);
    //
    // for(var i in propertiesToInclude){
    //   var _prop = propertiesToInclude[i];
    //   _data[_prop] = this[_prop];
    // }

    if(propertiesToInclude.indexOf('backgroundImage') !== -1){
      fabric.util.object.extend(_data, this.__serializeBgOverlay());
    }

    if(propertiesToInclude.indexOf('width') !== -1 && this.originalWidth){
      _data.width = this.originalWidth;
    }
    if(propertiesToInclude.indexOf('height') !== -1 && this.originalHeight){
      _data.height = this.originalHeight;
    }

    this.plugins.savers.forEach(function(saver){
      saver.call(this, propertiesToInclude, _data);
    }.bind(this));
    this.fire("before:object",{object: _data});

    return _data;
  },
  defaultText: "text",
  defaultTextType: "text",
  thumbSize: {
    width: 50,
    height: 100
  },
  setTemplate: function(template){

    this.template = template;
    if(!template)return;

    this.setWidth(this.slideWidth || template.width);
    this.setHeight(this.slideHeight || template.height);
    this.originalHeight = this.height;
    this.originalWidth = this.width;

    this.set(fabric.util.object.rearrange(template,["areas","helpers","offsets"]));

    this._update_clip_rect();
    this._update_background_image();
    this.fire("modified",{type: "template"});
    this.renderAll();
  },
  addText: function (text, options) {
    this.createObject({
      position: "center",
      text: text,
      type:   this.defaultTextType,
      clipTo: this.activeArea,
      movementLimits : this.activeArea
    });
  },
  uploadAction: function (img) {
    if (!img)return;
    this.createObject({
      position: "center",
      active: true,
      type:   this.uploadClass,
      image:  img,
      clipTo: this.activeArea,
      movementLimits : this.activeArea
    });
  },
  uploadClass: 'Image',
  uploadImageTool: false,
  addTextTool: false
});
fabric.SlideCanvas.__idcounter = 0;
fabric.SlideCanvas.fromJson = function(url,callback , element){
  fabric.util.data.loadJson(url,function(data){
    new fabric.SlideCanvas(element,data,callback)
  })
};

fabric.SlideCanvas.prototype.actions = fabric.util.object.extend({}, {
  //selectAll: {
  //  title: 'selectAll',
  //  type: 'key'
  //},
  backgroundColor : {
    type: "color"
  },
  addText: {
    insert: 'addTextTool',
    className:  'fa fa-font',
    title: 'text',
    action: function () {
      this.addText(this.defaultText,{});
    }
  },
  upload: {
    insert: 'uploadImageTool',
    className:  'fa fa-upload',
    key: 'U',
    title: 'upload image',
    action: function () {
      fabric.util.uploadImage(this.uploadAction.bind(this))
    }
  }
});

fabric.SlideCanvas.addPlugin = fabric.PluginsMixin.addPlugin.bind(fabric.SlideCanvas);

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 45 */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(fabric) {
fabric.util.object.extend(fabric.StaticCanvas.prototype,{
  /**
   * required to show video
   */
  addVideosSupport: function () {
    fabric.util.requestAnimFrame(function render() {
      this.renderAll();
      fabric.util.requestAnimFrame(render);
    }.bind(this));
  },
  find: function (options) {
    if (typeof options == "string"){
      options = {
        type: options
      }
    }
    return fabric.util.object.where(this._objects,options);
  },

  collection: function (type,options) {
    var classPrototype;
    var _applicationPrototype;
    if(typeof type == "function"){
      classPrototype =  type.prototype;
    }else if (typeof type == "string"){
      classPrototype = fabric[type].prototype
    }else if(type.type){
      classPrototype = fabric[type.type].prototype;
      options = type;
    }else{
      options = type;
    }
    options = options || {type: classPrototype.type};

    function makeFunction(foo){
      return function(){
        var options = arguments;
        this.forEach(function(obj){
          foo.apply(obj,options)
        });
        return this;
      }
    }

    var collectionProto;
    var _array = this.find(options);
    _array.canvas = this;
    _array.options = options;

    if(classPrototype) {
      if(this.application){
        _applicationPrototype = this.application.getDefaultProperties(classPrototype,{});
      }
      collectionProto = [];
      for(var i in classPrototype){
        if (typeof classPrototype[i] == "function") {
          collectionProto[i] = classPrototype[i];
        }
      }
      for(var i in _applicationPrototype){
        if (typeof _applicationPrototype[i] == "function") {
          collectionProto[i] = _applicationPrototype[i];
        }
      }
    }else{
      _array.forEach(function(_obj){
        if(!collectionProto) {
          collectionProto = [];
          for(var i in _obj) {
            if (typeof _obj[i] == "function") {
              collectionProto[i] = _obj[i];
            }
          }
        }else{
          for(var i in collectionProto){
            if(!_obj[i] || typeof _obj[i] !== "function"){
              delete collectionProto[i];
            }
          }
        }
      })
    }

    for(var i in collectionProto){
      collectionProto[i] = makeFunction( collectionProto[i] );
    }
    collectionProto.__proto = _array.__proto__;
    _array.__proto__ = collectionProto;


    _array.setCollection = function(_arr){
      this.length = 0;
      for(var i in _arr){
        this.push(_arr[i]);
      }
      return this;
    }
    _array.updateCollection = function(){
      var _arr = this.canvas.find(this.options);
      this.setCollection(_arr)
      return this;
    };

    _array.filter = function(){
      var _arr = this.__proto__.filter.apply(this,arguments);
      this.setCollection(_arr)
      return this;
    };

    return _array;
  },
  _update_background_image: function () {
    var photo = this.backgroundImage;
    if (!photo || photo.constructor == Object || photo.constructor == String) return;

    if (this.backgroundPosition == 'resize') {
      this.originalWidth = photo.width;
      this.originalHeight = photo.height;

    }else if (this.backgroundPosition != 'manual') {

      var _w  =  this.originalWidth || this.width,  _h = this.originalHeight || this.height;


      if(photo._originalElement){
        var size = fabric.util.getProportions(photo._originalElement, {
          width: _w,
          height: _h
        }, this.backgroundPosition);
      }else{
        size = {
          width: _w,
          height: _h
        }
      }


      var _l ;
      if(this.backgroundImage.originX == 'center'){
        _l = _w / 2;
      }else{
        _l = (_w - size.width) / 2 ;
      }
      var _t ;
      if(this.backgroundImage.originY == 'center'){
        _t = _h / 2;
      }else{
        _t = (_h - size.height) / 2 ;
      }


      this.backgroundImage.set({
        left: _l + this.viewportTransform[4],
        top:  _t + this.viewportTransform[5],
        width: size.width,
        height: size.height
      });
    } else {
      // var _orig = this.backgroundImage.getOriginalSize();
      // this.backgroundImage.set({
      //   originX: 'left',
      //   originY: 'top',
      //   left: 0, //this.viewportTransform[4],
      //   top: 0, //this.viewportTransform[5],
      //   width: _orig.width,
      //   height: _orig.height
      // });
    }
  },
  setBackgroundImage: function (bg, callback) {
    var _bgimageLoaded = function (el){

      this.backgroundImage = el;
      this.backgroundImage.canvas = this;
      this._update_background_image();
      if(!this.originalWidth && !this.originalHeight){
        this.originalWidth = el.width;
        this.originalHeight = el.height;
      }
      this.fire("background-image:loaded",{target: el});
      callback && callback();
    }


    if (!bg) {
      this.backgroundImage = null;
      return callback();
    }
    if (bg instanceof HTMLImageElement || bg instanceof Image){

      var el = new fabric.Image(bg,{
        width: bg.naturalWidth,
        height: bg.naturalHeight
      });

      _bgimageLoaded.call(this,el);
    }
    if (bg.constructor == String) {
      bg = {
        src: bg
      }
    }
    var _proto = this.application.prototypes;
    if(_proto && _proto.SlideCanvas && _proto.SlideCanvas.backgroundImageProperties){
      fabric.util.object.extend(bg,_proto.SlideCanvas.backgroundImageProperties);
    }
    bg.application = this.application;
    bg.type = bg.type || "image";
    // bg.width = bg.naturalWidth;
    // bg.height = bg.naturalHeight;
    //
    fabric.util.createObject(bg,_bgimageLoaded.bind(this));
  },
    createObjects: function(objects,callback){

    if(this.application){
      for(var i in objects){
        if(objects[i].constructor == String){
          objects[i] = this.application.objects[objects[i]];
        }
      }
    }

    var _canvas = this;

    function success(_objects) {
      _canvas.fire("progress:complete", {objects: objects});
      for (var i in _objects) {
        _canvas.add(_objects[i].object);
      }
      _canvas.renderAll();
      callback && callback.call(_canvas)
    }

    function progress(l, t) {
      _canvas.fire("progress", { loaded : l, total : t });
      if (fabric.util.loaderDebug) {
        console.log("loaded " + l + " / " + t);
      }
    }


    var _objects = [];
    if (!objects || !objects.length) {
      this.fire("progress:complete", 0);
      success(_objects);
      return;
    }

    var queueLoadCallback = fabric.util.queueLoad(objects.length, function(){
      success(_objects)
    }, progress);

    queueLoadCallback.data = (this.title || "") + "objects";

    for (var i in objects) {
      (function (options) {
        var _object_slot = {object: null, options: options};
        _objects.push(_object_slot);

        options.application = _canvas.application;
        fabric.util.createObject(options, function (el) {
          _object_slot.object = el;
          queueLoadCallback();
        });
      }).call(this, objects[i]);
    }
  },
  applyOptions: function(filter,options){
    this._objects.forEach(function(_obj){
      for(var prop in filter){
        if(_obj[prop] !==  filter[prop])return;
      }
      _obj.setOptions(options);
    })
  },
  createObject: function (type, options,callback) {
    if(typeof type !== "string"){
      callback = options;
      options = fabric.util.object.clone(type);
      type = null;
    }else{
      options = fabric.util.object.clone(options);
      options.type = type;
    }

    var _self = this;
    options.application = this.application;
    var _active = options.active;
    var _position = options.position;
    delete options.active;
    delete options.position;


    function _add(el) {
      if(el.canvas)return;
      if(_position == "center") {
        _self.center(el);
      }
      _self.add(el);

      if(_active){
        _self.setActiveObject(el);
      }
      callback && callback(el);
    }

    var el = fabric.util.createObject(options,_add );
    el && _add(el);
    return el;
  },
  onLoad: function (callback) {
    this.processing =false;
    this.loaded = true;
    this.fire("loading:end",{type: "slide", target: this});
    this.renderAll();
    callback && callback.call(this);
  },
  load: function (options,callback) {
    this.originalWidth = 0;
    this.originalHeight = 0;
    if (!options)return;

    if(!this.virtual){
      this.clear();
    }

    if(options.width){
      options.originalWidth = options.width;
      options.originalHeight = options.height;
    }

    this.processing = true;
    this.fire("loading:begin",{type: "slide", target: this});

    this.set(options,this.onLoad.bind(this,callback));


    this.plugins.preloaders.forEach(function(preloader){
      preloader.call(this, options);
      this.onResize();
    }.bind(this));

  },
  setObjects: function(objects,callback){

    this.createObjects(objects,function(){
      for(var i in this._objects){
        this._objects[i].setCoords();
      }
      callback();
    });
  },
  optionsOrder: ["originalWidth","originalHeight","width","height"],
  onResize: function(){
    var _scale = Math.min(1,800 /this.width );
    // this.setZoom(_scale);
    this.setDimensions({width: this.width,height: this.height});
  },
  center: function (el) {
    var _rect, maxSize, offsets;

    if(el.movementLimits && el.movementLimits.constructor !== Function){
      var lim = el.movementLimits;
      _rect = {
        left:   lim.left * lim.scaleX,
        width:  lim.width * lim.scaleX ,
        top:    lim.top * lim.scaleY,
        height: lim.height * lim.scaleY
      };
      maxSize = _rect;
      offsets = lim;
    }else{
      var _zoom = this.getZoom();
      var _w = this.originalWidth || this.width / _zoom;
      var _h = this.originalHeight || this.height / _zoom;
      _rect = {
        width: this.offsets ? (_w - this.offsets.left - this.offsets.right) : _w,
        height: this.offsets ?(_h - this.offsets.top - this.offsets.bottom) : _h
      };
      offsets = {
        left: this.offsets && this.offsets.top ||0 ,
        top:  this.offsets &&  this.offsets.left ||0
      }
    }
    maxSize = {
      width: _rect.width * this.fitIndex,
      height: _rect.height * this.fitIndex
    };
    var size = fabric.util.getProportions(el, maxSize, 'fit');

    el.setOptions({
      scaleX: size.scale,
      scaleY: size.scale,
      top: offsets.top  + _rect.height / 2 - size.height / 2,
      left:offsets.left + _rect.width / 2  - size.width / 2
    });
    el.setCoords();
  },
  fitIndex: 0.8,
  setOriginalSize: function (w, h) {
    this.originalWidth = h ? w : (w.naturalWidth || w.width);
    this.originalHeight = h ? h : (w.naturalHeight || w.height);
    return this;
  }
});

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 46 */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(fabric) {
fabric.debug = true;

fabric.util.data = __webpack_require__(15);
fabric.util.path = __webpack_require__(6);
fabric.util.compile = __webpack_require__(5);
fabric.util.loader = __webpack_require__(16);
fabric.util.object.extend(fabric.util.object,__webpack_require__(1));
fabric.util.object.extend(fabric.util,__webpack_require__(2));

__webpack_require__(14);


if(!fabric.isLikelyNode){
  /**
   * inline script images
   * @type {{error: string}}
   */
  fabric.media = {
    /**
     * replace images loaded with errors
     */
    error: 'data:image/svg+xml;base64,' + __webpack_require__(13)
  };
}

module.exports  = fabric;

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 47 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {


fabric.RemoveWhiteDP = fabric.Image.filters.RemoveWhiteDP =  fabric.util.createClass(fabric.Image.filters.BaseFilter,{
    type: 'RemoveWhiteDP',
    initialize: function(options) {
        if(options)delete options.type;
        this.options = fabric.util.object.defaults(options || {},{
                fromCorners : true,
                blurRadius: 2,
                colorThreshold: 32
            });
        this.pathfinder = new fabric.Pathfinder(this.options);
    },
    applyTo: function(canvasEl) {

        var pathfinder = this.pathfinder;

        pathfinder.colorThreshold = this.options.colorThreshold;
        pathfinder.setPicture(canvasEl);
        pathfinder.selectBackground(this.options.fromCorners);
        if(pathfinder.mask.count ) {
          pathfinder._fill([0, 0, 0, 0]);
          pathfinder.mask = fabric.MagicWand.invertMask(pathfinder.mask);
          //todo inverting mask

          if(pathfinder.mask.count){
            var _width = pathfinder.mask.bounds.maxX - pathfinder.mask.bounds.minX + 1;
            var _height = pathfinder.mask.bounds.maxY - pathfinder.mask.bounds.minY + 1;
            var ctx = canvasEl.getContext('2d');
            var imageData = pathfinder.editedImageCanvas.getContext('2d').getImageData(pathfinder.mask.bounds.minX, pathfinder.mask.bounds.minY, _width, _height);
            canvasEl.width  = _width;
            canvasEl.height = _height;
            ctx.putImageData(imageData, 0, 0);
            this.bounds = pathfinder.mask.bounds;
          }else{
            var ctx = canvasEl.getContext('2d');
            canvasEl.width  = 1;
            canvasEl.height = 1;
            ctx.clearRect(0,0,1,1);
            this.bounds = {
              maxX: 0,
              maxY: 0,
              minX: 0,
              minY: 0
            }
          }
        }



            //clip the image
        pathfinder.clearMemory();

    },
    toObject: function() {
        return fabric.util.object.extend(this.callSuper('toObject'), this.options);
    }
});

fabric.Image.filters.RemoveWhiteDP.fromObject = function(object) {
    return new fabric.Image.filters.RemoveWhiteDP(object);
};

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 48 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {


fabric.ResizeDP =fabric.Image.filters.ResizeDP = fabric.util.createClass(fabric.Image.filters.Resize, /** @lends fabric.Image.filters.Resize.prototype */ {
  applyTo: function (canvasEl, dW, dH) {


    var oW = canvasEl.width, oH = canvasEl.height,   imageData;

    var scaleX = dW / oW;
    var scaleY = dH / oH;
    this.rcpScaleX = 1 /  scaleX;
    this.rcpScaleY = 1 / scaleY;
    if (this.resizeType === 'sliceHack') {
      imageData = this.sliceByTwo(canvasEl, oW, oH, dW, dH);
    }
    if (this.resizeType === 'hermite') {
      imageData = this.hermiteFastResize(canvasEl, oW, oH, dW, dH);
    }
    if (this.resizeType === 'bilinear') {
      imageData = this.bilinearFiltering(canvasEl, oW, oH, dW, dH);
    }
    if (this.resizeType === 'lanczos') {
      imageData = this.lanczosResize(canvasEl, oW, oH, dW, dH);
    }
    canvasEl.width = dW;
    canvasEl.height = dH;
    canvasEl.getContext('2d').putImageData(imageData, 0, 0);
  }
});

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 49 */
/***/ (function(module, exports) {

$.fn.absolutePosition = function() {

  var off = this.offset(),  pos = this.position();
  var scroll = {top: document.documentElement.scrollTop || document.body.scrollTop || window.scrollY || 0, left:document.documentElement.scrollLeft || document.body.scrollLeft || window.scrollX || 0, bottom : document.documentElement.scrollHeight - $(window).height(), right: document.documentElement.scrollWidth - $(window).width()}
  var margin = {top: getValue(this.css("margin-top")), left: getValue(this.css("margin-left")) ,bottom: getValue(this.css("margin-bottom")), right: getValue(this.css("margin-right"))};

  function getValue(val){if(val == "auto") return 0 ;var num =  parseInt(val);return isNaN(num) ? 0 : num;}

  var border_offset = getValue(this.css("border-width")) * 2;

  return { top:     off.top, left:    off.left, bottom:  $(window).height() - off.top  - margin.bottom + scroll.bottom - this.height() - border_offset, right:   $(window).width() - off.left  - margin.right + scroll.right - this.width()};
};

$.fn.dpResizable = $.fn.resizable = function(scope) {
  var p = this[0];


  p.className = p.className + ' resizable';
  var resizer = document.createElement('div');
  resizer.className = 'resizable-se';
  p.appendChild(resizer);
  resizer.addEventListener('mousedown', initDrag, false);


  var startX, startY, startWidth, startHeight;

  function initDrag(e) {
    startX = e.clientX;
    startY = e.clientY;
    startWidth = parseInt(document.defaultView.getComputedStyle(p).width, 10);
    startHeight = parseInt(document.defaultView.getComputedStyle(p).height, 10);
    document.documentElement.addEventListener('mousemove', doDrag, false);
    document.documentElement.addEventListener('mouseup', stopDrag, false);
    e.preventDefault();
    e.stopPropagation();
  }

  function doDrag(e) {
    p.style.width = (startWidth + e.clientX - startX) + 'px';
    p.style.height = (startHeight + e.clientY - startY) + 'px';
    e.preventDefault();
    e.stopPropagation();
  }

  function stopDrag(e) {
    document.documentElement.removeEventListener('mousemove', doDrag, false);
    document.documentElement.removeEventListener('mouseup', stopDrag, false);
    e.preventDefault();
    e.stopPropagation();
  }
};

$.fn.dpDraggable = $.fn.draggable = function(scope) {
  var element = this;
  scope = scope || {
      button: 0,
      onChange:   null,
      ngModel:    null,
      onMove:     null,
      onCancel:   null,
      onDrop:     null,
      draggable:  "self",//"helper",
      draggableArea: null,
      droppable:  "[droppable]"
    };




  scope.excludeElements = scope.excludeElements || ".no-drag";
  scope.includeElements = scope.includeElements || ".drag-on";
  scope.draggable = scope.draggable || "self";
  scope.droppable = scope.droppable || "[droppable]";

  /**
   * при нажатииклавиши мыши на объекте - подготовливаемся к перетаскиванию.
   */
  function prepareForDrag(event){

    var _tags = "INPUT|SELECT|TEXTAREA|BUTTON";
    if(_tags.indexOf(event.target.tagName)!= -1 ){
      return;
    }

    if(scope.button && (event.button != scope.button)){
      return;
    }


    var _touch = event.type == "touchstart";
    options = {
      targetEl: event.target,
      hoverEl: null,
      _last_event:  _touch? event.originalEvent.changedTouches[0] : event,
      touch: _touch
    };

    if(scope.draggable == "false"){
      return;
    }

    var _parents = $(options.targetEl).parents();
    _parents.splice(0,0,options.targetEl);
    for(var i = 0; i < _parents.length; i++){
      if($(_parents[i]).is(scope.includeElements)){
        break;
      }
      if($(_parents[i]).is(scope.excludeElements)){
        return;
      }
      if(_parents[i] == element[0]){
        break;
      }
    }

    event.preventDefault();
    event.stopPropagation();

    $(document).on('mousemove touchmove', handleDragStart);
    $(document).on('mouseup touchend', handleDragCancel);
  }

  /**
   * изменение данных объекта droppable
   * @param e
   */
  function onChange(e){

    options.value = options.hoverEl && options.hoverEl.attr("value") || false;

    scope.onChange && scope.onChange({
      $event: e,
      $data:  scope.ngModel,
      $value:  options.value
    });
  }
  /**
   * поиск элемнета droppable под курсором
   * @param e
   */
  function hoverDroppable(e) {
    if(!options.areaEl)return;
    var _drop = scope.droppable || "[droppable]";

    var _hovered = false;
    var els = options.areaEl.find(_drop);

    if(options.areaEl.is(_drop)){
      els.push(options.areaEl[0])
    };

    els.each( function () {

      var el = $(this);
      var pos = el.absolutePosition();

      if (e.pageX > pos.left && e.pageX < pos.left + el.width() &&
        e.pageY > pos.top  && e.pageY < pos.top  + el.height()){

        _hovered = true;

        if(!options.hoverEl || options.hoverEl[0] != el[0]){
          el.addClass("hover");
          options.hoverEl = el;
          onChange(e);
        }
        options.hoverX = e.pageX - pos.left;
        options.hoverY = e.pageY - pos.top;
      }else{
        el.removeClass("hover");
      }

    });

    if(!_hovered){
      options.hoverEl = null;
      delete options.hoverX;
      delete options.hoverY;
      onChange(e);
    }
  }

  /**
   * перемеение элемента
   * @param event
   */
  function handleDragMove(event) {
    event.preventDefault();

    var e =  options.touch? event.originalEvent.changedTouches[0] : event;

    if(options.areaEl){
      var pos_area =  options.areaEl.absolutePosition();

      var _top = e.pageY - options.helperStartOffsetY - pos_area.top + options.marginTop + options.areaEl[0].scrollTop;
      var _left =  e.pageX - options.helperStartOffsetX - pos_area.left + options.marginLeft + options.areaEl[0].scrollLeft;

    }else{
      var _top = e.pageY - options.helperStartOffsetY + options.marginTop ;
      var _left = e.pageX - options.helperStartOffsetX + options.marginLeft;
    }

    if(element.hasClass("draggable-limited")){
      var _w = element.outerWidth(), _h = element.outerHeight();
      if(_top < options.marginTop){
        _top = options.marginTop;
      }
      if(_left < options.marginLeft){
        _left = options.marginLeft;
      }
      if(_left > options.areaEl.outerWidth() - _w + options.marginLeft){
        _left = options.areaEl.outerWidth() - _w + options.marginLeft;
      }
      if(_top > options.areaEl.outerHeight() - _h + options.marginTop){
        _top = options.areaEl.outerHeight() - _h + options.marginTop;
      }
    }


    if(options._helper){

      options._helper.css({
        top:   _top,
        left:   _left
      });
    }

    hoverDroppable(e);

    var $options = {
      originalEvent: e,
      element: element,
      event: e,
      data: scope.ngModel,
      helper: options._helper,
      x: _left,
      y: _top ,
      dropEl:  options.hoverEl,
      dragEl: options.dragEl,
      areaEl: options.areaEl,
      offsetX: options.helperStartOffsetX,
      offsetY: options.helperStartOffsetY
    };

    e.data = scope.ngModel;

    if(options.hoverEl){

      scope.onMove && scope.onMove({
        $event: $options,
        $data: scope.ngModel
      })
    }
  }


  /**
   * завершаем перетаскивание
   * @param e
   */
  function handleDragEnd(e) {
    e.preventDefault();
    e.stopPropagation();
    element.removeClass("draggable");
    $(document).off('mousemove touchmove', handleDragMove);
    $(document).off('mouseup touchend', handleDragEnd);

    if(options.hoverEl){
      options.hoverEl.removeClass("hover");
    }

    if(!options.hoverEl || !options.hoverEl.length ){

      scope.onCancel && scope.onCancel({
        $event: e,
        $data: scope.ngModel,
        helper: options._helper,
        dragEl: options.dragEl,
        areaEl: options.areaEl
      });

      if(scope.draggable == "helper"){
        options._helper.remove();
      }else{
        //element.css({
        //    top: 0,
        //    left: 0
        //});
      }

    }else{


      // var foo = scope.onDrop && scope.onDrop || options.hoverEl[0].onDrop;

      var $options = {
        originalEvent: e,
        data: scope.ngModel,
        helper: options._helper,
        x: options.hoverX,
        y: options.hoverY,
        value: options.value,
        dropEl:  options.hoverEl,
        dragEl: options.dragEl,
        areaEl: options.areaEl,
        offsetX: options.helperStartOffsetX,
        offsetY: options.helperStartOffsetY,
        callback: function(){
          if(scope.draggable == "helper") {
            options._helper.remove();
          }
        }
      };

      var _remove = scope.onDrop({
        $event:     $options,
        $value:     options.value,
        $callback:  options.callback
      });
      if(_remove !== false && scope.draggable == "helper"){
        options._helper.remove();
      }else{
        //element.css({
        //    top: 0,
        //    left: 0
        //});
      }
    }
    //scope.$apply();
  }


  /**
   * создаем копию перетаскиваемого элемента
   * @param e
   */
  function createHelper(e){
    options._helper = element.clone();
    var pos =  element.absolutePosition();
    var pos_area =  options.areaEl.absolutePosition();


    options._helper.find(".no-helper").remove();

    options._helper.css({
      height:             element.outerHeight(),
      display:            "inline-block",
      "z-index":          e.pageX ? 10000 : 9999,
      //"pointer-events":   "none",
      position:           "absolute",
      left:               pos.left - pos_area.left,
      top:                pos.top - pos_area.top
    })
      .attr("draggable","false")
      .appendTo(options.areaEl);

    options.dragEl = element;

    options._helper.addClass("draggable-helper");

  }

  /**
   * Начинаем перетаскивание
   * @param e
   */
  function handleDragStart(event) {
    var e =  options.touch? event.originalEvent.changedTouches[0] : event;

    if(Math.abs(options._last_event.pageX - e.pageX) < 1 && Math.abs(options._last_event.pageY - e.pageY) < 1){
      return;
    }

    $(document).off('touchmove mousemove', handleDragStart);
    $(document).off('touchend mouseup', handleDragCancel);


    event.preventDefault();
    element.addClass("draggable");

    var _parent =  $(element.parents()[0]);
    if(scope.draggableArea){
      options.areaEl = $(scope.draggableArea);
    }else{
      options.areaEl = _parent;
    }

    var pos =  element.absolutePosition();
    options.helperStartOffsetX = e.pageX - pos.left ;
    options.helperStartOffsetY = e.pageY - pos.top;


    options.marginLeft = 0;
    options.marginTop = 0;
    if(scope.draggable == "helper"){
      createHelper(e);
      options.dragData = scope.ngModel;
    }else if(scope.draggable == "self"){
      options._helper = element;
      options.marginLeft = 0;
      options.marginTop = 0;
      //if(_parent != options.areaEl){
      //    options.marginLeft =  + options.areaEl.offset().left;
      //    options.marginTop = + options.areaEl.offset().top;
      //}
    }

    scope.onDrag && scope.onDrag({
      $event: e,
      $data: scope.ngModel
    });


    $(document).on('mousemove touchmove', handleDragMove);
    $(document).on('mouseup touchend', handleDragEnd);
  }

  /**
   * drag не происходит
   */
  function handleDragCancel(){

    $(document).off('mousemove touchmove', handleDragStart);
    $(document).off('mouseup touchend', handleDragCancel);

  }

  this.on('mousedown touchstart', prepareForDrag);
  return this;
};



/***/ }),
/* 50 */
/***/ (function(module, exports, __webpack_require__) {

/**
 * Font Selector - jQuery plugin 0.1
 *
 * Copyright (c) 2012 Chris Dyer
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following
 * conditions are met:
 *
 * Redistributions of source code must retain the above copyright notice, this list of conditions and the following
 * disclaimer. Redistributions in binary form must reproduce the above copyright notice, this list of conditions
 * and the following disclaimer in the documentation and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING,
 * BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO
 * EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;
 * OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
 * SUCH DAMAGE.
 *
 */



(function (factory) {
  if (true) {
    module.exports = factory(__webpack_require__(12));
  } else {
    factory(jQuery);
  }
}(
    function( $ ) {

  'use strict';
  //if(_ && _.styleSheetContains && !_.styleSheetContains('.fontSelect')){
  //  _.linkCSS(_.scriptURL() + "/../../css/jquery.fontSelector.css");
  //}

  var settings;

  var methods = {
    init : function(options) {

      settings = $.extend( {
        'hide_fallbacks' : false,
        'selected' : function(style) {},
        'opened' : function() {},
        'closed' : function() {},
        'initial' : '',
        'fonts' : []
      }, options);

      var root = this;
      var $root = $(this);
      root.selectedCallback = settings['selected'];
      root.openedCallback = settings['opened'];
      root.closedCallback = settings['closed'];
      var visible = false;
      var selected = false;
      var openedClass = 'fontSelectOpen';

      var displayName = function(font) {
        if (settings['hide_fallbacks']){
          var index = font.indexOf(',');
          if(index == -1 )return font;
          return font.substr(0, index);
        }else
          return font;
      }


      var select = function(font,initial) {
        root.find('span').html(displayName(font).replace(/["']{1}/gi,""));
        root.css('font-family', font);
        selected = font;

        if(!initial)root.selectedCallback(selected);
      }

      var positionUl = function() {
        var left, top;
        left = $(root).offset().left;
        top = $(root).offset().top + $(root).outerHeight();

        $(ul).css({
          'position': 'absolute',
          'left': left + 'px',
          'top': top + 'px',
          'width': $(root).outerWidth() + 'px'
        });
      }

      var closeUl = function() {
        ul.slideUp('fast', function() {
          visible = false;
        });

        $root.removeClass(openedClass);

        root.closedCallback();
      }

      var openUi = function() {
        ul.slideDown('fast', function() {
          visible = true;
        });

        $root.addClass(openedClass);

        root.openedCallback();
      }

      // Setup markup
      $root.prepend('<span>' + settings['initial'].replace(/'/g,'&#039;') + '</span>');
      var ul = $('<ul class="fontSelectUl"></ul>').appendTo('body');
      ul.hide();
      positionUl();

      for (var i = 0; i < settings['fonts'].length; i++) {
        var item = $('<li>' + displayName(settings['fonts'][i]) + '</li>').appendTo(ul);
        item.css('font-family', settings['fonts'][i]);
        item[0].data = settings['fonts'][i];
      }

      if (settings['initial'] != '')
        select(settings['initial'],true);

      ul.find('li').click(function() {

        if (!visible)
          return;

        positionUl();
        closeUl();

        select(this.data);
      });

      $root.click(function(event) {

        if (visible)
          return;

        event.stopPropagation();

        positionUl();
        openUi();
      });

      $('html').click(function() {
        if (visible)
        {
          closeUl();
        }
      })
    },
    selected : function() {
      return this.data;
    },
    select : function(font) {
      this.find('span').html(font.substr(0, font.indexOf(',')).replace(/["']{1}/gi,""));
      this.css('font-family', font);
      var selected = false;
      selected = font;
    }
  };
  $.fontSelector = {

  };

  $.fn.fontSelector = function(method) {
    if ( methods[method] ) {
      return methods[ method ].apply( this, Array.prototype.slice.call( arguments, 1 ));
    } else if ( typeof method === 'object' || ! method ) {
      return methods.init.apply( this, arguments );
    } else {
      $.error( 'Method ' +  method + ' does not exist on jQuery.fontSelector' );
    }
  }
}));


/***/ }),
/* 51 */
/***/ (function(module, exports, __webpack_require__) {

/*
 * jQuery MiniColors: A tiny color picker built on jQuery
 *
 * Copyright: Cory LaViska for A Beautiful Site, LLC: http://www.abeautifulsite.net/
 *
 * Contribute: https://github.com/claviska/jquery-minicolors
 *
 * @license: http://opensource.org/licenses/MIT
 *
 */



(function (factory) {
  if (true) {
    module.exports = factory(__webpack_require__(12));
  } else {
    factory(jQuery);
  }
}(
  function ($) {

    'use strict';
    //if(_ && _.styleSheetContains && !_.styleSheetContains('.minicolors')){
    //  _.linkCSS(_.scriptURL() + "/../../css/jquery.minicolors.css");
    //}

    // Defaults
    $.minicolors = {
      defaults: {
        animationSpeed: 50,
        animationEasing: 'swing',
        change: null,
        changeDelay: 0,
        control: 'hue',
        dataUris: true,
        defaultValue: '',
        format: 'hex',
        hide: null,
        hideSpeed: 100,
        inline: false,
        keywords: '',
        letterCase: 'lowercase',
        opacity: false,
        position: 'bottom left',
        show: null,
        showSpeed: 100,
        theme: 'default',
        swatches: []
      }
    };

    // Public methods
    $.extend($.fn, {
      minicolors: function(method, data) {

        switch(method) {

          // Destroy the control
          case 'destroy':
            $(this).each( function() {
              destroy($(this));
            });
            return $(this);

          // Hide the color picker
          case 'hide':
            hide();
            return $(this);

          // Get/set opacity
          case 'opacity':
            // Getter
            if( data === undefined ) {
              // Getter
              return $(this).attr('data-opacity');
            } else {
              // Setter
              $(this).each( function() {
                updateFromInput($(this).attr('data-opacity', data));
              });
            }
            return $(this);

          // Get an RGB(A) object based on the current color/opacity
          case 'rgbObject':
            return rgbObject($(this), method === 'rgbaObject');

          // Get an RGB(A) string based on the current color/opacity
          case 'rgbString':
          case 'rgbaString':
            return rgbString($(this), method === 'rgbaString');

          // Get/set settings on the fly
          case 'settings':
            if( data === undefined ) {
              return $(this).data('minicolors-settings');
            } else {
              // Setter
              $(this).each( function() {
                var settings = $(this).data('minicolors-settings') || {};
                destroy($(this));
                $(this).minicolors($.extend(true, settings, data));
              });
            }
            return $(this);

          // Show the color picker
          case 'show':
            show( $(this).eq(0) );
            return $(this);

          // Get/set the hex color value
          case 'value':
            if( data === undefined ) {
              // Getter
              return $(this).val();
            } else {
              // Setter
              $(this).each( function() {
                if( typeof(data) === 'object' ) {
                  if( data.opacity ) {
                    $(this).attr('data-opacity', keepWithin(data.opacity, 0, 1));
                  }
                  if( data.color ) {
                    $(this).val(data.color);
                  }
                } else {
                  $(this).val(data);
                }
                updateFromInput($(this));
              });
            }
            return $(this);

          // Initializes the control
          default:
            if( method !== 'create' ) data = method;
            $(this).each( function() {
              init($(this), data);
            });
            return $(this);

        }

      }
    });

    var inputText, globalSettings, globalTarget , globalInput ;
    // Initialize input elements
    function init(input, settings) {

      var minicolors = $('<div class="minicolors" />'),
        defaults = $.minicolors.defaults,
        size,
        swatches,
        textPanel,
        swatch,
        panel,
        globalTarget = input,
        i;

      // Do nothing if already initialized
      if( input.data('minicolors-initialized') ) return;

      // Handle settings
      globalSettings = settings = $.extend(true, {}, defaults, settings);

      // The wrapper
      minicolors
        .addClass('minicolors-theme-' + settings.theme)
        .toggleClass('minicolors-with-opacity', settings.opacity)
        .toggleClass('minicolors-no-data-uris', settings.dataUris !== true);

      // Custom positioning
      if( settings.position !== undefined ) {
        $.each(settings.position.split(' '), function() {
          minicolors.addClass('minicolors-position-' + this);
        });
      }

      // Input size
      if( settings.format === 'rgb' ) {
        size = settings.opacity ? '25' : '20';
      } else {
        size = settings.keywords ? '11' : '7';
      }
       globalInput = input;
      // The input
      input
        .addClass('minicolors-input')
        .data('minicolors-initialized', false)
        .data('minicolors-settings', settings)
        .prop('size', size)
        .wrap(minicolors)
        .after(
        '<div class="minicolors-panel minicolors-slider-' + settings.control + '">' +
        '<div class="minicolors-slider minicolors-sprite">' +
        '<div class="minicolors-picker"></div>' +
        '</div>' +
        '<div class="minicolors-opacity-slider minicolors-sprite">' +
        '<div class="minicolors-picker"></div>' +
        '</div>' +
        '<div class="minicolors-grid minicolors-sprite">' +
        '<div class="minicolors-grid-inner"></div>' +
        '<div class="minicolors-picker"><div></div></div>' +
        '</div>' +
        '</div>'
      );

      // The swatch
      if( !settings.inline ) {
        input.after('<span class="minicolors-swatch minicolors-sprite minicolors-input-swatch"><span class="minicolors-swatch-color"></span></span>');
        input.next('.minicolors-input-swatch').on('click', function(event) {
          event.preventDefault();
          input.focus();
        });
      }

      // Prevent text selection in IE
      panel = input.parent().find('.minicolors-panel');
      panel.on('selectstart', function() { return false; }).end();

      // Swatches
      if (settings.swatches && settings.swatches.length !== 0) {
        if (settings.swatches.length > 7) {
          settings.swatches.length = 7;
        }
        panel.addClass('minicolors-with-swatches');
        swatches = $('<ul class="minicolors-swatches"></ul>')
          .appendTo(panel);
        for(i = 0; i < settings.swatches.length; ++i) {
          swatch = settings.swatches[i];
          swatch = isRgb(swatch) ? parseRgb(swatch, true) : hex2rgb(parseHex(swatch, true));
          $('<li class="minicolors-swatch minicolors-sprite"><span class="minicolors-swatch-color"></span></li>')
            .appendTo(swatches)
            .data('swatch-color', settings.swatches[i])
            .find('.minicolors-swatch-color')
            .css({
              backgroundColor: rgb2hex(swatch),
              opacity: swatch.a
            });
          settings.swatches[i] = swatch;
        }

      }


      // Swatches
      if (settings.text) {
        panel.addClass('minicolors-with-text');
        textPanel = $('<div class="minicolors-text"></div>')
          .appendTo(panel);
        inputText = $('<input type="text">')
          .appendTo(textPanel);

        $(inputText).change(function(){
          input.val(inputText.val());
          updateFromInput(input, true);
        })

      }

      // Inline controls
      if( settings.inline ) input.parent().addClass('minicolors-inline');

      updateFromInput(input, false);

      input.data('minicolors-initialized', true);

    }

    // Returns the input back to its original state
    function destroy(input) {

      var minicolors = input.parent();

      // Revert the input element
      input
        .removeData('minicolors-initialized')
        .removeData('minicolors-settings')
        .removeProp('size')
        .removeClass('minicolors-input');

      // Remove the wrap and destroy whatever remains
      minicolors.before(input).remove();

    }

    // Shows the specified dropdown panel
    function show(input) {

      var minicolors = input.parent(),
        panel = minicolors.find('.minicolors-panel'),
        settings = input.data('minicolors-settings');

      // Do nothing if uninitialized, disabled, inline, or already open
      if( !input.data('minicolors-initialized') ||
        input.prop('disabled') ||
        minicolors.hasClass('minicolors-inline') ||
        minicolors.hasClass('minicolors-focus')
      ) return;

      hide();

      minicolors.addClass('minicolors-focus');
      panel
        .stop(true, true)
        .fadeIn(settings.showSpeed, function() {
          if( settings.show ) settings.show.call(input.get(0));
        });

    }

    // Hides all dropdown panels
    function hide() {

      $('.minicolors-focus').each( function() {

        var minicolors = $(this),
          input = minicolors.find('.minicolors-input'),
          panel = minicolors.find('.minicolors-panel'),
          settings = input.data('minicolors-settings');

        panel.fadeOut(settings.hideSpeed, function() {
          if( settings.hide ) settings.hide.call(input.get(0));
          minicolors.removeClass('minicolors-focus');
        });

      });
    }

    // Moves the selected picker
    function move(target, event, animate) {

      var input =  target.parents('.minicolors').find('.minicolors-input'),
        settings = input.data('minicolors-settings'),
        picker = target.find('[class$=-picker]'),
        offsetX = target.offset().left,
        offsetY = target.offset().top,
        x = Math.round(event.pageX - offsetX),
        y = Math.round(event.pageY - offsetY),
        duration = animate ? settings.animationSpeed : 0,
        wx, wy, r, phi;

      // Touch support
      if( event.originalEvent.changedTouches ) {
        x = event.originalEvent.changedTouches[0].pageX - offsetX;
        y = event.originalEvent.changedTouches[0].pageY - offsetY;
      }

      // Constrain picker to its container
      if( x < 0 ) x = 0;
      if( y < 0 ) y = 0;
      if( x > target.width() ) x = target.width();
      if( y > target.height() ) y = target.height();

      // Constrain color wheel values to the wheel
      if( target.parent().is('.minicolors-slider-wheel') && picker.parent().is('.minicolors-grid') ) {
        wx = 75 - x;
        wy = 75 - y;
        r = Math.sqrt(wx * wx + wy * wy);
        phi = Math.atan2(wy, wx);
        if( phi < 0 ) phi += Math.PI * 2;
        if( r > 75 ) {
          r = 75;
          x = 75 - (75 * Math.cos(phi));
          y = 75 - (75 * Math.sin(phi));
        }
        x = Math.round(x);
        y = Math.round(y);
      }

      // Move the picker
      if( target.is('.minicolors-grid') ) {
        picker
          .stop(true)
          .animate({
            top: y + 'px',
            left: x + 'px'
          }, duration, settings.animationEasing, function() {
            updateFromControl(input, target);
          });
      } else {
        picker
          .stop(true)
          .animate({
            top: y + 'px'
          }, duration, settings.animationEasing, function() {
            updateFromControl(input, target);
          });
      }

    }

    // Sets the input based on the color picker values
    function updateFromControl(input, target) {

      function getCoords(picker, container) {

        var left, top;
        if( !picker.length || !container ) return null;
        left = picker.offset().left;
        top = picker.offset().top;

        return {
          x: left - container.offset().left + (picker.outerWidth() / 2),
          y: top - container.offset().top + (picker.outerHeight() / 2)
        };

      }

      var hue, saturation, brightness, x, y, r, phi,

        hex = input.val(),
        opacity = input.attr('data-opacity'),

      // Helpful references
        minicolors = input.parent(),
        settings = input.data('minicolors-settings'),
        swatch = minicolors.find('.minicolors-input-swatch'),

      // Panel objects
        grid = minicolors.find('.minicolors-grid'),
        slider = minicolors.find('.minicolors-slider'),
        opacitySlider = minicolors.find('.minicolors-opacity-slider'),

      // Picker objects
        gridPicker = grid.find('[class$=-picker]'),
        sliderPicker = slider.find('[class$=-picker]'),
        opacityPicker = opacitySlider.find('[class$=-picker]'),

      // Picker positions
        gridPos = getCoords(gridPicker, grid),
        sliderPos = getCoords(sliderPicker, slider),
        opacityPos = getCoords(opacityPicker, opacitySlider);

      // Handle colors
      if( target.is('.minicolors-grid, .minicolors-slider, .minicolors-opacity-slider') ) {

        // Determine HSB values
        switch(settings.control) {

          case 'wheel':
            // Calculate hue, saturation, and brightness
            x = (grid.width() / 2) - gridPos.x;
            y = (grid.height() / 2) - gridPos.y;
            r = Math.sqrt(x * x + y * y);
            phi = Math.atan2(y, x);
            if( phi < 0 ) phi += Math.PI * 2;
            if( r > 75 ) {
              r = 75;
              gridPos.x = 69 - (75 * Math.cos(phi));
              gridPos.y = 69 - (75 * Math.sin(phi));
            }
            saturation = keepWithin(r / 0.75, 0, 100);
            hue = keepWithin(phi * 180 / Math.PI, 0, 360);
            brightness = keepWithin(100 - Math.floor(sliderPos.y * (100 / slider.height())), 0, 100);
            hex = hsb2hex({
              h: hue,
              s: saturation,
              b: brightness
            });

            // Update UI
            slider.css('backgroundColor', hsb2hex({ h: hue, s: saturation, b: 100 }));
            break;

          case 'saturation':
            // Calculate hue, saturation, and brightness
            hue = keepWithin(parseInt(gridPos.x * (360 / grid.width()), 10), 0, 360);
            saturation = keepWithin(100 - Math.floor(sliderPos.y * (100 / slider.height())), 0, 100);
            brightness = keepWithin(100 - Math.floor(gridPos.y * (100 / grid.height())), 0, 100);
            hex = hsb2hex({
              h: hue,
              s: saturation,
              b: brightness
            });

            // Update UI
            slider.css('backgroundColor', hsb2hex({ h: hue, s: 100, b: brightness }));
            minicolors.find('.minicolors-grid-inner').css('opacity', saturation / 100);
            break;

          case 'brightness':
            // Calculate hue, saturation, and brightness
            hue = keepWithin(parseInt(gridPos.x * (360 / grid.width()), 10), 0, 360);
            saturation = keepWithin(100 - Math.floor(gridPos.y * (100 / grid.height())), 0, 100);
            brightness = keepWithin(100 - Math.floor(sliderPos.y * (100 / slider.height())), 0, 100);
            hex = hsb2hex({
              h: hue,
              s: saturation,
              b: brightness
            });

            // Update UI
            slider.css('backgroundColor', hsb2hex({ h: hue, s: saturation, b: 100 }));
            minicolors.find('.minicolors-grid-inner').css('opacity', 1 - (brightness / 100));
            break;

          default:
            // Calculate hue, saturation, and brightness
            hue = keepWithin(360 - parseInt(sliderPos.y * (360 / slider.height()), 10), 0, 360);
            saturation = keepWithin(Math.floor(gridPos.x * (100 / grid.width())), 0, 100);
            brightness = keepWithin(100 - Math.floor(gridPos.y * (100 / grid.height())), 0, 100);
            hex = hsb2hex({
              h: hue,
              s: saturation,
              b: brightness
            });

            // Update UI
            grid.css('backgroundColor', hsb2hex({ h: hue, s: 100, b: 100 }));
            break;

        }

        // Handle opacity
        if( settings.opacity ) {
          opacity = parseFloat(1 - (opacityPos.y / opacitySlider.height())).toFixed(2);
        } else {
          opacity = 1;
        }

        updateInput(input, hex, opacity);
      }
      else {
        // Set swatch color
        swatch.find('span').css({
          backgroundColor: hex,
          opacity: opacity
        });

        // Handle change event
        doChange(input, hex, opacity);
      }
    }

    // Sets the value of the input and does the appropriate conversions
    // to respect settings, also updates the swatch
    function updateInput(input, value, opacity) {
      var rgb,

      // Helpful references
        minicolors = input.parent(),
        settings = input.data('minicolors-settings'),
        swatch = minicolors.find('.minicolors-input-swatch');

      if( settings.opacity ) input.attr('data-opacity', opacity);

      // Set color string
      if( settings.format === 'rgb' ) {
        // Returns RGB(A) string

        // Checks for input format and does the conversion
        if ( isRgb(value) ) {
          rgb = parseRgb(value, true);
        }
        else {
          rgb = hex2rgb(parseHex(value, true));
        }


        opacity = input.attr('data-opacity') === '' ? 1 : keepWithin( parseFloat( input.attr('data-opacity') ).toFixed(2), 0, 1 );
        if( isNaN( opacity ) || !settings.opacity ) opacity = 1;

        if( input.minicolors('rgbObject').a <= 1 && rgb && settings.opacity) {
          // Set RGBA string if alpha
          value = 'rgba(' + rgb.r + ', ' + rgb.g + ', ' + rgb.b + ', ' + parseFloat( opacity ) + ')';
        } else {
          // Set RGB string (alpha = 1)
          value = 'rgb(' + rgb.r + ', ' + rgb.g + ', ' + rgb.b + ')';
        }
      } else {
        // Returns hex color

        // Checks for input format and does the conversion
        if ( isRgb(value) ) {
          value = rgbString2hex(value);
        }

        value = convertCase( value, settings.letterCase );
      }




      // Update value from picker
      //globalInput.val( value );
      input.val( value );

      if(inputText){
        inputText.val(value);
      }


      // Set swatch color
      swatch.find('span').css({
        backgroundColor: value,
        opacity: opacity
      });

      // Handle change event
      doChange(input, value, opacity);
    }

    // Sets the color picker values from the input
    function updateFromInput(input, preserveInputValue) {
     var  settings = globalSettings;
      var hex,
        hsb,
        opacity,
        keywords,
        alpha,
        value,
        x, y, r, phi,

      // Helpful references
        minicolors = input.parent(),
      //  settings = input.data('minicolors-settings'),
        swatch = minicolors.find('.minicolors-input-swatch'),

      // Panel objects
        grid = minicolors.find('.minicolors-grid'),
        slider = minicolors.find('.minicolors-slider'),
        opacitySlider = minicolors.find('.minicolors-opacity-slider'),

      // Picker objects
        gridPicker = grid.find('[class$=-picker]'),
        sliderPicker = slider.find('[class$=-picker]'),
        opacityPicker = opacitySlider.find('[class$=-picker]');

      // Determine hex/HSB values
      if( isRgb(input.val()) ) {
        // If input value is a rgb(a) string, convert it to hex color and update opacity
        hex = rgbString2hex(input.val());
        alpha = keepWithin(parseFloat(getAlpha(input.val())).toFixed(2), 0, 1);
        if( alpha ) {
          input.attr('data-opacity', alpha);
        }
      } else {
        hex = convertCase(parseHex(input.val(), true), settings.letterCase);
      }

      if( !hex ){
        hex = convertCase(parseInput(settings.defaultValue, true), settings.letterCase);
      }
      hsb = hex2hsb(hex);

      // Get array of lowercase keywords
      keywords = !settings.keywords ? [] : $.map(settings.keywords.split(','), function(a) {
        return $.trim(a.toLowerCase());
      });

      // Set color string
      if( input.val() !== '' && $.inArray(input.val().toLowerCase(), keywords) > -1 ) {
        value = convertCase(input.val());
      } else {
        value = isRgb(input.val()) ? parseRgb(input.val()) : hex;
      }

      // Update input value
      if( !preserveInputValue ){
        globalInput.val(value);

        inputText && inputText.val(value);
      }
      globalSettings = settings
      // Determine opacity value
      if( settings.opacity ) {
        // Get from data-opacity attribute and keep within 0-1 range
        opacity = input.attr('data-opacity') === '' ? 1 : keepWithin(parseFloat(input.attr('data-opacity')).toFixed(2), 0, 1);
        if( isNaN(opacity) ) opacity = 1;
        input.attr('data-opacity', opacity);
        swatch.find('span').css('opacity', opacity);

        // Set opacity picker position
        y = keepWithin(opacitySlider.height() - (opacitySlider.height() * opacity), 0, opacitySlider.height());
        opacityPicker.css('top', y + 'px');
      }

      // Set opacity to zero if input value is transparent
      if( input.val().toLowerCase() === 'transparent' ) {
        swatch.find('span').css('opacity', 0);
      }

      // Update swatch
      swatch.find('span').css('backgroundColor', hex);

      // Determine picker locations
      switch(settings.control) {

        case 'wheel':
          // Set grid position
          r = keepWithin(Math.ceil(hsb.s * 0.75), 0, grid.height() / 2);
          phi = hsb.h * Math.PI / 180;
          x = keepWithin(75 - Math.cos(phi) * r, 0, grid.width());
          y = keepWithin(75 - Math.sin(phi) * r, 0, grid.height());
          gridPicker.css({
            top: y + 'px',
            left: x + 'px'
          });

          // Set slider position
          y = 150 - (hsb.b / (100 / grid.height()));
          if( hex === '' ) y = 0;
          sliderPicker.css('top', y + 'px');

          // Update panel color
          slider.css('backgroundColor', hsb2hex({ h: hsb.h, s: hsb.s, b: 100 }));
          break;

        case 'saturation':
          // Set grid position
          x = keepWithin((5 * hsb.h) / 12, 0, 150);
          y = keepWithin(grid.height() - Math.ceil(hsb.b / (100 / grid.height())), 0, grid.height());
          gridPicker.css({
            top: y + 'px',
            left: x + 'px'
          });

          // Set slider position
          y = keepWithin(slider.height() - (hsb.s * (slider.height() / 100)), 0, slider.height());
          sliderPicker.css('top', y + 'px');

          // Update UI
          slider.css('backgroundColor', hsb2hex({ h: hsb.h, s: 100, b: hsb.b }));
          minicolors.find('.minicolors-grid-inner').css('opacity', hsb.s / 100);
          break;

        case 'brightness':
          // Set grid position
          x = keepWithin((5 * hsb.h) / 12, 0, 150);
          y = keepWithin(grid.height() - Math.ceil(hsb.s / (100 / grid.height())), 0, grid.height());
          gridPicker.css({
            top: y + 'px',
            left: x + 'px'
          });

          // Set slider position
          y = keepWithin(slider.height() - (hsb.b * (slider.height() / 100)), 0, slider.height());
          sliderPicker.css('top', y + 'px');

          // Update UI
          slider.css('backgroundColor', hsb2hex({ h: hsb.h, s: hsb.s, b: 100 }));
          minicolors.find('.minicolors-grid-inner').css('opacity', 1 - (hsb.b / 100));
          break;

        default:
          // Set grid position
          x = keepWithin(Math.ceil(hsb.s / (100 / grid.width())), 0, grid.width());
          y = keepWithin(grid.height() - Math.ceil(hsb.b / (100 / grid.height())), 0, grid.height());
          gridPicker.css({
            top: y + 'px',
            left: x + 'px'
          });

          // Set slider position
          y = keepWithin(slider.height() - (hsb.h / (360 / slider.height())), 0, slider.height());
          sliderPicker.css('top', y + 'px');

          // Update panel color
          grid.css('backgroundColor', hsb2hex({ h: hsb.h, s: 100, b: 100 }));
          break;

      }

      // Fire change event, but only if minicolors is fully initialized
      if( input.data('minicolors-initialized') ) {
        doChange(input, value, opacity);
      }

    }

    // Runs the change and changeDelay callbacks
    function doChange(input, value, opacity) {

      var settings = input.data('minicolors-settings'),
        lastChange = input.data('minicolors-lastChange'),
        obj,
        sel,
        i;

      // Only run if it actually changed
      if( !lastChange || lastChange.value !== value || lastChange.opacity !== opacity ) {

        // Remember last-changed value
        input.data('minicolors-lastChange', {
          value: value,
          opacity: opacity
        });

        // Check and select applicable swatch
        if (settings.swatches && settings.swatches.length !== 0) {
          if(!isRgb(value)) {
            obj = hex2rgb(value);
          }
          else {
            obj = parseRgb(value, true);
          }
          sel = -1;
          for(i = 0; i < settings.swatches.length; ++i) {
            if (obj.r === settings.swatches[i].r && obj.g === settings.swatches[i].g && obj.b === settings.swatches[i].b && obj.a === settings.swatches[i].a) {
              sel = i;
              break;
            }
          }

          input.parent().find('.minicolors-swatches .minicolors-swatch').removeClass('selected');
          if (i !== -1) {
            input.parent().find('.minicolors-swatches .minicolors-swatch').eq(i).addClass('selected');
          }
        }

        // Fire change event
        if( settings.change ) {
          if( settings.changeDelay ) {
            // Call after a delay
            clearTimeout(input.data('minicolors-changeTimeout'));
            input.data('minicolors-changeTimeout', setTimeout( function() {
              settings.change.call(input.get(0), value, opacity);
            }, settings.changeDelay));
          } else {
            // Call immediately
            settings.change.call(input.get(0), value, opacity);
          }
        }
        input.trigger('change').trigger('input');
      }

    }

    // Generates an RGB(A) object based on the input's value
    function rgbObject(input) {
      var hex = parseHex($(input).val(), true),
        rgb = hex2rgb(hex),
        opacity = $(input).attr('data-opacity');
      if( !rgb ) return null;
      if( opacity !== undefined ) $.extend(rgb, { a: parseFloat(opacity) });
      return rgb;
    }

    // Generates an RGB(A) string based on the input's value
    function rgbString(input, alpha) {
      var hex = parseHex($(input).val(), true),
        rgb = hex2rgb(hex),
        opacity = $(input).attr('data-opacity');
      if( !rgb ) return null;
      if( opacity === undefined ) opacity = 1;
      if( alpha ) {
        return 'rgba(' + rgb.r + ', ' + rgb.g + ', ' + rgb.b + ', ' + parseFloat(opacity) + ')';
      } else {
        return 'rgb(' + rgb.r + ', ' + rgb.g + ', ' + rgb.b + ')';
      }
    }

    // Converts to the letter case specified in settings
    function convertCase(string, letterCase) {
      return letterCase === 'uppercase' ? string.toUpperCase() : string.toLowerCase();
    }

    // Parses a string and returns a valid hex string when possible
    function parseHex(string, expand) {
      string = string.replace(/^#/g, '');
      if( !string.match(/^[A-F0-9]{3,6}/ig) ) return '';
      if( string.length !== 3 && string.length !== 6 ) return '';
      if( string.length === 3 && expand ) {
        string = string[0] + string[0] + string[1] + string[1] + string[2] + string[2];
      }
      return '#' + string;
    }

    // Parses a string and returns a valid RGB(A) string when possible
    function parseRgb(string, obj) {

      var values = string.replace(/[^\d,.]/g, ''),
        rgba = values.split(',');

      rgba[0] = keepWithin(parseInt(rgba[0], 10), 0, 255);
      rgba[1] = keepWithin(parseInt(rgba[1], 10), 0, 255);
      rgba[2] = keepWithin(parseInt(rgba[2], 10), 0, 255);
      if( rgba[3] ) {
        rgba[3] = keepWithin(parseFloat(rgba[3], 10), 0, 1);
      }

      // Return RGBA object
      if( obj ) {
        return {
          r: rgba[0],
          g: rgba[1],
          b: rgba[2],
          a: rgba[3] ? rgba[3] : null
        };
      }

      // Return RGBA string
      if( typeof(rgba[3]) !== 'undefined' && rgba[3] <= 1 ) {
        return 'rgba(' + rgba[0] + ', ' + rgba[1] + ', ' + rgba[2] + ', ' + rgba[3] + ')';
      } else {
        return 'rgb(' + rgba[0] + ', ' + rgba[1] + ', ' + rgba[2] + ')';
      }

    }

    // Parses a string and returns a valid color string when possible
    function parseInput(string, expand) {
      if( isRgb(string) ) {
        // Returns a valid rgb(a) string
        return parseRgb(string);
      } else {
        return parseHex(string, expand);
      }
    }

    // Keeps value within min and max
    function keepWithin(value, min, max) {
      if( value < min ) value = min;
      if( value > max ) value = max;
      return value;
    }

    // Checks if a string is a valid RGB(A) string
    function isRgb(string) {
      var rgb = string.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);
      return (rgb && rgb.length === 4) ? true : false;
    }

    // Function to get alpha from a RGB(A) string
    function getAlpha(rgba) {
      rgba = rgba.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+(\.\d{1,2})?|\.\d{1,2})[\s+]?/i);
      return (rgba && rgba.length === 6) ? rgba[4] : '1';
    }

    // Converts an HSB object to an RGB object
    function hsb2rgb(hsb) {
      var rgb = {};
      var h = Math.round(hsb.h);
      var s = Math.round(hsb.s * 255 / 100);
      var v = Math.round(hsb.b * 255 / 100);
      if(s === 0) {
        rgb.r = rgb.g = rgb.b = v;
      } else {
        var t1 = v;
        var t2 = (255 - s) * v / 255;
        var t3 = (t1 - t2) * (h % 60) / 60;
        if( h === 360 ) h = 0;
        if( h < 60 ) { rgb.r = t1; rgb.b = t2; rgb.g = t2 + t3; }
        else if( h < 120 ) {rgb.g = t1; rgb.b = t2; rgb.r = t1 - t3; }
        else if( h < 180 ) {rgb.g = t1; rgb.r = t2; rgb.b = t2 + t3; }
        else if( h < 240 ) {rgb.b = t1; rgb.r = t2; rgb.g = t1 - t3; }
        else if( h < 300 ) {rgb.b = t1; rgb.g = t2; rgb.r = t2 + t3; }
        else if( h < 360 ) {rgb.r = t1; rgb.g = t2; rgb.b = t1 - t3; }
        else { rgb.r = 0; rgb.g = 0; rgb.b = 0; }
      }
      return {
        r: Math.round(rgb.r),
        g: Math.round(rgb.g),
        b: Math.round(rgb.b)
      };
    }

    // Converts an RGB string to a hex string
    function rgbString2hex(rgb){
      rgb = rgb.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);
      return (rgb && rgb.length === 4) ? '#' +
      ('0' + parseInt(rgb[1],10).toString(16)).slice(-2) +
      ('0' + parseInt(rgb[2],10).toString(16)).slice(-2) +
      ('0' + parseInt(rgb[3],10).toString(16)).slice(-2) : '';
    }

    // Converts an RGB object to a hex string
    function rgb2hex(rgb) {
      var hex = [
        rgb.r.toString(16),
        rgb.g.toString(16),
        rgb.b.toString(16)
      ];
      $.each(hex, function(nr, val) {
        if (val.length === 1) hex[nr] = '0' + val;
      });
      return '#' + hex.join('');
    }

    // Converts an HSB object to a hex string
    function hsb2hex(hsb) {
      return rgb2hex(hsb2rgb(hsb));
    }

    // Converts a hex string to an HSB object
    function hex2hsb(hex) {
      var hsb = rgb2hsb(hex2rgb(hex));
      if( hsb.s === 0 ) hsb.h = 360;
      return hsb;
    }

    // Converts an RGB object to an HSB object
    function rgb2hsb(rgb) {
      var hsb = { h: 0, s: 0, b: 0 };
      var min = Math.min(rgb.r, rgb.g, rgb.b);
      var max = Math.max(rgb.r, rgb.g, rgb.b);
      var delta = max - min;
      hsb.b = max;
      hsb.s = max !== 0 ? 255 * delta / max : 0;
      if( hsb.s !== 0 ) {
        if( rgb.r === max ) {
          hsb.h = (rgb.g - rgb.b) / delta;
        } else if( rgb.g === max ) {
          hsb.h = 2 + (rgb.b - rgb.r) / delta;
        } else {
          hsb.h = 4 + (rgb.r - rgb.g) / delta;
        }
      } else {
        hsb.h = -1;
      }
      hsb.h *= 60;
      if( hsb.h < 0 ) {
        hsb.h += 360;
      }
      hsb.s *= 100/255;
      hsb.b *= 100/255;
      return hsb;
    }

    // Converts a hex string to an RGB object
    function hex2rgb(hex) {
      hex = parseInt(((hex.indexOf('#') > -1) ? hex.substring(1) : hex), 16);
      return {
        /* jshint ignore:start */
        r: hex >> 16,
        g: (hex & 0x00FF00) >> 8,
        b: (hex & 0x0000FF)
        /* jshint ignore:end */
      };
    }

    // Handle events
    $(document)
      // Hide on clicks outside of the control
      .on('mousedown.minicolors touchstart.minicolors', function(event) {
        if( !$(event.target).parents().add(event.target).hasClass('minicolors') ) {
          hide();
        }
      })
      // Start moving
      .on('mousedown.minicolors touchstart.minicolors', '.minicolors-grid, .minicolors-slider, .minicolors-opacity-slider', function(event) {
        var target = $(this);
        event.preventDefault();
        $(document).data('minicolors-target', target);
        move(target, event, true);
      })
      // Move pickers
      .on('mousemove.minicolors touchmove.minicolors', function(event) {
        var target = $(document).data('minicolors-target');
        if( target ) move(target, event);
      })
      // Stop moving
      .on('mouseup.minicolors touchend.minicolors', function() {
        $(this).removeData('minicolors-target');
      })
      // Selected a swatch
      .on('click.minicolors', '.minicolors-swatches li', function(event) {
        event.preventDefault();
        var target = $(this), input = target.parents('.minicolors').find('.minicolors-input'), color = target.data('swatch-color');
        updateInput(input, color, getAlpha(color));
        updateFromInput(input);
      })
      // Show panel when swatch is clicked
      .on('mousedown.minicolors touchstart.minicolors', '.minicolors-input-swatch', function(event) {
        var input = $(this).parent().find('.minicolors-input');
        event.preventDefault();
        if( input.parent().find('.minicolors-panel').css("display") !== "none"){
          //todo
          //hide();
        }else{
          show(input);
        }
      })
      // Show on focus
      .on('focus.minicolors', '.minicolors-input', function() {
        var input = $(this);
        if( !input.data('minicolors-initialized') ) return;
        show(input);
      })
      // Update value on blur
      .on('blur.minicolors', '.minicolors-input', function() {
        var input = $(this),
          settings = input.data('minicolors-settings'),
          keywords,
          hex,
          rgba,
          swatchOpacity,
          value;

        if( !input.data('minicolors-initialized') ) return;

        // Get array of lowercase keywords
        keywords = !settings.keywords ? [] : $.map(settings.keywords.split(','), function(a) {
          return $.trim(a.toLowerCase());
        });

        // Set color string
        if( input.val() !== '' && $.inArray(input.val().toLowerCase(), keywords) > -1 ) {
          value = input.val();
        } else {
          // Get RGBA values for easy conversion
          if( isRgb(input.val()) ) {
            rgba = parseRgb(input.val(), true);
          } else {
            hex = parseHex(input.val(), true);
            rgba = hex ? hex2rgb(hex) : null;
          }

          // Convert to format
          if( rgba === null ) {
            value = settings.defaultValue;
          } else if( settings.format === 'rgb' ) {
            value = settings.opacity ?
              parseRgb('rgba(' + rgba.r + ',' + rgba.g + ',' + rgba.b + ',' + input.attr('data-opacity') + ')') :
              parseRgb('rgb(' + rgba.r + ',' + rgba.g + ',' + rgba.b + ')');
          } else {
            value = rgb2hex(rgba);
          }
        }

        // Update swatch opacity
        swatchOpacity = settings.opacity ? input.attr('data-opacity') : 1;
        if( value.toLowerCase() === 'transparent' ) swatchOpacity = 0;
        input
          .closest('.minicolors')
          .find('.minicolors-input-swatch > span')
          .css('opacity', swatchOpacity);

        // Set input value
        input.val(value);

        // Is it blank?
        if( input.val() === '' ) input.val(parseInput(settings.defaultValue, true));

        // Adjust case
        input.val( convertCase(input.val(), settings.letterCase) );

      })
      // Handle keypresses
      .on('keydown.minicolors', '.minicolors-input', function(event) {
        var input = $(this);
        if( !input.data('minicolors-initialized') ) return;
        switch(event.keyCode) {
          case 9: // tab
            hide();
            break;
          case 13: // enter
          case 27: // esc
            hide();
            input.blur();
            break;
        }
      })
      // Update on keyup
      .on('keyup.minicolors', '.minicolors-input', function() {
        var input = $(this);
        if( !input.data('minicolors-initialized') ) return;
        updateFromInput(input, true);
      })
      // Update on paste
      .on('paste.minicolors', '.minicolors-input', function() {
        var input = $(this);
        if( !input.data('minicolors-initialized') ) return;
        setTimeout( function() {
          updateFromInput(input, true);
        }, 1);
      });

  }));


/***/ }),
/* 52 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {


  fabric.ShapeMixin = {
    storeProperties: fabric.Object.prototype.storeProperties.concat(["points"]),
    stateProperties: fabric.Object.prototype.stateProperties.concat(["points"]),
    specialProperties: ["points"],
    getPoints: function(){
      return fabric.util.object.filterValues(this.points,["x","y","c","c2"]);
    },
    addPoint: function (_point) {
      this.points.push({
        x : _point.x,
        y : _point.y
      });
      if(this.closeOnFull && this.points.length == this.maximumPoints ){
        this.closed = true;
      }
      this.updateBbox();
    },
    getLength: function () {
      var _l = 0;
      for(var i = 0 ; i < this.points.length - 1; i++){
        if(this.points[i].curve){
          _l += this.points[i].curve.length();
        }
      }
      return _l;
    },
    updateBbox: function () {
      if (this.points.length == 0) {
        this.left = 0;
        this.top = 0;
        this.width = 1;
        this.height = 1;
        return;
      }
      var minX = Infinity, maxX = -Infinity, minY = Infinity, maxY = -Infinity, i;
      for (i in this.points) {
        var _p = this.points[i];
        if (_p.outline) {
          var bbox = _p.outline.bbox();
          minX = Math.min(minX, bbox.x.min);
          maxX = Math.max(maxX, bbox.x.max);
          minY = Math.min(minY, bbox.y.min);
          maxY = Math.max(maxY, bbox.y.max);
        }else if (_p.curve) {
          var bbox = _p.curve.bbox();
          minX = Math.min(minX, bbox.x.min);
          maxX = Math.max(maxX, bbox.x.max);
          minY = Math.min(minY, bbox.y.min);
          maxY = Math.max(maxY, bbox.y.max);
        } else {
          minX = Math.min(minX, _p.x);
          maxX = Math.max(maxX, _p.x);
          minY = Math.min(minY, _p.y);
          maxY = Math.max(maxY, _p.y);
        }
      }
      this.__translated = {
        x: minX,
        y: minY,
      };
      this.left += minX;
      this.top += minY;
      this.width = maxX - minX + 1;
      this.height = maxY - minY + 1;

      for (i in this.points) {
        var _point = this.points[i];
        _point.x -= minX;
        _point.y -= minY;
        if(_point.c){
          _point.c.x -= minX;
          _point.c.y -= minY;
        }
        if(_point.c2){
          _point.c2.x -= minX;
          _point.c2.y -= minY;
        }
      }
      this.canvas && this.setCoords();

      //нужно оптимизировать(переисовывать только 1 или 2 кривых за раз
      //todo нужно перерисовывать при изменении размера
      if(this.__translated.x || this.__translated.y){
        for(i in this.points){
          this.points[i].c && this._update_curve(+i);
        }
      }
    },
    _performShapeAction: function (e, transform, pointer) {
      transform.corner.substr(1)
      this.setPoint(transform.corner, transform.point);
      transform.actionPerformed = true;
      this.fire('shaping', e);
    },
    _initPoints: function (points) {

      if (points) {
        this.set('points', points);
      }

      this._controlsVisibility = {};

      var _points = this.points || this._points;

      if (_points) {
        for (var i = 1; i <= _points.length; i++) {
          this._controlsVisibility["p" + i] = true;
        }
        this._controlsVisibility["p"] = true;
      }


      var _default_corners = {
        tl: true,
        tr: true,
        br: true,
        bl: true,
        ml: true,
        mt: true,
        mr: true,
        mb: true,
        mtr: true
      };
      for (var i in _default_corners) {
        this._controlsVisibility[i] = _default_corners[i];
      }
    },
    _default_corner_action: "shape",
    _corner_actions: {},


    drawBoundsControls:fabric.Object.prototype.drawControls,
    addPointsControls: function(){
      var controls = {};

      var pts = this.points ;
      for(var i in pts) {
        controls["p" + (+i )] = {
          x: pts[i].x,
          y: pts[i].y,
          size: this.cornerSize,
          style: "circle"
        };
      }
      return controls;
    },
    drawShapeBorder: function (ctx) {
      var _points = this.points || this._points;

      var x, y;
      x = -this.width / 2;
      y = -this.height / 2;
      var zoom = this.canvas.viewportTransform[0];
      ctx.save();
      ctx.scale(this.scaleX * zoom, this.scaleY * zoom);
      ctx.translate(x, y);


      ctx.beginPath();

      var _p = _points[0];// fabric.util.transformPoint(_points[0], transformMatrix);

      ctx.moveTo(_p.x, _p.y);

      for (var i = 1; i < _points.length; i++) {

        var _p = _points[i];//fabric.util.transformPoint(_points[i], transformMatrix);
        ctx.lineTo(_p.x, _p.y);
      }
      ctx.closePath();
      ctx.stroke();
      ctx.restore();
    }
    // setCoords: function () {
    //   this.setBoundCoords();
    //   this.setExtraCoords();
    // }
  };

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 53 */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(fabric) {fabric.TransformedImageMixin = {

  perspective: false,
  verticalSubdivisions: 7, // vertical subdivisions
  horizontalSubdivisions: 7,
  _update_content_offsets: function(_b){

    var _omX = 0, _omY = 0;
    if(this.contentOffsets){
      _omX = this.contentOffsets.minX;
      _omY = this.contentOffsets.minY;
    }

    if(_b){
      this.points = [
        this._getPointForImageCoordianate(_b.minX - _omX,_b.minY - _omY),
        this._getPointForImageCoordianate(_b.maxX - _omX,_b.minY - _omY),
        this._getPointForImageCoordianate(_b.maxX - _omX,_b.maxY - _omY),
        this._getPointForImageCoordianate(_b.minX - _omX,_b.maxY - _omY)
      ];
      this.dirty = true;
    }

    this.contentOffsets = _b;
  },

  _getImageCoordianateForPoint: function(pointer,doNotUseCurve){
    var curRow = 0.5,
      p1 = this.points[0],
      p2 = this.points[1],
      p3 = this.points[2],
      p4 = this.points[3];

    function checkT(t){

      var ax = p1.x + (p2.x - p1.x) * t , ay = p1.y + (p2.y - p1.y) * t,
        bx = p4.x + (p3.x - p4.x) * t , by = p4.y + (p3.y - p4.y) * t;
      var _sign =  (bx - ax) * (pointer.y - ay) - (by - ay) * (pointer.x - ax);
      return _sign > 0;
    }

    function getX(){
      //true слева
      var element = -1;
      var i = 0;

      if(checkT(i)){
        i--;
        while(checkT(i)){
          i--;
          if(i < -5) {
            return -5;
          }
        }
        element = i;
      }else{
        i++;
        while(!checkT(i)){
          i++;
          if(i > 5){
            return 5;
          }
        }
        element = i - 1;
      }

      var precision = 0.5;
      element += precision;
      while(precision > 0.05){
        precision/=2;
        if(checkT(element)){
          element -=precision;
        }else{
          element +=precision;
        }
      }
      return element;


    }
    var t = getX();

    var ax = p1.x + (p2.x - p1.x) * t , ay = p1.y + (p2.y - p1.y) * t,
      bx = p4.x + (p3.x - p4.x) * t , by = p4.y + (p3.y - p4.y) * t;

    var  _y = (pointer.y -ay) / (by - ay) ;

    return {x: t, y : _y };
  },
  _getPointForImageCoordianate: function(x,y,doNotUseCurve){
    var curRow = y / this.height,
      curCol = x / this.width;
    var p1 = this.points[0],
      p2 = this.points[1],
      p3 = this.points[2],
      p4 = this.points[3],
      curRowX1 = p1.x + (p4.x - p1.x) * curRow,
      curRowY1 = p1.y + (p4.y - p1.y) * curRow,
      curRowX2 = p2.x + (p3.x - p2.x) * curRow,
      curRowY2 = p2.y + (p3.y - p2.y) * curRow,
      p1x = curRowX1 + (curRowX2 - curRowX1) * curCol,
      p1y = curRowY1 + (curRowY2 - curRowY1) * curCol;


    if(!doNotUseCurve){
      p1y += this._getCurveOffset(curCol).y;
    }else{

      var p1 = this.points[0],
        p2 = this.points[1],
        p3 = this.points[2],
        p4 = this.points[3];

      if(p2.y == p1.y && p4.y == p3.y) {
        y = p1y;
      }
      if(p3.x == p2.x && p4.x == p1.x) {
        x = p1x;
      }
      if(curRowY2 == curRowY1) {
        curRowY1 = p1y;
      }
    }


    return {x: p1x , y : p1y};
  },
  drawTriangle: function(ctx, im, x0, y0, x1, y1, x2, y2, sx0, sy0, sx1, sy1, sx2, sy2) {
    ctx.save();

    // Clip the output to the on-screen triangle boundaries.
    ctx.beginPath();
    ctx.moveTo(x0, y0);
    ctx.lineTo(x1, y1);
    ctx.lineTo(x2, y2);
    ctx.closePath();
    if(this.wireframe){
      ctx.stroke();//xxxxxxx for wireframe
    }
    ctx.clip();

    /*
     ctx.transform(m11, m12, m21, m22, dx, dy) sets the context transform matrix.

     The context matrix is:

     [ m11 m21 dx ]
     [ m12 m22 dy ]
     [  0   0   1 ]

     Coords are column vectors with a 1 in the z coord, so the transform is:
     x_out = m11 * x + m21 * y + dx;
     y_out = m12 * x + m22 * y + dy;

     From Maxima, these are the transform values that map the source
     coords to the dest coords:

     sy0 (x2 - x1) - sy1 x2 + sy2 x1 + (sy1 - sy2) x0
     [m11 = - -----------------------------------------------------,
     sx0 (sy2 - sy1) - sx1 sy2 + sx2 sy1 + (sx1 - sx2) sy0

     sy1 y2 + sy0 (y1 - y2) - sy2 y1 + (sy2 - sy1) y0
     m12 = -----------------------------------------------------,
     sx0 (sy2 - sy1) - sx1 sy2 + sx2 sy1 + (sx1 - sx2) sy0

     sx0 (x2 - x1) - sx1 x2 + sx2 x1 + (sx1 - sx2) x0
     m21 = -----------------------------------------------------,
     sx0 (sy2 - sy1) - sx1 sy2 + sx2 sy1 + (sx1 - sx2) sy0

     sx1 y2 + sx0 (y1 - y2) - sx2 y1 + (sx2 - sx1) y0
     m22 = - -----------------------------------------------------,
     sx0 (sy2 - sy1) - sx1 sy2 + sx2 sy1 + (sx1 - sx2) sy0

     sx0 (sy2 x1 - sy1 x2) + sy0 (sx1 x2 - sx2 x1) + (sx2 sy1 - sx1 sy2) x0
     dx = ----------------------------------------------------------------------,
     sx0 (sy2 - sy1) - sx1 sy2 + sx2 sy1 + (sx1 - sx2) sy0

     sx0 (sy2 y1 - sy1 y2) + sy0 (sx1 y2 - sx2 y1) + (sx2 sy1 - sx1 sy2) y0
     dy = ----------------------------------------------------------------------]
     sx0 (sy2 - sy1) - sx1 sy2 + sx2 sy1 + (sx1 - sx2) sy0
     */

    // TODO: eliminate common subexpressions.
    var denom = sx0 * (sy2 - sy1) - sx1 * sy2 + sx2 * sy1 + (sx1 - sx2) * sy0;
    if (denom == 0) {
      return;
    }
    var m11 = -(sy0 * (x2 - x1) - sy1 * x2 + sy2 * x1 + (sy1 - sy2) * x0) / denom;
    var m12 = (sy1 * y2 + sy0 * (y1 - y2) - sy2 * y1 + (sy2 - sy1) * y0) / denom;
    var m21 = (sx0 * (x2 - x1) - sx1 * x2 + sx2 * x1 + (sx1 - sx2) * x0) / denom;
    var m22 = -(sx1 * y2 + sx0 * (y1 - y2) - sx2 * y1 + (sx2 - sx1) * y0) / denom;
    var dx = (sx0 * (sy2 * x1 - sy1 * x2) + sy0 * (sx1 * x2 - sx2 * x1) + (sx2 * sy1 - sx1 * sy2) * x0) / denom;
    var dy = (sx0 * (sy2 * y1 - sy1 * y2) + sy0 * (sx1 * y2 - sx2 * y1) + (sx2 * sy1 - sx1 * sy2) * y0) / denom;

    ctx.transform(m11, m12, m21, m22, dx, dy);

    // Draw the whole image.  Transform and clip will map it onto the
    // correct output triangle.
    //
    // TODO: figure out if drawImage goes faster if we specify the rectangle that
    // bounds the source coords.
    ctx.drawImage(im, 0, 0);
    ctx.restore();
  },
  drawWireframe: function(ctx){

    ctx.strokeStyle = "black";
    ctx.beginPath();
    var tri;
    for (var i in this._triangles) {
      tri = this._triangles[i];
      ctx.moveTo(tri.p0.x, tri.p0.y);
      ctx.lineTo(tri.p1.x, tri.p1.y);
      ctx.lineTo(tri.p2.x, tri.p2.y);
      ctx.lineTo(tri.p0.x, tri.p0.y);
    }
    ctx.stroke();
    ctx.closePath();
  },
  fixSemiTransparentPixels: function(ctx){

    var imgData = ctx.getImageData(0,0,ctx.canvas.width,ctx.canvas.height);
    for(var i = 3; i < imgData.data.length; i+=4){
      if(imgData.data[i] > 0){
        imgData.data[i] = 255;
      }
    }
    ctx.putImageData(imgData,0,0);
  },
  drawElement: function(ctx){
    var tri;
    for (var i in this._triangles) {
      tri = this._triangles[i];

      this.drawTriangle(ctx, this._element,
        +tri.p0.x, tri.p0.y,
        tri.p1.x, tri.p1.y,
        tri.p2.x, tri.p2.y,
        tri.t0.u, tri.t0.v,
        tri.t1.u, tri.t1.v,
        tri.t2.u, tri.t2.v);
    }
  },
  calculateGeometry : function() {
    // clear _triangles out
    this._triangles = [];

    // generate subdivision
    var subs = this.verticalSubdivisions; // vertical subdivisions
    var divs = this.horizontalSubdivisions; // horizontal subdivisions

    var p1 = new fabric.Point(this.points[0].x,this.points[0].y);
    var p2 = new fabric.Point(this.points[1].x,this.points[1].y);
    var p3 = new fabric.Point(this.points[2].x,this.points[2].y);
    var p4 = new fabric.Point(this.points[3].x,this.points[3].y);

    var dx1 = p4.x - p1.x;
    var dy1 = p4.y - p1.y;
    var dx2 = p3.x - p2.x;
    var dy2 = p3.y - p2.y;

    var imgW = this._element.naturalWidth;
    var imgH = this._element.naturalHeight;

    if(this.perspective) {
      //1/2
      var _perspectiveY = p2.distanceFrom(p3) / p1.distanceFrom(p4) ;
      var _perspectiveX = p1.distanceFrom(p2) / p4.distanceFrom(p3);
      var _totalDistanceX = 0, _totalDistanceY = 0;
      if (_perspectiveX < 1) _perspectiveX = 1 / _perspectiveX;
      if (_perspectiveY < 1) _perspectiveY = 1 / _perspectiveY;

      _perspectiveX = Math.sqrt(_perspectiveX);
      _perspectiveY = Math.sqrt(_perspectiveY);

      var lastX = 1;
      for (var sub = 0; sub < subs; ++sub) {
        _totalDistanceX += lastX;
        lastX *= _perspectiveX;
      }
      var lastY = 1;
      for (var sub = 0; sub < subs; ++sub) {
        _totalDistanceY += lastY;
        lastY *= _perspectiveY;
      }
    }

    this._initCurveOffset();

    var curRow, nextRow = 0, curRowTex, nextRowTex = 0;
    lastX = 1;
    for (var sub = 0; sub < subs; ++sub) {
      curRow = nextRow;
      curRowTex = nextRowTex;

      nextRowTex = (sub + 1) / subs;

      if(this.perspective){
        nextRow = curRow + lastX / _totalDistanceX;
        lastX *= _perspectiveX;
      }else{
        nextRow = nextRowTex;
      }

      var curRowX1 = p1.x + dx1 * curRow;
      var curRowY1 = p1.y + dy1 * curRow;

      var curRowX2 = p2.x + dx2 * curRow;
      var curRowY2 = p2.y + dy2 * curRow;

      var nextRowX1 = p1.x + dx1 * nextRow;
      var nextRowY1 = p1.y + dy1 * nextRow;

      var nextRowX2 = p2.x + dx2 * nextRow;
      var nextRowY2 = p2.y + dy2 * nextRow;

      var curCol, nextCol = 0, curColTex, nextColTex = 0;
      lastY = 1;
      for (var div = 0; div < divs; ++div) {

        curCol = nextCol;
        curColTex  = nextColTex;

        nextColTex = (div + 1) / divs;

        if(this.perspective){
          nextCol = curCol + lastY / _totalDistanceY;
          lastY *= _perspectiveY;
        }else{
          nextCol = nextColTex;
        }

        var dCurX = curRowX2 - curRowX1;
        var dCurY = curRowY2 - curRowY1;
        var dNextX = nextRowX2 - nextRowX1;
        var dNextY = nextRowY2 - nextRowY1;

        var p1x = curRowX1 + dCurX * curCol ;
        var p1y = curRowY1 + dCurY * curCol + this._getCurveOffset(curCol).y;

        var p2x = curRowX1 + (curRowX2 - curRowX1) * nextCol;
        var p2y = curRowY1 + (curRowY2 - curRowY1) * nextCol + this._getCurveOffset(nextCol).y;

        var p3x = nextRowX1 + dNextX * nextCol;
        var p3y = nextRowY1 + dNextY * nextCol  + this._getCurveOffset(nextCol).y;

        var p4x = nextRowX1 + dNextX * curCol;
        var p4y = nextRowY1 + dNextY * curCol  + this._getCurveOffset(curCol).y;

        var u1 = curColTex * imgW;
        var u2 = nextColTex * imgW;
        var v1 = curRowTex * imgH;
        var v2 = nextRowTex * imgH;

        var triangle1 = {
          p0: {x: p1x, y: p1y},
          p1: {x: p3x, y: p3y},
          p2: {x: p4x, y: p4y},
          t0: {u: u1, v: v1},
          t1: {u: u2, v: v2},
          t2: {u: u1, v: v2}
        };

        var triangle2 = {
          p0: {x: p1x , y: p1y},
          p1: {x: p2x , y: p2y},
          p2: {x: p3x , y: p3y},
          t0: {u: u1  ,v: v1},
          t1: {u: u2  ,v: v1},
          t2: {u: u2  ,v: v2}
        };

        this._triangles.push(triangle1);
        this._triangles.push(triangle2);
      }
    }
  }
};

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 54 */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(fabric) {/**
 *
 */
fabric.util.object.extend(fabric.Object.prototype, {
  inactiveOptions: null,
  activeOptions: null,
  eventListeners: fabric.util.object.extendArraysObject(fabric.Object.prototype.eventListeners, {
    added: function () {
      if(this.active){
        this.activeOptions && this.set(this.activeOptions);
      }else{
        this.inactiveOptions && this.set(this.inactiveOptions);
      }
    },
    deselected: function () {
      this.inactiveOptions && this.set(this.inactiveOptions);
    },
    selected: function () {
      this.activeOptions && this.set(this.activeOptions);
    }
  })
});

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 55 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.util.object.extend(fabric.SlideCanvas.prototype, {
  _update_clip_rect: function () {
    if (this.areas || !this.layers.background.objects[0]) return;
    var geometry = this.getRect(this.offsets);
    this.layers.background.objects[0].set(geometry);
  },
  offsets: {left : 0,top : 0, right: 0, bottom:0},
  setHelpers: function (helpers, callback) {
    var self = this;
    if(helpers){
      for (var i in helpers){
        fabric.util.createObject(helpers[i],function(helper){
          self.layers.background.objects.push(helper);
          self.renderAll();
        });
      }
    }
    callback && callback();
  },
  areaActivating: false,
  addElementsInsideActiveArea: false,
  areaProperties: {
    originX: 'left',
    originY: 'top',
    fill: 'transparent',
    strokeDashArray: [5, 5],
    strokeWidth: 1,
    stroke: 'black',
    resizable: true
    //selectable: false
  },
  setAreaProperty: function (property, value) {
    this["area_" + property] = value;
    for (var i in this.layers.background.objects) {
      this.layers.background.objects[i][property] = value;
    }
    this.renderAll();
  },
  setActiveArea: function (area) {
    if (area === true) {
      area = this.layers.background.objects[0] || null;
    }
    if (this.activeArea) {
      this.activeArea.setStroke("#000");
    }
    this.activeArea = area;
    if (area) {
      area.setStroke("#B7F1ED");
    }
  },
  setAreaActivating: function (value/*, force*/) {
    //todo force
    var force = true;
    if (force || (value && !this.areaActivating)) {
      this.areaActivating = true;
      this.on("object:modified", function (e) {
        if(this.editingObject){
          return;
        }
        //todo event! не ъотел бы это тут испольовать,но работает
        var pointer = this.getPointer(event, true);
        var target = this._searchPossibleTargets(this.layers.background.objects, pointer);
        if(this._currentTransform && target && this.target.movementLimits != target){
          this.target.movementLimits = this.target.clipTo = target;
          this.setActiveArea(target);
        }
      });
      this.on("mouse:down", function (e) {
        var pointer = this.getPointer(e.e, true);
        var target = this._searchPossibleTargets(this.layers.background.objects, pointer);
        if (target) {
          this.setActiveArea(target);
        }
      })
    }
  },
  _update_area_geometry: function(el,options){
    if (options.path) {

      options.width = options.width || el.width;
      var geometry = this.getRect(options);
      var _scale = el.width / geometry.width;
      el.set({
        left: geometry.left ,///* el.left * _scale*/,
        top: geometry.top ,//+ el.top * _scale,
        scaleX: _scale,
        scaleY: _scale
      });
      return;
    }
    var geometry = this.getRect(options);

    if(options.src){
      var _scale = geometry.width / img.width;
      el.set({
        left: geometry.left,// + el.left * _scale,
        top: geometry.top ,//+ el.top * _scale,
        strokeWidth: this.areaProperties.strokeWidth / _scale,
        scaleX: _scale,
        scaleY: _scale
      });
    }else{
      el.set(geometry);
    }
  },
  createArea: function (area, callback) {

    var _this = this;

    var _finalize = function (path) {
      path.id = area.id;
      area.instance = path;
      path.layer = "background";
      _this.add(path);
      this._update_area_geometry(path,area);
      // _this._backgroundLayer.push(path);
      // path.canvas = _this;
      callback();
    }.bind(this);

    var createClipPath = function (img) {
      clipFiller.setImage(img);
      clipFiller.mask = MagicWand.selectBackground(clipFiller.getInfo(), null, 15);

      var contours = clipFiller.getContours();
      var clipPoints = contours[1].points;
      var pathData = fabric.PencilBrush.prototype.convertPointsToSVGPath(clipPoints).join('');//todo
      var path = new fabric.Path(pathData, _this.areaProperties);

      //path.points = clipPoints;
      return path;
    };

    if (area.path) {
      var path = new fabric.Path(area.path, this.areaProperties);
      area.top = path.top;
      area.left = path.left;
      area.width = path.width;
      area.height = path.height;
      _finalize(path);  
    } else if (area.src) {
      var clipFiller = new fabric.Pathfinder({});
      fabric.util.loadImage(area.src, function (img) {
        var path = createClipPath(img);
        _finalize(path);
      });

    } else {
      var path = new fabric.Rect(this.areaProperties);
      _finalize(path);
    }



    if(( area.right || area.bottom || area.path ) && (!this.originalWidth  || !this.originalHeight) ){
      this.on("background-image:loaded",function(){
        this._update_area_geometry(path,area);
      this.renderAll();
      }.bind(this))
    }

    /*
     app.canvas.setOffsets({
     right:  1,
     left:   1,
     top:    1,
     bottom: 1
     });


     app.canvas.clipTo = function (ctx) {
     var zoom = app.canvas_config.width / app.canvas.backgroundImage.filters[0].pathfinder.mask.width;
     ctx.save();
     ctx.scale(zoom, zoom);
     app.clipFiller.traceInner(ctx);
     ctx.restore();
     };*/
  },
  removeArea: function (area, callback) {

    var objs = this.getObjects();
    for (var i in objs) {
      if (objs[i].movementLimits == area) {
        delete objs[i].movementLimits;
      }
      if (objs[i].clipTo == area) {
        //if(objs[i].olcClipToID){
        //    objs[i].clipToID = objs[i].oldClipToID;
        //}
        delete objs[i].clipTo;
        //objs[i].olcClipToID = area.id;
      }
    }
    area.remove();
  },
  setOffsets: function (offsets, callback) {
    if(offsets){
      this.offsets = offsets;
      this.setAreas([offsets], callback);
    }else{
      callback()
    }
  },
  setAreas: function (areas, callback) {
    areas = areas || [];
    if (this.areas) {
      for (var i = this.areas.length; i--;) {
        this.removeArea(this.areas[i].instance);
      }
    }
    this.areas = areas;

    var cb = fabric.util.queueLoad(areas.length + 1, function () {
      if (this.areaActivating) {
        if (this.layers.background.objects[0]) {
          this.setActiveArea(true);
        } else {
          this.activeArea = null;
        }
      }

      var objs = this.getObjects();
//work with object
      if (!areas.length) {
        objs.length && this.clear();
      } else {
        var _area = this.activeArea || this.layers.background.objects[0];
        for (var i in objs) {
          var obj = objs[i];
          obj.clipTo = _area;
          obj.setMovementLimits(_area);
          obj.setCoords();
        }
      }
      callback && callback.call(this);
    }.bind(this));

    for (var i in areas) {
      if (!areas[i].id) {
        areas[i].id = "__" + i;
      }
      this.createArea(areas[i], cb);
    }
    cb();

    this.renderAll();
  },
  specialProperties: fabric.SlideCanvas.prototype.specialProperties.concat(["offsets","areas","helpers","areaActivating"])
})

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 56 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {



fabric.util.object.extend(fabric.Object.prototype, {
  // specialProperties: fabric.Object.prototype.specialProperties.concat(["relativeObject","relativeTop","relativeLeft","rotatingStep"]),
  /**
   * ����������� �������� ������ 45 ��������
   */
  _step_Rotating: function (angle) {
    var _a = this.getAngle();

    var x = parseInt(_a / angle) * angle;
    if (_a - x < angle / angle) {
      this.setAngle(x);
    } else {
      this.setAngle(x + angle);
    }
  },
  setRotatingStep: function(value){
    this.rotatingStep = value;
    this.on("rotating", function(e){
      if(!e.e.shiftKey){
        this._step_Rotating(value)
      }
    });
  },
  updateRelativeCoordinates: function () {
    this.setCoords();
    var _c = this.relativeObject.getCenterPoint();
    this.relativeLeft = this.left - _c.x;
    this.relativeTop = this.top - _c.y;
  },
  setRelativeTop: function(val) {
    this.relativeTop = val;
    if(this.relativeObject){
      this.relativeObject.updateBindedObject(this);
    }
  },
  setRelativeLeft: function(val) {
    this.relativeLeft = val;
    if(this.relativeObject){
      this.relativeObject.updateBindedObject(this);
    }
  },
  updateBindedObject: function(tag) {
    var _c = this.getCenterPoint();
    tag.left = _c.x + tag.relativeLeft;
    tag.top = _c.y   + tag.relativeTop;
    tag.setCoords();
  },
  setRelativeObject: function(obj){
    var tag = this;


    if (obj.constructor === String) {
      this.on("added",function(){
        obj = this.canvas.getObjectByID(obj.substring(1));
        this.setRelativeObject(obj);
      });
      return;
    }

    var _foo = obj.updateBindedObject.bind(obj,tag);

    this.relativeObject = obj;


    if(!this.relativeLeft || !this.relativeTop) {
      var _boundRect = obj.getBoundingRect();
    }
    if(!this.relativeLeft) {
      this.relativeLeft = this.left ? obj.left - this.left : _boundRect.width/2 / obj.canvas.getZoom() + 20;
    }
    if(!this.relativeTop){
      this.relativeTop = this.top ? obj.top - this.top : _boundRect.height/2 / obj.canvas.getZoom() + 20;
    };

    tag.on('removed', function () {
      var _proc = this.canvas.processing;
      if(!_proc)this.canvas.processing = true;
      obj.remove();
      if(!_proc)this.canvas.processing = false;
      // obj.off('moving', _foo);
      // obj.off('scaling', _foo);
      // obj.off('rotating', _foo);
    });
    obj.on('added', function () {
      var _proc = this.canvas.processing;
      if(!_proc)this.canvas.processing = true;
      this.canvas.add(tag);
      if(!_proc)this.canvas.processing = false;
    });
    obj.on('removed', function () {
      var _proc = this.canvas.processing;
      if(!_proc)this.canvas.processing = true;
      tag.remove();
      if(!_proc)this.canvas.processing = false;
    });
    obj.on('moving rotating scaling modified', _foo);
    tag.on('moving rotating scaling modified', tag.updateRelativeCoordinates);

    obj.updateBindedObject(tag);
  }
});

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 57 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {


/**
   * Draw CSS3 border image on canvas.
   * @param canvas    {HTMLCanvasElement}
   * @param img       {HTMLImageElement} border-image-source image
   * @param options   {Object}
   *      slice {Array} border-image-slice values
   *      width {Array} border-image-width values
   *      outset {Array} border-image-outset values
   *      repeat {Array} border-image-repeat values
   * @param size      {Object}
   */
   fabric.util.drawBorderImage  = function(canvas, img, options){


    var options = fabric.util.object.extend({
      "slice":        [25,25,25,25],
      "width":        [25,25,25,25],
      "fill":         false,
      "repeat":       ["round","round"],
      "outset_values"	: [0, 0, 0, 0],
      "slice_units"   : [0, 0, 0, 0],
      "width_units"	: [0, 0, 0, 0],
      "outset_units"	: [0, 0, 0, 0],
      "size"			: [canvas.width, canvas.height]
    },options)


    var w = img.width;
    var h = img.height;

    var ctx = canvas.getContext("2d");
    var slice = options.slice;
    var width = options.width;

    var w2 = options.size[0];
    var h2 = options.size[1];


    if(options.slice_units[0] == 1)slice[0] *=  h / 100;
    if(options.slice_units[1] == 1)slice[1] *=  w / 100;
    if(options.slice_units[2] == 1)slice[2] *=  h / 100;
    if(options.slice_units[3] == 1)slice[3] *=  w / 100;

    if(options.width_units[0] == 1)width[0] *= h2 / 100;
    if(options.width_units[1] == 1)width[1] *= w2 / 100;
    if(options.width_units[2] == 1)width[2] *= h2 / 100;
    if(options.width_units[3] == 1)width[3] *= w2 / 100;


    function drawSide(side,sliceOffset,sliceWidth, drawOffset,drawWidth){
      var d;
      if(side == 0) {
        d = [slice[3] + sliceOffset, 0, sliceWidth,  slice[0],
          width[3] + drawOffset, 0, drawWidth,  width[0]]
      }
      if(side == 2){
        d = [slice[3] + sliceOffset, h - slice[2] ,sliceWidth,  slice[2],
          width[3] + drawOffset, h2 - width[2],drawWidth, width[2]]
      }
      if(side == 1) {
        d = [ w - slice[1], slice[0] + sliceOffset,  slice[1], sliceWidth,
          w2 - width[1], width[0] + drawOffset,width[1], drawWidth];
      }
      if(side == 3) {
        d = [ 0, slice[0] + sliceOffset,  slice[3], sliceWidth,
          0, width[0] + drawOffset, width[3],drawWidth];
      }
      ctx.drawImage(img,d[0],d[1],d[2],d[3],d[4],d[5],d[6],d[7])
    }


    function _draw_border_side(side){
      var _top_width, _top_slice, repeat;
      if(side == 0 || side == 2){
        _top_width = w2 - width[1]- width[3];
        _top_slice  =  w - slice[1] - slice[3];
        repeat = options.repeat[0];
      }else{
        _top_width = h2 - width[0]- width[2];
        _top_slice  =  h - slice[0] - slice[2];
        repeat = options.repeat[1];
      }


      if(repeat == "stretch"){
        return drawSide(side, 0,  _top_slice ,  0,     _top_width);
      }

      var _aspect =   slice[side] / width[side];
      var _one_width =  _top_slice *  width[side] / slice[side] ;
      var count = 1;
      var _left = 0;

      if(repeat == "repeat"){

        var _rest = _one_width - _top_width % _one_width / 2;
        var _rest_aspect  = _aspect * _rest;
        count =  Math.floor(_top_width / _one_width);


        if(_rest > 0){
          drawSide(side, _rest_aspect ,  _top_slice - _rest_aspect,  0,     _one_width - _rest)
        }

        _left =  _one_width - _rest;

        for(var i = 0 ; i< count;i ++){
          drawSide( side,0,   _top_slice ,  _left,     _one_width);
          _left +=_one_width;
        }

        if(_rest > 0){
          drawSide(side,  0 ,    _top_slice - _rest_aspect,  _left,    _one_width - _rest );
        }
      }
      if(repeat == "round"){

        _left = 0;
        count =  Math.max(1,Math.round(_top_width / _one_width));
        _one_width = _top_width / count;

        while(_left < _top_width){
          drawSide(side,0,     _top_slice ,  _left,     _one_width );
          _left +=_one_width;
        }
      }
    }

    _draw_border_side(0);
    _draw_border_side(2);
    _draw_border_side(1);
    _draw_border_side(3);

  //top left
    ctx.drawImage(img, 0, 0, slice[3], slice[0], 0, 0, width[3], width[0]);
  //top right
    ctx.drawImage(img, w - slice[1], 0, slice[1], slice[0],
      w2 - width[1], 0, width[1], width[0]);
  //bottom left
    ctx.drawImage(img, 0, h - slice[2], slice[3], slice[2],
      0, h2 - width[2], width[3], width[2]);

  //bottom right
    ctx.drawImage(img, w - slice[1], h - slice[2], slice[1], slice[2],
      w2 - width[1], h2 - width[2], width[1], width[2]);

  }

  /*
   var Frame = function(project,data){

   if(data.border_image){
   data.border_image = mixin( {
   "slice":          [25,25,25,25],
   "width":          [25,25,25,25],
   "fill":           false,
   "repeat":         ["round","round"],
   "outset"	:     [0, 0, 0, 0],
   "slice_units"   : [0, 0, 0, 0],
   "width_units"	: [0, 0, 0, 0],
   "outset_units"	: [0, 0, 0, 0]
   }, data.border_image)
   }


   this.superclass.constructor.call(this,project,data);
   this._add_root("mask");
   this._add_root("image");
   this.example = this._get_example();

   };*/
  fabric.util.getOffsetsClipPath = function(o) {

    return ['M', o[3], o[0], 'L', 100 - o[1], o[0], 'L', 100 - o[1], 100 - o[2], 'L', o[3], 100 - o[2], 'z'].join(" ");
  };

  fabric.util.getRadiusClipPath = function(radius,radius_units, width,height) {

  var br  = radius;
  var bru = radius_units || [1,1,1,1,1,1,1,1];



  var s = {
    "top-left-h":     br[0] * (bru[0] ? height / 100 : 1),
    "top-left-w":     br[1] * (bru[1] ? width / 100 : 1),
    "top-right-h":    br[2] * (bru[2] ? height / 100 : 1),
    "top-right-w":    br[3] * (bru[3] ? width / 100 : 1),
    "bottom-right-w": br[4] * (bru[4] ? width / 100 : 1),
    "bottom-right-h": br[5] * (bru[5] ? height / 100 : 1),
    "bottom-left-w":  br[6] * (bru[6] ? width / 100 : 1),
    "bottom-left-h":  br[7] * (bru[7] ? height / 100 : 1)
  };

  return [
    "M", 0, s["top-left-h"],
    "C", 0, s["top-left-h"], 0, 0, s["top-left-w"], 0,
    "H", width - s["top-right-w"],
    "C", width - s["top-right-w"], 0, width, 0, width, s["top-right-h"],
    "V", height - s["bottom-right-h"],
    "C", width, height - s["bottom-right-h"], width, height, width - s["bottom-right-w"], height,
    "H", s["bottom-left-w"],
    "C", s["bottom-left-w"], height, 0, height, 0, height - s["bottom-left-h"],
    "Z"
  ].join(" ");
};

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 58 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {


fabric.util.object.extend(fabric.Canvas.prototype, {
    enableClipAreaZooming: function(){
      //todo
      // this.on('viewport:scaled', function(){
      //   if (!this.layer("background").objects) return;
      //   this._backgroundLayer[0].setCoords();
      // });
    },
    _fabric_clip_function: function (ctx2) {

      var clipRect = this.clipRect;
      ctx2.save();
      clipRect.render(ctx2);
      ctx2.restore();

    }
  });

fabric.Object.prototype.setClipTo = function(val) {
  if (typeof val !== 'string') {
    this.clipTo = val;
  }

  var functionBody = fabric.util.getFunctionBody(val);
  if (typeof functionBody !== 'undefined') {
    this.clipTo = new Function('ctx', functionBody);
  }
};

/**
 * @private
 * @param {Object} [options] Options object
 */
fabric.Object.prototype._initClipping = function (options) {
  if (!options.clipTo || typeof options.clipTo !== 'string') {
    return;
  }
  if (options.clipTo[0] == '#') {
    //  var _id = options.clipTo[0].substring(1);
    this.clipTo = options.clipTo;
    return;
  }

  var functionBody = fabric.util.getFunctionBody(options.clipTo);
  if (typeof functionBody !== 'undefined') {
    this.clipTo = new Function('ctx', functionBody);
  }
};
fabric.Object.prototype.getClipTo = function () {
  return "#" + this.clipTo.id;
}

fabric.util.clipContext = function (receiver, ctx) {
  ctx.save();
  ctx.beginPath();

  if (receiver.clipTo.constructor === String) {
    var _id = receiver.clipTo.substring(1);

    var _clipCtx = receiver.canvas.getObjectByID(_id);
    if(_clipCtx){
      receiver.clipTo = _clipCtx;
    }else{
      console.warn("error: clipTo not found" + receiver.clipTo);
      delete receiver.clipTo;
    }
  }

  if (receiver.clipTo.constructor === Function) {
    receiver.clipTo(ctx);
  } else {
    fabric.util._clipToObject(receiver, ctx)
    ctx.clip();
  }

};

fabric.util._clipToObject = function (receiver, ctx) {
  ctx.save();
  ctx.beginPath();

  var fromLeft = false;
  var center = fromLeft ? receiver._getLeftTopCoords() : receiver.getCenterPoint();
  ctx.transform(1, Math.tan(fabric.util.degreesToRadians(-receiver.skewY)), 0, 1, 0, 0);
  ctx.transform(1, 0, Math.tan(fabric.util.degreesToRadians(-receiver.skewX)), 1, 0, 0);
  ctx.scale(
    (1 / receiver.scaleX) * (receiver.flipX ? -1 : 1),
    (1 / receiver.scaleY) * (receiver.flipY ? -1 : 1)
  );
  ctx.rotate(fabric.util.degreesToRadians(-receiver.angle));
  ctx.translate(-center.x, -center.y);


  if (receiver.clipTo.points) {
    var ps = receiver.clipTo.points;
    ctx.moveTo(ps[0].x, ps[0].y);
    for (var j = 1; j < ps.length; j++) {
      ctx.lineTo(ps[j].x, ps[j].y);
    }
    //ctx.stroke();
  } else if (receiver.clipTo.type == "path") {

    ctx.globalAlpha = 0;
    receiver.clipTo.transform(ctx);
    receiver.clipTo._render(ctx);
  } else if (receiver.clipTo.type == "path-group") {
    ctx.globalAlpha = 0;
    receiver.clipTo.transform(ctx);
    ctx.translate(-receiver.clipTo.width/2, -receiver.clipTo.height/2);
    for (var i = 0, l = receiver.clipTo.paths.length; i < l; ++i) {
      receiver.clipTo.paths[i].render(ctx, true);
    }
  }else {
    ctx.translate(receiver.clipTo.left, receiver.clipTo.top);
    ctx.rotate(-(receiver.clipTo.angle * -1) * Math.PI / 180);
    ctx.rect(0,0, receiver.clipTo.width, receiver.clipTo.height);
  }

  ctx.closePath();
  ctx.restore();
};

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 59 */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(fabric) {fabric.ColorNameMap = {};

fabric.ColorNameMap.prototype = fabric.util.object.extend(fabric.Color.colorNameMap, {
    "aliceblue": "#f0f8ff",
    "antiquewhite": "#faebd7",
    "aqua": "#00ffff",
    "aquamarine": "#7fffd4",
    "azure": "#f0ffff",
    "beige": "#f5f5dc",
    "bisque": "#ffe4c4",
    "black": "#000000",
    "blanchedalmond": "#ffebcd",
    "blue": "#0000ff",
    "blueviolet": "#8a2be2",
    "brown": "#a52a2a",
    "burlywood": "#deb887",
    "cadetblue": "#5f9ea0",
    "chartreuse": "#7fff00",
    "chocolate": "#d2691e",
    "coral": "#ff7f50",
    "cornflowerblue": "#6495ed",
    "cornsilk": "#fff8dc",
    "crimson": "#dc143c",
    "cyan": "#00ffff",
    "darkblue": "#00008b",
    "darkcyan": "#008b8b",
    "darkgoldenrod": "#b8860b",
    "darkgray": "#a9a9a9",
    "darkgreen": "#006400",
    "darkkhaki": "#bdb76b",
    "darkmagenta": "#8b008b",
    "darkolivegreen": "#556b2f",
    "darkorange": "#ff8c00",
    "darkorchid": "#9932cc",
    "darkred": "#8b0000",
    "darksalmon": "#e9967a",
    "darkseagreen": "#8fbc8f",
    "darkslateblue": "#483d8b",
    "darkslategray": "#2f4f4f",
    "darkturquoise": "#00ced1",
    "darkviolet": "#9400d3",
    "deeppink": "#ff1493",
    "deepskyblue": "#00bfff",
    "dimgray": "#696969",
    "dodgerblue": "#1e90ff",
    "firebrick": "#b22222",
    "floralwhite": "#fffaf0",
    "forestgreen": "#228b22",
    "fuchsia": "#ff00ff",
    "gainsboro": "#dcdcdc",
    "ghostwhite": "#f8f8ff",
    "gold": "#ffd700",
    "goldenrod": "#daa520",
    "gray": "#808080",
    "green": "#008000",
    "greenyellow": "#adff2f",
    "honeydew": "#f0fff0",
    "hotpink": "#ff69b4",
    "indianred": "#cd5c5c",
    "indigo": "#4b0082",
    "ivory": "#fffff0",
    "khaki": "#f0e68c",
    "lavender": "#e6e6fa",
    "lavenderblush": "#fff0f5",
    "lawngreen": "#7cfc00",
    "lemonchiffon": "#fffacd",
    "lightblue": "#add8e6",
    "lightcoral": "#f08080",
    "lightcyan": "#e0ffff",
    "lightgoldenrodyellow": "#fafad2",
    "lightgrey": "#d3d3d3",
    "lightgreen": "#90ee90",
    "lightpink": "#ffb6c1",
    "lightsalmon": "#ffa07a",
    "lightseagreen": "#20b2aa",
    "lightskyblue": "#87cefa",
    "lightslategray": "#778899",
    "lightsteelblue": "#b0c4de",
    "lightyellow": "#ffffe0",
    "lime": "#7FBA00",
    "limegreen": "#32cd32",
    "linen": "#faf0e6",
    "magenta": "#ff00ff",
    "maroon": "#800000",
    "mediumaquamarine": "#66cdaa",
    "mediumblue": "#0000cd",
    "mediumorchid": "#ba55d3",
    "mediumpurple": "#9370d8",
    "mediumseagreen": "#3cb371",
    "mediumslateblue": "#7b68ee",
    "mediumspringgreen": "#00fa9a",
    "mediumturquoise": "#48d1cc",
    "mediumvioletred": "#c71585",
    "midnightblue": "#191970",
    "mintcream": "#f5fffa",
    "mistyrose": "#ffe4e1",
    "moccasin": "#ffe4b5",
    "navajowhite": "#ffdead",
    "navy": "#000080",
    "oldlace": "#fdf5e6",
    "olive": "#808000",
    "olivedrab": "#6b8e23",
    "orange": "#ffa500",
    "orangered": "#ff4500",
    "orchid": "#da70d6",
    "palegoldenrod": "#eee8aa",
    "palegreen": "#98fb98",
    "paleturquoise": "#afeeee",
    "palevioletred": "#d87093",
    "papayawhip": "#ffefd5",
    "peachpuff": "#ffdab9",
    "peru": "#cd853f",
    "pink": "#ffc0cb",
    "plum": "#dda0dd",
    "powderblue": "#b0e0e6",
    "purple": "#800080",
    "red": "#ff0000",
    "rosybrown": "#bc8f8f",
    "royalblue": "#4169e1",
    "saddlebrown": "#8b4513",
    "salmon": "#fa8072",
    "sandybrown": "#f4a460",
    "seagreen": "#2e8b57",
    "seashell": "#fff5ee",
    "sienna": "#a0522d",
    "silver": "#c0c0c0",
    "skyblue": "#87ceeb",
    "slateblue": "#6a5acd",
    "slategray": "#708090",
    "snow": "#fffafa",
    "springgreen": "#00ff7f",
    "steelblue": "#4682b4",
    "tan": "#d2b48c",
    "teal": "#008080",
    "thistle": "#d8bfd8",
    "tomato": "#ff6347",
    "turquoise": "#40e0d0",
    "violet": "#ee82ee",
    "wheat": "#f5deb3",
    "white": "#ffffff",
    "whitesmoke": "#f5f5f5",
    "yellow": "#ffff00",
    "yellowgreen": "#9acd32"
});

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 60 */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(fabric) {var _performTransformAction_overwritten = fabric.Canvas.prototype._performTransformAction;

var isVML = function() { return typeof G_vmlCanvasManager !== 'undefined'; };


fabric.util.object.extend(fabric.SlideCanvas.prototype, {
  /**
   * Add custom pointers
   * @param corner
   * @param target
   * @param e
   * @private
   */
  _setCornerCursor: function (corner, target, e) {
    var _cursor = target._controls[corner].cursor;
    if(!_cursor || _cursor == "resize"){
      this.setCursor(this._getRotatedCornerCursor(corner, target, e));
    }else{
      this.setCursor(this[_cursor]);
    }
  },
  /**
   * custom transform actions
   * @param e
   * @param transform
   * @param pointer
   * @private
   */
  _performTransformAction: function (e, transform, pointer) {

    if(!transform.action)return;
    var t = transform.target;
    var foo = t["_perform" + fabric.util.string.capitalize(transform.action) + "Action"];
    if (foo) {
      var _p = t.toLocalPoint(pointer, transform.originX, transform.originY);
      _p.x /= t.scaleX;
      _p.y /= t.scaleY;
      if (t.flipX) _p.x *= -1;
      if (t.flipY) _p.y *= -1;
      transform.point = _p;
      foo.call(t, e, transform, pointer);
      return;
    }
    _performTransformAction_overwritten.call(this, e, transform, pointer);
  },
  /**
   * custom pointers
   * @param target
   * @param corner
   * @param e
   * @returns {string}
   * @private
   */
  _getActionFromCorner: function (target, corner, e) {
    if (corner) {
      var _corner = target._controls[corner];
      return e[this.altActionKey] && _corner.altAction || _corner.action;
    }
    return 'drag';
  }
});

fabric.util.object.extend(fabric.Object.prototype, {
  setControls: function(){
    var _controls =  this.getBoundsControls();
    this.setExtraControls && this.setExtraControls(_controls);

    for(var i in _controls){
      var _control = _controls[i];
      if(!_control.style){
        _control.style = this.cornerStyle;
      }
      if(!_control.size){
        _control.size = this.getCornerSize(i);
      }
    }
    this._controls = _controls;
  },
  /**
   * Solved the problem when it is impossible to move point when it is under another native control such as "mtr", "tl" etc.
   * Determines which corner has been clicked
   * @private
   * @param {Object} pointer The pointer indicating the mouse position
   * @return {String|Boolean} corner code (tl, tr, bl, br, etc.), or false if nothing is found
   */
  _findTargetCorner: function (pointer) {
    if (!this.hasControls || !this.active) {
      return false;
    }
    var ex = pointer.x,
      ey = pointer.y,
      xPoints,
      lines;
    this.__corner = 0;

    for (var i in this.oCoords) {
      if(!this._controls[i].visible){
        continue;
      }
      lines = this._getImageLines(this.oCoords[i].corner);
      xPoints = this._findCrossPoints({x: ex, y: ey}, lines);
      if (xPoints !== 0 && xPoints % 2 === 1) {
        this.__corner = i;
        return i;
      }
    }
    return false;
  },
  controls: {
    tl: {x: 0, y: 0, action: "scale"},
    tr: {x: "{width}", y: 0, action: "scale"},
    bl: {x: 0, y: "{height}", action: "scale"},
    br: {x: "{width}", y: "{height}", action: "scale"},
    ml: {visible: "!{lockUniScaling}" , x: 0,             y: "{height}/2", action:   "scaleX" , altAction: "skewY"},
    mr: {visible: "!{lockUniScaling}" , x: "{width}",     y: "{height}/2", action:   "scaleX" , altAction: "skewY"},
    mt: {visible: "!{lockUniScaling}" , x: "{width}/2",   y: 0,            action:   "scaleY" , altAction: "skewX"},
    mb: {visible: "!{lockUniScaling}" , x: "{width}/2",   y: "{height}",   action:   "scaleY" , altAction: "skewX"},
    mtr:{visible: "{hasRotatingPoint}", x: "{width}/2",   y: "-{rotatingPointOffset}/{zoom}/{scaleY}", action: "rotate", cursor: "rotationCursor"},
  },
  getBoundsControls: function(){
    // if(!this.hasBoundsControls)return {};
    var zoom = this.canvas.viewportTransform[0];

    //todo eval тяжелая функция
    var _replace = function (val){
      if(val && val.constructor == String){
        val = val.replace(/\{zoom\}/g,zoom)
           .replace(/\{([^}]*)\}/g,function(a,b){
             return "this." +b
           });
        val = eval(val);
      }
      return val;
    }.bind(this);

    var controls = {};
    for(var i in this.controls){
      var control = this.controls[i];

      var _visible = this.hasBoundsControls && (control.visible === undefined || _replace(control.visible));

      // if(_visible){
        var _newControl = fabric.util.object.clone(control);
        delete _newControl.visible;
        _newControl.x = _replace(_newControl.x);
        _newControl.y = _replace(_newControl.y);
        _newControl.visible = _visible;
        controls[i] = _newControl;
      // }
    }

    // this._getControlsFunction = eval("return ")
    // //
    // var controls = {
    //   tl: {x: 0, y: 0, action: "scale"},
    //   tr: {x: this.width, y: 0, action: "scale"},
    //   bl: {x: 0, y: this.height, action: "scale"},
    //   br: {x: this.width, y: this.height, action: "scale"}
    // };
    // if(!this.lockUniScaling) {
    //   fabric.util.object.extend(controls,{
    //     ml: {x: 0,            y: this.height/2, action:   "scaleX" , altAction: "skewY"},
    //     mr: {x: this.width,   y: this.height/2, action:   "scaleX" , altAction: "skewY"},
    //     mt: {x: this.width/2, y: 0,             action:   "scale"  , altAction: "skewX"},
    //     mb: {x: this.width/2, y: this.height,   action:   "scale"  , altAction: "skewX"},
    //   })
    // }
    // if(this.hasRotatingPoint){
    //   fabric.util.object.extend(controls, {
    //     mtr: this.hasRotatingPoint && {x: this.width / 2, y: -this.rotatingPointOffset / zoom, action: "rotate", cursor: "rotationCursor"},
    //     mtr2: {x: this.width / 2, y: this.height + this.rotatingPointOffset / zoom, action: "rotate", cursor: "rotationCursor"}
    //   });
    // };
    // return target._corner_actions[corner.substr(1)] || target._default_corner_action;
    return controls;
  },
  /**
   * Sets corner position coordinates based on current angle, width and height
   * See https://github.com/kangax/fabric.js/wiki/When-to-call-setCoords
   * @return {fabric.Object} thisArg
   * @chainable
   */
  setCoords: function () {
    if(!this.canvas)return;

    var i, _p, _c, _x, _y,
      zoom = this.canvas.viewportTransform[0],
      theta = fabric.util.degreesToRadians(this.angle),
      vpt = this.getViewportTransform(),
      dim = this._calculateCurrentDimensions(),
      currentWidth = dim.x, currentHeight = dim.y;

    // If width is negative, make postive. Fixes path selection issue
    if (currentWidth < 0) {
      currentWidth = Math.abs(currentWidth);
    }

    var sinTh = Math.sin(theta),
      cosTh = Math.cos(theta),
      _angle = currentWidth > 0 ? Math.atan(currentHeight / currentWidth) : 0,
      _hypotenuse = (currentWidth / Math.cos(_angle)) / 2,
      offsetX = Math.cos(_angle + theta) * _hypotenuse,
      offsetY = Math.sin(_angle + theta) * _hypotenuse,
      coords = fabric.util.transformPoint(this.getCenterPoint(), vpt);

    var TL = {x: coords.x - offsetX, y: coords.y - offsetY};

    this.setControls();
    this.oCoords = {};

    for (i in this._controls) {
      _p = {x: this._controls[i].x * this.scaleX, y: this._controls[i].y * this.scaleY};
      // _c = this.flipX ? (this.flipY ? "br" : "tr") : (this.flipY ? "bl" : "tl");
      this.oCoords[i] = {
        x: TL.x + ((-sinTh * _p.y + cosTh * _p.x) * (this.flipX ? -1 : 1)) * zoom,
        y: TL.y + (( cosTh * _p.y + sinTh * _p.x) * (this.flipY ? -1 : 1)) * zoom
      }
    }

    this._setCornerCoords && this._setCornerCoords();
    return this;
  },
  drawControls: function (ctx) {

    if (!this.hasControls) {
      return this;
    }

    var transformMatrix = this._calcDimensionsTransformMatrix(this.skewX, this.skewY, false);
    var wh = this._calculateCurrentDimensions(),
      width = wh.x,
      height = wh.y,
      zoom = this.canvas.viewportTransform[0],
      methodName = this.transparentCorners ? 'stroke' : 'fill',
      i, corner, _p, left, top, _x, _y, stroke, scaleOffset;

    ctx.save();
    ctx.lineWidth = 1;
    var _corner_alpha =  this.isMoving ? this.borderOpacityWhenMoving : 1;
    ctx.strokeStyle = ctx.fillStyle = this.cornerColor;

    for (var cornerName in this._controls) {
      corner = this._controls[cornerName];
      if(!corner.visible || corner.intransformable && this.canvas._currentTransform){
        continue;
      }
      _p = fabric.util.transformPoint(corner, transformMatrix);
      left = (this.flipX ? ( width - _p.x) : _p.x) * zoom;
      top = (this.flipY ? (height - _p.y) : _p.y) * zoom;
      stroke = !this.transparentCorners && this.cornerStrokeColor;

      var _foo = corner.styleFunction || this.cornerStyles[corner.style];
      if(corner.size) {
        ctx.globalAlpha = _corner_alpha;
        _foo.call(this, cornerName, ctx, methodName, left - (width + corner.size) / 2, top - (height + corner.size) / 2, corner.size, stroke);
      }
      if(corner.area){
        ctx.globalAlpha = 0.008;
        // ctx.globalAlpha = 0.3;
        this.cornerStyles.circle.call(this, cornerName, ctx, methodName, left -(width + corner.area) / 2 , top -(height + corner.area) / 2, corner.area, stroke);

        ctx.globalAlpha = 1;
      }
    }

    // if (this.extraControls) {
    //   for (i in this.extraControls) {
    //     _p = fabric.util.transformPoint(this.extraControls[i], transformMatrix);
    //     scaleOffset = this.cornerSize;
    //     left = -(width + scaleOffset) / 2;
    //     top = -(height + scaleOffset) / 2;
    //     _x = left + (this.flipX ? ( width - _p.x) : _p.x) * zoom;
    //     _y = top + (this.flipY ? (height - _p.y) : _p.y) * zoom;
    //     this._drawControl( i, ctx, methodName, _x, _y);
    //   }
    // }

    this.drawControlsInterface && this.drawControlsInterface(ctx);
    this.drawBorder && this.drawBorder(ctx);
    ctx.restore();

    return this;
  },

  cornerStyles: {
    arc: function (control, ctx, methodName, left, top, size, stroke) {
      ctx.save();
      ctx.beginPath();
      ctx.translate(left, top);

      if (control[0] !== "m") {
        ctx.translate(size, 0);
        ctx.rotate(Math.PI / 2);
      }
      switch (control) {
        case "tr":
          ctx.arc(size / 2, size / 2, size / 2, 2 * Math.PI, 0.5 * Math.PI, true);
          ctx.lineTo(size / 2, size / 2);
          break;
        case "br":
          ctx.arc(size / 2, size / 2, size / 2, 0.5 * Math.PI,  Math.PI, true);
          ctx.lineTo(size / 2, size / 2);
          break;
        case "bl":
          ctx.arc(size / 2, size / 2, size / 2, Math.PI, 1.5 * Math.PI, true);
          ctx.lineTo(size / 2, size / 2);
          break;
        case "tl":
          ctx.arc(size / 2, size / 2, size / 2, 1.5 * Math.PI, 2 * Math.PI, true);
          ctx.lineTo(size / 2, size / 2);
          break;
        case "mt":
          ctx.arc(size / 2, size / 2, size / 2, 0, Math.PI, true);
          break;
        case "mb":
          ctx.arc(size / 2, size / 2, size / 2, 0, Math.PI, false);
          break;
        case "ml":
          ctx.translate(0, size);
          ctx.rotate(-Math.PI / 2);
          ctx.arc(size / 2, size / 2, size / 2, 0, Math.PI, true);
          break;
        case "mr":
          ctx.translate( -1, size);
          ctx.rotate(-Math.PI / 2);
          ctx.arc(size / 2, size / 2, size / 2, 0, Math.PI, false);
          break;
        default:
          ctx.arc(size / 2, size / 2, size / 2, 0, 2 * Math.PI, false);
      }
      // ctx.moveTo(0, 0);
      // ctx.lineTo(size, 0);
      // ctx.lineTo(size, size / 2);
      //
      // if (control[0] == "m") {
      //   ctx.lineTo(0, size / 2);
      // } else {
      //   ctx.lineTo(size / 2, size / 2);
      //   ctx.lineTo(size / 2, size);
      //   ctx.lineTo(0, size);
      // }

      // if (control !== "mtr") {
      //   if (control[0] !== "m") {
      //     ctx.arc(size / 2, size / 2, size / 2, 0, 1.5 * Math.PI, false);
      //     ctx.lineTo(size / 2, size / 2)
      //   }
      // }
      ctx.closePath();
      ctx[methodName]();
      if (stroke) {
        ctx.stroke();
      }
      ctx.restore();
    },
    frame: function (control, ctx, methodName, left, top, size, stroke) {
      if (control == "mtr") {
        // this.transparentCorners || ctx.clearRect(left, top, size, size);
        ctx[methodName + 'Rect'](left, top, size, size);
        if (stroke) {
          ctx.strokeRect(left, top, size, size);
        }
        return;
      }

      ctx.save();
      ctx.beginPath();
      ctx.translate(left, top);
      switch (control) {
        case "tr":
          ctx.translate(size, 0);
          ctx.rotate(Math.PI / 2);
          break;
        case "br":
          ctx.translate(size, size);
          ctx.rotate(Math.PI);
          break;
        case "bl":
          ctx.translate(0, size);
          ctx.rotate(-Math.PI / 2);
          break;
        case "mr":
          ctx.translate(size, 0);
          ctx.rotate(Math.PI / 2);
          break;
        case "ml":
          ctx.translate(size / 2, 0);
          ctx.rotate(Math.PI / 2);
          break;
        case "mb":
          ctx.translate(0, size / 2);
          break;
      }
      ctx.moveTo(0, 0);
      ctx.lineTo(size, 0);
      ctx.lineTo(size, size / 2);

      if (control[0] == "m") {
        ctx.lineTo(0, size / 2);
      } else {
        ctx.lineTo(size / 2, size / 2);
        ctx.lineTo(size / 2, size);
        ctx.lineTo(0, size);
      }
      ctx.closePath();
      ctx[methodName]();
      if (stroke) {
        ctx.stroke();
      }
      ctx.restore();
    },
    circle: function (control, ctx, methodName, left, top, size, stroke) {
      ctx.beginPath();
      ctx.arc(left + size / 2, top + size / 2, size / 2, 0, 2 * Math.PI, false);
      ctx[methodName]();
      if (stroke) {
        ctx.stroke();
      }
    },
    rect: function (control, ctx, methodName, left, top, size, stroke) {
      this.transparentCorners && ctx.clearRect(left, top, size, size);
      ctx[methodName + 'Rect'](left, top, size, size);
      if (stroke) {
        ctx.strokeRect(left, top, size, size);
      }
    }
  },
  resizableEdge: false,
  /**
   * Sets the coordinates of the draggable boxes in the corners of
   * the image used to scale/rotate it.
   * @private
   */
  _setCornerCoords: function() {
    var coords = this.oCoords,
      newTheta = fabric.util.degreesToRadians(45 - this.angle),
      cornerHypotenuse,
      cosHalfOffset,
      sinHalfOffset ,
      x, y;

    for (var point in coords) {
      var size = this._controls[point].area || this._controls[point].size;
      cornerHypotenuse = size * 0.707106;
      cosHalfOffset = cornerHypotenuse * Math.cos(newTheta);
      sinHalfOffset = cornerHypotenuse * Math.sin(newTheta);

      var _corners = {tl: point, tr: point, bl: point, br: point};

      if(this.resizableEdge){
        switch(point){
          case "ml":
            _corners = {tl: "tl", tr: "tl", bl: "bl", br: "bl"};
            break;
          case "mt":
            _corners = {tl: "tl", tr: "tr", bl: "tl", br: "tr"};
            break;
          case "mr":
            _corners = {tl: "tr", tr: "tr", bl: "br", br: "br"};
            break;
          case "mb":
            _corners = {tl: "bl", tr: "br", bl: "bl", br: "br"};
            break;
        }
      }

      coords[point].corner = {
        tl: {
          x: coords[_corners.tl].x - sinHalfOffset,
          y: coords[_corners.tl].y - cosHalfOffset
        },
        tr: {
          x: coords[_corners.tr].x + cosHalfOffset,
          y: coords[_corners.tr].y - sinHalfOffset
        },
        bl: {
          x: coords[_corners.bl].x - cosHalfOffset,
          y: coords[_corners.bl].y + sinHalfOffset
        },
        br: {
          x: coords[_corners.br].x + sinHalfOffset,
          y: coords[_corners.br].y + cosHalfOffset
        }
      };
    }
  },
  getCornerAreaSize: function(control){
    if(this.cornerAreaSize){
      return this.cornerAreaSize;
    }
    return this.cornerSize[control] || this.cornerSize.all || this.cornerSize
  },
  getCornerSize: function(control){
    return this.cornerSize[control] || this.cornerSize.all || this.cornerSize
  },
  /**
   * @private
   */
  _drawControl: function (control, ctx, methodName, left, top) {
    if (!this.isControlVisible(control)) {
      return;
    }
    var _cornerStyle = this.cornerStyle[control] || this.cornerStyle.all || this.cornerStyle;
    var size = this.getCornerSize(control);
    var stroke = !this.transparentCorners && this.cornerStrokeColor;
    this.cornerStyles[_cornerStyle].call(this, control, ctx, methodName, left, top, size, stroke);
  }
  // _getControlsVisibility: function() {
  //   if (!this._controlsVisibility) {
  //     this._controlsVisibility = {
  //       tl: true,
  //       tr: true,
  //       br: true,
  //       bl: true,
  //       ml: true,
  //       mt: true,
  //       mr: true,
  //       mb: true,
  //       mtr: true,
  //       p: true
  //     };
  //   }
  //   return this._controlsVisibility;
  // },
  // isControlVisible: function(controlName) {
  //   var _mtr = controlName === 'mtr';
  //   var _cv = this._getControlsVisibility();
  //   var _middle = !_mtr && controlName[0] == "m";
  //   var _corner = controlName === 'tl' || controlName === 'tr' || controlName === 'bl' || controlName === 'br';
  //
  //   if (!this.hasBoundsControls && (_mtr || _corner || _middle))return false;
  //   if (!this.hasRotatingPoint && _mtr )return false;
  //   if (this.lockUniScaling && _middle)return false;
  //
  //   if(_cv[controlName]) return true;
  //
  //   if(!_corner && !_middle && !_mtr){
  //     return _cv.p
  //   }
  //
  //   return false;
  // }
});

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 61 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {


fabric.util.object.extend(fabric.SlideCanvas.prototype, {
  buttonCursor:             'pointer',
  rotationCursor:           'url(data:image/png;base64,' + __webpack_require__(24) + ') 8 8,auto',
  eyedropperCursor:         'url(data:image/svg+xml;utf8;base64,' + __webpack_require__(19) + ') 0 16,default',
  targetCursor:             'url(data:image/svg+xml;utf8;base64,'+ __webpack_require__(25) +  ') 8 8,default',
  specialProperties: fabric.SlideCanvas.prototype.specialProperties.concat(["cursorLines"]),
  cursorLines: false,
  setCursorLines: function(val){
    this.cursorLines = val;
    if(!val)return;

    this._vCursorLine = document.createElement("span");
    this._vCursorLine.className = "vertical-cursor-line";
    this._hCursorLine = document.createElement("span");
    this._hCursorLine.className = "horizontal-cursor-line";
    this._vCursorLine.style.position = "absolute";
    this._vCursorLine.style.display = "none";
    this._vCursorLine.style.height = "100%";
    this._vCursorLine.style.width = "1px";
    this._vCursorLine.style.display = "block";
    this._vCursorLine.style.background = this.cursorLines;
    this._hCursorLine.style.position = "absolute";
    this._hCursorLine.style.display = "none";
    this._hCursorLine.style.width = "100%";
    this._hCursorLine.style.height = "1px";
    this._hCursorLine.style.display = "block";
    this._hCursorLine.style.background = this.cursorLines;


    this.on('mouse:out', function(e){
      this.hideLines();
    });
    this.on('mouse:move', function(e){
      if(!this._linesAdded){
        this.wrapperEl.insertBefore(this._hCursorLine,this.upperCanvasEl);
        this.wrapperEl.insertBefore(this._vCursorLine,this.upperCanvasEl);
        this._linesAdded = true;
        this._linesVisible = false;
      }
      this.drawCursorLines(e.e);
    })
  },
  hideLines: function() {

    if (this._linesVisible) {
      this._linesVisible = false;
      this._hCursorLine.style.display = "none";
      this._vCursorLine.style.display = "none";

    }
  },
  drawCursorLines: function(e){

    if(this.isDrawingMode && !this._isCurrentlyDrawing){
      if(!this._linesVisible){
        this._linesVisible = true;
        this._hCursorLine.style.display = "block";
        this._vCursorLine.style.display = "block";
      }
      var point = this.getPointer(e);
      this._vCursorLine.style.left = this.viewportTransform[4]  + point.x * this.viewportTransform[3]  + "px";
      this._hCursorLine.style.top = this.viewportTransform[5] + point.y * this.viewportTransform[0] + "px";
    }else{
      this.hideLines();
    }
  }
});

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 62 */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(fabric) {
fabric.util.object.extend(fabric.Canvas.prototype, {
  /**
   }
   * не позволяет снимать выделение с объектов
   */
  deactivationDisabled: false,
  /**
   * Discards currently active object and fire events
   * @param {event} e
   * @return {fabric.Canvas} thisArg
   * @chainable
   */
  discardActiveObject: function (e) {
    var activeObject = this._activeObject;
    if(!activeObject)return this;

    this.fire('before:selection:cleared', { target: activeObject, e: e });

    this._discardActiveObject();

    this.fire('selection:cleared', { e: e });
    activeObject && activeObject.fire('deselected', { e: e });
    return this;
  },
  _discardActiveObject: function(){
    if (this._activeObject && !this.deactivationDisabled && !this._activeObject.deactivationDisabled) {
      this._activeObject.set('active', false);
    }
    this._activeObject = null;
  },

  /**
   * Discards currently active group and fire events
   * @return {fabric.Canvas} thisArg
   * @chainable
   */
  discardActiveGroup: function (e) {
    var g = this.getActiveGroup();
    if(!g)return this;
    this.fire('before:selection:cleared', { e: e, target: g });

    if (this.deactivationDisabled || g.deactivationDisabled) {
      this._activeGroup = null;
    }else{
      this._discardActiveGroup();
    }

    this.fire('selection:cleared', { e: e });
    return this;
  },

  /**
   * Deactivates all objects on canvas, removing any active group or object
   * @return {fabric.Canvas} thisArg
   * @chainable
   */
  deactivateAll: function () {
    if (!this.deactivationDisabled) {
      var allObjects = this.getObjects(),
        i = 0,
        len = allObjects.length;
      for (; i < len; i++) {
        !allObjects[i].deactivationDisabled && allObjects[i].set('active', false);
      }
      var g = this.getActiveGroup();
      g && !g.deactivationDisabled &&  this._discardActiveGroup();
      this._activeObject && !this._activeObject.deactivationDisabled && this._discardActiveObject();
    }else{
      this._activeGroup = null;
      this._activeObject = null;
    }
    return this;
  },
  setActiveObject: function (object, e) {
    if(object){
      this._setActiveObject(object);
      this.renderAll();
      this.fire('object:selected', { target: object, e: e });
      object.fire('selected', { e: e });
    }else{
      this.discardActiveObject();
    }
    return this;
  },
  /**
   * @private
   * @param {Object} object
   */
  _setActiveObject: function(object) {
    if (!this.deactivationDisabled) {
      if (this._activeObject && !this._activeObject.deactivationDisabled) {
        this._activeObject.set('active', false);
      }
    }
    this._activeObject = object;

    if(object){
      object.set('active', true);
    }
  }
});

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 63 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.util.object.extend(fabric.SlideCanvas.prototype, {
  setDroppable: function(val){
    this.droppable = val;
    if(this.droppable){
      this.initDragAndDrop();
    }
  },
  droppable: false, //{}
  isDropAvailable: function (droppable, data) {

    for (var i in droppable) {
      if (droppable[i].constructor == Array) {
        if (droppable[i].indexOf(data[i]) == -1)return false;
      } else {
        if(droppable[i] == "*")continue;
        if (droppable[i] != data[i]) return false;
      }
    }
    return true;
    //return (this.supportedTypes == "*" || this.supportedTypes.indexOf(type)!= -1)
  },
  drop: function (data) {
    var _this = this;
    data = fabric.util.object.clone(data);

    if (data.category == "background") {
      this.setBackgroundImage(data.src, this.renderAll.bind(this))
    }
    else {
      data.active = true;
      _this.createObject(data);
    }


    //fabric.util.createObject(data, function (el) {
    //  app.canvas.add(el);
    //  app.canvas.setActiveObject(el);
    //});
  },
  initDragAndDrop: function () {
    this.on("mouse:drop", function (e) {
      var _x = (e.x - e.offsetX);
      var _y = (e.y - e.offsetY)
      var _w = (e.data.width || e.width  );
      var _h = (e.data.height || e.height );
      if (e.data.scaleX) {
        var _scaleX = e.data.scaleX / this.viewportTransform[0]

      } else {
        _scaleX = 1;
        _w /= this.viewportTransform[0]
      }

      if (e.data.scaleY) {
        var _scaleY = e.data.scaleY / this.viewportTransform[3];
      } else {
        _scaleY = 1;
        _h /= this.viewportTransform[3]
      }

      if (e.data.left) {
        _x += (e.data.left + e.data.strokeWidth) / this.viewportTransform[0];
      }
      if (e.data.top) {
        _y += (e.data.top + e.data.strokeWidth) / this.viewportTransform[3];
      }
      var data = fabric.util.object.extend({}, e.data, {
        scaleX: _scaleX,
        scaleY: _scaleY,
        left: _x,
        top: _y,
        width: _w,
        height: _h,
        originalWidth: e.data.width,
        originalHeight: e.data.height
      });

      var event = e.originalEvent;
      var pointer = this.getPointer(event, true);

      var target = this._searchPossibleTargets(this._backgroundLayer, pointer);
      if (target) {
        this.setActiveArea(target);
        data.clipTo = "#" + target.id;
        data.movementLimits = "#" + target.id;
      }


      if (e.target && e.target.droppable) {
        if (this.isDropAvailable(e.target.droppable, e.data)) {
          e.target.deactivate();
          e.target.drop(data);
        }
      } else {
        if (this.droppable && this.isDropAvailable(this.droppable, e.data)) {
          this.drop(data);
        }
      }
    });
    this.on("mouse:dragenter", function (e) {
      if (e.target && e.target.droppable) {
        if (this.isDropAvailable(e.target.droppable, e.data)) {
          e.target.activate();
          e.e.helper.css("cursor", "alias");
          this.setCursor("alias");
        } else {
          e.e.helper.css("cursor", "not-allowed");
          this.setCursor("not-allowed");
        }
      }
    });
    this.on("mouse:dragleave", function (e) {
      if (e.target && e.target.droppable) {
        if (this.isDropAvailable(e.target.droppable, e.data)) {
          this._activated = false;
          e.target.deactivate()
        }
        e.e.helper.css("cursor", "pointer");
      }
    });
  }
});

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 64 */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(fabric) {
fabric.SlideCanvas.addPlugin("initialize",function(){
  if(typeof this.freeDrawingBrush == "string" ){
    this.setFreeDrawingBrush(this.freeDrawingBrush);
  }
});

fabric.util.object.extend(fabric.SlideCanvas.prototype,{
  /**
   * ['PencilBrush','RectangleBrush']
   */
  activeDrawingTools: [],
  /**
   *
     {
      BrushClassName: {
        className: 'brush className',
        title: 'brush title'
      }
    }
   */
  drawingTools: {},
  insertDrawingTool: false,
  actions: fabric.util.object.extend(fabric.SlideCanvas.prototype.actions,{
    drawingTool: {
      title: 'drawing-tool',
      type: 'options',
      value: 'freeDrawingBrush',
      menu: function(){
        var _tools = {};
        for(var i in this.activeDrawingTools){
          var _tool = this.activeDrawingTools[i];
          _tools[_tool] = fabric.util.object.extend({option: _tool},this.drawingTools[_tool]);
        }
        return _tools;
      }
    }
  }),
  freeDrawingBrush: 'PencilBrush',
  drawingColor: [0,0,0,255],
  _onMouseDownInDrawingMode: function(e) {
    this._isCurrentlyDrawing = true;
    if(!this.freeDrawingBrush.target){
      this.discardActiveObject(e).renderAll();
    }
    if (this.clipTo) {
      fabric.util.clipContext(this, this.contextTop);
    }
    var pointer = this.getPointer(e);
    this.freeDrawingBrush.onMouseDown(pointer);
    this._handleEvent(e, 'down');
  },
  getFreeDrawingBrush: function() {
    if(!this.freeDrawingBrush){
      return "Selection";
    }
    return  fabric.util.string.capitalize(fabric.util.string.camelize(this.freeDrawingBrush.type),true);
  },
  setFreeDrawingBrush: function(brush) {

    if(brush == 'Selection'){
      this.isDrawingMode = false;
      this.freeDrawingBrush = "";
      return;
    }
    var className = fabric.util.string.capitalize(fabric.util.string.camelize(brush),true);
    if(this["__" + className]){
      this.freeDrawingBrush = this["__" + className] ;
    }else{
      this.freeDrawingBrush = this["__" + className] = new  fabric[className](this);
    }
    this.fire("brush:changed",{brush: this.freeDrawingBrush});
  },
  drawZoomedArea : function(ctx,left, top ,width, height , pointer ) {

    width = width || 90;
    height = height || 90;

    ctx.save();
    ctx.translate(left || 0, top || 0);

    ctx.fillStyle = 'black';
    ctx.strokeStyle = "#fff";
    ctx.strokeWidth = 1;
    ctx.setLineDash([2, 2]);
    ctx.drawImage(this.backgroundImage._element,Math.floor(pointer.x) - 4, Math.floor(pointer.y) - 4 , 9 , 9, 0,0 , width, width );
    ctx.strokeRect(0,0 , width, width);
    ctx.strokeRect(40 , 40 , 10, 10);
    ctx.restore();
  }
});

fabric.SlideCanvas.prototype.drawingTools.Selection = {
  className: 'fa fa-mouse-pointer',
  title: 'Selection'
};
fabric.SlideCanvas.prototype.activeDrawingTools.push("Selection");

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 65 */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(fabric) {
fabric.Application.prototype.eventListeners["entity:created"].push(function(e){
    if(e.target.eventListeners){
      for(var i in e.target.eventListeners) {
        var _listeners = e.target.eventListeners[i];
        if(_listeners.constructor == Array){
          for (var j in _listeners) {
            e.target.on(i, _listeners[j]);
          }
        }else{
          e.target.on(i, _listeners);
        }
      }
    }

    if(e.options.eventListeners){
      for(var i in e.options.eventListeners){
        e.target.on(i,e.options.eventListeners[i]);
      }
    }
    delete e.options.eventListeners;

  if(e.target._default_event_listeners){
    for(var i in e.target._default_event_listeners){
      e.target.on(i,e.target._default_event_listeners[i]);
    }
  }
});

//
// fabric.on("canvas:created",function(){
//   if(this._default_event_listeners){
//     for(var i in this._default_event_listeners){
//       this.on(i,this._default_event_listeners[i]);
//     }
//   }
// });


fabric.util.object.extend(fabric.Application.prototype, {
  initEventListeners: function(){
    if(!this.__eventListeners){
      this.__eventListeners = {};
    }
    for (var event in this.eventListeners) {
      if(!this.__eventListeners[event]){
        this.__eventListeners[event] = []
      }
      this.__eventListeners[event] = this.__eventListeners[event].concat (this.eventListeners[event]);
    }

    if(this.options.eventListeners){
      this.on(this.options.eventListeners);
    }


    // for (var klassName in this.options.eventListeners) {
    //   var _proto = this.options.eventListeners[klassName];
    //   if (fabric[klassName].prototype._default_event_listeners) {
    //     fabric.util.object.extend(fabric[klassName].prototype._default_event_listeners, _proto)
    //   } else {
    //     fabric[klassName].prototype._default_event_listeners = _proto;
    //   }
    // }
    // delete this.options['eventListeners'];
  }
});


// fabric.Application
//   .addPlugin("configuration","initEventListeners");

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 66 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {


/*
 fabric.Image.filters.Redify = fabric.util.createClass(fabric.Image.filters.BaseFilter, {
 type: 'Redify',
 applyTo: function (canvasEl) {
 var context = canvasEl.getContext('2d'),
 imageData = context.getImageData(0, 0,
 canvasEl.width, canvasEl.height),
 data = imageData.data;
 for (var i = 0, len = data.length; i < len; i += 4) {
 data[i + 1] = 0;
 data[i + 2] = 0;
 }
 context.putImageData(imageData, 0, 0);
 }
 });
 fabric.Image.filters.Redify.fromObject = function (object) {
 return new fabric.Image.filters.Redify(object);
 };
 */

fabric.Image.filters.Sharpen = fabric.util.createClass(fabric.Image.filters.Convolute, {
  type: 'Sharpen',
  initialize: function(options) {
    options = options || { };

    this.opaque = options.opaque;
    this.matrix = options.matrix || [
        0, -1, 0,
        -1, 5, -1,
        0, -1, 0
      ];
  }
});
fabric.Image.filters.Sharpen.fromObject = function (object) {
  return new fabric.Image.filters.Sharpen(object);
};

fabric.Image.filters.Blur = fabric.util.createClass(fabric.Image.filters.Convolute, {
  type: 'Blur',
  initialize: function(options) {
    options = options || { };

    var _v = 1 / 9;
    this.opaque = options.opaque;
    this.matrix = options.matrix || [
        _v, _v, _v,
        _v, _v, _v,
        _v, _v, _v
      ];
  }
});
fabric.Image.filters.Blur.fromObject = function (object) {
  return new fabric.Image.filters.Blur(object);
};

fabric.Image.filters.Emboss = fabric.util.createClass(fabric.Image.filters.Convolute, {
  type: 'Emboss',
  initialize: function(options) {
    options = options || { };

    this.opaque = options.opaque;
    this.matrix = options.matrix || [
        1,   1,   1,
        1, 0.7,  -1,
        -1,  -1,  -1
      ];
  }
});
fabric.Image.filters.Emboss.fromObject = function (object) {
  return new fabric.Image.filters.Emboss(object);
};



fabric.Image.prototype.getFilter = function (filterName) {
  filterName = fabric.util.string.uncapitalize(filterName);
  for(var i in this.filters){
    if(fabric.util.string.uncapitalize(this.filters[i].type) === filterName){
      return this.filters[i];
    }
  }
  return false;
};

fabric.Image.prototype.setFilter = function (filter) {

  var _old_filter = false;
  if(filter.replace){
    this.filters = [];
  }else{
    _old_filter = fabric.util.object.findWhere(this.filters, {type: filter.type});
    _old_filter = _old_filter && _old_filter.toObject() || false;
  }


  if(filter.type){
    var _type = fabric.util.string.capitalize(filter.type,true);
    var _new_filter = filter.options && fabric.util.object.clone(filter.options);


  }else{
    _type = false;
    _new_filter = false;
  }

  /* this.project.history.add({
   data:   [$.extend(true, {}, this.data)],
   slide:  this.slide,
   object: this,
   redo:   filter,
   undo:   _old_filter ,
   type:   "filter",
   undoFn: function(action){
   action.object._set_filter(action.undo);
   },
   redoFn:  function(action){
   action.object._set_filter(action.redo);
   }
   });
   */
  this._set_filter(_type, _new_filter, _old_filter);

};

fabric.Image.prototype._set_filter = function (_type, _new_filter) {

  if(_type){
    var _old_filter = this.getFilter(_type);
  }

  if (_old_filter && _new_filter) {
    for (var i in _new_filter) {
      _old_filter[i] = _new_filter[i];
    }
  } else if (_old_filter && !_new_filter) {
    this.filters.splice(this.filters.indexOf(_old_filter), 1);
  }
  if (!_old_filter && _new_filter) {
    this.filters.push(new fabric.Image.filters[_type](_new_filter));
  }
  this.applyFilters(this.canvas.renderAll.bind(this.canvas));
};

var _IMG = fabric.Image.prototype;



fabric.Image.getFiltersList = function(el){

  el = el || fabric.Image.prototype;
  var filterList = [];
  for(var i in el.availableFilters){
    var _f = fabric.Image.filters[el.availableFilters[i]];

    var _data = {
      type:     el.availableFilters[i]
    };
    if(_f.prototype.custom){
      if(!el.customFilters){
        continue;
      }
    }
    if(_f.prototype.maskFilter){
      if(!el.maskFilter){
        continue;
      }
    }
    if(_f.prototype.caman){
      if(!el.camanFilters){
        continue;
      }
      _data.caman = true;
    }else{
      if(!el.fabricFilters){
        continue;
      }
    }
    if(_f.prototype.options){
      _data.options = fabric.util.object.clone(_f.prototype.options);
    }
    _data.text = _f.prototype.title || el.availableFilters[i];

    filterList.push(_data)
  }
  return filterList;
};

fabric.util.object.extend(fabric.Image.prototype, {
  filterTool:   false,
  camanFilters: false,
  fabricFilters: true,
  customFilters: false,
  maskFilter: false,
  getFiltersData : function () {
    var _filters = fabric.Image.getFiltersList(this);
    for (var i in this.filters) {
      var _f = fabric.util.object.findWhere(_filters,{type: fabric.util.string.capitalize(this.filters[i].type)})
      if(_f){
        _f.enabled = true;
      }
    }
    return _filters;
  },
  availableFilters: [
    //fabricJS
    "Grayscale",
    "Sepia",
    "Sepia2",
    "Invert",
    "Blur",
    "Sharpen",
    "Emboss",
    "Blend",
    "Tint",
    "Multiply",
    //"Convolute",
    "Noise",
    "Brightness",
    "Pixelate",
    "GradientTransparency",
    "Mask"
  ]
});


fabric.Image.filterManager = {

  //hide: function(object){
  //
  //},
  show: function (object) {
    this.activeObject = object;
    this.fire('show', object);
    this.on('target:changed', object)
  }
};


fabric.Image.filters.Brightness.prototype.options = {
  "brightness": {value: 100, min: 0, max: 255}
};

fabric.Image.filters.Noise.prototype.options = {
  "noise": {value: 100, min: 0, max: 1000}
};
fabric.Image.filters.Convolute.prototype.options = {
  "opaque": {value: true, type: "boolean" },
  "matrix": {value: [1, 1, 1, 1, 1, 1, 1, 1, 1], type: "matrix" }
};
fabric.Image.filters.Blur.prototype.options = {};
fabric.Image.filters.Sharpen.prototype.options = {};
fabric.Image.filters.Emboss.prototype.options = {};
fabric.Image.filters.Multiply.prototype.options = {
  "color": {type: 'color', value: "#F0F"}
};
fabric.Image.filters.Pixelate.prototype.options = {
  "blocksize": {value: 4, min: 2, max: 20}
};
fabric.Image.filters.Tint.prototype.options = {
  "color":  {type: 'color', value: "#3513B0"},
  "opacity": {value: 1, min: 0, max: 1, step: 0.1}
};
fabric.Image.filters.Mask.prototype.maskFilter = true;
fabric.Image.filters.Mask.prototype.options = {
  mask: {
    type: 'image',
    value: {
      src:  "photos/explosion.png"
    }
  },
  channel: { value: 0}
};

fabric.Image.filters.Blend.prototype.options = {
  "color": {type: 'color', value: "#3513B0"},
  "mode": {
    value: "add",
    options: [
      {value: "add", title: "Add"},
      {value: "diff", title: "Diff"},
      {value: "subtract", title: "Subtract"},
      {value: "multiply", title: "Multiply"},
      {value: "screen", title: "Screen"},
      {value: "lighten", title: "Lighten"},
      {value: "darken", title: "Darken"}
    ]
  }
};



fabric.util.observable(fabric.Image.filterManager);

fabric.util.drawFilter = function(element,src, filterName ,options){
  var ctx =element.getContext("2d");
  fabric.util.loadImage(src,function(el){

    if(options){
      if(options.width && options.height){
        element.width = options.width;
        element.height = options.height;
      }else if(options.width){
        element.width = options.width;
        element.height = options.width * (el.height / el.width);
      }else if(options.height){
        element.height = options.height;
        element.width = options.height * (el.width / el.height);
      }
    }

    ctx.drawImage(el,0,0,element.width,element.height);
    if(!filterName)return;
    filterName = fabric.util.string.capitalize(filterName,true);

    if(fabric.Image.filters[filterName]){
      var _filter = new fabric.Image.filters[filterName]()
    }else{
      var _filter =fabric.Image.filters[filterName].create({});
    }

    //var _filter = new fabric.Image.filters[filterName];
    if(_filter){
      var _fo = fabric.Image.filters[filterName].prototype.options;
      var filterOptions = {};
      for(var i in _fo){
        filterOptions[i] = _fo[i].value;

      }
      fabric.util.object.extend(_filter,filterOptions);
      _filter.imageData = ctx.getImageData(0,0,element.width,element.height);
      _filter.applyTo(element);
    }
  })
};

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 67 */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(fabric) {fabric.webFontsLoader = __webpack_require__(113);

//интересная библиотека
// http://opentype.js.org/index.html
//todo add step
//
// fabric.Application.prototype.steps.splice(3,0,"loadWebfonts");

fabric.util.object.extend(fabric.Application.prototype, {
  loadWebfonts: function (callback) {
    if(fabric.isLikelyNode){
      //todo шрифты не грузятся на сервере
      return callback();
    }
    if(this.options.fonts){
      if(!this.fonts)this.fonts = {};
      this.fonts = fabric.util.object.extend(this.fonts,this.options.fonts);
    }
    if(!this.fonts){
      return callback();
    }


    this.fire("loading",{type: "webfonts"});

    this._fonts = [];

    for(var i in this.fonts){
      this._fonts = this._fonts.concat(this.fonts[i]);
    }
    this._fonts = fabric.util.object.sortBy(this._fonts, function(font){ return font; });

    if(fabric.webFontsLoader && (this.fonts.google && this.fonts.google.length || this.fonts.custom && this.fonts.custom.length) ){
      var fonts_options = {
        active: function () {
          callback();
        }
      };
      if(this.fonts.google && this.fonts.google.length){
        fonts_options.google =  {
          families: this.fonts.google
        };
      }
      if(this.fonts.custom && this.fonts.custom.length){
        fonts_options.custom =  {
          families: this.fonts.custom
        };
      }

      fabric.webFontsLoader.load(fonts_options);
    } else {
      callback();
    }
    if (this.waitForWebfonts) {
      fabric.util.fonts.waitFor(this.waitForWebfonts, callback)
    }
  },
  fonts: {
    standart: [
      'Arial',
      'Arial Black',
      'Comic Sans MS',
      'Courier New',
      'Georgia',
      'Impact',
      'Lucida Console',
      'Tahoma',
      'Times New Roman',
      'Geneva',
      'sans-serif',
      'serif',
      'monospace',
      'cursive'
    ],
    google: [],
    custom: []
  }
});


fabric.util.fonts = {
  waitFor: function (fonts, callback) {
    var loadedFonts = 0;
    for (var i = 0, l = fonts.length; i < l; ++i) {
      (function (font) {
        var node = document.createElement('span');
        // Characters that vary significantly among different fonts
        node.innerHTML = 'giItT1WQy@!-/#';
        // Visible - so we can measure it - but not on the screen
        node.style.position = 'absolute';
        node.style.left = '-10000px';
        node.style.top = '-10000px';
        // Large font size makes even subtle changes obvious
        node.style.fontSize = '300px';
        // Reset any font properties
        node.style.fontFamily = 'sans-serif';
        node.style.fontVariant = 'normal';
        node.style.fontStyle = 'normal';
        node.style.fontWeight = 'normal';
        node.style.letterSpacing = '0';
        document.body.appendChild(node);

        // Remember width with no applied web font
        var width = node.offsetWidth;

        node.style.fontFamily = font;

        var interval;

        function checkFont() {
          // Compare current width with original width
          if (node && node.offsetWidth != width) {
            ++loadedFonts;
            node.parentNode.removeChild(node);
            node = null;
          }

          // If all fonts have been loaded
          if (loadedFonts >= fonts.length) {
            if (interval) {
              clearInterval(interval);
            }
            if (loadedFonts == fonts.length) {
              setTimeout(function () {
                callback();
              }, 50)
              return true;
            }
          }
        }

        if (!checkFont()) {
          interval = setInterval(checkFont, 50);
        }
      })(fonts[i]);
    }
  }
}

fabric.Application.addPlugin("postloaders","loadWebfonts");

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 68 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {


fabric.util.mediaRoot = "";
fabric.util.addNoCache = false;

fabric.util._loadImage_overwritten = fabric.util.loadImage;


// if(!fabric.isLikelyNode){
//
//   var URL = require('url'),
//     HTTP = require('http'),
//     HTTPS = require('https'),
//     Image = require('canvas').Image;
//
//   /** @private */
//   var request = function (url, encoding, callback) {
//     var oURL = URL.parse(url);
//
//     // detect if http or https is used
//     if ( !oURL.port ) {
//       oURL.port = ( oURL.protocol.indexOf('https:') === 0 ) ? 443 : 80;
//     }
//
//     // assign request handler based on protocol
//     var reqHandler = (oURL.protocol.indexOf('https:') === 0 ) ? HTTPS : HTTP,
//       req = reqHandler.request({
//         hostname: oURL.hostname,
//         port: oURL.port,
//         path: oURL.path,
//         method: 'GET'
//       }, function(response) {
//         var body = '';
//         if (encoding) {
//           response.setEncoding(encoding);
//         }
//         response.on('end', function () {
//           callback(body);
//         });
//         response.on('data', function (chunk) {
//           if (response.statusCode === 200) {
//             body += chunk;
//           }
//         });
//       });
//
//     req.on('error', function(err) {
//       if (err.errno === process.ECONNREFUSED) {
//         fabric.log('ECONNREFUSED: connection refused to ' + oURL.hostname + ':' + oURL.port);
//       }
//       else {
//         fabric.log(err.message);
//       }
//       callback(null);
//     });
//
//     req.end();
//   }
//
//   /** @private */
//   var requestFs = function (path, callback) {
//     var fs = require('fs');
//     fs.readFile(path, function (err, data) {
//       if (err) {
//         fabric.log(err);
//         throw err;
//       }
//       else {
//         callback(data);
//       }
//     });
//   };
//
//   fabric.util.loadImage = function(url, callback, context) {
//
//
//     var img = new Image();
//     img.onerror = function(){
//       console.log("error");
//       callback && callback.call(context, null, true);
//     };
//     img.onload = function(){
//       console.log("success");
//       callback && callback.call(context, img);
//     };
//
//     function createImageAndCallBack(data) {
//       if (data) {
//         img.src = data;
//         // preserving original url, which seems to be lost in node-canvas
//         img._src = url;
//       }
//       else {
//         img = null;
//         callback && callback.call(context, null, true);
//       }
//     }
//
//     if (url && (url instanceof Buffer || url.indexOf('data') === 0)) {
//       img.src = img._src = url;
//     }
//     else if (url && url.indexOf('http') !== 0) {
//       var path = require("path");
//       url = fabric.util.getURL(url);
//       url =   path.resolve(fabric.util.mediaRoot, url);
//       img.src =  url;
//       // requestFs(url, createImageAndCallBack);
//     }
//     else if (url) {
//       request(url, 'binary', createImageAndCallBack);
//     }
//     else {
//       callback && callback.call(context, url);
//     }
//   };
// }else{
  fabric.util.loadResources = function (resources, callback, context, crossOrigin) {

    var loadedResources = {};
    var loader = fabric.util.queueLoad(Object.keys(resources).length,function(){
      callback(loadedResources);
    });
    for(var i in resources){
      (function(i){
        fabric.util.loadImage(resources[i], function(image){
          loadedResources[i] = image;
          loader();
        }, context, crossOrigin);
      }(i));
    }
  };

  fabric.util.loadImage = function (url, callback, context, crossOrigin) {
    url = fabric.util.getURL(url);
    function _check_errors(img){
      //изображение не было загружено
      if (img) {
        callback.call(this,img);
      } else {
        fabric.errors.push({type: "image", message: "Image was not loaded"});
        fabric.util._loadImage_overwritten(fabric.media.error, callback, context, crossOrigin || 'Anonymous');
      }
    }

    if(fabric.debugTimeout){
      setTimeout(fabric.util._loadImage_overwritten.bind(this,url, _check_errors , context, crossOrigin || 'Anonymous'),fabric.debugTimeout)
    }else{
      fabric.util._loadImage_overwritten(url, _check_errors , context, crossOrigin || 'Anonymous');
    }
  };


fabric.util.getURL = function(url){
  if (url.indexOf('blob') !== 0 && url.indexOf('data') !== 0 && url.indexOf('://') == -1) {
    url = fabric.util.mediaRoot + url;
  }
  if (fabric.util.addNoCache && /^(http|https)\:\/\//.test(url)) {
    url += '?no-cache=' + new Date().getTime()
  }
  return url;
};


fabric.util.loadVideo = function (sources, callback, context, crossOrigin) {

  function loadIt(url){
    video.src = fabric.util.getURL(url);
    video.addEventListener("loadeddata", function(){
      callback(video);
    }, true);
    video.load();
  }




  var video = document.createElement('video');


  //trying to find the most suitable source for current browser
  for (var type in sources) {
    if(video.canPlayType(type) == "yes"){
      this.mediaType = type;
      loadIt(sources[type]);
      return;
    }
  }
  for (var type in sources) {
    if(video.canPlayType(type) == "maybe"){
      this.mediaType = type;
      loadIt(sources[type]);
      return;
    }
  }
  console.warn("video sources formats is not supported")


};

fabric.util._loadSVGFromURL_overwritten = fabric.loadSVGFromURL;
fabric.loadSVGFromURL = function (url, callback, reviver) {
  if (url.indexOf('data') !== 0 && url.indexOf('://') == -1) {
    url = fabric.util.mediaRoot + url;
  }
  if (fabric.util.addNoCache && /^(http|https)\:\/\//.test(url)) {
    url += '?no-cache=' + moment().format('x');
  }
  fabric.util._loadSVGFromURL_overwritten(url, function(data){
     if(data){
       return callback(data);
     }

    var xml = jQuery.parseXML(atob(fabric.media.error.substr(26)));

    fabric.parseSVGDocument(xml.documentElement, function (results, options) {
      callback && callback(results, options);
    }, reviver);

  }, reviver);
};

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 69 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

/**
 * Aligment library for FabricJS
 *
 *
 *
 * @author Denis Ponomarev
 * @email den.ponomarev@gmail.com
 */
fabric.GridSnapper = function (canvas,options){
  this.canvas = canvas;

  for(var prop in options){
    this[prop] = options[prop];
  }

  this.createAligmentLines(canvas);

  for(var i in this.canvas._objects){
    this.applySnap(this.canvas._objects[i]);
  }

  var _gs = this;

  (this.canvas.wrapperEl || this.canvas.lowerCanvasEl).addEventListener("mousedown",function(){
    window.addEventListener("mouseup",_gs._window_mouse_up.bind(_gs));
  });
};

fabric.util.object.extend(fabric.Object.prototype, {
  griddable: true
});

fabric.Canvas.prototype.applyGrid = function(){
  var canvas = this;
  this.grid = new fabric.GridSnapper(this);
  this.on("object:moving",function(options){
    if(!options.e.shiftKey && canvas.grid.enabled && options.target.griddable){
      canvas.grid.gridSnapMove(options.target);
    }
  });
  this.on('mouse:up',function(){
    canvas.clearContext(canvas.contextTop)
    canvas.grid.snapTo = null;
  });
  this.on('after:render',function(){
    var ctx = canvas.contextTop,
      snapTo = canvas.grid.snapTo;
    ctx.strokeStyle = "#ffaaaa";


    if(!snapTo)return;
    if(snapTo.x) {
      ctx.beginPath();
      if(snapTo.x.object2){
        var _ic , _c ;
        _c = snapTo.x.object2.oCoords;
        if(snapTo.x.line){
          ctx.moveTo(_c.mt.x, 0)
          ctx.lineTo(_c.mt.x, this.height)
        }else{

          ctx.moveTo(_c.tl.x, _c.tl.y);
          ctx.lineTo(_c.tr.x, _c.tr.y);
          ctx.lineTo(_c.br.x, _c.br.y);
          ctx.lineTo(_c.bl.x, _c.bl.y);
          ctx.lineTo(_c.tl.x, _c.tl.y);

          if(snapTo.x.corner2 == "c"){
            _ic = snapTo.x.object2.getCenterPoint();
          }else{
            _ic = _c[snapTo.x.corner2];
          }
          if(_ic){
            ctx.moveTo(_ic.x, _ic.y)
            ctx.arc(_ic.x, _ic.y, 2, 0, 2 * Math.PI);
          }

        }


        var _active = this._activeObject || this._activeGroup;
        _c = _active.oCoords;
        if(snapTo.x.corner == "c"){
          _ic = snapTo.x.object2.getCenterPoint();
        }else{
          _ic = _c[snapTo.x.corner];
        }
        ctx.moveTo(_ic.x, _ic.y)
        ctx.arc(_ic.x, _ic.y, 2, 0, 2 * Math.PI);
      }
      ctx.moveTo(snapTo.x.value,0);
      ctx.lineTo(snapTo.x.value,canvas.height);
      ctx.stroke();
    }
    if(snapTo.y) {
      ctx.beginPath();

      if(snapTo.y.object2){
        var _ic , _c ;
        _c = snapTo.y.object2.oCoords;
        if(snapTo.y.line){
          ctx.moveTo(0,_c.ml.y)
          ctx.lineTo(this.width,_c.ml.y)
        }else {
          ctx.moveTo(_c.tl.x, _c.tl.y);
          ctx.lineTo(_c.tr.x, _c.tr.y);
          ctx.lineTo(_c.br.x, _c.br.y);
          ctx.lineTo(_c.bl.x, _c.bl.y);
          ctx.lineTo(_c.tl.x, _c.tl.y);
          if (snapTo.y.corner2 == "c") {
            _ic = snapTo.y.object2.getCenterPoint();
          } else {
            _ic = _c[snapTo.y.corner2];
          }
          if(_ic) {
            ctx.moveTo(_ic.x, _ic.y)
            ctx.arc(_ic.x, _ic.y, 2, 0, 2 * Math.PI);
          }

          var _active = this._activeObject || this._activeGroup;
          _c = _active.oCoords;
          if (snapTo.y.corner == "c") {
            _ic = snapTo.y.object2.getCenterPoint();
          } else {
            _ic = _c[snapTo.y.corner];
          }
          ctx.moveTo(_ic.x, _ic.y)
          ctx.arc(_ic.x, _ic.y, 2, 0, 2 * Math.PI);
        }
      }

      ctx.moveTo(0,snapTo.y.value);
      ctx.lineTo(canvas.width,snapTo.y.value);
      ctx.stroke();
    }
  })

};

fabric.GridSnapper.prototype = {
  //offsets and size of the grid
  rect: {
    top: 50,
    left: 50,
    width: 600,
    height: 600
  },
  /**
   * support lines
   * @value [{
     *  [x: integer],
     *  [y: integer]
     * }]
   */
  supportLines: [],
  /**
   * fabrc objects.
   * @value [klass]
   */
  objects : [],
  //the area in pixels, where object will be snapped to the grid
  area: 3,
  //flag
  enabled: true,
  //
  gridEnabled: true,
  borderEnabled: true,
  gridBorder : false,
  //size of the grid
  gridSize: 25,
  /**
   * corners that will be snapped to the grid. This is the name from fabric object oCoords property. ( it is possible to more or less points )
   */
  snapCorners: {
    tl: ["tl","bl","br","tr"],
    bl: ["tl","bl","br","tr"],
    tr: ["tl","bl","br","tr"],
    br: ["tl","bl","br","tr"],
    c : ["c"]
  },
  _window_mouse_up  : function(){
    this.hideAligmentLines();
    window.removeEventListener('mouseup', this._window_mouse_up);
  },
  applySnap : function(obj){
    var _gs = this;

    this.canvas.on("object:removed",function(e){
      var i = _gs.canvas._objects.indexOf(e.target);
      if(i == -1)return;
      _gs.canvas._objects.splice(i,1);
    });

    obj.on("moving",function(){
      if(_gs.enabled){
        _gs.gridSnapMove(this);
      }
    });
  },

  creteSupportLines : function(){
    var rect = this.rect;

    var objs = [];
    for (var i = 0; i < this.supportLines.length; i++) {
      var l = this.supportLines[i];
      objs.push(new fabric.Line(
        (l.x ? [l.x, 0, l.x, rect.height] : [0, l.y, rect.width, l.y]),
        { stroke: 'red' }));
    }

    var support = new fabric.Group(objs,{
      left: rect.left,
      top: rect.top,
      selectable: false,
      evented: false
    });
    this.canvas.add(support);
    return support;
  },
  removeGridFrame: function(){
    this.canvas.remove(this.gridFrame);
    delete this.gridFrame;
  },
  removeGrid: function(){

    this.canvas.remove(this.grid);
    delete this.grid;

  },
  updateGridSize: function(){

    this.removeGridFrame();
    this.createGridFrame();

    if(this.grid){
      this.removeGrid();
      this.createGrid();
    }

    //this.xLine.y2 = this.canvas.height;
    //this.yLine.x2 = this.canvas.width;
  },
  createGridFrame: function(){
    /*   this.gridFrame = new fabric.Rect({
     left: this.rect.left,
     top: this.rect.top,
     width: this.rect.width,
     height: this.rect.height,
     stroke: '#5F8E70',
     fill: "transparent",
     selectable: false,
     evented: false
     });*/

    var rect = this.rect;
    var objs = [];

    objs.push(new fabric.Line([0, this.rect.top, this.canvas.width, this.rect.top], {
      stroke: '#5F8E70'
    }));
    objs.push(new fabric.Line([0, this.rect.top + this.rect.height, this.canvas.width, this.rect.top + this.rect.height], {
      stroke: '#5F8E70'
    }));
    objs.push(new fabric.Line([this.rect.left, 0, this.rect.left, this.canvas.height], {
      stroke: '#5F8E70'
    }));
    objs.push(new fabric.Line([this.rect.left + this.rect.width, 0, this.rect.left+ this.rect.width, this.canvas.height], {
      stroke: '#5F8E70'
    }));

    this.gridFrame = new fabric.Group(objs,{
      selectable: false,
      evented: false
    });
    this.canvas.add(this.gridFrame);
    return this.gridFrame;

  },
  /**
   * create a set of lines on the canvas
   * @returns {*}
   */
  createGrid: function(){
    var rect = this.rect;
    var objs = [];



    for (var y = this.gridSize; y  <= rect.height - 1; y += this.gridSize) {
      objs.push(new fabric.Line([0, y, rect.width, y], {
        stroke: '#5F8E70'
      }));
    }

    for (var x = this.gridSize; x <= rect.width - 1; x += this.gridSize) {
      objs.push(new fabric.Line([x, 0, x, rect.height], {
        stroke: '#5F8E70'
      }));
    }

    this.grid = new fabric.Group(objs,{
      left: rect.left,
      top: rect.top,
      selectable: false,
      evented: false
    });


    this.canvas.add(this.grid);
    return this.grid;

  },
  snapCallback :function(snapTo){
    this.snapTo = snapTo;
  },
  hideAligmentLines:  function(canvas) {

    if(this.xLine){
      this.xLine.setVisible(false);
      this.xLine.canvas.renderAll();
    }
    if(this.yLine) {
      this.yLine.setVisible(false);
      this.xLine.canvas.renderAll();
    }
  },
  createAligmentLines:  function() {
    //this.xLine = new fabric.Line([1, 0, 1, this.canvas.height], {
    //    left:0,
    //    stroke: '#40D0FF',
    //    selectable: false,
    //    evented: false,
    //    visible: false
    //});
    //this.yLine = new fabric.Line([0, 1, this.canvas.width, 1], {
    //    top:0,
    //    stroke: '#40D0FF',
    //    selectable: false,
    //    evented: false,
    //    visible: false
    //});
    //
    //this.canvas.add(this.xLine);
    //this.canvas.add(this.yLine);

  },
  /**
   *
   * @param object
   * @returns {{x: (false|{value, corner}|{value, corner, object2, corner2}), y: (false|{value, corner}|{value, corner, object2, corner2})}}
   */
  gridSnapMove:  function(object) {

    object.setCoords();

    var x = this.gridSnapMoveByAxe(object,"x"),
      y = this.gridSnapMoveByAxe(object,"y");

    var value = {x: x, y : y};
    this.snapCallback && this.snapCallback(value);

    return value;
  },


  _get_corner : function(object,corner_name) {

    if(corner_name == "c"){
      var p = object.getCenterPoint();
      var _scale = this.canvas.getZoom();
      p.x *= _scale;
      p.y *= _scale;
      return p;
    }
    return object.oCoords[corner_name];
  },
//snap to grid by x coordinates
  gridSnapMoveByAxe : function(object,axe) {

    var _scale = this.canvas.getZoom();
    var self = this;

    if( axe == "x" ){
      var _l = self.canvas.offsets.left,
        _w = this.canvas.originalWidth - self.canvas.offsets.right  - _l,
        _c = object.left,
        _p = "left"
    }else{
      _l = self.canvas.offsets.top;
      _w = this.canvas.originalHeight - self.canvas.offsets.bottom  - _l;
      _c = object.top;
      _p = "top";
    }



    //supportlines
    for(var corner_name in this.snapCorners) {
      var corner = this._get_corner(object,corner_name);
      for (var i in this.supportLines) {
        var l = this.supportLines[i];
        var _val = l[axe] + this.rect[_p];
        if (l[axe] && Math.abs(_val - corner[axe]) < self.area) {
          object[_p] = (_val - (corner[axe] - object.oCoords.tl[axe])) / (object.canvas.viewportTransform[0]) ;
          var VAL = {value: _val, corner: corner_name, object2 : l, line: true};
          ////console.log(VAL);
          return VAL;
        }
      }
    }

    //guidlines
    for(var corner_name in this.snapCorners) {
      var corner = this._get_corner(object,corner_name);
      for (var i in this.canvas.guidlines) {
        var l = this.canvas.guidlines[i];
        var _val = l[axe] * _scale;
        if (l[axe] && Math.abs(_val - corner[axe]) < self.area) {
          object[_p] = (_val - (corner[axe] - object.oCoords.tl[axe])) / (object.canvas.viewportTransform[0]) ;
          VAL = {value: _val, corner: corner_name, object2 : l, line: true};
          //console.log(VAL);
          return VAL;
        }
      }
    }

    //grid

    for(var corner_name in this.snapCorners) {
      var corner = this._get_corner(object,corner_name);

      if (this.gridEnabled) {
        var x = (corner[axe] - _l + self.area) % self.gridSize;
        if (x < -self.gridSize)return false;
        if (x < self.area * 2) {
          var _xxx = _c + (corner[axe] - object.oCoords.tl[axe]);
          if (_xxx > _l && _xxx < _w + _l) {
            object[_p] -= x - self.area;
            VAL = {value: corner[axe] - x + self.area, corner: corner_name, grid: true};
            //console.log(VAL);
            return VAL;
          }
        }

      }


      if (this.borderEnabled) {
        //grid width/height
        var _val = (_w + this.canvas.offsets[_p]) * _scale;
        if (Math.abs(_val - corner[axe]) < self.area) {
          object[_p] = (_val - (corner[axe] - object.oCoords.tl[axe])) / _scale;
          VAL = {value: _val, corner: corner_name, grid: true, corner2: axe == "x" ? "width" : "height"};
          //console.log(VAL);
          return VAL;
        }
        //grid top/left
        var _val = this.canvas.offsets[_p] * this.canvas.getZoom();
        if (Math.abs(_val - corner[axe]) < self.area) {
          object[_p] = (_val - (corner[axe] - object.oCoords.tl[axe]) ) / (object.canvas.viewportTransform[0]) ;
          VAL = {value: _val, corner: corner_name, grid: true, corner2: _p};
          //console.log(VAL);
          return VAL;
        }
      }
    }


    //other objects
    for (var _obj_index in this.canvas._objects) {
      var _obj = this.canvas._objects[_obj_index];
      if(!_obj.griddable || _obj == object || !_obj.visible || _obj.hiddenActive)continue;

      for(var corner_name in this.snapCorners) {
        var corner = this._get_corner(object,corner_name);

        for (var j in this.snapCorners[corner_name]) {
          var corner_name_2 =  this.snapCorners[corner_name][j];
          var corner_2 = this._get_corner(_obj,corner_name_2);

          if(Math.abs( corner[axe] - corner_2[axe]) < self.area){
            object[_p] = (corner_2[axe] -  (corner[axe] - object.oCoords.tl[axe])) / (object.canvas.viewportTransform[0]) ;
            VAL = {value: corner_2[axe],corner: corner_name, object2: _obj, corner2: corner_name_2};
            //console.log(VAL);
            return VAL;
          }
        }
      }
    }
    return false;
  },


  //snap to grid by x coordinates
  gridSnapResize:  function(object) {

    this.setCoords();
    var x = this.gridSnapXResize(object),
      y = this.gridSnapYResize(object);
    var value = {x: x, y : y};
    this.snapCallback && this.snapCallback(value);
    return value
  },

  gridSnapXResize:  function(object) {

    var self = this;

    var _l = self.rect.left,
      _w = self.rect.width;

    var active_corner = canvas._currentTransform.corner;

    var coords = [];
    var is_right = false;
    switch(active_corner){
      case "tr":
      case "br":
      case "mr":
        is_right = true;
        coords = ["tr","br"];
        break;
      case "tl":
      case "bl":
      case "ml":
        coords = ["bl","tl"];
        break;
    }

    var to_radians = Math.PI / 180;
    for(var i in this.snapCorners) {
      var _corner_name = this.snapCorners[i];
      if(coords.indexOf(_corner_name)== -1)continue;
      var corner = object.oCoords[this.snapCorners[i]];

      var x = (corner.x - _l + self.area)%self.gridSize;
      var _line =  Math.floor((corner.x - _l + self.area)/ self.gridSize) + 1;
      if(x < -self.gridSize )return false;
      if(x < self.area * 2){
        if(corner.x > _l && corner.x < _w + _l ){

          if(is_right){
            if(_corner_name == "tr"){
              var opt = {
                scaleX: object.scaleX *  (_line * self.gridSize - object.oCoords.tl.x - _l)/(corner.x - object.oCoords.tl.x)
              };
            }
            if(_corner_name == "br"){
              var opt = {
                scaleX: object.scaleX *  (_line * self.gridSize - object.oCoords.bl.x - _l)/(corner.x - object.oCoords.bl.x)
              };
            }
            //if(_corner_name == "mr"){
            //    var opt = {
            //        scaleX: object.scaleX *  (_line * self.gridSize - object.oCoords.ml.x - _l)/(corner.x - object.oCoords.ml.x)
            //    };
            //}
          }else{
            var scale2 = ( corner.x + object.width * object.scaleX - ((_line - 1) * self.gridSize + _l)) / object.width;
            //if(_corner_name == "tl"){
            //    var _l = (_line - 1) * self.gridSize + _l;
            //    var _r = object.oCoords.tr.x;
            //    var _w = _r - _l;
            //
            //   var _scale   = _w / (object.width *Math.sin(object.angle *  to_radians ));
            //
            //    opt = {
            //
            //        scaleX: scale2
            //    };
            //}
            //else{

            var opt = {
              left:  object.oCoords.tr.x - (object.oCoords.tr.x - object.left)/object.scaleX * scale2,
              scaleX: scale2
            };
            if(_corner_name != "ml"){
              opt.top = object.oCoords.tr.y - (object.oCoords.tr.y - object.top)/object.scaleX * scale2;
            }
            //}



          }
          object.set(opt);
          return {value: object.left + (corner.x - object.oCoords.tl.x), corner: _corner_name};
        }
      }
    }
    return false;
  },


  //snap to grid by x coordinates
  gridSnapYResize:  function(object) {

    var self = this;

    var _l = self.rect.top,
      _w = self.rect.height;

    var active_corner = canvas._currentTransform.corner;

    var coords = [];
    var is_right = false;
    switch(active_corner){
//             case "ml":
//                 coords = ["tl","bl"];
//                 break;
//             case "mr":
//                 is_right = true;
//                 coords = ["tr","br"];
//                 break;
      case "tr":
      case "tl":
      case "mt":
        coords = ["tl","tr"];
        break;
      case "bl":
      case "mb":
      case "br":
        is_right = true;
        coords = ["bl","br"];
        break;
    }

    for(var i in this.snapCorners) {
      var _corner_name = this.snapCorners[i];
      if(coords.indexOf(_corner_name)== -1)continue;
      var corner = object.oCoords[this.snapCorners[i]];

      var y = (corner.y - _l + self.area)%self.gridSize;
      var _line =  Math.floor((corner.y - _l + self.area)/ self.gridSize) + 1;
      if(y < -self.gridSize )return false;
      if(y < self.area * 2){
        if(corner.y > _l && corner.y < _w + _l ){

          if(is_right){
            if(_corner_name == "bl"){
              var opt = {
                scaleY: object.scaleY *  (_line * self.gridSize - object.oCoords.tl.y - _l)/(corner.y - object.oCoords.tl.y)
              };
            }
            if(_corner_name == "br"){
              var opt = {
                scaleY: object.scaleY *  (_line * self.gridSize - object.oCoords.tr.y - _l)/(corner.y - object.oCoords.tr.y)
              };
            }
            //if(_corner_name == "mb"){
            //    var opt = {
            //        scaleY: object.scaleY *  (_line * self.gridSize - object.oCoords.tr.y - _l)/(corner.y - object.oCoords.mt.y)
            //    };
            //}
          }else{
            var scale2 = ( corner.y + object.width * object.scaleY - ((_line - 1) * self.gridSize + _l)) / object.width;
            var opt = {
              top:   object.oCoords.bl.y - (object.oCoords.bl.y - object.top)/object.scaleY * scale2,
              scaleY: scale2
            };
            //if(_corner_name != "mt"){
            //    opt.left =  object.oCoords.bl.y - (object.oCoords.bl.y - object.left)/object.scaleY * scale2;
            //}
          }
          object.set(opt);
          return {value: object.left + (corner.y - object.oCoords.tl.y), corner: _corner_name};
        }
      }
    }
    return false;
  }

};

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 70 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {


// fabric.require('SlideGroup',['SlideObject'], function() {
var _OBJ = fabric.Object.prototype;
var _handleGrouping_overwritten = fabric.Canvas.prototype._handleGrouping;

fabric.util.object.extend(fabric.Canvas.prototype, {
  /**
   * Deactivates all objects and dispatches appropriate events
   * @return {fabric.Canvas} thisArg
   * @chainable
   */
  deactivateAllWithDispatch: function (e) {
    var activeGroup = this.getActiveGroup(),
      activeObject = this.getActiveObject();
    var _target = activeObject || activeGroup;
    if (_target) {
      this.fire('before:selection:cleared', { target: _target, e: e });
    }
    this.deactivateAll();
    if (_target) {
      this.fire('selection:cleared', { e: e, target: _target });
      _target.fire('deselected');
    }
    return this;
  },

  /**
   * Divides objects in two groups, one to render immediately
   * and one to render as activeGroup.
   * return objects to render immediately and pushes the other in the activeGroup.
   */
  _chooseObjectsToRender: function() {
    var activeGroup = this.getActiveGroup(),
      activeObject = this.getActiveObject(),
      object, objsToRender = [ ], activeGroupObjects = [ ];

    if (activeGroup && !this.preserveObjectStacking) {
      for (var i = 0, length = this._objects.length; i < length; i++) {
        object = this._objects[i];
        if (!activeGroup.contains(object)) {
          if(!object.hiddenActive){
            objsToRender.push(object);
          }
        }
        else {
          activeGroupObjects.push(object);
        }
      }
      if (activeGroup) {
        // activeGroup._set('_objects', activeGroupObjects);
        objsToRender.push(activeGroup);
      }
      activeObject && objsToRender.push(activeObject);
      // activeGroup._set('_objects', activeGroupObjects);
    }
    else {
      objsToRender = this._objects;
    }
    return objsToRender;
  },
  /**
   * adding before:selection:created event
   * @private
   * @param {Event} e Event object
   * @param {fabric.Object} target
   */
  _handleGrouping: function (e, target) {
    this.fire("before:selection:created");
    _handleGrouping_overwritten.call(this, e, target);
  },
  /**
   * @private
   * @param {Event} e mouse event
   */
  _groupSelectedObjects: function (e) {

    var group = this._collectObjects();

    group = fabric.util.object.filter(group,{groupSelectable: true});

    // do not create group for 1 element only
    if (group.length === 1) {
      this.setActiveObject(group[0], e);
    }
    else if (group.length > 1) {
      group = new fabric.Group(group.reverse(), {
        canvas: this
      });
      group.addWithUpdate();
      this.setActiveGroup(group, e);
      group.saveCoords();
      this.fire('selection:created', { target: group });
      this.renderAll();
    }
  }
});

fabric.Object.prototype.groupSelectable = true;

fabric.Group.prototype.cloneSync = function() {
  var _clonedObjects = this._objects.map(function(object){
    return object.cloneSync();
  });


  var object = this.toObject();
  delete object.objects;

  return new fabric.Group(_clonedObjects, object, true);

  // fabric.util.enlivenObjects(object.objects, function (enlivenedObjects) {
  //   delete object.objects;
  //   callback && callback(new fabric.Group(enlivenedObjects, object, true));
  // });
}

_OBJ.cloneSync = function(){
  var _klass = fabric[fabric.util.string.camelize(fabric.util.string.capitalize(this.type))];

  if(_klass.async){
    var _obj = new _klass.fromObject(this);
  }else{
    var _obj = this.clone();
  }
  _obj.canvas = this.canvas;
  return _obj;
};


fabric.Group.prototype.isPossibleTarget = function (e, object) {
  return this.searchPossibleTargets(e, [object]).target !== null;
};
/**
 * return inner target and group of targets under the cursor
 * @param e
 * @param objects
 * @returns {{target: null, group: Array}}
 */
fabric.Group.prototype.searchPossibleTargets = function (e, objects) {

  if (!objects)objects = this._objects;
  var pointer = this.canvas.getPointer(e, true);
  var i = objects.length,
    normalizedPointer = this.canvas._normalizePointer(this, pointer);

  var targets = {
    target: null,
    group: []
  };
  while (i--) {
    if (this.canvas._checkTarget(normalizedPointer, objects[i])) {
      if (!targets.target)targets.target = objects[i];
      targets.group.push(objects[i]);
    }
  }
  return targets;
};

fabric.Group.prototype._calcBounds = function (onlyWidthHeight) {
  var aX = [],
    aY = [],
    o, prop,
    props = ['tr', 'br', 'bl', 'tl'];

  for (var i = 0, len = this._objects.length; i < len; ++i) {
    o = this._objects[i];
    if (o.notSelectableInTheGroup) {
      continue;
    }
    o.setCoords();
    for (var j = 0; j < props.length; j++) {
      prop = props[j];
      aX.push(o.oCoords[prop].x);
      aY.push(o.oCoords[prop].y);
    }
  }

  this.set(this._getBounds(aX, aY, onlyWidthHeight));
};


fabric.SlideGroup = {
  initialize_overwritten: fabric.Group.prototype.initialize,
  isSelectionGroup: function(){
    return this.canvas._objects.indexOf(this) === -1
  },
  //clone: function(callback){
  //  if(callback === true || callback.constructor === Object){
  //    var _frame = new fabric.Group(this);
  //    if(callback.constructor === Object){
  //      _frame.set(callback);
  //      return _frame;
  //    }
  //  }
  //  return this.callSuper('clone',callback);
  //},
  initialize: function(objects,options){
    if(objects.constructor != Array){
      var el = objects;
      options = el.toObject();
      objects = [];
      for(var i in el._objects){
        objects.push(el._objects[i].cloneSync())
      }
    }

    this.initialize_overwritten(objects,options);
    if(this.type == 'group'){
      this.on("dblclick", function(){
        if(this.canvas._objects.indexOf(this) === -1){
          this.groupSelectedElements();
        }else{
          this.ungroup();
        }
      });
    }
  },
  ungroup : function() {
    this.canvas.discardActiveGroup();
    this._restoreObjectsState();
    this.canvas.remove(this);
    for(var i in this._objects){
      this.canvas.add(this._objects[i]);
      this._objects[i].clipTo = this.clipTo;
      //this._objects[i].active = true;
    }
    var group = new fabric.Group(this._objects, {
      canvas: this.canvas
    });
    group.addWithUpdate();
    this.canvas.setActiveGroup(group);
    group.saveCoords();
    this.canvas.fire('selection:created', { target: group });
    this.canvas.renderAll();

    //var _group = new fabric.Group(this._objects);
    //_group.canvas = this.canvas;
    //this.canvas.setActiveObject(_group);
  },

  groupSelectedElements: function(){



    var el = this.cloneSync();
    this.canvas.add(el);
    this.canvas.discardActiveGroup();
    this.canvas.setActiveObject(el);

    for(var i in this._objects){
      this.canvas.remove(this._objects[i].originalObject);
    }


  },
  actions: {

    objectRemove: {
      className:  'fa fa-trash',
      title:      'Delete',
      key:        "Delete",
      action:     function(){
        if(this.isSelectionGroup()){
          for(var i in this._objects){
            var _obj = this._objects[i];
            this.canvas.remove(_obj.originalObject);
          }
          this.canvas.discardActiveGroup();
          this.canvas.discardActiveObject();
        }else{
          this.canvas.remove(this);
        }
        this.canvas.renderAll();
      }
    },
    objectDuplicate: {
      className:  'fa fa-clone',
      insert:     'duplicateTool',
      title:      'Duplicate',
      action: function () {
        if(this.isSelectionGroup()){
          this.canvas.fire('before:selection:cleared', { target: this, e: null });
          this.canvas.discardActiveGroup();
          this.duplicate(function(el){
            el.ungroup();
          });

          this.canvas.renderAll();
        }else{
          this.duplicate();
        }
      }
    },
    selectGroup: {
      title: 'группа',
      className: 'fa fa-object-group',
      visible: function(){
        return this.isSelectionGroup();
      },
      action: function () {
        this.groupSelectedElements();
        this.canvas.renderAll();
      }
      //visible: IDE.groupAvailable
    },
    unselectGroup: {
      title: 'группа',
      className: 'fa fa-object-ungroup',
      visible: function(){
        return this.canvas._objects.indexOf(this) !== -1
      },
      action: function () {
        this.ungroup();
        this.canvas.renderAll();
      }
    }
  }
}
fabric.util.object.extend(fabric.Group.prototype, fabric.SlideGroup);


fabric.util.object.extend(fabric.SlideCanvas.prototype,{
  eventListeners: fabric.util.object.extendArraysObject(fabric.SlideCanvas.prototype.eventListeners, {
    'selection:created': function(event){
      this._onSelectionCreated(event);
    }
  }),
  _onSelectionModified: function () {
    for (var i in this._objects) {
      var copy = this._objects[i].cloneSync();
      copy.group = this;
      this._restoreObjectState(copy);
      this._objects[i].originalObject.set({
        left: copy.left,
        top: copy.top,
        angle: copy.angle,
        scaleX: copy.scaleX,
        scaleY: copy.scaleY,
        skewX: copy.skewX,
        skewY: copy.skewY,
        width: copy.width,
        height: copy.height
      });
    }
  },
  _onSelectionDeselected: function (data) {
    for (var i in this._objects) {
      var _obj = this._objects[i];
      _obj.originalObject.setCoords();
      _obj.originalObject.evented = true;
      delete _obj.originalObject.hiddenActive;
    }
  },
  _onSelectionCreated: function (el) {

    var group  = el.target;

    var originalObjects = []
    for(var i in group._objects){
      var _obj = group._objects[i];
      originalObjects.push(_obj.originalObject || _obj)
    }

    group.destroy();
    group._objects = [];

    var _clipTo = originalObjects[0].clipTo;

    for (var i in originalObjects) {
      var original = originalObjects[i];

      if (_clipTo != original.clipTo) {
        _clipTo = false;
      }

      var _obj = original.cloneSync();

      _obj.set({
        clipTo: null,
        originalObject: original
      });
      original.set({
        active:false,
        evented: false,
        hiddenActive: true
      });

      group.addWithUpdate(_obj);
      group.setCoords();
    }

    group.clipTo =  _clipTo;

    group.on({
      "modified": this._onSelectionModified,
      'deselected': this._onSelectionDeselected
    });

  }
});

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 71 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

var History = __webpack_require__(11);

History.prototype.insertRecords = false;
History.prototype.actions = {
  undo: {
    keyCode: 'z',
    ctrlKey:  true,
    observe: 'changed',
    className: 'fa fa-undo',
    title: 'undo',
    enabled: 'canUndo',
    action: function(){
      this.undo();
    }
  },
  records: {
    title:          "records",
    itemClassName:  "filters-selector",
    className:      "fa fa-history",
    type:           "select",
    templateSelection: function(state, container) {
      if (state.any) {
        return state.text;
      }
      return $('<span>' + state.id + ":" + state.type + '</span>');
    },
    templateResult: function(state, container,data) {
      if(!state.type)return;
      var _keys = state.originalState && Object.keys(state.originalState).join(',') || '';
      var type = state.object && state.object.type || '';
      return $("<span>{id}:{type}({otype} {keys})</span>".format(fabric.util.object.extend({keys : _keys, otype: type},state)));
      // if(state.id != "none"){
      //   var $canvas = $('<canvas>');
      //   $el.prepend($canvas);
      // }
      // return $el;
    },
    value:      {
      observe: 'changed',
      set : function(val,filtersData){
        this.goto(val);
      },
      get: function(){
        return this.records[this.current].id;
      },
      options: function(){
        return this.records;
      }
    }
  },
  redo: {
    keyCode: 'y',
    ctrlKey:  true,
    observe: 'changed',
    className: 'fa fa-repeat',
    title: 'redo',
    enabled: 'canRedo',
    action: function(){
      this.redo();
    }
  }
};

fabric.util.object.extend(fabric.SlideCanvas.prototype.actions, {
  history: {
    title: 'history',
    type: 'menu',
    target: function () {
      return this.history;
    },
    menu: function () {
      return this.actions;
    }
  }
});

fabric.util.object.extend(fabric.Canvas.prototype, {
  insertHistory: false,
  onObjectModified: function (e) {
    if (!this.history.enabled || this.processing || this.history.processing) {
      return false;
    }
    var _canvas = e.target.canvas || e.target.wrapperEl && e.target;

    this.history.add({
      canvas:  e.target.canvas.originalSlide || e.target.canvas,
      originalState:  e.states.original,
      modifiedState:  e.states.modified,
      object: e.target,
      type: 'object:modified',
      undo: function (_action) {
        _action.object.set(_action.originalState);
        if(_action.canvas.mirrorSlide == this.canvas){
          _action.object.setCoords();
          var _canvas = this.canvas || this;
          _canvas.renderAll();
        }
        _action.canvas.fire('object:modified', { target: _action.object });
        _action.object.fire('modified');
        _action.canvas.renderAll();
      },
      redo: function (_action) {
        _action.object.set(_action.modifiedState);
        _action.object.setCoords();
        if(_action.canvas.mirrorSlide == this.canvas){
          _action.object.setCoords();
          var _canvas = this.canvas || this;
          _canvas.renderAll();
        }
        _action.canvas.fire('object:modified', { target: _action.object });
        _action.object.fire('modified');
        _action.canvas.renderAll();
      }
    });
  },
  clearHistory: function () {
    this.history.clear();
  },
  disableHistory: function () {
    this.history.enabled = false;
  },
  _add_object_history_action: function (_action) {
    var _canvas = this.canvas || this;
    if(this.canvas && _action.canvas.mirrorSlide == this.canvas){
      _canvas.add(_action.object);
      _canvas.setActiveObject(_action.object);
      _canvas.renderAll();
    }else{
      _action.canvas.add(_action.object);
    }
    _action.canvas.renderAll();
  },

  _remove_object_history_action: function (_action) {
    _action.canvas.remove(_action.object);
    _action.canvas.renderAll();
    if(this.canvas && _action.canvas.mirrorSlide == this.canvas){
      this.canvas.renderAll();
    }
  },

  onObjectRemoved: function (e) {
    if (!this.history.enabled || this.processing || this.history.processing) {
      return false;
    }
    this.history.add({
      canvas: e.target.canvas.originalSlide || e.target.canvas,
      object: e.target,
      type: 'object:removed',
      redo: this._remove_object_history_action,
      undo: this._add_object_history_action
    });
  },
  onDrawAfter: function(event){
    if (!this.history.enabled || this.processing || this.history.processing) {
      return false;
    }
    this.history.add(this.freeDrawingBrush.getHistoryRecord(event))
  },
  onObjectAdded: function (e) {
    if (!this.history.enabled || this.processing || this.history.processing) {
      return false;
    }
    this.history.add({
      canvas:  e.target.canvas.originalSlide || e.target.canvas,
      object: e.target,
      type: 'object:added',
      undo: this._remove_object_history_action,
      redo: this._add_object_history_action
    });
  },
  initHistory: function (history) {
    if(!history){
      history = new History(this);
      history.application = this.application;
    }

    this.history = history;
    this.on({
      'loading:begin':    this.clearHistory,
      'draw:after':       this.onDrawAfter,
      'object:modified':  this.onObjectModified,
      'object:added':     this.onObjectAdded,
      'object:removed':   this.onObjectRemoved
    });

    var _this = this;
    this.history.on('changed', function(e){
      if(this.activeAction.canvas){
        this.activeAction.canvas.moment = e.action.moment;
      }
    });
    var proto = this.application.prototypes.History;
    if(proto){
      if(proto.eventListeners){
        history.on(proto.eventListeners);
      }
    }
  },
  enableHistory: function () {
    this.history.enabled = true;
  }
});

if(fabric.Project){
  fabric.util.object.extend(fabric.Project.prototype.actions, {
    history: {
      insert: 'historyTools',
      title: 'history',
      type: 'menu',
      target: function () {
        return this.history;
      },
      menu: function () {
        return this.actions;
      }
    }
  });

  fabric.util.object.extend(fabric.Project.prototype, {
    _default_event_listeners : {
      "slide:change:begin" : function(){
        this.processing = true ;
        if(this.history){
          this.history.processing = true ;
        }
      },
      "slide:changed" : function(){
        this.processing = false;
        if(this.history){
          this.history.processing = false;
        }
      }
    },
    historyTools: false,
    enableHistory: function () {
      this.history.enabled = true;
    }
  });
}

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 72 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {/**
* InteractiveMode mixin. Allow to switch between pan/edit/drawing canvas modes.
*/




var _mouse_down_overwritten = fabric.Canvas.prototype._onMouseDown;
var _mouse_up_overwritten = fabric.Canvas.prototype._onMouseUp;
var _mouse_move_overwritten = fabric.Canvas.prototype._onMouseMove;

fabric.util.object.extend(fabric.SlideCanvas.prototype, {
  specialProperties: fabric.SlideCanvas.prototype.specialProperties.concat(["interactiveMode"]),
  _initEventListeners_overwritten: fabric.Canvas.prototype._initEventListeners,
  _initEventListeners: function () {
    this._initEventListeners_overwritten();
    this.___onKeyDown = this._onKeyDown.bind(this);
    fabric.util.addListener(fabric.window, 'keydown', this.___onKeyDown);
  },
  _removeListeners_overwritten: fabric.Canvas.prototype.removeListeners,
  removeListeners: function () {
    this._removeListeners_overwritten();
    fabric.util.removeListener(fabric.window, 'keydown', this.___onKeyDown);
  },
  _onKeyDown: function (e) {
    return this._applyMixedMode(e);
  },
  getInteractiveMode: function () {
    return this.interactiveMode;
  },
  setInteractiveMode: function (tool) {
    //todo checkthis out
    // if (tool === 'hand') {
    //   this.setCursor('pointer');
    // }
    this.isDrawingMode = (tool === 'draw');
    this.isHandMode = (tool === 'hand');
    this.interactive = (tool !== 'disabled');
    this.isMixedMode = (tool === 'mixed');

    if (!this.interactive) {
      this.upperCanvasEl.style.cursor = 'default';
    }
    this.interactiveMode = tool;
  },

  /**
   *  current mode
   *  @values default | hand | selection
   *  @comment
   *      hand      - moving canvas
   *      draw - drawing reactangles
   *      selection - default behavior
   */
  interactiveMode: 'default',

  isHandMode: false,
  _handModeCursorMove: false,
  _handModeCursorDown: false,
  _handModeCursorPosition: {x: 0, y: 0},
  _handModeMouseMove: function (e) {
    if (this._handModeCursorDown === true) {

      if (e.pageY === this._handModeCursorPosition.y && e.pageX === this._handModeCursorPosition.x) {
        return;
      }

      this._handModeCursorMove = true;

      var scroll = {x: this.viewportTransform[4], y: this.viewportTransform[5]};

      var newScroll = {
        x: scroll.x - (this._handModeCursorPosition.x - e.pageX),
        y: scroll.y - (this._handModeCursorPosition.y - e.pageY)
      };

      var dims = {
        width: this.size.width * this.zoom - this.lowerCanvasEl.width,
        height: this.size.height * this.zoom - this.lowerCanvasEl.height
      };
      /*  todo need to add some restrictions later
       //Math.max(Math.min(0,newScroll.x),-dims.width);
       //Math.max(Math.min(0,newScroll.y),-dims.height);
       */
      this.viewportTransform[4] = newScroll.x;
      this.viewportTransform[5] = newScroll.y;

      this.fire('viewport:translate');

      this.renderAll();
      for (var i = 0, len = this._objects.length; i < len; i++) {
        this._objects[i].setCoords();
      }

      this._handModeCursorPosition.y = e.pageY;
      this._handModeCursorPosition.x = e.pageX;
    }
  },
  _handModeMouseUp: function () {
    this._handModeCursorDown = false;
    if (!this._handModeCursorMove) {

    }
  },
  _handModeMouseDown: function (e) {

    this._handModeCursorMove = false;
    this._handModeCursorDown = true;
    this._handModeCursorPosition = {
      y: e.pageY,
      x: e.pageX
    };
  },
  handModeEnabled: false,
  handModeKey: "Alt",
  _applyMixedMode: function (e) {
    this._current_target = this.findTarget(e);

    if (this.handModeEnabled && e.altKey || e.key === this.handModeKey) {
      //if shift use hand mode
      if (!this.isHandMode) {
        this.isHandMode = true;
        this.isDrawingMode = false;
        this.setCursor('pointer');
      }
    } else if (this.isMixedMode && !this._isCurrentlyDrawing && !this._currentTransform) {

      this.isHandMode = false;

      if (this._current_target) {
        if (this.freeDrawingBrush && this._current_target.allowDrawing) {
          var corner = this._current_target._findTargetCorner(this.getPointer(e, true));
          if (!corner) {
            this.isDrawingMode = true;
          } else {
            this.isDrawingMode = false;
          }
        } else if (this.isDrawingMode) {
          this.isDrawingMode = false;
        }
      } else {
        if (this.freeDrawingBrush && !this.isDrawingMode) {
          this.setCursor(this.freeDrawingCursor);
          this.isDrawingMode = true;
        }
      }
    } else {
      this.isHandMode = false;
    }

  },
  _onMouseMove: function (e) {
    if (!this.interactive) {
      return;
    }

    this._applyMixedMode(e);

    if (this.isHandMode) {

      if (this._current_target && this._current_target.selectable_overwritten) {
        this._current_target.selectable = true;
      }

      if (this._handModeActive) {
        return this._handModeMouseMove(e);
      }
      this.fire('mouse:move', {target: this._current_target, e: e});
      this._current_target && this._current_target.fire('mousemove', {e: e});
      return true;
    } else {
      return _mouse_move_overwritten.call(this, e);
    }
  }, /**
   * @private
   */
  _onScale: function (e, transform, x, y) {

    var useUniScale = e.shiftKey ^ this.shiftInverted;
    // rotate object only if shift key is not pressed
    // and if it is not a group we are transforming
    if ((useUniScale || this.uniScaleTransform) && !transform.target.get('lockUniScaling')) {
      transform.currentAction = 'scale';
      return this._scaleObject(x, y);
    }
    else {
      // Switch from a normal resize to proportional
      if (!transform.reset && transform.currentAction === 'scale') {
        this._resetCurrentTransform(e);
      }

      transform.currentAction = 'scaleEqually';
      return this._scaleObject(x, y, 'equally');
    }
  },
  shiftInverted: false,
  _setCursorFromEvent_overwritten: fabric.Canvas.prototype._setCursorFromEvent,
  _setCursorFromEvent: function (e, target) {
    if (this.isHandMode) {
      this.setCursor('pointer');
    } else {
      this._setCursorFromEvent_overwritten(e, target);
    }
  },
  _onMouseDown: function (e) {
    if (!this.interactive) {
      return;
    }

    e.preventDefault();
    e.stopPropagation();

    this._applyMixedMode(e);
    if (this.isHandMode && this._current_target) {
      this._current_target.selectable_overwritten = this._current_target.selectable;
      this._current_target.selectable = false;
    }

    _mouse_down_overwritten.call(this, e);


    if (this.isHandMode) {

      if (this._current_target && this._current_target.selectable_overwritten) {
        this._current_target.selectable = true;
      }
      this._handModeActive = true;
      this._handModeMouseDown(e);
    }
  },

  _onMouseUp: function (e) {
    if (!this.interactive) {
      return;
    }
    e.preventDefault();
    e.stopPropagation();
    _mouse_up_overwritten.call(this, e);

    if (this.isHandMode) {
      this._handModeActive = false;
    }
  }
});

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 73 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {


var _onResize_overwritten = fabric.Canvas.prototype._onResize;

var _set_dimensions_overwritten = fabric.Canvas.prototype.setDimensions;
var _renderAllNative = fabric.SlideCanvas.prototype.renderAll;
fabric.util.object.extend(fabric.SlideCanvas.prototype, {
  _renderAllNative: _renderAllNative,
  _onResizeNative: _onResize_overwritten,

  setImageSmoothingEnabled: function(value){
    this.imageSmoothingEnabled = value;
    this._setImageSmoothing();
  },
  /**
   * @private
   * @see {@link http://www.whatwg.org/specs/web-apps/current-work/multipage/the-canvas-element.html#dom-context-2d-imagesmoothingenabled|WhatWG Canvas Standard}
   */
  _setImageSmoothing: function() {
    var ctx = this.getContext();

    // ctx.imageSmoothingEnabled = ctx.imageSmoothingEnabled || ctx.webkitImageSmoothingEnabled
    //   || ctx.mozImageSmoothingEnabled || ctx.msImageSmoothingEnabled || ctx.oImageSmoothingEnabled;
    ctx.imageSmoothingEnabled = this.imageSmoothingEnabled;

    if(this.layers && this.layers.background){
      this.layers.background.context.imageSmoothingEnabled = this.imageSmoothingEnabled;
    }
  },

  _onResize: function(){
    this._onResizeNative();
    if(this.onResize){
      this.onResize();
    }
    this.fire("resize");
  },
  create: function () {
    this.created = true;
    this._initInteractive();
    this._createCacheCanvas();
    this.initLayers();
  },
  createLayer: function(zindex){
    var _canvasElement = fabric.util.createCanvasElementWithSize(this);
    _canvasElement.style.left = 0;
    _canvasElement.style.top = 0;
    _canvasElement.style.position = 'absolute';
    var _ctx = _canvasElement.getContext('2d');
    _ctx.imageSmoothingEnabled = this.imageSmoothingEnabled;


    var layerAfter = null;
    for(var i in this.layers){

      if(this.layers[i].zindex > zindex && !layerAfter || layerAfter.zindex > this.layers[i].zindex){
        layerAfter  = this.layers[i];
      }
    }
    if(this.wrapperEl){
      if(layerAfter){
        this.wrapperEl.insertBefore(_canvasElement,layerAfter.canvas);
      }else{
        this.wrapperEl.appendChild(_canvasElement);
      }
    }


    return {
      transform: true,
      canvas: _canvasElement,
      context: _ctx,
      objects: []
    }
  },
  layersOrder: ["background","objects","selection","controls","interaction","interface"],
  initLayers: function(){

    this.layers = {
      lower: {
        zindex: 5,
        transform: true,
        objects: this._objects,
        canvas: this.lowerCanvasEl,
        context: this.contextContainer
      }
      // selection: this.createLayer(),
      // interaction: this.createLayer(),
      // overla: this.createLayer(),

    };

    this.layers.background = this.createLayer(0);



    if(this.upperCanvasEl){
      this.wrapperEl.appendChild(this.upperCanvasEl);
    }
    var layers = this.layers;
    this.layersOrder = this.layersOrder.map(function(i){
      return layers[i];
    });

    this.on("resize",function(){
      for(var i in this._backgroundLayer){
        this._backgroundLayer[i].setCoords();
      }
    });
  },
  /**
   * Helper for setting width/height
   * @private
   * @param {String} prop property (width|height)
   * @param {Number} value value to set property to
   * @return {fabric.Canvas} instance
   * @chainable true
   */
  _setBackstoreDimension: function (prop, value) {

    for(var i in this.layers){
      this.layers[i].canvas[prop] = value;
    }

    if (this.cacheCanvasEl) {
      this.cacheCanvasEl[prop] = value;
    }

    this[prop] = value;

    return this;
  },

  /**
   * Helper for setting css width/height
   * @private
   * @param {String} prop property (width|height)
   * @param {String} value value to set property to
   * @return {fabric.Canvas} instance
   * @chainable true
   */
  _setCssDimension: function (prop, value) {

    for(var i in this.layers){
      this.layers[i].canvas.style[prop] = value;
    }

    if (this.wrapperEl) {
      this.wrapperEl.style[prop] = value;
    }

    return this;
  },
  setDimensions: function (dimensions, options) {
    _set_dimensions_overwritten.call(this, dimensions, options);

    if(this.backgroundImage && this.backgroundImage.constructor !== String){
      this._update_background_image();
    }
    //this._update_clip_rect();
    this.fire("dimensions:modified");
    this.renderAll();
  },
  add: function (/*, isNewElement*/) {
    for (var i = 0, length = arguments.length; i < length; i++) {
      var obj = arguments[i];
      fabric.util.object.defaults(obj, fabric.SlideObject);

      if(obj.layer) {
        var _layer = this.layers[obj.layer];
        if(!_layer){
          _layer = this.layers[obj.layer] = this.createLayer();
        }
        _layer.objects.push(obj)
      }else{
        this._objects.push(obj);
      }
      if (this._onObjectAdded) {
        this._onObjectAdded(obj);
      }
    }

    //todo
    // if(isNewElement){
    //   this.addAlementInTheMiddle(el);
    //   this.setActiveObject(el);
    // }

    this.renderOnAddRemove && this.renderAll();
    return this;
  },
  remove: function () {
    var _objects = this.getObjects(),
      index;
    var objects;
    for (var i = 0, length = arguments.length; i < length; i++) {
      if (arguments[i].layer) {
        objects = arguments[i].layer;
      } else {
        objects = _objects;
      }

      index = objects.indexOf(arguments[i]);
      // only call onObjectRemoved if an object was actually removed
      if (index !== -1) {
        objects.splice(index, 1);
        this._onObjectRemoved(arguments[i]);
      }
    }

    this.renderOnAddRemove && this.renderAll();
    return this;
  },
  renderLayer: function (layer) {
    layer = this.layers[layer];
    if(this.processing)return false;
    var ctx = layer.context;
    ctx.save();
    this.clearContext(ctx);
    this.clipTo && fabric.util.clipContext(this, ctx);
    layer.transform &&  ctx.transform.apply(ctx, this.viewportTransform);
    this._renderObjects(layer.context,layer.objects);
    ctx.restore();
  },
  renderAll: function () {
    if(this.processing)return false;
    if (!this.virtual && this.selection && !this._groupSelector && !this.isDrawingMode) {
      this.clearContext(this.contextTop);
    }

    this.fire('before:render');

    for(var i in this.layers){
      var ctx = this.layers[i].context;
      this.clearContext(ctx);
      ctx.save();
      if (this.clipTo) {
        fabric.util.clipContext(this, ctx);
      }
      if(this.layers[i].transform){
        ctx.transform.apply(ctx, this.viewportTransform);
      }
    }

    this._renderBackground(this.layers.background.context);


    this.layers.lower._objects = this.layers.lower.objects;
    this.layers.lower.objects = this._chooseObjectsToRender();

    for(var i in this.layers){
      this._renderObjects(this.layers[i].context,this.layers[i].objects);
    }
    this.layers.lower.objects = this.layers.lower._objects;

    this.fire('render');

    if(!this.virtual){
      if (!this.controlsAboveOverlay && this.interactive ) {
        this.drawControls(this.layers.upper.context);
      }
      this._renderOverlay(this.layers.upper.context);
    }

    if (this.controlsAboveOverlay && this.interactive && !this._isCurrentlyDrawing ) {

      if(this.borderOpacityWhenMoving || !this.isMoving){
        this.drawControls(this.layers.upper.context);
      }
    }


    for(var i in this.layers) {
      var ctx = this.layers[i].context;
      ctx.restore();
    }

    this.fire('after:render');
  },
  _renderBackground: function(ctx) {
    this._renderBackgroundOrOverlay(ctx, 'background');
  },
  _renderOverlay: function(ctx) {
    this._renderBackgroundOrOverlay(ctx, 'overlay');

    // if (this._interfaceLayer) {
    //   this._renderObjects(ctx, this._interfaceLayer);
    // }
  },
  storeProperties: fabric.Object.prototype.storeProperties.concat(["layer"])
});

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 74 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.objectsLibrary = {
  text: {
    title: "Text",
    type: "i-text",
    text: "Текст"
  },
  line: {
    type: "line",
    strokeWidth: 5,
    stroke: "black",
    scaleX: 1,
    scaleY: 1,
    x1: 0,
    x2: 100,
    y1: 0,
    y2: 50
  },
  triangle: {
    type: "triangle",
    width: function(w,h){ return Math.min(w,h) - 4},
    height: function(w,h){ return Math.min(w,h) - 4}
  },
  rectangle: {
    type: "rect",
    width: function(w,h){ return Math.min(w,h) - 4},
    height: function(w,h){ return Math.min(w,h) - 4}
  },
  polygon: {
    scaleX: 1,
    scaleY: 1,
    type: "polygon",
    points: function(w,h) {
      return [
        {x: 25, y: 1},
        {x: 31, y: 18},
        {x: 49, y: 18},
        {x: 35, y: 29},
        {x: 40, y: 46},
        {x: 25, y: 36},
        {x: 10, y: 46},
        {x: 15, y: 29},
        {x:  1, y: 18},
        {x: 19, y: 18}
      ];
    }
  },
  path: {
    "type": "path",
    "path":  "m581.077942,2.537359c-2.053223,0.047071 -4.04071,0.188348 -6.108093,0.352907c-33.05542,2.663918 -62.235901,19.640541 -77.057678,44.925953l-7.8573,19.135319c1.698822,-6.633144 4.302979,-13.065384 7.8573,-19.135319c-26.430695,-22.16293 -63.531677,-32.388445 -100.192383,-27.574373c-36.661469,4.788353 -68.503082,24.041758 -85.901978,51.935225c-49.116486,-24.490013 -110.34288,-22.999454 -157.711807,3.860092c-47.369164,26.86068 -72.61673,74.40551 -64.941162,122.38308l5.021355,19.49968c-2.263329,-6.38501 -3.960793,-12.887695 -5.021355,-19.49968l-0.761948,1.798569c-41.179165,3.625244 -74.945375,29.465134 -83.716398,64.059235c-8.771805,34.597748 9.46701,70.085876 45.185621,87.96701l55.776558,10.973114c-19.480217,1.291962 -38.915543,-2.534515 -55.776558,-10.973114c-27.5478,24.96817 -33.888516,61.935303 -15.71492,92.467834c18.173733,30.524719 56.988899,48.110687 97.030457,44.11734l24.339722,-5.21109c-7.827499,2.651611 -15.960983,4.379059 -24.339722,5.21109c22.730042,33.857269 60.428192,58.556244 104.66893,68.383514c44.2491,9.81366 91.240952,4.014771 130.425949,-16.094604c31.96701,40.793823 88.707642,62.217468 145.596313,54.99707c56.902466,-7.219666 103.833984,-41.81427 120.501343,-88.770996l5.781433,-26.239532c-0.863708,8.909546 -2.742249,17.681366 -5.781433,26.239532c39.133301,20.753662 88.353333,21.927307 128.785095,3.049316c40.439819,-18.874084 65.665771,-54.869049 66.036133,-94.078247l-14.495605,-58.580597l-57.105713,-39.630768c44.163452,22.374573 71.992615,56.467255 71.601318,98.211365c52.49707,0.448181 97.103394,-35.956573 117.112427,-77.726288c20.011597,-41.769836 12.443604,-89.396759 -19.864929,-125.164642c13.401184,-26.637695 12.609985,-56.937332 -2.183472,-83.034088c-14.786194,-26.097893 -42.065491,-45.476891 -74.873047,-53.098335c-7.341431,-34.580929 -37.602661,-62.404482 -77.600708,-71.526293c-39.998474,-9.121368 -82.584839,2.123992 -109.364807,28.926123l-16.258179,22.19817c4.157959,-8.018612 9.583923,-15.495213 16.258179,-22.19817c-18.876953,-21.060713 -48.486023,-32.954061 -79.348938,-32.155401l0,0z",
    "width": function(w,h){return w - 4 },
    "height": function(w,h){return h - 4}
  },
  ellipse: {
    "type": "ellipse",
    "rx": function(w,h){return w /2 - 4},
    "ry": function(w,h){return h/ 2 - 4}
  },
  circle: {
    type: "circle",
    radius: function(w,h){ return Math.min(w,h)/2 - 4}
  }
};

fabric.getObjectsList = function(w,h){
  var _lib = [];
  for(var i in this.objectsLibrary){
    var o = _lib[i] = fabric.util.object.cloneDeep(this.objectsLibrary[i]);
    o.title = o.title || o.type;
    if(o.width === 0 ) o.width = w;
    if(o.height === 0 ) o.height = h;
    for(var j in o){
      if(o[j].constructor == Function){
        o[j] = o[j].call(o,w,h);
      }
    }
  }
  return _lib;
};

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 75 */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.util.object.extend(fabric.Application.prototype, {
  // loaderTemplate: "<span class='fa fa-pulse fa-spinner canvas-load-spinner'></span>",
  loaderIcon:   'data:image/svg+xml;base64,' + __webpack_require__(21),
  loaderContainer: null,
  _showMainLoaderIndicator: function () {
    this.loaderEl.show();
    this.loaderContainer.addClass("processing");
  },
  _hideMainLoaderIndicator: function () {
    this.loaderEl.hide();
    this.loaderContainer.removeClass("processing");
  },
  setLoaderTemplate: function (val) {
    if(this.virtual) return false;
    this.loaderTemplate = val.replace("{loaderIcon}",this.loaderIcon);
    if(val) {
      this.loaderContainer = $(this.loaderContainer);
      this.loaderEl = $(this.loaderTemplate).hide();
      this.loaderContainer.append(this.loaderEl);
      // this.on("loading:begin", this._showMainLoaderIndicator);
      // this.on("loading:end", this._hideMainLoaderIndicator);


      this.on("project:changed",function(){
        this.project.on("slide:change:begin", this._showMainLoaderIndicator.bind(this));
        this.project.on("slide:changed", this._hideMainLoaderIndicator.bind(this));
      })

    }
  }
});


// fabric.util.object.extend(fabric.SlideCanvas.prototype, {
//   // loaderTemplate: "<span class='fa fa-pulse fa-spinner canvas-load-spinner'></span>",
//   setLoaderTemplate: function (val) {
//     if(this.virtual) return false;
//     this.loaderTemplate = val;
//     if(val) {
//       this.loaderEl = $(this.loaderTemplate).hide();
//       $(this.wrapperEl).append(this.loaderEl);
//       this.on("loading:begin", function () {
//         this.loaderEl.show();
//         $(this.wrapperEl).addClass("processing");
//       });
//       this.on("loading:end", function () {
//         this.loaderEl.hide();
//         $(this.wrapperEl).removeClass("processing");
//       });
//     }
//   }
// });

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 76 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {



// todo это убрать
fabric.movementsLimitsEasy = false;
var _toObject_overwritten = fabric.Object.prototype.toObject;
//todo use event "before:object";
fabric.Object.prototype.toObject = function (propertiesToInclude) {
  var obj = _toObject_overwritten.call(this,propertiesToInclude);
  var _storeAll = this.storeProperties.indexOf("*") != -1;
  if (this.clipTo && this.clipTo.id && (_storeAll || this.storeProperties.indexOf("clipTo") != -1)) {
    obj.clipTo = '#' + this.clipTo.id
  }
  if ( this.movementLimits &&  (_storeAll || this.storeProperties.indexOf("movementLimits") != -1)) {
    obj.movementLimits = this.movementLimits.id ? '#' + this.movementLimits.id : this.movementLimits;
  }
  return obj;
};

var _scaleObject_overwritten = fabric.Canvas.prototype._scaleObject;


fabric.util.object.extend(fabric.Object.prototype, {
  setWholeCoordinates: function(val){
    this.wholeCoordinates = val;
    this.on("added modified",function(){
      if(this.wholeCoordinates){
        this.set({
          left: Math.round(this.left),
          top: Math.round(this.top),
          width: Math.round(this.width),
          height: Math.round(this.height)
        })
      }
    },true)
  },
  // setTop: function(val){
  //   if(this.wholeCoordinates){
  //     val = Math.round(val);
  //   }
  //   this.top = val;
  // },
  // setLeft: function(val){
  //   if(this.wholeCoordinates){
  //     val = Math.round(val);
  //   }
  //   this.left = val;
  // },
  // setWidth: function(w){
  //   if(this.wholeCoordinates){
  //     w = Math.round(w);
  //   }
  //   this.width = w;
  // },
  // setHeight: function(h){
  //   if(this.wholeCoordinates){
  //     h = Math.round(h);
  //   }
  //   this.height = h;
  // },
  // specialProperties: fabric.Object.prototype.specialProperties.concat(["movementLimits"]),
  _setMovementLimitsString: function () {
    var val = this.movementLimits;
    if (val && val.constructor === String) {
      var val = this.movementLimits;
      if (val == 'canvas') {

        val = this.canvas;
      } else {
        var _id = this.movementLimits.substring(1);
        val = this.canvas.getObjectByID(_id);
      }
      this.movementLimits = val;
    }
    this.canvas._check_object_position(this);
    // this.canvas._check_object_position(this);
    // this.setCoords();

  },
  setMovementLimits: function (val) {


    if(!this.movementLimits){
      this.on({
        added: this._setMovementLimitsString,
        rotated: function (event) {
          var target = this;

          if (target.resizable) {
            if (pos.left !== undefined) {
              if (target.left < pos.left) {
                target.width += target.left - pos.left;
                target.left = pos.left;
              } else {
                target.width -= target.left - pos.left;
              }
            }
            if (pos.top !== undefined) {
              if (target.top < pos.top) {
                target.height += target.top - pos.top;
                target.top = pos.top;
              } else {
                target.height -= target.top - pos.top;
              }
            }
          }
          this.canvas._check_object_position(this)
        },
        modified: function (event) {
          this.canvas._check_object_after_modified(this)
        }
      });
    }
    this.movementLimits = val;

    if(this.canvas){
      this._setMovementLimitsString();
    }

  }
});

var _translateObject_overwritten = fabric.Canvas.prototype._translateObject;
var _beforeScaleTransform_overwritten = fabric.Canvas.prototype._beforeScaleTransform;
fabric.util.object.extend(fabric.SlideCanvas.prototype, {
  specialProperties: fabric.SlideCanvas.prototype.specialProperties.concat(["movementLimits"]),
  _beforeScaleTransform_overwritten: _beforeScaleTransform_overwritten,
  _beforeScaleTransform: function (e, transform) {
    this._beforeScaleTransform_overwritten(e, transform);
    if (!this._currentTransform.original.oCoords) {
      this._currentTransform.original.oCoords = fabric.util.object.cloneDeep(this._currentTransform.target.oCoords);
    }
  },
  //fix getcenter function
  centerObject: function (object) {
    var center;
    if (object.movementLimits) {
      var _xy = object.movementLimits.getCenterPoint();
      center = {top: _xy.y, left: _xy.x};
    } else {
      center = this.getCenter();
    }
    this._centerObject(object, new fabric.Point(center.left, center.top));
    this.renderAll();
    return this;
  },
  getCenter: function () {
    return {
      top: this.originalHeight / 2 / this.getZoom(),
      left: this.originalWidth / 2 / this.getZoom()
    };
  },
  setMovementLimits: function (_offsets) {
    this.movementLimits = _offsets;

    return this;
  },
  movementLimits: {
    left: false,
    top: false,
    right: false,
    bottom: false
  },
  //content хотя бы  пиксель объекта должен быть внутри зоны
  //fit зона должно полностью находится внутри объекта
  movementLimitMode: "fit",
  getFixedPositionEasy: function (target, x, y) {
    var _w = this.originalWidth || this.width;
    var _h = this.originalHeight || this.height;

    if (x === undefined) {
      x = target.left;
    }
    if (y === undefined) {
      y = target.top;
    }
    var scale = this.viewportTransform[0];
    target.setCoords();
    target.right = _w - (target.left + target.width);
    target.bottom = _h - (target.top + target.height);

    var _diff, _asp, rect;
    var newPos = {
      left: x,
      top: y,
      width: target.width,
      height: target.height
    }

    if (target.width > _w) {
      newPos.width = _w;
    }
    if (target.height > _h) {
      newPos.height = _h;
    }
    if (target.left < 0) {
      newPos.width += target.left;
      newPos.left -= target.left;
    }
    if (target.right < 0) {
      newPos.width += target.right;
    }
    if (target.top < 0) {
      newPos.height += target.top;
    }
    if (target.bottom < 0) {
      newPos.height += target.bottom;
    }
    return newPos;
  },
  getMovementsLimitsRect: function(target){

    var _w = this.originalWidth || this.width;
    var _h = this.originalHeight || this.height;

    if (target.movementLimits == this) {
      return {
        left: 0,
        top: 0,
        width: _w,
        height: _h,
        right: 0,
        bottom: 0
      }
    }else{
      var _stroke_width = target.movementLimits.strokeWidth;
      target.movementLimits.strokeWidth = 0;

      target.movementLimits.setCoords();
      var rect = target.movementLimits.getBoundingRect();

      target.movementLimits.strokeWidth = _stroke_width;
      return rect;
    }
  },
  contentOffsets : 5,
  getFixedPosition: function (target, x, y) {


    var _w = this.originalWidth || this.width;
    var _h = this.originalHeight || this.height;


    if (x === undefined) {
      x = target.left;
    }
    if (y === undefined) {
      y = target.top;
    }
    var scale = this.viewportTransform[0];
    target.setCoords();
    var bounds = target.getBoundingRect();
    bounds.left /= scale;
    bounds.top /= scale;
    bounds.width /= scale;
    bounds.height /= scale;

    bounds.left -= this.viewportTransform[4] / scale;
    bounds.top -= this.viewportTransform[5] / scale;
    bounds.right = _w - (bounds.left + bounds.width);
    bounds.bottom = _h - (bounds.top + bounds.height);



    if (target.movementLimits) {
      var rect = this.getMovementsLimitsRect(target);


      if (target.movementLimits == this) {

        rect.width *= scale;
        rect.height *= scale;
      }
      else if (target.movementLimits.getBoundingRect) {


        //var sw = target.movementLimits.strokeWidth;

        rect.left /= scale;
        rect.top /= scale;
        rect.width /= scale;
        rect.height /= scale;
        rect.left -= this.viewportTransform[4] / scale;
        rect.top -= this.viewportTransform[5] / scale;

        //rect.left   += sw /2;
        //rect.top    += sw /2;
        //rect.width  -= sw;
        //rect.height -= sw;

        rect.right = _w - (rect.left + rect.width);
        rect.bottom = _h - (rect.top + rect.height);
      } else {
        rect = target.movementLimits;
      }
    }

    var limits = rect || this.movementLimits;

    var newPos = {};
    var _l = limits.left, _r = limits.right;
    var _t = limits.top, _b = limits.bottom;

    if (target.movementLimitMode == "content") {
      _l -= bounds.width - this.contentOffsets, _r -= bounds.width - this.contentOffsets;
      _t -= bounds.height - this.contentOffsets, _b -= bounds.height - this.contentOffsets;
    }

    if (target.movementLimitMode == "fit" && !target.resizable) {
      if (_l !== false && _r !== false) {
        var _w = _w - _l - _r;
        if (bounds.width > _w) {
          var _asp = _w / bounds.width;
          newPos.scaleX = _asp;
          newPos.scaleY = _asp;
        }
      }

      if (_t !== false && _b !== false) {
        var _h = _h - _t - _b;
        if (bounds.height > _h) {
          var _asp = _h / bounds.height;
          target.scaleX *= _asp;
          target.scaleY *= _asp;
        }
      }
    }

    if (target.movementLimitMode == "fit" || target.movementLimitMode == "content") {

      if (_l !== false) {
        var _diff = _l - bounds.left;
        if (_diff > 0) {
          newPos.left = x + _diff;
        }
      }

      if (!newPos.left && _r !== false) {
        var _diff = _r - bounds.right;
        if (_diff > 0) {
          newPos.left = x - _diff;
        }
      }

      if (_t !== false) {
        var _diff = _t - bounds.top;
        if (_diff > 0) {
          newPos.top = y + _diff;
        }
      }

      if (!newPos.top && _b !== false) {
        var _diff = _b - bounds.bottom;
        if (_diff > 0) {
          newPos.top = y - _diff;
        }
      }

    }

    return newPos;
  },
  /**
   * функцию можно вызвать с евентом  'after:render'. Позволяет отображать вычисления пересечений изменяемого объекта с рамкой. выделяет красными лиинияи
   * @private
   * @example
   *  eventListeners : {
    Canvas: {
      'before:render': function(){
        this.clearContext(this.contextTop);
      },
      'after:render': function(){
        this._debug_intersections()
      }
    }
  }
   */
  drawInterestionLines: function(){
    var tr = this._currentTransform;
    if (tr && tr._intersections) {
      var ctx = this.contextTop;
      ctx.beginPath();
      ctx.strokeStyle = "red";
      for(var i in tr._intersections){
        var _coord = tr._intersections[i];
        ctx.moveTo(_coord.x + 5, _coord.y);
        ctx.arc(_coord.x, _coord.y, 5, 0, 2 * Math.PI);
      }
      for(var i in tr.lines){
        var _l = tr.lines[i];
        ctx.moveTo(_l[0].x,_l[0].y);
        ctx.lineTo(_l[1].x,_l[1].y);
      }
      for(var i in tr.mlLines){
        var _l = tr.mlLines[i];
        ctx.moveTo(_l[0].x,_l[0].y);
        ctx.lineTo(_l[1].x,_l[1].y);
      }
      ctx.stroke();
    }
  },
  _scaleObjectEasy: function (x, y, by) {
    //_scaleObject_overwritten.call(this, x, y, by);
    var tr = this._currentTransform,
      target = tr.target,
      corner = tr.corner;
    if(!target.movementLimits){
      return _scaleObject_overwritten.call(this, x,y, by);
    }


    if (target.movementLimitMode !== 'fit')return;
    x = Math.min(target.movementLimits.width, Math.max(0,x));
    y = Math.min(target.movementLimits.height, Math.max(0,y));
    _scaleObject_overwritten.call(this, x,y, by);
  },
  /**
   * Scales object by invoking its scaleX/scaleY methods
   * @private
   * @param {Number} x pointer's x coordinate
   * @param {Number} y pointer's y coordinate
   * @param {String} by Either 'x' or 'y' - specifies dimension constraint by which to scale an object.
   *                    When not provided, an object is scaled by both dimensions equally
   */
  _scaleObject: function (x, y, by) {
    var _scaled = _scaleObject_overwritten.call(this, x, y, by);

    var tr = this._currentTransform,
      target = tr.target,
      corner = tr.corner;
    var _v = this.viewportTransform;

    if (!target.movementLimits || target.movementLimitMode !== "fit"){
      return _scaled;
    }
    target.setCoords();

    var _scale = this.getZoom();

    if(target.movementLimits == this){
      var _w = this.originalWidth || this.width;
      var _h = this.originalHeight || this.height;
      var _l = this.viewportTransform[4] ;
      var _t = this.viewportTransform[5] ;
      _w *= _scale;
      _h *= _scale;
      var _rc = {
        tl: {x: _l, y: _t},
        tr: {x: _l + _w, y: _t},
        bl: {x: _l, y: _t + _h},
        br: {x: _l + _w, y: _t + _h}
      }
    }else{
      target.movementLimits.setCoords();
      var _rc = target.movementLimits.oCoords;
    }


    if (!tr.pointerOffset) {
      tr.pointerOffset = {
        x: x * _v[0] - target.oCoords[corner].x,
        y: y * _v[3] - target.oCoords[corner].y
      }

      tr.pointCenter = target.getCenterPoint();
      tr.pointCenter.x *= _scale;
      tr.pointCenter.y *= _scale;
      tr.pointOriginal = tr.original.oCoords[corner];
    }

    tr.pointTranformed = target.oCoords[corner];

    tr.mlLines = [];
    tr.lines = [];
    function _intersection(corner, coordinate) {
      var _oc;
      if (coordinate == "x" && corner[0] != "m") {
        _oc = tr.original.oCoords["m" + corner[0]];
      } else if (coordinate == "y" && corner[0] != "m") {
        _oc = tr.original.oCoords["m" + corner[1]];
      } else {
        _oc = tr.pointCenter;
        _oc = {
          x: _oc.x + _v[4],
          y: _oc.y + _v[5]
        };
      }
      var _tc = target.oCoords[corner];

      tr.lines.push([_oc, _tc]);
      tr.mlLines.push([_rc.tl, _rc.tr]);
      tr.mlLines.push([_rc.tr, _rc.br]);
      tr.mlLines.push([_rc.br, _rc.bl]);
      tr.mlLines.push([_rc.bl, _rc.tl]);

      var inters = fabric.Intersection.intersectLinePolygon(_oc, _tc, [_rc.tl, _rc.tr, _rc.br, _rc.bl]);
      if (!inters.points.length) {
        return;
      }
      inters.points[0].coordinate = coordinate;
      tr._intersections.push(inters.points[0])

//         if (coordinate) {
//           var p1 = inters.points[0];

//           var corner2;
//           if (coordinate == "x") {
//             corner2 = (corner[0] == "t" ? "b" : "t") + corner[1];
//           } else {
//             corner2 = corner[0] + (corner[1] == "l" ? "r" : "l");
//           }
//           var _p2 = target.oCoords[corner2];
//           var _diff = {x: _tc.x - p1.x, y: _tc.y - p1.y};

//           var p2 = {
//             x: _p2.x - _diff.x,
//             y: _p2.y - _diff.y
//           };

//           var its = fabric.Intersection.intersectLineLine(tr.pointCenter, tr.pointTranformed, p1, p2);
//           if (!its.points[0]) {
//             return;
//           }
//           tr._intersections.push(its.points[0]);
//         } else {
//           tr._intersections.push(inters.points[0]);
//         }


      //
      //if(inters.points.length){
      //  _scaleObject_overwritten.call(this, inters.points[0].x,  inters.points[0].y, by);
      //  target.setCoords();
      //}else{
      //  _scaleObject_overwritten.call(this, x, y, by);
      //}
    }


    tr._intersection = null;
    tr._intersections = [];
    switch (corner) {
      case "tl":
        _intersection("tl");
        _intersection("bl", "x");
        _intersection("tr", "y");
        break;
      case "tr":
        _intersection("tr");
        _intersection("tl", "y");
        _intersection("br", "x");
        break;
      case "br":
        _intersection("br");
        _intersection("tr", "x");
        _intersection("bl", "y");
        break;
      case "bl":
        _intersection("bl");
        _intersection("tl", "x");
        _intersection("br", "y");
        break;
      case "mt":
        _intersection("mt");
        _intersection("tl", "y");
        _intersection("tr", "y");
        break;
      case "mb":
        _intersection("mb");
        _intersection("bl", "y");
        _intersection("br", "y");
        break;
      case "mr":
        _intersection("mr");
        _intersection("tr", "x");
        _intersection("br", "x");
        break;
      case "ml":
        _intersection("ml");
        _intersection("tl", "x");
        _intersection("bl", "x");
    }

    if (!tr._intersections.length) {
      return _scaled;
    }


    var _newXY = tr._intersections[0];
    var _l = tr._intersections[0].distanceFrom(tr.pointOriginal);

    for (var i = 1; i < tr._intersections.length; i++) {
      var _l2 = tr._intersections[i].distanceFrom(tr.pointOriginal);
      if (_l2 < _l) {
        _newXY = tr._intersections[i];
        _l = _l2;
      }
    }
    tr._intersection = _newXY;


    if (by == "equally") {
      //by = false;

      var _diff2 = {x: _newXY.x - tr.pointCenter.x, y: _newXY.y - tr.pointCenter.y};
      var _l = Math.sqrt(_diff2.x * _diff2.x + _diff2.y * _diff2.y);

      _newXY.x -= _diff2.x / _l * target.strokeWidth;
      _newXY.y -= _diff2.y / _l * target.strokeWidth;
      // scrt(x*x + y*y) = atrokewidth
      var a = 1;
    }
    //return _scaleObject_overwritten.call(this, x, y, by);
    var __x = (_newXY.x + tr.pointerOffset.x ) / _v[0];
    var __y = (_newXY.y + tr.pointerOffset.y ) / _v[3];
    return _scaleObject_overwritten.call(this, __x, __y, by);

    //
    //if (corner == "br" || corner == "tr" || corner == "mr") {
    //  if (x < target.movementXMaxLimit) {
    //    x = target.movementXMaxLimit;
    //  }
    //}
    //if (corner == "bl" || corner == "tl" || corner == "ml") {
    //  if (x > target.movementXMinLimit) {
    //    x = target.movementXMinLimit;
    //  }
    //}
    //if (corner == "bl" || corner == "br" || corner == "mb") {
    //  if (y < target.movementYMaxLimit) {
    //    y = target.movementYMaxLimit;
    //  }
    //}
    //if (corner == "tl" || corner == "tr" || corner == "mt") {
    //  if (y > target.movementYMinLimit) {
    //    y = target.movementYMinLimit;
    //  }
    //}
    //
    //_scaleObject_overwritten.call(this, x, y, by);
  },
  movementLimitsOnAddAction: 'translate',
  _check_object_after_modified: function (target) {
    if (!this._currentTransform) {
      return;
    }
    var pos = this.getFixedPosition(target, target.left, target.top);

    switch (this._currentTransform.corner) {
      case "mtr":
        if (pos.left !== undefined) {
          target.set('left', pos.left);
        }
        if (pos.top) {
          target.set('top', pos.top);
        }
        break;
      case "mr":
      case "br":
        if (pos.left !== undefined) {
          var _ldiff = target.left - pos.left;

        }
        if (pos.top !== undefined) {
          var _tdiff = target.top - pos.top;
        }

        if (_ldiff && (!_tdiff || Math.abs(_ldiff) > Math.abs(_tdiff))) {
          if (_ldiff < 0) {
            target.width += _ldiff;
          } else {
            target.width -= _ldiff;
          }
        } else if (_tdiff) {
          if (_tdiff < 0) {
            target.width += _tdiff;
          } else {
            target.width -= _tdiff;
          }
        }
      //console.log(pos,_ldiff,_tdiff)
    }
    // this._check_object_position(target)
  },
  _check_object_position: function (target) {

    var pos = this.getFixedPosition(target, target.left, target.top);
    if (this.movementLimitsOnAddAction == 'translate') {
      if (pos.left !== undefined) {
        target.set('left', pos.left);
      }
      if (pos.top !== undefined) {
        target.set('top', pos.top);
      }
    }else{

      if (pos.left !== undefined) {
        if (target.left < pos.left) {
          target.width += target.left - pos.left;
          target.left = pos.left;
        } else {
          target.width -= target.left - pos.left;
        }
      }
      if (pos.top !== undefined) {
        if (target.top < pos.top) {
          target.height += target.top - pos.top;
          target.top = pos.top;
        } else {
          target.height -= target.top - pos.top;
        }
      }
    }


    if (pos.scaleX) {
      target.scaleX = target.scaleX *= pos.scaleX;
    }
    if (pos.scaleY) {
      target.scaleY = target.scaleY *= pos.scaleY;
    }

    target.setCoords();

    this.renderAll();
    // if(target.wholeCoordinates){
    //   target.top = Math.round(target.top);
    //   target.left = Math.round(target.left);
    //   target.height = Math.round(target.height);
    //   target.width = Math.round(target.width);
    // }
  },
  _translateObject: function (x, y, limits) {
    var target = this._currentTransform.target;
    if(target.beforeTranslate){
      var _point = target.beforeTranslate(x, y);
      if(!_point)return false;
      x = _point.x;
      y = _point.y;
    }
    var _translated = _translateObject_overwritten.call(this, x, y, limits);

    var pos = this.getFixedPosition(target, x, y);

    if (pos.scaleX) {
      target.scaleX = this._currentTransform.scaleX *= pos.scaleX;
    }
    if (pos.scaleY) {
      target.scaleY = this._currentTransform.scaleY *= pos.scaleY;
    }

    if (pos.top !== undefined || pos.left !== undefined) {
      _translated = _translateObject_overwritten.call(this,
        pos.left !== undefined ? pos.left : x,
        pos.top !== undefined ? pos.top : y);
    }
    return _translated || pos.scaleX || pos.scaleY;



    /* if (!target.get('lockMovementX')) {
     var _val = x - this._currentTransform.offsetX;

     //left offset
     var lim = this.movementLimits.minX.constructor == Number ? this.movementLimits.minX : -bounds.width + 1;
     if(target.movementXMinLimit && target.movementXMinLimit.constructor == Number && target.movementXMinLimit > lim ){
     lim = target.movementXMinLimit ;
     }

     _val = Math.min(lim, _val);

     //right offset
     var lim = this.movementLimits.maxX.constructor == Number ? this.movementLimits.maxX : this.width + bounds.width - 1;
     if(target.movementXMaxLimit && target.movementXMaxLimit.constructor == Number && target.movementXMaxLimit > lim ){
     lim = target.movementXMaxLimit ;
     }
     _val = Math.max(lim  - target.width * target.scaleX, _val);
     target.set('left', _val);
     }
     if (!target.get('lockMovementY')) {
     var _val = y - this._currentTransform.offsetY;
     if(target.movementYMinLimit !== undefined)
     _val = Math.min(target.movementYMinLimit, _val);
     if(target.movementYMaxLimit !== undefined)
     _val = Math.max(target.movementYMaxLimit  - target.height, _val);

     target.set('top', _val);
     }
     */
    //movementLimits ={
    //    xmin: 0,
    //    xmax: 0,
    //    ymin: 0,
    //    ymax: 0
    //};

  }

});

//fabric.SlideCanvas.addPlugin("loaders",function(){
//    this.initMovementLimits();
//});

//todo
fabric.Rect.prototype.stateProperties   = fabric.Rect.prototype.stateProperties.concat(["movementLimits","clipTo"]);
fabric.Object.prototype.stateProperties = fabric.Object.prototype.stateProperties.concat(["movementLimits","clipTo"]);
fabric.IText.prototype.stateProperties  = fabric.IText.prototype.stateProperties.concat(["movementLimits","clipTo"]);
fabric.Image.prototype.stateProperties  = fabric.Image.prototype.stateProperties.concat(["movementLimits","clipTo"]);


var _beforeTransform_overwritten = fabric.Canvas.prototype._beforeTransform;
var _finalize_current_transform_overwritten = fabric.Canvas.prototype._finalizeCurrentTransform;
var _restoreOriginXYNative = fabric.Canvas.prototype._restoreOriginXY;
fabric.util.object.extend(fabric.Canvas.prototype, {

  _finalizeCurrentTransformNative: fabric.Canvas.prototype._finalizeCurrentTransform,
  _finalizeCurrentTransform: function () {

    var transform = this._currentTransform,
      target = transform.target;

    if (target._scaling) {
      target._scaling = false;
    }

    target.setCoords();

    this._restoreOriginXY(target);
    // only fire :modified event if target coordinates were changed during mousedown-mouseup
    this.fireModifiedIfChanged(target);

    // target._finalizeCurrentTransform ?
    //   target._finalizeCurrentTransform() :
    //   this._finalizeCurrentTransformNative(this);
  },
  _beforeTransform: function (e, target) {
    target && target._beforeTransform ?
      target._beforeTransform(e) :
      _beforeTransform_overwritten.call(this, e, target);
  },
  _beforeTransformNative: _beforeTransform_overwritten,
  /**
   * Translates object by "setting" its left/top
   * @private
   * @param {Number} x pointer's x coordinate
   * @param {Number} y pointer's y coordinate
   * @return {Boolean} true if the translation occurred
   */
  _translateObject: function (x, y) {
    var transform = this._currentTransform,
      target = transform.target,
      newLeft = x - transform.offsetX,
      newTop = y - transform.offsetY,
      moveX = !target.get('lockMovementX') && target.left !== newLeft,
      moveY = !target.get('lockMovementY') && target.top !== newTop;


    //round coordinates
    // if (target.wholeCoordinates) {
    //   newLeft = Math.round(newLeft);
    //   newTop = Math.round(newTop);
    // }

    moveX && target.set('left', newLeft);
    moveY && target.set('top', newTop);
    return moveX || moveY;
  },

  // _restoreOriginXYNative: _restoreOriginXYNative,
  // _restoreOriginXY: function (target) {
  //   this._restoreOriginXYNative(target);
  //
  //   // if (target.wholeCoordinates) {
  //   //   target.left = Math.round(target.left);
  //   //   target.top = Math.round(target.top);
  //   // }
  // },

  /**
   * Sets the position of the object taking into consideration the object's origin
   * @param {fabric.Point} pos The new position of the object
   * @param {String} originX Horizontal origin: 'left', 'center' or 'right'
   * @param {String} originY Vertical origin: 'top', 'center' or 'bottom'
   * @return {void}
   */
  setPositionByOrigin: function (pos, originX, originY) {
    var center = this.translateToCenterPoint(pos, originX, originY),
      position = this.translateToOriginPoint(center, this.originX, this.originY);

    // if (this.wholeCoordinates) {
    //   position.x = Math.round(position.x);
    //   position.y = Math.round(position.y);
    // }
    this.set('left', position.x);
    this.set('top', position.y);
  }
});

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 77 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

var MagicWand = fabric.MagicWand ;

/**
 * Pathfinder (Pathfinder) Interface for MagicWand selection tool
 * @param options
 * @constructor
 */
function Pathfinder(options) {
  this.initialize(options);
}

Pathfinder.prototype = {
  type: 'pathfinder',
  keepOldSelection: true,
  alphaChannel: true,
  pathfinderMode: 'new',
  selectionTool: 'magic',
  adjacentPixels: true,
  async: false,
  drawingTools: false,
  pathfinderTools: false,
  blurRadius: 0,
  hatchLength: 4,
  colorThreshold: 15,
  simplifyTolerant: 0,
  simplifyCount: 30,
  hatchOffset: 0,
  imageInfo: null,
  mask: null,
  downPoint: null,
  allowDraw: false,
  shapeSelectionTools: false,
  initialize: function (options) {
    options.application.fire('entity:created',{target : this,options : options})

    for (var i in options) {
      this[i] = options[i];
    }
  },
  asyncronous: function (cb) {
    if (this.async) {
      setTimeout(cb);
    } else {
      cb();
    }
  },
  fillWithCurrentColor: function () {
    this.fill(this.color);
  },
  clearMemory: function () {
    delete this.resultCanvas;
    delete this.editedImageCanvas;
    delete this.test_picture;
    delete this.mask;
  },
  hide: function () {
    if (this.editedImageCanvas) {
      this.editedImageCanvas.remove();
      this.resultCanvas.remove();
      clearInterval(this.interval);
      this.clearMemory();
      this.fire('hidden');
    }
  },
  setContainer: function (container) {
    if (container.constructor === String) {
      container = document.getElementById(container);
    }
    this.container = container;

    this.test_picture = new Image();
    this.test_picture.onload = this.initCanvas.bind(this);
    return this;
  },
  getSelectionTool: function () {
    return this.selectionTool;
  },
  setSelectionTool: function (tool) {
    this.selectionTool = tool;
    this.downPoint = false ;
    this.fire('tool:changed', tool);
  },
  getThreshold: function () {
    return this.colorThreshold;
  },
  setThreshold: function (thres) {
    if(thres !== undefined){
      this.colorThreshold = thres;
    }
    if (this.downPoint) {
      this.drawMask(this.downPoint.x, this.downPoint.y, this.adjacentPixels);
    }
    this.fire('threshold:changed', {threshold: this.colorThreshold});
  },
  setPicture: function (img) {
    this.setImage(img);
    var cvs = fabric.util.createCanvasElement();

    cvs.onmouseup = this.onMouseUp.bind(this);
    cvs.onmousedown = this.onMouseDown.bind(this);
    cvs.onmousemove = this.onMouseMove.bind(this);
    cvs.oncontextmenu = function () {
      return false;
    };
    this.initCanvas(cvs);
  },
  load: function (file) {
    if (!file)return;

    if (file.constructor === String) {
      Pathfinder.test_picture.setAttribute('src',file);
    } else {
      var reader = new FileReader();
      reader.onload = function (e) {
        this.test_picture.setAttribute('src', e.target.result);
      }.bind(this);
      reader.readAsDataURL(file);
    }
  },
  initCanvas: function (cvs) {
    var img = this.editedImageCanvas;
    if(this.resultCanvas){
      $(this.resultCanvas).remove()
    }
    this.resultCanvas = cvs;
    this.createSelectionDrawCanvas();


    this.context = cvs.getContext('2d');
    cvs.width = img.width;
    cvs.height = img.height;
    //this.setImage(img);
  },
  setImage: function (img) {
    this._test_todo_img = img;
    //this.mask = null;//MagicWand.createMask(img.width,img.height);
    this.editedImageCanvas = fabric.util.createCanvasElement();
    this.editedImageCanvas.width = img.width;
    this.editedImageCanvas.height = img.height;
    this.editedImageCanvas.getContext('2d').drawImage(img, 0, 0);
    this.initCanvas(fabric.util.createCanvasElement())
  },
  getInfo: function () {

    var ctx = this.editedImageCanvas.getContext('2d');
    var imageInfo = ctx.getImageData(0, 0, this.editedImageCanvas.width, this.editedImageCanvas.height);
    imageInfo.bytes = 4;
    return imageInfo;
  },
  getMousePosition: function (e) {
    var scale = this.resultCanvas.width / $(this.resultCanvas).width();
    var target = e.target || e.srcElement,
      rect = target.getBoundingClientRect(),
      offsetX = e.clientX - rect.left,
      offsetY = e.clientY - rect.top;
    return {x: Math.round(offsetX * scale), y: Math.round(offsetY * scale)};
  },
  radius: 20,
  resetSelectionDrawCanvas: function () {
    this.selectionDrawContext.fillStyle = "black";
    //this.selectionDrawContext(0, 0, canvas.width, canvas.height);
    this.selectionDrawContext.fillRect(0,0,this.selectionDrawCanvas.width,this.selectionDrawCanvas.height);
    this.selectionDrawContext.fillStyle = "white";
    this.selectionDrawContext.strokeStyle = "white";
  },
  createSelectionDrawCanvas: function () {

    if(this.selectionDrawCanvas ){
      $(this.selectionDrawCanvas ).remove();
    }
    this.selectionDrawCanvas = fabric.util.createCanvasElement();
    this.selectionDrawCanvas.width  = this.resultCanvas.width;
    this.selectionDrawCanvas.height = this.resultCanvas.height;
    this.selectionDrawContext = this.selectionDrawCanvas.getContext("2d");
    this.resetSelectionDrawCanvas();
  },
  _onMouseDown: function (point) {
    point.x = Math.min(Math.max(0, parseInt(point.x)), this.resultCanvas.width - 1);
    point.y = Math.min(Math.max(0, parseInt(point.y)), this.resultCanvas.height - 1);
    this.allowDraw = true;
    this.tools[this.selectionTool].mouseDown.call(this,point);
  },
  onMouseDown: function (e) {
    e.preventDefault();
    e.stopPropagation();
    this._onMouseDown(this.getMousePosition(e));

  },
  _onMouseMove: function (p) {
    p.x = Math.min(Math.max(0, parseInt(p.x)), this.resultCanvas.width - 1);
    p.y = Math.min(Math.max(0, parseInt(p.y)), this.resultCanvas.height - 1);
    this.tools[this.selectionTool].mouseMove.call(this,p);
  },
  onMouseMove: function (e) {
    var p = this.getMousePosition(e);
    this._onMouseMove(p);
  },
  color: [255, 0, 0, 255],
  onMouseUp: function (e) {
    this.allowDraw = false;
    this.tools[this.selectionTool].mouseUp.call(this,e);
  },
  applyMask: function (canvas, left, top) {
    if (canvas.width === 0 || canvas.height === 0) {
      delete this.mask;
      this.render();
      return;
    }
    var info = this.getInfo(),
      mask = MagicWand.maskSelection(canvas,left,top) ;

    this.mask = mask;
    this.fire('selection:changed', {mask: mask, target: this.target});
  },
  setPathfinderMode: function (value) {
    this.pathfinderMode = value;
  },
  getPathfinderMode: function () {
    return this.pathfinderMode;
  },
  modifySelection: function (mask, pathfinderMode, noEvents) {
    this.shouldModify = false;
    if(this.selectionObject){
      this.selectionObject.remove();
    }
    this.downPoint = false;
    if (mask === undefined) {
      mask = this.mask;
    }
    if (pathfinderMode === undefined) {
      pathfinderMode = this.pathfinderMode;
    }
    if (pathfinderMode !== 'new' && this.oldMask) {
      mask = MagicWand[pathfinderMode](mask, this.oldMask);
    }
    if (this.blurRadius) {
      mask = MagicWand.gaussBlurOnlyBorder(mask, this.blurRadius);
    }
    //if (pathfinderMode !== 'new' && this.oldMask || this.blurRadius) {
    //  mask.cacheInd = MagicWand.getBorderIndices(mask);
    //}

    if(mask && mask.count && this.keepOldSelection){
      mask.makeCache();
      this.oldMask = mask;
    }else{
      delete this.oldMask ;
    }


    this.mask = MagicWand.createMask(this.editedImageCanvas.width, this.editedImageCanvas.height);
    if (!noEvents) {
      this.fire('selection:changed', {mask: mask, target: this.target});
    }
    this.render();
  },
  createSelection: function (mask) {
    if (this.shouldModify) {
      this.modifySelection();
    }

    this.mask = mask || MagicWand.createMask(this.editedImageCanvas.width, this.editedImageCanvas.height);
    this.render();
  },
  setSelection: function (mask) {
    this.mask = mask;
    this.render();
    this.fire('selection:changed', {mask: mask, target: this.target});
  },
  fill: function (color, callback) {
    this.asyncronous(function () {
      this._fill(color, false);
      callback && callback.call(this);
    }.bind(this), 0);
  },
  _fill: function (color, invert, canvas) {


    if (!this.mask) return;


    canvas = canvas || this.editedImageCanvas;
    var ctx = canvas.getContext('2d');//b.minX, b.minY, b.maxX - b.minX, b.maxY - b.minY);

    MagicWand.fillMask(ctx, this.mask, color);

    this.fire('image:changed', this.editedImageCanvas);
  },
  hatchTick: function () {
    this.hatchOffset = (this.hatchOffset + 1) % (this.hatchLength * 2);
    this.render(true);
  },
  show: function () {
    while (this.container.lastChild) {
      this.container.removeChild(this.container.lastChild);
    }
    this.container.appendChild(this.editedImageCanvas);
    this.container.appendChild(this.resultCanvas);
    this.interval = setInterval(this.hatchTick.bind(this), 300);

    this.fire('show');
  },
  clear: function (invert, canvas, callback) {
    this.asyncronous(function () {
      this._fill([0, 0, 0, 0], invert, canvas);
      callback && callback.call(this);
    }.bind(this), 0);
  },
  render: function (noBorder) {
    if (!this.context || !this.mask)return;

    var ctx = this.context;
    if (!noBorder) {
      this.mask.cacheInd = MagicWand.getBorderIndices(this.mask);
    }
    ctx.clearRect(0, 0, this.mask.width, this.mask.height);

    var _new_color = (!this.oldMask || this.pathfinderMode == "new" || this.pathfinderMode == "add"|| this.pathfinderMode == "exclude")
      ? this.newMaskColor : this.removedMaskColor;

    var _intersection_color;
    if(this.pathfinderMode == "add" || this.pathfinderMode == "new"|| this.pathfinderMode == "intersect"){
      _intersection_color = this.newMaskColor;
    }else{
      _intersection_color = this.removedMaskColor ;//intersectionRemovedMaskColor;
    }
    var _old_color;
    if(this.pathfinderMode == "exclude" || this.pathfinderMode == "substract"|| this.pathfinderMode == "add"){
      _old_color = this.newMaskColor;
    }else{
      _old_color = this.removedMaskColor;
    }

    this.oldMask && this.oldMask.render(ctx,{
      fill: _old_color
    });


    this.mask.render(ctx,{
      fill: _new_color,
      intersectionColor : _intersection_color,
      outerIntersectionColor : _old_color,
      // outerFill : "rgba(0,0,0,0.5)"
    });

    if(this.renderBorder){
      this.oldMask && this.oldMask.renderBorder(ctx,{});

      this.mask.renderBorder(ctx,{
        hatchOffset: this.hatchOffset
      });
    }

  },
  renderBorder: true,
  intersectionRemovedMaskColor: '#ffaaaa',
  removedMaskColor: '#aaaaff',
  newMaskColor:  '#aaFFaa' ,
  renderMask: function (ctx, mask, color, left, top) {
    mask = mask || this.mask;
    mask && mask.render(ctx,{
      intersectionColor: '#fff',
      outerIntersectionColor: '#000',
      fill :color || '#fff',
      left : left,
      top : top
    })
  },
  getContours: function () {
    if (!this.__cs) {
      this.__cs = MagicWand.traceContours(this.mask);
      this.__cs = MagicWand.simplifyContours(this.__cs, this.simplifyTolerant, this.simplifyCount);
    }
    return this.__cs;
  },
  traceInner: function (ctx) {

    var cs = this.getContours();
    var ctx = ctx || this.context;
    ctx.beginPath();
    for (var i = 0; i < cs.length; i++) {
      if (!cs[i].inner) continue;
      var ps = cs[i].points;
      ctx.moveTo(ps[0].x, ps[0].y);
      for (var j = 1; j < ps.length; j++) {
        ctx.lineTo(ps[j].x, ps[j].y);
      }
    }
    ctx.stroke();
  },
  getColor: function () {
    return 'rgba(' + this.color.join(', ') + ')';
  },
  setColor: function (color) {
    var _arr = color.substring(color.indexOf('(') + 1, color.length - 1).split(', ');
    for (var i in _arr) {
      _arr[i] = parseFloat(_arr[i]);
    }
    _arr[3] = Math.round(_arr[3] * 255);
    this.color = _arr;
  },
  trace: function (ctx) {
    var info = this.getInfo();
    var cs = MagicWand.traceContours(this.mask);
    cs = MagicWand.simplifyContours(cs, this.simplifyTolerant, this.simplifyCount);

    // draw contours
    var ctx = ctx || this.context;
    ctx.clearRect(0, 0, info.width, info.height);
    //inner
    ctx.beginPath();
    for (var i = 0; i < cs.length; i++) {
      if (!cs[i].inner) continue;
      var ps = cs[i].points;
      ctx.moveTo(ps[0].x, ps[0].y);
      for (var j = 1; j < ps.length; j++) {
        ctx.lineTo(ps[j].x, ps[j].y);
      }
    }
    ctx.strokeStyle = 'red';
    ctx.stroke();
    //outer
    ctx.beginPath();
    for (var i = 0; i < cs.length; i++) {
      if (cs[i].inner) continue;
      var ps = cs[i].points;
      ctx.moveTo(ps[0].x, ps[0].y);
      for (var j = 1; j < ps.length; j++) {
        ctx.lineTo(ps[j].x, ps[j].y);
      }
    }
    ctx.strokeStyle = 'blue';
    ctx.stroke();
  },
  removeNoise: function (threshold) {

    if(!this.mask || !this.mask.count)return;
    this.createSelectionDrawCanvas();
    //this.renderMask(this.selectionDrawContext, this.mask);

    var cs = MagicWand.traceContours(this.mask);
    cs = MagicWand.simplifyContours(cs, this.simplifyTolerant, this.simplifyCount);

    var ctx = this.selectionDrawContext, v = this.canvas.viewportTransform;

    //  cs = MagicWand.simplifyContours(cs, this.simplifyTolerant, this.simplifyCount);

    ctx.save();
    ctx.translate(0.5,0.5);
    ctx.fillStyle= "#fff";
    //ctx.fillStyle= "#0f0";
    ctx.strokeStyle= "#fff";
    for (var i = 0; i < cs.length; i++) {
      if (!cs[i].inner && cs[i].points.length > threshold) {
        var ps = cs[i].points;
        ctx.beginPath();
        ctx.moveTo(ps[0].x, ps[0].y);
        for (var j = 1; j < ps.length; j++) {
          ctx.lineTo(ps[j].x, ps[j].y);
        }
        ctx.closePath();
        ctx.fill();
      }

    }
    this.mask = MagicWand.maskSelection( this.selectionDrawCanvas);
    this.setSelection(this.mask);

    ctx.restore();
  }
};

fabric.util.observable(Pathfinder.prototype);

fabric.util.object.extend(Pathfinder.prototype, {
  selectBackground: function (fromCorners) {
    var info = this.getInfo(), mask;

    if (fromCorners) {
      var mask1 = MagicWand.selectBackground(info, [255, 255, 255, false], this.colorThreshold);
      var mask2 = MagicWand.selectBackground(info, [false, false, false, 0], this.colorThreshold);
      mask = MagicWand.add(mask1, mask2);
    } else {
      mask = MagicWand.selectAllByColor(info, [255, 255, 255, 255], this.colorThreshold);
    }

    if (this.blurRadius) {
      mask = MagicWand.gaussBlurOnlyBorder(mask, this.blurRadius);
    }
    this.setSelection(mask);
  },
  colorSelection: function (colors, threshold) {
    var info = this.getInfo(), mask2,
      mask = MagicWand.createMask(info.width, info.height);
    for (var i in colors) {
      var _color = new fabric.Color(colors[i])._source;
      _color[3] = Math.round(_color[3] * 255);
      mask2 = MagicWand.selectAllByColor(info, _color, threshold[i])
      mask = MagicWand.add(mask, mask2);
    }
    delete this.oldMask;
    this.modifySelection(mask);
  },
  smartSelection: function (threshold) {
    var info = this.getInfo(), mask;
    mask = MagicWand.selectBackground(info, null, threshold || this.colorThreshold);
    mask = MagicWand.invertMask(mask);
    delete this.oldMask;
    this.modifySelection(mask);
  }
});


Pathfinder.prototype.tools = {

  brush: {
    mouseUp: function(){
      this.modifySelection();
      this.resetSelectionDrawCanvas();
    },
    mouseMove: function(p){
      if (!this.allowDraw) return;
      this.drawCircle(p.x, p.y, this.radius);
    },
    mouseDown: function(point){
      this.createSelection();
      this.downPoint = point;
      this.createSelectionDrawCanvas();
      this.drawCircle(point.x, point.y, this.radius);
    },
    utils: {
      drawCircle: function (x, y, r) {
        var ctx = this.selectionDrawContext,
          v = this.canvas.viewportTransform;
        ctx.save();
        //  ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);
        ctx.beginPath();
        ctx.arc(x, y, this.radius, 0, Math.PI * 2, false);
        ctx.closePath();
        ctx.fill();
        ctx.restore();
        MagicWand.maskSelection( this.selectionDrawCanvas, 0,0, this.mask, 'add');
        this.setSelection(this.mask);
      }
    }
  },
  magic: {
    mouseUp: function(){
      this.shouldModify = true;
    },
    mouseMove: function (p){
      if (!this.allowDraw) return;
      var dist = p.x - this.downPoint.x;

      var val = this._init_thres + dist;
      var thres = Math.min(Math.max(val, 1), 255);
      if (thres != this.colorThreshold) {
        this.setThreshold(thres);
      }
    },
    mouseDown: function (point){
      if (this.shouldModify) {
        this.modifySelection();
      }
      this.downPoint = point;
      this.colorThreshold = 15;
      this.fire('threshold:changed', {threshold: this.colorThreshold});
      this._init_thres = this.colorThreshold;
      this.drawMask(this.downPoint.x, this.downPoint.y, this.adjacentPixels);
      return false;
    },
    utils:{
      drawMask: function (x, y, adjacentPixels) {
        this.asyncronous(this._drawMask.bind(this, x, y, adjacentPixels), 0);
      },
      _drawMask: function (x, y, adjacentPixels) {
        MagicWand.alphaChannel = this.alphaChannel;
        var info = this.getInfo(), mask;
        if (adjacentPixels) {
          MagicWand.floodFill(info, x, y, this.colorThreshold,{},null,function(mask){
            this.setSelection(mask);
          }.bind(this));
        } else {
          mask = MagicWand.selectAll(info, x, y, this.colorThreshold);
          this.setSelection(mask);
        }
      }
    }
  },
  rectangle: {
    mouseDown: function(point) {
      if (this.shouldModify) {
        this.modifySelection();
      }
      this.downPoint = point;
      this.shouldModify = true;
    },
    mouseUp: function(){
      //this.modifySelection();
      //this.resetSelectionDrawCanvas();
    },
    mouseMove: function(p){
      if (!this.allowDraw) return;
      this.drawRectangle(this.downPoint.x, this.downPoint.y, p.x, p.y);
    },
    utils:{
      drawRectangle: function (x, y, x2, y2) {
        var info = this.getInfo(),
          mask = MagicWand.selectRectangle(info, x, y, x2, y2);
        this.setSelection(mask);
      }
    }
  },
  circle: {
    mouseDown: function(point) {
      if (this.shouldModify) {
        this.modifySelection();
      }
      this.downPoint = point;
      this.createSelectionDrawCanvas();
      this.selectionObject = new fabric.Ellipse({
        left: point.x + this.target.left,
        top:  point.y + this.target.top,
        rx:1,
        ry:1,
        hasBorders: false,
        originX: 'center',
        originY: 'center',
        strokeWidth: 1,
        fill: 'transparent',
        stroke: 'transparent'
      });
      this.canvas.add(this.selectionObject);
      this.updateShape();
    },
    mouseUp: function(){
      this.canvas.setInteractiveMode("mixed");
      this.selectionObject.setCoords();
      var _this = this;
      this.selectionObject.on('scaling moving rotating',function(){
        _this.updateShape();
      });
      this.canvas.setActiveObject(this.selectionObject);
      this.shouldModify = true;
      //  this.modifySelection();
      //  this.resetSelectionDrawCanvas();
    },
    mouseMove: function(p){
      if (!this.allowDraw) return;
      this.selectionObject.set({
        rx: Math.abs((p.x + this.target.left -  this.selectionObject.get('left'))) ,
        ry: Math.abs((p.y + this.target.top  - this.selectionObject.get('top')))
      });

      this.updateShape();

    },
    utils:{
      updateShape: function () {
        this.resetSelectionDrawCanvas();
        this.selectionObject.fill = 'white';
        this.selectionDrawContext.save();
        this.selectionDrawContext.translate(-this.target.left, - this.target.top);
        this.selectionObject.render(this.selectionDrawContext);
        this.selectionDrawContext.restore();
        this.selectionObject.fill = 'transparent';
        this.mask = MagicWand.maskSelection( this.selectionDrawCanvas);
        this.setSelection(this.mask);
      }
    }
  },
  lasso: {
    mouseUp: function(){
      if(this.readyToClosePath) {
        this._closePath();
      }
    },
    mouseMove: function(p){
      if (!this.allowDraw) return;
      this.drawLine(this._last_point, p)
      this._points.push(p);
      this._last_point = p;
    },
    mouseDown: function(point){
      if(!this.downPoint){
        this.createSelection();
        this.createSelectionDrawCanvas();
        this._path_out = false;
        this.downPoint = point;
        this._points = [];
        this.selectionDrawContext.beginPath();
        this.canvas.on('mouse:move', this._changeCursorOverClosePoint);
      }
      if(this._last_point){
        if(this.readyToClosePath){
          this._closePath();
        }else{
          this.drawLine(this._last_point, point)
          this._last_point = point;
          this._points.push(point);
        }
      }else{

        this.drawLine({x:point.x - 0.5,y: point.y}, {x:point.x + 0.5,y: point.y })
        this._last_point = {x:point.x + 0.5,y: point.y };
        this._points.push(point);
        this.shouldModify = true;
      }
    },
    utils: {
      drawLine: function (p1 ,p2 ) {
        var ctx = this.selectionDrawContext,
          v = this.canvas.viewportTransform;
        ctx.save();
        //ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);
        ctx.moveTo(p1.x,p1.y);
        ctx.lineTo(p2.x,p2.y);
        ctx.stroke();
        ctx.restore();
        MagicWand.maskSelection(this.selectionDrawCanvas,0,0,this.mask,'add');
        this.setSelection(this.mask);
      },
      _closePath:  function (e) {

        this.allowDraw = false;
        var ctx = this.selectionDrawContext;
        ctx.beginPath();
        ctx.moveTo(this._points[0].x,this._points[0].y)
        for(var i = 1 ; i < this._points.length;i ++){
          ctx.lineTo(this._points[i].x,this._points[i].y)
        }
        ctx.closePath();
        ctx.fill();
        MagicWand.maskSelection(this.selectionDrawCanvas,0,0,this.mask,'add');
        this.setSelection(this.mask);
        this.resetSelectionDrawCanvas();
        this._points = [];
        delete this.downPoint;
        delete this.readyToClosePath;
        delete this._last_point;
        this.canvas.off('mouse:move', this._changeCursorOverClosePoint);
        this.canvas.freeDrawingCursor = 'crosshair';
        this.canvas.setCursor(this.canvas.freeDrawingCursor);
        // this.drawLine(this._last_point, this.downPoint);
      },
      _changeCursorOverClosePoint:  function (e) {
        var canvas = this,
          pathfinder = canvas.pathfinder;
        if(!pathfinder.target)return;
        var ivt = fabric.util.invertTransform(canvas.viewportTransform),
          p = fabric.util.transformPoint(canvas.getPointer(e.e, true), ivt);
        p.x -= pathfinder.target.left;
        p.y -= pathfinder.target.top;
        if ( pathfinder.downPoint && pathfinder.downPoint.distanceFrom(p) < 10) {
          if(!pathfinder._path_out){
            return;
          }
          pathfinder.readyToClosePath = true;
          canvas.freeDrawingCursor = canvas.targetCursor;
          canvas.setCursor(canvas.freeDrawingCursor);
          //console.log(canvas.freeDrawingCursor);
        } else {
          pathfinder._path_out = true;
          pathfinder.readyToClosePath = false;
          canvas.freeDrawingCursor = 'crosshair';
          canvas.setCursor(canvas.freeDrawingCursor);
          // console.log(canvas.freeDrawingCursor);
        }
      }
    }
  }
};
for(var i in Pathfinder.prototype.tools){
  fabric.util.object.extend(Pathfinder.prototype, Pathfinder.prototype.tools[i].utils)
}
fabric.Pathfinder = Pathfinder;




var _FIL = fabric.Pathfinder.prototype;
_FIL.actions = {

  cancelSelection: {
    visible: false,
    key:  'Escape',
    action: function(){
      delete this.shouldModify;
      this.mask = MagicWand.createMask(this.editedImageCanvas.width, this.editedImageCanvas.height);
    }
  },
  modifySelection: {
    visible: false,
    key:  'Enter',
    action: function(){
      if(this.shouldModify){
        this.modifySelection();
      }
    }
  },
  adjacentPixels: {
    className: 'button-adjacent',
    title: 'selet all',
    type: 'checkbox',
    value: 'adjacentPixels',
    visible: function () {
      return this.selectionTool === 'magic';
    },
    observe: 'tool:changed'
  },
  pathfinderRadius: {
    title: 'radius',
    type: 'range',
    value: {
      get: function () {
        return this.radius
      },
      set: function (val) {
        this.radius = val;
      },
      min: 1,
      max: 255
    },
    visible: function () {
      return this.selectionTool === 'brush';
    },
    observe: 'tool:changed'
  },
  pathfinderThreshold: {
    title: 'Threshold',
    type: 'range',
    value: {
      observe: 'threshold:changed',
      get: function () {
        return this.colorThreshold
      },
      set: function (val) {
        this.setThreshold(val);
      },
      min: 0,
      max: 255
    },
    visible: function () {
      return this.selectionTool === 'magic';
    },
    observe: 'tool:changed'
  },
  selectionTool: {
    title: 'selection-tool',
    type: 'options',
    value: 'selectionTool',
    menu: {
      selectionToolBrush: {
        className: 'fa fa-paint-brush',
        title: 'select-brush',
        option: 'brush'
      },
      selectionToolRectangle: {
        className: 'fa fa-square',
        title: 'select-rectangle',
        option: 'rectangle'
      },
      selectionElliptical: {
        className: 'fa fa-circle',
        title: 'select-circle',
        option: 'circle'
      },
      selectionToolMagic: {
        className: 'fa fa-magic',
        title: 'select-magic',
        option: 'magic'
      },
      selectionToolLasso: {
        use: 'shapeSelectionTools',
        title: 'select-lasso',
        option: 'lasso',
        icon: 'data:image/svg+xml;base64,'+ __webpack_require__(20)

      }
    }
  },
  pathfinder: {
    title: 'pathfinder',
    type: 'options',
    insert: 'pathfinderTools',
    value: 'pathfinderMode',
    menu: {
      pathfinderNew: {
        title: 'pathfinder-new',
        option: 'new'
      },
      pathfinderExclude: {
        title: 'pathfinder-exclude',
        option: 'exclude'
      },
      pathfinderSubstract: {
        title: 'pathfinder-substract',
        option: 'substract'
      },
      pathfinderAdd: {
        title: 'pathfinder-add',
        option: 'add'
      },
      pathfinderIntersect: {
        title: 'pathfinder-intersect',
        option: 'intersect'
      }
    }
  },
  pathfinderFill: {
    insert: 'drawingTools',
    title: 'fillWithCurrentColor',
    action: _FIL.fillWithCurrentColor,
    className: 'fa fa-paint-brush'
  },
  pathfinderClear: {
    insert: 'drawingTools',
    className: 'fa fa-eraser',
    id:     'Pathfinder-clear',
    title:  'clear',
    action: _FIL.clear
  },
  pathfinderColor: {
    insert: 'drawingTools',
    title:  'color',
    type:   'color',
    value:  'color'
  }
};

fabric.util.object.extend(fabric.SlideCanvas.prototype, {
  specialProperties: fabric.SlideCanvas.prototype.specialProperties.concat(["pathfinder"]),
  pathfinder: false,
  setPathfinder: function (val) {
    if (val) {
      this.pathfinder = new fabric.Pathfinder('pathfinder');
      this.pathfinder.canvas = this;
    }
  },
  getPathfinder: function () {
    return this.pathfinder || this.application && this.application.pathfinder;
  }
});

fabric.util.object.extend(fabric.Application.prototype, {
  initPathfinder: function () {
    if(this.pathfinder){

      this.pathfinder = new fabric.Pathfinder({
        application: this
      });

      this.pathfinder.on("image:changed", function (img) {
        var dataUrl = img.toDataURL();
        if (!this.target._originalElement) {
          this.target._originalElement = this.target._element;
        }
        this.target._element = new Image();
        this.target._element.src = dataUrl;
        this.target._edited = true;
        this.target.canvas && this.target.canvas.renderAll();
        this.target.fire("content:modified");
      });
    }

  }
});

fabric.Application
  .addPlugin("postloaders","initPathfinder");

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 78 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {


var _set_sbackground_image_overwritten = fabric.Canvas.prototype.setBackgroundImage;

fabric.util.object.extend(fabric.Canvas.prototype, {
  /**
   * backgroundPosition
   * @values manual | cover | fit
   */
  backgroundPosition: 'manual',
  setBackgroundPosition: function (src) {
    this.backgroundPosition = src;
    this._update_background_image();
    return this;
  },
  offsets: {
    left: 0,
    right: 0,
    bottom: 0,
    top: 0
  },

  // setBackgroundImage: function (src, callback, options) {
  //
  //   _set_sbackground_image_overwritten.call(this, src, function () {
  //     this._update_background_image();
  //     callback && callback(this.backgroundImage);
  //   }.bind(this), options);
  //   return this;
  // },
  fillBackgroundColorOverCanvas: false,
  _renderBackgroundOrOverlay: function(ctx, property) {
    var object = this[property + 'Color'];
    if (object) {
      ctx.fillStyle = object.toLive
        ? object.toLive(ctx)
        : object;

      if(this.fillBackgroundColorOverCanvas){
        ctx.fillRect(
          object.offsetX || -this.viewportTransform[4]/ this.viewportTransform[0],
          object.offsetY || -this.viewportTransform[5]/ this.viewportTransform[0],
          this.width / this.viewportTransform[0],
          this.height  / this.viewportTransform[0]);
      }else{
        ctx.fillRect(
          object.offsetX || 0,
          object.offsetY || 0,
          this.originalWidth ,
          this.originalHeight);
      }
    }
    object = this[property + 'Image'];
    if(object && object.constructor !== String &&  object.constructor !== Object){
        object.render(ctx);
    }
  },
  getImageData: function (options) {
    options = fabric.util.object.extend({
      clipped_area: false,
      clipped_area_only: false,
      draw_background: true,
      format: 'png',
      quality: 0.8
    }, options || {});

    var size;
    if (options.clipped_area) {
      size = options.clipped_area.getBoundingRect();
      var _zoom = this.getZoom();
      size.left   /= _zoom;
      size.top    /= _zoom;
      size.width  /= _zoom;
      size.height /= _zoom;
      fabric.util.object.extend(options, size);
    } else {
      size = {
        width: options.width || this.originalWidth || this.width,
        height: options.height || this.originalHeight || this.height,
      };

      if (options.clipped_area_only) {
        size.width -= this.offsets.left + this.offsets.right;
        size.height -= this.offsets.top + this.offsets.bottom;
      }
    }
    if (options.zoom) {
      size.width *= options.zoom;
      size.height *= options.zoom;
    }

    var canvas = fabric.util.createCanvasElement();
    canvas.width = size.width;
    canvas.height = size.height;

    options.left = Math.floor(options.left);
    options.top = Math.floor(options.top);
    options.height = Math.ceil(options.height);
    options.width = Math.ceil(options.width);

    this.renderThumb(canvas, options);

    var src = canvas.toDataURL(options);

    var blob = fabric.util.dataURItoBlob(src, 'image/' + options.format);
    var objectURL = URL.createObjectURL(blob);
    return {
      dataURL: src,
      blob: blob,
      url: objectURL,
      canvas: canvas
    };
  },
  getOriginalSize: function () {
    return {
      width: this.originalWidth,
      height: this.originalHeight
    }
  },

  renderThumb: function (canvas, options) {

    options = options || {
        objects: true,
        clipped_area_only: false,
        draw_background: true
      };

    if (options.zoom) {
      var _zoom = options.zoom;
    } else {
      if (canvas.width) {
        var _zoom = canvas.width / (this.originalWidth || this.width)
      } else {
        var _zoom = 1;
      }
    }
    var _old_Scale = this.viewportTransform[0];
    var old_x = this.viewportTransform[4];
    var old_y = this.viewportTransform[5];
    this.viewportTransform[4] = this.viewportTransform[5] = 0;
    this.viewportTransform[0] = this.viewportTransform[3] = 1;

    this.viewportTransform[0] = this.viewportTransform[3] = _zoom;
    //this._update_clip_rect();

    if (this.clipRect) {
      this.clipRect.setOpacity(0);
    }

    var size = {
      width: this.originalWidth || this.width,
      height: this.originalHeight || this.height
    };
    size.width = Math.ceil(size.width * _zoom);
    size.height = Math.ceil(size.height * _zoom);

    var _canvas = fabric.util.createCanvasElement();
    _canvas.width = size.width;
    _canvas.height = size.height;

    var canvasToDrawOn = _canvas.getContext('2d'), objsToRender;

    this.clearContext(canvasToDrawOn);
    canvasToDrawOn.save();
    canvasToDrawOn.transform.apply(canvasToDrawOn, this.viewportTransform);

    if (options.draw_background) {
      this._renderBackground(canvasToDrawOn);
      //if (this._backgroundLayer) {
      //  this._renderObjects(canvasToDrawOn, this._backgroundLayer);
      //}
    }

    if (!options.clipped_area_only && this.clipTo) {
      fabric.util.clipContext(this, canvasToDrawOn);
    }

    var _objects;
    if (options.objects && options.objects.constructor === Array) {
      _objects = options.objects;
    } else {
      _objects = options.objects !== false ? this._objects : [];
    }
    if (options.clipped_area) {
      _objects = fabric.util.object.clone(_objects);
      for (var i = _objects.length; i--;) {
        if (_objects[i].clipTo !== options.clipped_area) {
          _objects.splice(i, 1);
        }
      }
    }
    // if (fabric.version >= 1.6) {
      this._renderObjects(canvasToDrawOn, _objects);
    // } else {
    //   for (var i = 0, length = _objects.length; i < length; ++i) {
    //     this._draw(canvasToDrawOn, _objects[i]);
    //   }
    // }


    canvasToDrawOn.restore();
    if (!options.clipped_area_only && this.clipTo) {
      canvasToDrawOn.restore();
    }
    this._renderOverlay(canvasToDrawOn);
    canvasToDrawOn.restore();
    if (this.clipRect) {
      this.clipRect.setOpacity(1);
    }
    var ctx = canvas.getContext('2d');
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    if (options.clipped_area_only && this.clipRect) {
      var _rect = {
        left: this.clipRect.left * _zoom,
        top: this.clipRect.top * _zoom,
        width: this.clipRect.width * _zoom,
        height: this.clipRect.height * _zoom
      };
    } else {
      var _rect = {
        left: options.left * _zoom || 0,
        top: options.top * _zoom || 0,
        width: options.width * _zoom || size.width,
        height: options.height * _zoom || size.height
      };
    }
    if (options.angle) {
      ctx.rotate(-options.angle * Math.PI / 180);
      ctx.drawImage(_canvas,
        0, 0, _rect.width + _rect.left + _canvas.width, _rect.height + _rect.top + _canvas.height,
        -_rect.left, -_rect.top, canvas.width + _rect.left + _canvas.width, canvas.height + _rect.top + _canvas.height);
    } else {
      ctx.drawImage(_canvas, _rect.left, _rect.top, _rect.width, _rect.height, 0, 0, canvas.width, canvas.height);
    }

    this.viewportTransform[0] = this.viewportTransform[3] = _old_Scale;
    // this._update_background_image();
    //this._update_clip_rect();

    this.viewportTransform[4] = old_x;
    this.viewportTransform[5] = old_y;


    return canvas;
  },

  // setOffsets: function (_offsets) {
  //   this.offsets = _offsets || fabric.util.object.extend({}, fabric.SlideCanvas.prototype.offsets);
  //   //this._update_clip_rect();
  //   return this;
  // },
  getRect: function (options) {


    var rect = {};

    var _w = this.originalWidth || this.width; //this.originalWidth
    var _flexArray = fabric.util.flex(_w , [{value: options.left, flex: 0},{value: options.width, flex: 1},{value: options.right, flex: 0}] );
    rect.left = _flexArray[0];
    rect.width = _flexArray[1];
    rect.right = _flexArray[2];

    var _h = this.originalHeight|| this.height;   //this.originalHeight
    var _flexArray = fabric.util.flex(_h , [{value: options.top, flex: 0},{value: options.height, flex: 1},{value: options.bottom, flex: 0}] );
    rect.top = _flexArray[0];
    rect.height = _flexArray[1];
    rect.bottom = _flexArray[2];

    return rect;
  },
});

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 79 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {


var _set_object_scale_overwritten = fabric.Canvas.prototype._setObjectScale;
var _setup_current_transform = fabric.Canvas.prototype._setupCurrentTransform;

fabric.util.object.extend(fabric.Canvas.prototype, {
  _setupCurrentScaleTransform: _setup_current_transform,
  _setupCurrentTransform: function (e, target) {
    if (!target)return;
    if (target.setupCurrentTransform) {
      return target.setupCurrentTransform(e);
    } else {
      if (target.resizable) {
        return this._setupCurrentResizeTransform(e, target);
      } else {
        return this._setupCurrentScaleTransform.call(this, e, target);
      }
    }
  },
  _setObjectScale: function (localMouse, transform, lockScalingX, lockScalingY, by, lockScalingFlip, _dim) {

    var t = transform.target;

    if (!_dim) {
      var strokeWidth = t.stroke ? t.strokeWidth : 0;
      _dim = {
        x: (t.width + (strokeWidth / 2)),
        y: (t.height + (strokeWidth / 2))
      }
    }

    if (t.setObjectScale) {
      return t.setObjectScale(localMouse, transform,
        lockScalingX, lockScalingY, by, lockScalingFlip, _dim);
    }
    else {
      if (t.resizable) {
        return this._setObjectSize(localMouse, transform,
          lockScalingX, lockScalingY, by, lockScalingFlip, _dim);
      } else {
        return _set_object_scale_overwritten.call(this, localMouse, transform,
          lockScalingX, lockScalingY, by, lockScalingFlip, _dim);
      }
    }
  },
  _setObjectSize: function (localMouse, transform, lockScalingX, lockScalingY, by, lockScalingFlip, _dim) {

    var target = transform.target, forbidScalingX = false, forbidScalingY = false;
    var _stroke = transform.target.strokeWidth || 0;
    transform.newWidth = this.width * ((localMouse.x / transform.scaleX) / (this.width + _stroke));
    transform.newHeight = this.height * ((localMouse.y / transform.scaleY) / (this.height + _stroke));

    if(this.wholeCoordinates || target.wholeCoordinates){
      transform.newWidth = Math.round(transform.newWidth);
      transform.newHeight = Math.round(transform.newHeight);
    }
    if(transform.newHeight < 0 ){
      target.top = transform.top - transform.newHeight;
    }
    if (target.minWidth && transform.newWidth <= target.minWidth) {
      transform.newWidth = target.minWidth;
    }
    if (target.minHeight && transform.newHeight <= target.minHeight) {
      transform.newHeight = target.minHeight;
    }
    if (lockScalingFlip && transform.newWidth < target.width) {
      forbidScalingX = true;
    }
    if (lockScalingFlip && transform.newHeight < target.height) {
      forbidScalingY = true;
    }

    if (by === 'equally') {
      forbidScalingX || forbidScalingY || this._resizeObjectEqually(localMouse, target, transform, _dim);
    }
    else if (!by) {
      forbidScalingX || target.setWidth(transform.newWidth);
      forbidScalingY || target.setHeight(transform.newHeight);
    }
    else if (by === 'x' && !target.get('lockUniScaling')) {
      forbidScalingX || target.setWidth(transform.newWidth);
    }
    else if (by === 'y' && !target.get('lockUniScaling')) {
      forbidScalingY || target.setHeight(transform.newHeight);
    }
    return !forbidScalingX && !forbidScalingY;
    //transform.newWidth -= _stroke;
    //transform.newHeight -= _stroke;
  },
  _setupCurrentResizeTransform: function (e, target) {
    this._setupCurrentScaleTransform(e, target);
    this._currentTransform.original.height = target.height;
    this._currentTransform.original.width = target.width;
  },
  _resizeObjectEqually: function (localMouse, target, transform, _dim) {

    var dist = localMouse.y + localMouse.x,
      lastDist = _dim.y * transform.original.height / target.height +
        _dim.x * transform.original.width / target.width;

    transform.newWidth = transform.original.width * dist / lastDist;
    transform.newHeight = transform.original.height * dist / lastDist;

    var ratio = transform.original.height / transform.original.width;
    if (ratio > 1) {
      if (target.minWidth && transform.newWidth <= target.minWidth) {
        transform.newWidth = target.minWidth;
        transform.newHeight = target.minHeight * ratio;
      }
    } else {
      if (target.minHeight && transform.newHeight <= target.minHeight) {
        transform.newHeight = target.minHeight;
        transform.newWidth = target.minWidth / ratio;
      }
    }

    target.setWidth(transform.newWidth);
    target.setHeight(transform.newHeight);
  }
});

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 80 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {


fabric.Guidline = fabric.util.createClass(fabric.Object,{
  top : 0,
  left : 0,
  height : 1,
  width : 1,
  griddable: false,
  responsiveBorders : true,
  groupSelectable : false,
  hasControls : false,
  hasBorders : false,
  wholeCoordinates : true,
  stored: false,
  movementLimits: "#__0",
  initialize: function(options){
    this.x = Math.round(options.x);
    this.y = Math.round(options.y);

    if(this.x){
      this.lockMovementY = true;
      this.hoverCursor = "ew-resize";
    }

    if(this.y){
      this.lockMovementX = true;
      this.hoverCursor = "ns-resize";
    }

    this.on({
      "removed": function () {
        var i = this.canvas.guidlines.indexOf(this);
        this.canvas.guidlines.splice(i,1)
      },
      "modified": function () {
        if(this.x){
          this.x = this.left + this.width / 2;
        }
        if(this.y){
          this.y = this.top + this.height / 2;
        }
      },
      "dblclick": function () {
        this.remove();
      },
      "added": function () {
        if (this.x) {
          this.height = this.canvas.height;
          this.width = Math.ceil(10 / this.canvas.viewportTransform[0]);
          if(this.width % 2){
            this.width++;
          }
          this.left = this.x - this.width /2;
        }
        if (this.y) {
          this.width = this.canvas.width;
          this.height = Math.ceil(10 / this.canvas.viewportTransform[0]);
          if(this.height % 2){
            this.height++;
          }
          this.top = this.y - this.height /2;
        }
        this.setCoords();
        if(this.canvas.guidlines){
          this.canvas.guidlines.push(this);
        }else{
          this.visible = false;
        }
      }
    });

  },
  render: function(ctx){
    ctx.save();

    ctx.beginPath();
    ctx.strokeStyle = "#000000";
    if(this.x){
      ctx.translate(this.left + this.width / 2,0);
      ctx.scale(1 / this.canvas.getZoom(), 1 / this.canvas.getZoom());
      ctx.moveTo(0,0);
      ctx.lineTo(0,this.canvas.height);
    }
    if(this.y) {
      ctx.translate(0, this.top + this.height / 2);
      ctx.scale(1 / this.canvas.getZoom(), 1 / this.canvas.getZoom());
      ctx.moveTo(0, 0);
      ctx.lineTo(this.canvas.width, 0);
    }
    ctx.stroke();
    ctx.restore();
  }
});

fabric.Ruler = fabric.util.createClass({
  initialize: function (options) {

    this.canvas =options.canvas;
    this.type = options.type;
    if(options.size)this.size = options.size;
    var size;
    if (options.type == "vertical") {
      size = {
        width: this.size,
        height: this.canvas.height
      };
    } else {
      size = {
        width: this.canvas.width,
        height: this.size
      };
    }

    this.canvasElement = fabric.util.createCanvasElementWithSize(size);
    this.canvas.wrapperEl.appendChild(this.canvasElement);
    this.rulerContext = this.canvasElement.getContext('2d');
    // this.rulerContext.translate(-0.5,-0.5);
    window.rulerContext = this.rulerContext;
    this.rulerContext.imageSmoothingEnabled = false;
    this.render();
    var _this = this;
    this.canvas.on({
      'viewport:scaled changed modified' : function(){
        _this.render();
      }
    })

  },
  size: 30,
  orientation: "revert",
  font: "10px Open Sans",
  delimeters: [50, 10, 5, 1],
  render: function () {


    var v = this.type == "vertical";
    var scale = this.canvas.getZoom();
    var _ctx = this.rulerContext;

    _ctx.mozImageSmoothingEnabled = false;

    _ctx.clearRect(0, 0, this.canvasElement.width, this.canvasElement.height);
    if(v) {
      this.canvasElement.height = this.canvas.height;
      _ctx.textAlign = 'end';
    }else{
      this.canvasElement.width = this.canvas.width;
    }

    var _this = this;
    function push(h){
      var _x = Math.round( l * scale);
      if(false){
        var x1 = 0;
        var x2 = h;
      }else{
        var x1 = _this.size;
        var x2 = _this.size - h;
      }
      if(v){
        _ctx.moveTo(x1,_x);
        _ctx.lineTo(x2, _x);
      } else{
        _ctx.moveTo(_x,x1);
        _ctx.lineTo(_x,x2);
      }
      _ctx.stroke();
    }
    var w = ( v ? this.canvas.height : this.canvas.width) / scale;
    var _del = [], _labels = [];
    var i = 0, j = 0, k = 0, l = 0, d = this.delimeters, m;

    for (i = 0; i < w / d[0]; i++) {
      k = 0;
      j = 0;
      l = i * d[0] + j * d[1] + k * d[2];
      if (l >= w)break;
      push(10);

      _ctx.font = this.font;
      if (v) {
        _ctx.strokeText(l,_this.size - 6,l * scale + 12);
      } else {
        _ctx.strokeText(l,l * scale + 2,_this.size - 8 );
      }

      if (scale > 1) {

        for (j = 0; j < d[0] / d[1]; j++) {
          k = 0;
          l = i * d[0] + j * d[1] + k * d[2];
          if (l >= w)break;
          push(7);


          if (scale > 2) {
            for (k = 0; k < d[1] / d[2]; k++) {
              l = i * d[0] + j * d[1] + k * d[2];
              if (l >= w)break;
              push(4);
            }


            if (scale > 5) {

              for (m = 0; m < d[2] / d[3]; m++) {
                for (k = 0; k < d[1] / d[2]; k++) {
                  l = i * d[0] + j * d[1] + k * d[2] + m * d[3];
                  if (l >= w)break;
                  push(2);
                }
              }

            }
          }

        }
      }
    }

    this._elements = _del;
    this._labels = _labels;
    _ctx.stroke();
  }
});

fabric.util.object.extend(fabric.SlideCanvas.prototype,{
  guidlinesEnabled: false,
  createGuidline: function(data){
    if(data.y !== undefined){
      if(fabric.Guidline.prototype.wholeCoordinates){
        data.y = data.y && Math.round(data.y);
      }
      if(!fabric.util.object.findWhere(this.guidlines,{y: data.y})){
        var gl = new fabric.Guidline({y: data.y});
        this.add(gl);
      }
    }else if(data.x !== undefined){
      if(fabric.Guidline.prototype.wholeCoordinates){
        data.x = data.x && Math.round(data.x);
      }
      if(!fabric.util.object.findWhere(this.guidlines,{x: data.x})){
        var gl = new fabric.Guidline({x: data.x});
        this.add(gl);
      }
    }
  },
  setGuidlines: function(guidlines){
    this.guidlines = guidlines;
    if(guidlines && this.guidlinesEnabled){
      // this.guidlines = [];
      for(var i in guidlines){
        this.createGuidline(guidlines[i])
      }
    }
  },
  createRulers: function(){
    this.vRuler = new fabric.Ruler({
      canvas: this,
      type: "vertical"
    });
    this.hRuler = new fabric.Ruler({
      canvas: this,
      type: "horizontal"
    });

    this.hRuler.canvasElement.style.position = "absolute";
    this.hRuler.canvasElement.style.left = 0;
    this.hRuler.canvasElement.style.bottom = "100%";
    this.vRuler.canvasElement.style.position = "absolute";
    this.vRuler.canvasElement.style.top = 0;
    this.vRuler.canvasElement.style.right = "100%";


    this.guidlines = [];


    var _canvas = this;

    this.on('viewport:scaled', function(){

      this.guidlines.forEach(function(gl){
        if(gl.x){
          gl.width = Math.ceil(10 / gl.canvas.viewportTransform[0]);
          if(gl.width % 2){
            gl.width++;
          }
          gl.left = gl.x - gl.width/2;
        }
        if(gl.y){
          gl.height = Math.ceil(10 / gl.canvas.viewportTransform[0]);
          if(gl.height % 2){
            gl.height++;
          }
          gl.top = gl.y - gl.height/2;
        }
      })
    });


    this.hRuler.canvasElement.onclick  = function(e){
      var pointer = _canvas.getPointer(e);
      _canvas.createGuidline({x : pointer.x })
    };


    this.vRuler.canvasElement.onclick  = function(e){
      var pointer = _canvas.getPointer(e);

      _canvas.createGuidline({y : pointer.y })
    };
  }
})


fabric.SlideCanvas.addPlugin("savers",function(propertiesToInclude, _data){
  if(propertiesToInclude.indexOf('guidlines') !== -1 && this.guidlines) {
    _data.guidlines = [];
    this.guidlines.forEach(function(_gl){
      if(_gl.x){
        _data.guidlines.push({x : _gl.x })
      }
      if(_gl.y){
        _data.guidlines.push({y : _gl.y })
      }
    })
  }
});

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 81 */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(fabric) {
fabric.saveAs  = __webpack_require__(109).saveAs;

fabric.util.object.extend(fabric.SlideCanvas.prototype, {
  insertRenderArea: false,
  insertRenderFull: false,
});


fabric.util.object.extend(fabric.SlideCanvas.prototype.actions, {
  renderArea: {
    className: 'fa fa-download',
    title: 'Render Area',
    action: function () {
      fabric.saveAs(this.getImageData({
        clipped_area: this.activeArea,
        zoom: this.dotsPerUnit,
        clipped_area_only: true,
        draw_background: false
      }).blob, this.title);
    }
  },
  renderFull: {
    title: 'Render full',
    action: function () {
      fabric.saveAs(this.getImageData({
        zoom: this.dotsPerUnit,
        clipped_area_only: false,
        draw_background: true
      }).blob, this.title);
    }
  }
});

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 82 */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(fabric) {fabric.util.styles = {
  styleSheetContains: function (f) {
    var hasstyle = false;
    var fullstylesheets = document.styleSheets;
    for (var sx = 0; sx < fullstylesheets.length; sx++) {
      try {
        var sheetclasses = fullstylesheets[sx].rules || document.styleSheets[sx].cssRules;
      } catch (e) {
        continue;
      }
      if (!sheetclasses)continue;
      for (var cx = 0; cx < sheetclasses.length; cx++) {
        if (sheetclasses[cx].selectorText == f) {
          hasstyle = true;
          break;
          //return classes[x].style;
        }
      }
    }
    return hasstyle;
  },
  linkCSS: function (filename) {
    var fileref = document.createElement("link")
    fileref.setAttribute("rel", "stylesheet")
    fileref.setAttribute("type", "text/css")
    fileref.setAttribute("href", filename)
    document.getElementsByTagName("head")[0].appendChild(fileref)
  }
};

fabric.Application.prototype.linkCSS = function () {
  for(var i in this.css){
    fabric.util.styles.linkCSS(this.css[i])
  }
  return true;
};

fabric.Application.addPlugin("postloaders","linkCSS");

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 83 */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(fabric) {fabric.util.createThumb = function(slide, $el){

  var _canvas = slide.canvas,
      firstDraw = true,
      modified,
      _w = +$el.getAttribute("width"),
      _h = +$el.getAttribute("height");

  if (_h) {
    $el.style.height = $el.height;
  }

  function renderThumb() {
    if (_canvas.processing || !_canvas.loaded) {
      return false;
    }
    _canvas.renderThumb($el);
    modified = _canvas.modified;
  }

  function forceRenderThumb() {
    if (this.canvas) {
      if (this.canvas.loaded) {
        this.canvas.renderThumb($el);
      }
      return;
    }
    if (firstDraw && this.data.thumb) {
      var img = new Image();
      img.onload = function () {
        var ctx = $el.getContext("2d");
        ctx.clearRect(0, 0, $el.width, $el.height);
        ctx.drawImage(img, 0, 0, $el.width, $el.height);
        modified = this.modified;
      };
      img.src = this.data.thumb;
      return;
    }

    if (attrs.force !== "true") return;
    var canvas = new fabric.SlideCanvas(null, this.data, function () {
      canvas.renderThumb($el);
      //modified = slide.modified;
    });
  }


  function scaleThumb() {

    var _container = {
      width: _w,
      height: _h,
    };

    var size = {
      width: slide.canvas.originalWidth || slide.canvas.width,
      height: slide.canvas.originalHeight || slide.canvas.height
    };

    var _fitSize = fabric.util.getProportions( size,_container,"fit");

    $el.width = _fitSize.width;
    $el.height = _fitSize.height;


    $el.style.width = _fitSize.width + 'px';
    $el.style.height = _fitSize.height  + 'px';
    renderThumb();
  }

  function canvasChanged() {
    // _canvas && _canvas.off('after:render', renderThumb);
    // if (this.canvas) {
      // _canvas = scope.ffThumb.canvas;
      this.canvas.on('after:render', renderThumb);
      this.canvas.on("dimensions:modified", scaleThumb);
      this.canvas.on("loading:end", scaleThumb);
    // }
  }


  $el.setAttribute("title", slide.title);
  slide.on('canvas:changed', canvasChanged);
  slide.on('modified', forceRenderThumb);

  scaleThumb.call(slide);
  forceRenderThumb.call(slide);
  canvasChanged.call(slide);

};

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 84 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

var Toolbar = __webpack_require__(3);


Toolbar.prototype.setFunctionCallback = function(target){
  if(target.canvas){
    return target.canvas.renderAll();
  }
  if(target.renderAll){
    return target.renderAll()
  }
};


fabric.util.object.extend(fabric.Application.prototype,{
  toolbar: false,
  createToolbars: function(){
    if(!this.toolbar){
      return;
    }

    if(this.toolbar.application) {
      new Toolbar(this, this.toolbar.application)
    }

    if(this.canvas && this.toolbar.canvas){
      new Toolbar(this.canvas, this.toolbar.canvas);
    }
    if(this.project &&  this.toolbar.project){
      new Toolbar(this.project, this.toolbar.project);
    }

    if(this.toolbar.objects){
      if(this.toolbar.objects.constructor == Object){
        this.canvas && this.canvas.initMenuEvents(this.toolbar.objects.container,this.toolbar.objects);
      }else{
        this.canvas && this.canvas.initMenuEvents(this.toolbar.objects);
      }
    }
  },
  initTools: function(){
    if(this.options.toolbar){
      if(!this.toolbar){
        this.toolbar = this.options.toolbar;
      }else{
        fabric.util.object.deepExtend(this.toolbar,this.options.toolbar)
      }
    }
    if (this.toolbar) {
      fabric.util.object.deepExtend(Toolbar.tools, this.toolbar.tools);
      for (var klassName in this.toolbar.actions) {
        var actions = this.toolbar.actions[klassName];
        if(!fabric[klassName].prototype.actions){
          fabric[klassName].prototype.actions = {}
        }
        var protoActions = fabric[klassName].prototype.actions;

        if (actions.constructor == Function) {
          actions = actions.call(fabric[klassName].prototype)
        }else{
          actions = fabric.util.object.cloneDeep(actions);
        }
        var $order = actions["$order"];
        delete actions["$order"];

        for (var j in actions) {
          if(protoActions[j]){
            if (actions[j]["$clone"]) {
              protoActions[j] = fabric.util.object.deepExtend({}, protoActions[j]);
              delete actions[j]["$clone"];
            }
            fabric.util.object.deepExtend(protoActions[j], actions[j]);
          }else{
            protoActions[j] = actions[j];
          }
        }
        if($order){
          fabric[klassName].prototype.actions = fabric.util.object.rearrange(protoActions, $order);
        }
      }
      delete this.toolbar['tools'];
      delete this.toolbar['actions'];
      fabric.util.object.extend(Toolbar, this.toolbar);
      delete this.options.toolbar;
    }
  }
});

fabric.util.object.extend(fabric.Application.prototype,{
  eventListeners: fabric.util.object.extendArraysObject(fabric.Application.prototype.eventListeners, {
    "canvas:created" : function(){
      this.initTools();
    }
  })
});

fabric.Application
  // .addPlugin("canvas","initTools")
  .addPlugin("postloaders","createToolbars");


fabric.Toolbar = Toolbar;

fabric.util.object.extend(fabric.Canvas.prototype, {
  menuOriginX: "left",
  menuOriginY: "top",
  menuMarginX: 0,
  menuMarginY: 0,
  setToolbarCoords: function ($menu, target, options) {

    options = fabric.util.object.extend({
      originX: "left",
      originY: "top",
      marginX: 0,
      marginY: 0
    }, options);

    target.setCoords();
    var r = target.getBoundingRect();

    var _left;
    switch (options.originX) {
      case "left":
        _left = r.left;
        break;
      case "right":
        _left = r.left + r.width;
        break;
      case "center":
        _left = r.left + r.width / 2;
        break;
    }
    ;
    var _top;
    switch (options.originY) {
      case "top":
        _top = r.top - $menu.height();
        break;
      case "bottom":
        _top = r.top + r.height;
        break;
      case "center":
        _top = r.top + r.height / 2 - $menu.height() / 2;
        break;
    }
    ;


    _top += options.marginY;
    _left += options.marginX

    var _menuContainerOffset = $($menu.parents()[0]).offset();
    var _canvasOffset = $(this.wrapperEl).offset();

    _top += _canvasOffset.top - _menuContainerOffset.top;
    _left += _canvasOffset.left - _menuContainerOffset.left;

    var coords = {
      top: Math.max(3, _top),
      left: Math.min(Math.max(3, _left), $(this.wrapperEl).width() - $menu.width() - 5)
    };


    $(this.wrapperEl).offset();

    $menu.css(coords);
    return coords;
  },
  getToolbarContainer: function (id, options) {
    return $(document.getElementById(this.application.toolbar.objects.container));
  },
  initMenuEvents: function (id, options) {

    options = options || {};
    options.originX = options.originX || this.menuOriginX;
    options.originY = options.originY || this.menuOriginY;
    options.marginX = options.marginX || this.menuMarginX;
    options.marginY = options.marginY || this.menuMarginY;
    this.floatedToolbarOptions = options;
    var canvas = this;

    if (id) {
      this.$menu = $(document.getElementById(id)).hide();
    } else {

      this.$menu = this.$menu || $('<div>');
      $(this.wrapperEl).prepend(this.$menu);
    }
    this.$menu.hide();

    var _last_target = canvas.target;
    canvas
      .on('object:moving', function (event) {

        var $menu = this.getToolbarContainer();
        canvas.setToolbarCoords($menu, canvas.target, canvas.floatedToolbarOptions);
      })
      .on('target:cleared', function (event) {
        if (_last_target) {
          var $menu = this.getToolbarContainer();
          $menu.hide();
          canvas.objectToolbar.destroy();
          delete canvas.objectToolbar;
          _last_target = null;
        }
      })
      .on('target:changed', function (event) {
        if (_last_target) {
          canvas.objectToolbar.destroy();
        }
        canvas.createFloatedMenu(options);
        _last_target = event.target;
      })
  },

  createFloatedMenu: function (options) {

    var $menu = this.getToolbarContainer();

    $menu.show();
    //this.toolsContainer = this.$menu;
   /* var _tc = $menu.find(".toolbar-tools-container");
    if (_tc.length) {
      this.toolsContainer = _tc;
    }*/
   // this.toolsContainer.empty();
    if (this.target.actions) {
      this.objectToolbar = new Toolbar (this.target, $menu, options);
    }
    this.setToolbarCoords($menu, this.target, this.floatedToolbarOptions);
  }
});

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 85 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {


fabric.util.uploadImageMaxSize = {
  width: 400,
  height: 400
};

fabric.util.uploadImageMinSize = {
  width: 100,
  height: 100
};

fabric.util.multiUpload = false;

fabric.util.readFile = function(file,callback){

  var reader = new FileReader();
  reader.onload = function (e) {
    var result = e.target.result;
    var type = result.substr(11, result.indexOf(";") - 11);
    var img = new Image();
    img.type = type;
    img.name = file.name;
    img.onload = function () {

      if(!fabric.util.multiUpload){
        if (fabric.util.uploadPreprocessor) {
          fabric.util.uploadPreprocessor([this], function (val) {
            callback(val);
          },options)
        } else {
          callback(this);
        }
      }else{
        callback();
      }
    };
    img.src = result;
  };
  reader.readAsDataURL(file );
};


fabric.util.createUploadInput = function (options, complete, progress) {

  var input = document.createElement("input");
  input.setAttribute("type", "file");
  input.setAttribute("multiple", true);
  input.className = "hidden";

  $(input).change(function () {

    if(input.files && input.files.length){

      var _loader = fabric.util.queueLoad(input.files.length,function(loaded){

        if(fabric.util.multiUpload){
          if (fabric.util.uploadPreprocessor) {
            fabric.util.uploadPreprocessor(loaded, function (val) {
              complete(val,options);
            },options)
          } else {
            complete(loaded,options);
          }
        }else{
          complete(loaded[0],options);

        }
      },function(total, current, image){
        if(fabric.util.multiUpload) {
          if (progress) {
            progress(total, current, image);
          }
        }
      });



      for(var i =0; i< input.files.length; i++){
        fabric.util.readFile(input.files[i],_loader);
      }



    }

  });

  fabric.util.uploadInput = input;
};


//fabric.util.resizeImage(img, callback);
fabric.util.uploadPreprocessor = null;


fabric.util.uploadImage = function (cb,progress,options) {
  fabric.util.createUploadInput(options,cb,progress);
  $(fabric.util.uploadInput).trigger('click');
};


fabric.util.resizeUploadedImage = function (img, callback) {

  if (img.type === "svg+xml") {
    callback(img);
    return;
  }
  //Here we can put a restriction to upload a minim sized logo
  if (img.width < fabric.util.uploadImageMinSize.width || img.height < fabric.util.uploadImageMinSize.height) {
    alert("Logo is too small. MInimum size is " + fabric.util.uploadImageMinSize.width + "x" + fabric.util.uploadImageMinSize.height);
    callback(false);
    return;
  }

  if (img.width > fabric.util.uploadImageMaxSize.width || img.height > fabric.util.uploadImageMaxSize.height) {

    var size = fabric.util.getProportions(img, fabric.util.uploadImageMaxSize, "fit");

    var filter = new fabric.Image.filters.ResizeDP();

    var canvas = fabric.util.createCanvasElementWithSize(img);
    var ctx = canvas.getContext("2d");
    ctx.drawImage(img, 0, 0);
    filter.applyTo(canvas, size.width, size.height);
    callback(canvas);
  } else {
    callback(img);
  }
};


/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 86 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {



/////////////////module responsive borders//////////////////////////////////////////////////////////////////////////////////////////

fabric.util.object.extend(fabric.Object.prototype, {
  responsiveBorders: false
});

if(!fabric.SlideCanvas.prototype._default_event_listeners){
  fabric.SlideCanvas.prototype._default_event_listeners = {};
};

fabric.Object.prototype.updateResponsiveBorder = function(){
  if(this.responsiveBorders){
    if(!this.originalStrokeWidth){
      this.originalStrokeWidth = this.strokeWidth;
    }
    this.strokeWidth = this.canvas ? this.originalStrokeWidth / this.canvas.viewportTransform[0] : 0;
  }
};

fabric.SlideCanvas.prototype._default_event_listeners['viewport:scaled'] = function(){

  if(this.backgroundImage){
    this.backgroundImage.updateResponsiveBorder();
  }
  for(var i in this._objects){
    this._objects[i].updateResponsiveBorder();
  }
};

fabric.SlideCanvas.prototype._default_event_listeners["background-image:loaded"] = function(event){
  if(this.autoCenterAndZoomOutEnabled) {
    this.centerAndZoomOut();
  }
};

fabric.SlideCanvas.prototype._default_event_listeners["loading:end"] = function(event){
  if(this.autoCenterAndZoomOutEnabled && (this.originalHeight || this.originalWidth) ){
    this.centerAndZoomOut();
  }
};



fabric.SlideCanvas.prototype._default_event_listeners["object:added"] = function(event){
  event.target.updateResponsiveBorder()
};


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////



fabric.util.object.extend(fabric.SlideCanvas.prototype, {
  zoomCtrlKey: true,
  mouseWheelEnabled : false,
  _setZoomNative  : fabric.Canvas.prototype.setZoom,
  _zoomToPointNative  : fabric.Canvas.prototype.zoomToPoint,
  insertZoomTools: false,
  insertZoomNumber: false,
  changeDimensionOnZoom: false,
  drawZoomArea : function(_ctx,left, top ,width, height ){
    _ctx.save();
    _ctx.translate(left || 0, top || 0);
    var _scale = this.getZoom();
    var _size = fabric.util.getProportions(this.backgroundImage, {width: width || 100, height: height || 100});
    _ctx.globalAlpha = 0.5;
    _ctx.fillRect(0,0,_size.width, _size.height);
    _ctx.strokeStyle = "red";

    var v = this.viewportTransform;

    var x1 = -v[4] * _size.scale / _scale;
    var y1 = -v[5] * _size.scale / _scale;
    var x2 = x1 + this.width * _size.scale / _scale;
    var y2 = y1 + this.height * _size.scale / _scale;

    x1 = Math.max(x1,0);
    y1 = Math.max(y1,0);
    x2 = Math.min(x2,_size.width);
    y2 = Math.min(y2,_size.height);

    _ctx.globalAlpha = 1;
    _ctx.beginPath();
    _ctx.moveTo(x1,y1);
    _ctx.lineTo(x2,y1);
    _ctx.lineTo(x2,y2);
    _ctx.lineTo(x1,y2);
    _ctx.lineTo(x1,y1);

    _ctx.fill();
    _ctx.clip();
    // _ctx.globalCompositeOperation = "source-in";
    _ctx.drawImage(this.backgroundImage._element,0,0,_size.width, _size.height)
    // _ctx.globalCompositeOperation = "source-over";
    // _ctx.drawImage(this.backgroundImage._element,0,0,_size.width, _size.height)
    _ctx.stroke();
    _ctx.strokeRect(0,0,_size.width, _size.height);
    _ctx.restore();
  },
  setZoom: function (_scale){
    if(this.changeDimensionOnZoom){
      var _w = Math.round(this.originalWidth * _scale);
      var _h = Math.round(this.originalHeight * _scale);
      this.setDimensions({
        width: _w,
        height: _h
      });
    }
    this._zoomToPointNative( new fabric.Point(0, 0), _scale)
    //  this._setZoomNative(_scale);
    this.fire('viewport:scaled', {scale: _scale});
  },
  zoomToPoint: function(point, newZoom){
    var _max =  this.getMaxZoom();
    var _min =  this.getMinZoom().scale;
    if(newZoom > _max){
      newZoom = _max;
    }
    if(newZoom < _min){
      newZoom = _min;
    }
    this._zoomToPointNative( point, newZoom);
    for (var i in this._objects) {
      this._objects[i].setCoords();
    }
    this.fire('viewport:scaled', {scale: newZoom});
  },
  resetViewport: function () {
    _canvas.viewportTransform[0] = 1;
    _canvas.viewportTransform[3] = 1;
    _canvas.viewportTransform[4] = 0;
    _canvas.viewportTransform[5] = 0;
    _canvas.renderAll();
    for (var i in this._objects) {
      this._objects[i].setCoords();
    }
  },
  zoomToPointEnabled: true,
  minZoomFactor: 1,
  maxZoom: 20,
  autoCenterAndZoomOutEnabled: false,
  getMaxZoom: function () {
    return this.maxZoom;
  },
  getMinZoom: function () {
    var _containerSize = {
      width: $(this.wrapperEl).width(),
      height: $(this.wrapperEl).height()
    };
    var _bgSize = {
      width: this.originalWidth,
      height: this.originalHeight
    };
    var _maxSize = {
      width: _containerSize.width * this.minZoomFactor,
      height: _containerSize.height * this.minZoomFactor
    };

    return fabric.util.getProportions(_bgSize, _maxSize, 'fit');
  },
  centerAndZoomOut: function () {

    var options = this.getMinZoom();

    var _containerSize = {
      width: $(this.wrapperEl).width(),
      height: $(this.wrapperEl).height()
    };
    this.viewportTransform[4] = (_containerSize.width - options.width ) / 2;
    this.viewportTransform[5] = (_containerSize.height - options.height) / 2;
    this.setZoom(options.scale);
    this._update_background_image();
    // this.fire("viewport:scaled",{scale: options.scale})
    //this.renderAll();
  },
  centerOnObject: function(tag){
    var br = tag.getBoundingRect();
    var ct = this.viewportTransform;
    br.width /= ct[0];
    br.height /= ct[3];
    var size = {
      width: br.width * 1.1,
      height: br.height * 1.1
    };

    var prop = fabric.util.getProportions(size,this);
    var _w = (this.width / prop.scale - size.width ) / 2;
    var _h = (this.height / prop.scale - size.height) / 2;
    var _l = (br.left  - ct[4]) / ct[0];
    var _t = (br.top - ct[5]) / ct[3];

    var x1 = [
      prop.scale,
      0,0,
      prop.scale,
      - tag.left * prop.scale + (tag.width * 0.05 + _w) * prop.scale,
      - tag.top * prop.scale + (tag.height * 0.05 + _h )* prop.scale
    ];
    var x2 = [
      prop.scale,
      0,0,
      prop.scale,
      - _l  * prop.scale + (br.width * 0.05 + _w) * prop.scale,
      - _t  * prop.scale + (br.height * 0.05 + _h )* prop.scale
    ];

    this.setViewportTransform(x2);
    this.fire("viewport:scaled",{scale: prop.scale})
    this.renderAll();
  },

  __onMouseWheel: function (event) {

    if(!this.mouseWheelEnabled || this.zoomCtrlKey && !event.ctrlKey){
      return;
    }
//Find nearest point, that is inside image END
    var zoomStep;// = 0.1 * event.deltaY;
    if (event.deltaY < 0) {
      zoomStep = 1.1;
    } else {
      zoomStep = 0.9;
    }

    var newZoom = this.getZoom() * zoomStep;
    var minZoom = this.getMinZoom().scale;


    if(this.zoomToPointEnabled){
      var point = new fabric.Point(event.offsetX, event.offsetY);
      var _x = this.viewportTransform[4];
      var _y = this.viewportTransform[5];

      // Find nearest point, that is inside image BEGIN
      // It is needed to prevent canvas to zoom outside image
      var _w = this.originalWidth * this.getZoom() + _x;
      var _h = this.originalHeight * this.getZoom() + _y;


      if (point.x < _x) {
        point.x = _x;
      }
      if (point.y < _y) {
        point.y = _y;
      }
      if (point.x > _w) {
        point.x = _w;
      }
      if (point.y > _h) {
        point.y = _h;
      }
      if (minZoom > newZoom) {
        if(this.autoCenterAndZoomOutEnabled){
          this.centerAndZoomOut();
        }
      } else {
        this.zoomToPoint(point, newZoom);
      }
    }else{
      this.setZoom(newZoom);
    }




    for (var i in this._objects) {
      this._objects[i].setCoords();
    }
    this.renderAll();
    event.stopPropagation();
    event.preventDefault();
    return false; //preventing scroll page
  },
  scaleFactor: 1.1,
  getOrignalCenter : function(){
    var point = this.getCenter();
    point.left += this.viewportTransform[4] ;
    point.top += this.viewportTransform[5];
    return point;
  }
});


fabric.util.object.extend(fabric.SlideCanvas.prototype.actions, {
  zoom: {
    title: "zoom",
    menu: {
      zoomOut: {
        className: 'fa fa-search-minus',
        insert: "insertZoomTools",
        title: 'zoom-out',
        action: function (m) {
          var point = this.getOrignalCenter();
          var scaleValue = this.getZoom() / this.scaleFactor;
          this.zoomToPoint({x: point.left, y: point.top},scaleValue);
        }
      },
      zoomNumber: {
        type: 'number',
        value: {
          min:  function(){return 0.01},
          max:  function(){return 10},
          set: function (val) {
            this.setZoom(val)
          },
          get: function () {
            return this.getZoom()
          },
          observe: "viewport:scaled"
        }
      },
      zoomIn: {
        className: 'fa fa-search-plus',
        insert: "insertZoomTools",
        title: 'zoom-in',
        action: function (m) {
          var point = this.getOrignalCenter();
          var scaleValue = this.getZoom() * this.scaleFactor;
          this.zoomToPoint({x: point.left, y: point.top},scaleValue);
        }
      }
    }
  }
});

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 87 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

//fabric.require("BezierText",["BezierMixin"], function() {
  //fabric.IText,
  fabric.BezierText = fabric.util.createClass(fabric.IText,fabric.BezierMixin, {
    type: 'bezier-text',
    bezierControls: true,
    backgroundColor: false,
    backgroundStroke: false,
    outlineTop: 0,
    outlineBottom: 0,
    // outlineTop: 40,
    // outlineBottom: 0,
    stateProperties: fabric.IText.prototype.stateProperties.concat(["points" , "backgroundStroke" ]),
    initialize: function (text, options) {
      this.ctx = fabric.util.createCanvasElement().getContext('2d');
      this.text = text;
      if(!this.outlineTop){
        options.outlineTop = options.outlineTop || options.fontSize || this.fontSize;
      }
      if(!this.outlineBottom){
        options.outlineBottom = options.outlineBottom || ((options.fontSize || this.fontSize) / 4);
      }
      options || ( options = {});
      this.callSuper('initialize',text,  options);
      //this.curve = new (Function.prototype.bind.apply(Bezier, options.points));

//todo
//      if(!this.styles || _.isEmpty(this.styles)){
//        var style = this.getCurrentCharStyle(0,0);
//        style.strokeWidth++;
//        this.styles = {0: {0: style}};
//      }
//       this.initBezier();




      options.points = options.points || [
          {
            x: 0,
            y: this.fontSize,
            c: {
              x: options.width * 0.3,
              y: this.fontSize + 0.5
            },
            c2: {
              x: options.width * 0.7,
              y: this.fontSize + 0.5
            }
          },
          {
            x: options.width,
            y: this.fontSize
          },
        ];

      this.setPoints(options.points);
      this.on("added",function(){
        this.updateBbox();
      })
    },
    _getTextWidth: function(ctx){
      return this.width;
    },
    _getTextHeight: function(ctx){
      return this.height;
    },
    _getTopOffset: function(){
      return 0;
    },
    _getLeftOffset: function(){
      return 0;
    },

    _clearTextArea: function(ctx) {
      // we add 4 pixel, to be sure to do not leave any pixel out
      var width = this.width + 4, height = this.height + 4;
      ctx.clearRect(-width / 2, -height / 2, width, height);
    },
    /**
     * Renders text selection
     * @param {Array} chars Array of characters
     * @param {Object} boundaries Object with left/top/leftOffset/topOffset
     * @param {CanvasRenderingContext2D} ctx transformed context to draw on
     */
    renderSelection: function(chars, boundaries, ctx) {

      ctx.fillStyle = this.selectionColor;

      var start = this.get2DCursorLocation(this.selectionStart),
        end = this.get2DCursorLocation(this.selectionEnd),
        startLine = start.lineIndex,
        endLine = end.lineIndex;

      for (var i = start.charIndex; i <= end.charIndex; i++) {


        var t, pt, nv, angle;
        t = this._charPoints[i];
        pt = this.points[parseInt(t)].curve.get(t);
        nv = this.points[parseInt(t)].curve.normal(t);
        angle = - Math.atan2(nv.x, nv.y) ;
        var charHeight = this.getCurrentCharFontSize(0, i);
        var boxWidth = this._getWidthOfChar(ctx, chars[i], 0, i);

        ctx.save();
        ctx.translate(- this.width/2, - this.height/2);
        ctx.translate(pt.x + this.curveTextOffset*nv.x ,pt.y +  this.curveTextOffset*nv.y);
        ctx.rotate(angle);
        ctx.fillRect(0, 0,
          boxWidth,
          -charHeight);

        ctx.restore();
      }
      //
      //ctx.fillRect(
      //  boundaries.left + lineOffset,
      //  boundaries.top + boundaries.topOffset,
      //  boxWidth,
      //  lineHeight);

    },
    drawControlsInterface: function (ctx) {
      this.drawBezierShapeControls(ctx);
    },
    /**
     * @private
     * @param {String} method Method name ("fillText" or "strokeText")
     * @param {CanvasRenderingContext2D} ctx Context to render on
     * @param {String} line Text to render
     * @param {Number} left Left position of text
     * @param {Number} top Top position of text
     * @param {Number} lineIndex Index of a line in a text
     */
    _renderTextLine: function(method, ctx, line, left, top, lineIndex) {
      // lift the line by quarter of fontSize
      top -= this.fontSize * this._fontSizeFraction;

      // short-circuit
      var lineWidth = this._getLineWidth(ctx, lineIndex);
      this._renderChars(method, ctx, line, left, top, lineIndex);
      /*
       //justify
       var words = line.split(/\s+/),
       charOffset = 0,
       wordsWidth = this._getWidthOfWords(ctx, line, lineIndex, 0),
       widthDiff = this.width - wordsWidth,
       numSpaces = words.length - 1,
       spaceWidth = numSpaces > 0 ? widthDiff / numSpaces : 0,
       leftOffset = 0, word;

       for (var i = 0, len = words.length; i < len; i++) {
       while (line[charOffset] === ' ' && charOffset < line.length) {
       charOffset++;
       }
       word = words[i];
       this._renderChars(method, ctx, word, left + leftOffset, top, lineIndex, charOffset);
       leftOffset += this._getWidthOfWords(ctx, word, lineIndex, charOffset) + spaceWidth;
       charOffset += word.length;
       }*/
    },
    curveTextOffset: -3,
    //todo


    /**
     * Returns index of a character corresponding to where an object was clicked
     * @param {Event} e Event object
     * @return {Number} Index of a character
     */
    getSelectionStartFromPointer: function(e) {
      var mouseOffset = this.getLocalPointer(e),
        prevWidth = 0,
        width = 0,
        height = 0,
        charIndex = 0,
        newSelectionStart,
        line;

      mouseOffset.x /= this.scaleX;
      mouseOffset.y /= this.scaleY;

      //todo

      var p = this.points[0].curve.project(mouseOffset);

      for(var i in this._charPoints){
        if(this._charPoints[i] > p.t){
          return i - 1;
        }
      }
      return this.text.length;
    },
    isEmptyStyles: function(){
      return false;
    },
    _renderChar: function(method, ctx, lineIndex, i, _char, left, top, lineHeight) {
      var charWidth, charHeight, shouldFill, shouldStroke,
        decl = this.getCurrentCharStyle(lineIndex, i + 1),
        offset, textDecoration;

      if (decl) {
        charHeight = this._getHeightOfChar(ctx, _char, lineIndex, i);
        shouldStroke = decl.stroke;
        shouldFill = decl.fill;
        textDecoration = decl.textDecoration;
      }
      else {
        charHeight = this.fontSize;
      }

      shouldStroke = (shouldStroke || this.stroke) && method === 'strokeText';
      shouldFill = (shouldFill || this.fill) && method === 'fillText';

      charWidth = this._applyCharStylesGetWidth(ctx, _char, lineIndex, i);
      textDecoration = textDecoration || this.textDecoration;

      var left = 0, top = 0;
      var t2, pt2 ,nv2 , angle2;

      //todo this.points[0].curve это некорректно!
      var _curve = this.points[0].curve;

      for(var index = 0; index < _char.length; index++){
        var charIndex = index + i - _char.length + 1;

        t2 = this._charPoints[charIndex];
        //do not render chars that not fit into the text area
        if(t2 > 1){
          break;
        }
        pt2 = _curve.get(t2);
        nv2 = _curve.normal(t2);
        angle2 = -Math.atan2(nv2.x,nv2.y) ;

        ctx.save();
        ctx.translate(pt2.x + this.curveTextOffset*nv2.x, pt2.y +  this.curveTextOffset*nv2.y);
        ctx.rotate(angle2);
        shouldFill && ctx.fillText(_char[index], 0, 0);
        shouldStroke && ctx.strokeText(_char[index], 0, 0);
        ctx.restore();
      }

      if (textDecoration || textDecoration !== '') {
        offset = this._fontSizeFraction * lineHeight / this.lineHeight;
        this._renderCharDecoration(ctx, textDecoration, left, top, offset, charWidth, charHeight);
      }

    },
    _renderCharDecoration: function (ctx){

    },
    _renderTextBoxBackground: function (ctx){
      ctx.translate(-this.width/2 ,-this.height/2);
      if (!this.backgroundColor && !this.backgroundStroke){
        return;
      }
      if (this.backgroundColor) {
        this.__fill = this.fill;
        this.fill = this.backgroundColor;
        this._setFillStyles(ctx);
        this.fill = this.__fill;
      }
      if (this.backgroundStroke) {
        this.__stroke = this.stroke;
        this.stroke = this.backgroundStroke;
        this._setStrokeStyles(ctx);
      }
      fabric.Polyline.prototype._render.call(this,ctx);

      if (this.backgroundStroke) {
        this.stroke = this.__stroke;
      }
    },

    /**
     * @private
     * @param {CanvasRenderingContext2D} ctx Context to render on
     */
    _renderText: function(ctx) {
      //this._translateForTextAlign(ctx);
      this._renderTextFill(ctx);
      this._renderTextStroke(ctx);
      //this._translateForTextAlign(ctx, true);
    },
    _getPoint: function(t){
      var _normal = this.points[0].curve.normal(t);
      var info = {
        point:  this.points[0].curve.get(t),
        normal:  _normal,
        angle: -Math.atan2(_normal.x,_normal.y)
      };
      return info;
    },
    /**
     * Renders cursor
     * @param {Object} boundaries
     * @param {CanvasRenderingContext2D} ctx transformed context to draw on
     */
    renderCursor: function(boundaries, ctx) {

      var cursorLocation = this.get2DCursorLocation(),
        lineIndex = cursorLocation.lineIndex,
        charIndex = cursorLocation.charIndex,
        charHeight = this.getCurrentCharFontSize(lineIndex, charIndex);
      //leftOffset = (lineIndex === 0 && charIndex === 0)
      //  ? this._getLineLeftOffset(this._getLineWidth(ctx, lineIndex))
      //  : boundaries.leftOffset;


      var t , pt,nv , angle;
      t = this._charPoints[charIndex];
      var info = this._getPoint(t);
      ctx.save();
      ctx.translate(- this.width/2, - this.height/2);
      ctx.translate(info.point.x + this.curveTextOffset*info.normal.x ,info.point.y +  this.curveTextOffset*info.normal.y);
      ctx.rotate(info.angle);

      ctx.fillStyle = this.getCurrentCharColor(lineIndex, charIndex);
      ctx.globalAlpha = this.__isMousedown ? 1 : this._currentCursorOpacity;

      ctx.fillRect(0, 0,
        this.cursorWidth / this.scaleX,
        -charHeight);

      ctx.restore();

    },

    /**
     * Render Shape Object
     * @private
     * @param {CanvasRenderingctx2D} ctx ctx to render on
     */
    _render: function (ctx, noTransform){
      var x = noTransform ? this.left : -this.width / 2 ,
        y = noTransform ? this.top : -this.height / 2;

      ctx.save();

      this.clipTo && fabric.util.clipContext(this, ctx);
      ctx.translate(-x,-y);
      this._setOpacity(ctx);
      this._setShadow(ctx);
      this._setupCompositeOperation(ctx);
      this._renderTextBackground(ctx);
      this._setStrokeStyles(ctx);
      this._setFillStyles(ctx);

      this._charPoints = [0];
      this._charWidth = [];

      var curveWidth = this.getLength();
      var lineIndex = 0, charIndex = 0, _charWidth, textWidth = 0;
      if (this.textAlign == 'justify') {
        var _l = curveWidth / this.text.length;
        for (; charIndex < this.text.length; charIndex++) {
          this._charWidth.push(_l);
        }
      }else{
        for (; charIndex < this.text.length; charIndex++) {
          _charWidth = this._getWidthOfChar(ctx, this.text[charIndex], lineIndex, charIndex);
          this._charWidth.push(_charWidth);
          textWidth += _charWidth;
        }
      }

      this._charPoints = [];
      var last_t  = 0;
      for(charIndex = 0; charIndex < this.text.length; charIndex++){
        //todo this.points[0] это только для кривых из двух точек
        var _new_t =  this.points[0].curve.getTbyLength(this._charWidth[charIndex],0.0001,last_t);
        this._charPoints.push((_new_t + last_t) / 2);
        last_t = _new_t;
      }

      var t_offset;
      last_t  = Math.min(1,last_t);
      if (this.textAlign == 'right') {
        t_offset = 1 - last_t;
      }else if (this.textAlign == 'center') {
        t_offset = (1 - last_t)/ 2;
      }
      if(t_offset){
        for(var i = 0; i < this._charPoints.length; i++){
          this._charPoints[i] += t_offset;
        }
      }


      ctx.translate(x,y);

      ctx.textAlign = "center";
      this._renderText(ctx);
      this._renderTextDecoration(ctx);
      this.clipTo && ctx.restore();
      this.renderCursorOrSelection();


      ctx.restore();

    },
    /**
     * Returns object representation of an instance
     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output
     * @return {Object} object representation of an instance
    //  */
    // toObject: function (propertiesToInclude) {
    //
    //   var _points = [];
    //   for(var i in this.points){
    //     _points.push(this.points[i].x,this.points[i].y);
    //   }
    //   var object = fabric.util.object.extend(this.callSuper('toObject', propertiesToInclude), {
    //     points: _points,
    //     backgroundColor: this.backgroundColor,
    //     backgroundStroke: this.backgroundStroke,
    //   });
    //   if (!this.includeDefaultValues) {
    //     this._removeDefaultValues(object);
    //   }
    //   return object;
    // }
  });

  fabric.BezierText.fromObject = function (object) {
    return new fabric.BezierText(object.text,object);
  };
  fabric.util.createAccessors(fabric.BezierText);



  if(fabric.objectsLibrary){
    fabric.objectsLibrary.bezierTextCurved = {
      "title": "bezierTextCurved",
      "type":"bezier-text",
      "width": 200,
      "defaultShape": "curve",
      "text":"Add some text here"
    };
  }



  fabric.BezierText.prototype.actions = fabric.util.object.extend({}, fabric.IText.prototype.actions, {});

  fabric.Text.prototype.curveTool = false;
  fabric.Text.prototype.curveText = function () {
    var obj = this.toObject();
    obj.rasterizedType = obj.type;
    obj.type = "bezier-text";
    obj.movementLimits = this.movementLimits;
    obj.clipTo = this.clipTo;
    obj.active = true;

    var _this = this;
    _this.canvas.createObject(obj, function () {
      _this.canvas.remove(_this);
      _this.canvas.renderAll();
    });
  };
  fabric.IText.prototype.actions.curveText =
    fabric.Text.prototype.actions.curveText = {
    insert: 'curveTool',
    className: 'button-easel',
    title: 'curveText',
    action: fabric.Text.prototype.curveText
  };

//});

//материалы для вдохновения
//http://jsfiddle.net/ashishbhatt/XR7j6/10/
//http://jsfiddle.net/EffEPi/qpJTz/
//http://tympanus.net/Development/Arctext/
//http://jsfiddle.net/E5vnU/(function (global){


/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 88 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {/**
 * Bubble Object library for FabricJS
 *
 *
 *
 * @example
 nnew fabric.Bubble({
         left: 100,
         top: 100,
         width: 800,
         height: 600
     })
 *
 * @author Denis Ponomarev
 * @email den.ponomarev@gmail.com
 */


//fabric.require("Bubble",["ShapeMixin"], function() {
  fabric.Bubble = fabric.util.createClass(fabric.Rect, {
    type: 'bubble',


    stateProperties: fabric.Group.prototype.stateProperties.concat(["speechX", "speechY", "bubbleOffsetX", "bubbleOffsetY", "bubbleSize"]),

    /**
     * speechPoint
     * @type Number
     * @default
     */
    speechX: 0,

    /**
     * speechPoint
     * @type Number
     * @default
     */
    speechY: 0,

    /**
     * distance between corner and bubble
     * @type Number
     * @default
     */
    bubbleOffsetX: 0,
    /**
     * distance between corner and bubble
     * @type Number
     * @default
     */
    bubbleSize: 30,


    width: 150,

    height: 100,


    text: {
      fontSize: 20,
      fontFamily: 'Comic Sans'
    },

    /**
     * distance between corner and bubble
     * @type Number
     * @default
     */
    bubbleOffsetY: 0,

    initialize: function (options) {
      options || ( options = {});

      this.callSuper('initialize', options);

      this.set("bubbleOffsetX", options.bubbleOffsetX || 0);
      this.set("bubbleOffsetY", options.bubbleOffsetY || 0);
      if (options.bubbleSize) {
        this.set("bubbleSize", options.bubbleSize);
      }
      this._initRxRy();

      this.setPoint(0, {
        x: options.speechX || -25,
        y: options.speechY || 25
      });


      this._initPoints(options.points);
    },

    setPoint: function (order, _point) {

      if (!this._points)this._points = [];
      if (!this._points[order]) {
        this._points[order] = _point;
      }


      //   1 | 2
      // 8   |   3
      //----------
      // 7   |   4
      //   6 | 5


      var w = 1 / 2, h = 1 / 2, x = _point.x / this.width, y = _point.y / this.height;

      if (x < w) {
        if (y < h) {
          this._bubble_part = x < y ? 8 : 1;
        } else {
          this._bubble_part = w - x < y - h ? 6 : 7;
        }
      } else {
        if (y < h) {
          this._bubble_part = w + w - x > y ? 2 : 3;
        } else {
          this._bubble_part = w - x < h - y ? 4 : 5;
        }
      }


      if (_point.x > 0 && _point.x < this.width) {
        if (_point.y > 0 && _point.y <= this.height / 2) {
          if (this._bubble_part == 1 || this._bubble_part == 2) {
            _point.y = 0;
          }
          if (this._bubble_part == 8) {
            _point.x = 0;
          }
          if (this._bubble_part == 3) {
            _point.x = this.width;
          }
        }
        if (_point.y < this.height && _point.y >= this.height / 2) {
          if (this._bubble_part == 5 || this._bubble_part == 6) {
            _point.y = this.height;
          }
          if (this._bubble_part == 7) {
            _point.x = 0;
          }
          if (this._bubble_part == 4) {
            _point.x = this.width;
          }
        }
      }
      this.speechX = this._points[order].x = _point.x;
      this.speechY = this._points[order].y = _point.y;
      this.canvas && this.canvas.renderAll();
    },
    /**
     * Initializes rx/ry attributes
     * @private
     */
    _initRxRy: fabric.Rect.prototype._initRxRy,
    drawControls: function (ctx) {
      if (!this.hasControls) {
        return this;
      }
      fabric.Object.prototype.drawControls.call(this, ctx);

      this.drawShapeControls(ctx);
    },

    /**
     * @private
     * @param {CanvasRenderingContext2D} ctx Context to render on
     */
    _render: function (ctx, noTransform) {
      //    this.callSuper('_render', ctx, noTransform);

      // optimize 1x1 case (used in spray brush)
      if (this.width === 1 && this.height === 1) {
        ctx.fillRect(0, 0, 1, 1);
        return;
      }

      var rx = this.rx ? Math.min(this.rx, this.width / 2) : 0,
        ry = this.ry ? Math.min(this.ry, this.height / 2) : 0,
        w = this.width,
        h = this.height,
        x = noTransform ? this.left : -this.width / 2,
        y = noTransform ? this.top : -this.height / 2,
        isRounded = rx !== 0 || ry !== 0,
        k = 1 - 0.5522847498 /* "magic number" for bezier approximations of arcs (http://itc.ktu.lt/itc354/Riskus354.pdf) */;

      ctx.beginPath();

      ctx.moveTo(x + rx, y);


      var _ofX = Math.max(rx, rx + this.bubbleOffsetX || w / 6);
      var _ofY = Math.max(ry, ry + this.bubbleOffsetY || h / 6);

      var maxbubbleSize = w - _ofX * 2;
      var maxBubbleHeight = h - _ofY * 2;

      if (this._bubble_part == 1) {
        ctx.lineTo(x + _ofX, y);
        ctx.lineTo(x + this.speechX, y + this.speechY);
        ctx.lineTo(x + _ofX + Math.min(w - _ofX * 2, this.bubbleSize), y);
      }

      if (this._bubble_part == 2) {
        ctx.lineTo(x - _ofX + w - Math.min(maxbubbleSize, this.bubbleSize), y);
        ctx.lineTo(x + this.speechX, y + this.speechY);
        ctx.lineTo(x - _ofX + w, y);
      }

      ctx.lineTo(x + w - rx, y);
      isRounded && ctx.bezierCurveTo(x + w - k * rx, y, x + w, y + k * ry, x + w, y + ry);


      if (this._bubble_part == 3) {
        ctx.lineTo(x + w, y + _ofY);
        ctx.lineTo(x + this.speechX, y + this.speechY);
        ctx.lineTo(x + w, y + _ofY + Math.min(maxBubbleHeight, this.bubbleSize));
      }

      if (this._bubble_part == 4) {
        ctx.lineTo(x + w, y + h - _ofY - Math.min(maxBubbleHeight, this.bubbleSize));
        ctx.lineTo(x + this.speechX, y + this.speechY);
        ctx.lineTo(x + w, y + h - _ofY);
      }

      ctx.lineTo(x + w, y + h - ry);
      isRounded && ctx.bezierCurveTo(x + w, y + h - k * ry, x + w - k * rx, y + h, x + w - rx, y + h);


      if (this._bubble_part == 5) {
        ctx.lineTo(x + w - _ofX, y + h);
        ctx.lineTo(x + this.speechX, y + this.speechY);
        ctx.lineTo(x + w - _ofX - Math.min(w - _ofX * 2, this.bubbleSize), y + h);
      }

      if (this._bubble_part == 6) {
        ctx.lineTo(x + _ofX + Math.min(w - _ofX * 2, this.bubbleSize), y + h);
        ctx.lineTo(x + this.speechX, y + this.speechY);
        ctx.lineTo(x + _ofX, y + h);
      }


      ctx.lineTo(x + rx, y + h);
      isRounded && ctx.bezierCurveTo(x + k * rx, y + h, x, y + h - k * ry, x, y + h - ry);

      if (this._bubble_part == 7) {
        ctx.lineTo(x, y + h - _ofY);
        ctx.lineTo(x + this.speechX, y + this.speechY);
        ctx.lineTo(x, y + h - _ofY - Math.min(maxBubbleHeight, this.bubbleSize));
      }

      if (this._bubble_part == 8) {
        ctx.lineTo(x, y + _ofY + Math.min(maxBubbleHeight, this.bubbleSize));
        ctx.lineTo(x + this.speechX, y + this.speechY);
        ctx.lineTo(x, y + _ofY);
      }

      ctx.lineTo(x, y + ry);
      isRounded && ctx.bezierCurveTo(x, y + k * ry, x + k * rx, y, x + rx, y);


      //ctx.moveTo(x + this.speechX + 20, y + this.speechY);
      //ctx.arc(x + this.speechX , y + this.speechY, 20, 0, 2 * Math.PI, false);

      ctx.closePath();

      this._renderFill(ctx);

      this._renderStroke(ctx);
    },

    /**
     * Returns object representation of an instance
     * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output
     * @return {Object} object representation of an instance
     */
    toObject: function (propertiesToInclude) {
      var object = fabric.util.object.extend(this.callSuper('toObject', propertiesToInclude), {
        speechX: this.get('speechX') || 0,
        speechY: this.get('speechY') || 0,
        bubbleOffsetX: this.get('bubbleOffsetX') || 0,
        bubbleOffsetY: this.get('bubbleOffsetY') || 0,
        bubbleSize: this.get('bubbleSize') || 30
      });
      if (!this.includeDefaultValues) {
        this._removeDefaultValues(object);
      }
      return object;
    }
  });


  fabric.Bubble.fromObject = function (object) {
    return new fabric.Bubble(object);
  };

  fabric.util.object.extend(fabric.Bubble.prototype, fabric.ShapeMixin);
  fabric.util.createAccessors(fabric.Bubble);

//});


/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 89 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

__webpack_require__(9);
__webpack_require__(8);

/**
 * @author Denis Ponomarev
 * @email den.ponomarev@gmail.com
 */
fabric.Clipart = fabric.util.createClass(fabric.Group,fabric.StrokeMixin,fabric.CacheMixin, {
  type: 'clipart',
  colors: null,
  format: 'svg',
  resizable: true,
  processing: false,
  stateProperties: fabric.Group.prototype.stateProperties.concat(["colors"]),
  initialize: function (options) {
    options || ( options = {});

    if (options.constructor != Object) {

      var _obj = options.toObject();
      if (options.element) {
        _obj.element = options.element.cloneSync();
        _obj.element.clipTo = _obj._fabric_shape;
      }
      _obj.shape = options.shape;
      options = _obj;
    }

    this.on({
      "scaling": this.updateElement
    });


    this.initShape(options);
    this._fabric_shape.set({
      opacity: 0,
      originX : 'center',
      originY : 'center',
    });

    this.callSuper('initialize', [this._fabric_shape], options);

    this.resource = options.resource;

    this.colors = options.colors || {};
    this.setElement(options.element);

  },

  setShape: function(el,cb){

    el =  fabric.util.object.extend({
      strokeWidthFull: this.shape.strokeWidthFull,
      strokeWidthEmpty: this.shape.strokeWidthEmpty,
      strokeWidthActive: this.shape.strokeWidthActive,
      dashArray : this.shape.dashArray,
      strokeEmpty:  this.shape.strokeEmpty,
      strokeFull:  this.shape.strokeFull,
      strokeActive:this.shape.strokeActive
    },el);


    var _this = this;
    if(el && el.src && !el.paths){
      fabric.loadSVGFromURL(el.src,function(paths,options) {
        el.paths  = paths;
        fabric.util.object.extend(el,options);
        _this._set_shape(el);
        _this.add(_this._fabric_shape)
        _this._apply_shape();
        cb && cb();
      })
    }else{
      _this._set_shape(el);
      _this.add(_this._fabric_shape);
      _this._apply_shape();
      cb && cb();
    }
  },
  setElement: function (element) {
    if(!element){
      return;
    }
    element.set({
      originX : 'center',
      originY : 'center',
    });
    this.add(element);
    if (this.format === 'png' || this.format === 'image/png' || this.format === 'jpeg' || this.format === 'image/jpeg') {
      this._cache = this.element._element;
    } else {
      this._init_color_array();
    }
  },
  updateElement: function () {
    if(this.element){
      this.element.scaleX = this.width / this.element.width;
      this.element.scaleY = this.height / this.element.height;
    }
    if(this._fabric_shape){
      this._fabric_shape.set({
        width: this.width,
        height: this.height
      });
    }
    this.dirty = true;
  },
  _render: function (ctx) {
    ctx.save();
    ctx.scale(this.element.scaleX,this.element.scaleY)
    for (var i = 0, l = this.element.paths.length; i < l; ++i) {
      this.element.paths[i].render(ctx, true);
    }
    ctx.restore();
  },
  /**
   * кобъект готовится к замену фото
   */
  activate: function () {
    this._activated = true;
    this._fabric_shape.setOpacity(1);
    this.updateStroke();
    this.canvas.renderAll();
  },
  /**
   * кобъект не готовится к замену фото
   */
  deactivate: function () {
    this._activated = false;
    this.updateStroke();
    this.canvas.renderAll();
  },
  _init_color_array: function () {

    this.processing = true;
    this._colors = this.element.extractColors();


    for (var _color in this.colors) {
      this.setClipartColor(_color, this.colors[_color],true)
    }
  },
  // render: function (ctx) {
  //   // var x = noTransform ? 0 : - this.width * this.scaleX / 2,
  //   //   y = noTransform ? 0 : - this.height * this.scaleY / 2;
  //   //
  //   // ctx.save();
  //   // ctx.translate(x,y);
  //   fabric.Group.prototype.render.apply(this,arguments)
  //   // ctx.restore();
  // },
  setClipartColor: function (key, value, preventCacheUpdate) {

    if (!value) {
      value = key;
      delete this.colors[key];
    } else {
      this.colors[key] = value;
    }
    var _colors = this._colors[key];
    for (var i in _colors) {
      if (_colors[i].color) {
        _colors[i].color.fill = value;
      }
      if (_colors[i].stop) {
        _colors[i].stop.color = value;
      }
    }

    this.dirty = true;
    this.canvas && this.canvas.renderAll();
  },
  toObject: function (propertiesToInclude) {
    var _obj = this.callSuper('toObject', ['src', 'colors'].concat(propertiesToInclude));
    delete _obj.objects;
    return _obj;
  }
});

fabric.Clipart.prototype.actions = fabric.util.object.extend({},
  fabric.Object.prototype.actions, {
    switchControls: {
      type: 'menu',
      title: 'color menu',
      menu: function () {
        var _menu = [];
        for (var key in this._colors) {
          _menu.push({
            title: "Цвет (" + key + ")",
            value: {
              defaultValue: key,
              value: this.colors[key] || key,
              get: function (key) {
                return this.colors[key];
              }.bind(this, key),
              set: this.setClipartColor.bind(this, key)
            },
            type: "color"
          })
        }
        return _menu;
      }
    }
  });

fabric.Clipart.async = true;
/**
 * Creates fabric.PathGroup instance from an object representation
 * @static
 * @memberOf fabric.PathGroup
 * @param {Object} object Object to create an instance from
 * @param {Function} callback Callback to invoke when an fabric.PathGroup instance is created
 */
fabric.Clipart.fromObject = function (object, callback) {
  if (typeof object.src === 'string') {
    if (object.format === 'png' || object.format === "image/png" || object.format === 'jpeg' || object.format === "image/jpeg") {
      fabric.Image.fromURL(object.src, function (el) {
        object.element = el;
        object.width = object.width || fabric.Clipart.prototype.width,
          object.height = object.height || fabric.Clipart.prototype.height
        callback(new fabric.Clipart(object));
      }, {
        width: object.width || fabric.Clipart.prototype.width,
        height: object.height || fabric.Clipart.prototype.height
      });
    } else {
      fabric.PathGroup.fromURL(object.src, function (el) {
        object.element = el;
        object.width = object.width || fabric.Clipart.prototype.width,
          object.height = object.height || fabric.Clipart.prototype.height
        callback(new fabric.Clipart(object));
      }, {
        width: object.width || fabric.Clipart.prototype.width,
        height: object.height || fabric.Clipart.prototype.height
      });
    }
  } else {
    return new fabric.Clipart(object);
  }
};

fabric.util.createAccessors(fabric.Clipart);

if (fabric.objectsLibrary) {
  fabric.util.object.extend(fabric.objectsLibrary, {
    clipart: {
      "width": function (w, h) {
        var _asp = Math.min(285 / 365, w / h);
        return w;
      },
      "height": function (w, h) {
        var _asp = Math.min(285 / 365, w / h);
        return h;
      },
      "type": "clipart",
      "src": "data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTkuMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeD0iMHB4IiB5PSIwcHgiIHZpZXdCb3g9IjAgMCA1MTIgNTEyIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA1MTIgNTEyOyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIgd2lkdGg9IjUxMnB4IiBoZWlnaHQ9IjUxMnB4Ij4KPGc+Cgk8cGF0aCBzdHlsZT0iZmlsbDojRkY4QzQ2OyIgZD0iTTE2My4xODksNjcuMTQ4QzEyOS42MTYsNjcuMTQ4LDEyMS4yMjIsMCw3OS4yNTUsMEM1Mi43MTMsMCwyOC44OTQsMTYuNzg3LDI4Ljg5NCw1MC4zNjEgICBzNTguNzU0LDUwLjM2MSw0MS45NjcsMTA5LjExNUwxNjMuMTg5LDY3LjE0OHoiLz4KCTxwYXRoIHN0eWxlPSJmaWxsOiNGRjhDNDY7IiBkPSJNMzQ3Ljg0NSw2Ny4xNDhDMzgxLjQxOSw2Ny4xNDgsMzg5LjgxMiwwLDQzMS43OCwwYzI2LjU0MiwwLDUwLjM2MSwxNi43ODcsNTAuMzYxLDUwLjM2MSAgIHMtNTguNzU0LDUwLjM2MS00MS45NjcsMTA5LjExNUwzNDcuODQ1LDY3LjE0OHoiLz4KPC9nPgo8Zz4KCTxwYXRoIHN0eWxlPSJmaWxsOiNGRkVCRDI7IiBkPSJNMzMxLjU0MSw0NjEuNjM5QzMzMS41NDEsNDg5LjQ1MywzMTEuNjI2LDUxMiwyNTYsNTEycy03NS41NDEtMjIuNTQ3LTc1LjU0MS01MC4zNjF2LTguMzkzaDE1MC41OTkgICBMMzMxLjU0MSw0NjEuNjM5eiIvPgoJPHBhdGggc3R5bGU9ImZpbGw6I0ZGRUJEMjsiIGQ9Ik00NTkuMzY4LDE4Mi45MWMzNC40NDYsNTYuMzAzLDQwLjA0MiwxMDIuNDY3LDQwLjA0MiwxMDIuNDY3aC0xNi43ODcgICBjMCwwLDE2Ljc4Nyw0MS40NDMsMTYuNzg3LDY3LjE0OGwtMjUuMTgtOC4zOTNjMCwwLDE2Ljc4NywzNy43NywxNi43ODcsNjcuMTQ4YzAsMC41MjUtMjUuMTgtOC4zOTMtMjUuMTgtOC4zOTMgICBzMTIuNTksMjguMzI4LDguMzkzLDQxLjk2N2MtMC4xNTQsMC41MDEtMjUuMTgtOC4zOTMtMjUuMTgtOC4zOTNzNy4zNDQsMTkuNTg1LDAsMzMuNTc0bC00MS45NjctMTYuNzg3ICAgYzAsMC03Ljg0NiwyNS42ODEtOC4zOTMsMjUuMThjLTE4LjM2MS0xNi43ODctNDEuOTY3LTI1LjE4LTQxLjk2Ny0yNS4xOEgxNTUuMjc5YzAsMC0yMy42MDcsOC4zOTMtNDEuOTY3LDI1LjE4ICAgYy0wLjU0OCwwLjUtOC4zOTMtMjUuMTgtOC4zOTMtMjUuMThsLTQxLjk2NywxNi43ODdjLTcuMzQ0LTEzLjk4OSwwLTMzLjU3NCwwLTMzLjU3NHMtMjUuMDI2LDguODk1LTI1LjE4LDguMzkzICAgYy00LjE5Ny0xMy42MzksOC4zOTMtNDEuOTY3LDguMzkzLTQxLjk2N3MtMjUuMTgsOC45MTgtMjUuMTgsOC4zOTNjMC0yOS4zNzcsMTYuNzg3LTY3LjE0OCwxNi43ODctNjcuMTQ4bC0yNS4xOCw4LjM5MyAgIGMwLTI1LjcwNSwxNi43ODctNjcuMTQ4LDE2Ljc4Ny02Ny4xNDhIMTIuNTljMCwwLDUuNTk1LTQ2LjE2NCw0MC4wNDItMTAyLjQ2N0g0NTkuMzY4eiIvPgo8L2c+CjxlbGxpcHNlIHN0eWxlPSJmaWxsOiNGRkE1NEI7IiBjeD0iMjU1LjUxNyIgY3k9IjIzMC44MiIgcng9IjIwOS44MzYiIHJ5PSIxOTcuMjQ2Ii8+CjxnPgoJCgkJPGVsbGlwc2UgdHJhbnNmb3JtPSJtYXRyaXgoLTAuNjA0MiAtMC43OTY4IDAuNzk2OCAtMC42MDQyIDYzLjk0NzUgNDk5Ljg5MjYpIiBzdHlsZT0iZmlsbDojRkZFQkQyOyIgY3g9IjE1Ni4xMjMiIGN5PSIyMzQuMDY1IiByeD0iMzcuNzY5IiByeT0iNDYuMTYzIi8+CgkKCQk8ZWxsaXBzZSB0cmFuc2Zvcm09Im1hdHJpeCgtMC42MDQyIDAuNzk2OCAtMC43OTY4IC0wLjYwNDIgNzU1LjkyMDQgOTIuNzAzMSkiIHN0eWxlPSJmaWxsOiNGRkVCRDI7IiBjeD0iMzU0LjkzNyIgY3k9IjIzNC4wODYiIHJ4PSIzNy43NjkiIHJ5PSI0Ni4xNjMiLz4KPC9nPgo8cGF0aCBzdHlsZT0iZmlsbDojRkY4QzQ2OyIgZD0iTTI1NS41MjQsMjYwLjE5N2gtMC4wMTNjLTI4LjcxMSwwLTU1LjA0NSwxOC4yNjgtNjguNTM2LDQ3LjUxMSAgYy0xOC4xNjMsMzkuMzc0LTQwLjU3Myw5MS45OTYtNDAuNTczLDExMS45NjRoMjE4LjIyOWMwLTE5Ljk2Ny0yMi40MDktNzIuNTktNDAuNTczLTExMS45NjQgIEMzMTAuNTY5LDI3OC40NjQsMjg0LjIzNCwyNjAuMTk3LDI1NS41MjQsMjYwLjE5N3oiLz4KPHBhdGggc3R5bGU9ImZpbGw6I0ZGREVCNzsiIGQ9Ik0zMDQuNzk1LDM2OS4zMTFjLTE5LjM5MywwLTM2Ljg1NSw2LTQ5LjI3OCwxNS41ODhjLTEyLjQyMi05LjU4OC0yOS44ODUtMTUuNTg4LTQ5LjI3OC0xNS41ODggIGMtMzcuNjgyLDAtNjguMjMsMjIuNTQ3LTY4LjIzLDUwLjM2MXMzMC41NDgsNTAuMzYxLDY4LjIzLDUwLjM2MWMxNS43MjgsMCwzMC4xODctMy45NDcsNDEuNzE2LTEwLjU1NCAgYzQuNzY0LTIuNzMsMTAuMzU3LTIuNzMsMTUuMTIyLDBjMTEuNTI5LDYuNjA3LDI1Ljk4OCwxMC41NTQsNDEuNzE2LDEwLjU1NGMzNy42ODIsMCw2OC4yMy0yMi41NDcsNjguMjMtNTAuMzYxICBTMzQyLjQ3OCwzNjkuMzExLDMwNC43OTUsMzY5LjMxMXoiLz4KPGc+Cgk8cGF0aCBzdHlsZT0iZmlsbDojNDY0NjU1OyIgZD0iTTIxNS4zNDQsMzc0Ljk5MWwzMy40OCw0NC4yMzJjMy4zNTgsNC40MzcsMTAuMDI2LDQuNDM3LDEzLjM4NCwwbDMzLjQ4LTQ0LjIzMiAgIGM0LjE4NC01LjUyOCwwLjI0MS0xMy40NTktNi42OTMtMTMuNDU5aC00LjVjLTIuNTIsMC01LjAyNiwwLjM3OC03LjQzMiwxLjEyMmwtMTQuMTE2LDQuMzYxYy00Ljg0MiwxLjQ5Ni0xMC4wMjMsMS40OTYtMTQuODY1LDAgICBsLTE0LjExNi00LjM2MWMtMi40MDgtMC43NDQtNC45MTMtMS4xMjItNy40MzItMS4xMjJoLTQuNDk5QzIxNS4xMDMsMzYxLjUzMiwyMTEuMTYsMzY5LjQ2MywyMTUuMzQ0LDM3NC45OTF6Ii8+Cgk8Y2lyY2xlIHN0eWxlPSJmaWxsOiM0NjQ2NTU7IiBjeD0iMTU0Ljc5NiIgY3k9IjIzNS4wMTYiIHI9IjE2Ljc4NyIvPgoJPGNpcmNsZSBzdHlsZT0iZmlsbDojNDY0NjU1OyIgY3g9IjM1Ni4yMzkiIGN5PSIyMzUuMDE2IiByPSIxNi43ODciLz4KCTxwYXRoIHN0eWxlPSJmaWxsOiM0NjQ2NTU7IiBkPSJNNzcuMzU4LDMzNS4wMDFsNDYuMjA2LTM3LjgwNWM0LjAxMi0zLjI4MywxLjEyMy05Ljc2MS00LjAwMS04Ljk2OWwtNjEuNDc4LDkuNSAgIEM2My4xMjMsMzEwLjg2LDY5LjYxOCwzMjMuMzMxLDc3LjM1OCwzMzUuMDAxeiIvPgoJPHBhdGggc3R5bGU9ImZpbGw6IzQ2NDY1NTsiIGQ9Ik0xMjEuNDkzLDM4Mi41NzdsMjUuMDUyLTY2LjgwN2MxLjkyMi01LjEyNS00LjQ5NC05LjI1Ni04LjM2NC01LjM4NWwtNDUuMTgzLDQ1LjE4MyAgIEMxMDEuNTU1LDM2NS40MDYsMTExLjA5OCwzNzQuNDU1LDEyMS40OTMsMzgyLjU3N3oiLz4KCTxwYXRoIHN0eWxlPSJmaWxsOiM0NjQ2NTU7IiBkPSJNMjI2LjQwNSwxMDkuMTQ5bC02LjYzMy03Mi42NjdjLTguMTA2LDEuMzA4LTE2LjA1MiwzLjA0NC0yMy44MTEsNS4yMDFsMjEuNTMyLDY5LjIzOSAgIEMyMTkuMTIsMTE2LjE1NywyMjYuOTAzLDExNC42MDksMjI2LjQwNSwxMDkuMTQ5eiIvPgoJPHBhdGggc3R5bGU9ImZpbGw6IzQ2NDY1NTsiIGQ9Ik0yOTEuMjYzLDM2LjQ4MmwtNi42MzMsNzIuNjY3Yy0wLjQ5OCw1LjQ2LDcuMjg0LDcuMDA3LDguOTEzLDEuNzcybDIxLjUzMi02OS4yMzkgICBDMzA3LjMxNSwzOS41MjcsMjk5LjM2OSwzNy43OSwyOTEuMjYzLDM2LjQ4MnoiLz4KCTxwYXRoIHN0eWxlPSJmaWxsOiM0NjQ2NTU7IiBkPSJNMzM3LjM4Nyw0OS4xNTZsLTIwLjUwOSw0Ny40NDljLTIuMTM3LDQuOTQ2LDQuNTQ5LDguODY4LDcuODIzLDQuNTg4bDMyLjczLTQyLjc5MSAgIEMzNTAuOTQ2LDU1LjAxLDM0NC4yNzEsNTEuOSwzMzcuMzg3LDQ5LjE1NnoiLz4KCTxwYXRoIHN0eWxlPSJmaWxsOiM0NjQ2NTU7IiBkPSJNMTk0LjE1Nyw5Ni42MDVsLTIwLjUwOS00Ny40NDljLTYuODg0LDIuNzQ1LTEzLjU1OSw1Ljg1My0yMC4wNDQsOS4yNDdsMzIuNzMsNDIuNzkgICBDMTg5LjYwOCwxMDUuNDczLDE5Ni4yOTUsMTAxLjU1MSwxOTQuMTU3LDk2LjYwNXoiLz4KCTxwYXRoIHN0eWxlPSJmaWxsOiM0NjQ2NTU7IiBkPSJNMjcyLjIyNCwzNC4yNTNjLTUuNTE4LTAuNDA4LTExLjA3Ny0wLjY3OS0xNi43MDctMC42NzljLTUuNjMsMC0xMS4xODksMC4yNzEtMTYuNzA3LDAuNjc5ICAgbDEyLjE2OSwxMDMuNDRjMC42MzMsNS4zOCw4LjQ0Miw1LjM4LDkuMDc1LDBMMjcyLjIyNCwzNC4yNTN6Ii8+Cgk8cGF0aCBzdHlsZT0iZmlsbDojNDY0NjU1OyIgZD0iTTQzNC44NjgsMzM1LjAwMWwtNDYuMjA2LTM3LjgwNWMtNC4wMTItMy4yODMtMS4xMjMtOS43NjEsNC4wMDEtOC45NjlsNjEuNDc4LDkuNSAgIEM0NDkuMTA0LDMxMC44Niw0NDIuNjA4LDMyMy4zMzEsNDM0Ljg2OCwzMzUuMDAxeiIvPgoJPHBhdGggc3R5bGU9ImZpbGw6IzQ2NDY1NTsiIGQ9Ik0zOTAuNzMzLDM4Mi41NzdsLTI1LjA1Mi02Ni44MDdjLTEuOTIyLTUuMTI1LDQuNDk0LTkuMjU2LDguMzY0LTUuMzg1bDQ1LjE4Myw0NS4xODMgICBDNDEwLjY3MSwzNjUuNDA2LDQwMS4xMjksMzc0LjQ1NSwzOTAuNzMzLDM4Mi41Nzd6Ii8+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPC9zdmc+Cg=="
    }
  });
}

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 90 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {


__webpack_require__(9);
    /**
   * @author Denis Ponomarev
   * @email den.ponomarev@gmail.com
   */
  fabric.Frame = fabric.util.createClass(fabric.Group, fabric.StrokeMixin, {
    type: 'frame',
    //strokeActive:   "lightgreen",
    //stroke: "red",
    minWidth: 35,
    minHeight: 35,
    fill : "transparent",
    resizable: true,
    contentTools: false,
    //states : Empty / Full / Active
    specialProperties: ["element","shape","clip"],
    stateProperties: fabric.Group.prototype.stateProperties.concat(["clip"]),
    clip: {
      left: 0,
      top: 0,
      scaleX: 1,
      scaleY: 1
    },
    clippingAvailable: function(){
      return this.clipEnabled && this.element && !this._clipmode;
    },
    clipEnabled: true,
    /**
     * create clone with same image and shape as original (syncronous)
     * @param callback
     * @returns {*}
     */
    cloneSync: function(options){
      var _frame = new fabric.Frame(this);
      options && _frame.set(options);
      return _frame;
    },
    initialize: function (options) {

      options || ( options = {});



      if(options.constructor != Object){

        var _obj = options.toObject();
        if(options.element){
          _obj.element = options.element.cloneSync();
          _obj.element.clipTo = _obj._fabric_shape;
        }
        _obj.shape = options.shape;
        options = _obj;
      }


      this.on({
        "object:click":this._check_text_as_target_and_edit,
        "dblclick":this.toggleClipModeByClick,
        "scaling": this._apply_shape,
        "element:modified": function(event){
          this.updateStroke();
          this._apply_shape();
        }
      });


      this.initShape(options);

      this.callSuper('initialize', [
        this._fabric_shape
      ], options);
      this._elements_to_update = [];

    },
    toggleClipModeByClick: function(e){
      if(this._is_clipping_available(e.e)){
        if(!this._clipmode){
          this.clipPhotoStart()
        }else{
          this.clipPhotoEnd()
        }
      }
    },
    _check_text_as_target_and_edit: function(e){
      if( this.isPossibleTarget(e.e,this.text)){
        this.text.setOpacity(1);
        this._on_text_edit(e);
      }
    },
    clipPhotoEnd:function(){
      this.canvas.editingObject = null;
      this.canvas.off("target:changed target:cleared",this._endFoo);

      if(this.canvas.grid){
        this.canvas.grid.enabled = true;
      }

      //this.project.clipMode = false;


      this.canvas.remove(this.element);
      this.set({
        hasControls: false,
        evented: true,
        flipX:   this.element.flipX,
        flipY:   this.element.flipY
      })

      var to_radians = Math.PI / 180;
      var cosA = Math.cos(this.angle * to_radians);
      var sinA = Math.sin(this.angle * to_radians);
      var I = this.element, F = this;
      var _newGeometry = {
        angle: this.element.angle - this.angle,
        left: ( (I.left - F.left) * cosA + (I.top - F.top)* sinA  - F.width/ 2) * (I.flipX ? -1 : 1),
        top:  (-(I.left - F.left) * sinA + (I.top - F.top)* cosA  - F.height/ 2)* (I.flipY ? -1 : 1),
        flipX: false,
        flipY: false
      };
      this.add(this.element);
      this.element.set(_newGeometry);
      //
      //
      this._clipmode =false;
      //рамку двигать нельзя
      this.set({
        hasControls: true,
        evented: true
      });
      this.canvas.remove(this._fabric_shape);
      this.add(this._fabric_shape);
      this.updateStroke();
      this._apply_shape();

      this.element.active = false;
      this.canvas.setActiveObject(this);
      this.canvas.renderAll();

      var w = this.width,  h = this.height, el = this.element;

      this.clip = {
        left   : (el.left) / w ,
        top    : (el.top) / h ,
        scaleX : (el.width ) / w,
        scaleY : (el.height) / h
      };

      this.fire("clipping:exited");
      this.canvas.fire('frame:clipping:exited', { target: this });
    },

    clipPhotoStart:function(){
      var _this = this;
      this._clipmode = true;
      this.updateStroke();
      this._apply_shape();
      this.canvas.discardActiveGroup();
      if(this.canvas.grid){
        this.canvas.grid.enabled = false;
      }

      /* this.fabric.set({
       originX: "center",
       originY:  "center",
       left: this.fabric.left + this.fabric.width/2,
       top: this.fabric.top + this.fabric.height/2,
       });*/

      this.element.set({
        movementLimits: this,
        movementLimitMode: "content",
        //clipTo:         this,
        flipX: this.flipX,
        flipY: this.flipY,
        //left: this.element.left* (this.flipX ? -1 : 1),
        //top:  this.element.top* (this.flipY ? -1 : 1)
      });

      this._restoreObjectState(this.element);
      this.element.set({
        hasControls: true,
        //selectable: false,
        //perPixelTargetFind: true,
        selectable: true,
        perPixelTargetFind: false
      });
      this.remove(this.element);
      this.canvas.add(this.element);

      this._restoreObjectState(this._fabric_shape);
      this.remove(this._fabric_shape);
      this.canvas.add(this._fabric_shape);




  //рамка должна рисоваться над картинкой, иначе  некрасиво
  //      this.slide.canvas.bringToFront(this.fabric);

      //рамку двигать нельзя
      this.set({
        hasControls: false,
        evented: false
      });


      this.canvas.setActiveObject(this.element);
      this.active = true;


      this._endFoo = function(){
        _this.clipPhotoEnd();
      };
      this.canvas.on("target:changed target:cleared",this._endFoo);

      this.fire("clipping:entered");
      this.canvas.fire('frame:clipping:entered', { target: this });

      this.canvas.editingObject = this;
      this.canvas.renderAll();
    },
    render: function(ctx, noTransform) {
      if(this._clipmode){
        var _zoom = this.canvas.getZoom();
        ctx.save();
        //  this.transform(ctx);
        ctx.globalAlpha = 0.5;
        var _clip_to = this.element.clipTo;
        this.element.clipTo = null;
        this.element.render(ctx);
        ctx.scale(_zoom,_zoom);
        this.element.clipTo = _clip_to;
        this.transform(ctx);
        ctx.strokeStyle = this.borderColor;
        ctx.lineWidth = 1 / this.borderScaleFactor;
        ctx.beginPath();
        ctx.closePath();
        ctx.stroke();
        ctx.restore();
      }
      this.callSuper('render', ctx, noTransform);
    },
    //supportedTypes: "*", // * or ["image","video",...]
    clippingSupportedTypes: "*", // * or ["image","video",...]
    _is_clipping_available : function(e){
      if(!this.clipEnabled)return false;
      if(e && this.isPossibleTarget(e,this.button)){
        return;
      }
      return this.element && (this.clippingSupportedTypes == "*" || this.clippingSupportedTypes.indexOf(this.element.type)!= -1);
    },
    _remove_element: function(){},
    drop: function(data){
      if(data.type == "frame"){
        this.setFrame(data.frame);
        this.setShape(data.shape);
      }else{
        this.setElementObject(data);
      }
    },
    droppable: {
      type: ["image","video","frame"]
    },
    setElementObject: function(options,callback){
      this._set_pending(true);
      this.fire("element:loading");
      fabric.util.createObject(options,function(el){
        this._set_pending(false);
        this.setElementKlass(el);
        callback && callback(el);
      }.bind(this));
    },
    setElement: function(el,cb){
      if(el){
        if(el.constructor == Object){
          this.setElementObject(el,cb)
        }else{
          this.setElementKlass(el);
          cb && cb();
        }
      }else{
        this.setElementKlass();
        cb && cb()
      }
    },
    dropElementMethod: "cover",//resize
    /**
     * Создание элемента фото
     * @private
     */
    setElementKlass: function(el){
      if(this.element === el)return;

      if(this.element){
        this._remove_element();
        this.element.destructor && this.element.destructor();
        this.remove(this.element);
        this.canvas && this.canvas.remove(this.element);
      }
      this.element = el;

      if(el){
        el.on("dblclick",function(e){
          this.parent.toggleClipModeByClick(e);
        });
        el.setupState();

        if(this.dropElementMethod  == "resize"){
          this.clip = {
            left: 0,
            top: 0,
            scaleX: 1,
            scaleY: 1
          }
        }

        if(this.dropElementMethod  == "cover"){
          var size = fabric.util.getProportions(el,this,'cover')
          this.clip = {
            left: 0,
            top: 0,
            scaleX: size.width /this.width,
            scaleY: size.height /this.height
          }
        }

        el.set({
          actions: {
            clipEnd: {
              className:  "fa fa-crop",
              title:      "clip end",
              action:     function(){
                this.parent.clipPhotoEnd();
              }
            }
          },
          parent: this,
          notSelectableInTheGroup : true,
          originX: "center",
          originY: "center",
          transparentCorners : false,
          resizable: true,
          clipTo: this._fabric_shape
        });

        this.add(el);

        for(var i in this._elements_to_update){
          this.remove(this._elements_to_update[i].element);
          this.add(this._elements_to_update[i].element);
        }
        this._update_element_size();
      }

      this.fire("element:modified",{element: el});
      this.canvas && this.canvas.renderAll();
    },

    /**
     * ограничиваем перемещение фотографии внутри рамки
     * @param el
     */
    _limit_moving: function(data){

      var r = this.getBoundingRect();
      var i   = this.element;
      i.on("moving", function() {
        var b = {
          l:  r.left  + i.width * i.scaleX/2,
          r:  r.left + r.width - i.width * i.scaleX/2,
          t:  r.top  + i.height * i.scaleY/2,
          b:  r.top  + r.height - i.height * i.scaleY/2
        };
        // capping logic here
        i.setLeft(Math.max(Math.min(b.l, i.left),b.r));
        i.setTop(Math.max(Math.min(b.t, i.top),b.b));
      });

      i.on("scaling", function() {
        i.set({
          width: Math.max(r.width, i.width * i.scaleX),
          height: Math.max(r.height,i.height* i.scaleY),
          scaleX : 1,
          scaleY: 1
        });

        var b = {
          l:  r.left  + i.width * i.scaleX/2,
          r:  r.left + r.width - i.width * i.scaleX/2,
          t:  r.top  + i.height * i.scaleY/2,
          b : r.top  + r.height - i.height * i.scaleY/2
        };
        //// capping logic here
        //i.setLeft(Math.min(Math.max(b.l, i.left),b.r));
        //i.setTop(Math.min(Math.max(b.t, i.top),b.b));
      });
    },

    _set_pending: function(val){
      this._pending = val;
    },

    /**
     * Создание элемента фото
     * @private
     */
    _create_remove_button: function(options){

      this.button = this._create_button({
        text: "",
        options: {
          visible: false
        },
        position:{
          top: 0,
          right: 0
        }
      });

      this.button.on('click', function(e){
        if(!this._pending){
          this.setElement(false);
        }
      }.bind(this));

    },
    _add_element_to_update: function(data){
      this._elements_to_update.push(data);

      if(data.right !== undefined){
        data.element.setOriginX("right");
      }
      if(data.left !== undefined){
        data.element.setOriginX("left");
      }
      if(data.bottom !== undefined){
        data.element.setOriginY("bottom");
      }
      if(data.top !== undefined){
        data.element.setOriginY("top");
      }

      this._update_interface_element_position(data.element,data);

    },
    setClip: function(val){
      this.clip = val;
      this._update_element_size();
    },
    _update_element_size: function(){
      this._update_element_width();
      this._update_element_height();
    },

    _update_element_width: function(){
      if(this.element){
        if(this.element.type == "ellipse"){
          this.element.set({
            rx: this.width/2 * this.clip.scaleX
          });
        }else if( this.element.type =="video" || this.element.type == "path"){

          this.element.set({
            left: 0,
            scaleX: this.width / this.element.width
          });
        }else {
          this.element.setWidth(this.width * this.clip.scaleX)
          this.element.setLeft(this.width * this.clip.left);
        }
      }
    },
    _update_element_height: function(){
      if(this.element){

        if(this.element.type == "ellipse"){
          this.element.set({
            ry:     this.height/2 * this.clip.scaleY
          });
        }else if( this.element.type =="video" || this.element.type == "path"){

          this.element.set({
            top: 0,
            scaleY: this.height / this.element.height
          });
        }else{
          this.element.setHeight(this.height * this.clip.scaleY)
          this.element.setTop( this.height * this.clip.top);
        }
      }
    },
    _update_interface_element_position: function(el,data, prop){
      if(!prop || prop == "height"){
        if (data.top !== undefined && data.bottom !== undefined) {
          el.setTop(-this.height / 2 + data.top);
          el.setHeight(this.height - data.top - data.bottom);
        }if (data.top !== undefined) {
          el.setTop(-this.height / 2 + data.top);
        } else if (data.bottom !== undefined) {
          el.setTop(this.height / 2 - data.bottom);
        }else if (data.height !== undefined) {
          el.setHeight(data.height);
        }
      }
      if(!prop || prop == "width") {
        if (data.right !== undefined && data.left !== undefined) {
          el.setLeft(-this.width / 2 + data.left);
          el.setWidth(this.width - data.left - data.right);

        }else if (data.right !== undefined) {
          el.setLeft(this.width / 2 - data.right);
        }else if (data.left !== undefined) {
          el.setLeft(-this.width / 2 + data.left);
        }else if (data.width !== undefined) {
          el.setWidth(data.width);
        }
      }
      el.setCoords();
    },



    setHeight: function(h){
      this.set("height",h);
      for(var i in this._elements_to_update) {
        var data = this._elements_to_update[i];
        this._update_interface_element_position(data.element,data,"height");
      }
      this._update_element_height();
      this._apply_shape();
    },
    setWidth: function(w){
      this.set("width",w);
      for(var i in this._elements_to_update){
        var data = this._elements_to_update[i];
        this._update_interface_element_position(data.element,data,"width");
      }
      this._update_element_width();
      this._apply_shape();
    },
    toObject: function(propertiesToInclude){
      propertiesToInclude = ["clip","data"].concat(propertiesToInclude);

      var object = this.callSuper('toObject', propertiesToInclude);


      if(this.shape){
        object.shape = _.clone(this.shape);
        if(object.shape.src){
          delete object.shape.paths;
          delete object.shape.height;
          delete object.shape.width;
          delete object.shape.svgUid;
          delete object.shape.toBeParsed;
        }
      }

      delete object.objects;

      if(this.element){
        var _obj2 = this.element.toObject();
        object.element = {
          type: _obj2.type,
          src: _obj2.src
        }

      }

      return object;
    }
  });

  var _FRA = fabric.Frame.prototype;
  fabric.Frame.prototype.actions = fabric.util.object.extend({}, fabric.Object.prototype.actions, {

      clear: {
        insert:     "contentTools",
        title:      "Remove content",
        className:  "fa fa-times",
        action:     _FRA.setElement,
        visible:    "element",
        observe:    "element:modified"
      },
      photoClip: {
        title:      "обрезать",
        className:  "fa fa-crop",
        action:     _FRA.clipPhotoStart,
        visible:    _FRA.clippingAvailable,
        observe:  "clipping:entered clipping:exited element:modified"
      }
    }
  );


  fabric.Frame.fromObject = function(object,callback) {

    object = fabric.util.object.cloneDeep(object);


    var cb = fabric.util.queueLoad(2,function(){
      callback && callback(new fabric.Frame(object));
    });



    if(object.element){
      fabric.util.createObject(object.element,function(el){
        object.element = el;
        cb();
      });
    }else{
      cb();
    }

    if(object.shape && object.shape.src){
      fabric.loadSVGFromURL(object.shape.src,function(paths,options) {
        object.shape.paths  = paths;
        fabric.util.object.extend(object.shape,options);
        cb();
      })
    }else {
      cb();
    }



  };
  fabric.Frame.async = true;

  fabric.util.createAccessors(fabric.Frame);

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 91 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {


/**
 * MaskRectangl keep selection data, monochrome mask and utility function to edit mask data.
 * @class fabric.MaskRectangle
 * @extends fabric.Rect
 */
fabric.MaskRectangle = fabric.util.createClass(fabric.Rect,fabric.ShapeMixin, {
  type: "mask-rectangle",
  resizable: true,
  mode: 'original',
  fill: "white",
  thumbElement: null,
  eventListeners: fabric.util.object.extendArraysObject(fabric.Rect.prototype.eventListeners,{
    'added moving rotating scaling modified': function(){
      this.update();
    }
  }),
  // initialize: function (options,callback) {
  //   // this.loaded = false;
  //   this.callSuper('initialize', options,callback);
  //   // this.setOriginal(options.image);
  //   // this.setMask(options.mask);
  //   // this.on('added moving rotating scaling modified', this.update.bind(this));
  //   // if(!this._mask_loading && !this._original_loading){
  //   //   this.loaded = true;
  //   // }
  // },
  set_original_image: function (image, cb) {
    if(!this.width)this.width = image.width;
    if(!this.height)this.height = image.height;
    this._originalElement = this._element = image || fabric.util.createCanvasElement();
    this.canvas && this.canvas.renderAll();
    cb && cb()
  },
  setImage: function (image, cb) {
    if(!image){
      cb && cb();
      return this;
    }
    if(typeof image == "string"){
      this._original_loading = true;
      fabric.util.loadImage(image,function(el){
        this.set_original_image(el,cb);
      }.bind(this));
    }else{
      this.set_original_image(image,cb);
    }
  },
  convertMask: false,
  _set_mask_image: function (mask,cb) {
    if (mask && mask instanceof HTMLCanvasElement) {
      this.maskElement = mask;
    } else {
      this.maskElement = fabric.util.createCanvasElement();
      if(!this.width)this.width = mask.width;
      if(!this.height)this.height = mask.height;

      this.maskElement.width = mask && mask.width || 0 ;
      this.maskElement.height = mask && mask.height || 0;
    }
    var ctx = this.selectionContext = this.maskElement.getContext('2d');

    if (mask && mask instanceof HTMLImageElement) {
      ctx.drawImage(mask, 0, 0);
    }

    if(this.convertMask){
      this.convertMask = false;
      var worker = fabric.util.worker(this.makeTransparentMaskWorker);
      worker.onmessage = function(e){
        ctx.putImageData(e.data, 0, 0);
        cb && cb();
      }
      worker.postMessage({
        imageData: ctx.getImageData(0, 0, mask.width, mask.height),
        transparencyConstant: this.transparencyConstant
      });
    }else{
      cb && cb();
    }
  },
  greyValue: 0,
  switchMaskBackground: function(){
    this.greyValue = this.greyValue ? 0 : 255;
    var worker = fabric.util.worker(this.switchMaskBackgroundWorker);
    worker.onmessage = function(e){
      this.selectionContext.putImageData(e.data, 0, 0);
      this.canvas.renderAll();
    }.bind(this);
    var _imgData = this.selectionContext.getImageData(0, 0, this.maskElement.width, this.maskElement.height);
    worker.postMessage({data: _imgData, color : this.greyValue });
  },
  switchMaskBackgroundWorker: function(e,postMessage){
    var _data = e.data.data;
    var _color = e.data.color;
    for (var x = 0; x < _data.width; x++) {
      for (var y = 0; y < _data.height; y++) {
        var i = (x + y * _data.width ) * 4;
        if (_data.data[i + 3] ) {
          _data.data[i] = _color;
          _data.data[i + 1] = _color;
          _data.data[i + 2] = _color;
        }
      }
    }
    postMessage(_data);
  },
  transparencyConstant: 50,
  makeTransparentMaskWorker:function(e,postMessage){
    var _data = e.data.imageData;
    for (var x = 0; x < _data.width; x++) {
      for (var y = 0; y < _data.height; y++) {
        var i = (x + y * _data.width ) * 4;
        if (_data.data[i] > e.data.transparencyConstant || _data.data[i + 1] > e.data.transparencyConstant || _data.data[i + 2] > e.data.transparencyConstant) {
          _data.data[i] = 255;
          _data.data[i + 1] = 255;
          _data.data[i + 2] = 255;
          _data.data[i + 3] = 0;
        } else {
          _data.data[i] = 0;
          _data.data[i + 1] = 0;
          _data.data[i + 2] = 0;
          _data.data[i + 3] = 255;
        }
      }
    }
    postMessage(_data);
  },
  /**
   * set mask element and apply opacity using workers
   * @param mask
   */
  setMask: function (mask,cb) {
    if(!mask){
      return;
    }
    if(typeof mask == "string"){
      this._mask_loading = true;
      fabric.util.loadImage(mask,function(el){
        this._set_mask_image(el,cb);
      }.bind(this));
    }else{
      this._set_mask_image(mask,cb);
    }
  },
  _select_inner: function () {
    this.pathfinder.smartSelection();
    this.canvas.freeDrawingBrush.enable();
  },
  selectInner: function () {
    this._select_inner();
    this.renderMonochrome();
    this.canvas.freeDrawingBrush.enable();
  },
  _renderSelection: function () {
    var ctx = this.canvas.contextTop,
      v = this.canvas.viewportTransform;
    this.canvas.clearContext(this.canvas.contextTop);
    var zoom = this.canvas.getZoom();
    ctx.save();
    ctx.translate(this.left * zoom, this.top * zoom);
    ctx.transform(v[0], v[1], v[2], v[3], v[4], v[5]);
    ctx.beginPath();
    if (this.mask) {
      ctx.drawImage(this.maskElement, 0, 0);
    }
    ctx.restore();
  },
  maskOpacity: 1,
  renderMask: function () {
    var ctx = this.apertureContext;
    ctx.beginPath();
    ctx.rect(0, 0, this.width, this.height);
    ctx.fillStyle = 'black';
    ctx.fill();
    ctx.save();
    this.pathfinder.renderMask(this.apertureContext, this.mask);
  },
  renderMonochrome: function () {
    if (this.pathfinder.shouldModify) {
      this.pathfinder.modifySelection();
    }
    this.renderMask();
  },
  allowDrawing: false,
  cancelModal: function () {
    if (this.pathfinder.shouldModify) {
      this.pathfinder.modifySelection();
    }
    delete this.pathfinder.mask;
    delete this.pathfinder.oldMask;
    //this.mask = fabric.util.object.cloneDeep(this.pathfinder.mask);
    this.strokeWidth = 1;
    this.fill = this.inactiveOptions.fill;
    this.allowDrawing = false;
    this.lockMovementX = false;
    this.lockMovementY = false;
    if (this.mode === 'original') {
      this.mode = 'none';
    }
    this.canvas.renderAll();
  },
  editModal: function () {
    this.update();

    var _canvas = this.canvas;
    for (var i = 0; i < _canvas._objects.length; i++) {
      _canvas._objects[i].setVisible(false);
    }
    this.setVisible(true);
    //_canvas.deactivateAll();
    _canvas.backgroundImage.setOpacity(0.1);
    this.strokeWidth = 0;
    if (this.mode === 'none') {
      this.mode = 'original';
    }
    _canvas.renderAll();

    window.rect = this;
    window._canvas = _canvas;

    this.lockMovementX = true;
    this.lockMovementY = true;
    this.allowDrawing = true;
    this.canvas.freeDrawingBrush = this.canvas.pathfinderBrush;

    var size = {
      width: canvas.width * 0.9,
      height: canvas.height * 0.9
    };

    var pr = fabric.util.getProportions(this, size, 'fit');
    _canvas.viewportTransform = [pr.scale, 0, 0, pr.scale,
      (_canvas.width - pr.width ) / 2 - this.left * pr.scale,
      (_canvas.height - pr.height) / 2 - this.top * pr.scale
    ];

    this.setCoords();
    _canvas.renderAll();
  },
  update: function () {

    if (this.thumbElement) {
      this.thumbElement.width = this.width;
      this.thumbElement.height = this.height;
      this.renderThumb(this.thumbElement);
    }

    if (this.canvas.pathfinder) {
      this.maskElement.width = this.width;
      this.maskElement.height = this.height;
      // this.apertureElement.width = this.width;
      // this.apertureElement.height = this.height;
      if (!this.pathfinder) {

        this.pathfinder = this.canvas.pathfinder;
        var _this = this;
        this.pathfinder.on("selection:changed", function (event) {
          if (event.target == _this) {
            _this.mask = event.mask;
            _this.fire("selection:changed", event);
            //todo may influence on user expirience
          }
        })
      }
      this.pathfinder.mask = this.mask;
      this.pathfinder.target = this;
      this.pathfinder.setImage(this._originalElement);
      this.pathfinder.initCanvas(this.maskElement);
    }
  },
  run: function () {

    this.update();
    this.pathfinder.smartSelection();
    this.renderMonochrome();
  },
  getOriginalSize: function(){
    return {
      width: this._originalElement.naturalWidth || this._originalElement.width,
      height: this._originalElement.naturalHeight || this._originalElement.height
    };
  },
  _render: function (ctx, noTransform) {
    ctx.save();
    var
      x = (noTransform ? this.left : -this.width / 2),
      y = (noTransform ? this.top : -this.height / 2),
      w = this.width,
      h = this.height;

    ctx.restore();
    ctx.beginPath();
    ctx.moveTo(x, y);
    ctx.lineTo(x + w, y);
    ctx.lineTo(x + w, y + h);
    ctx.lineTo(x, y + h);
    ctx.lineTo(x, y);
    ctx.closePath();
    this._renderFill(ctx);

    if (this.mode === 'original') {
      if(this.maskOpacity != 1){
        this.maskElement && ctx.drawImage(this.maskElement, x, y, w, h);
      }
      if(this._originalElement){
        ctx.globalAlpha = this.maskOpacity;
        ctx.drawImage(this._originalElement, x, y, w, h);
      }
    } else if (this.mode === 'mask') {
      if(this.maskOpacity != 1){
        this._originalElement && ctx.drawImage(this._originalElement, x, y, w, h);
      }
      if(this.maskElement){

        ctx.globalAlpha = this.maskOpacity;
        ctx.fillStyle = this.fill;
        ctx.fillRect(x, y, w, h)

        ctx.drawImage(this.maskElement, x, y, w, h);
      }
    } else if (this.mode === 'mixed') {
      this._originalElement && ctx.drawImage(this._originalElement, x, y, w, h);
      ctx.globalAlpha = this.maskOpacity;
      this.maskElement && ctx.drawImage(this.maskElement, x, y, w, h);
    }
    ctx.globalAlpha = 1;

    this._renderStroke(ctx);
  },
  controls :fabric.util.object.extend({
    mbr:{visible: "{hasRotatingPoint}", x: "{width}/2",   y: "{height}+{rotatingPointOffset}/{zoom}", action: "rotate", cursor: "rotationCursor"},
    mlr:{visible: "{hasRotatingPoint}", x: "-{rotatingPointOffset}/{zoom}",   y: "{height/2}", action: "rotate", cursor: "rotationCursor"},
    mrr:{visible: "{hasRotatingPoint}", x: "{width}+{rotatingPointOffset}/{zoom}",   y: "{height/2}", action: "rotate", cursor: "rotationCursor"}
  },fabric.Object.prototype.controls),
  // drawControls: function (ctx, shape, offset) {
  //   if (!this.hasControls) {
  //     return this;
  //   }
  //   this.drawBoundsControls( ctx);
  //   this.drawExtraControls(ctx);
  // },
  renderThumb: function (_canvas) {
    _canvas.width = this.width;
    _canvas.height = this.height;
    var ctx = _canvas.getContext('2d');
    ctx.save();
    var _r = this.getBoundingRect();
    var _left, _top;
    if (this.originX == 'center' && this.originY == 'center') {
      var originPoint = this.translateToOriginPoint(
        this.getCenterPoint(),
        this.canvas._previousOriginX,
        this.canvas._previousOriginY);
      _left = originPoint.x;
      _top = originPoint.y;
    } else {
      _left = this.left;
      _top = this.top;
    }
    ctx.rotate(fabric.util.degreesToRadians(-this.angle));
    if (this._points) {
      ctx.beginPath();
      ctx.moveTo(this._points[0].x, this._points[0].y);
      for (var i = 1; i < this._points.length; i++) {
        ctx.lineTo(this._points[i].x, this._points[i].y);
      }
      ctx.closePath();
      ctx.clip();
    }

    ctx.drawImage(this.canvas.backgroundImage._element,-_left, -_top);
    ctx.restore();
  }
});

fabric.MaskRectangle.fromObject = function(options,callback){
  var _rect = new this(options);
  if(_rect.loaded){
    //  // callback && callback(_rect);
    return _rect;
  }else{
    _rect.on("loaded",function(){
      callback && callback(_rect)
    });
  }
};

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 92 */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(fabric) {
fabric.MaterialPoint = fabric.util.createClass(fabric.Object,{
  deactivationDisabled: true,
  type: "material-point",
  cornerSize: 5,
  width: 1,
  height: 1,
  strokeWidth: 0,
  cornerStyle: "circle",
  cornerAreaSize: 20,
  setCoords: fabric.Object.prototype.setExtraCoords,
  hasBoundsControls: false,
  hasBorders: false,
  _render: function(ctx,noTransform){
    var x = noTransform ? this.left : -this.width / 2 ,
      y = noTransform ? this.top : -this.height / 2;

    ctx.save();
    ctx.translate(x,y);
    ctx.beginPath();
    ctx.arc(0.5,0.5, 0.5, 0, 2 * Math.PI, false);
    this._renderFill(ctx);
    this._renderStroke(ctx);
    ctx.restore();
  },
  drawControls: function (ctx) {
    this.drawExtraControls(ctx);
  },
  setControlPoints: function () {
    return [
      {
        x: 0.5,
        y: 0.5,
        cursor: "moveCursor",
        area:  this.cornerAreaSize,
        size : this.cornerSize,
        style: this.cornerStyle,
        action: "drag",
        id: "d"
      }
    ]
  }
});

fabric.MaterialPoint.fromObject = function(options){
  return new fabric.MaterialPoint(options);
};

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 93 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

var path_initialize_overwritten = fabric.Path.prototype.initialize;

fabric.util.object.extend(fabric.Path.prototype, {
  accuracy: 0,
  initialize: function (path, options) {
    this.callSuper('initialize', options);
    path_initialize_overwritten.call(this, path, options);
    this._set_accuracy(this.accuracy, this.path);
  },
  translate: function (path, translateX, translateY) {
    var current;
    //if(this.path[0][0] === "m"){
    //  return;
    //}
    for (var i = 0, len = path.length; i < len; ++i) {

      current = path[i];

      switch (current[0]) { // first letter
        case 'L': // lineto, absolute
          current[1] += translateX;
          current[2] += translateY;
          break;
        case 'H':
          current[1] += translateX;
          break;
        case 'V': // verical lineto, absolute
          current[1] += translateY;
          break;
        case 'M':
          current[1] += translateX;
          current[2] += translateY;
          break;
        case 'C':
          current[1] += translateX;
          current[2] += translateY;
          current[3] += translateX;
          current[4] += translateY;
          current[5] += translateX;
          current[6] += translateY;
          break;
        case 'S':
          current[1] += translateX;
          current[2] += translateY;
          current[3] += translateX;
          current[4] += translateY;
          break;
        case 'Q': // quadraticCurveTo, absolute
          current[1] += translateX;
          current[2] += translateY;
          current[3] += translateX;
          current[4] += translateY;
          break;
        case 'T':
          current[1] += translateX;
          current[2] += translateY;
          break;
        case 'A':
          current[1] += translateX;//todo??
          current[2] += translateY;//todo ??
          current[6] += translateX;
          current[7] += translateY;
      }
    }
  },
  specialProperties: ["accuracy"],
  _set_accuracy: function (accuracy, path) {
    for (var i =0 ; i < path.length; i++) {
      for (var j = 1; j < path[i].length; j++) {
        path[i][j] = +path[i][j].toFixed(this.accuracy);
      }
    }
  },
  setAccuracy: function (accuracy) {
    this.accuracy = accuracy;
    if(!this._points)return;
    this._set_accuracy(accuracy, this.path);
  },
  storePathAsString: false,
  _toObject_overwritten: fabric.Path.prototype.toObject,
//todo use event "before:object";
  toObject: function (propertiesToInclude) {

    if(this.accuracy){
      this._set_accuracy(this.accuracy,this.path);
      this.left = +this.left.toFixed(this.accuracy);
      this.top  = +this.top.toFixed(this.accuracy);
      this.pathOffset.x = +this.pathOffset.x.toFixed(this.accuracy);
      this.pathOffset.y = +this.pathOffset.y.toFixed(this.accuracy);
    }

    var _obj = this._toObject_overwritten(propertiesToInclude);

    if (this.storeProperties.indexOf("*") == -1) {

      if (_obj.pathOffset && this.storeProperties.indexOf("pathOffset") == -1) {
        this.translate(_obj.path, _obj.pathOffset.x, _obj.pathOffset.y)
        this._set_accuracy(this.accuracy,_obj.path);
      }

      for (var i in _obj) {
        if (this.storeProperties.indexOf(i) == -1) {
          delete _obj[i];
        }
      }
      console.log("!!!")
    }
    if (this.storePathAsString) {
      _obj.path = _obj.path.join('')
    }
    return _obj;
  }
});

/**
 * Creates an instance of fabric.Path from an object
 * @static
 * @memberOf fabric.Path
 * @param {Object} object
 * @param {Function} callback Callback to invoke when an fabric.Path instance is created
 */
fabric.Path.fromObject = function (object, callback) {
  /* if (typeof object.path === 'string') {
   fabric.loadSVGFromURL(object.path, function (elements) {
   var path = elements[0],
   pathUrl = object.path;

   delete object.path;

   fabric.util.object.extend(path, object);
   path.setSourcePath(pathUrl);

   callback(path);
   });
   }
   else {*/

  var _scaled = object.scaleX || object.scaleY;

  var path = new fabric.Path(object.path, object);

  if(!_scaled){
    if(object.width){
      path.scaleX = object.width / path.width;
    }
    if(object.height){
      path.scaleY = object.height / path.height;
    }
  }

  callback && callback(path);
  return path;
  // }
};

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 94 */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(fabric) {
fabric.util.object.extend(fabric.PathGroup.prototype,{
  initialize_overwritten: fabric.PathGroup.prototype.initialize,
  initialize: function(paths, options){

    if(paths.constructor != Array){
      options = paths.toObject();
      delete options.paths;
      paths = paths.paths;
    }

    this.initialize_overwritten(paths, options);
  },
  extractColors: function () {
    var _colors = {};
    var _paths = this.paths;
    for (var i in _paths) {
      if (_paths[i].fill.type) {
        for (var j in _paths[i].fill.colorStops) {
          var _color = _paths[i].fill.colorStops[j].color;
          if (!_colors[_color]) _colors[_color] = [];
          _colors[_color].push({object: _paths[i], stop: _paths[i].fill.colorStops[j]});
        }

      } else {
        var _color = _paths[i].fill;
        if (!_colors[_color]) _colors[_color] = [];
        _colors[_color].push({object: _paths[i], color: _paths[i]});
      }
    }
    return _colors;
  }
})

fabric.PathGroup.fromElements = function (elements, object, url) {
  var _options = {
    toBeParsed: true,
    //originX: "center",
    //originY: "center"
  };

  //смещаем элементы так, чтобы их кооринаты начинались от 0.0
  if (elements.length) {

    var minX = Infinity,
      minY = Infinity;
    for (var i in elements) {
      minX = Math.min(elements[i].left, minX);
      minY = Math.min(elements[i].top, minY);
    }


    minX = Math.max(minX, 0);
    minY = Math.max(minY, 0);
    /* for (var i in elements) {
     elements[i].translate(-minX, -minY);
     elements[i].left -= minX;
     elements[i].pathOffset.x -= minX;
     elements[i].top -= minY;
     elements[i].pathOffset.y -= minY;
     }*/
  }

  var el = fabric.util.groupSVGElements(elements, _options, url);

  var scaleX = object.width ? object.width / el.width : null,
    scaleY = object.height ? object.height / el.height : null;
  if (scaleX && !scaleY) {
    scaleY = scaleX;
  }
  if (scaleY && !scaleX) {
    scaleX = scaleY;
  }
  if (!scaleY && !scaleX) {
    scaleX = scaleY = 1;
  }

  delete object.height;
  delete object.width;
  el.set(fabric.util.object.extend(object, {
    //left: 0, top: 0,
    scaleX: scaleX,
    scaleY: scaleY
  }));
  el.setLeft(object.left);
  el.setTop(object.top);
  return el;
};

// fabric.PathGroup.prototype.render = function(ctx,noTransform) {
//   if (!this.visible) {
//     return;
//   }
//   var x = noTransform ? 0 : - this.width * this.scaleX / 2,
//     y = noTransform ? 0 : - this.height * this.scaleY / 2;
//
//   ctx.save();
//   ctx.translate(x,y);
//
//   if (this.transformMatrix) {
//     ctx.transform.apply(ctx, this.transformMatrix);
//   }
//   this.transform(ctx);
//
//   this._setShadow(ctx);
//   this.clipTo && fabric.util.clipContext(this, ctx);
//   ctx.translate(-this.width/2, -this.height/2);
//   for (var i = 0, l = this.paths.length; i < l; ++i) {
//     this.paths[i].render(ctx, true);
//   }
//   this.clipTo && ctx.restore();
//   ctx.restore();
// }






fabric.PathGroup.fromURL = function (url, callback, object) {

  fabric.loadSVGFromURL(url,function(els){

    var el = new fabric.PathGroup(els, {toBeParsed:true});

    // //смещаем элементы так, чтобы их кооринаты начинались от 0.0
    // if (el.paths.length) {
    //
    //   var minX = Infinity,
    //     minY = Infinity;
    //   var maxX = -Infinity,
    //     maxY = -Infinity;
    //
    //   for (var i in el.paths) {
    //     var _p = el.paths[i];
    //     minX = Math.min(_p.left, minX);
    //     minY = Math.min(_p.top, minY);
    //     maxX = Math.max(_p.left + _p.width, maxX);
    //     maxY = Math.max(_p.top + _p.height, maxY);
    //   }
    //
    //   var _W = maxX - minX;
    //   var _H = maxY - minY;
    //   //
    //   //
    //   // minX = Math.max(minX, 0);
    //   // minY = Math.max(minY, 0);
    //   /* for (var i in elements) {
    //    elements[i].translate(-minX, -minY);
    //    elements[i].left -= minX;
    //    elements[i].pathOffset.x -= minX;
    //    elements[i].top -= minY;
    //    elements[i].pathOffset.y -= minY;
    //    }*/
    // }else{
    //   _W = 1;
    //   _H = 1;
    // }

    var scaleX = object.width ? object.width / el.width : null,
      scaleY = object.height ? object.height / el.height : null;
    if (scaleX && !scaleY) {
      scaleY = scaleX;
    }
    if (scaleY && !scaleX) {
      scaleX = scaleY;
    }
    if (!scaleY && !scaleX) {
      scaleX = scaleY = 1;
    }
    // console.log(object.width,el.width,object.height,el.height)
    // console.log(el);
    el.set( {
      scaleX: scaleX ,
      scaleY: scaleY
    });

    callback(el);
  });

  // fabric.loadSVGFromURL(url,function(els){
  //   callback(fabric.PathGroup.fromElements(els, object));
  // });
};

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 95 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {


  //fabric.DPI todo why do not use it?
/**
 * @author Denis Ponomarev
 * @email den.ponomarev@gmail.com
 */
//fabric.require("Photo",["Frame","SlideObject"], function() {
  fabric.Photo = fabric.util.createClass(fabric.Frame, {
    type: 'photo',
    frameTool: false,
    imageTools: false,
    filterTool: false,
    stateProperties: fabric.Frame.prototype.stateProperties.concat(["frame"]),
    _scaling_events_enabled: true,

    cloneSync: function(options){
      var _frame = new fabric.Photo(this);
      options && _frame.set(options);
      return _frame;
    },
    initialize: function (options) {

      options || ( options = {});
      this.callSuper('initialize',options);

      this.dpi = 0;
      this._create_sign();
      this._set_border(options.border , "border");
      this._set_border(options.border2,"border2");
      this._set_frame(options.frame);

      this.on({
        "added": function () {
          this._check_dpi();
        },
        "scaling": function () {
          this._apply_frame();
          this._update_frame();
          this._check_dpi();
        },
        "clipping:entered": function () {
          if (this._fabric_frame) {
            if(this.frame.position !== "back"){
              this._restoreObjectState(this._fabric_frame);
              this.remove(this._fabric_frame);
              this.canvas.add(this._fabric_frame);
            }
          }
        },
        "clipping:exited": function () {
          if (this._fabric_frame) {
            if(this.frame.position !== "back") {
              this.canvas.remove(this._fabric_frame);
              this.add(this._fabric_frame);
              this._apply_frame();
              this.canvas.renderAll();
            }
          }
        }
      });
    },

    _apply_frame: function () {
      this._fabric_frame && this._fabric_frame.set({
        left: 0 ,
        top: 0,
        width : this.width,
        height:  this.height
      })
    },
    _create_sign: function () {


      this._fabric_sign = new fabric.Text("", {
        fill: "yellow",
        stroke: "black",
        evented: false,
        visible: false,
        height: 20,
        fontSize: 24,
        fontFamily: "FontAwesome",
        left: this.width / 2 - 30,
        top: this.height / 2 - 35,
        textAlign: "center"
      });
      this._elements_to_update.push({
        element: this._fabric_sign,
        bottom: 35,
        right: 30
      });

      this._fabric_sign_text = new fabric.Text(Math.floor(this.dpi).toString(), {
        fill: "yellow",
        evented: false,
        visible: false,
        height: 5,
        fontSize: 10,
        left: this.width / 2 - 27,
        top: this.height / 2 - 12,
        textAlign: "center"
      });

      this._elements_to_update.push({
        element: this._fabric_sign_text,
        bottom: 12,
        right: 27
      });
      this.add(this._fabric_sign);
      this.add(this._fabric_sign_text);
    },
    _check_dpi: function () {
      //this.dpi_warning = true;
      this.dpi = this.getDPI();
      if (!this.canvas)return;//todo

      if (this.canvas.dpi && this.dpi < this.canvas.dpi) {
        this._fabric_sign.setVisible(true);
        this._fabric_sign_text.setVisible(true);
        this._fabric_sign_text.setText(Math.floor(this.dpi).toString());
        //this.slide.dpi_warning = true;
      } else {

        this._fabric_sign.setVisible(false);
        this._fabric_sign_text.setVisible(false);
        //if(!this._fabric_sign)return;
        //this.remove(this._fabric_sign);
        //delete this._fabric_sign;
        //this.slide.dpi_warning = this.slide.checkDPI();
      }
    },
    getDPI: function () {

      return;
      if (!this._original)return this.canvas.dpi;

      var INCH = 25.4; //mm

      var dims = [];

      dims.push(this._original.width / (this.width / INCH));
      dims.push(this._original.height / ( this.height / INCH));


      var _dpi = dims[0];

      for (var i = 1; i < dims.length; i++) {
        if (dims[i] < _dpi) {
          _dpi = dims[i]
        }
      }
      this.dpi = _dpi * 1;///this.canvas.scaleX;

      return _dpi;
    },
    supportedTypes: ["image"],

    _set_element: function (options, callback) {

      if (options.type == "image") {
        this._original = options.original;
        fabric.Image.fromURL((fabric.framesPath || "" ) + options.src, function (o) {
          o.on("rotating", fabric.util.stepRotating.bind(o));

          this._check_dpi();

          callback(o);
        }.bind(this));
      }

    },


    /**
     * ��������� �����
     * @param data - ����� �����
     */
    _set_border: function (border,name) {
      this[name] = border;
      if(!border)return;
      this["_fabric" + name] = new fabric.Path(this._fabric_shape.path,fabric.util.object.extend({
        fill: "transparent",
        selectable: false,
        originX: "center",
        originY: "center"
      },border));

      this.add(this["_fabric" + name]);
      if(border.position == "before"){
        this._objects.unshift(this._objects.pop());
      }

      var options = {
        left:   this._fabric_shape.left + this.width/2,
        top:    this._fabric_shape.top + this.height/2,
        scaleX: this._fabric_shape.scaleX * (border.scaleX || 1),
        scaleY: this._fabric_shape.scaleY * (border.scaleY || 1)
      };

      this["_fabric" + name].set(options);
    },
    setFrame: function (frame,cb) {

      var _this = this;
      if(frame && frame.src){

        fabric.util.loadImage(frame.src, function (img) {
          frame.image = img;
          _this._set_frame(frame);
          _this.canvas && _this.canvas.renderAll();
          cb && cb();
        })
      }else{
        _this._set_frame(frame);
        _this.canvas && _this.canvas.renderAll();
        cb && cb();
      }
    },
    _update_frame: function () {
      if(this.frame && this.frame.image && this.frame.slice) {
        var _canvas = this._fabric_frame._element;
        _canvas.width = this.width;
        _canvas.height = this.height;
        fabric.util.drawBorderImage(_canvas, this.frame.image, this.frame);
      }
    },
    _set_frame: function (frame) {
      if(this._fabric_frame){
        this.remove(this._fabric_frame);
        delete this._fabric_frame;
      }
      if(frame && frame.image) {

        //
        //if (!frame["border_image"]) {
        //    img.width = this.width;
        //    img.height = this.height;
        //}

        if (frame.width && frame.slice) {

          //Canvas for NodeJS
          var canvas = typeof Canvas !== 'undefined' && new Canvas() || document.createElement("canvas");

          canvas.width = this.width;
          canvas.height = this.height;
          fabric.util.drawBorderImage(canvas, frame.image, frame);
          //todo
          //var _src = canvas.toDataURL();
          //var image = new Image();
          //image.src = _src;
          this._fabric_frame = new fabric.Image(canvas);
          //
          //this._fabric_frame.width = this.width;
          //this._fabric_frame.height = this.height;

          //this.add(this._fabric_frame);
        } else {
          this._fabric_frame = new fabric.Image(frame.image);
        }


        this._fabric_frame.set({
          originX: "center",
          originY: "center",
          hasControls: false,
          evented: false
        });

        this.add(this._fabric_frame);
        if(this.frame && this.frame.position == "back"){
          this._fabric_frame.sendToBack();
        }
        this._apply_frame();
      }
      this.frame = frame;
    },


    /**
     * �������� �������� �����
     * @private
     */
    _create_frame: function () {

      if (this.frame) {
        this.frame.width = this._fabric_image.width;
        this.frame.height = this._fabric_image.height;
      }

      this._fabric_frame = new fabric.Image(this.frame, {
        originX: "center",
        originY: "center",
        perPixelTargetFind: true,
        width: this.data.geometry.width,
        height: this.data.geometry.height
      });
    },
    toObject: function(propertiesToInclude){
      var object = this.callSuper('toObject',propertiesToInclude);
      delete object.element;

      if(this.element){
        var _obj2 = this.element.toObject();
        object.src = _obj2.src;
        object.filters = _obj2.filters;
      }
      object.frame = fabric.util.object.extend({},this.frame);

      delete object.frame.image;
      return object;
    }
  });


  fabric.Photo.framesManager = {
    activeObject: null,
    show: function(object){
      this.activeObject = object;
      this.fire('show',object);
    }
  };
  fabric.util.observable(fabric.Photo.framesManager);

  var _OBJ_ACT = fabric.Object.prototype.actions;
  var _PHO = fabric.Photo.prototype;
  fabric.Photo.prototype.actions = fabric.util.object.extend({}, fabric.Frame.prototype.actions, {
    photoFrames: {
      insert: 'frameTool',
      title: "рамочки",
      className: "fa fa-heart-o",
      action: function(){
        fabric.Photo.framesManager.show(this.element);
      }
    },
    photoFilters: {
      insert: 'filterTool',
      title: "фильтр",
      className: "fa fa-filter",
      action: function(){
        fabric.Image.filterManager.show(this.element);
      }
    },
    removeWhiteFromBorders: fabric.util.object.extend({},fabric.Image.prototype.actions.removeWhiteFromBorders,{
      target: function(){
        return this.element;
      }
    }),
    historyBrush: fabric.util.object.extend({},fabric.Image.prototype.actions.historyBrush,{
      target: function(){
        return this.element;
      }
    })
  });




  fabric.Photo.fromObject = function(object,callback) {
    var _klass= this;
    var _app = object.application;
    delete object.application;
    object = fabric.util.object.cloneDeep(object);
    object.application = _app;

    if(object.src){
      object.element = {
        type: "image",
        src: object.src,
        filters: object.filters
      };

      delete object.src;
      delete object.filters;
    }


    var cb = fabric.util.queueLoad(3,function(){
      callback && callback(new _klass(object));
    });

    if(object.element){
      fabric.util.createObject(object.element,function(el){
        object.element = el;
        cb();
      });
    }else{
      cb();
    }


    if(object.frame && object.frame.src) {

      fabric.util.loadImage(object.frame.src, function (img) {
        object.frame.image = img;
        cb();
      })
    }else {
      cb();
    }

    if(object.shape && object.shape.src){
      fabric.loadSVGFromURL(object.shape.src,function(paths,options) {
        object.shape.paths  = paths;
        fabric.util.object.extend(object.shape,options);
        cb();
      })
    }else {
      cb();
    }

  };

  /**
   * Indicates that instances of this type are async
   * @static
   * @type Boolean
   * @default
   */
  fabric.Photo.async = true;

  fabric.util.createAccessors(fabric.Photo);

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 96 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {


//fabric.DPI todo why do not use it?

//fabric.require("Placeholder",["Frame","TextFrame","TextAreaMixin","Video"], function(){

  fabric.Placeholder = fabric.util.createClass(fabric.Frame, {
    type: 'placeholder',

    //stateProperties: fabric.Group.prototype.stateProperties.concat(["poster"]),
    _scaling_events_enabled: true,
    fitText: true,
      toObject: function(propertiesToInclude){
          var object = this.callSuper('toObject', propertiesToInclude);
          //if(this.clip){
          //    object.clip = this.clip;
          //}

          return object;
      },
    initialize: function (options) {
        options || ( options = {});

        var _text = options.text;
        delete options.text;
        this.callSuper('initialize', options);


        this.uploadButton = this._create_button({
            text: '',
        });
        if(!this.element){
            this.uploadButton.setVisible(true);
            this.button.setVisible(false);
            this.clipButton.setVisible(false);
        };


        if(this.uploadAction){
            this.uploadButton.on("click",this.uploadAction.bind(this));
        }


        this._initText(_text);

        this.text.setOptions({
            hoverCursor: "text",
            width: this.width,
            height: 60
        });

        this.on("clipping:entered",function(){
            this.text.evented = false;
        });
        this.on("clipping:exited",function(){
            if(this.text)this.text.evented = true;
        });


        this.text.on("editing:exited", function (e) {
            this.text.setOpacity(this.text.text ? 1 : 0);
            this.text.hoverCursor = "text";
            this._update_interface_element_position(this.text,this.textPosition);
        }.bind(this));
        this._create_play();

        this.textPosition = fabric.util.object.extend({},options.textPosition || this.textPosition);



        var pos = fabric.util.object.extend({},this.textPosition, {element: this.text});
        this._add_element_to_update(pos);
    },
      stateProperties: fabric.Group.prototype.stateProperties.concat(["poster"]),
      _is_clipping_available : function(e){

          if(e){
              this.text.setCoords();
              if(this.isPossibleTarget(e,this.text)){
                  return;
              }
          }
          return this.element && (this.clippingSupportedTypes == "*" || this.clippingSupportedTypes.indexOf(this.element.type)!= -1);
      },


    clippingSupportedTypes: ["image"], // * or ["image","video",...]
    /**
     * Создание элемента фото
     * @private
     */
    _create_play: function(){

        this.playButton = this._create_button({
            text: ''
        });

        this.playButton.on("click",function(){
            this.element.togglePlayPause();
            this.playButton.setText(this.element.paused? '': "");
        }.bind(this))


        var _self = this;
        //show/hide play/pause hint
        this.on('mouse:over', function(e) {
            if(this.playAvailable){
                this.playButton.setVisible(true);
                _self.canvas.renderAll();
            }
        });
        this.on('mouse:out', function(e) {
            this.playButton.setVisible(false);
            _self.canvas.renderAll();
        });
    },


  uploadAction: function(){
      var self = this;
      fabric.util.uploadImage(function(img){
          self.setElement({
              type: "image",
              src:   this.src,
              original: {
                  width: this.width,
                  height: this.height
              }
          })
      });
  },

    "textPosition": {
        bottom: 0,
        left: 0 ,
        right: 0
    },
    "text": {
        "text": "",
        "backgroundColor": "rgba(255,255,255,0.5)"
    },

    supportedTypes: ["image","video","path"],

      createButtons:function(){

          this._clip_end_function =  function(e){
              if(this.isPossibleTarget(e.e,this.submit)){
                  this.clipPhotoEnd();
              }
          }.bind(this);

          this.on('object:click', function(e) {
              var t = this.searchPossibleTargets(e.e);
              t.target && t.target.fire("click");
          });
          this.submit = this._create_button({
              text: "",
              options: {
                  visible: false
              },
              position:{
                  top: 0,
                  right: 26
              }
          });

          this.submit.on("click",this.clipPhotoEnd.bind(this));

          this.clipButton = this._create_button({
              text: "",
              options: {
                  visible: false
              },
              position:{
                  top: 0,
                  right: 26
              }
          });

          this.clipButton.on("click",this.clipPhotoStart.bind(this));

          //show/hide play/pause hint
          this.on('mouse:over', function(e) {
              if(this.element && !this.element._edited || this._pending){
                  this.button.setOpacity(1);
              }
              if(this._is_clipping_available()){
                  this.clipButton.setOpacity(1);
              }
              this.canvas.renderAll();
          });

          this.on('mouse:out', function(e) {
              if(!this._pending){
                  this.button.setOpacity(0);
              }
              this.clipButton.setOpacity(0);
              this.canvas.renderAll();
          });

          this._create_remove_button();

          if(this.element){
              this._set_element_callback(this.element);
          }

          this.on('added',function(){
              this.canvas.on('mouse:move', function(e) {
                  if(e.target == this || e.target == this.element){
                      var target = this.searchPossibleTargets(e.e).target ;

                      if(target){
                          this.canvas.hoverCursor = target.hoverCursor || "move";
                      }else{
                          this.canvas.hoverCursor = 'move';
                      }
                  }
                  //
                  //if(e.target == this || e.target == this.element &&  this.isPossibleTarget(e.e,this.submit)){
                  //    this.canvas.hoverCursor = 'pointer';
                  //}else{
                  //    this.canvas.hoverCursor = 'move';
                  //}
              }.bind(this));
          });

          this.on("clipping:entered",function(){
              this.submit.setVisible(true);
              this.clipButton.setVisible(false);
              this.button.setVisible(false);
          }.bind(this));

          this.on("clipping:exited",function(){
              this.submit.setVisible(false);
              this.clipButton.setVisible(true);
              this.button.setVisible(true);
          }.bind(this));


          this.on("element:loading",function(){
              this.button.setText("");
              this.button.setVisible(false);
              //this.button.false(val ? 26: 32);
          }.bind(this));

          this.on("element:loaded",function(){
              this.button.setText("");
              this.button.setVisible(true);
              //this.button.setFontSize(val ? 26: 32);
          }.bind(this));

          this.on("element:loaded",function(){

              if(this._is_clipping_available()) {
                  this.clipButton.setVisible(true);
                  this.button.setVisible(true);
                  this.element.on("dblclick", this.clipPhotoEnd.bind(this));
              }
          })
      },

      _create_button : function(data){
          var btn = new fabric.Text(data.text || "", fabric.util.object.extend({
              originX: "center",
              originY: "center",
              visible: false,
              width: 16,
              height: 16,
              fontSize: 26,
              fontFamily: "FontAwesome",
              fill: "white",
              shadow: { color: '#000', offsetX: 1,offsetY : 1,blur: 5 },
              hoverCursor: "pointer"
          },data.options));

          this._add_element_to_update(fabric.util.object.extend({
              element: btn
          },data.position));

          this.add(btn);

          btn.setCoords();
          return btn;
      },

    _remove_element: function(){

        if(this.element){
            if(this.element.type == "video"){
                this.playAvailable = false;
                // this.element.mediaElement.pause();
                // this.element.mediaElement.currentTime = 0;
                this.paused = true;
                //    delete this.element.mediaElement;
            }
            this.uploadButton.setVisible(true);
            this.text.setVisible(false);
        }
    },
    _set_element: function(options,callback){

        this.text && this.text.setVisible(true);
        this.uploadButton && this.uploadButton.setVisible(false);
        if(options.type == "image"){
            this._original = options.original;
            fabric.Image.fromURL(options.src,function(o){
                o.on("rotating", fabric.util.stepRotating.bind(o));
                callback(o);
            }.bind(this));
        }
        if(options.type == "video"){
            this._original = options.original;
            options.originX = "center";
            options.originY = "center";
            options.width = options.width || options.original.width;
            options.height = options.height || options.original.height;

            var el = fabric.Video.fromObject(options);



            el.on("rotating", fabric.util.stepRotating.bind(el));
            el.on("ready", function(){
                this.playAvailable = true;
            }.bind(this));
            callback(el);
        }

    }

});


    fabric.util.object.extend(fabric.Placeholder.prototype,fabric.TextAreaMixin);
    fabric.util.createAccessors(fabric.Placeholder);
    /**
     * @author Denis Ponomarev
     * @email den.ponomarev@gmail.com
     */
    fabric.Placeholder.fromObject = function(object, callback) {

        var instance = new fabric.Placeholder(object);
        callback && callback(instance);
    };

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 97 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {
var Bezier = __webpack_require__(10);
__webpack_require__(7);

fabric.Polyline = fabric.util.createClass(fabric.Object, fabric.BezierMixin,{
  type: 'polyline',
  hasRotatingPoint: false,
  stroke: "black",
  pointsLimits: false,
  hasBoundsControls: false,
  closed: false,
  cornerSize: 16,
  enderAreaSize: 4,
  extensionAreaEnabled: true,
  cornerStyle: "rect",
  maximumPoints: 4,
  points: [],
  _corner_cursors : {
    x:  'buttonCursor',
    p:  'defaultCursor',
    e:  'targetCursor'
  },
  _corner_actions : {
    x1: "add",
    x2: "remove",
    e1: "unshift",
    e2: "push"
  },
  stateProperties: ["top", "left", "width", "height", "angle", "points"],
  initialize: function (options) {
    options || ( options = {});
    options.points = fabric.util.object.cloneDeep(options.points);

    this.callSuper('initialize', options);

    this.on({
      "added": function () {
        this.setCoords();
      },
      "mousedown": function (event) {
        if (this.__corner/* && this.__corner[0] == "e"*/) {
          this.canvas._transformObject(event.e);
        }
      },
      "mouseout": function (event) {
        if (this.__magnet_point || this.__magnet_coordinate) {
          delete this.__magnet_coordinate;
          delete this.__magnet_point;
          this.canvas.renderAll();
          this.setCoords();
        }
      },
      "mousemove": function (event) {
        var pointer = this.canvas.getPointer(event.e);
        if (this.__corner) {
          if(this.__corner[0] != "x"){
            this.__magnet_point = this._controls[this.__corner];
            this.setCoords();
          }
          if (this.__corner[0] == "e") {
            this.__magnet_coordinate = {x: pointer.x - this.left, y: pointer.y - this.top};
            // this.setControlPoints();
          } else if (this.__magnet_coordinate) {
            delete this.__magnet_coordinate;
          }
        } else {
          if (this.__magnet_coordinate) {
            delete this.__magnet_point;
            delete this.__magnet_coordinate;
            this.setCoords();
          }
        }
        this.canvas.renderAll();
      }
    });

    if(this.shadow){
      this.setShadow(this.shadow);
    }
    this.setPoints(options.points);
    this.updateBbox();
  },
  _performPushAction: function (e, transform, pointer) {
    delete this.__magnet_coordinate;
    this.points.push({
      x: pointer.x - this.left,
      y: pointer.y - this.top,
    });
    transform.action = "shape";
    transform.corner = "p" + this.points.length;
    this.canvas.setCursor(this.canvas.freeDrawingCursor);
    this.canvas.renderAll();
  },
  _performUnshiftAction: function (e, transform, pointer) {
    delete this.__magnet_coordinate;
    this.points.unshift({
      x: pointer.x - this.left,
      y: pointer.y - this.top,
    });
    transform.action = "shape";
    transform.corner = "p1";
    this.canvas.setCursor(this.canvas.freeDrawingCursor);
    this.canvas.renderAll();
  },

  drawControlsInterface: function (ctx) {
    this.drawBezierShapeControls(ctx);
    this._drawMagnetLine(ctx);
  },
  _drawMagnetLine: function(ctx){
    if(this.__magnet_point && this.__magnet_coordinate){
      ctx.translate(-this.width/2, - this.height/2)
      ctx.beginPath();
      ctx.lineWidth = 3 ;
      ctx.strokeStyle = "red";
      ctx.moveTo(this.__magnet_point.x, this.__magnet_point.y);
      ctx.lineTo(this.__magnet_coordinate.x, this.__magnet_coordinate.y);
      ctx.stroke();
      ctx.beginPath();
      ctx.arc(this.__magnet_coordinate.x, this.__magnet_coordinate.y, this.cornerSize / 2, 0, Math.PI * 2, true);
      ctx.closePath();
      ctx.fill();
    }
  },
  _render: function (ctx, noTransform) {
    var x = noTransform ? this.left : -this.width / 2 ,
        y = noTransform ? this.top : -this.height / 2,
        _pc;

    ctx.save();
    ctx.translate(x,y);
    ctx.beginPath();
    ctx.moveTo(this.points[0].x,  this.points[0].y);

    for (var i = 0; i < this.points.length - 1; i++) {

      if(this.points[i].curve) {
        if(!this.points[i].outline){
          _pc = this.points[i].curve.points;
          ctx.quadraticCurveTo( _pc[1].x,  _pc[1].y,_pc[2].x,_pc[2].y);
        }
      }else{
        ctx.lineTo( this.points[i + 1].x,  this.points[i + 1].y);
      }
    }
    if(this.closed){
      if(this.points[this.points.length - 1].curve) {
        _pc = this.points[i].curve.points;
        ctx.quadraticCurveTo(_pc[1].x,  _pc[1].y, _pc[2].x,_pc[2].y);
      }
      ctx.closePath();
    }
    this.closed && this._renderFill(ctx);

    this._renderStroke(ctx);


    ctx.beginPath();
    for (i = 0; i < this.points.length - 1; i++) {
      if (this.points[i].outline) {
        var _ci = 0;
        while(!this.points[i].outline.curves[++_ci]._linear){
          this.drawCurve(ctx, this.points[i].outline.curves[_ci]);
        }
        this.points[i].outline.__middle = _ci;
      }
    }
    for (i = this.points.length; i --;) {
      if (this.points[i].outline) {
        _ci = this.points[i].outline.__middle;
        while(this.points[i].outline.curves[++_ci]){
          this.drawCurve(ctx, this.points[i].outline.curves[_ci]);
        }
      }
    }
    ctx.closePath();
    this._renderFill(ctx);
    this._renderStroke(ctx);

    ctx.restore();
  },
  merge: function (polyline,pIndex1,pIndex2) {
    var i,
        _x = polyline.left - this.left,
        _y = polyline.top - this.top,
        _points = this.points,
        _action,
        _PP = polyline.points;

    if(pIndex1) {
      _action = "push";
      _points.pop();
    }else{
      _action = "unshift";
      _points.shift();
    }
    var addPoint = function (main_point,reversePoint){
      var curve_point = reversePoint && reversePoint.c;
      var new_point = {
        x: main_point.x + _x,
        y: main_point.y + _y,
      };
      if(curve_point){
        new_point.c = {
          x: curve_point.x + _x,
          y: curve_point.y + _y,
        }
      }
      _points[_action](new_point);
    };
    if(pIndex2 == 0){
      for(i = 0 ; i < _PP.length; i++){
        addPoint(_PP[i] , _PP[pIndex1 ? i :  i - 1]);
      }
    }else{
      for(i = _PP.length ; i--;){
        addPoint(_PP[i] , _PP[pIndex1 ? i - 1: i]);
      }
    }
    polyline.remove();
    for(i =0; i < _points.length; i++){
      if(_points[i].c && !_points[i].curve){
        this._makeCurve(_points[i],_points[i].c,_points[i + 1]);
      }
    }
    this.updateBbox();
    this.canvas.renderAll();
  },
  getControlPoint: function (id) {
    return fabric.util.object.findWhere(this._controls,{id: id});
  },
  setExtraControls: function(controls){
    this.addPointsControls(controls);
    this.addExtensionAreaControls(controls);
  },
  addExtensionAreaControls: function(controls){

    var  pts = this.points;
    var _last = pts.length - 1;
    if(this.extensionAreaEnabled){
      controls["e1"] = {
        action: "unshift",
        x: pts[0].x,
        y: pts[0].y,
        style: this.cornerStyle,
        area:  this.enderAreaSize,
        visible: true
      };
      controls["e2"] = {
        action: "push",
        x: pts[_last].x,
        y: pts[_last].y,
        style: this.cornerStyle,
        area:  this.enderAreaSize,
        visible: true
      };
    }
  },
  checkMerge: function () {
    var target = this, _tlast = this.points.length - 1;
    var p1 = this.points[0],
      p2 = this.points[_tlast],
      _distance = fabric.Point.prototype.distanceFrom;
    p1 = {
      x : p1.x + this.left,
      y:  p1.y + this.top
    };
    p2 = {
      x : p2.x + this.left,
      y:  p2.y + this.top
    };

    var _dist = 10;

    this.canvas._objects.some(function(obj) {
      if (obj == target || obj.type !== "polyline")return false;
      var _olast = obj.points.length - 1;

      var p3 = obj.points[0];
      var p4 = obj.points[_olast];
      p3 = {
        x : p3.x + obj.left,
        y:  p3.y + obj.top
      };
      p4 = {
        x : p4.x + obj.left,
        y:  p4.y + obj.top
      };

      if(_distance.call(p1, p3) < _dist){
        target.merge(obj,0,0)
      }
      if(_distance.call(p1, p4) < _dist){
        target.merge(obj,0,_olast)
      }
      if(_distance.call(p2, p3) < _dist){
        target.merge(obj,_tlast,0)
      }
      if(_distance.call(p2, p4) < _dist){
        target.merge(obj,_tlast,_olast)
      }
    })
  }
});

fabric.Polyline.fromObject = function (object) {
  return new this(object);
};


fabric.util.createAccessors(fabric.Polyline);

__webpack_require__(107);




if (fabric.objectsLibrary) {
  fabric.util.object.extend(fabric.objectsLibrary, {
    shape: {
      type: "polyline",
      points: function (w, h) {
          return [
          {x: 25, y: 1},
          {x: 31, y: 18},
          {x: 49, y: 18},
          {x: 35, y: 29},
          {x: 40, y: 46},
          {x: 25, y: 36},
          {x: 10, y: 46},
          {x: 15, y: 29},
          {x: 1, y: 18},
          {x: 19, y: 18}
        ];
      },
      "stroke": "black",
      "fill": "blue"
    }
  });
}

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 98 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {



//fabric.DPI todo why do not use it?
/**
 * @author Denis Ponomarev
 * @email den.ponomarev@gmail.com
 */
//fabric.require("Raster",[], function() {
fabric.Raster = fabric.util.createClass(fabric.Image, {
  type: 'raster',
  colors: null,
  _color_areas: null,
  colorAreas: null,
  optionsOrder: ["colorAreas","colors"],
  initialize: function (img, options,callback) {

    this.colorAreas = [];
    this._color_areas = [];
    this.colors = {};
    this.callSuper('initialize', img, options, function(el){
      callback(this);
    }.bind(this));
  },
  setColorAreas: function (val,callback) {

    var cb = fabric.util.queueLoad(val.length + 1,function(){
      callback && callback(this);
    }.bind(this));

    var _this = this;
    for(var i in val){
      this.colorAreas[i] = val[i];
      if(val[i].src){
        fabric.Image.fromURL(val[i].src,function(index,el){
          el.width = _this.width;
          el.height = _this.height;
          _this._color_areas[index] = {
            image: el,
            filters: [
              new fabric.Image.filters.Mask({'mask': el})
            ]
          };
          if(this.colors[index]){
            this.setColor(index,this.colors[index],cb)
          }else{
            cb();
          }
        }.bind(this,i));
      }else{
        _this._color_areas[i] = {
        };
        cb();
      }
    }
    cb();
  },
  setColor: function (index,options,callback) {
    var _this = this;
    var colorArea = this._color_areas[index];
    this.colors[index] = options;

    if(!colorArea || !colorArea.image){
      return callback();
    }


    var _Blend = fabric.Image.filters.Blend;


    if(!options){
      //do not fill
      colorArea.filters.length = 1;
      createColorArea();
    }else if(options.constructor == String){

      // var _c = fabric.Color.colorNameMap[fabric.util.string.toDashed(colors[i].replace(/\s/, ""))];
      // if (!_c) {
      //   console.warn("HEX Code of '" + colors[i] + "' Not Found!");
      // }

      //fill a color
      if(!options.startsWith("rgb") && !options.startsWith("#") && !fabric.Color.colorNameMap[options]){
        console.log("color '" + options + "' not defined");
        options = "#000";
      }
      colorArea.filters[1] = new _Blend({
        color: options,
        mode: "multiply"
      });
      createColorArea()
    }else{
      //fill a texture
      colorArea.options = fabric.util.object.cloneDeep(options);
      fabric.Image.fromURL(colorArea.options.src,function(el){
        colorArea.options.image = el;
        colorArea.filters[1] = new _Blend(colorArea.options);
        createColorArea();
      })
    }


    function createColorArea() {
      var _image = new fabric.Image(_this._filteredEl || _this._originalElement);
      colorArea.canvas = _image.applyFilters(callback, colorArea.filters, _this._filteredEl || _this._originalElement);
    }

  },
  getColor: function (index) {
    return this.colors[index];
    //return this._color_areas[index].filters[1].color;
  },
  setColors: function (colors,callback) {

    var cb = fabric.util.queueLoad(colors.length,function(){

      this.fire("colors:changed", colors);
      this.fire("modified");
      //this.canvas && this.canvas.fire('object:modified', { target: this });
      callback && callback();
    }.bind(this));

    for(var i= 0; i< colors.length ;i ++){

      this.setColor(i,colors[i],cb)
    }
  },
  /**
   * @private
   * @param {CanvasRenderingContext2D} ctx Context to render on
   */
  _render: function(ctx, noTransform) {
    var x, y, imageMargins = this._findMargins(), elementToDraw;

    x = (noTransform ? this.left : -this.width / 2);
    y = (noTransform ? this.top : -this.height / 2);

    if (this.meetOrSlice === 'slice') {
      ctx.beginPath();
      ctx.rect(x, y, this.width, this.height);
      ctx.clip();
    }

    if (this.isMoving === false && this.resizeFilters.length && this._needsResize()) {
      this._lastScaleX = this.scaleX;
      this._lastScaleY = this.scaleY;
      elementToDraw = this.applyFilters(null, this.resizeFilters, this._filteredEl || this._originalElement, true);
    }
    else {
      elementToDraw = this._element;
    }
    elementToDraw && ctx.drawImage(elementToDraw,
      x + imageMargins.marginX,
      y + imageMargins.marginY,
      imageMargins.width,
      imageMargins.height
    );
    for(var i in this._color_areas){
      elementToDraw = this._color_areas[i].canvas;
      elementToDraw && ctx.drawImage(elementToDraw,
        x + imageMargins.marginX,
        y + imageMargins.marginY,
        imageMargins.width,
        imageMargins.height
      );
    }

    this._renderStroke(ctx);
  },
  toObject : function() {
    var _obj = this.callSuper('toObject');
    //_obj.height = this._original_height;
    _obj.colors = this.colors;
    _obj.colorAreas = this.colorAreas;
    return _obj;
  }
});

fabric.Raster.prototype.actions = fabric.util.object.extend({},{
  colors: {
    type:   'menu',
    title: 'color menu',
    menu:   function(){
      var _menu = [];
      for(var key in this._color_areas){
        _menu.push({
          title: "Цвет",
          args:   key,
          value: {
            get:    function(key){
              var color = this.getColor(key);
              if(color.constructor !== String){
                return "#000000"
              }
              return color;
            },
            set:    function(key,value){
              this.setColor(key,value);
              this.canvas.renderAll();
            }
          },
          type:       "color"
        })
      }
      return _menu;
    }
  }
});


fabric.Raster.fromObject = function(object, callback) {

  fabric.util.initImageAndFilters(object,function(img){
    var instance = new fabric.Raster(img, object,callback);
  })
};

/**
 * Indicates that instances of this type are async
 * @static
 * @type Boolean
 * @default
 */
fabric.Raster.async = true;

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 99 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {
//fabric.require("SkewObject",["ShapeMixin"], function() {



    fabric.SkewObject = {

          drawControls: function (ctx, shape, offset) {
            if (!this.hasControls) {
              return this;
            }
            this.drawBoundsControls( ctx);
            this.drawShapeControls(ctx);
          },
        initSkewPoints: function () {
            //fabric.util.object.extend(this, fabric.ShapeMixin);
            this._initPoints();
            this.extraControls = this.extraControls || {};
            this.extraControls.skewTR = {x: this.width - 5, y: 0};
            this.extraControls.skewBL = {x: 5, y: this.height};

            this._corner_actions = this._corner_actions || {};
            this._corner_actions.skewTR = "skew";
            this._corner_actions.skewBL = "skew";

            this._controlsVisibility.skewTR = true;
            this._controlsVisibility.skewBL = true;
            //fabric.util.object.extend(this, fabric.SkewObject);
        },

        _performSkewAction: function (e, transform, pointer) {
            //this.extraControls.curve
            //this.extraControls.curve.y = transform.point.y;

            if (transform.corner == "skewBL") {
                //_points[order].x = _point.x;
                this.skewX = Math.atan2(transform.point.x, this.height) / Math.PI * 180;
            }
            if (transform.corner == "skewTR") {
                //_points[order].y = _point.y;
                this.skewY = Math.atan2(transform.point.y, this.width) / Math.PI * 180;
            }
        }
    };

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 100 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {


//fabric.require("SlideImage",["SlideObject"/*,"Pathfinder"*/],function() {

var ImageInitOverWritten = fabric.Image.prototype.initialize;
fabric.util.object.extend(fabric.Image.prototype, {

  async: true,
  contentOffsets: null,
  initialize: function (element, options, callback) {
    options || (options = {});
    this.filters = [];
    this.resizeFilters = [];


    if (options.originalSrc) {
      this._edited = true;
      fabric.util.loadImage(options.originalSrc, function (img) {
        this._originalElement = img;
      }.bind(this));
    }

    this._initElement(element, options, callback && function () {
        fabric.Object.prototype.initialize.call(this, options,callback);
      }.bind(this));//adding callback
  },
  _initElement: function (element, options, callback) {
    this.setElement(fabric.util.getById(element), callback, options);
    fabric.util.addClass(this.getElement(), fabric.Image.CSS_CANVAS);
  },
  /**
   * Sets crossOrigin value (on an instance and corresponding image element)
   * @return {fabric.Image} thisArg
   * @chainable
   */
  setCrossOrigin: function(value) {
    this.crossOrigin = value;
    if(this._element){
      this._element.crossOrigin = value;
    }
    return this;
  },
  setElement: function(element, callback, options) {

    var _callback, _this;

    this._element = element;
    this._originalElement = element;
    this._initConfig(options);
    // this.setOptions(options );
    // this._setWidthHeight(this);
    // if (this._element && this.crossOrigin) {
    //   this._element.crossOrigin = this.crossOrigin;
    // }


    if (this.resizeFilters.length === 0) {
      _callback = callback;
    }
    else {
      _this = this;
      _callback = function() {
        _this.applyFilters(callback, _this.resizeFilters, _this._filteredEl || _this._originalElement, true);
      };
    }

    if (this.filters.length !== 0) {
      this.applyFilters(_callback);
    }
    else if (_callback) {
      _callback(this);
    }

    return this;
  },
  /**
   * @private
   * @param {CanvasRenderingContext2D} ctx Context to render on
   * @param {Boolean} noTransform
   */
  _render: function(ctx, noTransform) {
    var x, y, imageMargins = this._findMargins(), elementToDraw;

    x = (noTransform ? this.left : -this.width / 2);
    y = (noTransform ? this.top : -this.height / 2);

    if (this.meetOrSlice === 'slice') {
      ctx.beginPath();
      ctx.rect(x, y, this.width, this.height);
      ctx.clip();
    }

    if (this.isMoving === false && this.resizeFilters.length && this._needsResize()) {
      this._lastScaleX = this.scaleX;
      this._lastScaleY = this.scaleY;
      elementToDraw = this.applyFilters(null, this.resizeFilters, this._filteredEl || this._originalElement, true);
    }
    else {
      elementToDraw = this._element;
    }
    this._renderFill(ctx);
    elementToDraw && ctx.drawImage(elementToDraw,
      x + imageMargins.marginX,
      y + imageMargins.marginY,
      imageMargins.width,
      imageMargins.height
    );

    this._stroke(ctx);
    this._renderStroke(ctx);
  },
  toObjectNative: fabric.Image.prototype.toObject,
  toObject:     function(){
    var obj = fabric.Image.prototype.toObjectNative.apply(this,arguments);
    if(obj.src.indexOf(fabric.util.mediaRoot) == 0){
      obj.src = obj.src.replace(fabric.util.mediaRoot,"");
    }
    return obj;
  },
  imageTools:     false,
  photoshopTools  : false,
  cloneSync: function() {
    var _object = this.toObject();
    delete _object.filters;
    var clone = new fabric.Image(this._element,_object);
    clone._filteredEl = this._filteredEl;
    clone.filters = this.filters;
    return clone;
  },
  revertChanges: function() {
    var pathfinder = this.canvas.getPathfinder();
    if (pathfinder.target && pathfinder.target == this){
      pathfinder.hide();
    }

    if(this._element == this._originalElement){
      return;
    }

    this.filters.length = 0;
    if (this._filteredEl) {
      delete this._filteredEl;
    }
    delete this._edited;
    this._element = this._originalElement;

    this.fire("content:modified",{
      bounds: {minX: 0, minY: 0, maxX: this._element.width, maxY: this._element.height }
    });


    this.canvas.renderAll();
  },
  removeWhite: function(threshold,removeAll,callback) {


    var rwf = _.findWhere(this.filters, {type: 'RemoveWhiteDP'});

    if(rwf) {
      rwf.options.colorThreshold = threshold;
      rwf.options.fromCorners = !removeAll;
    }else{
      rwf = new fabric.Image.filters.RemoveWhiteDP({
        fromCorners: !removeAll,
        blurRadius: 2,
        colorThreshold: threshold
      });
      this.filters.push(rwf);
    }

    var _this = this;
    this.applyFilters(function(){
      //_this.width = _this._element.width;
      //_this.height = _this._element.height;
      _this.canvas.renderAll();
      _this.fire("content:modified",{filter: rwf, bounds: rwf.bounds});
      callback && callback();
    });
  },
  removeWhiteAll: true
});

var _IMG = fabric.Image.prototype;


if(_IMG.actions == fabric.Object.prototype.actions ){
  _IMG.actions = fabric.util.object.extend({},fabric.Object.prototype.actions);
}

_IMG.actions = fabric.util.object.extend(_IMG.actions,{
  removeWhiteFromBorders: {
    title: 'Remove Background',
    type: 'effect',
    className:   "fa fa-dot-circle-o",
    effectTpl:
    '<button id="select-colors-action-button" class="fa fa-check"></button>'+
    '<input id="select-colors-checkbox" type="checkbox">' +
    '<input id="select-colors-threshold" type="range"   min="1" max="255">',
    actionParameters: function(el,data){
      var
        actionChk = el.find('#select-colors-checkbox'),
        actionBtn = el.find('#select-colors-action-button');
      data.thresholdEl = el.find('#select-colors-threshold');

      data.removeWhiteAll = actionChk.is(":checked");
      actionChk.change(function(){
        data.removeWhiteAll = actionChk.is(":checked")
      });
      actionBtn.click(function(){
        data.action();
      });
      if(!data.__action){

        data.__action = data.action;
        data.action = function(){
          data.__action(parseInt(data.thresholdEl.val()),data.removeWhiteAll)
        };
      }
    },
    action: _IMG.removeWhite,
    insert:     'imageTools'
  },
  advancedTools: {
    type: 'effect',
    effectTpl:
    '<div id="editor-tools" class="inline-actions compact"></div>'+
    '<div class="checkboard" ><div id="pathfinder"></div></div>',
    className: 'fa fa-pencil-square-o',
    title: "advanced tools",
    action: function(){
      var pathfinder = this.canvas.getPathfinder();
      pathfinder.target = this;
      pathfinder.setPicture(this._element);
      pathfinder.show();
    },
    actionParameters: function(el,data){

      var pathfinder = this.canvas.getPathfinder();
      pathfinder.canvas = this.canvas;
      fabric.Toolbar.create(pathfinder, 'editor-tools');

      pathfinder.setContainer('pathfinder');

      // if (pathfinder.target)pathfinder.hide();
      pathfinder.target = this;
      pathfinder.setPicture(this._element);
      pathfinder.show();
    },
    insert:     'photoshopTools'
  },
  historyBrush: {
    className: 'fa fa-history',
    title: "revert to orignal image",
    action: _IMG.revertChanges,
    observe:  "content:modified",
    visible:     function(){
      return !!this._filteredEl || this._edited;
    },
    insert:     'imageTools'
  },
  filters: {
    insert:         "filterTool",
    title:          "фильтр",
    itemClassName:  "filters-selector",
    className:      "fa fa-filter",
    type:           "select",
    templateSelection: function(state, container) {
      if (state.any) {
        return state.text;
      }
      return $('<span><span class="color-span" style="background-color:' + state.text + '"></span>' + state.text + '</span>');
    },
    templateResult: function(state, container,data) {
      var $el = $('<span>' + state.text + '</span>');
      if(state.id != "none"){
        var $canvas = $('<canvas>');
        fabric.util.drawFilter($canvas[0],data.target.src, state.id ,{
          height: 22
        });
        $el.prepend($canvas);
      }
      return $el;
    },
    value:      {
      set : function(val,filtersData){
        var options = false;
        if(val == "none"){
          val = false;
        }else{
          var _f = _.findWhere(filtersData,{id: val});
          _f.enabled = !_f.enabled;
          for (var i in _f.options) {
            if ($.isNumeric(_f.options[i])) {
              _f.options[i] = parseFloat(_f.options[i]);
            }
          }
          if(_f.enabled){
            options = {};
            for(var i in _f.options){
              options[i] = _f.options[i].value;
            }
          }


        }
        this.setFilter({
          type:     val,
          options:  options,
          replace:  true
        });
      },
      get: function(){
        return this.filters.length ? fabric.util.string.capitalize( this.filters[0].type ,true) : "none"
      },
      options: function(){

        var _filters = this.getFiltersData();
        for(var i in _filters){
          _filters[i].id = _filters[i].type;
        }
        return [{
          id:     'none',
          text:     'original',
          enabled: !this.filters || !this.filters.length
        }].concat(_filters);

      }
    }
  }
});


fabric.util.initFilters = function (img, object, callback) {

  // if (fabric.version >= 1.6) {
  fabric.Image.prototype._initFilters.call(object, object.filters, function (filters) {
    object.filters = filters || [];
    fabric.Image.prototype._initFilters.call(object, object.resizeFilters, function (resizeFilters) {
      object.resizeFilters = resizeFilters || [];
      callback(img, object);
    });
  });
  // } else {
  //   fabric.Image.prototype._initFilters.call(object, object, function (filters) {
  //     object.filters = filters || [];
  //     callback(img, object);
  //   });
  // }
};

fabric.util.initImageAndFilters = function (object, callback) {
  if (object.src) {
    fabric.util.loadImage(object.src, function (img) {
      delete object.src;
      fabric.util.initFilters(img, object, callback);
    }, null, object.crossOrigin);
  } else {
    fabric.util.initFilters(null, object, callback);
  }
};


fabric.Image.fromObject = function (object, callback) {
  fabric.util.initImageAndFilters(object, function (img, object) {
    var instance = new fabric.Image(img, object, callback);
  })
};


fabric.Image.prototype._to_object_overwritten = fabric.Image.prototype.toObject;
fabric.Image.prototype.toObject = function (opt) {
  var obj = fabric.Image.prototype._to_object_overwritten.call(this, opt);


  if (this._edited) {
    obj.originalSrc = this._original_src || this._originalElement.src || this._element.src;
    obj.src = this._element.src;
  } else {
    obj.src = this._original_src || this._originalElement.src || this._element.src;
  }
  if (this.contentOffsets) {
    obj.contentOffsets = this.contentOffsets;
  }


  if (!this.includeDefaultValues) {
    if (!obj.filters.length)delete obj.filters;
  }
  //if(this._originalElement){
  //    obj.thumb = this._element.src;
  //}

  return obj;
};




fabric.Image.prototype.extractColors = function () {
  var _colors = fabric.MagicWand.extractColors(this._element);
  var colors = {};
  for(var i in _colors){
    var _str = "rgb(" + _colors[i].join(",") + ")";
    colors[_str] = {};
  }
  return colors;
};

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 101 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {



  //fabric.require('SlideText', ['SlideObject'], function () {
  var textInitialize = fabric.Text.prototype.initialize;

fabric.util.object.extend(fabric.Text.prototype,{
    textInitialize: textInitialize,
    editTool: false,
    advancedColorsTools: false,
    textFontSizeTools: false,
    textAligmentTools: false,
    advancedTextStyleTools: false,
    rasterizeTool: false,
    rasterizeKlass: fabric.Image,



    initialize: function (text,options) {
      this._initEntity(options);
      this.textInitialize( text,options);
       // this.updateCache();
    },
    _render_cache: function (ctx) {
      ctx.save();
      ctx.scale(
        this.scaleX * (this.flipX ? -1 : 1),
        this.scaleY * (this.flipY ? -1 : 1)
      );
      this.transform(ctx);
      this._setShadow(ctx);
      ctx.translate(-this.width / 2, -this.height / 2);
      ctx.drawImage(this._cache, 0, 0, this.width, this.height);
      ctx.restore();
    },
    updateCache: function () {

      var size = {
        width: this.width * this.canvas.dotsPerUnit,
        height: this.height * this.canvas.dotsPerUnit
      };

      var _clipTo = this.clipTo;
      delete this.clipTo;
      this._cache = fabric.util.createCanvasElementWithSize(size);
      var ctx = this._cache.getContext("2d");
      ctx.scale(
        this.canvas.dotsPerUnit,
        this.canvas.dotsPerUnit);
      ctx.translate(this.width / 2, this.height / 2);

      this.render(ctx, true);
      this.render = this._render_cache;
      this.clipTo = _clipTo;

    },
    rasterizeText: function () {
      this.updateCache();
      var img = fabric.util.createImage();

      img.onload = function () {
        var obj = this.toObject();
        obj.width = img.width;
        obj.height = img.height;
        obj.scaleX = this.scaleX * (this.height / img.height);
        obj.scaleY = this.scaleY * (this.width / img.width );
        obj.rasterizedType = obj.type;
        delete obj.type;

        var el = new this.rasterizeKlass(img, obj);
        this.canvas.add(el);
        this.canvas.remove(this);
        setTimeout(function () {
          this.canvas.setActiveObject(el);
          this.canvas.renderAll();
        }.bind(this))
      }.bind(this);
      img.src = this._cache.toDataURL();
      //this.on('modified',this.updateCache.bind(this));
    },
    getStyle: function (styleName) {
      var object = this;
      return (object.getSelectionStyles && object.isEditing)
        ? (object.getSelectionStyles()[styleName] || object[styleName])
        : (object[styleName] || object['__' + styleName] || '');
    },
    getPattern: function (url) {
      var _fill = this.getStyle('fill ');
      return _fill && _fill.source;
    },
    setPattern: function (url) {
      if (!url) {
        this.setStyle('fill');
      } else {
       // var _texture = _.findWhere(this.project.textures, {id: url});
        var _this = this;
        fabric.util.loadImage(url, function(img) {
          _this.setStyle('fill', new fabric.Pattern({
            source: img,
            repeat: 'repeat'
          }));
        });
      }
    },
    getOpacity: function () {
      return this.getStyle('opacity') * 100;
    },
    setOpacity: function (value) {
      this.setStyle('opacity', parseInt(value, 10) / 100);
    },
    getRadius: function () {
      return this.get('radius');
    },
    setShadow: function(options) {
      return this.setProperty('shadow', options ? new fabric.Shadow(options) : null);
    },
    setProperty: function (prop, value) {
      this[prop] = value;
      this.canvas && this.canvas.renderAll();
    },
    setRadius: function (value) {
      this.setProperty('radius', value);
    },
    getSpacing: function () {
      return this.get('spacing');
    },
    setSpacing: function (value) {
      this.setProperty('spacing', value);
    },
    getReverted: function () {
      return this.get('reverted');
    },
    setReverted: function (value) {
      this.setProperty('reverted', value);
    },
    getFill: function () {
      return this.getStyle('fill');
    },
    setFill: function (value) {
      this.setStyle('fill', value);
    },
    getText: function () {
      return this.get('text');
    },
    setText: function (value) {
      this.setProperty('text', value);
    },
    getTextAlign: function () {
      return this.get('textAlign');
    },
    setTextAlign: function (value) {
      this.setProperty('textAlign', value.toLowerCase());
    },
    getFontFamily: function () {
      return this.get('fontFamily');
    },
    setFontFamily: function (value) {
      this.setStyle('fontFamily', value);
    },
    getStyles: function(){
      return this.styles || {
          fill :                this.fill,
          fontSize :            this.fontSize,
          textBackgroundColor : this.textBackgroundColor,
          textDecoration :      this.textDecoration,
          fontFamily :          this.fontFamily,
          fontWeight :          this.fontWeight,
          fontStyle :           this.fontStyle,
          stroke :              this.stroke,
          strokeWidth :         this.strokeWidth
        };
    },
    getBgColor: function () {
      return this.get('backgroundColor');
    },
    setBgColor: function (value) {
      this.setProperty('backgroundColor', value);
    },
    getTextBgColor: function () {
      return this.get('textBackgroundColor');
    },
    setTextBgColor: function (value) {
      this.setProperty('textBackgroundColor', value);
    },
    getStroke: function () {
      return this.getStyle('stroke');
    },
    setStroke: function (value) {
      this.setStyle('stroke', value);
    },
    getStrokeWidth: function () {
      return this.getStyle('strokeWidth');
    },
    setStrokeWidth: function (value) {
      this.setStyle('strokeWidth', parseInt(value, 10));
    },
    decreaseFontSize: function () {
      this.setStyle('fontSize', parseInt(this.getStyle('fontSize')) - 1);
    },
    increaseFontSize: function () {
      this.setStyle('fontSize', parseInt(this.getStyle('fontSize')) + 1);
    },
    getFontSize: function () {
      return this.getStyle('fontSize');
    },
    setFontSize: function (value) {
      this.setStyle('fontSize', parseInt(value, 10));
    },
    getLineHeight: function () {
      return this.getStyle('lineHeight');
    },
    setLineHeight: function (value) {
      this.setStyle('lineHeight', parseFloat(value, 10));
    },
    addText: function (text,options) {

      var _match = this.text.match(/\n/g);
      var _lineIndex = _match && _match.length || 0;
      var charIndex = this.text.length - this.text.lastIndexOf("\n") - 1;

      if(!this.styles[_lineIndex]){
        this.styles[_lineIndex] = {}
      }

      if(!this.styles[_lineIndex][charIndex]){
        this.styles[_lineIndex][charIndex] = {}
      }
      fabric.util.object.extend(this.styles[_lineIndex][charIndex],options);
      this.text +=text;
      // this.styles;
    },
    getBold: function () {
      return this.getStyle('fontWeight') === "bold";
    },
    setBold: function (value) {
      this.setStyle('fontWeight', value ? 'bold' : '');
    },
    getItalic: function () {
      return this.getStyle('fontStyle') === 'italic';
    },
    setItalic: function (value) {
      this.setStyle('fontStyle', value ? 'italic' : '' );
    },
    getUnderline: function () {
      return this.getStyle('textDecoration').indexOf('underline') > -1;
    },
    setUnderline: function (value) {
      value = value ? (this.getStyle('textDecoration') + ' underline')
        : this.getStyle('textDecoration').replace('underline', '');

      this.setStyle('textDecoration', value);
    },
    getLinethrough: function () {
      return this.getStyle('textDecoration').indexOf('line-through') > -1;
    },
    setLinethrough: function (value) {
      value = value ? (this.getStyle('textDecoration') + ' line-through')
        : this.getStyle('textDecoration').replace('line-through', '');

      this.setStyle('textDecoration', value);
    },
    getOverline: function () {
      return this.getStyle('textDecoration').indexOf('overline') > -1;
    },
    setOverline: function (value) {
      value = value ? (this.getStyle('textDecoration') + ' overline')
        : this.getStyle('textDecoration').replace('overlin', '');

      this.setStyle('textDecoration', value);
    },
    setStyle: function (styleName, value) {
      var object = this;
      var _old = fabric.util.object.cloneDeep(object.getStyles());
      //var _old = fabric.util.object.deepExtend({}, object.getStyles);//getSelectionStyles();
      if (object.setSelectionStyles && object.isEditing) {
        var style = {};
        if (value !== undefined) {
          style[styleName] = value;
        } else {
          delete style[styleName];
        }
        object.setSelectionStyles(style);
        object.setCoords();
      }
      else {
        if (value !== undefined) {
          object[styleName] = value;
        } else {
          delete object[styleName];
        }
        for (var i in object.styles) {
          for (var j in object.styles[i]) {
            if (object.styles[i][j][styleName] !== undefined) {
              delete object.styles[i][j][styleName];
            }
          }
        }
      }

      var styles_data = object.getStyles();

      if(this.type != "text"){
        this.styles = fabric.util.object.cloneDeep(styles_data);
      }

      this.setCoords();

      this.fire("styles:modified", {
        original: _old,
        modified: styles_data
      });
      this.canvas && this.canvas.renderAll();
      /*
       this.project.history.add({
       slide: this.slide,
       object: this,
       undo: _old,
       redo: styles_data,
       type: 'styled',
       undoFn: function(){
       this.object.data.styles = this.undo;
       this.object.fabric.set('styles',this.undo);
       this.object.fabric.setCoords();
       this.object.slide.render();
       },
       redoFn:  function(){
       this.object.data.styles = this.redo;
       this.object.fabric.set('styles',this.redo);
       this.object.fabric.setCoords();
       this.object.slide.render();
       }
       });*/
    },

    generateTextStyle: function () {
      return {
        'font-style': this.isItalic() ? 'italic' : 'normal',
        'font-weight': this.isBold() ? 700 : 400,
        'text-decoration': (this.isLinethrough() ? 'line-through ' : '' ) +
        (this.isOverline() ? 'overline ' : '' ) +
        (this.isUnderline() ? 'underline ' : '')
      }
    }
  });

  fabric.util.object.extend(fabric.IText.prototype, {
    initHiddenTextarea_native: fabric.IText.prototype.initHiddenTextarea,
    initHiddenTextarea: function(){
      this.initHiddenTextarea_native();
      this.hiddenTextarea.style.width = "9999px";
    },
    /**
     * Exits from editing state
     * @return {fabric.IText} thisArg
     * @chainable
     */
    exitEditing: function() {
      // var isTextChanged = (this._textBeforeEdit !== this.text);
      this.selected = false;
      this.isEditing = false;
      this.selectable = true;

      this.selectionEnd = this.selectionStart;
      this.hiddenTextarea && this.canvas && this.hiddenTextarea.parentNode.removeChild(this.hiddenTextarea);
      this.hiddenTextarea = null;

      this.abortCursorAnimation();
      this._restoreEditingProps();
      this._currentCursorOpacity = 0;

      this.fire('editing:exited');
      // isTextChanged && this.fire('modified');
      if (this.canvas) {
        this.canvas.off('mouse:move', this.mouseMoveHandler);
        this.canvas.fire('text:editing:exited', { target: this });
        this.canvas.fireModifiedIfChanged(target);
      }
      return this;
    },
    maxStrokeWidth: function(){
      return Math.ceil( this.getFontSize() / 10);
    }
  });

  var _TEX = fabric.IText.prototype;
  fabric.Text.prototype.actions = fabric.util.object.extend({}, fabric.Object.prototype.actions, {
      rasterizeText: {
        insert: 'rasterizeTool',
        className: 'button-easel',
        title: 'rasterizeText',
        action: _TEX.rasterizeText
      },
      fill: {
        type: 'color',
        title: 'fill',
        insert: '!advancedColorsTools',
        value: 'fill'
      },
      colors: {
        className: 'colors',
        type: 'menu',
        title: 'colors',
        toggled: true,
        insert: 'advancedColorsTools',
        menu: {
          textBgcolor: {
            type: 'color',
            title: 'bgColor',
            value: {
              get: _TEX.getBgColor,
              set: _TEX.setBgColor
            }
          },
          textTextbgcolor: {
            type: 'color',
            title: 'textBgColor',
            value: {
              get: _TEX.getTextBgColor,
              set: _TEX.setTextBgColor
            }
          },
          textFill: {
            type: 'color',
            title: 'fill',
            value: {
              get: _TEX.getFill,
              set: _TEX.setFill
            }
          }
        }
      },
      textStyle: {
        type: 'menu',
        title: 'text style',
        toggled: true,
        className: 'fa fa-font',
        style: 'generateTextStyle',
        menu: {
          textBold: {
            type: "checkbox",
            title: 'bold',
            value: 'bold',
            className: 'fa fa-bold'
          },
          textItalic: {
            type: "checkbox",
            title: 'italic',
            value: 'italic',
            className: 'fa fa-italic'
          },
          textUnderline: {
            type: "checkbox",
            title: 'Underline',
            value: 'underline',
            className: 'fa fa-underline'
          },
          textLinethrough: {
            type: "checkbox",
            insert: 'advancedTextStyleTools',
            title: 'Linethrough',
            value: 'linethrough',
            className: 'text-linethrough fa fa-strikethrough'
          },
          textOverline: {
            type: "checkbox",
            insert: 'advancedTextStyleTools',
            title: 'overline',
            value: 'overline',
            className: 'text-overline fa fa-overline'
          },
          textAlign: {
            type: 'options',
            title: 'text align',
            insert: 'textAligmentTools',
            value: "textAlign",
            menu: {
              textAlignCenter: {
                title: 'align center',
                option: 'center',
                className: 'fa fa-align-center'
              },
              textAlignLeft: {
                title: 'align left',
                option: 'left',
                className: 'fa fa-align-left'
              },
              textAlignRight: {
                title: 'align right',
                option: 'right',
                className: 'fa fa-align-right'
              },
              textAlignJustify: {
                title: 'align justify',
                option: 'justify',
                className: 'fa fa-align-justify'
              }
            }
          },
          fontFamily: {
            type: 'fontFamily',
            title: 'font family',
            className: 'fa fa-text',
            value: 'fontFamily',
            data: function(){
              return this.application._fonts
            }
          },
          textFontSize: {
            insert: 'textFontSizeTools',
            type: 'number',
            title: 'fontSize',
            value: 'fontSize'
          },
          /*textFont: {
            insert: 'textFontSizeTools',
            type: 'menu',
            title: 'font',
            className: 'fa fa-font',
            menu: {
              textFontSizeDecrease: {
                title: 'decreaseFontSize',
                action: _TEX.decreaseFontSize,
                className: 'fa fa-font font-size-decrease'
              },
              textFontSizeIncrease: {
                title: 'increaseFontSize',
                action: _TEX.increaseFontSize,
                className: 'fa fa-font font-size-increase'
              }
            }
          }*/
        }
      }
    }
  );
  fabric.IText.prototype.actions = fabric.util.object.extend({}, fabric.Text.prototype.actions, {
      textEdit: {
        insert:     'editTool',
        className:  'fa fa-pencil-square-o',
        title:      'edit',
        action:     _TEX.enterEditing
      }
    }
  );
/*
  fabric.Text.async = true;
  fabric.Text.fromObject = function (object, callback) {
    var _total = 0, loaded = 0;

    function create() {
      if (object.curve) {
        var f = new fabric.CurvedText(object.text, object);
      } else {
        var f = new fabric.IText(object.text, object);
      }
      callback && callback(f);
    }
    _.recoursive(object,
      function (property, value, parent) {

        if (property == 'pattern') {
          _total++;
          //  var _texture = _.findWhere(o.project.textures,{id: parent[property]});

          var _texture = fabric.texturesPath + parent[property];

          fabric.util.loadImage(_texture, function (img) {
            //this[property] = new fabric.Image(img);

            parent['fill'] = new fabric.Pattern({
              source: img,
              repeat: 'repeat'
            });
            delete parent[property];
            loaded++;
            if (_total == loaded)create();
          });

          //
          //parent['fill'] = new fabric.Pattern({
          //    source: _texture,
          //    repeat: 'repeat'
          //});
        }
      }
    );
    if (_total == loaded) {
      return create();
    }
  };*/

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 102 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {

//fabric.require("Speech",["ShapeMixin","TextAreaMixin"], function() {

    fabric.Speech = fabric.util.createClass(fabric.Group, {
        type: 'speech',

        initialize: function (options) {
            options || ( options = {});

            var _path = options.path;
            delete options.path;

            this.callSuper('initialize', [], options);


            this._initBubble(options);

            this._points = this.bubble && this.bubble._points;
            if (this._points) {
                this.setPoint(0, {
                    x: this.bubble.speechX || -25,
                    y: this.bubble.speechY || 25
                });
                this._initPoints(options.points);
            }

            this.set({
                centeredScaling: true,
                hasControls: true,
                lockScalingFlip: true
            });

            this._initText(options.text);
            this.on("dblclick", this._on_text_edit);

            this._initPath(_path);

            this.setWidth(Math.max(this.getMinWidth(), this.width));
            this.setHeight(Math.max(this.getMinHeight(), this.height));

            this.initMousedownHandler();


        },
        drawControls: function (ctx) {
          if (!this.hasControls) {
            return this;
          }
          fabric.Object.prototype.drawControls.call(this, ctx);

          this.drawShapeControls(ctx);
        },

      /**
         * @private
         */
        _onObjectAdded: function (object) {
            object.group = this;
            object._set('canvas', this.canvas);
        },
        _initPath: function (options) {
            if (options) {
                var path = new fabric.Path(options.path, options);
                this.setPath(path);
            }
        },
        setPath: function (path) {
            this.path = path;
            //    this.path = new fabric.Path(this._path, options);
            this.path.set({
                originX: "center",
                originY: "center",
                left: 0,
                top: 0,
                scaleX: this.width / this.path.width,
                scaleY: this.height / this.path.height
            });

            this.add(this.path);
            this.remove(this.text);
            this.add(this.text);
            this.updatePathStrokeWidth();
//����� ������ ���������� ��� ���������, �����  ���������
        },
        setPoint: function (order, _point) {
            fabric.Bubble.prototype.setPoint.call(this, order, _point);
            this.bubble.setPoint(order, _point);
        },
        _initBubble: function (options) {
            if (options.bubble) {


                fabric.util.createObject(options.bubble, function (element) {
                    this.bubble = element;
                    this.bubble.set({
                        width: this.width,
                        height: this.height,
                        originX: "center",
                        originY: "center"
                    });
                    this.add(this.bubble);
                }.bind(this));

            }
        },
        /**
         * Initializes "mousedown" event handler
         */
        initMousedownHandler: function () {
            //this.on('mousedown', function(options) {
            //    this.text.fire("mousedown",options);
            //});
        },
        updatePathStrokeWidth: function () {

            var _sc = Math.min(this.path.scaleY, this.path.scaleX)
            this.path.set("strokeWidth", 1 / _sc);
        },
        setHeight: function (h) {

            if (this.height && this.bubble && this.bubble.setPoint && this.bubble.speechY && this.bubble.speechY > this.height) {
                var _yoff = this.bubble.speechY - this.height;
            }

            this.height = h;
            if (this.bubble) {
                this.bubble.height = this.height;
            }
            if (this.path) {
                this.path.set({
                    scaleY: this.height / this.path.height
                });
                this.updatePathStrokeWidth();
            }

            if (_yoff !== undefined) {
                this.setPoint(0, {x: this.bubble.speechX, y: this.height + _yoff});
                this.canvas && this.canvas.renderAll();
            }
        },
        setWidth: function (w) {
            if (this.width && this.bubble && this.bubble.setPoint && this.bubble.speechX && this.bubble.speechX > this.width) {
                var _xoff = this.bubble.speechX - this.width;
            }
            this.width = w;
            if (this.bubble) {
                this.bubble.width = w;
            }
            if (this.path) {
                this.path.set({
                    scaleX: this.width / this.path.width
                });
                this.updatePathStrokeWidth();
            }
            if (_xoff !== undefined) {
                this.setPoint(0, {x: this.width + _xoff, y: this.bubble.speechY});
                this.canvas && this.canvas.renderAll();
            }
        },
        _set: function (key, value) {
            if (key == "width") {
                this.setWidth(value);
            } else if (key == "height") {
                this.setHeight(value);
            } else {
                this.callSuper('_set', key, value);
            }
            return this;
        },


        /**
         * Returns object representation of an instance
         * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output
         * @return {Object} object representation of an instance
         */
        toObject: function (propertiesToInclude) {

            if (this.path) {
                var path = this.path.toObject();
                path.path = this.path.path.join(" ");
            }
            var object = fabric.util.object.extend(fabric.Object.prototype.toObject.call(this, propertiesToInclude), {
                bubble: this.bubble && this.bubble.toObject() || null,
                path: path || null,
                text: this.text && this.text.toObject() || null
            });
            if (!this.includeDefaultValues) {
                this._removeDefaultValues(object);
            }
            return object;
        },
        setObjectScale: fabric.util.resizeOnScaling,
        lockScalingY: false,
        lockScalingX: false,
        _setupCurrentTransform: function (e) {
            this.canvas.callSuper('_setupCurrentTransform', e, this);
            this.canvas._currentTransform.original.height = this.height;
            this.canvas._currentTransform.original.width = this.width;
        },
        textPaddingX: 25,
        textPaddingY: 15
    });

    fabric.util.object.extend(fabric.Speech.prototype, fabric.ShapeMixin);
    fabric.util.object.extend(fabric.Speech.prototype, fabric.TextAreaMixin);
    fabric.util.createAccessors(fabric.Speech);

    fabric.Speech.fromObject = function (object) {
        return new fabric.Speech(object);
    };


if (false) {
  fabric.util.object.extend(fabric.objectsLibrary, {
    speech2: {
      title: "Rect Speech",
      "type": "Speech",
      "width": function (w, h) {
        return w - 40
      },
      "height": function (w, h) {
        return h - 40
      },
      "bubble": {
        "type": "rect",
        "opacity": 0.5,
        "stroke": "black",
        "strokeWidth": 5,
        "fill": "blue",
        "rx": 20,
        "ry": 20,
        "bubbleSize": 20,
        "bubbleOffsetX": 0,
        "bubbleOffsetY": 5,
        "speechX": 23,
        "speechY": 66
      },
      "text": {
        "fontSize": 10,
        "fontFamily": "Comic Sans",
        "text": "Rect\nSpeech"
      }
    },
    speech3: {
      title: "Bubble Speech",
      "type": "Speech",
      "width": function (w, h) {
        return w - 40
      },
      "height": function (w, h) {
        return h - 40
      },
      "bubble": {
        "type": "bubble",
        "opacity": 0.5,
        "stroke": "black",
        "strokeWidth": 5,
        "fill": "blue",
        "rx": 20,
        "ry": 20,
        "bubbleSize": 20,
        "bubbleOffsetX": 0,
        "bubbleOffsetY": 5,
        "speechX": 23,
        "speechY": 66
      },
      "text": {
        "fontSize": 10,
        "fontFamily": "Comic Sans",
        "text": "I'm Bubble\nSpeech"
      }
    },
    speech4: {
      title: "Think Speech",
      "type": "Speech",
      "left": 450,
      "top": 460,
      "bubble": {
        "type": "think",
        "stroke": "black",
        "fill": "white",
        "drawEllipse": false,
        "speechX": 9,
        "speechY": 133
      },
      "path": {
        "path": "m581.077942,2.537359c-2.053223,0.047071 -4.04071,0.188348 -6.108093,0.352907c-33.05542,2.663918 -62.235901,19.640541 -77.057678,44.925953l-7.8573,19.135319c1.698822,-6.633144 4.302979,-13.065384 7.8573,-19.135319c-26.430695,-22.16293 -63.531677,-32.388445 -100.192383,-27.574373c-36.661469,4.788353 -68.503082,24.041758 -85.901978,51.935225c-49.116486,-24.490013 -110.34288,-22.999454 -157.711807,3.860092c-47.369164,26.86068 -72.61673,74.40551 -64.941162,122.38308l5.021355,19.49968c-2.263329,-6.38501 -3.960793,-12.887695 -5.021355,-19.49968l-0.761948,1.798569c-41.179165,3.625244 -74.945375,29.465134 -83.716398,64.059235c-8.771805,34.597748 9.46701,70.085876 45.185621,87.96701l55.776558,10.973114c-19.480217,1.291962 -38.915543,-2.534515 -55.776558,-10.973114c-27.5478,24.96817 -33.888516,61.935303 -15.71492,92.467834c18.173733,30.524719 56.988899,48.110687 97.030457,44.11734l24.339722,-5.21109c-7.827499,2.651611 -15.960983,4.379059 -24.339722,5.21109c22.730042,33.857269 60.428192,58.556244 104.66893,68.383514c44.2491,9.81366 91.240952,4.014771 130.425949,-16.094604c31.96701,40.793823 88.707642,62.217468 145.596313,54.99707c56.902466,-7.219666 103.833984,-41.81427 120.501343,-88.770996l5.781433,-26.239532c-0.863708,8.909546 -2.742249,17.681366 -5.781433,26.239532c39.133301,20.753662 88.353333,21.927307 128.785095,3.049316c40.439819,-18.874084 65.665771,-54.869049 66.036133,-94.078247l-14.495605,-58.580597l-57.105713,-39.630768c44.163452,22.374573 71.992615,56.467255 71.601318,98.211365c52.49707,0.448181 97.103394,-35.956573 117.112427,-77.726288c20.011597,-41.769836 12.443604,-89.396759 -19.864929,-125.164642c13.401184,-26.637695 12.609985,-56.937332 -2.183472,-83.034088c-14.786194,-26.097893 -42.065491,-45.476891 -74.873047,-53.098335c-7.341431,-34.580929 -37.602661,-62.404482 -77.600708,-71.526293c-39.998474,-9.121368 -82.584839,2.123992 -109.364807,28.926123l-16.258179,22.19817c4.157959,-8.018612 9.583923,-15.495213 16.258179,-22.19817c-18.876953,-21.060713 -48.486023,-32.954061 -79.348938,-32.155401l0,0z",
        "stroke": "black",
        "fill": "white"
      },
      "text": {
        "fontSize": 20,
        "fontFamily": "Comic Sans",
        "text": "I'm Think\nSpeech"
      },
      "width": 150,
      "height": 100
    }
  })
}

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 103 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {


fabric.TextFrame = fabric.util.createClass(fabric.Textbox, {
    type: 'TextFrame',
    initialize: function(text, options) {
        this.ctx = fabric.util.createCanvasElement().getContext("2d");
        this.callSuper("initialize", text, options);
        this.set({
            lockUniScaling: options.lockScalingY || false,
            lockScalingFlip: options.lockScalingFlip || false,
            lockScalingY: options.lockScalingY || false,
            hasBorders: true
        });
        //this.setControlsVisibility(fabric.Textbox.getTextboxControlVisibility());
        this._dimensionAffectingProps.width = true;
        this.on("changed", this.fitText.bind(this));
        this.fitText();
    },
    setWidth: function(w) {
        this.width = w;
        this.fitText();
    },
    setHeight: function(h) {
        this.height = h;
        this.fitText();
    },
    _initDimensions: function(ctx) {
        if (this.__skipDimension) {
            return;
        }
        if (!ctx) {
            ctx = fabric.util.createCanvasElement().getContext("2d");
            this._setTextStyles(ctx);
        }
        this.dynamicMinWidth = 0;
        this._textLines = this._splitTextIntoLines();
        this._clearCache();
    },
    fitText : function(){

        while(this._getTextHeight() < this.height ){
            this.fontSize++;
            this._initDimensions(this.ctx);
        }

        while(this._getTextHeight() > this.height || this.dynamicMinWidth > this.width ){
            this.fontSize--;
            this._initDimensions(this.ctx);
        }
        //this.lineHeight = (this.height / this._textLines.length) / this.fontSize / this._fontSizeMult;
    }
});
//
//Object.defineProperty(fabric.TextFrame, "width", {
//    get: function() {
//        return this._w;
//    },
//    set: function(slide) {
//        console.log(slide);
//        this._w = slide;
//    }
//});


fabric.TextFrame.fromObject = function(object, callback) {
    var _total = 0, loaded = 0;
    function create(){
        var f = new fabric.TextFrame(object.text,object);
        callback && callback(f);
    }
    fabric.util.data.recoursive(object,
        function(property, value, parent) {

            if (property == "pattern") {
                _total ++;
                //  var _texture = _.findWhere(o.project.textures,{id: parent[property]});

                var _texture =  fabric.texturesPath + parent[property];

                fabric.util.loadImage(_texture, function(img) {
                    //this[property] = new fabric.Image(img);

                    parent["fill"] = new fabric.Pattern({
                        source: img,
                        repeat: "repeat"
                    });
                    delete parent[property];
                    loaded++;
                    if(_total == loaded)create();
                });

                //
                //parent["fill"] = new fabric.Pattern({
                //    source: _texture,
                //    repeat: "repeat"
                //});
            }
        }
    );
    if(_total == loaded){
        return create();
    }
};

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 104 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {/**
 * Bubble Object library for FabricJS
 *
 *
 *
 * @example
 nnew fabric.Bubble({
         left: 100,
         top: 100,
         width: 800,
         height: 600
     })
 *
 * @author Denis Ponomarev
 * @email den.ponomarev@gmail.com
 */


//fabric.require("Think",["ShapeMixin"], function() {
    fabric.Think = fabric.util.createClass(fabric.Rect, {
        type: 'think',
        stateProperties: fabric.Group.prototype.stateProperties.concat(["speechX", "speechY", "bubbleOffsetX", "bubbleOffsetY", "bubbleSize", "drawEllipse"]),
        speechX: 0,
        speechY: 0,
        bubbleOffsetX: 0,
        bubbleSize: 30,
        bubbleOffsetY: 0,
        drawEllipse: true,
        initialize: function (options) {
            options || ( options = {});

            this.callSuper('initialize', options);


            options.bubbleSize && this.set("bubbleSize", options.bubbleSize);
            options.drawEllipse && this.set("drawEllipse", options.drawEllipse);

            this.setPoint(0, {
                x: options.speechX || -25,
                y: options.speechY || 25
            });

            this._initPoints(options.points);
        },
        drawControls: function (ctx) {
          if (!this.hasControls) {
            return this;
          }
          fabric.Object.prototype.drawControls.call(this, ctx);

          this.drawShapeControls(ctx);
        },

        setPoint: function (order, _point) {

            if (!this._points)this._points = [];
            if (!this._points[order]) {
                this._points[order] = _point;
            }

            this.speechX = this._points[order].x = _point.x;
            this.speechY = this._points[order].y = _point.y;

            var _x = this.speechX - this.width / 2, _y = this.speechY - this.height / 2;
            this._hypo = Math.sqrt(Math.pow(_x, 2) + Math.pow(_y, 2));
            var _k = this.width / this.height;
            this._bubble_angle_sin = _x / this._hypo;
            this._bubble_angle_cos = _y / this._hypo;

            this._bubble_angle = Math.acos(this._bubble_angle_cos) * 180 / ( Math.PI);


            this._bubble_offset_x = Math.sqrt(Math.pow(this._bubble_angle_sin, 2));
            this._bubble_offset_y = Math.sqrt(Math.pow(this._bubble_angle_cos, 2));

            if (_x > 0) {
                this._bubble_angle = 360 - this._bubble_angle;
            } else {
                this._bubble_offset_x *= -1;
            }
            if (_y > 0) {
                this._bubble_angle_cos *= -1;
            } else {
                this._bubble_offset_y *= -1;
            }


            //console.log(this._bubble_angle,this._x_point,this._y_point)

        },
        /**
         * @private
         * @param {CanvasRenderingContext2D} ctx Context to render on
         */
        _render: function (ctx, noTransform) {
            //    this.callSuper('_render', ctx, noTransform);


            // optimize 1x1 case (used in spray brush)
            if (this.width === 1 && this.height === 1) {
                ctx.fillRect(0, 0, 1, 1);
                return;
            }

            var x = noTransform ? this.left : -this.width / 2,
                y = noTransform ? this.top : -this.height / 2;


            ctx.beginPath();


            if (this.drawEllipse) {
                ctx.ellipse(x + this.width / 2, y + this.height / 2, this.width / 2, this.height / 2, 0, 0, 2 * Math.PI, false);
            }


            var a = {
                    x: x + this.width / 2 + this._bubble_offset_x * this.width / 2,
                    y: y + this._bubble_offset_y * this.height / 2 + this.height / 2
                },
                b = {
                    x: x + this.speechX,
                    y: y + this.speechY
                },
                c = {
                    x: a.x + (b.x - a.x) / 3 * 2,
                    y: a.y + (b.y - a.y) / 3 * 2
                },
                d = {
                    x: a.x + (b.x - a.x) / 4,
                    y: a.y + (b.y - a.y) / 4
                };

            //ctx.moveTo(a.x + 4, a.y);
            //ctx.arc(a.x,a.y, 4, 0, 2 * Math.PI, false);


            ctx.moveTo(c.x + 6, c.y);
            ctx.arc(c.x, c.y, 6, 0, 2 * Math.PI, false);

            ctx.moveTo(d.x + 8, d.y);
            ctx.arc(d.x, d.y, 8, 0, 2 * Math.PI, false);

            ctx.moveTo(b.x + 4, b.y);
            ctx.arc(b.x, b.y, 4, 0, 2 * Math.PI, false);


            ctx.closePath();

            this._renderFill(ctx);

            this._renderStroke(ctx);
        },
        /**
         * Returns object representation of an instance
         * @param {Array} [propertiesToInclude] Any properties that you might want to additionally include in the output
         * @return {Object} object representation of an instance
         */
        toObject: function (propertiesToInclude) {
            var object = fabric.util.object.extend(this.callSuper('toObject', propertiesToInclude), {
                speechX: this.get('speechX') || 0,
                speechY: this.get('speechY') || 0,
                bubbleOffsetX: this.get('bubbleOffsetX') || 0,
                bubbleOffsetY: this.get('bubbleOffsetY') || 0,
                bubbleSize: this.get('bubbleSize'),
                drawEllipse: this.get('drawEllipse')
            });
            if (!this.includeDefaultValues) {
                this._removeDefaultValues(object);
            }
            return object;
        }
    });
    fabric.Think.fromObject = function (object) {
        return new fabric.Think(object);
    };
    fabric.util.object.extend(fabric.Think.prototype, fabric.ShapeMixin);

    fabric.util.createAccessors(fabric.Think);

    fabric.util.object.extend(fabric.Think.prototype, fabric.ShapeMixin);
    fabric.util.createAccessors(fabric.Think);


/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 105 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {//http://jsfiddle.net/mrbendel/6rbtde5t/1/
//http://thecodeplayer.com/walkthrough/3d-perspective-projection-canvas-javascript
//http://tulrich.com/geekstuff/canvas/perspective.html



__webpack_require__(7);
__webpack_require__(8);
__webpack_require__(53);

fabric.TransformedImage = fabric.util.createClass(
fabric.Image,
fabric.BezierMixin,
fabric.CacheMixin,
fabric.TransformedImageMixin, {
  type: 'transformed-image',
  points:     null,
  _triangles: [],
  wireframe:  false,
  fixWireFrame: true,
  renderBorder:false,
  // specialProperties: fabric.Image.prototype.specialProperties.concat(["points","curve"] ),
  stateProperties: ["points"].concat(fabric.Image.prototype.stateProperties),
  _editing_mode: 'scale' ,//'3d',
  initialize: function (el,options,callback) {
    options || ( options = {});

    fabric.util.object.defaults(options,{
      width : el && el.width  || 100,
      height: el && el.height || 100
    });

    if(options.points){
      this.width = 0;
      this.height = 0;
    }

    this.points = options.points || [
        {x: 0, y: 0},
        {x: options.width, y: 0},
        {x: options.width, y: options.height},
        {x: 0, y: options.height}
      ];

    if(options.renderBorder !== undefined){
      this.renderBorder     = options.renderBorder;
    }
    if(options.wireframe !== undefined){
      this.wireframe     = options.wireframe;
    }
    if(options.perspective !== undefined){
      this.perspective     = options.perspective;
    }
    if(options.verticalSubdivisions !== undefined){
      this.verticalSubdivisions     = options.verticalSubdivisions;
    }
    if(options.horizontalSubdivisions !== undefined){
      this.horizontalSubdivisions     = options.horizontalSubdivisions;
    }
    this.extraControls = {};

    this._corner_actions = this._corner_actions || {};
    this._corner_actions.curve = "curve";

    this.callSuper('initialize',el, options,callback);


    this._update_curve_point();
    this._initCurveOffset();
    this._switch_controls = this.switchControls.bind(this);
    this.on('dblclick',this._switch_controls);

    if(options.contentOffsets){
      this._update_content_offsets(options.contentOffsets);
    }
    this.on("shape:modified",function(data){
      this.dirty = true;
      this.canvas.renderAll();
    });
    this.on("content:modified",function(data){
      if(data.bounds){
        this._initCurveOffset();
        var _b =  data.bounds || {
          minX: 0,
          maxX: this._originalElement.width,
          minY: 0,
          maxY: this._originalElement.height
        };
        this._update_content_offsets(_b);
      }
      this.dirty = true;
      this.canvas.renderAll();
    });
    this.updateBbox();
  },
  optionsOrder: fabric.Image.prototype.optionsOrder.concat(["points"]),
  curve :  {x: 0.5, y: 0.5},
  // drawControls: function (ctx, shape, offset) {
  //   if (!this.hasControls) {
  //     return this;
  //   }
  //   this.drawBoundsControls( ctx);
  // },
  _update_curve_point: function(){
    this.extraControls.curve = this._getPointForImageCoordianate(this.width * this.curve.x,this.height * this.curve.y,true);
  },
  setCurve: function(curve){
    this.curve = curve ||  {x: 0.5, y: 0.5};
    this.dirty = true;
    this.setPoint("c1",{x: this.points[0].x - 10, y: this.points[0].y - 10 });
  },
  _performCurveAction: function (e, transform, pointer) {
    this.extraControls.curve.y = transform.point.y;
    this.extraControls.curve.x = transform.point.x;
    this.setCurve(this._getImageCoordianateForPoint(transform.point));
    transform.actionPerformed = true;
  },
  _initCurveOffset: function(){
    this._curve_point_left =     {x: 0, y: this.height /2};           //  fabric.util.transformPoint({x: 0, y: this.height /2}, transformMatrix);
    this._curve_point_middle =   {x: this.width / 2, y: this.height * this.curve.y};           //   fabric.util.transformPoint({x: this.width / 2, y: _y}, transformMatrix);
    this._curve_point_right =    {x: this.width, y:  this.height /2}   ;//   fabric.util.transformPoint({x: this.width, y:  this.height /2}, transformMatrix);
  },
  _getCurveOffsetPoint :function(t) {
    var x = (1 - t) * (1 - t) * this._curve_point_left.x + 2 * (1 - t) * t * this._curve_point_middle.x + t * t * this._curve_point_right.x;
    var y = (1 - t) * (1 - t) * this._curve_point_left.y + 2 * (1 - t) * t * this._curve_point_middle.y + t * t * this._curve_point_right.y;
    return {x: x, y: y};
  },
  setControlPoints: function () {
    this._controls = [];
    this.addPointsControls(this._controls);
    return this._controls;
  },
  _getCurveOffset: function(t) {
    var p = this._getCurveOffsetPoint(t);
    p.y -= this._curve_point_left.y;
    return p;
  },
  _show_pointers: function ()  {
    if(this._editing_mode == '3d'){

      var _default_corners = {
        tl: false,
        tr: false,
        br: false,
        bl: false,
        ml: false,
        mt: false,
        mr: false,
        mb: false,
        mtr:false,
        p : true
      };
    }else{
      var _default_corners = {
        tl: true,
        tr: true,
        br: true,
        bl: true,
        ml: true,
        mt: true,
        mr: true,
        mb: true,
        mtr:true,
        p : false
      };
    }
    for(var i in _default_corners){
      this._controlsVisibility[i] = _default_corners[i];
    }
    this.canvas && this.canvas.renderAll();
  },
  switchControls: function () {
    if(this._editing_mode == '3d'){
      this._editing_mode = 'scale';
    }else{
      this._editing_mode = '3d';
    }
    this._show_pointers();
    this.canvas.renderAll();
  },
  normalize: function(){
    this.off('dblclick',this._switch_controls);
    delete this._switch_controls;
  },
  /**
   * @private
   * @param {CanvasRenderingctx2D} ctx ctx to render on
   */
  _render: function (ctx, noTransform) {
    ctx.save();

    this.calculateGeometry();

    if (this._element) this.drawElement(ctx);
    if (this.wireframe) this.drawWireframe(ctx);
    if (this.fixWireFrame) this.fixSemiTransparentPixels(ctx);

    if (this.renderBorder) {
      var p1 = new fabric.Point(this.points[0].x,this.points[0].y);
      var p2 = new fabric.Point(this.points[1].x,this.points[1].y);
      var p3 = new fabric.Point(this.points[2].x,this.points[2].y);
      var p4 = new fabric.Point(this.points[3].x,this.points[3].y);
      ctx.strokeStyle = "black";
      ctx.beginPath();
      ctx.moveTo(p1.x, p1.y);
      ctx.lineTo(p2.x, p2.y);
      ctx.lineTo(p3.x, p3.y);
      ctx.lineTo(p4.x, p4.y);
      ctx.lineTo(p1.x, p1.y);
      ctx.stroke();
      ctx.closePath();
    }
    ctx.restore();
  },
  toObject: function(propertiesToInclude) {
    var object = this.callSuper('toObject', propertiesToInclude);

    if (!this.includeDefaultValues) {
      this._removeDefaultValues(object);
    }

    var points = []
    for(var i in this.points){
      points.push(this.points[i].x);
      points.push(this.points[i].y);
    }
    object.curve = this.curve;
    object.points = points;
    return object;
  },
  update_curve_height: function () {
    if(this.extraControls.curve.y > this._original_height){
      this.height = this.extraControls.curve.y;
    }else  if(this.extraControls.curve.y < this._original_height){
      this.height = Math.max(this.extraControls.curve.y, this._original_height);
    }
  }
});

var _TRI = fabric.TransformedImage.prototype;
fabric.TransformedImage.prototype.actions = fabric.util.object.extend({}, fabric.Image.prototype.actions, {
  switchControls: {
    className: 'fa fa-cube ',
    title: 'toggle transform',
    action: _TRI.switchControls
  }
});

fabric.TransformedImage.fromObject = function(object,callback){

  object = fabric.util.object.clone(object);

  function onImageLoaded(img){
    fabric.Image.prototype._initFilters.call(object, object.filters, function(filters) {
      object.filters = filters || [ ];
      fabric.Image.prototype._initFilters.call(object, object.resizeFilters, function(resizeFilters) {
        object.resizeFilters = resizeFilters || [ ];
        var instance = new fabric.TransformedImage(img, object,callback);
      });
    });
  }


  if(object.image){
    onImageLoaded(object.image);
  }else{

    fabric.util.loadImage(object.src, onImageLoaded, null, object.crossOrigin);
  }
};


/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 106 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(fabric) {/**
 * Video Object library for FabricJS
 *
 * Extension of Group object.
 * Allow to create Video objects , play video by clicking on them.
 * Works with object events from fabric.canvasEx library.
 *
 *
 * @example
 nnew fabric.Video({
         left: 100,
         top: 100,
         width: 800,
         height: 600,
         poster: "path/to/poster.png",
         sources :{"video/mp4": "video.mp4",  "video/ogg": "video.ogv"}
     })
 *
 * @author Denis Ponomarev
 * @email den.ponomarev@gmail.com
 */




fabric.Video = fabric.util.createClass(fabric.Group, {
  type: 'video',

  stateProperties: fabric.Group.prototype.stateProperties.concat(["poster"]),

  initialize: function (options) {
    options || ( options = {});
    this.paused = true;
    this.callSuper('initialize', [], options);
    this.set('poster', options.poster || false);
    this.set('sources', options.sources || {});
    this.createPoster();
    this.loadVideo();
  },

  toObject: function () {
    return fabric.util.object.extend(this.callSuper('toObject'), {
      poster: this.get('poster'),
      sources: this.get('sources')
    });
  },

  _render: function (ctx) {
    this.callSuper('_render', ctx);
  },

  blackScreen: "data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs=",
  createPoster: function () {

    fabric.util.loadImage(this.poster || this.blackScreen, function (img) {
      var _image = new fabric.Image(img, {
        width: this.width,
        height: this.height,
        originX: 'center',
        originY: 'center'
      });
      this.image = _image;
      this.add(_image);
    }.bind(this))

  },
  createHint: function () {

    //play/pause hint
    this.text = new fabric.Text('', {
      fontFamily: 'videogular',
      textAlign: "center",
      fontSize: 60,
      left: -25,
      top: -28,
      width: 40,
      fill: "white",
      shadow: {color: '#000', offsetX: 1, offsetY: 1, blur: 5},
      visible: false
    });


    var _self = this;

    this.on('object:click', function (e) {
      _self.text.setCoords();
      var t = this.searchPossibleTargets(e.e);
      t.target && t.target.fire("click");
    });


    this.text.on("click", function () {
      _self.togglePlayPause()
    })


    //show/hide play/pause hint
    this.on('mouse:over', function (e) {
      _self.text.setVisible(true);
      _self.canvas.renderAll();
    });
    this.on('mouse:out', function (e) {
      _self.text.setVisible(false);
      _self.canvas.renderAll();
    });

    this.add(this.text);
  },
  destructor: function (e) {
    this.mediaElement.pause();
    this.mediaElement.currentTime = 0;
    this.paused = true;
    delete this.mediaElement;
  },
  togglePlayPause: function (e) {
    var el = this.video.getElement();
    if (el.paused) {
      el.play();
      this.paused = false;
      this.video.setVisible(true);
      this.text.setText("");
    } else {
      el.pause();
      el.currentTime = 0;
      this.paused = true;
      if (this.poster) {
        this.video.setVisible(false);
      }
      this.text.setText("");
    }
  },
  createVideo: function () {

    this.video = new fabric.Image(this.mediaElement, {
      width: this.width,
      height: this.height,
      originX: 'center',
      originY: 'center'
    });

    if (this.poster) {
      this.video.setVisible(false);
    }

    this.add(this.video);

    this.createHint();

    this.fire("ready");
    //this.canvas.renderAll();
  },
  setPoster: function (img) {

    this.poster = img.src;
    this.image.setElement(img);
    this.image.set({
      width: this.width,
      height: this.height
    });
    this.canvas.renderAll();
  },
  loadVideo: function () {
    fabric.util.loadVideo(this.sources, function (el) {
      this.mediaElement = el;
      this.createVideo();
    }.bind(this))
  }
});
fabric.Video.fromObject = function (object) {
  return new fabric.Video(object);
};

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 107 */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(fabric) {

fabric.util.object.extend(fabric.Polyline.prototype,{
  controlsButtonsEnabled: false,
  _create_buttons_controls: function(controls){

    if(!this.controlsButtonsEnabled)return;

    var pts = this.points,
      _last = pts.length - 1;
    if(this.__magnet_point && this.__magnet_point.id[0] != "x"){
      var _id = this.__magnet_point.id;
      var _ender_area = (_id == "e1" || _id == "e2");
      var _ender_points = _ender_area || (_id == "p1" || _id == "p" + pts.length);
      var _offset = _ender_points ? 15 : 10;
      this._xbuttons_point = _ender_area ? (_id[1] == "1" ? 0 : _last) : _id.substr(1) - 1;
      this._xbuttons_curve = _id[0] == "c";
      if(this._xbuttons_curve){
        controls.push({
          x: this.__magnet_point.x + _offset,
          y: this.__magnet_point.y - _offset,
          size : 16,
          intransformable: true,
          styleFunction: this._drawInsertNodeButton,
          id: "x1"
        });
      }
      controls.push({
        x: this.__magnet_point.x + _offset,
        y: this.__magnet_point.y + _offset,
        size : 16,
        intransformable: true,
        styleFunction: this._drawRemoveNodeButton,
        id: "x2"
      });
    }else{
      delete this._xbuttons_point;
      delete this._xbuttons_curve;
    }
  },
  _drawInsertNodeButton: function (control, ctx, methodName, left, top, size, stroke) {
    ctx.save();
    ctx.fillStyle = "green";
    ctx.beginPath();
    var _size = size / 4;
    ctx.arc(left + size/2 , top + size/2 , _size * 2 , 0, 2 * Math.PI, false);
    ctx.fill();
    ctx.strokeStyle = "white";
    ctx.translate(Math.floor(size/2),Math.floor(size/2));
    ctx.translate(0.5,0.5 );
    ctx.moveTo(left - _size , top );
    ctx.lineTo(left + _size , top );
    ctx.strokeStyle = "white";
    ctx.moveTo(left  , top + _size );
    ctx.lineTo(left  , top - _size );
    ctx.stroke();
    ctx.restore();
  },
  _drawRemoveNodeButton: function (control, ctx, methodName, left, top, size, stroke) {
    ctx.save();
    ctx.fillStyle = "red";
    ctx.beginPath();
    var _size = size / 4;
    ctx.arc(left + size/2 , top + size/2 , _size * 2 , 0, 2 * Math.PI, false);
    ctx.fill();
    ctx.strokeStyle = "white";
    ctx.translate(size/2,size/2);
    ctx.moveTo(left - _size , top - _size);
    ctx.lineTo(left + _size , top + _size);
    ctx.strokeStyle = "white";
    ctx.moveTo(left - _size , top + _size );
    ctx.lineTo(left + _size , top - _size );
    ctx.stroke();
    ctx.restore();
  },
  _performAddAction: function (e, transform, pointer) {
    this.isMoving = false;
    var p1 = this.points[this._xbuttons_point];
    var p2 = this.points[this._xbuttons_point + 1];
    if(p1.curve){
      var new_point1 = p1.curve.get(0.25);
      var new_point2 = p1.curve.get(0.75);

      this.points.splice(this._xbuttons_point + 1,0,{
        x: p1.c.x,
        y: p1.c.y,
        c: new_point2
      })
      p1.c = new_point1;
      this._makeCurveByIndex(this._xbuttons_point);
      this._makeCurveByIndex(this._xbuttons_point + 1);
    }else{
      var new_point1 = {x : (p2.x - p1.x) / 4, y: (p2.y - p1.y) / 4};
      var new_point2 = {x : (p2.x - p1.x) / 4*3, y: (p2.y - p1.y) / 4*3};
    }
    delete this.canvas._currentTransform;
    // delete transform.action;
    // delete transform.corner;
  },
  _performRemoveAction: function (e, transform, pointer) {
    if(this.points.length == 2){
      return this.remove();
    }

    var _curvepointer = this._xbuttons_curve,
      pIndex1 = this._xbuttons_point;

    if(this.points[pIndex1 - 1 ]  && this.points[pIndex1 + 1]){
      this.points[pIndex1 - 1 ].c = this.points[pIndex1];
      this.points.splice(pIndex1,1);
      this._makeCurveByIndex(pIndex1 - 1);
    }else{
      this.points.splice(pIndex1,1);
    }
    this.isMoving = false;
    this.setSize();
    this.canvas.renderAll();
    delete this.canvas._currentTransform;
    // delete transform.action;
    // delete transform.corner;
  }
});

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 108 */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(fabric) {// Magic Wand (Fuzzy Selection Tool) for Javascript
//
// The MIT License (MIT)
//
// Copyright (c) 2014, Ryasnoy Paul (ryasnoypaul@gmail.com)
//
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
//
// The above copyright notice and this permission notice shall be included in
// all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
// THE SOFTWARE.

var MagicWand = (function () {
  var lib = {};
  //var canvas = document.createElement("canvas");
  //var context = canvas.getContext("2d");

  function createCanvasElement(){
    if(typeof Canvas !== "undefined"){
      return new Canvas;
    }
    return document.createElement("canvas");
  }

  function SelectionMask(w,h,data){
    if(arguments.length == 1){
      for(var i in arguments[0] ){
        this[i] = arguments[0][i];
      }
    }else{
      this.data = new Uint8Array(data || w * h);
      this.width  = w;
      this.height = h;
      this.count  = 0;
      this.bounds = {
       minX: Infinity,
       minY: Infinity,
       maxY: -1,
       maxX: -1
      };
      // this.bounds = {
      //   minX: 0,
      //   minY: 0,
      //   maxY: h,
      //   maxX: w
      // };
    }
  }
  lib.SelectionMask = SelectionMask;


  SelectionMask.prototype.debug = function(){
    var canvas = document.createElement("canvas");
    canvas.width = this.width;
    canvas.height = this.height;
    var ctx = canvas.getContext('2d');
    this.render(ctx,{
      fill : "#fff",
      outerFill : "#000"
    });
    ctx.debug();
  };

  SelectionMask.prototype.makeCache = function(options ){
    this.cache = createCanvasElement();
    this.cache.width = this.bounds.maxX- this.bounds.minX + 1;
    this.cache.height = this.bounds.maxY- this.bounds.minY + 1;
    this.context = this.cache.getContext('2d');

    options = options || {}
    this.render(this.context,{
      fill : "#fff",
      outerFill : "#000",
      cache: false,
      left :-this.bounds.minX,
      top :-this.bounds.minY
    });

  };

  SelectionMask.prototype.add = function (mask) {
    var index, x, y;
    for (x = mask.bounds.minX; x <= mask.bounds.maxX; x++) {
      for (y = mask.bounds.minY; y <= mask.bounds.maxY; y++) {
        index = mask.width * y + x;
        if ( mask.data[index] && !this.data[index]){
          this.data[index] = 1;
          this.count++;
        }
      }
    }

    this.bounds.minX = Math.min(mask.bounds.minX, this.bounds.minX);
    this.bounds.maxX = Math.max(mask.bounds.maxX, this.bounds.maxX);
    this.bounds.minY = Math.min(mask.bounds.minY, this.bounds.minY);
    this.bounds.maxY = Math.max(mask.bounds.maxY, this.bounds.maxY);
  };
  function hexToRgb(hex) {
    // Expand shorthand form (e.g. "03F") to full form (e.g. "0033FF")
    var shorthandRegex = /^#?([a-f\d])([a-f\d])([a-f\d])$/i;
    hex = hex.replace(shorthandRegex, function(m, r, g, b) {
      return r + r + g + g + b + b;
    });

    var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
    return result ? {
      r: parseInt(result[1], 16),
      g: parseInt(result[2], 16),
      b: parseInt(result[3], 16)
    } : null;
  }

  SelectionMask.prototype.render = function(ctx,options ){
    if(!this.count)return;

    options             = options             || {};
    options.left        = options.left        || 0 ;
    options.top         = options.top         || 0 ;
    options.fill        = options.fill        || false ;// [0,0,0,0];
    options.intersectionColor = options.intersectionColor ||false ;//  [0,0,0,0];

    options.outerFill        = options.outerFill        || false ;// [0,0,0,0];
    options.outerIntersectionColor = options.outerIntersectionColor ||false ;//  [0,0,0,0];

    //if(this.cache && options.cache !== false){
    //
    //  var _ctx = this.context;
    //  _ctx.save();
    //  _ctx.globalCompositeOperation="source-in";
    //  _ctx.fillStyle= options.fill;
    //  _ctx.fillRect(0,0,this.cache.width,this.cache.height);
    //  _ctx.restore();
    //
    //  ctx.save();
    //  ctx.globalAlpha = options.opacity;
    //  ctx.drawImage(this.cache,this.bounds.minX,this.bounds.minY)
    //  ctx.restore();
    //  return;
    //}

    //todo do not use fabric here!
    function convertColor(color){
      if(color.constructor  == String ){
        if(color[0] == "#"){
          var _rgb = hexToRgb(color);
          return [_rgb.r,_rgb.g,_rgb.b,255];
        }
        color = new fabric.Color(color)._source;
        color[3] *= 255;
      }
      return color;
    }

    var _w = this.bounds.maxX - this.bounds.minX + 1;
    var _h = this.bounds.maxY - this.bounds.minY + 1;

    var imgData = ctx.getImageData(options.left,options.top,_w,_h);


    var color  = convertColor(options.fill);
    var color2 = convertColor(options.intersectionColor);
    var color3 = convertColor(options.outerFill);
    var color4 = convertColor(options.outerIntersectionColor);

    for(var x = this.bounds.minX ; x <= this.bounds.maxX;x++ ){
      for(var y = this.bounds.minY ; y <= this.bounds.maxY; y++ ){
        var index = this.width * y + x;
        var index_small = _w * (y - (this.bounds.minY)) + x - (this.bounds.minX);

        if(this.data[index] ){
          var _color = imgData.data[index_small * 4 + 3]? color2 : color ;
          if(!_color)continue;

          imgData.data[index_small * 4 ]    = _color[0];
          imgData.data[index_small * 4 + 1] = _color[1];
          imgData.data[index_small * 4 + 2] = _color[2];
          imgData.data[index_small * 4 + 3] = _color[3];
        }else{
          var _color = imgData.data[index_small * 4 + 3]? color4 : color3 ;
          if(!_color)continue;

          imgData.data[index_small * 4 ]    = _color[0];
          imgData.data[index_small * 4 + 1] = _color[1];
          imgData.data[index_small * 4 + 2] = _color[2];
          imgData.data[index_small * 4 + 3] = _color[3];
        }
      }
    }

    ctx.putImageData(imgData, options.left  , options.top  );
  };


  /**
   * get array with begin and end indices of filled 1 intervals
   * @param ctx
   * @param options
   * @returns {Array}
   */
  SelectionMask.prototype.getIntervalsArray = function (ctx, options) {
    var _newData = [];
    for (var i = 0, _val = 0; i < array.length; i++) {
      if (_val != array[i]) {
        _newData.push(i);
        _val = array[i];
      }
    }
    return _newData;
  };

  SelectionMask.prototype.renderBorder = function (ctx, options) {

    options             = options             || {};
    options.left        = options.left        || 0 ;
    options.top         = options.top         || 0 ;
    options.hatchOffset = options.hatchOffset || 0 ;
    options.hatchLength = options.hatchLength || 4 ;
    options.opacity = options.opacity || 1 ;

    var imgData = ctx.getImageData(0,0,this.width,this.height);

    if(!this.cacheInd){
      this.cacheInd = MagicWand.getBorderIndices(this);
    }

    var x, y, i, j, k,
      w = imgData.width,
      h = imgData.height;
    var res = imgData.data;

    var len = this.cacheInd.length;
    for (j = 0; j < len; j++) {
      i = this.cacheInd[j];
      x = i % w; // calc x by index
      y = (i - x) / w; // calc y by index
      k = (y * w + x) * 4;

      if ((x + y + options.hatchOffset) % (options.hatchLength * 2) < options.hatchLength) { // detect hatch color

        res[k] = 0;
        res[k + 1] = 0;
        res[k + 2] = 0;
        res[k + 3] = 255; // black, change only alpha
      } else {
        res[k] = 255; // white
        res[k + 1] = 255;
        res[k + 2] = 255;
        res[k + 3] = 255;
      }
    }
    ctx.save();
    ctx.globalAlpha = options.opacity;
    ctx.putImageData(imgData, options.left || 0 , options.top || 0 );
    ctx.restore();
  };


  lib.createMask = function (w, h,data) {
    return new SelectionMask(w,h,data);
  };

  lib.difference = function (a, b) {
    return Math.max(
      b[0] !== false ? Math.abs(b[0] - a[0]): 0,
      b[1] !== false ? Math.abs(b[1] - a[1]): 0,
      b[2] !== false ? Math.abs(b[2] - a[2]): 0,
      b[3] !== false ? Math.abs(b[3] - a[3]): 0);
  };

  lib.acceptable = function (x, y, image, visited, sampleColor, colorThreshold) {
// check whether the point has been visited
    if (visited[y * image.width + x] === 1) {
      return false;
    }
    var i = (y * image.width + x) * lib.bytes,
      color2 = [image.data[i], image.data[i + 1], image.data[i + 2], image.data[i + 3]];


    if (sampleColor[0] !== false && Math.abs(sampleColor[0] - color2[0]) > colorThreshold)return false;
    if (sampleColor[1] !== false && Math.abs(sampleColor[1] - color2[1]) > colorThreshold)return false;
    if (sampleColor[2] !== false && Math.abs(sampleColor[2] - color2[2]) >colorThreshold)return false;
    if (sampleColor[3] !== false && Math.abs(sampleColor[3] - color2[3]) > colorThreshold)return false;
    return true;
  };

  lib.selectAll = function (image, px, py, colorThreshold) {
    var i = (py * image.width + px) * lib.bytes,
      data = image.data,
      sampleColor = [data[i], data[i + 1], data[i + 2], data[i + 3]]; // start point color (sample)
    return lib.selectAllByColor(image, sampleColor, colorThreshold)
  };


  /**
   * Converts an RGB color value to HSL. Conversion formula
   * adapted from http://en.wikipedia.org/wiki/HSL_color_space.
   * Assumes r, g, and b are contained in the set [0, 255] and
   * returns h, s, and l in the set [0, 1].
   *
   * @param   Number  r       The red color value
   * @param   Number  g       The green color value
   * @param   Number  b       The blue color value
   * @return  Array           The HSL representation
   */
  lib.rgbToHsl = function(r, g, b){
    r /= 255, g /= 255, b /= 255;
    var max = Math.max(r, g, b), min = Math.min(r, g, b);
    var h, s, l = (max + min) / 2;

    if(max == min){
      h = s = 0; // achromatic
    }else{
      var d = max - min;
      s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
      switch(max){
        case r: h = (g - b) / d + (g < b ? 6 : 0); break;
        case g: h = (b - r) / d + 2; break;
        case b: h = (r - g) / d + 4; break;
      }
      h /= 6;
    }

    return [h, s, l];
  }

  lib.selectColored = function (image, options) {

    var mask = new SelectionMask(image.width, image.height);

    mask.bounds = {
      minX: image.width,
      minY: image.height,
      maxY: -1,
      maxX: -1
    };

    var x, y;
    for (y = 0; y < image.height; y++) {
      for (x = 0; x < image.width; x++) {
        var index = (y * image.width + x);
        var i = index * lib.bytes;
        //if (!image.data[i + 3]) continue;


        if (options.aMin && image.data[i + 3] < options.aMin)continue;

        var hsl = rgbToHsl(image.data[i], image.data[i + 1], image.data[i + 2]);


        if (options.sMin && hsl[1] < options.sMin)continue;
        if (options.sMax && hsl[1] > options.sMax)continue;
        if (options.bMin && hsl[2] < options.bMin)continue;
        if (options.bMax && hsl[2] > options.bMax)continue;


        mask.data[index] = 1;
        mask.count++;
        mask.bounds.minX = Math.min(mask.bounds.minX, x);
        mask.bounds.maxX = Math.max(mask.bounds.maxX, x);
        mask.bounds.minY = Math.min(mask.bounds.minY, y);
        mask.bounds.maxY = Math.max(mask.bounds.maxY, y);

      }
    }
    return mask;
  };




  lib.selectAllByColor = function (ctx, sampleColor, colorThreshold) {
    var image = _getImageData(ctx);

    var mask = new SelectionMask(image.width, image.height);

    mask.bounds = {
      minX: Infinity,
      minY: Infinity,
      maxY: -1,
      maxX: -1
    };


    var visited = new Uint8Array( image.width * image.height);
    var x, y;
    for (y = 0; y < image.height; y++) {
      for (x = 0; x < image.width; x++) {
        if(lib.acceptable(x, y, image, mask.data, sampleColor, colorThreshold)){
          MagicWand.floodFill(image, x, y, colorThreshold, {
            sampleColor:    sampleColor,
            activeMask :    mask,
            visitedPoints : visited
          });
        }
      }
    }
    return mask;
  };



  lib.drawImage = function (ctx,canvas, mask ,left, top) {

    var ctx2 = canvas.getContext('2d');


    var imgData = ctx.getImageData(0, 0, mask.width, mask.height);
    var imgDataOriginal = ctx2.getImageData(left, top, mask.width, mask.height);


    var b = mask.bounds;
    for (var x = b.minX; x <= b.maxX; x++)for (var y = b.minY; y <= b.maxY; y++) {
      var i = (y * mask.width + x);// * bytes; // point index in the image data
      if (mask.data[i]) {
        imgData.data[i * 4]     = imgDataOriginal.data[i * 4];
        imgData.data[i * 4 + 1] = imgDataOriginal.data[i * 4 + 1];
        imgData.data[i * 4 + 2] = imgDataOriginal.data[i * 4 + 2];
        imgData.data[i * 4 + 3] = imgDataOriginal.data[i * 4 + 3];
      }
    }
    ctx.putImageData(imgData,0, 0);
  };

  function _getImageData(ctx){
    if(ctx.constructor.name == "ImageData"){
      return ctx;
    }else{
      return ctx.getImageData(0, 0, ctx.canvas.width, ctx.canvas.height);
    }
  }

  lib.fillMask = function (ctx,mask, color) {
    var imgData = _getImageData(ctx);
    var b = mask.bounds;
    var w = imgData.width,
      h = imgData.height;

    for (var x = b.minX; x <= b.maxX; x++)for (var y = b.minY; y <= b.maxY; y++) {
      var i = (y * w + x);// * bytes; // point index in the image data
      if (mask.data[i]) {
        imgData.data[i * 4]     = color[0];
        imgData.data[i * 4 + 1] = color[1];
        imgData.data[i * 4 + 2] = color[2];
        imgData.data[i * 4 + 3] = color[3];
      }
    }
    if(ctx.constructor.name != "ImageData") {
      ctx.clearRect(0, 0, w, h);
      ctx.putImageData(imgData, 0, 0);
    }
  };

  lib.selectBackground = function (ctx, sampleColor, colorThreshold) {
    var image = _getImageData(ctx);

    colorThreshold = colorThreshold || 15;

    var mask = new SelectionMask(image.width, image.height);
    mask.bounds = {
      minX: Infinity,
      minY: Infinity,
      maxY: -1,
      maxX: -1
    };

    var data = image.data;

    sampleColor = sampleColor ||[data[0], data[1], data[2], data[3]]; // start point color (sample)

    var color = sampleColor;

    function add(x, y) {
      if (!lib.acceptable(x, y, image, mask.data, sampleColor, colorThreshold))return;
      if (!sampleColor) {
        var index = (y * image.width + x) * 4;
        color = [data[index], data[index + 1], data[index + 2], data[index + 3]];
      }
      var mask2 = MagicWand.floodFill(image, x, y, colorThreshold, null, color);
      mask = MagicWand.add(mask, mask2);
    }

    var x, y;

    for (x = 0; x < image.width; x++) {
      add(x, 0);
    }
    for (x = 0; x < image.width; x++) {
      add(x, image.height - 1);
    }
    for (y = 0; y < image.height; y++) {
      add(image.width - 1, y);
    }
    for (y = 0; y < image.height; y++) {
      add(0, y);
    }
    return mask;

  };

  lib.extractColors = function(mixedType,threshold) {
    threshold= threshold || 60;
    var imgData = lib.getImageData(mixedType);
    var _colors = [];
    var c1;
    for(var x = 1; x <imgData.width;x+=3){
      for(var y = 1; y <imgData.height;y+=3) {
        var iii = (x + y * imgData.width) * 4;
        var iiA = (x - 1 + y * imgData.width) * 4;
        var iiB = (x + 1 + y * imgData.width) * 4;
        var iiC = (x - 1 + (y + 1) * imgData.width) * 4;
        var iiD = (x + 1 + (y + 1) * imgData.width) * 4;
        if(imgData.data[iii + 3] < 255)continue;

        c1 = [ imgData.data[iii], imgData.data[iii + 1], imgData.data[iii + 2]];
        var cA = [ imgData.data[iiA], imgData.data[iiA + 1], imgData.data[iiA + 2]];
        var cB = [ imgData.data[iiB], imgData.data[iiB + 1], imgData.data[iiB + 2]];
        var cC = [ imgData.data[iiC], imgData.data[iiC + 1], imgData.data[iiC + 2]];
        var cD = [ imgData.data[iiD], imgData.data[iiD + 1], imgData.data[iiD + 2]];

        if(
          c1[0] != cA[0] || cA[0] != cB[0] || cB[0] != cC[0] || cC[0] != cD[0] ||
          c1[1] != cA[1] || cA[1] != cB[1] || cB[1] != cC[1] || cC[1] != cD[1] ||
          c1[2] != cA[2] || cA[2] != cB[2] || cB[2] != cC[2] || cC[2] != cD[2]
        ){
          continue;
        }

        var isNewColor = true;

        for(var i in _colors){
          if(MagicWand.difference(_colors[i], c1) < threshold){
            isNewColor = false;
            break;
          }
        }
        if(isNewColor){
          _colors.push(c1);
        }
      }
    }
    return _colors;
  };

  /**
   * image
   * canvas - черно блое изображение.
   *
   * mask- предыдущая маска. на нее будет накладывать новая
   * mode - способ наложения.
   */
  lib.maskSelection = function ( canvas, left, top, mask ,mode) {
    left = left || 0;
    top = top || 0;
    if(canvas.constructor.name == "HTMLImageElement"){

      var __canvas = createCanvasElement();
      __canvas.width = canvas.width;
      __canvas.height = canvas.height;
      var __ctx = __canvas.getContext('2d');
      __ctx.drawImage(canvas, 0, 0);
      canvas = __canvas;
    }


    var ctx = canvas.getContext('2d'),
      imgData = ctx.getImageData(0, 0, canvas.width, canvas.height),
      mask = mask || MagicWand.createMask(canvas.width, canvas.height);

    var _x1 = Math.max(0, - left),
      _y1 = Math.max(0, - top),
      _x2 = Math.min(mask.width - left,canvas.width);
    _y2 = Math.min(mask.height - top,canvas.height);

    for (var x = _x1; x < _x2; x++) {
      for (var y = _y1; y < _y2; y++) {
        var index = (canvas.width * y + x) * 4;

        if (imgData.data[index] > 20) {
          var index2 = mask.width * (y + top) + x + left;
          mask.data[index2] = 1;
          mask.count++;
        }
      }
    }
    return mask;
  },
  lib.selectRectangle = function (image, x1, y1, x2, y2) {

      var mask = new SelectionMask(image.width, image.height);
      var minX = Math.min(x1, x2);
      var maxX = Math.max(x1, x2);
      var minY = Math.min(y1, y2);
      var maxY = Math.max(y1, y2);

      var w = image.width, h = image.height;

      var data = image.data;
      for (var y = minY; y <= maxY; y++) {
        for (var x = minX; x <= maxX; x++) {
          if (data[(y * w + x) * 4 + 3]) {
            mask.data[y * w + x] = 1;
            mask.count++;
          }
        }
      }

      mask.bounds = {
        minX: minX,
        minY: minY,
        maxX: maxX,
        maxY: maxY
      };

      return mask;
    };

  lib.bytes = 4;






  lib.__floodFill = function (e,postMessage) {

    data = e.data;
    var image = data[0], px = data[1], py = data[2], colorThreshold = data[3], options = data[4];

    options = options || {};
    /*{
     visitedPointsArray,
     sampleColor,
     resultMask
     }*/

    var c, x, newY, el, xr, xl, dy, dyl, dyr, checkY,
      data = image.data, w = image.width, h = image.height, bytes = lib.bytes,
      i = py * w + px; // start point index in the mask data
    i = i * bytes; // start point index in the image data

    var visited     = options.visitedPoints || new Uint8Array( w * h), // mask of visited points
      sampleColor = options.sampleColor   || [data[i], data[i + 1], data[i + 2], data[i + 3]], // start point color (sample)
      result      = options.activeMask;

    function acceptable(x, y) {
// check whether the point has been visited
      if (visited[y * image.width + x] === 1) {
        return false;
      }
      var i = (y * image.width + x) * lib.bytes,
        color2 = [image.data[i], image.data[i + 1], image.data[i + 2], image.data[i + 3]];
      if (sampleColor[0] !== false && Math.abs(sampleColor[0] - color2[0]) > colorThreshold)return false;
      if (sampleColor[1] !== false && Math.abs(sampleColor[1] - color2[1]) > colorThreshold)return false;
      if (sampleColor[2] !== false && Math.abs(sampleColor[2] - color2[2]) > colorThreshold)return false;
      if (sampleColor[3] !== false && Math.abs(sampleColor[3] - color2[3]) > colorThreshold)return false;
      return true;
    };



    if (visited[i] === 1) return null;


    var first = true;
    var stack = [{y: py, left: px - 1, right: px + 1, dir: 1}]; // first scanning line

    var mode = 'strict';
    var _ci;
    do {
      el = stack.shift(); // get line for scanning

      checkY = false;
      for (x = el.left + 1; x < el.right; x++) {
        dy = el.y * w;

        if(mode == 'gradient' && !first) {
          _ci = (dy + x + (el.dir == -1 ? w: - w))*4;
          sampleColor = [data[_ci],data[_ci+1],data[_ci+2],data[_ci+3]];
        }
        if (!acceptable(x, el.y, image, visited, sampleColor, colorThreshold))continue;

        first = false;

        checkY = true; // if the color of the new point(x,y) is similar to the sample color need to check minmax for Y

        result.count++;

        result.data[dy + x] = 1; // mark a new point in mask
        visited[dy + x] = 1; // mark a new point as visited

        xl = x - 1;
        // walk to left side starting with the left neighbor
        while (xl > -1) {
          dyl = dy + xl;

          if(mode == 'gradient') {
            _ci = (dyl + 1)*4;
            sampleColor = [data[_ci], data[_ci + 1], data[_ci + 2], data[_ci + 3]];
          }
          if (!acceptable(xl, el.y, image, visited, sampleColor, colorThreshold)) break;

          result.count++;
          result.data[dyl] = 1;
          visited[dyl] = 1;

          xl--;
        }
        xr = x + 1;
        // walk to right side starting with the right neighbor
        while (xr < w) {
          dyr = dy + xr;

          if(mode == 'gradient') {
            _ci = (dyr - 1)*4;
            sampleColor = [data[_ci], data[_ci + 1], data[_ci + 2], data[_ci + 3]];
          }
          if (!acceptable(xr, el.y, image, visited, sampleColor, colorThreshold)){
            break;
          }

          result.count++;
          result.data[dyr] = 1;
          visited[dyr] = 1;
          xr++;
        }

        // check minmax for X
        if (xl < result.bounds.minX) result.bounds.minX = xl + 1;
        if (xr > result.bounds.maxX) result.bounds.maxX = xr - 1;

        newY = el.y - el.dir;
        if (newY >= 0 && newY < h) {
          if (xl < xr) stack.push({y: newY, left: xl, right: xr, dir: -el.dir}); // from "new left" to "new right"
          // add two scanning lines in the opposite direction (y - dir) if necessary
          // if (xl <= el.left) stack.push({y: newY, left: xl, right: el.left, dir: -el.dir}); // from "new left" to "current left"
          // if (el.right <= xr) stack.push({y: newY, left: el.right, right: xr, dir: -el.dir}); // from "current right" to "new right"
        }
        newY = el.y + el.dir;
        if (newY >= 0 && newY < h) { // add the scanning line in the direction (y + dir) if necessary
          if (xl < xr) stack.push({y: newY, left: xl, right: xr, dir: el.dir}); // from "new left" to "new right"
        }
      }
      // check minmax for Y if necessary
      if (checkY) {
        if (el.y < result.bounds.minY) result.bounds.minY = el.y;
        if (el.y > result.bounds.maxY) result.bounds.maxY = el.y;
      }
    } while (stack.length > 0);

    postMessage && postMessage(result);
    return result;
  };

  lib.extendMask = function (mask, value) {

    var mask2 = new SelectionMask(mask.width + 2, mask.height + 2);
    if(value){
      mask2.data.fill(value);
    }

    for(var y = 0;y < mask.height ; y++){
      for(var x = 0;x < mask.width ; x++){
        mask2.data[ (y + 1) * mask2.width + x + 1 ] = mask.data[y * mask.width + x ];
      }
    }
    mask2.count  = mask.count;

    if(!value) {
      mask2.bounds = {
        minX: mask.bounds.minX + 1,
        maxX: mask.bounds.maxX + 1,
        maxY: mask.bounds.maxY + 1,
        minY: mask.bounds.minY + 1
      };
    }else{
      mask2.bounds = mask.bounds;
    }

    return mask2;
  };

  /** Create a binary mask on the image by color threshold
   * Algorithm: Scanline flood fill (http://en.wikipedia.org/wiki/Flood_fill)
   * @param {Object} image: {Uint8Array} data, {int} width, {int} height, {int} bytes
   * @param {int} x of start pixel
   * @param {int} y of start pixel
   * @param {int} color threshold
   * @param {Uint8Array} mask of visited points (optional)
   * @return {Object} mask: {Uint8Array} data, {int} width, {int} height, {Object} bounds
   */
  lib.floodFill = function (image, px, py, colorThreshold, options,color,callback) {
    options = options || {};
    options.activeMask = options.activeMask  || new SelectionMask(image.width, image.height);

    return lib.__floodFill({data: [image, px, py, colorThreshold, options, color]},callback);

    /*
    var worker = _.worker(lib.__floodFill);
    worker.onmessage = function(e){
      var mask = new SelectionMask(e.data);
      callback && callback(mask);
    };
    worker.postMessage([image, px, py, colorThreshold, options]);
*/

  };

  lib.substract = function (mask, mask2) {
    var minX, maxX, minY, maxY;

    var result = new SelectionMask(mask.width, mask.height);
    var bounds = mask2.bounds;

    var minX = false, minY = mask.height, maxX = false, maxY = -1;

    for (var x = bounds.minX; x <= bounds.maxX; x++) {
      for (var y = bounds.minY; y <= bounds.maxY; y++) {
        var index = mask.width * y + x;

        if (!mask.data[index] && mask2.data[index]) {
          result.data[index] = 1;
          result.count++;
          if (result.bounds.minY > y)result.bounds.minY = y;
          if (result.bounds.maxY < y)result.bounds.maxY = y;
          if (result.bounds.minX > x)result.bounds.minX = x;
          if (result.bounds.maxX < x)result.bounds.maxX = x;
        }
      }
    }

    return result;
  }

  lib.getImageData  = function(mixedType){
    var canvas;
    if (mixedType.constructor.name == "Image" || mixedType.constructor.name == "HTMLImageElement") {
      var _canvas = createCanvasElement();
      _canvas.width = mixedType.width;
      _canvas.height = mixedType.height;
      var ctx = _canvas.getContext("2d");
      ctx.drawImage(mixedType, 0, 0);
      canvas = _canvas;
    }else{
      canvas = mixedType;
    }
    if (canvas.constructor.name == "HTMLCanvasElement" || canvas.constructor.name == "Canvas") {
      var imgData = canvas.getContext("2d").getImageData(0, 0, canvas.width, canvas.height);
    }else{
      imgData = mixedType;
    }
    return imgData;
  };

  lib.getColoredPixels = function (mixedType) {
    var imgData = lib.getImageData(mixedType);
    var data = imgData.data;
    var pixels = 0;
    for (var i = 3; i < data.length; i += 4) {
      if (data[i]) {
        pixels+= data[i] / 255;
      }
    }
    return pixels;
  };

  lib.invertMask = function (mask) {
    var result = new SelectionMask(mask.width, mask.height);
    result.bounds = {
      minX: Infinity,
      minY: Infinity,
      maxY: -1,
      maxX: -1
    };


    for (var x = 0; x < mask.width; x++) {
      for (var y = 0; y < mask.height; y++) {
        var index = mask.width * y + x;
        if (!mask.data[index]) {
          result.data[index] = 1;
          result.count++;
          if (result.bounds.minY > y)result.bounds.minY = y;
          if (result.bounds.maxY < y)result.bounds.maxY = y;
          if (result.bounds.minX > x)result.bounds.minX = x;
          if (result.bounds.maxX < x)result.bounds.maxX = x;
        }
      }
    }
    return result;
  };

  lib.exclude = function (mask, mask2) {
    var result = new SelectionMask(mask.width, mask.height);
    var bounds = {
      minX: Math.min(mask.bounds.minX, mask2.bounds.minX),
      maxX: Math.max(mask.bounds.maxX, mask2.bounds.maxX),
      minY: Math.min(mask.bounds.minY, mask2.bounds.minY),
      maxY: Math.max(mask.bounds.maxY, mask2.bounds.maxY)
    };

    var minX = false, minY = mask.height, maxX = false, maxY = -1;

    for (var x = bounds.minX; x <= bounds.maxX; x++) {
      for (var y = bounds.minY; y <= bounds.maxY; y++) {
        var index = mask2.width * y + x;

        if (mask.data[index] ^ mask2.data[index]) {
          result.data[index] = 1;
          result.count++;
          maxX = x;
          if (minY > y)minY = y;
          if (maxY < y)maxY = y;
          if (minX === false) {
            minX = x;
          }
        }
      }
    }

    result.bounds = {
      minX: minX,
      maxX: maxX,
      minY: minY,
      maxY: maxY
    }

    return result;
  };

  lib.intersect = function (mask, mask2) {
    var minX, maxX, minY, maxY;

    var result = new SelectionMask(mask.width, mask.height);
    var bounds = {
      minX: Math.max(mask.bounds.minX, mask2.bounds.minX),
      maxX: Math.min(mask.bounds.maxX, mask2.bounds.maxX),
      minY: Math.max(mask.bounds.minY, mask2.bounds.minY),
      maxY: Math.min(mask.bounds.maxY, mask2.bounds.maxY)
    };

    var minX = false, minY = mask.height, maxX = false, maxY = -1;

    for (var x = bounds.minX; x <= bounds.maxX; x++) {
      for (var y = bounds.minY; y <= bounds.maxY; y++) {
        var index = mask2.width * y + x;

        if (mask.data[index] && mask2.data[index]) {
          result.data[index] = 1;
          result.count++;
          maxX = x;
          if (minY > y)minY = y;
          if (maxY < y)maxY = y;
          if (minX === false) {
            minX = x;
          }
        }
      }
    }

    result.bounds = {
      minX: minX,
      maxX: maxX,
      minY: minY,
      maxY: maxY
    }

    return result;
  };

  lib.add = function (mask, mask2) {
    var result = new SelectionMask(mask.width, mask.height);

    result.bounds = {
      minX: Math.min(mask.bounds.minX, mask2.bounds.minX),
      maxX: Math.max(mask.bounds.maxX, mask2.bounds.maxX),
      minY: Math.min(mask.bounds.minY, mask2.bounds.minY),
      maxY: Math.max(mask.bounds.maxY, mask2.bounds.maxY)
    };

    for (var x = result.bounds.minX; x <= result.bounds.maxX; x++) {
      for (var y = result.bounds.minY; y <= result.bounds.maxY; y++) {
        var index = mask2.width * y + x;

        if (mask.data[index] || mask2.data[index]) {
          result.data[index] = 1;
          result.count++;
        }
      }
    }

    return result;
  };

  /** Apply the gauss-blur filter to binary mask
   * Algorithms: http://blog.ivank.net/fastest-gaussian-blur.html
   * http://www.librow.com/articles/article-9
   * http://elynxsdk.free.fr/ext-docs/Blur/Fast_box_blur.pdf
   * @param {Object} mask: {Uint8Array} data, {int} width, {int} height, {Object} bounds
   * @param {int} blur radius
   * @return {Object} mask: {Uint8Array} data, {int} width, {int} height, {Object} bounds
   */
  lib.gaussBlur = function (mask, radius) {

    var i, k, k1, x, y, val, start, end,
      n = radius * 2 + 1, // size of the pattern for radius-neighbors (from -r to +r with the center point)
      s2 = radius * radius,
      wg = new Float32Array(n), // weights
      total = 0, // sum of weights(used for normalization)
      w = mask.width,
      h = mask.height,
      data = mask.data,
      minX = mask.bounds.minX,
      maxX = mask.bounds.maxX,
      minY = mask.bounds.minY,
      maxY = mask.bounds.maxY,
      count = 0;

    // calc gauss weights
    for (i = 0; i < radius; i++) {
      var dsq = (radius - i) * (radius - i);
      var ww = Math.exp(-dsq / (2.0 * s2)) / (2 * Math.PI * s2);
      wg[radius + i] = wg[radius - i] = ww;
      total += 2 * ww;
    }
    // normalization weights
    for (i = 0; i < n; i++) {
      wg[i] /= total;
    }

    var result = new Uint8Array(w * h), // result mask
      endX = radius + w,
      endY = radius + h;

    //walk through all source points for blur
    for (y = minY; y < maxY + 1; y++)
      for (x = minX; x < maxX + 1; x++) {
        val = 0;
        k = y * w + x; // index of the point
        start = radius - x > 0 ? radius - x : 0;
        end = endX - x < n ? endX - x : n; // Math.min((((w - 1) - x) + radius) + 1, n);
        k1 = k - radius;
        // walk through x-neighbors
        for (i = start; i < end; i++) {
          val += data[k1 + i] * wg[i];
        }
        start = radius - y > 0 ? radius - y : 0;
        end = endY - y < n ? endY - y : n; // Math.min((((h - 1) - y) + radius) + 1, n);
        k1 = k - radius * w;
        // walk through y-neighbors
        for (i = start; i < end; i++) {
          val += data[k1 + i * w] * wg[i];
        }
        if (val > 0.5) {
          result[k] = 1;
          count++;
        } else {
          result[k] = 0;
        }
      }

    return {
      count: count,
      data: result,
      width: w,
      height: h,
      bounds: {
        minX: minX,
        minY: minY,
        maxX: maxX,
        maxY: maxY
      }
    };
  };

  /** Create a border index array of boundary points of the mask with radius-neighbors
   * @param {Object} mask: {Uint8Array} data, {int} width, {int} height, {Object} bounds
   * @param {int} radius: blur radius
   * @param {Uint8Array} visited: mask of visited points (optional)
   * @return {Array} border index array of boundary points with radius-neighbors (only points need for blur)
   */
  function createBorderForBlur(mask, radius, visited) {

    var x, i, j, y, k, k1, k2,
      w = mask.width,
      h = mask.height,
      data = mask.data,
      visitedData = new Uint8Array(data),
      minX = mask.bounds.minX,
      maxX = mask.bounds.maxX,
      minY = mask.bounds.minY,
      maxY = mask.bounds.maxY,
      len = w * h,
      temp = new Uint8Array(len), // auxiliary array to check uniqueness
      border = [], // only border points
      x0 = Math.max(minX, 1),
      x1 = Math.min(maxX, w - 2),
      y0 = Math.max(minY, 1),
      y1 = Math.min(maxY, h - 2);

    if (visited && visited.length > 0) {
      // copy visited points (only "black")
      for (k = 0; k < len; k++) {
        if (visited[k] === 1) visitedData[k] = 1;
      }
    }

    // walk through inner values except points on the boundary of the image
    for (y = y0; y < y1 + 1; y++)
      for (x = x0; x < x1 + 1; x++) {
        k = y * w + x;
        if (data[k] === 0) continue; // "white" point isn't the border
        k1 = k + w; // y + 1
        k2 = k - w; // y - 1
        // check if any neighbor with a "white" color
        if (visitedData[k + 1] === 0 || visitedData[k - 1] === 0 ||
          visitedData[k1] === 0 || visitedData[k1 + 1] === 0 || visitedData[k1 - 1] === 0 ||
          visitedData[k2] === 0 || visitedData[k2 + 1] === 0 || visitedData[k2 - 1] === 0) {
          //if (visitedData[k + 1] + visitedData[k - 1] +
          //    visitedData[k1] + visitedData[k1 + 1] + visitedData[k1 - 1] +
          //    visitedData[k2] + visitedData[k2 + 1] + visitedData[k2 - 1] == 8) continue;
          border.push(k);
        }
      }

    // walk through points on the boundary of the image if necessary
    // if the "black" point is adjacent to the boundary of the image, it is a border point
    if (minX == 0)
      for (y = minY; y < maxY + 1; y++)
        if (data[y * w] === 1)
          border.push(y * w);

    if (maxX == w - 1)
      for (y = minY; y < maxY + 1; y++)
        if (data[y * w + maxX] === 1)
          border.push(y * w + maxX);

    if (minY == 0)
      for (x = minX; x < maxX + 1; x++)
        if (data[x] === 1)
          border.push(x);

    if (maxY == h - 1)
      for (x = minX; x < maxX + 1; x++)
        if (data[maxY * w + x] === 1)
          border.push(maxY * w + x);

    var result = [], // border points with radius-neighbors
      start, end,
      endX = radius + w,
      endY = radius + h,
      n = radius * 2 + 1; // size of the pattern for radius-neighbors (from -r to +r with the center point)

    len = border.length;
    // walk through radius-neighbors of border points and add them to the result array
    for (j = 0; j < len; j++) {
      k = border[j]; // index of the border point
      temp[k] = 1; // mark border point
      result.push(k); // save the border point
      x = k % w; // calc x by index
      y = (k - x) / w; // calc y by index
      start = radius - x > 0 ? radius - x : 0;
      end = endX - x < n ? endX - x : n; // Math.min((((w - 1) - x) + radius) + 1, n);
      k1 = k - radius;
      // walk through x-neighbors
      for (i = start; i < end; i++) {
        k2 = k1 + i;
        if (temp[k2] === 0) { // check the uniqueness
          temp[k2] = 1;
          result.push(k2);
        }
      }
      start = radius - y > 0 ? radius - y : 0;
      end = endY - y < n ? endY - y : n; // Math.min((((h - 1) - y) + radius) + 1, n);
      k1 = k - radius * w;
      // walk through y-neighbors
      for (i = start; i < end; i++) {
        k2 = k1 + i * w;
        if (temp[k2] === 0) { // check the uniqueness
          temp[k2] = 1;
          result.push(k2);
        }
      }
    }

    return result;
  };

  /** Apply the gauss-blur filter ONLY to border points with radius-neighbors
   * Algorithms: http://blog.ivank.net/fastest-gaussian-blur.html
   * http://www.librow.com/articles/article-9
   * http://elynxsdk.free.fr/ext-docs/Blur/Fast_box_blur.pdf
   * @param  {Object}     mask:     {Uint8Array} data, {int} width, {int} height, {Object} bounds
   * @param  {int}        radius:   blur radius
   * @param  {Uint8Array} visited:  mask of visited points (optional)
   * @return {Object}     mask:     {Uint8Array} data, {int} width, {int} height, {Object} bounds
   */
  lib.gaussBlurOnlyBorder = function (mask, radius, visited) {

    var border = createBorderForBlur(mask, radius, visited), // get border points with radius-neighbors
      ww, dsq, i, j, k, k1, x, y, val, start, end,
      n = radius * 2 + 1, // size of the pattern for radius-neighbors (from -r to +r with center point)
      s2 = 2 * radius * radius,
      wg = new Float32Array(n), // weights
      total = 0, // sum of weights(used for normalization)
      w = mask.width,
      h = mask.height,
      data = mask.data,
      minX = mask.bounds.minX,
      maxX = mask.bounds.maxX,
      minY = mask.bounds.minY,
      maxY = mask.bounds.maxY,
      len = border.length;

    // calc gauss weights
    for (i = 0; i < radius; i++) {
      dsq = (radius - i) * (radius - i);
      ww = Math.exp(-dsq / s2) / Math.PI;
      wg[radius + i] = wg[radius - i] = ww;
      total += 2 * ww;
    }
    // normalization weights
    for (i = 0; i < n; i++) {
      wg[i] /= total;
    }

    var result = new SelectionMask(w,h,data), // copy the source mask
      endX = radius + w,
      endY = radius + h;

    //walk through all border points for blur
    for (i = 0; i < len; i++) {
      k = border[i]; // index of the border point
      val = 0;
      x = k % w; // calc x by index
      y = (k - x) / w; // calc y by index
      start = radius - x > 0 ? radius - x : 0;
      end = endX - x < n ? endX - x : n; // Math.min((((w - 1) - x) + radius) + 1, n);
      k1 = k - radius;
      // walk through x-neighbors
      for (j = start; j < end; j++) {
        val += data[k1 + j] * wg[j];
      }
      if (val > 0.5) {
        result.data[k] = 1;
        result.count++;
        // check minmax
        if (x < minX) minX = x;
        if (x > maxX) maxX = x;
        if (y < minY) minY = y;
        if (y > maxY) maxY = y;
        continue;
      }
      start = radius - y > 0 ? radius - y : 0;
      end = endY - y < n ? endY - y : n; // Math.min((((h - 1) - y) + radius) + 1, n);
      k1 = k - radius * w;
      // walk through y-neighbors
      for (j = start; j < end; j++) {
        val += data[k1 + j * w] * wg[j];
      }
      if (val > 0.5) {
        result.data[k] = 1;
        result.count++;
        // check minmax
        if (x < minX) minX = x;
        if (x > maxX) maxX = x;
        if (y < minY) minY = y;
        if (y > maxY) maxY = y;
      } else {
        result.data[k] = 0;
      }
    }
    result.bounds = {
      minX: minX,
      minY: minY,
      maxX: maxX,
      maxY: maxY
    };

    return result;
  };

  /** Create a border mask (only boundary points)
   * @param {Object} mask: {Uint8Array} data, {int} width, {int} height, {Object} bounds
   * @return {Object} border mask: {Uint8Array} data, {int} width, {int} height, {Object} offset
   */
  lib.createBorderMask = function (mask) {

    var x, y, k, k1, k2,
      w = mask.width,
      h = mask.height,
      data = mask.data,
      minX = mask.bounds.minX,
      maxX = mask.bounds.maxX,
      minY = mask.bounds.minY,
      maxY = mask.bounds.maxY,
      rw = maxX - minX + 1, // bounds size
      rh = maxY - minY + 1,
      result = new Uint8Array(rw * rh), // reduced mask (bounds size)
      x0 = Math.max(minX, 1),
      x1 = Math.min(maxX, w - 2),
      y0 = Math.max(minY, 1),
      y1 = Math.min(maxY, h - 2),
      count = 0;

    // walk through inner values except points on the boundary of the image
    for (y = y0; y < y1 + 1; y++)
      for (x = x0; x < x1 + 1; x++) {
        k = y * w + x;
        if (data[k] === 0) continue; // "white" point isn't the border
        k1 = k + w; // y + 1
        k2 = k - w; // y - 1
        // check if any neighbor with a "white" color
        if (data[k + 1] === 0 || data[k - 1] === 0 ||
          data[k1] === 0 || data[k1 + 1] === 0 || data[k1 - 1] === 0 ||
          data[k2] === 0 || data[k2 + 1] === 0 || data[k2 - 1] === 0) {
          //if (data[k + 1] + data[k - 1] +
          //    data[k1] + data[k1 + 1] + data[k1 - 1] +
          //    data[k2] + data[k2 + 1] + data[k2 - 1] == 8) continue;
          result[(y - minY) * rw + (x - minX)] = 1;
          count++;
        }
      }

    // walk through points on the boundary of the image if necessary
    // if the "black" point is adjacent to the boundary of the image, it is a border point
    if (minX == 0)
      for (y = minY; y < maxY + 1; y++)
        if (data[y * w] === 1) {
          result[(y - minY) * rw] = 1;
          count++;
        }

    if (maxX == w - 1)
      for (y = minY; y < maxY + 1; y++)
        if (data[y * w + maxX] === 1) {
          result[(y - minY) * rw + (maxX - minX)] = 1;
          count++;
        }

    if (minY == 0)
      for (x = minX; x < maxX + 1; x++)
        if (data[x] === 1) {
          result[x - minX] = 1;
          count++;
        }

    if (maxY == h - 1)
      for (x = minX; x < maxX + 1; x++)
        if (data[maxY * w + x] === 1) {
          result[(maxY - minY) * rw + (x - minX)] = 1;
          count++;
        }

    return {
      count: count,
      data: result,
      width: rw,
      height: rh,
      offset: {x: minX, y: minY}
    };
  };

  /** Create a border index array of boundary points of the mask
   * @param {Object} mask: {Uint8Array} data, {int} width, {int} height
   * @return {Array} border index array boundary points of the mask
   */
  lib.getBorderIndices = function (mask) {

    var x, y, k, k1, k2,
      w = mask.width,
      h = mask.height,
      data = mask.data,
      border = [], // only border points
      x1 = w - 1,
      y1 = h - 1;

    // walk through inner values except points on the boundary of the image
    for (y = 1; y < y1; y++)
      for (x = 1; x < x1; x++) {
        k = y * w + x;
        if (data[k] === 0) continue; // "white" point isn't the border
        k1 = k + w; // y + 1
        k2 = k - w; // y - 1
        // check if any neighbor with a "white" color
        if (data[k + 1] === 0 || data[k - 1] === 0 ||
          data[k1] === 0 || data[k1 + 1] === 0 || data[k1 - 1] === 0 ||
          data[k2] === 0 || data[k2 + 1] === 0 || data[k2 - 1] === 0) {
          //if (data[k + 1] + data[k - 1] +
          //    data[k1] + data[k1 + 1] + data[k1 - 1] +
          //    data[k2] + data[k2 + 1] + data[k2 - 1] == 8) continue;
          border.push(k);
        }
      }

    // walk through points on the boundary of the image if necessary
    // if the "black" point is adjacent to the boundary of the image, it is a border point
    for (y = 0; y < h; y++)
      if (data[y * w] === 1)
        border.push(y * w);

    for (x = 0; x < w; x++)
      if (data[x] === 1)
        border.push(x);

    k = w - 1;
    for (y = 0; y < h; y++)
      if (data[y * w + k] === 1)
        border.push(y * w + k);

    k = (h - 1) * w;
    for (x = 0; x < w; x++)
      if (data[k + x] === 1)
        border.push(k + x);

    return border;
  };

  /** Create a compressed mask with a "white" border (1px border with zero values) for the contour tracing
   * @param {Object} mask: {Uint8Array} data, {int} width, {int} height, {Object} bounds
   * @return {Object} border mask: {Uint8Array} data, {int} width, {int} height, {Object} offset
   */
  function prepareMask(mask) {
    var x, y,
      w = mask.width,
      data = mask.data,
      minX = mask.bounds.minX,
      maxX = mask.bounds.maxX,
      minY = mask.bounds.minY,
      maxY = mask.bounds.maxY,
      rw = maxX - minX + 3, // bounds size +1 px on each side (a "white" border)
      rh = maxY - minY + 3,
      result = new Uint8Array(rw * rh); // reduced mask (bounds size)

    // walk through inner values and copy only "black" points to the result mask
    for (y = minY; y < maxY + 1; y++)
      for (x = minX; x < maxX + 1; x++) {
        if (data[y * w + x] === 1)
          result[(y - minY + 1) * rw + (x - minX + 1)] = 1;
      }

    return {
      data: result,
      width: rw,
      height: rh,
      offset: {x: minX - 1, y: minY - 1}
    };
  };

  /** Create a contour array for the binary mask
   * Algorithm: http://www.sciencedirect.com/science/article/pii/S1077314203001401
   * @param {Object} mask: {Uint8Array} data, {int} width, {int} height, {Object} bounds
   * @return {Array} contours: {Array} points, {bool} inner, {int} label
   */
  lib.traceContours = function (mask) {
    var m = prepareMask(mask),
      contours = [],
      label = 0,
      w = m.width,
      w2 = w * 2,
      h = m.height,
      src = m.data,
      dx = m.offset.x,
      dy = m.offset.y,
      bounds,_p,
      dest = new Uint8Array(src), // label matrix
      i, j, x, y, k, k1, c, inner, dir, first, second, current, previous, next, d;

    // all [dx,dy] pairs (array index is the direction)
    // 5 6 7
    // 4 X 0
    // 3 2 1
    var directions = [[1, 0], [1, 1], [0, 1], [-1, 1], [-1, 0], [-1, -1], [0, -1], [1, -1]];

    for (y = 1; y < h - 1; y++)
      for (x = 1; x < w - 1; x++) {
        k = y * w + x;
        if (src[k] === 1) {
          for (i = -w; i < w2; i += w2) { // k - w: outer tracing (y - 1), k + w: inner tracing (y + 1)
            if (src[k + i] === 0 && dest[k + i] === 0) { // need contour tracing
              inner = i === w; // is inner contour tracing ?
              label++; // label for the next contour

              c = [];
              bounds = {
                minX : w,
                minY : h,
                maxX : -1,
                maxY : -1,
              };
              dir = inner ? 2 : 6; // start direction
              current = previous = first = {x: x, y: y};
              second = null;
              while (true) {
                dest[current.y * w + current.x] = label; // mark label for the current point
                // bypass all the neighbors around the current point in a clockwise
                for (j = 0; j < 8; j++) {
                  dir = (dir + 1) % 8;

                  // get the next point by new direction
                  d = directions[dir]; // index as direction
                  next = {x: current.x + d[0], y: current.y + d[1]};

                  k1 = next.y * w + next.x;
                  if (src[k1] === 1) // black boundary pixel
                  {
                    dest[k1] = label; // mark a label
                    break;
                  }
                  dest[k1] = -1; // mark a white boundary pixel
                  next = null;
                }
                if (next === null) break; // no neighbours (one-point contour)
                current = next;
                if (second) {
                  if (previous.x === first.x && previous.y === first.y && current.x === second.x && current.y === second.y) {
                    break; // creating the contour completed when returned to original position
                  }
                } else {
                  second = next;
                }
                _p = {x: previous.x + dx, y: previous.y + dy};
                if(bounds.minX > _p.x)bounds.minX = _p.x;
                if(bounds.maxX < _p.x)bounds.maxX = _p.x;
                if(bounds.minY > _p.y)bounds.minY = _p.y;
                if(bounds.maxY < _p.y)bounds.maxY = _p.y;
                c.push(_p);
                previous = current;
                dir = (dir + 4) % 8; // next dir (symmetrically to the current direction)
              }

              if (next != null) {
                _p = {x: first.x + dx, y: first.y + dy};
                if(bounds.minX >  _p.x)bounds.minX =  _p.x;
                if(bounds.maxX <  _p.x)bounds.maxX =  _p.x;
                if(bounds.minY >  _p.y)bounds.minY =  _p.y;
                if(bounds.maxY <  _p.y)bounds.maxY =  _p.y;
                c.push(_p); // close the contour
                contours.push({inner: inner, label: label, points: c,bounds : bounds}); // add contour to the list
              }
            }
          }
        }
      }

    return contours;
  };

  function rgbToHsl(r, g, b){
    r /= 255, g /= 255, b /= 255;
    var max = Math.max(r, g, b), min = Math.min(r, g, b);
    var h, s, l = (max + min) / 2;

    if(max == min){
      h = s = 0; // achromatic
    }else{
      var d = max - min;
      s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
      switch(max){
        case r: h = (g - b) / d + (g < b ? 6 : 0); break;
        case g: h = (b - r) / d + 2; break;
        case b: h = (r - g) / d + 4; break;
      }
      h /= 6;
    }

    return [h * 255, s* 255, l* 255];
  }

  lib.simplifyContour = function (c, simplifyTolerant, simplifyCount) {
    var
      i, j, k, c, points, len, resPoints, lst, stack, ids,
      maxd, maxi, dist, r1, r2, r12, dx, dy, pi, pf, pl;

    points = c.points;
    len = c.points.length;

    if (len < simplifyCount) { // contour isn't simplified
      resPoints = [];
      for (k = 0; k < len; k++) {
        resPoints.push({x: points[k].x, y: points[k].y});
      }
      return {
        bounds: c.bounds, inner: c.inner, label: c.label, points: resPoints, initialCount: len};
    }

    lst = [0, len - 1]; // always add first and last points
    stack = [{first: 0, last: len - 1}]; // first processed edge

    do {
      ids = stack.shift();
      if (ids.last <= ids.first + 1) // no intermediate points
      {
        continue;
      }

      maxd = -1.0; // max distance from point to current edge
      maxi = ids.first; // index of maximally distant point

      for (i = ids.first + 1; i < ids.last; i++) // bypass intermediate points in edge
      {
        // calc the distance from current point to edge
        pi = points[i];
        pf = points[ids.first];
        pl = points[ids.last];
        dx = pi.x - pf.x;
        dy = pi.y - pf.y;
        r1 = Math.sqrt(dx * dx + dy * dy);
        dx = pi.x - pl.x;
        dy = pi.y - pl.y;
        r2 = Math.sqrt(dx * dx + dy * dy);
        dx = pf.x - pl.x;
        dy = pf.y - pl.y;
        r12 = Math.sqrt(dx * dx + dy * dy);
        if (r1 >= Math.sqrt(r2 * r2 + r12 * r12)) dist = r2;
        else if (r2 >= Math.sqrt(r1 * r1 + r12 * r12)) dist = r1;
        else dist = Math.abs((dy * pi.x - dx * pi.y + pf.x * pl.y - pl.x * pf.y) / r12);

        if (dist > maxd) {
          maxi = i; // save the index of maximally distant point
          maxd = dist;
        }
      }

      if (maxd > simplifyTolerant) // if the max "deviation" is larger than allowed then...
      {
        lst.push(maxi); // add index to the simplified list
        stack.push({first: ids.first, last: maxi}); // add the left part for processing
        stack.push({first: maxi, last: ids.last}); // add the right part for processing
      }

    } while (stack.length > 0);

    resPoints = [];
    len = lst.length;
    lst.sort(function (a, b) {
      return a - b;
    }); // restore index order
    for (k = 0; k < len; k++) {
      resPoints.push({x: points[lst[k]].x, y: points[lst[k]].y}); // add result points to the correct order
    }
    return {
      bounds: c.bounds,
      inner: c.inner, label: c.label, points: resPoints, initialCount: c.points.length
    };
  };

  /** Simplify contours
   * Algorithms: http://psimpl.sourceforge.net/douglas-peucker.html
   * http://neerc.ifmo.ru/wiki/index.php?title=%D0%A3%D0%BF%D1%80%D0%BE%D1%89%D0%B5%D0%BD%D0%B8%D0%B5_%D0%BF%D0%BE%D0%BB%D0%B8%D0%B3%D0%BE%D0%BD%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D0%B9_%D1%86%D0%B5%D0%BF%D0%B8
   * @param {Array} contours: {Array} points, {bool} inner, {int} label
   * @param {float} simplify tolerant
   * @param {int} simplify count: min number of points when the contour is simplified
   * @return {Array} contours: {Array} points, {bool} inner, {int} label, {int} initialCount
   */
  lib.simplifyContours = function (contours, simplifyTolerant, simplifyCount) {
    var lenContours = contours.length,
      result = [];

    // walk through all contours
    for (var j = 0; j < lenContours; j++) {

      result.push(lib.simplifyContour(contours[j], simplifyTolerant, simplifyCount));
    }

    return result;
  };

  return lib;
})();
if (true) {
  module.exports = MagicWand;
}

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 109 */
/***/ (function(module, exports, __webpack_require__) {

var __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/* FileSaver.js
 * A saveAs() FileSaver implementation.
 * 1.1.20150716
 *
 * By Eli Grey, http://eligrey.com
 * License: X11/MIT
 *   See https://github.com/eligrey/FileSaver.js/blob/master/LICENSE.md
 */

/*global self */
/*jslint bitwise: true, indent: 4, laxbreak: true, laxcomma: true, smarttabs: true, plusplus: true */

/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */



var isLikelyNode = typeof Buffer !== 'undefined' && typeof window === 'undefined';



var saveAs = !isLikelyNode &&  (function(view) {
        "use strict";
        // IE <10 is explicitly unsupported
        if (typeof navigator !== "undefined" && /MSIE [1-9]\./.test(navigator.userAgent)) {
            return;
        }
        var
            doc = view.document
        // only get URL when necessary in case Blob.js hasn't overridden it yet
            , get_URL = function() {
                return view.URL || view.webkitURL || view;
            }
            , save_link = doc.createElementNS("http://www.w3.org/1999/xhtml", "a")
            , can_use_save_link = "download" in save_link
            , click = function(node) {
                var event = new MouseEvent("click");
                node.dispatchEvent(event);
            }
            , webkit_req_fs = view.webkitRequestFileSystem
            , req_fs = view.requestFileSystem || webkit_req_fs || view.mozRequestFileSystem
            , throw_outside = function(ex) {
                (view.setImmediate || view.setTimeout)(function() {
                    throw ex;
                }, 0);
            }
            , force_saveable_type = "application/octet-stream"
            , fs_min_size = 0
        // See https://code.google.com/p/chromium/issues/detail?id=375297#c7 and
        // https://github.com/eligrey/FileSaver.js/commit/485930a#commitcomment-8768047
        // for the reasoning behind the timeout and revocation flow
            , arbitrary_revoke_timeout = 500 // in ms
            , revoke = function(file) {
                var revoker = function() {
                    if (typeof file === "string") { // file is an object URL
                        get_URL().revokeObjectURL(file);
                    } else { // file is a File
                        file.remove();
                    }
                };
                if (view.chrome) {
                    revoker();
                } else {
                    setTimeout(revoker, arbitrary_revoke_timeout);
                }
            }
            , dispatch = function(filesaver, event_types, event) {
                event_types = [].concat(event_types);
                var i = event_types.length;
                while (i--) {
                    var listener = filesaver["on" + event_types[i]];
                    if (typeof listener === "function") {
                        try {
                            listener.call(filesaver, event || filesaver);
                        } catch (ex) {
                            throw_outside(ex);
                        }
                    }
                }
            }
            , auto_bom = function(blob) {
                // prepend BOM for UTF-8 XML and text/* types (including HTML)
                if (/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(blob.type)) {
                    return new Blob(["\ufeff", blob], {type: blob.type});
                }
                return blob;
            }
            , FileSaver = function(blob, name, no_auto_bom) {
                if (!no_auto_bom) {
                    blob = auto_bom(blob);
                }
                // First try a.download, then web filesystem, then object URLs
                var
                    filesaver = this
                    , type = blob.type
                    , blob_changed = false
                    , object_url
                    , target_view
                    , dispatch_all = function() {
                        dispatch(filesaver, "writestart progress write writeend".split(" "));
                    }
                // on any filesys errors revert to saving with object URLs
                    , fs_error = function() {
                        // don't create more object URLs than needed
                        if (blob_changed || !object_url) {
                            object_url = get_URL().createObjectURL(blob);
                        }
                        if (target_view) {
                            target_view.location.href = object_url;
                        } else {
                            var new_tab = view.open(object_url, "_blank");
                            if (new_tab == undefined && typeof safari !== "undefined") {
                                //Apple do not allow window.open, see http://bit.ly/1kZffRI
                                view.location.href = object_url
                            }
                        }
                        filesaver.readyState = filesaver.DONE;
                        dispatch_all();
                        revoke(object_url);
                    }
                    , abortable = function(func) {
                        return function() {
                            if (filesaver.readyState !== filesaver.DONE) {
                                return func.apply(this, arguments);
                            }
                        };
                    }
                    , create_if_not_found = {create: true, exclusive: false}
                    , slice
                    ;
                filesaver.readyState = filesaver.INIT;
                if (!name) {
                    name = "download";
                }
                if (can_use_save_link) {
                    object_url = get_URL().createObjectURL(blob);
                    save_link.href = object_url;
                    save_link.download = name;
                    setTimeout(function() {
                        click(save_link);
                        dispatch_all();
                        revoke(object_url);
                        filesaver.readyState = filesaver.DONE;
                    });
                    return;
                }
                // Object and web filesystem URLs have a problem saving in Google Chrome when
                // viewed in a tab, so I force save with application/octet-stream
                // http://code.google.com/p/chromium/issues/detail?id=91158
                // Update: Google errantly closed 91158, I submitted it again:
                // https://code.google.com/p/chromium/issues/detail?id=389642
                if (view.chrome && type && type !== force_saveable_type) {
                    slice = blob.slice || blob.webkitSlice;
                    blob = slice.call(blob, 0, blob.size, force_saveable_type);
                    blob_changed = true;
                }
                // Since I can't be sure that the guessed media type will trigger a download
                // in WebKit, I append .download to the filename.
                // https://bugs.webkit.org/show_bug.cgi?id=65440
                if (webkit_req_fs && name !== "download") {
                    name += ".download";
                }
                if (type === force_saveable_type || webkit_req_fs) {
                    target_view = view;
                }
                if (!req_fs) {
                    fs_error();
                    return;
                }
                fs_min_size += blob.size;
                req_fs(view.TEMPORARY, fs_min_size, abortable(function(fs) {
                    fs.root.getDirectory("saved", create_if_not_found, abortable(function(dir) {
                        var save = function() {
                            dir.getFile(name, create_if_not_found, abortable(function(file) {
                                file.createWriter(abortable(function(writer) {
                                    writer.onwriteend = function(event) {
                                        target_view.location.href = file.toURL();
                                        filesaver.readyState = filesaver.DONE;
                                        dispatch(filesaver, "writeend", event);
                                        revoke(file);
                                    };
                                    writer.onerror = function() {
                                        var error = writer.error;
                                        if (error.code !== error.ABORT_ERR) {
                                            fs_error();
                                        }
                                    };
                                    "writestart progress write abort".split(" ").forEach(function(event) {
                                        writer["on" + event] = filesaver["on" + event];
                                    });
                                    writer.write(blob);
                                    filesaver.abort = function() {
                                        writer.abort();
                                        filesaver.readyState = filesaver.DONE;
                                    };
                                    filesaver.readyState = filesaver.WRITING;
                                }), fs_error);
                            }), fs_error);
                        };
                        dir.getFile(name, {create: false}, abortable(function(file) {
                            // delete file if it already exists
                            file.remove();
                            save();
                        }), abortable(function(ex) {
                            if (ex.code === ex.NOT_FOUND_ERR) {
                                save();
                            } else {
                                fs_error();
                            }
                        }));
                    }), fs_error);
                }), fs_error);
            }
            , FS_proto = FileSaver.prototype
            , saveAs = function(blob, name, no_auto_bom) {
                return new FileSaver(blob, name, no_auto_bom);
            }
            ;
        // IE 10+ (native saveAs)
        if (typeof navigator !== "undefined" && navigator.msSaveOrOpenBlob) {
            return function(blob, name, no_auto_bom) {
                if (!no_auto_bom) {
                    blob = auto_bom(blob);
                }
                return navigator.msSaveOrOpenBlob(blob, name || "download");
            };
        }

        FS_proto.abort = function() {
            var filesaver = this;
            filesaver.readyState = filesaver.DONE;
            dispatch(filesaver, "abort");
        };
        FS_proto.readyState = FS_proto.INIT = 0;
        FS_proto.WRITING = 1;
        FS_proto.DONE = 2;

        FS_proto.error =
            FS_proto.onwritestart =
                FS_proto.onprogress =
                    FS_proto.onwrite =
                        FS_proto.onabort =
                            FS_proto.onerror =
                                FS_proto.onwriteend =
                                    null;

        return saveAs;
    }(
        typeof self !== "undefined" && self
        || typeof window !== "undefined" && window
        || this.content
    ));
// `self` is undefined in Firefox for Android content script context
// while `this` is nsIContentFrameMessageManager
// with an attribute `content` that corresponds to the window

if (typeof module !== "undefined" && module.exports) {
    module.exports.saveAs = saveAs;
} else if (("function" !== "undefined" && __webpack_require__(17) !== null) && (__webpack_require__(18) != null)) {
    !(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_AMD_DEFINE_RESULT__ = function() {
        return saveAs;
    }.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__),
				__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));
}


/***/ }),
/* 110 */
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(51);
var Toolbar = __webpack_require__(3);

Toolbar.prototype.colorpicker = function (el, options) {
  options.format = 'rgb';
  options.opacity = true;
  el.minicolors(options);
};

Toolbar.prototype.tools.color = {
  template:
    '<div class="object-menu-item" title="{title}">' +
    '<div class="btn button-{id} {className}">' +
    '<input type="text" data-format="rgba" data-opacity="true" data-text="true" data-control="saturation" data-swatches="#fff|#000|#f00|#0f0|#00f|#ff0|#0ff"  value="{valueCurrent}" transclude>',
  post: function ($item, data, options, transclude) {
    var target = data.target;

    var _visible = false;
    this.colorpicker(transclude, {
      // value:        data.value.get() ,//|| data.value.get(),
      defaultValue: 'rgb(0,0,0,1)',//data.value.defaultValue || data.value.get(),
      control:      transclude.attr('data-control') || 'hue',
      format:       transclude.attr('data-format') || 'hex',
      keywords:     transclude.attr('data-keywords') || '',
      inline:       transclude.attr('data-inline') === 'true',
      letterCase:   transclude.attr('data-letterCase') || 'lowercase',
      opacity:      transclude.attr('data-opacity'),
      position:     transclude.attr('data-position') || this.tools.color.colorpickerPosition || 'right bottom',
      swatches:     transclude.attr('data-swatches') ? transclude.attr('data-swatches').split('|') : [],
      text:     transclude.attr('data-text'),
      hide: function () {
        _visible = false
      },
      show: function () {
        _visible = true;
      },
      change: function (value, opacity) {
        data.value.set(value);
      }
    });

    var _el = $(transclude.parents()[0]).find(".minicolors-panel");

    var _HIDE = function(e){
      if(_visible && $(e.target).parents().index(_el) == -1){
        transclude.minicolors("hide");
      }
    };
    $("body").on("mousedown",_HIDE)
  }
};


/***/ }),
/* 111 */
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(50);
var Toolbar = __webpack_require__(3);

Toolbar.prototype.fonts = [
  'Arial,Helvetica,sans-serif',
  'Arial Black,Gadget,sans-serif',
  'Comic Sans MS,cursive',
  'Courier New,Courier,monospace',
  'Georgia,serif',
  'Impact,Charcoal,sans-serif',
  'Lucida Console,Monaco,monospace',
  'Lucida Sans Unicode,Lucida Grande,sans-serif',
  'Palatino Linotype,Book Antiqua,Palatino,serif',
  'Tahoma,Geneva,sans-serif',
  'Times New Roman,Times,serif',
  'Trebuchet MS,Helvetica,sans-serif',
  'Verdana,Geneva,sans-serif',
  'Gill Sans,Geneva,sans-serif'
];


Toolbar.prototype.tools.fontFamily = {
  scope: function (data, options) {
    return {
      //currentValue: data.value.get(),
      onchange: function (e) {
        data.value.set(parseFloat($(e.target).val()));
      }
    }
  },
  template: '<div class="object-menu-item object-menu-font-family" title="{title}">' +
  '<div class="fontSelect" transclude><div class="arrow-down">',
    post: function ($item, data, options, transclude) {

    transclude.fontSelector({
      'hide_fallbacks': true,
      'initial': data.value.get(),//'Courier New,Courier New,Courier,monospace',
      'selected': data.value.set.bind(data.target),
      'fonts': data.data
    });
  }
};


/***/ }),
/* 112 */
/***/ (function(module, exports, __webpack_require__) {


var Toolbar = __webpack_require__(3);

Toolbar.prototype.updateSelectedOption = function(data){
  var $checked = data.$item.find(":checked");
  var _html = $checked.parents(0).html();
  data.$item.find('.btn-selected-option').html(_html);
};

Toolbar.prototype.tools.option = {
  scope: function (data, options) {
    var _self = this;
    return {
      parentId: data.parent.id,
      valueCurrent: data.parent.value.get() === data.option,
      onchange: function () {
        //оптимизировать

        var $checked = data.$item.find(":checked");
        var _value = $checked.val();
        if (_value == data.option) {
          data.parent.value.set(_value);
        }
        _self.updateSelectedOption(data.parent);
      }
    }
  },
  template:
    '<div class="object-menu-item object-menu-option " title="{title}" >' +
    '<input type="radio" id="tool-{id}" dp-checked="{valueCurrent}" name="{parentId}" value="{option}" onchange="onchange()">' +
    '<label class="btn button-{id} {className}" for="tool-{id}">' +
      '<img dp-if="icon" dp-src="icon">' +
      '<span dp-include="svg" dp-if="svg"></span>' +
      '<span dp-if="title" class="option-title">{title}</span>'
};

Toolbar.prototype.tools.options = {
  scope: function (data, options) {
    return {
      className: data.className || 'items-column',
      buttonsTitle: options.buttons && options.buttons.title || false,
      buttonsClassName: (options.buttons.className || '')
    }
  },
  template:
  '<div class="object-menu-item object-menu-options {className}" title="{title}">' +
  '<div class="btn btn-selected-option"></div>' +
  '<div class="object-menu-options-container" transclude>',
  post: function ($item, data, options, transclude) {
    this.generateMenu(data.target, transclude, options, data.menu);
    this.updateSelectedOption(data);
  }
};


/***/ }),
/* 113 */
/***/ (function(module, exports, __webpack_require__) {

var __WEBPACK_AMD_DEFINE_RESULT__;/* Web Font Loader v1.6.26 - (c) Adobe Systems, Google. License: Apache 2.0 */(function(){function aa(a,b,c){return a.call.apply(a.bind,arguments)}function ba(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,d);return a.apply(b,c)}}return function(){return a.apply(b,arguments)}}function p(a,b,c){p=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?aa:ba;return p.apply(null,arguments)}var q=Date.now||function(){return+new Date};function ca(a,b){this.a=a;this.m=b||a;this.c=this.m.document}var da=!!window.FontFace;function t(a,b,c,d){b=a.c.createElement(b);if(c)for(var e in c)c.hasOwnProperty(e)&&("style"==e?b.style.cssText=c[e]:b.setAttribute(e,c[e]));d&&b.appendChild(a.c.createTextNode(d));return b}function u(a,b,c){a=a.c.getElementsByTagName(b)[0];a||(a=document.documentElement);a.insertBefore(c,a.lastChild)}function v(a){a.parentNode&&a.parentNode.removeChild(a)}
  function w(a,b,c){b=b||[];c=c||[];for(var d=a.className.split(/\s+/),e=0;e<b.length;e+=1){for(var f=!1,g=0;g<d.length;g+=1)if(b[e]===d[g]){f=!0;break}f||d.push(b[e])}b=[];for(e=0;e<d.length;e+=1){f=!1;for(g=0;g<c.length;g+=1)if(d[e]===c[g]){f=!0;break}f||b.push(d[e])}a.className=b.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function y(a,b){for(var c=a.className.split(/\s+/),d=0,e=c.length;d<e;d++)if(c[d]==b)return!0;return!1}
  function z(a){if("string"===typeof a.f)return a.f;var b=a.m.location.protocol;"about:"==b&&(b=a.a.location.protocol);return"https:"==b?"https:":"http:"}function ea(a){return a.m.location.hostname||a.a.location.hostname}
  function A(a,b,c){function d(){k&&e&&f&&(k(g),k=null)}b=t(a,"link",{rel:"stylesheet",href:b,media:"all"});var e=!1,f=!0,g=null,k=c||null;da?(b.onload=function(){e=!0;d()},b.onerror=function(){e=!0;g=Error("Stylesheet failed to load");d()}):setTimeout(function(){e=!0;d()},0);u(a,"head",b)}
  function B(a,b,c,d){var e=a.c.getElementsByTagName("head")[0];if(e){var f=t(a,"script",{src:b}),g=!1;f.onload=f.onreadystatechange=function(){g||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(g=!0,c&&c(null),f.onload=f.onreadystatechange=null,"HEAD"==f.parentNode.tagName&&e.removeChild(f))};e.appendChild(f);setTimeout(function(){g||(g=!0,c&&c(Error("Script load timeout")))},d||5E3);return f}return null};function C(){this.a=0;this.c=null}function D(a){a.a++;return function(){a.a--;E(a)}}function F(a,b){a.c=b;E(a)}function E(a){0==a.a&&a.c&&(a.c(),a.c=null)};function G(a){this.a=a||"-"}G.prototype.c=function(a){for(var b=[],c=0;c<arguments.length;c++)b.push(arguments[c].replace(/[\W_]+/g,"").toLowerCase());return b.join(this.a)};function H(a,b){this.c=a;this.f=4;this.a="n";var c=(b||"n4").match(/^([nio])([1-9])$/i);c&&(this.a=c[1],this.f=parseInt(c[2],10))}function fa(a){return I(a)+" "+(a.f+"00")+" 300px "+J(a.c)}function J(a){var b=[];a=a.split(/,\s*/);for(var c=0;c<a.length;c++){var d=a[c].replace(/['"]/g,"");-1!=d.indexOf(" ")||/^\d/.test(d)?b.push("'"+d+"'"):b.push(d)}return b.join(",")}function K(a){return a.a+a.f}function I(a){var b="normal";"o"===a.a?b="oblique":"i"===a.a&&(b="italic");return b}
  function ga(a){var b=4,c="n",d=null;a&&((d=a.match(/(normal|oblique|italic)/i))&&d[1]&&(c=d[1].substr(0,1).toLowerCase()),(d=a.match(/([1-9]00|normal|bold)/i))&&d[1]&&(/bold/i.test(d[1])?b=7:/[1-9]00/.test(d[1])&&(b=parseInt(d[1].substr(0,1),10))));return c+b};function ha(a,b){this.c=a;this.f=a.m.document.documentElement;this.h=b;this.a=new G("-");this.j=!1!==b.events;this.g=!1!==b.classes}function ia(a){a.g&&w(a.f,[a.a.c("wf","loading")]);L(a,"loading")}function M(a){if(a.g){var b=y(a.f,a.a.c("wf","active")),c=[],d=[a.a.c("wf","loading")];b||c.push(a.a.c("wf","inactive"));w(a.f,c,d)}L(a,"inactive")}function L(a,b,c){if(a.j&&a.h[b])if(c)a.h[b](c.c,K(c));else a.h[b]()};function ja(){this.c={}}function ka(a,b,c){var d=[],e;for(e in b)if(b.hasOwnProperty(e)){var f=a.c[e];f&&d.push(f(b[e],c))}return d};function N(a,b){this.c=a;this.f=b;this.a=t(this.c,"span",{"aria-hidden":"true"},this.f)}function O(a){u(a.c,"body",a.a)}function P(a){return"display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+J(a.c)+";"+("font-style:"+I(a)+";font-weight:"+(a.f+"00")+";")};function Q(a,b,c,d,e,f){this.g=a;this.j=b;this.a=d;this.c=c;this.f=e||3E3;this.h=f||void 0}Q.prototype.start=function(){var a=this.c.m.document,b=this,c=q(),d=new Promise(function(d,e){function k(){q()-c>=b.f?e():a.fonts.load(fa(b.a),b.h).then(function(a){1<=a.length?d():setTimeout(k,25)},function(){e()})}k()}),e=new Promise(function(a,d){setTimeout(d,b.f)});Promise.race([e,d]).then(function(){b.g(b.a)},function(){b.j(b.a)})};function R(a,b,c,d,e,f,g){this.v=a;this.B=b;this.c=c;this.a=d;this.s=g||"BESbswy";this.f={};this.w=e||3E3;this.u=f||null;this.o=this.j=this.h=this.g=null;this.g=new N(this.c,this.s);this.h=new N(this.c,this.s);this.j=new N(this.c,this.s);this.o=new N(this.c,this.s);a=new H(this.a.c+",serif",K(this.a));a=P(a);this.g.a.style.cssText=a;a=new H(this.a.c+",sans-serif",K(this.a));a=P(a);this.h.a.style.cssText=a;a=new H("serif",K(this.a));a=P(a);this.j.a.style.cssText=a;a=new H("sans-serif",K(this.a));a=
    P(a);this.o.a.style.cssText=a;O(this.g);O(this.h);O(this.j);O(this.o)}var S={D:"serif",C:"sans-serif"},T=null;function U(){if(null===T){var a=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);T=!!a&&(536>parseInt(a[1],10)||536===parseInt(a[1],10)&&11>=parseInt(a[2],10))}return T}R.prototype.start=function(){this.f.serif=this.j.a.offsetWidth;this.f["sans-serif"]=this.o.a.offsetWidth;this.A=q();la(this)};
  function ma(a,b,c){for(var d in S)if(S.hasOwnProperty(d)&&b===a.f[S[d]]&&c===a.f[S[d]])return!0;return!1}function la(a){var b=a.g.a.offsetWidth,c=a.h.a.offsetWidth,d;(d=b===a.f.serif&&c===a.f["sans-serif"])||(d=U()&&ma(a,b,c));d?q()-a.A>=a.w?U()&&ma(a,b,c)&&(null===a.u||a.u.hasOwnProperty(a.a.c))?V(a,a.v):V(a,a.B):na(a):V(a,a.v)}function na(a){setTimeout(p(function(){la(this)},a),50)}function V(a,b){setTimeout(p(function(){v(this.g.a);v(this.h.a);v(this.j.a);v(this.o.a);b(this.a)},a),0)};function W(a,b,c){this.c=a;this.a=b;this.f=0;this.o=this.j=!1;this.s=c}var X=null;W.prototype.g=function(a){var b=this.a;b.g&&w(b.f,[b.a.c("wf",a.c,K(a).toString(),"active")],[b.a.c("wf",a.c,K(a).toString(),"loading"),b.a.c("wf",a.c,K(a).toString(),"inactive")]);L(b,"fontactive",a);this.o=!0;oa(this)};
  W.prototype.h=function(a){var b=this.a;if(b.g){var c=y(b.f,b.a.c("wf",a.c,K(a).toString(),"active")),d=[],e=[b.a.c("wf",a.c,K(a).toString(),"loading")];c||d.push(b.a.c("wf",a.c,K(a).toString(),"inactive"));w(b.f,d,e)}L(b,"fontinactive",a);oa(this)};function oa(a){0==--a.f&&a.j&&(a.o?(a=a.a,a.g&&w(a.f,[a.a.c("wf","active")],[a.a.c("wf","loading"),a.a.c("wf","inactive")]),L(a,"active")):M(a.a))};function pa(a){this.j=a;this.a=new ja;this.h=0;this.f=this.g=!0}pa.prototype.load=function(a){this.c=new ca(this.j,a.context||this.j);this.g=!1!==a.events;this.f=!1!==a.classes;qa(this,new ha(this.c,a),a)};
  function ra(a,b,c,d,e){var f=0==--a.h;(a.f||a.g)&&setTimeout(function(){var a=e||null,k=d||null||{};if(0===c.length&&f)M(b.a);else{b.f+=c.length;f&&(b.j=f);var h,m=[];for(h=0;h<c.length;h++){var l=c[h],n=k[l.c],r=b.a,x=l;r.g&&w(r.f,[r.a.c("wf",x.c,K(x).toString(),"loading")]);L(r,"fontloading",x);r=null;null===X&&(X=window.FontFace?(x=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent))?42<parseInt(x[1],10):!0:!1);X?r=new Q(p(b.g,b),p(b.h,b),b.c,l,b.s,n):r=new R(p(b.g,b),p(b.h,b),b.c,l,b.s,a,
    n);m.push(r)}for(h=0;h<m.length;h++)m[h].start()}},0)}function qa(a,b,c){var d=[],e=c.timeout;ia(b);var d=ka(a.a,c,a.c),f=new W(a.c,b,e);a.h=d.length;b=0;for(c=d.length;b<c;b++)d[b].load(function(b,d,c){ra(a,f,b,d,c)})};function sa(a,b){this.c=a;this.a=b}function ta(a,b,c){var d=z(a.c);a=(a.a.api||"fast.fonts.net/jsapi").replace(/^.*http(s?):(\/\/)?/,"");return d+"//"+a+"/"+b+".js"+(c?"?v="+c:"")}
  sa.prototype.load=function(a){function b(){if(f["__mti_fntLst"+d]){var c=f["__mti_fntLst"+d](),e=[],h;if(c)for(var m=0;m<c.length;m++){var l=c[m].fontfamily;void 0!=c[m].fontStyle&&void 0!=c[m].fontWeight?(h=c[m].fontStyle+c[m].fontWeight,e.push(new H(l,h))):e.push(new H(l))}a(e)}else setTimeout(function(){b()},50)}var c=this,d=c.a.projectId,e=c.a.version;if(d){var f=c.c.m;B(this.c,ta(c,d,e),function(e){e?a([]):(f["__MonotypeConfiguration__"+d]=function(){return c.a},b())}).id="__MonotypeAPIScript__"+
    d}else a([])};function ua(a,b){this.c=a;this.a=b}ua.prototype.load=function(a){var b,c,d=this.a.urls||[],e=this.a.families||[],f=this.a.testStrings||{},g=new C;b=0;for(c=d.length;b<c;b++)A(this.c,d[b],D(g));var k=[];b=0;for(c=e.length;b<c;b++)if(d=e[b].split(":"),d[1])for(var h=d[1].split(","),m=0;m<h.length;m+=1)k.push(new H(d[0],h[m]));else k.push(new H(d[0]));F(g,function(){a(k,f)})};function va(a,b,c){a?this.c=a:this.c=b+wa;this.a=[];this.f=[];this.g=c||""}var wa="//fonts.googleapis.com/css";function xa(a,b){for(var c=b.length,d=0;d<c;d++){var e=b[d].split(":");3==e.length&&a.f.push(e.pop());var f="";2==e.length&&""!=e[1]&&(f=":");a.a.push(e.join(f))}}
  function ya(a){if(0==a.a.length)throw Error("No fonts to load!");if(-1!=a.c.indexOf("kit="))return a.c;for(var b=a.a.length,c=[],d=0;d<b;d++)c.push(a.a[d].replace(/ /g,"+"));b=a.c+"?family="+c.join("%7C");0<a.f.length&&(b+="&subset="+a.f.join(","));0<a.g.length&&(b+="&text="+encodeURIComponent(a.g));return b};function za(a){this.f=a;this.a=[];this.c={}}
  var Aa={latin:"BESbswy","latin-ext":"\u00e7\u00f6\u00fc\u011f\u015f",cyrillic:"\u0439\u044f\u0416",greek:"\u03b1\u03b2\u03a3",khmer:"\u1780\u1781\u1782",Hanuman:"\u1780\u1781\u1782"},Ba={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},Ca={i:"i",italic:"i",n:"n",normal:"n"},
    Da=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/;
  function Ea(a){for(var b=a.f.length,c=0;c<b;c++){var d=a.f[c].split(":"),e=d[0].replace(/\+/g," "),f=["n4"];if(2<=d.length){var g;var k=d[1];g=[];if(k)for(var k=k.split(","),h=k.length,m=0;m<h;m++){var l;l=k[m];if(l.match(/^[\w-]+$/)){var n=Da.exec(l.toLowerCase());if(null==n)l="";else{l=n[2];l=null==l||""==l?"n":Ca[l];n=n[1];if(null==n||""==n)n="4";else var r=Ba[n],n=r?r:isNaN(n)?"4":n.substr(0,1);l=[l,n].join("")}}else l="";l&&g.push(l)}0<g.length&&(f=g);3==d.length&&(d=d[2],g=[],d=d?d.split(","):
    g,0<d.length&&(d=Aa[d[0]])&&(a.c[e]=d))}a.c[e]||(d=Aa[e])&&(a.c[e]=d);for(d=0;d<f.length;d+=1)a.a.push(new H(e,f[d]))}};function Fa(a,b){this.c=a;this.a=b}var Ga={Arimo:!0,Cousine:!0,Tinos:!0};Fa.prototype.load=function(a){var b=new C,c=this.c,d=new va(this.a.api,z(c),this.a.text),e=this.a.families;xa(d,e);var f=new za(e);Ea(f);A(c,ya(d),D(b));F(b,function(){a(f.a,f.c,Ga)})};function Ha(a,b){this.c=a;this.a=b}Ha.prototype.load=function(a){var b=this.a.id,c=this.c.m;b?B(this.c,(this.a.api||"https://use.typekit.net")+"/"+b+".js",function(b){if(b)a([]);else if(c.Typekit&&c.Typekit.config&&c.Typekit.config.fn){b=c.Typekit.config.fn;for(var e=[],f=0;f<b.length;f+=2)for(var g=b[f],k=b[f+1],h=0;h<k.length;h++)e.push(new H(g,k[h]));try{c.Typekit.load({events:!1,classes:!1,async:!0})}catch(m){}a(e)}},2E3):a([])};function Ia(a,b){this.c=a;this.f=b;this.a=[]}Ia.prototype.load=function(a){var b=this.f.id,c=this.c.m,d=this;b?(c.__webfontfontdeckmodule__||(c.__webfontfontdeckmodule__={}),c.__webfontfontdeckmodule__[b]=function(b,c){for(var g=0,k=c.fonts.length;g<k;++g){var h=c.fonts[g];d.a.push(new H(h.name,ga("font-weight:"+h.weight+";font-style:"+h.style)))}a(d.a)},B(this.c,z(this.c)+(this.f.api||"//f.fontdeck.com/s/css/js/")+ea(this.c)+"/"+b+".js",function(b){b&&a([])})):a([])};var Y=new pa(window);Y.a.c.custom=function(a,b){return new ua(b,a)};Y.a.c.fontdeck=function(a,b){return new Ia(b,a)};Y.a.c.monotype=function(a,b){return new sa(b,a)};Y.a.c.typekit=function(a,b){return new Ha(b,a)};Y.a.c.google=function(a,b){return new Fa(b,a)};var Z={load:p(Y.load,Y)}; true?!(__WEBPACK_AMD_DEFINE_RESULT__ = function(){return Z}.call(exports, __webpack_require__, exports, module),
				__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__)):"undefined"!==typeof module&&module.exports?module.exports=Z:(window.WebFont=Z,window.WebFontConfig&&Y.load(window.WebFontConfig));}());


/***/ }),
/* 114 */
/***/ (function(module, exports, __webpack_require__) {

/* WEBPACK VAR INJECTION */(function(fabric) {fabric.selectColorsTool = function(){
  return {
    className: 'button-colorwheel',
    type: 'effect',
    visible: function(){
      return !!this.logoSvg;
    },
    observe: "task:changed",
    effectTpl:
    '<div id="select-colors-color-list"></div>' +
    '<div id="select-colors-colorwheel"></div>' +
    //'<div class="btn btn-circle button-eyedropper" id="select-colors-eyedropper"></div>' +
    '<div class="btn btn-circle button-bolt" id="select-colors-action-button"></div>' +
    '<input id="select-colors-threshold" type="range" min="1" max="255">',
      actionParameters: function(el,data){
        var app = this;
    $(app.canvas.wrapperEl).click(function(e){
      var data = app.canvas.wrapperEl.get
    });

    var initialThreshold = 55;
    var colors = app.logoSvg.extractColors();
    var _keys =  Object.keys(colors);

    for(var i = 0 ; i < _keys.length - 1; i++){
      for(var j = _keys.length ; j-- > i+1; ) {
        var color1 = new fabric.Color(_keys[i])._source;
        var color2 = new fabric.Color(_keys[j])._source;
        if (MagicWand.difference(color1, color2) < initialThreshold) {
          delete colors[_keys[j]];
          _keys.splice(j);
        }
      }
    }


    var els = [],
      values = [],
      currentIndex = 0,
      threshold = [],
      minicolors = el.find("#select-colors-colorwheel"),
      list = el.find("#select-colors-color-list"),
      actionBtn = el.find('#select-colors-action-button'),
      thresholdEl = el.find('#select-colors-threshold');
      //eyedropperBtn = el.find('#select-colors-eyedropper');

    var _keys =  Object.keys(colors);

    for(var i in _keys) {
      if(_keys[i][0] !== '#') {
        _keys[i] = '#' + new fabric.Color(_keys[i]).toHex();
      }
    }

      function eyedrop(e){
          var ctx = app.canvas.lowerCanvasEl.getContext("2d");
          var data = ctx.getImageData(e.offsetX, e.offsetY,1,1);
          data.data[3] /= 255;
          var color = "rgba(" + data.data.join(",") + ")";
          setColor(color);
          e.stopPropagation();
      }

   // eyedropperBtn.click(function(){
      app.canvas.interactive = false;
      app.canvas.setCursor(app.canvas.eyedropperCursor);
      $(app.canvas.upperCanvasEl).on("click",eyedrop);
 //   });



    actionBtn.click(function(){
      data.action(values,threshold)
    });

    function setColor(value,opacity){
      values[currentIndex] = value;
      els[currentIndex].css('background-color',value);
    }

    function setValue(index){
      currentIndex = index;
      minicolors.minicolors('settings',{
        defaultValue: _keys[currentIndex]
      });
      thresholdEl.val(threshold[index]);
      minicolors.minicolors('value',_keys[index]);
    }


    for(var i in _keys){
      els[i] = (function(color){
        values.push(color);
        threshold.push(initialThreshold);

        var $color = $("<span>").css({'background-color': color});

        var $rm = $("<i>").addClass('fa fa-trash');

        $rm.click(function(){
          var index = _keys.indexOf(color);
          _keys.splice(index,1);
          els.splice(index,1);
          threshold.splice(index,1);
          values.splice(index,1);
          $color.remove();
        });

        $color.click(function(){
          setValue(_keys.indexOf(color))
        });

        $color.append($rm);
        list.append($color);
        return $color;
      })(_keys[i]);
    }

    color = _keys[currentIndex];

    thresholdEl.change(function(){
      threshold[currentIndex] = parseInt(thresholdEl.val());

      app.canvas.pathfinder.colorSelection([values[currentIndex]],[threshold[currentIndex]]);
      app.canvas.pathfinder.render();
      app.canvas.freeDrawingBrush.enable();
    });
    thresholdEl.val(threshold[currentIndex]);

    minicolors.minicolors({
      change: setColor,
      format: 'hex',
      control: 'saturation',
      inline: true
    });

    setValue(0);


    return function(){
      $(app.canvas.upperCanvasEl).off("click",eyedrop);
      app.canvas.interactive = true;
    }
  },
    title: 'removeBackground',
    action:  function (colors,threshold) {
      this.canvas.pathfinder.colorSelection(colors,threshold);
      this.canvas.pathfinder.render();
      this.canvas.freeDrawingBrush.enable();
    }
  }
}

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(0)))

/***/ }),
/* 115 */
/***/ (function(module, exports) {


var deepDiffMapper = {
  VALUE_CREATED: 'created',
  VALUE_UPDATED: 'updated',
  VALUE_DELETED: 'deleted',
  VALUE_UNCHANGED: 'unchanged',
  map: function(obj1, obj2) {
    if (this.isFunction(obj1) || this.isFunction(obj2)) {
      throw 'Invalid argument. Function given, object expected.';
    }
    if (this.isValue(obj1) || this.isValue(obj2)) {
      return {
        '_map_type': this.compareValues(obj1, obj2),
        '_map_data': (obj2 === undefined) ? obj1 : obj2
      };
    }


    if(_.isArray(obj2)){
      var _array = true;
      var diff = [];
    }else{
      var diff = {};
    }


    for (var key in obj1) {
      if (this.isFunction(obj1[key])) {
        continue;
      }

      var value2 = undefined;
      if ('undefined' != typeof(obj2[key])) {
        value2 = obj2[key];
      }

      diff[key] = this.map(obj1[key], value2);
    }
    for (var key in obj2) {
      if (this.isFunction(obj2[key]) || ('undefined' != typeof(diff[key]))) {
        continue;
      }

      var _val = this.map(undefined, obj2[key]);
      if(_array){
        diff.push(_val);
      }else{
        diff[key] = _val
      }
    }

    return {
      '_map_type': '',
      '_map_data': diff
    };

  },
  compareValues: function(value1, value2) {
    if (value1 === value2) {
      return this.VALUE_UNCHANGED;
    }
    if ('undefined' == typeof(value1)) {
      return this.VALUE_CREATED;
    }
    if ('undefined' == typeof(value2)) {
      return this.VALUE_DELETED;
    }

    return this.VALUE_UPDATED;
  },
  isFunction: function(obj) {
    return {}.toString.apply(obj) === '[object Function]';
  },
  isArray: function(obj) {
    return {}.toString.apply(obj) === '[object Array]';
  },
  isObject: function(obj) {
    return {}.toString.apply(obj) === '[object Object]';
  },
  isValue: function(obj) {
    return !this.isObject(obj) && !this.isArray(obj);
  }
};

module.exports = {
  differenceMap: deepDiffMapper.map.bind(deepDiffMapper),
  syntaxHighlight: function (json) {
    if (typeof json != 'string') {
      json = JSON.stringify(json, null, 2);
    }
    json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');

    json = json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {
      var cls = 'number';
      if (/^"/.test(match)) {
        if (/:$/.test(match)) {
          cls = 'key';
        } else {
          cls = 'string';
        }
      } else if (/true|false/.test(match)) {
        cls = 'boolean';
      } else if (/null/.test(match)) {
        cls = 'null';
      }
      return '<span class="' + cls + '">' + match + '</span>';
    });
    return json = json.replace(/[^,\n][^\n]*/g, function (match) {
      return '<span>' + match + '</span>';
    });
  },
  differenceHighlight: function  (json,output){

    if(output){
      output.empty();
    }else{
      output = $("<pre>");
    }


    function printObject(json,level,output,comma,objectIndex){
      var _el = $("<p>");

      _el.append($("<span>").addClass("object-key").append(
        $("<span>").text(new Array(level).join(' ') )
      ));
      if(objectIndex){
        _el.append(
          $("<span>").text('"').addClass("invisible"),
          $("<span>").addClass("key").text(objectIndex),
          $("<span>").text('"').addClass("invisible"),
          $("<span>").text(': ')
        );
      }

      if(json && json._map_type !== undefined){
        _el.addClass(json._map_type);

        if(_.isArray(json._map_data)){
          _el.append($("<span>").text("["));
          var _last_key = json._map_data.length - 1;
          for(var i in json._map_data){
            printObject(json._map_data[i],level + 1,_el,i != _last_key);
          }
          _el.append($("<p>").text(new Array(level ).join(' ') + "]" + (comma ? "," : "")));
        }
        else if(_.isObject(json._map_data)){
          _el.append($("<span>").text("{"));
          var _last_key = Object.keys(json._map_data).pop();
          for(var i in json._map_data){
            printObject(json._map_data[i],level + 1,_el,i != _last_key,i);
          }
          _el.append($("<p>").text(new Array(level ).join(' ') + "}" + (comma ? "," : "")));
        }
        else{

          if(_.isNull(json._map_data)){
            _el.append(
              $("<span>").text(JSON.stringify(json._map_data, null, 2))
            );
          }
          else if(json._map_data.constructor === String ){
            _el.append(
              $("<span>").text('"'),
              $("<span>").addClass('string').text(json._map_data),
              $("<span>").text('"')
            );
          }
          else if(json._map_data.constructor === Number || json._map_data.constructor === Boolean){
            _el.append(
              $("<span>").addClass('number').text(json._map_data)
            );
          }
          else{
            _el.append(
              $("<span>").text(JSON.stringify(json._map_data, null, 2))
            );
          }
          if(comma){
            _el.append(
              $("<span>").text(",")
            );
          }


        }
      }else{
        _el.append(
          $("<span>").text(JSON.stringify(json, null, 2))
        )

        if(comma){
          _el.append(
            $("<span>").text(",")
          );
        }

      }

      output.append(_el);

    }
    printObject(json,1,output);
    return output;
  }
};



/***/ }),
/* 116 */
/***/ (function(module, exports) {

module.exports = require("fs");

/***/ })
/******/ ]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmllcmEuZGV2LmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vL3dlYnBhY2svYm9vdHN0cmFwIDRmZThhZmMzYzRiYzE5NzAyOGVkIiwid2VicGFjazovLy9leHRlcm5hbCBcImZhYnJpY1wiIiwid2VicGFjazovLy8uL3V0aWwvb2JqZWN0LmpzIiwid2VicGFjazovLy8uL3V0aWwvdXRpbC5qcyIsIndlYnBhY2s6Ly8vLi9wbHVnaW5zL3Rvb2xiYXIuanMiLCJ3ZWJwYWNrOi8vLy4vcGx1Z2lucy91bmRlcnNjb3JlLmpzIiwid2VicGFjazovLy8uL3V0aWwvY29tcGlsZS5qcyIsIndlYnBhY2s6Ly8vLi91dGlsL3BhdGguanMiLCJ3ZWJwYWNrOi8vLy4vbWl4aW5zL0Jlemllck1peGluLmpzIiwid2VicGFjazovLy8uL21peGlucy9DYWNoZU1peGluLmpzIiwid2VicGFjazovLy8uL21peGlucy9TdHJva2VNaXhpbi5qcyIsIndlYnBhY2s6Ly8vLi9wbHVnaW5zL2Jlemllci5qcyIsIndlYnBhY2s6Ly8vLi9wbHVnaW5zL2hpc3RvcnkuanMiLCJ3ZWJwYWNrOi8vL2V4dGVybmFsIFwiJFwiIiwid2VicGFjazovLy8uL21lZGlhL2Vycm9yLWJ1dHRvbi5zdmciLCJ3ZWJwYWNrOi8vLy4vbW9kdWxlcy5qcyIsIndlYnBhY2s6Ly8vLi91dGlsL2RhdGEuanMiLCJ3ZWJwYWNrOi8vLy4vdXRpbC9sb2FkZXIuanMiLCJ3ZWJwYWNrOi8vLyh3ZWJwYWNrKS9idWlsZGluL2FtZC1kZWZpbmUuanMiLCJ3ZWJwYWNrOi8vLyh3ZWJwYWNrKS9idWlsZGluL2FtZC1vcHRpb25zLmpzIiwid2VicGFjazovLy8uL21lZGlhL2V5ZWRyb3BwZXIuc3ZnIiwid2VicGFjazovLy8uL21lZGlhL2xhc3NvLnN2ZyIsIndlYnBhY2s6Ly8vLi9tZWRpYS9sb2FkZXIuc3ZnIiwid2VicGFjazovLy8uL21lZGlhL3BhaW50LWJ1Y2tldC5zdmciLCJ3ZWJwYWNrOi8vLy4vbWVkaWEvcG9seWdvbi5wbmciLCJ3ZWJwYWNrOi8vLy4vbWVkaWEvcm90YXRlLnBuZyIsIndlYnBhY2s6Ly8vLi9tZWRpYS90YXJnZXQuc3ZnIiwid2VicGFjazovLy8uL2JydXNoZXMvQmFzZUJydXNoLmpzIiwid2VicGFjazovLy8uL2JydXNoZXMvUGFpbnRCdWNrZXRCcnVzaC5qcyIsIndlYnBhY2s6Ly8vLi9icnVzaGVzL1BhaW50UGVuQnJ1c2guanMiLCJ3ZWJwYWNrOi8vLy4vYnJ1c2hlcy9QZW5jaWxCcnVzaC5qcyIsIndlYnBhY2s6Ly8vLi9icnVzaGVzL1BvaW50c0JydXNoLmpzIiwid2VicGFjazovLy8uL2JydXNoZXMvUG9seWdvbkJydXNoLmpzIiwid2VicGFjazovLy8uL2JydXNoZXMvUmVjdGFuZ2xlQnJ1c2guanMiLCJ3ZWJwYWNrOi8vLy4vY29yZS9hcHBsaWNhdGlvbi5qcyIsIndlYnBhY2s6Ly8vLi9jb3JlL2Jhc2UuanMiLCJ3ZWJwYWNrOi8vLy4vY29yZS9kZWJ1Zy5qcyIsIndlYnBhY2s6Ly8vLi9jb3JlL2RlbW8uanMiLCJ3ZWJwYWNrOi8vLy4vY29yZS9ldmVudHMuanMiLCJ3ZWJwYWNrOi8vLy4vY29yZS9vYmplY3QuanMiLCJ3ZWJwYWNrOi8vLy4vY29yZS9vYnNlcnZlLmpzIiwid2VicGFjazovLy8uL2NvcmUvcGx1Z2luc01peGluLmpzIiwid2VicGFjazovLy8uL2NvcmUvcHJvamVjdC5hY2Nlc3MuanMiLCJ3ZWJwYWNrOi8vLy4vY29yZS9wcm9qZWN0LmpzIiwid2VicGFjazovLy8uL2NvcmUvcHJvdG90eXBlcy5qcyIsIndlYnBhY2s6Ly8vLi9jb3JlL3NsaWRlLmpzIiwid2VicGFjazovLy8uL2NvcmUvc3RhdGljQ2FudmFzLmpzIiwid2VicGFjazovLy8uL2ZpZXJhLmpzIiwid2VicGFjazovLy8uL2ZpbHRlcnMvUmVtb3ZlV2hpdGVEUC5qcyIsIndlYnBhY2s6Ly8vLi9maWx0ZXJzL1Jlc2l6ZURQLmpzIiwid2VicGFjazovLy8uL2pxdWVyeS9kcmFnZ2FibGUuanMiLCJ3ZWJwYWNrOi8vLy4vanF1ZXJ5L2ZvbnRTZWxlY3Rvci5qcyIsIndlYnBhY2s6Ly8vLi9qcXVlcnkvbWluaWNvbG9ycy5qcyIsIndlYnBhY2s6Ly8vLi9taXhpbnMvU2hhcGVNaXhpbi5qcyIsIndlYnBhY2s6Ly8vLi9taXhpbnMvVHJhbnNmb3JtZWRJbWFnZU1peGluLmpzIiwid2VicGFjazovLy8uL21vZHVsZXMvYWN0aXZhdGUuanMiLCJ3ZWJwYWNrOi8vLy4vbW9kdWxlcy9hcmVhcy5qcyIsIndlYnBhY2s6Ly8vLi9tb2R1bGVzL2JpbmQuanMiLCJ3ZWJwYWNrOi8vLy4vbW9kdWxlcy9ib3JkZXJJbWFnZS5qcyIsIndlYnBhY2s6Ly8vLi9tb2R1bGVzL2NsaXBUby5qcyIsIndlYnBhY2s6Ly8vLi9tb2R1bGVzL2NvbG9yTmFtZU1hcC5qcyIsIndlYnBhY2s6Ly8vLi9tb2R1bGVzL2NvbnRyb2xzLmpzIiwid2VicGFjazovLy8uL21vZHVsZXMvY3Vyc29ycy5qcyIsIndlYnBhY2s6Ly8vLi9tb2R1bGVzL2RlYWN0aXZhdGlvbi5qcyIsIndlYnBhY2s6Ly8vLi9tb2R1bGVzL2Ryb3BwYWJsZS5qcyIsIndlYnBhY2s6Ly8vLi9tb2R1bGVzL2VkaXRvci5qcyIsIndlYnBhY2s6Ly8vLi9tb2R1bGVzL2V2ZW50TGlzdGVuZXJzLmpzIiwid2VicGFjazovLy8uL21vZHVsZXMvZmlsdGVycy5qcyIsIndlYnBhY2s6Ly8vLi9tb2R1bGVzL2ZvbnRzLmpzIiwid2VicGFjazovLy8uL21vZHVsZXMvZnJvbVVSTC5qcyIsIndlYnBhY2s6Ly8vLi9tb2R1bGVzL2dyaWQuanMiLCJ3ZWJwYWNrOi8vLy4vbW9kdWxlcy9ncm91cHMuanMiLCJ3ZWJwYWNrOi8vLy4vbW9kdWxlcy9oaXN0b3J5LmpzIiwid2VicGFjazovLy8uL21vZHVsZXMvaW50ZXJhY3RpdmVNb2RlLmpzIiwid2VicGFjazovLy8uL21vZHVsZXMvbGF5ZXJzLmpzIiwid2VicGFjazovLy8uL21vZHVsZXMvbGlicmFyeS5qcyIsIndlYnBhY2s6Ly8vLi9tb2R1bGVzL2xvYWRlci5qcyIsIndlYnBhY2s6Ly8vLi9tb2R1bGVzL21vdmVtZW50TGltaXRzLmpzIiwid2VicGFjazovLy8uL21vZHVsZXMvcGF0aGZpbmRlci5qcyIsIndlYnBhY2s6Ly8vLi9tb2R1bGVzL3JlbmRlci5qcyIsIndlYnBhY2s6Ly8vLi9tb2R1bGVzL3Jlc2l6YWJsZS5qcyIsIndlYnBhY2s6Ly8vLi9tb2R1bGVzL3J1bGVyLmpzIiwid2VicGFjazovLy8uL21vZHVsZXMvc2F2ZUFzLmpzIiwid2VicGFjazovLy8uL21vZHVsZXMvc3R5bGVzLmpzIiwid2VicGFjazovLy8uL21vZHVsZXMvdGh1bWIuanMiLCJ3ZWJwYWNrOi8vLy4vbW9kdWxlcy90b29sYmFyLmpzIiwid2VicGFjazovLy8uL21vZHVsZXMvdXBsb2FkLmpzIiwid2VicGFjazovLy8uL21vZHVsZXMvem9vbS5qcyIsIndlYnBhY2s6Ly8vLi9vYmplY3RzL0JlemllclRleHQuanMiLCJ3ZWJwYWNrOi8vLy4vb2JqZWN0cy9CdWJibGUuanMiLCJ3ZWJwYWNrOi8vLy4vb2JqZWN0cy9DbGlwYXJ0LmpzIiwid2VicGFjazovLy8uL29iamVjdHMvRnJhbWUuanMiLCJ3ZWJwYWNrOi8vLy4vb2JqZWN0cy9NYXNrUmVjdGFuZ2xlLmpzIiwid2VicGFjazovLy8uL29iamVjdHMvTWF0ZXJpYWxQb2ludC5qcyIsIndlYnBhY2s6Ly8vLi9vYmplY3RzL1BhdGguanMiLCJ3ZWJwYWNrOi8vLy4vb2JqZWN0cy9QYXRoR3JvdXAuanMiLCJ3ZWJwYWNrOi8vLy4vb2JqZWN0cy9QaG90by5qcyIsIndlYnBhY2s6Ly8vLi9vYmplY3RzL1BsYWNlaG9sZGVyLmpzIiwid2VicGFjazovLy8uL29iamVjdHMvUG9seWxpbmUuanMiLCJ3ZWJwYWNrOi8vLy4vb2JqZWN0cy9SYXN0ZXIuanMiLCJ3ZWJwYWNrOi8vLy4vb2JqZWN0cy9Ta2V3T2JqZWN0LmpzIiwid2VicGFjazovLy8uL29iamVjdHMvU2xpZGVJbWFnZS5qcyIsIndlYnBhY2s6Ly8vLi9vYmplY3RzL1NsaWRlVGV4dC5qcyIsIndlYnBhY2s6Ly8vLi9vYmplY3RzL1NwZWVjaC5qcyIsIndlYnBhY2s6Ly8vLi9vYmplY3RzL1RleHRGcmFtZS5qcyIsIndlYnBhY2s6Ly8vLi9vYmplY3RzL1RoaW5rLmpzIiwid2VicGFjazovLy8uL29iamVjdHMvVHJhbnNmb3JtZWRJbWFnZS5qcyIsIndlYnBhY2s6Ly8vLi9vYmplY3RzL1ZpZGVvLmpzIiwid2VicGFjazovLy8uL29iamVjdHMvcG9seWxpbmUuY29udHJvbHMuanMiLCJ3ZWJwYWNrOi8vLy4vcGx1Z2lucy9tYWdpY3dhbmQuanMiLCJ3ZWJwYWNrOi8vLy4vcGx1Z2lucy9zYXZlQXMuanMiLCJ3ZWJwYWNrOi8vLy4vcGx1Z2lucy90b29sYmFyLmNvbG9ycy5qcyIsIndlYnBhY2s6Ly8vLi9wbHVnaW5zL3Rvb2xiYXIuZm9udHMuanMiLCJ3ZWJwYWNrOi8vLy4vcGx1Z2lucy90b29sYmFyLm9wdGlvbnMuanMiLCJ3ZWJwYWNrOi8vLy4vcGx1Z2lucy93ZWJmb250LmpzIiwid2VicGFjazovLy8uL3Rvb2xzL3NlbGVjdENvbG9yc1Rvb2xzLmpzIiwid2VicGFjazovLy8uL3V0aWwvc3ludGF4LmpzIiwid2VicGFjazovLy9leHRlcm5hbCBcImZzXCIiXSwic291cmNlc0NvbnRlbnQiOlsiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gaWRlbnRpdHkgZnVuY3Rpb24gZm9yIGNhbGxpbmcgaGFybW9ueSBpbXBvcnRzIHdpdGggdGhlIGNvcnJlY3QgY29udGV4dFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5pID0gZnVuY3Rpb24odmFsdWUpIHsgcmV0dXJuIHZhbHVlOyB9O1xuXG4gXHQvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikge1xuIFx0XHRpZighX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHtcbiBcdFx0XHRcdGNvbmZpZ3VyYWJsZTogZmFsc2UsXG4gXHRcdFx0XHRlbnVtZXJhYmxlOiB0cnVlLFxuIFx0XHRcdFx0Z2V0OiBnZXR0ZXJcbiBcdFx0XHR9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSA0Nik7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gd2VicGFjay9ib290c3RyYXAgNGZlOGFmYzNjNGJjMTk3MDI4ZWQiLCJtb2R1bGUuZXhwb3J0cyA9IGZhYnJpYztcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyBleHRlcm5hbCBcImZhYnJpY1wiXG4vLyBtb2R1bGUgaWQgPSAwXG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsInZhciBfID0gcmVxdWlyZShcIi4uL3BsdWdpbnMvdW5kZXJzY29yZVwiKTtcblxudmFyIHV0aWxzID0ge1xuICAvKipcbiAgICpcbiAgICogQHBhcmFtIGFyclxuICAgKiBAcGFyYW0gYXJyMlxuICAgKiBAcmV0dXJucyB7e319XG4gICAqIEBleGFtcGxlXG4gICAqICAgIHggPSB7YTogMSAsYjogMSwgYzogWzEsMl19XG4gICAqICAgIHkgPSB7YTogMiAsICBjIDogMyAsIGQgOiAxfVxuICAgKlxuICAgKiAgICBleHRlbmRBcnJheXNPYmplY3QoeCx5KSA9IHthOiBbMSwyXSBiIDogWzFdIGMgOiBbMSwyLDNdLCBkIFsxXSB9XG4gICAqL1xuICBleHRlbmRBcnJheXNPYmplY3QgOiBmdW5jdGlvbihhcnIsYXJyMil7XG4gICAgdmFyIG5ld0FycmF5ID0ge307XG5cbiAgICBmb3IodmFyIGkgaW4gYXJyKXtcbiAgICAgIGlmKGFycltpXS5jb25zdHJ1Y3RvciA9PSBBcnJheSl7XG4gICAgICAgIG5ld0FycmF5W2ldICA9IFtdLmNvbmNhdChhcnJbaV0pO1xuICAgICAgfWVsc2V7XG4gICAgICAgIG5ld0FycmF5W2ldID0gW2FycltpXV07XG4gICAgICB9XG4gICAgfVxuXG4gICAgZm9yKHZhciBpIGluIGFycjIpe1xuICAgICAgaWYobmV3QXJyYXlbaV0pe1xuICAgICAgICBuZXdBcnJheVtpXS5wdXNoKGFycjJbaV0pO1xuICAgICAgfWVsc2V7XG4gICAgICAgIG5ld0FycmF5W2ldID0gW2FycjJbaV1dO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbmV3QXJyYXk7XG4gIH0sXG4gIGZpbHRlclZhbHVlczogZnVuY3Rpb24gKGFycmF5LCB2YWx1ZXMpIHtcbiAgICB2YXIgbmV3X2FycmF5ID0gW107XG4gICAgZm9yICh2YXIgaSBpbiBhcnJheSkge1xuICAgICAgdmFyIF9uZXdfb2JqZWN0ID0ge307XG4gICAgICBmb3IgKHZhciBqIGluIHZhbHVlcykge1xuICAgICAgICBfbmV3X29iamVjdFt2YWx1ZXNbal1dID0gYXJyYXlbaV1bdmFsdWVzW2pdXVxuICAgICAgfVxuICAgICAgbmV3X2FycmF5LnB1c2goX25ld19vYmplY3QpO1xuICAgIH1cbiAgICByZXR1cm4gbmV3X2FycmF5O1xuICB9LFxuXG4gIC8qKlxuICAgKiAg0KLQsNGB0L7QstCw0L3QuNC1INCk0LjRiNC10YDQsOKAk9CZ0LXRgtGB0LAs0YHQu9GD0YfQsNC50L3QvtC1INGC0LDRgdC+0LLQsNC90LjQtSDQvNC90L7QttC10YHRgtCy0LBcbiAgICogQHBhcmFtIG9iamVjdFxuICAgKiBAcmV0dXJucyB7Kn1cbiAgICovXG4gIHNodWZmbGU6IGZ1bmN0aW9uIChvYmplY3QpIHtcbiAgICBpZiAoIW9iamVjdC5sZW5ndGgpIHJldHVybjtcbiAgICB2YXIgaSA9IG9iamVjdC5sZW5ndGg7XG4gICAgd2hpbGUgKC0taSkge1xuICAgICAgdmFyIGogPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoaSArIDEpKTtcbiAgICAgIHZhciB0ZW1wID0gb2JqZWN0W2ldO1xuICAgICAgb2JqZWN0W2ldID0gb2JqZWN0W2pdO1xuICAgICAgb2JqZWN0W2pdID0gdGVtcDtcbiAgICB9XG5cbiAgICByZXR1cm4gb2JqZWN0OyAvLyBmb3IgY29udmVuaWVuY2UsIGluIGNhc2Ugd2Ugd2FudCBhIHJlZmVyZW5jZSB0byB0aGUgYXJyYXlcbiAgfSxcbiAgLyoqXG4gICAqIERlcGVuZGVuY3k6IHVuZGVyc2NvcmUuanMgKCBodHRwOi8vZG9jdW1lbnRjbG91ZC5naXRodWIuY29tL3VuZGVyc2NvcmUvIClcbiAgICpcbiAgICogTWl4IGl0IGluIHdpdGggdW5kZXJzY29yZS5qczpcbiAgICogXy5taXhpbih7ZGVlcEV4dGVuZDogZGVlcEV4dGVuZH0pO1xuICAgKlxuICAgKiBDYWxsIGl0IGxpa2UgdGhpczpcbiAgICogdmFyIG15T2JqID0gdXRpbHMuZGVlcEV4dGVuZChncmFuZHBhcmVudCwgY2hpbGQsIGdyYW5kY2hpbGQsIGdyZWF0Z3JhbmRjaGlsZClcbiAgICpcbiAgICogTm90ZXM6XG4gICAqIEtlZXAgaXQgRFJZLlxuICAgKiBUaGlzIGZ1bmN0aW9uIGlzIGVzcGVjaWFsbHkgdXNlZnVsIGlmIHlvdSdyZSB3b3JraW5nIHdpdGggSlNPTiBjb25maWcgZG9jdW1lbnRzLiBJdCBhbGxvd3MgeW91IHRvIGNyZWF0ZSBhIGRlZmF1bHRcbiAgICogY29uZmlnIGRvY3VtZW50IHdpdGggdGhlIG1vc3QgY29tbW9uIHNldHRpbmdzLCB0aGVuIG92ZXJyaWRlIHRob3NlIHNldHRpbmdzIGZvciBzcGVjaWZpYyBjYXNlcy4gSXQgYWNjZXB0cyBhbnlcbiAgICogbnVtYmVyIG9mIG9iamVjdHMgYXMgYXJndW1lbnRzLCBnaXZpbmcgeW91IGZpbmUtZ3JhaW5lZCBjb250cm9sIG92ZXIgeW91ciBjb25maWcgZG9jdW1lbnQgaGllcmFyY2h5LlxuICAgKlxuICAgKiBTcGVjaWFsIEZlYXR1cmVzIGFuZCBDb25zaWRlcmF0aW9uczpcbiAgICogLSBwYXJlbnRSRSBhbGxvd3MgeW91IHRvIGNvbmNhdGVuYXRlIHN0cmluZ3MuIGV4YW1wbGU6XG4gICAqICAgdmFyIG9iaiA9IHV0aWxzLmRlZXBFeHRlbmQoe3VybDogXCJ3d3cuZXhhbXBsZS5jb21cIn0sIHt1cmw6IFwiaHR0cDovLyN7X30vcGF0aC90by9maWxlLmh0bWxcIn0pO1xuICAgKiAgIGNvbnNvbGUubG9nKG9iai51cmwpO1xuICAgKiAgIG91dHB1dDogXCJodHRwOi8vd3d3LmV4YW1wbGUuY29tL3BhdGgvdG8vZmlsZS5odG1sXCJcbiAgICpcbiAgICogLSBwYXJlbnRSRSBhbHNvIGFjdHMgYXMgYSBwbGFjZWhvbGRlciwgd2hpY2ggY2FuIGJlIHVzZWZ1bCB3aGVuIHlvdSBuZWVkIHRvIGNoYW5nZSBvbmUgdmFsdWUgaW4gYW4gYXJyYXksIHdoaWxlXG4gICAqICAgbGVhdmluZyB0aGUgb3RoZXJzIHVudG91Y2hlZC4gZXhhbXBsZTpcbiAgICogICB2YXIgYXJyID0gdXRpbHMuZGVlcEV4dGVuZChbMTAwLCAgICB7aWQ6IDEyMzR9LCB0cnVlLCAgXCJmb29cIiwgIFsyNTAsIDUwMF1dLFxuICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgW1wiI3tffVwiLCBcIiN7X31cIiwgICAgIGZhbHNlLCBcIiN7X31cIiwgXCIje199XCJdKTtcbiAgICogICBjb25zb2xlLmxvZyhhcnIpO1xuICAgKiAgIG91dHB1dDogWzEwMCwge2lkOiAxMjM0fSwgZmFsc2UsIFwiZm9vXCIsIFsyNTAsIDUwMF1dXG4gICAqXG4gICAqIC0gVGhlIHByZXZpb3VzIGV4YW1wbGUgY2FuIGFsc28gYmUgd3JpdHRlbiBsaWtlIHRoaXM6XG4gICAqICAgdmFyIGFyciA9IHV0aWxzLmRlZXBFeHRlbmQoWzEwMCwgICAge2lkOjEyMzR9LCAgIHRydWUsICBcImZvb1wiLCAgWzI1MCwgNTAwXV0sXG4gICAqICAgICAgICAgICAgICAgICAgICAgICAgICBbXCIje199XCIsIHt9LCAgICAgICAgICBmYWxzZSwgXCIje199XCIsIFtdXSk7XG4gICAqICAgY29uc29sZS5sb2coYXJyKTtcbiAgICogICBvdXRwdXQ6IFsxMDAsIHtpZDogMTIzNH0sIGZhbHNlLCBcImZvb1wiLCBbMjUwLCA1MDBdXVxuICAgKlxuICAgKiAtIEFuZCBhbHNvIGxpa2UgdGhpczpcbiAgICogICB2YXIgYXJyID0gdXRpbHMuZGVlcEV4dGVuZChbMTAwLCAgICB7aWQ6MTIzNH0sICAgdHJ1ZSwgIFwiZm9vXCIsICBbMjUwLCA1MDBdXSxcbiAgICogICAgICAgICAgICAgICAgICAgICAgICAgIFtcIiN7X31cIiwge30sICAgICAgICAgIGZhbHNlXSk7XG4gICAqICAgY29uc29sZS5sb2coYXJyKTtcbiAgICogICBvdXRwdXQ6IFsxMDAsIHtpZDogMTIzNH0sIGZhbHNlLCBcImZvb1wiLCBbMjUwLCA1MDBdXVxuICAgKlxuICAgKiAtIEFycmF5IG9yZGVyIGlzIGltcG9ydGFudC4gZXhhbXBsZTpcbiAgICogICB2YXIgYXJyID0gdXRpbHMuZGVlcEV4dGVuZChbMSwgMiwgMywgNF0sIFsxLCA0LCAzLCAyXSk7XG4gICAqICAgY29uc29sZS5sb2coYXJyKTtcbiAgICogICBvdXRwdXQ6IFsxLCA0LCAzLCAyXVxuICAgKlxuICAgKiAtIFlvdSBjYW4gcmVtb3ZlIGFuIGFycmF5IGVsZW1lbnQgc2V0IGluIGEgcGFyZW50IG9iamVjdCBieSBzZXR0aW5nIHRoZSBzYW1lIGluZGV4IHZhbHVlIHRvIG51bGwgaW4gYSBjaGlsZCBvYmplY3QuXG4gICAqICAgZXhhbXBsZTpcbiAgICogICB2YXIgb2JqID0gdXRpbHMuZGVlcEV4dGVuZCh7YXJyOiBbMSwgMiwgMywgNF19LCB7YXJyOiBbXCIje199XCIsIG51bGxdfSk7XG4gICAqICAgY29uc29sZS5sb2cob2JqLmFycik7XG4gICAqICAgb3V0cHV0OiBbMSwgMywgNF1cbiAgICpcbiAgICoqL1xuICBkZWVwRXh0ZW5kOiBmdW5jdGlvbiAoLypvYmpfMSwgW29ial8yXSwgW29ial9OXSovKSB7XG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPCAxIHx8IHR5cGVvZiBhcmd1bWVudHNbMF0gIT09ICdvYmplY3QnKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPCAyKSByZXR1cm4gYXJndW1lbnRzWzBdO1xuXG4gICAgdmFyIHRhcmdldCA9IGFyZ3VtZW50c1swXTtcblxuICAgIC8vIGNvbnZlcnQgYXJndW1lbnRzIHRvIGFycmF5IGFuZCBjdXQgb2ZmIHRhcmdldCBvYmplY3RcbiAgICB2YXIgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSk7XG5cbiAgICB2YXIga2V5LCB2YWwsIHNyYywgY2xvbmUsIHRtcEJ1ZjtcblxuICAgIGFyZ3MuZm9yRWFjaChmdW5jdGlvbiAob2JqKSB7XG4gICAgICBpZiAodHlwZW9mIG9iaiAhPT0gJ29iamVjdCcpIHJldHVybjtcblxuICAgICAgZm9yIChrZXkgaW4gb2JqKSB7XG4gICAgICAgIGlmICghKGtleSBpbiBvYmopKSBjb250aW51ZTtcblxuICAgICAgICBzcmMgPSB0YXJnZXRba2V5XTtcbiAgICAgICAgdmFsID0gdXRpbHMuY2xvbmVEZWVwKG9ialtrZXldKTtcblxuXG4gICAgICAgIGlmICh0eXBlb2Ygc3JjICE9PSAnb2JqZWN0JyB8fCBzcmMgPT09IG51bGwpIHtcbiAgICAgICAgICB0YXJnZXRba2V5XSA9IHZhbDtcbiAgICAgICAgfWVsc2UgaWYgKEFycmF5LmlzQXJyYXkodmFsKSkge1xuICAgICAgICAgIGNsb25lID0gKEFycmF5LmlzQXJyYXkoc3JjKSkgPyBzcmMgOiBbXTtcblxuICAgICAgICAgIHZhbC5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pe1xuICAgICAgICAgICAgY2xvbmUucHVzaCh1dGlscy5jbG9uZURlZXAoaXRlbSkpO1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgdGFyZ2V0W2tleV0gPSBjbG9uZTtcbiAgICAgICAgICAvL3RvZG8gINC10YHQu9C4INC30LDQuNC80YHRgtCy0YPQtdC8INC80LDRgdGB0LjQsiAsINGC0L4g0YHRgdC+0YXRgNCw0L3Rj9C10Lwg0LfQvdCw0YfQtdC90LjRjyDQuNC3INC+0LHQvtC40YUg0LzQsNGB0YHQuNCy0L7QslxuICAgICAgICAgIC8vdGFyZ2V0W2tleV0gPSB1dGlscy5kZWVwRXh0ZW5kKGNsb25lLCB2YWwpO1xuXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY2xvbmUgPSAoIUFycmF5LmlzQXJyYXkoc3JjKSkgPyBzcmMgOiB7fTtcbiAgICAgICAgICB0YXJnZXRba2V5XSA9IHV0aWxzLmRlZXBFeHRlbmQoY2xvbmUsIHZhbCk7XG4gICAgICAgIH1cblxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIHRhcmdldDtcbiAgfSxcbiAgY2xvbmVEZWVwOiBmdW5jdGlvbiAodmFsKSB7XG5cbiAgICBpZiAodHlwZW9mIHZhbCA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgaWYgKHZhbCA9PT0gbnVsbCkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBEYXRlKSB7XG4gICAgICByZXR1cm4gbmV3IERhdGUodmFsLmdldFRpbWUoKSk7XG4gICAgfSBlbHNlIGlmICh2YWwgaW5zdGFuY2VvZiBSZWdFeHApIHtcbiAgICAgIHJldHVybiBuZXcgUmVnRXhwKHZhbCk7XG4gICAgfVxuXG4gICAgaWYodmFsLmNsb25lU3luYyl7XG4gICAgICByZXR1cm4gdmFsLmNsb25lU3luYygpO1xuICAgIH1lbHNlIGlmKHZhbC5jb25zdHJ1Y3RvciA9PSBPYmplY3Qpe1xuICAgICAgcmV0dXJuIHV0aWxzLmRlZXBFeHRlbmQoe30sIHZhbCk7XG4gICAgfWVsc2UgaWYodmFsLmNvbnN0cnVjdG9yID09IEFycmF5KXtcbiAgICAgIHZhciBjbG9uZSA9IFtdO1xuICAgICAgZm9yKHZhciBpID0wIDtpIDwgdmFsLmxlbmd0aDsgaSsrKXtcbiAgICAgICAgY2xvbmUucHVzaCh1dGlscy5jbG9uZURlZXAodmFsW2ldKSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gY2xvbmU7XG4gICAgfWVsc2V7XG4gICAgICByZXR1cm4gdmFsO1xuICAgIH1cbiAgfSxcbiAgcmVhcnJhbmdlOiBmdW5jdGlvbiAob2JqZWN0LCBrZXlzKSB7XG4gICAgdmFyIF9uZXdPcmRlciA9IHt9O1xuICAgIGZvciAodmFyIGkgaW4ga2V5cykge1xuICAgICAgaWYob2JqZWN0W2tleXNbaV1dICE9PSB1bmRlZmluZWQpe1xuICAgICAgICBfbmV3T3JkZXJba2V5c1tpXV0gPSBvYmplY3Rba2V5c1tpXV1cbiAgICAgIH1cbiAgICB9XG4gICAgLy8gZm9yIChpIGluIG9iamVjdCkge1xuICAgIC8vICAgZGVsZXRlIG9iamVjdFtpXTtcbiAgICAvLyB9XG4gICAgLy8gZm9yIChpIGluIF9uZXdPcmRlcikge1xuICAgIC8vICAgb2JqZWN0W2ldID0gX25ld09yZGVyW2ldO1xuICAgIC8vIH1cbiAgICByZXR1cm4gX25ld09yZGVyO1xuICB9LFxuICBzb3J0Qnk6IF8uc29ydEJ5LFxuICBkZWZhdWx0czogXy5kZWZhdWx0cyxcbiAgd2hlcmU6IF8ud2hlcmUsXG4gIGZpbmRXaGVyZTogXy5maW5kV2hlcmUsXG4gIGZpbHRlcjogXy5maWx0ZXIsXG4gIHBpY2s6IF8ucGljayxcbiAgZXh0ZW5kOiBmdW5jdGlvbiAoZGVzdGluYXRpb24pIHtcbiAgICAvLyBKU2NyaXB0IERvbnRFbnVtIGJ1ZyBpcyBub3QgdGFrZW4gY2FyZSBvZlxuICAgIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldO1xuICAgICAgZm9yICh2YXIgcHJvcGVydHkgaW4gc291cmNlKSB7XG4gICAgICAgIGRlc3RpbmF0aW9uW3Byb3BlcnR5XSA9IHNvdXJjZVtwcm9wZXJ0eV07XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBkZXN0aW5hdGlvbjtcbiAgfVxufTtcbm1vZHVsZS5leHBvcnRzID0gIHV0aWxzO1xuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi91dGlsL29iamVjdC5qc1xuLy8gbW9kdWxlIGlkID0gMVxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCJ2YXIgb2JqZWN0VXRpbHMgPSByZXF1aXJlKFwiLi9vYmplY3RcIilcbl8gPSByZXF1aXJlKFwiLi4vcGx1Z2lucy91bmRlcnNjb3JlXCIpO1xuXG52YXIgdXRpbHMgPSB7XG4gIC8qKlxuICAgKiB3aWxsIGRpdmlkZSB0b3RhbCB3aWR0aCBmb3IgZXZlcnkgb2JqZWN0IGluIGNvbHVtbnRzIGFycmF5XG4gICAqXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqICAgICB2YXIgX2ZsZXhBcnJheSA9IGZhYnJpYy51dGlsLmZsZXgoMjAwICwgW3tmbGV4OiAwfSx7dmFsdWU6IDEwMCwgZmxleDogMX0se2ZsZXg6IDB9XSApO1xuICAgKiBAcGFyYW0gdG90YWxcbiAgICogQHBhcmFtIGNvbHVtbnNcbiAgICogQHJldHVybnMge0FycmF5fVxuICAgKiBAZXhhbXBsZSBbNTAsMTAwLDUwXVxuICAgKi9cbiAgZmxleDogZnVuY3Rpb24gKHRvdGFsLGNvbHVtbnMpe1xuICAgIHZhciBfcmV0dXJuID0gW107XG4gICAgdmFyIHNwbGl0ID0gMDtcbiAgICBjb2x1bW5zLmZvckVhY2goZnVuY3Rpb24oY29sdW1uLCBpbmRleCl7XG4gICAgICBpZihjb2x1bW4udmFsdWUgPT09IHVuZGVmaW5lZCl7XG4gICAgICAgIHNwbGl0Kys7XG4gICAgICB9ZWxzZXtcbiAgICAgICAgdG90YWwgLT0gY29sdW1uLnZhbHVlO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHZhciBfdyA9IHRvdGFsIC8gc3BsaXQ7XG4gICAgY29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uKGNvbHVtbil7XG4gICAgICBfcmV0dXJuLnB1c2goY29sdW1uLnZhbHVlID09PSB1bmRlZmluZWQgPyBfdyA6ICBjb2x1bW4udmFsdWUgKTtcbiAgICB9KTtcbiAgICByZXR1cm4gX3JldHVybjtcbiAgfSxcbiAgd29ya2VyOiBmdW5jdGlvbiAoZm9vKSB7XG4gICAgaWYgKHdpbmRvdy5Xb3JrZXIpIHtcbiAgICAgIHZhciBzdHIgPSBmb28udG9TdHJpbmcoKTtcbiAgICAgIHZhciBldmVudEFyZyA9IHN0ci5zdWJzdHJpbmcoc3RyLmluZGV4T2YoXCIoXCIpICsgMSxzdHIuaW5kZXhPZihcIixcIikpO1xuICAgICAgdmFyIHBvc3RNZXNzYWdlQXJnID0gc3RyLnN1YnN0cmluZyhzdHIuaW5kZXhPZihcIixcIikgKyAxLHN0ci5pbmRleE9mKFwiKVwiKSk7XG4gICAgICB2YXIgX2Z1bmN0aW9uQm9keSA9IHN0ci5zdWJzdHJpbmcoc3RyLmluZGV4T2YoXCJ7XCIpICsgMSk7XG4gICAgICBzdHIgPSBcIm9ubWVzc2FnZT1mdW5jdGlvbihcIiArIGV2ZW50QXJnICsgXCIpe1wiICsgcG9zdE1lc3NhZ2VBcmcgKyBcIj0gcG9zdE1lc3NhZ2U7XCIgKyBfZnVuY3Rpb25Cb2R5O1xuICAgICAgdmFyIGJsb2IgPSBuZXcgQmxvYihbc3RyXSk7XG4gICAgICAvL1wib25tZXNzYWdlID0gZnVuY3Rpb24oZSkgeyBwb3N0TWVzc2FnZSgnbXNnIGZyb20gd29ya2VyJyk7IH1cIl0pO1xuICAgICAgdmFyIGJsb2JVUkwgPSB3aW5kb3cuVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTtcbiAgICAgIHJldHVybiBuZXcgV29ya2VyKGJsb2JVUkwpO1xuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgd29ya2VyID0ge1xuICAgICAgICB0ZXJtaW5hdGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgfSxcbiAgICAgICAgcG9zdE1lc3NhZ2U6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBmb28oe2RhdGE6IGRhdGF9LCBmdW5jdGlvbiAocmVzcG9uc2VEYXRhKSB7XG4gICAgICAgICAgICAgIHdvcmtlci5vbm1lc3NhZ2UgJiYgd29ya2VyLm9ubWVzc2FnZSh7ZGF0YTogcmVzcG9uc2VEYXRhfSk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgcmV0dXJuIHdvcmtlcjtcbiAgICB9XG4gIH0sXG4gIG9ic2VydmFibGU6IGZ1bmN0aW9uIChvYmopIHtcbiAgICBfLmV4dGVuZChvYmosIHtcblxuICAgICAgZmlyZTogZnVuY3Rpb24gZmlyZShldmVudE5hbWUsIG9wdGlvbnMpIHtcbiAgICAgICAgaWYgKCF0aGlzLl9fZXZlbnRMaXN0ZW5lcnMpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGxpc3RlbmVyc0ZvckV2ZW50ID0gdGhpcy5fX2V2ZW50TGlzdGVuZXJzW2V2ZW50TmFtZV07XG4gICAgICAgIGlmICghbGlzdGVuZXJzRm9yRXZlbnQpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IGxpc3RlbmVyc0ZvckV2ZW50Lmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgbGlzdGVuZXJzRm9yRXZlbnRbaV0uY2FsbCh0aGlzLCBvcHRpb25zIHx8IHt9KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgIH0sXG4gICAgICBvbjogZnVuY3Rpb24gKGV2ZW50TmFtZSwgaGFuZGxlcikge1xuICAgICAgICBpZiAoZXZlbnROYW1lLmNvbnN0cnVjdG9yID09IE9iamVjdCkge1xuICAgICAgICAgIGZvciAodmFyIGkgaW4gZXZlbnROYW1lKSB7XG4gICAgICAgICAgICB0aGlzLm9uKGksIGV2ZW50TmFtZVtpXSlcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGV2ZW50cyA9IGV2ZW50TmFtZS5zcGxpdChcIiBcIik7XG4gICAgICAgIGZvciAodmFyIGkgaW4gZXZlbnRzKSB7XG4gICAgICAgICAgdGhpcy5vYnNlcnZlKGV2ZW50c1tpXSwgaGFuZGxlcilcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgIH0sXG4gICAgICBvYnNlcnZlOiBmdW5jdGlvbiAoZXZlbnROYW1lLCBoYW5kbGVyKSB7XG4gICAgICAgIGlmICghdGhpcy5fX2V2ZW50TGlzdGVuZXJzKSB7XG4gICAgICAgICAgdGhpcy5fX2V2ZW50TGlzdGVuZXJzID0ge307XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICBmb3IgKHZhciBwcm9wIGluIGV2ZW50TmFtZSkge1xuICAgICAgICAgICAgdGhpcy5vbihwcm9wLCBldmVudE5hbWVbcHJvcF0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICBpZiAoIXRoaXMuX19ldmVudExpc3RlbmVyc1tldmVudE5hbWVdKSB7XG4gICAgICAgICAgICB0aGlzLl9fZXZlbnRMaXN0ZW5lcnNbZXZlbnROYW1lXSA9IFtdO1xuICAgICAgICAgIH1cbiAgICAgICAgICB0aGlzLl9fZXZlbnRMaXN0ZW5lcnNbZXZlbnROYW1lXS5wdXNoKGhhbmRsZXIpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgfSxcbiAgICAgIG9mZjogZnVuY3Rpb24gc3RvcE9ic2VydmluZyhldmVudE5hbWUsIGhhbmRsZXIpIHtcbiAgICAgICAgZnVuY3Rpb24gX3JlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBoYW5kbGVyKSB7XG4gICAgICAgICAgaWYgKCF0aGlzLl9fZXZlbnRMaXN0ZW5lcnNbZXZlbnROYW1lXSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChoYW5kbGVyKSB7XG4gICAgICAgICAgICB2YXIgaWR4ID0gdGhpcy5fX2V2ZW50TGlzdGVuZXJzW2V2ZW50TmFtZV0uaW5kZXhPZihoYW5kbGVyKTtcbiAgICAgICAgICAgIGlmIChpZHggIT09IC0xKSB7XG4gICAgICAgICAgICAgIHRoaXMuX19ldmVudExpc3RlbmVyc1tldmVudE5hbWVdLnNwbGljZShpZHgsIDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuX19ldmVudExpc3RlbmVyc1tldmVudE5hbWVdLmxlbmd0aCA9IDA7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCF0aGlzLl9fZXZlbnRMaXN0ZW5lcnMpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICB0aGlzLl9fZXZlbnRMaXN0ZW5lcnMgPSB7fTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAxICYmIHR5cGVvZiBhcmd1bWVudHNbMF0gPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgZm9yICh2YXIgcHJvcCBpbiBldmVudE5hbWUpIHtcbiAgICAgICAgICAgIF9yZW1vdmVFdmVudExpc3RlbmVyLmNhbGwodGhpcywgcHJvcCwgZXZlbnROYW1lW3Byb3BdKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgX3JlbW92ZUV2ZW50TGlzdGVuZXIuY2FsbCh0aGlzLCBldmVudE5hbWUsIGhhbmRsZXIpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgfVxuICAgIH0pXG4gIH0sXG4gIGluT3JkZXI6IGZ1bmN0aW9uIChhcnJheSwgZm9vLCBjYWxsYmFjaykge1xuICAgIHZhciBfaW5kZXggPSAwO1xuICAgIGZ1bmN0aW9uIF9pbk9yZGVySW5kZXgoKSB7XG4gICAgICBpZiAoKytfaW5kZXggPCBhcnJheS5sZW5ndGgpIHtcbiAgICAgICAgZm9vKGFycmF5W19pbmRleF0sIF9pbmRleCwgX2luT3JkZXJJbmRleClcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKCk7XG4gICAgICB9XG4gICAgfVxuICAgIGZvbyhhcnJheVtfaW5kZXhdLCBfaW5kZXgsIF9pbk9yZGVySW5kZXgpXG4gIH0sXG4gIC8qKlxuICAgKiDQstC+0LfQstGA0LDRidCw0LXRgiDQvtCx0YrQtdC60YIg0YEg0LrQu9GO0YfQsNC80Lgg0YHRgtGA0L7QutC4IHVybFxuICAgKiBAcmV0dXJucyB7e319XG4gICAqL1xuICBxdWVyeVN0cmluZzogZnVuY3Rpb24gKHF1ZXJ5KSB7XG4gICAgaWYocXVlcnkpIHtcbiAgICAgIHF1ZXJ5ID0gcXVlcnkuc3Vic3RyKHF1ZXJ5LmluZGV4T2YoXCI/XCIpICsgMSkgO1xuICAgIH1lbHNle1xuICAgICAgcXVlcnkgPSB3aW5kb3cubG9jYXRpb24uc2VhcmNoLnN1YnN0cmluZygxKTtcbiAgICB9XG4gICAgdmFyIG9iaiA9IHt9O1xuICAgIHZhciBfbGVuZ3RoID0gMDtcbiAgICBpZiAoIXF1ZXJ5KXJldHVybiBvYmo7XG4gICAgdmFyIHZhcnMgPSBxdWVyeS5zcGxpdChcIiZcIik7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2YXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgcGFpciA9IHZhcnNbaV0uc3BsaXQoXCI9XCIpO1xuICAgICAgdmFyIF92bmFtZSA9IHBhaXJbMF0sIHZhbCA9IHBhaXJbMV07XG4gICAgICBpZiAodHlwZW9mIG9ialtfdm5hbWVdID09PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgIG9ialtfdm5hbWVdID0gdmFsIHx8IFwiXCI7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIF9sZW5ndGgsIHt2YWx1ZTogX3ZuYW1lLCBlbnVtZXJhYmxlOiBmYWxzZX0pO1xuICAgICAgICBfbGVuZ3RoKys7XG4gICAgICAgIC8vIElmIHNlY29uZCBlbnRyeSB3aXRoIHRoaXMgbmFtZVxuICAgICAgfSBlbHNlIGlmICh0eXBlb2Ygb2JqW192bmFtZV0gPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgdmFyIGFyciA9IFtvYmpbX3ZuYW1lXSwgdmFsXTtcbiAgICAgICAgb2JqW192bmFtZV0gPSBhcnI7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIF9sZW5ndGgsIHt2YWx1ZTogX3ZuYW1lLCBlbnVtZXJhYmxlOiBmYWxzZX0pO1xuICAgICAgICBfbGVuZ3RoKys7XG4gICAgICAgIC8vIElmIHRoaXJkIG9yIGxhdGVyIGVudHJ5IHdpdGggdGhpcyBuYW1lXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBvYmpbX3ZuYW1lXS5wdXNoKHZhbCk7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIF9sZW5ndGgsIHt2YWx1ZTogX3ZuYW1lLCBlbnVtZXJhYmxlOiBmYWxzZX0pO1xuICAgICAgICBfbGVuZ3RoKys7XG4gICAgICB9XG4gICAgfVxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIFwibGVuZ3RoXCIsIHt2YWx1ZTogX2xlbmd0aCwgZW51bWVyYWJsZTogZmFsc2V9KTtcbiAgICByZXR1cm4gb2JqO1xuICB9LFxuICBjb3B5VmFsdWU6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7XG4gICAgICByZXR1cm4gbnVsbFxuICAgIH1cbiAgICBpZiAodmFsdWUgPT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXR1cm4gdW5kZWZpbmVkXG4gICAgfVxuICAgIHN3aXRjaCAodmFsdWUuY29uc3RydWN0b3IpIHtcbiAgICAgIGNhc2UgT2JqZWN0OlxuICAgICAgICByZXR1cm4gb2JqZWN0VXRpbHMuZGVlcEV4dGVuZCh7fSwgdmFsdWUpO1xuICAgICAgY2FzZSBBcnJheTpcbiAgICAgICAgcmV0dXJuIG9iamVjdFV0aWxzLmRlZXBFeHRlbmQoW10sIHZhbHVlKTtcbiAgICAgIGNhc2UgU3RyaW5nOlxuICAgICAgY2FzZSBOdW1iZXI6XG4gICAgICBjYXNlIEJvb2xlYW46XG4gICAgICAgIHJldHVybiB2YWx1ZTtcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIC8vY29uc29sZS5sb2codmFsdWUuY29uc3RydWN0b3IpO1xuICAgICAgICByZXR1cm4gb2JqZWN0VXRpbHMuZGVlcEV4dGVuZCh7fSwgdmFsdWUpO1xuICAgIH1cbiAgfSxcbiAgY2xlYXJWYWx1ZTogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgc3dpdGNoICh2YWx1ZS5jb25zdHJ1Y3Rvcikge1xuICAgICAgY2FzZSBPYmplY3Q6XG4gICAgICAgIGZvciAodmFyIG1lbWJlciBpbiB2YWx1ZSkgZGVsZXRlIHZhbHVlW21lbWJlcl07XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBBcnJheTpcbiAgICAgICAgdmFsdWUubGVuZ3RoID0gMDtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBkZWxldGUgdmFsdWU7XG4gICAgfVxuICB9LFxuICBvYmplY3RzRGlmZmVyZW5jZTogZnVuY3Rpb24gKHByZXYsIG5vdykge1xuICAgIHZhciBjaGFuZ2VzID0ge307XG4gICAgZm9yICh2YXIgcHJvcCBpbiBub3cpIHtcbiAgICAgIGlmICghcHJldiB8fCBwcmV2W3Byb3BdICE9PSBub3dbcHJvcF0pIHtcbiAgICAgICAgaWYgKHR5cGVvZiBub3dbcHJvcF0gPT0gXCJvYmplY3RcIikge1xuICAgICAgICAgIHZhciBjID0gdXRpbHMub2JqZWN0c0RpZmZlcmVuY2UocHJldltwcm9wXSwgbm93W3Byb3BdKTtcbiAgICAgICAgICBpZiAoIV8uaXNFbXB0eShjKSkgLy8gdW5kZXJzY29yZVxuICAgICAgICAgICAgY2hhbmdlc1twcm9wXSA9IGM7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY2hhbmdlc1twcm9wXSA9IG5vd1twcm9wXTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gY2hhbmdlcztcbiAgfSxcbiAgc3BsaXRCeTogZnVuY3Rpb24gKHF1ZXJ5LCBkZWxpbWl0ZXIpIHtcbiAgICB2YXIgdHJhY2VRdWVyaWVzID0gW107XG4gICAgdmFyIHIgPSAwLFxuICAgICAgZiA9IDAsXG4gICAgICBfcF9zdGFydCA9IDA7XG4gICAgaWYgKHF1ZXJ5ID09IFwiXCIpIHJldHVybiBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHF1ZXJ5Lmxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgYyA9IHF1ZXJ5W2ldO1xuICAgICAgaWYgKGMgPT0gXCIoXCIpIHtcbiAgICAgICAgcisrO1xuICAgICAgICBmID0gMTtcbiAgICAgIH0gZWxzZSBpZiAoYyA9PSBcIilcIikge1xuICAgICAgICByLS07XG4gICAgICB9XG4gICAgICBpZiAociA9PSAwICYmIGYgPT0gMSkgZiA9IDA7XG4gICAgICBpZiAoZGVsaW1pdGVyLmluZGV4T2YoYykgIT0gLTEgJiYgciA9PSAwICYmIGYgPT0gMCkge1xuICAgICAgICB0cmFjZVF1ZXJpZXMucHVzaChxdWVyeS5zdWJzdHJpbmcoX3Bfc3RhcnQsIGkpKTtcbiAgICAgICAgX3Bfc3RhcnQgPSBpICsgMTtcbiAgICAgIH1cbiAgICB9XG4gICAgdHJhY2VRdWVyaWVzLnB1c2gocXVlcnkuc3Vic3RyaW5nKF9wX3N0YXJ0KSk7XG4gICAgcmV0dXJuIHRyYWNlUXVlcmllcztcbiAgfSxcbiAgcXVldWVMb2FkOiBmdW5jdGlvbiAodG90YWwsIGNvbXBsZXRlQ0IsIHByb2dyZXNzQ0IpIHtcbiAgICB2YXIgbG9hZGVyID0gZnVuY3Rpb24gKGVsKSB7XG4gICAgICBsb2FkZXIubG9hZGVkLnB1c2goZWwpO1xuICAgICAgbG9hZGVyLnByb2dyZXNzQ0IgJiYgbG9hZGVyLnByb2dyZXNzQ0IobG9hZGVyLmxvYWRlZC5sZW5ndGgsIGxvYWRlci50b3RhbCwgZWwsIGxvYWRlci5sb2FkZWQpO1xuXG4gICAgICBpZiAobG9hZGVyLmxvYWRlZC5sZW5ndGggPT0gbG9hZGVyLnRvdGFsKSB7XG4gICAgICAgIGxvYWRlci5jb21wbGV0ZUNCICYmIGxvYWRlci5jb21wbGV0ZUNCKGxvYWRlci5sb2FkZWQpO1xuICAgICAgICBsb2FkZXIuZmlyZShcImxvYWRlZFwiKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIGxvYWRlci5jb21wbGV0ZUNCID0gY29tcGxldGVDQjtcbiAgICBsb2FkZXIucHJvZ3Jlc3NDQiA9IHByb2dyZXNzQ0I7XG4gICAgbG9hZGVyLnRvdGFsID0gdG90YWw7XG4gICAgbG9hZGVyLmxvYWRlZCA9IFtdO1xuICAgIHV0aWxzLm9ic2VydmFibGUobG9hZGVyKTtcblxuICAgIHJldHVybiBsb2FkZXI7XG4gIH1cbn07XG5tb2R1bGUuZXhwb3J0cyA9ICB1dGlscztcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vdXRpbC91dGlsLmpzXG4vLyBtb2R1bGUgaWQgPSAyXG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsInZhciB1dGlscyA9IHJlcXVpcmUoJy4vLi4vdXRpbC91dGlsLmpzJyk7XG51dGlscy5jb21waWxlID0gcmVxdWlyZSgnLi8uLi91dGlsL2NvbXBpbGUuanMnKTtcbnV0aWxzLm9iamVjdCA9IHJlcXVpcmUoJy4vLi4vdXRpbC9vYmplY3QuanMnKTtcblxuZnVuY3Rpb24gY2FwaXRhbGl6ZShzdHJpbmcsIGZpcnN0TGV0dGVyT25seSkge1xuICByZXR1cm4gc3RyaW5nLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICtcbiAgICAoZmlyc3RMZXR0ZXJPbmx5ID8gc3RyaW5nLnNsaWNlKDEpIDogc3RyaW5nLnNsaWNlKDEpLnRvTG93ZXJDYXNlKCkpO1xufVxuXG5mdW5jdGlvbiB0b0Rhc2hlZCAoc3RyKSB7XG4gIHJldHVybiBzdHIucmVwbGFjZSgvKFthLXpdKShbQS1aXSkvZywgJyQxLSQyJykudG9Mb3dlckNhc2UoKTtcbn1cblxuXG52YXIgVG9vbGJhciA9IGZ1bmN0aW9uKFBBUkVOVCwgZWwsIG9wdGlvbnMsIG1lbnUpe1xuICB0aGlzLmJ1dHRvbnMgPSBbXTtcbiAgLy90b2RvINGN0YLQviDQvdC1INGB0L7QstGB0LXQvCDRhdC+0YDQvtGI0L4uINC90LXQu9GM0LfRjyDRgdC+0LfQtNCw0YLRjCDRg9C70LHRgNCw0Ysg0YEg0YDQsNC30L3Ri9C80Lgg0LrQvtC90YTQuNCz0LDQvNC4INC60L3QvtC/0L7QulxuICAvLyB0aGlzLnRvb2xzID0gdXRpbHMub2JqZWN0LmNsb25lRGVlcCh0aGlzLnRvb2xzKTtcblxuICBpZiAob3B0aW9ucykge1xuICAgIGlmIChvcHRpb25zLmJ1dHRvbikge1xuICAgICAgdXRpbHMub2JqZWN0LmV4dGVuZCh0aGlzLnRvb2xzLmJ1dHRvbiwgb3B0aW9ucy5idXR0b24pO1xuICAgIH1cbiAgfVxuICB0aGlzLmFjdGlvbnMgPSBUb29sYmFyLm1ha2VBY3Rpb25zKFBBUkVOVCwgbWVudSk7XG5cbiAgaWYoZWwuY29uc3RydWN0b3IgPT0gU3RyaW5nKXtcbiAgICBlbCA9ICQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZWwpKTtcbiAgfVxuICBpZihlbC5sZW5ndGggJiYgT2JqZWN0LmtleXModGhpcy5hY3Rpb25zKS5sZW5ndGgpe1xuICAgIHRoaXMuZ2VuZXJhdGVNZW51KFBBUkVOVCwgZWwsIG9wdGlvbnMsIHRoaXMuYWN0aW9ucyk7XG4gICAgdGhpcy5vbkNyZWF0ZSgpO1xuICAgIGVsLnNob3coKTtcbiAgfVxuICBUb29sYmFyLmluaXRLZXlzKHRoaXMuYWN0aW9ucyk7XG59O1xuXG5cblRvb2xiYXIuX2dldEtleVN0cmluZyA9IGZ1bmN0aW9uIChjb25maWcpIHtcbiAgdmFyIHN0cmluZyA9IFwiXCI7XG5cbiAgaWYgKGNvbmZpZy5jdHJsS2V5KXN0cmluZyArPSBcIkN0cmwgKyBcIjtcbiAgaWYgKGNvbmZpZy5hbHRLZXkpc3RyaW5nICs9IFwiQWx0ICsgXCI7XG4gIGlmIChjb25maWcuc2hpZnRLZXkpc3RyaW5nICs9IFwiU2hpZnQgKyBcIjtcblxuICB2YXIgX2NvZGUgPSBjb25maWcua2V5O1xuICBpZihfY29kZSl7XG4gICAgc3RyaW5nICs9IGNvbmZpZy5rZXk7XG4gIH1cbiAgcmV0dXJuIHN0cmluZztcbn07XG5cblRvb2xiYXIubWFrZUFjdGlvbnMgPSBmdW5jdGlvbiAoUEFSRU5ULCBhY3Rpb25zKSB7XG4gIGlmICghUEFSRU5ULl9hY3Rpb25zUmVhZHkpIHtcblxuICAgIGFjdGlvbnMgPSBhY3Rpb25zIHx8IFBBUkVOVC5hY3Rpb25zO1xuXG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuXG4gICAgZm9yICh2YXIgaSBpbiBhY3Rpb25zKSB7XG4gICAgICB2YXIgX2FjdGlvbiA9IHRoaXMubWFrZUFjdGlvbihpLCBhY3Rpb25zW2ldLCBQQVJFTlQpO1xuICAgICAgaWYoX2FjdGlvbil7XG4gICAgICAgIHJlc3VsdFtpXSA9IF9hY3Rpb247XG4gICAgICB9XG4gICAgfVxuICAgIFBBUkVOVC5fYWN0aW9uc1JlYWR5ID0gdHJ1ZTtcbiAgICBQQVJFTlQuYWN0aW9ucyA9IHJlc3VsdDtcbiAgfVxuICByZXR1cm4gUEFSRU5ULmFjdGlvbnM7XG59O1xuVG9vbGJhci5tYWtlQWN0aW9uID0gZnVuY3Rpb24gKGlkLCBfT1JJR0lOQUwsIHBhcmVudCkge1xuXG4gIHZhciBzZWxmID0gdGhpcztcblxuICBpZiAoX09SSUdJTkFMLmNvbnN0cnVjdG9yID09PSBGdW5jdGlvbikge1xuICAgIF9PUklHSU5BTCA9IF9PUklHSU5BTC5jYWxsKHRhcmdldCk7XG4gIH1cblxuICB2YXIgdGFyZ2V0O1xuXG4gIGlmIChfT1JJR0lOQUwudGFyZ2V0ICYmIF9PUklHSU5BTC50YXJnZXQuY29uc3RydWN0b3IgPT0gRnVuY3Rpb24pIHtcbiAgICB0YXJnZXQgPSBfT1JJR0lOQUwudGFyZ2V0LmNhbGwocGFyZW50KTtcbiAgfSBlbHNlIHtcbiAgICB0YXJnZXQgPSBfT1JJR0lOQUwudGFyZ2V0IHx8IHBhcmVudDtcbiAgfVxuXG4gIHZhciBfX190YXJnZXQgPSBfT1JJR0lOQUwudGFyZ2V0O1xuICB2YXIgX19fcGFyZW50ID0gX09SSUdJTkFMLnBhcmVudDtcbiAgZGVsZXRlIF9PUklHSU5BTC5wYXJlbnQ7XG4gIGRlbGV0ZSBfT1JJR0lOQUwudGFyZ2V0O1xuICB2YXIgUkVTID0gdXRpbHMub2JqZWN0LmNsb25lRGVlcChfT1JJR0lOQUwpO1xuICBfT1JJR0lOQUwucGFyZW50ID0gX19fcGFyZW50O1xuICBfT1JJR0lOQUwudGFyZ2V0ID0gX19fdGFyZ2V0O1xuXG5cbiAgUkVTLnBhcmVudCA9IF9fX3BhcmVudDtcbiAgUkVTLnRhcmdldCA9IHRhcmdldDtcbiAgUkVTLmlkID0gdG9EYXNoZWQoaWQpO1xuXG5cbiAgZnVuY3Rpb24gY3JlYXRlR2V0dGVyKHByb3BlcnR5LHVzZVBhcmVudCkge1xuICAgIGlmIChwcm9wZXJ0eS5jb25zdHJ1Y3RvciA9PSBTdHJpbmcpIHtcbiAgICAgIHZhciBuZWdhdGl2ZSA9IGZhbHNlO1xuICAgICAgaWYgKHByb3BlcnR5WzBdID09IFwiIVwiKSB7XG4gICAgICAgIHByb3BlcnR5ID0gcHJvcGVydHkuc3Vic3RyKDEpO1xuICAgICAgICBuZWdhdGl2ZSA9IHRydWU7XG4gICAgICB9XG4gICAgICBpZih1c2VQYXJlbnQpe1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBwYXJlbnQgJiYgISFwYXJlbnRbcHJvcGVydHldIF4gbmVnYXRpdmU7XG4gICAgICAgIH1cbiAgICAgIH1lbHNle1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiB0YXJnZXQgJiYgISF0YXJnZXRbcHJvcGVydHldIF4gbmVnYXRpdmU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHByb3BlcnR5LmNvbnN0cnVjdG9yID09IEZ1bmN0aW9uKSB7XG4gICAgICByZXR1cm4gcHJvcGVydHkuYmluZCh0YXJnZXQpO1xuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG5cbiAgdmFyIF9pbnNlcnQgPSBfT1JJR0lOQUwuaW5zZXJ0O1xuICBpZiAoIV9pbnNlcnQgfHwgX2luc2VydC5jb25zdHJ1Y3RvciA9PSBTdHJpbmcpIHtcblxuICAgIGlmKF9PUklHSU5BTC5wYXJlbnQpe1xuICAgICAgdmFyIGluc2VydHByb3BlcnR5ID0gZmFicmljLnV0aWwuc3RyaW5nLmNhcGl0YWxpemUoZmFicmljLnV0aWwuc3RyaW5nLmNhbWVsaXplKF9PUklHSU5BTC5wYXJlbnQuaWQpKVxuICAgIH1lbHNle1xuICAgICAgdmFyIGluc2VydHByb3BlcnR5ID0gX2luc2VydCB8fCBcImluc2VydFwiICsgZmFicmljLnV0aWwuc3RyaW5nLmNhcGl0YWxpemUoaWQsdHJ1ZSk7XG4gICAgfVxuXG4gICAgaWYodGFyZ2V0W2luc2VydHByb3BlcnR5XSAhPT0gdW5kZWZpbmVkKXtcbiAgICAgIF9pbnNlcnQgPSB0YXJnZXRbaW5zZXJ0cHJvcGVydHldLy8gY3JlYXRlR2V0dGVyKGluc2VydHByb3BlcnR5LHRydWUpKClcbiAgICB9ZWxzZXtcbiAgICAgIF9pbnNlcnQgPSB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIGlmKCFfaW5zZXJ0KXJldHVybjtcblxuICBpZiAoIVJFUy50eXBlKSB7XG4gICAgaWYgKFJFUy5tZW51KSB7XG4gICAgICBSRVMudHlwZSA9IFwibWVudVwiO1xuICAgIH1lbHNle1xuICAgICAgUkVTLnR5cGUgPSBcImJ1dHRvblwiO1xuICAgIH1cbiAgfVxuICBpZiAoIVJFUy5hY3Rpb24pIHtcbiAgICBpZihSRVMudHlwZSA9PSBcImJ1dHRvblwiKXtcbiAgICAgIFJFUy5hY3Rpb24gPSBpZDtcbiAgICB9XG4gIH1cblxuXG4gIGlmIChSRVMuYWN0aW9uKSB7XG4gICAgaWYgKFJFUy5hY3Rpb24uY29uc3RydWN0b3IgPT0gU3RyaW5nKSB7XG4gICAgICBSRVMuYWN0aW9uID0gdGFyZ2V0W1JFUy5hY3Rpb25dO1xuICAgIH1cbiAgICAvL1JFUyA9IFJFUy5hY3Rpb24uYmluZCh0YXJnZXQpO1xuICAgIC8vUkVTLmFjdGlvbiA9IFJFUy5hY3Rpb24uYmluZCh0YXJnZXQpO1xuICAgIC8vXy5leHRlbmQoUkVTLCBfYWN0KTtcbiAgICAvL2FyZ3VtZW50cyBmb3IgYWN0aW9uIGZ1bmN0aW9uXG4gICAgaWYgKF9PUklHSU5BTC5hcmdzKSB7XG4gICAgICBSRVMuX2FjdGlvbiA9IFJFUy5hY3Rpb24uYmluZCh0YXJnZXQsIF9PUklHSU5BTC5hcmdzKTtcbiAgICB9IGVsc2Uge1xuICAgICAgUkVTLl9hY3Rpb24gPSBSRVMuYWN0aW9uLmJpbmQodGFyZ2V0KTtcbiAgICB9XG4gICAgUkVTLmFjdGlvbiA9IGZ1bmN0aW9uKCl7XG4gICAgICBpZihSRVMuZGlzYWJsZWQpcmV0dXJuO1xuICAgICAgUkVTLl9hY3Rpb24uYXBwbHkodGhpcyxhcmd1bWVudHMpO1xuICAgIH1cbiAgfVxuXG5cbiAgaWYgKF9PUklHSU5BTC5tZW51ICYmIF9PUklHSU5BTC5tZW51LmNvbnN0cnVjdG9yID09IEZ1bmN0aW9uKSB7XG4gICAgUkVTLm1lbnUgPSBfT1JJR0lOQUwubWVudS5iaW5kKHRhcmdldCk7XG4gIH1cbiAgaWYgKF9PUklHSU5BTC5hY3RpdmUpIHtcbiAgICBSRVMuYWN0aXZlID0gY3JlYXRlR2V0dGVyKF9PUklHSU5BTC5hY3RpdmUpO1xuICB9XG4gIGlmIChfT1JJR0lOQUwudmlzaWJsZSkge1xuICAgIFJFUy52aXNpYmxlID0gY3JlYXRlR2V0dGVyKF9PUklHSU5BTC52aXNpYmxlKTtcbiAgfVxuICBpZiAoX09SSUdJTkFMLmVuYWJsZWQpIHtcbiAgICBSRVMuZW5hYmxlZCA9IGNyZWF0ZUdldHRlcihfT1JJR0lOQUwuZW5hYmxlZCk7XG4gIH1cbiAgaWYgKCFfT1JJR0lOQUwudmFsdWUpIHtcbiAgICBzd2l0Y2goX09SSUdJTkFMLnR5cGUpe1xuICAgICAgY2FzZSBcImNvbG9yXCI6XG4gICAgICBjYXNlIFwidGV4dFwiOlxuICAgICAgY2FzZSBcIm51bWJlclwiOlxuICAgICAgY2FzZSBcInJhbmdlXCI6XG4gICAgICBjYXNlIFwibGFiZWxcIjpcbiAgICAgIGNhc2UgXCJzZWxlY3RcIjpcbiAgICAgIGNhc2UgXCJjaGVja2JveFwiOlxuICAgICAgICBfT1JJR0lOQUwudmFsdWUgPSBpZDtcbiAgICAgIC8vIGNvbnNvbGUubG9nKGlkLCBfT1JJR0lOQUwpO1xuICAgIH1cbiAgfVxuICBpZiAoX09SSUdJTkFMLnZhbHVlKSB7XG4gICAgdmFyIF9zZXQsIF9nZXQsIF9vcHRpb25zO1xuICAgIGlmIChfT1JJR0lOQUwudmFsdWUuY29uc3RydWN0b3IgPT0gU3RyaW5nKSB7XG5cbiAgICAgIHZhciBzZXRGdW5jdGlvbk5hbWUgPSBcInNldFwiICsgY2FwaXRhbGl6ZShfT1JJR0lOQUwudmFsdWUsIHRydWUpLFxuICAgICAgICBnZXRGdW5jdGlvbk5hbWUgPSBcImdldFwiICsgY2FwaXRhbGl6ZShfT1JJR0lOQUwudmFsdWUsIHRydWUpLFxuICAgICAgICBtaW5OYW1lID0gXCJtaW5cIiArIGNhcGl0YWxpemUoX09SSUdJTkFMLnZhbHVlLCB0cnVlKSxcbiAgICAgICAgbWF4TmFtZSA9IFwibWF4XCIgKyBjYXBpdGFsaXplKF9PUklHSU5BTC52YWx1ZSwgdHJ1ZSksXG4gICAgICAgIHNldEZvbyA9IGZ1bmN0aW9uKHZhbCl7XG4gICAgICAgICAgdGFyZ2V0W3NldEZ1bmN0aW9uTmFtZV0odmFsKTtcbiAgICAgICAgICAvLyB0b2RvIHNlbGYuc2V0RnVuY3Rpb25DYWxsYmFjayh0YXJnZXQpO1xuICAgICAgICB9LFxuICAgICAgICBnZXRGb28gPSB0YXJnZXRbZ2V0RnVuY3Rpb25OYW1lXSxcbiAgICAgICAgbWluRm9vID0gdGFyZ2V0W21pbk5hbWVdLFxuICAgICAgICBtYXhGb28gPSB0YXJnZXRbbWF4TmFtZV07XG5cbiAgICAgIF9zZXQgPSBzZXRGb28gfHwgKF9PUklHSU5BTC5hcmdzID9cbiAgICAgICAgICBmdW5jdGlvbiAodmFsLCBhcmdzKSB7XG4gICAgICAgICAgICB0aGlzW19PUklHSU5BTC52YWx1ZV1bYXJnc10gPSB2YWw7XG4gICAgICAgICAgfSA6XG4gICAgICAgICAgZnVuY3Rpb24gKHZhbCkge1xuICAgICAgICAgICAgdGhpc1tfT1JJR0lOQUwudmFsdWVdID0gdmFsO1xuICAgICAgICAgIH0pO1xuXG4gICAgICBfZ2V0ID0gZ2V0Rm9vIHx8IChfT1JJR0lOQUwuYXJncyA/XG4gICAgICAgICAgZnVuY3Rpb24gKGFyZ3MpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzW19PUklHSU5BTC52YWx1ZV1bYXJnc107XG4gICAgICAgICAgfSA6XG4gICAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXNbX09SSUdJTkFMLnZhbHVlXTtcbiAgICAgICAgICB9KTtcblxuXG4gICAgICBSRVMudmFsdWUgPSB7XG4gICAgICAgIG1pbjogbWluRm9vLFxuICAgICAgICBtYXg6IG1heEZvb1xuICAgICAgfVxuXG4gICAgfSBlbHNlIHtcbiAgICAgIF9zZXQgPSBfT1JJR0lOQUwudmFsdWUuc2V0O1xuICAgICAgX2dldCA9IF9PUklHSU5BTC52YWx1ZS5nZXQ7XG4gICAgICBfb3B0aW9ucyA9IF9PUklHSU5BTC52YWx1ZS5vcHRpb25zO1xuICAgIH1cblxuICAgIGlmKFJFUy52YWx1ZS5taW4gIT09IHVuZGVmaW5lZCAmJiBSRVMudmFsdWUubWluLmNvbnN0cnVjdG9yID09IFN0cmluZyl7XG4gICAgICBSRVMudmFsdWUubWluID0gdGFyZ2V0W1JFUy52YWx1ZS5taW5dO1xuICAgIH1cbiAgICBpZihSRVMudmFsdWUubWF4ICE9PSB1bmRlZmluZWQgJiYgUkVTLnZhbHVlLm1heC5jb25zdHJ1Y3RvciA9PSBTdHJpbmcpe1xuICAgICAgUkVTLnZhbHVlLm1heCA9IHRhcmdldFtSRVMudmFsdWUubWF4XTtcbiAgICB9XG4gICAgaWYoUkVTLnZhbHVlLnN0ZXAgIT09IHVuZGVmaW5lZCAmJiBSRVMudmFsdWUuc3RlcC5jb25zdHJ1Y3RvciA9PSBTdHJpbmcpe1xuICAgICAgUkVTLnZhbHVlLnN0ZXAgPSB0YXJnZXRbUkVTLnZhbHVlLnN0ZXBdO1xuICAgIH1cbiAgICB2YXIgX21pbiA9IFJFUy52YWx1ZS5taW4sIF9tYXggPSBSRVMudmFsdWUubWF4LCBfc3RlcCA9IFJFUy52YWx1ZS5zdGVwO1xuXG4gICAgaWYgKF9zZXQpIHtcbiAgICAgIFJFUy52YWx1ZS5zZXQgPSAoIF9PUklHSU5BTC5hcmdzID8gX3NldC5iaW5kKHRhcmdldCwgX09SSUdJTkFMLmFyZ3MpIDogX3NldC5iaW5kKHRhcmdldCkpO1xuICAgIH1cbiAgICBpZiAoX2dldCkge1xuICAgICAgUkVTLnZhbHVlLmdldCA9ICggX09SSUdJTkFMLmFyZ3MgPyBfZ2V0LmJpbmQodGFyZ2V0LCBfT1JJR0lOQUwuYXJncykgOiBfZ2V0LmJpbmQodGFyZ2V0KSk7XG4gICAgfVxuICAgIGlmIChfbWluICYmIF9taW4uY29uc3RydWN0b3IgPT0gRnVuY3Rpb24pIHtcbiAgICAgIFJFUy52YWx1ZS5taW4gPSAoIF9PUklHSU5BTC5hcmdzID8gX21pbi5iaW5kKHRhcmdldCwgX09SSUdJTkFMLmFyZ3MpIDogX21pbi5iaW5kKHRhcmdldCkpO1xuICAgIH1cbiAgICBpZiAoX21heCAmJiBfbWF4LmNvbnN0cnVjdG9yID09IEZ1bmN0aW9uKSB7XG4gICAgICBSRVMudmFsdWUubWF4ID0gKCBfT1JJR0lOQUwuYXJncyA/IF9tYXguYmluZCh0YXJnZXQsIF9PUklHSU5BTC5hcmdzKSA6IF9tYXguYmluZCh0YXJnZXQpKTtcbiAgICB9XG4gICAgaWYgKF9zdGVwICYmIF9zdGVwLmNvbnN0cnVjdG9yID09IEZ1bmN0aW9uKSB7XG4gICAgICBSRVMudmFsdWUuc3RlcCA9ICggX09SSUdJTkFMLmFyZ3MgPyBfc3RlcC5iaW5kKHRhcmdldCwgX09SSUdJTkFMLmFyZ3MpIDogX3N0ZXAuYmluZCh0YXJnZXQpKTtcbiAgICB9XG4gICAgaWYgKF9vcHRpb25zKSB7XG4gICAgICBSRVMudmFsdWUub3B0aW9ucyA9ICggX09SSUdJTkFMLmFyZ3MgPyBfb3B0aW9ucy5iaW5kKHRhcmdldCwgX09SSUdJTkFMLmFyZ3MpIDogX29wdGlvbnMuYmluZCh0YXJnZXQpKTtcbiAgICB9XG4gIH1cblxuICBpZiAoX09SSUdJTkFMLmRhdGEpIHtcbiAgICBSRVMuZGF0YSA9IF9PUklHSU5BTC5kYXRhLmNhbGwodGFyZ2V0KTtcbiAgfVxuICBpZiAoUkVTLm1lbnUpIHtcbiAgICBpZiAoX09SSUdJTkFMLm1lbnUuY29uc3RydWN0b3IgPT09IEZ1bmN0aW9uKXtcbiAgICAgIFJFUy5tZW51ID0gIF9PUklHSU5BTC5tZW51LmNhbGwodGFyZ2V0KTtcbiAgICB9XG4gICAgaWYgKFJFUy50eXBlID09IFwib3B0aW9uc1wiKSB7XG4gICAgICBmb3IgKHZhciBpIGluIFJFUy5tZW51KSB7XG4gICAgICAgIFJFUy5tZW51W2ldLnBhcmVudCA9IFJFUztcbiAgICAgICAgUkVTLm1lbnVbaV0udHlwZSA9IFwib3B0aW9uXCI7XG4gICAgICAgIGlmKCFSRVMubWVudVtpXS50aXRsZSl7XG4gICAgICAgICAgUkVTLm1lbnVbaV0udGl0bGUgPSBpO1xuICAgICAgICB9XG4gICAgICAgIGlmKCFSRVMubWVudVtpXS5vcHRpb24pIHtcbiAgICAgICAgICBSRVMubWVudVtpXS5vcHRpb24gPSBpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIGZvciAodmFyIGkgaW4gUkVTLm1lbnUpIHtcbiAgICAgIGlmKFJFUy5tZW51W2ldLmNvbnN0cnVjdG9yID09IFN0cmluZyl7XG4gICAgICAgIFJFUy5tZW51W2ldID0gZmFicmljLnV0aWwub2JqZWN0LmNsb25lKFJFUy50YXJnZXQuYWN0aW9uc1tSRVMubWVudVtpXV0pO1xuICAgICAgICBSRVMubWVudVtpXS5wYXJlbnQgPSBSRVM7XG4gICAgICB9XG4gICAgICBSRVMubWVudVtpXSA9IFRvb2xiYXIubWFrZUFjdGlvbihpLCBSRVMubWVudVtpXSwgdGFyZ2V0KTtcbiAgICAgIGlmKCFSRVMubWVudVtpXSl7XG4gICAgICAgIGRlbGV0ZSBSRVMubWVudVtpXTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuXG5cbiAgaWYgKF9PUklHSU5BTC5rZXlib2FyZCAhPT0gZmFsc2UgJiYgKF9PUklHSU5BTC5rZXkgfHwgX09SSUdJTkFMLnNoaWZ0S2V5IHx8IF9PUklHSU5BTC5hbHRLZXkgfHwgX09SSUdJTkFMLmN0cmxLZXkgfHwgX09SSUdJTkFMLm1ldGFLZXkpKSB7XG4gICAgaWYoX09SSUdJTkFMLmtleUNvZGUgJiYgX09SSUdJTkFMLmtleUNvZGUuY29uc3RydWN0b3IgPT0gU3RyaW5nKXtcbiAgICAgIFJFUy5rZXlDb2RlID0gX09SSUdJTkFMLmtleUNvZGUudG9VcHBlckNhc2UoKS5jaGFyQ29kZUF0KDApO1xuICAgICAgUkVTLmtleSA9IFN0cmluZy5mcm9tQ2hhckNvZGUoUkVTLmtleUNvZGUpO1xuICAgIH1cbiAgICBSRVMua2V5Ym9hcmQgPSB0cnVlXG4gIH07XG5cbiAgcmV0dXJuIFJFUztcbn07XG5cblRvb2xiYXIuZ2V0QnV0dG9ucyA9IGZ1bmN0aW9uIChhY3Rpb25zKSB7XG4gIHZhciBfYnV0dG9ucyA9IFtdO1xuICBmb3IodmFyIGkgaW4gYWN0aW9ucyl7XG4gICAgdmFyIGFjdGlvbiA9IGFjdGlvbnNbaV07XG4gICAgaWYoYWN0aW9uLmtleWJvYXJkKXtcbiAgICAgIGFjdGlvbi50aXRsZSArPSBcIiAoXCIgKyBUb29sYmFyLl9nZXRLZXlTdHJpbmcoYWN0aW9uKSArIFwiKVwiO1xuICAgICAgX2J1dHRvbnMucHVzaChhY3Rpb24pO1xuICAgIH1cbiAgICBpZiAoYWN0aW9ucy5tZW51KSB7XG4gICAgICBfYnV0dG9ucyA9IF9idXR0b25zLmNvbmNhdChUb29sYmFyLmdldEJ1dHRvbnMoYWN0aW9ucy5tZW51KSk7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBfYnV0dG9ucztcbn07XG5Ub29sYmFyLmluaXRLZXlzID0gZnVuY3Rpb24gKGFjdGlvbnMpIHtcblxuICB2YXIgYnV0dG9ucyA9IFRvb2xiYXIuZ2V0QnV0dG9ucyhhY3Rpb25zKTtcblxuICB2YXIgc2VsZiA9IHRoaXM7XG4gICQoXCJib2R5XCIpLm9uKCBcImtleWRvd25cIixmdW5jdGlvbiAoZSkge1xuICAgIGZvciAodmFyIGkgaW4gYnV0dG9ucykge1xuICAgICAgdmFyIF9jb25maWcgPSBidXR0b25zW2ldO1xuXG4gICAgICBpZihfY29uZmlnLmVuYWJsZWQgJiYgIV9jb25maWcuZW5hYmxlZCgpKXtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBpZihfY29uZmlnLmRpc2FibGVkIHx8IF9jb25maWcuZGlzYWJsZWQpe1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIGlmICgoIV9jb25maWcuZGlzYWJsZWQgJiYgIV9jb25maWcuaGlkZGVuKSAmJlxuICAgICAgICAoX2NvbmZpZy5rZXlDb2RlID09IGUua2V5Q29kZSB8fCBfY29uZmlnLmtleSA9PSBlLmtleSkgJiZcbiAgICAgICAgKF9jb25maWcuY3RybEtleSA9PT0gdW5kZWZpbmVkIHx8IF9jb25maWcuY3RybEtleSA9PSBlLmN0cmxLZXkgKSAmJlxuICAgICAgICAoX2NvbmZpZy5hbHRLZXkgPT09IHVuZGVmaW5lZCB8fCBfY29uZmlnLmFsdEtleSA9PSBlLmFsdEtleSApICYmXG4gICAgICAgIChfY29uZmlnLnNoaWZ0S2V5ID09PSB1bmRlZmluZWQgfHwgX2NvbmZpZy5zaGlmdEtleSA9PSBlLnNoaWZ0S2V5ICkgJiZcbiAgICAgICAgKF9jb25maWcubWV0YUtleSA9PT0gdW5kZWZpbmVkIHx8IF9jb25maWcubWV0YUtleSA9PSBlLm1ldGFLZXkgKSkge1xuXG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgaWYgKF9jb25maWcub3B0aW9uICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBfY29uZmlnLmFjdGlvbi5jYWxsKF9jb25maWcudGFyZ2V0LCBfY29uZmlnLm9wdGlvbiwgZSlcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBfY29uZmlnLmFjdGlvbi5jYWxsKF9jb25maWcudGFyZ2V0LCBlKVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9KTtcblxuICAvLyQod2luZG93KS5vbihcIm1vdXNld2hlZWxcIiwgZnVuY3Rpb24gKGV2ZW50KSB7XG4gIC8vICBmb3IgKHZhciBpIGluIHNlbGYuYnV0dG9ucykge1xuICAvLyAgICB2YXIgZGF0YSA9IHNlbGYuYnV0dG9uc1tpXTtcbiAgLy8gICAgaWYgKCFkYXRhLm1vdXNld2hlZWwpY29udGludWU7XG4gIC8vICAgIGlmICghZGF0YS5jdHJsS2V5IHx8IGRhdGEuY3RybEtleSAmJiBldmVudC5jdHJsS2V5KSB7XG4gIC8vICAgICAgaWYgKGV2ZW50LmRlbHRhWSA+IDAgJiYgZGF0YS5tb3VzZXdoZWVsID09IFwiPlwiKSB7XG4gIC8vICAgICAgICBkYXRhLmFjdGlvbi5jYWxsKHRhcmdldCwgZGF0YS5vcHRpb24gfHwgZXZlbnQsIGV2ZW50KVxuICAvLyAgICAgIH1cbiAgLy8gICAgICBpZiAoZXZlbnQuZGVsdGFZIDwgMCAmJiBkYXRhLm1vdXNld2hlZWwgPT0gXCI8XCIpIHtcbiAgLy8gICAgICAgIGRhdGEuYWN0aW9uLmNhbGwodGFyZ2V0LCBkYXRhLm9wdGlvbiB8fCBldmVudCwgZXZlbnQpXG4gIC8vICAgICAgfVxuICAvLyAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gIC8vICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gIC8vICAgICAgcmV0dXJuIGZhbHNlO1xuICAvLyAgICB9XG4gIC8vICB9XG4gIC8vfSk7XG5cbn07XG5cblRvb2xiYXIucHJvdG90eXBlID0ge1xuXG4gIC8vIHNldEZ1bmN0aW9uQ2FsbGJhY2s6IGZ1bmN0aW9uKCl7fSxcbiAgdG9vbHM6IHtcblxuICAgIFwibGFiZWxcIjoge1xuICAgICAgc2NvcGU6IGZ1bmN0aW9uIChkYXRhLCBvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgZ2V0VmFsdWU6IGRhdGEudmFsdWUuZ2V0LFxuICAgICAgICAgIHZhbHVlQ3VycmVudDogZGF0YS52YWx1ZS5nZXQoKVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgdGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwib2JqZWN0LW1lbnUtaXRlbSBvYmplY3QtbWVudS1sYWJlbFwiIHRpdGxlPVwie3RpdGxlfVwiPicsXG4gICAgICByZW5kZXI6IGZ1bmN0aW9uICgkaXRlbSwgZGF0YSwgb3B0aW9ucywgdG9vbCwgdmFsKSB7XG4gICAgICAgIHZhciBzY29wZSA9IGZhYnJpYy51dGlsLm9iamVjdC5kZWZhdWx0cyh0b29sLnNjb3BlLmNhbGwodGhpcywgZGF0YSwgb3B0aW9ucyksZGF0YSk7XG4gICAgICAgICRpdGVtLmh0bWwoZGF0YS50ZW1wbGF0ZS5mb3JtYXQoZGF0YS52YWx1ZS5nZXQoKSkpO1xuICAgICAgICB1dGlscy5jb21waWxlLmNvbXBpbGVFbGVtZW50KCRpdGVtLHNjb3BlKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIFwic2VsZWN0XCI6IHtcbiAgICAgIHNjb3BlOiBmdW5jdGlvbiAoZGF0YSwgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGdldElucHV0VmFsdWU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBwYXJzZUZsb2F0KGRhdGEuJGl0ZW0uZmluZChcImlucHV0XCIpLnZhbCgpKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGdldFZhbHVlOiBkYXRhLnZhbHVlLmdldCxcbiAgICAgICAgICBzZXRWYWx1ZTogZGF0YS52YWx1ZS5zZXQsXG4gICAgICAgICAgb25jaGFuZ2U6IGZ1bmN0aW9uIChlLG1vZGVsKSB7XG4gICAgICAgICAgICBkYXRhLnZhbHVlLnNldChlLnBhcmFtcy5kYXRhLmlkLG1vZGVsKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB0ZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJvYmplY3QtbWVudS1pdGVtIG9iamVjdC1tZW51LXNlbGVjdCB7aXRlbUNsYXNzTmFtZX1cIiB0aXRsZT1cInt0aXRsZX1cIiA+PGxhYmVsIGZvcj1cInh4eFwiIGNsYXNzPVwiYnRuIGJ1dHRvbi17aWR9IHtjbGFzc05hbWV9XCI+PC9sYWJlbD48c2VsZWN0IGlkPVwieHh4XCI+JyxcbiAgICAgIHBvc3Q6IGZ1bmN0aW9uICgkaXRlbSwgZGF0YSwgb3B0aW9ucywgdG9vbCwgdmFsKSB7XG4gICAgICAgIHZhciBtb2RlbCA9ICBkYXRhLnZhbHVlLm9wdGlvbnMoKTtcbiAgICAgICAgdmFyIF92YWwgPSBkYXRhLnZhbHVlLmdldCgpO1xuICAgICAgICB2YXIgX3NlbGVjdCA9ICRpdGVtLmZpbmQoXCJzZWxlY3RcIik7XG4gICAgICAgIF9zZWxlY3QuZHBTZWxlY3Qoe1xuICAgICAgICAgIG1pbmltdW1SZXN1bHRzRm9yU2VhcmNoOiBJbmZpbml0eSxcbiAgICAgICAgICBkcm9wZG93blBhcmVudDogJChcImJvZHlcIiksXG4gICAgICAgICAgZGF0YTogIG1vZGVsLFxuICAgICAgICAgIHRlbXBsYXRlU2VsZWN0aW9uOiBmdW5jdGlvbihzdGF0ZSwgY29udGFpbmVyKSB7XG4gICAgICAgICAgICByZXR1cm4gZGF0YS50ZW1wbGF0ZVNlbGVjdGlvbihzdGF0ZSwgY29udGFpbmVyLGRhdGEpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgdGVtcGxhdGVSZXN1bHQ6IGZ1bmN0aW9uKHN0YXRlLCBjb250YWluZXIpe1xuICAgICAgICAgICAgcmV0dXJuIGRhdGEudGVtcGxhdGVSZXN1bHQoc3RhdGUsIGNvbnRhaW5lcixkYXRhKTtcbiAgICAgICAgICB9LFxuICAgICAgICB9KS5vbihcInNlbGVjdDI6c2VsZWN0XCIsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICBkYXRhLm9uY2hhbmdlKGUsIG1vZGVsKTtcbiAgICAgICAgfSk7XG4gICAgICAgIF9zZWxlY3QuZHBTZWxlY3QoXCJ2YWxcIixbX3ZhbF0pO1xuICAgICAgfVxuICAgIH0sXG4gICAgXCJudW1iZXJcIjoge1xuICAgICAgc2NvcGU6IGZ1bmN0aW9uIChkYXRhLCBvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgZ2V0SW5wdXRWYWx1ZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHJldHVybiBwYXJzZUZsb2F0KGRhdGEuJGl0ZW0uZmluZChcImlucHV0XCIpLnZhbCgpKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGdldFZhbHVlOiBkYXRhLnZhbHVlLmdldCxcbiAgICAgICAgICBzZXRWYWx1ZTogZGF0YS52YWx1ZS5zZXQsXG4gICAgICAgICAgbWluVmFsdWU6IGRhdGEudmFsdWUubWluICYmIGRhdGEudmFsdWUubWluKCksXG4gICAgICAgICAgbWF4VmFsdWU6IGRhdGEudmFsdWUubWF4ICYmIGRhdGEudmFsdWUubWF4KCksXG4gICAgICAgICAgdmFsdWVDdXJyZW50OiBkYXRhLnZhbHVlLmdldCgpLFxuICAgICAgICAgIG9uY2hhbmdlOiBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgZGF0YS52YWx1ZS5zZXQocGFyc2VGbG9hdCgkKGUudGFyZ2V0KS52YWwoKSkpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cIm9iamVjdC1tZW51LWl0ZW0gb2JqZWN0LW1lbnUtbnVtYmVyXCIgdGl0bGU9XCJ7dGl0bGV9XCI+JyArXG4gICAgICAnPGlucHV0IHR5cGU9XCJudW1iZXJcIiBtaW49XCJ7bWluVmFsdWV9XCIgbWF4PVwie21heFZhbHVlfVwiIHZhbHVlPVwie3ZhbHVlQ3VycmVudH1cIiBvbmNoYW5nZT1cIm9uY2hhbmdlKGV2ZW50KVwiPicsXG4gICAgICByZW5kZXI6IGZ1bmN0aW9uICgkaXRlbSwgZGF0YSwgb3B0aW9ucywgdG9vbCwgdmFsKSB7XG4gICAgICAgICRpdGVtLmZpbmQoXCJpbnB1dFwiKS52YWwoZGF0YS52YWx1ZS5nZXQoKSk7XG4gICAgICB9XG4gICAgfSxcbiAgICBcInJhbmdlXCI6IHtcbiAgICAgIHNjb3BlOiBmdW5jdGlvbiAoZGF0YSwgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIG1pblZhbHVlOiBkYXRhLnZhbHVlLm1pbiA/IHR5cGVvZiBkYXRhLnZhbHVlLm1pbiA9PSBcImZ1bmN0aW9uXCIgPyBkYXRhLnZhbHVlLm1pbigpIDogZGF0YS52YWx1ZS5taW46IDAsXG4gICAgICAgICAgbWF4VmFsdWU6IGRhdGEudmFsdWUubWF4ID8gdHlwZW9mIGRhdGEudmFsdWUubWF4ID09IFwiZnVuY3Rpb25cIiA/IGRhdGEudmFsdWUubWF4KCkgOiBkYXRhLnZhbHVlLm1heDogMSxcbiAgICAgICAgICB2YWx1ZVN0ZXA6IGRhdGEudmFsdWUuc3RlcCA/IHR5cGVvZiBkYXRhLnZhbHVlLnN0ZXAgPT0gXCJmdW5jdGlvblwiID8gZGF0YS52YWx1ZS5zdGVwKCkgOiBkYXRhLnZhbHVlLnN0ZXA6IDAuMSxcbiAgICAgICAgICB2YWx1ZUN1cnJlbnQ6IGRhdGEudmFsdWUuZ2V0KCksXG4gICAgICAgICAgb25jaGFuZ2U6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBkYXRhLnZhbHVlLnNldChwYXJzZUZsb2F0KCQoZS50YXJnZXQpLnZhbCgpKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgdGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwib2JqZWN0LW1lbnUtaXRlbSBvYmplY3QtbWVudS1yYW5nZVwiIHRpdGxlPVwie3RpdGxlfVwiPicgK1xuICAgICAgJzxpbnB1dCB0eXBlPVwicmFuZ2VcIiBzdGVwPVwie3ZhbHVlU3RlcH1cIiBtaW49XCJ7bWluVmFsdWV9XCIgbWF4PVwie21heFZhbHVlfVwiIHZhbHVlPVwie3ZhbHVlQ3VycmVudH1cIiBvbmNoYW5nZT1cIm9uY2hhbmdlKGV2ZW50KVwiPicsXG4gICAgICByZW5kZXI6IGZ1bmN0aW9uICgkaXRlbSwgZGF0YSwgb3B0aW9ucywgdG9vbCwgdmFsKSB7XG4gICAgICAgICRpdGVtLmZpbmQoXCJpbnB1dFwiKS52YWwoZGF0YS52YWx1ZS5nZXQoKSk7XG4gICAgICB9XG4gICAgfSxcbiAgICBcImNoZWNrYm94XCI6IHtcbiAgICAgIHNjb3BlOiBmdW5jdGlvbiAoZGF0YSwgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIG9uY2hhbmdlOiBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgZGF0YS52YWx1ZS5zZXQoZS50YXJnZXQuY2hlY2tlZClcbiAgICAgICAgICB9LFxuICAgICAgICAgIHZhbHVlQ3VycmVudDogZGF0YS52YWx1ZS5nZXQoKVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgdGVtcGxhdGU6XG4gICAgICAnPGRpdiBjbGFzcz1cIm9iamVjdC1tZW51LWl0ZW0gb2JqZWN0LW1lbnUtY2hlY2tib3hcIiB0aXRsZT1cInt0aXRsZX1cIj4nICtcbiAgICAgICc8aW5wdXQgdHlwZT1cImNoZWNrYm94XCIgb25jaGFuZ2U9XCJvbmNoYW5nZShldmVudClcIiBkcC1jaGVja2VkPVwie3ZhbHVlQ3VycmVudH1cIiBpZD1cImNoZWNrYm94LXtpZH1cIj4nICtcbiAgICAgICc8bGFiZWwgZm9yPVwiY2hlY2tib3gte2lkfVwiICBjbGFzcz1cImJ0biBidXR0b24te2lkfSB7Y2xhc3NOYW1lfVwiPicsXG4gICAgICByZW5kZXI6IGZ1bmN0aW9uICgkaXRlbSwgZGF0YSwgb3B0aW9ucywgdG9vbCwgdmFsKSB7XG4gICAgICAgICRpdGVtLmZpbmQoXCJpbnB1dFwiKS52YWwodmFsKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIFwibWVudVwiOiB7XG4gICAgICB0ZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJvYmplY3QtbWVudS1pdGVtIG9iamVjdC1tZW51LW1lbnVcIiB0aXRsZT1cInt0aXRsZX1cIj4nICtcbiAgICAgICc8bGFiZWwgZHAtaWY9XCJ0aXRsZVwiIGZvcj1cImJ1dHRvbi17aWR9XCI+e3RpdGxlfTwvbGFiZWw+JyArXG4gICAgICAnPGJ1dHRvbiBjbGFzcz1cImJ0biBidXR0b24tbWVudS10cmlnZ2VyIGJ1dHRvbi17aWR9IHtjbGFzc05hbWV9XCIgaWQ9XCJidXR0b24te2lkfVwiLz4nICtcbiAgICAgICc8ZGl2IGNsYXNzPVwib2JqZWN0LW1lbnUgc3VibWVudVwiIHRyYW5zY2x1ZGUvPicsXG4gICAgICBwb3N0OiBmdW5jdGlvbiAoJGl0ZW0sIGRhdGEsIG9wdGlvbnMsIHRyYW5zY2x1ZGUpIHtcbiAgICAgICAgLy8kaXRlbS5maW5kKFwiLmJ1dHRvbi1tZW51LXRyaWdnZXJcIikuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICAvLyAgJGl0ZW0uZmluZChcIi5vYmplY3QtbWVudVwiKS50b2dnbGUoKTtcbiAgICAgICAgLy99KVxuICAgICAgICBpZiAoZGF0YS5ob3ZlcmVkKSB7XG4gICAgICAgICAgJGl0ZW0uYWRkQ2xhc3MoXCJob3ZlcmVkXCIpO1xuICAgICAgICAgIHRoaXMudG9nZ2xlQnlIb3ZlcigkaXRlbSwgdHJhbnNjbHVkZSwgbnVsbCwgZGF0YSlcbiAgICAgICAgfVxuICAgICAgICBpZiAoZGF0YS50b2dnbGVkKSB7XG4gICAgICAgICAgJGl0ZW0uYWRkQ2xhc3MoXCJ0b2dnbGVkXCIpO1xuICAgICAgICAgIHRoaXMudG9nZ2xlQnlCdXR0b24oJGl0ZW0sIHRyYW5zY2x1ZGUpXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuZ2VuZXJhdGVNZW51KGRhdGEudGFyZ2V0LCB0cmFuc2NsdWRlLCBvcHRpb25zLCBkYXRhLm1lbnUpO1xuICAgICAgfVxuICAgIH0sXG4gICAgXCJlZmZlY3RcIjoge1xuICAgICAgc2NvcGU6IGZ1bmN0aW9uIChkYXRhLCBvcHRpb25zKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgYnV0dG9uc1RpdGxlOiBvcHRpb25zLmJ1dHRvbnMgJiYgb3B0aW9ucy5idXR0b25zLnRpdGxlIHx8IGZhbHNlLFxuICAgICAgICAgIGlzUGFyYW1ldGVyczogISFkYXRhLmFjdGlvblBhcmFtZXRlcnMsXG4gICAgICAgICAgYnV0dG9uc2NDbGFzc05hbWU6IChvcHRpb25zLmJ1dHRvbnMgJiYgb3B0aW9ucy5idXR0b25zLmNsYXNzTmFtZSB8fCAnJylcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cIm9iamVjdC1tZW51LWl0ZW1cIiB0aXRsZT1cInt0aXRsZX1cIj4nICtcbiAgICAgICc8YnV0dG9uIGNsYXNzPVwiYnRuIGJ1dHRvbi17aWR9IHtjbGFzc05hbWV9IHtidXR0b25zY0NsYXNzTmFtZX1cIj4nICtcbiAgICAgICc8c3BhbiBkcC1pZj1cImJ1dHRvbnNUaXRsZVwiIGNsYXNzPVwiYnV0dG9uLXRpdGxlXCI+e3RpdGxlfTwvc3Bhbj4nICtcbiAgICAgICc8L2J1dHRvbj4nICtcbiAgICAgICc8ZGl2IGRwLWlmPVwiaXNQYXJhbWV0ZXJzXCIgY2xhc3M9XCJtZW51LWFjdGlvbi1wYXJhbWV0ZXJzXCIgc3R5bGU9XCJkaXNwbGF5OiBub25lXCIgdHJhbnNjbHVkZT48L2Rpdj4nICtcbiAgICAgICc8L2Rpdj4nLFxuICAgICAgcG9zdDogZnVuY3Rpb24gKCRpdGVtLCBkYXRhLCBvcHRpb25zLCB0cmFuc2NsdWRlKSB7XG5cblxuICAgICAgICB2YXIgZm9vID0gZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgaWYgKGRhdGEuZWZmZWN0VHBsKSB7XG4gICAgICAgICAgICB2YXIgJHRwbCA9ICQoZGF0YS5lZmZlY3RUcGwpO1xuICAgICAgICAgICAgdHJhbnNjbHVkZS5odG1sKCR0cGwpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmIChkYXRhLmFjdGlvblBhcmFtZXRlcnNJZCkge1xuICAgICAgICAgICAgdmFyICR0cGwgPSAkKFwiI1wiICsgZGF0YS5hY3Rpb25QYXJhbWV0ZXJzSWQpLmNsb25lKCk7XG4gICAgICAgICAgICB0cmFuc2NsdWRlLmh0bWwoJHRwbCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBkYXRhLmFjdGlvblBhcmFtZXRlcnMuY2FsbChkYXRhLnRhcmdldCwgdHJhbnNjbHVkZSwgZGF0YSwgb3B0aW9ucyk7XG4gICAgICAgIH1cblxuXG4gICAgICAgIHRoaXMudG9nZ2xlQnlCdXR0b24oJGl0ZW0sIHRyYW5zY2x1ZGUsIGZvbyAsZGF0YSk7XG4gICAgICB9XG4gICAgfSxcbiAgICBcImJ1dHRvblwiOiB7XG4gICAgICBzY29wZTogZnVuY3Rpb24gKGRhdGEsIG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBidXR0b25zVGl0bGU6IG9wdGlvbnMuYnV0dG9ucyAmJiBvcHRpb25zLmJ1dHRvbnMudGl0bGUgfHwgZmFsc2UsXG4gICAgICAgICAgYnV0dG9uc2NDbGFzc05hbWU6IChvcHRpb25zLmJ1dHRvbnMgJiYgb3B0aW9ucy5idXR0b25zLmNsYXNzTmFtZSB8fCAnJylcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHRlbXBsYXRlOlxuICAgICAgJzxkaXYgY2xhc3M9XCJvYmplY3QtbWVudS1pdGVtXCIgdGl0bGU9XCJ7dGl0bGV9XCI+JyArXG4gICAgICAnPGJ1dHRvbiBjbGFzcz1cImJ0biBidXR0b24te2lkfSB7Y2xhc3NOYW1lfSB7YnV0dG9uc2NDbGFzc05hbWV9XCIgIG9uY2xpY2s9XCIhZGlzYWJsZWQgJiYgYWN0aW9uKG9wdGlvbilcIj4nICtcbiAgICAgICc8aW1nIGRwLWlmPVwiaWNvblwiIGRwLXNyYz1cImljb25cIj4nICtcbiAgICAgICc8c3BhbiBkcC1pbmNsdWRlPVwic3ZnXCIgZHAtaWY9XCJzdmdcIj48L3NwYW4+JyArXG4gICAgICAnPHNwYW4gZHAtaWY9XCJidXR0b25zVGl0bGVcIiBjbGFzcz1cImJ1dHRvbi10aXRsZVwiPnt0aXRsZX08L3NwYW4+J1xuICAgIH1cbiAgfSxcbiAgb25DcmVhdGU6IGZ1bmN0aW9uICgpIHtcblxuICB9LFxuICBkZXN0cm95OiBmdW5jdGlvbiAodGFyZ2V0KSB7XG4gICAgZm9yICh2YXIgaSA9IHRoaXMuYnV0dG9ucy5sZW5ndGg7aS0tOykge1xuICAgICAgdmFyIF9jb25maWcgPSB0aGlzLmJ1dHRvbnNbaV07XG4gICAgICBpZih0YXJnZXQgJiYgX2NvbmZpZy50YXJnZXQgIT0gdGFyZ2V0ICl7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgdGhpcy5idXR0b25zLnNwbGljZShpLDEpO1xuICAgIH1cbiAgfSxcbiAgY3JlYXRlSW5wdXQ6IGZ1bmN0aW9uICgkaXRlbSwgZGF0YSwgdHlwZSkge1xuXG4gICAgdmFyIHRhcmdldCA9IGRhdGEudGFyZ2V0O1xuICAgIHZhciAkaW5wdXQgPSAkKFwiPGlucHV0PlwiKVxuICAgICAgLmF0dHIoXCJ0eXBlXCIsIHR5cGUpXG4gICAgICAuYXR0cihcIm1pblwiLCBkYXRhLnZhbHVlLm1pbigpKVxuICAgICAgLmF0dHIoXCJtYXhcIiwgZGF0YS52YWx1ZS5tYXgoKSk7XG5cbiAgICAkaW5wdXQudmFsKGRhdGEudmFsdWUuZ2V0KCkpO1xuICAgIGlmIChkYXRhLnZhbHVlLm9ic2VydmUpIHtcbiAgICAgIHRhcmdldC5vbihkYXRhLnZhbHVlLm9ic2VydmUsIGZ1bmN0aW9uICh2YWwpIHtcbiAgICAgICAgJGlucHV0LnZhbChkYXRhLnZhbHVlLmdldCgpKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgICAkaW5wdXQuY2hhbmdlKGZ1bmN0aW9uIChlKSB7XG4gICAgICBkYXRhLnZhbHVlLnNldChwYXJzZUZsb2F0KCRpbnB1dC52YWwoKSkpXG4gICAgfSk7XG4gICAgJGl0ZW0uYXBwZW5kKCRpbnB1dCk7XG4gIH0sXG4gIGluaXRJdGVtOiBmdW5jdGlvbiAoJGl0ZW0sIGRhdGEpIHtcblxuICAgIGlmIChkYXRhLmFjdGl2ZSkge1xuICAgICAgaWYgKGRhdGEuYWN0aXZlLmNhbGwoZGF0YS50YXJnZXQsIGRhdGEub3B0aW9uKSkge1xuICAgICAgICAkaXRlbS5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoZGF0YS52aXNpYmxlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGlmIChkYXRhLnZpc2libGUuY29uc3RydWN0b3IgPT0gRnVuY3Rpb24pIHtcbiAgICAgICAgaWYgKCFkYXRhLnZpc2libGUuY2FsbChkYXRhLnRhcmdldCkpIHtcbiAgICAgICAgICAkaXRlbS5oaWRlKCk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAoIWRhdGEudmlzaWJsZSkge1xuICAgICAgICAkaXRlbS5oaWRlKCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgZGF0YS5kaXNhYmxlZCA9IGZhbHNlO1xuICAgIGlmIChkYXRhLmVuYWJsZWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgaWYgKGRhdGEuZW5hYmxlZC5jb25zdHJ1Y3RvciA9PSBGdW5jdGlvbikge1xuICAgICAgICBpZiAoIWRhdGEuZW5hYmxlZC5jYWxsKGRhdGEudGFyZ2V0KSkge1xuICAgICAgICAgICRpdGVtLmF0dHIoXCJkaXNhYmxlZFwiLCB0cnVlKTtcbiAgICAgICAgICBkYXRhLmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChkYXRhLm9ic2VydmUpIHtcbiAgICAgIC8vdG9kb1xuICAgICAgaWYgKGRhdGEudmlzaWJsZSAmJiBkYXRhLnZpc2libGUuY29uc3RydWN0b3IgPT0gRnVuY3Rpb24pIHtcbiAgICAgICAgZGF0YS50YXJnZXQgJiYgZGF0YS50YXJnZXQub24oZGF0YS5vYnNlcnZlLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgaWYgKCFkYXRhLnZpc2libGUuY2FsbChkYXRhLnRhcmdldCkpIHtcbiAgICAgICAgICAgICRpdGVtLmhpZGUoKTtcbiAgICAgICAgICAgIGRhdGEuaGlkZGVuID0gdHJ1ZTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgJGl0ZW0uc2hvdygpO1xuICAgICAgICAgICAgZGF0YS5oaWRkZW4gPSBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBpZiAoZGF0YS50eXBlID09IFwib3B0aW9uc1wiKSB7XG4gICAgICAgIGRhdGEudGFyZ2V0ICYmIGRhdGEudGFyZ2V0Lm9uKGRhdGEub2JzZXJ2ZSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHZhciBfdmFsID0gZGF0YS52YWx1ZS5nZXQoKTtcbiAgICAgICAgICAkKFwiW25hbWU9XCIgKyBkYXRhLmlkICsgXCJdXCIpLnByb3AoXCJjaGVja2VkXCIsZmFsc2UpO1xuICAgICAgICAgICQoXCJbbmFtZT1cIiArIGRhdGEuaWQgKyBcIl1bdmFsdWU9XCIgKyBfdmFsICtcIl1cIikucHJvcChcImNoZWNrZWRcIix0cnVlKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChkYXRhLmVuYWJsZWQgJiYgZGF0YS5lbmFibGVkLmNvbnN0cnVjdG9yID09IEZ1bmN0aW9uKSB7XG4gICAgICAgIGRhdGEudGFyZ2V0ICYmIGRhdGEudGFyZ2V0Lm9uKGRhdGEub2JzZXJ2ZSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGlmICghZGF0YS5lbmFibGVkLmNhbGwoZGF0YS50YXJnZXQpKSB7XG4gICAgICAgICAgICAkaXRlbS5hdHRyKFwiZGlzYWJsZWRcIiwgdHJ1ZSk7XG4gICAgICAgICAgICBkYXRhLmRpc2FibGVkID0gdHJ1ZTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgJGl0ZW0ucmVtb3ZlQXR0cihcImRpc2FibGVkXCIpO1xuICAgICAgICAgICAgZGF0YS5kaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICB9LFxuICB0b2dnbGVCeUhvdmVyOiBmdW5jdGlvbiAoJGl0ZW0sICR0b2dnbGVFbGVtZW50LCBmb28sZGF0YSkge1xuXG4gICAgdmFyIG9uQ2xvc2U7XG5cbiAgICAkdG9nZ2xlRWxlbWVudC5oaWRlKCk7XG4gICAgJGl0ZW0ubW91c2VvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgJHRvZ2dsZUVsZW1lbnQuaGlkZSgpO1xuICAgICAgb25DbG9zZSAmJiBvbkNsb3NlKCk7XG4gICAgfSk7XG4gICAgJGl0ZW0ubW91c2VvdmVyKGZ1bmN0aW9uICgpIHtcbiAgICAgICR0b2dnbGVFbGVtZW50LnNob3coKTtcbiAgICAgIG9uQ2xvc2UgPSBmb28gJiYgZm9vKCk7XG4gICAgfSk7XG5cbiAgICAkaXRlbS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAoZGF0YSAmJiBkYXRhLmltbWVkaWF0ZWx5KSB7XG4gICAgICAgIGRhdGEuYWN0aW9uKCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0sXG4gIHRvZ2dsZUJ5QnV0dG9uOiBmdW5jdGlvbiAoJGl0ZW0sICR0b2dnbGVFbGVtZW50LCBmb28sZGF0YSkge1xuXG4gICAgdmFyIG9uQ2xvc2U7XG4gICAgdmFyIF90cnlfaGlkZSA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICB2YXIgX3BhcmVudHMgPSAkKGUudGFyZ2V0KS5wYXJlbnRzKCk7XG4gICAgICBmb3IgKHZhciBpIGluIF9wYXJlbnRzKSB7XG4gICAgICAgIGlmIChfcGFyZW50c1tpXSA9PT0gJGl0ZW1bMF0pIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmICgkdG9nZ2xlRWxlbWVudC5jc3MoXCJkaXNwbGF5XCIpICE9PSBcIm5vbmVcIikge1xuICAgICAgICAkdG9nZ2xlRWxlbWVudC5oaWRlKCk7XG4gICAgICAgIG9uQ2xvc2UgJiYgb25DbG9zZSgpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICAkdG9nZ2xlRWxlbWVudC5jbGljayhmdW5jdGlvbiAoZSkge1xuICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICB9KTtcbiAgICAkdG9nZ2xlRWxlbWVudC5oaWRlKCk7XG4gICAgJGl0ZW0uY2xpY2soZnVuY3Rpb24gKCkge1xuXG4gICAgICBpZiAoJHRvZ2dsZUVsZW1lbnQuY3NzKFwiZGlzcGxheVwiKSAhPT0gXCJub25lXCIpIHtcbiAgICAgICAgJHRvZ2dsZUVsZW1lbnQuaGlkZSgpO1xuICAgICAgICBvbkNsb3NlICYmIG9uQ2xvc2UoKTtcbiAgICAgICAgJCh3aW5kb3cpLm9mZihcImNsaWNrXCIsIF90cnlfaGlkZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAkdG9nZ2xlRWxlbWVudC5zaG93KCk7XG4gICAgICAgICQod2luZG93KS5vbihcImNsaWNrXCIsIF90cnlfaGlkZSk7XG5cbiAgICAgICAgb25DbG9zZSA9IGZvbyAmJiBmb28oKTtcblxuICAgICAgICBpZihkYXRhICYmIGRhdGEuaW1tZWRpYXRlbHkpe1xuICAgICAgICAgIGRhdGEuYWN0aW9uKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KVxuICB9LFxuICBnZW5lcmF0ZU1lbnU6IGZ1bmN0aW9uICh0YXJnZXQsICRlbCwgb3B0aW9ucywgbWVudSkge1xuXG4gICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge1xuICAgICAgICB0aXRsZTogZmFsc2VcbiAgICAgIH07XG4gICAgb3B0aW9ucy5idXR0b25zID0gb3B0aW9ucy5idXR0b25zIHx8IHtcbiAgICAgICAgY2xhc3NOYW1lOiBcIlwiLFxuICAgICAgICB0aXRsZTogZmFsc2VcbiAgICAgIH07XG5cbiAgICAkZWwuZW1wdHkoKTtcblxuICAgIGZvciAodmFyIGkgaW4gbWVudSkge1xuICAgICAgdmFyIGRhdGEgPSBtZW51W2ldO1xuICAgICAgaWYgKCFkYXRhIHx8IGRhdGEuaW5zZXJ0ICE9PSB1bmRlZmluZWQgJiYgIWRhdGEuaW5zZXJ0KSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgZGF0YS50eXBlID0gZGF0YS50eXBlIHx8IFwiYnV0dG9uXCI7XG5cbiAgICAgIC8vdG9kbyDQvdC10L/QvtC90Y/RgtC90L4g0LfQsNGH0LXQvCDQsNGA0LPRg9C80LXQvdGCIHRhcmdldCDQsiDQvdCw0YfQsNC70LVcbiAgICAgIHZhciB0YXJnZXQgPSBkYXRhLnRhcmdldDtcblxuICAgICAgdmFyIHRvb2wgPSB0aGlzLnRvb2xzW2RhdGEudHlwZV07XG5cbiAgICAgIGlmICghdG9vbCkge1xuICAgICAgICBjb25zb2xlLndhcm4oXCJ0b29sIHVuZGVmaW5lZFwiKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdmFyIHNjb3BlID0gZGF0YTtcbiAgICAgIGlmICh0b29sLnNjb3BlKSB7XG4gICAgICAgIHNjb3BlID0gZmFicmljLnV0aWwub2JqZWN0LmRlZmF1bHRzKHRvb2wuc2NvcGUuY2FsbCh0aGlzLCBkYXRhLCBvcHRpb25zKSxkYXRhKTtcbiAgICAgIH1cblxuICAgICAgdmFyICRpdGVtID0gJCh0b29sLnRlbXBsYXRlLmZvcm1hdChzY29wZSkpO1xuICAgICAgdmFyIHRyYW5zY2x1ZGUgPSAkaXRlbS5maW5kKFwiW3RyYW5zY2x1ZGVdXCIpO1xuICAgICAgc2NvcGUuJGl0ZW0gPSBkYXRhLiRpdGVtID0gJGl0ZW07XG4gICAgICBpZihkYXRhLnRlbXBsYXRlKXtcbiAgICAgICAgJGl0ZW0uaHRtbChkYXRhLnRlbXBsYXRlLmZvcm1hdChkYXRhLnZhbHVlLmdldCgpKSk7XG4gICAgICB9XG5cbiAgICAgIHV0aWxzLmNvbXBpbGUuY29tcGlsZUVsZW1lbnQoJGl0ZW0sc2NvcGUpO1xuXG4gICAgICBpZiAoZGF0YS52YWx1ZSAmJiBkYXRhLnZhbHVlLm9ic2VydmUpIHtcblxuICAgICAgICB0YXJnZXQub24oZGF0YS52YWx1ZS5vYnNlcnZlLCBmdW5jdGlvbiAodmFsKSB7XG5cbiAgICAgICAgICBpZiAodG9vbC5wb3N0KSB7XG4gICAgICAgICAgICB0b29sLnBvc3QuY2FsbCh0aGlzLCRpdGVtLCBzY29wZSwgb3B0aW9ucywgdHJhbnNjbHVkZS5sZW5ndGggPyB0cmFuc2NsdWRlIDogbnVsbCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmKHRvb2wucmVuZGVyKXtcbiAgICAgICAgICAgIHRvb2wucmVuZGVyLmNhbGwodGhpcywgJGl0ZW0sIGRhdGEsIG9wdGlvbnMsIHRvb2wsIHZhbCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIC8vdGhpcy5maXJlKGRhdGEudHlwZSArIFwiOnJlbmRlclwiLHtpdGVtOiAkaXRlbSwgZGF0YTogZGF0YSwgb3B0aW9uczogb3B0aW9ucywgdG9vbDogdG9vbCwgdmFsOiB2YWx9KVxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5pbml0SXRlbSgkaXRlbSwgZGF0YSk7XG5cbiAgICAgIGlmICh0b29sLnBvc3QpIHtcbiAgICAgICAgdG9vbC5wb3N0LmNhbGwodGhpcywkaXRlbSwgc2NvcGUsIG9wdGlvbnMsIHRyYW5zY2x1ZGUubGVuZ3RoID8gdHJhbnNjbHVkZSA6IG51bGwpO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmZpcmUoZGF0YS50eXBlICsgXCI6Y3JlYXRlZFwiLHtpdGVtOiAkaXRlbSwgZGF0YTogZGF0YSwgb3B0aW9uczogb3B0aW9ucywgdG9vbDogdG9vbH0pO1xuXG4gICAgICAkZWwuYXBwZW5kKCRpdGVtKTtcbiAgICB9XG4gIH1cbn07XG51dGlscy5vYnNlcnZhYmxlKFRvb2xiYXIucHJvdG90eXBlKTtcblxuXG5Ub29sYmFyLnNpbmdsZSA9IGZ1bmN0aW9uKGRhdGEsZWxlbWVudCl7XG4gIGRhdGEuJGl0ZW0gPSBlbGVtZW50O1xuICBkYXRhLnR5cGUgPSBkYXRhLnR5cGUgfHwgXCJidXR0b25cIjtcblxuICB2YXIgdG9vbCA9IFRvb2xiYXIucHJvdG90eXBlLnRvb2xzW2RhdGEudHlwZV07XG5cbiAgVG9vbGJhci5wcm90b3R5cGUuaW5pdEl0ZW0oZWxlbWVudCxkYXRhKTtcblxuICBpZiAoZGF0YS52YWx1ZSAmJiBkYXRhLnZhbHVlLm9ic2VydmUpIHtcbiAgICBkYXRhLnRhcmdldC5vbihkYXRhLnZhbHVlLm9ic2VydmUsIGZ1bmN0aW9uICh2YWwpIHtcbiAgICAgIHRvb2wucmVuZGVyKCBlbGVtZW50LCBkYXRhLCB7fSwgdG9vbCwgdmFsKVxuICAgIH0pO1xuICB9XG5cbiAgaWYodG9vbC5wb3N0KXtcbiAgICB2YXIgdHJhbnNjbHVkZSA9IGVsZW1lbnQuZmluZChcIlt0cmFuc2NsdWRlXVwiKTtcblxuICAgIHRvb2wucG9zdC5jYWxsKFRvb2xiYXIucHJvdG90eXBlLCBlbGVtZW50LCBkYXRhLCB7fSwgdHJhbnNjbHVkZS5sZW5ndGggPyB0cmFuc2NsdWRlIDogbnVsbCk7XG4gIH1cblxuICB2YXIgc2NvcGUgPSBkYXRhO1xuICBpZih0b29sLnNjb3BlKXtcbiAgICBzY29wZSA9IF8uZGVmYXVsdHMoZGF0YSwgdG9vbC5zY29wZS5jYWxsKFRvb2xiYXIucHJvdG90eXBlLCBkYXRhLCB7fSkpO1xuICB9XG5cbiAgZWxlbWVudC5lYWNoU2VsZihcIipcIixmdW5jdGlvbigpe1xuICAgIHZhciBub2Rlcz1bXSwgdmFsdWVzPVtdO1xuICAgIGZvciAodmFyIGF0dCwgaSA9IDAsIGF0dHMgPSB0aGlzLmF0dHJpYnV0ZXMsIG4gPSBhdHRzLmxlbmd0aDsgaSA8IG47IGkrKyl7XG4gICAgICBhdHQgPSBhdHRzW2ldO1xuICAgICAgbm9kZXMucHVzaChhdHQubm9kZU5hbWUpO1xuICAgICAgdmFsdWVzLnB1c2goYXR0Lm5vZGVWYWx1ZSk7XG4gICAgICB0aGlzLnNldEF0dHJpYnV0ZShhdHQubm9kZU5hbWUsYXR0Lm5vZGVWYWx1ZS5mb3JtYXQoc2NvcGUpKTtcbiAgICB9XG4gIH0pO1xuICB1dGlscy5jb21waWxlLmNvbXBpbGVFbGVtZW50KGVsZW1lbnQsc2NvcGUpO1xufTtcblxuXG5tb2R1bGUuZXhwb3J0cyA9IFRvb2xiYXI7XG5cblxuXG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL3BsdWdpbnMvdG9vbGJhci5qc1xuLy8gbW9kdWxlIGlkID0gM1xuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCIvLyAgICAgVW5kZXJzY29yZS5qcyAxLjguM1xuLy8gICAgIGh0dHA6Ly91bmRlcnNjb3JlanMub3JnXG4vLyAgICAgKGMpIDIwMDktMjAxNSBKZXJlbXkgQXNoa2VuYXMsIERvY3VtZW50Q2xvdWQgYW5kIEludmVzdGlnYXRpdmUgUmVwb3J0ZXJzICYgRWRpdG9yc1xuLy8gICAgIFVuZGVyc2NvcmUgbWF5IGJlIGZyZWVseSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UuXG5cblxuICAvLyBTYXZlIGJ5dGVzIGluIHRoZSBtaW5pZmllZCAoYnV0IG5vdCBnemlwcGVkKSB2ZXJzaW9uOlxuICB2YXIgQXJyYXlQcm90byA9IEFycmF5LnByb3RvdHlwZSwgT2JqUHJvdG8gPSBPYmplY3QucHJvdG90eXBlLCBGdW5jUHJvdG8gPSBGdW5jdGlvbi5wcm90b3R5cGU7XG5cbiAgLy8gQ3JlYXRlIHF1aWNrIHJlZmVyZW5jZSB2YXJpYWJsZXMgZm9yIHNwZWVkIGFjY2VzcyB0byBjb3JlIHByb3RvdHlwZXMuXG4gIHZhclxuICAgIHB1c2ggICAgICAgICAgICAgPSBBcnJheVByb3RvLnB1c2gsXG4gICAgc2xpY2UgICAgICAgICAgICA9IEFycmF5UHJvdG8uc2xpY2UsXG4gICAgdG9TdHJpbmcgICAgICAgICA9IE9ialByb3RvLnRvU3RyaW5nLFxuICAgIGhhc093blByb3BlcnR5ICAgPSBPYmpQcm90by5oYXNPd25Qcm9wZXJ0eTtcblxuICAvLyBBbGwgKipFQ01BU2NyaXB0IDUqKiBuYXRpdmUgZnVuY3Rpb24gaW1wbGVtZW50YXRpb25zIHRoYXQgd2UgaG9wZSB0byB1c2VcbiAgLy8gYXJlIGRlY2xhcmVkIGhlcmUuXG4gIHZhclxuICAgIG5hdGl2ZUlzQXJyYXkgICAgICA9IEFycmF5LmlzQXJyYXksXG4gICAgbmF0aXZlS2V5cyAgICAgICAgID0gT2JqZWN0LmtleXMsXG4gICAgbmF0aXZlQmluZCAgICAgICAgID0gRnVuY1Byb3RvLmJpbmQsXG4gICAgbmF0aXZlQ3JlYXRlICAgICAgID0gT2JqZWN0LmNyZWF0ZTtcblxuICAvLyBOYWtlZCBmdW5jdGlvbiByZWZlcmVuY2UgZm9yIHN1cnJvZ2F0ZS1wcm90b3R5cGUtc3dhcHBpbmcuXG4gIHZhciBDdG9yID0gZnVuY3Rpb24oKXt9O1xuXG4gIC8vIENyZWF0ZSBhIHNhZmUgcmVmZXJlbmNlIHRvIHRoZSBVbmRlcnNjb3JlIG9iamVjdCBmb3IgdXNlIGJlbG93LlxuICB2YXIgXyA9IGZ1bmN0aW9uKG9iaikge1xuICAgIGlmIChvYmogaW5zdGFuY2VvZiBfKSByZXR1cm4gb2JqO1xuICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBfKSkgcmV0dXJuIG5ldyBfKG9iaik7XG4gICAgdGhpcy5fd3JhcHBlZCA9IG9iajtcbiAgfTtcblxuICAvLyBDdXJyZW50IHZlcnNpb24uXG4gIF8uVkVSU0lPTiA9ICcxLjguMyc7XG5cbiAgLy8gSW50ZXJuYWwgZnVuY3Rpb24gdGhhdCByZXR1cm5zIGFuIGVmZmljaWVudCAoZm9yIGN1cnJlbnQgZW5naW5lcykgdmVyc2lvblxuICAvLyBvZiB0aGUgcGFzc2VkLWluIGNhbGxiYWNrLCB0byBiZSByZXBlYXRlZGx5IGFwcGxpZWQgaW4gb3RoZXIgVW5kZXJzY29yZVxuICAvLyBmdW5jdGlvbnMuXG4gIHZhciBvcHRpbWl6ZUNiID0gZnVuY3Rpb24oZnVuYywgY29udGV4dCwgYXJnQ291bnQpIHtcbiAgICBpZiAoY29udGV4dCA9PT0gdm9pZCAwKSByZXR1cm4gZnVuYztcbiAgICBzd2l0Y2ggKGFyZ0NvdW50ID09IG51bGwgPyAzIDogYXJnQ291bnQpIHtcbiAgICAgIGNhc2UgMTogcmV0dXJuIGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICAgIHJldHVybiBmdW5jLmNhbGwoY29udGV4dCwgdmFsdWUpO1xuICAgICAgfTtcbiAgICAgIGNhc2UgMjogcmV0dXJuIGZ1bmN0aW9uKHZhbHVlLCBvdGhlcikge1xuICAgICAgICByZXR1cm4gZnVuYy5jYWxsKGNvbnRleHQsIHZhbHVlLCBvdGhlcik7XG4gICAgICB9O1xuICAgICAgY2FzZSAzOiByZXR1cm4gZnVuY3Rpb24odmFsdWUsIGluZGV4LCBjb2xsZWN0aW9uKSB7XG4gICAgICAgIHJldHVybiBmdW5jLmNhbGwoY29udGV4dCwgdmFsdWUsIGluZGV4LCBjb2xsZWN0aW9uKTtcbiAgICAgIH07XG4gICAgICBjYXNlIDQ6IHJldHVybiBmdW5jdGlvbihhY2N1bXVsYXRvciwgdmFsdWUsIGluZGV4LCBjb2xsZWN0aW9uKSB7XG4gICAgICAgIHJldHVybiBmdW5jLmNhbGwoY29udGV4dCwgYWNjdW11bGF0b3IsIHZhbHVlLCBpbmRleCwgY29sbGVjdGlvbik7XG4gICAgICB9O1xuICAgIH1cbiAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gZnVuYy5hcHBseShjb250ZXh0LCBhcmd1bWVudHMpO1xuICAgIH07XG4gIH07XG5cbiAgLy8gQSBtb3N0bHktaW50ZXJuYWwgZnVuY3Rpb24gdG8gZ2VuZXJhdGUgY2FsbGJhY2tzIHRoYXQgY2FuIGJlIGFwcGxpZWRcbiAgLy8gdG8gZWFjaCBlbGVtZW50IGluIGEgY29sbGVjdGlvbiwgcmV0dXJuaW5nIHRoZSBkZXNpcmVkIHJlc3VsdCDigJQgZWl0aGVyXG4gIC8vIGlkZW50aXR5LCBhbiBhcmJpdHJhcnkgY2FsbGJhY2ssIGEgcHJvcGVydHkgbWF0Y2hlciwgb3IgYSBwcm9wZXJ0eSBhY2Nlc3Nvci5cbiAgdmFyIGNiID0gZnVuY3Rpb24odmFsdWUsIGNvbnRleHQsIGFyZ0NvdW50KSB7XG4gICAgaWYgKHZhbHVlID09IG51bGwpIHJldHVybiBfLmlkZW50aXR5O1xuICAgIGlmIChfLmlzRnVuY3Rpb24odmFsdWUpKSByZXR1cm4gb3B0aW1pemVDYih2YWx1ZSwgY29udGV4dCwgYXJnQ291bnQpO1xuICAgIGlmIChfLmlzT2JqZWN0KHZhbHVlKSkgcmV0dXJuIF8ubWF0Y2hlcih2YWx1ZSk7XG4gICAgcmV0dXJuIF8ucHJvcGVydHkodmFsdWUpO1xuICB9O1xuICBfLml0ZXJhdGVlID0gZnVuY3Rpb24odmFsdWUsIGNvbnRleHQpIHtcbiAgICByZXR1cm4gY2IodmFsdWUsIGNvbnRleHQsIEluZmluaXR5KTtcbiAgfTtcblxuICAvLyBBbiBpbnRlcm5hbCBmdW5jdGlvbiBmb3IgY3JlYXRpbmcgYXNzaWduZXIgZnVuY3Rpb25zLlxuICB2YXIgY3JlYXRlQXNzaWduZXIgPSBmdW5jdGlvbihrZXlzRnVuYywgdW5kZWZpbmVkT25seSkge1xuICAgIHJldHVybiBmdW5jdGlvbihvYmopIHtcbiAgICAgIHZhciBsZW5ndGggPSBhcmd1bWVudHMubGVuZ3RoO1xuICAgICAgaWYgKGxlbmd0aCA8IDIgfHwgb2JqID09IG51bGwpIHJldHVybiBvYmo7XG4gICAgICBmb3IgKHZhciBpbmRleCA9IDE7IGluZGV4IDwgbGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICAgIHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaW5kZXhdLFxuICAgICAgICAgICAga2V5cyA9IGtleXNGdW5jKHNvdXJjZSksXG4gICAgICAgICAgICBsID0ga2V5cy5sZW5ndGg7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbDsgaSsrKSB7XG4gICAgICAgICAgdmFyIGtleSA9IGtleXNbaV07XG4gICAgICAgICAgaWYgKCF1bmRlZmluZWRPbmx5IHx8IG9ialtrZXldID09PSB2b2lkIDApIG9ialtrZXldID0gc291cmNlW2tleV07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBvYmo7XG4gICAgfTtcbiAgfTtcblxuICAvLyBBbiBpbnRlcm5hbCBmdW5jdGlvbiBmb3IgY3JlYXRpbmcgYSBuZXcgb2JqZWN0IHRoYXQgaW5oZXJpdHMgZnJvbSBhbm90aGVyLlxuICB2YXIgYmFzZUNyZWF0ZSA9IGZ1bmN0aW9uKHByb3RvdHlwZSkge1xuICAgIGlmICghXy5pc09iamVjdChwcm90b3R5cGUpKSByZXR1cm4ge307XG4gICAgaWYgKG5hdGl2ZUNyZWF0ZSkgcmV0dXJuIG5hdGl2ZUNyZWF0ZShwcm90b3R5cGUpO1xuICAgIEN0b3IucHJvdG90eXBlID0gcHJvdG90eXBlO1xuICAgIHZhciByZXN1bHQgPSBuZXcgQ3RvcjtcbiAgICBDdG9yLnByb3RvdHlwZSA9IG51bGw7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcblxuICB2YXIgcHJvcGVydHkgPSBmdW5jdGlvbihrZXkpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24ob2JqKSB7XG4gICAgICByZXR1cm4gb2JqID09IG51bGwgPyB2b2lkIDAgOiBvYmpba2V5XTtcbiAgICB9O1xuICB9O1xuXG4gIC8vIEhlbHBlciBmb3IgY29sbGVjdGlvbiBtZXRob2RzIHRvIGRldGVybWluZSB3aGV0aGVyIGEgY29sbGVjdGlvblxuICAvLyBzaG91bGQgYmUgaXRlcmF0ZWQgYXMgYW4gYXJyYXkgb3IgYXMgYW4gb2JqZWN0XG4gIC8vIFJlbGF0ZWQ6IGh0dHA6Ly9wZW9wbGUubW96aWxsYS5vcmcvfmpvcmVuZG9yZmYvZXM2LWRyYWZ0Lmh0bWwjc2VjLXRvbGVuZ3RoXG4gIC8vIEF2b2lkcyBhIHZlcnkgbmFzdHkgaU9TIDggSklUIGJ1ZyBvbiBBUk0tNjQuICMyMDk0XG4gIHZhciBNQVhfQVJSQVlfSU5ERVggPSBNYXRoLnBvdygyLCA1MykgLSAxO1xuICB2YXIgZ2V0TGVuZ3RoID0gcHJvcGVydHkoJ2xlbmd0aCcpO1xuICB2YXIgaXNBcnJheUxpa2UgPSBmdW5jdGlvbihjb2xsZWN0aW9uKSB7XG4gICAgdmFyIGxlbmd0aCA9IGdldExlbmd0aChjb2xsZWN0aW9uKTtcbiAgICByZXR1cm4gdHlwZW9mIGxlbmd0aCA9PSAnbnVtYmVyJyAmJiBsZW5ndGggPj0gMCAmJiBsZW5ndGggPD0gTUFYX0FSUkFZX0lOREVYO1xuICB9O1xuXG4gIC8vIENvbGxlY3Rpb24gRnVuY3Rpb25zXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgLy8gVGhlIGNvcm5lcnN0b25lLCBhbiBgZWFjaGAgaW1wbGVtZW50YXRpb24sIGFrYSBgZm9yRWFjaGAuXG4gIC8vIEhhbmRsZXMgcmF3IG9iamVjdHMgaW4gYWRkaXRpb24gdG8gYXJyYXktbGlrZXMuIFRyZWF0cyBhbGxcbiAgLy8gc3BhcnNlIGFycmF5LWxpa2VzIGFzIGlmIHRoZXkgd2VyZSBkZW5zZS5cbiAgXy5lYWNoID0gXy5mb3JFYWNoID0gZnVuY3Rpb24ob2JqLCBpdGVyYXRlZSwgY29udGV4dCkge1xuICAgIGl0ZXJhdGVlID0gb3B0aW1pemVDYihpdGVyYXRlZSwgY29udGV4dCk7XG4gICAgdmFyIGksIGxlbmd0aDtcbiAgICBpZiAoaXNBcnJheUxpa2Uob2JqKSkge1xuICAgICAgZm9yIChpID0gMCwgbGVuZ3RoID0gb2JqLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGl0ZXJhdGVlKG9ialtpXSwgaSwgb2JqKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgdmFyIGtleXMgPSBfLmtleXMob2JqKTtcbiAgICAgIGZvciAoaSA9IDAsIGxlbmd0aCA9IGtleXMubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaXRlcmF0ZWUob2JqW2tleXNbaV1dLCBrZXlzW2ldLCBvYmopO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gb2JqO1xuICB9O1xuXG4gIC8vIFJldHVybiB0aGUgcmVzdWx0cyBvZiBhcHBseWluZyB0aGUgaXRlcmF0ZWUgdG8gZWFjaCBlbGVtZW50LlxuICBfLm1hcCA9IF8uY29sbGVjdCA9IGZ1bmN0aW9uKG9iaiwgaXRlcmF0ZWUsIGNvbnRleHQpIHtcbiAgICBpdGVyYXRlZSA9IGNiKGl0ZXJhdGVlLCBjb250ZXh0KTtcbiAgICB2YXIga2V5cyA9ICFpc0FycmF5TGlrZShvYmopICYmIF8ua2V5cyhvYmopLFxuICAgICAgICBsZW5ndGggPSAoa2V5cyB8fCBvYmopLmxlbmd0aCxcbiAgICAgICAgcmVzdWx0cyA9IEFycmF5KGxlbmd0aCk7XG4gICAgZm9yICh2YXIgaW5kZXggPSAwOyBpbmRleCA8IGxlbmd0aDsgaW5kZXgrKykge1xuICAgICAgdmFyIGN1cnJlbnRLZXkgPSBrZXlzID8ga2V5c1tpbmRleF0gOiBpbmRleDtcbiAgICAgIHJlc3VsdHNbaW5kZXhdID0gaXRlcmF0ZWUob2JqW2N1cnJlbnRLZXldLCBjdXJyZW50S2V5LCBvYmopO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0cztcbiAgfTtcblxuICAvLyBDcmVhdGUgYSByZWR1Y2luZyBmdW5jdGlvbiBpdGVyYXRpbmcgbGVmdCBvciByaWdodC5cbiAgZnVuY3Rpb24gY3JlYXRlUmVkdWNlKGRpcikge1xuICAgIC8vIE9wdGltaXplZCBpdGVyYXRvciBmdW5jdGlvbiBhcyB1c2luZyBhcmd1bWVudHMubGVuZ3RoXG4gICAgLy8gaW4gdGhlIG1haW4gZnVuY3Rpb24gd2lsbCBkZW9wdGltaXplIHRoZSwgc2VlICMxOTkxLlxuICAgIGZ1bmN0aW9uIGl0ZXJhdG9yKG9iaiwgaXRlcmF0ZWUsIG1lbW8sIGtleXMsIGluZGV4LCBsZW5ndGgpIHtcbiAgICAgIGZvciAoOyBpbmRleCA+PSAwICYmIGluZGV4IDwgbGVuZ3RoOyBpbmRleCArPSBkaXIpIHtcbiAgICAgICAgdmFyIGN1cnJlbnRLZXkgPSBrZXlzID8ga2V5c1tpbmRleF0gOiBpbmRleDtcbiAgICAgICAgbWVtbyA9IGl0ZXJhdGVlKG1lbW8sIG9ialtjdXJyZW50S2V5XSwgY3VycmVudEtleSwgb2JqKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBtZW1vO1xuICAgIH1cblxuICAgIHJldHVybiBmdW5jdGlvbihvYmosIGl0ZXJhdGVlLCBtZW1vLCBjb250ZXh0KSB7XG4gICAgICBpdGVyYXRlZSA9IG9wdGltaXplQ2IoaXRlcmF0ZWUsIGNvbnRleHQsIDQpO1xuICAgICAgdmFyIGtleXMgPSAhaXNBcnJheUxpa2Uob2JqKSAmJiBfLmtleXMob2JqKSxcbiAgICAgICAgICBsZW5ndGggPSAoa2V5cyB8fCBvYmopLmxlbmd0aCxcbiAgICAgICAgICBpbmRleCA9IGRpciA+IDAgPyAwIDogbGVuZ3RoIC0gMTtcbiAgICAgIC8vIERldGVybWluZSB0aGUgaW5pdGlhbCB2YWx1ZSBpZiBub25lIGlzIHByb3ZpZGVkLlxuICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPCAzKSB7XG4gICAgICAgIG1lbW8gPSBvYmpba2V5cyA/IGtleXNbaW5kZXhdIDogaW5kZXhdO1xuICAgICAgICBpbmRleCArPSBkaXI7XG4gICAgICB9XG4gICAgICByZXR1cm4gaXRlcmF0b3Iob2JqLCBpdGVyYXRlZSwgbWVtbywga2V5cywgaW5kZXgsIGxlbmd0aCk7XG4gICAgfTtcbiAgfVxuXG4gIC8vICoqUmVkdWNlKiogYnVpbGRzIHVwIGEgc2luZ2xlIHJlc3VsdCBmcm9tIGEgbGlzdCBvZiB2YWx1ZXMsIGFrYSBgaW5qZWN0YCxcbiAgLy8gb3IgYGZvbGRsYC5cbiAgXy5yZWR1Y2UgPSBfLmZvbGRsID0gXy5pbmplY3QgPSBjcmVhdGVSZWR1Y2UoMSk7XG5cbiAgLy8gVGhlIHJpZ2h0LWFzc29jaWF0aXZlIHZlcnNpb24gb2YgcmVkdWNlLCBhbHNvIGtub3duIGFzIGBmb2xkcmAuXG4gIF8ucmVkdWNlUmlnaHQgPSBfLmZvbGRyID0gY3JlYXRlUmVkdWNlKC0xKTtcblxuICAvLyBSZXR1cm4gdGhlIGZpcnN0IHZhbHVlIHdoaWNoIHBhc3NlcyBhIHRydXRoIHRlc3QuIEFsaWFzZWQgYXMgYGRldGVjdGAuXG4gIF8uZmluZCA9IF8uZGV0ZWN0ID0gZnVuY3Rpb24ob2JqLCBwcmVkaWNhdGUsIGNvbnRleHQpIHtcbiAgICB2YXIga2V5O1xuICAgIGlmIChpc0FycmF5TGlrZShvYmopKSB7XG4gICAgICBrZXkgPSBfLmZpbmRJbmRleChvYmosIHByZWRpY2F0ZSwgY29udGV4dCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGtleSA9IF8uZmluZEtleShvYmosIHByZWRpY2F0ZSwgY29udGV4dCk7XG4gICAgfVxuICAgIGlmIChrZXkgIT09IHZvaWQgMCAmJiBrZXkgIT09IC0xKSByZXR1cm4gb2JqW2tleV07XG4gIH07XG5cbiAgLy8gUmV0dXJuIGFsbCB0aGUgZWxlbWVudHMgdGhhdCBwYXNzIGEgdHJ1dGggdGVzdC5cbiAgLy8gQWxpYXNlZCBhcyBgc2VsZWN0YC5cbiAgXy5maWx0ZXIgPSBfLnNlbGVjdCA9IGZ1bmN0aW9uKG9iaiwgcHJlZGljYXRlLCBjb250ZXh0KSB7XG4gICAgdmFyIHJlc3VsdHMgPSBbXTtcbiAgICBwcmVkaWNhdGUgPSBjYihwcmVkaWNhdGUsIGNvbnRleHQpO1xuICAgIF8uZWFjaChvYmosIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCwgbGlzdCkge1xuICAgICAgaWYgKHByZWRpY2F0ZSh2YWx1ZSwgaW5kZXgsIGxpc3QpKSByZXN1bHRzLnB1c2godmFsdWUpO1xuICAgIH0pO1xuICAgIHJldHVybiByZXN1bHRzO1xuICB9O1xuXG4gIC8vIFJldHVybiBhbGwgdGhlIGVsZW1lbnRzIGZvciB3aGljaCBhIHRydXRoIHRlc3QgZmFpbHMuXG4gIF8ucmVqZWN0ID0gZnVuY3Rpb24ob2JqLCBwcmVkaWNhdGUsIGNvbnRleHQpIHtcbiAgICByZXR1cm4gXy5maWx0ZXIob2JqLCBfLm5lZ2F0ZShjYihwcmVkaWNhdGUpKSwgY29udGV4dCk7XG4gIH07XG5cbiAgLy8gRGV0ZXJtaW5lIHdoZXRoZXIgYWxsIG9mIHRoZSBlbGVtZW50cyBtYXRjaCBhIHRydXRoIHRlc3QuXG4gIC8vIEFsaWFzZWQgYXMgYGFsbGAuXG4gIF8uZXZlcnkgPSBfLmFsbCA9IGZ1bmN0aW9uKG9iaiwgcHJlZGljYXRlLCBjb250ZXh0KSB7XG4gICAgcHJlZGljYXRlID0gY2IocHJlZGljYXRlLCBjb250ZXh0KTtcbiAgICB2YXIga2V5cyA9ICFpc0FycmF5TGlrZShvYmopICYmIF8ua2V5cyhvYmopLFxuICAgICAgICBsZW5ndGggPSAoa2V5cyB8fCBvYmopLmxlbmd0aDtcbiAgICBmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4IDwgbGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICB2YXIgY3VycmVudEtleSA9IGtleXMgPyBrZXlzW2luZGV4XSA6IGluZGV4O1xuICAgICAgaWYgKCFwcmVkaWNhdGUob2JqW2N1cnJlbnRLZXldLCBjdXJyZW50S2V5LCBvYmopKSByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xuICB9O1xuXG4gIC8vIERldGVybWluZSBpZiBhdCBsZWFzdCBvbmUgZWxlbWVudCBpbiB0aGUgb2JqZWN0IG1hdGNoZXMgYSB0cnV0aCB0ZXN0LlxuICAvLyBBbGlhc2VkIGFzIGBhbnlgLlxuICBfLnNvbWUgPSBfLmFueSA9IGZ1bmN0aW9uKG9iaiwgcHJlZGljYXRlLCBjb250ZXh0KSB7XG4gICAgcHJlZGljYXRlID0gY2IocHJlZGljYXRlLCBjb250ZXh0KTtcbiAgICB2YXIga2V5cyA9ICFpc0FycmF5TGlrZShvYmopICYmIF8ua2V5cyhvYmopLFxuICAgICAgICBsZW5ndGggPSAoa2V5cyB8fCBvYmopLmxlbmd0aDtcbiAgICBmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4IDwgbGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICB2YXIgY3VycmVudEtleSA9IGtleXMgPyBrZXlzW2luZGV4XSA6IGluZGV4O1xuICAgICAgaWYgKHByZWRpY2F0ZShvYmpbY3VycmVudEtleV0sIGN1cnJlbnRLZXksIG9iaikpIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG5cbiAgLy8gRGV0ZXJtaW5lIGlmIHRoZSBhcnJheSBvciBvYmplY3QgY29udGFpbnMgYSBnaXZlbiBpdGVtICh1c2luZyBgPT09YCkuXG4gIC8vIEFsaWFzZWQgYXMgYGluY2x1ZGVzYCBhbmQgYGluY2x1ZGVgLlxuICBfLmNvbnRhaW5zID0gXy5pbmNsdWRlcyA9IF8uaW5jbHVkZSA9IGZ1bmN0aW9uKG9iaiwgaXRlbSwgZnJvbUluZGV4LCBndWFyZCkge1xuICAgIGlmICghaXNBcnJheUxpa2Uob2JqKSkgb2JqID0gXy52YWx1ZXMob2JqKTtcbiAgICBpZiAodHlwZW9mIGZyb21JbmRleCAhPSAnbnVtYmVyJyB8fCBndWFyZCkgZnJvbUluZGV4ID0gMDtcbiAgICByZXR1cm4gXy5pbmRleE9mKG9iaiwgaXRlbSwgZnJvbUluZGV4KSA+PSAwO1xuICB9O1xuXG4gIC8vIEludm9rZSBhIG1ldGhvZCAod2l0aCBhcmd1bWVudHMpIG9uIGV2ZXJ5IGl0ZW0gaW4gYSBjb2xsZWN0aW9uLlxuICBfLmludm9rZSA9IGZ1bmN0aW9uKG9iaiwgbWV0aG9kKSB7XG4gICAgdmFyIGFyZ3MgPSBzbGljZS5jYWxsKGFyZ3VtZW50cywgMik7XG4gICAgdmFyIGlzRnVuYyA9IF8uaXNGdW5jdGlvbihtZXRob2QpO1xuICAgIHJldHVybiBfLm1hcChvYmosIGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICB2YXIgZnVuYyA9IGlzRnVuYyA/IG1ldGhvZCA6IHZhbHVlW21ldGhvZF07XG4gICAgICByZXR1cm4gZnVuYyA9PSBudWxsID8gZnVuYyA6IGZ1bmMuYXBwbHkodmFsdWUsIGFyZ3MpO1xuICAgIH0pO1xuICB9O1xuXG4gIC8vIENvbnZlbmllbmNlIHZlcnNpb24gb2YgYSBjb21tb24gdXNlIGNhc2Ugb2YgYG1hcGA6IGZldGNoaW5nIGEgcHJvcGVydHkuXG4gIF8ucGx1Y2sgPSBmdW5jdGlvbihvYmosIGtleSkge1xuICAgIHJldHVybiBfLm1hcChvYmosIF8ucHJvcGVydHkoa2V5KSk7XG4gIH07XG5cbiAgLy8gQ29udmVuaWVuY2UgdmVyc2lvbiBvZiBhIGNvbW1vbiB1c2UgY2FzZSBvZiBgZmlsdGVyYDogc2VsZWN0aW5nIG9ubHkgb2JqZWN0c1xuICAvLyBjb250YWluaW5nIHNwZWNpZmljIGBrZXk6dmFsdWVgIHBhaXJzLlxuICBfLndoZXJlID0gZnVuY3Rpb24ob2JqLCBhdHRycykge1xuICAgIHJldHVybiBfLmZpbHRlcihvYmosIF8ubWF0Y2hlcihhdHRycykpO1xuICB9O1xuXG4gIC8vIENvbnZlbmllbmNlIHZlcnNpb24gb2YgYSBjb21tb24gdXNlIGNhc2Ugb2YgYGZpbmRgOiBnZXR0aW5nIHRoZSBmaXJzdCBvYmplY3RcbiAgLy8gY29udGFpbmluZyBzcGVjaWZpYyBga2V5OnZhbHVlYCBwYWlycy5cbiAgXy5maW5kV2hlcmUgPSBmdW5jdGlvbihvYmosIGF0dHJzKSB7XG4gICAgcmV0dXJuIF8uZmluZChvYmosIF8ubWF0Y2hlcihhdHRycykpO1xuICB9O1xuXG4gIC8vIFJldHVybiB0aGUgbWF4aW11bSBlbGVtZW50IChvciBlbGVtZW50LWJhc2VkIGNvbXB1dGF0aW9uKS5cbiAgXy5tYXggPSBmdW5jdGlvbihvYmosIGl0ZXJhdGVlLCBjb250ZXh0KSB7XG4gICAgdmFyIHJlc3VsdCA9IC1JbmZpbml0eSwgbGFzdENvbXB1dGVkID0gLUluZmluaXR5LFxuICAgICAgICB2YWx1ZSwgY29tcHV0ZWQ7XG4gICAgaWYgKGl0ZXJhdGVlID09IG51bGwgJiYgb2JqICE9IG51bGwpIHtcbiAgICAgIG9iaiA9IGlzQXJyYXlMaWtlKG9iaikgPyBvYmogOiBfLnZhbHVlcyhvYmopO1xuICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IG9iai5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgICB2YWx1ZSA9IG9ialtpXTtcbiAgICAgICAgaWYgKHZhbHVlID4gcmVzdWx0KSB7XG4gICAgICAgICAgcmVzdWx0ID0gdmFsdWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgaXRlcmF0ZWUgPSBjYihpdGVyYXRlZSwgY29udGV4dCk7XG4gICAgICBfLmVhY2gob2JqLCBmdW5jdGlvbih2YWx1ZSwgaW5kZXgsIGxpc3QpIHtcbiAgICAgICAgY29tcHV0ZWQgPSBpdGVyYXRlZSh2YWx1ZSwgaW5kZXgsIGxpc3QpO1xuICAgICAgICBpZiAoY29tcHV0ZWQgPiBsYXN0Q29tcHV0ZWQgfHwgY29tcHV0ZWQgPT09IC1JbmZpbml0eSAmJiByZXN1bHQgPT09IC1JbmZpbml0eSkge1xuICAgICAgICAgIHJlc3VsdCA9IHZhbHVlO1xuICAgICAgICAgIGxhc3RDb21wdXRlZCA9IGNvbXB1dGVkO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcblxuICAvLyBSZXR1cm4gdGhlIG1pbmltdW0gZWxlbWVudCAob3IgZWxlbWVudC1iYXNlZCBjb21wdXRhdGlvbikuXG4gIF8ubWluID0gZnVuY3Rpb24ob2JqLCBpdGVyYXRlZSwgY29udGV4dCkge1xuICAgIHZhciByZXN1bHQgPSBJbmZpbml0eSwgbGFzdENvbXB1dGVkID0gSW5maW5pdHksXG4gICAgICAgIHZhbHVlLCBjb21wdXRlZDtcbiAgICBpZiAoaXRlcmF0ZWUgPT0gbnVsbCAmJiBvYmogIT0gbnVsbCkge1xuICAgICAgb2JqID0gaXNBcnJheUxpa2Uob2JqKSA/IG9iaiA6IF8udmFsdWVzKG9iaik7XG4gICAgICBmb3IgKHZhciBpID0gMCwgbGVuZ3RoID0gb2JqLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHZhbHVlID0gb2JqW2ldO1xuICAgICAgICBpZiAodmFsdWUgPCByZXN1bHQpIHtcbiAgICAgICAgICByZXN1bHQgPSB2YWx1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBpdGVyYXRlZSA9IGNiKGl0ZXJhdGVlLCBjb250ZXh0KTtcbiAgICAgIF8uZWFjaChvYmosIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCwgbGlzdCkge1xuICAgICAgICBjb21wdXRlZCA9IGl0ZXJhdGVlKHZhbHVlLCBpbmRleCwgbGlzdCk7XG4gICAgICAgIGlmIChjb21wdXRlZCA8IGxhc3RDb21wdXRlZCB8fCBjb21wdXRlZCA9PT0gSW5maW5pdHkgJiYgcmVzdWx0ID09PSBJbmZpbml0eSkge1xuICAgICAgICAgIHJlc3VsdCA9IHZhbHVlO1xuICAgICAgICAgIGxhc3RDb21wdXRlZCA9IGNvbXB1dGVkO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcblxuICAvLyBTaHVmZmxlIGEgY29sbGVjdGlvbiwgdXNpbmcgdGhlIG1vZGVybiB2ZXJzaW9uIG9mIHRoZVxuICAvLyBbRmlzaGVyLVlhdGVzIHNodWZmbGVdKGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvRmlzaGVy4oCTWWF0ZXNfc2h1ZmZsZSkuXG4gIF8uc2h1ZmZsZSA9IGZ1bmN0aW9uKG9iaikge1xuICAgIHZhciBzZXQgPSBpc0FycmF5TGlrZShvYmopID8gb2JqIDogXy52YWx1ZXMob2JqKTtcbiAgICB2YXIgbGVuZ3RoID0gc2V0Lmxlbmd0aDtcbiAgICB2YXIgc2h1ZmZsZWQgPSBBcnJheShsZW5ndGgpO1xuICAgIGZvciAodmFyIGluZGV4ID0gMCwgcmFuZDsgaW5kZXggPCBsZW5ndGg7IGluZGV4KyspIHtcbiAgICAgIHJhbmQgPSBfLnJhbmRvbSgwLCBpbmRleCk7XG4gICAgICBpZiAocmFuZCAhPT0gaW5kZXgpIHNodWZmbGVkW2luZGV4XSA9IHNodWZmbGVkW3JhbmRdO1xuICAgICAgc2h1ZmZsZWRbcmFuZF0gPSBzZXRbaW5kZXhdO1xuICAgIH1cbiAgICByZXR1cm4gc2h1ZmZsZWQ7XG4gIH07XG5cbiAgLy8gU2FtcGxlICoqbioqIHJhbmRvbSB2YWx1ZXMgZnJvbSBhIGNvbGxlY3Rpb24uXG4gIC8vIElmICoqbioqIGlzIG5vdCBzcGVjaWZpZWQsIHJldHVybnMgYSBzaW5nbGUgcmFuZG9tIGVsZW1lbnQuXG4gIC8vIFRoZSBpbnRlcm5hbCBgZ3VhcmRgIGFyZ3VtZW50IGFsbG93cyBpdCB0byB3b3JrIHdpdGggYG1hcGAuXG4gIF8uc2FtcGxlID0gZnVuY3Rpb24ob2JqLCBuLCBndWFyZCkge1xuICAgIGlmIChuID09IG51bGwgfHwgZ3VhcmQpIHtcbiAgICAgIGlmICghaXNBcnJheUxpa2Uob2JqKSkgb2JqID0gXy52YWx1ZXMob2JqKTtcbiAgICAgIHJldHVybiBvYmpbXy5yYW5kb20ob2JqLmxlbmd0aCAtIDEpXTtcbiAgICB9XG4gICAgcmV0dXJuIF8uc2h1ZmZsZShvYmopLnNsaWNlKDAsIE1hdGgubWF4KDAsIG4pKTtcbiAgfTtcblxuICAvLyBTb3J0IHRoZSBvYmplY3QncyB2YWx1ZXMgYnkgYSBjcml0ZXJpb24gcHJvZHVjZWQgYnkgYW4gaXRlcmF0ZWUuXG4gIF8uc29ydEJ5ID0gZnVuY3Rpb24ob2JqLCBpdGVyYXRlZSwgY29udGV4dCkge1xuICAgIGl0ZXJhdGVlID0gY2IoaXRlcmF0ZWUsIGNvbnRleHQpO1xuICAgIHJldHVybiBfLnBsdWNrKF8ubWFwKG9iaiwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBsaXN0KSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB2YWx1ZTogdmFsdWUsXG4gICAgICAgIGluZGV4OiBpbmRleCxcbiAgICAgICAgY3JpdGVyaWE6IGl0ZXJhdGVlKHZhbHVlLCBpbmRleCwgbGlzdClcbiAgICAgIH07XG4gICAgfSkuc29ydChmdW5jdGlvbihsZWZ0LCByaWdodCkge1xuICAgICAgdmFyIGEgPSBsZWZ0LmNyaXRlcmlhO1xuICAgICAgdmFyIGIgPSByaWdodC5jcml0ZXJpYTtcbiAgICAgIGlmIChhICE9PSBiKSB7XG4gICAgICAgIGlmIChhID4gYiB8fCBhID09PSB2b2lkIDApIHJldHVybiAxO1xuICAgICAgICBpZiAoYSA8IGIgfHwgYiA9PT0gdm9pZCAwKSByZXR1cm4gLTE7XG4gICAgICB9XG4gICAgICByZXR1cm4gbGVmdC5pbmRleCAtIHJpZ2h0LmluZGV4O1xuICAgIH0pLCAndmFsdWUnKTtcbiAgfTtcblxuICAvLyBBbiBpbnRlcm5hbCBmdW5jdGlvbiB1c2VkIGZvciBhZ2dyZWdhdGUgXCJncm91cCBieVwiIG9wZXJhdGlvbnMuXG4gIHZhciBncm91cCA9IGZ1bmN0aW9uKGJlaGF2aW9yKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKG9iaiwgaXRlcmF0ZWUsIGNvbnRleHQpIHtcbiAgICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICAgIGl0ZXJhdGVlID0gY2IoaXRlcmF0ZWUsIGNvbnRleHQpO1xuICAgICAgXy5lYWNoKG9iaiwgZnVuY3Rpb24odmFsdWUsIGluZGV4KSB7XG4gICAgICAgIHZhciBrZXkgPSBpdGVyYXRlZSh2YWx1ZSwgaW5kZXgsIG9iaik7XG4gICAgICAgIGJlaGF2aW9yKHJlc3VsdCwgdmFsdWUsIGtleSk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfTtcbiAgfTtcblxuICAvLyBHcm91cHMgdGhlIG9iamVjdCdzIHZhbHVlcyBieSBhIGNyaXRlcmlvbi4gUGFzcyBlaXRoZXIgYSBzdHJpbmcgYXR0cmlidXRlXG4gIC8vIHRvIGdyb3VwIGJ5LCBvciBhIGZ1bmN0aW9uIHRoYXQgcmV0dXJucyB0aGUgY3JpdGVyaW9uLlxuICBfLmdyb3VwQnkgPSBncm91cChmdW5jdGlvbihyZXN1bHQsIHZhbHVlLCBrZXkpIHtcbiAgICBpZiAoXy5oYXMocmVzdWx0LCBrZXkpKSByZXN1bHRba2V5XS5wdXNoKHZhbHVlKTsgZWxzZSByZXN1bHRba2V5XSA9IFt2YWx1ZV07XG4gIH0pO1xuXG4gIC8vIEluZGV4ZXMgdGhlIG9iamVjdCdzIHZhbHVlcyBieSBhIGNyaXRlcmlvbiwgc2ltaWxhciB0byBgZ3JvdXBCeWAsIGJ1dCBmb3JcbiAgLy8gd2hlbiB5b3Uga25vdyB0aGF0IHlvdXIgaW5kZXggdmFsdWVzIHdpbGwgYmUgdW5pcXVlLlxuICBfLmluZGV4QnkgPSBncm91cChmdW5jdGlvbihyZXN1bHQsIHZhbHVlLCBrZXkpIHtcbiAgICByZXN1bHRba2V5XSA9IHZhbHVlO1xuICB9KTtcblxuICAvLyBDb3VudHMgaW5zdGFuY2VzIG9mIGFuIG9iamVjdCB0aGF0IGdyb3VwIGJ5IGEgY2VydGFpbiBjcml0ZXJpb24uIFBhc3NcbiAgLy8gZWl0aGVyIGEgc3RyaW5nIGF0dHJpYnV0ZSB0byBjb3VudCBieSwgb3IgYSBmdW5jdGlvbiB0aGF0IHJldHVybnMgdGhlXG4gIC8vIGNyaXRlcmlvbi5cbiAgXy5jb3VudEJ5ID0gZ3JvdXAoZnVuY3Rpb24ocmVzdWx0LCB2YWx1ZSwga2V5KSB7XG4gICAgaWYgKF8uaGFzKHJlc3VsdCwga2V5KSkgcmVzdWx0W2tleV0rKzsgZWxzZSByZXN1bHRba2V5XSA9IDE7XG4gIH0pO1xuXG4gIC8vIFNhZmVseSBjcmVhdGUgYSByZWFsLCBsaXZlIGFycmF5IGZyb20gYW55dGhpbmcgaXRlcmFibGUuXG4gIF8udG9BcnJheSA9IGZ1bmN0aW9uKG9iaikge1xuICAgIGlmICghb2JqKSByZXR1cm4gW107XG4gICAgaWYgKF8uaXNBcnJheShvYmopKSByZXR1cm4gc2xpY2UuY2FsbChvYmopO1xuICAgIGlmIChpc0FycmF5TGlrZShvYmopKSByZXR1cm4gXy5tYXAob2JqLCBfLmlkZW50aXR5KTtcbiAgICByZXR1cm4gXy52YWx1ZXMob2JqKTtcbiAgfTtcblxuICAvLyBSZXR1cm4gdGhlIG51bWJlciBvZiBlbGVtZW50cyBpbiBhbiBvYmplY3QuXG4gIF8uc2l6ZSA9IGZ1bmN0aW9uKG9iaikge1xuICAgIGlmIChvYmogPT0gbnVsbCkgcmV0dXJuIDA7XG4gICAgcmV0dXJuIGlzQXJyYXlMaWtlKG9iaikgPyBvYmoubGVuZ3RoIDogXy5rZXlzKG9iaikubGVuZ3RoO1xuICB9O1xuXG4gIC8vIFNwbGl0IGEgY29sbGVjdGlvbiBpbnRvIHR3byBhcnJheXM6IG9uZSB3aG9zZSBlbGVtZW50cyBhbGwgc2F0aXNmeSB0aGUgZ2l2ZW5cbiAgLy8gcHJlZGljYXRlLCBhbmQgb25lIHdob3NlIGVsZW1lbnRzIGFsbCBkbyBub3Qgc2F0aXNmeSB0aGUgcHJlZGljYXRlLlxuICBfLnBhcnRpdGlvbiA9IGZ1bmN0aW9uKG9iaiwgcHJlZGljYXRlLCBjb250ZXh0KSB7XG4gICAgcHJlZGljYXRlID0gY2IocHJlZGljYXRlLCBjb250ZXh0KTtcbiAgICB2YXIgcGFzcyA9IFtdLCBmYWlsID0gW107XG4gICAgXy5lYWNoKG9iaiwgZnVuY3Rpb24odmFsdWUsIGtleSwgb2JqKSB7XG4gICAgICAocHJlZGljYXRlKHZhbHVlLCBrZXksIG9iaikgPyBwYXNzIDogZmFpbCkucHVzaCh2YWx1ZSk7XG4gICAgfSk7XG4gICAgcmV0dXJuIFtwYXNzLCBmYWlsXTtcbiAgfTtcblxuICAvLyBBcnJheSBGdW5jdGlvbnNcbiAgLy8gLS0tLS0tLS0tLS0tLS0tXG5cbiAgLy8gR2V0IHRoZSBmaXJzdCBlbGVtZW50IG9mIGFuIGFycmF5LiBQYXNzaW5nICoqbioqIHdpbGwgcmV0dXJuIHRoZSBmaXJzdCBOXG4gIC8vIHZhbHVlcyBpbiB0aGUgYXJyYXkuIEFsaWFzZWQgYXMgYGhlYWRgIGFuZCBgdGFrZWAuIFRoZSAqKmd1YXJkKiogY2hlY2tcbiAgLy8gYWxsb3dzIGl0IHRvIHdvcmsgd2l0aCBgXy5tYXBgLlxuICBfLmZpcnN0ID0gXy5oZWFkID0gXy50YWtlID0gZnVuY3Rpb24oYXJyYXksIG4sIGd1YXJkKSB7XG4gICAgaWYgKGFycmF5ID09IG51bGwpIHJldHVybiB2b2lkIDA7XG4gICAgaWYgKG4gPT0gbnVsbCB8fCBndWFyZCkgcmV0dXJuIGFycmF5WzBdO1xuICAgIHJldHVybiBfLmluaXRpYWwoYXJyYXksIGFycmF5Lmxlbmd0aCAtIG4pO1xuICB9O1xuXG4gIC8vIFJldHVybnMgZXZlcnl0aGluZyBidXQgdGhlIGxhc3QgZW50cnkgb2YgdGhlIGFycmF5LiBFc3BlY2lhbGx5IHVzZWZ1bCBvblxuICAvLyB0aGUgYXJndW1lbnRzIG9iamVjdC4gUGFzc2luZyAqKm4qKiB3aWxsIHJldHVybiBhbGwgdGhlIHZhbHVlcyBpblxuICAvLyB0aGUgYXJyYXksIGV4Y2x1ZGluZyB0aGUgbGFzdCBOLlxuICBfLmluaXRpYWwgPSBmdW5jdGlvbihhcnJheSwgbiwgZ3VhcmQpIHtcbiAgICByZXR1cm4gc2xpY2UuY2FsbChhcnJheSwgMCwgTWF0aC5tYXgoMCwgYXJyYXkubGVuZ3RoIC0gKG4gPT0gbnVsbCB8fCBndWFyZCA/IDEgOiBuKSkpO1xuICB9O1xuXG4gIC8vIEdldCB0aGUgbGFzdCBlbGVtZW50IG9mIGFuIGFycmF5LiBQYXNzaW5nICoqbioqIHdpbGwgcmV0dXJuIHRoZSBsYXN0IE5cbiAgLy8gdmFsdWVzIGluIHRoZSBhcnJheS5cbiAgXy5sYXN0ID0gZnVuY3Rpb24oYXJyYXksIG4sIGd1YXJkKSB7XG4gICAgaWYgKGFycmF5ID09IG51bGwpIHJldHVybiB2b2lkIDA7XG4gICAgaWYgKG4gPT0gbnVsbCB8fCBndWFyZCkgcmV0dXJuIGFycmF5W2FycmF5Lmxlbmd0aCAtIDFdO1xuICAgIHJldHVybiBfLnJlc3QoYXJyYXksIE1hdGgubWF4KDAsIGFycmF5Lmxlbmd0aCAtIG4pKTtcbiAgfTtcblxuICAvLyBSZXR1cm5zIGV2ZXJ5dGhpbmcgYnV0IHRoZSBmaXJzdCBlbnRyeSBvZiB0aGUgYXJyYXkuIEFsaWFzZWQgYXMgYHRhaWxgIGFuZCBgZHJvcGAuXG4gIC8vIEVzcGVjaWFsbHkgdXNlZnVsIG9uIHRoZSBhcmd1bWVudHMgb2JqZWN0LiBQYXNzaW5nIGFuICoqbioqIHdpbGwgcmV0dXJuXG4gIC8vIHRoZSByZXN0IE4gdmFsdWVzIGluIHRoZSBhcnJheS5cbiAgXy5yZXN0ID0gXy50YWlsID0gXy5kcm9wID0gZnVuY3Rpb24oYXJyYXksIG4sIGd1YXJkKSB7XG4gICAgcmV0dXJuIHNsaWNlLmNhbGwoYXJyYXksIG4gPT0gbnVsbCB8fCBndWFyZCA/IDEgOiBuKTtcbiAgfTtcblxuICAvLyBUcmltIG91dCBhbGwgZmFsc3kgdmFsdWVzIGZyb20gYW4gYXJyYXkuXG4gIF8uY29tcGFjdCA9IGZ1bmN0aW9uKGFycmF5KSB7XG4gICAgcmV0dXJuIF8uZmlsdGVyKGFycmF5LCBfLmlkZW50aXR5KTtcbiAgfTtcblxuICAvLyBJbnRlcm5hbCBpbXBsZW1lbnRhdGlvbiBvZiBhIHJlY3Vyc2l2ZSBgZmxhdHRlbmAgZnVuY3Rpb24uXG4gIHZhciBmbGF0dGVuID0gZnVuY3Rpb24oaW5wdXQsIHNoYWxsb3csIHN0cmljdCwgc3RhcnRJbmRleCkge1xuICAgIHZhciBvdXRwdXQgPSBbXSwgaWR4ID0gMDtcbiAgICBmb3IgKHZhciBpID0gc3RhcnRJbmRleCB8fCAwLCBsZW5ndGggPSBnZXRMZW5ndGgoaW5wdXQpOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciB2YWx1ZSA9IGlucHV0W2ldO1xuICAgICAgaWYgKGlzQXJyYXlMaWtlKHZhbHVlKSAmJiAoXy5pc0FycmF5KHZhbHVlKSB8fCBfLmlzQXJndW1lbnRzKHZhbHVlKSkpIHtcbiAgICAgICAgLy9mbGF0dGVuIGN1cnJlbnQgbGV2ZWwgb2YgYXJyYXkgb3IgYXJndW1lbnRzIG9iamVjdFxuICAgICAgICBpZiAoIXNoYWxsb3cpIHZhbHVlID0gZmxhdHRlbih2YWx1ZSwgc2hhbGxvdywgc3RyaWN0KTtcbiAgICAgICAgdmFyIGogPSAwLCBsZW4gPSB2YWx1ZS5sZW5ndGg7XG4gICAgICAgIG91dHB1dC5sZW5ndGggKz0gbGVuO1xuICAgICAgICB3aGlsZSAoaiA8IGxlbikge1xuICAgICAgICAgIG91dHB1dFtpZHgrK10gPSB2YWx1ZVtqKytdO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKCFzdHJpY3QpIHtcbiAgICAgICAgb3V0cHV0W2lkeCsrXSA9IHZhbHVlO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gb3V0cHV0O1xuICB9O1xuXG4gIC8vIEZsYXR0ZW4gb3V0IGFuIGFycmF5LCBlaXRoZXIgcmVjdXJzaXZlbHkgKGJ5IGRlZmF1bHQpLCBvciBqdXN0IG9uZSBsZXZlbC5cbiAgXy5mbGF0dGVuID0gZnVuY3Rpb24oYXJyYXksIHNoYWxsb3cpIHtcbiAgICByZXR1cm4gZmxhdHRlbihhcnJheSwgc2hhbGxvdywgZmFsc2UpO1xuICB9O1xuXG4gIC8vIFJldHVybiBhIHZlcnNpb24gb2YgdGhlIGFycmF5IHRoYXQgZG9lcyBub3QgY29udGFpbiB0aGUgc3BlY2lmaWVkIHZhbHVlKHMpLlxuICBfLndpdGhvdXQgPSBmdW5jdGlvbihhcnJheSkge1xuICAgIHJldHVybiBfLmRpZmZlcmVuY2UoYXJyYXksIHNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSk7XG4gIH07XG5cbiAgLy8gUHJvZHVjZSBhIGR1cGxpY2F0ZS1mcmVlIHZlcnNpb24gb2YgdGhlIGFycmF5LiBJZiB0aGUgYXJyYXkgaGFzIGFscmVhZHlcbiAgLy8gYmVlbiBzb3J0ZWQsIHlvdSBoYXZlIHRoZSBvcHRpb24gb2YgdXNpbmcgYSBmYXN0ZXIgYWxnb3JpdGhtLlxuICAvLyBBbGlhc2VkIGFzIGB1bmlxdWVgLlxuICBfLnVuaXEgPSBfLnVuaXF1ZSA9IGZ1bmN0aW9uKGFycmF5LCBpc1NvcnRlZCwgaXRlcmF0ZWUsIGNvbnRleHQpIHtcbiAgICBpZiAoIV8uaXNCb29sZWFuKGlzU29ydGVkKSkge1xuICAgICAgY29udGV4dCA9IGl0ZXJhdGVlO1xuICAgICAgaXRlcmF0ZWUgPSBpc1NvcnRlZDtcbiAgICAgIGlzU29ydGVkID0gZmFsc2U7XG4gICAgfVxuICAgIGlmIChpdGVyYXRlZSAhPSBudWxsKSBpdGVyYXRlZSA9IGNiKGl0ZXJhdGVlLCBjb250ZXh0KTtcbiAgICB2YXIgcmVzdWx0ID0gW107XG4gICAgdmFyIHNlZW4gPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMCwgbGVuZ3RoID0gZ2V0TGVuZ3RoKGFycmF5KTsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgdmFsdWUgPSBhcnJheVtpXSxcbiAgICAgICAgICBjb21wdXRlZCA9IGl0ZXJhdGVlID8gaXRlcmF0ZWUodmFsdWUsIGksIGFycmF5KSA6IHZhbHVlO1xuICAgICAgaWYgKGlzU29ydGVkKSB7XG4gICAgICAgIGlmICghaSB8fCBzZWVuICE9PSBjb21wdXRlZCkgcmVzdWx0LnB1c2godmFsdWUpO1xuICAgICAgICBzZWVuID0gY29tcHV0ZWQ7XG4gICAgICB9IGVsc2UgaWYgKGl0ZXJhdGVlKSB7XG4gICAgICAgIGlmICghXy5jb250YWlucyhzZWVuLCBjb21wdXRlZCkpIHtcbiAgICAgICAgICBzZWVuLnB1c2goY29tcHV0ZWQpO1xuICAgICAgICAgIHJlc3VsdC5wdXNoKHZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmICghXy5jb250YWlucyhyZXN1bHQsIHZhbHVlKSkge1xuICAgICAgICByZXN1bHQucHVzaCh2YWx1ZSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG5cbiAgLy8gUHJvZHVjZSBhbiBhcnJheSB0aGF0IGNvbnRhaW5zIHRoZSB1bmlvbjogZWFjaCBkaXN0aW5jdCBlbGVtZW50IGZyb20gYWxsIG9mXG4gIC8vIHRoZSBwYXNzZWQtaW4gYXJyYXlzLlxuICBfLnVuaW9uID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIF8udW5pcShmbGF0dGVuKGFyZ3VtZW50cywgdHJ1ZSwgdHJ1ZSkpO1xuICB9O1xuXG4gIC8vIFByb2R1Y2UgYW4gYXJyYXkgdGhhdCBjb250YWlucyBldmVyeSBpdGVtIHNoYXJlZCBiZXR3ZWVuIGFsbCB0aGVcbiAgLy8gcGFzc2VkLWluIGFycmF5cy5cbiAgXy5pbnRlcnNlY3Rpb24gPSBmdW5jdGlvbihhcnJheSkge1xuICAgIHZhciByZXN1bHQgPSBbXTtcbiAgICB2YXIgYXJnc0xlbmd0aCA9IGFyZ3VtZW50cy5sZW5ndGg7XG4gICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IGdldExlbmd0aChhcnJheSk7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgdmFyIGl0ZW0gPSBhcnJheVtpXTtcbiAgICAgIGlmIChfLmNvbnRhaW5zKHJlc3VsdCwgaXRlbSkpIGNvbnRpbnVlO1xuICAgICAgZm9yICh2YXIgaiA9IDE7IGogPCBhcmdzTGVuZ3RoOyBqKyspIHtcbiAgICAgICAgaWYgKCFfLmNvbnRhaW5zKGFyZ3VtZW50c1tqXSwgaXRlbSkpIGJyZWFrO1xuICAgICAgfVxuICAgICAgaWYgKGogPT09IGFyZ3NMZW5ndGgpIHJlc3VsdC5wdXNoKGl0ZW0pO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuXG4gIC8vIFRha2UgdGhlIGRpZmZlcmVuY2UgYmV0d2VlbiBvbmUgYXJyYXkgYW5kIGEgbnVtYmVyIG9mIG90aGVyIGFycmF5cy5cbiAgLy8gT25seSB0aGUgZWxlbWVudHMgcHJlc2VudCBpbiBqdXN0IHRoZSBmaXJzdCBhcnJheSB3aWxsIHJlbWFpbi5cbiAgXy5kaWZmZXJlbmNlID0gZnVuY3Rpb24oYXJyYXkpIHtcbiAgICB2YXIgcmVzdCA9IGZsYXR0ZW4oYXJndW1lbnRzLCB0cnVlLCB0cnVlLCAxKTtcbiAgICByZXR1cm4gXy5maWx0ZXIoYXJyYXksIGZ1bmN0aW9uKHZhbHVlKXtcbiAgICAgIHJldHVybiAhXy5jb250YWlucyhyZXN0LCB2YWx1ZSk7XG4gICAgfSk7XG4gIH07XG5cbiAgLy8gWmlwIHRvZ2V0aGVyIG11bHRpcGxlIGxpc3RzIGludG8gYSBzaW5nbGUgYXJyYXkgLS0gZWxlbWVudHMgdGhhdCBzaGFyZVxuICAvLyBhbiBpbmRleCBnbyB0b2dldGhlci5cbiAgXy56aXAgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gXy51bnppcChhcmd1bWVudHMpO1xuICB9O1xuXG4gIC8vIENvbXBsZW1lbnQgb2YgXy56aXAuIFVuemlwIGFjY2VwdHMgYW4gYXJyYXkgb2YgYXJyYXlzIGFuZCBncm91cHNcbiAgLy8gZWFjaCBhcnJheSdzIGVsZW1lbnRzIG9uIHNoYXJlZCBpbmRpY2VzXG4gIF8udW56aXAgPSBmdW5jdGlvbihhcnJheSkge1xuICAgIHZhciBsZW5ndGggPSBhcnJheSAmJiBfLm1heChhcnJheSwgZ2V0TGVuZ3RoKS5sZW5ndGggfHwgMDtcbiAgICB2YXIgcmVzdWx0ID0gQXJyYXkobGVuZ3RoKTtcblxuICAgIGZvciAodmFyIGluZGV4ID0gMDsgaW5kZXggPCBsZW5ndGg7IGluZGV4KyspIHtcbiAgICAgIHJlc3VsdFtpbmRleF0gPSBfLnBsdWNrKGFycmF5LCBpbmRleCk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG5cbiAgLy8gQ29udmVydHMgbGlzdHMgaW50byBvYmplY3RzLiBQYXNzIGVpdGhlciBhIHNpbmdsZSBhcnJheSBvZiBgW2tleSwgdmFsdWVdYFxuICAvLyBwYWlycywgb3IgdHdvIHBhcmFsbGVsIGFycmF5cyBvZiB0aGUgc2FtZSBsZW5ndGggLS0gb25lIG9mIGtleXMsIGFuZCBvbmUgb2ZcbiAgLy8gdGhlIGNvcnJlc3BvbmRpbmcgdmFsdWVzLlxuICBfLm9iamVjdCA9IGZ1bmN0aW9uKGxpc3QsIHZhbHVlcykge1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBmb3IgKHZhciBpID0gMCwgbGVuZ3RoID0gZ2V0TGVuZ3RoKGxpc3QpOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmICh2YWx1ZXMpIHtcbiAgICAgICAgcmVzdWx0W2xpc3RbaV1dID0gdmFsdWVzW2ldO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVzdWx0W2xpc3RbaV1bMF1dID0gbGlzdFtpXVsxXTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcblxuICAvLyBHZW5lcmF0b3IgZnVuY3Rpb24gdG8gY3JlYXRlIHRoZSBmaW5kSW5kZXggYW5kIGZpbmRMYXN0SW5kZXggZnVuY3Rpb25zXG4gIGZ1bmN0aW9uIGNyZWF0ZVByZWRpY2F0ZUluZGV4RmluZGVyKGRpcikge1xuICAgIHJldHVybiBmdW5jdGlvbihhcnJheSwgcHJlZGljYXRlLCBjb250ZXh0KSB7XG4gICAgICBwcmVkaWNhdGUgPSBjYihwcmVkaWNhdGUsIGNvbnRleHQpO1xuICAgICAgdmFyIGxlbmd0aCA9IGdldExlbmd0aChhcnJheSk7XG4gICAgICB2YXIgaW5kZXggPSBkaXIgPiAwID8gMCA6IGxlbmd0aCAtIDE7XG4gICAgICBmb3IgKDsgaW5kZXggPj0gMCAmJiBpbmRleCA8IGxlbmd0aDsgaW5kZXggKz0gZGlyKSB7XG4gICAgICAgIGlmIChwcmVkaWNhdGUoYXJyYXlbaW5kZXhdLCBpbmRleCwgYXJyYXkpKSByZXR1cm4gaW5kZXg7XG4gICAgICB9XG4gICAgICByZXR1cm4gLTE7XG4gICAgfTtcbiAgfVxuXG4gIC8vIFJldHVybnMgdGhlIGZpcnN0IGluZGV4IG9uIGFuIGFycmF5LWxpa2UgdGhhdCBwYXNzZXMgYSBwcmVkaWNhdGUgdGVzdFxuICBfLmZpbmRJbmRleCA9IGNyZWF0ZVByZWRpY2F0ZUluZGV4RmluZGVyKDEpO1xuICBfLmZpbmRMYXN0SW5kZXggPSBjcmVhdGVQcmVkaWNhdGVJbmRleEZpbmRlcigtMSk7XG5cbiAgLy8gVXNlIGEgY29tcGFyYXRvciBmdW5jdGlvbiB0byBmaWd1cmUgb3V0IHRoZSBzbWFsbGVzdCBpbmRleCBhdCB3aGljaFxuICAvLyBhbiBvYmplY3Qgc2hvdWxkIGJlIGluc2VydGVkIHNvIGFzIHRvIG1haW50YWluIG9yZGVyLiBVc2VzIGJpbmFyeSBzZWFyY2guXG4gIF8uc29ydGVkSW5kZXggPSBmdW5jdGlvbihhcnJheSwgb2JqLCBpdGVyYXRlZSwgY29udGV4dCkge1xuICAgIGl0ZXJhdGVlID0gY2IoaXRlcmF0ZWUsIGNvbnRleHQsIDEpO1xuICAgIHZhciB2YWx1ZSA9IGl0ZXJhdGVlKG9iaik7XG4gICAgdmFyIGxvdyA9IDAsIGhpZ2ggPSBnZXRMZW5ndGgoYXJyYXkpO1xuICAgIHdoaWxlIChsb3cgPCBoaWdoKSB7XG4gICAgICB2YXIgbWlkID0gTWF0aC5mbG9vcigobG93ICsgaGlnaCkgLyAyKTtcbiAgICAgIGlmIChpdGVyYXRlZShhcnJheVttaWRdKSA8IHZhbHVlKSBsb3cgPSBtaWQgKyAxOyBlbHNlIGhpZ2ggPSBtaWQ7XG4gICAgfVxuICAgIHJldHVybiBsb3c7XG4gIH07XG5cbiAgLy8gR2VuZXJhdG9yIGZ1bmN0aW9uIHRvIGNyZWF0ZSB0aGUgaW5kZXhPZiBhbmQgbGFzdEluZGV4T2YgZnVuY3Rpb25zXG4gIGZ1bmN0aW9uIGNyZWF0ZUluZGV4RmluZGVyKGRpciwgcHJlZGljYXRlRmluZCwgc29ydGVkSW5kZXgpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24oYXJyYXksIGl0ZW0sIGlkeCkge1xuICAgICAgdmFyIGkgPSAwLCBsZW5ndGggPSBnZXRMZW5ndGgoYXJyYXkpO1xuICAgICAgaWYgKHR5cGVvZiBpZHggPT0gJ251bWJlcicpIHtcbiAgICAgICAgaWYgKGRpciA+IDApIHtcbiAgICAgICAgICAgIGkgPSBpZHggPj0gMCA/IGlkeCA6IE1hdGgubWF4KGlkeCArIGxlbmd0aCwgaSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBsZW5ndGggPSBpZHggPj0gMCA/IE1hdGgubWluKGlkeCArIDEsIGxlbmd0aCkgOiBpZHggKyBsZW5ndGggKyAxO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKHNvcnRlZEluZGV4ICYmIGlkeCAmJiBsZW5ndGgpIHtcbiAgICAgICAgaWR4ID0gc29ydGVkSW5kZXgoYXJyYXksIGl0ZW0pO1xuICAgICAgICByZXR1cm4gYXJyYXlbaWR4XSA9PT0gaXRlbSA/IGlkeCA6IC0xO1xuICAgICAgfVxuICAgICAgaWYgKGl0ZW0gIT09IGl0ZW0pIHtcbiAgICAgICAgaWR4ID0gcHJlZGljYXRlRmluZChzbGljZS5jYWxsKGFycmF5LCBpLCBsZW5ndGgpLCBfLmlzTmFOKTtcbiAgICAgICAgcmV0dXJuIGlkeCA+PSAwID8gaWR4ICsgaSA6IC0xO1xuICAgICAgfVxuICAgICAgZm9yIChpZHggPSBkaXIgPiAwID8gaSA6IGxlbmd0aCAtIDE7IGlkeCA+PSAwICYmIGlkeCA8IGxlbmd0aDsgaWR4ICs9IGRpcikge1xuICAgICAgICBpZiAoYXJyYXlbaWR4XSA9PT0gaXRlbSkgcmV0dXJuIGlkeDtcbiAgICAgIH1cbiAgICAgIHJldHVybiAtMTtcbiAgICB9O1xuICB9XG5cbiAgLy8gUmV0dXJuIHRoZSBwb3NpdGlvbiBvZiB0aGUgZmlyc3Qgb2NjdXJyZW5jZSBvZiBhbiBpdGVtIGluIGFuIGFycmF5LFxuICAvLyBvciAtMSBpZiB0aGUgaXRlbSBpcyBub3QgaW5jbHVkZWQgaW4gdGhlIGFycmF5LlxuICAvLyBJZiB0aGUgYXJyYXkgaXMgbGFyZ2UgYW5kIGFscmVhZHkgaW4gc29ydCBvcmRlciwgcGFzcyBgdHJ1ZWBcbiAgLy8gZm9yICoqaXNTb3J0ZWQqKiB0byB1c2UgYmluYXJ5IHNlYXJjaC5cbiAgXy5pbmRleE9mID0gY3JlYXRlSW5kZXhGaW5kZXIoMSwgXy5maW5kSW5kZXgsIF8uc29ydGVkSW5kZXgpO1xuICBfLmxhc3RJbmRleE9mID0gY3JlYXRlSW5kZXhGaW5kZXIoLTEsIF8uZmluZExhc3RJbmRleCk7XG5cbiAgLy8gR2VuZXJhdGUgYW4gaW50ZWdlciBBcnJheSBjb250YWluaW5nIGFuIGFyaXRobWV0aWMgcHJvZ3Jlc3Npb24uIEEgcG9ydCBvZlxuICAvLyB0aGUgbmF0aXZlIFB5dGhvbiBgcmFuZ2UoKWAgZnVuY3Rpb24uIFNlZVxuICAvLyBbdGhlIFB5dGhvbiBkb2N1bWVudGF0aW9uXShodHRwOi8vZG9jcy5weXRob24ub3JnL2xpYnJhcnkvZnVuY3Rpb25zLmh0bWwjcmFuZ2UpLlxuICBfLnJhbmdlID0gZnVuY3Rpb24oc3RhcnQsIHN0b3AsIHN0ZXApIHtcbiAgICBpZiAoc3RvcCA9PSBudWxsKSB7XG4gICAgICBzdG9wID0gc3RhcnQgfHwgMDtcbiAgICAgIHN0YXJ0ID0gMDtcbiAgICB9XG4gICAgc3RlcCA9IHN0ZXAgfHwgMTtcblxuICAgIHZhciBsZW5ndGggPSBNYXRoLm1heChNYXRoLmNlaWwoKHN0b3AgLSBzdGFydCkgLyBzdGVwKSwgMCk7XG4gICAgdmFyIHJhbmdlID0gQXJyYXkobGVuZ3RoKTtcblxuICAgIGZvciAodmFyIGlkeCA9IDA7IGlkeCA8IGxlbmd0aDsgaWR4KyssIHN0YXJ0ICs9IHN0ZXApIHtcbiAgICAgIHJhbmdlW2lkeF0gPSBzdGFydDtcbiAgICB9XG5cbiAgICByZXR1cm4gcmFuZ2U7XG4gIH07XG5cbiAgLy8gRnVuY3Rpb24gKGFoZW0pIEZ1bmN0aW9uc1xuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS1cblxuICAvLyBEZXRlcm1pbmVzIHdoZXRoZXIgdG8gZXhlY3V0ZSBhIGZ1bmN0aW9uIGFzIGEgY29uc3RydWN0b3JcbiAgLy8gb3IgYSBub3JtYWwgZnVuY3Rpb24gd2l0aCB0aGUgcHJvdmlkZWQgYXJndW1lbnRzXG4gIHZhciBleGVjdXRlQm91bmQgPSBmdW5jdGlvbihzb3VyY2VGdW5jLCBib3VuZEZ1bmMsIGNvbnRleHQsIGNhbGxpbmdDb250ZXh0LCBhcmdzKSB7XG4gICAgaWYgKCEoY2FsbGluZ0NvbnRleHQgaW5zdGFuY2VvZiBib3VuZEZ1bmMpKSByZXR1cm4gc291cmNlRnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTtcbiAgICB2YXIgc2VsZiA9IGJhc2VDcmVhdGUoc291cmNlRnVuYy5wcm90b3R5cGUpO1xuICAgIHZhciByZXN1bHQgPSBzb3VyY2VGdW5jLmFwcGx5KHNlbGYsIGFyZ3MpO1xuICAgIGlmIChfLmlzT2JqZWN0KHJlc3VsdCkpIHJldHVybiByZXN1bHQ7XG4gICAgcmV0dXJuIHNlbGY7XG4gIH07XG5cbiAgLy8gQ3JlYXRlIGEgZnVuY3Rpb24gYm91bmQgdG8gYSBnaXZlbiBvYmplY3QgKGFzc2lnbmluZyBgdGhpc2AsIGFuZCBhcmd1bWVudHMsXG4gIC8vIG9wdGlvbmFsbHkpLiBEZWxlZ2F0ZXMgdG8gKipFQ01BU2NyaXB0IDUqKidzIG5hdGl2ZSBgRnVuY3Rpb24uYmluZGAgaWZcbiAgLy8gYXZhaWxhYmxlLlxuICBfLmJpbmQgPSBmdW5jdGlvbihmdW5jLCBjb250ZXh0KSB7XG4gICAgaWYgKG5hdGl2ZUJpbmQgJiYgZnVuYy5iaW5kID09PSBuYXRpdmVCaW5kKSByZXR1cm4gbmF0aXZlQmluZC5hcHBseShmdW5jLCBzbGljZS5jYWxsKGFyZ3VtZW50cywgMSkpO1xuICAgIGlmICghXy5pc0Z1bmN0aW9uKGZ1bmMpKSB0aHJvdyBuZXcgVHlwZUVycm9yKCdCaW5kIG11c3QgYmUgY2FsbGVkIG9uIGEgZnVuY3Rpb24nKTtcbiAgICB2YXIgYXJncyA9IHNsaWNlLmNhbGwoYXJndW1lbnRzLCAyKTtcbiAgICB2YXIgYm91bmQgPSBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBleGVjdXRlQm91bmQoZnVuYywgYm91bmQsIGNvbnRleHQsIHRoaXMsIGFyZ3MuY29uY2F0KHNsaWNlLmNhbGwoYXJndW1lbnRzKSkpO1xuICAgIH07XG4gICAgcmV0dXJuIGJvdW5kO1xuICB9O1xuXG4gIC8vIFBhcnRpYWxseSBhcHBseSBhIGZ1bmN0aW9uIGJ5IGNyZWF0aW5nIGEgdmVyc2lvbiB0aGF0IGhhcyBoYWQgc29tZSBvZiBpdHNcbiAgLy8gYXJndW1lbnRzIHByZS1maWxsZWQsIHdpdGhvdXQgY2hhbmdpbmcgaXRzIGR5bmFtaWMgYHRoaXNgIGNvbnRleHQuIF8gYWN0c1xuICAvLyBhcyBhIHBsYWNlaG9sZGVyLCBhbGxvd2luZyBhbnkgY29tYmluYXRpb24gb2YgYXJndW1lbnRzIHRvIGJlIHByZS1maWxsZWQuXG4gIF8ucGFydGlhbCA9IGZ1bmN0aW9uKGZ1bmMpIHtcbiAgICB2YXIgYm91bmRBcmdzID0gc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpO1xuICAgIHZhciBib3VuZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIHBvc2l0aW9uID0gMCwgbGVuZ3RoID0gYm91bmRBcmdzLmxlbmd0aDtcbiAgICAgIHZhciBhcmdzID0gQXJyYXkobGVuZ3RoKTtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgICAgYXJnc1tpXSA9IGJvdW5kQXJnc1tpXSA9PT0gXyA/IGFyZ3VtZW50c1twb3NpdGlvbisrXSA6IGJvdW5kQXJnc1tpXTtcbiAgICAgIH1cbiAgICAgIHdoaWxlIChwb3NpdGlvbiA8IGFyZ3VtZW50cy5sZW5ndGgpIGFyZ3MucHVzaChhcmd1bWVudHNbcG9zaXRpb24rK10pO1xuICAgICAgcmV0dXJuIGV4ZWN1dGVCb3VuZChmdW5jLCBib3VuZCwgdGhpcywgdGhpcywgYXJncyk7XG4gICAgfTtcbiAgICByZXR1cm4gYm91bmQ7XG4gIH07XG5cbiAgLy8gQmluZCBhIG51bWJlciBvZiBhbiBvYmplY3QncyBtZXRob2RzIHRvIHRoYXQgb2JqZWN0LiBSZW1haW5pbmcgYXJndW1lbnRzXG4gIC8vIGFyZSB0aGUgbWV0aG9kIG5hbWVzIHRvIGJlIGJvdW5kLiBVc2VmdWwgZm9yIGVuc3VyaW5nIHRoYXQgYWxsIGNhbGxiYWNrc1xuICAvLyBkZWZpbmVkIG9uIGFuIG9iamVjdCBiZWxvbmcgdG8gaXQuXG4gIF8uYmluZEFsbCA9IGZ1bmN0aW9uKG9iaikge1xuICAgIHZhciBpLCBsZW5ndGggPSBhcmd1bWVudHMubGVuZ3RoLCBrZXk7XG4gICAgaWYgKGxlbmd0aCA8PSAxKSB0aHJvdyBuZXcgRXJyb3IoJ2JpbmRBbGwgbXVzdCBiZSBwYXNzZWQgZnVuY3Rpb24gbmFtZXMnKTtcbiAgICBmb3IgKGkgPSAxOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgIGtleSA9IGFyZ3VtZW50c1tpXTtcbiAgICAgIG9ialtrZXldID0gXy5iaW5kKG9ialtrZXldLCBvYmopO1xuICAgIH1cbiAgICByZXR1cm4gb2JqO1xuICB9O1xuXG4gIC8vIE1lbW9pemUgYW4gZXhwZW5zaXZlIGZ1bmN0aW9uIGJ5IHN0b3JpbmcgaXRzIHJlc3VsdHMuXG4gIF8ubWVtb2l6ZSA9IGZ1bmN0aW9uKGZ1bmMsIGhhc2hlcikge1xuICAgIHZhciBtZW1vaXplID0gZnVuY3Rpb24oa2V5KSB7XG4gICAgICB2YXIgY2FjaGUgPSBtZW1vaXplLmNhY2hlO1xuICAgICAgdmFyIGFkZHJlc3MgPSAnJyArIChoYXNoZXIgPyBoYXNoZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSA6IGtleSk7XG4gICAgICBpZiAoIV8uaGFzKGNhY2hlLCBhZGRyZXNzKSkgY2FjaGVbYWRkcmVzc10gPSBmdW5jLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICByZXR1cm4gY2FjaGVbYWRkcmVzc107XG4gICAgfTtcbiAgICBtZW1vaXplLmNhY2hlID0ge307XG4gICAgcmV0dXJuIG1lbW9pemU7XG4gIH07XG5cbiAgLy8gRGVsYXlzIGEgZnVuY3Rpb24gZm9yIHRoZSBnaXZlbiBudW1iZXIgb2YgbWlsbGlzZWNvbmRzLCBhbmQgdGhlbiBjYWxsc1xuICAvLyBpdCB3aXRoIHRoZSBhcmd1bWVudHMgc3VwcGxpZWQuXG4gIF8uZGVsYXkgPSBmdW5jdGlvbihmdW5jLCB3YWl0KSB7XG4gICAgdmFyIGFyZ3MgPSBzbGljZS5jYWxsKGFyZ3VtZW50cywgMik7XG4gICAgcmV0dXJuIHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgIHJldHVybiBmdW5jLmFwcGx5KG51bGwsIGFyZ3MpO1xuICAgIH0sIHdhaXQpO1xuICB9O1xuXG4gIC8vIERlZmVycyBhIGZ1bmN0aW9uLCBzY2hlZHVsaW5nIGl0IHRvIHJ1biBhZnRlciB0aGUgY3VycmVudCBjYWxsIHN0YWNrIGhhc1xuICAvLyBjbGVhcmVkLlxuICBfLmRlZmVyID0gXy5wYXJ0aWFsKF8uZGVsYXksIF8sIDEpO1xuXG4gIC8vIFJldHVybnMgYSBmdW5jdGlvbiwgdGhhdCwgd2hlbiBpbnZva2VkLCB3aWxsIG9ubHkgYmUgdHJpZ2dlcmVkIGF0IG1vc3Qgb25jZVxuICAvLyBkdXJpbmcgYSBnaXZlbiB3aW5kb3cgb2YgdGltZS4gTm9ybWFsbHksIHRoZSB0aHJvdHRsZWQgZnVuY3Rpb24gd2lsbCBydW5cbiAgLy8gYXMgbXVjaCBhcyBpdCBjYW4sIHdpdGhvdXQgZXZlciBnb2luZyBtb3JlIHRoYW4gb25jZSBwZXIgYHdhaXRgIGR1cmF0aW9uO1xuICAvLyBidXQgaWYgeW91J2QgbGlrZSB0byBkaXNhYmxlIHRoZSBleGVjdXRpb24gb24gdGhlIGxlYWRpbmcgZWRnZSwgcGFzc1xuICAvLyBge2xlYWRpbmc6IGZhbHNlfWAuIFRvIGRpc2FibGUgZXhlY3V0aW9uIG9uIHRoZSB0cmFpbGluZyBlZGdlLCBkaXR0by5cbiAgXy50aHJvdHRsZSA9IGZ1bmN0aW9uKGZ1bmMsIHdhaXQsIG9wdGlvbnMpIHtcbiAgICB2YXIgY29udGV4dCwgYXJncywgcmVzdWx0O1xuICAgIHZhciB0aW1lb3V0ID0gbnVsbDtcbiAgICB2YXIgcHJldmlvdXMgPSAwO1xuICAgIGlmICghb3B0aW9ucykgb3B0aW9ucyA9IHt9O1xuICAgIHZhciBsYXRlciA9IGZ1bmN0aW9uKCkge1xuICAgICAgcHJldmlvdXMgPSBvcHRpb25zLmxlYWRpbmcgPT09IGZhbHNlID8gMCA6IF8ubm93KCk7XG4gICAgICB0aW1lb3V0ID0gbnVsbDtcbiAgICAgIHJlc3VsdCA9IGZ1bmMuYXBwbHkoY29udGV4dCwgYXJncyk7XG4gICAgICBpZiAoIXRpbWVvdXQpIGNvbnRleHQgPSBhcmdzID0gbnVsbDtcbiAgICB9O1xuICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBub3cgPSBfLm5vdygpO1xuICAgICAgaWYgKCFwcmV2aW91cyAmJiBvcHRpb25zLmxlYWRpbmcgPT09IGZhbHNlKSBwcmV2aW91cyA9IG5vdztcbiAgICAgIHZhciByZW1haW5pbmcgPSB3YWl0IC0gKG5vdyAtIHByZXZpb3VzKTtcbiAgICAgIGNvbnRleHQgPSB0aGlzO1xuICAgICAgYXJncyA9IGFyZ3VtZW50cztcbiAgICAgIGlmIChyZW1haW5pbmcgPD0gMCB8fCByZW1haW5pbmcgPiB3YWl0KSB7XG4gICAgICAgIGlmICh0aW1lb3V0KSB7XG4gICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXQpO1xuICAgICAgICAgIHRpbWVvdXQgPSBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHByZXZpb3VzID0gbm93O1xuICAgICAgICByZXN1bHQgPSBmdW5jLmFwcGx5KGNvbnRleHQsIGFyZ3MpO1xuICAgICAgICBpZiAoIXRpbWVvdXQpIGNvbnRleHQgPSBhcmdzID0gbnVsbDtcbiAgICAgIH0gZWxzZSBpZiAoIXRpbWVvdXQgJiYgb3B0aW9ucy50cmFpbGluZyAhPT0gZmFsc2UpIHtcbiAgICAgICAgdGltZW91dCA9IHNldFRpbWVvdXQobGF0ZXIsIHJlbWFpbmluZyk7XG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH07XG4gIH07XG5cbiAgLy8gUmV0dXJucyBhIGZ1bmN0aW9uLCB0aGF0LCBhcyBsb25nIGFzIGl0IGNvbnRpbnVlcyB0byBiZSBpbnZva2VkLCB3aWxsIG5vdFxuICAvLyBiZSB0cmlnZ2VyZWQuIFRoZSBmdW5jdGlvbiB3aWxsIGJlIGNhbGxlZCBhZnRlciBpdCBzdG9wcyBiZWluZyBjYWxsZWQgZm9yXG4gIC8vIE4gbWlsbGlzZWNvbmRzLiBJZiBgaW1tZWRpYXRlYCBpcyBwYXNzZWQsIHRyaWdnZXIgdGhlIGZ1bmN0aW9uIG9uIHRoZVxuICAvLyBsZWFkaW5nIGVkZ2UsIGluc3RlYWQgb2YgdGhlIHRyYWlsaW5nLlxuICBfLmRlYm91bmNlID0gZnVuY3Rpb24oZnVuYywgd2FpdCwgaW1tZWRpYXRlKSB7XG4gICAgdmFyIHRpbWVvdXQsIGFyZ3MsIGNvbnRleHQsIHRpbWVzdGFtcCwgcmVzdWx0O1xuXG4gICAgdmFyIGxhdGVyID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgbGFzdCA9IF8ubm93KCkgLSB0aW1lc3RhbXA7XG5cbiAgICAgIGlmIChsYXN0IDwgd2FpdCAmJiBsYXN0ID49IDApIHtcbiAgICAgICAgdGltZW91dCA9IHNldFRpbWVvdXQobGF0ZXIsIHdhaXQgLSBsYXN0KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRpbWVvdXQgPSBudWxsO1xuICAgICAgICBpZiAoIWltbWVkaWF0ZSkge1xuICAgICAgICAgIHJlc3VsdCA9IGZ1bmMuYXBwbHkoY29udGV4dCwgYXJncyk7XG4gICAgICAgICAgaWYgKCF0aW1lb3V0KSBjb250ZXh0ID0gYXJncyA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuXG4gICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgY29udGV4dCA9IHRoaXM7XG4gICAgICBhcmdzID0gYXJndW1lbnRzO1xuICAgICAgdGltZXN0YW1wID0gXy5ub3coKTtcbiAgICAgIHZhciBjYWxsTm93ID0gaW1tZWRpYXRlICYmICF0aW1lb3V0O1xuICAgICAgaWYgKCF0aW1lb3V0KSB0aW1lb3V0ID0gc2V0VGltZW91dChsYXRlciwgd2FpdCk7XG4gICAgICBpZiAoY2FsbE5vdykge1xuICAgICAgICByZXN1bHQgPSBmdW5jLmFwcGx5KGNvbnRleHQsIGFyZ3MpO1xuICAgICAgICBjb250ZXh0ID0gYXJncyA9IG51bGw7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfTtcbiAgfTtcblxuICAvLyBSZXR1cm5zIHRoZSBmaXJzdCBmdW5jdGlvbiBwYXNzZWQgYXMgYW4gYXJndW1lbnQgdG8gdGhlIHNlY29uZCxcbiAgLy8gYWxsb3dpbmcgeW91IHRvIGFkanVzdCBhcmd1bWVudHMsIHJ1biBjb2RlIGJlZm9yZSBhbmQgYWZ0ZXIsIGFuZFxuICAvLyBjb25kaXRpb25hbGx5IGV4ZWN1dGUgdGhlIG9yaWdpbmFsIGZ1bmN0aW9uLlxuICBfLndyYXAgPSBmdW5jdGlvbihmdW5jLCB3cmFwcGVyKSB7XG4gICAgcmV0dXJuIF8ucGFydGlhbCh3cmFwcGVyLCBmdW5jKTtcbiAgfTtcblxuICAvLyBSZXR1cm5zIGEgbmVnYXRlZCB2ZXJzaW9uIG9mIHRoZSBwYXNzZWQtaW4gcHJlZGljYXRlLlxuICBfLm5lZ2F0ZSA9IGZ1bmN0aW9uKHByZWRpY2F0ZSkge1xuICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiAhcHJlZGljYXRlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgfTtcbiAgfTtcblxuICAvLyBSZXR1cm5zIGEgZnVuY3Rpb24gdGhhdCBpcyB0aGUgY29tcG9zaXRpb24gb2YgYSBsaXN0IG9mIGZ1bmN0aW9ucywgZWFjaFxuICAvLyBjb25zdW1pbmcgdGhlIHJldHVybiB2YWx1ZSBvZiB0aGUgZnVuY3Rpb24gdGhhdCBmb2xsb3dzLlxuICBfLmNvbXBvc2UgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgYXJncyA9IGFyZ3VtZW50cztcbiAgICB2YXIgc3RhcnQgPSBhcmdzLmxlbmd0aCAtIDE7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGkgPSBzdGFydDtcbiAgICAgIHZhciByZXN1bHQgPSBhcmdzW3N0YXJ0XS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgd2hpbGUgKGktLSkgcmVzdWx0ID0gYXJnc1tpXS5jYWxsKHRoaXMsIHJlc3VsdCk7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH07XG4gIH07XG5cbiAgLy8gUmV0dXJucyBhIGZ1bmN0aW9uIHRoYXQgd2lsbCBvbmx5IGJlIGV4ZWN1dGVkIG9uIGFuZCBhZnRlciB0aGUgTnRoIGNhbGwuXG4gIF8uYWZ0ZXIgPSBmdW5jdGlvbih0aW1lcywgZnVuYykge1xuICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgIGlmICgtLXRpbWVzIDwgMSkge1xuICAgICAgICByZXR1cm4gZnVuYy5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgfVxuICAgIH07XG4gIH07XG5cbiAgLy8gUmV0dXJucyBhIGZ1bmN0aW9uIHRoYXQgd2lsbCBvbmx5IGJlIGV4ZWN1dGVkIHVwIHRvIChidXQgbm90IGluY2x1ZGluZykgdGhlIE50aCBjYWxsLlxuICBfLmJlZm9yZSA9IGZ1bmN0aW9uKHRpbWVzLCBmdW5jKSB7XG4gICAgdmFyIG1lbW87XG4gICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgaWYgKC0tdGltZXMgPiAwKSB7XG4gICAgICAgIG1lbW8gPSBmdW5jLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICB9XG4gICAgICBpZiAodGltZXMgPD0gMSkgZnVuYyA9IG51bGw7XG4gICAgICByZXR1cm4gbWVtbztcbiAgICB9O1xuICB9O1xuXG4gIC8vIFJldHVybnMgYSBmdW5jdGlvbiB0aGF0IHdpbGwgYmUgZXhlY3V0ZWQgYXQgbW9zdCBvbmUgdGltZSwgbm8gbWF0dGVyIGhvd1xuICAvLyBvZnRlbiB5b3UgY2FsbCBpdC4gVXNlZnVsIGZvciBsYXp5IGluaXRpYWxpemF0aW9uLlxuICBfLm9uY2UgPSBfLnBhcnRpYWwoXy5iZWZvcmUsIDIpO1xuXG4gIC8vIE9iamVjdCBGdW5jdGlvbnNcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLVxuXG4gIC8vIEtleXMgaW4gSUUgPCA5IHRoYXQgd29uJ3QgYmUgaXRlcmF0ZWQgYnkgYGZvciBrZXkgaW4gLi4uYCBhbmQgdGh1cyBtaXNzZWQuXG4gIHZhciBoYXNFbnVtQnVnID0gIXt0b1N0cmluZzogbnVsbH0ucHJvcGVydHlJc0VudW1lcmFibGUoJ3RvU3RyaW5nJyk7XG4gIHZhciBub25FbnVtZXJhYmxlUHJvcHMgPSBbJ3ZhbHVlT2YnLCAnaXNQcm90b3R5cGVPZicsICd0b1N0cmluZycsXG4gICAgICAgICAgICAgICAgICAgICAgJ3Byb3BlcnR5SXNFbnVtZXJhYmxlJywgJ2hhc093blByb3BlcnR5JywgJ3RvTG9jYWxlU3RyaW5nJ107XG5cbiAgZnVuY3Rpb24gY29sbGVjdE5vbkVudW1Qcm9wcyhvYmosIGtleXMpIHtcbiAgICB2YXIgbm9uRW51bUlkeCA9IG5vbkVudW1lcmFibGVQcm9wcy5sZW5ndGg7XG4gICAgdmFyIGNvbnN0cnVjdG9yID0gb2JqLmNvbnN0cnVjdG9yO1xuICAgIHZhciBwcm90byA9IChfLmlzRnVuY3Rpb24oY29uc3RydWN0b3IpICYmIGNvbnN0cnVjdG9yLnByb3RvdHlwZSkgfHwgT2JqUHJvdG87XG5cbiAgICAvLyBDb25zdHJ1Y3RvciBpcyBhIHNwZWNpYWwgY2FzZS5cbiAgICB2YXIgcHJvcCA9ICdjb25zdHJ1Y3Rvcic7XG4gICAgaWYgKF8uaGFzKG9iaiwgcHJvcCkgJiYgIV8uY29udGFpbnMoa2V5cywgcHJvcCkpIGtleXMucHVzaChwcm9wKTtcblxuICAgIHdoaWxlIChub25FbnVtSWR4LS0pIHtcbiAgICAgIHByb3AgPSBub25FbnVtZXJhYmxlUHJvcHNbbm9uRW51bUlkeF07XG4gICAgICBpZiAocHJvcCBpbiBvYmogJiYgb2JqW3Byb3BdICE9PSBwcm90b1twcm9wXSAmJiAhXy5jb250YWlucyhrZXlzLCBwcm9wKSkge1xuICAgICAgICBrZXlzLnB1c2gocHJvcCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy8gUmV0cmlldmUgdGhlIG5hbWVzIG9mIGFuIG9iamVjdCdzIG93biBwcm9wZXJ0aWVzLlxuICAvLyBEZWxlZ2F0ZXMgdG8gKipFQ01BU2NyaXB0IDUqKidzIG5hdGl2ZSBgT2JqZWN0LmtleXNgXG4gIF8ua2V5cyA9IGZ1bmN0aW9uKG9iaikge1xuICAgIGlmICghXy5pc09iamVjdChvYmopKSByZXR1cm4gW107XG4gICAgaWYgKG5hdGl2ZUtleXMpIHJldHVybiBuYXRpdmVLZXlzKG9iaik7XG4gICAgdmFyIGtleXMgPSBbXTtcbiAgICBmb3IgKHZhciBrZXkgaW4gb2JqKSBpZiAoXy5oYXMob2JqLCBrZXkpKSBrZXlzLnB1c2goa2V5KTtcbiAgICAvLyBBaGVtLCBJRSA8IDkuXG4gICAgaWYgKGhhc0VudW1CdWcpIGNvbGxlY3ROb25FbnVtUHJvcHMob2JqLCBrZXlzKTtcbiAgICByZXR1cm4ga2V5cztcbiAgfTtcblxuICAvLyBSZXRyaWV2ZSBhbGwgdGhlIHByb3BlcnR5IG5hbWVzIG9mIGFuIG9iamVjdC5cbiAgXy5hbGxLZXlzID0gZnVuY3Rpb24ob2JqKSB7XG4gICAgaWYgKCFfLmlzT2JqZWN0KG9iaikpIHJldHVybiBbXTtcbiAgICB2YXIga2V5cyA9IFtdO1xuICAgIGZvciAodmFyIGtleSBpbiBvYmopIGtleXMucHVzaChrZXkpO1xuICAgIC8vIEFoZW0sIElFIDwgOS5cbiAgICBpZiAoaGFzRW51bUJ1ZykgY29sbGVjdE5vbkVudW1Qcm9wcyhvYmosIGtleXMpO1xuICAgIHJldHVybiBrZXlzO1xuICB9O1xuXG4gIC8vIFJldHJpZXZlIHRoZSB2YWx1ZXMgb2YgYW4gb2JqZWN0J3MgcHJvcGVydGllcy5cbiAgXy52YWx1ZXMgPSBmdW5jdGlvbihvYmopIHtcbiAgICB2YXIga2V5cyA9IF8ua2V5cyhvYmopO1xuICAgIHZhciBsZW5ndGggPSBrZXlzLmxlbmd0aDtcbiAgICB2YXIgdmFsdWVzID0gQXJyYXkobGVuZ3RoKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICB2YWx1ZXNbaV0gPSBvYmpba2V5c1tpXV07XG4gICAgfVxuICAgIHJldHVybiB2YWx1ZXM7XG4gIH07XG5cbiAgLy8gUmV0dXJucyB0aGUgcmVzdWx0cyBvZiBhcHBseWluZyB0aGUgaXRlcmF0ZWUgdG8gZWFjaCBlbGVtZW50IG9mIHRoZSBvYmplY3RcbiAgLy8gSW4gY29udHJhc3QgdG8gXy5tYXAgaXQgcmV0dXJucyBhbiBvYmplY3RcbiAgXy5tYXBPYmplY3QgPSBmdW5jdGlvbihvYmosIGl0ZXJhdGVlLCBjb250ZXh0KSB7XG4gICAgaXRlcmF0ZWUgPSBjYihpdGVyYXRlZSwgY29udGV4dCk7XG4gICAgdmFyIGtleXMgPSAgXy5rZXlzKG9iaiksXG4gICAgICAgICAgbGVuZ3RoID0ga2V5cy5sZW5ndGgsXG4gICAgICAgICAgcmVzdWx0cyA9IHt9LFxuICAgICAgICAgIGN1cnJlbnRLZXk7XG4gICAgICBmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4IDwgbGVuZ3RoOyBpbmRleCsrKSB7XG4gICAgICAgIGN1cnJlbnRLZXkgPSBrZXlzW2luZGV4XTtcbiAgICAgICAgcmVzdWx0c1tjdXJyZW50S2V5XSA9IGl0ZXJhdGVlKG9ialtjdXJyZW50S2V5XSwgY3VycmVudEtleSwgb2JqKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXN1bHRzO1xuICB9O1xuXG4gIC8vIENvbnZlcnQgYW4gb2JqZWN0IGludG8gYSBsaXN0IG9mIGBba2V5LCB2YWx1ZV1gIHBhaXJzLlxuICBfLnBhaXJzID0gZnVuY3Rpb24ob2JqKSB7XG4gICAgdmFyIGtleXMgPSBfLmtleXMob2JqKTtcbiAgICB2YXIgbGVuZ3RoID0ga2V5cy5sZW5ndGg7XG4gICAgdmFyIHBhaXJzID0gQXJyYXkobGVuZ3RoKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICBwYWlyc1tpXSA9IFtrZXlzW2ldLCBvYmpba2V5c1tpXV1dO1xuICAgIH1cbiAgICByZXR1cm4gcGFpcnM7XG4gIH07XG5cbiAgLy8gSW52ZXJ0IHRoZSBrZXlzIGFuZCB2YWx1ZXMgb2YgYW4gb2JqZWN0LiBUaGUgdmFsdWVzIG11c3QgYmUgc2VyaWFsaXphYmxlLlxuICBfLmludmVydCA9IGZ1bmN0aW9uKG9iaikge1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICB2YXIga2V5cyA9IF8ua2V5cyhvYmopO1xuICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBrZXlzLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICByZXN1bHRbb2JqW2tleXNbaV1dXSA9IGtleXNbaV07XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG5cbiAgLy8gUmV0dXJuIGEgc29ydGVkIGxpc3Qgb2YgdGhlIGZ1bmN0aW9uIG5hbWVzIGF2YWlsYWJsZSBvbiB0aGUgb2JqZWN0LlxuICAvLyBBbGlhc2VkIGFzIGBtZXRob2RzYFxuICBfLmZ1bmN0aW9ucyA9IF8ubWV0aG9kcyA9IGZ1bmN0aW9uKG9iaikge1xuICAgIHZhciBuYW1lcyA9IFtdO1xuICAgIGZvciAodmFyIGtleSBpbiBvYmopIHtcbiAgICAgIGlmIChfLmlzRnVuY3Rpb24ob2JqW2tleV0pKSBuYW1lcy5wdXNoKGtleSk7XG4gICAgfVxuICAgIHJldHVybiBuYW1lcy5zb3J0KCk7XG4gIH07XG5cbiAgLy8gRXh0ZW5kIGEgZ2l2ZW4gb2JqZWN0IHdpdGggYWxsIHRoZSBwcm9wZXJ0aWVzIGluIHBhc3NlZC1pbiBvYmplY3QocykuXG4gIF8uZXh0ZW5kID0gY3JlYXRlQXNzaWduZXIoXy5hbGxLZXlzKTtcblxuICAvLyBBc3NpZ25zIGEgZ2l2ZW4gb2JqZWN0IHdpdGggYWxsIHRoZSBvd24gcHJvcGVydGllcyBpbiB0aGUgcGFzc2VkLWluIG9iamVjdChzKVxuICAvLyAoaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvT2JqZWN0L2Fzc2lnbilcbiAgXy5leHRlbmRPd24gPSBfLmFzc2lnbiA9IGNyZWF0ZUFzc2lnbmVyKF8ua2V5cyk7XG5cbiAgLy8gUmV0dXJucyB0aGUgZmlyc3Qga2V5IG9uIGFuIG9iamVjdCB0aGF0IHBhc3NlcyBhIHByZWRpY2F0ZSB0ZXN0XG4gIF8uZmluZEtleSA9IGZ1bmN0aW9uKG9iaiwgcHJlZGljYXRlLCBjb250ZXh0KSB7XG4gICAgcHJlZGljYXRlID0gY2IocHJlZGljYXRlLCBjb250ZXh0KTtcbiAgICB2YXIga2V5cyA9IF8ua2V5cyhvYmopLCBrZXk7XG4gICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IGtleXMubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgIGtleSA9IGtleXNbaV07XG4gICAgICBpZiAocHJlZGljYXRlKG9ialtrZXldLCBrZXksIG9iaikpIHJldHVybiBrZXk7XG4gICAgfVxuICB9O1xuXG4gIC8vIFJldHVybiBhIGNvcHkgb2YgdGhlIG9iamVjdCBvbmx5IGNvbnRhaW5pbmcgdGhlIHdoaXRlbGlzdGVkIHByb3BlcnRpZXMuXG4gIF8ucGljayA9IGZ1bmN0aW9uKG9iamVjdCwgb2l0ZXJhdGVlLCBjb250ZXh0KSB7XG4gICAgdmFyIHJlc3VsdCA9IHt9LCBvYmogPSBvYmplY3QsIGl0ZXJhdGVlLCBrZXlzO1xuICAgIGlmIChvYmogPT0gbnVsbCkgcmV0dXJuIHJlc3VsdDtcbiAgICBpZiAoXy5pc0Z1bmN0aW9uKG9pdGVyYXRlZSkpIHtcbiAgICAgIGtleXMgPSBfLmFsbEtleXMob2JqKTtcbiAgICAgIGl0ZXJhdGVlID0gb3B0aW1pemVDYihvaXRlcmF0ZWUsIGNvbnRleHQpO1xuICAgIH0gZWxzZSB7XG4gICAgICBrZXlzID0gZmxhdHRlbihhcmd1bWVudHMsIGZhbHNlLCBmYWxzZSwgMSk7XG4gICAgICBpdGVyYXRlZSA9IGZ1bmN0aW9uKHZhbHVlLCBrZXksIG9iaikgeyByZXR1cm4ga2V5IGluIG9iajsgfTtcbiAgICAgIG9iaiA9IE9iamVjdChvYmopO1xuICAgIH1cbiAgICBmb3IgKHZhciBpID0gMCwgbGVuZ3RoID0ga2V5cy5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgdmFyIGtleSA9IGtleXNbaV07XG4gICAgICB2YXIgdmFsdWUgPSBvYmpba2V5XTtcbiAgICAgIGlmIChpdGVyYXRlZSh2YWx1ZSwga2V5LCBvYmopKSByZXN1bHRba2V5XSA9IHZhbHVlO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuXG4gICAvLyBSZXR1cm4gYSBjb3B5IG9mIHRoZSBvYmplY3Qgd2l0aG91dCB0aGUgYmxhY2tsaXN0ZWQgcHJvcGVydGllcy5cbiAgXy5vbWl0ID0gZnVuY3Rpb24ob2JqLCBpdGVyYXRlZSwgY29udGV4dCkge1xuICAgIGlmIChfLmlzRnVuY3Rpb24oaXRlcmF0ZWUpKSB7XG4gICAgICBpdGVyYXRlZSA9IF8ubmVnYXRlKGl0ZXJhdGVlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdmFyIGtleXMgPSBfLm1hcChmbGF0dGVuKGFyZ3VtZW50cywgZmFsc2UsIGZhbHNlLCAxKSwgU3RyaW5nKTtcbiAgICAgIGl0ZXJhdGVlID0gZnVuY3Rpb24odmFsdWUsIGtleSkge1xuICAgICAgICByZXR1cm4gIV8uY29udGFpbnMoa2V5cywga2V5KTtcbiAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiBfLnBpY2sob2JqLCBpdGVyYXRlZSwgY29udGV4dCk7XG4gIH07XG5cbiAgLy8gRmlsbCBpbiBhIGdpdmVuIG9iamVjdCB3aXRoIGRlZmF1bHQgcHJvcGVydGllcy5cbiAgXy5kZWZhdWx0cyA9IGNyZWF0ZUFzc2lnbmVyKF8uYWxsS2V5cywgdHJ1ZSk7XG5cbiAgLy8gQ3JlYXRlcyBhbiBvYmplY3QgdGhhdCBpbmhlcml0cyBmcm9tIHRoZSBnaXZlbiBwcm90b3R5cGUgb2JqZWN0LlxuICAvLyBJZiBhZGRpdGlvbmFsIHByb3BlcnRpZXMgYXJlIHByb3ZpZGVkIHRoZW4gdGhleSB3aWxsIGJlIGFkZGVkIHRvIHRoZVxuICAvLyBjcmVhdGVkIG9iamVjdC5cbiAgXy5jcmVhdGUgPSBmdW5jdGlvbihwcm90b3R5cGUsIHByb3BzKSB7XG4gICAgdmFyIHJlc3VsdCA9IGJhc2VDcmVhdGUocHJvdG90eXBlKTtcbiAgICBpZiAocHJvcHMpIF8uZXh0ZW5kT3duKHJlc3VsdCwgcHJvcHMpO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG5cbiAgLy8gQ3JlYXRlIGEgKHNoYWxsb3ctY2xvbmVkKSBkdXBsaWNhdGUgb2YgYW4gb2JqZWN0LlxuICBfLmNsb25lID0gZnVuY3Rpb24ob2JqKSB7XG4gICAgaWYgKCFfLmlzT2JqZWN0KG9iaikpIHJldHVybiBvYmo7XG4gICAgcmV0dXJuIF8uaXNBcnJheShvYmopID8gb2JqLnNsaWNlKCkgOiBfLmV4dGVuZCh7fSwgb2JqKTtcbiAgfTtcblxuICAvLyBJbnZva2VzIGludGVyY2VwdG9yIHdpdGggdGhlIG9iaiwgYW5kIHRoZW4gcmV0dXJucyBvYmouXG4gIC8vIFRoZSBwcmltYXJ5IHB1cnBvc2Ugb2YgdGhpcyBtZXRob2QgaXMgdG8gXCJ0YXAgaW50b1wiIGEgbWV0aG9kIGNoYWluLCBpblxuICAvLyBvcmRlciB0byBwZXJmb3JtIG9wZXJhdGlvbnMgb24gaW50ZXJtZWRpYXRlIHJlc3VsdHMgd2l0aGluIHRoZSBjaGFpbi5cbiAgXy50YXAgPSBmdW5jdGlvbihvYmosIGludGVyY2VwdG9yKSB7XG4gICAgaW50ZXJjZXB0b3Iob2JqKTtcbiAgICByZXR1cm4gb2JqO1xuICB9O1xuXG4gIC8vIFJldHVybnMgd2hldGhlciBhbiBvYmplY3QgaGFzIGEgZ2l2ZW4gc2V0IG9mIGBrZXk6dmFsdWVgIHBhaXJzLlxuICBfLmlzTWF0Y2ggPSBmdW5jdGlvbihvYmplY3QsIGF0dHJzKSB7XG4gICAgdmFyIGtleXMgPSBfLmtleXMoYXR0cnMpLCBsZW5ndGggPSBrZXlzLmxlbmd0aDtcbiAgICBpZiAob2JqZWN0ID09IG51bGwpIHJldHVybiAhbGVuZ3RoO1xuICAgIHZhciBvYmogPSBPYmplY3Qob2JqZWN0KTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIga2V5ID0ga2V5c1tpXTtcbiAgICAgIGlmIChhdHRyc1trZXldICE9PSBvYmpba2V5XSB8fCAhKGtleSBpbiBvYmopKSByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xuICB9O1xuXG5cbiAgLy8gSW50ZXJuYWwgcmVjdXJzaXZlIGNvbXBhcmlzb24gZnVuY3Rpb24gZm9yIGBpc0VxdWFsYC5cbiAgdmFyIGVxID0gZnVuY3Rpb24oYSwgYiwgYVN0YWNrLCBiU3RhY2spIHtcbiAgICAvLyBJZGVudGljYWwgb2JqZWN0cyBhcmUgZXF1YWwuIGAwID09PSAtMGAsIGJ1dCB0aGV5IGFyZW4ndCBpZGVudGljYWwuXG4gICAgLy8gU2VlIHRoZSBbSGFybW9ueSBgZWdhbGAgcHJvcG9zYWxdKGh0dHA6Ly93aWtpLmVjbWFzY3JpcHQub3JnL2Rva3UucGhwP2lkPWhhcm1vbnk6ZWdhbCkuXG4gICAgaWYgKGEgPT09IGIpIHJldHVybiBhICE9PSAwIHx8IDEgLyBhID09PSAxIC8gYjtcbiAgICAvLyBBIHN0cmljdCBjb21wYXJpc29uIGlzIG5lY2Vzc2FyeSBiZWNhdXNlIGBudWxsID09IHVuZGVmaW5lZGAuXG4gICAgaWYgKGEgPT0gbnVsbCB8fCBiID09IG51bGwpIHJldHVybiBhID09PSBiO1xuICAgIC8vIFVud3JhcCBhbnkgd3JhcHBlZCBvYmplY3RzLlxuICAgIGlmIChhIGluc3RhbmNlb2YgXykgYSA9IGEuX3dyYXBwZWQ7XG4gICAgaWYgKGIgaW5zdGFuY2VvZiBfKSBiID0gYi5fd3JhcHBlZDtcbiAgICAvLyBDb21wYXJlIGBbW0NsYXNzXV1gIG5hbWVzLlxuICAgIHZhciBjbGFzc05hbWUgPSB0b1N0cmluZy5jYWxsKGEpO1xuICAgIGlmIChjbGFzc05hbWUgIT09IHRvU3RyaW5nLmNhbGwoYikpIHJldHVybiBmYWxzZTtcbiAgICBzd2l0Y2ggKGNsYXNzTmFtZSkge1xuICAgICAgLy8gU3RyaW5ncywgbnVtYmVycywgcmVndWxhciBleHByZXNzaW9ucywgZGF0ZXMsIGFuZCBib29sZWFucyBhcmUgY29tcGFyZWQgYnkgdmFsdWUuXG4gICAgICBjYXNlICdbb2JqZWN0IFJlZ0V4cF0nOlxuICAgICAgLy8gUmVnRXhwcyBhcmUgY29lcmNlZCB0byBzdHJpbmdzIGZvciBjb21wYXJpc29uIChOb3RlOiAnJyArIC9hL2kgPT09ICcvYS9pJylcbiAgICAgIGNhc2UgJ1tvYmplY3QgU3RyaW5nXSc6XG4gICAgICAgIC8vIFByaW1pdGl2ZXMgYW5kIHRoZWlyIGNvcnJlc3BvbmRpbmcgb2JqZWN0IHdyYXBwZXJzIGFyZSBlcXVpdmFsZW50OyB0aHVzLCBgXCI1XCJgIGlzXG4gICAgICAgIC8vIGVxdWl2YWxlbnQgdG8gYG5ldyBTdHJpbmcoXCI1XCIpYC5cbiAgICAgICAgcmV0dXJuICcnICsgYSA9PT0gJycgKyBiO1xuICAgICAgY2FzZSAnW29iamVjdCBOdW1iZXJdJzpcbiAgICAgICAgLy8gYE5hTmBzIGFyZSBlcXVpdmFsZW50LCBidXQgbm9uLXJlZmxleGl2ZS5cbiAgICAgICAgLy8gT2JqZWN0KE5hTikgaXMgZXF1aXZhbGVudCB0byBOYU5cbiAgICAgICAgaWYgKCthICE9PSArYSkgcmV0dXJuICtiICE9PSArYjtcbiAgICAgICAgLy8gQW4gYGVnYWxgIGNvbXBhcmlzb24gaXMgcGVyZm9ybWVkIGZvciBvdGhlciBudW1lcmljIHZhbHVlcy5cbiAgICAgICAgcmV0dXJuICthID09PSAwID8gMSAvICthID09PSAxIC8gYiA6ICthID09PSArYjtcbiAgICAgIGNhc2UgJ1tvYmplY3QgRGF0ZV0nOlxuICAgICAgY2FzZSAnW29iamVjdCBCb29sZWFuXSc6XG4gICAgICAgIC8vIENvZXJjZSBkYXRlcyBhbmQgYm9vbGVhbnMgdG8gbnVtZXJpYyBwcmltaXRpdmUgdmFsdWVzLiBEYXRlcyBhcmUgY29tcGFyZWQgYnkgdGhlaXJcbiAgICAgICAgLy8gbWlsbGlzZWNvbmQgcmVwcmVzZW50YXRpb25zLiBOb3RlIHRoYXQgaW52YWxpZCBkYXRlcyB3aXRoIG1pbGxpc2Vjb25kIHJlcHJlc2VudGF0aW9uc1xuICAgICAgICAvLyBvZiBgTmFOYCBhcmUgbm90IGVxdWl2YWxlbnQuXG4gICAgICAgIHJldHVybiArYSA9PT0gK2I7XG4gICAgfVxuXG4gICAgdmFyIGFyZUFycmF5cyA9IGNsYXNzTmFtZSA9PT0gJ1tvYmplY3QgQXJyYXldJztcbiAgICBpZiAoIWFyZUFycmF5cykge1xuICAgICAgaWYgKHR5cGVvZiBhICE9ICdvYmplY3QnIHx8IHR5cGVvZiBiICE9ICdvYmplY3QnKSByZXR1cm4gZmFsc2U7XG5cbiAgICAgIC8vIE9iamVjdHMgd2l0aCBkaWZmZXJlbnQgY29uc3RydWN0b3JzIGFyZSBub3QgZXF1aXZhbGVudCwgYnV0IGBPYmplY3RgcyBvciBgQXJyYXlgc1xuICAgICAgLy8gZnJvbSBkaWZmZXJlbnQgZnJhbWVzIGFyZS5cbiAgICAgIHZhciBhQ3RvciA9IGEuY29uc3RydWN0b3IsIGJDdG9yID0gYi5jb25zdHJ1Y3RvcjtcbiAgICAgIGlmIChhQ3RvciAhPT0gYkN0b3IgJiYgIShfLmlzRnVuY3Rpb24oYUN0b3IpICYmIGFDdG9yIGluc3RhbmNlb2YgYUN0b3IgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfLmlzRnVuY3Rpb24oYkN0b3IpICYmIGJDdG9yIGluc3RhbmNlb2YgYkN0b3IpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICYmICgnY29uc3RydWN0b3InIGluIGEgJiYgJ2NvbnN0cnVjdG9yJyBpbiBiKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuICAgIC8vIEFzc3VtZSBlcXVhbGl0eSBmb3IgY3ljbGljIHN0cnVjdHVyZXMuIFRoZSBhbGdvcml0aG0gZm9yIGRldGVjdGluZyBjeWNsaWNcbiAgICAvLyBzdHJ1Y3R1cmVzIGlzIGFkYXB0ZWQgZnJvbSBFUyA1LjEgc2VjdGlvbiAxNS4xMi4zLCBhYnN0cmFjdCBvcGVyYXRpb24gYEpPYC5cblxuICAgIC8vIEluaXRpYWxpemluZyBzdGFjayBvZiB0cmF2ZXJzZWQgb2JqZWN0cy5cbiAgICAvLyBJdCdzIGRvbmUgaGVyZSBzaW5jZSB3ZSBvbmx5IG5lZWQgdGhlbSBmb3Igb2JqZWN0cyBhbmQgYXJyYXlzIGNvbXBhcmlzb24uXG4gICAgYVN0YWNrID0gYVN0YWNrIHx8IFtdO1xuICAgIGJTdGFjayA9IGJTdGFjayB8fCBbXTtcbiAgICB2YXIgbGVuZ3RoID0gYVN0YWNrLmxlbmd0aDtcbiAgICB3aGlsZSAobGVuZ3RoLS0pIHtcbiAgICAgIC8vIExpbmVhciBzZWFyY2guIFBlcmZvcm1hbmNlIGlzIGludmVyc2VseSBwcm9wb3J0aW9uYWwgdG8gdGhlIG51bWJlciBvZlxuICAgICAgLy8gdW5pcXVlIG5lc3RlZCBzdHJ1Y3R1cmVzLlxuICAgICAgaWYgKGFTdGFja1tsZW5ndGhdID09PSBhKSByZXR1cm4gYlN0YWNrW2xlbmd0aF0gPT09IGI7XG4gICAgfVxuXG4gICAgLy8gQWRkIHRoZSBmaXJzdCBvYmplY3QgdG8gdGhlIHN0YWNrIG9mIHRyYXZlcnNlZCBvYmplY3RzLlxuICAgIGFTdGFjay5wdXNoKGEpO1xuICAgIGJTdGFjay5wdXNoKGIpO1xuXG4gICAgLy8gUmVjdXJzaXZlbHkgY29tcGFyZSBvYmplY3RzIGFuZCBhcnJheXMuXG4gICAgaWYgKGFyZUFycmF5cykge1xuICAgICAgLy8gQ29tcGFyZSBhcnJheSBsZW5ndGhzIHRvIGRldGVybWluZSBpZiBhIGRlZXAgY29tcGFyaXNvbiBpcyBuZWNlc3NhcnkuXG4gICAgICBsZW5ndGggPSBhLmxlbmd0aDtcbiAgICAgIGlmIChsZW5ndGggIT09IGIubGVuZ3RoKSByZXR1cm4gZmFsc2U7XG4gICAgICAvLyBEZWVwIGNvbXBhcmUgdGhlIGNvbnRlbnRzLCBpZ25vcmluZyBub24tbnVtZXJpYyBwcm9wZXJ0aWVzLlxuICAgICAgd2hpbGUgKGxlbmd0aC0tKSB7XG4gICAgICAgIGlmICghZXEoYVtsZW5ndGhdLCBiW2xlbmd0aF0sIGFTdGFjaywgYlN0YWNrKSkgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBEZWVwIGNvbXBhcmUgb2JqZWN0cy5cbiAgICAgIHZhciBrZXlzID0gXy5rZXlzKGEpLCBrZXk7XG4gICAgICBsZW5ndGggPSBrZXlzLmxlbmd0aDtcbiAgICAgIC8vIEVuc3VyZSB0aGF0IGJvdGggb2JqZWN0cyBjb250YWluIHRoZSBzYW1lIG51bWJlciBvZiBwcm9wZXJ0aWVzIGJlZm9yZSBjb21wYXJpbmcgZGVlcCBlcXVhbGl0eS5cbiAgICAgIGlmIChfLmtleXMoYikubGVuZ3RoICE9PSBsZW5ndGgpIHJldHVybiBmYWxzZTtcbiAgICAgIHdoaWxlIChsZW5ndGgtLSkge1xuICAgICAgICAvLyBEZWVwIGNvbXBhcmUgZWFjaCBtZW1iZXJcbiAgICAgICAga2V5ID0ga2V5c1tsZW5ndGhdO1xuICAgICAgICBpZiAoIShfLmhhcyhiLCBrZXkpICYmIGVxKGFba2V5XSwgYltrZXldLCBhU3RhY2ssIGJTdGFjaykpKSByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuICAgIC8vIFJlbW92ZSB0aGUgZmlyc3Qgb2JqZWN0IGZyb20gdGhlIHN0YWNrIG9mIHRyYXZlcnNlZCBvYmplY3RzLlxuICAgIGFTdGFjay5wb3AoKTtcbiAgICBiU3RhY2sucG9wKCk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH07XG5cbiAgLy8gUGVyZm9ybSBhIGRlZXAgY29tcGFyaXNvbiB0byBjaGVjayBpZiB0d28gb2JqZWN0cyBhcmUgZXF1YWwuXG4gIF8uaXNFcXVhbCA9IGZ1bmN0aW9uKGEsIGIpIHtcbiAgICByZXR1cm4gZXEoYSwgYik7XG4gIH07XG5cbiAgLy8gSXMgYSBnaXZlbiBhcnJheSwgc3RyaW5nLCBvciBvYmplY3QgZW1wdHk/XG4gIC8vIEFuIFwiZW1wdHlcIiBvYmplY3QgaGFzIG5vIGVudW1lcmFibGUgb3duLXByb3BlcnRpZXMuXG4gIF8uaXNFbXB0eSA9IGZ1bmN0aW9uKG9iaikge1xuICAgIGlmIChvYmogPT0gbnVsbCkgcmV0dXJuIHRydWU7XG4gICAgaWYgKGlzQXJyYXlMaWtlKG9iaikgJiYgKF8uaXNBcnJheShvYmopIHx8IF8uaXNTdHJpbmcob2JqKSB8fCBfLmlzQXJndW1lbnRzKG9iaikpKSByZXR1cm4gb2JqLmxlbmd0aCA9PT0gMDtcbiAgICByZXR1cm4gXy5rZXlzKG9iaikubGVuZ3RoID09PSAwO1xuICB9O1xuXG4gIC8vIElzIGEgZ2l2ZW4gdmFsdWUgYSBET00gZWxlbWVudD9cbiAgXy5pc0VsZW1lbnQgPSBmdW5jdGlvbihvYmopIHtcbiAgICByZXR1cm4gISEob2JqICYmIG9iai5ub2RlVHlwZSA9PT0gMSk7XG4gIH07XG5cbiAgLy8gSXMgYSBnaXZlbiB2YWx1ZSBhbiBhcnJheT9cbiAgLy8gRGVsZWdhdGVzIHRvIEVDTUE1J3MgbmF0aXZlIEFycmF5LmlzQXJyYXlcbiAgXy5pc0FycmF5ID0gbmF0aXZlSXNBcnJheSB8fCBmdW5jdGlvbihvYmopIHtcbiAgICByZXR1cm4gdG9TdHJpbmcuY2FsbChvYmopID09PSAnW29iamVjdCBBcnJheV0nO1xuICB9O1xuXG4gIC8vIElzIGEgZ2l2ZW4gdmFyaWFibGUgYW4gb2JqZWN0P1xuICBfLmlzT2JqZWN0ID0gZnVuY3Rpb24ob2JqKSB7XG4gICAgdmFyIHR5cGUgPSB0eXBlb2Ygb2JqO1xuICAgIHJldHVybiB0eXBlID09PSAnZnVuY3Rpb24nIHx8IHR5cGUgPT09ICdvYmplY3QnICYmICEhb2JqO1xuICB9O1xuXG4gIC8vIEFkZCBzb21lIGlzVHlwZSBtZXRob2RzOiBpc0FyZ3VtZW50cywgaXNGdW5jdGlvbiwgaXNTdHJpbmcsIGlzTnVtYmVyLCBpc0RhdGUsIGlzUmVnRXhwLCBpc0Vycm9yLlxuICBfLmVhY2goWydBcmd1bWVudHMnLCAnRnVuY3Rpb24nLCAnU3RyaW5nJywgJ051bWJlcicsICdEYXRlJywgJ1JlZ0V4cCcsICdFcnJvciddLCBmdW5jdGlvbihuYW1lKSB7XG4gICAgX1snaXMnICsgbmFtZV0gPSBmdW5jdGlvbihvYmopIHtcbiAgICAgIHJldHVybiB0b1N0cmluZy5jYWxsKG9iaikgPT09ICdbb2JqZWN0ICcgKyBuYW1lICsgJ10nO1xuICAgIH07XG4gIH0pO1xuXG5cbiAgLy8gT3B0aW1pemUgYGlzRnVuY3Rpb25gIGlmIGFwcHJvcHJpYXRlLiBXb3JrIGFyb3VuZCBzb21lIHR5cGVvZiBidWdzIGluIG9sZCB2OCxcbiAgLy8gSUUgMTEgKCMxNjIxKSwgYW5kIGluIFNhZmFyaSA4ICgjMTkyOSkuXG4gIGlmICh0eXBlb2YgLy4vICE9ICdmdW5jdGlvbicgJiYgdHlwZW9mIEludDhBcnJheSAhPSAnb2JqZWN0Jykge1xuICAgIF8uaXNGdW5jdGlvbiA9IGZ1bmN0aW9uKG9iaikge1xuICAgICAgcmV0dXJuIHR5cGVvZiBvYmogPT0gJ2Z1bmN0aW9uJyB8fCBmYWxzZTtcbiAgICB9O1xuICB9XG5cbiAgLy8gSXMgYSBnaXZlbiBvYmplY3QgYSBmaW5pdGUgbnVtYmVyP1xuICBfLmlzRmluaXRlID0gZnVuY3Rpb24ob2JqKSB7XG4gICAgcmV0dXJuIGlzRmluaXRlKG9iaikgJiYgIWlzTmFOKHBhcnNlRmxvYXQob2JqKSk7XG4gIH07XG5cbiAgLy8gSXMgdGhlIGdpdmVuIHZhbHVlIGBOYU5gPyAoTmFOIGlzIHRoZSBvbmx5IG51bWJlciB3aGljaCBkb2VzIG5vdCBlcXVhbCBpdHNlbGYpLlxuICBfLmlzTmFOID0gZnVuY3Rpb24ob2JqKSB7XG4gICAgcmV0dXJuIF8uaXNOdW1iZXIob2JqKSAmJiBvYmogIT09ICtvYmo7XG4gIH07XG5cbiAgLy8gSXMgYSBnaXZlbiB2YWx1ZSBhIGJvb2xlYW4/XG4gIF8uaXNCb29sZWFuID0gZnVuY3Rpb24ob2JqKSB7XG4gICAgcmV0dXJuIG9iaiA9PT0gdHJ1ZSB8fCBvYmogPT09IGZhbHNlIHx8IHRvU3RyaW5nLmNhbGwob2JqKSA9PT0gJ1tvYmplY3QgQm9vbGVhbl0nO1xuICB9O1xuXG4gIC8vIElzIGEgZ2l2ZW4gdmFsdWUgZXF1YWwgdG8gbnVsbD9cbiAgXy5pc051bGwgPSBmdW5jdGlvbihvYmopIHtcbiAgICByZXR1cm4gb2JqID09PSBudWxsO1xuICB9O1xuXG4gIC8vIElzIGEgZ2l2ZW4gdmFyaWFibGUgdW5kZWZpbmVkP1xuICBfLmlzVW5kZWZpbmVkID0gZnVuY3Rpb24ob2JqKSB7XG4gICAgcmV0dXJuIG9iaiA9PT0gdm9pZCAwO1xuICB9O1xuXG4gIC8vIFNob3J0Y3V0IGZ1bmN0aW9uIGZvciBjaGVja2luZyBpZiBhbiBvYmplY3QgaGFzIGEgZ2l2ZW4gcHJvcGVydHkgZGlyZWN0bHlcbiAgLy8gb24gaXRzZWxmIChpbiBvdGhlciB3b3Jkcywgbm90IG9uIGEgcHJvdG90eXBlKS5cbiAgXy5oYXMgPSBmdW5jdGlvbihvYmosIGtleSkge1xuICAgIHJldHVybiBvYmogIT0gbnVsbCAmJiBoYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwga2V5KTtcbiAgfTtcblxuICAvLyBLZWVwIHRoZSBpZGVudGl0eSBmdW5jdGlvbiBhcm91bmQgZm9yIGRlZmF1bHQgaXRlcmF0ZWVzLlxuICBfLmlkZW50aXR5ID0gZnVuY3Rpb24odmFsdWUpIHtcbiAgICByZXR1cm4gdmFsdWU7XG4gIH07XG5cbiAgLy8gUHJlZGljYXRlLWdlbmVyYXRpbmcgZnVuY3Rpb25zLiBPZnRlbiB1c2VmdWwgb3V0c2lkZSBvZiBVbmRlcnNjb3JlLlxuICBfLmNvbnN0YW50ID0gZnVuY3Rpb24odmFsdWUpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gdmFsdWU7XG4gICAgfTtcbiAgfTtcblxuICBfLm5vb3AgPSBmdW5jdGlvbigpe307XG5cbiAgXy5wcm9wZXJ0eSA9IHByb3BlcnR5O1xuXG4gIC8vIEdlbmVyYXRlcyBhIGZ1bmN0aW9uIGZvciBhIGdpdmVuIG9iamVjdCB0aGF0IHJldHVybnMgYSBnaXZlbiBwcm9wZXJ0eS5cbiAgXy5wcm9wZXJ0eU9mID0gZnVuY3Rpb24ob2JqKSB7XG4gICAgcmV0dXJuIG9iaiA9PSBudWxsID8gZnVuY3Rpb24oKXt9IDogZnVuY3Rpb24oa2V5KSB7XG4gICAgICByZXR1cm4gb2JqW2tleV07XG4gICAgfTtcbiAgfTtcblxuICAvLyBSZXR1cm5zIGEgcHJlZGljYXRlIGZvciBjaGVja2luZyB3aGV0aGVyIGFuIG9iamVjdCBoYXMgYSBnaXZlbiBzZXQgb2ZcbiAgLy8gYGtleTp2YWx1ZWAgcGFpcnMuXG4gIF8ubWF0Y2hlciA9IF8ubWF0Y2hlcyA9IGZ1bmN0aW9uKGF0dHJzKSB7XG4gICAgYXR0cnMgPSBfLmV4dGVuZE93bih7fSwgYXR0cnMpO1xuICAgIHJldHVybiBmdW5jdGlvbihvYmopIHtcbiAgICAgIHJldHVybiBfLmlzTWF0Y2gob2JqLCBhdHRycyk7XG4gICAgfTtcbiAgfTtcblxuICAvLyBSdW4gYSBmdW5jdGlvbiAqKm4qKiB0aW1lcy5cbiAgXy50aW1lcyA9IGZ1bmN0aW9uKG4sIGl0ZXJhdGVlLCBjb250ZXh0KSB7XG4gICAgdmFyIGFjY3VtID0gQXJyYXkoTWF0aC5tYXgoMCwgbikpO1xuICAgIGl0ZXJhdGVlID0gb3B0aW1pemVDYihpdGVyYXRlZSwgY29udGV4dCwgMSk7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBuOyBpKyspIGFjY3VtW2ldID0gaXRlcmF0ZWUoaSk7XG4gICAgcmV0dXJuIGFjY3VtO1xuICB9O1xuXG4gIC8vIFJldHVybiBhIHJhbmRvbSBpbnRlZ2VyIGJldHdlZW4gbWluIGFuZCBtYXggKGluY2x1c2l2ZSkuXG4gIF8ucmFuZG9tID0gZnVuY3Rpb24obWluLCBtYXgpIHtcbiAgICBpZiAobWF4ID09IG51bGwpIHtcbiAgICAgIG1heCA9IG1pbjtcbiAgICAgIG1pbiA9IDA7XG4gICAgfVxuICAgIHJldHVybiBtaW4gKyBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAobWF4IC0gbWluICsgMSkpO1xuICB9O1xuXG4gIC8vIEEgKHBvc3NpYmx5IGZhc3Rlcikgd2F5IHRvIGdldCB0aGUgY3VycmVudCB0aW1lc3RhbXAgYXMgYW4gaW50ZWdlci5cbiAgXy5ub3cgPSBEYXRlLm5vdyB8fCBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gIH07XG5cbiAgIC8vIExpc3Qgb2YgSFRNTCBlbnRpdGllcyBmb3IgZXNjYXBpbmcuXG4gIHZhciBlc2NhcGVNYXAgPSB7XG4gICAgJyYnOiAnJmFtcDsnLFxuICAgICc8JzogJyZsdDsnLFxuICAgICc+JzogJyZndDsnLFxuICAgICdcIic6ICcmcXVvdDsnLFxuICAgIFwiJ1wiOiAnJiN4Mjc7JyxcbiAgICAnYCc6ICcmI3g2MDsnXG4gIH07XG4gIHZhciB1bmVzY2FwZU1hcCA9IF8uaW52ZXJ0KGVzY2FwZU1hcCk7XG5cbiAgLy8gRnVuY3Rpb25zIGZvciBlc2NhcGluZyBhbmQgdW5lc2NhcGluZyBzdHJpbmdzIHRvL2Zyb20gSFRNTCBpbnRlcnBvbGF0aW9uLlxuICB2YXIgY3JlYXRlRXNjYXBlciA9IGZ1bmN0aW9uKG1hcCkge1xuICAgIHZhciBlc2NhcGVyID0gZnVuY3Rpb24obWF0Y2gpIHtcbiAgICAgIHJldHVybiBtYXBbbWF0Y2hdO1xuICAgIH07XG4gICAgLy8gUmVnZXhlcyBmb3IgaWRlbnRpZnlpbmcgYSBrZXkgdGhhdCBuZWVkcyB0byBiZSBlc2NhcGVkXG4gICAgdmFyIHNvdXJjZSA9ICcoPzonICsgXy5rZXlzKG1hcCkuam9pbignfCcpICsgJyknO1xuICAgIHZhciB0ZXN0UmVnZXhwID0gUmVnRXhwKHNvdXJjZSk7XG4gICAgdmFyIHJlcGxhY2VSZWdleHAgPSBSZWdFeHAoc291cmNlLCAnZycpO1xuICAgIHJldHVybiBmdW5jdGlvbihzdHJpbmcpIHtcbiAgICAgIHN0cmluZyA9IHN0cmluZyA9PSBudWxsID8gJycgOiAnJyArIHN0cmluZztcbiAgICAgIHJldHVybiB0ZXN0UmVnZXhwLnRlc3Qoc3RyaW5nKSA/IHN0cmluZy5yZXBsYWNlKHJlcGxhY2VSZWdleHAsIGVzY2FwZXIpIDogc3RyaW5nO1xuICAgIH07XG4gIH07XG4gIF8uZXNjYXBlID0gY3JlYXRlRXNjYXBlcihlc2NhcGVNYXApO1xuICBfLnVuZXNjYXBlID0gY3JlYXRlRXNjYXBlcih1bmVzY2FwZU1hcCk7XG5cbiAgLy8gSWYgdGhlIHZhbHVlIG9mIHRoZSBuYW1lZCBgcHJvcGVydHlgIGlzIGEgZnVuY3Rpb24gdGhlbiBpbnZva2UgaXQgd2l0aCB0aGVcbiAgLy8gYG9iamVjdGAgYXMgY29udGV4dDsgb3RoZXJ3aXNlLCByZXR1cm4gaXQuXG4gIF8ucmVzdWx0ID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSwgZmFsbGJhY2spIHtcbiAgICB2YXIgdmFsdWUgPSBvYmplY3QgPT0gbnVsbCA/IHZvaWQgMCA6IG9iamVjdFtwcm9wZXJ0eV07XG4gICAgaWYgKHZhbHVlID09PSB2b2lkIDApIHtcbiAgICAgIHZhbHVlID0gZmFsbGJhY2s7XG4gICAgfVxuICAgIHJldHVybiBfLmlzRnVuY3Rpb24odmFsdWUpID8gdmFsdWUuY2FsbChvYmplY3QpIDogdmFsdWU7XG4gIH07XG5cbiAgLy8gR2VuZXJhdGUgYSB1bmlxdWUgaW50ZWdlciBpZCAodW5pcXVlIHdpdGhpbiB0aGUgZW50aXJlIGNsaWVudCBzZXNzaW9uKS5cbiAgLy8gVXNlZnVsIGZvciB0ZW1wb3JhcnkgRE9NIGlkcy5cbiAgdmFyIGlkQ291bnRlciA9IDA7XG4gIF8udW5pcXVlSWQgPSBmdW5jdGlvbihwcmVmaXgpIHtcbiAgICB2YXIgaWQgPSArK2lkQ291bnRlciArICcnO1xuICAgIHJldHVybiBwcmVmaXggPyBwcmVmaXggKyBpZCA6IGlkO1xuICB9O1xuXG4gIC8vIEJ5IGRlZmF1bHQsIFVuZGVyc2NvcmUgdXNlcyBFUkItc3R5bGUgdGVtcGxhdGUgZGVsaW1pdGVycywgY2hhbmdlIHRoZVxuICAvLyBmb2xsb3dpbmcgdGVtcGxhdGUgc2V0dGluZ3MgdG8gdXNlIGFsdGVybmF0aXZlIGRlbGltaXRlcnMuXG4gIF8udGVtcGxhdGVTZXR0aW5ncyA9IHtcbiAgICBldmFsdWF0ZSAgICA6IC88JShbXFxzXFxTXSs/KSU+L2csXG4gICAgaW50ZXJwb2xhdGUgOiAvPCU9KFtcXHNcXFNdKz8pJT4vZyxcbiAgICBlc2NhcGUgICAgICA6IC88JS0oW1xcc1xcU10rPyklPi9nXG4gIH07XG5cbiAgLy8gV2hlbiBjdXN0b21pemluZyBgdGVtcGxhdGVTZXR0aW5nc2AsIGlmIHlvdSBkb24ndCB3YW50IHRvIGRlZmluZSBhblxuICAvLyBpbnRlcnBvbGF0aW9uLCBldmFsdWF0aW9uIG9yIGVzY2FwaW5nIHJlZ2V4LCB3ZSBuZWVkIG9uZSB0aGF0IGlzXG4gIC8vIGd1YXJhbnRlZWQgbm90IHRvIG1hdGNoLlxuICB2YXIgbm9NYXRjaCA9IC8oLileLztcblxuICAvLyBDZXJ0YWluIGNoYXJhY3RlcnMgbmVlZCB0byBiZSBlc2NhcGVkIHNvIHRoYXQgdGhleSBjYW4gYmUgcHV0IGludG8gYVxuICAvLyBzdHJpbmcgbGl0ZXJhbC5cbiAgdmFyIGVzY2FwZXMgPSB7XG4gICAgXCInXCI6ICAgICAgXCInXCIsXG4gICAgJ1xcXFwnOiAgICAgJ1xcXFwnLFxuICAgICdcXHInOiAgICAgJ3InLFxuICAgICdcXG4nOiAgICAgJ24nLFxuICAgICdcXHUyMDI4JzogJ3UyMDI4JyxcbiAgICAnXFx1MjAyOSc6ICd1MjAyOSdcbiAgfTtcblxuICB2YXIgZXNjYXBlciA9IC9cXFxcfCd8XFxyfFxcbnxcXHUyMDI4fFxcdTIwMjkvZztcblxuICB2YXIgZXNjYXBlQ2hhciA9IGZ1bmN0aW9uKG1hdGNoKSB7XG4gICAgcmV0dXJuICdcXFxcJyArIGVzY2FwZXNbbWF0Y2hdO1xuICB9O1xuXG4gIC8vIEphdmFTY3JpcHQgbWljcm8tdGVtcGxhdGluZywgc2ltaWxhciB0byBKb2huIFJlc2lnJ3MgaW1wbGVtZW50YXRpb24uXG4gIC8vIFVuZGVyc2NvcmUgdGVtcGxhdGluZyBoYW5kbGVzIGFyYml0cmFyeSBkZWxpbWl0ZXJzLCBwcmVzZXJ2ZXMgd2hpdGVzcGFjZSxcbiAgLy8gYW5kIGNvcnJlY3RseSBlc2NhcGVzIHF1b3RlcyB3aXRoaW4gaW50ZXJwb2xhdGVkIGNvZGUuXG4gIC8vIE5COiBgb2xkU2V0dGluZ3NgIG9ubHkgZXhpc3RzIGZvciBiYWNrd2FyZHMgY29tcGF0aWJpbGl0eS5cbiAgXy50ZW1wbGF0ZSA9IGZ1bmN0aW9uKHRleHQsIHNldHRpbmdzLCBvbGRTZXR0aW5ncykge1xuICAgIGlmICghc2V0dGluZ3MgJiYgb2xkU2V0dGluZ3MpIHNldHRpbmdzID0gb2xkU2V0dGluZ3M7XG4gICAgc2V0dGluZ3MgPSBfLmRlZmF1bHRzKHt9LCBzZXR0aW5ncywgXy50ZW1wbGF0ZVNldHRpbmdzKTtcblxuICAgIC8vIENvbWJpbmUgZGVsaW1pdGVycyBpbnRvIG9uZSByZWd1bGFyIGV4cHJlc3Npb24gdmlhIGFsdGVybmF0aW9uLlxuICAgIHZhciBtYXRjaGVyID0gUmVnRXhwKFtcbiAgICAgIChzZXR0aW5ncy5lc2NhcGUgfHwgbm9NYXRjaCkuc291cmNlLFxuICAgICAgKHNldHRpbmdzLmludGVycG9sYXRlIHx8IG5vTWF0Y2gpLnNvdXJjZSxcbiAgICAgIChzZXR0aW5ncy5ldmFsdWF0ZSB8fCBub01hdGNoKS5zb3VyY2VcbiAgICBdLmpvaW4oJ3wnKSArICd8JCcsICdnJyk7XG5cbiAgICAvLyBDb21waWxlIHRoZSB0ZW1wbGF0ZSBzb3VyY2UsIGVzY2FwaW5nIHN0cmluZyBsaXRlcmFscyBhcHByb3ByaWF0ZWx5LlxuICAgIHZhciBpbmRleCA9IDA7XG4gICAgdmFyIHNvdXJjZSA9IFwiX19wKz0nXCI7XG4gICAgdGV4dC5yZXBsYWNlKG1hdGNoZXIsIGZ1bmN0aW9uKG1hdGNoLCBlc2NhcGUsIGludGVycG9sYXRlLCBldmFsdWF0ZSwgb2Zmc2V0KSB7XG4gICAgICBzb3VyY2UgKz0gdGV4dC5zbGljZShpbmRleCwgb2Zmc2V0KS5yZXBsYWNlKGVzY2FwZXIsIGVzY2FwZUNoYXIpO1xuICAgICAgaW5kZXggPSBvZmZzZXQgKyBtYXRjaC5sZW5ndGg7XG5cbiAgICAgIGlmIChlc2NhcGUpIHtcbiAgICAgICAgc291cmNlICs9IFwiJytcXG4oKF9fdD0oXCIgKyBlc2NhcGUgKyBcIikpPT1udWxsPycnOl8uZXNjYXBlKF9fdCkpK1xcbidcIjtcbiAgICAgIH0gZWxzZSBpZiAoaW50ZXJwb2xhdGUpIHtcbiAgICAgICAgc291cmNlICs9IFwiJytcXG4oKF9fdD0oXCIgKyBpbnRlcnBvbGF0ZSArIFwiKSk9PW51bGw/Jyc6X190KStcXG4nXCI7XG4gICAgICB9IGVsc2UgaWYgKGV2YWx1YXRlKSB7XG4gICAgICAgIHNvdXJjZSArPSBcIic7XFxuXCIgKyBldmFsdWF0ZSArIFwiXFxuX19wKz0nXCI7XG4gICAgICB9XG5cbiAgICAgIC8vIEFkb2JlIFZNcyBuZWVkIHRoZSBtYXRjaCByZXR1cm5lZCB0byBwcm9kdWNlIHRoZSBjb3JyZWN0IG9mZmVzdC5cbiAgICAgIHJldHVybiBtYXRjaDtcbiAgICB9KTtcbiAgICBzb3VyY2UgKz0gXCInO1xcblwiO1xuXG4gICAgLy8gSWYgYSB2YXJpYWJsZSBpcyBub3Qgc3BlY2lmaWVkLCBwbGFjZSBkYXRhIHZhbHVlcyBpbiBsb2NhbCBzY29wZS5cbiAgICBpZiAoIXNldHRpbmdzLnZhcmlhYmxlKSBzb3VyY2UgPSAnd2l0aChvYmp8fHt9KXtcXG4nICsgc291cmNlICsgJ31cXG4nO1xuXG4gICAgc291cmNlID0gXCJ2YXIgX190LF9fcD0nJyxfX2o9QXJyYXkucHJvdG90eXBlLmpvaW4sXCIgK1xuICAgICAgXCJwcmludD1mdW5jdGlvbigpe19fcCs9X19qLmNhbGwoYXJndW1lbnRzLCcnKTt9O1xcblwiICtcbiAgICAgIHNvdXJjZSArICdyZXR1cm4gX19wO1xcbic7XG5cbiAgICB0cnkge1xuICAgICAgdmFyIHJlbmRlciA9IG5ldyBGdW5jdGlvbihzZXR0aW5ncy52YXJpYWJsZSB8fCAnb2JqJywgJ18nLCBzb3VyY2UpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGUuc291cmNlID0gc291cmNlO1xuICAgICAgdGhyb3cgZTtcbiAgICB9XG5cbiAgICB2YXIgdGVtcGxhdGUgPSBmdW5jdGlvbihkYXRhKSB7XG4gICAgICByZXR1cm4gcmVuZGVyLmNhbGwodGhpcywgZGF0YSwgXyk7XG4gICAgfTtcblxuICAgIC8vIFByb3ZpZGUgdGhlIGNvbXBpbGVkIHNvdXJjZSBhcyBhIGNvbnZlbmllbmNlIGZvciBwcmVjb21waWxhdGlvbi5cbiAgICB2YXIgYXJndW1lbnQgPSBzZXR0aW5ncy52YXJpYWJsZSB8fCAnb2JqJztcbiAgICB0ZW1wbGF0ZS5zb3VyY2UgPSAnZnVuY3Rpb24oJyArIGFyZ3VtZW50ICsgJyl7XFxuJyArIHNvdXJjZSArICd9JztcblxuICAgIHJldHVybiB0ZW1wbGF0ZTtcbiAgfTtcblxuICAvLyBBZGQgYSBcImNoYWluXCIgZnVuY3Rpb24uIFN0YXJ0IGNoYWluaW5nIGEgd3JhcHBlZCBVbmRlcnNjb3JlIG9iamVjdC5cbiAgXy5jaGFpbiA9IGZ1bmN0aW9uKG9iaikge1xuICAgIHZhciBpbnN0YW5jZSA9IF8ob2JqKTtcbiAgICBpbnN0YW5jZS5fY2hhaW4gPSB0cnVlO1xuICAgIHJldHVybiBpbnN0YW5jZTtcbiAgfTtcblxuICAvLyBPT1BcbiAgLy8gLS0tLS0tLS0tLS0tLS0tXG4gIC8vIElmIFVuZGVyc2NvcmUgaXMgY2FsbGVkIGFzIGEgZnVuY3Rpb24sIGl0IHJldHVybnMgYSB3cmFwcGVkIG9iamVjdCB0aGF0XG4gIC8vIGNhbiBiZSB1c2VkIE9PLXN0eWxlLiBUaGlzIHdyYXBwZXIgaG9sZHMgYWx0ZXJlZCB2ZXJzaW9ucyBvZiBhbGwgdGhlXG4gIC8vIHVuZGVyc2NvcmUgZnVuY3Rpb25zLiBXcmFwcGVkIG9iamVjdHMgbWF5IGJlIGNoYWluZWQuXG5cbiAgLy8gSGVscGVyIGZ1bmN0aW9uIHRvIGNvbnRpbnVlIGNoYWluaW5nIGludGVybWVkaWF0ZSByZXN1bHRzLlxuICB2YXIgcmVzdWx0ID0gZnVuY3Rpb24oaW5zdGFuY2UsIG9iaikge1xuICAgIHJldHVybiBpbnN0YW5jZS5fY2hhaW4gPyBfKG9iaikuY2hhaW4oKSA6IG9iajtcbiAgfTtcblxuICAvLyBBZGQgeW91ciBvd24gY3VzdG9tIGZ1bmN0aW9ucyB0byB0aGUgVW5kZXJzY29yZSBvYmplY3QuXG4gIF8ubWl4aW4gPSBmdW5jdGlvbihvYmopIHtcbiAgICBfLmVhY2goXy5mdW5jdGlvbnMob2JqKSwgZnVuY3Rpb24obmFtZSkge1xuICAgICAgdmFyIGZ1bmMgPSBfW25hbWVdID0gb2JqW25hbWVdO1xuICAgICAgXy5wcm90b3R5cGVbbmFtZV0gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGFyZ3MgPSBbdGhpcy5fd3JhcHBlZF07XG4gICAgICAgIHB1c2guYXBwbHkoYXJncywgYXJndW1lbnRzKTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdCh0aGlzLCBmdW5jLmFwcGx5KF8sIGFyZ3MpKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH07XG5cbiAgLy8gQWRkIGFsbCBvZiB0aGUgVW5kZXJzY29yZSBmdW5jdGlvbnMgdG8gdGhlIHdyYXBwZXIgb2JqZWN0LlxuICBfLm1peGluKF8pO1xuXG4gIC8vIEFkZCBhbGwgbXV0YXRvciBBcnJheSBmdW5jdGlvbnMgdG8gdGhlIHdyYXBwZXIuXG4gIF8uZWFjaChbJ3BvcCcsICdwdXNoJywgJ3JldmVyc2UnLCAnc2hpZnQnLCAnc29ydCcsICdzcGxpY2UnLCAndW5zaGlmdCddLCBmdW5jdGlvbihuYW1lKSB7XG4gICAgdmFyIG1ldGhvZCA9IEFycmF5UHJvdG9bbmFtZV07XG4gICAgXy5wcm90b3R5cGVbbmFtZV0gPSBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBvYmogPSB0aGlzLl93cmFwcGVkO1xuICAgICAgbWV0aG9kLmFwcGx5KG9iaiwgYXJndW1lbnRzKTtcbiAgICAgIGlmICgobmFtZSA9PT0gJ3NoaWZ0JyB8fCBuYW1lID09PSAnc3BsaWNlJykgJiYgb2JqLmxlbmd0aCA9PT0gMCkgZGVsZXRlIG9ialswXTtcbiAgICAgIHJldHVybiByZXN1bHQodGhpcywgb2JqKTtcbiAgICB9O1xuICB9KTtcblxuICAvLyBBZGQgYWxsIGFjY2Vzc29yIEFycmF5IGZ1bmN0aW9ucyB0byB0aGUgd3JhcHBlci5cbiAgXy5lYWNoKFsnY29uY2F0JywgJ2pvaW4nLCAnc2xpY2UnXSwgZnVuY3Rpb24obmFtZSkge1xuICAgIHZhciBtZXRob2QgPSBBcnJheVByb3RvW25hbWVdO1xuICAgIF8ucHJvdG90eXBlW25hbWVdID0gZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gcmVzdWx0KHRoaXMsIG1ldGhvZC5hcHBseSh0aGlzLl93cmFwcGVkLCBhcmd1bWVudHMpKTtcbiAgICB9O1xuICB9KTtcblxuICAvLyBFeHRyYWN0cyB0aGUgcmVzdWx0IGZyb20gYSB3cmFwcGVkIGFuZCBjaGFpbmVkIG9iamVjdC5cbiAgXy5wcm90b3R5cGUudmFsdWUgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5fd3JhcHBlZDtcbiAgfTtcblxuICAvLyBQcm92aWRlIHVud3JhcHBpbmcgcHJveHkgZm9yIHNvbWUgbWV0aG9kcyB1c2VkIGluIGVuZ2luZSBvcGVyYXRpb25zXG4gIC8vIHN1Y2ggYXMgYXJpdGhtZXRpYyBhbmQgSlNPTiBzdHJpbmdpZmljYXRpb24uXG4gIF8ucHJvdG90eXBlLnZhbHVlT2YgPSBfLnByb3RvdHlwZS50b0pTT04gPSBfLnByb3RvdHlwZS52YWx1ZTtcblxuICBfLnByb3RvdHlwZS50b1N0cmluZyA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiAnJyArIHRoaXMuX3dyYXBwZWQ7XG4gIH07XG5cbiAgbW9kdWxlLmV4cG9ydHMgPSBfO1xuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9wbHVnaW5zL3VuZGVyc2NvcmUuanNcbi8vIG1vZHVsZSBpZCA9IDRcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiXG5TdHJpbmcucHJvdG90eXBlLmZvcm1hdCAgPSBmdW5jdGlvbiAoKSB7XG4gIHZhciBzdHIgPSB0aGlzLnRvU3RyaW5nKCk7XG4gIGlmIChhcmd1bWVudHMubGVuZ3RoKSB7XG4gICAgdmFyIHR5cGUgPSB0eXBlb2YgYXJndW1lbnRzWzBdXG4gICAgICAsIGFyZ3MgPSB0eXBlID09ICdzdHJpbmcnIHx8IHR5cGUgPT0gJ251bWJlcicgPyBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpIDogYXJndW1lbnRzWzBdXG4gICAgLy9cbiAgICAvLyBmb3IgKHZhciBhcmcgaW4gYXJncykgc3RyID0gc3RyLnJlcGxhY2UobmV3IFJlZ0V4cCgnXFxcXHsnICsgYXJnICsgJ1xcXFx9JywgJ2dpJyksIGFyZ3NbYXJnXSlcblxuICAgIHN0ciA9IHN0ci5yZXBsYWNlKC9cXHsoW159XSopXFx9L2csZnVuY3Rpb24oYSxiKXtcbiAgICAgIHJldHVybiB1dGlscy5ldmFsSW5Db250ZXh0KGIsYXJncylcbiAgICB9KVxuICB9XG5cbiAgcmV0dXJuIHN0clxufTtcblxudXRpbHMgPSB7XG4gIGV4dHJhY3RWYXJpYWJsZXM6IGZ1bmN0aW9uIChzdHIpIHtcbiAgICByZXR1cm4gc3RyLm1hdGNoKC8oPyEoPzpkb3xpZnxpbnxmb3J8bGV0fG5ld3x0cnl8dmFyfGNhc2V8ZWxzZXxlbnVtfGV2YWx8ZmFsc2V8bnVsbHx0aGlzfHRydWV8dm9pZHx3aXRofGJyZWFrfGNhdGNofGNsYXNzfGNvbnN0fHN1cGVyfHRocm93fHdoaWxlfHlpZWxkfGRlbGV0ZXxleHBvcnR8aW1wb3J0fHB1YmxpY3xyZXR1cm58c3RhdGljfHN3aXRjaHx0eXBlb2Z8ZGVmYXVsdHxleHRlbmRzfGZpbmFsbHl8cGFja2FnZXxwcml2YXRlfGNvbnRpbnVlfGRlYnVnZ2VyfGZ1bmN0aW9ufGFyZ3VtZW50c3xpbnRlcmZhY2V8cHJvdGVjdGVkfGltcGxlbWVudHN8aW5zdGFuY2VvZikkKVskQS1aXFxfYS16XFx4YWFcXHhiNVxceGJhXFx4YzAtXFx4ZDZcXHhkOC1cXHhmNlxceGY4LVxcdTAyYzFcXHUwMmM2LVxcdTAyZDFcXHUwMmUwLVxcdTAyZTRcXHUwMmVjXFx1MDJlZVxcdTAzNzAtXFx1MDM3NFxcdTAzNzZcXHUwMzc3XFx1MDM3YS1cXHUwMzdkXFx1MDM4NlxcdTAzODgtXFx1MDM4YVxcdTAzOGNcXHUwMzhlLVxcdTAzYTFcXHUwM2EzLVxcdTAzZjVcXHUwM2Y3LVxcdTA0ODFcXHUwNDhhLVxcdTA1MjdcXHUwNTMxLVxcdTA1NTZcXHUwNTU5XFx1MDU2MS1cXHUwNTg3XFx1MDVkMC1cXHUwNWVhXFx1MDVmMC1cXHUwNWYyXFx1MDYyMC1cXHUwNjRhXFx1MDY2ZVxcdTA2NmZcXHUwNjcxLVxcdTA2ZDNcXHUwNmQ1XFx1MDZlNVxcdTA2ZTZcXHUwNmVlXFx1MDZlZlxcdTA2ZmEtXFx1MDZmY1xcdTA2ZmZcXHUwNzEwXFx1MDcxMi1cXHUwNzJmXFx1MDc0ZC1cXHUwN2E1XFx1MDdiMVxcdTA3Y2EtXFx1MDdlYVxcdTA3ZjRcXHUwN2Y1XFx1MDdmYVxcdTA4MDAtXFx1MDgxNVxcdTA4MWFcXHUwODI0XFx1MDgyOFxcdTA4NDAtXFx1MDg1OFxcdTA4YTBcXHUwOGEyLVxcdTA4YWNcXHUwOTA0LVxcdTA5MzlcXHUwOTNkXFx1MDk1MFxcdTA5NTgtXFx1MDk2MVxcdTA5NzEtXFx1MDk3N1xcdTA5NzktXFx1MDk3ZlxcdTA5ODUtXFx1MDk4Y1xcdTA5OGZcXHUwOTkwXFx1MDk5My1cXHUwOWE4XFx1MDlhYS1cXHUwOWIwXFx1MDliMlxcdTA5YjYtXFx1MDliOVxcdTA5YmRcXHUwOWNlXFx1MDlkY1xcdTA5ZGRcXHUwOWRmLVxcdTA5ZTFcXHUwOWYwXFx1MDlmMVxcdTBhMDUtXFx1MGEwYVxcdTBhMGZcXHUwYTEwXFx1MGExMy1cXHUwYTI4XFx1MGEyYS1cXHUwYTMwXFx1MGEzMlxcdTBhMzNcXHUwYTM1XFx1MGEzNlxcdTBhMzhcXHUwYTM5XFx1MGE1OS1cXHUwYTVjXFx1MGE1ZVxcdTBhNzItXFx1MGE3NFxcdTBhODUtXFx1MGE4ZFxcdTBhOGYtXFx1MGE5MVxcdTBhOTMtXFx1MGFhOFxcdTBhYWEtXFx1MGFiMFxcdTBhYjJcXHUwYWIzXFx1MGFiNS1cXHUwYWI5XFx1MGFiZFxcdTBhZDBcXHUwYWUwXFx1MGFlMVxcdTBiMDUtXFx1MGIwY1xcdTBiMGZcXHUwYjEwXFx1MGIxMy1cXHUwYjI4XFx1MGIyYS1cXHUwYjMwXFx1MGIzMlxcdTBiMzNcXHUwYjM1LVxcdTBiMzlcXHUwYjNkXFx1MGI1Y1xcdTBiNWRcXHUwYjVmLVxcdTBiNjFcXHUwYjcxXFx1MGI4M1xcdTBiODUtXFx1MGI4YVxcdTBiOGUtXFx1MGI5MFxcdTBiOTItXFx1MGI5NVxcdTBiOTlcXHUwYjlhXFx1MGI5Y1xcdTBiOWVcXHUwYjlmXFx1MGJhM1xcdTBiYTRcXHUwYmE4LVxcdTBiYWFcXHUwYmFlLVxcdTBiYjlcXHUwYmQwXFx1MGMwNS1cXHUwYzBjXFx1MGMwZS1cXHUwYzEwXFx1MGMxMi1cXHUwYzI4XFx1MGMyYS1cXHUwYzMzXFx1MGMzNS1cXHUwYzM5XFx1MGMzZFxcdTBjNThcXHUwYzU5XFx1MGM2MFxcdTBjNjFcXHUwYzg1LVxcdTBjOGNcXHUwYzhlLVxcdTBjOTBcXHUwYzkyLVxcdTBjYThcXHUwY2FhLVxcdTBjYjNcXHUwY2I1LVxcdTBjYjlcXHUwY2JkXFx1MGNkZVxcdTBjZTBcXHUwY2UxXFx1MGNmMVxcdTBjZjJcXHUwZDA1LVxcdTBkMGNcXHUwZDBlLVxcdTBkMTBcXHUwZDEyLVxcdTBkM2FcXHUwZDNkXFx1MGQ0ZVxcdTBkNjBcXHUwZDYxXFx1MGQ3YS1cXHUwZDdmXFx1MGQ4NS1cXHUwZDk2XFx1MGQ5YS1cXHUwZGIxXFx1MGRiMy1cXHUwZGJiXFx1MGRiZFxcdTBkYzAtXFx1MGRjNlxcdTBlMDEtXFx1MGUzMFxcdTBlMzJcXHUwZTMzXFx1MGU0MC1cXHUwZTQ2XFx1MGU4MVxcdTBlODJcXHUwZTg0XFx1MGU4N1xcdTBlODhcXHUwZThhXFx1MGU4ZFxcdTBlOTQtXFx1MGU5N1xcdTBlOTktXFx1MGU5ZlxcdTBlYTEtXFx1MGVhM1xcdTBlYTVcXHUwZWE3XFx1MGVhYVxcdTBlYWJcXHUwZWFkLVxcdTBlYjBcXHUwZWIyXFx1MGViM1xcdTBlYmRcXHUwZWMwLVxcdTBlYzRcXHUwZWM2XFx1MGVkYy1cXHUwZWRmXFx1MGYwMFxcdTBmNDAtXFx1MGY0N1xcdTBmNDktXFx1MGY2Y1xcdTBmODgtXFx1MGY4Y1xcdTEwMDAtXFx1MTAyYVxcdTEwM2ZcXHUxMDUwLVxcdTEwNTVcXHUxMDVhLVxcdTEwNWRcXHUxMDYxXFx1MTA2NVxcdTEwNjZcXHUxMDZlLVxcdTEwNzBcXHUxMDc1LVxcdTEwODFcXHUxMDhlXFx1MTBhMC1cXHUxMGM1XFx1MTBjN1xcdTEwY2RcXHUxMGQwLVxcdTEwZmFcXHUxMGZjLVxcdTEyNDhcXHUxMjRhLVxcdTEyNGRcXHUxMjUwLVxcdTEyNTZcXHUxMjU4XFx1MTI1YS1cXHUxMjVkXFx1MTI2MC1cXHUxMjg4XFx1MTI4YS1cXHUxMjhkXFx1MTI5MC1cXHUxMmIwXFx1MTJiMi1cXHUxMmI1XFx1MTJiOC1cXHUxMmJlXFx1MTJjMFxcdTEyYzItXFx1MTJjNVxcdTEyYzgtXFx1MTJkNlxcdTEyZDgtXFx1MTMxMFxcdTEzMTItXFx1MTMxNVxcdTEzMTgtXFx1MTM1YVxcdTEzODAtXFx1MTM4ZlxcdTEzYTAtXFx1MTNmNFxcdTE0MDEtXFx1MTY2Y1xcdTE2NmYtXFx1MTY3ZlxcdTE2ODEtXFx1MTY5YVxcdTE2YTAtXFx1MTZlYVxcdTE2ZWUtXFx1MTZmMFxcdTE3MDAtXFx1MTcwY1xcdTE3MGUtXFx1MTcxMVxcdTE3MjAtXFx1MTczMVxcdTE3NDAtXFx1MTc1MVxcdTE3NjAtXFx1MTc2Y1xcdTE3NmUtXFx1MTc3MFxcdTE3ODAtXFx1MTdiM1xcdTE3ZDdcXHUxN2RjXFx1MTgyMC1cXHUxODc3XFx1MTg4MC1cXHUxOGE4XFx1MThhYVxcdTE4YjAtXFx1MThmNVxcdTE5MDAtXFx1MTkxY1xcdTE5NTAtXFx1MTk2ZFxcdTE5NzAtXFx1MTk3NFxcdTE5ODAtXFx1MTlhYlxcdTE5YzEtXFx1MTljN1xcdTFhMDAtXFx1MWExNlxcdTFhMjAtXFx1MWE1NFxcdTFhYTdcXHUxYjA1LVxcdTFiMzNcXHUxYjQ1LVxcdTFiNGJcXHUxYjgzLVxcdTFiYTBcXHUxYmFlXFx1MWJhZlxcdTFiYmEtXFx1MWJlNVxcdTFjMDAtXFx1MWMyM1xcdTFjNGQtXFx1MWM0ZlxcdTFjNWEtXFx1MWM3ZFxcdTFjZTktXFx1MWNlY1xcdTFjZWUtXFx1MWNmMVxcdTFjZjVcXHUxY2Y2XFx1MWQwMC1cXHUxZGJmXFx1MWUwMC1cXHUxZjE1XFx1MWYxOC1cXHUxZjFkXFx1MWYyMC1cXHUxZjQ1XFx1MWY0OC1cXHUxZjRkXFx1MWY1MC1cXHUxZjU3XFx1MWY1OVxcdTFmNWJcXHUxZjVkXFx1MWY1Zi1cXHUxZjdkXFx1MWY4MC1cXHUxZmI0XFx1MWZiNi1cXHUxZmJjXFx1MWZiZVxcdTFmYzItXFx1MWZjNFxcdTFmYzYtXFx1MWZjY1xcdTFmZDAtXFx1MWZkM1xcdTFmZDYtXFx1MWZkYlxcdTFmZTAtXFx1MWZlY1xcdTFmZjItXFx1MWZmNFxcdTFmZjYtXFx1MWZmY1xcdTIwNzFcXHUyMDdmXFx1MjA5MC1cXHUyMDljXFx1MjEwMlxcdTIxMDdcXHUyMTBhLVxcdTIxMTNcXHUyMTE1XFx1MjExOS1cXHUyMTFkXFx1MjEyNFxcdTIxMjZcXHUyMTI4XFx1MjEyYS1cXHUyMTJkXFx1MjEyZi1cXHUyMTM5XFx1MjEzYy1cXHUyMTNmXFx1MjE0NS1cXHUyMTQ5XFx1MjE0ZVxcdTIxNjAtXFx1MjE4OFxcdTJjMDAtXFx1MmMyZVxcdTJjMzAtXFx1MmM1ZVxcdTJjNjAtXFx1MmNlNFxcdTJjZWItXFx1MmNlZVxcdTJjZjJcXHUyY2YzXFx1MmQwMC1cXHUyZDI1XFx1MmQyN1xcdTJkMmRcXHUyZDMwLVxcdTJkNjdcXHUyZDZmXFx1MmQ4MC1cXHUyZDk2XFx1MmRhMC1cXHUyZGE2XFx1MmRhOC1cXHUyZGFlXFx1MmRiMC1cXHUyZGI2XFx1MmRiOC1cXHUyZGJlXFx1MmRjMC1cXHUyZGM2XFx1MmRjOC1cXHUyZGNlXFx1MmRkMC1cXHUyZGQ2XFx1MmRkOC1cXHUyZGRlXFx1MmUyZlxcdTMwMDUtXFx1MzAwN1xcdTMwMjEtXFx1MzAyOVxcdTMwMzEtXFx1MzAzNVxcdTMwMzgtXFx1MzAzY1xcdTMwNDEtXFx1MzA5NlxcdTMwOWQtXFx1MzA5ZlxcdTMwYTEtXFx1MzBmYVxcdTMwZmMtXFx1MzBmZlxcdTMxMDUtXFx1MzEyZFxcdTMxMzEtXFx1MzE4ZVxcdTMxYTAtXFx1MzFiYVxcdTMxZjAtXFx1MzFmZlxcdTM0MDAtXFx1NGRiNVxcdTRlMDAtXFx1OWZjY1xcdWEwMDAtXFx1YTQ4Y1xcdWE0ZDAtXFx1YTRmZFxcdWE1MDAtXFx1YTYwY1xcdWE2MTAtXFx1YTYxZlxcdWE2MmFcXHVhNjJiXFx1YTY0MC1cXHVhNjZlXFx1YTY3Zi1cXHVhNjk3XFx1YTZhMC1cXHVhNmVmXFx1YTcxNy1cXHVhNzFmXFx1YTcyMi1cXHVhNzg4XFx1YTc4Yi1cXHVhNzhlXFx1YTc5MC1cXHVhNzkzXFx1YTdhMC1cXHVhN2FhXFx1YTdmOC1cXHVhODAxXFx1YTgwMy1cXHVhODA1XFx1YTgwNy1cXHVhODBhXFx1YTgwYy1cXHVhODIyXFx1YTg0MC1cXHVhODczXFx1YTg4Mi1cXHVhOGIzXFx1YThmMi1cXHVhOGY3XFx1YThmYlxcdWE5MGEtXFx1YTkyNVxcdWE5MzAtXFx1YTk0NlxcdWE5NjAtXFx1YTk3Y1xcdWE5ODQtXFx1YTliMlxcdWE5Y2ZcXHVhYTAwLVxcdWFhMjhcXHVhYTQwLVxcdWFhNDJcXHVhYTQ0LVxcdWFhNGJcXHVhYTYwLVxcdWFhNzZcXHVhYTdhXFx1YWE4MC1cXHVhYWFmXFx1YWFiMVxcdWFhYjVcXHVhYWI2XFx1YWFiOS1cXHVhYWJkXFx1YWFjMFxcdWFhYzJcXHVhYWRiLVxcdWFhZGRcXHVhYWUwLVxcdWFhZWFcXHVhYWYyLVxcdWFhZjRcXHVhYjAxLVxcdWFiMDZcXHVhYjA5LVxcdWFiMGVcXHVhYjExLVxcdWFiMTZcXHVhYjIwLVxcdWFiMjZcXHVhYjI4LVxcdWFiMmVcXHVhYmMwLVxcdWFiZTJcXHVhYzAwLVxcdWQ3YTNcXHVkN2IwLVxcdWQ3YzZcXHVkN2NiLVxcdWQ3ZmJcXHVmOTAwLVxcdWZhNmRcXHVmYTcwLVxcdWZhZDlcXHVmYjAwLVxcdWZiMDZcXHVmYjEzLVxcdWZiMTdcXHVmYjFkXFx1ZmIxZi1cXHVmYjI4XFx1ZmIyYS1cXHVmYjM2XFx1ZmIzOC1cXHVmYjNjXFx1ZmIzZVxcdWZiNDBcXHVmYjQxXFx1ZmI0M1xcdWZiNDRcXHVmYjQ2LVxcdWZiYjFcXHVmYmQzLVxcdWZkM2RcXHVmZDUwLVxcdWZkOGZcXHVmZDkyLVxcdWZkYzdcXHVmZGYwLVxcdWZkZmJcXHVmZTcwLVxcdWZlNzRcXHVmZTc2LVxcdWZlZmNcXHVmZjIxLVxcdWZmM2FcXHVmZjQxLVxcdWZmNWFcXHVmZjY2LVxcdWZmYmVcXHVmZmMyLVxcdWZmYzdcXHVmZmNhLVxcdWZmY2ZcXHVmZmQyLVxcdWZmZDdcXHVmZmRhLVxcdWZmZGNdWyRBLVpcXF9hLXpcXHhhYVxceGI1XFx4YmFcXHhjMC1cXHhkNlxceGQ4LVxceGY2XFx4ZjgtXFx1MDJjMVxcdTAyYzYtXFx1MDJkMVxcdTAyZTAtXFx1MDJlNFxcdTAyZWNcXHUwMmVlXFx1MDM3MC1cXHUwMzc0XFx1MDM3NlxcdTAzNzdcXHUwMzdhLVxcdTAzN2RcXHUwMzg2XFx1MDM4OC1cXHUwMzhhXFx1MDM4Y1xcdTAzOGUtXFx1MDNhMVxcdTAzYTMtXFx1MDNmNVxcdTAzZjctXFx1MDQ4MVxcdTA0OGEtXFx1MDUyN1xcdTA1MzEtXFx1MDU1NlxcdTA1NTlcXHUwNTYxLVxcdTA1ODdcXHUwNWQwLVxcdTA1ZWFcXHUwNWYwLVxcdTA1ZjJcXHUwNjIwLVxcdTA2NGFcXHUwNjZlXFx1MDY2ZlxcdTA2NzEtXFx1MDZkM1xcdTA2ZDVcXHUwNmU1XFx1MDZlNlxcdTA2ZWVcXHUwNmVmXFx1MDZmYS1cXHUwNmZjXFx1MDZmZlxcdTA3MTBcXHUwNzEyLVxcdTA3MmZcXHUwNzRkLVxcdTA3YTVcXHUwN2IxXFx1MDdjYS1cXHUwN2VhXFx1MDdmNFxcdTA3ZjVcXHUwN2ZhXFx1MDgwMC1cXHUwODE1XFx1MDgxYVxcdTA4MjRcXHUwODI4XFx1MDg0MC1cXHUwODU4XFx1MDhhMFxcdTA4YTItXFx1MDhhY1xcdTA5MDQtXFx1MDkzOVxcdTA5M2RcXHUwOTUwXFx1MDk1OC1cXHUwOTYxXFx1MDk3MS1cXHUwOTc3XFx1MDk3OS1cXHUwOTdmXFx1MDk4NS1cXHUwOThjXFx1MDk4ZlxcdTA5OTBcXHUwOTkzLVxcdTA5YThcXHUwOWFhLVxcdTA5YjBcXHUwOWIyXFx1MDliNi1cXHUwOWI5XFx1MDliZFxcdTA5Y2VcXHUwOWRjXFx1MDlkZFxcdTA5ZGYtXFx1MDllMVxcdTA5ZjBcXHUwOWYxXFx1MGEwNS1cXHUwYTBhXFx1MGEwZlxcdTBhMTBcXHUwYTEzLVxcdTBhMjhcXHUwYTJhLVxcdTBhMzBcXHUwYTMyXFx1MGEzM1xcdTBhMzVcXHUwYTM2XFx1MGEzOFxcdTBhMzlcXHUwYTU5LVxcdTBhNWNcXHUwYTVlXFx1MGE3Mi1cXHUwYTc0XFx1MGE4NS1cXHUwYThkXFx1MGE4Zi1cXHUwYTkxXFx1MGE5My1cXHUwYWE4XFx1MGFhYS1cXHUwYWIwXFx1MGFiMlxcdTBhYjNcXHUwYWI1LVxcdTBhYjlcXHUwYWJkXFx1MGFkMFxcdTBhZTBcXHUwYWUxXFx1MGIwNS1cXHUwYjBjXFx1MGIwZlxcdTBiMTBcXHUwYjEzLVxcdTBiMjhcXHUwYjJhLVxcdTBiMzBcXHUwYjMyXFx1MGIzM1xcdTBiMzUtXFx1MGIzOVxcdTBiM2RcXHUwYjVjXFx1MGI1ZFxcdTBiNWYtXFx1MGI2MVxcdTBiNzFcXHUwYjgzXFx1MGI4NS1cXHUwYjhhXFx1MGI4ZS1cXHUwYjkwXFx1MGI5Mi1cXHUwYjk1XFx1MGI5OVxcdTBiOWFcXHUwYjljXFx1MGI5ZVxcdTBiOWZcXHUwYmEzXFx1MGJhNFxcdTBiYTgtXFx1MGJhYVxcdTBiYWUtXFx1MGJiOVxcdTBiZDBcXHUwYzA1LVxcdTBjMGNcXHUwYzBlLVxcdTBjMTBcXHUwYzEyLVxcdTBjMjhcXHUwYzJhLVxcdTBjMzNcXHUwYzM1LVxcdTBjMzlcXHUwYzNkXFx1MGM1OFxcdTBjNTlcXHUwYzYwXFx1MGM2MVxcdTBjODUtXFx1MGM4Y1xcdTBjOGUtXFx1MGM5MFxcdTBjOTItXFx1MGNhOFxcdTBjYWEtXFx1MGNiM1xcdTBjYjUtXFx1MGNiOVxcdTBjYmRcXHUwY2RlXFx1MGNlMFxcdTBjZTFcXHUwY2YxXFx1MGNmMlxcdTBkMDUtXFx1MGQwY1xcdTBkMGUtXFx1MGQxMFxcdTBkMTItXFx1MGQzYVxcdTBkM2RcXHUwZDRlXFx1MGQ2MFxcdTBkNjFcXHUwZDdhLVxcdTBkN2ZcXHUwZDg1LVxcdTBkOTZcXHUwZDlhLVxcdTBkYjFcXHUwZGIzLVxcdTBkYmJcXHUwZGJkXFx1MGRjMC1cXHUwZGM2XFx1MGUwMS1cXHUwZTMwXFx1MGUzMlxcdTBlMzNcXHUwZTQwLVxcdTBlNDZcXHUwZTgxXFx1MGU4MlxcdTBlODRcXHUwZTg3XFx1MGU4OFxcdTBlOGFcXHUwZThkXFx1MGU5NC1cXHUwZTk3XFx1MGU5OS1cXHUwZTlmXFx1MGVhMS1cXHUwZWEzXFx1MGVhNVxcdTBlYTdcXHUwZWFhXFx1MGVhYlxcdTBlYWQtXFx1MGViMFxcdTBlYjJcXHUwZWIzXFx1MGViZFxcdTBlYzAtXFx1MGVjNFxcdTBlYzZcXHUwZWRjLVxcdTBlZGZcXHUwZjAwXFx1MGY0MC1cXHUwZjQ3XFx1MGY0OS1cXHUwZjZjXFx1MGY4OC1cXHUwZjhjXFx1MTAwMC1cXHUxMDJhXFx1MTAzZlxcdTEwNTAtXFx1MTA1NVxcdTEwNWEtXFx1MTA1ZFxcdTEwNjFcXHUxMDY1XFx1MTA2NlxcdTEwNmUtXFx1MTA3MFxcdTEwNzUtXFx1MTA4MVxcdTEwOGVcXHUxMGEwLVxcdTEwYzVcXHUxMGM3XFx1MTBjZFxcdTEwZDAtXFx1MTBmYVxcdTEwZmMtXFx1MTI0OFxcdTEyNGEtXFx1MTI0ZFxcdTEyNTAtXFx1MTI1NlxcdTEyNThcXHUxMjVhLVxcdTEyNWRcXHUxMjYwLVxcdTEyODhcXHUxMjhhLVxcdTEyOGRcXHUxMjkwLVxcdTEyYjBcXHUxMmIyLVxcdTEyYjVcXHUxMmI4LVxcdTEyYmVcXHUxMmMwXFx1MTJjMi1cXHUxMmM1XFx1MTJjOC1cXHUxMmQ2XFx1MTJkOC1cXHUxMzEwXFx1MTMxMi1cXHUxMzE1XFx1MTMxOC1cXHUxMzVhXFx1MTM4MC1cXHUxMzhmXFx1MTNhMC1cXHUxM2Y0XFx1MTQwMS1cXHUxNjZjXFx1MTY2Zi1cXHUxNjdmXFx1MTY4MS1cXHUxNjlhXFx1MTZhMC1cXHUxNmVhXFx1MTZlZS1cXHUxNmYwXFx1MTcwMC1cXHUxNzBjXFx1MTcwZS1cXHUxNzExXFx1MTcyMC1cXHUxNzMxXFx1MTc0MC1cXHUxNzUxXFx1MTc2MC1cXHUxNzZjXFx1MTc2ZS1cXHUxNzcwXFx1MTc4MC1cXHUxN2IzXFx1MTdkN1xcdTE3ZGNcXHUxODIwLVxcdTE4NzdcXHUxODgwLVxcdTE4YThcXHUxOGFhXFx1MThiMC1cXHUxOGY1XFx1MTkwMC1cXHUxOTFjXFx1MTk1MC1cXHUxOTZkXFx1MTk3MC1cXHUxOTc0XFx1MTk4MC1cXHUxOWFiXFx1MTljMS1cXHUxOWM3XFx1MWEwMC1cXHUxYTE2XFx1MWEyMC1cXHUxYTU0XFx1MWFhN1xcdTFiMDUtXFx1MWIzM1xcdTFiNDUtXFx1MWI0YlxcdTFiODMtXFx1MWJhMFxcdTFiYWVcXHUxYmFmXFx1MWJiYS1cXHUxYmU1XFx1MWMwMC1cXHUxYzIzXFx1MWM0ZC1cXHUxYzRmXFx1MWM1YS1cXHUxYzdkXFx1MWNlOS1cXHUxY2VjXFx1MWNlZS1cXHUxY2YxXFx1MWNmNVxcdTFjZjZcXHUxZDAwLVxcdTFkYmZcXHUxZTAwLVxcdTFmMTVcXHUxZjE4LVxcdTFmMWRcXHUxZjIwLVxcdTFmNDVcXHUxZjQ4LVxcdTFmNGRcXHUxZjUwLVxcdTFmNTdcXHUxZjU5XFx1MWY1YlxcdTFmNWRcXHUxZjVmLVxcdTFmN2RcXHUxZjgwLVxcdTFmYjRcXHUxZmI2LVxcdTFmYmNcXHUxZmJlXFx1MWZjMi1cXHUxZmM0XFx1MWZjNi1cXHUxZmNjXFx1MWZkMC1cXHUxZmQzXFx1MWZkNi1cXHUxZmRiXFx1MWZlMC1cXHUxZmVjXFx1MWZmMi1cXHUxZmY0XFx1MWZmNi1cXHUxZmZjXFx1MjA3MVxcdTIwN2ZcXHUyMDkwLVxcdTIwOWNcXHUyMTAyXFx1MjEwN1xcdTIxMGEtXFx1MjExM1xcdTIxMTVcXHUyMTE5LVxcdTIxMWRcXHUyMTI0XFx1MjEyNlxcdTIxMjhcXHUyMTJhLVxcdTIxMmRcXHUyMTJmLVxcdTIxMzlcXHUyMTNjLVxcdTIxM2ZcXHUyMTQ1LVxcdTIxNDlcXHUyMTRlXFx1MjE2MC1cXHUyMTg4XFx1MmMwMC1cXHUyYzJlXFx1MmMzMC1cXHUyYzVlXFx1MmM2MC1cXHUyY2U0XFx1MmNlYi1cXHUyY2VlXFx1MmNmMlxcdTJjZjNcXHUyZDAwLVxcdTJkMjVcXHUyZDI3XFx1MmQyZFxcdTJkMzAtXFx1MmQ2N1xcdTJkNmZcXHUyZDgwLVxcdTJkOTZcXHUyZGEwLVxcdTJkYTZcXHUyZGE4LVxcdTJkYWVcXHUyZGIwLVxcdTJkYjZcXHUyZGI4LVxcdTJkYmVcXHUyZGMwLVxcdTJkYzZcXHUyZGM4LVxcdTJkY2VcXHUyZGQwLVxcdTJkZDZcXHUyZGQ4LVxcdTJkZGVcXHUyZTJmXFx1MzAwNS1cXHUzMDA3XFx1MzAyMS1cXHUzMDI5XFx1MzAzMS1cXHUzMDM1XFx1MzAzOC1cXHUzMDNjXFx1MzA0MS1cXHUzMDk2XFx1MzA5ZC1cXHUzMDlmXFx1MzBhMS1cXHUzMGZhXFx1MzBmYy1cXHUzMGZmXFx1MzEwNS1cXHUzMTJkXFx1MzEzMS1cXHUzMThlXFx1MzFhMC1cXHUzMWJhXFx1MzFmMC1cXHUzMWZmXFx1MzQwMC1cXHU0ZGI1XFx1NGUwMC1cXHU5ZmNjXFx1YTAwMC1cXHVhNDhjXFx1YTRkMC1cXHVhNGZkXFx1YTUwMC1cXHVhNjBjXFx1YTYxMC1cXHVhNjFmXFx1YTYyYVxcdWE2MmJcXHVhNjQwLVxcdWE2NmVcXHVhNjdmLVxcdWE2OTdcXHVhNmEwLVxcdWE2ZWZcXHVhNzE3LVxcdWE3MWZcXHVhNzIyLVxcdWE3ODhcXHVhNzhiLVxcdWE3OGVcXHVhNzkwLVxcdWE3OTNcXHVhN2EwLVxcdWE3YWFcXHVhN2Y4LVxcdWE4MDFcXHVhODAzLVxcdWE4MDVcXHVhODA3LVxcdWE4MGFcXHVhODBjLVxcdWE4MjJcXHVhODQwLVxcdWE4NzNcXHVhODgyLVxcdWE4YjNcXHVhOGYyLVxcdWE4ZjdcXHVhOGZiXFx1YTkwYS1cXHVhOTI1XFx1YTkzMC1cXHVhOTQ2XFx1YTk2MC1cXHVhOTdjXFx1YTk4NC1cXHVhOWIyXFx1YTljZlxcdWFhMDAtXFx1YWEyOFxcdWFhNDAtXFx1YWE0MlxcdWFhNDQtXFx1YWE0YlxcdWFhNjAtXFx1YWE3NlxcdWFhN2FcXHVhYTgwLVxcdWFhYWZcXHVhYWIxXFx1YWFiNVxcdWFhYjZcXHVhYWI5LVxcdWFhYmRcXHVhYWMwXFx1YWFjMlxcdWFhZGItXFx1YWFkZFxcdWFhZTAtXFx1YWFlYVxcdWFhZjItXFx1YWFmNFxcdWFiMDEtXFx1YWIwNlxcdWFiMDktXFx1YWIwZVxcdWFiMTEtXFx1YWIxNlxcdWFiMjAtXFx1YWIyNlxcdWFiMjgtXFx1YWIyZVxcdWFiYzAtXFx1YWJlMlxcdWFjMDAtXFx1ZDdhM1xcdWQ3YjAtXFx1ZDdjNlxcdWQ3Y2ItXFx1ZDdmYlxcdWY5MDAtXFx1ZmE2ZFxcdWZhNzAtXFx1ZmFkOVxcdWZiMDAtXFx1ZmIwNlxcdWZiMTMtXFx1ZmIxN1xcdWZiMWRcXHVmYjFmLVxcdWZiMjhcXHVmYjJhLVxcdWZiMzZcXHVmYjM4LVxcdWZiM2NcXHVmYjNlXFx1ZmI0MFxcdWZiNDFcXHVmYjQzXFx1ZmI0NFxcdWZiNDYtXFx1ZmJiMVxcdWZiZDMtXFx1ZmQzZFxcdWZkNTAtXFx1ZmQ4ZlxcdWZkOTItXFx1ZmRjN1xcdWZkZjAtXFx1ZmRmYlxcdWZlNzAtXFx1ZmU3NFxcdWZlNzYtXFx1ZmVmY1xcdWZmMjEtXFx1ZmYzYVxcdWZmNDEtXFx1ZmY1YVxcdWZmNjYtXFx1ZmZiZVxcdWZmYzItXFx1ZmZjN1xcdWZmY2EtXFx1ZmZjZlxcdWZmZDItXFx1ZmZkN1xcdWZmZGEtXFx1ZmZkYzAtOVxcdTAzMDAtXFx1MDM2ZlxcdTA0ODMtXFx1MDQ4N1xcdTA1OTEtXFx1MDViZFxcdTA1YmZcXHUwNWMxXFx1MDVjMlxcdTA1YzRcXHUwNWM1XFx1MDVjN1xcdTA2MTAtXFx1MDYxYVxcdTA2NGItXFx1MDY2OVxcdTA2NzBcXHUwNmQ2LVxcdTA2ZGNcXHUwNmRmLVxcdTA2ZTRcXHUwNmU3XFx1MDZlOFxcdTA2ZWEtXFx1MDZlZFxcdTA2ZjAtXFx1MDZmOVxcdTA3MTFcXHUwNzMwLVxcdTA3NGFcXHUwN2E2LVxcdTA3YjBcXHUwN2MwLVxcdTA3YzlcXHUwN2ViLVxcdTA3ZjNcXHUwODE2LVxcdTA4MTlcXHUwODFiLVxcdTA4MjNcXHUwODI1LVxcdTA4MjdcXHUwODI5LVxcdTA4MmRcXHUwODU5LVxcdTA4NWJcXHUwOGU0LVxcdTA4ZmVcXHUwOTAwLVxcdTA5MDNcXHUwOTNhLVxcdTA5M2NcXHUwOTNlLVxcdTA5NGZcXHUwOTUxLVxcdTA5NTdcXHUwOTYyXFx1MDk2M1xcdTA5NjYtXFx1MDk2ZlxcdTA5ODEtXFx1MDk4M1xcdTA5YmNcXHUwOWJlLVxcdTA5YzRcXHUwOWM3XFx1MDljOFxcdTA5Y2ItXFx1MDljZFxcdTA5ZDdcXHUwOWUyXFx1MDllM1xcdTA5ZTYtXFx1MDllZlxcdTBhMDEtXFx1MGEwM1xcdTBhM2NcXHUwYTNlLVxcdTBhNDJcXHUwYTQ3XFx1MGE0OFxcdTBhNGItXFx1MGE0ZFxcdTBhNTFcXHUwYTY2LVxcdTBhNzFcXHUwYTc1XFx1MGE4MS1cXHUwYTgzXFx1MGFiY1xcdTBhYmUtXFx1MGFjNVxcdTBhYzctXFx1MGFjOVxcdTBhY2ItXFx1MGFjZFxcdTBhZTJcXHUwYWUzXFx1MGFlNi1cXHUwYWVmXFx1MGIwMS1cXHUwYjAzXFx1MGIzY1xcdTBiM2UtXFx1MGI0NFxcdTBiNDdcXHUwYjQ4XFx1MGI0Yi1cXHUwYjRkXFx1MGI1NlxcdTBiNTdcXHUwYjYyXFx1MGI2M1xcdTBiNjYtXFx1MGI2ZlxcdTBiODJcXHUwYmJlLVxcdTBiYzJcXHUwYmM2LVxcdTBiYzhcXHUwYmNhLVxcdTBiY2RcXHUwYmQ3XFx1MGJlNi1cXHUwYmVmXFx1MGMwMS1cXHUwYzAzXFx1MGMzZS1cXHUwYzQ0XFx1MGM0Ni1cXHUwYzQ4XFx1MGM0YS1cXHUwYzRkXFx1MGM1NVxcdTBjNTZcXHUwYzYyXFx1MGM2M1xcdTBjNjYtXFx1MGM2ZlxcdTBjODJcXHUwYzgzXFx1MGNiY1xcdTBjYmUtXFx1MGNjNFxcdTBjYzYtXFx1MGNjOFxcdTBjY2EtXFx1MGNjZFxcdTBjZDVcXHUwY2Q2XFx1MGNlMlxcdTBjZTNcXHUwY2U2LVxcdTBjZWZcXHUwZDAyXFx1MGQwM1xcdTBkM2UtXFx1MGQ0NFxcdTBkNDYtXFx1MGQ0OFxcdTBkNGEtXFx1MGQ0ZFxcdTBkNTdcXHUwZDYyXFx1MGQ2M1xcdTBkNjYtXFx1MGQ2ZlxcdTBkODJcXHUwZDgzXFx1MGRjYVxcdTBkY2YtXFx1MGRkNFxcdTBkZDZcXHUwZGQ4LVxcdTBkZGZcXHUwZGYyXFx1MGRmM1xcdTBlMzFcXHUwZTM0LVxcdTBlM2FcXHUwZTQ3LVxcdTBlNGVcXHUwZTUwLVxcdTBlNTlcXHUwZWIxXFx1MGViNC1cXHUwZWI5XFx1MGViYlxcdTBlYmNcXHUwZWM4LVxcdTBlY2RcXHUwZWQwLVxcdTBlZDlcXHUwZjE4XFx1MGYxOVxcdTBmMjAtXFx1MGYyOVxcdTBmMzVcXHUwZjM3XFx1MGYzOVxcdTBmM2VcXHUwZjNmXFx1MGY3MS1cXHUwZjg0XFx1MGY4NlxcdTBmODdcXHUwZjhkLVxcdTBmOTdcXHUwZjk5LVxcdTBmYmNcXHUwZmM2XFx1MTAyYi1cXHUxMDNlXFx1MTA0MC1cXHUxMDQ5XFx1MTA1Ni1cXHUxMDU5XFx1MTA1ZS1cXHUxMDYwXFx1MTA2Mi1cXHUxMDY0XFx1MTA2Ny1cXHUxMDZkXFx1MTA3MS1cXHUxMDc0XFx1MTA4Mi1cXHUxMDhkXFx1MTA4Zi1cXHUxMDlkXFx1MTM1ZC1cXHUxMzVmXFx1MTcxMi1cXHUxNzE0XFx1MTczMi1cXHUxNzM0XFx1MTc1MlxcdTE3NTNcXHUxNzcyXFx1MTc3M1xcdTE3YjQtXFx1MTdkM1xcdTE3ZGRcXHUxN2UwLVxcdTE3ZTlcXHUxODBiLVxcdTE4MGRcXHUxODEwLVxcdTE4MTlcXHUxOGE5XFx1MTkyMC1cXHUxOTJiXFx1MTkzMC1cXHUxOTNiXFx1MTk0Ni1cXHUxOTRmXFx1MTliMC1cXHUxOWMwXFx1MTljOFxcdTE5YzlcXHUxOWQwLVxcdTE5ZDlcXHUxYTE3LVxcdTFhMWJcXHUxYTU1LVxcdTFhNWVcXHUxYTYwLVxcdTFhN2NcXHUxYTdmLVxcdTFhODlcXHUxYTkwLVxcdTFhOTlcXHUxYjAwLVxcdTFiMDRcXHUxYjM0LVxcdTFiNDRcXHUxYjUwLVxcdTFiNTlcXHUxYjZiLVxcdTFiNzNcXHUxYjgwLVxcdTFiODJcXHUxYmExLVxcdTFiYWRcXHUxYmIwLVxcdTFiYjlcXHUxYmU2LVxcdTFiZjNcXHUxYzI0LVxcdTFjMzdcXHUxYzQwLVxcdTFjNDlcXHUxYzUwLVxcdTFjNTlcXHUxY2QwLVxcdTFjZDJcXHUxY2Q0LVxcdTFjZThcXHUxY2VkXFx1MWNmMi1cXHUxY2Y0XFx1MWRjMC1cXHUxZGU2XFx1MWRmYy1cXHUxZGZmXFx1MjAwY1xcdTIwMGRcXHUyMDNmXFx1MjA0MFxcdTIwNTRcXHUyMGQwLVxcdTIwZGNcXHUyMGUxXFx1MjBlNS1cXHUyMGYwXFx1MmNlZi1cXHUyY2YxXFx1MmQ3ZlxcdTJkZTAtXFx1MmRmZlxcdTMwMmEtXFx1MzAyZlxcdTMwOTlcXHUzMDlhXFx1YTYyMC1cXHVhNjI5XFx1YTY2ZlxcdWE2NzQtXFx1YTY3ZFxcdWE2OWZcXHVhNmYwXFx1YTZmMVxcdWE4MDJcXHVhODA2XFx1YTgwYlxcdWE4MjMtXFx1YTgyN1xcdWE4ODBcXHVhODgxXFx1YThiNC1cXHVhOGM0XFx1YThkMC1cXHVhOGQ5XFx1YThlMC1cXHVhOGYxXFx1YTkwMC1cXHVhOTA5XFx1YTkyNi1cXHVhOTJkXFx1YTk0Ny1cXHVhOTUzXFx1YTk4MC1cXHVhOTgzXFx1YTliMy1cXHVhOWMwXFx1YTlkMC1cXHVhOWQ5XFx1YWEyOS1cXHVhYTM2XFx1YWE0M1xcdWFhNGNcXHVhYTRkXFx1YWE1MC1cXHVhYTU5XFx1YWE3YlxcdWFhYjBcXHVhYWIyLVxcdWFhYjRcXHVhYWI3XFx1YWFiOFxcdWFhYmVcXHVhYWJmXFx1YWFjMVxcdWFhZWItXFx1YWFlZlxcdWFhZjVcXHVhYWY2XFx1YWJlMy1cXHVhYmVhXFx1YWJlY1xcdWFiZWRcXHVhYmYwLVxcdWFiZjlcXHVmYjFlXFx1ZmUwMC1cXHVmZTBmXFx1ZmUyMC1cXHVmZTI2XFx1ZmUzM1xcdWZlMzRcXHVmZTRkLVxcdWZlNGZcXHVmZjEwLVxcdWZmMTlcXHVmZjNmXSovZ2kpO1xuICB9LFxuICBldmFsSW5Db250ZXh0OiBmdW5jdGlvbiAoanMpIHtcbiAgICBqcyA9IGpzLnJlcGxhY2UoL1xccysvZywgJycpO1xuXG5cbiAgICB2YXIga2V5cyA9IFtdLCB2YWx1ZXMgPSBbXTtcblxuICAgIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBrZXlzID0ga2V5cy5jb25jYXQoT2JqZWN0LmtleXMoYXJndW1lbnRzW2ldKSk7XG4gICAgICBmb3IgKHZhciBqIGluIGFyZ3VtZW50c1tpXSkge1xuICAgICAgICB2YWx1ZXMucHVzaChhcmd1bWVudHNbaV1bal0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vXG4gICAgLy9pZihfLmlzQ29ycmVjdFZhcmlhYmxlTmFtZShqcykgJiYga2V5cy5pbmRleE9mKGpzKSA9PT0gLTEpe1xuICAgIC8vICBrZXlzLnB1c2goanMpO1xuICAgIC8vICB2YWx1ZXMucHVzaCh1bmRlZmluZWQpO1xuICAgIC8vfVxuXG4gICAgdmFyIGFyciA9IHV0aWxzLmV4dHJhY3RWYXJpYWJsZXMoanMpO1xuICAgIC8vY29uc29sZS5sb2coYXJyKTtcbiAgICBmb3IgKHZhciBpIGluIGFycikge1xuICAgICAgaWYgKGtleXMuaW5kZXhPZihhcnJbaV0pID09PSAtMSkge1xuICAgICAgICBrZXlzLnB1c2goYXJyW2ldKTtcbiAgICAgICAgdmFsdWVzLnB1c2godW5kZWZpbmVkKTtcbiAgICAgIH1cbiAgICB9XG4gICAganMgPSBcInZhciBmb28gPSBmdW5jdGlvbihcIiArIGtleXMuam9pbihcIixcIikgKyBcIil7IHZhciBfX3JldHVybl9fdmFsdWUgPSBcIiArIGpzICsgXCIgO3JldHVybiBfX3JldHVybl9fdmFsdWU7fTsgZm9vO1wiO1xuICAgIHRyeSB7XG4gICAgICB2YXIgZm9vID0gZXZhbChqcyk7XG4gICAgICByZXR1cm4gZm9vLmFwcGx5KHRoaXMsIHZhbHVlcyk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgfSxcbiAgY29tcGlsZUVsZW1lbnQ6IGZ1bmN0aW9uICgkaXRlbSwgc2NvcGUpIHtcblxuICAgIGZ1bmN0aW9uIF9lYWNoU2VsZihlbCwgc2VsZWN0b3IsIGZvbykge1xuICAgICAgZWwuZmluZChzZWxlY3RvcikuZWFjaChmb28pO1xuICAgICAgaWYgKGVsLmlzKHNlbGVjdG9yKSkge1xuICAgICAgICBmb28uY2FsbChlbFswXSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8uYWRkQmFjaygnc2VsZWN0b3InKVxuICAgIF9lYWNoU2VsZigkaXRlbSwgXCJbb25jbGlja11cIiwgZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIG9uQ2xpY2sgPSAkKHRoaXMpLmF0dHIoXCJvbmNsaWNrXCIpO1xuICAgICAgJCh0aGlzKS5yZW1vdmVBdHRyKFwib25jbGlja1wiKTtcbiAgICAgICQodGhpcykuY2xpY2soZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIHV0aWxzLmV2YWxJbkNvbnRleHQob25DbGljaywgc2NvcGUsIHtldmVudDogZXZlbnR9KTtcbiAgICAgIH0pXG4gICAgfSlcblxuXG4gICAgX2VhY2hTZWxmKCRpdGVtLCBcIltvbmNoYW5nZV1cIiwgZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIG9uQ2hhbmdlID0gJCh0aGlzKS5hdHRyKFwib25jaGFuZ2VcIik7XG4gICAgICAkKHRoaXMpLnJlbW92ZUF0dHIoXCJvbmNoYW5nZVwiKTtcbiAgICAgICQodGhpcykuY2hhbmdlKGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICB1dGlscy5ldmFsSW5Db250ZXh0KG9uQ2hhbmdlLCBzY29wZSwge2V2ZW50OiBldmVudH0pO1xuICAgICAgfSlcbiAgICB9KTtcblxuICAgIF9lYWNoU2VsZigkaXRlbSwgXCJbZHAtY2hlY2tlZF1cIiwgZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIF92YWwgPSAkKHRoaXMpLmF0dHIoXCJkcC1jaGVja2VkXCIpO1xuICAgICAgdmFyIHZhbCA9IHV0aWxzLmV2YWxJbkNvbnRleHQoX3ZhbCwgc2NvcGUpO1xuICAgICAgaWYgKHZhbCkge1xuICAgICAgICAkKHRoaXMpLmF0dHIoXCJjaGVja2VkXCIsIFwiY2hlY2tlZFwiKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgICQodGhpcykucmVtb3ZlQXR0cihcImNoZWNrZWRcIik7XG4gICAgICB9XG5cbiAgICB9KTtcbiAgICBfZWFjaFNlbGYoJGl0ZW0sIFwiW2RwLXNyY11cIiwgZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIF92YWwgPSAkKHRoaXMpLmF0dHIoXCJkcC1zcmNcIik7XG4gICAgICB2YXIgdmFsID0gdXRpbHMuZXZhbEluQ29udGV4dChfdmFsLCBzY29wZSk7XG4gICAgICBpZiAodmFsKSB7XG4gICAgICAgICQodGhpcykuYXR0cihcInNyY1wiLCB2YWwpO1xuICAgICAgfVxuXG4gICAgfSk7XG4gICAgX2VhY2hTZWxmKCRpdGVtLCBcIltkcC1pZl1cIiwgZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIF92YWwgPSAkKHRoaXMpLmF0dHIoXCJkcC1pZlwiKTtcbiAgICAgIGlmIChfdmFsID09PSBcImZhbHNlXCIpIHtcbiAgICAgICAgJCh0aGlzKS5yZW1vdmUoKTtcbiAgICAgIH1cbiAgICAgIGlmIChfdmFsID09PSBcInRydWVcIikge1xuXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgdmFsID0gdXRpbHMuZXZhbEluQ29udGV4dChfdmFsLCBzY29wZSk7XG4gICAgICAgIGlmICghdmFsKSB7XG4gICAgICAgICAgJCh0aGlzKS5yZW1vdmUoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICAgIF9lYWNoU2VsZigkaXRlbSwgXCJbZHAtaW5jbHVkZV1cIiwgZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIF9lbCA9ICQodGhpcyk7XG4gICAgICB2YXIgX3ZhbCA9IF9lbC5hdHRyKFwiZHAtaW5jbHVkZVwiKTtcbiAgICAgIHZhciB2YWwgPSB1dGlscy5ldmFsSW5Db250ZXh0KF92YWwsIHNjb3BlKTtcbiAgICAgIF9lbC5sb2FkKHZhbCk7XG4gICAgfSk7XG4gIH0sXG4gIHBhcnNlVGVtcGxhdGU6IGZ1bmN0aW9uICh0cGwsIHNjb3BlKSB7XG4gICAgdmFyICRpdGVtID0gJCh0cGwuZm9ybWF0KHNjb3BlKSk7XG4gICAgXy5jb21waWxlRWxlbWVudCgkaXRlbSwgc2NvcGUpO1xuICAgIHJldHVybiAkaXRlbTtcbiAgfVxufTtcbm1vZHVsZS5leHBvcnRzID0gdXRpbHM7XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL3V0aWwvY29tcGlsZS5qc1xuLy8gbW9kdWxlIGlkID0gNVxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCJtb2R1bGUuZXhwb3J0cyA9IHtcbiAgcmVzb2x2ZTogZnVuY3Rpb24gKHBhdGgpIHtcbiAgICB2YXIgY2h1bmtzID0gcGF0aC5zcGxpdChcIi9cIik7XG4gICAgdmFyIHByZXYgPSAwO1xuICAgIGZvciAodmFyIGkgPSBjaHVua3MubGVuZ3RoOyBpLS0gPiAwOykge1xuICAgICAgaWYgKGNodW5rc1tpXSA9PSBcIi4uXCIpIHtcbiAgICAgICAgcHJldisrO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgd2hpbGUgKHByZXYgPiAwKSB7XG4gICAgICAgICAgY2h1bmtzLnNwbGljZShpLCAxKTtcbiAgICAgICAgICBjaHVua3Muc3BsaWNlKGktLSwgMSk7XG4gICAgICAgICAgcHJldi0tO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBjaHVua3Muam9pbihcIi9cIik7XG4gIH0sXG4gIGdldFBhcmVudERpcmVjdG9yeVVybDogZnVuY3Rpb24gKHVybCkge1xuICAgIHJldHVybiB1cmwuc3Vic3RyKDAsIHVybC5sYXN0SW5kZXhPZihcIi9cIikgKyAxKTtcbiAgfVxufVxuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi91dGlsL3BhdGguanNcbi8vIG1vZHVsZSBpZCA9IDZcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiJ3VzZSBzdHJpY3QnO1xuXG52YXIgQmV6aWVyID0gcmVxdWlyZShcIi4uL3BsdWdpbnMvYmV6aWVyXCIpO1xucmVxdWlyZShcIi4vLi4vbWl4aW5zL1NoYXBlTWl4aW5cIik7XG5cbmZhYnJpYy5CZXppZXJNaXhpbiA9IHtcbiAgY3VydmVDb3JuZXJTaXplOiA0LFxuICBjdXJ2ZUNvcm5lclN0eWxlOiBcInJlY3RcIixcbiAgb3V0bGluZVRvcDogMCxcbiAgb3V0bGluZUJvdHRvbTogMCxcblxuXG4gIF9yZW5kZXJCZXppZXI6IGZ1bmN0aW9uIChjdHgsX291dGxpbmUgLHgseSkge1xuICAgIF9vdXRsaW5lID0gX291dGxpbmUgfHwgdGhpcy5vdXRsaW5lO1xuICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgIC8vIGN0eC5zYXZlKCk7XG4gICAgLy8gY3R4LnRyYW5zbGF0ZSh0aGlzLl90cmFuc2FsYXRlLngsIHRoaXMuX3RyYW5zYWxhdGUueSk7XG4gICAgdmFyIGRvYyA9IGZ1bmN0aW9uIChjKSB7XG4gICAgICBfdGhpcy5kcmF3Q3VydmUoY3R4LCBjKTtcbiAgICB9O1xuICAgIF9vdXRsaW5lLmN1cnZlcy5mb3JFYWNoKGRvYyk7XG5cbiAgICBjdHguY2xvc2VQYXRoKCk7XG5cbiAgICB0aGlzLl9yZW5kZXJGaWxsKGN0eCk7XG4gICAgdGhpcy5fcmVuZGVyU3Ryb2tlKGN0eCk7XG4gIH0sXG4gIGRyYXdCZXppZXJDb250cm9sczogZnVuY3Rpb24gKGN0eCwgcDEsIHAyLCBwMywgcDQpIHtcbiAgICB2YXIgcHRzID0gdGhpcy5wb2ludHM7XG4gICAgY3R4LnNhdmUoKTtcbiAgICBjdHguZ2xvYmFsQWxwaGEgPSB0aGlzLmlzTW92aW5nID8gdGhpcy5ib3JkZXJPcGFjaXR5V2hlbk1vdmluZyA6IDE7XG4gICAgY3R4LnN0cm9rZVN0eWxlID0gY3R4LmZpbGxTdHlsZSA9IHRoaXMuY29ybmVyQ29sb3I7XG4gICAgY3R4LnNjYWxlKHRoaXMuY2FudmFzLnZpZXdwb3J0VHJhbnNmb3JtWzBdLCB0aGlzLmNhbnZhcy52aWV3cG9ydFRyYW5zZm9ybVszXSk7XG4gICAgY3R4LnRyYW5zbGF0ZSgtdGhpcy53aWR0aCAvIDIgKiB0aGlzLnNjYWxlWCwgLXRoaXMuaGVpZ2h0IC8gMiAqIHRoaXMuc2NhbGVZKTtcbiAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgY3R4Lm1vdmVUbyhwMS54ICogdGhpcy5zY2FsZVgsIHAxLnkgKiB0aGlzLnNjYWxlWSk7XG4gICAgY3R4LmxpbmVUbyhwMi54ICogdGhpcy5zY2FsZVgsIHAyLnkgKiB0aGlzLnNjYWxlWSk7XG4gICAgaWYgKHB0cy5sZW5ndGggPT09IDMpIHtcbiAgICAgIGN0eC5tb3ZlVG8ocDIueCAqIHRoaXMuc2NhbGVYLCBwMi55ICogdGhpcy5zY2FsZVkpO1xuICAgICAgY3R4LmxpbmVUbyhwMy54ICogdGhpcy5zY2FsZVgsIHAzLnkgKiB0aGlzLnNjYWxlWSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgY3R4Lm1vdmVUbyhwMy54ICogdGhpcy5zY2FsZVgsIHAzLnkgKiB0aGlzLnNjYWxlWSk7XG4gICAgICBjdHgubGluZVRvKHA0LnggKiB0aGlzLnNjYWxlWCwgcDQueSAqIHRoaXMuc2NhbGVZKTtcbiAgICB9XG4gICAgY3R4LmNsb3NlUGF0aCgpO1xuICAgIGN0eC5zdHJva2UoKTtcbiAgICBjdHguc2NhbGUodGhpcy5zY2FsZVgsIHRoaXMuc2NhbGVZKTtcbiAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgdGhpcy5kcmF3Q3VydmUoY3R4LCBwMS5jdXJ2ZSk7XG4gICAgY3R4LnN0cm9rZSgpO1xuICAgIGN0eC5yZXN0b3JlKCk7XG4gIH0sXG4gIGRyYXdDdXJ2ZTogZnVuY3Rpb24gKGN0eCwgY3VydmUsIG9mZnNldCkge1xuICAgIG9mZnNldCA9IG9mZnNldCB8fCB7eDogMCwgeTogMH07XG4gICAgdmFyIG94ID0gb2Zmc2V0Lng7XG4gICAgdmFyIG95ID0gb2Zmc2V0Lnk7XG4gICAgdmFyIHAgPSBjdXJ2ZS5wb2ludHMsIGk7XG4gICAgLy9jdHgubW92ZVRvKHBbMF0ueCArIG94LCBwWzBdLnkgKyBveSk7XG4gICAgY3R4LmxpbmVUbyhwWzBdLnggKyBveCwgcFswXS55ICsgb3kpO1xuICAgIGlmIChwLmxlbmd0aCA9PT0gMykge1xuICAgICAgY3R4LnF1YWRyYXRpY0N1cnZlVG8oXG4gICAgICAgIHBbMV0ueCArIG94LCBwWzFdLnkgKyBveSxcbiAgICAgICAgcFsyXS54ICsgb3gsIHBbMl0ueSArIG95XG4gICAgICApO1xuICAgIH1cbiAgICBpZiAocC5sZW5ndGggPT09IDQpIHtcbiAgICAgIGN0eC5iZXppZXJDdXJ2ZVRvKFxuICAgICAgICBwWzFdLnggKyBveCwgcFsxXS55ICsgb3ksXG4gICAgICAgIHBbMl0ueCArIG94LCBwWzJdLnkgKyBveSxcbiAgICAgICAgcFszXS54ICsgb3gsIHBbM10ueSArIG95XG4gICAgICApO1xuICAgIH1cbiAgfSxcbiAgZHJhd0xpbmU6IGZ1bmN0aW9uIChjdHgsIHAxLCBwMiwgb2Zmc2V0KSB7XG4gICAgb2Zmc2V0ID0gb2Zmc2V0IHx8IHt4OiAwLCB5OiAwfTtcbiAgICB2YXIgb3ggPSBvZmZzZXQueDtcbiAgICB2YXIgb3kgPSBvZmZzZXQueTtcbiAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgY3R4Lm1vdmVUbyhwMS54ICsgb3gsIHAxLnkgKyBveSk7XG4gICAgY3R4LmxpbmVUbyhwMi54ICsgb3gsIHAyLnkgKyBveSk7XG4gICAgY3R4LnN0cm9rZSgpO1xuICB9LFxuICBkcmF3UG9pbnQ6IGZ1bmN0aW9uIChjdHgsIHAsIG9mZnNldCkge1xuICAgIG9mZnNldCA9IG9mZnNldCB8fCB7eDogMCwgeTogMH07XG4gICAgdmFyIG94ID0gb2Zmc2V0Lng7XG4gICAgdmFyIG95ID0gb2Zmc2V0Lnk7XG4gICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgIGN0eC5hcmMocC54ICsgb3gsIHAueSArIG95LCA1LCAwLCAyICogTWF0aC5QSSk7XG4gICAgY3R4LnN0cm9rZSgpO1xuICB9LFxuICBkcmF3UG9pbnRzOiBmdW5jdGlvbiAoY3R4LCBwb2ludHMsIG9mZnNldCkge1xuICAgIG9mZnNldCA9IG9mZnNldCB8fCB7eDogMCwgeTogMH07XG4gICAgcG9pbnRzLmZvckVhY2goZnVuY3Rpb24gKHApIHtcbiAgICAgIHRoaXMuZHJhd0NpcmNsZShjdHgsIHAsIDMsIG9mZnNldCk7XG4gICAgfS5iaW5kKHRoaXMpKTtcbiAgfSxcbiAgZHJhd0FyYzogZnVuY3Rpb24gKGN0eCwgcCwgb2Zmc2V0KSB7XG4gICAgb2Zmc2V0ID0gb2Zmc2V0IHx8IHt4OiAwLCB5OiAwfTtcbiAgICB2YXIgb3ggPSBvZmZzZXQueDtcbiAgICB2YXIgb3kgPSBvZmZzZXQueTtcbiAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgY3R4Lm1vdmVUbyhwLnggKyBveCwgcC55ICsgb3kpO1xuICAgIGN0eC5hcmMocC54ICsgb3gsIHAueSArIG95LCBwLnIsIHAucywgcC5lKTtcbiAgICBjdHgubGluZVRvKHAueCArIG94LCBwLnkgKyBveSk7XG4gICAgY3R4LmZpbGwoKTtcbiAgICBjdHguc3Ryb2tlKCk7XG4gIH0sXG4gIGRyYXdDaXJjbGU6IGZ1bmN0aW9uIChjdHgsIHAsIHIsIG9mZnNldCkge1xuICAgIG9mZnNldCA9IG9mZnNldCB8fCB7eDogMCwgeTogMH07XG4gICAgdmFyIG94ID0gb2Zmc2V0Lng7XG4gICAgdmFyIG95ID0gb2Zmc2V0Lnk7XG4gICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgIGN0eC5hcmMocC54ICsgb3gsIHAueSArIG95LCByLCAwLCAyICogTWF0aC5QSSk7XG4gICAgY3R4LnN0cm9rZSgpO1xuICB9LFxuICBkcmF3YmJveDogZnVuY3Rpb24gKGN0eCwgYmJveCwgb2Zmc2V0KSB7XG4gICAgb2Zmc2V0ID0gb2Zmc2V0IHx8IHt4OiAwLCB5OiAwfTtcbiAgICB2YXIgb3ggPSBvZmZzZXQueDtcbiAgICB2YXIgb3kgPSBvZmZzZXQueTtcbiAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgY3R4Lm1vdmVUbyhiYm94LngubWluICsgb3gsIGJib3gueS5taW4gKyBveSk7XG4gICAgY3R4LmxpbmVUbyhiYm94LngubWluICsgb3gsIGJib3gueS5tYXggKyBveSk7XG4gICAgY3R4LmxpbmVUbyhiYm94LngubWF4ICsgb3gsIGJib3gueS5tYXggKyBveSk7XG4gICAgY3R4LmxpbmVUbyhiYm94LngubWF4ICsgb3gsIGJib3gueS5taW4gKyBveSk7XG4gICAgY3R4LmNsb3NlUGF0aCgpO1xuICAgIGN0eC5zdHJva2UoKTtcbiAgfSxcbiAgZHJhd0h1bGw6IGZ1bmN0aW9uIChjdHgsIGh1bGwsIG9mZnNldCkge1xuICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICBpZiAoaHVsbC5sZW5ndGggPT09IDYpIHtcbiAgICAgIGN0eC5tb3ZlVG8oaHVsbFswXS54LCBodWxsWzBdLnkpO1xuICAgICAgY3R4LmxpbmVUbyhodWxsWzFdLngsIGh1bGxbMV0ueSk7XG4gICAgICBjdHgubGluZVRvKGh1bGxbMl0ueCwgaHVsbFsyXS55KTtcbiAgICAgIGN0eC5tb3ZlVG8oaHVsbFszXS54LCBodWxsWzNdLnkpO1xuICAgICAgY3R4LmxpbmVUbyhodWxsWzRdLngsIGh1bGxbNF0ueSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGN0eC5tb3ZlVG8oaHVsbFswXS54LCBodWxsWzBdLnkpO1xuICAgICAgY3R4LmxpbmVUbyhodWxsWzFdLngsIGh1bGxbMV0ueSk7XG4gICAgICBjdHgubGluZVRvKGh1bGxbMl0ueCwgaHVsbFsyXS55KTtcbiAgICAgIGN0eC5saW5lVG8oaHVsbFszXS54LCBodWxsWzNdLnkpO1xuICAgICAgY3R4Lm1vdmVUbyhodWxsWzRdLngsIGh1bGxbNF0ueSk7XG4gICAgICBjdHgubGluZVRvKGh1bGxbNV0ueCwgaHVsbFs1XS55KTtcbiAgICAgIGN0eC5saW5lVG8oaHVsbFs2XS54LCBodWxsWzZdLnkpO1xuICAgICAgY3R4Lm1vdmVUbyhodWxsWzddLngsIGh1bGxbN10ueSk7XG4gICAgICBjdHgubGluZVRvKGh1bGxbOF0ueCwgaHVsbFs4XS55KTtcbiAgICB9XG4gICAgY3R4LnN0cm9rZSgpO1xuICB9LFxuICBkcmF3U2hhcGU6IGZ1bmN0aW9uIChjdHgsIHNoYXBlLCBvZmZzZXQpIHtcbiAgICBvZmZzZXQgPSBvZmZzZXQgfHwge3g6IDAsIHk6IDB9O1xuICAgIHZhciBvcmRlciA9IHNoYXBlLmZvcndhcmQucG9pbnRzLmxlbmd0aCAtIDE7XG4gICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgIGN0eC5tb3ZlVG8ob2Zmc2V0LnggKyBzaGFwZS5zdGFydGNhcC5wb2ludHNbMF0ueCwgb2Zmc2V0LnkgKyBzaGFwZS5zdGFydGNhcC5wb2ludHNbMF0ueSk7XG4gICAgY3R4LmxpbmVUbyhvZmZzZXQueCArIHNoYXBlLnN0YXJ0Y2FwLnBvaW50c1szXS54LCBvZmZzZXQueSArIHNoYXBlLnN0YXJ0Y2FwLnBvaW50c1szXS55KTtcbiAgICBpZiAob3JkZXIgPT09IDMpIHtcbiAgICAgIGN0eC5iZXppZXJDdXJ2ZVRvKFxuICAgICAgICBvZmZzZXQueCArIHNoYXBlLmZvcndhcmQucG9pbnRzWzFdLngsIG9mZnNldC55ICsgc2hhcGUuZm9yd2FyZC5wb2ludHNbMV0ueSxcbiAgICAgICAgb2Zmc2V0LnggKyBzaGFwZS5mb3J3YXJkLnBvaW50c1syXS54LCBvZmZzZXQueSArIHNoYXBlLmZvcndhcmQucG9pbnRzWzJdLnksXG4gICAgICAgIG9mZnNldC54ICsgc2hhcGUuZm9yd2FyZC5wb2ludHNbM10ueCwgb2Zmc2V0LnkgKyBzaGFwZS5mb3J3YXJkLnBvaW50c1szXS55XG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICBjdHgucXVhZHJhdGljQ3VydmVUbyhcbiAgICAgICAgb2Zmc2V0LnggKyBzaGFwZS5mb3J3YXJkLnBvaW50c1sxXS54LCBvZmZzZXQueSArIHNoYXBlLmZvcndhcmQucG9pbnRzWzFdLnksXG4gICAgICAgIG9mZnNldC54ICsgc2hhcGUuZm9yd2FyZC5wb2ludHNbMl0ueCwgb2Zmc2V0LnkgKyBzaGFwZS5mb3J3YXJkLnBvaW50c1syXS55XG4gICAgICApO1xuICAgIH1cbiAgICBjdHgubGluZVRvKG9mZnNldC54ICsgc2hhcGUuZW5kY2FwLnBvaW50c1szXS54LCBvZmZzZXQueSArIHNoYXBlLmVuZGNhcC5wb2ludHNbM10ueSk7XG4gICAgaWYgKG9yZGVyID09PSAzKSB7XG4gICAgICBjdHguYmV6aWVyQ3VydmVUbyhcbiAgICAgICAgb2Zmc2V0LnggKyBzaGFwZS5iYWNrLnBvaW50c1sxXS54LCBvZmZzZXQueSArIHNoYXBlLmJhY2sucG9pbnRzWzFdLnksXG4gICAgICAgIG9mZnNldC54ICsgc2hhcGUuYmFjay5wb2ludHNbMl0ueCwgb2Zmc2V0LnkgKyBzaGFwZS5iYWNrLnBvaW50c1syXS55LFxuICAgICAgICBvZmZzZXQueCArIHNoYXBlLmJhY2sucG9pbnRzWzNdLngsIG9mZnNldC55ICsgc2hhcGUuYmFjay5wb2ludHNbM10ueVxuICAgICAgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY3R4LnF1YWRyYXRpY0N1cnZlVG8oXG4gICAgICAgIG9mZnNldC54ICsgc2hhcGUuYmFjay5wb2ludHNbMV0ueCwgb2Zmc2V0LnkgKyBzaGFwZS5iYWNrLnBvaW50c1sxXS55LFxuICAgICAgICBvZmZzZXQueCArIHNoYXBlLmJhY2sucG9pbnRzWzJdLngsIG9mZnNldC55ICsgc2hhcGUuYmFjay5wb2ludHNbMl0ueVxuICAgICAgKTtcbiAgICB9XG4gICAgY3R4LmNsb3NlUGF0aCgpO1xuICAgIGN0eC5maWxsKCk7XG4gICAgY3R4LnN0cm9rZSgpO1xuICB9LFxuICAvLyBpbml0QmV6aWVyOiBmdW5jdGlvbiAoKSB7XG4gIC8vICAgdGhpcy5jdXJ2ZSA9IG5ldyBCZXppZXIoMCwgMCwgMCwgMSwgMSwgMSwgMCwgMSk7XG4gIC8vICAgdGhpcy5vdXRsaW5lID0gdGhpcy5jdXJ2ZS5vdXRsaW5lKHRoaXMuYmV6aWVyT3V0bGluZVswXSwgdGhpcy5iZXppZXJPdXRsaW5lWzFdKTtcbiAgLy8gfSxcbiAgLy8gYmV6aWVyVHlwZTogXCJxdWFkcmF0aWNCeVBvaW50c1wiLFxuICAvLyBkZWZhdWx0U2hhcGU6IFwiYXJjXCIsLy9saW5lXG4gIHNldFBvaW50czogZnVuY3Rpb24gKHBvaW50cykge1xuXG4gICAgaWYocG9pbnRzICYmIHBvaW50c1swXSAhPT0gdW5kZWZpbmVkICYmIHBvaW50c1swXS54ID09PSB1bmRlZmluZWQpe1xuICAgICAgdmFyIF9ORVdfcG9pbnRzID0gW107XG4gICAgICBmb3IodmFyIGk9MDsgaSA8IHBvaW50cy5sZW5ndGggO2krPTIpe1xuICAgICAgICBfTkVXX3BvaW50cy5wdXNoKHt4OiBwb2ludHNbaV0gLCB5OiBwb2ludHNbaSArIDFdfSk7XG4gICAgICB9XG4gICAgICBwb2ludHMgPSBfTkVXX3BvaW50cztcbiAgICB9XG5cblxuICAgIC8vIGlmKHRoaXMuZGVmYXVsdFNoYXBlID09IFwiY3VydmVcIil7XG4gICAgLy8gICBwb2ludHMgPSBbMCwgMCwgdGhpcy53aWR0aC8yLCAtdGhpcy53aWR0aC8yLCB0aGlzLndpZHRoLzIsIHRoaXMud2lkdGgvMiwgdGhpcy53aWR0aCwgMF07XG4gICAgLy8gfWVsc2UgaWYodGhpcy5kZWZhdWx0U2hhcGUgPT0gXCJhcmNcIil7XG4gICAgLy8gICBwb2ludHMgPSBbMCwgMCwgdGhpcy53aWR0aCowLjE2LCAtdGhpcy53aWR0aCowLjQzLCB0aGlzLndpZHRoICooMSAtIDAuMTYpLCAtdGhpcy53aWR0aCowLjQzLCB0aGlzLndpZHRoLCAwXTtcbiAgICAvLyB9ZWxzZXtcbiAgICAvLyAgIHBvaW50cyA9IFswLCAwLCB0aGlzLndpZHRoIC8gMywgMSwgdGhpcy53aWR0aCAvIDMgKiAyLCAxLCB0aGlzLndpZHRoLCAwXTtcbiAgICAvLyB9XG4gICAgdmFyIF9pbnRlcnZhbHMgPSB0aGlzLmNsb3NlZCAmJiBwb2ludHMubGVuZ3RoID4gMSA/IHBvaW50cy5sZW5ndGggOiBwb2ludHMubGVuZ3RoIC0gMTtcbiAgICB0aGlzLnBvaW50cyA9IFtdLmNvbmNhdChwb2ludHMpO1xuICAgIGlmKHRoaXMucG9pbnRzLmxlbmd0aCA+IDEgJiYgdGhpcy5iZXppZXJDb250cm9scyl7XG4gICAgICBmb3IodmFyIGkgPSAwIDsgaSA8IF9pbnRlcnZhbHM7IGkgKysgKXtcbiAgICAgICAgdmFyIHAyID0gdGhpcy5wb2ludHNbaSArIDFdIHx8IHRoaXMucG9pbnRzWzBdO1xuICAgICAgICB2YXIgcDEgPSB0aGlzLnBvaW50c1tpXTtcbiAgICAgICAgdmFyIF9jcCA9IHAxLmM7XG4gICAgICAgIGlmKF9jcCl7XG4gICAgICAgICAgaWYocDEuYzIpe1xuICAgICAgICAgICAgdGhpcy5fbWFrZUN1YmljKHAxLCBwMS5jLHAxLmMyLCBwMik7XG4gICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICB0aGlzLl9tYWtlQ3VydmUocDEsIHAxLmMsIHAyKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1lbHNle1xuICAgICAgICAgIF9jcCA9IHtcbiAgICAgICAgICAgIHg6IChwMS54ICsgcDIueCkvMixcbiAgICAgICAgICAgIHk6IChwMS55ICsgcDIueSkvMlxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgLy8gc2V0UG9pbnQ6IGZ1bmN0aW9uIChvcmRlciwgX3BvaW50KSB7XG4gIC8vICAgdmFyIF9wb2ludHMgPSB0aGlzLnBvaW50cztcbiAgLy8gICBfcG9pbnRzW29yZGVyXS54ID0gX3BvaW50Lng7XG4gIC8vICAgX3BvaW50c1tvcmRlcl0ueSA9IF9wb2ludC55O1xuICAvL1xuICAvLyAgIGlmKG9yZGVyID09IDAgKXtcbiAgLy8gICAgIHZhciBfcDEgPSBfcG9pbnRzWzFdLCBfcDIgPSAgX3BvaW50c1swXTtcbiAgLy8gICB9XG4gIC8vICAgaWYob3JkZXIgPT0gMSApe1xuICAvLyAgICAgdmFyIF9wMSA9IF9wb2ludHNbMF0sIF9wMiA9ICBfcG9pbnRzWzFdO1xuICAvLyAgIH1cbiAgLy8gICBpZihfcG9pbnRzLmxlbmd0aCA9PSAzKXtcbiAgLy8gICAgIGlmKG9yZGVyID09IDIgKXtcbiAgLy8gICAgICAgdmFyIF9wMSA9IF9wb2ludHNbMV0sIF9wMiA9ICBfcG9pbnRzWzJdO1xuICAvLyAgICAgfVxuICAvLyAgIH1lbHNle1xuICAvLyAgICAgaWYob3JkZXIgPT0gMiApe1xuICAvLyAgICAgICB2YXIgX3AxID0gX3BvaW50c1szXSwgX3AyID0gIF9wb2ludHNbMl07XG4gIC8vICAgICB9XG4gIC8vICAgICBpZihvcmRlciA9PSAzICl7XG4gIC8vICAgICAgIHZhciBfcDEgPSBfcG9pbnRzWzJdLCBfcDIgPSAgX3BvaW50c1szXTtcbiAgLy8gICAgIH1cbiAgLy8gICB9XG4gIC8vICAgaWYgKF9wMS54IC0gX3AyLnggPCAxKSB7XG4gIC8vICAgICBpZihfcDEueCA8ICBfcDIueCl7XG4gIC8vICAgICAgIF9wMi54Kys7XG4gIC8vICAgICB9ZWxzZXtcbiAgLy8gICAgICAgX3AyLngtLTtcbiAgLy8gICAgIH1cbiAgLy8gICB9XG4gIC8vICAgaWYgKF9wMS55IC0gX3AyLnkgPCAxKSB7XG4gIC8vICAgICBpZihfcDEueSA8ICBfcDIueSl7XG4gIC8vICAgICAgIF9wMi55Kys7XG4gIC8vICAgICB9ZWxzZXtcbiAgLy8gICAgICAgX3AyLnktLTtcbiAgLy8gICAgIH1cbiAgLy8gICB9XG4gIC8vICAgdGhpcy5jdXJ2ZS51cGRhdGUoKTtcbiAgLy8gICB0aGlzLm91dGxpbmUgPSB0aGlzLmN1cnZlLm91dGxpbmUodGhpcy5iZXppZXJPdXRsaW5lWzBdLCB0aGlzLmJlemllck91dGxpbmVbMV0pO1xuICAvLyAgIHRoaXMudXBkYXRlQmJveCgpO1xuICAvLyAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAvLyB9XG5cbiAgc2V0RXh0cmFDb250cm9sczogZnVuY3Rpb24oY29udHJvbHMpe1xuICAgIHRoaXMuYWRkUG9pbnRzQ29udHJvbHMoY29udHJvbHMpO1xuICB9LFxuXG4gIGFkZFBvaW50c0NvbnRyb2xzOiBmdW5jdGlvbihjb250cm9scyl7XG5cbiAgICB2YXIgcHRzID0gdGhpcy5wb2ludHMsXG4gICAgICBfbGFzdCA9IHB0cy5sZW5ndGggLSAxO1xuICAgIGZvcih2YXIgaSBpbiBwdHMpe1xuICAgICAgY29udHJvbHNbXCJwXCIgKyAoK2kgKyAxKV0gPSB7XG4gICAgICAgIGFjdGlvbjogXCJzaGFwZVwiLFxuICAgICAgICB2aXNpYmxlOiB0cnVlLFxuICAgICAgICB4OiBwdHNbaV0ueCxcbiAgICAgICAgeTogcHRzW2ldLnksXG4gICAgICAgIGFyZWE6ICAodGhpcy5leHRlbnNpb25BcmVhRW5hYmxlZCAmJiAoaSA9PSAwIHx8IGkgPT0gX2xhc3QpKT8gdGhpcy5jb3JuZXJTaXplIDogdGhpcy5jb3JuZXJBcmVhU2l6ZSxcbiAgICAgICAgc2l6ZSA6IHRoaXMuY29ybmVyU2l6ZSxcbiAgICAgICAgc3R5bGU6IHRoaXMuY29ybmVyU3R5bGVcbiAgICAgIH07XG5cbiAgICAgIGlmKHRoaXMuYmV6aWVyQ29udHJvbHMpIHtcbiAgICAgICAgaWYgKHB0c1tpXS5jMikge1xuXG4gICAgICAgICAgY29udHJvbHNbIFwiZFwiICsgKCtpICsgMSldID17XG4gICAgICAgICAgICBhY3Rpb246IFwic2hhcGVcIixcbiAgICAgICAgICAgIHZpc2libGU6IHRydWUsXG4gICAgICAgICAgICB4OiBwdHNbaV0uYzIueCxcbiAgICAgICAgICAgIHk6IHB0c1tpXS5jMi55LFxuICAgICAgICAgICAgc2l6ZTogdGhpcy5jdXJ2ZUNvcm5lclNpemUgKyAyLFxuICAgICAgICAgICAgYXJlYTogdGhpcy5jb3JuZXJBcmVhU2l6ZSxcbiAgICAgICAgICAgIHN0eWxlOiBcInJlY3RcIlxuICAgICAgICAgIH1cblxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHB0c1tpXS5jKSB7XG4gICAgICAgICAgY29udHJvbHNbXCJjXCIgKyAoK2kgKyAxKV0gPSB7XG4gICAgICAgICAgICBhY3Rpb246IFwic2hhcGVcIixcbiAgICAgICAgICAgIHZpc2libGU6IHRydWUsXG4gICAgICAgICAgICB4OiBwdHNbaV0uYy54LFxuICAgICAgICAgICAgeTogcHRzW2ldLmMueSxcbiAgICAgICAgICAgIHNpemU6IHRoaXMuY3VydmVDb3JuZXJTaXplICsgMixcbiAgICAgICAgICAgIGFyZWE6IHRoaXMuY29ybmVyQXJlYVNpemUsXG4gICAgICAgICAgICBzdHlsZTogXCJyZWN0XCJcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdmFyIHAyID0gcHRzWytpICsgMV0gfHwgdGhpcy5jbG9zZWQgJiYgcHRzWzBdO1xuICAgICAgICAgIGlmKHAyKXtcbiAgICAgICAgICAgIGNvbnRyb2xzW1wiY1wiICsgKCtpICsgMSldID0ge1xuICAgICAgICAgICAgICBhY3Rpb246IFwic2hhcGVcIixcbiAgICAgICAgICAgICAgdmlzaWJsZTogdHJ1ZSxcbiAgICAgICAgICAgICAgeDogKHB0c1tpXS54ICsgcDIueCkgLyAyLFxuICAgICAgICAgICAgICB5OiAocHRzW2ldLnkgKyBwMi55KSAvIDIsXG4gICAgICAgICAgICAgIGFyZWE6IHRoaXMuY29ybmVyQXJlYVNpemUsXG4gICAgICAgICAgICAgIHNpemU6IHRoaXMuY3VydmVDb3JuZXJTaXplLFxuICAgICAgICAgICAgICBzdHlsZTogXCJjaXJjbGVcIlxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgZHJhd0JlemllclNoYXBlQ29udHJvbHM6IGZ1bmN0aW9uKGN0eCl7XG4gICAgZm9yKHZhciBpID0gMCA7IGkgPCB0aGlzLnBvaW50cy5sZW5ndGggOyBpKyspe1xuICAgICAgaWYodGhpcy5wb2ludHNbaV0uYzIpe1xuICAgICAgICB0aGlzLmRyYXdCZXppZXJDb250cm9scyhjdHgsIHRoaXMucG9pbnRzW2ldLHRoaXMucG9pbnRzW2ldLmMsdGhpcy5wb2ludHNbaV0uYzIsdGhpcy5wb2ludHNbaSArIDFdKTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIGJlemllckNvbnRyb2xzOiBmYWxzZSxcbiAgX21ha2VDdXJ2ZUJ5SW5kZXg6IGZ1bmN0aW9uIChpbmRleCkge1xuICAgIHRoaXMuX21ha2VDdXJ2ZSh0aGlzLnBvaW50c1tpbmRleF0sdGhpcy5wb2ludHNbaW5kZXhdLmMsdGhpcy5wb2ludHNbaW5kZXggKyAxXSB8fCB0aGlzLnBvaW50c1swXSlcbiAgfSxcbiAgX21ha2VDdWJpYzogZnVuY3Rpb24gKHAxLCBjMSxjMixwMikge1xuICAgIHAxLmN1cnZlID0gbmV3IEJlemllcihwMS54LHAxLnkgLCBjMS54ICxjMS55ICwgYzIueCxjMi55ICwgcDIueCxwMi55KTtcbiAgICBpZih0aGlzLm91dGxpbmVUb3AgfHwgdGhpcy5vdXRsaW5lQm90dG9tKXtcbiAgICAgIHAxLm91dGxpbmUgPSBwMS5jdXJ2ZS5vdXRsaW5lKHRoaXMub3V0bGluZUJvdHRvbSwgdGhpcy5vdXRsaW5lVG9wKTtcbiAgICB9XG4gIH0sXG4gIF9tYWtlQ3VydmU6IGZ1bmN0aW9uIChfY3VyUG9pbnQsIGMxLF9wMikge1xuICAgIF9jdXJQb2ludC5jID0ge3g6IGMxLngseSA6IGMxLnl9O1xuICAgIF9jdXJQb2ludC5jdXJ2ZSA9IEJlemllci5xdWFkcmF0aWNGcm9tUG9pbnRzLmFwcGx5KHRoaXMsW19jdXJQb2ludCxjMSxfcDJdKTtcbiAgICBpZih0aGlzLm91dGxpbmVUb3AgfHwgdGhpcy5vdXRsaW5lQm90dG9tKXtcbiAgICAgIF9jdXJQb2ludC5vdXRsaW5lID0gX2N1clBvaW50LmN1cnZlLm91dGxpbmUodGhpcy5vdXRsaW5lVG9wLCB0aGlzLm91dGxpbmVCb3R0b20pO1xuICAgIH1cbiAgfSxcbiAgX3VwZGF0ZV9jdXJ2ZTogZnVuY3Rpb24gKF9wb2ludEluZGV4KSB7XG4gICAgdmFyIF9wMSA9IHRoaXMucG9pbnRzW19wb2ludEluZGV4IF07XG4gICAgaWYoIV9wMS5jKXtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdmFyIF9wMiA9IHRoaXMucG9pbnRzW19wb2ludEluZGV4ICsgMV0gfHwgdGhpcy5wb2ludHNbMF07XG5cbiAgICBpZihfcDEuYzIpe1xuICAgICAgX3AxLmN1cnZlLnBvaW50c1swXS54ID0gX3AxLng7XG4gICAgICBfcDEuY3VydmUucG9pbnRzWzBdLnkgPSBfcDEueTtcbiAgICAgIF9wMS5jdXJ2ZS5wb2ludHNbMV0ueCA9IF9wMS5jLng7XG4gICAgICBfcDEuY3VydmUucG9pbnRzWzFdLnkgPSBfcDEuYy55O1xuICAgICAgX3AxLmN1cnZlLnBvaW50c1syXS54ID0gX3AxLmMyLng7XG4gICAgICBfcDEuY3VydmUucG9pbnRzWzJdLnkgPSBfcDEuYzIueTtcbiAgICAgIF9wMS5jdXJ2ZS5wb2ludHNbM10ueCA9IF9wMi54O1xuICAgICAgX3AxLmN1cnZlLnBvaW50c1szXS55ID0gX3AyLnk7XG4gICAgICBfcDEuY3VydmUudXBkYXRlKCk7XG4gICAgICBfcDEub3V0bGluZSA9IF9wMS5jdXJ2ZS5vdXRsaW5lKHRoaXMub3V0bGluZUJvdHRvbSwgdGhpcy5vdXRsaW5lVG9wKTtcbiAgICB9ZWxzZXtcbiAgICAgIHZhciBiZXppZXJfcG9pbnRlcnMgPSBCZXppZXIuZ2V0QUJDKDIsIF9wMSwgX3AxLmMsIF9wMiAsIDAuNSk7XG4gICAgICBfcDEuY3VydmUucG9pbnRzWzBdLnggPSBfcDEueDtcbiAgICAgIF9wMS5jdXJ2ZS5wb2ludHNbMF0ueSA9IF9wMS55O1xuICAgICAgX3AxLmN1cnZlLnBvaW50c1sxXS54ID0gYmV6aWVyX3BvaW50ZXJzLkEueDtcbiAgICAgIF9wMS5jdXJ2ZS5wb2ludHNbMV0ueSA9IGJlemllcl9wb2ludGVycy5BLnk7XG4gICAgICBfcDEuY3VydmUucG9pbnRzWzJdLnggPSBfcDIueDtcbiAgICAgIF9wMS5jdXJ2ZS5wb2ludHNbMl0ueSA9IF9wMi55O1xuICAgICAgX3AxLmN1cnZlLnVwZGF0ZSgpO1xuICAgICAgaWYodGhpcy5vdXRsaW5lVG9wIHx8IHRoaXMub3V0bGluZUJvdHRvbSkge1xuICAgICAgICBfcDEub3V0bGluZSA9IF9wMS5jdXJ2ZS5vdXRsaW5lKHRoaXMub3V0bGluZUJvdHRvbSwgdGhpcy5vdXRsaW5lVG9wKTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIHNldFBvaW50OiBmdW5jdGlvbiAob3JkZXIsIF9wb2ludCkge1xuXG4gICAgdmFyIGRyYWdQb2ludGVyLFxuICAgICAgX2N1cnZlcG9pbnRlciA9IG9yZGVyWzBdID09IFwiY1wiLFxuICAgICAgcEluZGV4MSA9ICtvcmRlci5zdWJzdHIoMSkgLSAxLFxuICAgICAgcDEgPSB0aGlzLnBvaW50c1twSW5kZXgxXSxcbiAgICAgIHBJbmRleDIgPSB0aGlzLnBvaW50c1twSW5kZXgxICsgMV0gPyBwSW5kZXgxICsgMSA6ICh0aGlzLmNsb3NlZCA/IDAgOiAtMSksXG4gICAgICBwMiA9IHBJbmRleDIgIT09IC0xICYmIHRoaXMucG9pbnRzW3BJbmRleDJdLFxuICAgICAgcEluZGV4MCA9IHRoaXMucG9pbnRzW3BJbmRleDEgLSAxXSA/IHBJbmRleDEgLSAxIDogKHRoaXMuY2xvc2VkID8gdGhpcy5wb2ludHMubGVuZ3RoIC0gMSA6IC0xKSxcbiAgICAgIHAwID0gcEluZGV4MCAhPT0gLTEgJiYgdGhpcy5wb2ludHNbcEluZGV4MF07XG5cbiAgICBpZiAodGhpcy5wb2ludHNMaW1pdHMpIHtcbiAgICAgIF9wb2ludC54ID0gTWF0aC5tYXgoMCwgTWF0aC5taW4oX3BvaW50LngsIHRoaXMud2lkdGgpKTtcbiAgICAgIF9wb2ludC55ID0gTWF0aC5tYXgoMCwgTWF0aC5taW4oX3BvaW50LnksIHRoaXMuaGVpZ2h0KSk7XG4gICAgfVxuICAgIHZhciBfY3VydmVwb2ludGVyMiA9IG9yZGVyWzBdID09IFwiZFwiO1xuICAgIGlmKF9jdXJ2ZXBvaW50ZXIyKXtcbiAgICAgIGRyYWdQb2ludGVyID0gIHAxLmMyO1xuICAgIH1lbHNle1xuICAgICAgaWYoX2N1cnZlcG9pbnRlcil7XG5cbiAgICAgICAgaWYoIXAxLmMpe1xuICAgICAgICAgIHRoaXMuX21ha2VDdXJ2ZShwMSwgX3BvaW50LCBwMik7XG4gICAgICAgIH1cbiAgICAgICAgZHJhZ1BvaW50ZXIgPSBwMS5jXG4gICAgICB9ZWxzZXtcbiAgICAgICAgZHJhZ1BvaW50ZXIgPSBwMTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYoZHJhZ1BvaW50ZXIpe1xuICAgICAgZHJhZ1BvaW50ZXIueCA9IF9wb2ludC54O1xuICAgICAgZHJhZ1BvaW50ZXIueSA9IF9wb2ludC55O1xuICAgIH1cbiAgICBmb3IodmFyIGkgaW4gdGhpcy5wb2ludHMpe1xuICAgICAgdGhpcy5wb2ludHNbaV0uYyAmJiB0aGlzLl91cGRhdGVfY3VydmUoK2kpO1xuICAgIH1cbiAgICB0aGlzLnVwZGF0ZUJib3goKTtcbiAgICB0aGlzLmZpcmUoXCJzaGFwZTptb2RpZmllZFwiKTtcbiAgICB0aGlzLmNhbnZhcyAmJiB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgfVxufTtcblxuZmFicmljLnV0aWwub2JqZWN0LmRlZmF1bHRzKGZhYnJpYy5CZXppZXJNaXhpbiwgIGZhYnJpYy5TaGFwZU1peGluKTtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vbWl4aW5zL0Jlemllck1peGluLmpzXG4vLyBtb2R1bGUgaWQgPSA3XG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIlxuZmFicmljLkNhY2hlTWl4aW4gPSB7XG4gIGNhY2hpbmc6IHRydWUsXG4gIGRpcnR5OiB0cnVlLFxuICByZW5kZXI6IGZ1bmN0aW9uICggY3R4KSB7XG5cbiAgICBjdHguc2F2ZSgpO1xuICAgIGlmICh0aGlzLnRyYW5zZm9ybU1hdHJpeCkge1xuICAgICAgY3R4LnRyYW5zZm9ybS5hcHBseShjdHgsIHRoaXMudHJhbnNmb3JtTWF0cml4KTtcbiAgICB9XG4gICAgdGhpcy50cmFuc2Zvcm0oY3R4KTtcblxuICAgIHRoaXMuX3NldFNoYWRvdyhjdHgpO1xuICAgIHRoaXMuY2xpcFRvICYmIGZhYnJpYy51dGlsLmNsaXBDb250ZXh0KHRoaXMsIGN0eCk7XG5cbiAgICBjdHgudHJhbnNsYXRlKC10aGlzLndpZHRoIC8gMiwgLXRoaXMuaGVpZ2h0IC8gMik7XG5cbiAgICBpZiAodGhpcy5jYWNoaW5nKSB7XG4gICAgICBpZighdGhpcy5fY2FjaGUpe1xuICAgICAgICB0aGlzLl9jYWNoZSA9IGZhYnJpYy51dGlsLmNyZWF0ZUNhbnZhc0VsZW1lbnRXaXRoU2l6ZSh0aGlzKTtcbiAgICAgIH1cbiAgICAgIGlmKHRoaXMuZGlydHkpe1xuICAgICAgICB0aGlzLl9jYWNoZS53aWR0aCA9IHRoaXMud2lkdGg7XG4gICAgICAgIHRoaXMuX2NhY2hlLmhlaWdodCA9IHRoaXMuaGVpZ2h0O1xuICAgICAgICB2YXIgY2FjaGVDdHggPSB0aGlzLl9jYWNoZS5nZXRDb250ZXh0KFwiMmRcIik7XG4gICAgICAgIGNhY2hlQ3R4LmNsZWFyUmVjdCgwLDAsdGhpcy5fY2FjaGUud2lkdGgsdGhpcy5fY2FjaGUuaGVpZ2h0KVxuICAgICAgICB0aGlzLl9yZW5kZXIoY2FjaGVDdHgpO1xuICAgICAgICB0aGlzLmRpcnR5ID0gZmFsc2U7XG4gICAgICB9XG5cbiAgICAgIGN0eC5kcmF3SW1hZ2UodGhpcy5fY2FjaGUsIDAsIDAsIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0LDAsIDAsIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KTtcbiAgICB9ZWxzZXtcbiAgICAgIHRoaXMuX3JlbmRlcihjdHgpO1xuICAgIH1cblxuICAgIHRoaXMuY2xpcFRvICYmIGN0eC5yZXN0b3JlKCk7XG4gICAgY3R4LnJlc3RvcmUoKTtcbiAgfVxuXG59O1xuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9taXhpbnMvQ2FjaGVNaXhpbi5qc1xuLy8gbW9kdWxlIGlkID0gOFxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCJmYWJyaWMuU3Ryb2tlTWl4aW4gPSB7XG4gIHNoYXBlOiB7XG4gICAgc3Ryb2tlV2lkdGhGdWxsOiAwLFxuICAgIHN0cm9rZVdpZHRoRW1wdHk6IDIsXG4gICAgc3Ryb2tlV2lkdGhBY3RpdmU6IDIsXG4gICAgc3Ryb2tlRGFzaEFycmF5IDogWzUsNV0sXG4gICAgZmlsbDogXCJ0cmFuc3BhcmVudFwiLFxuICAgIHN0cm9rZUVtcHR5OiAgXCJyZWRcIixcbiAgICBzdHJva2VGdWxsOiAgIFwicmVkXCIsXG4gICAgc3Ryb2tlQWN0aXZlOiBcImdyZWVuXCJcbiAgfSxcbiAgc2V0U2hhcGU6IGZ1bmN0aW9uKGVsLGNiKXtcblxuICAgIGVsID0gIGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoe1xuICAgICAgc3Ryb2tlV2lkdGhGdWxsOiB0aGlzLnNoYXBlLnN0cm9rZVdpZHRoRnVsbCxcbiAgICAgIHN0cm9rZVdpZHRoRW1wdHk6IHRoaXMuc2hhcGUuc3Ryb2tlV2lkdGhFbXB0eSxcbiAgICAgIHN0cm9rZVdpZHRoQWN0aXZlOiB0aGlzLnNoYXBlLnN0cm9rZVdpZHRoQWN0aXZlLFxuICAgICAgZGFzaEFycmF5IDogdGhpcy5zaGFwZS5kYXNoQXJyYXksXG4gICAgICBzdHJva2VFbXB0eTogIHRoaXMuc2hhcGUuc3Ryb2tlRW1wdHksXG4gICAgICBzdHJva2VGdWxsOiAgdGhpcy5zaGFwZS5zdHJva2VGdWxsLFxuICAgICAgc3Ryb2tlQWN0aXZlOnRoaXMuc2hhcGUuc3Ryb2tlQWN0aXZlXG4gICAgfSxlbCk7XG5cblxuICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgaWYoZWwgJiYgZWwuc3JjICYmICFlbC5wYXRocyl7XG4gICAgICBmYWJyaWMubG9hZFNWR0Zyb21VUkwoZWwuc3JjLGZ1bmN0aW9uKHBhdGhzLG9wdGlvbnMpIHtcbiAgICAgICAgZWwucGF0aHMgID0gcGF0aHM7XG4gICAgICAgIGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZWwsb3B0aW9ucyk7XG4gICAgICAgIF90aGlzLl9zZXRfc2hhcGUoZWwpO1xuICAgICAgICBfdGhpcy5hZGQoX3RoaXMuX2ZhYnJpY19zaGFwZSlcbiAgICAgICAgX3RoaXMuX2FwcGx5X3NoYXBlKCk7XG4gICAgICAgIGNiICYmIGNiKCk7XG4gICAgICB9KVxuICAgIH1lbHNle1xuICAgICAgX3RoaXMuX3NldF9zaGFwZShlbCk7XG4gICAgICBfdGhpcy5hZGQoX3RoaXMuX2ZhYnJpY19zaGFwZSk7XG4gICAgICBfdGhpcy5fYXBwbHlfc2hhcGUoKTtcbiAgICAgIGNiICYmIGNiKCk7XG4gICAgfVxuICB9LFxuICBpbml0U2hhcGU6IGZ1bmN0aW9uKG9wdGlvbnMpe1xuXG4gICAgdmFyIF9zaGFwZU9wdGlvbnMgPSBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKG9wdGlvbnMuc2hhcGUgfHwge30gLCB0aGlzLnNoYXBlKTtcblxuICAgIHRoaXMuX2ZhYnJpY19zaGFwZSA9ICBuZXcgZmFicmljLlJlY3QoZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCh7fSxfc2hhcGVPcHRpb25zLHtcbiAgICAgIHdpZHRoOiAgICAgICAgICAgIG9wdGlvbnMud2lkdGgsXG4gICAgICBoZWlnaHQ6ICAgICAgICAgICBvcHRpb25zLmhlaWdodCxcbiAgICAgIHN0cm9rZTogICAgICAgICAgIF9zaGFwZU9wdGlvbnMuc3Ryb2tlRW1wdHksXG4gICAgICBzdHJva2VXaWR0aDogICAgICBfc2hhcGVPcHRpb25zLnN0cm9rZVdpZHRoRW1wdHlcbiAgICB9KSk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIO+/ve+/ve+/ve+/ve+/ve+/ve+/ve+/ve+/ve+/ve+/ve+/ve+/ve+/vSDvv73vv73vv73vv73vv70g77+977+9IO+/ve+/ve+/ve+/ve+/ve+/ve+/vSDvv73vv73vv73vv73vv73vv73vv70g77+977+977+977+9XG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBfYXBwbHlfc2hhcGU6IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgc2hhcGUgPSB0aGlzLnNoYXBlO1xuXG4gICAgdmFyIF9vZmYgPSBzaGFwZSAmJiBzaGFwZS5vZmZzZXRzO1xuXG4gICAgaWYgKCFfb2ZmKSB7XG4gICAgICBfb2ZmID0gWzAsIDAsIDAsIDBdO1xuICAgIH1cblxuICAgIHZhciBfb2ZmX3VuaXRzID0gc2hhcGUgJiYgc2hhcGUub2Zmc2V0c191bml0cztcblxuICAgIGlmICghX29mZl91bml0cykge1xuICAgICAgLy9pZiAoZnJhbWUuYm9yZGVyX2ltYWdlKSB7dG9kb1xuICAgICAgLy8gICAgX29mZl91bml0cyA9IGZyYW1lLmJvcmRlcl9pbWFnZS53aWR0aF91bml0cyB8fCBbMCwgMCwgMCwgMF07XG4gICAgICAvL30gZWxzZSB7XG4gICAgICBfb2ZmX3VuaXRzID0gWzEsIDEsIDEsIDFdO1xuICAgICAgLy99XG4gICAgfVxuXG4gICAgLyplbHNlIGlmKHNoYXBlLm9mZnNldHMgJiYgc2hhcGUub2Zmc2V0c191bml0cyl7XG4gICAgIHZhciBzID0gdGhpcy5zbGlkZS5zY2FsZVZhbHVlO1xuICAgICB0aGlzLl9mYWJyaWNfc2hhcGUgPSBuZXcgZmFicmljLlJlY3Qoe1xuICAgICBvcmlnaW5YOiAnY2VudGVyJyxcbiAgICAgb3JpZ2luWTogJ2NlbnRlcicsXG4gICAgIHdpZHRoOiAgKHRoaXMuZGF0YS5nZW9tZXRyeS53aWR0aCAtIHNoYXBlLm9mZnNldHNbM10gLSBzaGFwZS5vZmZzZXRzWzFdKSAqIHMsXG4gICAgIGhlaWdodDogKHRoaXMuZGF0YS5nZW9tZXRyeS5oZWlnaHQgLXNoYXBlLm9mZnNldHNbMF0gLSBzaGFwZS5vZmZzZXRzWzJdKSAqIHNcbiAgICAgfSk7Ki9cblxuICAgIF9vZmYgPSB7XG4gICAgICB0b3A6ICAgX29mZlswXSAqIChfb2ZmX3VuaXRzWzBdID8gdGhpcy5oZWlnaHQgLyAxMDAgOiAxKSB8fCAwLFxuICAgICAgcmlnaHQ6IF9vZmZbMV0gKiAoX29mZl91bml0c1sxXSA/IHRoaXMud2lkdGggLyAxMDAgOiAxKSB8fCAwLFxuICAgICAgYm90dG9tOl9vZmZbMl0gKiAoX29mZl91bml0c1syXSA/IHRoaXMuaGVpZ2h0IC8gMTAwIDogMSkgfHwgMCxcbiAgICAgIGxlZnQ6ICBfb2ZmWzNdICogKF9vZmZfdW5pdHNbM10gPyB0aGlzLndpZHRoIC8gMTAwIDogMSkgfHwgMFxuICAgIH07XG5cblxuICAgIHZhciBfdyA9ICh0aGlzLndpZHRoIC0gX29mZi5sZWZ0IC0gX29mZi5yaWdodCApOy8vICp0aGlzLnNsaWRlLnNjYWxlVmFsdWU7XG4gICAgdmFyIF9oID0gKHRoaXMuaGVpZ2h0IC0gX29mZi50b3AgLSBfb2ZmLmJvdHRvbSk7Ly8gKnRoaXMuc2xpZGUuc2NhbGVWYWx1ZTtcblxuXG4gICAgLy9pZih0aGlzLnJlc291cmNlcy5mcmFtZS5kYXRhLnNoYXBlICYmIHRoaXMucmVzb3VyY2VzLmZyYW1lLmRhdGEuc2hhcGUucmFkaXVzKXtcbiAgICAvL1xuICAgIC8vICAgIHRoaXMuX2ZhYnJpY19zaGFwZS5zZXQoe1xuICAgIC8vICAgICAgICBsZWZ0OiAtdGhpcy53aWR0aC8yICArIF9vZmYubGVmdCAsXG4gICAgLy8gICAgICAgIHRvcDogIC10aGlzLmhlaWdodC8yICsgX29mZi50b3AgLFxuICAgIC8vICAgICAgICB3aWR0aDogX3cgLSBfb2ZmLmxlZnQgLV9vZmYucmlnaHQsXG4gICAgLy8gICAgICAgIGhlaWdodDogIF9oIC0gX29mZi50b3AgLV9vZmYuYm90dG9tLFxuICAgIC8vICAgICAgICBzY2FsZVg6ICAxLFxuICAgIC8vICAgICAgICBzY2FsZVk6ICAxXG4gICAgLy8gICAgfSk7XG4gICAgLy99ZWxzZXtcblxuXG4gICAgaWYodGhpcy5zaGFwZS5wYXRoIHx8IHRoaXMuc2hhcGUucGF0aHMgfHwgdGhpcy5zaGFwZS5vZmZzZXRzKXtcbiAgICAgIHZhciBfc3cgPSB0aGlzLnNoYXBlLndpZHRoIHx8IHRoaXMuX2ZhYnJpY19zaGFwZS53aWR0aDtcbiAgICAgIHZhciBfc2ggPSB0aGlzLnNoYXBlLmhlaWdodCB8fCB0aGlzLl9mYWJyaWNfc2hhcGUuaGVpZ2h0O1xuXG4gICAgICBpZih0aGlzLl9mYWJyaWNfc2hhcGUuc3Ryb2tlV2lkdGgpe1xuICAgICAgICBfc3cgKz0gdGhpcy5fZmFicmljX3NoYXBlLnN0cm9rZVdpZHRoIDtcbiAgICAgICAgX3NoICs9IHRoaXMuX2ZhYnJpY19zaGFwZS5zdHJva2VXaWR0aCA7XG4gICAgICB9XG5cbiAgICAgIHZhciBvcHRpb25zID0ge1xuICAgICAgICBsZWZ0OiAgIC10aGlzLndpZHRoIC8gMiArIF9vZmYubGVmdCxcbiAgICAgICAgdG9wOiAgICAtdGhpcy5oZWlnaHQgLyAyICsgX29mZi50b3AsXG4gICAgICAgIHNjYWxlWDogX3cgLyAxMDAgLyAoX3N3IC8gMTAwKSwvLyAqIChzaGFwZS5zY2FsZVggfHwgMSksXG4gICAgICAgIHNjYWxlWTogX2ggLyAxMDAgLyAoX3NoIC8gMTAwKSwvLyAqIChzaGFwZS5zY2FsZVkgfHwgMSlcbiAgICAgICAgYW5nbGU6IDBcbiAgICAgIH07XG4gICAgfWVsc2V7XG4gICAgICB2YXIgb3B0aW9ucyA9IHtcbiAgICAgICAgbGVmdDogICAtdGhpcy53aWR0aCAvIDIgKyBfb2ZmLmxlZnQsXG4gICAgICAgIHRvcDogICAgLXRoaXMuaGVpZ2h0IC8gMiArIF9vZmYudG9wLFxuICAgICAgICB3aWR0aDogICAgX3csLy8gKiAoc2hhcGUuc2NhbGVYIHx8IDEpLFxuICAgICAgICBoZWlnaHQ6ICAgX2gsLy8gKiAoc2hhcGUuc2NhbGVZIHx8IDEpXG4gICAgICAgIGFuZ2xlOiAwXG4gICAgICB9O1xuICAgIH1cblxuICAgIHRoaXMuX2ZhYnJpY19zaGFwZS5zZXQob3B0aW9ucyk7XG5cbiAgICB0aGlzLnVwZGF0ZVN0cm9rZSgpO1xuICAgIHRoaXMuY2FudmFzICYmIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICB9LFxuICBfc2V0X3NoYXBlOiBmdW5jdGlvbiAoc2hhcGUpIHtcblxuICAgIGlmKHRoaXMuX2ZhYnJpY19zaGFwZSl7XG4gICAgICB0aGlzLnJlbW92ZSh0aGlzLl9mYWJyaWNfc2hhcGUpO1xuICAgICAgZGVsZXRlIHRoaXMuX2ZhYnJpY19zaGFwZTtcbiAgICB9XG4gICAgdmFyIF9mYWJyaWNfc2hhcGU7XG4gICAgdmFyIF9vcHRpb25zID0ge1xuICAgICAgZmlsbDogICAgICAgICAgICAgXCJ0cmFuc3BhcmVudFwiLFxuICAgICAgc3Ryb2tlRGFzaEFycmF5IDogdGhpcy5zaGFwZS5kYXNoQXJyYXksXG4gICAgfTtcblxuICAgIHRoaXMuc2hhcGUgPSBzaGFwZTtcblxuICAgIGlmKCFzaGFwZSl7XG4gICAgICBfZmFicmljX3NoYXBlID0gbmV3IGZhYnJpYy5SZWN0KHtcbiAgICAgICAgd2lkdGg6IHRoaXMud2lkdGgsXG4gICAgICAgIGhlaWdodDogdGhpcy5oZWlnaHRcbiAgICAgIH0pO1xuICAgICAgX2ZhYnJpY19zaGFwZS5zZXQoX29wdGlvbnMpXG4gICAgfWVsc2UgaWYgKHNoYXBlLnBhdGhzKSB7XG5cbiAgICAgIGZvcih2YXIgaSBpbiBzaGFwZS5wYXRocyl7XG4gICAgICAgIHNoYXBlLnBhdGhzW2ldLnNldChfb3B0aW9ucylcbiAgICAgIH1cblxuICAgICAgX2ZhYnJpY19zaGFwZSA9IGZhYnJpYy51dGlsLmdyb3VwU1ZHRWxlbWVudHMoc2hhcGUucGF0aHMsIHNoYXBlKTtcbiAgICAgIC8vdGhpcy5fb2JqZWN0cy51bnNoaWZ0KHRoaXMuX29iamVjdHMucG9wKCkpO1xuICAgIH1lbHNlIHtcbiAgICAgIHZhciBwYXRoO1xuXG4gICAgICBpZiAoc2hhcGUucmFkaXVzKSB7XG4gICAgICAgIHBhdGggPSBmYWJyaWMudXRpbC5nZXRSYWRpdXNDbGlwUGF0aChzaGFwZS5yYWRpdXMsIHNoYXBlLnJhZGl1c191bml0cywgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpO1xuICAgICAgICBfZmFicmljX3NoYXBlID0gbmV3IGZhYnJpYy5QYXRoKHBhdGgsIF9vcHRpb25zKTtcbiAgICAgIH0gZWxzZSBpZiAoc2hhcGUucGF0aCkge1xuICAgICAgICBfZmFicmljX3NoYXBlID0gbmV3IGZhYnJpYy5QYXRoKHNoYXBlLnBhdGgsIF9vcHRpb25zKTtcbiAgICAgICAgLy99IGVsc2UgaWYoc2hhcGUub2Zmc2V0cyl7XG4gICAgICAgIC8vICBwYXRoID0gZmFicmljLnV0aWwuZ2V0T2Zmc2V0c0NsaXBQYXRoKHNoYXBlLm9mZnNldHMsIHNoYXBlLm9mZnNldHNfdW5pdHMpXG4gICAgICB9ZWxzZXtcbiAgICAgICAgcGF0aCA9ICAnTSAwIDAgTCB7d2lkdGh9IDAgTCB7d2lkdGh9IHtoZWlnaHR9IEwgMCB7aGVpZ2h0fSB6Jy5mb3JtYXQoZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCh7XG4gICAgICAgICAgd2lkdGg6ICAgICAgICAgICAgMTAwLFxuICAgICAgICAgIGhlaWdodDogICAgICAgICAgIDEwMFxuICAgICAgICB9LHNoYXBlKSk7XG5cbiAgICAgICAgX2ZhYnJpY19zaGFwZSA9IG5ldyBmYWJyaWMuUGF0aChwYXRoLCBfb3B0aW9ucyk7XG4gICAgICAgIC8vXG4gICAgICAgIC8vX2ZhYnJpY19zaGFwZSA9ICBuZXcgZmFicmljLlJlY3QoZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCh7XG4gICAgICAgIC8vICB3aWR0aDogICAgICAgICAgICAxMDAsXG4gICAgICAgIC8vICBoZWlnaHQ6ICAgICAgICAgICAxMDBcbiAgICAgICAgLy99LHNoYXBlKSk7XG5cbiAgICAgIH1cbiAgICB9XG5cblxuICAgIF9mYWJyaWNfc2hhcGUuc2V0KHtcbiAgICAgIHNjYWxlWDogdGhpcy53aWR0aCAgLyBfZmFicmljX3NoYXBlLndpZHRoLFxuICAgICAgc2NhbGVZOiB0aGlzLmhlaWdodCAvIF9mYWJyaWNfc2hhcGUuaGVpZ2h0LFxuICAgICAgcGVyUGl4ZWxUYXJnZXRGaW5kOiB0cnVlLFxuICAgICAgc2VsZWN0YWJsZTogZmFsc2UsXG4gICAgICBvcmlnaW5YOiBcImxlZnRcIixcbiAgICAgIG9yaWdpblk6IFwidG9wXCJcbiAgICB9KTtcblxuXG5cbiAgICB0aGlzLl9mYWJyaWNfc2hhcGUgPSAgX2ZhYnJpY19zaGFwZTtcblxuXG4gICAgaWYodGhpcy5lbGVtZW50KXtcbiAgICAgIHRoaXMuZWxlbWVudC5jbGlwVG8gPSB0aGlzLl9mYWJyaWNfc2hhcGU7XG4gICAgfVxuXG5cbiAgICB0aGlzLnVwZGF0ZVN0cm9rZSgpO1xuXG4gIH0sXG5cbiAgdXBkYXRlU3Ryb2tlOiBmdW5jdGlvbigpe1xuXG4gICAgdmFyIF9zdHJva2UgPSB0aGlzLnNoYXBlLnN0cm9rZTtcbiAgICB2YXIgX3N3ID0gMDtcbiAgICBpZigodGhpcy5fYWN0aXZhdGVkIHx8IHRoaXMuX2NsaXBtb2RlICkmJiB0aGlzLnNoYXBlLnN0cm9rZVdpZHRoQWN0aXZlKXtcbiAgICAgIF9zdyA9IHRoaXMuc2hhcGUuc3Ryb2tlV2lkdGhBY3RpdmVcbiAgICB9ZWxzZSBpZih0aGlzLmVsZW1lbnQgJiYgdGhpcy5zaGFwZS5zdHJva2VXaWR0aEZ1bGwpe1xuICAgICAgX3N3ID0gdGhpcy5zaGFwZS5zdHJva2VXaWR0aEZ1bGw7XG4gICAgfWVsc2UgaWYoIXRoaXMuZWxlbWVudCAmJiB0aGlzLnNoYXBlLnN0cm9rZVdpZHRoRW1wdHkpe1xuICAgICAgX3N3ID0gdGhpcy5zaGFwZS5zdHJva2VXaWR0aEVtcHR5O1xuICAgIH1cbiAgICBpZigodGhpcy5fYWN0aXZhdGVkIHx8IHRoaXMuX2NsaXBtb2RlKSAmJiB0aGlzLnNoYXBlLnN0cm9rZUFjdGl2ZSl7XG4gICAgICBfc3Ryb2tlID0gdGhpcy5zaGFwZS5zdHJva2VBY3RpdmVcbiAgICB9ZWxzZSBpZih0aGlzLmVsZW1lbnQgJiYgdGhpcy5zaGFwZS5zdHJva2VGdWxsKXtcbiAgICAgIF9zdHJva2UgPSB0aGlzLnNoYXBlLnN0cm9rZUZ1bGw7XG4gICAgfWVsc2UgaWYoIXRoaXMuZWxlbWVudCAmJiB0aGlzLnNoYXBlLnN0cm9rZUVtcHR5KXtcbiAgICAgIF9zdHJva2UgPSB0aGlzLnNoYXBlLnN0cm9rZUVtcHR5O1xuICAgIH1cblxuXG4gICAgdmFyIF9zdHJva2VXaWR0aCA9IF9zdyAvIE1hdGgubWF4KHRoaXMuX2ZhYnJpY19zaGFwZS5zY2FsZVgsdGhpcy5fZmFicmljX3NoYXBlLnNjYWxlWSk7XG5cbiAgICBpZih0aGlzLnNoYXBlKXtcbiAgICAgIGlmKHRoaXMuc2hhcGUucGF0aHMgKXtcbiAgICAgICAgZm9yKHZhciBpIGluIHRoaXMuX2ZhYnJpY19zaGFwZS5wYXRocyl7XG4gICAgICAgICAgdGhpcy5fZmFicmljX3NoYXBlLnBhdGhzW2ldLnNldFN0cm9rZVdpZHRoKF9zdHJva2VXaWR0aClcbiAgICAgICAgICB0aGlzLl9mYWJyaWNfc2hhcGUucGF0aHNbaV0uc2V0U3Ryb2tlKF9zdHJva2UpXG4gICAgICAgIH1cbiAgICAgIH1lbHNle1xuICAgICAgICB0aGlzLl9mYWJyaWNfc2hhcGUuc2V0U3Ryb2tlV2lkdGgoX3N0cm9rZVdpZHRoKVxuICAgICAgICB0aGlzLl9mYWJyaWNfc2hhcGUuc2V0U3Ryb2tlKF9zdHJva2UpXG4gICAgICB9XG4gICAgfVxuICB9LFxuICAvKipcbiAgICog0LrQvtCx0YrQtdC60YIg0LPQvtGC0L7QstC40YLRgdGPINC6INC30LDQvNC10L3RgyDRhNC+0YLQvlxuICAgKi9cbiAgYWN0aXZhdGU6IGZ1bmN0aW9uKCl7XG4gICAgdGhpcy5fYWN0aXZhdGVkID0gdHJ1ZTtcbiAgICB0aGlzLl9mYWJyaWNfc2hhcGUuc2V0T3BhY2l0eSgxKTtcbiAgICB0aGlzLnVwZGF0ZVN0cm9rZSgpO1xuICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICB9LFxuICAvKipcbiAgICog0LrQvtCx0YrQtdC60YIg0L3QtSDQs9C+0YLQvtCy0LjRgtGB0Y8g0Log0LfQsNC80LXQvdGDINGE0L7RgtC+XG4gICAqL1xuICBkZWFjdGl2YXRlOiBmdW5jdGlvbigpe1xuICAgIHRoaXMuX2FjdGl2YXRlZCA9IGZhbHNlO1xuICAgIHRoaXMudXBkYXRlU3Ryb2tlKCk7XG4gICAgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gIH0sXG59XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL21peGlucy9TdHJva2VNaXhpbi5qc1xuLy8gbW9kdWxlIGlkID0gOVxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCIvKipcbiAgQSBqYXZhc2NyaXB0IEJlemllciBjdXJ2ZSBsaWJyYXJ5IGJ5IFBvbWF4LlxuXG4gIEJhc2VkIG9uIGh0dHA6Ly9wb21heC5naXRodWIuaW8vYmV6aWVyaW5mb1xuXG4gIFRoaXMgY29kZSBpcyBNSVQgbGljZW5zZWQuXG4qKi9cbnZhciBCZXppZXIgPSAoZnVuY3Rpb24oKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIC8vIG1hdGgtaW5saW5pbmcuXG4gIHZhciBhYnMgPSBNYXRoLmFicyxcbiAgICAgIG1pbiA9IE1hdGgubWluLFxuICAgICAgbWF4ID0gTWF0aC5tYXgsXG4gICAgICBhY29zID0gTWF0aC5hY29zLFxuICAgICAgc3FydCA9IE1hdGguc3FydCxcbiAgICAgIHBpID0gTWF0aC5QSSxcbiAgICAgIC8vIGEgemVybyBjb29yZGluYXRlLCB3aGljaCBpcyBzdXJwcmlzaW5nbHkgdXNlZnVsXG4gICAgICBaRVJPID0ge3g6MCx5OjAsejowfTtcblxuXG5cblxuICAgICAgLy8gbWF0aC1pbmxpbmluZy5cbiAgICAgIHZhciBhYnMgPSBNYXRoLmFicyxcbiAgICAgICAgY29zID0gTWF0aC5jb3MsXG4gICAgICAgIHNpbiA9IE1hdGguc2luLFxuICAgICAgICBhY29zID0gTWF0aC5hY29zLFxuICAgICAgICBhdGFuMiA9IE1hdGguYXRhbjIsXG4gICAgICAgIHNxcnQgPSBNYXRoLnNxcnQsXG4gICAgICAgIHBvdyA9IE1hdGgucG93LFxuICAgICAgLy8gY3ViZSByb290IGZ1bmN0aW9uIHlpZWxkaW5nIHJlYWwgcm9vdHNcbiAgICAgICAgY3J0ID0gZnVuY3Rpb24odikgeyByZXR1cm4gKHY8MCkgPyAtcG93KC12LDEvMykgOiBwb3codiwxLzMpOyB9LFxuICAgICAgLy8gdHJpZyBjb25zdGFudHNcbiAgICAgICAgcGkgPSBNYXRoLlBJLFxuICAgICAgICB0YXUgPSAyKnBpLFxuICAgICAgICBxdWFydCA9IHBpLzIsXG4gICAgICAvLyBmbG9hdCBwcmVjaXNpb24gc2lnbmlmaWNhbnQgZGVjaW1hbFxuICAgICAgICBlcHNpbG9uID0gMC4wMDAwMDE7XG5cbiAgICAgIC8vIEJlemllciB1dGlsaXR5IGZ1bmN0aW9uc1xuICAgICAgdmFyIHV0aWxzID0ge1xuICAgICAgICAvLyBMZWdlbmRyZS1HYXVzcyBhYnNjaXNzYWUgd2l0aCBuPTI0ICh4X2kgdmFsdWVzLCBkZWZpbmVkIGF0IGk9biBhcyB0aGUgcm9vdHMgb2YgdGhlIG50aCBvcmRlciBMZWdlbmRyZSBwb2x5bm9taWFsIFBuKHgpKVxuICAgICAgICBUdmFsdWVzOiBbXG4gICAgICAgICAgLTAuMDY0MDU2ODkyODYyNjA1NjI2MDg1MDQzMDgyNjI0NzQ1MDM4NTkwOSxcbiAgICAgICAgICAgMC4wNjQwNTY4OTI4NjI2MDU2MjYwODUwNDMwODI2MjQ3NDUwMzg1OTA5LFxuICAgICAgICAgIC0wLjE5MTExODg2NzQ3MzYxNjMwOTE1ODYzOTgyMDc1NzA2OTYzMTg0MDQsXG4gICAgICAgICAgIDAuMTkxMTE4ODY3NDczNjE2MzA5MTU4NjM5ODIwNzU3MDY5NjMxODQwNCxcbiAgICAgICAgICAtMC4zMTUwNDI2Nzk2OTYxNjMzNzQzODY3OTMyOTEzMTk4MTAyNDA3ODY0LFxuICAgICAgICAgICAwLjMxNTA0MjY3OTY5NjE2MzM3NDM4Njc5MzI5MTMxOTgxMDI0MDc4NjQsXG4gICAgICAgICAgLTAuNDMzNzkzNTA3NjI2MDQ1MTM4NDg3MDg0MjMxOTEzMzQ5NzEyNDUyNCxcbiAgICAgICAgICAgMC40MzM3OTM1MDc2MjYwNDUxMzg0ODcwODQyMzE5MTMzNDk3MTI0NTI0LFxuICAgICAgICAgIC0wLjU0NTQyMTQ3MTM4ODgzOTUzNTY1ODM3NTYxNzIxODM3MjM3MDAxMDcsXG4gICAgICAgICAgIDAuNTQ1NDIxNDcxMzg4ODM5NTM1NjU4Mzc1NjE3MjE4MzcyMzcwMDEwNyxcbiAgICAgICAgICAtMC42NDgwOTM2NTE5MzY5NzU1NjkyNTI0OTU3ODY5MTA3NDc2MjY2Njk2LFxuICAgICAgICAgICAwLjY0ODA5MzY1MTkzNjk3NTU2OTI1MjQ5NTc4NjkxMDc0NzYyNjY2OTYsXG4gICAgICAgICAgLTAuNzQwMTI0MTkxNTc4NTU0MzY0MjQzODI4MTAzMDk5OTc4NDI1NTIzMixcbiAgICAgICAgICAgMC43NDAxMjQxOTE1Nzg1NTQzNjQyNDM4MjgxMDMwOTk5Nzg0MjU1MjMyLFxuICAgICAgICAgIC0wLjgyMDAwMTk4NTk3MzkwMjkyMTk1Mzk0OTg3MjY2OTc0NTIwODA3NjEsXG4gICAgICAgICAgIDAuODIwMDAxOTg1OTczOTAyOTIxOTUzOTQ5ODcyNjY5NzQ1MjA4MDc2MSxcbiAgICAgICAgICAtMC44ODY0MTU1MjcwMDQ0MDEwMzQyMTMxNTQzNDE5ODIxOTY3NTUwODczLFxuICAgICAgICAgICAwLjg4NjQxNTUyNzAwNDQwMTAzNDIxMzE1NDM0MTk4MjE5Njc1NTA4NzMsXG4gICAgICAgICAgLTAuOTM4Mjc0NTUyMDAyNzMyNzU4NTIzNjQ5MDAxNzA4NzIxNDQ5NjU0OCxcbiAgICAgICAgICAgMC45MzgyNzQ1NTIwMDI3MzI3NTg1MjM2NDkwMDE3MDg3MjE0NDk2NTQ4LFxuICAgICAgICAgIC0wLjk3NDcyODU1NTk3MTMwOTQ5ODE5ODM5MTk5MzAwODE2OTA2MTc0MTEsXG4gICAgICAgICAgIDAuOTc0NzI4NTU1OTcxMzA5NDk4MTk4MzkxOTkzMDA4MTY5MDYxNzQxMSxcbiAgICAgICAgICAtMC45OTUxODcyMTk5OTcwMjEzNjAxNzk5OTc0MDk3MDA3MzY4MTE4NzQ1LFxuICAgICAgICAgICAwLjk5NTE4NzIxOTk5NzAyMTM2MDE3OTk5NzQwOTcwMDczNjgxMTg3NDVcbiAgICAgICAgXSxcbiAgICAgICAgLy8gTGVnZW5kcmUtR2F1c3Mgd2VpZ2h0cyB3aXRoIG49MjQgKHdfaSB2YWx1ZXMsIGRlZmluZWQgYnkgYSBmdW5jdGlvbiBsaW5rZWQgdG8gaW4gdGhlIEJlemllciBwcmltZXIgYXJ0aWNsZSlcbiAgICAgICAgQ3ZhbHVlczogW1xuICAgICAgICAgIDAuMTI3OTM4MTk1MzQ2NzUyMTU2OTc0MDU2MTY1MjI0Njk1MzcxODUxNyxcbiAgICAgICAgICAwLjEyNzkzODE5NTM0Njc1MjE1Njk3NDA1NjE2NTIyNDY5NTM3MTg1MTcsXG4gICAgICAgICAgMC4xMjU4Mzc0NTYzNDY4MjgyOTYxMjEzNzUzODI1MTExODM2ODg3MjY0LFxuICAgICAgICAgIDAuMTI1ODM3NDU2MzQ2ODI4Mjk2MTIxMzc1MzgyNTExMTgzNjg4NzI2NCxcbiAgICAgICAgICAwLjEyMTY3MDQ3MjkyNzgwMzM5MTIwNDQ2MzE1MzQ3NjI2MjQyNTYwNzAsXG4gICAgICAgICAgMC4xMjE2NzA0NzI5Mjc4MDMzOTEyMDQ0NjMxNTM0NzYyNjI0MjU2MDcwLFxuICAgICAgICAgIDAuMTE1NTA1NjY4MDUzNzI1NjAxMzUzMzQ0NDgzOTA2NzgzNTU5ODYyMixcbiAgICAgICAgICAwLjExNTUwNTY2ODA1MzcyNTYwMTM1MzM0NDQ4MzkwNjc4MzU1OTg2MjIsXG4gICAgICAgICAgMC4xMDc0NDQyNzAxMTU5NjU2MzQ3ODI1NzczNDI0NDY2MDYyMjI3OTQ2LFxuICAgICAgICAgIDAuMTA3NDQ0MjcwMTE1OTY1NjM0NzgyNTc3MzQyNDQ2NjA2MjIyNzk0NixcbiAgICAgICAgICAwLjA5NzYxODY1MjEwNDExMzg4ODI2OTg4MDY2NDQ2NDI0NzE1NDQyNzksXG4gICAgICAgICAgMC4wOTc2MTg2NTIxMDQxMTM4ODgyNjk4ODA2NjQ0NjQyNDcxNTQ0Mjc5LFxuICAgICAgICAgIDAuMDg2MTkwMTYxNTMxOTUzMjc1OTE3MTg1MjAyOTgzNzQyNjY3MTg1MCxcbiAgICAgICAgICAwLjA4NjE5MDE2MTUzMTk1MzI3NTkxNzE4NTIwMjk4Mzc0MjY2NzE4NTAsXG4gICAgICAgICAgMC4wNzMzNDY0ODE0MTEwODAzMDU3MzQwMzM2MTUyNTMxMTY1MTgxMTkzLFxuICAgICAgICAgIDAuMDczMzQ2NDgxNDExMDgwMzA1NzM0MDMzNjE1MjUzMTE2NTE4MTE5MyxcbiAgICAgICAgICAwLjA1OTI5ODU4NDkxNTQzNjc4MDc0NjM2Nzc1ODUwMDEwODU4NDU0MTIsXG4gICAgICAgICAgMC4wNTkyOTg1ODQ5MTU0MzY3ODA3NDYzNjc3NTg1MDAxMDg1ODQ1NDEyLFxuICAgICAgICAgIDAuMDQ0Mjc3NDM4ODE3NDE5ODA2MTY4NjAyNzQ4MjExMzM4MjI4ODU5MyxcbiAgICAgICAgICAwLjA0NDI3NzQzODgxNzQxOTgwNjE2ODYwMjc0ODIxMTMzODIyODg1OTMsXG4gICAgICAgICAgMC4wMjg1MzEzODg2Mjg5MzM2NjMxODEzMDc4MTU5NTE4NzgyODY0NDkxLFxuICAgICAgICAgIDAuMDI4NTMxMzg4NjI4OTMzNjYzMTgxMzA3ODE1OTUxODc4Mjg2NDQ5MSxcbiAgICAgICAgICAwLjAxMjM0MTIyOTc5OTk4NzE5OTU0NjgwNTY2NzA3MDAzNzI5MTU3NTksXG4gICAgICAgICAgMC4wMTIzNDEyMjk3OTk5ODcxOTk1NDY4MDU2NjcwNzAwMzcyOTE1NzU5XG4gICAgICAgIF0sXG4gICAgICAgIGFyY2ZuOiBmdW5jdGlvbih0LCBkZXJpdmF0aXZlRm4pIHtcbiAgICAgICAgICB2YXIgZCA9IGRlcml2YXRpdmVGbih0KTtcbiAgICAgICAgICB2YXIgbCA9IGQueCpkLnggKyBkLnkqZC55O1xuICAgICAgICAgIGlmKHR5cGVvZiBkLnogIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgICAgIGwgKz0gZC56KmQuejtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHNxcnQobCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgYmV0d2VlbjogZnVuY3Rpb24odiwgbSwgTSkge1xuICAgICAgICAgIHJldHVybiAobSA8PSB2ICYmIHYgPD0gTSkgfHwgdXRpbHMuYXBwcm94aW1hdGVseSh2LCBtKSB8fCB1dGlscy5hcHByb3hpbWF0ZWx5KHYsIE0pO1xuICAgICAgICB9LFxuXG4gICAgICAgIGFwcHJveGltYXRlbHk6IGZ1bmN0aW9uKGEsYixwcmVjaXNpb24pIHtcbiAgICAgICAgICByZXR1cm4gYWJzKGEtYikgPD0gKHByZWNpc2lvbiB8fCBlcHNpbG9uKTtcbiAgICAgICAgfSxcbiAgICAgICAgbGVuZ3RoOiBmdW5jdGlvbihkZXJpdmF0aXZlRm4pIHtcbiAgICAgICAgICB2YXIgej0wLjUsc3VtPTAsbGVuPXV0aWxzLlR2YWx1ZXMubGVuZ3RoLGksdDtcbiAgICAgICAgICBmb3IoaT0wOyBpPGxlbjsgaSsrKSB7XG4gICAgICAgICAgICB0ID0geiAqIHV0aWxzLlR2YWx1ZXNbaV0gKyB6O1xuICAgICAgICAgICAgc3VtICs9IHV0aWxzLkN2YWx1ZXNbaV0gKiB1dGlscy5hcmNmbih0LGRlcml2YXRpdmVGbik7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiB6ICogc3VtO1xuICAgICAgICB9LFxuXG4gICAgICAgIG1hcDogZnVuY3Rpb24odiwgZHMsZGUsIHRzLHRlKSB7XG4gICAgICAgICAgdmFyIGQxID0gZGUtZHMsIGQyID0gdGUtdHMsIHYyID0gIHYtZHMsIHIgPSB2Mi9kMTtcbiAgICAgICAgICByZXR1cm4gdHMgKyBkMipyO1xuICAgICAgICB9LFxuXG4gICAgICAgIGxlcnA6IGZ1bmN0aW9uKHIsIHYxLCB2Mikge1xuICAgICAgICAgIHZhciByZXQgPSB7XG4gICAgICAgICAgICB4OiB2MS54ICsgcioodjIueC12MS54KSxcbiAgICAgICAgICAgIHk6IHYxLnkgKyByKih2Mi55LXYxLnkpXG4gICAgICAgICAgfTtcbiAgICAgICAgICBpZighIXYxLnogJiYgISF2Mi56KSB7XG4gICAgICAgICAgICByZXQueiA9ICB2MS56ICsgcioodjIuei12MS56KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHJldDtcbiAgICAgICAgfSxcblxuICAgICAgICBwb2ludFRvU3RyaW5nOiBmdW5jdGlvbihwKSB7XG4gICAgICAgICAgdmFyIHMgPSBwLngrXCIvXCIrcC55O1xuICAgICAgICAgIGlmKHR5cGVvZiBwLnogIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgICAgIHMgKz0gXCIvXCIrcC56O1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gcztcbiAgICAgICAgfSxcblxuICAgICAgICBwb2ludHNUb1N0cmluZzogZnVuY3Rpb24ocG9pbnRzKSB7XG4gICAgICAgICAgcmV0dXJuIFwiW1wiICsgcG9pbnRzLm1hcCh1dGlscy5wb2ludFRvU3RyaW5nKS5qb2luKFwiLCBcIikgKyBcIl1cIjtcbiAgICAgICAgfSxcblxuICAgICAgICBjb3B5OiBmdW5jdGlvbihvYmopIHtcbiAgICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShvYmopKTtcbiAgICAgICAgfSxcblxuICAgICAgICBhbmdsZTogZnVuY3Rpb24obyx2MSx2Mikge1xuICAgICAgICAgIHZhciBkeDEgPSB2MS54IC0gby54LFxuICAgICAgICAgICAgZHkxID0gdjEueSAtIG8ueSxcbiAgICAgICAgICAgIGR4MiA9IHYyLnggLSBvLngsXG4gICAgICAgICAgICBkeTIgPSB2Mi55IC0gby55LFxuICAgICAgICAgICAgY3Jvc3MgPSBkeDEqZHkyIC0gZHkxKmR4MixcbiAgICAgICAgICAgIG0xID0gc3FydChkeDEqZHgxK2R5MSpkeTEpLFxuICAgICAgICAgICAgbTIgPSBzcXJ0KGR4MipkeDIrZHkyKmR5MiksXG4gICAgICAgICAgICBkb3Q7XG4gICAgICAgICAgZHgxLz1tMTsgZHkxLz1tMTsgZHgyLz1tMjsgZHkyLz1tMjtcbiAgICAgICAgICBkb3QgPSBkeDEqZHgyICsgZHkxKmR5MjtcbiAgICAgICAgICByZXR1cm4gYXRhbjIoY3Jvc3MsIGRvdCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgLy8gcm91bmQgYXMgc3RyaW5nLCB0byBhdm9pZCByb3VuZGluZyBlcnJvcnNcbiAgICAgICAgcm91bmQ6IGZ1bmN0aW9uKHYsIGQpIHtcbiAgICAgICAgICB2YXIgcyA9ICcnICsgdjtcbiAgICAgICAgICB2YXIgcG9zID0gcy5pbmRleE9mKFwiLlwiKTtcbiAgICAgICAgICByZXR1cm4gcGFyc2VGbG9hdChzLnN1YnN0cmluZygwLHBvcysxK2QpKTtcbiAgICAgICAgfSxcblxuICAgICAgICBkaXN0OiBmdW5jdGlvbihwMSwgcDIpIHtcbiAgICAgICAgICB2YXIgZHggPSBwMS54IC0gcDIueCxcbiAgICAgICAgICAgIGR5ID0gcDEueSAtIHAyLnk7XG4gICAgICAgICAgcmV0dXJuIHNxcnQoZHgqZHgrZHkqZHkpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGNsb3Nlc3Q6IGZ1bmN0aW9uKExVVCwgcG9pbnQpIHtcbiAgICAgICAgICB2YXIgbWRpc3QgPSBwb3coMiw2MyksIG1wb3MsIGQ7XG4gICAgICAgICAgTFVULmZvckVhY2goZnVuY3Rpb24ocCwgaWR4KSB7XG4gICAgICAgICAgICBkID0gdXRpbHMuZGlzdChwb2ludCwgcCk7XG4gICAgICAgICAgICBpZiAoZDxtZGlzdCkge1xuICAgICAgICAgICAgICBtZGlzdCA9IGQ7XG4gICAgICAgICAgICAgIG1wb3MgPSBpZHg7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmV0dXJuIHsgbWRpc3Q6bWRpc3QsIG1wb3M6bXBvcyB9O1xuICAgICAgICB9LFxuXG4gICAgICAgIGFiY3JhdGlvOiBmdW5jdGlvbih0LCBuKSB7XG4gICAgICAgICAgLy8gc2VlIHJhdGlvKHQpIG5vdGUgb24gaHR0cDovL3BvbWF4LmdpdGh1Yi5pby9iZXppZXJpbmZvLyNhYmNcbiAgICAgICAgICBpZiAobiE9PTIgJiYgbiE9PTMpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHR5cGVvZiB0ID09PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgICB0ID0gMC41O1xuICAgICAgICAgIH0gZWxzZSBpZiAodD09PTAgfHwgdD09PTEpIHtcbiAgICAgICAgICAgIHJldHVybiB0O1xuICAgICAgICAgIH1cbiAgICAgICAgICB2YXIgYm90dG9tID0gcG93KHQsbikgKyBwb3coMS10LG4pLCB0b3AgPSBib3R0b20gLSAxO1xuICAgICAgICAgIHJldHVybiBhYnModG9wL2JvdHRvbSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgcHJvamVjdGlvbnJhdGlvOiBmdW5jdGlvbih0LCBuKSB7XG4gICAgICAgICAgLy8gc2VlIHUodCkgbm90ZSBvbiBodHRwOi8vcG9tYXguZ2l0aHViLmlvL2JlemllcmluZm8vI2FiY1xuICAgICAgICAgIGlmIChuIT09MiAmJiBuIT09Mykge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAodHlwZW9mIHQgPT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgICAgIHQgPSAwLjU7XG4gICAgICAgICAgfSBlbHNlIGlmICh0PT09MCB8fCB0PT09MSkge1xuICAgICAgICAgICAgcmV0dXJuIHQ7XG4gICAgICAgICAgfVxuICAgICAgICAgIHZhciB0b3AgPSBwb3coMS10LCBuKSwgYm90dG9tID0gcG93KHQsbikgKyB0b3A7XG4gICAgICAgICAgcmV0dXJuIHRvcC9ib3R0b207XG4gICAgICAgIH0sXG5cbiAgICAgICAgbGxpODogZnVuY3Rpb24oeDEseTEseDIseTIseDMseTMseDQseTQpIHtcbiAgICAgICAgICB2YXIgbng9KHgxKnkyLXkxKngyKSooeDMteDQpLSh4MS14MikqKHgzKnk0LXkzKng0KSxcbiAgICAgICAgICAgIG55PSh4MSp5Mi15MSp4MikqKHkzLXk0KS0oeTEteTIpKih4Myp5NC15Myp4NCksXG4gICAgICAgICAgICBkPSh4MS14MikqKHkzLXk0KS0oeTEteTIpKih4My14NCk7XG4gICAgICAgICAgaWYoZD09MCkgeyByZXR1cm4gZmFsc2U7IH1cbiAgICAgICAgICByZXR1cm4geyB4OiBueC9kLCB5OiBueS9kIH07XG4gICAgICAgIH0sXG5cbiAgICAgICAgbGxpNDogZnVuY3Rpb24ocDEscDIscDMscDQpIHtcbiAgICAgICAgICB2YXIgeDEgPSBwMS54LCB5MSA9IHAxLnksXG4gICAgICAgICAgICB4MiA9IHAyLngsIHkyID0gcDIueSxcbiAgICAgICAgICAgIHgzID0gcDMueCwgeTMgPSBwMy55LFxuICAgICAgICAgICAgeDQgPSBwNC54LCB5NCA9IHA0Lnk7XG4gICAgICAgICAgcmV0dXJuIHV0aWxzLmxsaTgoeDEseTEseDIseTIseDMseTMseDQseTQpO1xuICAgICAgICB9LFxuXG4gICAgICAgIGxsaTogZnVuY3Rpb24odjEsIHYyKSB7XG4gICAgICAgICAgcmV0dXJuIHV0aWxzLmxsaTQodjEsdjEuYyx2Mix2Mi5jKTtcbiAgICAgICAgfSxcblxuICAgICAgICBtYWtlbGluZTogZnVuY3Rpb24ocDEscDIpIHtcbiAgICAgICAgICB2YXIgeDEgPSBwMS54LCB5MSA9IHAxLnksIHgyID0gcDIueCwgeTIgPSBwMi55LCBkeCA9ICh4Mi14MSkvMywgZHkgPSAoeTIteTEpLzM7XG4gICAgICAgICAgcmV0dXJuIG5ldyBCZXppZXIoeDEsIHkxLCB4MStkeCwgeTErZHksIHgxKzIqZHgsIHkxKzIqZHksIHgyLCB5Mik7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZmluZGJib3g6IGZ1bmN0aW9uKHNlY3Rpb25zKSB7XG4gICAgICAgICAgdmFyIG14PTk5OTk5OTk5LG15PW14LE1YPS1teCxNWT1NWDtcbiAgICAgICAgICBzZWN0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uKHMpIHtcbiAgICAgICAgICAgIHZhciBiYm94ID0gcy5iYm94KCk7XG4gICAgICAgICAgICBpZihteCA+IGJib3gueC5taW4pIG14ID0gYmJveC54Lm1pbjtcbiAgICAgICAgICAgIGlmKG15ID4gYmJveC55Lm1pbikgbXkgPSBiYm94LnkubWluO1xuICAgICAgICAgICAgaWYoTVggPCBiYm94LngubWF4KSBNWCA9IGJib3gueC5tYXg7XG4gICAgICAgICAgICBpZihNWSA8IGJib3gueS5tYXgpIE1ZID0gYmJveC55Lm1heDtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgeDogeyBtaW46IG14LCBtaWQ6KG14K01YKS8yLCBtYXg6IE1YLCBzaXplOk1YLW14IH0sXG4gICAgICAgICAgICB5OiB7IG1pbjogbXksIG1pZDoobXkrTVkpLzIsIG1heDogTVksIHNpemU6TVktbXkgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBzaGFwZWludGVyc2VjdGlvbnM6IGZ1bmN0aW9uKHMxLCBiYm94MSwgczIsIGJib3gyKSB7XG4gICAgICAgICAgaWYoIXV0aWxzLmJib3hvdmVybGFwKGJib3gxLCBiYm94MikpIHJldHVybiBbXTtcbiAgICAgICAgICB2YXIgaW50ZXJzZWN0aW9ucyA9IFtdO1xuICAgICAgICAgIHZhciBhMSA9IFtzMS5zdGFydGNhcCwgczEuZm9yd2FyZCwgczEuYmFjaywgczEuZW5kY2FwXTtcbiAgICAgICAgICB2YXIgYTIgPSBbczIuc3RhcnRjYXAsIHMyLmZvcndhcmQsIHMyLmJhY2ssIHMyLmVuZGNhcF07XG4gICAgICAgICAgYTEuZm9yRWFjaChmdW5jdGlvbihsMSkge1xuICAgICAgICAgICAgaWYobDEudmlydHVhbCkgcmV0dXJuO1xuICAgICAgICAgICAgYTIuZm9yRWFjaChmdW5jdGlvbihsMikge1xuICAgICAgICAgICAgICBpZihsMi52aXJ0dWFsKSByZXR1cm47XG4gICAgICAgICAgICAgIHZhciBpc3MgPSBsMS5pbnRlcnNlY3RzKGwyKTtcbiAgICAgICAgICAgICAgaWYoaXNzLmxlbmd0aD4wKSB7XG4gICAgICAgICAgICAgICAgaXNzLmMxID0gbDE7XG4gICAgICAgICAgICAgICAgaXNzLmMyID0gbDI7XG4gICAgICAgICAgICAgICAgaXNzLnMxID0gczE7XG4gICAgICAgICAgICAgICAgaXNzLnMyID0gczI7XG4gICAgICAgICAgICAgICAgaW50ZXJzZWN0aW9ucy5wdXNoKGlzcyk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJldHVybiBpbnRlcnNlY3Rpb25zO1xuICAgICAgICB9LFxuXG4gICAgICAgIG1ha2VzaGFwZTogZnVuY3Rpb24oZm9yd2FyZCwgYmFjaykge1xuICAgICAgICAgIHZhciBicGwgPSBiYWNrLnBvaW50cy5sZW5ndGg7XG4gICAgICAgICAgdmFyIGZwbCA9IGZvcndhcmQucG9pbnRzLmxlbmd0aDtcbiAgICAgICAgICB2YXIgc3RhcnQgID0gdXRpbHMubWFrZWxpbmUoYmFjay5wb2ludHNbYnBsLTFdLCBmb3J3YXJkLnBvaW50c1swXSk7XG4gICAgICAgICAgdmFyIGVuZCAgICA9IHV0aWxzLm1ha2VsaW5lKGZvcndhcmQucG9pbnRzW2ZwbC0xXSwgYmFjay5wb2ludHNbMF0pO1xuICAgICAgICAgIHZhciBzaGFwZSAgPSB7XG4gICAgICAgICAgICBzdGFydGNhcDogc3RhcnQsXG4gICAgICAgICAgICBmb3J3YXJkOiBmb3J3YXJkLFxuICAgICAgICAgICAgYmFjazogYmFjayxcbiAgICAgICAgICAgIGVuZGNhcDogZW5kLFxuICAgICAgICAgICAgYmJveDogdXRpbHMuZmluZGJib3goW3N0YXJ0LCBmb3J3YXJkLCBiYWNrLCBlbmRdKVxuICAgICAgICAgIH07XG4gICAgICAgICAgdmFyIHNlbGYgPSB1dGlscztcbiAgICAgICAgICBzaGFwZS5pbnRlcnNlY3Rpb25zID0gZnVuY3Rpb24oczIpIHtcbiAgICAgICAgICAgIHJldHVybiBzZWxmLnNoYXBlaW50ZXJzZWN0aW9ucyhzaGFwZSxzaGFwZS5iYm94LHMyLHMyLmJib3gpO1xuICAgICAgICAgIH07XG4gICAgICAgICAgcmV0dXJuIHNoYXBlO1xuICAgICAgICB9LFxuXG4gICAgICAgIGdldG1pbm1heDogZnVuY3Rpb24oY3VydmUsIGQsIGxpc3QpIHtcbiAgICAgICAgICBpZighbGlzdCkgcmV0dXJuIHsgbWluOjAsIG1heDowIH07XG4gICAgICAgICAgdmFyIG1pbj0weEZGRkZGRkZGRkZGRkZGRkYsIG1heD0tbWluLHQsYztcbiAgICAgICAgICBpZihsaXN0LmluZGV4T2YoMCk9PT0tMSkgeyBsaXN0ID0gWzBdLmNvbmNhdChsaXN0KTsgfVxuICAgICAgICAgIGlmKGxpc3QuaW5kZXhPZigxKT09PS0xKSB7IGxpc3QucHVzaCgxKTsgfVxuICAgICAgICAgIGZvcih2YXIgaT0wLGxlbj1saXN0Lmxlbmd0aDsgaTxsZW47IGkrKykge1xuICAgICAgICAgICAgdCA9IGxpc3RbaV07XG4gICAgICAgICAgICBjID0gY3VydmUuZ2V0KHQpO1xuICAgICAgICAgICAgaWYoY1tkXSA8IG1pbikgeyBtaW4gPSBjW2RdOyB9XG4gICAgICAgICAgICBpZihjW2RdID4gbWF4KSB7IG1heCA9IGNbZF07IH1cbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHsgbWluOm1pbiwgbWlkOihtaW4rbWF4KS8yLCBtYXg6bWF4LCBzaXplOm1heC1taW4gfTtcbiAgICAgICAgfSxcblxuICAgICAgICBhbGlnbjogZnVuY3Rpb24ocG9pbnRzLCBsaW5lKSB7XG4gICAgICAgICAgdmFyIHR4ID0gbGluZS5wMS54LFxuICAgICAgICAgICAgdHkgPSBsaW5lLnAxLnksXG4gICAgICAgICAgICBhID0gLWF0YW4yKGxpbmUucDIueS10eSwgbGluZS5wMi54LXR4KSxcbiAgICAgICAgICAgIGQgPSBmdW5jdGlvbih2KSB7XG4gICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgeDogKHYueC10eCkqY29zKGEpIC0gKHYueS10eSkqc2luKGEpLFxuICAgICAgICAgICAgICAgIHk6ICh2LngtdHgpKnNpbihhKSArICh2LnktdHkpKmNvcyhhKVxuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICByZXR1cm4gcG9pbnRzLm1hcChkKTtcbiAgICAgICAgfSxcblxuICAgICAgICByb290czogZnVuY3Rpb24ocG9pbnRzLCBsaW5lKSB7XG4gICAgICAgICAgbGluZSA9IGxpbmUgfHwge3AxOnt4OjAseTowfSxwMjp7eDoxLHk6MH19O1xuICAgICAgICAgIHZhciBvcmRlciA9IHBvaW50cy5sZW5ndGggLSAxO1xuICAgICAgICAgIHZhciBwID0gdXRpbHMuYWxpZ24ocG9pbnRzLCBsaW5lKTtcbiAgICAgICAgICB2YXIgcmVkdWNlID0gZnVuY3Rpb24odCkgeyByZXR1cm4gMDw9dCAmJiB0IDw9MTsgfTtcblxuICAgICAgICAgIGlmIChvcmRlciA9PT0gMikge1xuICAgICAgICAgICAgdmFyIGEgPSBwWzBdLnksXG4gICAgICAgICAgICAgIGIgPSBwWzFdLnksXG4gICAgICAgICAgICAgIGMgPSBwWzJdLnksXG4gICAgICAgICAgICAgIGQgPSBhIC0gMipiICsgYztcbiAgICAgICAgICAgIGlmKGQhPT0wKSB7XG4gICAgICAgICAgICAgIHZhciBtMSA9IC1zcXJ0KGIqYi1hKmMpLFxuICAgICAgICAgICAgICAgIG0yID0gLWErYixcbiAgICAgICAgICAgICAgICB2MSA9IC0oIG0xK20yKS9kLFxuICAgICAgICAgICAgICAgIHYyID0gLSgtbTErbTIpL2Q7XG4gICAgICAgICAgICAgIHJldHVybiBbdjEsIHYyXS5maWx0ZXIocmVkdWNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYoYiE9PWMgJiYgZD09PTApIHtcbiAgICAgICAgICAgICAgcmV0dXJuIFsgKDIqYi1jKS8yKihiLWMpIF0uZmlsdGVyKHJlZHVjZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gc2VlIGh0dHA6Ly93d3cudHJhbnM0bWluZC5jb20vcGVyc29uYWxfZGV2ZWxvcG1lbnQvbWF0aGVtYXRpY3MvcG9seW5vbWlhbHMvY3ViaWNBbGdlYnJhLmh0bVxuICAgICAgICAgIHZhciBwYSA9IHBbMF0ueSxcbiAgICAgICAgICAgIHBiID0gcFsxXS55LFxuICAgICAgICAgICAgcGMgPSBwWzJdLnksXG4gICAgICAgICAgICBwZCA9IHBbM10ueSxcbiAgICAgICAgICAgIGQgPSAoLXBhICsgMypwYiAtIDMqcGMgKyBwZCksXG4gICAgICAgICAgICBhID0gKDMqcGEgLSA2KnBiICsgMypwYykgLyBkLFxuICAgICAgICAgICAgYiA9ICgtMypwYSArIDMqcGIpIC8gZCxcbiAgICAgICAgICAgIGMgPSBwYSAvIGQsXG4gICAgICAgICAgICBwID0gKDMqYiAtIGEqYSkvMyxcbiAgICAgICAgICAgIHAzID0gcC8zLFxuICAgICAgICAgICAgcSA9ICgyKmEqYSphIC0gOSphKmIgKyAyNypjKS8yNyxcbiAgICAgICAgICAgIHEyID0gcS8yLFxuICAgICAgICAgICAgZGlzY3JpbWluYW50ID0gcTIqcTIgKyBwMypwMypwMyxcbiAgICAgICAgICAgIHUxLHYxLHgxLHgyLHgzO1xuICAgICAgICAgIGlmIChkaXNjcmltaW5hbnQgPCAwKSB7XG4gICAgICAgICAgICB2YXIgbXAzID0gLXAvMyxcbiAgICAgICAgICAgICAgbXAzMyA9IG1wMyptcDMqbXAzLFxuICAgICAgICAgICAgICByID0gc3FydCggbXAzMyApLFxuICAgICAgICAgICAgICB0ID0gLXEvKDIqciksXG4gICAgICAgICAgICAgIGNvc3BoaSA9IHQ8LTEgPyAtMSA6IHQ+MSA/IDEgOiB0LFxuICAgICAgICAgICAgICBwaGkgPSBhY29zKGNvc3BoaSksXG4gICAgICAgICAgICAgIGNydHIgPSBjcnQociksXG4gICAgICAgICAgICAgIHQxID0gMipjcnRyO1xuICAgICAgICAgICAgeDEgPSB0MSAqIGNvcyhwaGkvMykgLSBhLzM7XG4gICAgICAgICAgICB4MiA9IHQxICogY29zKChwaGkrdGF1KS8zKSAtIGEvMztcbiAgICAgICAgICAgIHgzID0gdDEgKiBjb3MoKHBoaSsyKnRhdSkvMykgLSBhLzM7XG4gICAgICAgICAgICByZXR1cm4gW3gxLCB4MiwgeDNdLmZpbHRlcihyZWR1Y2UpO1xuICAgICAgICAgIH0gZWxzZSBpZihkaXNjcmltaW5hbnQgPT09IDApIHtcbiAgICAgICAgICAgIHUxID0gcTIgPCAwID8gY3J0KC1xMikgOiAtY3J0KHEyKTtcbiAgICAgICAgICAgIHgxID0gMip1MS1hLzM7XG4gICAgICAgICAgICB4MiA9IC11MSAtIGEvMztcbiAgICAgICAgICAgIHJldHVybiBbeDEseDJdLmZpbHRlcihyZWR1Y2UpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB2YXIgc2QgPSBzcXJ0KGRpc2NyaW1pbmFudCk7XG4gICAgICAgICAgICB1MSA9IGNydCgtcTIrc2QpO1xuICAgICAgICAgICAgdjEgPSBjcnQocTIrc2QpO1xuICAgICAgICAgICAgcmV0dXJuIFt1MS12MS1hLzNdLmZpbHRlcihyZWR1Y2UpOztcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgZHJvb3RzOiBmdW5jdGlvbihwKSB7XG4gICAgICAgICAgLy8gcXVhZHJhdGljIHJvb3RzIGFyZSBlYXN5XG4gICAgICAgICAgaWYocC5sZW5ndGggPT09IDMpIHtcbiAgICAgICAgICAgIHZhciBhID0gcFswXSxcbiAgICAgICAgICAgICAgYiA9IHBbMV0sXG4gICAgICAgICAgICAgIGMgPSBwWzJdLFxuICAgICAgICAgICAgICBkID0gYSAtIDIqYiArIGM7XG4gICAgICAgICAgICBpZihkIT09MCkge1xuICAgICAgICAgICAgICB2YXIgbTEgPSAtc3FydChiKmItYSpjKSxcbiAgICAgICAgICAgICAgICBtMiA9IC1hK2IsXG4gICAgICAgICAgICAgICAgdjEgPSAtKCBtMSttMikvZCxcbiAgICAgICAgICAgICAgICB2MiA9IC0oLW0xK20yKS9kO1xuICAgICAgICAgICAgICByZXR1cm4gW3YxLCB2Ml07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmKGIhPT1jICYmIGQ9PT0wKSB7XG4gICAgICAgICAgICAgIHJldHVybiBbICgyKmItYykvKDIqKGItYykpIF07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gbGluZWFyIHJvb3RzIGFyZSBldmVuIGVhc2llclxuICAgICAgICAgIGlmKHAubGVuZ3RoID09PSAyKSB7XG4gICAgICAgICAgICB2YXIgYSA9IHBbMF0sIGIgPSBwWzFdO1xuICAgICAgICAgICAgaWYoYSE9PWIpIHsgcmV0dXJuIFthLyhhLWIpXTsgfVxuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBpbmZsZWN0aW9uczogZnVuY3Rpb24ocG9pbnRzKSB7XG4gICAgICAgICAgdmFyIHAgPSB1dGlscy5hbGlnbihwb2ludHMsIHsgcDE6IHBvaW50c1swXSwgcDI6IHBvaW50c1szXSB9KSxcbiAgICAgICAgICAgIGEgPSBwWzJdLnggKiBwWzFdLnksXG4gICAgICAgICAgICBiID0gcFszXS54ICogcFsxXS55LFxuICAgICAgICAgICAgYyA9IHBbMV0ueCAqIHBbMl0ueSxcbiAgICAgICAgICAgIGQgPSBwWzNdLnggKiBwWzJdLnksXG4gICAgICAgICAgICB2MSA9IDE4ICogKC0zKmEgKyAyKmIgKyAzKmMgLSBkKSxcbiAgICAgICAgICAgIHYyID0gMTggKiAoMyphIC0gYiAtIDMqYyksXG4gICAgICAgICAgICB2MyA9IDE4ICogKGMgLSBhKTtcblxuICAgICAgICAgIGlmICh1dGlscy5hcHByb3hpbWF0ZWx5KHYxLDApKSByZXR1cm4gW107XG5cbiAgICAgICAgICB2YXIgdHJtID0gdjIqdjIgLSA0KnYxKnYzLFxuICAgICAgICAgICAgc3EgPSBNYXRoLnNxcnQodHJtKSxcbiAgICAgICAgICAgIGQgPSAyICogdjE7XG5cbiAgICAgICAgICBpZiAodXRpbHMuYXBwcm94aW1hdGVseShkLDApKSByZXR1cm4gW107XG5cbiAgICAgICAgICByZXR1cm4gWyhzcS12MikvZCwgLSh2MitzcSkvZF0uZmlsdGVyKGZ1bmN0aW9uKHIpIHtcbiAgICAgICAgICAgIHJldHVybiAoMCA8PSByICYmIHIgPD0gMSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgYmJveG92ZXJsYXA6IGZ1bmN0aW9uKGIxLGIyKSB7XG4gICAgICAgICAgdmFyIGRpbXM9Wyd4JywneSddLGxlbj1kaW1zLmxlbmd0aCxpLGRpbSxsLHQsZFxuICAgICAgICAgIGZvcihpPTA7IGk8bGVuOyBpKyspIHtcbiAgICAgICAgICAgIGRpbSA9IGRpbXNbaV07XG4gICAgICAgICAgICBsID0gYjFbZGltXS5taWQ7XG4gICAgICAgICAgICB0ID0gYjJbZGltXS5taWQ7XG4gICAgICAgICAgICBkID0gKGIxW2RpbV0uc2l6ZSArIGIyW2RpbV0uc2l6ZSkvMjtcbiAgICAgICAgICAgIGlmKGFicyhsLXQpID49IGQpIHJldHVybiBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0sXG5cbiAgICAgICAgZXhwYW5kYm94OiBmdW5jdGlvbihiYm94LCBfYmJveCkge1xuICAgICAgICAgIGlmKF9iYm94LngubWluIDwgYmJveC54Lm1pbikgeyBiYm94LngubWluID0gX2Jib3gueC5taW47IH1cbiAgICAgICAgICBpZihfYmJveC55Lm1pbiA8IGJib3gueS5taW4pIHsgYmJveC55Lm1pbiA9IF9iYm94LnkubWluOyB9XG4gICAgICAgICAgaWYoX2Jib3gueiAmJiBfYmJveC56Lm1pbiA8IGJib3guei5taW4pIHsgYmJveC56Lm1pbiA9IF9iYm94LnoubWluOyB9XG4gICAgICAgICAgaWYoX2Jib3gueC5tYXggPiBiYm94LngubWF4KSB7IGJib3gueC5tYXggPSBfYmJveC54Lm1heDsgfVxuICAgICAgICAgIGlmKF9iYm94LnkubWF4ID4gYmJveC55Lm1heCkgeyBiYm94LnkubWF4ID0gX2Jib3gueS5tYXg7IH1cbiAgICAgICAgICBpZihfYmJveC56ICYmIF9iYm94LnoubWF4ID4gYmJveC56Lm1heCkgeyBiYm94LnoubWF4ID0gX2Jib3guei5tYXg7IH1cbiAgICAgICAgICBiYm94LngubWlkID0gKGJib3gueC5taW4gKyBiYm94LngubWF4KS8yO1xuICAgICAgICAgIGJib3gueS5taWQgPSAoYmJveC55Lm1pbiArIGJib3gueS5tYXgpLzI7XG4gICAgICAgICAgaWYoYmJveC56KSB7IGJib3guei5taWQgPSAoYmJveC56Lm1pbiArIGJib3guei5tYXgpLzI7IH1cbiAgICAgICAgICBiYm94Lnguc2l6ZSA9IGJib3gueC5tYXggLSBiYm94LngubWluO1xuICAgICAgICAgIGJib3gueS5zaXplID0gYmJveC55Lm1heCAtIGJib3gueS5taW47XG4gICAgICAgICAgaWYoYmJveC56KSB7IGJib3guei5zaXplID0gYmJveC56Lm1heCAtIGJib3guei5taW47IH1cbiAgICAgICAgfSxcblxuICAgICAgICBwYWlyaXRlcmF0aW9uOiBmdW5jdGlvbihjMSxjMikge1xuICAgICAgICAgIHZhciBjMWIgPSBjMS5iYm94KCksXG4gICAgICAgICAgICBjMmIgPSBjMi5iYm94KCksXG4gICAgICAgICAgICByID0gMTAwMDAwLFxuICAgICAgICAgICAgdGhyZXNob2xkID0gMC41O1xuICAgICAgICAgIGlmKGMxYi54LnNpemUgKyBjMWIueS5zaXplIDwgdGhyZXNob2xkICYmIGMyYi54LnNpemUgKyBjMmIueS5zaXplIDwgdGhyZXNob2xkKSB7XG4gICAgICAgICAgICByZXR1cm4gWyAoKHIgKiAoYzEuX3QxK2MxLl90MikvMil8MCkvciArIFwiL1wiICsgKChyICogKGMyLl90MStjMi5fdDIpLzIpfDApL3IgXTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdmFyIGNjMSA9IGMxLnNwbGl0KDAuNSksXG4gICAgICAgICAgICBjYzIgPSBjMi5zcGxpdCgwLjUpLFxuICAgICAgICAgICAgcGFpcnMgPSBbXG4gICAgICAgICAgICAgIHtsZWZ0OiBjYzEubGVmdCwgcmlnaHQ6IGNjMi5sZWZ0IH0sXG4gICAgICAgICAgICAgIHtsZWZ0OiBjYzEubGVmdCwgcmlnaHQ6IGNjMi5yaWdodCB9LFxuICAgICAgICAgICAgICB7bGVmdDogY2MxLnJpZ2h0LCByaWdodDogY2MyLnJpZ2h0IH0sXG4gICAgICAgICAgICAgIHtsZWZ0OiBjYzEucmlnaHQsIHJpZ2h0OiBjYzIubGVmdCB9XTtcbiAgICAgICAgICBwYWlycyA9IHBhaXJzLmZpbHRlcihmdW5jdGlvbihwYWlyKSB7XG4gICAgICAgICAgICByZXR1cm4gdXRpbHMuYmJveG92ZXJsYXAocGFpci5sZWZ0LmJib3goKSxwYWlyLnJpZ2h0LmJib3goKSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgdmFyIHJlc3VsdHMgPSBbXTtcbiAgICAgICAgICBpZihwYWlycy5sZW5ndGggPT09IDApIHJldHVybiByZXN1bHRzO1xuICAgICAgICAgIHBhaXJzLmZvckVhY2goZnVuY3Rpb24ocGFpcikge1xuICAgICAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuY29uY2F0KFxuICAgICAgICAgICAgICB1dGlscy5wYWlyaXRlcmF0aW9uKHBhaXIubGVmdCwgcGFpci5yaWdodClcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSlcbiAgICAgICAgICByZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIoZnVuY3Rpb24odixpKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0cy5pbmRleE9mKHYpID09PSBpO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJldHVybiByZXN1bHRzO1xuICAgICAgICB9LFxuXG4gICAgICAgIGdldGNjZW50ZXI6IGZ1bmN0aW9uKHAxLHAyLHAzKSB7XG4gICAgICAgICAgdmFyIGR4MSA9IChwMi54IC0gcDEueCksXG4gICAgICAgICAgICBkeTEgPSAocDIueSAtIHAxLnkpLFxuICAgICAgICAgICAgZHgyID0gKHAzLnggLSBwMi54KSxcbiAgICAgICAgICAgIGR5MiA9IChwMy55IC0gcDIueSk7XG4gICAgICAgICAgdmFyIGR4MXAgPSBkeDEgKiBjb3MocXVhcnQpIC0gZHkxICogc2luKHF1YXJ0KSxcbiAgICAgICAgICAgIGR5MXAgPSBkeDEgKiBzaW4ocXVhcnQpICsgZHkxICogY29zKHF1YXJ0KSxcbiAgICAgICAgICAgIGR4MnAgPSBkeDIgKiBjb3MocXVhcnQpIC0gZHkyICogc2luKHF1YXJ0KSxcbiAgICAgICAgICAgIGR5MnAgPSBkeDIgKiBzaW4ocXVhcnQpICsgZHkyICogY29zKHF1YXJ0KTtcbiAgICAgICAgICAvLyBjaG9yZCBtaWRwb2ludHNcbiAgICAgICAgICB2YXIgbXgxID0gKHAxLnggKyBwMi54KS8yLFxuICAgICAgICAgICAgbXkxID0gKHAxLnkgKyBwMi55KS8yLFxuICAgICAgICAgICAgbXgyID0gKHAyLnggKyBwMy54KS8yLFxuICAgICAgICAgICAgbXkyID0gKHAyLnkgKyBwMy55KS8yO1xuICAgICAgICAgIC8vIG1pZHBvaW50IG9mZnNldHNcbiAgICAgICAgICB2YXIgbXgxbiA9IG14MSArIGR4MXAsXG4gICAgICAgICAgICBteTFuID0gbXkxICsgZHkxcCxcbiAgICAgICAgICAgIG14Mm4gPSBteDIgKyBkeDJwLFxuICAgICAgICAgICAgbXkybiA9IG15MiArIGR5MnA7XG4gICAgICAgICAgLy8gaW50ZXJzZWN0aW9uIG9mIHRoZXNlIGxpbmVzOlxuICAgICAgICAgIHZhciBhcmMgPSB1dGlscy5sbGk4KG14MSxteTEsbXgxbixteTFuLCBteDIsbXkyLG14Mm4sbXkybiksXG4gICAgICAgICAgICByID0gdXRpbHMuZGlzdChhcmMscDEpLFxuICAgICAgICAgIC8vIGFyYyBzdGFydC9lbmQgdmFsdWVzLCBvdmVyIG1pZCBwb2ludDpcbiAgICAgICAgICAgIHMgPSBhdGFuMihwMS55IC0gYXJjLnksIHAxLnggLSBhcmMueCksXG4gICAgICAgICAgICBtID0gYXRhbjIocDIueSAtIGFyYy55LCBwMi54IC0gYXJjLngpLFxuICAgICAgICAgICAgZSA9IGF0YW4yKHAzLnkgLSBhcmMueSwgcDMueCAtIGFyYy54KSxcbiAgICAgICAgICAgIF87XG4gICAgICAgICAgLy8gZGV0ZXJtaW5lIGFyYyBkaXJlY3Rpb24gKGN3L2NjdyBjb3JyZWN0aW9uKVxuICAgICAgICAgIGlmIChzPGUpIHtcbiAgICAgICAgICAgIC8vIGlmIHM8bTxlLCBhcmMocywgZSlcbiAgICAgICAgICAgIC8vIGlmIG08czxlLCBhcmMoZSwgcyArIHRhdSlcbiAgICAgICAgICAgIC8vIGlmIHM8ZTxtLCBhcmMoZSwgcyArIHRhdSlcbiAgICAgICAgICAgIGlmIChzPm0gfHwgbT5lKSB7IHMgKz0gdGF1OyB9XG4gICAgICAgICAgICBpZiAocz5lKSB7IF89ZTsgZT1zOyBzPV87IH1cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gaWYgZTxtPHMsIGFyYyhlLCBzKVxuICAgICAgICAgICAgLy8gaWYgbTxlPHMsIGFyYyhzLCBlICsgdGF1KVxuICAgICAgICAgICAgLy8gaWYgZTxzPG0sIGFyYyhzLCBlICsgdGF1KVxuICAgICAgICAgICAgaWYgKGU8bSAmJiBtPHMpIHsgXz1lOyBlPXM7IHM9XzsgfSBlbHNlIHsgZSArPSB0YXU7IH1cbiAgICAgICAgICB9XG4gICAgICAgICAgLy8gYXNzaWduIGFuZCBkb25lLlxuICAgICAgICAgIGFyYy5zID0gcztcbiAgICAgICAgICBhcmMuZSA9IGU7XG4gICAgICAgICAgYXJjLnIgPSByO1xuICAgICAgICAgIHJldHVybiBhcmM7XG4gICAgICAgIH1cbiAgICAgIH07XG5cblxuXG4gICAgLyoqXG4gICAgICogUG9seSBCZXppZXJcbiAgICAgKiBAcGFyYW0ge1t0eXBlXX0gY3VydmVzIFtkZXNjcmlwdGlvbl1cbiAgICAgKi9cbiAgICB2YXIgUG9seUJlemllciA9IGZ1bmN0aW9uKGN1cnZlcykge1xuICAgICAgdGhpcy5jdXJ2ZXMgPSBbXTtcbiAgICAgIHRoaXMuXzNkID0gZmFsc2U7XG4gICAgICBpZighIWN1cnZlcykge1xuICAgICAgICB0aGlzLmN1cnZlcyA9IGN1cnZlcztcbiAgICAgICAgdGhpcy5fM2QgPSB0aGlzLmN1cnZlc1swXS5fM2Q7XG4gICAgICB9XG4gICAgfVxuXG4gICAgUG9seUJlemllci5wcm90b3R5cGUgPSB7XG4gICAgICB2YWx1ZU9mOiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudG9TdHJpbmcoKTtcbiAgICAgIH0sXG4gICAgICB0b1N0cmluZzogZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB1dGlscy5wb2ludHNUb1N0cmluZyh0aGlzLnBvaW50cyk7XG4gICAgICB9LFxuICAgICAgYWRkQ3VydmU6IGZ1bmN0aW9uKGN1cnZlKSB7XG4gICAgICAgIHRoaXMuY3VydmVzLnB1c2goY3VydmUpO1xuICAgICAgICB0aGlzLl8zZCA9IHRoaXMuXzNkIHx8IGN1cnZlLl8zZDtcbiAgICAgIH0sXG4gICAgICBsZW5ndGg6IGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jdXJ2ZXMubWFwKGZ1bmN0aW9uKHYpIHsgcmV0dXJuIHYubGVuZ3RoKCk7IH0pLnJlZHVjZShmdW5jdGlvbihhLGIpIHsgcmV0dXJuIGErYjsgfSk7XG4gICAgICB9LFxuICAgICAgY3VydmU6IGZ1bmN0aW9uKGlkeCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jdXJ2ZXNbaWR4XTtcbiAgICAgIH0sXG4gICAgICBiYm94OiBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGMgPSB0aGlzLmN1cnZlcztcbiAgICAgICAgdmFyIGJib3ggPSBjWzBdLmJib3goKTtcbiAgICAgICAgZm9yKHZhciBpPTE7IGk8Yy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIHV0aWxzLmV4cGFuZGJveChiYm94LCBjW2ldLmJib3goKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGJib3g7XG4gICAgICB9LFxuICAgICAgb2Zmc2V0OiBmdW5jdGlvbihkKSB7XG4gICAgICAgIHZhciBvZmZzZXQgPSBbXTtcbiAgICAgICAgdGhpcy5jdXJ2ZXMuZm9yRWFjaChmdW5jdGlvbih2KSB7XG4gICAgICAgICAgb2Zmc2V0ID0gb2Zmc2V0LmNvbmNhdCh2Lm9mZnNldChkKSk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gbmV3IFBvbHlCZXppZXIob2Zmc2V0KTtcbiAgICAgIH1cbiAgICB9O1xuXG5cblxuXG4gIC8qKlxuICAgKiBCZXppZXIgY3VydmUgY29uc3RydWN0b3IuIFRoZSBjb25zdHJ1Y3RvciBhcmd1bWVudCBjYW4gYmUgb25lIG9mIHRocmVlIHRoaW5nczpcbiAgICpcbiAgICogMS4gYXJyYXkvNCBvZiB7eDouLi4sIHk6Li4uLCB6Oi4uLn0sIHogb3B0aW9uYWxcbiAgICogMi4gbnVtZXJpY2FsIGFycmF5Lzggb3JkZXJlZCB4MSx5MSx4Mix5Mix4Myx5Myx4NCx5NFxuICAgKiAzLiBudW1lcmljYWwgYXJyYXkvMTIgb3JkZXJlZCB4MSx5MSx6MSx4Mix5Mix6Mix4Myx5Myx6Myx4NCx5NCx6NFxuICAgKlxuICAgKi9cbiAgdmFyIEJlemllciA9IGZ1bmN0aW9uKGNvb3Jkcykge1xuICAgIHZhciBhcmdzID0gKGNvb3JkcyAmJiBjb29yZHMuZm9yRWFjaCkgPyBjb29yZHMgOiBbXS5zbGljZS5jYWxsKGFyZ3VtZW50cyk7XG4gICAgdmFyIGNvb3JkbGVuID0gZmFsc2U7XG4gICAgaWYodHlwZW9mIGFyZ3NbMF0gPT09IFwib2JqZWN0XCIpIHtcbiAgICAgIGNvb3JkbGVuID0gYXJncy5sZW5ndGg7XG4gICAgICB2YXIgbmV3YXJncyA9IFtdO1xuICAgICAgYXJncy5mb3JFYWNoKGZ1bmN0aW9uKHBvaW50KSB7XG4gICAgICAgIFsneCcsJ3knLCd6J10uZm9yRWFjaChmdW5jdGlvbihkKSB7XG4gICAgICAgICAgaWYodHlwZW9mIHBvaW50W2RdICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgICBuZXdhcmdzLnB1c2gocG9pbnRbZF0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICAgIGFyZ3MgPSBuZXdhcmdzO1xuICAgIH1cbiAgICB2YXIgaGlnaGVyID0gZmFsc2U7XG4gICAgdmFyIGxlbiA9IGFyZ3MubGVuZ3RoO1xuICAgIGlmIChjb29yZGxlbikge1xuICAgICAgaWYoY29vcmRsZW4+NCkge1xuICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCAhPT0gMSkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIk9ubHkgbmV3IEJlemllcihwb2ludFtdKSBpcyBhY2NlcHRlZCBmb3IgNHRoIGFuZCBoaWdoZXIgb3JkZXIgY3VydmVzXCIpO1xuICAgICAgICB9XG4gICAgICAgIGhpZ2hlciA9IHRydWU7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmKGxlbiE9PTYgJiYgbGVuIT09OCAmJiBsZW4hPT05ICYmIGxlbiE9PTEyKSB7XG4gICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoICE9PSAxKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiT25seSBuZXcgQmV6aWVyKHBvaW50W10pIGlzIGFjY2VwdGVkIGZvciA0dGggYW5kIGhpZ2hlciBvcmRlciBjdXJ2ZXNcIik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgdmFyIF8zZCA9ICghaGlnaGVyICYmIChsZW4gPT09IDkgfHwgbGVuID09PSAxMikpIHx8IChjb29yZHMgJiYgY29vcmRzWzBdICYmIHR5cGVvZiBjb29yZHNbMF0ueiAhPT0gXCJ1bmRlZmluZWRcIik7XG4gICAgdGhpcy5fM2QgPSBfM2Q7XG4gICAgdmFyIHBvaW50cyA9IFtdO1xuICAgIGZvcih2YXIgaWR4PTAsIHN0ZXA9KF8zZCA/IDMgOiAyKTsgaWR4PGxlbjsgaWR4Kz1zdGVwKSB7XG4gICAgICB2YXIgcG9pbnQgPSB7XG4gICAgICAgIHg6IGFyZ3NbaWR4XSxcbiAgICAgICAgeTogYXJnc1tpZHgrMV1cbiAgICAgIH07XG4gICAgICBpZihfM2QpIHsgcG9pbnQueiA9IGFyZ3NbaWR4KzJdIH07XG4gICAgICBwb2ludHMucHVzaChwb2ludCk7XG4gICAgfVxuICAgIHRoaXMub3JkZXIgPSBwb2ludHMubGVuZ3RoIC0gMTtcbiAgICB0aGlzLnBvaW50cyA9IHBvaW50cztcbiAgICB2YXIgZGltcyA9IFsneCcsJ3knXTtcbiAgICBpZihfM2QpIGRpbXMucHVzaCgneicpO1xuICAgIHRoaXMuZGltcyA9IGRpbXM7XG4gICAgdGhpcy5kaW1sZW4gPSBkaW1zLmxlbmd0aDtcbiAgICAoZnVuY3Rpb24oY3VydmUpIHtcbiAgICAgIHZhciBhID0gdXRpbHMuYWxpZ24ocG9pbnRzLCB7cDE6cG9pbnRzWzBdLCBwMjpwb2ludHNbY3VydmUub3JkZXJdfSk7XG4gICAgICBmb3IodmFyIGk9MDsgaTxhLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGlmKGFicyhhW2ldLnkpID4gMC4wMDAxKSB7XG4gICAgICAgICAgY3VydmUuX2xpbmVhciA9IGZhbHNlO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgY3VydmUuX2xpbmVhciA9IHRydWU7XG4gICAgfSh0aGlzKSk7XG4gICAgdGhpcy5fdDEgPSAwO1xuICAgIHRoaXMuX3QyID0gMTtcbiAgICB0aGlzLnVwZGF0ZSgpO1xuICB9O1xuXG4gIEJlemllci5mcm9tU1ZHID0gZnVuY3Rpb24oc3ZnU3RyaW5nKSB7XG4gICAgdmFyIGxpc3QgPSBzdmdTdHJpbmcubWF0Y2goL1stK10/XFxkKlxcLj9cXGQrKD86W2VFXVstK10/XFxkKyk/L2cpLm1hcChwYXJzZUZsb2F0KTtcbiAgICB2YXIgcmVsYXRpdmUgPSAvW2NxXS8udGVzdChzdmdTdHJpbmcpO1xuICAgIGlmKCFyZWxhdGl2ZSkgcmV0dXJuIG5ldyBCZXppZXIobGlzdCk7XG4gICAgbGlzdCA9IGxpc3QubWFwKGZ1bmN0aW9uKHYsaSkge1xuICAgICAgcmV0dXJuIGkgPCAyID8gdiA6IHYgKyBsaXN0W2kgJSAyXTtcbiAgICB9KTtcbiAgICByZXR1cm4gbmV3IEJlemllcihsaXN0KTtcbiAgfTtcblxuICBCZXppZXIuZ2V0QUJDID0gZnVuY3Rpb24gKG4sUyxCLEUsdCkge1xuICAgIGlmKHR5cGVvZiB0ID09PSBcInVuZGVmaW5lZFwiKSB7IHQgPSAwLjU7IH1cbiAgICB2YXIgdSA9IHV0aWxzLnByb2plY3Rpb25yYXRpbyh0LG4pLFxuICAgICAgICB1bSA9IDEtdSxcbiAgICAgICAgQyA9IHtcbiAgICAgICAgICB4OiB1KlMueCArIHVtKkUueCxcbiAgICAgICAgICB5OiB1KlMueSArIHVtKkUueVxuICAgICAgICB9LFxuICAgICAgICBzID0gdXRpbHMuYWJjcmF0aW8odCxuKSxcbiAgICAgICAgQSA9IHtcbiAgICAgICAgICB4OiBCLnggKyAoQi54LUMueCkvcyxcbiAgICAgICAgICB5OiBCLnkgKyAoQi55LUMueSkvc1xuICAgICAgICB9O1xuICAgIHJldHVybiB7IEE6QSwgQjpCLCBDOkMgfTtcbiAgfVxuXG4gIEJlemllci5xdWFkcmF0aWNGcm9tUG9pbnRzID0gZnVuY3Rpb24ocDEscDIscDMsIHQpIHtcbiAgICBpZih0eXBlb2YgdCA9PT0gXCJ1bmRlZmluZWRcIikgeyB0ID0gMC41OyB9XG4gICAgLy8gc2hvcnRjdXRzLCBhbHRob3VnaCB0aGV5J3JlIHJlYWxseSBkdW1iXG4gICAgaWYodD09PTApIHsgcmV0dXJuIG5ldyBCZXppZXIocDIscDIscDMpOyB9XG4gICAgaWYodD09PTEpIHsgcmV0dXJuIG5ldyBCZXppZXIocDEscDIscDIpOyB9XG4gICAgLy8gcmVhbCBmaXR0aW5nLlxuICAgIHZhciBhYmMgPSBCZXppZXIuZ2V0QUJDKDIscDEscDIscDMsdCk7XG4gICAgcmV0dXJuIG5ldyBCZXppZXIocDEsIGFiYy5BLCBwMyk7XG4gIH07XG5cbiAgQmV6aWVyLmN1YmljRnJvbVBvaW50cyA9IGZ1bmN0aW9uKFMsQixFLCB0LGQxKSB7XG4gICAgaWYodHlwZW9mIHQgPT09IFwidW5kZWZpbmVkXCIpIHsgdCA9IDAuNTsgfVxuICAgIHZhciBhYmMgPSBCZXppZXIuZ2V0QUJDKDMsUyxCLEUsdCk7XG4gICAgaWYodHlwZW9mIGQxID09PSBcInVuZGVmaW5lZFwiKSB7IGQxID0gdXRpbHMuZGlzdChCLGFiYy5DKTsgfVxuICAgIHZhciBkMiA9IGQxICogKDEtdCkvdDtcblxuICAgIHZhciBzZWxlbiA9IHV0aWxzLmRpc3QoUyxFKSxcbiAgICAgICAgbHggPSAoRS54LVMueCkvc2VsZW4sXG4gICAgICAgIGx5ID0gKEUueS1TLnkpL3NlbGVuLFxuICAgICAgICBieDEgPSBkMSAqIGx4LFxuICAgICAgICBieTEgPSBkMSAqIGx5LFxuICAgICAgICBieDIgPSBkMiAqIGx4LFxuICAgICAgICBieTIgPSBkMiAqIGx5O1xuICAgIC8vIGRlcml2YXRpb24gb2YgbmV3IGh1bGwgY29vcmRpbmF0ZXNcbiAgICB2YXIgZTEgID0geyB4OiBCLnggLSBieDEsIHk6IEIueSAtIGJ5MSB9LFxuICAgICAgICBlMiAgPSB7IHg6IEIueCArIGJ4MiwgeTogQi55ICsgYnkyIH0sXG4gICAgICAgIEEgPSBhYmMuQSxcbiAgICAgICAgdjEgID0geyB4OiBBLnggKyAoZTEueC1BLngpLygxLXQpLCB5OiBBLnkgKyAoZTEueS1BLnkpLygxLXQpIH0sXG4gICAgICAgIHYyICA9IHsgeDogQS54ICsgKGUyLngtQS54KS8odCksIHk6IEEueSArIChlMi55LUEueSkvKHQpIH0sXG4gICAgICAgIG5jMSA9IHsgeDogUy54ICsgKHYxLngtUy54KS8odCksIHk6IFMueSArICh2MS55LVMueSkvKHQpIH0sXG4gICAgICAgIG5jMiA9IHsgeDogRS54ICsgKHYyLngtRS54KS8oMS10KSwgeTogRS55ICsgKHYyLnktRS55KS8oMS10KSB9O1xuICAgIC8vIC4uLmRvbmVcbiAgICByZXR1cm4gbmV3IEJlemllcihTLG5jMSxuYzIsRSk7XG4gIH07XG5cbiAgdmFyIGdldFV0aWxzID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHV0aWxzO1xuICB9O1xuXG4gIEJlemllci5nZXRVdGlscyA9IGdldFV0aWxzO1xuXG4gIEJlemllci5wcm90b3R5cGUgPSB7XG4gICAgZ2V0VXRpbHM6IGdldFV0aWxzLFxuICAgIHZhbHVlT2Y6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHRoaXMudG9TdHJpbmcoKTtcbiAgICB9LFxuICAgIHRvU3RyaW5nOiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiB1dGlscy5wb2ludHNUb1N0cmluZyh0aGlzLnBvaW50cyk7XG4gICAgfSxcbiAgICB0b1NWRzogZnVuY3Rpb24ocmVsYXRpdmUpIHtcbiAgICAgIGlmKHRoaXMuXzNkKSByZXR1cm4gZmFsc2U7XG4gICAgICB2YXIgcCA9IHRoaXMucG9pbnRzLFxuICAgICAgICAgIHggPSBwWzBdLngsXG4gICAgICAgICAgeSA9IHBbMF0ueSxcbiAgICAgICAgICBzID0gW1wiTVwiLCB4LCB5LCAodGhpcy5vcmRlcj09PTIgPyBcIlFcIjpcIkNcIildO1xuICAgICAgZm9yKHZhciBpPTEsIGxhc3Q9cC5sZW5ndGg7IGk8bGFzdDsgaSsrKSB7XG4gICAgICAgIHMucHVzaChwW2ldLngpO1xuICAgICAgICBzLnB1c2gocFtpXS55KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBzLmpvaW4oXCIgXCIpO1xuICAgIH0sXG4gICAgdXBkYXRlOiBmdW5jdGlvbigpIHtcbiAgICAgIC8vIG9uZS10aW1lIGNvbXB1dGUgZGVyaXZhdGl2ZSBjb29yZGluYXRlc1xuICAgICAgdGhpcy5kcG9pbnRzID0gW107XG4gICAgICBmb3IodmFyIHA9dGhpcy5wb2ludHMsIGQ9cC5sZW5ndGgsIGM9ZC0xOyBkPjE7IGQtLSwgYy0tKSB7XG4gICAgICAgIHZhciBsaXN0ID0gW107XG4gICAgICAgIGZvcih2YXIgaj0wLCBkcHQ7IGo8YzsgaisrKSB7XG4gICAgICAgICAgZHB0ID0ge1xuICAgICAgICAgICAgeDogYyAqIChwW2orMV0ueCAtIHBbal0ueCksXG4gICAgICAgICAgICB5OiBjICogKHBbaisxXS55IC0gcFtqXS55KVxuICAgICAgICAgIH07XG4gICAgICAgICAgaWYodGhpcy5fM2QpIHtcbiAgICAgICAgICAgIGRwdC56ID0gYyAqIChwW2orMV0ueiAtIHBbal0ueik7XG4gICAgICAgICAgfVxuICAgICAgICAgIGxpc3QucHVzaChkcHQpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZHBvaW50cy5wdXNoKGxpc3QpO1xuICAgICAgICBwID0gbGlzdDtcbiAgICAgIH07XG4gICAgICB0aGlzLmNvbXB1dGVkaXJlY3Rpb24oKTtcbiAgICB9LFxuICAgIGNvbXB1dGVkaXJlY3Rpb246IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIHBvaW50cyA9IHRoaXMucG9pbnRzO1xuICAgICAgdmFyIGFuZ2xlID0gdXRpbHMuYW5nbGUocG9pbnRzWzBdLCBwb2ludHNbdGhpcy5vcmRlcl0sIHBvaW50c1sxXSk7XG4gICAgICB0aGlzLmNsb2Nrd2lzZSA9IGFuZ2xlID4gMDtcbiAgICB9LFxuICAgIGxlbmd0aDogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gdXRpbHMubGVuZ3RoKHRoaXMuZGVyaXZhdGl2ZS5iaW5kKHRoaXMpKTtcbiAgICB9LFxuICAgIF9sdXQ6IFtdLFxuICAgIGdldExVVDogZnVuY3Rpb24oc3RlcHMpIHtcbiAgICAgIHN0ZXBzID0gc3RlcHMgfHwgMTAwO1xuICAgICAgaWYgKHRoaXMuX2x1dC5sZW5ndGggPT09IHN0ZXBzKSB7IHJldHVybiB0aGlzLl9sdXQ7IH1cbiAgICAgIHRoaXMuX2x1dCA9IFtdO1xuICAgICAgZm9yKHZhciB0PTA7IHQ8PXN0ZXBzOyB0KyspIHtcbiAgICAgICAgdGhpcy5fbHV0LnB1c2godGhpcy5jb21wdXRlKHQvc3RlcHMpKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzLl9sdXQ7XG4gICAgfSxcbiAgICBvbjogZnVuY3Rpb24ocG9pbnQsIGVycm9yKSB7XG4gICAgICBlcnJvciA9IGVycm9yIHx8IDU7XG4gICAgICB2YXIgbHV0ID0gdGhpcy5nZXRMVVQoKSwgaGl0cyA9IFtdLCBjLCB0PTA7XG4gICAgICBmb3IodmFyIGk9MDsgaTxsdXQubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgYyA9IGx1dFtpXTtcbiAgICAgICAgaWYgKHV0aWxzLmRpc3QoYyxwb2ludCkgPCBlcnJvcikge1xuICAgICAgICAgIGhpdHMucHVzaChjKVxuICAgICAgICAgIHQgKz0gaSAvIGx1dC5sZW5ndGg7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmKCFoaXRzLmxlbmd0aCkgcmV0dXJuIGZhbHNlO1xuICAgICAgcmV0dXJuIHQgLz0gaGl0cy5sZW5ndGg7XG4gICAgfSxcbiAgICBwcm9qZWN0OiBmdW5jdGlvbihwb2ludCkge1xuICAgICAgLy8gc3RlcCAxOiBjb2Fyc2UgY2hlY2tcbiAgICAgIHZhciBMVVQgPSB0aGlzLmdldExVVCgpLCBsID0gTFVULmxlbmd0aC0xLFxuICAgICAgICAgIGNsb3Nlc3QgPSB1dGlscy5jbG9zZXN0KExVVCwgcG9pbnQpLFxuICAgICAgICAgIG1kaXN0ID0gY2xvc2VzdC5tZGlzdCxcbiAgICAgICAgICBtcG9zID0gY2xvc2VzdC5tcG9zO1xuICAgICAgaWYgKG1wb3M9PT0wIHx8IG1wb3M9PT1sKSB7XG4gICAgICAgIHZhciB0ID0gbXBvcy9sLCBwdCA9IHRoaXMuY29tcHV0ZSh0KTtcbiAgICAgICAgcHQudCA9IHQ7XG4gICAgICAgIHB0LmQgPSBtZGlzdDtcbiAgICAgICAgcmV0dXJuIHB0O1xuICAgICAgfVxuXG4gICAgICAvLyBzdGVwIDI6IGZpbmUgY2hlY2tcbiAgICAgIHZhciBmdCwgdCwgcCwgZCxcbiAgICAgICAgICB0MSA9IChtcG9zLTEpL2wsXG4gICAgICAgICAgdDIgPSAobXBvcysxKS9sLFxuICAgICAgICAgIHN0ZXAgPSAwLjEvbDtcbiAgICAgIG1kaXN0ICs9IDE7XG4gICAgICBmb3IodD10MSxmdD10OyB0PHQyK3N0ZXA7IHQrPXN0ZXApIHtcbiAgICAgICAgcCA9IHRoaXMuY29tcHV0ZSh0KTtcbiAgICAgICAgZCA9IHV0aWxzLmRpc3QocG9pbnQsIHApO1xuICAgICAgICBpZiAoZDxtZGlzdCkge1xuICAgICAgICAgIG1kaXN0ID0gZDtcbiAgICAgICAgICBmdCA9IHQ7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHAgPSB0aGlzLmNvbXB1dGUoZnQpO1xuICAgICAgcC50ID0gZnQ7XG4gICAgICBwLmQgPSBtZGlzdDtcbiAgICAgIHJldHVybiBwO1xuICAgIH0sXG4gICAgZ2V0OiBmdW5jdGlvbih0KSB7XG4gICAgICByZXR1cm4gdGhpcy5jb21wdXRlKHQpO1xuICAgIH0sXG4gICAgcG9pbnQ6IGZ1bmN0aW9uKGlkeCkge1xuICAgICAgcmV0dXJuIHRoaXMucG9pbnRzW2lkeF07XG4gICAgfSxcbiAgICBjb21wdXRlOiBmdW5jdGlvbih0KSB7XG4gICAgICAvLyBzaG9ydGN1dHNcbiAgICAgIGlmKHQ9PT0wKSB7IHJldHVybiB0aGlzLnBvaW50c1swXTsgfVxuICAgICAgaWYodD09PTEpIHsgcmV0dXJuIHRoaXMucG9pbnRzW3RoaXMub3JkZXJdOyB9XG5cbiAgICAgIHZhciBwID0gdGhpcy5wb2ludHM7XG4gICAgICB2YXIgbXQgPSAxLXQ7XG5cbiAgICAgIC8vIGxpbmVhcj9cbiAgICAgIGlmKHRoaXMub3JkZXI9PT0xKSB7XG4gICAgICAgIHJldCA9IHtcbiAgICAgICAgICB4OiBtdCpwWzBdLnggKyB0KnBbMV0ueCxcbiAgICAgICAgICB5OiBtdCpwWzBdLnkgKyB0KnBbMV0ueVxuICAgICAgICB9O1xuICAgICAgICBpZiAodGhpcy5fM2QpIHsgcmV0LnogPSBtdCpwWzBdLnogKyB0KnBbMV0uejsgfVxuICAgICAgICByZXR1cm4gcmV0O1xuICAgICAgfVxuXG4gICAgICAvLyBxdWFkcmF0aWMvY3ViaWMgY3VydmU/XG4gICAgICBpZih0aGlzLm9yZGVyPDQpIHtcbiAgICAgICAgdmFyIG10MiA9IG10Km10LFxuICAgICAgICAgICAgdDIgPSB0KnQsXG4gICAgICAgICAgICBhLGIsYyxkID0gMDtcbiAgICAgICAgaWYodGhpcy5vcmRlcj09PTIpIHtcbiAgICAgICAgICBwID0gW3BbMF0sIHBbMV0sIHBbMl0sIFpFUk9dO1xuICAgICAgICAgIGEgPSBtdDI7XG4gICAgICAgICAgYiA9IG10KnQqMjtcbiAgICAgICAgICBjID0gdDI7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZih0aGlzLm9yZGVyPT09Mykge1xuICAgICAgICAgIGEgPSBtdDIqbXQ7XG4gICAgICAgICAgYiA9IG10Mip0KjM7XG4gICAgICAgICAgYyA9IG10KnQyKjM7XG4gICAgICAgICAgZCA9IHQqdDI7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHJldCA9IHtcbiAgICAgICAgICB4OiBhKnBbMF0ueCArIGIqcFsxXS54ICsgYypwWzJdLnggKyBkKnBbM10ueCxcbiAgICAgICAgICB5OiBhKnBbMF0ueSArIGIqcFsxXS55ICsgYypwWzJdLnkgKyBkKnBbM10ueVxuICAgICAgICB9O1xuICAgICAgICBpZih0aGlzLl8zZCkge1xuICAgICAgICAgIHJldC56ID0gYSpwWzBdLnogKyBiKnBbMV0ueiArIGMqcFsyXS56ICsgZCpwWzNdLno7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJldDtcbiAgICAgIH1cblxuICAgICAgLy8gaGlnaGVyIG9yZGVyIGN1cnZlczogdXNlIGRlIENhc3RlbGphdSdzIGNvbXB1dGF0aW9uXG4gICAgICB2YXIgZENwdHMgPSBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KHRoaXMucG9pbnRzKSk7XG4gICAgICB3aGlsZShkQ3B0cy5sZW5ndGggPiAxKSB7XG4gICAgICAgIGZvciAodmFyIGk9MDsgaTxkQ3B0cy5sZW5ndGgtMTsgaSsrKSB7XG4gICAgICAgICAgZENwdHNbaV0gPSB7XG4gICAgICAgICAgICB4OiBkQ3B0c1tpXS54ICsgKGRDcHRzW2krMV0ueCAtIGRDcHRzW2ldLngpICogdCxcbiAgICAgICAgICAgIHk6IGRDcHRzW2ldLnkgKyAoZENwdHNbaSsxXS55IC0gZENwdHNbaV0ueSkgKiB0XG4gICAgICAgICAgfTtcbiAgICAgICAgICBpZiAodHlwZW9mIGRDcHRzW2ldLnogIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgICAgIGRDcHRzW2ldID0gZENwdHNbaV0ueiArIChkQ3B0c1tpKzFdLnogLSBkQ3B0c1tpXS56KSAqIHRcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZENwdHMuc3BsaWNlKGRDcHRzLmxlbmd0aC0xLCAxKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBkQ3B0c1swXTtcbiAgICB9LFxuICAgIHJhaXNlOiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBwID0gdGhpcy5wb2ludHMsIG5wID0gW3BbMF1dLCBpLCBrPXAubGVuZ3RoLCBwaSwgcGltO1xuICAgICAgZm9yICh2YXIgaT0xOyBpPGs7IGkrKykge1xuICAgICAgICBwaSA9IHBbaV07XG4gICAgICAgIHBpbSA9IHBbaS0xXTtcbiAgICAgICAgbnBbaV0gPSB7XG4gICAgICAgICAgeDogKGstaSkvayAqIHBpLnggKyBpL2sgKiBwaW0ueCxcbiAgICAgICAgICB5OiAoay1pKS9rICogcGkueSArIGkvayAqIHBpbS55XG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICBucFtrXSA9IHBbay0xXTtcbiAgICAgIHJldHVybiBuZXcgQmV6aWVyKG5wKTtcbiAgICB9LFxuICAgIGRlcml2YXRpdmU6IGZ1bmN0aW9uKHQpIHtcbiAgICAgIHZhciBtdCA9IDEtdCxcbiAgICAgICAgICBhLGIsYz0wLFxuICAgICAgICAgIHAgPSB0aGlzLmRwb2ludHNbMF07XG4gICAgICBpZih0aGlzLm9yZGVyPT09MikgeyBwID0gW3BbMF0sIHBbMV0sIFpFUk9dOyBhID0gbXQ7IGIgPSB0OyB9XG4gICAgICBpZih0aGlzLm9yZGVyPT09MykgeyBhID0gbXQqbXQ7IGIgPSBtdCp0KjI7IGMgPSB0KnQ7IH1cbiAgICAgIHZhciByZXQgPSB7XG4gICAgICAgIHg6IGEqcFswXS54ICsgYipwWzFdLnggKyBjKnBbMl0ueCxcbiAgICAgICAgeTogYSpwWzBdLnkgKyBiKnBbMV0ueSArIGMqcFsyXS55XG4gICAgICB9O1xuICAgICAgaWYodGhpcy5fM2QpIHtcbiAgICAgICAgcmV0LnogPSBhKnBbMF0ueiArIGIqcFsxXS56ICsgYypwWzJdLno7XG4gICAgICB9XG4gICAgICByZXR1cm4gcmV0O1xuICAgIH0sXG4gICAgaW5mbGVjdGlvbnM6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHV0aWxzLmluZmxlY3Rpb25zKHRoaXMucG9pbnRzKTtcbiAgICB9LFxuICAgIG5vcm1hbDogZnVuY3Rpb24odCkge1xuICAgICAgcmV0dXJuIHRoaXMuXzNkID8gdGhpcy5fX25vcm1hbDModCkgOiB0aGlzLl9fbm9ybWFsMih0KTtcbiAgICB9LFxuICAgIF9fbm9ybWFsMjogZnVuY3Rpb24odCkge1xuICAgICAgdmFyIGQgPSB0aGlzLmRlcml2YXRpdmUodCk7XG4gICAgICB2YXIgcSA9IHNxcnQoZC54KmQueCArIGQueSpkLnkpXG4gICAgICByZXR1cm4geyB4OiAtZC55L3EsIHk6IGQueC9xIH07XG4gICAgfSxcbiAgICBfX25vcm1hbDM6IGZ1bmN0aW9uKCkge1xuICAgICAgLy8gc2VlIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMjU0NTMxNTlcbiAgICAgIHZhciByMSA9IHRoaXMuZGVyaXZhdGl2ZSh0KSxcbiAgICAgICAgICByMiA9IHRoaXMuZGVyaXZhdGl2ZSh0KzAuMDEpLFxuICAgICAgICAgIHExID0gc3FydChyMS54KnIxLnggKyByMS55KnIxLnkgKyByMS56KnIxLnopLFxuICAgICAgICAgIHEyID0gc3FydChyMi54KnIyLnggKyByMi55KnIyLnkgKyByMi56KnIyLnopO1xuICAgICAgcjEueCAvPSBxMTsgcjEueSAvPSBxMTsgcjEueiAvPSBxMTtcbiAgICAgIHIyLnggLz0gcTI7IHIyLnkgLz0gcTI7IHIyLnogLz0gcTI7XG4gICAgICAvLyBjcm9zcyBwcm9kdWN0XG4gICAgICB2YXIgYyA9IHtcbiAgICAgICAgeDogcjIueSpyMS56IC0gcjIueipyMS55LFxuICAgICAgICB5OiByMi56KnIxLnggLSByMi54KnIxLnosXG4gICAgICAgIHo6IHIyLngqcjEueSAtIHIyLnkqcjEueFxuICAgICAgfTtcbiAgICAgIHZhciBtID0gc3FydChjLngqYy54ICsgYy55KmMueSArIGMueipjLnopO1xuICAgICAgYy54IC89IG07IGMueSAvPSBtOyBjLnogLz0gbTtcbiAgICAgIC8vIHJvdGF0aW9uIG1hdHJpeFxuICAgICAgdmFyIFIgPSBbICAgYy54KmMueCwgICBjLngqYy55LWMueiwgYy54KmMueitjLnksXG4gICAgICAgICAgICAgICAgYy54KmMueStjLnosICAgYy55KmMueSwgICBjLnkqYy56LWMueCxcbiAgICAgICAgICAgICAgICBjLngqYy56LWMueSwgYy55KmMueitjLngsICAgYy56KmMueiAgICBdO1xuICAgICAgLy8gbm9ybWFsIHZlY3RvcjpcbiAgICAgIHZhciBuID0ge1xuICAgICAgICB4OiBSWzBdICogcjEueCArIFJbMV0gKiByMS55ICsgUlsyXSAqIHIxLnosXG4gICAgICAgIHk6IFJbM10gKiByMS54ICsgUls0XSAqIHIxLnkgKyBSWzVdICogcjEueixcbiAgICAgICAgejogUls2XSAqIHIxLnggKyBSWzddICogcjEueSArIFJbOF0gKiByMS56XG4gICAgICB9O1xuICAgICAgcmV0dXJuIG47XG4gICAgfSxcbiAgICBodWxsOiBmdW5jdGlvbih0KSB7XG4gICAgICB2YXIgcCA9IHRoaXMucG9pbnRzLFxuICAgICAgICAgIF9wID0gW10sXG4gICAgICAgICAgcHQsXG4gICAgICAgICAgcSA9IFtdLFxuICAgICAgICAgIGlkeCA9IDAsXG4gICAgICAgICAgaT0wLFxuICAgICAgICAgIGw9MDtcbiAgICAgIHFbaWR4KytdID0gcFswXTtcbiAgICAgIHFbaWR4KytdID0gcFsxXTtcbiAgICAgIHFbaWR4KytdID0gcFsyXTtcbiAgICAgIGlmKHRoaXMub3JkZXIgPT09IDMpIHsgcVtpZHgrK10gPSBwWzNdOyB9XG4gICAgICAvLyB3ZSBsZXJwIGJldHdlZW4gYWxsIHBvaW50cyBhdCBlYWNoIGl0ZXJhdGlvbiwgdW50aWwgd2UgaGF2ZSAxIHBvaW50IGxlZnQuXG4gICAgICB3aGlsZShwLmxlbmd0aD4xKSB7XG4gICAgICAgIF9wID0gW107XG4gICAgICAgIGZvcihpPTAsIGw9cC5sZW5ndGgtMTsgaTxsOyBpKyspIHtcbiAgICAgICAgICBwdCA9IHV0aWxzLmxlcnAodCxwW2ldLHBbaSsxXSk7XG4gICAgICAgICAgcVtpZHgrK10gPSBwdDtcbiAgICAgICAgICBfcC5wdXNoKHB0KTtcbiAgICAgICAgfVxuICAgICAgICBwID0gX3A7XG4gICAgICB9XG4gICAgICByZXR1cm4gcTtcbiAgICB9LFxuICAgIHNwbGl0OiBmdW5jdGlvbih0MSwgdDIpIHtcbiAgICAgIC8vIHNob3J0Y3V0c1xuICAgICAgaWYodDE9PT0wICYmICEhdDIpIHsgcmV0dXJuIHRoaXMuc3BsaXQodDIpLmxlZnQ7IH1cbiAgICAgIGlmKHQyPT09MSkgeyByZXR1cm4gdGhpcy5zcGxpdCh0MSkucmlnaHQ7IH1cblxuICAgICAgLy8gbm8gc2hvcnRjdXQ6IHVzZSBcImRlIENhc3RlbGphdVwiIGl0ZXJhdGlvbi5cbiAgICAgIHZhciBxID0gdGhpcy5odWxsKHQxKTtcbiAgICAgIHZhciByZXN1bHQgPSB7XG4gICAgICAgIGxlZnQ6IHRoaXMub3JkZXIgPT09IDIgPyBuZXcgQmV6aWVyKFtxWzBdLHFbM10scVs1XV0pIDogbmV3IEJlemllcihbcVswXSxxWzRdLHFbN10scVs5XV0pLFxuICAgICAgICByaWdodDogdGhpcy5vcmRlciA9PT0gMiA/IG5ldyBCZXppZXIoW3FbNV0scVs0XSxxWzJdXSkgOiBuZXcgQmV6aWVyKFtxWzldLHFbOF0scVs2XSxxWzNdXSksXG4gICAgICAgIHNwYW46IHFcbiAgICAgIH07XG5cbiAgICAgIC8vIG1ha2Ugc3VyZSB3ZSBiaW5kIF90MS9fdDIgaW5mb3JtYXRpb24hXG4gICAgICByZXN1bHQubGVmdC5fdDEgID0gdXRpbHMubWFwKDAsICAwLDEsIHRoaXMuX3QxLHRoaXMuX3QyKTtcbiAgICAgIHJlc3VsdC5sZWZ0Ll90MiAgPSB1dGlscy5tYXAodDEsIDAsMSwgdGhpcy5fdDEsdGhpcy5fdDIpO1xuICAgICAgcmVzdWx0LnJpZ2h0Ll90MSA9IHV0aWxzLm1hcCh0MSwgMCwxLCB0aGlzLl90MSx0aGlzLl90Mik7XG4gICAgICByZXN1bHQucmlnaHQuX3QyID0gdXRpbHMubWFwKDEsICAwLDEsIHRoaXMuX3QxLHRoaXMuX3QyKTtcblxuICAgICAgLy8gaWYgd2UgaGF2ZSBubyB0Miwgd2UncmUgZG9uZVxuICAgICAgaWYoIXQyKSB7IHJldHVybiByZXN1bHQ7IH1cblxuICAgICAgLy8gaWYgd2UgaGF2ZSBhIHQyLCBzcGxpdCBhZ2FpbjpcbiAgICAgIHQyID0gdXRpbHMubWFwKHQyLHQxLDEsMCwxKTtcbiAgICAgIHZhciBzdWJzcGxpdCA9IHJlc3VsdC5yaWdodC5zcGxpdCh0Mik7XG4gICAgICByZXR1cm4gc3Vic3BsaXQubGVmdDtcbiAgICB9LFxuICAgIGV4dHJlbWE6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGRpbXMgPSB0aGlzLmRpbXMsXG4gICAgICAgICAgcmVzdWx0PXt9LFxuICAgICAgICAgIHJvb3RzPVtdLFxuICAgICAgICAgIHAsIG1mbjtcbiAgICAgIGRpbXMuZm9yRWFjaChmdW5jdGlvbihkaW0pIHtcbiAgICAgICAgbWZuID0gZnVuY3Rpb24odikgeyByZXR1cm4gdltkaW1dOyB9O1xuICAgICAgICBwID0gdGhpcy5kcG9pbnRzWzBdLm1hcChtZm4pO1xuICAgICAgICByZXN1bHRbZGltXSA9IHV0aWxzLmRyb290cyhwKTtcbiAgICAgICAgaWYodGhpcy5vcmRlciA9PT0gMykge1xuICAgICAgICAgIHAgPSB0aGlzLmRwb2ludHNbMV0ubWFwKG1mbik7XG4gICAgICAgICAgcmVzdWx0W2RpbV0gPSByZXN1bHRbZGltXS5jb25jYXQodXRpbHMuZHJvb3RzKHApKTtcbiAgICAgICAgfVxuICAgICAgICByZXN1bHRbZGltXSA9IHJlc3VsdFtkaW1dLmZpbHRlcihmdW5jdGlvbih0KSB7IHJldHVybiAodD49MCAmJiB0PD0xKTsgfSk7XG4gICAgICAgIHJvb3RzID0gcm9vdHMuY29uY2F0KHJlc3VsdFtkaW1dLnNvcnQoKSk7XG4gICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgcm9vdHMuc29ydCgpO1xuICAgICAgcmVzdWx0LnZhbHVlcyA9IHJvb3RzO1xuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9LFxuICAgIGJib3g6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGV4dHJlbWEgPSB0aGlzLmV4dHJlbWEoKSwgcmVzdWx0ID0ge307XG4gICAgICB0aGlzLmRpbXMuZm9yRWFjaChmdW5jdGlvbihkKSB7XG4gICAgICAgIHJlc3VsdFtkXSA9IHV0aWxzLmdldG1pbm1heCh0aGlzLCBkLCBleHRyZW1hW2RdKTtcbiAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0sXG4gICAgb3ZlcmxhcHM6IGZ1bmN0aW9uKGN1cnZlKSB7XG4gICAgICB2YXIgbGJib3ggPSB0aGlzLmJib3goKSxcbiAgICAgICAgICB0YmJveCA9IGN1cnZlLmJib3goKTtcbiAgICAgIHJldHVybiB1dGlscy5iYm94b3ZlcmxhcChsYmJveCx0YmJveCk7XG4gICAgfSxcbiAgICBvZmZzZXQ6IGZ1bmN0aW9uKHQsIGQpIHtcbiAgICAgIGlmKHR5cGVvZiBkICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgIHZhciBjID0gdGhpcy5nZXQodCk7XG4gICAgICAgIHZhciBuID0gdGhpcy5ub3JtYWwodCk7XG4gICAgICAgIHZhciByZXQgPSB7XG4gICAgICAgICAgYzogYyxcbiAgICAgICAgICBuOiBuLFxuICAgICAgICAgIHg6IGMueCArIG4ueCAqIGQsXG4gICAgICAgICAgeTogYy55ICsgbi55ICogZFxuICAgICAgICB9O1xuICAgICAgICBpZih0aGlzLl8zZCkge1xuICAgICAgICAgIHJldC56ID0gYy56ICsgbi56ICogZDtcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIHJldDtcbiAgICAgIH1cbiAgICAgIGlmKHRoaXMuX2xpbmVhcikge1xuICAgICAgICB2YXIgbnYgPSB0aGlzLm5vcm1hbCgwKTtcbiAgICAgICAgdmFyIGNvb3JkcyA9IHRoaXMucG9pbnRzLm1hcChmdW5jdGlvbihwKSB7XG4gICAgICAgICAgdmFyIHJldCA9IHtcbiAgICAgICAgICAgIHg6IHAueCArIHQgKiBudi54LFxuICAgICAgICAgICAgeTogcC55ICsgdCAqIG52LnlcbiAgICAgICAgICB9O1xuICAgICAgICAgIGlmKHAueiAmJiBuLnopIHsgcmV0LnogPSBwLnogKyB0ICogbnYuejsgfVxuICAgICAgICAgIHJldHVybiByZXQ7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gW25ldyBCZXppZXIoY29vcmRzKV07XG4gICAgICB9XG4gICAgICB2YXIgcmVkdWNlZCA9IHRoaXMucmVkdWNlKCk7XG4gICAgICByZXR1cm4gcmVkdWNlZC5tYXAoZnVuY3Rpb24ocykge1xuICAgICAgICByZXR1cm4gcy5zY2FsZSh0KTtcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgc2ltcGxlOiBmdW5jdGlvbigpIHtcbiAgICAgIGlmKHRoaXMub3JkZXI9PT0zKSB7XG4gICAgICAgIHZhciBhMSA9IHV0aWxzLmFuZ2xlKHRoaXMucG9pbnRzWzBdLCB0aGlzLnBvaW50c1szXSwgdGhpcy5wb2ludHNbMV0pO1xuICAgICAgICB2YXIgYTIgPSB1dGlscy5hbmdsZSh0aGlzLnBvaW50c1swXSwgdGhpcy5wb2ludHNbM10sIHRoaXMucG9pbnRzWzJdKTtcbiAgICAgICAgaWYoYTE+MCAmJiBhMjwwIHx8IGExPDAgJiYgYTI+MCkgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgdmFyIG4xID0gdGhpcy5ub3JtYWwoMCk7XG4gICAgICB2YXIgbjIgPSB0aGlzLm5vcm1hbCgxKTtcbiAgICAgIHZhciBzID0gbjEueCpuMi54ICsgbjEueSpuMi55O1xuICAgICAgaWYodGhpcy5fM2QpIHsgcyArPSBuMS56Km4yLno7IH1cbiAgICAgIHZhciBhbmdsZSA9IGFicyhhY29zKHMpKTtcbiAgICAgIHJldHVybiBhbmdsZSA8IHBpLzM7XG4gICAgfSxcbiAgICByZWR1Y2U6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGksIHQxPTAsIHQyPTAsIHN0ZXA9MC4wMSwgc2VnbWVudCwgcGFzczE9W10sIHBhc3MyPVtdO1xuICAgICAgLy8gZmlyc3QgcGFzczogc3BsaXQgb24gZXh0cmVtYVxuICAgICAgdmFyIGV4dHJlbWEgPSB0aGlzLmV4dHJlbWEoKS52YWx1ZXM7XG4gICAgICBpZihleHRyZW1hLmluZGV4T2YoMCk9PT0tMSkgeyBleHRyZW1hID0gWzBdLmNvbmNhdChleHRyZW1hKTsgfVxuICAgICAgaWYoZXh0cmVtYS5pbmRleE9mKDEpPT09LTEpIHsgZXh0cmVtYS5wdXNoKDEpOyB9XG4gICAgICBmb3IodDE9ZXh0cmVtYVswXSwgaT0xOyBpPGV4dHJlbWEubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdDIgPSBleHRyZW1hW2ldO1xuICAgICAgICBzZWdtZW50ID0gdGhpcy5zcGxpdCh0MSx0Mik7XG4gICAgICAgIHNlZ21lbnQuX3QxID0gdDE7XG4gICAgICAgIHNlZ21lbnQuX3QyID0gdDI7XG4gICAgICAgIHBhc3MxLnB1c2goc2VnbWVudCk7XG4gICAgICAgIHQxID0gdDI7XG4gICAgICB9XG4gICAgICAvLyBzZWNvbmQgcGFzczogZnVydGhlciByZWR1Y2UgdGhlc2Ugc2VnbWVudHMgdG8gc2ltcGxlIHNlZ21lbnRzXG4gICAgICBwYXNzMS5mb3JFYWNoKGZ1bmN0aW9uKHAxKSB7XG4gICAgICAgIHQxPTA7XG4gICAgICAgIHQyPTA7XG4gICAgICAgIHdoaWxlKHQyIDw9IDEpIHtcbiAgICAgICAgICBmb3IodDI9dDErc3RlcDsgdDI8PTErc3RlcDsgdDIrPXN0ZXApIHtcbiAgICAgICAgICAgIHNlZ21lbnQgPSBwMS5zcGxpdCh0MSx0Mik7XG4gICAgICAgICAgICBpZighc2VnbWVudC5zaW1wbGUoKSkge1xuICAgICAgICAgICAgICB0MiAtPSBzdGVwO1xuICAgICAgICAgICAgICBpZihhYnModDEtdDIpPHN0ZXApIHtcbiAgICAgICAgICAgICAgICAvLyB3ZSBjYW4gbmV2ZXIgZm9ybSBhIHJlZHVjdGlvblxuICAgICAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBzZWdtZW50ID0gcDEuc3BsaXQodDEsdDIpO1xuICAgICAgICAgICAgICBzZWdtZW50Ll90MSA9IHV0aWxzLm1hcCh0MSwwLDEscDEuX3QxLHAxLl90Mik7XG4gICAgICAgICAgICAgIHNlZ21lbnQuX3QyID0gdXRpbHMubWFwKHQyLDAsMSxwMS5fdDEscDEuX3QyKTtcbiAgICAgICAgICAgICAgcGFzczIucHVzaChzZWdtZW50KTtcbiAgICAgICAgICAgICAgdDEgPSB0MjtcbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmKHQxPDEpIHtcbiAgICAgICAgICBzZWdtZW50ID0gcDEuc3BsaXQodDEsMSk7XG4gICAgICAgICAgc2VnbWVudC5fdDEgPSB1dGlscy5tYXAodDEsMCwxLHAxLl90MSxwMS5fdDIpO1xuICAgICAgICAgIHNlZ21lbnQuX3QyID0gcDEuX3QyO1xuICAgICAgICAgIHBhc3MyLnB1c2goc2VnbWVudCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHBhc3MyO1xuICAgIH0sXG4gICAgc2NhbGU6IGZ1bmN0aW9uKGQpIHtcbiAgICAgIHZhciBvcmRlciA9IHRoaXMub3JkZXI7XG4gICAgICB2YXIgZGlzdGFuY2VGbiA9IGZhbHNlXG4gICAgICBpZih0eXBlb2YgZCA9PT0gXCJmdW5jdGlvblwiKSB7IGRpc3RhbmNlRm4gPSBkOyB9XG4gICAgICBpZihkaXN0YW5jZUZuICYmIG9yZGVyID09PSAyKSB7IHJldHVybiB0aGlzLnJhaXNlKCkuc2NhbGUoZGlzdGFuY2VGbik7IH1cblxuICAgICAgLy8gVE9ETzogYWRkIHNwZWNpYWwgaGFuZGxpbmcgZm9yIGRlZ2VuZXJhdGUgKD1saW5lYXIpIGN1cnZlcy5cbiAgICAgIHZhciBjbG9ja3dpc2UgPSB0aGlzLmNsb2Nrd2lzZTtcbiAgICAgIHZhciByMSA9IGRpc3RhbmNlRm4gPyBkaXN0YW5jZUZuKDApIDogZDtcbiAgICAgIHZhciByMiA9IGRpc3RhbmNlRm4gPyBkaXN0YW5jZUZuKDEpIDogZDtcbiAgICAgIHZhciB2ID0gWyB0aGlzLm9mZnNldCgwLDEwKSwgdGhpcy5vZmZzZXQoMSwxMCkgXTtcbiAgICAgIHZhciBvID0gdXRpbHMubGxpNCh2WzBdLCB2WzBdLmMsIHZbMV0sIHZbMV0uYyk7XG4gICAgICBpZighbykgeyBjb25zb2xlLmxvZyhcImNhbm5vdCBzY2FsZSB0aGlzIGN1cnZlLiBUcnkgcmVkdWNpbmcgaXQgZmlyc3QuXCIpOyByZXR1cm4gdGhpczt9XG4gICAgICAvLyBtb3ZlIGFsbCBwb2ludHMgYnkgZGlzdGFuY2UgJ2QnIHdydCB0aGUgb3JpZ2luICdvJ1xuICAgICAgdmFyIHBvaW50cz10aGlzLnBvaW50cywgbnA9W107XG5cbiAgICAgIC8vIG1vdmUgZW5kIHBvaW50cyBieSBmaXhlZCBkaXN0YW5jZSBhbG9uZyBub3JtYWwuXG4gICAgICBbMCwxXS5mb3JFYWNoKGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgdmFyIHAgPSBucFt0Km9yZGVyXSA9IHV0aWxzLmNvcHkocG9pbnRzW3Qqb3JkZXJdKTtcbiAgICAgICAgcC54ICs9ICh0P3IyOnIxKSAqIHZbdF0ubi54O1xuICAgICAgICBwLnkgKz0gKHQ/cjI6cjEpICogdlt0XS5uLnk7XG4gICAgICB9LmJpbmQodGhpcykpO1xuXG4gICAgICBpZiAoIWRpc3RhbmNlRm4pIHtcbiAgICAgICAgLy8gbW92ZSBjb250cm9sIHBvaW50cyB0byBsaWUgb24gdGhlIGludGVyc2VjdGlvbiBvZiB0aGUgb2Zmc2V0XG4gICAgICAgIC8vIGRlcml2YXRpdmUgdmVjdG9yLCBhbmQgdGhlIG9yaWdpbi10aHJvdWdoLWNvbnRyb2wgdmVjdG9yXG4gICAgICAgIFswLDFdLmZvckVhY2goZnVuY3Rpb24odCkge1xuICAgICAgICAgIGlmKHRoaXMub3JkZXI9PT0yICYmICEhdCkgcmV0dXJuO1xuICAgICAgICAgIHZhciBwID0gbnBbdCpvcmRlcl07XG4gICAgICAgICAgdmFyIGQgPSB0aGlzLmRlcml2YXRpdmUodCk7XG4gICAgICAgICAgdmFyIHAyID0geyB4OiBwLnggKyBkLngsIHk6IHAueSArIGQueSB9O1xuICAgICAgICAgIG5wW3QrMV0gPSB1dGlscy5sbGk0KHAsIHAyLCBvLCBwb2ludHNbdCsxXSk7XG4gICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgIHJldHVybiBuZXcgQmV6aWVyKG5wKTtcbiAgICAgIH1cblxuICAgICAgLy8gbW92ZSBjb250cm9sIHBvaW50cyBieSBcImhvd2V2ZXIgbXVjaCBuZWNlc3NhcnkgdG9cbiAgICAgIC8vIGVuc3VyZSB0aGUgY29ycmVjdCB0YW5nZW50IHRvIGVuZHBvaW50XCIuXG4gICAgICBbMCwxXS5mb3JFYWNoKGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgaWYodGhpcy5vcmRlcj09PTIgJiYgISF0KSByZXR1cm47XG4gICAgICAgIHZhciBwID0gcG9pbnRzW3QrMV07XG4gICAgICAgIHZhciBvdiA9IHtcbiAgICAgICAgICB4OiBwLnggLSBvLngsXG4gICAgICAgICAgeTogcC55IC0gby55XG4gICAgICAgIH07XG4gICAgICAgIHZhciByYyA9IGRpc3RhbmNlRm4gPyBkaXN0YW5jZUZuKCh0KzEpL29yZGVyKSA6IGQ7XG4gICAgICAgIGlmKGRpc3RhbmNlRm4gJiYgIWNsb2Nrd2lzZSkgcmMgPSAtcmM7XG4gICAgICAgIHZhciBtID0gc3FydChvdi54Km92LnggKyBvdi55Km92LnkpO1xuICAgICAgICBvdi54IC89IG07XG4gICAgICAgIG92LnkgLz0gbTtcbiAgICAgICAgbnBbdCsxXSA9IHtcbiAgICAgICAgICB4OiBwLnggKyByYypvdi54LFxuICAgICAgICAgIHk6IHAueSArIHJjKm92LnlcbiAgICAgICAgfVxuICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgIHJldHVybiBuZXcgQmV6aWVyKG5wKTtcbiAgICB9LFxuICAgIG91dGxpbmU6IGZ1bmN0aW9uKGQxLCBkMiwgZDMsIGQ0KSB7XG4gICAgICBkMiA9ICh0eXBlb2YgZDIgPT09IFwidW5kZWZpbmVkXCIpID8gZDEgOiBkMjtcbiAgICAgIHZhciByZWR1Y2VkID0gdGhpcy5yZWR1Y2UoKSxcbiAgICAgICAgICBsZW4gPSByZWR1Y2VkLmxlbmd0aCxcbiAgICAgICAgICBmY3VydmVzID0gW10sXG4gICAgICAgICAgYmN1cnZlcyA9IFtdLFxuICAgICAgICAgIHAsXG4gICAgICAgICAgYWxlbiA9IDAsXG4gICAgICAgICAgdGxlbiA9IHRoaXMubGVuZ3RoKCk7XG5cbiAgICAgIHZhciBncmFkdWF0ZWQgPSAodHlwZW9mIGQzICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZiBkNCAhPT0gXCJ1bmRlZmluZWRcIik7XG5cbiAgICAgIGZ1bmN0aW9uIGxpbmVhckRpc3RhbmNlRnVuY3Rpb24ocyxlLCB0bGVuLGFsZW4sc2xlbikge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHYpIHtcbiAgICAgICAgICB2YXIgZjEgPSBhbGVuL3RsZW4sIGYyID0gKGFsZW4rc2xlbikvdGxlbiwgZCA9IGUtcztcbiAgICAgICAgICByZXR1cm4gdXRpbHMubWFwKHYsIDAsMSwgcytmMSpkLCBzK2YyKmQpO1xuICAgICAgICB9O1xuICAgICAgfTtcblxuICAgICAgLy8gZm9ybSBjdXJ2ZSBvdWxpbmVzXG4gICAgICByZWR1Y2VkLmZvckVhY2goZnVuY3Rpb24oc2VnbWVudCkge1xuICAgICAgICBzbGVuID0gc2VnbWVudC5sZW5ndGgoKTtcbiAgICAgICAgaWYgKGdyYWR1YXRlZCkge1xuICAgICAgICAgIGZjdXJ2ZXMucHVzaChzZWdtZW50LnNjYWxlKCAgbGluZWFyRGlzdGFuY2VGdW5jdGlvbiggZDEsIGQzLCB0bGVuLGFsZW4sc2xlbikgICkpO1xuICAgICAgICAgIGJjdXJ2ZXMucHVzaChzZWdtZW50LnNjYWxlKCAgbGluZWFyRGlzdGFuY2VGdW5jdGlvbigtZDIsLWQ0LCB0bGVuLGFsZW4sc2xlbikgICkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGZjdXJ2ZXMucHVzaChzZWdtZW50LnNjYWxlKCBkMSkpO1xuICAgICAgICAgIGJjdXJ2ZXMucHVzaChzZWdtZW50LnNjYWxlKC1kMikpO1xuICAgICAgICB9XG4gICAgICAgIGFsZW4gKz0gc2xlbjtcbiAgICAgIH0pO1xuXG4gICAgICAvLyByZXZlcnNlIHRoZSBcInJldHVyblwiIG91dGxpbmVcbiAgICAgIGJjdXJ2ZXMgPSBiY3VydmVzLm1hcChmdW5jdGlvbihzKSB7XG4gICAgICAgIHAgPSBzLnBvaW50cztcbiAgICAgICAgaWYocFszXSkgeyBzLnBvaW50cyA9IFtwWzNdLHBbMl0scFsxXSxwWzBdXTsgfVxuICAgICAgICBlbHNlIHsgcy5wb2ludHMgPSBbcFsyXSxwWzFdLHBbMF1dOyB9XG4gICAgICAgIHJldHVybiBzO1xuICAgICAgfSkucmV2ZXJzZSgpO1xuXG4gICAgICAvLyBmb3JtIHRoZSBlbmRjYXBzIGFzIGxpbmVzXG4gICAgICB2YXIgZnMgPSBmY3VydmVzWzBdLnBvaW50c1swXSxcbiAgICAgICAgICBmZSA9IGZjdXJ2ZXNbbGVuLTFdLnBvaW50c1tmY3VydmVzW2xlbi0xXS5wb2ludHMubGVuZ3RoLTFdLFxuICAgICAgICAgIGJzID0gYmN1cnZlc1tsZW4tMV0ucG9pbnRzW2JjdXJ2ZXNbbGVuLTFdLnBvaW50cy5sZW5ndGgtMV0sXG4gICAgICAgICAgYmUgPSBiY3VydmVzWzBdLnBvaW50c1swXSxcbiAgICAgICAgICBscyA9IHV0aWxzLm1ha2VsaW5lKGJzLGZzKSxcbiAgICAgICAgICBsZSA9IHV0aWxzLm1ha2VsaW5lKGZlLGJlKSxcbiAgICAgICAgICBzZWdtZW50cyA9IFtsc10uY29uY2F0KGZjdXJ2ZXMpLmNvbmNhdChbbGVdKS5jb25jYXQoYmN1cnZlcyksXG4gICAgICAgICAgc2xlbiA9IHNlZ21lbnRzLmxlbmd0aDtcblxuICAgICAgcmV0dXJuIG5ldyBQb2x5QmV6aWVyKHNlZ21lbnRzKTtcbiAgICB9LFxuICAgIG91dGxpbmVzaGFwZXM6IGZ1bmN0aW9uKGQxLGQyKSB7XG4gICAgICBkMiA9IGQyIHx8IGQxO1xuICAgICAgdmFyIG91dGxpbmUgPSB0aGlzLm91dGxpbmUoZDEsZDIpLmN1cnZlcztcbiAgICAgIHZhciBzaGFwZXMgPSBbXTtcbiAgICAgIGZvcih2YXIgaT0xLCBsZW49b3V0bGluZS5sZW5ndGg7IGkgPCBsZW4vMjsgaSsrKSB7XG4gICAgICAgIHZhciBzaGFwZSA9IHV0aWxzLm1ha2VzaGFwZShvdXRsaW5lW2ldLCBvdXRsaW5lW2xlbi1pXSk7XG4gICAgICAgIHNoYXBlLnN0YXJ0Y2FwLnZpcnR1YWwgPSAoaSA+IDEpO1xuICAgICAgICBzaGFwZS5lbmRjYXAudmlydHVhbCA9IChpIDwgbGVuLzItMSk7XG4gICAgICAgIHNoYXBlcy5wdXNoKHNoYXBlKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBzaGFwZXM7XG4gICAgfSxcbiAgICBpbnRlcnNlY3RzOiBmdW5jdGlvbihjdXJ2ZSkge1xuICAgICAgaWYoIWN1cnZlKSByZXR1cm4gdGhpcy5zZWxmaW50ZXJzZWN0cygpO1xuICAgICAgaWYoY3VydmUucDEgJiYgY3VydmUucDIpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubGluZUludGVyc2VjdHMoY3VydmUpO1xuICAgICAgfVxuICAgICAgaWYoY3VydmUgaW5zdGFuY2VvZiBCZXppZXIpIHsgY3VydmUgPSBjdXJ2ZS5yZWR1Y2UoKTsgfVxuICAgICAgcmV0dXJuIHRoaXMuY3VydmVpbnRlcnNlY3RzKHRoaXMucmVkdWNlKCksIGN1cnZlKTtcbiAgICB9LFxuICAgIGxpbmVJbnRlcnNlY3RzOiBmdW5jdGlvbihsaW5lKSB7XG4gICAgICB2YXIgbXggPSBtaW4obGluZS5wMS54LCBsaW5lLnAyLngpLFxuICAgICAgICAgIG15ID0gbWluKGxpbmUucDEueSwgbGluZS5wMi55KSxcbiAgICAgICAgICBNWCA9IG1heChsaW5lLnAxLngsIGxpbmUucDIueCksXG4gICAgICAgICAgTVkgPSBtYXgobGluZS5wMS55LCBsaW5lLnAyLnkpLFxuICAgICAgICAgIHNlbGY9dGhpcztcbiAgICAgIHJldHVybiB1dGlscy5yb290cyh0aGlzLnBvaW50cywgbGluZSkuZmlsdGVyKGZ1bmN0aW9uKHQpIHtcbiAgICAgICAgdmFyIHAgPSBzZWxmLmdldCh0KTtcbiAgICAgICAgcmV0dXJuIHV0aWxzLmJldHdlZW4ocC54LCBteCwgTVgpICYmIHV0aWxzLmJldHdlZW4ocC55LCBteSwgTVkpO1xuICAgICAgfSk7XG4gICAgfSxcbiAgICBzZWxmaW50ZXJzZWN0czogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgcmVkdWNlZCA9IHRoaXMucmVkdWNlKCk7XG4gICAgICAvLyBcInNpbXBsZVwiIGN1cnZlcyBjYW5ub3QgaW50ZXJzZWN0IHdpdGggdGhlaXIgZGlyZWN0XG4gICAgICAvLyBuZWlnaGJvdXIsIHNvIGZvciBlYWNoIHNlZ21lbnQgWCB3ZSBjaGVjayB3aGV0aGVyXG4gICAgICAvLyBpdCBpbnRlcnNlY3RzIFswOngtMl1beCsyOmxhc3RdLlxuICAgICAgdmFyIGksbGVuPXJlZHVjZWQubGVuZ3RoLTIscmVzdWx0cz1bXSxyZXN1bHQsbGVmdCxyaWdodDtcbiAgICAgIGZvcihpPTA7IGk8bGVuOyBpKyspIHtcbiAgICAgICAgbGVmdCA9IHJlZHVjZWQuc2xpY2UoaSxpKzEpO1xuICAgICAgICByaWdodCA9IHJlZHVjZWQuc2xpY2UoaSsyKTtcbiAgICAgICAgcmVzdWx0ID0gdGhpcy5jdXJ2ZWludGVyc2VjdHMobGVmdCwgcmlnaHQpO1xuICAgICAgICByZXN1bHRzID0gcmVzdWx0cy5jb25jYXQoIHJlc3VsdCApO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHJlc3VsdHM7XG4gICAgfSxcbiAgICBjdXJ2ZWludGVyc2VjdHM6IGZ1bmN0aW9uKGMxLGMyKSB7XG4gICAgICB2YXIgcGFpcnMgPSBbXTtcbiAgICAgIC8vIHN0ZXAgMTogcGFpciBvZmYgYW55IG92ZXJsYXBwaW5nIHNlZ21lbnRzXG4gICAgICBjMS5mb3JFYWNoKGZ1bmN0aW9uKGwpIHtcbiAgICAgICAgYzIuZm9yRWFjaChmdW5jdGlvbihyKSB7XG4gICAgICAgICAgaWYobC5vdmVybGFwcyhyKSkge1xuICAgICAgICAgICAgcGFpcnMucHVzaCh7IGxlZnQ6IGwsIHJpZ2h0OiByIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICAgIC8vIHN0ZXAgMjogZm9yIGVhY2ggcGFpcmluZywgcnVuIHRocm91Z2ggdGhlIGNvbnZlcmdlbmNlIGFsZ29yaXRobS5cbiAgICAgIHZhciBpbnRlcnNlY3Rpb25zID0gW107XG4gICAgICBwYWlycy5mb3JFYWNoKGZ1bmN0aW9uKHBhaXIpIHtcbiAgICAgICAgdmFyIHJlc3VsdCA9IHV0aWxzLnBhaXJpdGVyYXRpb24ocGFpci5sZWZ0LCBwYWlyLnJpZ2h0KTtcbiAgICAgICAgaWYocmVzdWx0Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBpbnRlcnNlY3Rpb25zID0gaW50ZXJzZWN0aW9ucy5jb25jYXQocmVzdWx0KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICByZXR1cm4gaW50ZXJzZWN0aW9ucztcbiAgICB9LFxuICAgIGFyY3M6IGZ1bmN0aW9uKGVycm9yVGhyZXNob2xkKSB7XG4gICAgICBlcnJvclRocmVzaG9sZCA9IGVycm9yVGhyZXNob2xkIHx8IDAuNTtcbiAgICAgIHZhciBjaXJjbGVzID0gW107XG4gICAgICByZXR1cm4gdGhpcy5faXRlcmF0ZShlcnJvclRocmVzaG9sZCwgY2lyY2xlcyk7XG4gICAgfSxcbiAgICBfZXJyb3I6IGZ1bmN0aW9uKHBjLCBucDEsIHMsIGUpIHtcbiAgICAgIHZhciBxID0gKGUgLSBzKSAvIDQsXG4gICAgICAgICAgYzEgPSB0aGlzLmdldChzICsgcSksXG4gICAgICAgICAgYzIgPSB0aGlzLmdldChlIC0gcSksXG4gICAgICAgICAgcmVmID0gdXRpbHMuZGlzdChwYywgbnAxKSxcbiAgICAgICAgICBkMSAgPSB1dGlscy5kaXN0KHBjLCBjMSksXG4gICAgICAgICAgZDIgID0gdXRpbHMuZGlzdChwYywgYzIpO1xuICAgICAgcmV0dXJuIGFicyhkMS1yZWYpICsgYWJzKGQyLXJlZik7XG4gICAgfSxcbiAgICBfaXRlcmF0ZTogZnVuY3Rpb24oZXJyb3JUaHJlc2hvbGQsIGNpcmNsZXMpIHtcbiAgICAgIHZhciBzID0gMCwgZSA9IDEsIHNhZmV0eTtcbiAgICAgIC8vIHdlIGRvIGEgYmluYXJ5IHNlYXJjaCB0byBmaW5kIHRoZSBcImdvb2QgYHRgIGNsb3Nlc3QgdG8gbm8tbG9uZ2VyLWdvb2RcIlxuICAgICAgZG8ge1xuICAgICAgICBzYWZldHk9MDtcblxuICAgICAgICAvLyBzdGVwIDE6IHN0YXJ0IHdpdGggdGhlIG1heGltdW0gcG9zc2libGUgYXJjXG4gICAgICAgIGUgPSAxO1xuXG4gICAgICAgIC8vIHBvaW50czpcbiAgICAgICAgdmFyIG5wMSA9IHRoaXMuZ2V0KHMpLCBucDIsIG5wMywgYXJjLCBwcmV2X2FyYztcblxuICAgICAgICAvLyBib29sZWFuczpcbiAgICAgICAgdmFyIGN1cnJfZ29vZCA9IGZhbHNlLCBwcmV2X2dvb2QgPSBmYWxzZSwgZG9uZTtcblxuICAgICAgICAvLyBudW1iZXJzOlxuICAgICAgICB2YXIgbSA9IGUsIHByZXZfZSA9IDEsIHN0ZXAgPSAwO1xuXG4gICAgICAgIC8vIHN0ZXAgMjogZmluZCB0aGUgYmVzdCBwb3NzaWJsZSBhcmNcbiAgICAgICAgZG8ge1xuICAgICAgICAgIHByZXZfZ29vZCA9IGN1cnJfZ29vZDtcbiAgICAgICAgICBwcmV2X2FyYyA9IGFyYztcbiAgICAgICAgICBtID0gKHMgKyBlKS8yO1xuICAgICAgICAgIHN0ZXArKztcblxuICAgICAgICAgIG5wMiA9IHRoaXMuZ2V0KG0pO1xuICAgICAgICAgIG5wMyA9IHRoaXMuZ2V0KGUpO1xuXG4gICAgICAgICAgYXJjID0gdXRpbHMuZ2V0Y2NlbnRlcihucDEsIG5wMiwgbnAzKTtcbiAgICAgICAgICB2YXIgZXJyb3IgPSB0aGlzLl9lcnJvcihhcmMsIG5wMSwgcywgZSk7XG4gICAgICAgICAgY3Vycl9nb29kID0gKGVycm9yIDw9IGVycm9yVGhyZXNob2xkKTtcblxuICAgICAgICAgIGRvbmUgPSBwcmV2X2dvb2QgJiYgIWN1cnJfZ29vZDtcbiAgICAgICAgICBpZighZG9uZSkgcHJldl9lID0gZTtcblxuICAgICAgICAgIC8vIHRoaXMgYXJjIGlzIGZpbmU6IHdlIGNhbiBtb3ZlICdlJyB1cCB0byBzZWUgaWYgd2UgY2FuIGZpbmQgYSB3aWRlciBhcmNcbiAgICAgICAgICBpZihjdXJyX2dvb2QpIHtcbiAgICAgICAgICAgIC8vIGlmIGUgaXMgYWxyZWFkeSBhdCBtYXgsIHRoZW4gd2UncmUgZG9uZSBmb3IgdGhpcyBhcmMuXG4gICAgICAgICAgICBpZiAoZSA+PSAxKSB7XG4gICAgICAgICAgICAgIHByZXZfZSA9IDE7XG4gICAgICAgICAgICAgIHByZXZfYXJjID0gYXJjO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIGlmIG5vdCwgbW92ZSBpdCB1cCBieSBoYWxmIHRoZSBpdGVyYXRpb24gZGlzdGFuY2VcbiAgICAgICAgICAgIGUgPSBlICsgKGUtcykvMjtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyB0aGlzIGlzIGEgYmFkIGFyYzogd2UgbmVlZCB0byBtb3ZlICdlJyBkb3duIHRvIGZpbmQgYSBnb29kIGFyY1xuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZSA9IG07XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHdoaWxlKCFkb25lICYmIHNhZmV0eSsrPDEwMCk7XG5cbiAgICAgICAgaWYoc2FmZXR5Pj0xMDApIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKFwiYXJjIGFic3RyYWN0aW9uIHNvbWVob3cgZmFpbGVkLi4uXCIpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gY29uc29sZS5sb2coXCJbRl0gYXJjIGZvdW5kXCIsIHMsIHByZXZfZSwgcHJldl9hcmMueCwgcHJldl9hcmMueSwgcHJldl9hcmMucywgcHJldl9hcmMuZSk7XG5cbiAgICAgICAgcHJldl9hcmMgPSAocHJldl9hcmMgPyBwcmV2X2FyYyA6IGFyYyk7XG4gICAgICAgIGNpcmNsZXMucHVzaChwcmV2X2FyYyk7XG4gICAgICAgIHMgPSBwcmV2X2U7XG4gICAgICB9XG4gICAgICB3aGlsZShlIDwgMSk7XG4gICAgICByZXR1cm4gY2lyY2xlcztcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogZWRpdGVkIERlbmlzIFBvbm9tYXJldiB3d3cuaG9tZXRsdC5ydVxuICAgICAqL1xuICAgIGdldFRieUxlbmd0aDogZnVuY3Rpb24obGVuZ3RoLCBhY2N1cmFjeSAsIG9mZnNldFQgKXtcbiAgICAgIG9mZnNldFQgPSBvZmZzZXRUIHx8IDA7XG4gICAgICBhY2N1cmFjeSA9IGFjY3VyYWN5IHx8IDAuMDA1O1xuICAgICAgaWYobGVuZ3RoID09IDAgKXJldHVybiBvZmZzZXRUO1xuICAgICAgdmFyIHB0MSA9IHRoaXMuZ2V0KG9mZnNldFQpLCBwdDIsIHQ9IG9mZnNldFQsICBkeCAsIGR5O1xuICAgICAgdmFyIGRpc3QgPSAwO1xuICAgICAgZG97XG4gICAgICAgIHQrPSBhY2N1cmFjeTtcbiAgICAgICAgcHQyID0gdGhpcy5nZXQodCk7XG4gICAgICAgIGR4ID0gcHQyLnggLSBwdDEueDtcbiAgICAgICAgZHkgPSBwdDIueSAtIHB0MS55O1xuICAgICAgICBkaXN0ICs9IE1hdGguc3FydChkeCAqIGR4ICsgZHkgKiBkeSk7XG4gICAgICAgIHB0MSA9IHB0MjtcbiAgICAgICAgaWYodCA+PSAxKXtcbiAgICAgICAgICByZXR1cm4gdGhpcy5sZW5ndGgoKTtcbiAgICAgICAgfVxuICAgICAgfSB3aGlsZShkaXN0IDwgIGxlbmd0aCk7XG5cbiAgICAgIHJldHVybiB0O1xuICAgIH1cbiAgfTtcbiAgcmV0dXJuIEJlemllcjtcbn0oKSk7XG5cbmlmICh0eXBlb2YgZXhwb3J0cyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgbW9kdWxlLmV4cG9ydHMgPSBCZXppZXI7XG59XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL3BsdWdpbnMvYmV6aWVyLmpzXG4vLyBtb2R1bGUgaWQgPSAxMFxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCJcbnZhciB1dGlscyA9IHJlcXVpcmUoJy4vLi4vdXRpbC91dGlsLmpzJyk7XG51dGlscy5vYmplY3QgPSByZXF1aXJlKCcuLy4uL3V0aWwvb2JqZWN0LmpzJyk7XG5cblxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gKiogRFBIaXN0b3J5XG4gKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG5cblxudmFyIERQSGlzdG9yeSA9IGZ1bmN0aW9uIChwYXJlbnQsIGluaXRBY3Rpb24pIHtcbiAgICB0aGlzLnBhcmVudCA9IHBhcmVudDtcbiAgICB0aGlzLmNsZWFyKGluaXRBY3Rpb24pO1xufTtcblxuRFBIaXN0b3J5LnByb3RvdHlwZS5zZXRSZWNvcmRzID0gZnVuY3Rpb24gKHJlY29yZHMsY3VycmVudCkge1xuICB0aGlzLmNhblVuZG8gPSByZWNvcmRzLmxlbmd0aDtcbiAgdGhpcy5jYW5SZWRvID0gZmFsc2U7XG5cbiAgaWYoIXJlY29yZHMubGVuZ3RoKXtcbiAgICByZWNvcmRzID0gW3tcbiAgICAgIHR5cGU6ICdpbml0aWFsaXplZCcsXG4gICAgICBpZDogMCxcbiAgICAgIHRleHQgOiAnaW5pdGlhbGl6ZWQnXG4gICAgfV1cbiAgfVxuICB0aGlzLnJlY29yZHMgPSByZWNvcmRzO1xuICB0aGlzLmxlbmd0aCA9IHRoaXMucmVjb3Jkcy5sZW5ndGggO1xuICB0aGlzLmN1cnJlbnQgPSBjdXJyZW50ID09PSB1bmRlZmluZWQgPyByZWNvcmRzLmxlbmd0aCAtIDEgOiBjdXJyZW50O1xuICB0aGlzLmFjdGl2ZUFjdGlvbiA9IHRoaXMucmVjb3Jkc1t0aGlzLmN1cnJlbnRdO1xuICB0aGlzLmZpcmUoXCJjaGFuZ2VkXCIse2FjdGlvbjogdGhpcy5hY3RpdmVBY3Rpb259KTtcbiAgcmV0dXJuIHRoaXM7XG59O1xuXG5EUEhpc3RvcnkucHJvdG90eXBlLnJlc3RvcmUgPSBmdW5jdGlvbiAoKSB7XG4gIHRoaXMuc2V0UmVjb3Jkcyh0aGlzLnNhdmVkLnJlY29yZHMsdGhpcy5zYXZlZC5jdXJyZW50KTtcbiAgcmV0dXJuIHRoaXM7XG59O1xuXG5EUEhpc3RvcnkucHJvdG90eXBlLnNhdmUgPSBmdW5jdGlvbiAoKSB7XG4gIHRoaXMuc2F2ZWQgPSB7XG4gICAgY3VycmVudDogdGhpcy5jdXJyZW50LFxuICAgIHJlY29yZHM6IHV0aWxzLm9iamVjdC5jbG9uZURlZXAodGhpcy5yZWNvcmRzKVxuICB9XG4gIHJldHVybiB0aGlzO1xufTtcblxuRFBIaXN0b3J5LnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uIChpbml0QWN0aW9uKSB7XG4gICAgaWYgKGluaXRBY3Rpb24pIHtcbiAgICAgICAgaW5pdEFjdGlvbi5pZCA9IDA7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgaW5pdEFjdGlvbiA9IHtcbiAgICAgICAgICAgIHR5cGU6ICdpbml0aWFsaXplZCcsXG4gICAgICAgICAgICBpZDogMCxcbiAgICAgICAgICB0ZXh0IDogJ2luaXRpYWxpemVkJ1xuICAgICAgICB9XG4gICAgfVxuICAgIHRoaXMucmVjb3JkcyA9IFtpbml0QWN0aW9uXTtcbiAgICB0aGlzLmN1cnJlbnQgPSAwO1xuICAgIHRoaXMuY2FuVW5kbyA9IGZhbHNlO1xuICAgIHRoaXMuY2FuUmVkbyA9IGZhbHNlO1xuICAgIHRoaXMuYWN0aXZlQWN0aW9uID0gdGhpcy5yZWNvcmRzW3RoaXMuY3VycmVudF07XG4gIHRoaXMuZmlyZShcImNoYW5nZWRcIix7YWN0aW9uOiB0aGlzLmFjdGl2ZUFjdGlvbn0pO1xuICByZXR1cm4gdGhpcztcbn07XG5cblxuRFBIaXN0b3J5LnByb3RvdHlwZS5hZGQgPSBmdW5jdGlvbihhY3Rpb24pe1xuXG5cbiAgICBpZiAoIXRoaXMuZW5hYmxlZCB8fCB0aGlzLnByb2Nlc3NpbmcpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBhY3Rpb24ubW9tZW50ID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gICAgdGhpcy5jYW5VbmRvID0gdHJ1ZTtcbiAgICB0aGlzLmNhblJlZG8gPSBmYWxzZTtcbiAgICB0aGlzLnJlY29yZHMuc3BsaWNlKHRoaXMuY3VycmVudCsgMSk7XG4gICAgdGhpcy5yZWNvcmRzLnB1c2goYWN0aW9uKTtcbiAgICB0aGlzLmxlbmd0aCA9IHRoaXMucmVjb3Jkcy5sZW5ndGg7XG4gICAgYWN0aW9uLmlkID0gdGhpcy5sZW5ndGggLSAxO1xuICAgIGFjdGlvbi50ZXh0ID0gYWN0aW9uLnR5cGUgfHwgYWN0aW9uLnRleHQ7XG4gICAgdGhpcy5jdXJyZW50ID0gdGhpcy5sZW5ndGggLSAxO1xuXG4gIHRoaXMuYWN0aXZlQWN0aW9uID0gdGhpcy5yZWNvcmRzW3RoaXMuY3VycmVudF07XG4gIHRoaXMuZmlyZShcImNoYW5nZWRcIix7YWN0aW9uOiBhY3Rpb259KTtcbiAgcmV0dXJuIHRoaXM7XG59O1xuRFBIaXN0b3J5LnByb3RvdHlwZS5kaXNhYmxlID0gZnVuY3Rpb24oKXtcbiAgdGhpcy5lbmFibGVkID0gZmFsc2U7XG4gIHJldHVybiB0aGlzO1xufTtcbkRQSGlzdG9yeS5wcm90b3R5cGUuZW5hYmxlID0gZnVuY3Rpb24oKXtcbiAgdGhpcy5lbmFibGVkID0gdHJ1ZTtcbiAgcmV0dXJuIHRoaXM7XG59O1xuRFBIaXN0b3J5LnByb3RvdHlwZS51bmRvID0gZnVuY3Rpb24obm9GaXJlKXtcbiAgICB0aGlzLmNhblJlZG8gPSB0cnVlO1xuICAgIHZhciBfYWN0aW9uID0gdGhpcy5yZWNvcmRzW3RoaXMuY3VycmVudF07XG4gICAgdGhpcy5jdXJyZW50LS07XG4gIHRoaXMucHJvY2Vzc2luZyA9IHRydWU7XG4gICAgX2FjdGlvbi51bmRvLmNhbGwodGhpcy5wYXJlbnQsX2FjdGlvbik7XG4gIHRoaXMucHJvY2Vzc2luZyA9IGZhbHNlO1xuICAgIGlmKHRoaXMuY3VycmVudCA9PSAwKXtcbiAgICAgICAgdGhpcy5jYW5VbmRvID0gZmFsc2U7XG4gICAgfVxuICAgIGlmKCFub0ZpcmUpe1xuICAgICAgdGhpcy5hY3RpdmVBY3Rpb24gPSB0aGlzLnJlY29yZHNbdGhpcy5jdXJyZW50XTtcbiAgICAgIHRoaXMuZmlyZShcImNoYW5nZWRcIix7YWN0aW9uOiBfYWN0aW9ufSk7XG4gICAgfVxuICByZXR1cm4gdGhpcztcbn07XG5cbkRQSGlzdG9yeS5wcm90b3R5cGUuZ290byA9IGZ1bmN0aW9uKGluZGV4KXtcbiAgICBpZihpbmRleCA9PSB0aGlzLmN1cnJlbnQpcmV0dXJuO1xuICAgIGlmKGluZGV4IDwgdGhpcy5jdXJyZW50KXtcbiAgICAgICAgZm9yKHZhciBpID0gdGhpcy5jdXJyZW50IC0gaW5kZXggO2ktLTsgKXtcbiAgICAgICAgICAgIHRoaXMudW5kbyh0cnVlKTtcbiAgICAgICAgfVxuICAgIH1pZihpbmRleCA+IHRoaXMuY3VycmVudCl7XG4gICAgICAgIGZvcih2YXIgaSA9IGluZGV4IC0gdGhpcy5jdXJyZW50IDtpLS07ICl7XG4gICAgICAgICAgICB0aGlzLnJlZG8odHJ1ZSk7XG4gICAgICAgIH1cbiAgICB9XG4gIHRoaXMuYWN0aXZlQWN0aW9uID0gdGhpcy5yZWNvcmRzW3RoaXMuY3VycmVudF07XG4gIHRoaXMuZmlyZShcImNoYW5nZWRcIix7YWN0aW9uOiB0aGlzLmFjdGl2ZUFjdGlvbn0pO1xuICByZXR1cm4gdGhpcztcbn07XG5cbkRQSGlzdG9yeS5wcm90b3R5cGUucmVkbyA9IGZ1bmN0aW9uKG5vRmlyZSl7XG4gICAgaWYodGhpcy5jdXJyZW50ID09IHRoaXMubGVuZ3RoIC0gMSl7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gIHRoaXMucHJvY2Vzc2luZyA9IHRydWU7XG4gICAgdGhpcy5jYW5VbmRvID0gdHJ1ZTtcbiAgICB0aGlzLmN1cnJlbnQrKztcbiAgICB2YXIgX2FjdGlvbiA9IHRoaXMucmVjb3Jkc1t0aGlzLmN1cnJlbnRdO1xuXG4gICAgX2FjdGlvbi5yZWRvLmNhbGwodGhpcy5wYXJlbnQsX2FjdGlvbik7XG5cbiAgICBpZih0aGlzLmN1cnJlbnQgPT0gdGhpcy5sZW5ndGggLSAxKXtcbiAgICAgICAgdGhpcy5jYW5SZWRvID0gZmFsc2U7XG4gICAgfVxuICB0aGlzLnByb2Nlc3NpbmcgPSBmYWxzZTtcbiAgaWYoIW5vRmlyZSkge1xuICAgIHRoaXMuYWN0aXZlQWN0aW9uID0gdGhpcy5yZWNvcmRzW3RoaXMuY3VycmVudF07XG4gICAgdGhpcy5maXJlKFwiY2hhbmdlZFwiLHthY3Rpb246IF9hY3Rpb259KTtcbiAgfVxuICByZXR1cm4gdGhpcztcbn07XG51dGlscy5vYnNlcnZhYmxlKERQSGlzdG9yeS5wcm90b3R5cGUpO1xubW9kdWxlLmV4cG9ydHMgPSBEUEhpc3Rvcnk7XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL3BsdWdpbnMvaGlzdG9yeS5qc1xuLy8gbW9kdWxlIGlkID0gMTFcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwibW9kdWxlLmV4cG9ydHMgPSAkO1xuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIGV4dGVybmFsIFwiJFwiXG4vLyBtb2R1bGUgaWQgPSAxMlxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCJtb2R1bGUuZXhwb3J0cyA9IFwiUEQ5NGJXd2dkbVZ5YzJsdmJqMGlNUzR3SWlCbGJtTnZaR2x1WnowaVZWUkdMVGdpSUhOMFlXNWtZV3h2Ym1VOUltNXZJajgrQ2p3aExTMGdRM0psWVhSbFpDQjNhWFJvSUVsdWEzTmpZWEJsSUNob2RIUndPaTh2ZDNkM0xtbHVhM05qWVhCbExtOXlaeThwSUMwdFBnbzhjM1puQ2lBZ0lDQjRiV3h1Y3pwcGJtdHpZMkZ3WlQwaWFIUjBjRG92TDNkM2R5NXBibXR6WTJGd1pTNXZjbWN2Ym1GdFpYTndZV05sY3k5cGJtdHpZMkZ3WlNJS0lDQWdJSGh0Ykc1ek9uSmtaajBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TVRrNU9TOHdNaTh5TWkxeVpHWXRjM2x1ZEdGNExXNXpJeUlLSUNBZ0lIaHRiRzV6UFNKb2RIUndPaTh2ZDNkM0xuY3pMbTl5Wnk4eU1EQXdMM04yWnlJS0lDQWdJSGh0Ykc1ek9uTnZaR2x3YjJScFBTSm9kSFJ3T2k4dmMyOWthWEJ2WkdrdWMyOTFjbU5sWm05eVoyVXVibVYwTDBSVVJDOXpiMlJwY0c5a2FTMHdMbVIwWkNJS0lDQWdJSGh0Ykc1ek9tTmpQU0pvZEhSd09pOHZZM0psWVhScGRtVmpiMjF0YjI1ekxtOXlaeTl1Y3lNaUNpQWdJQ0I0Yld4dWN6cDRiR2x1YXowaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1UazVPUzk0YkdsdWF5SUtJQ0FnSUhodGJHNXpPbVJqUFNKb2RIUndPaTh2Y0hWeWJDNXZjbWN2WkdNdlpXeGxiV1Z1ZEhNdk1TNHhMeUlLSUNBZ0lIaHRiRzV6T25OMlp6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lDaUFnSUNCNGJXeHVjenB1Y3pFOUltaDBkSEE2THk5emIzcHBMbUpoYVdWeWIzVm5aUzVtY2lJS0lDQWdJR2xrUFNKemRtYzBPRGc0SWdvZ0lDQWdjMjlrYVhCdlpHazZaRzlqYm1GdFpUMGlkMkZ5Ym1sdVoxOWlkWFIwYjI0dWMzWm5JZ29nSUNBZ2RtbGxkMEp2ZUQwaU1DQXdJRFF3TUNBME1EQWlDaUFnSUNCMlpYSnphVzl1UFNJeExqRWlDaUFnSUNCcGJtdHpZMkZ3WlRwMlpYSnphVzl1UFNJd0xqUTRMakFnY2prMk5UUWlDaUFnUGdvZ0lEeGtaV1p6Q2lBZ0lDQWdJR2xrUFNKa1pXWnpORGc1TUNJS0lDQWdJRDRLSUNBZ0lEeHNhVzVsWVhKSGNtRmthV1Z1ZEFvZ0lDQWdJQ0FnSUdsa1BTSnNhVzVsWVhKSGNtRmthV1Z1ZERnME1URWlDaUFnSUNBZ0lDQWdlVEk5SWpNMk55NDRPQ0lLSUNBZ0lDQWdJQ0JuY21Ga2FXVnVkRlZ1YVhSelBTSjFjMlZ5VTNCaFkyVlBibFZ6WlNJS0lDQWdJQ0FnSUNCNU1UMGlNamczTGpRNUlnb2dJQ0FnSUNBZ0lIZ3lQU0l6TVRVdU5EY2lDaUFnSUNBZ0lDQWdlREU5SWpJME1TNDBNU0lLSUNBZ0lDQWdJQ0JwYm10elkyRndaVHBqYjJ4c1pXTjBQU0poYkhkaGVYTWlDaUFnSUNBZ0lENEtJQ0FnSUNBZ1BITjBiM0FLSUNBZ0lDQWdJQ0FnSUdsa1BTSnpkRzl3TkRFMU9DSUtJQ0FnSUNBZ0lDQWdJSE4wZVd4bFBTSnpkRzl3TFdOdmJHOXlPaU5tWm1abVptWWlDaUFnSUNBZ0lDQWdJQ0J2Wm1aelpYUTlJakFpQ2lBZ0lDQWdJQzgrQ2lBZ0lDQWdJRHh6ZEc5d0NpQWdJQ0FnSUNBZ0lDQnBaRDBpYzNSdmNEUXhOakFpQ2lBZ0lDQWdJQ0FnSUNCemRIbHNaVDBpYzNSdmNDMWpiMnh2Y2pvalptWm1abVptTzNOMGIzQXRiM0JoWTJsMGVUb3dJZ29nSUNBZ0lDQWdJQ0FnYjJabWMyVjBQU0l4SWdvZ0lDQWdJQ0F2UGdvZ0lDQWdQQzlzYVc1bFlYSkhjbUZrYVdWdWRBb2dJQ0FnUGdvZ0lDQWdQR1pwYkhSbGNnb2dJQ0FnSUNBZ0lHbGtQU0ptYVd4MFpYSTJNVEkySWdvZ0lDQWdJQ0FnSUdOdmJHOXlMV2x1ZEdWeWNHOXNZWFJwYjI0dFptbHNkR1Z5Y3owaWMxSkhRaUlLSUNBZ0lDQWdJQ0JwYm10elkyRndaVHBqYjJ4c1pXTjBQU0poYkhkaGVYTWlDaUFnSUNBZ0lENEtJQ0FnSUNBZ1BHWmxSMkYxYzNOcFlXNUNiSFZ5Q2lBZ0lDQWdJQ0FnSUNCcFpEMGlabVZIWVhWemMybGhia0pzZFhJMk1USTRJZ29nSUNBZ0lDQWdJQ0FnYzNSa1JHVjJhV0YwYVc5dVBTSXdMalV6TURNMU56RXpJZ29nSUNBZ0lDQWdJQ0FnYVc1cmMyTmhjR1U2WTI5c2JHVmpkRDBpWVd4M1lYbHpJZ29nSUNBZ0lDQXZQZ29nSUNBZ1BDOW1hV3gwWlhJS0lDQWdJRDRLSUNBZ0lEeHNhVzVsWVhKSGNtRmthV1Z1ZEFvZ0lDQWdJQ0FnSUdsa1BTSnNhVzVsWVhKSGNtRmthV1Z1ZERnME1UTWlDaUFnSUNBZ0lDQWdlVEk5SWpNNU1TNDBOU0lLSUNBZ0lDQWdJQ0JuY21Ga2FXVnVkRlZ1YVhSelBTSjFjMlZ5VTNCaFkyVlBibFZ6WlNJS0lDQWdJQ0FnSUNCNU1UMGlNekF3TGpnMklnb2dJQ0FnSUNBZ0lIZ3lQU0l6TkRJaUNpQWdJQ0FnSUNBZ2VERTlJakkzTlM0Mk1TSUtJQ0FnSUNBZ0lDQnBibXR6WTJGd1pUcGpiMnhzWldOMFBTSmhiSGRoZVhNaUNpQWdJQ0FnSUQ0S0lDQWdJQ0FnUEhOMGIzQUtJQ0FnSUNBZ0lDQWdJR2xrUFNKemRHOXdOekl3TVNJS0lDQWdJQ0FnSUNBZ0lITjBlV3hsUFNKemRHOXdMV052Ykc5eU9pTTFOVEF3TURBaUNpQWdJQ0FnSUNBZ0lDQnZabVp6WlhROUlqQWlDaUFnSUNBZ0lDOCtDaUFnSUNBZ0lEeHpkRzl3Q2lBZ0lDQWdJQ0FnSUNCcFpEMGljM1J2Y0RjeU1ETWlDaUFnSUNBZ0lDQWdJQ0J6ZEhsc1pUMGljM1J2Y0MxamIyeHZjam9qWm1Zd01EQXdJZ29nSUNBZ0lDQWdJQ0FnYjJabWMyVjBQU0l4SWdvZ0lDQWdJQ0F2UGdvZ0lDQWdQQzlzYVc1bFlYSkhjbUZrYVdWdWRBb2dJQ0FnUGdvZ0lDQWdQSEpoWkdsaGJFZHlZV1JwWlc1MENpQWdJQ0FnSUNBZ2FXUTlJbkpoWkdsaGJFZHlZV1JwWlc1ME9EUXhOU0lLSUNBZ0lDQWdJQ0JuY21Ga2FXVnVkRlZ1YVhSelBTSjFjMlZ5VTNCaFkyVlBibFZ6WlNJS0lDQWdJQ0FnSUNCamVEMGlNekV5TGpjNElnb2dJQ0FnSUNBZ0lHTjVQU0l6T0RZdU5UY2lDaUFnSUNBZ0lDQWdjajBpTlRNdU1ETTJJZ29nSUNBZ0lDQWdJR2R5WVdScFpXNTBWSEpoYm5ObWIzSnRQU0p0WVhSeWFYZ29MUzQxT1RNeU55QXRMalU1TXpJM0lDNDNNVFV3TlNBdExqY3hOVEExSURJME15NHlOeUE0TkRrdU1ETXBJZ29nSUNBZ0lDQWdJR2x1YTNOallYQmxPbU52Ykd4bFkzUTlJbUZzZDJGNWN5SUtJQ0FnSUNBZ1Bnb2dJQ0FnSUNBOGMzUnZjQW9nSUNBZ0lDQWdJQ0FnYVdROUluTjBiM0EzTVRFekxUY2lDaUFnSUNBZ0lDQWdJQ0J6ZEhsc1pUMGljM1J2Y0MxamIyeHZjam9qWm1abVptWm1PM04wYjNBdGIzQmhZMmwwZVRvdU5EQTRNVFlpQ2lBZ0lDQWdJQ0FnSUNCdlptWnpaWFE5SWpBaUNpQWdJQ0FnSUM4K0NpQWdJQ0FnSUR4emRHOXdDaUFnSUNBZ0lDQWdJQ0JwWkQwaWMzUnZjRGN4TVRVdE55SUtJQ0FnSUNBZ0lDQWdJSE4wZVd4bFBTSnpkRzl3TFdOdmJHOXlPaU5tWm1abVptWTdjM1J2Y0MxdmNHRmphWFI1T2pBaUNpQWdJQ0FnSUNBZ0lDQnZabVp6WlhROUlqRWlDaUFnSUNBZ0lDOCtDaUFnSUNBOEwzSmhaR2xoYkVkeVlXUnBaVzUwQ2lBZ0lDQStDaUFnSUNBOGJHbHVaV0Z5UjNKaFpHbGxiblFLSUNBZ0lDQWdJQ0JwWkQwaWJHbHVaV0Z5UjNKaFpHbGxiblF4TURRME9TSUtJQ0FnSUNBZ0lDQjVNajBpTXpNNExqZ3lJZ29nSUNBZ0lDQWdJR2R5WVdScFpXNTBWVzVwZEhNOUluVnpaWEpUY0dGalpVOXVWWE5sSWdvZ0lDQWdJQ0FnSUhreFBTSXlPRFl1TmpjaUNpQWdJQ0FnSUNBZ1ozSmhaR2xsYm5SVWNtRnVjMlp2Y20wOUltMWhkSEpwZUNndU9UVTFNelFnTUNBd0lDNDVOVFV6TkNBeE16WXVNVElnTVRRdU1EVTFLU0lLSUNBZ0lDQWdJQ0I0TWowaU16QXdMakkzSWdvZ0lDQWdJQ0FnSUhneFBTSXlOVFV1TXpJaUNpQWdJQ0FnSUNBZ2FXNXJjMk5oY0dVNlkyOXNiR1ZqZEQwaVlXeDNZWGx6SWdvZ0lDQWdJQ0ErQ2lBZ0lDQWdJRHh6ZEc5d0NpQWdJQ0FnSUNBZ0lDQnBaRDBpYzNSdmNEUXhOVEFpQ2lBZ0lDQWdJQ0FnSUNCemRIbHNaVDBpYzNSdmNDMWpiMnh2Y2pvalptWm1abVptSWdvZ0lDQWdJQ0FnSUNBZ2IyWm1jMlYwUFNJd0lnb2dJQ0FnSUNBdlBnb2dJQ0FnSUNBOGMzUnZjQW9nSUNBZ0lDQWdJQ0FnYVdROUluTjBiM0EwTVRVeUlnb2dJQ0FnSUNBZ0lDQWdjM1I1YkdVOUluTjBiM0F0WTI5c2IzSTZJMlptWm1abVpqdHpkRzl3TFc5d1lXTnBkSGs2TUNJS0lDQWdJQ0FnSUNBZ0lHOW1abk5sZEQwaU1TSUtJQ0FnSUNBZ0x6NEtJQ0FnSUR3dmJHbHVaV0Z5UjNKaFpHbGxiblFLSUNBZ0lENEtJQ0FnSUR4bWFXeDBaWElLSUNBZ0lDQWdJQ0JwWkQwaVptbHNkR1Z5TVRFME1qZ2lDaUFnSUNBZ0lDQWdZMjlzYjNJdGFXNTBaWEp3YjJ4aGRHbHZiaTFtYVd4MFpYSnpQU0p6VWtkQ0lnb2dJQ0FnSUNBZ0lHbHVhM05qWVhCbE9tTnZiR3hsWTNROUltRnNkMkY1Y3lJS0lDQWdJQ0FnUGdvZ0lDQWdJQ0E4Wm1WSFlYVnpjMmxoYmtKc2RYSUtJQ0FnSUNBZ0lDQWdJR2xrUFNKbVpVZGhkWE56YVdGdVFteDFjakV4TkRNd0lnb2dJQ0FnSUNBZ0lDQWdjM1JrUkdWMmFXRjBhVzl1UFNJeExqSTBNelEyTnpnaUNpQWdJQ0FnSUNBZ0lDQnBibXR6WTJGd1pUcGpiMnhzWldOMFBTSmhiSGRoZVhNaUNpQWdJQ0FnSUM4K0NpQWdJQ0E4TDJacGJIUmxjZ29nSUNBZ1Bnb2dJRHd2WkdWbWN3b2dJRDRLSUNBOGMyOWthWEJ2WkdrNmJtRnRaV1IyYVdWM0NpQWdJQ0FnSUdsa1BTSmlZWE5sSWdvZ0lDQWdJQ0JpYjNKa1pYSmpiMnh2Y2owaUl6WTJOalkyTmlJS0lDQWdJQ0FnYVc1cmMyTmhjR1U2Y0dGblpYTm9ZV1J2ZHowaU1pSUtJQ0FnSUNBZ2FXNXJjMk5oY0dVNmQybHVaRzkzTFhrOUlpMDRJZ29nSUNBZ0lDQndZV2RsWTI5c2IzSTlJaU5tWm1abVptWWlDaUFnSUNBZ0lHbHVhM05qWVhCbE9uZHBibVJ2ZHkxb1pXbG5hSFE5SWprNE9DSUtJQ0FnSUNBZ2FXNXJjMk5oY0dVNmQybHVaRzkzTFcxaGVHbHRhWHBsWkQwaU1TSUtJQ0FnSUNBZ2FXNXJjMk5oY0dVNmVtOXZiVDBpTUM0M01EY3hNRFkzT0NJS0lDQWdJQ0FnYVc1cmMyTmhjR1U2ZDJsdVpHOTNMWGc5SWkwNElnb2dJQ0FnSUNCemFHOTNaM0pwWkQwaVptRnNjMlVpQ2lBZ0lDQWdJR0p2Y21SbGNtOXdZV05wZEhrOUlqRXVNQ0lLSUNBZ0lDQWdhVzVyYzJOaGNHVTZZM1Z5Y21WdWRDMXNZWGxsY2owaWJHRjVaWEl4SWdvZ0lDQWdJQ0JwYm10elkyRndaVHBqZUQwaU16QTBMamc1TkRBNUlnb2dJQ0FnSUNCcGJtdHpZMkZ3WlRwamVUMGlNelF4TGpVeU1UZzJJZ29nSUNBZ0lDQnBibXR6WTJGd1pUcDNhVzVrYjNjdGQybGtkR2c5SWpFMk9EQWlDaUFnSUNBZ0lHbHVhM05qWVhCbE9uQmhaMlZ2Y0dGamFYUjVQU0l3TGpBaUNpQWdJQ0FnSUdsdWEzTmpZWEJsT21SdlkzVnRaVzUwTFhWdWFYUnpQU0p3ZUNJS0lDQXZQZ29nSUR4bkNpQWdJQ0FnSUdsa1BTSnNZWGxsY2pFaUNpQWdJQ0FnSUdsdWEzTmpZWEJsT214aFltVnNQU0pNWVhsbGNpQXhJZ29nSUNBZ0lDQnBibXR6WTJGd1pUcG5jbTkxY0cxdlpHVTlJbXhoZVdWeUlnb2dJQ0FnSUNCMGNtRnVjMlp2Y20wOUluUnlZVzV6YkdGMFpTZ3dJQzAyTlRJdU16WXBJZ29nSUNBZ1Bnb2dJQ0FnUEdjS0lDQWdJQ0FnSUNCcFpEMGlaekV4TkRNeUlnb2dJQ0FnSUNBZ0lHbHVhM05qWVhCbE9tVjRjRzl5ZEMxNVpIQnBQU0k1TUNJS0lDQWdJQ0FnSUNCcGJtdHpZMkZ3WlRwbGVIQnZjblF0ZUdSd2FUMGlPVEFpQ2lBZ0lDQWdJQ0FnZEhKaGJuTm1iM0p0UFNKdFlYUnlhWGdvTWk0NU1EVXhJREFnTUNBeUxqa3dOVEVnTFRFd01ERXVPU0F0TnpndU9UWXhLU0lLSUNBZ0lDQWdQZ29nSUNBZ0lDQThjR0YwYUFvZ0lDQWdJQ0FnSUNBZ2FXUTlJbkJoZEdnM01qYzJJZ29nSUNBZ0lDQWdJQ0FnYzI5a2FYQnZaR2s2Y25nOUlqVXpMakF6TlRjeE15SUtJQ0FnSUNBZ0lDQWdJSE52Wkdsd2IyUnBPbko1UFNJMU15NHdNelUzTVRNaUNpQWdJQ0FnSUNBZ0lDQnpkSGxzWlQwaVptbHNiRG9qT1RrNU9UazVJZ29nSUNBZ0lDQWdJQ0FnYzI5a2FYQnZaR2s2ZEhsd1pUMGlZWEpqSWdvZ0lDQWdJQ0FnSUNBZ1pEMGliVE0xTmk0M09TQXpORFl1TVRGak1DQXlPUzR5T1RFdE1qTXVOelExSURVekxqQXpOaTAxTXk0d016WWdOVE11TURNMmN5MDFNeTR3TXpZdE1qTXVOelExTFRVekxqQXpOaTAxTXk0d016WWdNak11TnpRMUxUVXpMakF6TmlBMU15NHdNell0TlRNdU1ETTJJRFV6TGpBek5pQXlNeTQzTkRVZ05UTXVNRE0ySURVekxqQXpObm9pQ2lBZ0lDQWdJQ0FnSUNCMGNtRnVjMlp2Y20wOUltMWhkSEpwZUNndU9UY3pOVFFnTUNBd0lDNDVOek0xTkNBeE1qQXVNRGtnTFRFeUxqWXlPQ2tpQ2lBZ0lDQWdJQ0FnSUNCemIyUnBjRzlrYVRwamVUMGlNelEyTGpFeE1qRTRJZ29nSUNBZ0lDQWdJQ0FnYzI5a2FYQnZaR2s2WTNnOUlqTXdNeTQzTlNJS0lDQWdJQ0FnTHo0S0lDQWdJQ0FnUEhCaGRHZ0tJQ0FnSUNBZ0lDQWdJR2xrUFNKd1lYUm9OekkzT0NJS0lDQWdJQ0FnSUNBZ0lITnZaR2x3YjJScE9uSjRQU0kxTXk0d016VTNNVE1pQ2lBZ0lDQWdJQ0FnSUNCemIyUnBjRzlrYVRweWVUMGlOVE11TURNMU56RXpJZ29nSUNBZ0lDQWdJQ0FnYzNSNWJHVTlJbVpwYkd3NmRYSnNLQ05zYVc1bFlYSkhjbUZrYVdWdWREZzBNVEVwSWdvZ0lDQWdJQ0FnSUNBZ2MyOWthWEJ2WkdrNmRIbHdaVDBpWVhKaklnb2dJQ0FnSUNBZ0lDQWdaRDBpYlRNMU5pNDNPU0F6TkRZdU1URmpNQ0F5T1M0eU9URXRNak11TnpRMUlEVXpMakF6TmkwMU15NHdNellnTlRNdU1ETTJjeTAxTXk0d016WXRNak11TnpRMUxUVXpMakF6TmkwMU15NHdNellnTWpNdU56UTFMVFV6TGpBek5pQTFNeTR3TXpZdE5UTXVNRE0ySURVekxqQXpOaUF5TXk0M05EVWdOVE11TURNMklEVXpMakF6Tm5vaUNpQWdJQ0FnSUNBZ0lDQjBjbUZ1YzJadmNtMDlJbTFoZEhKcGVDZ3VPVFU1TmpBZ01DQXdJQzQ1TlRrMk1DQXhNalF1TXpNZ0xUY3VPREF4TkNraUNpQWdJQ0FnSUNBZ0lDQnpiMlJwY0c5a2FUcGplVDBpTXpRMkxqRXhNakU0SWdvZ0lDQWdJQ0FnSUNBZ2MyOWthWEJ2WkdrNlkzZzlJak13TXk0M05TSUtJQ0FnSUNBZ0x6NEtJQ0FnSUNBZ1BIQmhkR2dLSUNBZ0lDQWdJQ0FnSUdsa1BTSndZWFJvTnpJNE1DSUtJQ0FnSUNBZ0lDQWdJSE52Wkdsd2IyUnBPbko0UFNJMU15NHdNelUzTVRNaUNpQWdJQ0FnSUNBZ0lDQnpiMlJwY0c5a2FUcHllVDBpTlRNdU1ETTFOekV6SWdvZ0lDQWdJQ0FnSUNBZ2MzUjViR1U5SW1acGJIUmxjanAxY213b0kyWnBiSFJsY2pZeE1qWXBPMlpwYkd3NkkyVmpaV05sWXlJS0lDQWdJQ0FnSUNBZ0lITnZaR2x3YjJScE9uUjVjR1U5SW1GeVl5SUtJQ0FnSUNBZ0lDQWdJR1E5SW0wek5UWXVOemtnTXpRMkxqRXhZekFnTWprdU1qa3hMVEl6TGpjME5TQTFNeTR3TXpZdE5UTXVNRE0ySURVekxqQXpObk10TlRNdU1ETTJMVEl6TGpjME5TMDFNeTR3TXpZdE5UTXVNRE0ySURJekxqYzBOUzAxTXk0d016WWdOVE11TURNMkxUVXpMakF6TmlBMU15NHdNellnTWpNdU56UTFJRFV6TGpBek5pQTFNeTR3TXpaNklnb2dJQ0FnSUNBZ0lDQWdkSEpoYm5ObWIzSnRQU0p0WVhSeWFYZ29MamczTXpVMUlEQWdNQ0F1T0Rjek5UVWdNVFV3TGpRM0lESXhMams0TVNraUNpQWdJQ0FnSUNBZ0lDQnpiMlJwY0c5a2FUcGplVDBpTXpRMkxqRXhNakU0SWdvZ0lDQWdJQ0FnSUNBZ2MyOWthWEJ2WkdrNlkzZzlJak13TXk0M05TSUtJQ0FnSUNBZ0x6NEtJQ0FnSUNBZ1BIQmhkR2dLSUNBZ0lDQWdJQ0FnSUdsa1BTSndZWFJvTnpJNE1pSUtJQ0FnSUNBZ0lDQWdJSE52Wkdsd2IyUnBPbko0UFNJMU15NHdNelUzTVRNaUNpQWdJQ0FnSUNBZ0lDQnpiMlJwY0c5a2FUcHllVDBpTlRNdU1ETTFOekV6SWdvZ0lDQWdJQ0FnSUNBZ2MzUjViR1U5SW1acGJIUmxjanAxY213b0kyWnBiSFJsY2pZeE1qWXBPMlpwYkd3Nkl6azVPVGs1T1NJS0lDQWdJQ0FnSUNBZ0lITnZaR2x3YjJScE9uUjVjR1U5SW1GeVl5SUtJQ0FnSUNBZ0lDQWdJR1E5SW0wek5UWXVOemtnTXpRMkxqRXhZekFnTWprdU1qa3hMVEl6TGpjME5TQTFNeTR3TXpZdE5UTXVNRE0ySURVekxqQXpObk10TlRNdU1ETTJMVEl6TGpjME5TMDFNeTR3TXpZdE5UTXVNRE0ySURJekxqYzBOUzAxTXk0d016WWdOVE11TURNMkxUVXpMakF6TmlBMU15NHdNellnTWpNdU56UTFJRFV6TGpBek5pQTFNeTR3TXpaNklnb2dJQ0FnSUNBZ0lDQWdkSEpoYm5ObWIzSnRQU0p0WVhSeWFYZ29Mamd6T0RNNElEQWdNQ0F1T0RNNE16Z2dNVFl4TGpFMUlETTBMakUxTWlraUNpQWdJQ0FnSUNBZ0lDQnpiMlJwY0c5a2FUcGplVDBpTXpRMkxqRXhNakU0SWdvZ0lDQWdJQ0FnSUNBZ2MyOWthWEJ2WkdrNlkzZzlJak13TXk0M05TSUtJQ0FnSUNBZ0x6NEtJQ0FnSUNBZ1BIQmhkR2dLSUNBZ0lDQWdJQ0FnSUdsa1BTSndZWFJvTnpJNE5DSUtJQ0FnSUNBZ0lDQWdJSE52Wkdsd2IyUnBPbko0UFNJMU15NHdNelUzTVRNaUNpQWdJQ0FnSUNBZ0lDQnpiMlJwY0c5a2FUcHllVDBpTlRNdU1ETTFOekV6SWdvZ0lDQWdJQ0FnSUNBZ2MzUjViR1U5SW1acGJHdzZkWEpzS0NOc2FXNWxZWEpIY21Ga2FXVnVkRGcwTVRNcElnb2dJQ0FnSUNBZ0lDQWdjMjlrYVhCdlpHazZkSGx3WlQwaVlYSmpJZ29nSUNBZ0lDQWdJQ0FnWkQwaWJUTTFOaTQzT1NBek5EWXVNVEZqTUNBeU9TNHlPVEV0TWpNdU56UTFJRFV6TGpBek5pMDFNeTR3TXpZZ05UTXVNRE0yY3kwMU15NHdNell0TWpNdU56UTFMVFV6TGpBek5pMDFNeTR3TXpZZ01qTXVOelExTFRVekxqQXpOaUExTXk0d016WXROVE11TURNMklEVXpMakF6TmlBeU15NDNORFVnTlRNdU1ETTJJRFV6TGpBek5ub2lDaUFnSUNBZ0lDQWdJQ0IwY21GdWMyWnZjbTA5SW0xaGRISnBlQ2d1T0RBMU9EY2dNQ0F3SUM0NE1EVTROeUF4TnpFdU1ETWdORFV1TkRBMUtTSUtJQ0FnSUNBZ0lDQWdJSE52Wkdsd2IyUnBPbU41UFNJek5EWXVNVEV5TVRnaUNpQWdJQ0FnSUNBZ0lDQnpiMlJwY0c5a2FUcGplRDBpTXpBekxqYzFJZ29nSUNBZ0lDQXZQZ29nSUNBZ0lDQThjR0YwYUFvZ0lDQWdJQ0FnSUNBZ2FXUTlJbkJoZEdnM01qZzJJZ29nSUNBZ0lDQWdJQ0FnYzI5a2FYQnZaR2s2Y25nOUlqVXpMakF6TlRjeE15SUtJQ0FnSUNBZ0lDQWdJSE52Wkdsd2IyUnBPbko1UFNJMU15NHdNelUzTVRNaUNpQWdJQ0FnSUNBZ0lDQnpkSGxzWlQwaVptbHNiRHAxY213b0kzSmhaR2xoYkVkeVlXUnBaVzUwT0RReE5Ta2lDaUFnSUNBZ0lDQWdJQ0J6YjJScGNHOWthVHAwZVhCbFBTSmhjbU1pQ2lBZ0lDQWdJQ0FnSUNCa1BTSnRNelUyTGpjNUlETTBOaTR4TVdNd0lESTVMakk1TVMweU15NDNORFVnTlRNdU1ETTJMVFV6TGpBek5pQTFNeTR3TXpaekxUVXpMakF6TmkweU15NDNORFV0TlRNdU1ETTJMVFV6TGpBek5pQXlNeTQzTkRVdE5UTXVNRE0ySURVekxqQXpOaTAxTXk0d016WWdOVE11TURNMklESXpMamMwTlNBMU15NHdNellnTlRNdU1ETTJlaUlLSUNBZ0lDQWdJQ0FnSUhSeVlXNXpabTl5YlQwaWJXRjBjbWw0S0M0M05UZ3lOU0F3SURBZ0xqYzFPREkxSURFNE5pNDNOU0EyTXk0NU1EWXBJZ29nSUNBZ0lDQWdJQ0FnYzI5a2FYQnZaR2s2WTNrOUlqTTBOaTR4TVRJeE9DSUtJQ0FnSUNBZ0lDQWdJSE52Wkdsd2IyUnBPbU40UFNJek1ETXVOelVpQ2lBZ0lDQWdJQzgrQ2lBZ0lDQWdJRHh3WVhSb0NpQWdJQ0FnSUNBZ0lDQnBaRDBpY0dGMGFEY3lPRGdpQ2lBZ0lDQWdJQ0FnSUNCemRIbHNaVDBpYjNCaFkybDBlVG91TXpFM056RTdabWxzYkRwMWNtd29JMnhwYm1WaGNrZHlZV1JwWlc1ME1UQTBORGtwSWdvZ0lDQWdJQ0FnSUNBZ2FXNXJjMk5oY0dVNlkyOXVibVZqZEc5eUxXTjFjblpoZEhWeVpUMGlNQ0lLSUNBZ0lDQWdJQ0FnSUdROUltMDBNVFF1T0NBeU9EUXVNVFZqTFRFekxqTXpNU0F3TGpNd01EWTVMVEkyTGpFNE5pQTNMak0xT0Mwek15NHpNellnTVRrdU56UXlMVGN1Tmprd015QXhNeTR6TWkwMkxqY3hNemtnTWprdU1qWTJJREV1TVRVME5TQTBNUzR6TXpFZ01DNDROVE13TmkweU5pNDFNeklnTWpFdU1UTXlMVFEyTGpVeE5TQTBOaTR6TWpRdE5EVXVNRFUwSURndU1qVTRPU0F3TGpRM09UQTNJREUyTGpBMU5DQXpMakl3TURFZ01qSXVPRFU1SURjdU5Ua3dPQzB6TGpJMU56Z3ROeTQwTkRrNExUZ3VPREUzTVMweE15NDVOVE10TVRZdU16azBMVEU0TGpNeU55MDJMalE0TmpjdE15NDNORFV4TFRFekxqWXlOUzAxTGpRek9UTXRNakF1TmpBNExUVXVNamd4T0hvaUNpQWdJQ0FnSUM4K0NpQWdJQ0FnSUR4d1lYUm9DaUFnSUNBZ0lDQWdJQ0JwWkQwaWNtVmpkRGN6TnpBaUNpQWdJQ0FnSUNBZ0lDQmtQU0p0TkRBeUxqZzRJRE13TUM0d09TMHhNUzQxT0RFZ01URXVOVGd4SURFekxqSTVOU0F4TXk0eU9UVXRNVE11TWprMUlERXpMakk0TVNBeE1TNDFPREVnTVRFdU5UZ3hJREV6TGpJNE1TMHhNeTR5T1RVZ01UTXVNamsxSURFekxqSTVOU0F4TVM0MU9ERXRNVEV1TlRneExURXpMakk0TVMweE15NHlPREVnTVRNdU1qZ3hMVEV6TGpJNU5TMHhNUzQxT0RFdE1URXVOVGd4TFRFekxqSTVOU0F4TXk0eU9ERXRNVE11TWpneExURXpMakk0TVhvaUNpQWdJQ0FnSUNBZ0lDQnpkSGxzWlQwaVptbHNkR1Z5T25WeWJDZ2pabWxzZEdWeU1URTBNamdwTzJacGJHdzZJekZoTVdFeFlTSUtJQ0FnSUNBZ0lDQWdJR2x1YTNOallYQmxPbU52Ym01bFkzUnZjaTFqZFhKMllYUjFjbVU5SWpBaUNpQWdJQ0FnSUM4K0NpQWdJQ0FnSUR4d1lYUm9DaUFnSUNBZ0lDQWdJQ0JwWkQwaWNHRjBhREV3TkRVM0lnb2dJQ0FnSUNBZ0lDQWdjM1I1YkdVOUltWnBiR3c2STJabVptWm1aaUlLSUNBZ0lDQWdJQ0FnSUdsdWEzTmpZWEJsT21OdmJtNWxZM1J2Y2kxamRYSjJZWFIxY21VOUlqQWlDaUFnSUNBZ0lDQWdJQ0JrUFNKdE5EQXpMalExSURNd01TNHhOUzB4TVM0d09EY2dNVEV1TURnM0lERXlMamN5T0NBeE1pNDNNamd0TVRJdU56STRJREV5TGpjeE5DQXhNUzR3T0RjZ01URXVNRGczSURFeUxqY3hOQzB4TWk0M01qZ2dNVEl1TnpJNElERXlMamN5T0NBeE1TNHdPRGN0TVRFdU1EZzNMVEV5TGpjeE5DMHhNaTQzTVRRZ01USXVOekUwTFRFeUxqY3lPQzB4TVM0d09EY3RNVEV1TURnM0xURXlMamN5T0NBeE1pNDNNVFF0TVRJdU56RTBMVEV5TGpjeE5Ib2lDaUFnSUNBZ0lDOCtDaUFnSUNBOEwyY0tJQ0FnSUQ0S0lDQThMMmNLSUNBK0NpQWdQRzFsZEdGa1lYUmhDaUFnSUNBK0NpQWdJQ0E4Y21SbU9sSkVSZ29nSUNBZ0lDQStDaUFnSUNBZ0lEeGpZenBYYjNKckNpQWdJQ0FnSUNBZ1Bnb2dJQ0FnSUNBZ0lEeGtZenBtYjNKdFlYUUtJQ0FnSUNBZ0lDQWdJRDVwYldGblpTOXpkbWNyZUcxc1BDOWtZenBtYjNKdFlYUUtJQ0FnSUNBZ0lDQStDaUFnSUNBZ0lDQWdQR1JqT25SNWNHVUtJQ0FnSUNBZ0lDQWdJQ0FnY21SbU9uSmxjMjkxY21ObFBTSm9kSFJ3T2k4dmNIVnliQzV2Y21jdlpHTXZaR050YVhSNWNHVXZVM1JwYkd4SmJXRm5aU0lLSUNBZ0lDQWdJQ0F2UGdvZ0lDQWdJQ0FnSUR4all6cHNhV05sYm5ObENpQWdJQ0FnSUNBZ0lDQWdJSEprWmpweVpYTnZkWEpqWlQwaWFIUjBjRG92TDJOeVpXRjBhWFpsWTI5dGJXOXVjeTV2Y21jdmJHbGpaVzV6WlhNdmNIVmliR2xqWkc5dFlXbHVMeUlLSUNBZ0lDQWdJQ0F2UGdvZ0lDQWdJQ0FnSUR4a1l6cHdkV0pzYVhOb1pYSUtJQ0FnSUNBZ0lDQWdJRDRLSUNBZ0lDQWdJQ0FnSUR4all6cEJaMlZ1ZEFvZ0lDQWdJQ0FnSUNBZ0lDQWdJSEprWmpwaFltOTFkRDBpYUhSMGNEb3ZMMjl3Wlc1amJHbHdZWEowTG05eVp5OGlDaUFnSUNBZ0lDQWdJQ0FnSUQ0S0lDQWdJQ0FnSUNBZ0lDQWdQR1JqT25ScGRHeGxDaUFnSUNBZ0lDQWdJQ0FnSUNBZ1BrOXdaVzVqYkdsd1lYSjBQQzlrWXpwMGFYUnNaUW9nSUNBZ0lDQWdJQ0FnSUNBK0NpQWdJQ0FnSUNBZ0lDQThMMk5qT2tGblpXNTBDaUFnSUNBZ0lDQWdJQ0ErQ2lBZ0lDQWdJQ0FnUEM5a1l6cHdkV0pzYVhOb1pYSUtJQ0FnSUNBZ0lDQStDaUFnSUNBZ0lDQWdQR1JqT25ScGRHeGxDaUFnSUNBZ0lDQWdJQ0ErWlhKeWIzSWdZblYwZEc5dVBDOWtZenAwYVhSc1pRb2dJQ0FnSUNBZ0lENEtJQ0FnSUNBZ0lDQThaR002WkdGMFpRb2dJQ0FnSUNBZ0lDQWdQakl3TVRFdE1ESXRNalJVTVRjNk5EVTZORFU4TDJSak9tUmhkR1VLSUNBZ0lDQWdJQ0ErQ2lBZ0lDQWdJQ0FnUEdSak9tUmxjMk55YVhCMGFXOXVDaUFnSUNBZ0lDQWdMejRLSUNBZ0lDQWdJQ0E4WkdNNmMyOTFjbU5sQ2lBZ0lDQWdJQ0FnSUNBK2FIUjBjSE02THk5dmNHVnVZMnhwY0dGeWRDNXZjbWN2WkdWMFlXbHNMekV5TWpReU5TOWxjbkp2Y2kxaWRYUjBiMjR0WW5rdGNtbGpZWEprYjIxaGFXRThMMlJqT25OdmRYSmpaUW9nSUNBZ0lDQWdJRDRLSUNBZ0lDQWdJQ0E4WkdNNlkzSmxZWFJ2Y2dvZ0lDQWdJQ0FnSUNBZ1Bnb2dJQ0FnSUNBZ0lDQWdQR05qT2tGblpXNTBDaUFnSUNBZ0lDQWdJQ0FnSUQ0S0lDQWdJQ0FnSUNBZ0lDQWdQR1JqT25ScGRHeGxDaUFnSUNBZ0lDQWdJQ0FnSUNBZ1BuSnBZMkZ5Wkc5dFlXbGhQQzlrWXpwMGFYUnNaUW9nSUNBZ0lDQWdJQ0FnSUNBK0NpQWdJQ0FnSUNBZ0lDQThMMk5qT2tGblpXNTBDaUFnSUNBZ0lDQWdJQ0ErQ2lBZ0lDQWdJQ0FnUEM5a1l6cGpjbVZoZEc5eUNpQWdJQ0FnSUNBZ1Bnb2dJQ0FnSUNBZ0lEeGtZenB6ZFdKcVpXTjBDaUFnSUNBZ0lDQWdJQ0ErQ2lBZ0lDQWdJQ0FnSUNBOGNtUm1Pa0poWndvZ0lDQWdJQ0FnSUNBZ0lDQStDaUFnSUNBZ0lDQWdJQ0FnSUR4eVpHWTZiR2tLSUNBZ0lDQWdJQ0FnSUNBZ0lDQStZblYwZEc5dVBDOXlaR1k2YkdrS0lDQWdJQ0FnSUNBZ0lDQWdQZ29nSUNBZ0lDQWdJQ0FnSUNBOGNtUm1PbXhwQ2lBZ0lDQWdJQ0FnSUNBZ0lDQWdQbU5oYm1ObGJEd3ZjbVJtT214cENpQWdJQ0FnSUNBZ0lDQWdJRDRLSUNBZ0lDQWdJQ0FnSUNBZ1BISmtaanBzYVFvZ0lDQWdJQ0FnSUNBZ0lDQWdJRDVqYVhKamJHVThMM0prWmpwc2FRb2dJQ0FnSUNBZ0lDQWdJQ0ErQ2lBZ0lDQWdJQ0FnSUNBZ0lEeHlaR1k2YkdrS0lDQWdJQ0FnSUNBZ0lDQWdJQ0ErWkdWc1pYUmxQQzl5WkdZNmJHa0tJQ0FnSUNBZ0lDQWdJQ0FnUGdvZ0lDQWdJQ0FnSUNBZ0lDQThjbVJtT214cENpQWdJQ0FnSUNBZ0lDQWdJQ0FnUG5KbFpEd3ZjbVJtT214cENpQWdJQ0FnSUNBZ0lDQWdJRDRLSUNBZ0lDQWdJQ0FnSUNBZ1BISmtaanBzYVFvZ0lDQWdJQ0FnSUNBZ0lDQWdJRDV5YjNWdVpEd3ZjbVJtT214cENpQWdJQ0FnSUNBZ0lDQWdJRDRLSUNBZ0lDQWdJQ0FnSUR3dmNtUm1Pa0poWndvZ0lDQWdJQ0FnSUNBZ1Bnb2dJQ0FnSUNBZ0lEd3ZaR002YzNWaWFtVmpkQW9nSUNBZ0lDQWdJRDRLSUNBZ0lDQWdQQzlqWXpwWGIzSnJDaUFnSUNBZ0lENEtJQ0FnSUNBZ1BHTmpPa3hwWTJWdWMyVUtJQ0FnSUNBZ0lDQWdJSEprWmpwaFltOTFkRDBpYUhSMGNEb3ZMMk55WldGMGFYWmxZMjl0Ylc5dWN5NXZjbWN2YkdsalpXNXpaWE12Y0hWaWJHbGpaRzl0WVdsdUx5SUtJQ0FnSUNBZ0lDQStDaUFnSUNBZ0lDQWdQR05qT25CbGNtMXBkSE1LSUNBZ0lDQWdJQ0FnSUNBZ2NtUm1PbkpsYzI5MWNtTmxQU0pvZEhSd09pOHZZM0psWVhScGRtVmpiMjF0YjI1ekxtOXlaeTl1Y3lOU1pYQnliMlIxWTNScGIyNGlDaUFnSUNBZ0lDQWdMejRLSUNBZ0lDQWdJQ0E4WTJNNmNHVnliV2wwY3dvZ0lDQWdJQ0FnSUNBZ0lDQnlaR1k2Y21WemIzVnlZMlU5SW1oMGRIQTZMeTlqY21WaGRHbDJaV052YlcxdmJuTXViM0puTDI1ekkwUnBjM1J5YVdKMWRHbHZiaUlLSUNBZ0lDQWdJQ0F2UGdvZ0lDQWdJQ0FnSUR4all6cHdaWEp0YVhSekNpQWdJQ0FnSUNBZ0lDQWdJSEprWmpweVpYTnZkWEpqWlQwaWFIUjBjRG92TDJOeVpXRjBhWFpsWTI5dGJXOXVjeTV2Y21jdmJuTWpSR1Z5YVhaaGRHbDJaVmR2Y210eklnb2dJQ0FnSUNBZ0lDOCtDaUFnSUNBZ0lEd3ZZMk02VEdsalpXNXpaUW9nSUNBZ0lDQStDaUFnSUNBOEwzSmtaanBTUkVZS0lDQWdJRDRLSUNBOEwyMWxkR0ZrWVhSaENpQWdQZ284TDNOMlp3bytDZz09XCJcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuLi9+L2Jhc2U2NC1sb2FkZXIhLi9tZWRpYS9lcnJvci1idXR0b24uc3ZnXG4vLyBtb2R1bGUgaWQgPSAxM1xuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCJyZXF1aXJlKCcuL2NvcmUvYmFzZS5qcycpO1xucmVxdWlyZSgnLi9jb3JlL3BsdWdpbnNNaXhpbi5qcycpO1xucmVxdWlyZSgnLi9jb3JlL3N0YXRpY0NhbnZhcy5qcycpO1xucmVxdWlyZSgnLi9jb3JlL2V2ZW50cy5qcycpO1xucmVxdWlyZSgnLi9jb3JlL3NsaWRlLmpzJyk7XG5yZXF1aXJlKCcuL2NvcmUvcHJvamVjdC5qcycpO1xucmVxdWlyZSgnLi9jb3JlL3Byb2plY3QuYWNjZXNzLmpzJyk7XG5yZXF1aXJlKCcuL2NvcmUvb2JzZXJ2ZS5qcycpO1xucmVxdWlyZSgnLi9jb3JlL2FwcGxpY2F0aW9uLmpzJyk7XG5yZXF1aXJlKCcuL2NvcmUvZGVtby5qcycpO1xucmVxdWlyZSgnLi9jb3JlL3Byb3RvdHlwZXMuanMnKTtcbnJlcXVpcmUoJy4vY29yZS9vYmplY3QuanMnKTtcbnJlcXVpcmUoJy4vY29yZS9kZWJ1Zy5qcycpO1xucmVxdWlyZSgnLi9tb2R1bGVzL2ZvbnRzLmpzJyk7XG5yZXF1aXJlKCcuL21vZHVsZXMvdGh1bWIuanMnKTtcbnJlcXVpcmUoJy4vbW9kdWxlcy9kZWFjdGl2YXRpb24uanMnKTtcbnJlcXVpcmUoJy4vbW9kdWxlcy9jb250cm9scy5qcycpO1xucmVxdWlyZSgnLi9tb2R1bGVzL3N0eWxlcy5qcycpO1xucmVxdWlyZSgnLi9tb2R1bGVzL2JpbmQuanMnKTtcbnJlcXVpcmUoJy4vbW9kdWxlcy9mcm9tVVJMLmpzJyk7XG5yZXF1aXJlKCcuL21vZHVsZXMvdXBsb2FkLmpzJyk7XG5yZXF1aXJlKCcuL21vZHVsZXMvbG9hZGVyLmpzJyk7XG5yZXF1aXJlKCcuL21vZHVsZXMvbGlicmFyeS5qcycpO1xucmVxdWlyZSgnLi9tb2R1bGVzL2xheWVycy5qcycpO1xucmVxdWlyZSgnLi9tb2R1bGVzL2FyZWFzLmpzJyk7XG5yZXF1aXJlKCcuL21vZHVsZXMvcnVsZXIuanMnKTtcbnJlcXVpcmUoJy4vbW9kdWxlcy9maWx0ZXJzLmpzJyk7XG5yZXF1aXJlKCcuL21vZHVsZXMvdG9vbGJhci5qcycpO1xucmVxdWlyZSgnLi9tb2R1bGVzL2NsaXBUby5qcycpO1xucmVxdWlyZSgnLi9tb2R1bGVzL3JlbmRlci5qcycpO1xucmVxdWlyZSgnLi9tb2R1bGVzL21vdmVtZW50TGltaXRzLmpzJyk7XG5yZXF1aXJlKCcuL21vZHVsZXMvaGlzdG9yeS5qcycpO1xucmVxdWlyZSgnLi9tb2R1bGVzL2dyaWQuanMnKTtcbnJlcXVpcmUoJy4vbW9kdWxlcy9ncm91cHMuanMnKTtcbnJlcXVpcmUoJy4vbW9kdWxlcy96b29tLmpzJyk7XG5yZXF1aXJlKCcuL21vZHVsZXMvYWN0aXZhdGUuanMnKTtcbnJlcXVpcmUoJy4vbW9kdWxlcy9ldmVudExpc3RlbmVycy5qcycpO1xucmVxdWlyZSgnLi9tb2R1bGVzL3Jlc2l6YWJsZS5qcycpO1xucmVxdWlyZSgnLi9tb2R1bGVzL2N1cnNvcnMuanMnKTtcbnJlcXVpcmUoJy4vbW9kdWxlcy9pbnRlcmFjdGl2ZU1vZGUuanMnKTtcbnJlcXVpcmUoJy4vbW9kdWxlcy9wYXRoZmluZGVyLmpzJyk7XG5yZXF1aXJlKCcuL21vZHVsZXMvZHJvcHBhYmxlLmpzJyk7XG5yZXF1aXJlKCcuL21vZHVsZXMvYm9yZGVySW1hZ2UuanMnKTtcbnJlcXVpcmUoJy4vbW9kdWxlcy9zYXZlQXMuanMnKTtcbnJlcXVpcmUoJy4vbW9kdWxlcy9lZGl0b3IuanMnKTtcbnJlcXVpcmUoJy4vbW9kdWxlcy9jb2xvck5hbWVNYXAuanMnKTtcbnJlcXVpcmUoJy4vYnJ1c2hlcy9CYXNlQnJ1c2guanMnKTtcbnJlcXVpcmUoJy4vYnJ1c2hlcy9QZW5jaWxCcnVzaC5qcycpO1xucmVxdWlyZSgnLi9icnVzaGVzL1JlY3RhbmdsZUJydXNoLmpzJyk7XG5yZXF1aXJlKCcuL2JydXNoZXMvUG9seWdvbkJydXNoLmpzJyk7XG5yZXF1aXJlKCcuL2JydXNoZXMvUGFpbnRQZW5CcnVzaC5qcycpO1xucmVxdWlyZSgnLi9icnVzaGVzL1BhaW50QnVja2V0QnJ1c2guanMnKTtcbnJlcXVpcmUoJy4vYnJ1c2hlcy9Qb2ludHNCcnVzaC5qcycpO1xucmVxdWlyZSgnLi9maWx0ZXJzL1JlbW92ZVdoaXRlRFAuanMnKTtcbnJlcXVpcmUoJy4vZmlsdGVycy9SZXNpemVEUC5qcycpO1xucmVxdWlyZSgnLi9vYmplY3RzL1BhdGguanMnKTtcbnJlcXVpcmUoJy4vb2JqZWN0cy9QYXRoR3JvdXAuanMnKTtcbnJlcXVpcmUoJy4vb2JqZWN0cy9SYXN0ZXIuanMnKTtcbnJlcXVpcmUoJy4vb2JqZWN0cy9UZXh0RnJhbWUuanMnKTtcbnJlcXVpcmUoJy4vb2JqZWN0cy9TbGlkZVRleHQuanMnKTtcbnJlcXVpcmUoJy4vb2JqZWN0cy9TbGlkZUltYWdlLmpzJyk7XG5yZXF1aXJlKCcuL29iamVjdHMvVHJhbnNmb3JtZWRJbWFnZS5qcycpO1xucmVxdWlyZSgnLi9vYmplY3RzL1BvbHlsaW5lLmpzJyk7XG5yZXF1aXJlKCcuL29iamVjdHMvQmV6aWVyVGV4dC5qcycpO1xucmVxdWlyZSgnLi9vYmplY3RzL0ZyYW1lLmpzJyk7XG5yZXF1aXJlKCcuL29iamVjdHMvUGhvdG8uanMnKTtcbnJlcXVpcmUoJy4vb2JqZWN0cy9DbGlwYXJ0LmpzJyk7XG5yZXF1aXJlKCcuL29iamVjdHMvTWFza1JlY3RhbmdsZS5qcycpO1xucmVxdWlyZSgnLi9vYmplY3RzL1ZpZGVvLmpzJyk7XG5yZXF1aXJlKCcuL29iamVjdHMvUGxhY2Vob2xkZXIuanMnKTtcbnJlcXVpcmUoJy4vb2JqZWN0cy9CdWJibGUuanMnKTtcbnJlcXVpcmUoJy4vb2JqZWN0cy9Ta2V3T2JqZWN0LmpzJyk7XG5yZXF1aXJlKCcuL29iamVjdHMvU3BlZWNoLmpzJyk7XG5yZXF1aXJlKCcuL29iamVjdHMvVGhpbmsuanMnKTtcbnJlcXVpcmUoJy4vb2JqZWN0cy9NYXRlcmlhbFBvaW50LmpzJyk7XG5yZXF1aXJlKCcuL3BsdWdpbnMvdG9vbGJhci5mb250cy5qcycpO1xucmVxdWlyZSgnLi9wbHVnaW5zL3Rvb2xiYXIuY29sb3JzLmpzJyk7XG5yZXF1aXJlKCcuL3BsdWdpbnMvdG9vbGJhci5vcHRpb25zLmpzJyk7XG5yZXF1aXJlKCcuL3Rvb2xzL3NlbGVjdENvbG9yc1Rvb2xzLmpzJyk7XG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9tb2R1bGVzLmpzXG4vLyBtb2R1bGUgaWQgPSAxNFxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCJcbnZhciBwYXRoID0gcmVxdWlyZShcIi4vcGF0aFwiKTtcbnZhciB1dGlsID0gcmVxdWlyZShcIi4vdXRpbFwiKTtcbnZhciBvYmplY3QgPSByZXF1aXJlKFwiLi9vYmplY3RcIik7XG5cbmZ1bmN0aW9uIGlzU2VydmVyKCkge1xuICByZXR1cm4gISAodHlwZW9mIHdpbmRvdyAhPSAndW5kZWZpbmVkJyAmJiB3aW5kb3cuZG9jdW1lbnQpO1xufVxuXG5cbmlmIChpc1NlcnZlcigpKSB7XG4gIHZhciBmcyA9IHJlcXVpcmUoJ2ZzJyk7XG59XG5cblxuZnVuY3Rpb24gX2xvYWRfanNvbiAodmFsdWUsIGNhbGxiYWNrX3N1Y2Nlc3MsIGNhbGxiYWNrX2Vycm9yKXtcblxuICB2YXIgb3V0cHV0ID0gbnVsbDtcbiAgdmFyIGVycm9ycyA9IFtdO1xuXG4gIGlmICh2YWx1ZS5jb25zdHJ1Y3RvciA9PSBTdHJpbmcpIHtcblxuICAgIHZhciBmaWxlbmFtZSwgcmVnZXhfZGF0YSwgaW5pdF9wcm9wZXJ0eTtcbiAgICByZWdleF9kYXRhID0gL14oW14jXSopIz8oLiopJC8uZXhlYyh2YWx1ZSk7XG5cbiAgICBmaWxlbmFtZSA9IHJlZ2V4X2RhdGFbMV07XG4gICAgaW5pdF9wcm9wZXJ0eSA9IHJlZ2V4X2RhdGFbMl07XG4gICAgdXRpbHMuZ2V0SW5saW5lSnNvbihmaWxlbmFtZSwgXCJqc29uXCIsIF9sb2FkSnNvbl9kYXRhLCBmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgIGVycm9ycy5wdXNoKGVycm9yKTtcbiAgICAgIGlmIChjYWxsYmFja19lcnJvcikge1xuICAgICAgICBjYWxsYmFja19lcnJvcihlcnJvcilcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJmaWxlOiBcXFwiXCIgKyBmaWxlbmFtZSArIFwiXFxcIi4gXCIgKyBlcnJvci5tZXNzYWdlKVxuICAgICAgfVxuICAgIH0pO1xuICB9IGVsc2Uge1xuICAgIF9sb2FkSnNvbl9kYXRhKHZhbHVlKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIF9sb2FkSnNvbl9kYXRhKGRhdGEpIHtcbiAgICAvKlxuICAgICDQt9Cw0LzQtdC90LAg0LfQsNC/0LjRgdC10LkgXCJ1cmwoLi9wYXRoL3RvL2ZpbGUpICDQvdCwIFwiLi4vLi4vcGF0aC90by9maWxlXCJcbiAgICAgdXJsINC90LDRh9C40L3QsNGO0YnQuNC10YHRjyDRgSAuLyDQvtGC0L3QvtGB0LjRgtC10LvRjNC90L4g0YDQvtC00LjRgtC10LvRjNC60L7Qs9C+IGpzb24g0YTQsNC50LvQsFxuXG4gICAgIHVybCDRgSBcIi9cIiDQtNC+0LHQsNCy0LvRj9C10YLRgdGPIEFQUF9TVEFUSUNfUEFUSFxuICAgICAqL1xuICAgIHV0aWxzLnJlY291cnNpdmUoZGF0YSxcbiAgICAgIGZ1bmN0aW9uIChwcm9wZXJ0eSwgdmFsdWUsIHBhcmVudCkge1xuICAgICAgICBpZiAoL151cmxcXCguKlxcKSQvLnRlc3QodmFsdWUpKSB7XG4gICAgICAgICAgdmFyIHJlZ2V4X2RhdGEgPSAvXnVybFxcKChcXC4/XFwvKT8oLiopXFwpJC8uZXhlYyh2YWx1ZSk7XG4gICAgICAgICAgdmFyIHVybCA9IHJlZ2V4X2RhdGFbMl07XG5cbiAgICAgICAgICBpZiAocmVnZXhfZGF0YVsxXSA9PSBcIi9cIikge1xuICAgICAgICAgICAgdXJsID0gd2luZG93LkFQUF9TVEFUSUNfUEFUSCArIHVybDtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHJlZ2V4X2RhdGFbMV0gPT0gXCIuL1wiKSB7XG4gICAgICAgICAgICB1cmwgPSBwYXRoLmdldFBhcmVudERpcmVjdG9yeVVybChmaWxlbmFtZSkgKyB1cmw7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcGFyZW50W3Byb3BlcnR5XSA9IHBhdGgucmVzb2x2ZSh1cmwpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgKTtcblxuXG4gICAgdmFyIGxvYWRlciA9IHV0aWwucXVldWVMb2FkKDEsIGZ1bmN0aW9uIGZpbmFsaXplKCkge1xuXG4gICAgICBpZiAoaW5pdF9wcm9wZXJ0eSkge1xuICAgICAgICB2YXIgcHJvcF9hcnIgPSBpbml0X3Byb3BlcnR5LnNwbGl0KFwiL1wiKTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wX2Fyci5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIGRhdGEgPSBkYXRhW3Byb3BfYXJyW2ldXTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAoZXJyb3JzLmxlbmd0aCkge1xuICAgICAgICBpZiAoY2FsbGJhY2tfZXJyb3IpIGNhbGxiYWNrX2Vycm9yKGVycm9ycyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoY2FsbGJhY2tfc3VjY2VzcykgY2FsbGJhY2tfc3VjY2VzcyhkYXRhKTtcbiAgICAgICAgb3V0cHV0ID0gZGF0YTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8qKlxuICAgICAqIHJlbW92ZSBjb21tZW50c1xuICAgICAqL1xuICAgIHV0aWxzLnJlY291cnNpdmUoZGF0YSwgZnVuY3Rpb24gKHByb3BlcnR5LCB2YWx1ZSwgcGFyZW50KSB7XG4gICAgICAvKlxuICAgICAgIHJlbW92ZSBjb21tZW50cyBsaWtlXG4gICAgICAgW1wiQGNvbW1lbnQoKVwiXVxuICAgICAgIFwiQGNvbW1lbnRcIjoge31cbiAgICAgICAqL1xuICAgICAgaWYgKC9eXFwvXFwvLiokLy50ZXN0KHZhbHVlKSB8fCAvXkBjb21tZW50XFwoLipcXCkkLy50ZXN0KHZhbHVlKSB8fCBwcm9wZXJ0eSA9PSBcIkBjb21tZW50XCIpIHtcbiAgICAgICAgaWYgKHBhcmVudC5jb25zdHJ1Y3RvciA9PSBBcnJheSkge1xuICAgICAgICAgIHBhcmVudC5zcGxpY2UocHJvcGVydHksIDEpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGRlbGV0ZSBwYXJlbnRbcHJvcGVydHldO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKC9eQGV4dGVuZC4qJC8udGVzdChwcm9wZXJ0eSkpIHtcblxuICAgICAgICBsb2FkZXIudG90YWwrKztcbiAgICAgICAgX2xvYWRfanNvbih2YWx1ZSwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICB2YXIgZXh0X2RhdGEgPSBvYmplY3QuZGVlcEV4dGVuZChkYXRhLCBwYXJlbnQpO1xuICAgICAgICAgIG9iamVjdC5kZWVwRXh0ZW5kKHBhcmVudCwgZXh0X2RhdGEpO1xuICAgICAgICAgIGRlbGV0ZSBwYXJlbnRbXCJAZXh0ZW5kXCJdO1xuICAgICAgICAgIGxvYWRlcigpO1xuICAgICAgICB9LCBmdW5jdGlvbiAoZGF0YSwgZXJyb3IpIHtcbiAgICAgICAgICBlcnJvcnMucHVzaChlcnJvcik7XG4gICAgICAgICAgbG9hZGVyKCk7XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIGlmICgvXkBleHRlbmRcXCguKlxcKSQvLnRlc3QodmFsdWUpKSB7XG4gICAgICAgIHZhciBfcmVnX2RhdGEgPSAvXkBleHRlbmRcXCgoXFwuXFwvKT8oLiopXFwpJC8uZXhlYyh2YWx1ZSk7XG4gICAgICAgIHZhciB1cmwgPSBfcmVnX2RhdGFbMl07XG4gICAgICAgIGlmIChfcmVnX2RhdGFbMV0pIHtcbiAgICAgICAgICB1cmwgPSBwYXRoLmdldFBhcmVudERpcmVjdG9yeVVybChmaWxlbmFtZSkgKyB1cmw7XG4gICAgICAgIH1cbiAgICAgICAgbG9hZGVyLnRvdGFsKys7XG4gICAgICAgIF9sb2FkX2pzb24odXJsLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgIHBhcmVudFtwcm9wZXJ0eV0gPSBkYXRhO1xuICAgICAgICAgIGxvYWRlcigpO1xuICAgICAgICB9LCBmdW5jdGlvbiAoZGF0YSwgZXJyb3IpIHtcbiAgICAgICAgICBlcnJvcnMucHVzaChlcnJvcik7XG4gICAgICAgICAgbG9hZGVyKCk7XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIGlmICgvXkBtaXhpblxcKC4qXFwpJC8udGVzdCh2YWx1ZSkpIHtcbiAgICAgICAgdmFyIF9yZWdfZGF0YSA9IC9eQG1peGluXFwoKFxcLlxcLyk/KC4qKVxcKSQvLmV4ZWModmFsdWUpO1xuICAgICAgICB2YXIgdXJsID0gX3JlZ19kYXRhWzJdO1xuICAgICAgICBpZiAoX3JlZ19kYXRhWzFdKSB7XG4gICAgICAgICAgdXJsID0gcGF0aC5nZXRQYXJlbnREaXJlY3RvcnlVcmwoZmlsZW5hbWUpICsgdXJsO1xuICAgICAgICB9XG4gICAgICAgIGxvYWRlci50b3RhbCsrO1xuICAgICAgICBfbG9hZF9qc29uKHVybCwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICBpZiAocGFyZW50LmNvbnN0cnVjdG9yID09IEFycmF5KSB7XG4gICAgICAgICAgICBwYXJlbnQuc3BsaWNlKHByb3BlcnR5LCAxKTtcbiAgICAgICAgICAgIGZvciAodmFyIGkgaW4gZGF0YSkge1xuICAgICAgICAgICAgICBwYXJlbnQucHVzaChkYXRhW2ldKVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBkZWxldGUgcGFyZW50W3Byb3BlcnR5XTtcbiAgICAgICAgICAgIGZvciAodmFyIGkgaW4gZGF0YSkge1xuICAgICAgICAgICAgICBwYXJlbnRbaV0gPSBkYXRhW2ldO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBsb2FkZXIoKTtcbiAgICAgICAgfSwgZnVuY3Rpb24gKGRhdGEsIGVycm9yKSB7XG4gICAgICAgICAgZXJyb3JzLnB1c2goZXJyb3IpO1xuICAgICAgICAgIGxvYWRlcigpO1xuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSBpZiAoL15AbG9hZFxcKCguKilcXCkkLy50ZXN0KHZhbHVlKSkge1xuICAgICAgICB2YXIgX3JlZ19kYXRhID0gL15AbG9hZFxcKChcXC4/XFwvKT8oLiopXFwpJC8uZXhlYyh2YWx1ZSk7XG4gICAgICAgIHZhciB1cmwgPSBfcmVnX2RhdGFbMl07XG4gICAgICAgIGlmIChfcmVnX2RhdGFbMV0gPT0gXCIvXCIpIHtcbiAgICAgICAgICB1cmwgPSB3aW5kb3cuQVBQX1NUQVRJQ19QQVRIICsgdXJsO1xuICAgICAgICB9XG4gICAgICAgIGlmIChfcmVnX2RhdGFbMV0gPT0gXCIuL1wiKSB7XG4gICAgICAgICAgdXJsID0gcGF0aC5nZXRQYXJlbnREaXJlY3RvcnlVcmwoZmlsZW5hbWUpICsgdXJsO1xuICAgICAgICB9XG5cbiAgICAgICAgbG9hZGVyLnRvdGFsKys7XG4gICAgICAgIHV0aWxzLmdldElubGluZUpzb24odXJsLCBcImh0bWxcIiwgZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICBwYXJlbnRbcHJvcGVydHldID0gZGF0YTtcbiAgICAgICAgICBsb2FkZXIoKTtcbiAgICAgICAgfSwgZnVuY3Rpb24gKGRhdGEsIGVycm9yKSB7XG4gICAgICAgICAgZXJyb3JzLnB1c2goZXJyb3IpO1xuICAgICAgICAgIGxvYWRlcigpO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgIH0pO1xuICAgIGxvYWRlcigpO1xuXG4gIH1cblxuICByZXR1cm4gb3V0cHV0O1xufVxuXG52YXIgdXRpbHMgPSB7XG4gIENBQ0hFRF9KU09OIDoge30sXG4gIGxvYWRKc29uU3luYzogZnVuY3Rpb24oc3JjKXtcbiAgICB2YXIgZGF0YTtcbiAgICBfbG9hZF9qc29uKHNyYyxmdW5jdGlvbihfZGF0YSl7XG4gICAgICBkYXRhID0gX2RhdGE7XG4gICAgfSk7XG4gICAgcmV0dXJuIGRhdGE7XG4gIH0sXG5cbiAgLyoqXG4gICDQv9C+0LfQstC+0LvRj9C10YIg0LjRgdC/0L7Qu9GM0LfQvtCy0LDRgtGMINC60L7QvdGB0YLRgNGD0LrRhtC40Lgg0LLQuNC00LBcbiAgINGA0LDRgdGI0LjRgNC40YLRjCDQtNCw0L3QvdGL0LUg0LjQtyDRhNCw0LnQu9CwIHRlbXBsYXRlLmpzb25cbiAgIFwiQGV4dGVuZFwiIDogXCJ1cmwoZGF0YS90ZW1wbGF0ZS5qc29uKVwiLFxuICAgXCJAZXh0ZW5kXCIgOiBcInVybChkYXRhL3RlbXBsYXRlLmpzb24jc2V0dGluZ3Mvc3RhZ2VzKVwiLFxuXG4gICAvL9C30LDQvNC10L3QuNGC0Ywg0YHRgtGA0L7QutGDINC90LDQtNCw0L3QvdGL0LUg0LjQtyDRhNCw0LnQu9CwXG4gICBcInN0YWdlc1wiOiAgICAgICBcInVybChkYXRhL3RlbXBsYXRlLmpzb24jc2V0dGluZ3Mvc3RhZ2VzKVwiLFxuXG4gICAqIEBwYXJhbSBmaWxlbmFtZVxuICAgKiBAcGFyYW0gY2FsbGJhY2tfc3VjY2Vzc1xuICAgKiBAcGFyYW0gY2FsbGJhY2tfZXJyb3JcbiAgICovXG4gIGxvYWRKc29uOiBmdW5jdGlvbiAodmFsdWUscmVzb2x2ZV9jYixmYWlsX2NiKSB7XG4gICAgICByZXR1cm4gX2xvYWRfanNvbih2YWx1ZSxmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgcmVzb2x2ZV9jYiAmJiByZXNvbHZlX2NiKGRhdGEpO1xuICAgICAgfSxmdW5jdGlvbihlcnIpe1xuICAgICAgICBmYWlsX2NiICYmIGZhaWxfY2IoZXJyKTtcbiAgICAgIH0pO1xuICB9LFxuXG4gIHJlbW92ZUNvbW1lbnRzOiBmdW5jdGlvbiAoc3RyKSB7XG4gICAgc3RyID0gc3RyLnJlcGxhY2UoL15cXHMqKFxcL1xcLy4qfCg/OlxcL1xcKltcXHNcXFNdKj8pXFwqXFwvXFxzKikkL2dtLFwiXCIpO1xuICAgIHJldHVybiBzdHI7XG4gIH0sXG4gIC8qKlxuICAgKlxuICAgKiBAcGFyYW0gb2JqZWN0XG4gICAqIEBwYXJhbSBjcml0ZXJpYSAtINCy0YvQv9C+0LvQvdGP0YLRjCDRhNGD0L3QutGG0LjRjiDRgdC+INCy0YHQtdC80Lgg0L7QsdGK0LXQutGC0LDQvNC4XG4gICAqL1xuICByZWNvdXJzaXZlOiBmdW5jdGlvbiAob2JqZWN0LCBjcml0ZXJpYSkge1xuICAgIHZhciByZWFkZWQgPSBbXTtcbiAgICBpZiAoIW9iamVjdCkgcmV0dXJuO1xuICAgIHJldHVybiAoZnVuY3Rpb24gc3ViX3JlY291cnNpdmUob2JqZWN0KSB7XG4gICAgICBpZiAocmVhZGVkLmluZGV4T2Yob2JqZWN0KSAhPSAtMSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICByZWFkZWQucHVzaChvYmplY3QpO1xuXG5cbiAgICAgIGlmIChvYmplY3QgaW5zdGFuY2VvZiBBcnJheSkge1xuICAgICAgICBmb3IgKHZhciBwcm9wID0gb2JqZWN0Lmxlbmd0aDsgcHJvcC0tOykge1xuICAgICAgICAgIGlmIChvYmplY3RbcHJvcF0gJiYgKG9iamVjdFtwcm9wXS5jb25zdHJ1Y3RvciA9PSBPYmplY3QgfHwgb2JqZWN0W3Byb3BdLmNvbnN0cnVjdG9yID09IEFycmF5KSkge1xuICAgICAgICAgICAgc3ViX3JlY291cnNpdmUob2JqZWN0W3Byb3BdKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmFyIGJyZWFrXyA9IGNyaXRlcmlhKHByb3AsIG9iamVjdFtwcm9wXSwgb2JqZWN0KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGZvciAodmFyIHByb3AgaW4gb2JqZWN0KSB7XG4gICAgICAgICAgaWYgKG9iamVjdFtwcm9wXSAmJiAob2JqZWN0W3Byb3BdLmNvbnN0cnVjdG9yID09IE9iamVjdCB8fCBvYmplY3RbcHJvcF0uY29uc3RydWN0b3IgPT0gQXJyYXkpKSB7XG4gICAgICAgICAgICBzdWJfcmVjb3Vyc2l2ZShvYmplY3RbcHJvcF0pO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB2YXIgYnJlYWtfID0gY3JpdGVyaWEocHJvcCwgb2JqZWN0W3Byb3BdLCBvYmplY3QpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pKG9iamVjdCk7XG4gIH0sXG5cbiAgcGFyc2VDU1Y6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgdmFyIHJvd3MgPSBkYXRhLnNwbGl0KC9cXG4vKTtcbiAgICB2YXIgY29sdW1ucyA9IHJvd3NbMF0uc3BsaXQoJywnKTtcbiAgICByb3dzLnNwbGljZSgwLCAxKTtcblxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcm93cy5sZW5ndGg7IGkrKykge1xuICAgICAgdmFyIG91dHB1dF9yb3dfZGF0YSA9IHt9O1xuICAgICAgdmFyIHJvd19kYXRhID0gW107XG5cblxuICAgICAgdmFyIF9xdW90ZSA9IGZhbHNlLCBsYXN0ID0gLTE7XG4gICAgICB2YXIgaiA9IC0xO1xuICAgICAgdmFyIHN0ciA9IHJvd3NbaV07XG4gICAgICB3aGlsZSAoKytqIDwgc3RyLmxlbmd0aCkge1xuICAgICAgICBpZiAoIV9xdW90ZSkge1xuICAgICAgICAgIGlmIChzdHJbal0gPT0gJ1xcJycgfHwgc3RyW2pdID09ICdcXFwiJykge1xuICAgICAgICAgICAgX3F1b3RlID0gc3RyW2pdO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoc3RyW2pdID09IFwiLFwiKSB7XG4gICAgICAgICAgICB2YXIgX3ZhbCA9IHN0ci5zdWJzdHJpbmcobGFzdCwgaik7XG4gICAgICAgICAgICBpZiAoX3ZhbFswXSA9PSAnXFxcIicgJiYgX3ZhbFtfdmFsLmxlbmd0aCAtIDFdID09ICdcXFwiJykge1xuICAgICAgICAgICAgICBfdmFsID0gX3ZhbC5zdWJzdHJpbmcoMSwgX3ZhbC5sZW5ndGggLSAxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJvd19kYXRhLnB1c2goX3ZhbCk7XG4gICAgICAgICAgICBsYXN0ID0gaiArIDE7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmIChzdHJbal0gPT0gX3F1b3RlKSB7XG4gICAgICAgICAgICBfcXVvdGUgPSBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgZm9yICh2YXIgaiBpbiByb3dfZGF0YSkge1xuICAgICAgICBvdXRwdXRfcm93X2RhdGFbY29sdW1uc1tqXV0gPSByb3dfZGF0YVtqXTtcbiAgICAgIH1cbiAgICAgIHJvd3NbaV0gPSBvdXRwdXRfcm93X2RhdGE7XG4gICAgfVxuICAgIHJldHVybiByb3dzO1xuICB9LFxuICBwYXJzZURhdGE6IGZ1bmN0aW9uIChkYXRhLCBkYXRhVHlwZSkge1xuICAgIHZhciBfcGFyc2VkO1xuICAgIGlmIChkYXRhVHlwZSA9PSBcImNzdlwiKSB7XG4gICAgICBfcGFyc2VkID0gdXRpbHMucGFyc2VDU1YoZGF0YSk7XG4gICAgfSBlbHNlIGlmIChkYXRhVHlwZSA9PSBcImpzb25cIikge1xuICAgICAgX3BhcnNlZCA9IGRhdGEudHJpbSgpO1xuICAgICAgLy9pZiAoZGF0YVswXSAhPSBcIntcIiAmJiBkYXRhWzBdICE9IFwiW1wiKSB7XG4gICAgICAvLyAgcmV0dXJuIGZhbHNlO1xuICAgICAgLy99XG5cbiAgICAgIF9wYXJzZWQgPSB1dGlscy5yZW1vdmVDb21tZW50cyhfcGFyc2VkKTtcbiAgICAgIC8vZGF0YSAgPSBkYXRhLnJlcGxhY2UoL1xcbi9nLFwiXCIpXG5cbiAgICAgIHRyeXtcbiAgICAgICAgdmFyIF9wYXJzZWQgPSBKU09OLnBhcnNlKF9wYXJzZWQpOy8vPSBKU09OLnBhcnNlKGRhdGEucmVwbGFjZSgvXFwvXFwqW1xcc1xcU10qP1xcKlxcL3xcXC9cXC8uKi9nLFwiXCIpKTtcbiAgICAgIH1jYXRjaChlKXtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBzdGF0dXM6IFwiZXJyb3JcIixcbiAgICAgICAgICBtZXNzYWdlOiBlLnRvU3RyaW5nKCksXG4gICAgICAgICAgZGF0YTogIGRhdGFcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIC8vdmFyIHNjcmlwdCA9ICQoXCI8c2NyaXB0IHR5cGU9J3RleHQvanNvbicgaWQ9J1wiICsgdXJsICsgXCInPlwiICsgSlNPTi5zdHJpbmdpZnkoZGF0YSkgKyBcIjwvc2NyaXB0PlwiKTtcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgIHN0YXR1czogXCJzdWNjZXNzXCIsXG4gICAgICBkYXRhOiBfcGFyc2VkXG4gICAgfTtcbiAgfSxcbiAgbG9hZDogZnVuY3Rpb24gKHVybCwgZGF0YVR5cGUsIGNhbGxiYWNrX3N1Y2Nlc3MsIGNhbGxiYWNrX2Vycm9yKSB7XG4gICAgLy90b2RvXG4gICAgaWYgKGlzU2VydmVyKCkpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHZhciBkYXRhID0gZnMucmVhZEZpbGVTeW5jKHVybCwgJ3V0ZjgnKTtcbiAgICAgICAgZGF0YSA9IGRhdGEucmVwbGFjZSgvXlxcdUZFRkYvLCAnJyk7XG4gICAgICAgIHZhciBfcGFyc2VkID0gdXRpbHMucGFyc2VEYXRhKGRhdGEsIGRhdGFUeXBlKTtcbiAgICAgICAgaWYoX3BhcnNlZC5zdGF0dXMgPT0gXCJlcnJvclwiKXtcbiAgICAgICAgICBjYWxsYmFja19lcnJvcih7XG4gICAgICAgICAgICBzdGF0dXM6ICAgXCJlcnJvclwiLFxuICAgICAgICAgICAgbWVzc2FnZTogIF9wYXJzZWQubWVzc2FnZSxcbiAgICAgICAgICAgIGRhdGE6ICAgICBfcGFyc2VkLmRhdGFcbiAgICAgICAgICB9KTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY2FsbGJhY2tfc3VjY2VzcyhfcGFyc2VkLmRhdGEpO1xuICAgICAgfSBjYXRjaCAoZSkge1xuXG4gICAgICAgIGlmIChlLmNvZGUgPT09ICdFTk9FTlQnKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ0ZpbGUgbm90IGZvdW5kIScpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRocm93IGU7XG4gICAgICAgIH1cbiAgICAgICAgY2FsbGJhY2tfZXJyb3IoZGF0YSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcblxuICAgICAgdmFyIGh0dHBSZXF1ZXN0ID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG5cbiAgICAgIGh0dHBSZXF1ZXN0Lm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGh0dHBSZXF1ZXN0LnJlYWR5U3RhdGUgPT09IDQpIHtcbiAgICAgICAgICBpZiAoaHR0cFJlcXVlc3Quc3RhdHVzID09PSAyMDApIHtcbiAgICAgICAgICAgIHZhciBkYXRhID0gaHR0cFJlcXVlc3QucmVzcG9uc2VUZXh0O1xuICAgICAgICAgICAgdmFyIF9wYXJzZWQgPSB1dGlscy5wYXJzZURhdGEoZGF0YSwgZGF0YVR5cGUpO1xuICAgICAgICAgICAgaWYoX3BhcnNlZC5zdGF0dXMgPT0gXCJlcnJvclwiKXtcbiAgICAgICAgICAgICAgY2FsbGJhY2tfZXJyb3Ioe1xuICAgICAgICAgICAgICAgIHN0YXR1czogaHR0cFJlcXVlc3Quc3RhdHVzLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICBfcGFyc2VkLm1lc3NhZ2UsXG4gICAgICAgICAgICAgICAgcmVzcG9uc2U6IGh0dHBSZXF1ZXN0LnJlc3BvbnNlVGV4dFxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2FsbGJhY2tfc3VjY2VzcyhfcGFyc2VkLmRhdGEpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjYWxsYmFja19lcnJvcih1cmwsIGh0dHBSZXF1ZXN0KVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIGh0dHBSZXF1ZXN0Lm9wZW4oJ0dFVCcsIHVybCk7XG4gICAgICBodHRwUmVxdWVzdC5zZW5kKCk7XG4gICAgfVxuICB9LFxuICAvKipcbiAgICog0J/QvtC30LLQvtC70Y/QtdGC0LfQsNCz0YDRg9C20LDRgtGMIGpzb24g0YTQsNC50LvRiyAsINGB0L7QtNC10YDQttCw0YnQuNC1INGB0YHRi9C70LrQuCDQvdCwINC00YDRg9Cz0LjQtSBqc29uINGE0LDQudC70YsuXG4gICAqINCy0LzQtdGB0YLQviDRgdGB0YvQu9C+0Log0YLQuNC/0LBcbiAgICogIFwicHJvcGVydHlcIiA6IFwidXJsKGNodW5rLmpzb24pXCJcbiAgICogINCx0YPQtNC10YIg0LfQsNCz0YDRg9C20LXQvdC+INGB0L7QtNC10YDQttC40LzQvtC1INGE0LDQudC70LBcbiAgICogIFwicHJvcGVydHlcIiA6IHsuLi59XG4gICAqXG4gICAqICDQtdGB0LvQuCDRg9C60LDQt9Cw0YLRjCDRj9C60L7RgNGMXG4gICAqICBcInByb3BlcnR5XCIgOiBcInVybChjaHVuay5qc29uI3NldHRpbmdzL2NodW5rLzAvdGV4dClcIlxuICAgKlxuICAgKiDRgtC+INCx0YPQtNC10YIg0LfQsNCz0YDRg9C20LXQvdC+INGB0L7QtNC10YDQttC40LzQvtC1INC/0L7Qu9GPIHNldHRpbmdzLmNodW5rWzBdLnRleHQg0LjQtyDRhNCw0LnQu9CwIGNodW5rLmpzb25cbiAgICpcbiAgICpcbiAgICogQHBhcmFtIGZpbGVuYW1lICDQv9GD0YLRjCDQuiDQvtGB0L3QvtCy0L3QvtC80YMganNvbiDRhNCw0LnQu9GDXG4gICAqIEBwYXJhbSBjYWxsYmFjayAg0LHRg9C00LXRgiDQstGL0LfQstCw0L0g0L/QvtGB0LvQtSDQvtC60L7QvdGH0LDQvdC40Y8g0LfQsNCz0YDRg9C30LrQuCDQstGB0LXRhSDRhNCw0LnQu9C+0LJcbiAgICovXG4gIGdldElubGluZUpzb246IGZ1bmN0aW9uICh1cmwsIGRhdGFUeXBlLCBjYWxsYmFja19zdWNjZXNzLCBjYWxsYmFja19lcnJvcikge1xuXG4gICAgaWYgKGRhdGFUeXBlLmNvbnN0cnVjdG9yICE9IFN0cmluZykge1xuICAgICAgY2FsbGJhY2tfZXJyb3IgPSBjYWxsYmFja19zdWNjZXNzO1xuICAgICAgY2FsbGJhY2tfc3VjY2VzcyA9IGRhdGFUeXBlO1xuICAgICAgZGF0YVR5cGUgPSBcImpzb25cIjtcbiAgICB9XG5cblxuICAgIGlmICh0eXBlb2YgdXRpbHMuQ0FDSEVEX0pTT04gIT09IFwidW5kZWZpbmVkXCIgJiYgdXRpbHMuQ0FDSEVEX0pTT04gJiYgdXRpbHMuQ0FDSEVEX0pTT05bdXJsXSkge1xuICAgICAgY2FsbGJhY2tfc3VjY2Vzcyh1dGlscy5DQUNIRURfSlNPTlt1cmxdKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiAkICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICBpZiAodHlwZW9mIGRvY3VtZW50ICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgIHZhciBpbmxpbmUgPSAkKFwic2NyaXB0W2lkPSdcIiArIHVybCArIFwiJ11cIik7XG4gICAgICAgIGlmIChpbmxpbmUubGVuZ3RoID4gMCkge1xuICAgICAgICAgIHZhciBfZGF0YSA9XG4gICAgICAgICAgICBpbmxpbmVbMF0uaW5uZXJUZXh0IHx8IC8vYWxsXG4gICAgICAgICAgICBpbmxpbmVbMF0udGV4dENvbnRlbnQgfHwgLy9maXJlZm94XG4gICAgICAgICAgICBpbmxpbmVbMF0udGV4dDsgLy9pZThcbiAgICAgICAgICBpZiAoZGF0YVR5cGUgPT0gXCJqc29uXCIpIHtcblxuICAgICAgICAgICAgdmFyIF9kYXRhID0gdXRpbHMucmVtb3ZlQ29tbWVudHMoX2RhdGEpO1xuICAgICAgICAgICAgY2FsbGJhY2tfc3VjY2VzcyhKU09OLnBhcnNlKF9kYXRhKSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNhbGxiYWNrX3N1Y2Nlc3MoX2RhdGEpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgdXRpbHMubG9hZCh1cmwsIGRhdGFUeXBlLCBjYWxsYmFja19zdWNjZXNzLCBjYWxsYmFja19lcnJvcik7XG4gIH1cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gdXRpbHM7XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL3V0aWwvZGF0YS5qc1xuLy8gbW9kdWxlIGlkID0gMTVcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiaWYgKHR5cGVvZiBfID09PSAndW5kZWZpbmVkJyAmJiB0eXBlb2YgZXhwb3J0cyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgXyA9IHJlcXVpcmUoXCIuLi9wbHVnaW5zL3VuZGVyc2NvcmVcIik7XG4gIG1vZHVsZS5leHBvcnRzID0gXztcbn1cblxubW9kdWxlLmV4cG9ydHMgPSB7XG5cbiAgbG9hZFNjcmlwdDogZnVuY3Rpb24gKHJlcXVpcmVtZW50LCBoZWxwZXIsIGVycm9yKSB7XG4gICAgdmFyIGhlYWQgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaGVhZCcpWzBdO1xuICAgIHZhciBzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTtcbiAgICBzY3JpcHQudHlwZSA9ICd0ZXh0L2phdmFzY3JpcHQnO1xuICAgIHNjcmlwdC5vbmVycm9yID0gZXJyb3I7XG4gICAgc2NyaXB0Lm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmICh0aGlzLnJlYWR5U3RhdGUgPT0gJ2NvbXBsZXRlJykge1xuICAgICAgICBoZWxwZXIoc2NyaXB0LCBfX3NyYyk7XG4gICAgICB9XG4gICAgfTtcbiAgICBzY3JpcHQuYWRkRXZlbnRMaXN0ZW5lcihcImxvYWRcIiwgaGVscGVyLCB0cnVlKTtcbiAgICBzY3JpcHQuc3JjID0gcmVxdWlyZW1lbnQ7XG4gICAgaGVhZC5hcHBlbmRDaGlsZChzY3JpcHQpO1xuICB9LFxuICBzY3JpcHRVUkw6IGZ1bmN0aW9uICgpIHtcblxuICAgIGlmIChkb2N1bWVudC5jdXJyZW50U2NyaXB0KSB7XG4gICAgICByZXR1cm4gZG9jdW1lbnQuY3VycmVudFNjcmlwdC5zcmM7XG4gICAgfVxuICAgIHZhciBzY3JpcHRzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3NjcmlwdCcpO1xuICAgIGZvciAodmFyIGkgPSBzY3JpcHRzLmxlbmd0aCAtIDE7IGktLTspIHtcbiAgICAgIGlmIChzY3JpcHRzW2ldLnNyYykge1xuICAgICAgICByZXR1cm4gc2NyaXB0c1tpXS5zcmM7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufTtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vdXRpbC9sb2FkZXIuanNcbi8vIG1vZHVsZSBpZCA9IDE2XG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oKSB7XHJcblx0dGhyb3cgbmV3IEVycm9yKFwiZGVmaW5lIGNhbm5vdCBiZSB1c2VkIGluZGlyZWN0XCIpO1xyXG59O1xyXG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAod2VicGFjaykvYnVpbGRpbi9hbWQtZGVmaW5lLmpzXG4vLyBtb2R1bGUgaWQgPSAxN1xuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCIvKiBnbG9iYWxzIF9fd2VicGFja19hbWRfb3B0aW9uc19fICovXHJcbm1vZHVsZS5leHBvcnRzID0gX193ZWJwYWNrX2FtZF9vcHRpb25zX187XHJcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vICh3ZWJwYWNrKS9idWlsZGluL2FtZC1vcHRpb25zLmpzXG4vLyBtb2R1bGUgaWQgPSAxOFxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCJtb2R1bGUuZXhwb3J0cyA9IFwiUEQ5NGJXd2dkbVZ5YzJsdmJqMGlNUzR3SWlCbGJtTnZaR2x1WnowaWRYUm1MVGdpUHo0S1BDRXRMU0JIWlc1bGNtRjBaV1FnWW5rZ1NXTnZUVzl2Ymk1cGJ5QXRMVDRLUENGRVQwTlVXVkJGSUhOMlp5QlFWVUpNU1VNZ0lpMHZMMWN6UXk4dlJGUkVJRk5XUnlBeExqRXZMMFZPSWlBaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdlIzSmhjR2hwWTNNdlUxWkhMekV1TVM5RVZFUXZjM1puTVRFdVpIUmtJajRLUEhOMlp5QjRiV3h1Y3owaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNQzl6ZG1jaUlIaHRiRzV6T25oc2FXNXJQU0pvZEhSd09pOHZkM2QzTG5jekxtOXlaeTh4T1RrNUwzaHNhVzVySWlCMlpYSnphVzl1UFNJeExqRWlJSGRwWkhSb1BTSXhObkI0SWlCb1pXbG5hSFE5SWpFMmNIZ2lJSFpwWlhkQ2IzZzlJakFnTUNBeE5pQXhOaUkrQ2p4d1lYUm9JR1pwYkd3OUlpTXdNREF3TURBaUlHUTlJazB4TlNBeFl5MHhMamd0TVM0NExUTXVOeTB3TGpjdE5DNDJJREF1TVMwd0xqUWdNQzQwTFRBdU55QXdMamt0TUM0M0lERXVOWFl3WXpBZ01TNHhMVEV1TVNBeExqZ3RNaTR4SURFdU5Xd3RNQzR4TFRBdU1TMHdMamNnTUM0NElEQXVOeUF3TGpjdE5pQTJMVEF1T0NBeUxqTXRNQzQzSURBdU55QXhMalVnTVM0MUlEQXVPQzB3TGpnZ01pNHpMVEF1T0NBMkxUWWdNQzQzSURBdU55QXdMamN0TUM0MkxUQXVNUzB3TGpKakxUQXVNeTB4SURBdU5DMHlMakVnTVM0MUxUSXVNWFl3WXpBdU5pQXdJREV1TVMwd0xqSWdNUzQwTFRBdU5pQXdMamt0TUM0NUlESXRNaTQ0SURBdU1pMDBMalo2VFRNdU9TQXhNeTQyYkMweUlEQXVOeTB3TGpJZ01DNHhJREF1TVMwd0xqSWdNQzQzTFRJZ05TNDRMVFV1T0NBeExqVWdNUzQxTFRVdU9TQTFMamQ2SWk4K0Nqd3ZjM1puUGdvPVwiXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi4vfi9iYXNlNjQtbG9hZGVyIS4vbWVkaWEvZXllZHJvcHBlci5zdmdcbi8vIG1vZHVsZSBpZCA9IDE5XG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIm1vZHVsZS5leHBvcnRzID0gXCJQSE4yWnlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpSUhacFpYZENiM2c5SWpBZ01DQXlNaUF5TWlJK1BHY2dkSEpoYm5ObWIzSnRQU0p0WVhSeWFYZ29MakF6T1RZMUlEQWdNQ0F1TURNNU5qVWdNUzR4TmpNZ01TNHhOak1wSWlCbWFXeHNQU0lqTkdRMFpEUmtJajQ4Y0dGMGFDQmtQU0p0TWpVd0xqSWdPREV1TmpGak9UY3VORE1nTUNBeE56a3VOelVnTkRNdU5ETWdNVGM1TGpjMUlEazBMamd6SURBZ01USXVORFE1TFRRdU9UTTBJREkwTGpRME9TMHhNeTQyTkRVZ016VXVORFkxYkRNMUxqUXdNaUF4TUM0ME1EUmpPQzQyTVRNdE1UUXVNakkzSURFekxqVXpNeTB5T1M0Mk1qa2dNVE11TlRNekxUUTFMamcyT1NBd0xUY3lMamsyTlMwNU5DNDBOaTB4TXpBdU1USXRNakUxTGpBMExURXpNQzR4TWkweE1qQXVOVGNnTUMweU1UVXVNRFFnTlRjdU1UWXRNakUxTGpBMElERXpNQzR4TWlBd0lESTJMamt4T0NBeE1pNDVNellnTlRFdU5qUXpJRE0xTGpFNUlEY3lMakUzTFRZdU9UVXhJRFF1TlRBeUxURXpMamMxTmlBeE1DNDFNREl0TVRndU9ETTJJREU0TGprNE5DMHhNQzQwTlRNZ01UY3VORFE1TFRFd0xqWTJJRE01TGpBNUxTNDJORFVnTmpRdU16VWdPUzQwTXpNZ01qTXVOemt4SURjdU1USTFJRE15TGpVNE1pQTFMalk1TXlBek5TNHlOQzB6TGpNMU5DQTJMak15TWkweE9DNHhNeUE1TGpVeE5DMHpNaTR6T0RVZ01USXVOVGsyTFRNdU5EZzJMamMxT0MwM0xqQTBJREV1TlRNeExURXdMalU0TWlBeUxqTTNNUzA1TGpRNE5DQXlMakkwTFRFMUxqTTFNeUF4TVM0M01qVXRNVE11TVRNZ01qRXVNak1nTVM0NU1ESWdPQzR4TVRFZ09TNHhOalFnTVRNdU5UazJJREUzTGpFMklERXpMalU1TmlBeExqTTBJREFnTWk0M01Ea3RMakUySURRdU1EWTRMUzQwTmpjZ015NHpNaTB1TnpreElEWXVOalUyTFRFdU5URTRJRGt1T1RNeUxUSXVNakkzSURJeExqRXhMVFF1TlRZMElEUTFMakF5TFRrdU56UXlJRFUyTGpBNExUTXdMalE0TWlBNExqUTROaTB4TlM0NU1ESWdOeTR4T1RVdE16WXVOVEUyTFRRdU1ETXROalF1T0RVdE5TNDNNalV0TVRRdU5ETTFMVFl1TXpnMUxUSTFMalUyTkMweExqazBOeTB6TXk0eElEUXVPVFkxTFRndU5EVXhJREUyTGpFMExURXlMakl3TnlBeU1pNHhPUzB4TXk0ME5qY2dNelV1TnpBMUlERTVMamt3TWlBNE1pNDROU0F6TWk0ek5UUWdNVE0xTGpVNUlETXpMamcyT1d3dE1UQXVOVEEwTFRNMUxqYzBZeTA0Tnk0NE55MDFMamMxT0MweE5UZ3VOVFl0TkRZdU5EVXRNVFU0TGpVMkxUazBMakEzTGpBd01ERXROVEV1TkNBNE1pNHpNaTA1TkM0NE15QXhOemt1TnpVdE9UUXVPRE1pTHo0OGNHRjBhQ0JrUFNKdE5EZzNMalUzSURJMk9TNDJNMnd0TWpJeUxqQTFMVFkxTGpJM1l5MHhMakV4TlMwdU16TTRMVEl1TWpRMExTNDBPREl0TXk0ek56TXRMalE0TWkwekxqRXhNeUF3TFRZdU1UVTRJREV1TWpJM0xUZ3VORE0wSURNdU5TMHpMakE1TmlBekxqQTRMVFF1TWpVNElEY3VOakV6TFRNdU1ESWdNVEV1TnpnNWJEWTFMakkzSURJeU1pNHhZekV1TXpRZ05DNDJNVE1nTlM0ek5USWdOeTQ1T0RJZ01UQXVNVFF6SURndU5TNDBOVE11TURRM0xqZzVNUzR3TmpRZ01TNHpNakl1TURZMElEUXVNekE1SURBZ09DNHpNRGN0TWk0ek16Z2dNVEF1TkRNNUxUWXVNVFl5YkRVMExqQTRMVGs0TGpBMElEazRMakF6TFRVMExqQTVZelF1TWpJMUxUSXVNekl5SURZdU5qSTVMVFl1T1RVeElEWXVNUzB4TVM0M01qY3RMalV4TkMwMExqYzROeTB6TGpnM05DMDRMamd3TlMwNExqVXdNaTB4TUM0eE56WWlMejQ4TDJjK1BDOXpkbWMrQ2c9PVwiXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi4vfi9iYXNlNjQtbG9hZGVyIS4vbWVkaWEvbGFzc28uc3ZnXG4vLyBtb2R1bGUgaWQgPSAyMFxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCJtb2R1bGUuZXhwb3J0cyA9IFwiUEQ5NGJXd2dkbVZ5YzJsdmJqMGlNUzR3SWlCbGJtTnZaR2x1WnowaWRYUm1MVGdpUHo0OGMzWm5JSGRwWkhSb1BTY3hPRGh3ZUNjZ2FHVnBaMmgwUFNjeE9EaHdlQ2NnZUcxc2JuTTlJbWgwZEhBNkx5OTNkM2N1ZHpNdWIzSm5Mekl3TURBdmMzWm5JaUIyYVdWM1FtOTRQU0l3SURBZ01UQXdJREV3TUNJZ2NISmxjMlZ5ZG1WQmMzQmxZM1JTWVhScGJ6MGllRTFwWkZsTmFXUWlJR05zWVhOelBTSjFhV3d0YzNCcGJpSStQSEpsWTNRZ2VEMGlNQ0lnZVQwaU1DSWdkMmxrZEdnOUlqRXdNQ0lnYUdWcFoyaDBQU0l4TURBaUlHWnBiR3c5SW01dmJtVWlJR05zWVhOelBTSmlheUkrUEM5eVpXTjBQanhuSUhSeVlXNXpabTl5YlQwaWRISmhibk5zWVhSbEtEVXdJRFV3S1NJK1BHY2dkSEpoYm5ObWIzSnRQU0p5YjNSaGRHVW9NQ2tnZEhKaGJuTnNZWFJsS0RNMElEQXBJajQ4WTJseVkyeGxJR040UFNJd0lpQmplVDBpTUNJZ2NqMGlPQ0lnWm1sc2JEMGlJMk5tWm1aa1ppSStQR0Z1YVcxaGRHVWdZWFIwY21saWRYUmxUbUZ0WlQwaWIzQmhZMmwwZVNJZ1puSnZiVDBpTVNJZ2RHODlJakF1TVNJZ1ltVm5hVzQ5SWpCeklpQmtkWEk5SWpGeklpQnlaWEJsWVhSRGIzVnVkRDBpYVc1a1pXWnBibWwwWlNJK1BDOWhibWx0WVhSbFBqeGhibWx0WVhSbFZISmhibk5tYjNKdElHRjBkSEpwWW5WMFpVNWhiV1U5SW5SeVlXNXpabTl5YlNJZ2RIbHdaVDBpYzJOaGJHVWlJR1p5YjIwOUlqRXVOU0lnZEc4OUlqRWlJR0psWjJsdVBTSXdjeUlnWkhWeVBTSXhjeUlnY21Wd1pXRjBRMjkxYm5ROUltbHVaR1ZtYVc1cGRHVWlQand2WVc1cGJXRjBaVlJ5WVc1elptOXliVDQ4TDJOcGNtTnNaVDQ4TDJjK1BHY2dkSEpoYm5ObWIzSnRQU0p5YjNSaGRHVW9ORFVwSUhSeVlXNXpiR0YwWlNnek5DQXdLU0krUEdOcGNtTnNaU0JqZUQwaU1DSWdZM2s5SWpBaUlISTlJamdpSUdacGJHdzlJaU5qWm1abVpHWWlQanhoYm1sdFlYUmxJR0YwZEhKcFluVjBaVTVoYldVOUltOXdZV05wZEhraUlHWnliMjA5SWpFaUlIUnZQU0l3TGpFaUlHSmxaMmx1UFNJd0xqRXljeUlnWkhWeVBTSXhjeUlnY21Wd1pXRjBRMjkxYm5ROUltbHVaR1ZtYVc1cGRHVWlQand2WVc1cGJXRjBaVDQ4WVc1cGJXRjBaVlJ5WVc1elptOXliU0JoZEhSeWFXSjFkR1ZPWVcxbFBTSjBjbUZ1YzJadmNtMGlJSFI1Y0dVOUluTmpZV3hsSWlCbWNtOXRQU0l4TGpVaUlIUnZQU0l4SWlCaVpXZHBiajBpTUM0eE1uTWlJR1IxY2owaU1YTWlJSEpsY0dWaGRFTnZkVzUwUFNKcGJtUmxabWx1YVhSbElqNDhMMkZ1YVcxaGRHVlVjbUZ1YzJadmNtMCtQQzlqYVhKamJHVStQQzluUGp4bklIUnlZVzV6Wm05eWJUMGljbTkwWVhSbEtEa3dLU0IwY21GdWMyeGhkR1VvTXpRZ01Da2lQanhqYVhKamJHVWdZM2c5SWpBaUlHTjVQU0l3SWlCeVBTSTRJaUJtYVd4c1BTSWpZMlptWm1SbUlqNDhZVzVwYldGMFpTQmhkSFJ5YVdKMWRHVk9ZVzFsUFNKdmNHRmphWFI1SWlCbWNtOXRQU0l4SWlCMGJ6MGlNQzR4SWlCaVpXZHBiajBpTUM0eU5YTWlJR1IxY2owaU1YTWlJSEpsY0dWaGRFTnZkVzUwUFNKcGJtUmxabWx1YVhSbElqNDhMMkZ1YVcxaGRHVStQR0Z1YVcxaGRHVlVjbUZ1YzJadmNtMGdZWFIwY21saWRYUmxUbUZ0WlQwaWRISmhibk5tYjNKdElpQjBlWEJsUFNKelkyRnNaU0lnWm5KdmJUMGlNUzQxSWlCMGJ6MGlNU0lnWW1WbmFXNDlJakF1TWpWeklpQmtkWEk5SWpGeklpQnlaWEJsWVhSRGIzVnVkRDBpYVc1a1pXWnBibWwwWlNJK1BDOWhibWx0WVhSbFZISmhibk5tYjNKdFBqd3ZZMmx5WTJ4bFBqd3ZaejQ4WnlCMGNtRnVjMlp2Y20wOUluSnZkR0YwWlNneE16VXBJSFJ5WVc1emJHRjBaU2d6TkNBd0tTSStQR05wY21Oc1pTQmplRDBpTUNJZ1kzazlJakFpSUhJOUlqZ2lJR1pwYkd3OUlpTmpabVptWkdZaVBqeGhibWx0WVhSbElHRjBkSEpwWW5WMFpVNWhiV1U5SW05d1lXTnBkSGtpSUdaeWIyMDlJakVpSUhSdlBTSXdMakVpSUdKbFoybHVQU0l3TGpNM2N5SWdaSFZ5UFNJeGN5SWdjbVZ3WldGMFEyOTFiblE5SW1sdVpHVm1hVzVwZEdVaVBqd3ZZVzVwYldGMFpUNDhZVzVwYldGMFpWUnlZVzV6Wm05eWJTQmhkSFJ5YVdKMWRHVk9ZVzFsUFNKMGNtRnVjMlp2Y20waUlIUjVjR1U5SW5OallXeGxJaUJtY205dFBTSXhMalVpSUhSdlBTSXhJaUJpWldkcGJqMGlNQzR6TjNNaUlHUjFjajBpTVhNaUlISmxjR1ZoZEVOdmRXNTBQU0pwYm1SbFptbHVhWFJsSWo0OEwyRnVhVzFoZEdWVWNtRnVjMlp2Y20wK1BDOWphWEpqYkdVK1BDOW5QanhuSUhSeVlXNXpabTl5YlQwaWNtOTBZWFJsS0RFNE1Da2dkSEpoYm5Oc1lYUmxLRE0wSURBcElqNDhZMmx5WTJ4bElHTjRQU0l3SWlCamVUMGlNQ0lnY2owaU9DSWdabWxzYkQwaUkyTm1abVprWmlJK1BHRnVhVzFoZEdVZ1lYUjBjbWxpZFhSbFRtRnRaVDBpYjNCaFkybDBlU0lnWm5KdmJUMGlNU0lnZEc4OUlqQXVNU0lnWW1WbmFXNDlJakF1TlhNaUlHUjFjajBpTVhNaUlISmxjR1ZoZEVOdmRXNTBQU0pwYm1SbFptbHVhWFJsSWo0OEwyRnVhVzFoZEdVK1BHRnVhVzFoZEdWVWNtRnVjMlp2Y20wZ1lYUjBjbWxpZFhSbFRtRnRaVDBpZEhKaGJuTm1iM0p0SWlCMGVYQmxQU0p6WTJGc1pTSWdabkp2YlQwaU1TNDFJaUIwYnowaU1TSWdZbVZuYVc0OUlqQXVOWE1pSUdSMWNqMGlNWE1pSUhKbGNHVmhkRU52ZFc1MFBTSnBibVJsWm1sdWFYUmxJajQ4TDJGdWFXMWhkR1ZVY21GdWMyWnZjbTArUEM5amFYSmpiR1UrUEM5blBqeG5JSFJ5WVc1elptOXliVDBpY205MFlYUmxLREl5TlNrZ2RISmhibk5zWVhSbEtETTBJREFwSWo0OFkybHlZMnhsSUdONFBTSXdJaUJqZVQwaU1DSWdjajBpT0NJZ1ptbHNiRDBpSTJObVptWmtaaUkrUEdGdWFXMWhkR1VnWVhSMGNtbGlkWFJsVG1GdFpUMGliM0JoWTJsMGVTSWdabkp2YlQwaU1TSWdkRzg5SWpBdU1TSWdZbVZuYVc0OUlqQXVOakp6SWlCa2RYSTlJakZ6SWlCeVpYQmxZWFJEYjNWdWREMGlhVzVrWldacGJtbDBaU0krUEM5aGJtbHRZWFJsUGp4aGJtbHRZWFJsVkhKaGJuTm1iM0p0SUdGMGRISnBZblYwWlU1aGJXVTlJblJ5WVc1elptOXliU0lnZEhsd1pUMGljMk5oYkdVaUlHWnliMjA5SWpFdU5TSWdkRzg5SWpFaUlHSmxaMmx1UFNJd0xqWXljeUlnWkhWeVBTSXhjeUlnY21Wd1pXRjBRMjkxYm5ROUltbHVaR1ZtYVc1cGRHVWlQand2WVc1cGJXRjBaVlJ5WVc1elptOXliVDQ4TDJOcGNtTnNaVDQ4TDJjK1BHY2dkSEpoYm5ObWIzSnRQU0p5YjNSaGRHVW9NamN3S1NCMGNtRnVjMnhoZEdVb016UWdNQ2tpUGp4amFYSmpiR1VnWTNnOUlqQWlJR041UFNJd0lpQnlQU0k0SWlCbWFXeHNQU0lqWTJabVptUm1JajQ4WVc1cGJXRjBaU0JoZEhSeWFXSjFkR1ZPWVcxbFBTSnZjR0ZqYVhSNUlpQm1jbTl0UFNJeElpQjBiejBpTUM0eElpQmlaV2RwYmowaU1DNDNOWE1pSUdSMWNqMGlNWE1pSUhKbGNHVmhkRU52ZFc1MFBTSnBibVJsWm1sdWFYUmxJajQ4TDJGdWFXMWhkR1UrUEdGdWFXMWhkR1ZVY21GdWMyWnZjbTBnWVhSMGNtbGlkWFJsVG1GdFpUMGlkSEpoYm5ObWIzSnRJaUIwZVhCbFBTSnpZMkZzWlNJZ1puSnZiVDBpTVM0MUlpQjBiejBpTVNJZ1ltVm5hVzQ5SWpBdU56VnpJaUJrZFhJOUlqRnpJaUJ5WlhCbFlYUkRiM1Z1ZEQwaWFXNWtaV1pwYm1sMFpTSStQQzloYm1sdFlYUmxWSEpoYm5ObWIzSnRQand2WTJseVkyeGxQand2Wno0OFp5QjBjbUZ1YzJadmNtMDlJbkp2ZEdGMFpTZ3pNVFVwSUhSeVlXNXpiR0YwWlNnek5DQXdLU0krUEdOcGNtTnNaU0JqZUQwaU1DSWdZM2s5SWpBaUlISTlJamdpSUdacGJHdzlJaU5qWm1abVpHWWlQanhoYm1sdFlYUmxJR0YwZEhKcFluVjBaVTVoYldVOUltOXdZV05wZEhraUlHWnliMjA5SWpFaUlIUnZQU0l3TGpFaUlHSmxaMmx1UFNJd0xqZzNjeUlnWkhWeVBTSXhjeUlnY21Wd1pXRjBRMjkxYm5ROUltbHVaR1ZtYVc1cGRHVWlQand2WVc1cGJXRjBaVDQ4WVc1cGJXRjBaVlJ5WVc1elptOXliU0JoZEhSeWFXSjFkR1ZPWVcxbFBTSjBjbUZ1YzJadmNtMGlJSFI1Y0dVOUluTmpZV3hsSWlCbWNtOXRQU0l4TGpVaUlIUnZQU0l4SWlCaVpXZHBiajBpTUM0NE4zTWlJR1IxY2owaU1YTWlJSEpsY0dWaGRFTnZkVzUwUFNKcGJtUmxabWx1YVhSbElqNDhMMkZ1YVcxaGRHVlVjbUZ1YzJadmNtMCtQQzlqYVhKamJHVStQQzluUGp3dlp6NDhMM04yWno0PVwiXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi4vfi9iYXNlNjQtbG9hZGVyIS4vbWVkaWEvbG9hZGVyLnN2Z1xuLy8gbW9kdWxlIGlkID0gMjFcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwibW9kdWxlLmV4cG9ydHMgPSBcIlBITjJaeUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSGRwWkhSb1BTSXlOQ0lnYUdWcFoyaDBQU0l5TkNJZ2RtbGxkMEp2ZUQwaU1DQXdJREkwSURJMElqNDhjR0YwYUNCa1BTSk5NakV1TVRReklEa3VOalkzWXkwdU56TXpMVEV1TXpreUxURXVPVEUwTFRNdU1EVXRNeTQyTVRjdE5DNDNOVE10TWk0NU56Y3RNaTQ1TnpndE5TNDBOemd0TXk0NU1UUXROaTQzT0RVdE15NDVNVFF0TGpReE5DQXdMUzQzTURndU1EazBMUzQ0Tmk0eU5EWnNMVEV1TXpZeElERXVNelpqTFRFdU9EazVMUzR5TXpZdE15NDBNaTR4TURZdE5DNHlPVFF1T1RnekxTNDROell1T0RjMUxURXVNVFkwSURJdU1UVTVMUzQzT1RJZ015NDFNak11TkRreUlERXVPREEySURJdU16QTFJRFF1TURRNUlEVXVPVEExSURVdU16YzFMakF6T0M0ek1qTXVNVFUzTGpZek9DNDBNRFV1T0RnMUxqVTRPQzQxT0RnZ01TNDFNelV1TlRnMklESXVNVEl4SURCekxqVTRPQzB4TGpVek15NHdNREl0TWk0eE1UbGpMUzQxT0RndExqVTROeTB4TGpVek55MHVOVGc0TFRJdU1USXpMUzR3TURGc0xTNHhOeTR5TlRaakxUSXVNRE14TFM0M05qVXRNeTR6T1RVdE1TNDRNamd0TkM0eU16SXRNaTQ1YkRNdU9EYzVMVE11T0RjMVl5NDBPVFlnTWk0M015QTJMalF6TWlBNExqWTNOaUE1TGpFM09DQTVMakUzT0d3dE55NHhNVFVnTnk0eE1EZGpMUzR5TXpRdU1UVXpMVEl1TnprNExTNHpNVFl0Tmk0eE5UWXRNeTQyTnpVdE15NHpPVE10TXk0ek9UTXRNeTR4TnpVdE5TNHlOekV0TXk0d01qY3ROUzQwT1Roc01TNDROVGt0TVM0NE5UWmpMUzQwTXprdExqTTFPUzB1T1RJMUxURXVNVEF6TFRFdU1UUXhMVEV1TmpnNWJDMHlMakV6TkNBeUxqRXpNV010TGpRME5TNDBORFl0TGpZNE5TQXhMakEyTkMwdU5qZzFJREV1T0RJZ01DQXhMall6TkNBeExqRXlNU0F6TGpreE5TQXpMamN4TXlBMkxqVXdOaUF5TGpjMk5DQXlMamMyTkNBMUxqVTRJRFF1TWpReklEY3VORE15SURRdU1qUXpMalkwT0NBd0lERXVNVGd0TGpFNU5TQXhMalUwTnkwdU5UWXliRGd1TURnMkxUZ3VNRGM0WXk0NU1TNDROelF0TGpjM09DQXpMalV6T0MwdU56YzRJRFF1TmpRNElEQWdNUzR4TURRdU9EazJJREV1T1RrNUlESWdNUzQ1T1RrZ01TNHhNRFVnTUNBeUxTNDRPVFlnTWkweUlEQXRNeTR4T0RRdE1TNDBNalV0Tmk0NE1TMHlMamcxTnkwNUxqTTBlbTB0TVRZdU1qQTVMVFV1TXpjeFl5NDFNamN0TGpVeklERXVORGN4TFM0M09URWdNaTQyTlRZdExqYzJNV3d0TXk0eU1Ea2dNeTR5TURaakxTNHlNell0TGprM09DMHVNRFE1TFRFdU9EUTFMalUxTXkweUxqUTBOWHB0T1M0eU9USWdOQzR3Tnpsc0xTNHdNeTB1TURJNVl5MHhMakk1TWkweExqSTVNaTB6TGpnd015MDBMak0xTmkwekxqQTVOaTAxTGpBMk15NDNNVFV0TGpjeE5TQXpMalE0T0NBeExqVXlNU0ExTGpBMk1pQXpMakE1Tmk0NE5qSXVPRFl5SURJdU1EZzRJREl1TWpRM0lESXVPVE0zSURNdU5EVTRMVEV1TnpFM0xURXVNRGMwTFRNdU5Ea3hMVEV1TkRZNUxUUXVPRGN6TFRFdU5EWXllaUl2UGp3dmMzWm5QZz09XCJcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuLi9+L2Jhc2U2NC1sb2FkZXIhLi9tZWRpYS9wYWludC1idWNrZXQuc3ZnXG4vLyBtb2R1bGUgaWQgPSAyMlxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCJtb2R1bGUuZXhwb3J0cyA9IFwiaVZCT1J3MEtHZ29BQUFBTlNVaEVVZ0FBQUVBQUFBQkFDQVlBQUFDcWFYSGVBQUFBQkhOQ1NWUUlDQWdJZkFoa2lBQUFBQWx3U0ZsekFBQU5sQUFBRFpRQkVMRC9mQUFBQUJsMFJWaDBVMjltZEhkaGNtVUFkM2QzTG1sdWEzTmpZWEJsTG05eVo1dnVQQm9BQUFYUFNVUkJWSGljNWR0L3lGNWxHUWZ3ejdVNTU1YWF0cEVvcGs2eUxiYTE2SWVnRENrMEMwa0Qyd29KRFpyOUliVWcwellpK3lNU1F2dEZoaEcxYU9JL09mL1FMTEVnY2dnenpjcEJjMUNUMm9xc1hOaHFzem5icnY2NDd4ZmZQWHVmN1htZWM1N3o3cDFmdURtY2MrNGYxL1c5cjNPZisxelhkU0l6dlJvUUVmUHh1Y3o4L0dIWFh3MEVSTVJDL0FSek0vT3RrKy9ObWg2UnVrTkVYSWd0dUhpcSt5YzBBUkh4TmtYNWkvclZPV0VKaUlncnNSbG40WWwrOVU1SUFpTGlldndZcCtKYitGaS91aWNjQVJHeERoc3hSMW4xMStKUXYvb25kU1hZdUJFUnMvQU5yTVgvY0dObWJqeFd1eE9DZ0lpWWkzdXhDdnV3S2pNZkdhVHRqQ2NnSXM3QWc3Z016K09xekh4cTBQWXptb0NJT0JlUFlDbWV4ZnN5Yzhjd2ZSeXhDRWJFNG9oNGJUc2lqZzhSc1JTUEs4ci9HcGNPcXp4VFc4RFZ1RE1pL294dCtGMHQyL0JNWnI0NHN0UXRJU0l1VTh6K0RQeFVlZWIzanRSWlpoNVdjQnIraFp5aUhNUU9QSURiY1IyVzQrVGVmc1pWbElWdWY1WG5Ic3dab00yU1d2L3BJKzcxYWZEbDJ1QXAzSXdOeW03cVAzMkllUm5QNEQ1OEFSL0VZc3h1V2ZtMWRSS3l5aGdEdGh1YWdMUHhFZzdnM0VuWEE0dndmcXhYWGoyL25UUWp2V1UvbnE3MTF0ZDJpd1lWdkdmY2lVazVpTFZEdGgrT2dOcG9RMjMwbFFFR21GMW4vTnBxQWZjcGE4YkxmWWpaV3kzcSs5WENyc1E1ZmZxZVUwMTlndERWSTFoT1h3TDYrZ01pNHMxVmliMTRRMmJ1bWJMaVVSQVJKMWRpbG1KWkxVdHhvYW0zNFM5NFplSGRwanhXNnlwQmUvQ0J6Tnc4Z2h4THNCMWJzOGNmY0N6bWZxUXd0NzdsWjNrZTNvNGJjQWNleGs1VFcwdmlMMWplWUx6aExhQXl0eEtQNFRsY2tKa0hobVYvR0VURTZZcUZUTGFZZWJndU0zYzE2SGMwQzZqa1BLNnd0NlpOSytpeU9Jb0ZEUEk1ZkVjOTNoSVJNZW9zSEs4WWhJQUg4WHVGeGF2SEswNzNPQ1lCbVhrSVg2Mm50NDVYbk80eHFFZm9IdndkS3lQaWtqSEswemtHSWlBejkrT3VldnJaOFluVFBZYnhDZDZ0YklxdWlZZzNqVW1lempFd0FabjVBcjVYMjl3eU5vazZ4ckJlNGE4ckRzY2JJdUtzTWNqVE9ZWWlvTzdHZm9pNStOUllKT29ZbzhRRjdxekhteUxpMURhRm1RNE1UVUJtYnNYUGNDWnViRjJpampGcVpHaGllL3pwaUpqUm51V1JDTWpNbitNM09BOGZibFdpanRFa05qaXhGc3pvN1hFVEFqYmhUMWhSUTlFekVpTVRrSmtIOGJWNk9tTzN4MDNENHh2d1QxeGVzekZtSEJvUmtDVktkSGM5blpGclFSc0pFbmZodjFnZEVSZTAwRituYUV4QVpqNlBIeWl4Z1p1YjlqY21MT3A3cHlXbjR4dVZpTTArTERnT25LQnpjQVcraVQ5NnhiMCtlR1JvaEVFMzFVRnVteWFsWDRlUEtCOXJleHdlVi9pRDR0YTdkSndFWEZ3SCt3Zm1kYVQwUmZnTUhsVSsweWRIc1I5VFhzOUxqdHBIeXdJOVdnVzRhVXdLejhaSzVWdGtlODhzL3h2M0s5R21oUVAzMmJLQVYwMHl1Vmt0OVhtYWtoT3dFYnQ3bE42cDVBRysxNGc1Q20wVEVFcGdNNVdzalZIN09RK2ZVUEovWHBxazhDRThpZHV3b2hXWjJ5U2dDdi9SS3V3VFF4TDNUbnhSeVNlWVBNc3Y0aUY4SEdlM0xtK0xpaS9HR3NWeE9pSDg3VmpXcC80OEpXSGlPL2hyajlMUDRidTRCdlBiVnJwVkFxcmk5MWZ6N0JmZS9pWGVvaVF1cjFIQ2JmdDY2bXpGbCtyYlpLZ01raWFsMFE4VE5UNndCUXVVYkpCZjRSZEtidEZ5dkJ1WDRCVGwxVFNybWpzbC9XYXprb1B3VUdidUhGbVFKbWc0K3hNTDNyMTRUWjg2YzVVYzNvbVozb1RWT0wycldSN0xJNkRzcnhPN0RHQ3lTazVRNG9ycFZucHlhZkl4TkJFWTJaV0RQVWZQMXVPWkRjWnNIdzBzNENRbG9mS2dZOHdxM3FIRUZRL2gvT21lOVZZZWdhcllKeFd6UHFDa3ZGMnY1aFhpOWZnUXZsMlZIeWpsYmtZUlVCVzkxWkdKa244ejlXdnhYZE90Y0c5cDViL0JpRGhIY1lhOFIvRU56RmQ4aFU4cWk5L0NhaTNiTW5OWjR3RmJST3MvVHRaRXFnV1p1YnZuMmc0bFFmTDhiSkR5MWpaYS8ya3FDM2IzWGxOMmc3Q2k3VEdiWURyK0dqdGxHc2JzaTA0SXFQLzFYRjVQdDNjeDVxRG95Z0xXS1J1bkxVb1M5SEdEcmdqWW80VFJWbVhicTI1RC9COVBMZm8zRU1FWml3QUFBQUJKUlU1RXJrSmdnZz09XCJcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuLi9+L2Jhc2U2NC1sb2FkZXIhLi9tZWRpYS9wb2x5Z29uLnBuZ1xuLy8gbW9kdWxlIGlkID0gMjNcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwibW9kdWxlLmV4cG9ydHMgPSBcImlWQk9SdzBLR2dvQUFBQU5TVWhFVWdBQUFCQUFBQUFRQ0FZQUFBQWY4LzloQUFBQUNYQklXWE1BQUFzVEFBQUxFd0VBbXB3WUFBQUtUMmxEUTFCUWFHOTBiM05vYjNBZ1NVTkRJSEJ5YjJacGJHVUFBSGphblZOblZGUHBGajMzM3ZSQ1M0aUFsRXR2VWhVSUlGSkNpNEFVa1NZcUlRa1FTb2dob2RrVlVjRVJSVVVFRzhpZ2lBT09qb0NNRlZFc0RJb0syQWZrSWFLT2c2T0lpc3I3NFh1amE5YTg5K2JOL3JYWFB1ZXM4NTJ6endmQUNBeVdTRE5STllBTXFVSWVFZUNEeDhURzRlUXVRSUVLSkhBQUVBaXpaQ0Z6L1NNQkFQaCtQRHdySXNBSHZnQUJlTk1MQ0FEQVRadkFNQnlIL3cvcVFwbGNBWUNFQWNCMGtUaExDSUFVQUVCNmprS21BRUJHQVlDZG1DWlRBS0FFQUdETFkyTGpBRkF0QUdBbmYrYlRBSUNkK0psN0FRQmJsQ0VWQWFDUkFDQVRaWWhFQUdnN0FLelBWb3BGQUZnd0FCUm1TOFE1QU5ndEFEQkpWMlpJQUxDM0FNRE9FQXV5QUFnTUFEQlJpSVVwQUFSN0FHRElJeU40QUlTWkFCUkc4bGM4OFN1dUVPY3FBQUI0bWJJOHVTUTVSWUZiQ0MxeEIxZFhMaDRvemtrWEt4UTJZUUpobWtBdXdubVpHVEtCTkEvZzg4d0FBS0NSRlJIZ2cvUDllTTRPcnM3T05vNjJEbDh0NnI4Ry95SmlZdVArNWMrcmNFQUFBT0YwZnRIK0xDK3pHb0E3Qm9CdC9xSWw3Z1JvWGd1Z2RmZUxacklQUUxVQW9PbmFWL053K0g0OFBFV2hrTG5aMmVYazVOaEt4RUpiWWNwWGZmNW53bC9BVi8xcytYNDgvUGYxNEw3aUpJRXlYWUZIQlBqZ3dzejBUS1VjejVJSmhHTGM1bzlIL0xjTC8vd2QweUxFU1dLNVdDb1U0MUVTY1k1RW1venpNcVVpaVVLU0tjVWwwdjlrNHQ4cyt3TSszelVBc0dvK0FYdVJMYWhkWXdQMlN5Y1FXSFRBNHZjQUFQSzdiOEhVS0FnRGdHaUQ0YzkzLys4Ly9VZWdKUUNBWmttU2NRQUFYa1FrTGxUS3N6L0hDQUFBUktDQktyQkJHL1RCR0N6QUJoekJCZHpCQy94Z05vUkNKTVRDUWhCQ0NtU0FISEpnS2F5Q1FpaUd6YkFkS21BdjFFQWROTUJSYUlhVGNBNHV3bFc0RGoxd0QvcGhDSjdCS0x5QkNRUkJ5QWdUWVNIYWlBRmlpbGdqamdnWG1ZWDRJY0ZJQkJLTEpDREppQlJSSWt1Uk5VZ3hVb3BVSUZWSUhmSTljZ0k1aDF4R3VwRTd5QUF5Z3Z5R3ZFY3hsSUd5VVQzVURMVkR1YWczR29SR29ndlFaSFF4bW84V29KdlFjclFhUFl3Mm9lZlFxMmdQMm84K1E4Y3d3T2dZQnpQRWJEQXV4c05Dc1Rnc0NaTmp5N0VpckF5cnhocXdWcXdEdTRuMVk4K3hkd1FTZ1VYQUNUWUVkMElnWVI1QlNGaE1XRTdZU0tnZ0hDUTBFZG9KTndrRGhGSENKeUtUcUV1MEpyb1IrY1FZWWpJeGgxaElMQ1BXRW84VEx4QjdpRVBFTnlRU2lVTXlKN21RQWtteHBGVFNFdEpHMG01U0kra3NxWnMwU0Jvams4bmFaR3V5QnptVUxDQXJ5SVhrbmVURDVEUGtHK1FoOGxzS25XSkFjYVQ0VStJb1VzcHFTaG5sRU9VMDVRWmxtREpCVmFPYVV0Mm9vVlFSTlk5YVFxMmh0bEt2VVllb0V6UjFtam5OZ3haSlM2V3RvcFhUR21nWGFQZHByK2gwdWhIZGxSNU9sOUJYMHN2cFIraVg2QVAwZHd3TmhoV0R4NGhuS0JtYkdBY1laeGwzR0srWVRLWVowNHNaeDFRd056SHJtT2VaRDVsdlZWZ3F0aXA4RlpIS0NwVktsU2FWR3lvdlZLbXFwcXJlcWd0VjgxWExWSStwWGxOOXJrWlZNMVBqcVFuVWxxdFZxcDFRNjFNYlUyZXBPNmlIcW1lb2IxUS9wSDVaL1lrR1djTk13MDlEcEZHZ3NWL2p2TVlnQzJNWnMzZ3NJV3NOcTRaMWdUWEVKckhOMlh4MktydVkvUjI3aXoycXFhRTVRek5LTTFlelV2T1VaajhINDVoeCtKeDBUZ25uS0tlWDgzNkszaFR2S2VJcEc2WTBUTGt4WlZ4cnFwYVhsbGlyU0t0UnEwZnJ2VGF1N2FlZHByMUZ1MW43Z1E1Qngwb25YQ2RIWjQvT0JaM25VOWxUM2FjS3B4Wk5QVHIxcmk2cWE2VWJvYnRFZDc5dXArNllucjVlZ0o1TWI2ZmVlYjNuK2h4OUwvMVUvVzM2cC9WSERGZ0dzd3drQnRzTXpoZzh4VFZ4Ynp3ZEw4ZmI4VkZEWGNOQVE2VmhsV0dYNFlTUnVkRThvOVZHalVZUGpHbkdYT01rNDIzR2JjYWpKZ1ltSVNaTFRlcE43cHBTVGJtbUthWTdURHRNeDgzTXphTE4xcGsxbXoweDF6TG5tK2ViMTV2ZnQyQmFlRm9zdHFpMnVHVkpzdVJhcGxudXRyeHVoVm81V2FWWVZWcGRzMGF0bmEwbDFydXR1NmNScDdsT2swNnJudFpudzdEeHRzbTJxYmNac09YWUJ0dXV0bTIyZldGblloZG50OFd1dys2VHZaTjl1bjJOL1QwSERZZlpEcXNkV2gxK2M3UnlGRHBXT3Q2YXpwenVQMzNGOUpicEwyZFl6eERQMkRQanRoUExLY1JwblZPYjAwZG5GMmU1YzRQemlJdUpTNExMTHBjK0xwc2J4dDNJdmVSS2RQVnhYZUY2MHZXZG03T2J3dTJvMjYvdU51NXA3b2Zjbjh3MG55bWVXVE56ME1QSVErQlI1ZEUvQzUrVk1HdmZySDVQUTArQlo3WG5JeTlqTDVGWHJkZXd0NlYzcXZkaDd4Yys5ajV5bitNKzR6dzMzakxlV1YvTU44QzN5TGZMVDhOdm5sK0YzME4vSS85ay8zci8wUUNuZ0NVQlp3T0pnVUdCV3dMNytIcDhJYitPUHpyYlpmYXkyZTFCaktDNVFSVkJqNEt0Z3VYQnJTRm95T3lRclNIMzU1ak9rYzVwRG9WUWZ1alcwQWRoNW1HTHczNE1KNFdIaFZlR1A0NXdpRmdhMFRHWE5YZlIzRU56MzBUNlJKWkUzcHRuTVU4NXJ5MUtOU28rcWk1cVBObzN1alM2UDhZdVpsbk0xVmlkV0Vsc1N4dzVMaXF1Tm01c3Z0Lzg3Zk9INHAzaUMrTjdGNWd2eUYxd2VhSE93dlNGcHhhcExoSXNPcFpBVEloT09KVHdRUkFxcUJhTUpmSVRkeVdPQ25uQ0hjSm5JaS9STnRHSTJFTmNLaDVPOGtncVRYcVM3Skc4Tlhra3hUT2xMT1c1aENlcGtMeE1EVXpkbXpxZUZwcDJJRzB5UFRxOU1ZT1NrWkJ4UXFvaFRaTzJaK3BuNW1aMnk2eGxoYkwreFc2THR5OGVsUWZKYTdPUXJBVlpMUXEyUXFib1ZGb28xeW9Ic21kbFYyYS96WW5LT1phcm5pdk43Y3l6eXR1UU41enZuLy90RXNJUzRaSzJwWVpMVnkwZFdPYTlyR281c2p4eGVkc0s0eFVGSzRaV0Jxdzh1SXEyS20zVlQ2dnRWNWV1ZnIwbWVrMXJnVjdCeW9MQnRRRnI2d3RWQ3VXRmZldmMxKzFkVDFndldkKzFZZnFHblJzK0ZZbUtyaFRiRjVjVmY5Z28zSGpsRzRkdnlyK1ozSlMwcWF2RXVXVFBadEptNmViZUxaNWJEcGFxbCthWERtNE4yZHEwRGQ5V3RPMzE5a1hiTDVmTktOdTdnN1pEdWFPL1BMaThaYWZKenMwN1AxU2tWUFJVK2xRMjd0TGR0V0hYK0c3UjdodDd2UFkwN05YYlc3ejMvVDdKdnR0VkFWVk4xV2JWWmZ0Sis3UDNQNjZKcXVuNGx2dHRYYTFPYlhIdHh3UFNBLzBISXc2MjE3blUxUjNTUFZSU2o5WXI2MGNPeHgrKy9wM3ZkeTBOTmcxVmpaekc0aU53UkhuazZmY0ozL2NlRFRyYWRveDdyT0VIMHg5MkhXY2RMMnBDbXZLYVJwdFRtdnRiWWx1NlQ4dyswZGJxM25yOFI5c2ZENXcwUEZsNVN2TlV5V25hNllMVGsyZnl6NHlkbFoxOWZpNzUzR0Rib3JaNzUyUE8zMm9QYisrNkVIVGgwa1gvaStjN3ZEdk9YUEs0ZFBLeTIrVVRWN2hYbXE4NlgyM3FkT284L3BQVFQ4ZTduTHVhcnJsY2E3bnVlcjIxZTJiMzZSdWVOODdkOUwxNThSYi8xdFdlT1QzZHZmTjZiL2ZGOS9YZkZ0MStjaWY5enN1NzJYY243cTI4VDd4ZjlFRHRRZGxEM1lmVlAxdiszTmp2M0g5cXdIZWc4OUhjUi9jR2hZUFAvcEgxanc5REJZK1pqOHVHRFlicm5qZytPVG5pUDNMOTZmeW5RODlrenlhZUYvNmkvc3V1RnhZdmZ2alY2OWZPMFpqUm9aZnlsNU8vYlh5bC9lckE2eG12MjhiQ3hoNit5WGd6TVY3MFZ2dnR3WGZjZHgzdm85OFBUK1I4SUg4by8yajVzZlZUMEtmN2t4bVRrLzhFQTVqei9HTXpMZHNBQUFBRVowRk5RUUFBc1k1OCsxR1RBQUFBSUdOSVVrMEFBSG9sQUFDQWd3QUErZjhBQUlEcEFBQjFNQUFBNm1BQUFEcVlBQUFYYjVKZnhVWUFBQU4yU1VSQlZIamFWSkpQYUJ4VkFNWmY4TkJXQllWNlYxcmFneUFJS1FvV0pJb2dldkdndFlwNktoSWtKZ3ViTE5uWmVUUHpkdWJ0bXplYkhaS2RoQ1NkaGNtZjNmeUJTTmhMRXRDUXpDMXVTSlllMHZ4Wmt1eG1kMDBhUEZqVEhzU3Fud2R0cllmdjluMC9mb2VQU0NsYnN0bnNkVTNUanVMeCtJTnNObnZtdXU2WjY3cG5uUE16MjdZZlVFcm5IY2Noa1VpRWNNNkpiZHRFMHpRQ2dCQXA1UXVjODB0ZFhWMGp2dStqVnF1aDJXeWkwV2lnMld3aURFTnd6bWVrbEtTOXZmMHE1L3cxS2VWL0FOdTJYeFJDdEhIT3YvTThEM3Q3ZXpnOVBVV2owVUNsVXNIdzhQQkR6L00rMW5YOUtxWDBNSlZLM1dlTXZhN3IraE1EWWhqR3pXUXkrZXY2K2pvMk56ZXh1N3VMazVNVGxNdGxLSXF5bVU2bkx6SEdsaGNYRjdHMHRBUks2ZmVhcHAwRFFFZ21rN2xJS1oyWW1abEJyVlpEWDE4ZmZOOUh0VnBGc1ZqOGd6RjJPNTFPdHpxT3N6NDNONGVqb3lQNHZvOTRQTjcyMk9DOXNiR3hoNVZLQmZQejgranU3bDVLSkJJL3JheXNRRkdVbnhsamJ6REczbFJWdFZkUmxJTzF0VFdFWVlqQndjRTVBSVJRU204RlFZRGo0MlBrODNuMDlQUjRpcUk0SFIwZGo0UVFaY2R4bnJNczZ4cWw5R1puWjJlNHVycUs3ZTF0VEV4TVZBQVFFby9IWTdsY0R2VjZIWVZDQVpSU3FhcnFGN3F1TDl1Mi9iV1Vzc1cyN1pjWVkyM1JhSFExREVQczdPd2dDSUovQUxxdUo4Ykh4Myt2MVdxWW5wNUdJcEZRVGROOGkzUCtnWlR5b3BTU1NDbUpaVm5YSTVISVpoaUdLSlZLeU9WeVB3SWdoREgyRGVkOGEzbDVHZVZ5R1VORFEvZWtsRjhLSWM0OUhxZlQ2UmJUTlB0OTMvOXJmMzhmazVPVG9KUitDNEFRd3pBK2pNVml0ejNQZTNSNGVJaGlzUWpQOCs0eHhqNjNMS3ROVmRWM0RjUFErdnY3VVNxVmNPZk9IYml1KzRzUTRnb0FRcExKNU51V1pmVnd6a3VqbzZPb1ZxdlkyTmhBRUFTWW5aMUZMcGRERUFTb1ZxdlkydHFDRUFJREF3T0c2N29YQUJBaWhMaE1LZjJFYzU1TXBWSWJBd01EQ01NUWpVWURqVVlEOVhvZEJ3Y0hXRmhZZ09NNHYzSE9KNFVRcjBncG56enh2R1ZaMTFSVi9ZcHozaHVOUnNlVHllVGRxYW1wUHd1RkF2TDVQRVpHUnU1SElwRWZETU5JWlRLWlY2V1V6endOSUxadFAyOVpWcXVtYVo5UlNtOFpobUZRU29kaXNaamYyOXViVTFWVlVrcHZjTTZ2U0NtZmRSeUgvQS93Yjg0TElTNmJwdm1PcnVzZmFacjJxYTdyTnd6RGVOODB6VmJidGwrV1VsNTRxazhBa0w4SEFKbDFaQ1lyMEN5cUFBQUFBRWxGVGtTdVFtQ0NcIlxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4uL34vYmFzZTY0LWxvYWRlciEuL21lZGlhL3JvdGF0ZS5wbmdcbi8vIG1vZHVsZSBpZCA9IDI0XG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIm1vZHVsZS5leHBvcnRzID0gXCJQRDk0Yld3Z2RtVnljMmx2YmowaU1TNHdJaUJsYm1OdlpHbHVaejBpYVhOdkxUZzROVGt0TVNJL1BnbzhJUzB0SUVkbGJtVnlZWFJ2Y2pvZ1FXUnZZbVVnU1d4c2RYTjBjbUYwYjNJZ01UWXVNQzR3TENCVFZrY2dSWGh3YjNKMElGQnNkV2N0U1c0Z0xpQlRWa2NnVm1WeWMybHZiam9nTmk0d01DQkNkV2xzWkNBd0tTQWdMUzArQ2p3aFJFOURWRmxRUlNCemRtY2dVRlZDVEVsRElDSXRMeTlYTTBNdkwwUlVSQ0JUVmtjZ01TNHhMeTlGVGlJZ0ltaDBkSEE2THk5M2QzY3Vkek11YjNKbkwwZHlZWEJvYVdOekwxTldSeTh4TGpFdlJGUkVMM04yWnpFeExtUjBaQ0krQ2p4emRtY2dlRzFzYm5NOUltaDBkSEE2THk5M2QzY3Vkek11YjNKbkx6SXdNREF2YzNabklpQjRiV3h1Y3pwNGJHbHVhejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TVRrNU9TOTRiR2x1YXlJZ2RtVnljMmx2YmowaU1TNHhJaUJwWkQwaVEyRndZVjh4SWlCNFBTSXdjSGdpSUhrOUlqQndlQ0lnZDJsa2RHZzlJakUyY0hnaUlHaGxhV2RvZEQwaU1UWndlQ0lnZG1sbGQwSnZlRDBpTUNBd0lETTVOaUF6T1RZaUlITjBlV3hsUFNKbGJtRmliR1V0WW1GamEyZHliM1Z1WkRwdVpYY2dNQ0F3SURNNU5pQXpPVFk3SWlCNGJXdzZjM0JoWTJVOUluQnlaWE5sY25abElqNEtQR2MrQ2drOFp6NEtDUWs4Y0dGMGFDQmtQU0pOTXpnMkxERTRNaTQyTmpWb0xURXhMakU1T1dNdE55NHpOVFV0T0RVdU16azNMVGMyTGpBMk55MHhOVFF1TVRBNExURTJNUzQwTmpjdE1UWXhMalEyTmxZeE1HTXdMVFV1TlRJeUxUUXVORGM1TFRFd0xURXdMVEV3YUMweE1DNDJOamtnSUNBZ1l5MDFMalV5TWl3d0xURXdMRFF1TkRjNExURXdMREV3ZGpFeExqRTVPVU01Tnk0eU5qZ3NNamd1TlRVMkxESTRMalUxTnl3NU55NHlOamdzTWpFdU1UazVMREU0TWk0Mk5qVklNVEJqTFRVdU5USXlMREF0TVRBc05DNDBOemd0TVRBc01UQjJNVEF1TmpjZ0lDQWdZekFzTlM0MU1qSXNOQzQwTnpnc01UQXNNVEFzTVRCb01URXVNVGs1WXpjdU16VTNMRGcxTGpNNU5pdzNOaTR3Tmpnc01UVTBMakV3T0N3eE5qRXVORFkyTERFMk1TNDBOalpXTXpnMll6QXNOUzQxTWpFc05DNDBOemdzTVRBc01UQXNNVEJvTVRBdU5qWTVJQ0FnSUdNMUxqVXlNU3d3TERFd0xUUXVORGM1TERFd0xURXdkaTB4TVM0eE9UbGpPRFV1TXprM0xUY3VNelUxTERFMU5DNHhNRGt0TnpZdU1EWTNMREUyTVM0ME5qY3RNVFl4TGpRMk5rZ3pPRFpqTlM0MU1qSXNNQ3d4TUMwMExqUTNPQ3d4TUMweE1IWXRNVEF1TmpjZ0lDQWdRek01Tml3eE9EY3VNVFF6TERNNU1TNDFNaklzTVRneUxqWTJOU3d6T0RZc01UZ3lMalkyTlhvZ1RUSXhNeTR6TXpRc016UXpMams1TW5ZdE5EQXVNRFkwWXpRM0xqRXdOQzAyTGpjMk1TdzRNeTQ0TXpJdE5ETXVORGczTERrd0xqVTVOQzA1TUM0MU9UTm9OREF1TURZMElDQWdJR010TXk0ME9ERXNNek11TWpnMUxURTRMalF3Tnl3Mk5DNDFOekl0TkRJdU1qUTNMRGc0TGpReE1VTXlOemN1T1RBMUxETXlOUzQxT0RZc01qUTJMall4T0N3ek5EQXVOVEV5TERJeE15NHpNelFzTXpRekxqazVNbm9nVFRFNE1pNDJOalVzTXpRekxqazVNaUFnSUNCakxUTXpMakk0TlMwekxqUTRNUzAyTkM0MU56SXRNVGd1TkRBM0xUZzRMalF4TVMwME1pNHlORFp6TFRNNExqYzJOUzAxTlM0eE1qWXROREl1TWpRMkxUZzRMalF4TVdnME1DNHdOalJqTmk0M05qRXNORGN1TVRBekxEUXpMalE1TERnekxqZ3pNaXc1TUM0MU9UTXNPVEF1TlRreklDQWdJRll6TkRNdU9Ua3lUREU0TWk0Mk5qVXNNelF6TGprNU1ub2dUVEU0TWk0Mk5qVXNOVEl1TURBNGRqUXdMakEyTkdNdE5EY3VNVEF6TERZdU56WXhMVGd6TGpnek1pdzBNeTQwT1MwNU1DNDFPVE1zT1RBdU5Ua3pTRFV5TGpBd09DQWdJQ0JqTXk0ME9ERXRNek11TWpnMUxERTRMalF3TnkwMk5DNDFOeklzTkRJdU1qUTJMVGc0TGpReE1WTXhORGt1TXpnc05UVXVORGc1TERFNE1pNDJOalVzTlRJdU1EQTRlaUJOTVRJMExqRXdPQ3d4T1Roak1DMDBNQzQzTkRRc016TXVNVFEzTFRjekxqZzVNaXczTXk0NE9USXROek11T0RreUlDQWdJSE0zTXk0NE9USXNNek11TVRRM0xEY3pMamc1TWl3M015NDRPVEpUTWpNNExqYzBOQ3d5TnpFdU9Ea3pMREU1T0N3eU56RXVPRGt6VXpFeU5DNHhNRGdzTWpNNExqYzBOQ3d4TWpRdU1UQTRMREU1T0hvZ1RUSXhNeTR6TXpRc05USXVNREE0SUNBZ0lHTXpNeTR5T0RRc015NDBPQ3cyTkM0MU56RXNNVGd1TkRBMkxEZzRMalF4TVN3ME1pNHlORFpqTWpNdU9EUXNNak11T0RNNUxETTRMamMyTml3MU5TNHhNallzTkRJdU1qUTNMRGc0TGpReE1XZ3ROREF1TURZMElDQWdJR010Tmk0M05qSXRORGN1TVRBekxUUXpMalE0T0MwNE15NDRNekl0T1RBdU5UazBMVGt3TGpVNU0xWTFNaTR3TURoTU1qRXpMak16TkN3MU1pNHdNRGg2SWlCbWFXeHNQU0lqTURBd01EQXdJaTgrQ2drOEwyYytDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BDOXpkbWMrQ2c9PVwiXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi4vfi9iYXNlNjQtbG9hZGVyIS4vbWVkaWEvdGFyZ2V0LnN2Z1xuLy8gbW9kdWxlIGlkID0gMjVcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuQmFzZUJydXNoLnByb3RvdHlwZSwge1xuICB1c2VEcmF3aW5nQ29sb3I6IHRydWUsXG4gIHNldE9wdGlvbnM6IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgZm9yICh2YXIgcHJvcCBpbiBvcHRpb25zKSB7XG4gICAgICB0aGlzW3Byb3BdID0gb3B0aW9uc1twcm9wXTtcbiAgICB9XG4gIH0sXG4gIHR5cGU6IFwiYmFzZS1icnVzaFwiLFxuICBpbml0aWFsaXplOiBmdW5jdGlvbiAoY2FudmFzLCBvcHRpb25zKSB7XG4gICAgdGhpcy5jYW52YXMgPSBjYW52YXM7XG4gICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG4gICAgdGhpcy5jYW52YXMuYXBwbGljYXRpb24uZmlyZShcImVudGl0eTpjcmVhdGVkXCIsIHt0YXJnZXQ6IHRoaXMsIG9wdGlvbnM6IG9wdGlvbnN9KVxuICAgIHRoaXMuc2V0T3B0aW9ucyhvcHRpb25zKTtcbiAgfSxcbiAgY29udmVydENvbG9yOiBmdW5jdGlvbiAoY29sb3IsIHR5cGUpIHtcbiAgICB0eXBlID0gdHlwZSB8fCBcIm5hbWVcIjtcbiAgICBpZiAoY29sb3IgaW5zdGFuY2VvZiBBcnJheSkge1xuICAgICAgaWYgKHR5cGUgPT0gXCJzb3VyY2VcIikge1xuICAgICAgICByZXR1cm4gY29sb3I7XG4gICAgICB9XG4gICAgICBjb2xvciA9IFwiI1wiICsgZmFicmljLkNvbG9yLmZyb21Tb3VyY2UoY29sb3IpLnRvSGV4KCk7XG4gICAgfVxuICAgIGlmICh0eXBlID09IFwiaGV4XCIgfHwgdHlwZSA9PSBcInNvdXJjZVwiKSB7XG4gICAgICBpZiAoZmFicmljLkNvbG9yLmNvbG9yTmFtZU1hcFtjb2xvcl0pIHtcbiAgICAgICAgY29sb3IgPSBmYWJyaWMuQ29sb3IuY29sb3JOYW1lTWFwW2NvbG9yXTtcbiAgICAgIH1cbiAgICAgIGlmICh0eXBlID09IFwic291cmNlXCIpIHtcbiAgICAgICAgaWYgKGNvbG9yID09IFwidHJhbnNwYXJlbnRcIikge1xuICAgICAgICAgIHJldHVybiBbMCwgMCwgMCwgMF07XG4gICAgICAgIH1cbiAgICAgICAgdmFyIF9zb3VyY2UgPSBmYWJyaWMuQ29sb3IuZnJvbUhleChjb2xvcikuZ2V0U291cmNlKClcbiAgICAgICAgX3NvdXJjZVszXSAqPSAyNTU7XG4gICAgICAgIHJldHVybiBfc291cmNlO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gY29sb3I7XG4gIH0sXG4gIGdldENvbG9yOiBmdW5jdGlvbiAodHlwZSkge1xuICAgIHZhciBjb2xvciA9IHRoaXMudXNlRHJhd2luZ0NvbG9yICYmIHRoaXMuY2FudmFzLmRyYXdpbmdDb2xvciB8fCB0aGlzLmNvbG9yO1xuICAgIHJldHVybiB0aGlzLmNvbnZlcnRDb2xvcihjb2xvciwgdHlwZSk7XG4gIH1cbn0pO1xuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9icnVzaGVzL0Jhc2VCcnVzaC5qc1xuLy8gbW9kdWxlIGlkID0gMjZcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiJ3VzZSBzdHJpY3QnO1xuXG5cbmZhYnJpYy5NYWdpY1dhbmQgPSByZXF1aXJlKCcuLi9wbHVnaW5zL21hZ2ljd2FuZCcpO1xuXG4gIC8qKlxuICAgKiBQZW5jaWxCcnVzaCBjbGFzc1xuICAgKiBAY2xhc3MgZmFicmljLlBlbmNpbEJydXNoXG4gICAqIEBleHRlbmRzIGZhYnJpYy5CYXNlQnJ1c2hcbiAgICovXG4gIGZhYnJpYy5QYWludEJ1Y2tldEJydXNoID0gZmFicmljLnV0aWwuY3JlYXRlQ2xhc3MoZmFicmljLkJhc2VCcnVzaCwgLyoqIEBsZW5kcyBmYWJyaWMuUGVuY2lsQnJ1c2gucHJvdG90eXBlICovIHtcbiAgICB0eXBlOiAncGFpbnQtYnVja2V0LWJydXNoJyxcbiAgICAvKipcbiAgICAgKiBDb25zdHJ1Y3RvclxuICAgICAqIEBwYXJhbSB7ZmFicmljLkNhbnZhc30gY2FudmFzXG4gICAgICogQHJldHVybiB7ZmFicmljLlBlbmNpbEJydXNofSBJbnN0YW5jZSBvZiBhIHBlbmNpbCBicnVzaFxuICAgICAqL1xuICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uKGNhbnZhcykge1xuICAgICAgdGhpcy5jYWxsU3VwZXIoJ2luaXRpYWxpemUnLCBjYW52YXMpO1xuICAgICAgdGhpcy5fcG9pbnRzID0gW107XG4gICAgfSxcbiAgICBnZXRUYXJnZXQ6IGZ1bmN0aW9uKCl7XG4gICAgICByZXR1cm4gdGhpcy5jYW52YXMuZHJhd2luZ0NvbnRleHQ7XG4gICAgfSxcbiAgICBvbk1vdXNlVXA6IGZ1bmN0aW9uKCkge30sXG4gICAgb25Nb3VzZU1vdmU6IGZ1bmN0aW9uKCkge30sXG4gICAgb25Nb3VzZURvd246IGZ1bmN0aW9uKHBvaW50ZXIpIHtcbiAgICAgIHRoaXMuX2ZpbGwocG9pbnRlcik7XG4gICAgfSxcbiAgICBfZmlsbDogZnVuY3Rpb24ocG9pbnRlcil7XG4gICAgICBwb2ludGVyID0ge1xuICAgICAgICB4OiBNYXRoLmZsb29yKHBvaW50ZXIueCksXG4gICAgICAgIHk6IE1hdGguZmxvb3IocG9pbnRlci55KVxuICAgICAgfTtcblxuICAgICAgdmFyIGluZm8gPSB0aGlzLmdldFRhcmdldCgpLmdldEltYWdlRGF0YSgwLDAsdGhpcy5nZXRUYXJnZXQoKS5jYW52YXMud2lkdGgsdGhpcy5nZXRUYXJnZXQoKS5jYW52YXMuaGVpZ2h0KTtcblxuICAgICAgZmFicmljLk1hZ2ljV2FuZC5mbG9vZEZpbGwoaW5mbywgcG9pbnRlci54ICwgcG9pbnRlci55LCAxLHt9LG51bGwsZnVuY3Rpb24obWFzayl7XG4gICAgICAgIHZhciBfY29sb3IgPSB0aGlzLmdldENvbG9yKCdzb3VyY2UnKTtcbiAgICAgICAgdmFyIF90YXJnZXQgPSB0aGlzLmdldFRhcmdldCgpO1xuICAgICAgICB2YXIgX3cgPSBtYXNrLmJvdW5kcy5tYXhYIC0gbWFzay5ib3VuZHMubWluWCArIDEsIF9oID0gbWFzay5ib3VuZHMubWF4WSAtIG1hc2suYm91bmRzLm1pblkgKyAxO1xuICAgICAgICB2YXIgb2xkSW1hZ2VEYXRhID0gX3RhcmdldC5nZXRJbWFnZURhdGEoIG1hc2suYm91bmRzLm1pblgsbWFzay5ib3VuZHMubWluWSxfdywgX2gpO1xuXG4gICAgICAgIG1hc2sucmVuZGVyKF90YXJnZXQse1xuICAgICAgICAgIGludGVyc2VjdGlvbkNvbG9yIDogX2NvbG9yLFxuICAgICAgICAgIGZpbGwgOiBfY29sb3IsXG4gICAgICAgICAgY2FjaGU6IGZhbHNlLFxuICAgICAgICAgIGxlZnQgOiBtYXNrLmJvdW5kcy5taW5YLFxuICAgICAgICAgIHRvcCA6IG1hc2suYm91bmRzLm1pbllcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5jYW52YXMuZmlyZShcImRyYXc6YWZ0ZXJcIix7XG4gICAgICAgICAgdGFyZ2V0OiB0aGlzLmdldFRhcmdldCgpICxcbiAgICAgICAgICByZWRvOiBfdGFyZ2V0LmdldEltYWdlRGF0YSggbWFzay5ib3VuZHMubWluWCxtYXNrLmJvdW5kcy5taW5ZLF93LCBfaCksXG4gICAgICAgICAgdW5kbzogb2xkSW1hZ2VEYXRhICxcbiAgICAgICAgICBsZWZ0IDogbWFzay5ib3VuZHMubWluWCxcbiAgICAgICAgICB0b3AgOiBtYXNrLmJvdW5kcy5taW5ZLFxuICAgICAgICAgIGNvbG9yOiB0aGlzLmdldENvbG9yKCkuc2xpY2UoKVxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgfSxcbiAgICBnZXRIaXN0b3J5UmVjb3JkOiBmdW5jdGlvbihldmVudCkge1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBjYW52YXM6ICAgdGhpcy5jYW52YXMsXG4gICAgICAgIG9iamVjdDogICBldmVudC50YXJnZXQgLFxuICAgICAgICB0eXBlOiAgICAgXCJkcmF3OmJ1Y2tldFwiLFxuICAgICAgICBsZWZ0OiAgICAgZXZlbnQubGVmdCAsXG4gICAgICAgIHRvcDogICAgICBldmVudC50b3AgLFxuICAgICAgICB1bmRvRGF0YTogZXZlbnQudW5kbyxcbiAgICAgICAgcmVkb0RhdGE6IGV2ZW50LnJlZG8sXG4gICAgICAgIGNvbG9yOiAgICB0aGlzLmNvbnZlcnRDb2xvcihldmVudC5jb2xvcixcInNvdXJjZVwiICApLFxuICAgICAgICB1bmRvOiBmdW5jdGlvbihfYWN0aW9uKXtcbiAgICAgICAgICBfYWN0aW9uLm9iamVjdC5wdXRJbWFnZURhdGEoX2FjdGlvbi51bmRvRGF0YSwgX2FjdGlvbi5sZWZ0LF9hY3Rpb24udG9wKTtcbiAgICAgICAgICBfYWN0aW9uLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICAgICAgfSxcbiAgICAgICAgcmVkbzogZnVuY3Rpb24oX2FjdGlvbil7XG4gICAgICAgICAgX2FjdGlvbi5vYmplY3QucHV0SW1hZ2VEYXRhKF9hY3Rpb24ucmVkb0RhdGEsIF9hY3Rpb24ubGVmdCxfYWN0aW9uLnRvcCk7XG4gICAgICAgICAgX2FjdGlvbi5jYW52YXMucmVuZGVyQWxsKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuXG5mYWJyaWMuU2xpZGVDYW52YXMucHJvdG90eXBlLmRyYXdpbmdUb29scy5QYWludEJ1Y2tldEJydXNoID0ge1xuICBpY29uOiAgJ2RhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsJyArIHJlcXVpcmUoJ2Jhc2U2NC1sb2FkZXIhLi8uLi9tZWRpYS9wYWludC1idWNrZXQuc3ZnJyksXG4gIHRpdGxlOiAnQnVja2V0IEJydXNoJ1xufTtcbmZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUuYWN0aXZlRHJhd2luZ1Rvb2xzLnB1c2goXCJQYWludEJ1Y2tldEJydXNoXCIpO1xuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9icnVzaGVzL1BhaW50QnVja2V0QnJ1c2guanNcbi8vIG1vZHVsZSBpZCA9IDI3XG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIid1c2Ugc3RyaWN0JztcblxuXG4gIC8qKlxuICAgKiBQZW5jaWxCcnVzaCBjbGFzc1xuICAgKiBAY2xhc3MgZmFicmljLlBlbmNpbEJydXNoXG4gICAqIEBleHRlbmRzIGZhYnJpYy5CYXNlQnJ1c2hcbiAgICovXG4gIGZhYnJpYy5QYWludFBlbkJydXNoID0gZmFicmljLnV0aWwuY3JlYXRlQ2xhc3MoZmFicmljLkJhc2VCcnVzaCwgLyoqIEBsZW5kcyBmYWJyaWMuUGVuY2lsQnJ1c2gucHJvdG90eXBlICovIHtcbiAgICB0eXBlOiAncGFpbnQtcGVuLWJydXNoJyxcblxuICAgIC8qKlxuICAgICAqIENvbnN0cnVjdG9yXG4gICAgICogQHBhcmFtIHtmYWJyaWMuQ2FudmFzfSBjYW52YXNcbiAgICAgKiBAcmV0dXJuIHtmYWJyaWMuUGVuY2lsQnJ1c2h9IEluc3RhbmNlIG9mIGEgcGVuY2lsIGJydXNoXG4gICAgICovXG4gICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oY2FudmFzKSB7XG4gICAgICB0aGlzLmNhbGxTdXBlcignaW5pdGlhbGl6ZScsIGNhbnZhcyk7XG4gICAgICB0aGlzLl9wb2ludHMgPSBbXTtcbiAgICB9LFxuICAgIGdldFRhcmdldDogZnVuY3Rpb24oKXtcbiAgICAgIHJldHVybiB0aGlzLmNhbnZhcy5kcmF3aW5nQ29udGV4dDtcbiAgICB9LFxuICAgIC8qKlxuICAgICAqIElub3Zva2VkIG9uIG1vdXNlIGRvd25cbiAgICAgKiBAcGFyYW0ge09iamVjdH0gcG9pbnRlclxuICAgICAqL1xuICAgIG9uTW91c2VEb3duOiBmdW5jdGlvbihwb2ludGVyKSB7XG4gICAgICB0aGlzLl9yZXNldCgpO1xuICAgICAgdGhpcy5fZmlsbChwb2ludGVyKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogSW5vdm9rZWQgb24gbW91c2UgbW92ZVxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBwb2ludGVyXG4gICAgICovXG4gICAgb25Nb3VzZU1vdmU6IGZ1bmN0aW9uKHBvaW50ZXIpIHtcbiAgICAgIHRoaXMuX2ZpbGwocG9pbnRlcik7XG4gICAgfSxcbiAgICAvKipcbiAgICAgKiBJbnZva2VkIG9uIG1vdXNlIHVwXG4gICAgICovXG4gICAgb25Nb3VzZVVwOiBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMuY2FudmFzLmZpcmUoXCJkcmF3OmFmdGVyXCIse1xuICAgICAgICB0YXJnZXQ6IHRoaXMuZ2V0VGFyZ2V0KCkgLFxuICAgICAgICBwb2ludHM6IHRoaXMuX3BvaW50cy5zbGljZSgpICxcbiAgICAgICAgY29sb3I6IHRoaXMuZ2V0Q29sb3IoJ3NvdXJjZScpXG4gICAgICB9KTtcbiAgICB9LFxuICAgIF9maWxsOiBmdW5jdGlvbihwb2ludGVyKXtcbiAgICAgIHBvaW50ZXIgPSB7XG4gICAgICAgIHg6IE1hdGguZmxvb3IocG9pbnRlci54KSxcbiAgICAgICAgeTogTWF0aC5mbG9vcihwb2ludGVyLnkpXG4gICAgICB9O1xuXG4gICAgICBpZihfLmZpbmRXaGVyZSh0aGlzLl9wb2ludHMscG9pbnRlcikpe1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIC8vIHRoaXMuZ2V0VGFyZ2V0KCkuZmlsbFJlY3QocG9pbnRlci54ICwgcG9pbnRlci55ICAsMSwxKTtcbiAgICAgIHZhciBfZGF0YSA9IHRoaXMuZ2V0VGFyZ2V0KCkuZ2V0SW1hZ2VEYXRhKHBvaW50ZXIueCAsIHBvaW50ZXIueSAgLDEsMSk7XG4gICAgICBwb2ludGVyLmNvbG9yID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoX2RhdGEuZGF0YSk7XG4gICAgICB0aGlzLl9wb2ludHMucHVzaChwb2ludGVyKTtcbiAgICAgIHZhciBfY29sb3IgPSB0aGlzLmdldENvbG9yKCdzb3VyY2UnKTtcblxuXG5cblxuICAgICAgX2RhdGEuZGF0YVswXSA9IF9jb2xvclswXTtcbiAgICAgIF9kYXRhLmRhdGFbMV0gPSBfY29sb3JbMV07XG4gICAgICBfZGF0YS5kYXRhWzJdID0gX2NvbG9yWzJdO1xuICAgICAgX2RhdGEuZGF0YVszXSA9IF9jb2xvclszXTtcblxuICAgICAgdGhpcy5nZXRUYXJnZXQoKS5wdXRJbWFnZURhdGEoX2RhdGEsIHBvaW50ZXIueCAsIHBvaW50ZXIueSk7XG4gICAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICB9LFxuICAgIHVuZG9QYWludEFjdGlvbjogZnVuY3Rpb24oX2FjdGlvbil7XG4gICAgICB2YXIgY3R4ID0gX2FjdGlvbi5vYmplY3Q7XG4gICAgICBmb3IodmFyIGkgaW4gX2FjdGlvbi5wb2ludHMpe1xuICAgICAgICB2YXIgX3AgID1fYWN0aW9uLnBvaW50c1tpXSwgX2MgPSBfYWN0aW9uLmJydXNoLmdldEFjdGlvbkNvbG9yKF9wLmNvbG9yKTtcbiAgICAgICAgaWYoX2NbM10gPT0gMCkge1xuICAgICAgICAgIGN0eC5jbGVhclJlY3QoX3AueCxfcC55ICAsMSwxKTtcbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgY3R4LmZpbGxTdHlsZSA9IFwicmdiYShcIiArIF9jWzBdICsgXCIsXCIgKyBfY1sxXSArIFwiLFwiICsgX2NbMl0gKyBcIixcIiArIF9jWzNdICsgIFwiKVwiO1xuICAgICAgICAgIGN0eC5maWxsUmVjdChfcC54LF9wLnkgICwxLDEpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBfYWN0aW9uLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICB9LFxuICAgIHJlZG9QYWludEFjdGlvbjogZnVuY3Rpb24oX2FjdGlvbil7XG5cbiAgICAgIHZhciBjdHggPSBfYWN0aW9uLm9iamVjdCwgX2MgPSBfYWN0aW9uLmJydXNoLmdldEFjdGlvbkNvbG9yKF9hY3Rpb24uY29sb3IpO1xuICAgICAgdmFyIHB0cyA9IF9hY3Rpb24ucG9pbnRzO1xuICAgICAgaWYoX2NbM10gPT0gMCkge1xuICAgICAgICBmb3IodmFyIGkgaW4gcHRzKXtcbiAgICAgICAgICBjdHguY2xlYXJSZWN0KHB0c1tpXS54LHB0c1tpXS55ICAsMSwxKTtcbiAgICAgICAgfVxuICAgICAgfWVsc2V7XG4gICAgICAgIGN0eC5maWxsU3R5bGUgPSBcInJnYmEoXCIgKyBfY1swXSArIFwiLFwiICsgX2NbMV0gKyBcIixcIiArIF9jWzJdICsgXCIsXCIgKyBfY1szXSArIFwiKVwiO1xuICAgICAgICBmb3IodmFyIGkgaW4gcHRzKXtcbiAgICAgICAgICBjdHguZmlsbFJlY3QocHRzW2ldLngscHRzW2ldLnkgLDEsMSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIF9hY3Rpb24uY2FudmFzLnJlbmRlckFsbCgpO1xuICAgIH0sXG4gICAgLyoqXG4gICAgICogQ2xlYXIgcG9pbnRzIGFycmF5IGFuZCBzZXQgY29udGV4dFRvcCBjYW52YXMgc3R5bGUuXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfcmVzZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5fcG9pbnRzLmxlbmd0aCA9IDA7XG4gICAgICB0aGlzLmdldFRhcmdldCgpLmZpbGxTdHlsZSA9IHRoaXMuY29sb3I7XG4gICAgfSxcbiAgICBnZXRIaXN0b3J5UmVjb3JkOiBmdW5jdGlvbihldmVudCl7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGNhbnZhczogICB0aGlzLmNhbnZhcyxcbiAgICAgICAgdHlwZTogICAgIFwiZHJhdzpwZW5cIixcbiAgICAgICAgb2JqZWN0OiAgIGV2ZW50LnRhcmdldCAsXG4gICAgICAgIHBvaW50czogICBldmVudC5wb2ludHMgLFxuICAgICAgICBicnVzaDogICB0aGlzLFxuICAgICAgICBjb2xvcjogICAgZXZlbnQuY29sb3IsXG4gICAgICAgIHVuZG86ICAgICB0aGlzLnVuZG9QYWludEFjdGlvbixcbiAgICAgICAgcmVkbzogICAgIHRoaXMucmVkb1BhaW50QWN0aW9uXG4gICAgICB9XG4gICAgfVxuICB9KTtcblxuZmFicmljLlNsaWRlQ2FudmFzLnByb3RvdHlwZS5kcmF3aW5nVG9vbHMuUGFpbnRQZW5CcnVzaCA9IHtcbiAgY2xhc3NOYW1lOiAnZmEgZmEtcGFpbnQtYnJ1c2gnLFxuICB0aXRsZTogJ1BlbiBCcnVzaCdcbn07XG5mYWJyaWMuU2xpZGVDYW52YXMucHJvdG90eXBlLmFjdGl2ZURyYXdpbmdUb29scy5wdXNoKFwiUGFpbnRQZW5CcnVzaFwiKTtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vYnJ1c2hlcy9QYWludFBlbkJydXNoLmpzXG4vLyBtb2R1bGUgaWQgPSAyOFxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCJcblxuZmFicmljLlBlbmNpbEJydXNoLnByb3RvdHlwZS5pbml0aWFsaXplID0gZnVuY3Rpb24oY2FudmFzKSB7XG4gIHRoaXMuY2FsbFN1cGVyKCdpbml0aWFsaXplJywgY2FudmFzKTtcbiAgdGhpcy5fcG9pbnRzID0gWyBdO1xufTtcbmZhYnJpYy5QZW5jaWxCcnVzaC5wcm90b3R5cGUudHlwZSA9ICdwZW5jaWwtYnJ1c2gnO1xuXG5mYWJyaWMuUGVuY2lsQnJ1c2gucHJvdG90eXBlLl9yZW5kZXIgPSBmdW5jdGlvbigpIHtcbiAgdmFyIGN0eCAgPSB0aGlzLmNhbnZhcy5jb250ZXh0VG9wLCB2ID0gdGhpcy5jYW52YXMudmlld3BvcnRUcmFuc2Zvcm0sIHAxID0gdGhpcy5fcG9pbnRzWzBdLCBwMiA9IHRoaXMuX3BvaW50c1sxXTtcbiAgY3R4LnNhdmUoKTtcbiAgY3R4LnRyYW5zZm9ybSh2WzBdLCB2WzFdLCB2WzJdLCB2WzNdLCB2WzRdLCB2WzVdKTtcbiAgY3R4LmJlZ2luUGF0aCgpO1xuICBjdHgubGluZVdpZHRoID0gMSAvIHRoaXMuY2FudmFzLnZpZXdwb3J0VHJhbnNmb3JtWzBdO1xuICBpZiAodGhpcy5fcG9pbnRzLmxlbmd0aCA9PT0gMiAmJiBwMS54ID09PSBwMi54ICYmIHAxLnkgPT09IHAyLnkpIHtcbiAgICBwMS54IC09IDAuNSAvIHRoaXMuY2FudmFzLnZpZXdwb3J0VHJhbnNmb3JtWzBdO1xuICAgIHAyLnggKz0gMC41IC8gdGhpcy5jYW52YXMudmlld3BvcnRUcmFuc2Zvcm1bMF07XG4gIH1cbiAgY3R4Lm1vdmVUbyhwMS54LCBwMS55KTtcbiAgZm9yICh2YXIgaSA9IDEsIGxlbiA9IHRoaXMuX3BvaW50cy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgIHZhciBtaWRQb2ludCA9IHAxLm1pZFBvaW50RnJvbShwMik7XG4gICAgY3R4LnF1YWRyYXRpY0N1cnZlVG8ocDEueCwgcDEueSwgbWlkUG9pbnQueCwgbWlkUG9pbnQueSk7XG4gICAgcDEgPSB0aGlzLl9wb2ludHNbaV07XG4gICAgcDIgPSB0aGlzLl9wb2ludHNbaSArIDFdO1xuICB9XG4gIGN0eC5saW5lVG8ocDEueCwgcDEueSk7XG4gIGN0eC5zdHJva2UoKTtcbiAgY3R4LnJlc3RvcmUoKTtcbn07XG5cbmZhYnJpYy5QZW5jaWxCcnVzaC5wcm90b3R5cGUuY3JlYXRlUGF0aCA9IGZ1bmN0aW9uKHBhdGhEYXRhKSB7XG4gIHZhciBwYXRoID0gbmV3IGZhYnJpYy5QYXRoKHBhdGhEYXRhLCB7XG4gICAgc3Ryb2tlOiB0aGlzLmdldENvbG9yKCksXG4gICAgc3Ryb2tlV2lkdGg6IHRoaXMud2lkdGgsXG4gICAgYXBwbGljYXRpb246IHRoaXMuY2FudmFzLmFwcGxpY2F0aW9uXG4gIH0pO1xuICBpZiAodGhpcy5zaGFkb3cpIHtcbiAgICB0aGlzLnNoYWRvdy5hZmZlY3RTdHJva2UgPSB0cnVlO1xuICAgIHBhdGguc2V0U2hhZG93KHRoaXMuc2hhZG93KTtcbiAgfVxuICByZXR1cm4gcGF0aDtcbn07XG5mYWJyaWMuUGVuY2lsQnJ1c2gucHJvdG90eXBlLm1pbkxlbmd0aCA9IDM7XG5cbmZhYnJpYy5QZW5jaWxCcnVzaC5wcm90b3R5cGUuYWNjdXJhY3kgPSAwO1xuZmFicmljLlBlbmNpbEJydXNoLnByb3RvdHlwZS5fZmluYWxpemVBbmRBZGRQYXRoID0gZnVuY3Rpb24oKSB7XG4gIGlmKHRoaXMuX3BvaW50cy5sZW5ndGggPCAyKXJldHVybjtcbiAgdmFyIGN0eCA9IHRoaXMuY2FudmFzLmNvbnRleHRUb3A7XG4gIGN0eC5jbG9zZVBhdGgoKTtcbiAgdGhpcy5jYW52YXMuY2xlYXJDb250ZXh0KHRoaXMuY2FudmFzLmNvbnRleHRUb3ApO1xuICBpZih0aGlzLmFjY3VyYWN5KXtcbiAgICBmb3IodmFyIGkgaW4gdGhpcy5fcG9pbnRzKXtcbiAgICAgIHRoaXMuX3BvaW50c1tpXS54ID0gK3RoaXMuX3BvaW50c1tpXS54LnRvRml4ZWQodGhpcy5hY2N1cmFjeSk7XG4gICAgICB0aGlzLl9wb2ludHNbaV0ueSA9ICt0aGlzLl9wb2ludHNbaV0ueS50b0ZpeGVkKHRoaXMuYWNjdXJhY3kpO1xuICAgIH1cbiAgICBmb3IoaSA9IHRoaXMuX3BvaW50cy5sZW5ndGggLSAxOyBpLS07ICl7XG4gICAgICBpZih0aGlzLl9wb2ludHNbaV0ueCA9PSB0aGlzLl9wb2ludHNbaSArIDFdLnggJiYgIHRoaXMuX3BvaW50c1tpXS55ID09IHRoaXMuX3BvaW50c1tpICsgMV0ueSl7XG4gICAgICAgIHRoaXMuX3BvaW50cy5zcGxpY2UoaSwxKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgaWYodGhpcy5fcG9pbnRzLmxlbmd0aCA8IDIpcmV0dXJuO1xuICB2YXIgcGF0aERhdGEgPSB0aGlzLmNvbnZlcnRQb2ludHNUb1NWR1BhdGgodGhpcy5fcG9pbnRzKS5qb2luKCcnKTtcbiAgaWYgKHRoaXMuX3BvaW50cy5sZW5ndGggPCB0aGlzLm1pbkxlbmd0aCB8fCBwYXRoRGF0YSA9PT0gJ00gMCAwIFEgMCAwIDAgMCBMIDAgMCcpIHtcbiAgICByZXR1cm4gdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gIH1cbiAgdmFyIHBhdGggPSB0aGlzLmNyZWF0ZVBhdGgocGF0aERhdGEpO1xuICB0aGlzLmNhbnZhcy5hZGQocGF0aCk7XG4gIHBhdGguc2V0Q29vcmRzKCk7XG4gIHRoaXMuX3Jlc2V0U2hhZG93KCk7XG4gIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICB0aGlzLmNhbnZhcy5maXJlKCdwYXRoOmNyZWF0ZWQnLCB7IHBhdGg6IHBhdGggfSk7XG59O1xuXG5cbmZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUuZHJhd2luZ1Rvb2xzLlBlbmNpbEJydXNoID0ge1xuICBjbGFzc05hbWU6ICdmYSBmYS1wZW5jaWwnLFxuICB0aXRsZTogJ1BlbmNpbCBCcnVzaCdcbn07XG5mYWJyaWMuU2xpZGVDYW52YXMucHJvdG90eXBlLmFjdGl2ZURyYXdpbmdUb29scy5wdXNoKFwiUGVuY2lsQnJ1c2hcIik7XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL2JydXNoZXMvUGVuY2lsQnJ1c2guanNcbi8vIG1vZHVsZSBpZCA9IDI5XG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIid1c2Ugc3RyaWN0JztcblxuZmFicmljLlBvaW50c0JydXNoID0gZmFicmljLnV0aWwuY3JlYXRlQ2xhc3MoZmFicmljLkJhc2VCcnVzaCwge1xuICB0eXBlOiBcInBvaW50cy1icnVzaFwiLFxuICBtYXhpbXVtUG9pbnRzIDogMCxcbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKGNhbnZhcykge1xuICAgIHRoaXMuY2FsbFN1cGVyKCdpbml0aWFsaXplJywgY2FudmFzKTtcbiAgICB0aGlzLnJlc2V0KCk7XG4gIH0sXG4gIGN1cnJlbnRQb2ludCA6IDEsXG4gIGdldFBvaW50czogZnVuY3Rpb24oKXtcbiAgICByZXR1cm4gZmFicmljLnV0aWwub2JqZWN0LndoZXJlKHRoaXMuY2FudmFzLl9vYmplY3RzLHt0eXBlOiBcIm1hdGVyaWFsLXBvaW50XCJ9KTtcbiAgfSxcbiAgY2hlY2tQb3NpdGlvbjogbnVsbCxcbiAgb25Nb3VzZURvd246IGZ1bmN0aW9uIChwb2ludGVyKSB7XG5cbiAgfSxcbiAgb25Nb3VzZU1vdmU6IGZ1bmN0aW9uIChwb2ludGVyKSB7XG4gIH0sXG4gIHJlc2V0OiBmdW5jdGlvbigpe1xuICB9LFxuICBvbk1vdXNlVXA6IGZ1bmN0aW9uIChwb2ludGVyKSB7XG4gICAgdmFyIF9wb2ludHMgPSB0aGlzLmdldFBvaW50cygpO1xuXG4gICAgdmFyIHBvcyA9IHtcbiAgICAgIGxlZnQ6IHBvaW50ZXIueCAtMC41LFxuICAgICAgdG9wOiBwb2ludGVyLnkgIC0wLjUsXG4gICAgfTtcblxuICAgIHZhciBfY29ycmVjdCA9IHRoaXMuY2hlY2tQb3NpdGlvbiA/IHRoaXMuY2hlY2tQb3NpdGlvbihwb2ludGVyKSA6IHRydWUgO1xuXG4gICAgaWYoIV9jb3JyZWN0KXtcbiAgICAgIHRoaXMuY2FudmFzLmZpcmUoXCJwb2ludDpyZWplY3RlZFwiLHtwb2ludCA6IHBvaW50ZXJ9KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZih0aGlzLm1heGltdW1Qb2ludHMgJiYgX3BvaW50cy5sZW5ndGggPj0gdGhpcy5tYXhpbXVtUG9pbnRzKXtcbiAgICAgIGlmKHRoaXMuY3VycmVudFBvaW50ID4gdGhpcy5tYXhpbXVtUG9pbnRzKXtcbiAgICAgICAgdGhpcy5jdXJyZW50UG9pbnQgPSAxO1xuICAgICAgfVxuICAgICAgaWYodGhpcy53aG9sZUNvb3JkaW5hdGVzKXtcbiAgICAgICAgcG9pbnRlci54ID0gTWF0aC5yb3VuZChwb2ludGVyLngpICsgMC41O1xuICAgICAgICBwb2ludGVyLnkgPSBNYXRoLnJvdW5kKHBvaW50ZXIueSkgICsgMC41O1xuICAgICAgfVxuXG4gICAgICB2YXIgX29iaiA9IGZhYnJpYy51dGlsLm9iamVjdC5maW5kV2hlcmUoX3BvaW50cyx7bnVtYmVyIDogdGhpcy5jdXJyZW50UG9pbnQrK30pO1xuXG4gICAgICB2YXIgc3RhdGVzID0ge1xuICAgICAgICBvcmlnaW5hbCA6IHtcbiAgICAgICAgICBsZWZ0OiBfb2JqLmxlZnQsXG4gICAgICAgICAgdG9wOiBfb2JqLnRvcFxuICAgICAgICB9LFxuICAgICAgICBtb2RpZmllZDogIHtcbiAgICAgICAgICBsZWZ0OiBwb2ludGVyLnggLSAwLjUsXG4gICAgICAgICAgdG9wOiBwb2ludGVyLnkgLSAwLjVcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgX29iai5zZXQoc3RhdGVzLm1vZGlmaWVkKS5zZXRDb29yZHMoKS5maXJlKFwibW9kaWZpZWRcIix7c3RhdGVzOiBzdGF0ZXN9KTtcbiAgICAgIHRoaXMuY2FudmFzLmZpcmUoXCJvYmplY3Q6bW9kaWZpZWRcIix7dGFyZ2V0IDogX29iaiwgc3RhdGVzOiBzdGF0ZXN9KTtcbiAgICAgIHRoaXMuY2FudmFzLnNldEFjdGl2ZU9iamVjdChfb2JqKTtcbiAgICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgICAgcmV0dXJuO1xuICAgIH1lbHNle1xuICAgICAgdGhpcy5jdXJyZW50UG9pbnQgPSAxO1xuICAgICAgd2hpbGUoZmFicmljLnV0aWwub2JqZWN0LmZpbmRXaGVyZShfcG9pbnRzLHtudW1iZXIgOiB0aGlzLmN1cnJlbnRQb2ludH0pKXtcbiAgICAgICAgdGhpcy5jdXJyZW50UG9pbnQrKztcbiAgICAgIH1cbiAgICB9XG5cbiAgICB2YXIgX29iaiA9IG5ldyBmYWJyaWMuTWF0ZXJpYWxQb2ludCh7XG4gICAgICBudW1iZXI6IHRoaXMuY3VycmVudFBvaW50ICxcbiAgICAgIGFwcGxpY2F0aW9uOiB0aGlzLmNhbnZhcy5hcHBsaWNhdGlvbixcbiAgICAgIGxlZnQ6IHBvcy5sZWZ0LFxuICAgICAgdG9wOiBwb3MudG9wXG4gICAgfSk7XG5cbiAgICB0aGlzLmN1cnJlbnRQb2ludCsrO1xuICAgIHRoaXMuY2FudmFzLmFkZChfb2JqKTtcbiAgICB0aGlzLmNhbnZhcy5maXJlKFwicG9pbnQ6Y3JlYXRlZFwiLHtwb2ludCA6IF9vYmp9KVxuICAgIHRoaXMuY2FudmFzLnNldEFjdGl2ZU9iamVjdChfb2JqKTtcbiAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgfSxcbiAgX3JlbmRlcjogZnVuY3Rpb24gKCkge1xuICB9XG59KTtcblxuZmFicmljLlNsaWRlQ2FudmFzLnByb3RvdHlwZS5kcmF3aW5nVG9vbHMuUG9pbnRzQnJ1c2ggPSB7XG4gIGNsYXNzTmFtZTogJ2ZhIGZhLWNpcmNsZS1vJyxcbiAgdGl0bGU6ICdQb2ludHMgQnJ1c2gnXG59O1xuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9icnVzaGVzL1BvaW50c0JydXNoLmpzXG4vLyBtb2R1bGUgaWQgPSAzMFxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCIndXNlIHN0cmljdCc7XG5cblxuICAvKipcbiAgICogUGVuY2lsQnJ1c2ggY2xhc3NcbiAgICogQGNsYXNzIGZhYnJpYy5SZWN0YW5nbGVCcnVzaFxuICAgKiBAZXh0ZW5kcyBmYWJyaWMuQmFzZUJydXNoXG4gICAqL1xuICBmYWJyaWMuUG9seWdvbkJydXNoID0gZmFicmljLnV0aWwuY3JlYXRlQ2xhc3MoZmFicmljLkJhc2VCcnVzaCwgLyoqIEBsZW5kcyBmYWJyaWMuUmVjdGFuZ2xlQnJ1c2gucHJvdG90eXBlICovIHtcbiAgICByZXN1bHRPYmplY3RUeXBlOiBcIlBvbHlsaW5lXCIsXG4gICAgdHlwZTogXCJwb2x5Z29uLWJydXNoXCIsXG4gICAgdmlydHVhbE9iamVjdDogZmFsc2UsXG4gICAgbWF4aW11bVBvaW50cyA6IDAsXG4gICAgaW5kaXZpZHVhbERyYXdpbmc6IHRydWUsXG4gICAgLyoqXG4gICAgICogQ29uc3RydWN0b3JcbiAgICAgKiBAcGFyYW0ge2ZhYnJpYy5DYW52YXN9IGNhbnZhc1xuICAgICAqIEByZXR1cm4ge2ZhYnJpYy5SZWN0YW5nbGVCcnVzaH0gSW5zdGFuY2Ugb2YgYSBwZW5jaWwgYnJ1c2hcbiAgICAgKi9cbiAgICBpbml0aWFsaXplOiBmdW5jdGlvbiAoY2FudmFzKSB7XG4gICAgICB0aGlzLmNhbGxTdXBlcignaW5pdGlhbGl6ZScsIGNhbnZhcyk7XG4gICAgICB0aGlzLnJlc2V0KCk7XG4gICAgfSxcbiAgICAvKipcbiAgICAgKiBJbm92b2tlZCBvbiBtb3VzZSBkb3duXG4gICAgICogQHBhcmFtIHtPYmplY3R9IHBvaW50ZXJcbiAgICAgKi9cbiAgICBvbk1vdXNlRG93bjogZnVuY3Rpb24gKHBvaW50ZXIpIHtcblxuXG4gICAgICBpZih0aGlzLmluZGl2aWR1YWxEcmF3aW5nIHx8ICF0aGlzLnRhcmdldCl7XG4gICAgICAgIHZhciBfcG9pbnQgPSB7eDogcG9pbnRlci54LCB5OiBwb2ludGVyLnl9O1xuICAgICAgICB0aGlzLnBvaW50cy5wdXNoKF9wb2ludCk7XG4gICAgICAgIGlmKCF0aGlzLnZpcnR1YWxPYmplY3Qpe1xuICAgICAgICAgIHRoaXMudGFyZ2V0ID0gdGhpcy5jYW52YXMuY3JlYXRlT2JqZWN0KFxuICAgICAgICAgICAgZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCh7fSxcbiAgICAgICAgICAgICAgdGhpcy5yZXN1bHRPYmplY3RQcm9wZXJ0aWVzLCB7XG4gICAgICAgICAgICAgICAgdHlwZTogdGhpcy5yZXN1bHRPYmplY3RUeXBlLFxuICAgICAgICAgICAgICAgIHBvaW50czogW19wb2ludF0sXG4gICAgICAgICAgICAgICAgYWN0aXZlOiB0cnVlXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIClcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9ZWxzZXtcbiAgICAgICAgdGhpcy5fY3JlYXRlX2FjdGl2ZV9wb2ludChwb2ludGVyKTtcbiAgICAgIH1cblxuICAgICAgaWYodGhpcy52aXJ0dWFsT2JqZWN0KSB7XG4gICAgICAgIHRoaXMuX3NldEJydXNoU3R5bGVzKCk7XG4gICAgICAgIHRoaXMuX3NldFNoYWRvdygpO1xuICAgICAgICB0aGlzLl9yZW5kZXIoKTtcbiAgICAgIH1lbHNle1xuICAgICAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgX2NyZWF0ZV9hY3RpdmVfcG9pbnQ6IGZ1bmN0aW9uIChwb2ludGVyKSB7XG4gICAgICB2YXIgX3BvaW50ID0ge3g6IHBvaW50ZXIueCwgeTogcG9pbnRlci55fTtcbiAgICAgIHRoaXMuYWN0aXZlUG9pbnQgPSAgX3BvaW50O1xuICAgICAgdGhpcy5hY3RpdmVUYXJnZXRQb2ludCA9ICB7eDogcG9pbnRlci54IC0gdGhpcy50YXJnZXQubGVmdCwgeSA6IHBvaW50ZXIueSAtIHRoaXMudGFyZ2V0LnRvcH07XG4gICAgICB0aGlzLnBvaW50cy5wdXNoKHRoaXMuYWN0aXZlUG9pbnQpO1xuICAgICAgdGhpcy50YXJnZXQuYWRkUG9pbnQodGhpcy5hY3RpdmVUYXJnZXRQb2ludCk7XG4gICAgfSxcbiAgICAvKipcbiAgICAgKiBJbm92b2tlZCBvbiBtb3VzZSBtb3ZlXG4gICAgICogQHBhcmFtIHtPYmplY3R9IHBvaW50ZXJcbiAgICAgKi9cbiAgICBvbk1vdXNlTW92ZTogZnVuY3Rpb24gKHBvaW50ZXIpIHtcblxuXG4gICAgICB2YXIgX3AgPSAge3g6IHBvaW50ZXIueCAtIHRoaXMudGFyZ2V0LmxlZnQsIHkgOiBwb2ludGVyLnkgLSB0aGlzLnRhcmdldC50b3B9O1xuXG5cbiAgICAgIGlmKHRoaXMuYWN0aXZlUG9pbnQpe1xuICAgICAgICB0aGlzLmFjdGl2ZVBvaW50LnggPSBwb2ludGVyLng7XG4gICAgICAgIHRoaXMuYWN0aXZlUG9pbnQueSA9IHBvaW50ZXIueTtcbiAgICAgICAgdmFyIF9vcmRlciA9IHRoaXMudGFyZ2V0LnBvaW50cy5sZW5ndGggO1xuXG4gICAgICAgIHRoaXMudGFyZ2V0LnNldFBvaW50KFwicFwiICsgX29yZGVyLCB7XG4gICAgICAgICAgeCA6IHBvaW50ZXIueCAtIHRoaXMudGFyZ2V0LmxlZnQsXG4gICAgICAgICAgeSA6IHBvaW50ZXIueSAtIHRoaXMudGFyZ2V0LnRvcFxuICAgICAgICB9KTtcbiAgICAgIH1lbHNle1xuICAgICAgICB2YXIgX2Rpc3QgPSBmYWJyaWMuUG9pbnQucHJvdG90eXBlLmRpc3RhbmNlRnJvbS5jYWxsKHRoaXMucG9pbnRzWzBdLF9wKVxuICAgICAgICBpZihfZGlzdCA+IDEwKXtcbiAgICAgICAgICB0aGlzLl9jcmVhdGVfYWN0aXZlX3BvaW50KHBvaW50ZXIpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICB9LFxuICAgIHJlc2V0OiBmdW5jdGlvbigpe1xuICAgICAgdGhpcy5wb2ludHMgPSBbXTtcbiAgICAgIHRoaXMudGFyZ2V0ID0gbnVsbDtcbiAgICAgIHRoaXMuYWN0aXZlUG9pbnQgPSBudWxsO1xuICAgICAgdGhpcy5hY3RpdmVUYXJnZXRQb2ludCA9IG51bGw7XG4gICAgfSxcbiAgICAvKipcbiAgICAgKiBJbnZva2VkIG9uIG1vdXNlIHVwXG4gICAgICovXG4gICAgb25Nb3VzZVVwOiBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLnRhcmdldC51cGRhdGVCYm94KCk7XG4gICAgICBpZih0aGlzLnBvaW50cy5sZW5ndGggPT0gdGhpcy5tYXhpbXVtUG9pbnRzKXtcbiAgICAgICAgdGhpcy5yZXNldCgpO1xuICAgICAgfVxuICAgICAgdGhpcy5hY3RpdmVQb2ludCA9IG51bGw7XG4gICAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogRHJhdyBhIHNtb290aCBwYXRoIG9uIHRoZSB0b3BDYW52YXMgdXNpbmcgcXVhZHJhdGljQ3VydmVUb1xuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX3JlbmRlcjogZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5jYW52YXMuZmlyZShcImJlZm9yZTpicnVzaDpyZW5kZXJcIix7dGFyZ2V0OiB0aGlzfSk7XG5cbiAgICAgIHZhciBjdHggPSB0aGlzLmNhbnZhcy5jb250ZXh0VG9wLFxuICAgICAgICB2ID0gdGhpcy5jYW52YXMudmlld3BvcnRUcmFuc2Zvcm07XG5cbiAgICAgIGN0eC5zYXZlKCk7XG4gICAgICBjdHgudHJhbnNmb3JtKHZbMF0sIHZbMV0sIHZbMl0sIHZbM10sIHZbNF0sIHZbNV0pO1xuXG4gICAgICB2YXIgX2tsYXNzX3Byb3RvID0gZmFicmljW3RoaXMucmVzdWx0T2JqZWN0VHlwZV0ucHJvdG90eXBlO1xuXG4gICAgICBjdHgubGluZVdpZHRoID0gX2tsYXNzX3Byb3RvLnN0cm9rZVdpZHRoO1xuICAgICAgY3R4LnN0cm9rZVN0eWxlID0gX2tsYXNzX3Byb3RvLnN0cm9rZTtcbiAgICAgIGN0eC5maWxsU3R5bGUgPSBfa2xhc3NfcHJvdG8uZmlsbDtcblxuICAgICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgICAgY3R4Lm1vdmVUbyh0aGlzLnBvaW50c1swXS54LHRoaXMucG9pbnRzWzBdLnkpO1xuICAgICAgZm9yKHZhciBpID0gMTsgaSA8IHRoaXMucG9pbnRzLmxlbmd0aDsgaSsrKXtcbiAgICAgICAgY3R4LmxpbmVUbyh0aGlzLnBvaW50c1tpXS54LHRoaXMucG9pbnRzW2ldLnkpXG4gICAgICB9XG4gICAgICBjdHguY2xvc2VQYXRoKCk7XG4gICAgICBjdHguZmlsbCgpO1xuICAgICAgY3R4LnN0cm9rZSgpO1xuICAgICAgY3R4LnJlc3RvcmUoKTtcbiAgICAgIHRoaXMuY2FudmFzLmZpcmUoXCJicnVzaDpyZW5kZXJcIix7dGFyZ2V0OiB0aGlzfSlcbiAgICB9LFxuICAgIGRyYXdpbmdMaW1pdHM6IG51bGwsIC8qe1xuICAgICAgbGVmdDogMCxcbiAgICAgIHdpZHRoOiAwLFxuICAgICAgaGVpZ2h0OiAwLFxuICAgICAgdG9wOiAwXG4gICAgfSwqL1xuICAgIG1pbkhlaWdodDogNTAsXG4gICAgbWluV2lkdGg6IDUwLFxuICAgIF9jaGVja1JlY3RhbmdsZTogZnVuY3Rpb24oX3JlY3Qpe1xuXG5cbiAgICAgIHZhciBkbCA9IHRoaXMuZHJhd2luZ0xpbWl0cztcbiAgICAgIGlmKGRsICYmIGRsID09IFwiYmFja2dyb3VuZEltYWdlXCIpe1xuICAgICAgICBkbD0gdGhpcy5jYW52YXMuYmFja2dyb3VuZEltYWdlO1xuICAgICAgfVxuXG4gICAgICBfcmVjdCA9IHtcbiAgICAgICAgbGVmdDogX3JlY3QubGVmdCxcbiAgICAgICAgdG9wOiBfcmVjdC50b3AsXG4gICAgICAgIHdpZHRoOiBfcmVjdC53aWR0aCxcbiAgICAgICAgaGVpZ2h0OiBfcmVjdC5oZWlnaHQsXG4gICAgICB9O1xuXG4gICAgICBfcmVjdC5sZWZ0ICAtPSBmYWJyaWMuUmVjdC5wcm90b3R5cGUuc3Ryb2tlV2lkdGggLyAyO1xuICAgICAgX3JlY3QudG9wICAgLT0gZmFicmljLlJlY3QucHJvdG90eXBlLnN0cm9rZVdpZHRoIC8gMjtcblxuICAgICAgaWYoZGwpe1xuICAgICAgICBpZihfcmVjdC5sZWZ0ICsgX3JlY3Qud2lkdGggPCBkbC5sZWZ0IHx8XG4gICAgICAgICAgX3JlY3QudG9wICArIF9yZWN0LmhlaWdodCA8IGRsLnRvcCB8fFxuICAgICAgICAgIF9yZWN0LmxlZnQgPiBkbC53aWR0aCB8fFxuICAgICAgICAgIF9yZWN0LnRvcCA+IGRsLmhlaWdodCl7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYoX3JlY3QudG9wIDwgZGwudG9wKXtcbiAgICAgICAgICBfcmVjdC5oZWlnaHQgKz1fcmVjdC50b3AgO1xuICAgICAgICAgIF9yZWN0LnRvcCA9IGRsLnRvcDtcbiAgICAgICAgfVxuICAgICAgICBpZihfcmVjdC5sZWZ0IDwgZGwubGVmdCl7XG4gICAgICAgICAgX3JlY3Qud2lkdGggKz0gX3JlY3QubGVmdDtcbiAgICAgICAgICBfcmVjdC5sZWZ0ID0gZGwubGVmdDtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZih0aGlzLm1pbldpZHRoICYmIF9yZWN0LndpZHRoIDwgdGhpcy5taW5XaWR0aCl7XG4gICAgICAgIF9yZWN0LndpZHRoID0gdGhpcy5taW5XaWR0aDtcbiAgICAgIH1cbiAgICAgIGlmKHRoaXMubWluSGVpZ2h0ICYmIF9yZWN0LmhlaWdodCA8IHRoaXMubWluSGVpZ2h0KXtcbiAgICAgICAgX3JlY3QuaGVpZ2h0ID0gdGhpcy5taW5IZWlnaHQ7XG4gICAgICB9XG5cblxuICAgICAgaWYoZGwpIHtcbiAgICAgICAgdmFyIF94ZGlmZiA9IF9yZWN0LmxlZnQgKyBfcmVjdC53aWR0aCAtIGRsLndpZHRoO1xuICAgICAgICBpZiAoX3hkaWZmID4gMCkge1xuICAgICAgICAgIF9yZWN0LndpZHRoIC09IF94ZGlmZjtcbiAgICAgICAgICBpZiAodGhpcy5taW5XaWR0aCAmJiBfcmVjdC53aWR0aCA8IHRoaXMubWluV2lkdGgpIHtcbiAgICAgICAgICAgIF9yZWN0LmxlZnQgLT0gdGhpcy5taW5XaWR0aCAtIF9yZWN0LndpZHRoO1xuICAgICAgICAgICAgX3JlY3Qud2lkdGggPSB0aGlzLm1pbldpZHRoO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB2YXIgX3lkaWZmID0gX3JlY3QudG9wICsgX3JlY3QuaGVpZ2h0IC0gZGwuaGVpZ2h0O1xuICAgICAgICBpZiAoX3lkaWZmID4gMCkge1xuICAgICAgICAgIF9yZWN0LmhlaWdodCAtPSBfeWRpZmY7XG4gICAgICAgICAgaWYgKHRoaXMubWluSGVpZ2h0ICYmIF9yZWN0LmhlaWdodCA8IHRoaXMubWluSGVpZ2h0KSB7XG4gICAgICAgICAgICBfcmVjdC50b3AgLT0gdGhpcy5taW5IZWlnaHQgLSBfcmVjdC5oZWlnaHQ7XG4gICAgICAgICAgICBfcmVjdC5oZWlnaHQgPSB0aGlzLm1pbkhlaWdodDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBfcmVjdDtcbiAgICB9LFxuICAgIHJlc3VsdE9iamVjdFByb3BlcnRpZXM6IHt9XG4gIH0pO1xuXG5cbmZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUuZHJhd2luZ1Rvb2xzLlBvbHlnb25CcnVzaCA9IHtcbiAgaWNvbjogJ2RhdGE6aW1hZ2UvcG5nO2Jhc2U2NCwnKyByZXF1aXJlKCdiYXNlNjQtbG9hZGVyIS4vLi4vbWVkaWEvcG9seWdvbi5wbmcnKSxcbiAgdGl0bGU6ICdQb2x5Z29uIEJydXNoJ1xufTtcbmZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUuYWN0aXZlRHJhd2luZ1Rvb2xzLnB1c2goXCJQb2x5Z29uQnJ1c2hcIik7XG5cblxuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9icnVzaGVzL1BvbHlnb25CcnVzaC5qc1xuLy8gbW9kdWxlIGlkID0gMzFcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiJ3VzZSBzdHJpY3QnO1xuXG5cbi8qKlxuICogUGVuY2lsQnJ1c2ggY2xhc3NcbiAqIEBjbGFzcyBmYWJyaWMuUmVjdGFuZ2xlQnJ1c2hcbiAqIEBleHRlbmRzIGZhYnJpYy5CYXNlQnJ1c2hcbiAqL1xuZmFicmljLlJlY3RhbmdsZUJydXNoID0gZmFicmljLnV0aWwuY3JlYXRlQ2xhc3MoZmFicmljLkJhc2VCcnVzaCwgLyoqIEBsZW5kcyBmYWJyaWMuUmVjdGFuZ2xlQnJ1c2gucHJvdG90eXBlICovIHtcbiAgcmVzdWx0T2JqZWN0VHlwZTogXCJSZWN0XCIsXG4gIHR5cGU6IFwicmVjdGFuZ2xlLWJydXNoXCIsXG4gIC8qKlxuICAgKiBDb25zdHJ1Y3RvclxuICAgKiBAcGFyYW0ge2ZhYnJpYy5DYW52YXN9IGNhbnZhc1xuICAgKiBAcmV0dXJuIHtmYWJyaWMuUmVjdGFuZ2xlQnJ1c2h9IEluc3RhbmNlIG9mIGEgcGVuY2lsIGJydXNoXG4gICAqL1xuICBpbml0aWFsaXplOiBmdW5jdGlvbiAoY2FudmFzKSB7XG4gICAgdGhpcy5jYWxsU3VwZXIoJ2luaXRpYWxpemUnLCBjYW52YXMpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBJbm92b2tlZCBvbiBtb3VzZSBkb3duXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBwb2ludGVyXG4gICAqL1xuICBvbk1vdXNlRG93bjogZnVuY3Rpb24gKHBvaW50ZXIpIHtcbiAgICAvL3ByZXBhcmUgZm9yIGRyYXdpbmdcbiAgICBkZWxldGUgdGhpcy5wMjtcblxuICAgIHRoaXMucDEgPSBuZXcgZmFicmljLlBvaW50KHBvaW50ZXIueCwgcG9pbnRlci55KTtcbiAgICB0aGlzLl9zZXRCcnVzaFN0eWxlcygpO1xuICAgIHRoaXMuX3NldFNoYWRvdygpO1xuICAgIHRoaXMuY2FudmFzLmNvbnRleHRUb3AubW92ZVRvKHRoaXMucDEueCwgdGhpcy5wMS55KTtcbiAgICB0aGlzLl9yZW5kZXIoKTtcbiAgfSxcblxuICAvKipcbiAgICogSW5vdm9rZWQgb24gbW91c2UgbW92ZVxuICAgKiBAcGFyYW0ge09iamVjdH0gcG9pbnRlclxuICAgKi9cbiAgb25Nb3VzZU1vdmU6IGZ1bmN0aW9uIChwb2ludGVyKSB7XG5cbiAgICB0aGlzLnAyID0gbmV3IGZhYnJpYy5Qb2ludChwb2ludGVyLngsIHBvaW50ZXIueSk7XG5cbiAgICBpZih0aGlzLmRyYXdpbmdPYmplY3Qpe1xuICAgICAgdmFyIF9yZWN0ID0gdGhpcy5fZ2V0UmVjdCgpO1xuICAgICAgdGhpcy5kcmF3aW5nT2JqZWN0LnNldChfcmVjdCk7XG4gICAgICB0aGlzLmRyYXdpbmdPYmplY3QuZmlyZShcInNjYWxpbmdcIik7XG4gICAgfWVsc2V7XG5cbiAgICAgIGlmICh0aGlzLnAxLnggPT09IHRoaXMucDIueCAmJiB0aGlzLnAxLnkgPT09IHRoaXMucDIueSkge1xuICAgICAgICBkZWxldGUgdGhpcy5wMjtcbiAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgaWYodGhpcy5yZXN1bHRPYmplY3RUeXBlKXtcbiAgICAgICAgICB2YXIgX3JlY3QgPSB0aGlzLl9nZXRSZWN0KCk7XG4gICAgICAgICAgdGhpcy5kcmF3aW5nT2JqZWN0ID0gdGhpcy5fY3JlYXRlUmVjdGFuZ2xlKF9yZWN0KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICB0aGlzLmNhbnZhcy5yZW5kZXJMYXllcihcImxvd2VyXCIpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBJbnZva2VkIG9uIG1vdXNlIHVwXG4gICAqL1xuICBvbk1vdXNlVXA6IGZ1bmN0aW9uICgpIHtcbiAgICBpZih0aGlzLmRyYXdpbmdPYmplY3Qpe1xuICAgICAgdmFyIF9yZWN0ID0gdGhpcy5fZ2V0UmVjdCgpO1xuICAgICAgdmFyIF9yZWN0MiA9IHRoaXMuX2NoZWNrUmVjdGFuZ2xlKF9yZWN0KTtcblxuICAgICAgdGhpcy5jYW52YXMubGF5ZXJzLmxvd2VyLm9iamVjdHMuc3BsaWNlKHRoaXMuY2FudmFzLmxheWVycy5sb3dlci5vYmplY3RzLmluZGV4T2YodGhpcy5kcmF3aW5nT2JqZWN0KSwgMSk7XG5cbiAgICAgIHRoaXMuZHJhd2luZ09iamVjdC5zZXQoX3JlY3QyKTtcbiAgICAgIHRoaXMuY2FudmFzLmFkZCh0aGlzLmRyYXdpbmdPYmplY3QpO1xuICAgICAgdGhpcy5jYW52YXMuc2V0QWN0aXZlT2JqZWN0KHRoaXMuZHJhd2luZ09iamVjdCk7XG4gICAgICB0aGlzLmRyYXdpbmdPYmplY3Quc2V0Q29vcmRzKCk7XG4gICAgICBkZWxldGUgdGhpcy5kcmF3aW5nT2JqZWN0O1xuICAgIH1cbiAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICAvLyB0aGlzLl9maW5hbGl6ZUFuZEFkZFBhdGgoKTtcbiAgfSxcblxuICAvKipcbiAgICogRHJhdyBhIHNtb290aCBwYXRoIG9uIHRoZSB0b3BDYW52YXMgdXNpbmcgcXVhZHJhdGljQ3VydmVUb1xuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgX3JlbmRlcjogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuY2FudmFzLmZpcmUoXCJiZWZvcmU6YnJ1c2g6cmVuZGVyXCIse3RhcmdldDogdGhpc30pXG4gICAgaWYgKCF0aGlzLnAyKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHZhciBjdHggPSB0aGlzLmNhbnZhcy5jb250ZXh0VG9wLFxuICAgICAgdiA9IHRoaXMuY2FudmFzLnZpZXdwb3J0VHJhbnNmb3JtLFxuICAgICAgcDEgPSB0aGlzLnAxLFxuICAgICAgcDIgPSB0aGlzLnAyO1xuXG4gICAgY3R4LnNhdmUoKTtcbiAgICBjdHgudHJhbnNmb3JtKHZbMF0sIHZbMV0sIHZbMl0sIHZbM10sIHZbNF0sIHZbNV0pO1xuICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICBpZih0aGlzLmFwcGxpY2F0aW9uKXtcbiAgICAgIHZhciBfa2xhc3NfcHJvdG8gPSB0aGlzLmFwcGxpY2F0aW9uLmdldERlZmF1bHRQcm9wZXJ0aWVzKGZhYnJpY1t0aGlzLnJlc3VsdE9iamVjdFR5cGVdLnByb3RvdHlwZSkgfHwge307XG4gICAgICBjdHgubGluZVdpZHRoID0gX2tsYXNzX3Byb3RvLnN0cm9rZVdpZHRoO1xuICAgICAgY3R4LnN0cm9rZVN0eWxlID0gX2tsYXNzX3Byb3RvLnN0cm9rZTtcbiAgICAgIGN0eC5maWxsU3R5bGUgPSBfa2xhc3NfcHJvdG8uZmlsbDtcbiAgICB9XG5cbiAgICB2YXIgX3JlY3QgPSB0aGlzLl9nZXRSZWN0KCk7XG4gICAgY3R4LnJlY3QoX3JlY3QubGVmdCwgX3JlY3QudG9wLCBfcmVjdC53aWR0aCwgX3JlY3QuaGVpZ2h0KTtcblxuICAgIGN0eC5maWxsKCk7XG4gICAgY3R4LnN0cm9rZSgpO1xuICAgIGN0eC5yZXN0b3JlKCk7XG4gICAgdGhpcy5jYW52YXMuZmlyZShcImJydXNoOnJlbmRlclwiLHt0YXJnZXQ6IHRoaXN9KVxuICB9LFxuICBfZ2V0UmVjdDogZnVuY3Rpb24gKCkge1xuXG4gICAgdmFyIHgxLCB4MiwgeTEsIHkyO1xuICAgIGlmICh0aGlzLnAxLnggPCB0aGlzLnAyLngpIHtcbiAgICAgIHgxID0gdGhpcy5wMS54LCB4MiA9IHRoaXMucDIueDtcbiAgICB9IGVsc2Uge1xuICAgICAgeDIgPSB0aGlzLnAxLngsIHgxID0gdGhpcy5wMi54O1xuICAgIH1cbiAgICBpZiAodGhpcy5wMS55IDwgdGhpcy5wMi55KSB7XG4gICAgICB5MSA9IHRoaXMucDEueSwgeTIgPSB0aGlzLnAyLnk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHkyID0gdGhpcy5wMS55LCB5MSA9IHRoaXMucDIueTtcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgIGxlZnQ6IHgxLFxuICAgICAgdG9wOiB5MSxcbiAgICAgIHdpZHRoOiB4MiAtIHgxLFxuICAgICAgaGVpZ2h0OiB5MiAtIHkxXG4gICAgfTtcbiAgfSxcbiAgZHJhd2luZ0xpbWl0czogbnVsbCwgLyp7XG4gICBsZWZ0OiAwLFxuICAgd2lkdGg6IDAsXG4gICBoZWlnaHQ6IDAsXG4gICB0b3A6IDBcbiAgIH0sKi9cbiAgbWluSGVpZ2h0OiA1MCxcbiAgbWluV2lkdGg6IDUwLFxuICBfY2hlY2tSZWN0YW5nbGU6IGZ1bmN0aW9uKF9yZWN0KXtcblxuXG4gICAgdmFyIGRsID0gdGhpcy5kcmF3aW5nTGltaXRzO1xuICAgIGlmKGRsICYmIGRsID09IFwiYmFja2dyb3VuZEltYWdlXCIpe1xuICAgICAgZGw9IHRoaXMuY2FudmFzLmJhY2tncm91bmRJbWFnZTtcbiAgICB9XG5cbiAgICBfcmVjdCA9IHtcbiAgICAgIGxlZnQ6IF9yZWN0LmxlZnQsXG4gICAgICB0b3A6IF9yZWN0LnRvcCxcbiAgICAgIHdpZHRoOiBfcmVjdC53aWR0aCxcbiAgICAgIGhlaWdodDogX3JlY3QuaGVpZ2h0LFxuICAgIH07XG5cbiAgICAvLyBfcmVjdC5sZWZ0ICAtPSBmYWJyaWMuUmVjdC5wcm90b3R5cGUuc3Ryb2tlV2lkdGggLyAyO1xuICAgIC8vIF9yZWN0LnRvcCAgIC09IGZhYnJpYy5SZWN0LnByb3RvdHlwZS5zdHJva2VXaWR0aCAvIDI7XG5cbiAgICBpZihkbCl7XG4gICAgICBpZihfcmVjdC5sZWZ0ICsgX3JlY3Qud2lkdGggPCBkbC5sZWZ0IHx8XG4gICAgICAgIF9yZWN0LnRvcCAgKyBfcmVjdC5oZWlnaHQgPCBkbC50b3AgfHxcbiAgICAgICAgX3JlY3QubGVmdCA+IGRsLndpZHRoIHx8XG4gICAgICAgIF9yZWN0LnRvcCA+IGRsLmhlaWdodCl7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgaWYoX3JlY3QudG9wIDwgZGwudG9wKXtcbiAgICAgICAgX3JlY3QuaGVpZ2h0ICs9X3JlY3QudG9wIDtcbiAgICAgICAgX3JlY3QudG9wID0gZGwudG9wO1xuICAgICAgfVxuICAgICAgaWYoX3JlY3QubGVmdCA8IGRsLmxlZnQpe1xuICAgICAgICBfcmVjdC53aWR0aCArPSBfcmVjdC5sZWZ0O1xuICAgICAgICBfcmVjdC5sZWZ0ID0gZGwubGVmdDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZih0aGlzLm1pbldpZHRoICYmIF9yZWN0LndpZHRoIDwgdGhpcy5taW5XaWR0aCl7XG4gICAgICBfcmVjdC53aWR0aCA9IHRoaXMubWluV2lkdGg7XG4gICAgfVxuICAgIGlmKHRoaXMubWluSGVpZ2h0ICYmIF9yZWN0LmhlaWdodCA8IHRoaXMubWluSGVpZ2h0KXtcbiAgICAgIF9yZWN0LmhlaWdodCA9IHRoaXMubWluSGVpZ2h0O1xuICAgIH1cblxuXG4gICAgaWYoZGwpIHtcbiAgICAgIHZhciBfeGRpZmYgPSBfcmVjdC5sZWZ0ICsgX3JlY3Qud2lkdGggLSBkbC53aWR0aDtcbiAgICAgIGlmIChfeGRpZmYgPiAwKSB7XG4gICAgICAgIF9yZWN0LndpZHRoIC09IF94ZGlmZjtcbiAgICAgICAgaWYgKHRoaXMubWluV2lkdGggJiYgX3JlY3Qud2lkdGggPCB0aGlzLm1pbldpZHRoKSB7XG4gICAgICAgICAgX3JlY3QubGVmdCAtPSB0aGlzLm1pbldpZHRoIC0gX3JlY3Qud2lkdGg7XG4gICAgICAgICAgX3JlY3Qud2lkdGggPSB0aGlzLm1pbldpZHRoO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICB2YXIgX3lkaWZmID0gX3JlY3QudG9wICsgX3JlY3QuaGVpZ2h0IC0gZGwuaGVpZ2h0O1xuICAgICAgaWYgKF95ZGlmZiA+IDApIHtcbiAgICAgICAgX3JlY3QuaGVpZ2h0IC09IF95ZGlmZjtcbiAgICAgICAgaWYgKHRoaXMubWluSGVpZ2h0ICYmIF9yZWN0LmhlaWdodCA8IHRoaXMubWluSGVpZ2h0KSB7XG4gICAgICAgICAgX3JlY3QudG9wIC09IHRoaXMubWluSGVpZ2h0IC0gX3JlY3QuaGVpZ2h0O1xuICAgICAgICAgIF9yZWN0LmhlaWdodCA9IHRoaXMubWluSGVpZ2h0O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBfcmVjdDtcbiAgfSxcbiAgX2NyZWF0ZVJlY3RhbmdsZTogZnVuY3Rpb24ocmVjdCl7XG4gICAgdGhpcy5jYW52YXMuc2V0QWN0aXZlT2JqZWN0KGZhbHNlKTtcbiAgICByZWN0LmFjdGl2ZSA9IHRydWU7XG4gICAgcmVjdC5hcHBsaWNhdGlvbiA9IHRoaXMuYXBwbGljYXRpb247XG4gICAgcmVjdC5jYW52YXMgPSB0aGlzLmNhbnZhcztcbiAgICB2YXIgX29iamVjdCA9IGZhYnJpYy51dGlsLmNyZWF0ZU9iamVjdCh0aGlzLnJlc3VsdE9iamVjdFR5cGUscmVjdCk7XG4gICAgdGhpcy5jYW52YXMubGF5ZXJzLmxvd2VyLm9iamVjdHMucHVzaChfb2JqZWN0KTtcbiAgICBfb2JqZWN0LnVwZGF0ZVJlc3BvbnNpdmVCb3JkZXIoKTtcbiAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICByZXR1cm4gX29iamVjdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBPbiBtb3VzZXVwIGFmdGVyIGRyYXdpbmcgdGhlIHBhdGggb24gY29udGV4dFRvcCBjYW52YXNcbiAgICogd2UgdXNlIHRoZSBwb2ludHMgY2FwdHVyZWQgdG8gY3JlYXRlIGFuIG5ldyBmYWJyaWMgcmVjdCBvYmplY3RcbiAgICogYW5kIGFkZCBpdCB0byB0aGUgZmFicmljIGNhbnZhcy5cbiAgICovXG4gIC8vIF9maW5hbGl6ZUFuZEFkZFBhdGg6IGZ1bmN0aW9uICgpIHtcbiAgLy9cbiAgLy8gICBpZiAoIXRoaXMucDIpIHtcbiAgLy8gICAgIHJldHVybiBmYWxzZTtcbiAgLy8gICB9XG4gIC8vICAgdmFyIGN0eCA9IHRoaXMuY2FudmFzLmNvbnRleHRUb3A7XG4gIC8vICAgY3R4LmNsb3NlUGF0aCgpO1xuICAvL1xuICAvL1xuICAvLyAgIHRoaXMuY2FudmFzLmNsZWFyQ29udGV4dCh0aGlzLmNhbnZhcy5jb250ZXh0VG9wKTtcbiAgLy8gICB0aGlzLl9yZXNldFNoYWRvdygpO1xuICAvL1xuICAvLyAgIC8vIHZhciBfcmVjdCA9IHRoaXMuX2dldFJlY3QoKTtcbiAgLy8gICB2YXIgX3JlY3QyID0gdGhpcy5fY2hlY2tSZWN0YW5nbGUoX3JlY3QpO1xuICAvLyAgIGlmKF9yZWN0Mil7XG4gIC8vICAgICAvLyBpZih0aGlzLnJlc3VsdE9iamVjdFR5cGUpe1xuICAvLyAgICAgLy8gICB0aGlzLl9jcmVhdGVSZWN0YW5nbGUoX3JlY3QyKTtcbiAgLy8gICAgIC8vIH1cbiAgLy8gICAgIHRoaXMuY2FudmFzLmZpcmUoJ3JlY3Q6Y3JlYXRlZCcsIHtyZWN0OiBfcmVjdDIsIG9yaWdpbmFsOiBfcmVjdH0pO1xuICAvLyAgIH1lbHNle1xuICAvLyAgICAgdGhpcy5jYW52YXMuZmlyZSgncmVjdDpyZWplY3RlZCcsIHtyZWN0OiBfcmVjdH0pO1xuICAvLyAgIH1cbiAgLy8gICB0aGlzLmNhbnZhcy5yZW5kZXJMYXllcih0aGlzLmxheWVycy5sb3dlcik7XG4gIC8vIH1cbn0pO1xuXG5cbmZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUuZHJhd2luZ1Rvb2xzLlJlY3RhbmdsZUJydXNoID0ge1xuICBjbGFzc05hbWU6ICdmYSBmYS1wZW5jaWwtc3F1YXJlJyxcbiAgdGl0bGU6ICdzZWxlY3QtYnJ1c2gnXG59O1xuZmFicmljLlNsaWRlQ2FudmFzLnByb3RvdHlwZS5hY3RpdmVEcmF3aW5nVG9vbHMucHVzaChcIlJlY3RhbmdsZUJydXNoXCIpO1xuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9icnVzaGVzL1JlY3RhbmdsZUJydXNoLmpzXG4vLyBtb2R1bGUgaWQgPSAzMlxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCIndXNlIHN0cmljdCc7XG5cblxuLyoqXG4gKiDQotC+0YfQutCwINC30LDQv9GD0YHQutCwINC/0YDQuNC70L7QttC10L3QuNGHXG4gKi9cbmZhYnJpYy5BcHBsaWNhdGlvbiA9IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgdGhpcy5pbml0KG9wdGlvbnMpO1xufTtcblxuZmFicmljLkFwcGxpY2F0aW9uLnByb3RvdHlwZSA9IGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoe30sZmFicmljLk9ic2VydmFibGUsZmFicmljLlBsdWdpbnNNaXhpbix7XG4gIGluaXQ6IGZ1bmN0aW9uKG9wdGlvbnMpe1xuXG4gICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG4gICAgdGhpcy5vcHRpb25zID0gIGZhYnJpYy51dGlsLm9iamVjdC5jbG9uZShvcHRpb25zKTtcbiAgICBpZih0aGlzLm9wdGlvbnMuY2FsbGJhY2spe1xuICAgICAgdGhpcy5jYWxsYmFjayA9IHRoaXMub3B0aW9ucy5jYWxsYmFjaztcbiAgICAgIGRlbGV0ZSB0aGlzLm9wdGlvbnMuY2FsbGJhY2s7XG4gICAgfVxuICAgIGlmKHRoaXMub3B0aW9ucy5pbml0aWFsaXplKXtcbiAgICAgIHRoaXMuaW5pdGlhbGl6ZSA9IHRoaXMub3B0aW9ucy5pbml0aWFsaXplO1xuICAgIH1cblxuICAgIGlmKHRoaXMub3B0aW9ucy5wcm90b3R5cGVzKXtcbiAgICAgIGZhYnJpYy51dGlsLm9iamVjdC5kZWVwRXh0ZW5kKHRoaXMucHJvdG90eXBlcywgdGhpcy5vcHRpb25zLnByb3RvdHlwZXMpO1xuICAgICAgZGVsZXRlIHRoaXMub3B0aW9ucy5wcm90b3R5cGVzO1xuICAgIH1cblxuICAgIGlmKHRoaXMub3B0aW9ucy5wbHVnaW5zKXtcbiAgICAgIGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQodGhpcy5wbHVnaW5zLCB0aGlzLm9wdGlvbnMucGx1Z2lucyk7XG4gICAgICBkZWxldGUgdGhpcy5vcHRpb25zLnBsdWdpbnM7XG4gICAgfVxuXG4gICAgaWYodGhpcy5vcHRpb25zLmNhbnZhc0NvbnRhaW5lcil7XG4gICAgICB0aGlzLmNhbnZhc0NvbnRhaW5lciA9IHRoaXMub3B0aW9ucy5jYW52YXNDb250YWluZXI7XG4gICAgICBkZWxldGUgdGhpcy5vcHRpb25zLmNhbnZhc0NvbnRhaW5lcjtcbiAgICB9XG5cbiAgICB0aGlzLmluaXRFdmVudExpc3RlbmVycygpO1xuXG4gICAgaWYodGhpcy5vcHRpb25zLmxvYWRlclRlbXBsYXRlKXtcbiAgICAgIHRoaXMuc2V0TG9hZGVyVGVtcGxhdGUodGhpcy5sb2FkZXJUZW1wbGF0ZSB8fCB0aGlzLm9wdGlvbnMubG9hZGVyVGVtcGxhdGUpO1xuICAgIH1cblxuICAgIGlmKHRoaXMub3B0aW9ucy5jcmVkZW50aWFscyB8fCB0aGlzLmNyZWRlbnRpYWxzKXtcbiAgICAgIHRoaXMucHJpbnRCYW5uZXIoKTtcbiAgICB9XG5cbiAgICB0aGlzLmZpcmUoXCJsb2FkaW5nOmJlZ2luXCIse30pO1xuXG4gICAgZmFicmljLnV0aWwub3JkZXIoW1xuICAgICAgdGhpcy5ydW5QbHVnaW5zLmJpbmQodGhpcyxcInByZWxvYWRlcnNcIiksXG4gICAgICB0aGlzLnByZWxvYWRlcixcbiAgICAgIHRoaXMubG9hZENvbmZpZ3VyYXRpb24sXG4gICAgICB0aGlzLnJ1blBsdWdpbnMuYmluZCh0aGlzLFwiY29uZmlndXJhdGlvblwiKSxcbiAgICAgIHRoaXMuY3JlYXRlQXBwLFxuICAgICAgdGhpcy5pbml0aWFsaXplLFxuICAgICAgdGhpcy5sb2FkU2xpZGUsXG4gICAgICB0aGlzLnJ1blBsdWdpbnMuYmluZCh0aGlzLFwicG9zdGxvYWRlcnNcIiksXG4gICAgICB0aGlzLm9uQXBwbGljYXRpb25DcmVhdGVkLFxuICAgICAgdGhpcy5wb3N0bG9hZGVyLFxuICAgICAgdGhpcy5jYWxsYmFjayAmJiBmdW5jdGlvbigpe1xuICAgICAgICBzZXRUaW1lb3V0KHRoaXMuY2FsbGJhY2suYmluZCh0aGlzKSwwKVxuICAgICAgfVxuICAgIF0sdGhpcylcbiAgfSxcbiAgY3JlZGVudGlhbHM6IGZhbHNlLFxuICByZWFkeSA6IGZhbHNlLFxuICBvbkFwcGxpY2F0aW9uQ3JlYXRlZDogZnVuY3Rpb24oKXtcbiAgICB0aGlzLnJlYWR5ID0gdHJ1ZTtcbiAgICB0aGlzLmZpcmUoXCJsb2FkaW5nOmVuZFwiLHt9KTtcbiAgfSxcbiAgY2FudmFzQ2xhc3M6ICdTbGlkZUNhbnZhcycsXG4gIHJlc2l6YWJsZTogZmFsc2UsXG4gIGhpc3Rvcnk6IHRydWUsXG4gIC8qKlxuICAgKiBmdW5jdGlvbnMgd2lsbCBiZSBjYWxsZWQgb24gZGlmZmVyZW50IGFwcGxpY2F0aW9uIGNyZWF0aW9uIHN0YWdlc1xuICAgKi9cbiAgcGx1Z2luczoge1xuICAgIHByZWxvYWRlcnM6IFtdLFxuICAgIGNvbmZpZ3VyYXRpb246IFtdLFxuICAgIGNhbnZhczogW10sXG4gICAgcG9zdGxvYWRlcnM6IFtdXG4gIH0sXG4gIHByaW50QmFubmVyOiBmdW5jdGlvbigpe1xuICAgIGlmKHRoaXMuY3JlZGVudGlhbHMpe1xuICAgICAgY29uc29sZS5pbmZvKFwiJWNGaWVyYSBDYW52YXMgRWRpdG9yJWMgYnkgJWNEZW5pcyBQb25vbWFyZXYlYyAlYyU2JHMlYyAvICVjJTkkcyVjXCIsIFwiY29sb3I6ICNmZmE1MDBcIiwgXCJjb2xvcjogIzIwMjAyMFwiLCBcImNvbG9yOiAjMkVDMDZDXCIsIFwiY29sb3I6ICMyMDIwMjBcIiwgXCJjb2xvcjogIzMzN2FiN1wiLCBcInd3dy5ob21ldGx0LnJ1XCIsIFwiY29sb3I6ICMyMDIwMjBcIiwgXCJjb2xvcjogIzMzN2FiN1wiLCBcInBvbm9tYXJldnRsdEBnbWFpbC5jb21cIiwgXCJjb2xvcjogIzIwMjAyMFwiKTtcbiAgICB9XG4gIH0sXG4gIGV2ZW50TGlzdGVuZXJzOiB7XG4gICAgXCJjYW52YXM6Y3JlYXRlZFwiOiBmdW5jdGlvbigpe1xuICAgICAgdGhpcy5zZXRSZXNpemFibGUoKTtcbiAgICB9LFxuICAgIFwiZW50aXR5OmNyZWF0ZWRcIjogW11cbiAgfSxcbiAgb25TbGlkZUxvYWRlZDogZnVuY3Rpb24gKCkge30sXG4gIG9uQ2FudmFzQ3JlYXRlZDogZnVuY3Rpb24gKCkge30sXG4gIGNhbGxiYWNrOiBmdW5jdGlvbiAoKSB7fSxcbiAgbG9hZENvbmZpZ3VyYXRpb246IGZ1bmN0aW9uIChyZXNvbHZlLGVycm9yKSB7XG4gICAgaWYoIXRoaXMub3B0aW9ucy5jb25maWd1cmF0aW9uKXtcbiAgICAgIHJldHVybiByZXNvbHZlKCk7XG4gICAgfVxuICAgIHZhciBfYXBwID0gdGhpcztcbiAgICBmYWJyaWMudXRpbC5wcm9taXNlXG4gICAgICAubWFwKFxuICAgICAgICB0aGlzLm9wdGlvbnMuY29uZmlndXJhdGlvbixcbiAgICAgICAgZnVuY3Rpb24odmFsdWUpe1xuICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLGZhaWwpIHtcbiAgICAgICAgICAgIGZhYnJpYy51dGlsLmRhdGEubG9hZEpzb24odmFsdWUscmVzb2x2ZSxmYWlsKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgKVxuICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzdWx0cyl7XG4gICAgICAgIGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoX2FwcCxyZXN1bHRzKVxuICAgICAgfSlcbiAgICAgIC50aGVuKHJlc29sdmUsZXJyb3IpO1xuICB9LFxuICBzZXRDYW52YXNDb250YWluZXI6IGZ1bmN0aW9uIChpZCkge1xuICAgIGlmKHRoaXMuX2FwcENyZWF0ZWQpe1xuICAgICAgdGhpcy5jcmVhdGVDYW52YXModGhpcy5jYW52YXNDb250YWluZXIsIHRoaXMuY2FudmFzKTtcbiAgICAgIHRoaXMucHJvamVjdC5zZXRDYW52YXModGhpcy5jYW52YXMpO1xuICAgIH1lbHNle1xuICAgICAgdGhpcy5jYW52YXNDb250YWluZXIgPSBpZDtcbiAgICB9XG4gIH0sXG4gIGxvYWRTbGlkZTogZnVuY3Rpb24gKCkge1xuICAgIHZhciBfY2FudmFzID0gdGhpcy5jYW52YXM7XG4gICAgaWYgKHRoaXMuc2xpZGUpIHtcbiAgICAgIGlmIChfY2FudmFzLmxvYWQpIHtcbiAgICAgICAgX2NhbnZhcy5sb2FkKHRoaXMuc2xpZGUsIHRoaXMub25TbGlkZUxvYWRlZC5iaW5kKHRoaXMpKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIF9jYW52YXMuY3JlYXRlT2JqZWN0cyh0aGlzLnNsaWRlLHRoaXMub25TbGlkZUxvYWRlZC5iaW5kKHRoaXMpKTtcbiAgICAgIH1cbiAgICB9XG4gICAgLy9cbiAgICAvLyBpZihfY2FudmFzKXtcbiAgICAvLyAgIF9jYW52YXMuZmlyZShcImxvYWRpbmc6ZW5kXCIse3R5cGU6IFwiYXBwbGljYXRpb25cIiAsdGFyZ2V0OiB0aGlzfSk7XG4gICAgLy8gfVxuICB9LFxuICBjcmVhdGVBcHA6IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuXG4gICAgZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCh0aGlzLCB0aGlzLm9wdGlvbnMpO1xuICAgIHRoaXMuY3JlYXRlQ2FudmFzKCk7XG4gICAgLy8gdGhpcy5ydW5QbHVnaW5zLmJpbmQodGhpcyxcImNhbnZhc1wiKSxcblxuICAgIHZhciBfY2FudmFzID0gdGhpcy5jYW52YXM7XG5cblxuICAgIGlmICh0aGlzLnByb2plY3QpIHtcbiAgICAgIHZhciBfcHJvamVjdCA9IHRoaXMucHJvamVjdDtcblxuICAgICAgdGhpcy5wcm9qZWN0ID0gbmV3IGZhYnJpYy5Qcm9qZWN0KHthcHBsaWNhdGlvbjogdGhpc30pO1xuICAgICAgdGhpcy5maXJlKFwicHJvamVjdDpjaGFuZ2VkXCIpO1xuXG4gICAgICBpZih0aGlzLmhpc3Rvcnkpe1xuICAgICAgICB0aGlzLnByb2plY3QuaW5pdEhpc3RvcnkoKTtcbiAgICAgICAgdGhpcy5wcm9qZWN0LmVuYWJsZUhpc3RvcnkoKTtcbiAgICAgIH1cbiAgICAgIF9jYW52YXMgJiYgdGhpcy5wcm9qZWN0LnNldENhbnZhcyhfY2FudmFzKTtcblxuICAgICAgaWYgKF9wcm9qZWN0ICE9PSB0cnVlKSB7XG4gICAgICAgIHRoaXMucHJvamVjdC5sb2FkKF9wcm9qZWN0KTtcbiAgICAgIH1cbiAgICB9ZWxzZSBpZiAodGhpcy5jYW52YXMpe1xuICAgICAgaWYodGhpcy5oaXN0b3J5KXtcbiAgICAgICAgX2NhbnZhcy5pbml0SGlzdG9yeSgpO1xuICAgICAgICBfY2FudmFzLmVuYWJsZUhpc3RvcnkoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLmZpcmUoXCJjcmVhdGVkXCIpO1xuICAgIGNhbGxiYWNrKCk7XG4gIH0sXG4gIGNyZWF0ZUNhbnZhczogZnVuY3Rpb24gKCkge1xuICAgIGlmKCF0aGlzLmNhbnZhc0NvbnRhaW5lcil7XG4gICAgICByZXR1cm4gOy8vY2FsbGJhY2soKTtcbiAgICB9XG4gICAgaWYgKHRoaXMuY2FudmFzQ29udGFpbmVyLmNvbnN0cnVjdG9yID09IFN0cmluZykge1xuICAgICAgdmFyIGVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy5jYW52YXNDb250YWluZXIpO1xuICAgIH0gZWxzZSB7XG4gICAgICBlbCA9IHRoaXMuY2FudmFzQ29udGFpbmVyO1xuICAgIH1cbiAgICAvLyB2YXIgX2NhbnZhc19vcHRpb25zID0gdGhpcy5jYW52YXMgO1xuXG4gICAgdGhpcy5jYW52YXMgPSBuZXcgZmFicmljW3RoaXMuY2FudmFzQ2xhc3NdKGVsLCB7YXBwbGljYXRpb246IHRoaXN9KTtcbiAgICAvLyBpZihfY2FudmFzX29wdGlvbnMpe1xuICAgIC8vICAgdGhpcy5jYW52YXMubG9hZChfY2FudmFzX29wdGlvbnMpO1xuICAgIC8vIH1cbiAgICB0aGlzLmZpcmUoXCJjYW52YXM6Y3JlYXRlZFwiKTtcbiAgICB0aGlzLm9uQ2FudmFzQ3JlYXRlZCgpO1xuICB9LFxuICBkaXNwb3NlOiBmdW5jdGlvbigpe1xuICAgIHRoaXMuY2FudmFzLmRpc3Bvc2UoKTtcbiAgfSxcbiAgc2V0UmVzaXphYmxlOiBmdW5jdGlvbigpe1xuICAgIGlmKHRoaXMub3B0aW9ucy5vblJlc2l6ZSl7XG4gICAgICB0aGlzLm9uUmVzaXplID0gdGhpcy5vcHRpb25zLm9uUmVzaXplO1xuICAgICAgZGVsZXRlIHRoaXMub3B0aW9ucy5vblJlc2l6ZTtcbiAgICB9XG4gICAgaWYodGhpcy5vcHRpb25zLnJlc2l6YWJsZSl7XG4gICAgICB0aGlzLnJlc2l6YWJsZSA9IHRoaXMub3B0aW9ucy5yZXNpemFibGU7XG4gICAgICBkZWxldGUgdGhpcy5vcHRpb25zLnJlc2l6YWJsZTtcbiAgICB9XG4gICAgaWYgKHRoaXMucmVzaXphYmxlKSB7XG4gICAgICB0aGlzLmNhbnZhcy5vblJlc2l6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIF9wYXJlbnQgPSAkKHRoaXMud3JhcHBlckVsLnBhcmVudE5vZGUpO1xuXG4gICAgICAgIHZhciBfb2Zmc2V0ID0gJCh0aGlzLndyYXBwZXJFbCkucG9zaXRpb24oKTtcbiAgICAgICAgdmFyIF9tYXJnaW4gID0gdGhpcy5hcHBsaWNhdGlvbi53aWR0aE1hcmdpbiB8fCAwO1xuICAgICAgICB2YXIgX3cgPSAgX3BhcmVudC53aWR0aCgpIC0gX21hcmdpbiwgX2ggPSBfcGFyZW50LmhlaWdodCgpO1xuICAgICAgICBpZiAodGhpcy5hcHBsaWNhdGlvbi5vblJlc2l6ZSkge1xuICAgICAgICAgIHRoaXMuYXBwbGljYXRpb24ub25SZXNpemUoe1xuICAgICAgICAgICAgd2lkdGg6IF93ICxcbiAgICAgICAgICAgIGhlaWdodDogX2hcbiAgICAgICAgICB9LCB7XG4gICAgICAgICAgICB3aWR0aDogdGhpcy5vcmlnaW5hbFdpZHRoICxcbiAgICAgICAgICAgIGhlaWdodDogdGhpcy5vcmlnaW5hbEhlaWdodFxuICAgICAgICAgIH0pO1xuICAgICAgICAgIHRoaXMuY2FsY09mZnNldCgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMuc2V0RGltZW5zaW9ucyh7XG4gICAgICAgICAgICB3aWR0aDogX3cgLSBfb2Zmc2V0LmxlZnQgIC0gX21hcmdpbixcbiAgICAgICAgICAgIGhlaWdodDogX2ggLSBfb2Zmc2V0LnRvcFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIGlmKHRoaXMuY2FudmFzKXtcbiAgICAgIHRoaXMuY2FudmFzLm9uUmVzaXplKCk7XG4gICAgfVxuICB9XG59KTtcblxuZmFicmljLkFwcGxpY2F0aW9uLmFkZFBsdWdpbiA9IGZhYnJpYy5QbHVnaW5zTWl4aW4uYWRkUGx1Z2luLmJpbmQoZmFicmljLkFwcGxpY2F0aW9uKTtcblxuZmFicmljLmFwcCA9IGZ1bmN0aW9uKG9wdGlvbnMpe1xuICByZXR1cm4gbmV3IGZhYnJpYy5BcHBsaWNhdGlvbihvcHRpb25zKTtcbn07XG5cblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vY29yZS9hcHBsaWNhdGlvbi5qc1xuLy8gbW9kdWxlIGlkID0gMzNcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiXG5cblxuaWYoIU9iamVjdC52YWx1ZXMpe1xuICBPYmplY3QuZGVmaW5lUHJvcGVydHkoT2JqZWN0LCAndmFsdWVzJywge1xuICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgIGNvbmZpZ3VyYWJsZTogZmFsc2UsXG4gICAgd3JpdGFibGU6IGZhbHNlLFxuICAgIHZhbHVlOiBmdW5jdGlvbihfb2JqZWN0KSB7XG4gICAgICB2YXIgX3ZhbHVlcyA9IFtdO1xuICAgICAgT2JqZWN0LmtleXMoX29iamVjdCkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgIF92YWx1ZXMucHVzaChfb2JqZWN0W2tleV0pO1xuICAgICAgICAvLyB1c2UgdmFsXG4gICAgICB9KTtcbiAgICAgIHJldHVybiBfdmFsdWVzO1xuICAgIH1cbiAgfSk7XG59XG5cblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMse1xuICBlcnJvcnM6IFtdXG59KTtcblxuZmFicmljLnV0aWwub3JkZXIgPSBmdW5jdGlvbihfYXJyYXksY29udGV4dCApe1xuICAoZnVuY3Rpb24gX2NhbGwoKXtcbiAgICBpZighX2FycmF5Lmxlbmd0aClyZXR1cm47XG4gICAgdmFyIGZvbyA9IF9hcnJheS5zaGlmdCgpO1xuICAgIGlmKGZvbyl7XG4gICAgICBpZihmb28ubGVuZ3RoKXtcbiAgICAgICAgZm9vLmNhbGwoY29udGV4dCxfY2FsbCk7XG4gICAgICB9ZWxzZXtcbiAgICAgICAgZm9vLmNhbGwoY29udGV4dCk7XG4gICAgICAgIF9jYWxsKCk7XG4gICAgICB9XG4gICAgfWVsc2V7XG4gICAgICBfY2FsbCgpO1xuICAgIH1cbiAgfSkoKVxufTtcblxuZmFicmljLnV0aWwucHJvbWlzZSA9IHtcbiAgbWFwOiBmdW5jdGlvbiAoZGF0YSwgZm9vKSB7XG5cbiAgICBpZihkYXRhLmNvbnN0cnVjdG9yID09IEFycmF5KXtcbiAgICAgIHJldHVybiBQcm9taXNlLmFsbChkYXRhLm1hcChmb28pKVxuICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzdWx0cywgZXJyb3IpIHtcbiAgICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnJvcik7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUocmVzdWx0cyk7XG4gICAgICAgIH0pXG4gICAgfVxuXG4gICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhkYXRhKTtcbiAgICB2YXIgdXJscyA9IE9iamVjdC52YWx1ZXMoZGF0YSk7XG4gICAgcmV0dXJuIFByb21pc2UuYWxsKHVybHMubWFwKGZvbykpXG4gICAgICAudGhlbihmdW5jdGlvbiAocmVzdWx0cywgZXJyb3IpIHtcbiAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgX21hcCA9IHt9O1xuXG4gICAgICAgIGZvcih2YXIgaSA9IDAgOyBpIDwgcmVzdWx0cy5sZW5ndGg7IGkrKyl7XG4gICAgICAgICAgX21hcFtrZXlzW2ldXSA9IHJlc3VsdHNbaV07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShfbWFwKTtcbiAgICAgIH0pXG4gIH0sXG4gIHdyYXA6IGZ1bmN0aW9uIChjb250ZXh0KSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIHdyYXAoZm9vKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgb3B0aW9ucyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywxKTtcbiAgICAgICAgaWYgKCFmb28ubGVuZ3RoKSB7XG4gICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCBmYWlsKSB7XG4gICAgICAgICAgICB2YXIgX3Jlc3VsdCA9IGZvby5jYWxsKGNvbnRleHQpO1xuICAgICAgICAgICAgKF9yZXN1bHQgfHwgX3Jlc3VsdCA9PT0gdW5kZWZpbmVkKSA/IHJlc29sdmUoKSA6IGZhaWwoKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZm9vLmJpbmQoY29udGV4dCkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG59O1xuXG5cblxuZmFicmljLk9iamVjdC5wcm90b3R5cGUuc2V0ID0gZnVuY3Rpb24oa2V5LCB2YWx1ZSkge1xuICBpZiAodHlwZW9mIGtleSA9PT0gJ29iamVjdCcpIHtcbiAgICB0aGlzLl9zZXRPYmplY3Qoa2V5LCB2YWx1ZSk7XG4gIH1cbiAgZWxzZSB7XG4gICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJyAmJiBrZXkgIT09ICdjbGlwVG8nKSB7XG4gICAgICB0aGlzLl9zZXQoa2V5LCB2YWx1ZSh0aGlzLmdldChrZXkpKSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgdGhpcy5fc2V0KGtleSwgdmFsdWUpO1xuICAgIH1cbiAgfVxuICByZXR1cm4gdGhpcztcbn07XG5cbmZhYnJpYy5PYmplY3QucHJvdG90eXBlLl9zZXRPYmplY3QgPSBmdW5jdGlvbihvcHRpb25zLGNhbGxiYWNrKSB7XG4gIHZhciBrZXlzID0gT2JqZWN0LmtleXMob3B0aW9ucyk7XG4gIGlmKHRoaXMub3B0aW9uc09yZGVyKXtcbiAgICBmb3IodmFyIGkgPSB0aGlzLm9wdGlvbnNPcmRlci5sZW5ndGg7IGktLTspe1xuICAgICAgdmFyIHByb3AgPSB0aGlzLm9wdGlvbnNPcmRlcltpXTtcbiAgICAgIHZhciBpaSA9IGtleXMuaW5kZXhPZihwcm9wKTtcbiAgICAgIGlmKGlpICE9IC0xKXtcbiAgICAgICAga2V5cy5zcGxpY2UoaWksIDEpO1xuICAgICAgICBrZXlzLnVuc2hpZnQocHJvcCk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIGZvciAodmFyIGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykge1xuICAgIHZhciBwcm9wID0ga2V5c1tpXTtcbiAgICBpZih0eXBlb2Ygb3B0aW9uc1twcm9wXSA9PSBcImZ1bmN0aW9uXCIpe1xuICAgICAga2V5cy5zcGxpY2UoaSwgMSk7XG4gICAgICBrZXlzLnVuc2hpZnQocHJvcCk7XG4gICAgfVxuICB9XG4gIHZhciBxdWV1ZTtcbiAgZm9yICh2YXIgaSBpbiBrZXlzKSB7XG4gICAgdmFyIF9rZXkgPSBrZXlzW2ldO1xuICAgIGlmKG9wdGlvbnNbX2tleV0gPT09IHVuZGVmaW5lZCB8fCBvcHRpb25zW19rZXldID09PSBudWxsKWNvbnRpbnVlO1xuICAgIHZhciBfZm9vTmFtZSA9IFwic2V0XCIgKyBmYWJyaWMudXRpbC5zdHJpbmcuY2FwaXRhbGl6ZShfa2V5LCB0cnVlKTtcbiAgICBpZih0aGlzW19mb29OYW1lXSAmJiB0aGlzW19mb29OYW1lXS5uYW1lICYmIHRoaXNbX2Zvb05hbWVdLm5hbWUgIT0gXCJhbm9ueW1vdXNcIil7XG4gICAgICBpZih0aGlzW19mb29OYW1lXS5sZW5ndGggPT0gMil7XG4gICAgICAgIGlmKCFxdWV1ZSl7XG4gICAgICAgICAgcXVldWUgPSBmYWJyaWMudXRpbC5xdWV1ZUxvYWQoMixjYWxsYmFjayk7XG4gICAgICAgIH1lbHNle1xuICAgICAgICAgIHF1ZXVlLnRvdGFsICsrO1xuICAgICAgICB9XG4gICAgICAgIHRoaXNbX2Zvb05hbWVdKG9wdGlvbnNbX2tleV0sZnVuY3Rpb24oX2tleSl7XG4gICAgICAgICAgcXVldWUoKTtcbiAgICAgICAgfS5iaW5kKHRoaXMsX2tleSkpO1xuICAgICAgfWVsc2V7XG4gICAgICAgIHRoaXNbX2Zvb05hbWVdKG9wdGlvbnNbX2tleV0pXG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX19zZXQoX2tleSwgb3B0aW9uc1tfa2V5XSk7XG4gICAgfVxuICB9XG4gIGlmKHF1ZXVlKXtcbiAgICBxdWV1ZSgpXG4gIH1lbHNlIGlmKGNhbGxiYWNrICl7XG4gICAgY2FsbGJhY2soKTtcbiAgfVxufTtcblxudmFyIF9nZXRfcG9pbnRlcl9vdmVyd3JpdHRlbiA9IGZhYnJpYy5DYW52YXMucHJvdG90eXBlLmdldFBvaW50ZXI7XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLkNhbnZhcy5wcm90b3R5cGUsIHtcbiAgc2V0V2lkdGg6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgIHJldHVybiB0aGlzLnNldERpbWVuc2lvbnMoeyB3aWR0aDogdmFsdWUgfSwge30pO1xuICB9LFxuICBzZXRIZWlnaHQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgIHJldHVybiB0aGlzLnNldERpbWVuc2lvbnMoeyBoZWlnaHQ6IHZhbHVlIH0sIHt9KTtcbiAgfSxcbiAgLyoqXG4gICAqIEBwcml2YXRlXG4gICAqL1xuXG4gIF9zZXRPYmplY3Q6IGZhYnJpYy5PYmplY3QucHJvdG90eXBlLl9zZXRPYmplY3QsXG4gIG9yaWdpbmFsU3RhdGU6IHt9LFxuICBzdGF0ZVByb3BlcnRpZXM6IFtdLFxuICBzcGVjaWFsUHJvcGVydGllczogW1wiYmFja2dyb3VuZEltYWdlXCIsXCJvYmplY3RzXCJdLFxuICBlZGl0aW5nT2JqZWN0OiBudWxsLFxuICBnZXRPYmplY3RCeUlEOiBmdW5jdGlvbihfaWQpe1xuICAgIHZhciBsYXllcnMgPSB0aGlzLmxheWVycyB8fCBbe29iamVjdHM6IHRoaXMuX29iamVjdHN9XTtcbiAgICBmb3IgKHZhciBpIGluIGxheWVycykge1xuICAgICAgZm9yICh2YXIgaiBpbiBsYXllcnNbaV0ub2JqZWN0cykge1xuICAgICAgICBpZiAobGF5ZXJzW2ldLm9iamVjdHNbal0uaWQgPT09IF9pZCkge1xuICAgICAgICAgIHJldHVybiBsYXllcnNbaV0ub2JqZWN0c1tqXTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbiAgfSxcbiAgLypcbiAgIEFkZCBDdXN0b20gT2JqZWN0IFRyYW5mb3JtYXRpb25zXG4gICAqL1xuICBnZXRQb2ludGVyOiBmdW5jdGlvbiAoZSwgaWdub3JlWm9vbSwgdXBwZXJDYW52YXNFbCkge1xuICAgIHZhciBwb2ludGVyID0gX2dldF9wb2ludGVyX292ZXJ3cml0dGVuLmNhbGwodGhpcywgZSwgaWdub3JlWm9vbSwgdXBwZXJDYW52YXNFbCk7XG4gICAgaWYgKGUuX2dyb3VwKSB7XG4gICAgICByZXR1cm4gdGhpcy5fbm9ybWFsaXplUG9pbnRlcihlLl9ncm91cCwgcG9pbnRlcik7XG4gICAgfVxuICAgIHJldHVybiBwb2ludGVyO1xuICB9LFxuICBfX3NldCA6IGZhYnJpYy5PYmplY3QucHJvdG90eXBlLl9zZXQsXG4gIGdldE1vZGlmaWVkU3RhdGVzOiBmdW5jdGlvbiAodGFyZ2V0KSB7XG4gICAgdmFyIHN0YXRlcyA9IHtcbiAgICAgIG9yaWdpbmFsOiB7fSxcbiAgICAgIG1vZGlmaWVkOiB7fVxuICAgIH07XG4gICAgZm9yICh2YXIgcHJvcCBpbiB0YXJnZXQub3JpZ2luYWxTdGF0ZSkge1xuICAgICAgaWYgKHRhcmdldC5vcmlnaW5hbFN0YXRlW3Byb3BdICE9PSB0YXJnZXRbcHJvcF0pIHtcbiAgICAgICAgaWYodGFyZ2V0Lm9yaWdpbmFsU3RhdGVbcHJvcF0gaW5zdGFuY2VvZiBPYmplY3Qpe1xuICAgICAgICAgIGlmKEpTT04uc3RyaW5naWZ5KHRhcmdldC5vcmlnaW5hbFN0YXRlW3Byb3BdKSA9PSBKU09OLnN0cmluZ2lmeSh0YXJnZXRbcHJvcF0pKXtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBzdGF0ZXMub3JpZ2luYWxbcHJvcF0gPSB0YXJnZXQub3JpZ2luYWxTdGF0ZVtwcm9wXTtcbiAgICAgICAgc3RhdGVzLm1vZGlmaWVkW3Byb3BdID0gdGFyZ2V0W3Byb3BdO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gc3RhdGVzO1xuICB9LFxuICBmaXJlTW9kaWZpZWRJZkNoYW5nZWQ6IGZ1bmN0aW9uICh0YXJnZXQpIHtcbiAgICBpZiAodGhpcy5zdGF0ZWZ1bCkge1xuICAgICAgdmFyIF9zdGF0ZXMgPSB0YXJnZXQuaGFzU3RhdGVDaGFuZ2VkKCk7XG4gICAgICBpZihfc3RhdGVzKXtcbiAgICAgICAgdGhpcy5maXJlKCdvYmplY3Q6bW9kaWZpZWQnLCB7dGFyZ2V0OiB0YXJnZXQgLCBzdGF0ZXM6IF9zdGF0ZXN9KTtcbiAgICAgICAgdGFyZ2V0LmZpcmUoJ21vZGlmaWVkJyx7c3RhdGVzOiBfc3RhdGVzfSk7XG4gICAgICB9XG4gICAgfVxuICB9LFxuICBfc2V0OiBmdW5jdGlvbiAoa2V5LCB2YWx1ZSxjYWxsYmFjaykge1xuICAgIGlmICh0aGlzLnNwZWNpYWxQcm9wZXJ0aWVzLmluZGV4T2Yoa2V5KSAhPT0gLTEpIHtcbiAgICAgIHRoaXNbXCJzZXRcIiArIGZhYnJpYy51dGlsLnN0cmluZy5jYXBpdGFsaXplKGtleSwgdHJ1ZSldKHZhbHVlLGNhbGxiYWNrKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZmFicmljLk9iamVjdC5wcm90b3R5cGUuX3NldC5jYWxsKHRoaXMsIGtleSwgdmFsdWUpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfSxcbiAgZ2V0OiBmYWJyaWMuT2JqZWN0LnByb3RvdHlwZS5nZXQsXG4gIHNldDogZmFicmljLk9iamVjdC5wcm90b3R5cGUuc2V0LFxuICBoYXNTdGF0ZUNoYW5nZWQ6IGZhYnJpYy5PYmplY3QucHJvdG90eXBlLmhhc1N0YXRlQ2hhbmdlZCxcbiAgLyoqIENyZWF0ZXMgYSBib3R0b20gY2FudmFzXG4gICAqIEBwcml2YXRlXG4gICAqIEBwYXJhbSB7SFRNTEVsZW1lbnR9IFtjYW52YXNFbF1cbiAgICovXG4gIF9jcmVhdGVMb3dlckNhbnZhczogZnVuY3Rpb24gKGNhbnZhc0VsKSB7XG4gICAgaWYgKHR5cGVvZiBjYW52YXNFbCA9PSBcInN0cmluZ1wiKSB7XG4gICAgICB0aGlzLmxvd2VyQ2FudmFzRWwgPSBmYWJyaWMudXRpbC5nZXRCeUlkKGNhbnZhc0VsKSB8fCB0aGlzLl9jcmVhdGVDYW52YXNFbGVtZW50KCk7XG4gICAgfSBlbHNlIGlmIChjYW52YXNFbCkge1xuICAgICAgdGhpcy5sb3dlckNhbnZhc0VsID0gY2FudmFzRWw7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMudmlydHVhbCA9IHRydWU7XG4gICAgICB0aGlzLmxvd2VyQ2FudmFzRWwgPSBmYWJyaWMudXRpbC5jcmVhdGVDYW52YXNFbGVtZW50KCk7XG4gICAgfVxuXG4gICAgdGhpcy5faW5pdENhbnZhc0VsZW1lbnQodGhpcy5sb3dlckNhbnZhc0VsKTtcblxuICAgIGZhYnJpYy51dGlsLmFkZENsYXNzKHRoaXMubG93ZXJDYW52YXNFbCwgJ2xvd2VyLWNhbnZhcycpO1xuXG4gICAgaWYgKHRoaXMuaW50ZXJhY3RpdmUpIHtcbiAgICAgIHRoaXMuX2FwcGx5Q2FudmFzU3R5bGUodGhpcy5sb3dlckNhbnZhc0VsKTtcbiAgICB9XG5cbiAgICB0aGlzLmNvbnRleHRDb250YWluZXIgPSB0aGlzLmxvd2VyQ2FudmFzRWwuZ2V0Q29udGV4dCgnMmQnKTtcbiAgfSxcbiAgZmluZFRhcmdldDogZnVuY3Rpb24gKGUsIHNraXBHcm91cCkge1xuICAgIGlmICh0aGlzLnNraXBUYXJnZXRGaW5kKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdmFyIGlnbm9yZVpvb20gPSB0cnVlLFxuICAgICAgcG9pbnRlciA9IHRoaXMuZ2V0UG9pbnRlcihlLCBpZ25vcmVab29tKSxcbiAgICAgIGFjdGl2ZUdyb3VwID0gdGhpcy5nZXRBY3RpdmVHcm91cCgpLFxuICAgICAgYWN0aXZlT2JqZWN0ID0gdGhpcy5nZXRBY3RpdmVPYmplY3QoKTtcbiAgICBpZiAoYWN0aXZlR3JvdXAgJiYgIXNraXBHcm91cCAmJiB0aGlzLl9jaGVja1RhcmdldChwb2ludGVyLCBhY3RpdmVHcm91cCkpIHtcbiAgICAgIHJldHVybiBhY3RpdmVHcm91cDtcbiAgICB9XG5cbiAgICBpZiAoYWN0aXZlT2JqZWN0ICYmIHRoaXMuX2NoZWNrVGFyZ2V0KHBvaW50ZXIsIGFjdGl2ZU9iamVjdCkpIHtcbiAgICAgIC8vYWRkZWQgdmlzY2Vyb2lkXG4gICAgICB0aGlzLl9maXJlT3Zlck91dEV2ZW50cyhhY3RpdmVPYmplY3QsIGUpO1xuICAgICAgcmV0dXJuIGFjdGl2ZU9iamVjdDtcbiAgICB9XG5cbiAgICB0aGlzLnRhcmdldHMgPSBbIF07XG5cbiAgICB2YXIgdGFyZ2V0ID0gdGhpcy5fc2VhcmNoUG9zc2libGVUYXJnZXRzKHRoaXMuX29iamVjdHMsIHBvaW50ZXIpO1xuICAgIHRoaXMuX2ZpcmVPdmVyT3V0RXZlbnRzKHRhcmdldCwgZSk7XG4gICAgcmV0dXJuIHRhcmdldDtcbiAgfVxufSk7XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLk9iamVjdC5wcm90b3R5cGUsIHtcbiAgc2V0QW5nbGU6IGZ1bmN0aW9uKGFuZ2xlKSB7XG4gICAgdGhpcy5hbmdsZSA9IGFuZ2xlO1xuICB9LFxuICBfX3NldCA6IGZhYnJpYy5PYmplY3QucHJvdG90eXBlLl9zZXQsXG4gIGdldCA6IGZhYnJpYy5PYmplY3QucHJvdG90eXBlLmdldCxcbiAgX3NldDogZnVuY3Rpb24gKGtleSwgdmFsdWUgLGNhbGxiYWNrKSB7XG4gICAgdmFyIF9mb29OYW1lID0gXCJzZXRcIiArIGZhYnJpYy51dGlsLnN0cmluZy5jYXBpdGFsaXplKGtleSwgdHJ1ZSk7XG4gICAgaWYodGhpc1tfZm9vTmFtZV0gICYmIHRoaXNbX2Zvb05hbWVdLm5hbWUgJiYgdGhpc1tfZm9vTmFtZV0ubmFtZSAhPSBcImFub255bW91c1wiKXtcbiAgICAgIC8vIGlmICh0aGlzLnNwZWNpYWxQcm9wZXJ0aWVzLmluZGV4T2Yoa2V5KSAhPT0gLTEpIHtcbiAgICAgIC8vIGlmKHRoaXNbX2Zvb05hbWVdKXtcbiAgICAgIHRoaXNbX2Zvb05hbWVdKHZhbHVlLGNhbGxiYWNrKTtcbiAgICB9ZWxzZXtcbiAgICAgIHRoaXMuX19zZXQoa2V5LCB2YWx1ZSk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9LFxuICBkaXNhYmxlOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5zZXQoe1xuICAgICAgc2VsZWN0YWJsZTogZmFsc2UsXG4gICAgICBldmVudGVkOiBmYWxzZSxcbiAgICAgIGhhc0NvbnRyb2xzOiBmYWxzZSxcbiAgICAgIGxvY2tNb3ZlbWVudFg6IHRydWUsXG4gICAgICBsb2NrTW92ZW1lbnRZOiB0cnVlXG4gICAgfSk7XG4gIH0sXG4gIHN0b3JlZDogdHJ1ZSxcbiAgLyoqXG4gICAqIFNhdmVzIHN0YXRlIG9mIGFuIG9iamVjdFxuICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdIE9iamVjdCB3aXRoIGFkZGl0aW9uYWwgYHN0YXRlUHJvcGVydGllc2AgYXJyYXkgdG8gaW5jbHVkZSB3aGVuIHNhdmluZyBzdGF0ZVxuICAgKiBAcmV0dXJuIHtmYWJyaWMuT2JqZWN0fSB0aGlzQXJnXG4gICAqL1xuICBzYXZlU3RhdGU6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICB0aGlzLnN0YXRlUHJvcGVydGllcy5mb3JFYWNoKGZ1bmN0aW9uKHByb3ApIHtcbiAgICAgIHZhciBfdmFsID0gdGhpcy5nZXQocHJvcCk7XG4gICAgICBpZihfdmFsIGluc3RhbmNlb2YgT2JqZWN0KXtcbiAgICAgICAgdGhpcy5vcmlnaW5hbFN0YXRlW3Byb3BdID0gZmFicmljLnV0aWwub2JqZWN0LmNsb25lRGVlcChfdmFsKTtcbiAgICAgIH1lbHNle1xuICAgICAgICB0aGlzLm9yaWdpbmFsU3RhdGVbcHJvcF0gPSBfdmFsO1xuICAgICAgfVxuICAgIH0sIHRoaXMpO1xuXG4gICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5zdGF0ZVByb3BlcnRpZXMpIHtcbiAgICAgIG9wdGlvbnMuc3RhdGVQcm9wZXJ0aWVzLmZvckVhY2goZnVuY3Rpb24ocHJvcCkge1xuICAgICAgICB0aGlzLm9yaWdpbmFsU3RhdGVbcHJvcF0gPSB0aGlzLmdldChwcm9wKTtcbiAgICAgIH0sIHRoaXMpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfSxcbiAgaGFzU3RhdGVDaGFuZ2VkOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgbW9kaWZpZWQgPSAwO1xuICAgIHZhciBzdGF0ZXMgPSB7XG4gICAgICBvcmlnaW5hbDoge30sXG4gICAgICBtb2RpZmllZDoge31cbiAgICB9O1xuICAgIGZvciAodmFyIHByb3AgaW4gdGhpcy5vcmlnaW5hbFN0YXRlKSB7XG4gICAgICBpZiAodGhpcy5vcmlnaW5hbFN0YXRlW3Byb3BdICE9PSB0aGlzW3Byb3BdKSB7XG4gICAgICAgIGlmKHRoaXMub3JpZ2luYWxTdGF0ZVtwcm9wXSBpbnN0YW5jZW9mIE9iamVjdCl7XG4gICAgICAgICAgaWYoSlNPTi5zdHJpbmdpZnkodGhpcy5vcmlnaW5hbFN0YXRlW3Byb3BdKSA9PSBKU09OLnN0cmluZ2lmeSh0aGlzW3Byb3BdKSl7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgc3RhdGVzLm9yaWdpbmFsW3Byb3BdID0gdGhpcy5vcmlnaW5hbFN0YXRlW3Byb3BdO1xuICAgICAgICBzdGF0ZXMubW9kaWZpZWRbcHJvcF0gPSB0aGlzW3Byb3BdO1xuICAgICAgICBtb2RpZmllZCsrO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbW9kaWZpZWQgJiYgc3RhdGVzO1xuICB9XG59KTtcblxuZmFicmljLnV0aWwuZ2V0UHJvcG9ydGlvbnMgPSBmdW5jdGlvbiAocGhvdG8sIGNvbnRhaW5lciwgbW9kZSkge1xuICBtb2RlID0gbW9kZSB8fCAnZml0JztcbiAgdmFyIF93ID0gcGhvdG8ubmF0dXJhbFdpZHRoIHx8IHBob3RvLndpZHRoO1xuICB2YXIgX2ggPSBwaG90by5uYXR1cmFsSGVpZ2h0IHx8IHBob3RvLmhlaWdodDtcbiAgaWYgKCFjb250YWluZXIuaGVpZ2h0ICYmICFjb250YWluZXIud2lkdGgpIHtcbiAgICByZXR1cm4ge1xuICAgICAgc2NhbGU6IDEsXG4gICAgICB3aWR0aDogX3csXG4gICAgICBoZWlnaHQ6IF9oXG4gICAgfTtcbiAgfVxuICBpZiAoIXBob3RvLmhlaWdodCAmJiAhcGhvdG8ud2lkdGgpIHtcbiAgICByZXR1cm4ge1xuICAgICAgc2NhbGU6IDAuMDAxLFxuICAgICAgd2lkdGg6IGNvbnRhaW5lci53aWR0aCxcbiAgICAgIGhlaWdodDogY29udGFpbmVyLmhlaWdodFxuICAgIH07XG4gIH1cblxuICAvLyB2YXIgX2FzcCA9IF93IC8gX2gsIF9jX2FzcCA9IGNvbnRhaW5lci53aWR0aCAvIGNvbnRhaW5lci5oZWlnaHQ7XG5cbiAgLy8gaWYgKF9hc3AgPiBfY19hc3ApIHtcbiAgLy8gICBfaCA9IGNvbnRhaW5lci5oZWlnaHQ7XG4gIC8vICAgX3cgPSBfaCAqIF9hc3A7XG4gIC8vXG4gIC8vIH0gZWxzZSB7XG4gIC8vICAgX3cgPSBjb250YWluZXIud2lkdGg7XG4gIC8vICAgX2ggPSBfdyAvIF9hc3A7XG4gIC8vIH1cbiAgLy8gdmFyIHNjYWxlWCA9IGNvbnRhaW5lci53aWR0aCAvIF93O1xuICAvLyB2YXIgc2NhbGVZID0gY29udGFpbmVyLmhlaWdodCAvIF9oO1xuICB2YXIgc2NhbGVYID0gY29udGFpbmVyLndpZHRoICYmIGNvbnRhaW5lci53aWR0aCAvIF93IHx8IDk5OTtcbiAgdmFyIHNjYWxlWSA9IGNvbnRhaW5lci5oZWlnaHQgJiYgY29udGFpbmVyLmhlaWdodCAvIF9oIHx8IDk5OTtcblxuICB2YXIgc2NhbGU7XG4gIGlmIChtb2RlID09PSAnY292ZXInKSB7XG4gICAgc2NhbGUgPSBNYXRoLm1heChzY2FsZVgsIHNjYWxlWSk7XG4gIH1cbiAgaWYgKG1vZGUgPT09ICdmaXQnKSB7XG4gICAgc2NhbGUgPSBNYXRoLm1pbihzY2FsZVgsIHNjYWxlWSk7XG4gIH1cbiAgaWYgKG1vZGUgPT09ICdjZW50ZXInKSB7XG4gICAgc2NhbGUgPSAxO1xuICB9XG4gIHJldHVybiB7XG4gICAgc2NhbGU6IHNjYWxlLFxuICAgIHdpZHRoOiBNYXRoLmZsb29yKF93ICogc2NhbGUpLFxuICAgIGhlaWdodDogTWF0aC5mbG9vcihfaCAqIHNjYWxlKVxuICB9O1xufTtcblxuZmFicmljLnV0aWwuVXRmOEFycmF5VG9TdHIgPSBmdW5jdGlvbihhcnJheSkge1xuICB2YXIgb3V0LCBpLCBsZW4sIGM7XG4gIHZhciBjaGFyMiwgY2hhcjM7XG5cbiAgb3V0ID0gXCJcIjtcbiAgbGVuID0gYXJyYXkubGVuZ3RoO1xuICBpID0gMDtcbiAgd2hpbGUoaSA8IGxlbikge1xuICAgIGMgPSBhcnJheVtpKytdO1xuICAgIHN3aXRjaChjID4+IDQpXG4gICAge1xuICAgICAgY2FzZSAwOiBjYXNlIDE6IGNhc2UgMjogY2FzZSAzOiBjYXNlIDQ6IGNhc2UgNTogY2FzZSA2OiBjYXNlIDc6XG4gICAgICAvLyAweHh4eHh4eFxuICAgICAgb3V0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoYyk7XG4gICAgICBicmVhaztcbiAgICAgIGNhc2UgMTI6IGNhc2UgMTM6XG4gICAgICAvLyAxMTB4IHh4eHggICAxMHh4IHh4eHhcbiAgICAgIGNoYXIyID0gYXJyYXlbaSsrXTtcbiAgICAgIG91dCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKCgoYyAmIDB4MUYpIDw8IDYpIHwgKGNoYXIyICYgMHgzRikpO1xuICAgICAgYnJlYWs7XG4gICAgICBjYXNlIDE0OlxuICAgICAgICAvLyAxMTEwIHh4eHggIDEweHggeHh4eCAgMTB4eCB4eHh4XG4gICAgICAgIGNoYXIyID0gYXJyYXlbaSsrXTtcbiAgICAgICAgY2hhcjMgPSBhcnJheVtpKytdO1xuICAgICAgICBvdXQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgoKGMgJiAweDBGKSA8PCAxMikgfFxuICAgICAgICAgICgoY2hhcjIgJiAweDNGKSA8PCA2KSB8XG4gICAgICAgICAgKChjaGFyMyAmIDB4M0YpIDw8IDApKTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIG91dDtcbn07XG5cbmZhYnJpYy51dGlsLmNyZWF0ZU9iamVjdCA9IGZ1bmN0aW9uICh0eXBlLCBvcHRpb25zLCBjYWxsYmFjaykge1xuICBpZih0eXBlb2YgdHlwZSAhPT0gXCJzdHJpbmdcIil7XG4gICAgY2FsbGJhY2sgPSBvcHRpb25zO1xuICAgIG9wdGlvbnMgPSB0eXBlO1xuICAgIHR5cGUgPSBudWxsO1xuICB9ZWxzZXtcbiAgICBvcHRpb25zLnR5cGUgPSB0eXBlO1xuICB9XG4gIHZhciBhcHAgPSBvcHRpb25zLmFwcGxpY2F0aW9uO1xuICBhcHAgJiYgYXBwLmZpcmUoXCJlbnRpdHk6bG9hZFwiLHtvcHRpb25zOiBvcHRpb25zfSk7XG5cbiAgdmFyIF9rbGFzc05hbWUgPSBmYWJyaWMudXRpbC5zdHJpbmcuY2FtZWxpemUoZmFicmljLnV0aWwuc3RyaW5nLmNhcGl0YWxpemUodHlwZSB8fCBvcHRpb25zLnR5cGUgfHwgYXBwLnByb3RvdHlwZXMuT2JqZWN0LnR5cGUsdHJ1ZSkpO1xuICB2YXIgX2tsYXNzID0gZmFicmljW19rbGFzc05hbWVdIHx8IGFwcC5rbGFzc2VzW19rbGFzc05hbWVdO1xuXG5cbiAgaWYoIV9rbGFzcyl7XG4gICAgY29uc29sZS5lcnJvcihfa2xhc3NOYW1lICsgXCIgaXMgdW5kZWZpbmVkXCIpO1xuICAgIHJldHVybiBjYWxsYmFjayhuZXcgZmFicmljLlJlY3Qob3B0aW9ucykpXG4gIH1cblxuICB2YXIgZWwgPSBfa2xhc3MuZnJvbU9iamVjdChvcHRpb25zLCBmdW5jdGlvbiAoZWwpIHtcbiAgICBjYWxsYmFjayAmJiBjYWxsYmFjayhlbCk7XG4gICAgY2FsbGJhY2sgPSBudWxsO1xuICB9KTtcbiAgaWYgKGVsKSB7XG4gICAgY2FsbGJhY2sgJiYgY2FsbGJhY2soZWwpO1xuICAgIGNhbGxiYWNrID0gbnVsbDtcbiAgfVxuICByZXR1cm4gZWw7XG59O1xuXG5mYWJyaWMudXRpbC5kYXRhVVJJdG9CbG9iID0gZnVuY3Rpb24gKGRhdGFVUkksIGRhdGFUWVBFKSB7XG4gIHZhciBiaW5hcnkgPSBhdG9iKGRhdGFVUkkuc3BsaXQoJywnKVsxXSksIGFycmF5ID0gW107XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgYmluYXJ5Lmxlbmd0aDsgaSsrKSB7XG4gICAgYXJyYXkucHVzaChiaW5hcnkuY2hhckNvZGVBdChpKSk7XG4gIH1cbiAgcmV0dXJuIG5ldyBCbG9iKFtuZXcgVWludDhBcnJheShhcnJheSldLCB7dHlwZTogZGF0YVRZUEV9KTtcbn07XG5cbmZhYnJpYy51dGlsLmJsb2JUb0RhdGFVUkwgPSBmdW5jdGlvbiAoYmxvYiwgY2FsbGJhY2spIHtcbiAgdmFyIGEgPSBuZXcgRmlsZVJlYWRlcigpO1xuICBhLm9ubG9hZCA9IGZ1bmN0aW9uIChlKSB7XG4gICAgY2FsbGJhY2soZS50YXJnZXQucmVzdWx0KTtcbiAgfTtcbiAgYS5yZWFkQXNEYXRhVVJMKGJsb2IpO1xufTtcblxuZmFicmljLnV0aWwuY3JlYXRlQ2FudmFzRWxlbWVudFdpdGhTaXplID0gZnVuY3Rpb24gKHNpemUpIHtcbiAgdmFyIGNhbnZhcyA9IGZhYnJpYy51dGlsLmNyZWF0ZUNhbnZhc0VsZW1lbnQoKTtcbiAgY2FudmFzLndpZHRoID0gc2l6ZS53aWR0aDtcbiAgY2FudmFzLmhlaWdodCA9IHNpemUuaGVpZ2h0O1xuICByZXR1cm4gY2FudmFzO1xufTtcblxuZmFicmljLnV0aWwuc3RyaW5nLnRvRGFzaGVkID0gZnVuY3Rpb24gKHN0cikge1xuICByZXR1cm4gc3RyLnJlcGxhY2UoLyhbYS16XSkoW0EtWl0pL2csICckMS0kMicpLnRvTG93ZXJDYXNlKCk7XG59O1xuXG5mYWJyaWMudXRpbC5zdHJpbmcudW5jYXBpdGFsaXplID0gZnVuY3Rpb24oc3RyaW5nKXtcbiAgcmV0dXJuIHN0cmluZy5jaGFyQXQoMCkudG9Mb3dlckNhc2UoKSArXG4gICAgKHN0cmluZy5zbGljZSgxKSk7XG59O1xuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9jb3JlL2Jhc2UuanNcbi8vIG1vZHVsZSBpZCA9IDM0XG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIid1c2Ugc3RyaWN0JztcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMse1xuICBkZWJ1Z1RpbWVvdXQ6IDBcbn0pO1xuXG5mYWJyaWMuQXBwbGljYXRpb24ucHJvdG90eXBlLmVuYWJsZURlYnVnZ2luZyA9IGZ1bmN0aW9uKCl7XG4gIGlmKGZhYnJpYy5kZWJ1Zyl7XG5cbiAgICB2YXIgX29wZXJhbmQgPSBcImNvbG9yOiAjMkVDMDZDOyBmb250LXN0eWxlOiBpdGFsaWM7XCI7XG4gICAgY29uc29sZS5pbmZvKFwiZGVidWcgZW5hYmxlZC4gKHVzZSAlY2FwcCVjLCAlY3Byb2plY3QlYywgJWNjYW52YXMlYywgJWN0YXJnZXQlYyBpbiBjb25zb2xlKVwiLFxuICAgICAgX29wZXJhbmQsIFwiY29sb3I6ICMyMDIwMjBcIixcbiAgICAgIF9vcGVyYW5kLCBcImNvbG9yOiAjMjAyMDIwXCIsXG4gICAgICBfb3BlcmFuZCwgXCJjb2xvcjogIzIwMjAyMFwiLFxuICAgICAgX29wZXJhbmQsIFwiY29sb3I6ICMyMDIwMjBcIik7XG5cbiAgICB3aW5kb3cuYXBwID0gdGhpcztcbiAgICB3aW5kb3cuY2FudmFzID0gdGhpcy5jYW52YXM7XG4gICAgd2luZG93LnByb2plY3QgPSB0aGlzLnByb2plY3Q7XG4gICAgd2luZG93LnRhcmdldCA9IG51bGw7XG4gICAgdGhpcy5jYW52YXMgJiYgdGhpcy5jYW52YXMub24oXCJ0YXJnZXQ6Y2hhbmdlZFwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICB3aW5kb3cudGFyZ2V0ID0gdGhpcy50YXJnZXQ7XG4gICAgfSk7XG4gIH1cbn07XG5mYWJyaWMuQXBwbGljYXRpb24uYWRkUGx1Z2luKFwicG9zdGxvYWRlcnNcIixcImVuYWJsZURlYnVnZ2luZ1wiKTtcblxuZmFicmljLk9iamVjdC5wcm90b3R5cGUuZGVidWcgPSBmdW5jdGlvbihub0JvcmRlcnMpe1xuICB2YXIgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKTtcbiAgY2FudmFzLndpZHRoID0gbm9Cb3JkZXJzID90aGlzLndpZHRoOiB0aGlzLndpZHRoICsgMjtcbiAgY2FudmFzLmhlaWdodCA9IG5vQm9yZGVycyA/dGhpcy5oZWlnaHQgOiB0aGlzLmhlaWdodCArIDI7XG5cbiAgdmFyIGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xuICBpZighbm9Cb3JkZXJzKXtcbiAgICBjdHgubGluZVdpZHRoPTE7XG4gICAgY3R4LnN0cm9rZVN0eWxlPVwieWVsbG93XCI7XG4gICAgY3R4LnN0cm9rZVJlY3QoMCwwLHRoaXMud2lkdGggKyAyLHRoaXMuaGVpZ2h0KyAyKTtcbiAgICBjdHguc2V0TGluZURhc2goWzQsNF0pO1xuICAgIGN0eC5zdHJva2VTdHlsZT1cIiMwMDAwMDBcIjtcbiAgICBjdHguc3Ryb2tlUmVjdCgwLDAsdGhpcy53aWR0aCArIDIsdGhpcy5oZWlnaHQrIDIpO1xuICB9XG4gIGN0eC50cmFuc2xhdGUodGhpcy53aWR0aC8yICArIDEsdGhpcy5oZWlnaHQvMiArIDEpO1xuICB2YXIgX2NsaXBUbyA9IHRoaXMuY2xpcFRvO1xuICBkZWxldGUgdGhpcy5jbGlwVG87XG4gIHRoaXMucmVuZGVyKGN0eCx0cnVlKTtcbiAgdGhpcy5jbGlwVG8gPSBfY2xpcFRvO1xuICB3aW5kb3cub3BlbihjYW52YXMudG9EYXRhVVJMKCksXCJfYmxhbmtcIik7XG59O1xuXG5cbmZhYnJpYy5BcHBsaWNhdGlvbi5wcm90b3R5cGUubG9nRXZlbnRzID0gZmFicmljLk9iamVjdC5wcm90b3R5cGUubG9nRXZlbnRzID0gZnVuY3Rpb24gZXZlbnRzTG9nZ2VyKG9wdGlvbnMpe1xuICB2YXIgX2NvdW50ZXIgPSB7fTtcbiAgZm9yKHZhciBpIGluIG9wdGlvbnMpe1xuICAgIF9jb3VudGVyW2ldID0gMDtcbiAgICB0aGlzLm9uKG9wdGlvbnNbaV0sZnVuY3Rpb24oaSwgZXZlbnQpIHtcbiAgICAgIGNvbnNvbGUubG9nKGkgKyBcIiBcIiArICsrX2NvdW50ZXJbaV0sZXZlbnQpO1xuICAgIH0uYmluZCh0aGlzLGkpKTtcbiAgfVxufVxuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9jb3JlL2RlYnVnLmpzXG4vLyBtb2R1bGUgaWQgPSAzNVxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCIndXNlIHN0cmljdCc7XG5cbmlmICghU3RyaW5nLnByb3RvdHlwZS5zcGxpY2UpIHtcbiAgLyoqXG4gICAqIHtKU0RvY31cbiAgICpcbiAgICogVGhlIHNwbGljZSgpIG1ldGhvZCBjaGFuZ2VzIHRoZSBjb250ZW50IG9mIGEgc3RyaW5nIGJ5IHJlbW92aW5nIGEgcmFuZ2Ugb2ZcbiAgICogY2hhcmFjdGVycyBhbmQvb3IgYWRkaW5nIG5ldyBjaGFyYWN0ZXJzLlxuICAgKlxuICAgKiBAdGhpcyB7U3RyaW5nfVxuICAgKiBAcGFyYW0ge251bWJlcn0gc3RhcnQgSW5kZXggYXQgd2hpY2ggdG8gc3RhcnQgY2hhbmdpbmcgdGhlIHN0cmluZy5cbiAgICogQHBhcmFtIHtudW1iZXJ9IGRlbENvdW50IEFuIGludGVnZXIgaW5kaWNhdGluZyB0aGUgbnVtYmVyIG9mIG9sZCBjaGFycyB0byByZW1vdmUuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBuZXdTdWJTdHIgVGhlIFN0cmluZyB0aGF0IGlzIHNwbGljZWQgaW4uXG4gICAqIEByZXR1cm4ge3N0cmluZ30gQSBuZXcgc3RyaW5nIHdpdGggdGhlIHNwbGljZWQgc3Vic3RyaW5nLlxuICAgKi9cbiAgU3RyaW5nLnByb3RvdHlwZS5zcGxpY2UgPSBmdW5jdGlvbihzdGFydCwgZGVsQ291bnQsIG5ld1N1YlN0cikge1xuICAgIHJldHVybiB0aGlzLnNsaWNlKDAsIHN0YXJ0KSArIG5ld1N1YlN0ciArIHRoaXMuc2xpY2Uoc3RhcnQgKyBNYXRoLmFicyhkZWxDb3VudCkpO1xuICB9O1xufVxuXG5cbnJlcXVpcmUoXCIuLy4uL2pxdWVyeS9kcmFnZ2FibGVcIik7XG5mYWJyaWMudXRpbC5zeW50YXggPSByZXF1aXJlKFwiLi8uLi91dGlsL3N5bnRheFwiKTtcblxuZmFicmljLkRlbW9BcHBsaWNhdGlvbiA9IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgdGhpcy5pbml0KG9wdGlvbnMpO1xufTtcblxuZmFicmljLkRlbW9BcHBsaWNhdGlvbi5wcm90b3R5cGUgPSB7XG4gIGNyZWRlbnRpYWxzOiB0cnVlLFxuICBsb2FkZXJDb250YWluZXI6IFwiLnh4LWNvbnRhaW5lclwiLFxuICBsb2FkZXJUZW1wbGF0ZTogXCI8c3BhbiBjbGFzcz0nY2FudmFzLWxvYWQtc3Bpbm5lcic+PGltZyBzcmM9J3tsb2FkZXJJY29ufSc+PC9zcGFuPlwiLFxuICBfX3Byb3RvX186IGZhYnJpYy5BcHBsaWNhdGlvbi5wcm90b3R5cGUsXG4gIHVzZU1hcmtEb3duOiBmYWxzZSxcbiAgbGlicmFyeVRvb2w6IGZhbHNlLFxuICBjb2RlQmxvY2s6IHRydWUsXG4gIHV0aWw6IHtcbiAgICBtZWRpYVJvb3Q6ICcuLi9tZWRpYS8nXG4gIH0sXG4gIHJlc2l6YWJsZTogdHJ1ZSxcbiAgcHJvdG90eXBlczoge1xuICAgIFRleHQ6IHtcbiAgICAgIGZvbnRGYW1pbHk6IFwiT3BlbiBTYW5zXCJcbiAgICB9LFxuICAgIE9iamVjdDoge1xuICAgICAgLy8gb3JpZ2luWDogXCJjZW50ZXJcIixcbiAgICAgIC8vIG9yaWdpblk6IFwiY2VudGVyXCIsXG4gICAgICBpbmNsdWRlRGVmYXVsdFZhbHVlczogZmFsc2UsXG4gICAgICAvLyBvcmRlclRvb2xzICAgOiB0cnVlLFxuICAgICAgLy8gZmxpcFRvb2xzIDogdHJ1ZSxcbiAgICAgIC8vIGR1cGxpY2F0ZVRvb2wgOiB0cnVlLFxuICAgICAgdHJhbnNwYXJlbnRDb3JuZXJzOiBmYWxzZSxcbiAgICAgIGJvcmRlclNjYWxlRmFjdG9yOiAwLjUsXG4gICAgICBib3JkZXJDb2xvcjogXCJvcmFuZ2VcIixcbiAgICAgIGNvcm5lckNvbG9yOiBcIm9yYW5nZVwiXG4gICAgfSxcbiAgICBTbGlkZUNhbnZhczoge1xuICAgICAgaGlzdG9yeVRvb2xzOiB0cnVlLFxuICAgICAgZHJvcHBhYmxlOiB0cnVlLFxuICAgICAgaW5jbHVkZURlZmF1bHRWYWx1ZXM6IGZhbHNlLFxuICAgICAgZGVmYXVsdEFyZWE6IFwiI19fMFwiLFxuICAgICAgaW5zZXJ0Wm9vbVRvb2xzOiB0cnVlLFxuICAgICAgYmFja2dyb3VuZFBvc2l0aW9uOiBcImNvdmVyXCJcbiAgICB9XG4gIH0sXG4gIHNhdmVEYXRhOiBmdW5jdGlvbigpe1xuXG4gICAgaWYodGhpcy5wcm9qZWN0KXtcbiAgICAgIHRoaXMuc2F2ZWREYXRhID0gdGhpcy5wcm9qZWN0LnRvT2JqZWN0KCk7XG4gICAgfWVsc2V7XG4gICAgICB0aGlzLnNhdmVkRGF0YSA9IHRoaXMuY2FudmFzLnRvT2JqZWN0KHRoaXMuY2FudmFzLnByb3BlcnRpZXNUb0luY2x1ZGUpXG4gICAgfVxuICAgIHZhciBpbnB1dCA9IGZhYnJpYy51dGlsLnN5bnRheC5zeW50YXhIaWdobGlnaHQoSlNPTi5zdHJpbmdpZnkodGhpcy5zbGlkZSB8fCB7fSxudWxsLCcgJykucmVwbGFjZSgvXCIoXFx3KylcIlxccyo6L2csICckMTonKSk7XG4gICAgdGhpcy4kZGlmZkVsMS5odG1sKGlucHV0KTtcbiAgICB2YXIgX2RpZmZlcmVuY2UgPSBmYWJyaWMudXRpbC5zeW50YXguZGlmZmVyZW5jZU1hcCh0aGlzLnNsaWRlIHx8IHt9LHRoaXMuc2F2ZWREYXRhKTtcbiAgICBmYWJyaWMudXRpbC5zeW50YXguZGlmZmVyZW5jZUhpZ2hsaWdodChfZGlmZmVyZW5jZSx0aGlzLiRkaWZmRWwpO1xuXG4gICAgdmFyIHNpemUgPSB0aGlzLiRkaWZmRWwudGV4dCgpLmxlbmd0aDtcbiAgICB0aGlzLiRvdXRwdXRTaXplLnRleHQoc2l6ZSlcbiAgfSxcbiAgYWN0aW9uczoge1xuICAgIHNhdmU6IHtcbiAgICAgIHRpdGxlOiBcImRvbmVcIixcbiAgICAgIGluc2VydCA6IFwiY29kZUJsb2NrXCIsXG4gICAgICBjbGFzc05hbWU6ICdmYSBmYS1mbG9wcHktbycsXG4gICAgICBhY3Rpb246IGZ1bmN0aW9uKCl7XG4gICAgICAgIHRoaXMuJGNvZGVCbG9jay5zaG93KCk7XG4gICAgICAgIHRoaXMuc2F2ZURhdGEoKTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIHRvb2xiYXI6IHtcbiAgICBhcHBsaWNhdGlvbjogIFwiYXBwbGljYXRpb24tbWVudVwiLFxuICAgIGNhbnZhczogICAgICAgXCJzbGlkZS1tZW51XCIsXG4gICAgb2JqZWN0czogIHtcbiAgICAgIGNvbnRhaW5lcjogXCJvYmplY3QtbWVudVwiLFxuICAgICAgbWFyZ2luWTogLTUwXG4gICAgfVxuICB9LFxuICBzbGlkZXNMaXN0OiBmYWxzZSxcbiAgb25DYW52YXNDcmVhdGVkOiBmdW5jdGlvbigpe1xuICAgIHRoaXMuYWRkVGl0bGUodGhpcy5vcHRpb25zLnRpdGxlIHx8IGRvY3VtZW50LnRpdGxlKTtcbiAgICAvL2lmICh0aGlzLiRjb250YWluZXIuYXR0cihcImRhdGEtc2VsZWN0b3JcIikgIT09IHVuZGVmaW5lZCkge1xuICAgIC8vICB0aGlzLmNyZWF0ZVNlbGVjdG9yKCk7XG4gICAgLy99XG4gICAgaWYodGhpcy5zbGlkZXNMaXN0KXtcbiAgICAgIHRoaXMuY3JlYXRlU2xpZGVzTGlzdCgpO1xuICAgIH1cblxuICAgIHRoaXMuY2FudmFzLm9uKCd2aWV3cG9ydDpzY2FsZWQnLGZ1bmN0aW9uKGUpe1xuICAgICAgJCh0aGlzLndyYXBwZXJFbCkuY3NzKFwiYmFja2dyb3VuZC1zaXplXCIgLFxuICAgICAgICBcIntzY2FsZX1weCB7c2NhbGV9cHgse3NjYWxlfXB4IHtzY2FsZX1weCwge3NjYWxlMn1weCB7c2NhbGUyfXB4LCB7c2NhbGUyfXB4IHtzY2FsZTJ9cHhcIlxuICAgICAgICAgIC5mb3JtYXQoe3NjYWxlOiBlLnNjYWxlICogMTAwICwgc2NhbGUyOiBlLnNjYWxlICogMjAuMDQgfSkpXG4gICAgfSlcbiAgfSxcbiAgY3JlYXRlQ29kZUJsb2NrOiBmdW5jdGlvbiAoY2FsbGJhY2spIHtcblxuICAgIHZhciBhcHAgPSB0aGlzO1xuICAgIHRoaXMuJGNvZGVCbG9jayA9ICQoXCIjY29kZS1ibG9ja1wiKTtcbiAgICB0aGlzLiRkaWZmRWwgPSAkKFwiPHByZT5cIik7XG4gICAgdGhpcy4kZGlmZkVsMSA9ICQoXCI8cHJlPlwiKTtcbiAgICB0aGlzLiRkaWZmRWwuYXR0cihcImNvbnRlbnRlZGl0YWJsZVwiLHRydWUpO1xuICAgIHZhciAkY2xvc2VCdXR0b24gPSAkKFwiPGJ1dHRvbiBjbGFzcz0nYnRuIGZhIGZhLXRpbWVzJz48L2J1dHRvbj5cIik7XG4gICAgJGNsb3NlQnV0dG9uLmNsaWNrKGZ1bmN0aW9uKCl7XG4gICAgICBhcHAuJGNvZGVCbG9jay5oaWRlKCk7XG4gICAgfSk7XG5cblxuICAgIHZhciAkbG9hZEJ1dHRvbiA9ICQoXCI8YnV0dG9uIGNsYXNzPSdidG4gZmEgZmEtcGxheS1jaXJjbGUgIGxvYWQtYnV0dG9uJz48L2J1dHRvbj5cIik7XG4gICAgJGxvYWRCdXR0b24uY2xpY2soZnVuY3Rpb24oKXtcbiAgICAgIC8vIGNvbnNvbGUubG9nKCk7XG4gICAgICBhcHAuc2xpZGUgPSBhcHAuc2F2ZWREYXRhO1xuICAgICAgYXBwLmNhbnZhcy5sb2FkKGFwcC5zYXZlZERhdGEsZnVuY3Rpb24oKXtcbiAgICAgICAgYXBwLnNhdmVEYXRhKCk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgICB0aGlzLiRjb2RlQmxvY2suZmluZChcIi5jb2RlLWNvbHVtblwiKS5yZW1vdmUoKTtcbiAgICB0aGlzLiRjb2RlQmxvY2suYXBwZW5kKFxuICAgICAgJChcIjxkaXYgY2xhc3M9J2NvZGUtY29sdW1uJz48aDI+SW5wdXQgZGF0YTwvaDI+XCIpLmFwcGVuZCh0aGlzLiRkaWZmRWwxKSxcbiAgICAgICQoXCI8ZGl2IGNsYXNzPSdjb2RlLWNvbHVtbic+PGgyPk91dHB1dCBkYXRhIDxzcGFuIGlkPSdzaXplJz48L3NwYW4+PC9oMj5cIikuYXBwZW5kKHRoaXMuJGRpZmZFbCksXG4gICAgICAkbG9hZEJ1dHRvbixcbiAgICAgICRjbG9zZUJ1dHRvblxuICAgICk7XG4gICAgdGhpcy4kb3V0cHV0U2l6ZSA9IHRoaXMuJGNvZGVCbG9jay5maW5kKFwiI3NpemVcIik7XG5cbiAgICB0aGlzLiRjb2RlQmxvY2suZHJhZ2dhYmxlKHtcbiAgICAgIGV4Y2x1ZGVFbGVtZW50cyA6IFwicHJlXCIsXG4gICAgfSkuZHBSZXNpemFibGUoKTtcbiAgfSxcbiAgc2V0Q29udGFpbmVyOiBmdW5jdGlvbiAoY2FsbGJhY2spIHtcblxuXG5cbiAgICB0aGlzLiRmZmNvbnRhaW5lciA9ICQoXCIuZmYtY29udGFpbmVyXCIpO1xuICAgIHRoaXMuJGNvbnRhaW5lciA9ICQoXCIueHgtY29udGFpbmVyXCIpO1xuICAgIGlmKCF0aGlzLiRjb250YWluZXIubGVuZ3RoKXtcbiAgICAgIHRoaXMuJGNvbnRhaW5lciA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcImZmLWNvbnRhaW5lclwiKTtcbiAgICAgICQoXCJib2R5XCIpLmFwcGVuZCh0aGlzLiRjb250YWluZXIpO1xuICAgIH1cblxuXG4gICAgdGhpcy4kY29udGFpbmVyLmFwcGVuZCgkKFxuICAgICAgJzxkaXYgY2xhc3M9XCJib3R0b20taW50ZXJmYWNlXCI+JyArXG4gICAgICAgICc8ZGl2IGNsYXNzPVwiYm90dG9tLWJ1dHRvbnNcIj4nICtcbiAgICAgICAgICAnPGRpdiBpZD1cInNsaWRlLW1lbnVcIiBjbGFzcz1cImlubGluZS1hY3Rpb25zIGNvbXBhY3RcIj48L2Rpdj4nICtcbiAgICAgICAgICAnPGRpdiBpZD1cImFwcGxpY2F0aW9uLW1lbnVcIiBjbGFzcz1cImlubGluZS1hY3Rpb25zIGNvbXBhY3RcIj48L2Rpdj4nICtcbiAgICAgICAgJzwvZGl2PicgK1xuICAgICAgJzwvZGl2PicgK1xuICAgICAgJzxkaXYgaWQ9XCJvYmplY3QtbWVudVwiIGNsYXNzPVwiaW5saW5lLWFjdGlvbnMgY29tcGFjdFwiPjwvZGl2PicgK1xuICAgICAgJzxkaXYgaWQ9XCJjb2RlLWJsb2NrXCI+PC9kaXY+J1xuICAgICkpO1xuXG4gICAgdGhpcy5jYW52YXNDb250YWluZXIgPSBmYWJyaWMudXRpbC5jcmVhdGVDYW52YXNFbGVtZW50KCk7XG4gICAgdGhpcy4kY29udGFpbmVyLmFwcGVuZCgkKHRoaXMuY2FudmFzQ29udGFpbmVyKSk7XG4gICAgLy90b2RvXG4gICAgdGhpcy5vcHRpb25zLmNhbnZhc0NvbnRhaW5lciA9IHRoaXMuY2FudmFzQ29udGFpbmVyO1xuICAgIGNhbGxiYWNrKCk7XG4gIH0sXG4gIHBvc3Rsb2FkZXI6IGZ1bmN0aW9uKCl7XG4gICAgaWYodGhpcy5jb2RlQmxvY2spe1xuICAgICAgdGhpcy5jcmVhdGVDb2RlQmxvY2soKTtcbiAgICB9XG5cbiAgICB0aGlzLmNyZWF0ZUhlbHAodGhpcy5hcnRpY2xlKTtcbiAgfSxcbiAgcHJlbG9hZGVyOiBmdW5jdGlvbihjYWxsYmFjayl7XG4gICAgaWYgKGRvY3VtZW50LmJvZHkpe1xuICAgICAgcmV0dXJuIHRoaXMuc2V0Q29udGFpbmVyKGNhbGxiYWNrKTtcbiAgICB9XG5cbiAgICBpZiAoZG9jdW1lbnQucmVhZHlTdGF0ZSA9PT0gXCJjb21wbGV0ZVwiKSB7XG4gICAgICB0aGlzLnNldENvbnRhaW5lcihjYWxsYmFjayk7XG4gICAgfWVsc2V7XG4gICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImxvYWRcIiwgZnVuY3Rpb24oKXtcbiAgICAgICAgdGhpcy5zZXRDb250YWluZXIoY2FsbGJhY2spO1xuICAgICAgfS5iaW5kKHRoaXMpLHRydWUpO1xuICAgIH1cbiAgfSxcbiAgbGlicmFyeU9wZW5lZDogZmFsc2UsXG4gIGNyZWF0ZVRhYjogZnVuY3Rpb24gKHRhYixvcHRpb25zKSB7XG4gICAgaWYoIXRoaXMuJHRhYnMpe1xuICAgICAgdGhpcy4kYXNpZGUgPSAkKFwiPGFzaWRlPlwiKTtcbiAgICAgIHRoaXMuJGNvbnRhaW5lci5hcHBlbmQodGhpcy4kYXNpZGUpO1xuICAgICAgdGhpcy4kdGFicyA9ICQoJzxkaXYgY2xhc3M9XCJmZi10YWJzXCI+Jyk7XG4gICAgICB0aGlzLiRhc2lkZS5hcHBlbmQodGhpcy4kdGFicyk7XG4gICAgfVxuXG4gICAgdmFyIHZhbHVlSUQgPSBmYWJyaWMudXRpbC5zdHJpbmcuY2FtZWxpemUodGFiKTtcbiAgICB2YXIgcGFuZWxJRCA9IFwiZmllcmEtcGFuZWwtXCIgKyBmYWJyaWMudXRpbC5zdHJpbmcuY2FtZWxpemUodGFiKTtcbiAgICB2YXIgdGFiSUQgPSBcImZpZXJhLXRhYi1cIiArIGZhYnJpYy51dGlsLnN0cmluZy5jYW1lbGl6ZSh0YWIpO1xuICAgIHZhciAkaW5wdXQgPSAkKCc8aW5wdXQgdHlwZT1cInJhZGlvXCIgbmFtZT1cInRhYnNcIj4nKS5hdHRyKFwiaWRcIix0YWJJRCkudmFsKHZhbHVlSUQpO1xuICAgIHZhciAkbGFiZWwgPSAkKCc8bGFiZWw+JykuYXR0cihcImZvclwiLHRhYklEKS5hdHRyKFwidGl0bGVcIix0YWIpLnRleHQodGFiKTtcblxuICAgIGlmKCF0aGlzLmxpYnJhcnlPcGVuZWQpIHtcbiAgICAgICRpbnB1dC5hdHRyKFwiY2hlY2tlZFwiLFwidHJ1ZVwiKTtcbiAgICB9XG4gICAgdGhpcy4kdGFicy5hcHBlbmQoJGlucHV0LCRsYWJlbCk7XG5cbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICRsYWJlbC5jbGljayhmdW5jdGlvbigpe1xuICAgICAgaWYoIV90aGlzLmxpYnJhcnlPcGVuZWQgfHwgX3RoaXMuc2VsZWN0ZWRUYWIgPT0gJGlucHV0LnZhbCgpKXtcbiAgICAgICAgX3RoaXMubGlicmFyeU9wZW5lZCA9ICFfdGhpcy5saWJyYXJ5T3BlbmVkO1xuICAgICAgICBfdGhpcy4kZmZjb250YWluZXIudG9nZ2xlQ2xhc3MoXCJsaWJyYXJ5LW9wZW5lZFwiKTtcbiAgICAgIH1cbiAgICAgIF90aGlzLnNlbGVjdGVkVGFiID0gJGlucHV0LnZhbCgpO1xuICAgICAgX3RoaXMuJGFzaWRlLmZpbmQoXCIuZWxlbWVudHNcIikuaGlkZSgpLmZpbHRlcihcIiNcIiArIHBhbmVsSUQpLnNob3coKTtcbiAgICB9KTtcblxuICAgIGlmKHRoaXMubGlicmFyeU9wZW5lZCA9PT0gdHJ1ZSB8fCB0aGlzLmxpYnJhcnlPcGVuZWQgPT09IFwidGFiXCIpIHtcbiAgICAgIHRoaXMuJGZmY29udGFpbmVyLmFkZENsYXNzKFwibGlicmFyeS1vcGVuZWRcIik7XG4gICAgICB0aGlzLmxpYnJhcnlPcGVuZWQgPSB0cnVlO1xuICAgICAgdGhpcy5zZWxlY3RlZFRhYiA9IHZhbHVlSUQ7XG4gICAgfVxuXG4gICAgdmFyICRlbGVtZW50c0xpc3QgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJlbGVtZW50c1wiKS5hdHRyKFwiaWRcIixwYW5lbElEKTtcbiAgICB0aGlzLiRhc2lkZS5hcHBlbmQoJGVsZW1lbnRzTGlzdCk7XG5cbiAgICBpZih0aGlzLnNlbGVjdGVkVGFiICE9IHZhbHVlSUQpe1xuICAgICAgJGVsZW1lbnRzTGlzdC5oaWRlKCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIG9wdGlvbnM6IG9wdGlvbnMsXG4gICAgICB0YWI6IHRhYixcbiAgICAgIGxhYmVsOiAkbGFiZWwsXG4gICAgICBpbnB1dDogJGlucHV0LFxuICAgICAgbGlzdDogJGVsZW1lbnRzTGlzdFxuICAgIH1cbiAgfSxcbiAgY3JlYXRlRm9udHNMaXN0OiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGxpYnJhcnkgPSBbXTtcbiAgICBmb3IodmFyIGkgaW4gdGhpcy5fZm9udHMpIHtcbiAgICAgIGxpYnJhcnkucHVzaCh7XG4gICAgICAgIGZvbnRGYW1pbHk6IHRoaXMuX2ZvbnRzW2ldLFxuICAgICAgICBmb250U2l6ZTogMjUsXG4gICAgICAgIGNhdGVnb3J5OiBcImZvbnRGYW1pbHlcIixcbiAgICAgICAgdGV4dDogdGhpcy5fZm9udHNbaV0sXG4gICAgICAgIHR5cGU6IFwidGV4dFwiXG4gICAgICB9KVxuICAgIH1cbiAgICB0aGlzLmNyZWF0ZUVsZW1lbnRzTGlzdChcIkZvbnRzXCIsbGlicmFyeSk7XG4gIH0sXG4gIF9hZGRDYW52YXNFbDogZnVuY3Rpb24gKGVsLCBlbGVtZW50LCRpbm5lckVsKXtcblxuICAgIC8vIGVsZW1lbnQgPSBmYWJyaWMudXRpbC5vYmplY3QuY2xvbmVEZWVwKGVsZW1lbnQpO1xuXG4gICAgdmFyIGNhbnZhc0VsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKTtcbiAgICBjYW52YXNFbC53aWR0aCA9IDE1NjtcbiAgICBjYW52YXNFbC5oZWlnaHQgPSA4NjtcblxuICAgIHZhciBfZmFrZV9jYW52YXMgPSBuZXcgZmFicmljLlNsaWRlQ2FudmFzKGNhbnZhc0VsLHthcHBsaWNhdGlvbjogdGhpc30pO1xuICAgIF9mYWtlX2NhbnZhcy5jbGVhcigpO1xuXG4gICAgX2Zha2VfY2FudmFzLmNyZWF0ZU9iamVjdChlbGVtZW50LGZ1bmN0aW9uKF9vYmplY3Qpe1xuICAgICAgdmFyIGIgPSBfb2JqZWN0LmdldEJvdW5kaW5nUmVjdCgpO1xuICAgICAgX29iamVjdC5zZXQoe1xuICAgICAgICBsZWZ0IDogODAgLSBiLndpZHRoLzIgLSBfb2JqZWN0LnN0cm9rZVdpZHRoICogMixcbiAgICAgICAgdG9wIDogNDUgLSBiLmhlaWdodC8yIC0gX29iamVjdC5zdHJva2VXaWR0aCAqIDJcbiAgICAgIH0pO1xuICAgICAgZWxlbWVudC5zY2FsZVggPSBfb2JqZWN0LnNjYWxlWDtcbiAgICAgIGVsZW1lbnQuc2NhbGVZID0gX29iamVjdC5zY2FsZVk7XG4gICAgICBlbGVtZW50LndpZHRoID0gX29iamVjdC53aWR0aDtcbiAgICAgIGVsZW1lbnQuaGVpZ2h0ID0gX29iamVjdC5oZWlnaHQ7XG4gICAgICBlbGVtZW50LmxlZnQgPSBfb2JqZWN0LmxlZnQ7XG4gICAgICBlbGVtZW50LnRvcCA9IF9vYmplY3QudG9wO1xuICAgICAgZWxlbWVudC5zdHJva2VXaWR0aCA9IF9vYmplY3Quc3Ryb2tlV2lkdGg7XG5cbiAgICAgIF9mYWtlX2NhbnZhcy5yZW5kZXJBbGwoKTtcblxuICAgICAgJGlubmVyRWxbMF0uc3JjID0gY2FudmFzRWwudG9EYXRhVVJMKCk7XG5cbiAgICAgIGRlbGV0ZSBfb2JqZWN0LmNhbnZhcztcbiAgICAgIGVsWzBdLmRhdGEgPSBlbGVtZW50O1xuICAgICAgZWxbMF0uZWxlbWVudCA9IF9vYmplY3Q7XG5cbiAgICB9KTtcbiAgfSxcbiAgdXBkYXRlRWxlbWVudHNMaXN0OiBmdW5jdGlvbihsaXN0LCBsaWJyYXJ5KXtcblxuICAgIHZhciBhcHAgPSB0aGlzO1xuICAgIGZvciAodmFyIGkgaW4gbGlicmFyeSkge1xuICAgICAgdmFyIGVsZW1lbnQgPSBsaWJyYXJ5W2ldO1xuICAgICAgdmFyIGVsID0gJChcIjxzcGFuPlwiKVxuICAgICAgICAuYWRkQ2xhc3MoXCJsaXN0LWl0ZW1cIik7XG5cbiAgICAgIGVsWzBdLmRhdGEgPSBlbGVtZW50O1xuXG4gICAgICBpZihsaXN0Lm9wdGlvbnMuZWxlbWVudCl7XG4gICAgICAgIGVsZW1lbnQgPSBsaXN0Lm9wdGlvbnMuZWxlbWVudChlbGVtZW50KTtcbiAgICAgIH1cblxuXG5cbiAgICAgIGlmKGVsZW1lbnQudGl0bGUpe1xuICAgICAgICB2YXIgJHNwYW4gPSAkKFwiPHNwYW4+XCIpLnRleHQoZWxlbWVudC50aXRsZSkuYWRkQ2xhc3MoXCJlbGVtZW50LXRpdGxlXCIpO1xuICAgICAgICBlbC5hcHBlbmQoJHNwYW4pO1xuICAgICAgfVxuICAgICAgdmFyICRpbm5lckVsID0gbnVsbDtcblxuICAgICAgaWYobGlzdC5vcHRpb25zLnJlbmRlcil7XG4gICAgICAgICRpbm5lckVsID0gbGlzdC5vcHRpb25zLnJlbmRlcihlbGVtZW50KTtcbiAgICAgIH1lbHNle1xuICAgICAgICBpZihlbGVtZW50LmNhdGVnb3J5ID09IFwiZm9udEZhbWlseVwiKXtcbiAgICAgICAgICAkaW5uZXJFbCA9ICQoXCI8c3Bhbj5cIikuY3NzKHtcbiAgICAgICAgICAgIFwiY29sb3JcIjogZWxlbWVudC5maWxsIHx8IGZhYnJpYy5UZXh0LnByb3RvdHlwZS5maWxsLFxuICAgICAgICAgICAgXCJmb250LWZhbWlseVwiOiBlbGVtZW50LmZvbnRGYW1pbHksXG4gICAgICAgICAgICBcImZvbnQtc2l6ZVwiOiAgIGVsZW1lbnQuZm9udFNpemVcbiAgICAgICAgICB9KS50ZXh0KGVsZW1lbnQudGV4dCk7XG4gICAgICAgIH1lbHNle1xuXG4gICAgICAgICAgc3dpdGNoIChlbGVtZW50LnR5cGUpIHtcbiAgICAgICAgICAgIGNhc2UgXCJpbWFnZVwiOlxuICAgICAgICAgICAgICAkaW5uZXJFbCA9ICQoXCI8aW1nPlwiKS5hdHRyKHtcbiAgICAgICAgICAgICAgICBzcmM6IGZhYnJpYy51dGlsLm1lZGlhUm9vdCArIGVsZW1lbnQuc3JjXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICBlbFswXS5lbGVtZW50ID0gJGlubmVyRWxbMF07XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcInZpZGVvXCI6XG4gICAgICAgICAgICAgICRpbm5lckVsID0gJChcIjx2aWRlbz5cIik7XG4gICAgICAgICAgICAgIGZvciAodmFyIHR5cGUgaW4gZWxlbWVudC5zcmMpIHtcbiAgICAgICAgICAgICAgICAkaW5uZXJFbC5hcHBlbmQoJChcIjxzb3VyY2U+XCIpLmF0dHIoe1xuICAgICAgICAgICAgICAgICAgc3JjOiBmYWJyaWMudXRpbC5tZWRpYVJvb3QgKyBlbGVtZW50LnNyY1t0eXBlXSxcbiAgICAgICAgICAgICAgICAgIHR5cGU6IHR5cGVcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgZWxbMF0uZWxlbWVudCA9ICRpbm5lckVsWzBdO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICRpbm5lckVsID0gJChcIjxpbWcgd2lkdGg9MTYwIGhlaWdodD05MD5cIik7XG4gICAgICAgICAgICAgIHRoaXMuX2FkZENhbnZhc0VsKGVsLCBlbGVtZW50LCRpbm5lckVsKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmKCRpbm5lckVsLmNvbnN0cnVjdG9yID09IEFycmF5KXtcbiAgICAgICAgdmFyIF9zcGFuID0gJChcIjxzcGFuPlwiKTtcbiAgICAgICAgX3NwYW4uYXBwZW5kKCRpbm5lckVsKTtcbiAgICAgICAgJGlubmVyRWwgPSBfc3BhbjtcbiAgICAgIH1cbiAgICAgIGVsLmFwcGVuZCgkaW5uZXJFbCk7XG5cblxuICAgICAgaWYobGlzdC5vcHRpb25zLmRyYWdnYWJsZSl7XG4gICAgICAgICRpbm5lckVsLmRyYWdnYWJsZSh7XG4gICAgICAgICAgZHJhZ2dhYmxlOiBcImhlbHBlclwiLFxuICAgICAgICAgIGRyb3BwYWJsZTogXCIuY2FudmFzLWNvbnRhaW5lclwiLFxuICAgICAgICAgIG5nTW9kZWw6IGVsZW1lbnQsXG4gICAgICAgICAgb25Nb3ZlOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgYXBwLmNhbnZhcy5fb25EcmFnTW92ZSAmJiBhcHAuY2FudmFzLl9vbkRyYWdNb3ZlKGRhdGEuJGV2ZW50KTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIG9uRHJvcDogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIGFwcC5jYW52YXMuX29uRHJvcChkYXRhLiRldmVudCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBkcmFnZ2FibGVBcmVhOiBcIi5mZi1jb250YWluZXJcIlxuICAgICAgICB9KVxuICAgICAgfTtcblxuICAgICAgJGlubmVyRWwuY2xpY2sobGlzdC5vcHRpb25zLmFjdGl2YXRlLmJpbmQodGhpcyxlbFswXSkpO1xuXG4gICAgICBsaXN0Lmxpc3QuYXBwZW5kKGVsKTtcblxuICAgIH1cbiAgfSxcbiAgY3JlYXRlRWxlbWVudHNMaXN0OiBmdW5jdGlvbiAodGFiLGxpYnJhcnksb3B0aW9ucykge1xuICAgIG9wdGlvbnMgPSBmYWJyaWMudXRpbC5vYmplY3QuZGVmYXVsdHMob3B0aW9ucyB8fCB7fSx7XG4gICAgICBkcmFnZ2FibGU6IHRydWUsXG4gICAgICBhY3RpdmF0ZTogZnVuY3Rpb24gKGVsKSB7XG4gICAgICAgIGlmKHRoaXMudGFyZ2V0ICYmIHRoaXMudGFyZ2V0LnNldEVsZW1lbnQpe1xuICAgICAgICAgIHRoaXMudGFyZ2V0LnNldEVsZW1lbnQoZWwuZGF0YSk7XG4gICAgICAgIH1lbHNle1xuXG4gICAgICAgICAgdGhpcy5jYW52YXMuY3JlYXRlT2JqZWN0KGZhYnJpYy51dGlsLm9iamVjdC5kZWVwRXh0ZW5kKHtcbiAgICAgICAgICAgIHBvc2l0aW9uOiBcImNlbnRlclwiXG4gICAgICAgICAgfSxlbC5kYXRhKSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgICB2YXIgbGlzdCA9IHRoaXMuY3JlYXRlVGFiKHRhYiwgb3B0aW9ucyk7XG4gICAgdGhpcy51cGRhdGVFbGVtZW50c0xpc3QobGlzdCwgbGlicmFyeSk7XG4gICAgcmV0dXJuIGxpc3Q7XG4gIH0sXG4gIGNyZWF0ZVNlbGVjdG9yOiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgdmFyIGxpc3QgPSB7XG4gICAgICBcIkNsaXBhcnRcIjogICAgICBcImNsaXBhcnQuaHRtbFwiLFxuICAgICAgXCJGaWx0ZXJzXCI6ICAgICAgXCJmaWx0ZXJzLmh0bWxcIixcbiAgICAgIFwiR3JpZHNuYXBwZXJcIjogIFwiZ3JpZHNuYXBwZXIuaHRtbFwiLFxuICAgICAgXCJCdWJibGVzXCI6ICAgICAgXCJidWJibGVzLmh0bWxcIixcbiAgICAgIFwiUGhvdG9cIjogICAgICAgIFwicGhvdG8uaHRtbFwiLFxuICAgICAgXCJQbGFjZWhvbGRlclwiOiAgXCJwbGFjZWhvbGRlci5odG1sXCIsXG4gICAgICBcIlZpZGVvXCI6ICAgICAgICBcInZpZGVvLmh0bWxcIixcbiAgICAgIFwiUHJvamVjdFwiOiAgICAgIFwicHJvamVjdC5odG1sXCIsXG4gICAgICBcIlRleHRGcmFtZVwiOiAgICBcInRleHRGcmFtZS5odG1sXCIsXG4gICAgICBcIkZpbGxlclwiOiAgICAgICBcImdudC1zb2x1dGlvbnMvaW5kZXguaHRtbFwiLFxuICAgICAgXCJGcmFtZXNcIjogICAgICAgXCJmcmFtZXMuaHRtbFwiXG4gICAgfTtcblxuICAgIGlmICghYXBwLiRzZWxlY3Rvcikge1xuICAgICAgYXBwLiRzZWxlY3RvciA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcInNlbGVjdG9yXCIpO1xuXG5cbiAgICAgIHZhciAkc3BhbiA9ICQoXCI8c3Bhbj5cIikudGV4dChcIuKWvFwiKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgIGFwcC4kc2VsZWN0b3IuYWRkQ2xhc3MoXCJvcGVuZWRcIik7XG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gY2xvc2VTZWxlY3RvcigpIHtcbiAgICAgICAgICAkKFwiLnNlbGVjdG9yXCIpLnJlbW92ZUNsYXNzKFwib3BlbmVkXCIpO1xuICAgICAgICB9LCB0cnVlKTtcbiAgICAgIH0pO1xuXG4gICAgICBhcHAuJHNlbGVjdG9yLmFwcGVuZCgkc3Bhbik7XG5cbiAgICAgIGFwcC4kY29udGFpbmVyLmFwcGVuZChhcHAuJHNlbGVjdG9yKTtcbiAgICAgIGFwcC4kc2VsZWN0b3JMaXN0ID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwic2VsZWN0b3ItbGlzdFwiKTtcbiAgICAgIGFwcC4kc2VsZWN0b3IuYXBwZW5kKGFwcC4kc2VsZWN0b3JMaXN0KTtcblxuICAgICAgZm9yICh2YXIgaSBpbiBsaXN0KSB7XG4gICAgICAgIHZhciAkYSA9ICQoXCI8YT5cIikuYXR0cihcImhyZWZcIiwgYXBwLmRlbW9Sb290ICsgbGlzdFtpXSkudGV4dChpKTtcbiAgICAgICAgYXBwLiRzZWxlY3Rvckxpc3QuYXBwZW5kKCRhKTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIGRlbW9Sb290OiBcIlwiLFxuICBjcmVhdGVTbGlkZXNMaXN0OiBmdW5jdGlvbiAoKSB7XG5cbiAgICB2YXIgJGJvdHRvbSA9IHRoaXMuJGNvbnRhaW5lci5maW5kKFwiLmJvdHRvbS1pbnRlcmZhY2VcIik7XG4gICAgdmFyICRib3R0b21CdXR0b25zID0gJGJvdHRvbS5maW5kKFwiLmJvdHRvbS1idXR0b25zXCIpO1xuXG4gICAgdGhpcy4kc2xpZGVzQnV0dG9uID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwic2xpZGVzLWJ1dHRvbiBmYSBmYS1tYXAtb1wiKTtcbiAgICB2YXIgJHNsaWRlTGlzdCA9IHRoaXMuJHNsaWRlc0xpc3QgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJzbGlkZXMtbGlzdFwiKTtcbiAgICB2YXIgJHNsaWRlTGlzdElubmVyID0gJChcIjxkaXY+XCIpLmFkZENsYXNzKFwic2xpZGVzLWxpc3QtaW5uZXJcIik7XG4gICAgJHNsaWRlTGlzdC5hcHBlbmQoJHNsaWRlTGlzdElubmVyKTtcblxuICAgICRib3R0b20uYXBwZW5kKHRoaXMuJHNsaWRlc0xpc3QpO1xuICAgICRib3R0b21CdXR0b25zLmFwcGVuZCh0aGlzLiRzbGlkZXNCdXR0b24pO1xuXG4gICAgdGhpcy4kY29udGFpbmVyLmFkZENsYXNzKFwic2xpZGVzLW9wZW5lZFwiKTtcbiAgICB0aGlzLiRzbGlkZXNCdXR0b24uY2xpY2soZnVuY3Rpb24oKXtcbiAgICAgIHRoaXMuJGNvbnRhaW5lci50b2dnbGVDbGFzcyhcInNsaWRlcy1vcGVuZWRcIik7XG4gICAgfS5iaW5kKHRoaXMpKTtcblxuICAgIHZhciBwcm9qZWN0ID0gdGhpcy5wcm9qZWN0O1xuXG4gICAgcHJvamVjdC5zbGlkZXMuZm9yRWFjaChmdW5jdGlvbihfc2xpZGUpe1xuXG4gICAgICB2YXIgX2NhbnZhc0VsID0gZmFicmljLnV0aWwuY3JlYXRlQ2FudmFzRWxlbWVudCgpO1xuICAgICAgX2NhbnZhc0VsLnNldEF0dHJpYnV0ZShcImhlaWdodFwiLDE1MCk7XG4gICAgICBmYWJyaWMudXRpbC5jcmVhdGVUaHVtYihfc2xpZGUsX2NhbnZhc0VsKTtcblxuICAgICAgdmFyICRzbGlkZSA9ICQoXCI8ZGl2PlwiKVxuICAgICAgICAuYWRkQ2xhc3MoXCJzbGlkZVwiKVxuICAgICAgICAuY2xpY2soZnVuY3Rpb24oKXtcbiAgICAgICAgICBwcm9qZWN0LnNldEFjdGl2ZVNsaWRlKF9zbGlkZSlcbiAgICAgICAgfSlcbiAgICAgICAgLmFwcGVuZChfY2FudmFzRWwpXG4gICAgICAgIC5hcHBlbmQoJChcIjxzcGFuPlwiKS5odG1sKF9zbGlkZS50aXRsZSkpO1xuXG4gICAgICAkc2xpZGVMaXN0SW5uZXIuYXBwZW5kKCRzbGlkZSk7XG4gICAgfSk7XG5cbiAgfSxcbiAgX191c2VNYXJrRG93bjogZnVuY3Rpb24gKGVsLF9jb250ZW50KSB7XG5cbiAgICB2YXIgbWQgPSBNYXJrRG93bkl0KHtcbiAgICAgIGhpZ2hsaWdodDogZnVuY3Rpb24gKHN0ciwgbGFuZykge1xuICAgICAgICBpZiAobGFuZyAmJiBobGpzLmdldExhbmd1YWdlKGxhbmcpKSB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHJldHVybiBobGpzLmhpZ2hsaWdodChsYW5nLCBzdHIpLnZhbHVlO1xuICAgICAgICAgIH0gY2F0Y2ggKF9fKSB7fVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuICcnOyAvLyB1c2UgZXh0ZXJuYWwgZGVmYXVsdCBlc2NhcGluZ1xuICAgICAgfVxuICAgIH0pO1xuICAgIC8vIHZhciBobGpzID0gcmU/cXVpcmUoJ2hpZ2hsaWdodC5qcycpOyAvLyBodHRwczovL2hpZ2hsaWdodGpzLm9yZy9cblxuXG4gICAgZWwuaHRtbChtZC5yZW5kZXIoX2NvbnRlbnQpKTtcbiAgfSxcbiAgY3JlYXRlSGVscDogZnVuY3Rpb24gKGhlbHBGaWxlKSB7XG4gICAgdmFyIGFwcCA9IHRoaXM7XG5cbiAgICBpZiAoIWhlbHBGaWxlKSB7XG4gICAgICB2YXIgYXJ0aWNsZSA9ICQoXCJhcnRpY2xlXCIpO1xuICAgICAgdmFyIF9jb250ZW50ID0gYXJ0aWNsZS5odG1sKCk7XG4gICAgICBhcnRpY2xlLnJlbW92ZSgpO1xuICAgIH1cblxuICAgIGFwcC4kaGVscEFydGljbGUgPSAkKFwiPGFydGljbGU+XCIpLmFkZENsYXNzKFwiaGVscC1hcnRpY2xlXCIpLmhpZGUoKTtcbiAgICBhcHAuJGhlbHBUaXRsZSA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcImhlbHAtdGl0bGVcIik7XG4gICAgYXBwLiRoZWxwQ29udGVudCA9ICQoXCI8ZGl2PlwiKS5hZGRDbGFzcyhcImhlbHAtY29udGVudFwiKS5hZGRDbGFzcyhcIm1hcmtkb3duLWJvZHlcIik7XG5cbiAgICBhcHAuJGhlbHBBcnRpY2xlLmFwcGVuZChhcHAuJGhlbHBUaXRsZSwgYXBwLiRoZWxwQ29udGVudCk7XG5cblxuICAgIGFwcC4kaGVscE9wZW5CdXR0b24gPSAkKFwiPGE+XCIpLyouYXR0cihcImhyZWZcIiwgXCIjaGVscFwiKSovLmFkZENsYXNzKFwiaGVscC1idXR0b25cIikudGV4dChcIj9cIik7XG4gICAgYXBwLiRoZWxwQ2xvc2VCdXR0b24gPSAkKFwiPGE+XCIpLyouYXR0cihcImhyZWZcIiwgXCIjXCIpKi8uYWRkQ2xhc3MoXCJoZWxwLWJ1dHRvblwiKS50ZXh0KFwiw5dcIik7XG5cbiAgICBhcHAuJGhlbHBPcGVuQnV0dG9uLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgIGFwcC4kaGVscEFydGljbGUuc2hvdygpO1xuICAgICAgYXBwLiRoZWxwT3BlbkJ1dHRvbi5oaWRlKCk7XG4gICAgICBhcHAuJGhlbHBDbG9zZUJ1dHRvbi5zaG93KCk7XG4gICAgICBhcHAuaGVscENvbnRlbnRDYWxsYmFjayAmJiBhcHAuaGVscENvbnRlbnRDYWxsYmFjaygpO1xuICAgIH0pO1xuICAgIGFwcC4kaGVscENsb3NlQnV0dG9uLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgIGFwcC4kaGVscEFydGljbGUuaGlkZSgpO1xuICAgICAgYXBwLiRoZWxwT3BlbkJ1dHRvbi5zaG93KCk7XG4gICAgICBhcHAuJGhlbHBDbG9zZUJ1dHRvbi5oaWRlKCk7XG4gICAgfSkuaGlkZSgpO1xuXG4gICAgLy9cbiAgICAvLyBpZiAodHJ1ZSkge1xuICAgIC8vICAgY29uc29sZS5sb2codHJ1ZSk7XG4gICAgLy8gICAvLyBmYWJyaWMudXRpbC5kYXRhLmxvYWRKc29uKClcbiAgICAvL1xuICAgIC8vICAgLy8gZmFicmljLnV0aWwubG9hZEpzb24oKVxuICAgIC8vICAgLy8gZmFicmljLnV0aWwubG9hZEpzb24oKVxuICAgIC8vIH1cblxuXG5cbiAgICBpZiAoaGVscEZpbGUpIHtcbiAgICAgIGlmKGhlbHBGaWxlLnN0YXJ0c1dpdGgoXCJkb3g6XCIpKXtcbiAgICAgICAgZmFicmljLnV0aWwuZGF0YS5sb2FkSnNvbihoZWxwRmlsZS5zdWJzdHIoNCksZnVuY3Rpb24oZGF0YSl7XG4gICAgICAgICAgYXBwLiRjb250YWluZXIuYXBwZW5kKGFwcC4kaGVscEFydGljbGUpO1xuICAgICAgICAgIHZhciAkZnVsbFByZSA9ICQoXCI8cHJlIGNsYXNzPSdsYW5ndWFnZS1qYXZhc2NyaXB0Jz5cIik7XG4gICAgICAgICAgLy8gYXBwLiRoZWxwQ29udGVudC5hcHBlbmQoJGZ1bGxQcmUpO1xuICAgICAgICAgIGRhdGEuZm9yRWFjaChmdW5jdGlvbihpdGVtLGluZGV4KXtcbiAgICAgICAgICAgIGlmKCFpdGVtLmNvZGUpe1xuICAgICAgICAgICAgICBpdGVtLmNvZGUgPSBcIlwiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGxpbmVzID0gaXRlbS5jb2RlLnNwbGl0KFwiXFxuXCIpO1xuICAgICAgICAgICAgZm9yKHZhciBpID0gbGluZXMubGVuZ3RoIDsgaS0tOykge1xuICAgICAgICAgICAgICBpZihsaW5lc1tpXS50cmltKCkubGVuZ3RoID09IDApe1xuICAgICAgICAgICAgICAgIGxpbmVzLnNwbGljZShpLDEpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmKF8uZmluZFdoZXJlKGl0ZW0udGFncyx7dHlwZTogXCJjb2xsYXBzZWRcIn0pKXtcbiAgICAgICAgICAgICAgdmFyIF9pZGVudCA9IGxpbmVzWzBdLmxlbmd0aCAtIGxpbmVzWzBdLnRyaW0oKS5sZW5ndGg7XG4gICAgICAgICAgICAgIHZhciB0YWlsID0gXCJcIjtcbiAgICAgICAgICAgICAgZm9yKHZhciBpID0gMSA7IGkgPCBsaW5lcy5sZW5ndGggOyBpKyspIHtcbiAgICAgICAgICAgICAgICBpZiAobGluZXNbaV0ubGVuZ3RoIC0gbGluZXNbaV0udHJpbSgpLmxlbmd0aCA8IF9pZGVudCkge1xuICAgICAgICAgICAgICAgICAgdGFpbCA9IGxpbmVzLnNwbGljZShpKS5qb2luKFwiXFxuXCIpXG4gICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgdmFyIF9jb2RlID0gbGluZXMuam9pbihcIlxcblwiKTtcblxuICAgICAgICAgICAgICB2YXIgJHNwb2lsZXJUcmlnZ2VyID0gJChcIjxkaXYgY2xhc3M9J3Nwb2lsZXItdHJpZ2dlcic+XCIpO1xuICAgICAgICAgICAgICB2YXIgJHNwb2lsZXIgPSAkKFwiPGRpdiBjbGFzcz0nc3BvaWxlcic+XCIpLnRleHQoX2NvZGUuc3Vic3RyKF9jb2RlLmluZGV4T2YoXCJ7XCIpICAsX2NvZGUubGFzdEluZGV4T2YoXCJ9XCIpICApKTtcbiAgICAgICAgICAgICAgJGZ1bGxQcmUuYXBwZW5kKFxuICAgICAgICAgICAgICAgIFwiLyoqLyxcIixcbiAgICAgICAgICAgICAgICBfY29kZS5zdWJzdHIoMCxfY29kZS5pbmRleE9mKFwie1wiKSApLFxuICAgICAgICAgICAgICAgICRzcG9pbGVyVHJpZ2dlcixcbiAgICAgICAgICAgICAgICAkc3BvaWxlcixcbiAgICAgICAgICAgICAgICBfY29kZS5zdWJzdHIoX2NvZGUubGFzdEluZGV4T2YoXCJ9XCIpICsgMSksXG4gICAgICAgICAgICAgICAgXCJcXG5cIixcbiAgICAgICAgICAgICAgICB0YWlsXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgdmFyIF9jb2RlID0gbGluZXMuam9pbihcIlxcblwiKTtcbiAgICAgICAgICAgICAgJGZ1bGxQcmUuYXBwZW5kKFxuICAgICAgICAgICAgICAgIFwiLyoqLyxcIixcbiAgICAgICAgICAgICAgICBfY29kZVxuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgLy8gJGZ1bGxQcmVbMF0udGV4dENvbnRlbnQgPSBcIlwiO1xuICAgICAgICAgIGhsanMuaGlnaGxpZ2h0QmxvY2soJGZ1bGxQcmVbMF0pO1xuXG4gICAgICAgICAgdmFyIGxpbmVzID0gJGZ1bGxQcmUuaHRtbCgpLnNwbGl0KCc8c3BhbiBjbGFzcz1cImhsanMtY29tbWVudFwiPi8qKi88L3NwYW4+LCcpO1xuICAgICAgICAgIGxpbmVzLnNwbGljZSgwLDEpO1xuXG4gICAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IGxpbmVzLmxlbmd0aCA7IGkrKykge1xuICAgICAgICAgICAgdmFyIGl0ZW0gPSBkYXRhW2ldO1xuXG5cbiAgICAgICAgICAgIGl0ZW0udGFncy5mb3JFYWNoKGZ1bmN0aW9uKHRhZyl7XG4gICAgICAgICAgICAgIGl0ZW0udGFnc1t0YWcudHlwZV0gPSB0YWc7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgdmFyICRsaW5lID0gJChcIjxkaXYgY2xhc3M9J2RveC1saW5lJz5cIik7XG4gICAgICAgICAgICB2YXIgJGxlZnQgPSAkKFwiPGRpdiBjbGFzcz0nZG94LWxlZnQtY29sdW1uJz57ZGVzY3JpcHRpb24uZnVsbH08L2Rpdj5cIi5mb3JtYXQoaXRlbSkpO1xuICAgICAgICAgICAgdmFyICRjb2RlID0gJChcIjxwcmU+XCIpLmh0bWwobGluZXNbaV0pO1xuICAgICAgICAgICAgJGxpbmUuYXBwZW5kKCRsZWZ0LCAkY29kZSk7XG4gICAgICAgICAgICBhcHAuJGhlbHBDb250ZW50LmFwcGVuZCgkbGluZSk7XG5cbiAgICAgICAgICAgIGlmKGl0ZW0udGFncy5jb2xsYXBzZWQpe1xuICAgICAgICAgICAgICAkY29kZS5maW5kKFwiLnNwb2lsZXItdHJpZ2dlclwiKS5hcHBlbmQoJGNvZGUuZmluZChcIi5zcG9pbGVyXCIpKS5jbGljayhmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICQodGhpcykudG9nZ2xlQ2xhc3MoXCJjb2xsYXBzZWRcIilcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH1cblxuXG4gICAgICAgICAgICBpZihpdGVtLnRhZ3MubW9kdWxlKXtcbiAgICAgICAgICAgICAgdmFyICRwb3B1cCA9ICQoXCI8ZGl2IGNsYXNzPSdwb3B1cCc+QG1vZHVsZToge3RhZ3MubW9kdWxlLnN0cmluZ308L2Rpdj5cIi5mb3JtYXQoaXRlbSkpO1xuICAgICAgICAgICAgICAkKCRjb2RlLmNoaWxkcmVuKClbMF0pLmFkZENsYXNzKFwieHh4XCIpLnByZXBlbmQoJHBvcHVwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG5cblxuICAgICAgICAgIC8vIGhsanMuaGlnaGxpZ2h0QmxvY2soJGZ1bGxQcmVbMF0gKTtcblxuXG4gICAgICAgICAgYXBwLiRjb250YWluZXIuYXBwZW5kKGFwcC4kaGVscE9wZW5CdXR0b24pO1xuICAgICAgICAgIGFwcC4kY29udGFpbmVyLmFwcGVuZChhcHAuJGhlbHBDbG9zZUJ1dHRvbik7XG4gICAgICAgIH0pO1xuICAgICAgfWVsc2V7XG5cbiAgICAgICAgYXBwLiRoZWxwQ29udGVudC5sb2FkKGhlbHBGaWxlLCBmdW5jdGlvbiAoKSB7XG5cblxuICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIGgxID0gJChcIjxoMT5cIikudGV4dChkb2N1bWVudC50aXRsZSk7XG4gICAgICAgICAgICBhcHAuJGhlbHBUaXRsZS5hcHBlbmQoaDEpO1xuICAgICAgICAgICAgaWYoL1xcLm1kJC8udGVzdChoZWxwRmlsZSkpe1xuICAgICAgICAgICAgICBhcHAuX191c2VNYXJrRG93bihhcHAuJGhlbHBDb250ZW50LGFwcC4kaGVscENvbnRlbnQudGV4dCgpKVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgYXBwLiRjb250YWluZXIuYXBwZW5kKGFwcC4kaGVscEFydGljbGUpO1xuICAgICAgICAgIGFwcC4kY29udGFpbmVyLmFwcGVuZChhcHAuJGhlbHBPcGVuQnV0dG9uKTtcbiAgICAgICAgICBhcHAuJGNvbnRhaW5lci5hcHBlbmQoYXBwLiRoZWxwQ2xvc2VCdXR0b24pO1xuICAgICAgICB9KTtcblxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBpZihhcHAudXNlTWFya0Rvd24gJiYgTWFya0Rvd25JdCl7XG4gICAgICAgIHRoaXMuX191c2VNYXJrRG93bihhcHAuJGhlbHBDb250ZW50LF9jb250ZW50KTtcbiAgICAgIH1lbHNle1xuICAgICAgICBhcHAuJGhlbHBDb250ZW50Lmh0bWwoX2NvbnRlbnQpO1xuICAgICAgfVxuICAgICAgdmFyIGgxID0gJChcIjxoMT5cIikudGV4dChkb2N1bWVudC50aXRsZSk7XG4gICAgICBhcHAuJGhlbHBUaXRsZS5hcHBlbmQoaDEpO1xuXG4gICAgICBhcHAuJGNvbnRhaW5lci5hcHBlbmQoYXBwLiRoZWxwQXJ0aWNsZSk7XG4gICAgICBhcHAuJGNvbnRhaW5lci5hcHBlbmQoYXBwLiRoZWxwT3BlbkJ1dHRvbik7XG4gICAgICBhcHAuJGNvbnRhaW5lci5hcHBlbmQoYXBwLiRoZWxwQ2xvc2VCdXR0b24pO1xuICAgIH1cbiAgfSxcbiAgYWRkVGl0bGU6IGZ1bmN0aW9uICh0aXRsZSkge1xuICAgIHZhciBhcHAgPSB0aGlzO1xuICAgIGFwcC50aXRsZSA9IGFwcC50aXRsZSB8fCB0aXRsZTtcbiAgICBpZiAoIWFwcC50aXRsZSlyZXR1cm47XG4gICAgLy9pZiAoYXBwLiR0aXRsZSkge1xuICAgIC8vICAgIGFwcC50ZXh0KGFwcC50aXRsZSk7XG4gICAgLy99IGVsc2Uge1xuICAgIGFwcC4kdGl0bGUgPSAkKFwiPGRpdj5cIikuYWRkQ2xhc3MoXCJ0aXRsZVwiKTsvLy50ZXh0KGFwcC50aXRsZSk7XG4gICAgLy8gICAgLy9hcHAuJGNvbnRhaW5lci5hcHBlbmQoYXBwLiR0aXRsZSk7XG4gICAgJChcIi5jYW52YXMtY29udGFpbmVyXCIpLnByZXBlbmQoYXBwLiR0aXRsZSk7XG4gICAgLy99XG4gICAgLy8gYXBwLnRpdGxlT2JqZWN0ID0gbmV3IGZhYnJpYy5UZXh0KGFwcC50aXRsZSwge1xuICAgIC8vICAgdG9wOiAzMixcbiAgICAvLyAgIGxlZnQ6IDYwLFxuICAgIC8vICAgZm9udFNpemU6IDIwLFxuICAgIC8vICAgZmlsbDogXCJ3aGl0ZVwiLFxuICAgIC8vICAgZm9udEZhbWlseTogXCJPcGVuIFNhbnNcIixcbiAgICAvLyAgIGV2ZW50ZWQ6IGZhbHNlLFxuICAgIC8vICAgbGF5ZXI6IFwiaW50ZXJmYWNlXCIsXG4gICAgLy8gICBzZWxlY3RhYmxlOiBmYWxzZVxuICAgIC8vIH0pO1xuICAgIC8vIGFwcC5jYW52YXMuYWRkKGFwcC50aXRsZU9iamVjdCk7XG4gICAgLy8gYXBwLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICAvLyBhcHAuJHRpdGxlLndpZHRoKGFwcC50aXRsZU9iamVjdC53aWR0aCArIDIwKTtcbiAgICAvLyBhcHAuJHRpdGxlLmhlaWdodChhcHAudGl0bGVPYmplY3QuaGVpZ2h0KTtcbiAgfSxcbiAgdXBsb2FkQWN0aW9uOiBmdW5jdGlvbiAoaW1nLCBvcHRpb25zKSB7XG4gICAgaWYgKCFpbWcpcmV0dXJuO1xuICAgIHZhciBvYmogPSBuZXcgZmFicmljLlRyYW5zZm9ybWVkSW1hZ2UoaW1nLCBvcHRpb25zIHx8IHtcbiAgICAgICAgd2lkdGg6IDMwMCxcbiAgICAgICAgaGVpZ2h0OiAoaW1nLmhlaWdodCAvIGltZy53aWR0aCApICogMzAwXG4gICAgICB9KTtcbiAgICB0aGlzLmNhbnZhcy5hZGQob2JqKTtcbiAgICBvYmouY2VudGVyKCk7XG4gICAgb2JqLnNldENvb3JkcygpO1xuICB9XG59O1xuXG5mYWJyaWMuZGVtbyA9IGZ1bmN0aW9uKG9wdGlvbnMpe1xuICByZXR1cm4gbmV3IGZhYnJpYy5EZW1vQXBwbGljYXRpb24ob3B0aW9ucyk7XG59O1xuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9jb3JlL2RlbW8uanNcbi8vIG1vZHVsZSBpZCA9IDM2XG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIid1c2Ugc3RyaWN0JztcblxuXG52YXIgX2JpbmRFdmVudHMgPSBmYWJyaWMuQ2FudmFzLnByb3RvdHlwZS5fYmluZEV2ZW50cztcbnZhciBfb25Nb3VzZURvd25fb3ZlcndyaXR0ZW4gPSBmYWJyaWMuQ2FudmFzLnByb3RvdHlwZS5fb25Nb3VzZURvd247XG52YXIgX29uTW91c2VVcF9vdmVyd3JpdHRlbiA9IGZhYnJpYy5DYW52YXMucHJvdG90eXBlLl9vbk1vdXNlVXA7XG52YXIgX2luaXRFdmVudExpc3RlbmVyc19vdmVyd3JpdHRlbiA9IGZhYnJpYy5DYW52YXMucHJvdG90eXBlLl9pbml0RXZlbnRMaXN0ZW5lcnM7XG52YXIgcmVtb3ZlTGlzdGVuZXJzX292ZXJ3cml0dGVuID0gZmFicmljLkNhbnZhcy5wcm90b3R5cGUucmVtb3ZlTGlzdGVuZXJzO1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5DYW52YXMucHJvdG90eXBlLCB7XG4gIHRhcGhvbGRUaHJlc2hvbGQ6IDIwMDAsXG4gIF9iaW5kRXZlbnRzOiBmdW5jdGlvbiAoKSB7XG4gICAgX2JpbmRFdmVudHMuY2FsbCh0aGlzKTtcbiAgICB0aGlzLl9vbkNsaWNrID0gdGhpcy5fb25DbGljay5iaW5kKHRoaXMpO1xuICAgIHRoaXMuX29uRG91YmxlQ2xpY2sgPSB0aGlzLl9vbkRvdWJsZUNsaWNrLmJpbmQodGhpcyk7XG4gICAgdGhpcy5fb25UYXBIb2xkID0gdGhpcy5fb25UYXBIb2xkLmJpbmQodGhpcyk7XG4gIH0sXG5cbiAgX29uRG91YmxlQ2xpY2s6IGZ1bmN0aW9uIChlKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgdmFyIHRhcmdldCA9IHNlbGYuZmluZFRhcmdldChlKTtcbiAgICBzZWxmLmZpcmUoJ21vdXNlOmRibGNsaWNrJywge1xuICAgICAgdGFyZ2V0OiB0YXJnZXQsXG4gICAgICBlOiBlXG4gICAgfSk7XG5cbiAgICBpZiAodGFyZ2V0ICYmICFzZWxmLmlzRHJhd2luZ01vZGUpIHtcbiAgICAgIC8vIFRvIHVuaWZ5IHRoZSBiZWhhdmlvciwgdGhlIG9iamVjdCdzIGRvdWJsZSBjbGljayBldmVudCBkb2VzIG5vdCBmaXJlIG9uIGRyYXdpbmcgbW9kZS5cbiAgICAgIHRhcmdldC5maXJlKCdkYmxjbGljaycsIHtcbiAgICAgICAgZTogZVxuICAgICAgfSk7XG4gICAgfVxuICB9LFxuXG4gIF9vbkRyb3A6IGZ1bmN0aW9uIChlKSB7XG4gICAgdmFyIF96b29tID0gdGhpcy5nZXRab29tKCk7XG4gICAgZS54IC89IF96b29tO1xuICAgIGUueSAvPSBfem9vbTtcbiAgICBlLm9mZnNldFggLz0gX3pvb207XG4gICAgZS5vZmZzZXRZIC89IF96b29tO1xuICAgIGUud2lkdGggPSBlLmhlbHBlci53aWR0aCgpIC8gX3pvb207XG4gICAgZS5oZWlnaHQgPSBlLmhlbHBlci5oZWlnaHQoKSAvIF96b29tO1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICBlLnRhcmdldCA9IHNlbGYuZmluZFRhcmdldChlLm9yaWdpbmFsRXZlbnQpO1xuXG4gICAgc2VsZi5maXJlKCdtb3VzZTpkcm9wJywgZSk7XG5cbiAgICBpZiAoZS50YXJnZXQgJiYgIXNlbGYuaXNEcmF3aW5nTW9kZSkge1xuICAgICAgLy8gVG8gdW5pZnkgdGhlIGJlaGF2aW9yLCB0aGUgb2JqZWN0J3MgZG91YmxlIGNsaWNrIGV2ZW50IGRvZXMgbm90IGZpcmUgb24gZHJhd2luZyBtb2RlLlxuICAgICAgZS50YXJnZXQuZmlyZSgnb2JqZWN0OmRyb3AnLCBlKTtcbiAgICB9XG4gIH0sXG5cbiAgX29uRHJhZ01vdmU6IGZ1bmN0aW9uIChlKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgdmFyIHRhcmdldCA9IHNlbGYuZmluZFRhcmdldChlLm9yaWdpbmFsRXZlbnQpO1xuICAgIHNlbGYuZmlyZSgnbW91c2U6ZHJhZ21vdmUnLCB7XG4gICAgICB0YXJnZXQ6IHRhcmdldCxcbiAgICAgIGU6IGUsXG4gICAgICBkYXRhOiBlLmRhdGFcbiAgICB9KTtcbiAgICBpZiAodGFyZ2V0ICYmICFzZWxmLmlzRHJhd2luZ01vZGUpIHtcbiAgICAgIC8vIFRvIHVuaWZ5IHRoZSBiZWhhdmlvciwgdGhlIG9iamVjdCdzIGRvdWJsZSBjbGljayBldmVudCBkb2VzIG5vdCBmaXJlIG9uIGRyYXdpbmcgbW9kZS5cbiAgICAgIHRhcmdldC5maXJlKCdvYmplY3Q6ZHJhZ21vdmUnLCB7XG4gICAgICAgIGU6IGUsXG4gICAgICAgIGRhdGE6IGUuZGF0YVxuICAgICAgfSk7XG4gICAgfVxuICAgIGlmICh0aGlzLl9sYXN0X3RhcmdldCA9PSB0YXJnZXQpcmV0dXJuO1xuICAgIGlmICh0aGlzLl9sYXN0X3RhcmdldCkge1xuICAgICAgc2VsZi5maXJlKCdtb3VzZTpkcmFnbGVhdmUnLCB7XG4gICAgICAgIHRhcmdldDogdGhpcy5fbGFzdF90YXJnZXQsXG4gICAgICAgIGU6IGUsXG4gICAgICAgIGRhdGE6IGUuZGF0YVxuICAgICAgfSk7XG4gICAgICB0aGlzLl9sYXN0X3RhcmdldC5maXJlKCdvYmplY3Q6ZHJhZ2xlYXZlJywge1xuICAgICAgICBlOiBlLFxuICAgICAgICBkYXRhOiBlLmRhdGFcbiAgICAgIH0pO1xuICAgICAgdGhpcy5fbGFzdF90YXJnZXQgPSBmYWxzZTtcbiAgICB9XG4gICAgaWYgKHRhcmdldCkge1xuXG4gICAgICBzZWxmLmZpcmUoJ21vdXNlOmRyYWdlbnRlcicsIHtcbiAgICAgICAgdGFyZ2V0OiB0YXJnZXQsXG4gICAgICAgIGU6IGUsXG4gICAgICAgIGRhdGE6IGUuZGF0YVxuICAgICAgfSk7XG4gICAgICB0YXJnZXQuZmlyZSgnb2JqZWN0OmRyYWdlbnRlcicsIHtcbiAgICAgICAgZTogZSxcbiAgICAgICAgZGF0YTogZS5kYXRhXG4gICAgICB9KTtcblxuICAgICAgdGhpcy5fbGFzdF90YXJnZXQgPSB0YXJnZXQ7XG4gICAgfVxuXG4gIH0sXG5cbiAgX29uQ2xpY2s6IGZ1bmN0aW9uIChlKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgdmFyIHRhcmdldCA9IHNlbGYuZmluZFRhcmdldChlKTtcbiAgICBzZWxmLmZpcmUoJ21vdXNlOmNsaWNrJywge1xuICAgICAgdGFyZ2V0OiB0YXJnZXQsXG4gICAgICBlOiBlXG4gICAgfSk7XG5cbiAgICBpZiAodGFyZ2V0ICYmICFzZWxmLmlzRHJhd2luZ01vZGUpIHtcbiAgICAgIGlmIChcbiAgICAgICAgdGFyZ2V0Lm9yaWdpbmFsU3RhdGUubGVmdCA9PSB0YXJnZXQubGVmdCAmJlxuICAgICAgICB0YXJnZXQub3JpZ2luYWxTdGF0ZS50b3AgPT0gdGFyZ2V0LnRvcCAmJlxuICAgICAgICB0YXJnZXQub3JpZ2luYWxTdGF0ZS5zY2FsZVggPT0gdGFyZ2V0LnNjYWxlWCAmJlxuICAgICAgICB0YXJnZXQub3JpZ2luYWxTdGF0ZS5zY2FsZVkgPT0gdGFyZ2V0LnNjYWxlWSAmJlxuICAgICAgICB0YXJnZXQub3JpZ2luYWxTdGF0ZS5hbmdsZSA9PSB0YXJnZXQuYW5nbGVcbiAgICAgICkge1xuICAgICAgICAvLyBUbyB1bmlmeSB0aGUgYmVoYXZpb3IsIHRoZSBvYmplY3QncyBkb3VibGUgY2xpY2sgZXZlbnQgZG9lcyBub3QgZmlyZSBvbiBkcmF3aW5nIG1vZGUuXG4gICAgICAgIHRhcmdldC5maXJlKCdvYmplY3Q6Y2xpY2snLCB7XG4gICAgICAgICAgZTogZVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG5cbiAgX29uVGFwSG9sZDogZnVuY3Rpb24gKGUpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICB2YXIgdGFyZ2V0ID0gc2VsZi5maW5kVGFyZ2V0KGUpO1xuICAgIHNlbGYuZmlyZSgndG91Y2g6dGFwaG9sZCcsIHtcbiAgICAgIHRhcmdldDogdGFyZ2V0LFxuICAgICAgZTogZVxuICAgIH0pO1xuXG4gICAgaWYgKHRhcmdldCAmJiAhc2VsZi5pc0RyYXdpbmdNb2RlKSB7XG4gICAgICAvLyBUbyB1bmlmeSB0aGUgYmVoYXZpb3IsIHRoZSBvYmplY3QncyB0YXAgaG9sZCBldmVudCBkb2VzIG5vdCBmaXJlIG9uIGRyYXdpbmcgbW9kZS5cbiAgICAgIHRhcmdldC5maXJlKCd0YXBob2xkJywge1xuICAgICAgICBlOiBlXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBpZiAoZS50eXBlID09PSAndG91Y2hlbmQnICYmIHNlbGYudG91Y2hTdGFydFRpbWVyICE9IG51bGwpIHtcbiAgICAgIGNsZWFyVGltZW91dChzZWxmLnRvdWNoU3RhcnRUaW1lcik7XG4gICAgfVxuICB9LFxuXG4gIF9vbk1vdXNlRG93bjogZnVuY3Rpb24gKGUpIHtcbiAgICBfb25Nb3VzZURvd25fb3ZlcndyaXR0ZW4uY2FsbCh0aGlzLCBlKTtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgaWYgKGUudHlwZSA9PT0gJ3RvdWNoc3RhcnQnKSB7XG4gICAgICB2YXIgdG91Y2hTdGFydFRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHNlbGYuX29uVGFwSG9sZChlKTtcbiAgICAgICAgc2VsZi5pc0xvbmdUYXAgPSB0cnVlO1xuICAgICAgfSwgc2VsZi50YXBob2xkVGhyZXNob2xkKTtcbiAgICAgIHNlbGYudG91Y2hTdGFydFRpbWVyID0gdG91Y2hTdGFydFRpbWVyO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIEFkZCByaWdodCBjbGljayBzdXBwb3J0XG4gICAgaWYgKGUud2hpY2ggPT09IDMpIHtcbiAgICAgIHZhciB0YXJnZXQgPSB0aGlzLmZpbmRUYXJnZXQoZSk7XG4gICAgICBzZWxmLmZpcmUoJ21vdXNlOmRvd24nLCB7dGFyZ2V0OiB0YXJnZXQsIGU6IGV9KTtcbiAgICAgIGlmICh0YXJnZXQgJiYgIXNlbGYuaXNEcmF3aW5nTW9kZSkge1xuICAgICAgICAvLyBUbyB1bmlmeSB0aGUgYmVoYXZpb3IsIHRoZSBvYmplY3QncyBtb3VzZSBkb3duIGV2ZW50IGRvZXMgbm90IGZpcmUgb24gZHJhd2luZyBtb2RlLlxuICAgICAgICB0YXJnZXQuZmlyZSgnbW91c2Vkb3duJywge1xuICAgICAgICAgIGU6IGVcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICB9LFxuXG4gIF9vbk1vdXNlVXA6IGZ1bmN0aW9uIChlKSB7XG5cbiAgICBfb25Nb3VzZVVwX292ZXJ3cml0dGVuLmNhbGwodGhpcywgZSk7XG5cbiAgICBpZiAoZS50eXBlID09PSAndG91Y2hlbmQnKSB7XG4gICAgICAvLyBQcm9jZXNzIHRhcCBob2xkLlxuICAgICAgaWYgKHRoaXMudG91Y2hTdGFydFRpbWVyICE9IG51bGwpIHtcbiAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMudG91Y2hTdGFydFRpbWVyKTtcbiAgICAgIH1cbiAgICAgIC8vIFByb2Nlc3MgbG9uZyB0YXAuXG4gICAgICBpZiAodGhpcy5pc0xvbmdUYXApIHtcbiAgICAgICAgdGhpcy5fb25Mb25nVGFwRW5kKGUpO1xuICAgICAgICB0aGlzLmlzTG9uZ1RhcCA9IGZhbHNlO1xuICAgICAgfVxuICAgICAgLy8gUHJvY2VzcyBkb3VibGUgY2xpY2tcbiAgICAgIHZhciBub3cgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgICAgIHZhciBsYXN0VG91Y2ggPSB0aGlzLmxhc3RUb3VjaCB8fCBub3cgKyAxO1xuICAgICAgdmFyIGRlbHRhID0gbm93IC0gbGFzdFRvdWNoO1xuICAgICAgaWYgKGRlbHRhIDwgMzAwICYmIGRlbHRhID4gMCkge1xuICAgICAgICAvLyBBZnRlciB3ZSBkZXRjdCBhIGRvdWJsZXRhcCwgc3RhcnQgb3ZlclxuICAgICAgICB0aGlzLmxhc3RUb3VjaCA9IG51bGw7XG5cbiAgICAgICAgdGhpcy5fb25Eb3VibGVUYXAoZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmxhc3RUb3VjaCA9IG5vdztcbiAgICAgIH1cbiAgICB9XG4gIH0sXG5cbiAgX29uRG91YmxlVGFwOiBmdW5jdGlvbiAoZSkge1xuICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgIHZhciB0YXJnZXQgPSBzZWxmLmZpbmRUYXJnZXQoZSk7XG4gICAgc2VsZi5maXJlKCd0b3VjaDpkb3VibGV0YXAnLCB7XG4gICAgICB0YXJnZXQ6IHRhcmdldCxcbiAgICAgIGU6IGVcbiAgICB9KTtcblxuICAgIGlmICh0YXJnZXQgJiYgIXNlbGYuaXNEcmF3aW5nTW9kZSkge1xuICAgICAgLy8gVG8gdW5pZnkgdGhlIGJlaGF2aW9yLCB0aGUgb2JqZWN0J3MgZG91YmxlIHRhcCBldmVudCBkb2VzIG5vdCBmaXJlIG9uIGRyYXdpbmcgbW9kZS5cbiAgICAgIHRhcmdldC5maXJlKCdvYmplY3Q6ZG91YmxldGFwJywge1xuICAgICAgICBlOiBlXG4gICAgICB9KTtcbiAgICB9XG4gIH0sXG5cbiAgX29uTG9uZ1RhcEVuZDogZnVuY3Rpb24gKGUpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICB2YXIgdGFyZ2V0ID0gc2VsZi5maW5kVGFyZ2V0KGUpO1xuICAgIHNlbGYuZmlyZSgndG91Y2g6bG9uZ3RhcGVuZCcsIHtcbiAgICAgIHRhcmdldDogdGFyZ2V0LFxuICAgICAgZTogZVxuICAgIH0pO1xuXG4gICAgaWYgKHRhcmdldCAmJiAhc2VsZi5pc0RyYXdpbmdNb2RlKSB7XG4gICAgICAvLyBUbyB1bmlmeSB0aGUgYmVoYXZpb3IsIHRoZSBvYmplY3QncyBsb25nIHRhcCBlbmQgZXZlbnQgZG9lcyBub3QgZmlyZSBvbiBkcmF3aW5nIG1vZGUuXG4gICAgICB0YXJnZXQuZmlyZSgnb2JqZWN0Omxvbmd0YXBlbmQnLCB7XG4gICAgICAgIGU6IGVcbiAgICAgIH0pO1xuICAgIH1cbiAgfSxcblxuICBfaW5pdEV2ZW50TGlzdGVuZXJzOiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIF9pbml0RXZlbnRMaXN0ZW5lcnNfb3ZlcndyaXR0ZW4uY2FsbChzZWxmKTtcblxuICAgIGZhYnJpYy51dGlsLmFkZExpc3RlbmVyKHNlbGYudXBwZXJDYW52YXNFbCwgJ2NsaWNrJywgc2VsZi5fb25DbGljayk7XG4gICAgZmFicmljLnV0aWwuYWRkTGlzdGVuZXIoc2VsZi51cHBlckNhbnZhc0VsLCAnZGJsY2xpY2snLCBzZWxmLl9vbkRvdWJsZUNsaWNrKTtcblxuICAgIHNlbGYub24oJ29iamVjdDpzY2FsaW5nJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgIGlmIChlLnRhcmdldCAmJiBlLnRhcmdldC5fc2NhbGluZ19ldmVudHNfZW5hYmxlZCkge1xuICAgICAgICBlLnRhcmdldC5maXJlKFwic2NhbGluZ1wiLCBlLmUpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHNlbGYub24oJ29iamVjdDpzZWxlY3RlZCcsIGZ1bmN0aW9uIChlKSB7XG4gICAgICBpZiAoZS50YXJnZXQpIHtcbiAgICAgICAgZS50YXJnZXQuZmlyZShcIm9iamVjdDpzZWxlY3RlZFwiLCBlLmUpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHNlbGYub24oJ21vdXNlOm92ZXInLCBmdW5jdGlvbiAoZSkge1xuICAgICAgaWYgKGUudGFyZ2V0KSB7XG4gICAgICAgIGUudGFyZ2V0LmZpcmUoXCJtb3VzZTpvdmVyXCIsIGUuZSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBzZWxmLm9uKCdtb3VzZTpvdXQnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgaWYgKGUudGFyZ2V0KSB7XG4gICAgICAgIGUudGFyZ2V0LmZpcmUoXCJtb3VzZTpvdXRcIiwgZS5lKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICB9LFxuXG4gIHJlbW92ZUxpc3RlbmVyczogZnVuY3Rpb24gKCkge1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICByZW1vdmVMaXN0ZW5lcnNfb3ZlcndyaXR0ZW4uY2FsbChzZWxmKTtcblxuXG4gICAgZmFicmljLnV0aWwucmVtb3ZlTGlzdGVuZXIoc2VsZi51cHBlckNhbnZhc0VsLCAnY2xpY2snLCBzZWxmLl9vbkNsaWNrKTtcbiAgICBmYWJyaWMudXRpbC5yZW1vdmVMaXN0ZW5lcihzZWxmLnVwcGVyQ2FudmFzRWwsICdkYmxjbGljaycsIHNlbGYuX29uRG91YmxlQ2xpY2spO1xuICB9XG59KTtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vY29yZS9ldmVudHMuanNcbi8vIG1vZHVsZSBpZCA9IDM3XG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIid1c2Ugc3RyaWN0JztcblxudmFyIGlzVk1MID0gZnVuY3Rpb24oKSB7IHJldHVybiB0eXBlb2YgR192bWxDYW52YXNNYW5hZ2VyICE9PSAndW5kZWZpbmVkJzsgfTtcblxuZGVsZXRlIGZhYnJpYy5SZWN0LnByb3RvdHlwZS50b09iamVjdDtcbmZhYnJpYy5SZWN0LnByb3RvdHlwZS5zdG9yZVByb3BlcnRpZXMgPSBbXCIqXCIsXCJyeFwiLFwicnlcIl07XG5cbmZhYnJpYy5JTkNMVURFX0FMTCA9IFwiKlwiO1xuXG52YXIgX3RvT2JqZWN0X292ZXJ3cml0dGVuID0gZmFicmljLk9iamVjdC5wcm90b3R5cGUudG9PYmplY3Q7XG5mYWJyaWMuU2xpZGVPYmplY3QgPSB7XG4gIGV2ZW50TGlzdGVuZXJzOiB7fSxcbiAgdG9PYmplY3Q6IGZ1bmN0aW9uIChwcm9wZXJ0aWVzVG9JbmNsdWRlKSB7XG4gICAgaWYocHJvcGVydGllc1RvSW5jbHVkZSA9PSBmYWJyaWMuSU5DTFVERV9BTEwpe1xuICAgICAgcHJvcGVydGllc1RvSW5jbHVkZSA9IFtmYWJyaWMuSU5DTFVERV9BTExdO1xuICAgIH1cblxuICAgIHByb3BlcnRpZXNUb0luY2x1ZGUgPSBwcm9wZXJ0aWVzVG9JbmNsdWRlIHx8IFtdO1xuICAgIHByb3BlcnRpZXNUb0luY2x1ZGUgPSBwcm9wZXJ0aWVzVG9JbmNsdWRlLmNvbmNhdCh0aGlzLnN0b3JlUHJvcGVydGllcyk7XG5cblxuICAgIHZhciBvYmogPSBfdG9PYmplY3Rfb3ZlcndyaXR0ZW4uY2FsbCh0aGlzLHByb3BlcnRpZXNUb0luY2x1ZGUpO1xuICAgIGlmKHByb3BlcnRpZXNUb0luY2x1ZGVbMF0gIT09IGZhYnJpYy5JTkNMVURFX0FMTCl7XG4gICAgICBpZiAoIXRoaXMuaW5jbHVkZURlZmF1bHRWYWx1ZXMpIHtcbiAgICAgICAgdGhpcy5fcmVtb3ZlRGVmYXVsdFZhbHVlcyhvYmopO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmKHRoaXMuc3RvcmVQcm9wZXJ0aWVzLmluZGV4T2YoXCIqXCIpID09IC0xKSB7XG4gICAgICBmb3IgKHZhciBpIGluIG9iaikge1xuICAgICAgICBpZiAodGhpcy5zdG9yZVByb3BlcnRpZXMuaW5kZXhPZihpKSA9PSAtMSkge1xuICAgICAgICAgIGRlbGV0ZSBvYmpbaV07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLmZpcmUoXCJiZWZvcmU6b2JqZWN0XCIse29iamVjdDogb2JqfSk7XG4gICAgcmV0dXJuIG9iajtcbiAgfSxcbiAgc3RvcmVQcm9wZXJ0aWVzOiBbJyonXSxcbiAgb3B0aW9uc09yZGVyOiBbXCJzcGVjaWFsUHJvcGVydGllc1wiXSxcblxuICAvKipcbiAgICogU2V0cyBvYmplY3QncyBwcm9wZXJ0aWVzIGZyb20gb3B0aW9uc1xuICAgKiBAcGFyYW0ge09iamVjdH0gW29wdGlvbnNdIE9wdGlvbnMgb2JqZWN0XG4gICAqL1xuICBzZXRPcHRpb25zOiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgdGhpcy5fc2V0T2JqZWN0KG9wdGlvbnMpO1xuICAgIC8vIHRoaXMuX2luaXRHcmFkaWVudChvcHRpb25zKTtcbiAgICAvLyB0aGlzLl9pbml0UGF0dGVybihvcHRpb25zKTtcbiAgICAvLyB0aGlzLl9pbml0Q2xpcHBpbmcob3B0aW9ucyk7XG4gIH0sXG4gIGhhc0JvdW5kc0NvbnRyb2xzOiB0cnVlLFxuICBfaW5pdEVudGl0eTogZnVuY3Rpb24ob3B0aW9ucyl7XG4gICAgb3B0aW9ucy5hcHBsaWNhdGlvbiAmJiBvcHRpb25zLmFwcGxpY2F0aW9uLmZpcmUoXCJlbnRpdHk6Y3JlYXRlZFwiLHt0YXJnZXQ6IHRoaXMsIG9wdGlvbnM6IG9wdGlvbnN9KTtcbiAgfSxcbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24ob3B0aW9ucyxjYWxsYmFjayl7XG4gICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG4gICAgdGhpcy5faW5pdEVudGl0eShvcHRpb25zKTtcbiAgICAvLyBpZihvcHRpb25zLndob2xlQ29vcmRpbmF0ZXMpe1xuICAgIC8vICAgdmFyIGNvb3JkaW5hdGVzID0gW1wibGVmdFwiLFwidG9wXCIsXCJ3aWR0aFwiLFwiaGVpZ2h0XCJdO1xuICAgIC8vICAgZm9yKHZhciBpIGluIGNvb3JkaW5hdGVzKXtcbiAgICAvLyAgICAgaWYob3B0aW9uc1tjb29yZGluYXRlc1tpXV0pe1xuICAgIC8vICAgICAgIG9wdGlvbnNbY29vcmRpbmF0ZXNbaV1dID0gTWF0aC5yb3VuZChvcHRpb25zW2Nvb3JkaW5hdGVzW2ldXSk7XG4gICAgLy8gICAgIH1cbiAgICAvLyAgIH1cbiAgICAvLyB9XG4gICAgdmFyIF9zZWxmID0gdGhpcztcbiAgICB0aGlzLl9zZXRPYmplY3Qob3B0aW9ucyxmdW5jdGlvbigpe1xuICAgICAgX3NlbGYubG9hZGVkID0gdHJ1ZTtcbiAgICAgIF9zZWxmLmZpcmUoXCJsb2FkZWRcIik7XG4gICAgICBjYWxsYmFjayAmJiBjYWxsYmFjayhfc2VsZik7XG4gICAgfSk7XG4gIH0sXG4gIGZsaXBUb29sczogICAgIGZhbHNlLFxuICBvcmRlclRvb2xzOiAgICBmYWxzZSxcbiAgYWRkOiBmdW5jdGlvbihjYW52YXMpIHtcbiAgICBjYW52YXMuYWRkKHRoaXMpO1xuICB9LFxuICBzZXQ6IGZ1bmN0aW9uKGtleSwgdmFsdWUpIHtcbiAgICBpZiAodHlwZW9mIGtleSA9PT0gJ29iamVjdCcpIHtcbiAgICAgIHRoaXMuX3NldE9iamVjdChrZXkpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIGlmIChrZXlbMF0gPT0gXCImXCIpIHtcbiAgICAgICAga2V5ID0ga2V5LnN1YnN0cigxKTtcbiAgICAgICAgdGhpcy5fc2V0KGtleSwgdmFsdWUodGhpcy5nZXQoa2V5KSkpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIHRoaXMuX3NldChrZXksIHZhbHVlKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG4gIHN0cm9rZTogXCJ0cmFuc3BhcmVudFwiLFxuICBvblRvcDogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLmNhbnZhcy5fb2JqZWN0cy5pbmRleE9mKHRoaXMpID09IHRoaXMuY2FudmFzLl9vYmplY3RzLmxlbmd0aCAtIDE7XG4gIH0sXG4gIGZsb3A6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmZsaXBZID0gIXRoaXMuZmxpcFk7XG4gICAgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gIH0sXG4gIGZsaXA6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmZsaXBYID0gIXRoaXMuZmxpcFg7XG4gICAgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gIH0sXG4gIG9uQm90dG9tOiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMuY2FudmFzLl9vYmplY3RzLmluZGV4T2YodGhpcykgPT0gMDtcbiAgfSxcbiAgZHVwbGljYXRlOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgX29iamVjdCA9IHRoaXMudG9PYmplY3QoZmFicmljLklOQ0xVREVfQUxMKTtcbiAgICBfb2JqZWN0LmFjdGl2ZSA9IHRydWU7XG5cbiAgICB2YXIgX2Nsb25lID0gX29iamVjdC5jbG9uZVN5bmMgJiYgX29iamVjdC5jbG9uZVN5bmMoKSB8fCB0aGlzLmNhbnZhcy5jcmVhdGVPYmplY3QoX29iamVjdCk7XG4gICAgcmV0dXJuIF9jbG9uZTtcbiAgfSxcbiAgaW5zZXJ0RHVwbGljYXRlOiBmYWxzZSxcbiAgaW5zZXJ0UmVtb3ZlOiBmYWxzZSxcbiAgaW5zZXJ0Qm91bmRpbmdSZWN0OiBmYWxzZSxcbiAgaW5zZXJ0RGltZW5zaW9uczogZmFsc2UsXG4gIGluc2VydFBvc2l0aW9uOiBmYWxzZSxcbiAgbWluU3Ryb2tlV2lkdGg6IDAsXG4gIG1heFN0cm9rZVdpZHRoOiBmdW5jdGlvbigpe1xuICAgIHJldHVybiBNYXRoLm1pbih0aGlzLndpZHRoLHRoaXMuaGVpZ2h0KSAvIDI7XG4gIH0sXG4gIGFjdGlvbnM6IHtcbiAgICBib3VuZGluZ1JlY3Q6IHtcbiAgICAgIHR5cGU6ICdsYWJlbCcsXG4gICAgICB0ZW1wbGF0ZTogJzxkdD5MOjwvZHQ+PGRkIGNsYXNzPVwie2xlZnRDbGFzc31cIiB0aXRsZT1cIntsZWZ0fVwiPntyb3VuZExlZnR9PC9kZD48ZHQ+VDo8L2R0PjxkZCBjbGFzcz1cInt0b3BDbGFzc31cIiAgdGl0bGU9XCJ7dG9wfVwiPntyb3VuZFRvcH08L2RkPjxkdD5SOjwvZHQ+PGRkIGNsYXNzPVwie3JpZ2h0Q2xhc3N9XCIgdGl0bGU9XCJ7cmlnaHR9XCI+e3JvdW5kUmlnaHR9PC9kZD48ZHQ+Qjo8L2R0PjxkZCBjbGFzcz1cIntib3R0b21DbGFzc31cIiAgdGl0bGU9XCJ7Ym90dG9tfVwiPntyb3VuZEJvdHRvbX08L2RkPicsXG4gICAgICB2YWx1ZToge1xuICAgICAgICBvYnNlcnZlOiBcIm1vZGlmaWVkIHNjYWxpbmcgbW92aW5nIHJvdGF0aW5nXCIsXG4gICAgICAgIGdldDogZnVuY3Rpb24oKXtcbiAgICAgICAgICB2YXIgX3JlY3QgPSB0aGlzLmdldEJvdW5kaW5nUmVjdCgpO1xuXG4gICAgICAgICAgaWYodGhpcy5tb3ZlbWVudExpbWl0cykge1xuXG4gICAgICAgICAgICBpZiAodGhpcy5tb3ZlbWVudExpbWl0cyA9PSB0aGlzLmNhbnZhcykge1xuICAgICAgICAgICAgICB2YXIgX3YgPSB0aGlzLmNhbnZhcy52aWV3cG9ydFRyYW5zZm9ybTtcbiAgICAgICAgICAgICAgdmFyIF9tbHIgPSB7XG4gICAgICAgICAgICAgICAgbGVmdDogX3ZbNF0sXG4gICAgICAgICAgICAgICAgdG9wOiBfdls1XSxcbiAgICAgICAgICAgICAgICB3aWR0aDogKHRoaXMuY2FudmFzLm9yaWdpbmFsV2lkdGggfHwgdGhpcy5jYW52YXMud2lkdGgpICogX3ZbMF0sXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiAodGhpcy5jYW52YXMub3JpZ2luYWxIZWlnaHQgfHwgdGhpcy5jYW52YXMuaGVpZ2h0KSAgKiBfdlszXSxcbiAgICAgICAgICAgICAgICByaWdodDogMCxcbiAgICAgICAgICAgICAgICBib3R0b206IDBcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgIF9tbHIgPSB0aGlzLm1vdmVtZW50TGltaXRzLmdldEJvdW5kaW5nUmVjdCgpO1xuICAgICAgICAgICAgfVxuXG5cbiAgICAgICAgICAgIF9yZWN0LmJvdHRvbSA9IHRoaXMubW92ZW1lbnRMaW1pdHMuaGVpZ2h0IC0gX3JlY3QuaGVpZ2h0O1xuICAgICAgICAgICAgdmFyIF90ID0gX3JlY3QudG9wIC0gX21sci50b3A7XG4gICAgICAgICAgICB2YXIgX2wgPSBfcmVjdC5sZWZ0IC0gX21sci5sZWZ0O1xuICAgICAgICAgICAgdmFyIF9yID0gX21sci53aWR0aCAtIF9yZWN0LndpZHRoIC0gX2w7XG4gICAgICAgICAgICB2YXIgX2IgPSBfbWxyLmhlaWdodCAtIF9yZWN0LmhlaWdodCAtIF90O1xuICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgX3QgPSBfcmVjdC50b3A7XG4gICAgICAgICAgICBfbCA9IF9yZWN0LmxlZnQ7XG4gICAgICAgICAgICBfYiA9IHRoaXMuY2FudmFzLmhlaWdodCAtIF9yZWN0LmhlaWdodCAtIF9yZWN0LnRvcDtcbiAgICAgICAgICAgIF9yICA9IHRoaXMuY2FudmFzLndpZHRoIC0gX3JlY3Qud2lkdGggLSBfcmVjdC5sZWZ0O1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICB0b3BDbGFzczogX3QgPiAwID8gXCJwb3NpdGl2ZVwiIDogX3QgPCAwID8gXCJuZWdhdGl2ZVwiIDogXCJ6ZXJvXCIsXG4gICAgICAgICAgICBib3R0b21DbGFzczogX2IgPiAwID8gXCJwb3NpdGl2ZVwiIDogX2IgPCAwID8gXCJuZWdhdGl2ZVwiIDogXCJ6ZXJvXCIsXG4gICAgICAgICAgICBsZWZ0Q2xhc3M6IF9sID4gMCA/IFwicG9zaXRpdmVcIiA6IF9sIDwgMCA/IFwibmVnYXRpdmVcIiA6IFwiemVyb1wiLFxuICAgICAgICAgICAgcmlnaHRDbGFzczogX3IgPiAwID8gXCJwb3NpdGl2ZVwiIDogX3IgPCAwID8gXCJuZWdhdGl2ZVwiIDogXCJ6ZXJvXCIsXG4gICAgICAgICAgICB0b3A6ICAgIF90LFxuICAgICAgICAgICAgbGVmdDogICBfbCxcbiAgICAgICAgICAgIGJvdHRvbTogX2IsXG4gICAgICAgICAgICByaWdodDogIF9yLFxuICAgICAgICAgICAgcm91bmRUb3A6ICAgIE1hdGgucm91bmQoX3QpLFxuICAgICAgICAgICAgcm91bmRMZWZ0OiAgIE1hdGgucm91bmQoX2wpLFxuICAgICAgICAgICAgcm91bmRCb3R0b206IE1hdGgucm91bmQoX2IpLFxuICAgICAgICAgICAgcm91bmRSaWdodDogIE1hdGgucm91bmQoX3IpXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcbiAgICBwb3NpdGlvbjoge1xuICAgICAgdGl0bGU6ICdwb3NpdGlvbicsXG4gICAgICB0eXBlOiAnbWVudScsXG4gICAgICBtZW51OiB7XG4gICAgICAgIG9iamVjdExlZnQ6IHtcbiAgICAgICAgICB0eXBlOiAgICdudW1iZXInLFxuICAgICAgICAgIHRpdGxlOiAgJ2xlZnQnLFxuICAgICAgICAgIHZhbHVlOiB7XG4gICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2YWwpIHtcbiAgICAgICAgICAgICAgdGhpcy5sZWZ0ID0gdmFsO1xuICAgICAgICAgICAgICB0aGlzLmZpcmUoXCJtb2RpZmllZFwiKTtcbiAgICAgICAgICAgICAgdGhpcy5jYW52YXMuZmlyZShcIm9iamVjdDptb2RpZmllZFwiLCB7dGFyZ2V0OiB0aGlzfSk7XG4gICAgICAgICAgICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICByZXR1cm4gdGhpcy5sZWZ0O1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIG9ic2VydmU6IFwibW9kaWZpZWRcIlxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgb2JqZWN0VG9wOiB7XG4gICAgICAgICAgdHlwZTogICAnbnVtYmVyJyxcbiAgICAgICAgICB0aXRsZTogICd0b3AnLFxuICAgICAgICAgIHZhbHVlOiB7XG4gICAgICAgICAgICBzZXQ6IGZ1bmN0aW9uICh2YWwpIHtcbiAgICAgICAgICAgICAgdGhpcy50b3AgPSB2YWw7XG4gICAgICAgICAgICAgIHRoaXMuZmlyZShcIm1vZGlmaWVkXCIpO1xuICAgICAgICAgICAgICB0aGlzLmNhbnZhcy5maXJlKFwib2JqZWN0Om1vZGlmaWVkXCIsIHt0YXJnZXQ6IHRoaXN9KTtcbiAgICAgICAgICAgICAgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIHJldHVybiB0aGlzLnRvcDtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvYnNlcnZlOiBcIm1vZGlmaWVkXCJcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuICAgIGRpbWVuc2lvbnM6IHtcbiAgICAgIHRpdGxlOiAnZGltZW5zaW9ucycsXG4gICAgICB0eXBlOiAnbWVudScsXG4gICAgICBtZW51OntcbiAgICAgICAgb2JqZWN0V2lkdGg6IHtcbiAgICAgICAgICB0eXBlOiAgICdudW1iZXInLFxuICAgICAgICAgIHRpdGxlOiAgJ3dpZHRoJyxcbiAgICAgICAgICB2YWx1ZToge1xuICAgICAgICAgICAgc2V0OiBmdW5jdGlvbih2YWwpe1xuICAgICAgICAgICAgICB0aGlzLnNhdmVTdGF0ZSgpO1xuICAgICAgICAgICAgICB0aGlzLmRpbWVuc2lvbnNXaWR0aFZhbHVlID0gdmFsO1xuICAgICAgICAgICAgICB0aGlzLnNjYWxlVG9XaWR0aCh2YWwgKiAgdGhpcy5jYW52YXMuZ2V0Wm9vbSgpKTtcbiAgICAgICAgICAgICAgdGhpcy5jYW52YXMuZmlyZU1vZGlmaWVkSWZDaGFuZ2VkKHRoaXMpO1xuICAgICAgICAgICAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICAgICAgICAgICAgZGVsZXRlIHRoaXMuZGltZW5zaW9uc1dpZHRoVmFsdWU7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICBpZih0aGlzLmRpbWVuc2lvbnNXaWR0aFZhbHVlKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5kaW1lbnNpb25zV2lkdGhWYWx1ZTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICByZXR1cm4gTWF0aC5yb3VuZCh0aGlzLmdldEJvdW5kaW5nUmVjdCgpLndpZHRoIC8gdGhpcy5jYW52YXMuZ2V0Wm9vbSgpKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvYnNlcnZlOiBcIm1vZGlmaWVkXCJcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIG9iamVjdEhlaWdodDoge1xuICAgICAgICAgIHR5cGU6ICAgJ251bWJlcicsXG4gICAgICAgICAgdGl0bGU6ICAnaGVpZ2h0JyxcbiAgICAgICAgICB2YWx1ZToge1xuICAgICAgICAgICAgc2V0OiBmdW5jdGlvbih2YWwpe1xuICAgICAgICAgICAgICB0aGlzLnNhdmVTdGF0ZSgpO1xuICAgICAgICAgICAgICB0aGlzLnNjYWxlVG9IZWlnaHQodmFsICogIHRoaXMuY2FudmFzLmdldFpvb20oKSk7XG4gICAgICAgICAgICAgIHRoaXMuZGltZW5zaW9uc0hlaWdodFZhbHVlID0gdmFsO1xuICAgICAgICAgICAgICB0aGlzLmNhbnZhcy5maXJlTW9kaWZpZWRJZkNoYW5nZWQodGhpcyk7XG4gICAgICAgICAgICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgICAgICAgICAgICBkZWxldGUgdGhpcy5kaW1lbnNpb25zSGVpZ2h0VmFsdWU7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICBpZih0aGlzLmRpbWVuc2lvbnNIZWlnaHRWYWx1ZSl7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGltZW5zaW9uc0hlaWdodFZhbHVlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHJldHVybiBNYXRoLnJvdW5kKHRoaXMuZ2V0Qm91bmRpbmdSZWN0KCkuaGVpZ2h0IC8gdGhpcy5jYW52YXMuZ2V0Wm9vbSgpKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvYnNlcnZlOiBcIm1vZGlmaWVkXCJcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuICAgIGNlbnRlcjoge1xuICAgICAgY2xhc3NOYW1lOiAgJ2ZhIGZhLWJ1bGxzZXllJyxcbiAgICAgIHRpdGxlOiAnQ2VudGVyJyxcbiAgICAgIGFjdGlvbjogZnVuY3Rpb24oKXtcbiAgICAgICAgdGhpcy5jZW50ZXIoKTtcbiAgICAgICAgdGhpcy5zZXRDb29yZHMoKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIG9iamVjdEZsaXA6IHtcbiAgICAgIGNsYXNzTmFtZTogICdmYSBmYS1hcnJvd3MtaCcsXG4gICAgICBpbnNlcnQ6ICAgICAnZmxpcFRvb2xzJyxcbiAgICAgIHRpdGxlOiAgICAgICdmbGlwJyxcbiAgICAgIGFjdGlvbjogICAgICdmbGlwJ1xuICAgIH0sXG4gICAgZmxvcDoge1xuICAgICAgY2xhc3NOYW1lOiAgJ2ZhIGZhLWFycm93cy12JyxcbiAgICAgIGluc2VydDogICAgICdmbGlwVG9vbHMnLFxuICAgICAgdGl0bGU6ICAgICAgJ2Zsb3AnXG4gICAgfSxcbiAgICBicmluZ0ZvcndhcmQ6IHtcbiAgICAgIGluc2VydDogICAgICdvcmRlclRvb2xzJyxcbiAgICAgIHRpdGxlOiAgICAgICdicmluZyBmb3J3YXJkJyxcbiAgICAgIGNsYXNzTmFtZTogICdmYSBmYS1sZXZlbC11cCcsXG4gICAgICBkaXNhYmxlZDogICAnb25Ub3AnXG4gICAgfSxcbiAgICBzZW5kQmFja3dhcmRzOiB7XG4gICAgICBpbnNlcnQ6ICAgICAnb3JkZXJUb29scycsXG4gICAgICB0aXRsZTogICAgICAnc2VuZCBiYWNrd2FyZHMnLFxuICAgICAgY2xhc3NOYW1lOiAgJ2ZhIGZhLWxldmVsLWRvd24nLFxuICAgICAgZGlzYWJsZWQ6ICAgJ29uQm90dG9tJ1xuICAgIH0sXG4gICAgcmVtb3ZlOiB7XG4gICAgICBjbGFzc05hbWU6ICAnZmEgZmEtdHJhc2gnLFxuICAgICAgdGl0bGU6ICAgICAgJ3JlbW92ZScsXG4gICAgICBrZXk6ICAgICAgICBcIkRlbGV0ZVwiXG4gICAgfSxcbiAgICBkdXBsaWNhdGU6IHtcbiAgICAgIGNsYXNzTmFtZTogICdmYSBmYS1jbG9uZScsXG4gICAgICB0aXRsZTogICAgICAnZHVwbGljYXRlJ1xuICAgIH1cbiAgfVxufTtcbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLk9iamVjdC5wcm90b3R5cGUsIGZhYnJpYy5TbGlkZU9iamVjdCk7XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL2NvcmUvb2JqZWN0LmpzXG4vLyBtb2R1bGUgaWQgPSAzOFxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCIndXNlIHN0cmljdCc7XG5cblxuLyoqXG4gKiBAcHJpdmF0ZVxuICogQHBhcmFtIHtTdHJpbmd9IGV2ZW50TmFtZVxuICogQHBhcmFtIHtGdW5jdGlvbn0gaGFuZGxlclxuICovXG5mdW5jdGlvbiBfcmVtb3ZlRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIGhhbmRsZXIpIHtcbiAgaWYgKCF0aGlzLl9fZXZlbnRMaXN0ZW5lcnNbZXZlbnROYW1lXSkge1xuICAgIHJldHVybjtcbiAgfVxuICB2YXIgZXZlbnRMaXN0ZW5lciA9IHRoaXMuX19ldmVudExpc3RlbmVyc1tldmVudE5hbWVdO1xuICBpZiAoaGFuZGxlcikge1xuICAgIGV2ZW50TGlzdGVuZXIuc3BsaWNlKGV2ZW50TGlzdGVuZXIuaW5kZXhPZihoYW5kbGVyKSwgMSlcbiAgfVxuICBlbHNlIHtcbiAgICBldmVudExpc3RlbmVyLmxlbmd0aCA9IDA7XG4gIH1cbn1cblxuZmFicmljLkNhbnZhcy5wcm90b3R5cGUuc3RvcE9ic2VydmluZyA9IGZhYnJpYy5PYmplY3QucHJvdG90eXBlLnN0b3BPYnNlcnZpbmcgPSBmdW5jdGlvbiBzdG9wT2JzZXJ2aW5nKGV2ZW50TmFtZSwgaGFuZGxlcikge1xuICBpZiAoIXRoaXMuX19ldmVudExpc3RlbmVycykge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIHJlbW92ZSBhbGwga2V5L3ZhbHVlIHBhaXJzIChldmVudCBuYW1lIC0+IGV2ZW50IGhhbmRsZXIpXG4gIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAwKSB7XG4gICAgZm9yIChldmVudE5hbWUgaW4gdGhpcy5fX2V2ZW50TGlzdGVuZXJzKSB7XG4gICAgICBfcmVtb3ZlRXZlbnRMaXN0ZW5lci5jYWxsKHRoaXMsIGV2ZW50TmFtZSk7XG4gICAgfVxuICB9XG4gIC8vIG9uZSBvYmplY3Qgd2l0aCBrZXkvdmFsdWUgcGFpcnMgd2FzIHBhc3NlZFxuICBlbHNlIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAxICYmIHR5cGVvZiBhcmd1bWVudHNbMF0gPT09ICdvYmplY3QnKSB7XG4gICAgZm9yICh2YXIgcHJvcCBpbiBldmVudE5hbWUpIHtcbiAgICAgIF9yZW1vdmVFdmVudExpc3RlbmVyLmNhbGwodGhpcywgcHJvcCwgZXZlbnROYW1lW3Byb3BdKTtcbiAgICB9XG4gIH1cbiAgZWxzZSB7XG4gICAgX3JlbW92ZUV2ZW50TGlzdGVuZXIuY2FsbCh0aGlzLCBldmVudE5hbWUsIGhhbmRsZXIpO1xuICB9XG4gIHJldHVybiB0aGlzO1xufVxuXG5cbmZhYnJpYy5PYnNlcnZhYmxlLm9uID0gZmFicmljLkNhbnZhcy5wcm90b3R5cGUub24gPSBmYWJyaWMuT2JqZWN0LnByb3RvdHlwZS5vbiA9IGZ1bmN0aW9uIChldmVudE5hbWUsIGhhbmRsZXIscHJpb3JpdHkpIHtcbiAgaWYgKGV2ZW50TmFtZS5jb25zdHJ1Y3RvciA9PSBPYmplY3QpIHtcbiAgICBmb3IgKHZhciBpIGluIGV2ZW50TmFtZSkge1xuICAgICAgdGhpcy5vbihpLCBldmVudE5hbWVbaV0scHJpb3JpdHkpXG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9XG4gIHZhciBldmVudHMgPSBldmVudE5hbWUuc3BsaXQoXCIgXCIpO1xuICBmb3IgKHZhciBpIGluIGV2ZW50cykge1xuICAgIGV2ZW50TmFtZSA9IGV2ZW50c1tpXTtcbiAgICB0aGlzLm9ic2VydmUoZXZlbnROYW1lLCBoYW5kbGVyKTtcbiAgICBpZihwcmlvcml0eSl7XG4gICAgICB0aGlzLl9fZXZlbnRMaXN0ZW5lcnNbZXZlbnROYW1lXS51bnNoaWZ0KHRoaXMuX19ldmVudExpc3RlbmVyc1tldmVudE5hbWVdLnBvcCgpKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHRoaXM7XG59O1xuZmFicmljLkNhbnZhcy5wcm90b3R5cGUub2ZmID0gZmFicmljLk9iamVjdC5wcm90b3R5cGUub2ZmID0gZnVuY3Rpb24gKGV2ZW50TmFtZSwgaGFuZGxlcikge1xuICB2YXIgZXZlbnRzID0gZXZlbnROYW1lLnNwbGl0KFwiIFwiKTtcbiAgZm9yICh2YXIgaSBpbiBldmVudHMpIHtcbiAgICB0aGlzLnN0b3BPYnNlcnZpbmcoZXZlbnRzW2ldLCBoYW5kbGVyKVxuICB9XG4gIHJldHVybiB0aGlzO1xufTtcblxuXG5mYWJyaWMuQ2FudmFzLnByb3RvdHlwZS5maXJlID0gZmFicmljLk9iamVjdC5wcm90b3R5cGUuZmlyZSA9IGZ1bmN0aW9uIGZpcmUoZXZlbnROYW1lLCBvcHRpb25zKSB7XG4gIGlmICghdGhpcy5fX2V2ZW50TGlzdGVuZXJzKSB7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdmFyIGxpc3RlbmVyc0ZvckV2ZW50ID0gdGhpcy5fX2V2ZW50TGlzdGVuZXJzW2V2ZW50TmFtZV07XG4gIGlmIChsaXN0ZW5lcnNGb3JFdmVudCkge1xuICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSBsaXN0ZW5lcnNGb3JFdmVudC5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgbGlzdGVuZXJzRm9yRXZlbnRbaV0uY2FsbCh0aGlzLCBvcHRpb25zIHx8IHt9KTtcbiAgICB9XG4gIH1cblxuICB2YXIgbGlzdGVuZXJzRm9yRXZlbnRBbGwgPSB0aGlzLl9fZXZlbnRMaXN0ZW5lcnNbJyonXTtcbiAgaWYgKGxpc3RlbmVyc0ZvckV2ZW50QWxsKSB7XG4gICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG4gICAgb3B0aW9ucy5ldmVudE5hbWUgPSBldmVudE5hbWU7XG4gICAgb3B0aW9ucy5saXN0ZW5lcnMgPSBsaXN0ZW5lcnNGb3JFdmVudDtcbiAgICBmb3IgKGkgPSAwLCBsZW4gPSBsaXN0ZW5lcnNGb3JFdmVudEFsbC5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgbGlzdGVuZXJzRm9yRXZlbnRBbGxbaV0uY2FsbCh0aGlzLCBvcHRpb25zKTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gdGhpcztcbn07XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL2NvcmUvb2JzZXJ2ZS5qc1xuLy8gbW9kdWxlIGlkID0gMzlcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiZmFicmljLlBsdWdpbnNNaXhpbiA9IHtcbiAgcnVuUGx1Z2luczogZnVuY3Rpb24gKHBsdWdpblR5cGVzLCByZXNvbHZlLCBlcnJvcikge1xuXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgdmFyIHBsdWdpbnMgPSB0aGlzLnBsdWdpbnNbcGx1Z2luVHlwZXNdLm1hcChmdW5jdGlvbihmb28pe1xuICAgICAgdmFyIGwgPSBmb28ubGVuZ3RoO1xuICAgICAgaWYoIWZvby5sZW5ndGgpe1xuICAgICAgICB2YXIgX3Jlc3VsdCA9IGZvby5jYWxsKHNlbGYpO1xuICAgICAgICAvLyAoX3Jlc3VsdCB8fCBfcmVzdWx0ID09PSB1bmRlZmluZWQpID8gcmVzb2x2ZSgpIDogZmFpbCgpO1xuICAgICAgICByZXR1cm4gX3Jlc3VsdDtcbiAgICAgIH1lbHNle1xuICAgICAgICByZXR1cm4gZm9vO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgZm9yKHZhciBpID0gcGx1Z2lucy5sZW5ndGggOyBpLS07KXtcbiAgICAgIGlmKHR5cGVvZiBwbHVnaW5zW2ldICE9PSBcImZ1bmN0aW9uXCIpe1xuICAgICAgICBwbHVnaW5zLnNwbGljZShpLDEpO1xuICAgICAgfVxuICAgIH1cbiAgICBpZihwbHVnaW5zLmxlbmd0aCkge1xuICAgICAgdmFyIHdyYXAgPSBmYWJyaWMudXRpbC5wcm9taXNlLndyYXAodGhpcyk7XG4gICAgICB2YXIgX2NvdW50ZXIgPSBwbHVnaW5zLmxlbmd0aDtcbiAgICAgIGZvcih2YXIgaSBpbiBwbHVnaW5zKXtcbiAgICAgICAgcGx1Z2luc1tpXS5jYWxsKHNlbGYsZnVuY3Rpb24oKXtcbiAgICAgICAgICBpZighLS1fY291bnRlcil7XG4gICAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgfVxuICAgIH1lbHNle1xuICAgICAgcmVzb2x2ZSgpO1xuICAgIH1cblxuICB9LFxuICBhZGRQbHVnaW46IGZ1bmN0aW9uICh0eXBlLCBuYW1lKSB7XG4gICAgaWYobmFtZS5jb25zdHJ1Y3RvciA9PSBTdHJpbmcpe1xuICAgICAgdGhpcy5wcm90b3R5cGUucGx1Z2luc1t0eXBlXS5wdXNoKHRoaXMucHJvdG90eXBlW25hbWVdKTtcbiAgICB9ZWxzZXtcbiAgICAgIHRoaXMucHJvdG90eXBlLnBsdWdpbnNbdHlwZV0ucHVzaChuYW1lKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cbn07XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL2NvcmUvcGx1Z2luc01peGluLmpzXG4vLyBtb2R1bGUgaWQgPSA0MFxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCJcbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLlByb2plY3QucHJvdG90eXBlLCB7XG4gIHNldEFjY2VzczogZnVuY3Rpb24gKGFjY2Vzcykge1xuXG5cbiAgICBhY2Nlc3MgPSBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKHRoaXMuX2FjY2Vzc19wcm9wZXJ0aWVzLCBhY2Nlc3MgfHwge30pO1xuXG5cbiAgICBpZiAoIWFjY2Vzcy5ndWlkbGluZXMpXG4gICAgICBhY2Nlc3NbXCJndWlkbGluZXMuZWRpdFwiXSA9IGZhbHNlO1xuICAgIGlmICghYWNjZXNzLnBob3RvKVxuICAgICAgYWNjZXNzW1wicGhvdG8uZWRpdFwiXSA9IGZhbHNlO1xuICAgIGlmICghYWNjZXNzLnRleHQpXG4gICAgICBhY2Nlc3NbXCJ0ZXh0LmVkaXRcIl0gPSBmYWxzZTtcbiAgICBpZiAoIWFjY2Vzcy5jbGlwYXJ0KVxuICAgICAgYWNjZXNzW1wiY2xpcGFydC5lZGl0XCJdID0gZmFsc2U7XG4gICAgaWYgKCFhY2Nlc3MuYmFja2dyb3VuZClcbiAgICAgIGFjY2Vzc1tcImJhY2tncm91bmQuZWRpdFwiXSA9IGZhbHNlO1xuXG4gICAgYWNjZXNzLmhpc3RvcnkgPSBmYWxzZTtcbiAgICBmb3IgKHZhciBpIGluIGFjY2Vzcykge1xuICAgICAgaWYgKGFjY2Vzc1tpXSkge1xuICAgICAgICBhY2Nlc3MuaGlzdG9yeSA9IHRydWU7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMuYWNjZXNzID0gYWNjZXNzO1xuICB9LFxuICBfYWNjZXNzX3Byb3BlcnRpZXM6IHtcbiAgICAvKipcbiAgICAgKiDQvtGC0L7RgNCw0LbQtdC90LjQtSDQuNC90YHRgtGA0YPQvNC10L3RgtC+0LIg0Lgg0L/QsNC90LXQu9C10Lkg0YEg0YDQsNC80LrQsNC80Lgg0Lgg0LzQsNGB0LrQsNC80LhcbiAgICAgKi9cbiAgICBcImZyYW1lc1wiOiB0cnVlLFxuICAgIC8qKlxuICAgICAqINC00L7QsdCw0LLQu9C10L3QuNC1INC4INGD0LTQsNC70LXQvdC40LUg0YDQtdGB0YPRgNGB0L7QsiDQv9GA0L7QtdC60YLQsCAo0YDQsNC80L7Quiwg0YTQvtGC0L4sINCx0Y3QutGA0LDRg9C90LTQvtCyLCDQutC70LjQv9Cw0YDRgtC+0LIs0LzQsNGB0L7QuilcbiAgICAgKi9cbiAgICBcInJlc291cmNlc1wiOiB0cnVlLFxuICAgIC8qKlxuICAgICAqINCy0L7Qt9C80L7QttC90L7RgdGC0Ywg0LTQvtCx0LDQstC70LXQvdC40Y8sINGD0LTQsNC70LXQvdC40Y8g0Lgg0L/QtdGA0LXQvNC10YnQtdC90LjRjyDRhNC+0YLQvlxuICAgICAqL1xuICAgIFwicGhvdG9cIjogdHJ1ZSxcbiAgICAvKipcbiAgICAgKiDQstC+0LfQvNC+0LbQvdC+0YHRgtGMINGA0LXQtNCw0LrRgtC40YDQvtCy0LDQvdC40Y8g0LrQvtC90YLQtdC90YLQsCDRhNC+0YLQvtCz0YDQsNGE0LjQuVxuICAgICAqL1xuICAgIFwicGhvdG8uZWRpdFwiOiB0cnVlLFxuICAgIC8qKlxuICAgICAqINCy0L7Qt9C80L7QttC90L7RgdGC0Ywg0LTQvtCx0LDQstC70LXQvdC40Y8sINGD0LTQsNC70LXQvdC40Y8g0Lgg0L/QtdGA0LXQvNC10YnQtdC90LjRjyDRgtC10LrRgdGC0LBcbiAgICAgKi9cbiAgICBcInRleHRcIjogdHJ1ZSxcbiAgICAvKipcbiAgICAgKiDQstC+0LfQvNC+0LbQvdC+0YHRgtGMINGA0LXQtNCw0LrRgtC40YDQvtCy0LDQvdC40Y8g0LrQvtC90YLQtdC90YLQsCDRgtC10LrRgtC+0LLRi9GFINGN0LvQtdC80LXQvdGC0L7QslxuICAgICAqL1xuICAgIFwidGV4dC5lZGl0XCI6IHRydWUsXG4gICAgLyoqXG4gICAgICog0LLQvtC30L7QttC90L7RgdGC0Ywg0LTQvtCx0LDQstC70LXQvdC40Y8sINGD0LTQsNC70LXQvdC40Y8g0Lgg0L/QtdGA0LXQvNC10YnQtdC90LjRjyDRgdC70LDQudC00L7QslxuICAgICAqL1xuICAgIFwic2xpZGVzXCI6IHRydWUsXG4gICAgLyoqXG4gICAgICog0L7RgtC+0LHRgNCw0LbQtdC90LjQtSDQs9Cw0LnQtNC70LDQudC90L7QslxuICAgICAqL1xuICAgIFwiZ3VpZGxpbmVzXCI6IHRydWUsXG4gICAgLyoqXG4gICAgICog0YDQtdC00LDQutGC0LjRgNC+0LLQsNC90LjQtSAg0LPQsNC50LTQu9Cw0LnQvdC+0LJcbiAgICAgKi9cbiAgICBcImd1aWRsaW5lcy5lZGl0XCI6IHRydWUsXG4gICAgLyoqXG4gICAgICog0LTQvtGB0YLRg9C/0L3QvtGB0YLRjCDRhNGD0L3QutGG0LjQuSA6INC/0LXRgNC10LzQtdGJ0LXQvdC40LUg0L/QviDRgdC70L7Rj9C8INC4INGD0LTQsNC70LXQvdC40LVcbiAgICAgKi9cbiAgICBcImVkaXRcIjogdHJ1ZSxcbiAgICAvKipcbiAgICAgKiDQtNC+0YHRgtGD0L/QvdC+0YHRgtGMINGE0YPQvdC60YbQuNC4INCz0YDRg9C/0L/QuNGA0L7QstC60LAg0Lgg0LLQvtC30LzQvtC20L3QvtGB0YLRjCDRgNCw0LHQvtGC0Ysg0YEg0LPRgNGD0L/Qv9Cw0LzQuFxuICAgICAqL1xuICAgIFwiZ3JvdXBcIjogdHJ1ZSxcbiAgICAvKipcbiAgICAgKiDQstC+0LfQvNC+0LbQvdC+0YHRgtGMINC00L7QsdCw0LLQu9C10L3QuNGPLCDRg9C00LDQu9C10L3QuNGPINC4INC/0LXRgNC10LzQtdGJ0LXQvdC40Y8g0LrQu9C40L/QsNGA0YLQvtCyXG4gICAgICovXG4gICAgXCJjbGlwYXJ0XCI6IHRydWUsXG4gICAgLyoqXG4gICAgICog0LLQvtC30LzQvtC20L3QvtGB0YLRjCDRgNC10LTQsNC60YLQuNGA0L7QstCw0L3QuNGPINC60L7QvdGC0LXQvdGC0LAg0LrQu9C40L/QsNGA0YLQsFxuICAgICAqL1xuICAgIFwiY2xpcGFydC5lZGl0XCI6IHRydWUsXG4gICAgLyoqXG4gICAgICog0LLQvtC30LzQvtC20L3QvtGB0YLRjCDQtNC+0LHQsNCy0LvQtdC90LjRjywg0YPQtNCw0LvQtdC90LjRjyDQuCDQv9C10YDQtdC80LXRidC10L3QuNGPICwg0LHRjdC60LPRgNCw0YPQvdC00L7QslxuICAgICAqL1xuICAgIFwiYmFja2dyb3VuZFwiOiB0cnVlLFxuICAgIC8qKlxuICAgICAqINCy0L7Qt9C80L7QttC90L7RgdGC0Ywg0YDQtdC00LDQutGC0LjRgNC+0LLQsNC90LjRjyDQutC+0L3RgtC10L3RgtCwINCx0Y3QutCz0YDQsNGD0L3QtNC+0LJcbiAgICAgKi9cbiAgICBcImJhY2tncm91bmQuZWRpdFwiOiB0cnVlLFxuICAgIC8qKlxuICAgICAqINCy0L7Qt9C80L7QttC90L7RgdGC0Ywg0YDQtdC00LDRgtC40YDQvtCy0LDQvdC40Y8g0YDQsNC30LzQtdGA0L7QsiDRgdGC0YDQsNC90LjRhiDQuCDQvtGC0YHRgtGD0L/QvtCyXG4gICAgICovXG5cbiAgICBcInRlbXBsYXRlXCI6IHRydWUsXG4gICAgLyoqXG4gICAgICog0LLQvtC30LzQvtC20L3QvtGB0YLRjCDRgNC10LTQsNGC0LjRgNC+0LLQsNC90LjRjyDQtNCw0L3QvdGL0YUg0L4g0L/RgNC+0LXQutGC0LVcbiAgICAgKi9cbiAgICBcImdlbmVyYWxcIjogdHJ1ZSxcbiAgICAvKipcbiAgICAgKiDQuNC90YHRgtGA0YPQvNC10L3RgiDQuNGB0YLQvtGA0LjRjyAo0YPRgdGC0LDQvdCw0LLQu9C40LLQsNC10YLRgdGPINCw0LLRgtC+0LzQsNGC0LjRh9C10YHQutC4KVxuICAgICAqL1xuICAgIFwiaGlzdG9yeVwiOiB0cnVlXG5cbiAgfVxufSk7XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL2NvcmUvcHJvamVjdC5hY2Nlc3MuanNcbi8vIG1vZHVsZSBpZCA9IDQxXG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIid1c2Ugc3RyaWN0JztcbnZhciBIaXN0b3J5ID0gcmVxdWlyZSgnLi8uLi9wbHVnaW5zL2hpc3RvcnknKTtcblxuLyoqXG4gKiBQcm9qZWN0IGNsYXNzLiBVc2VkIGZvciBzbGlkZXMgbWFuaXB1bGF0aW9uLiBhZGQvcmVtb3ZlL3NldCBhY3RpdmUgc2xpZGUvbW92ZS9yZXBsYWNlIHNsaWRlc1xuICoga2VlcCBhbGwgaW5mb3JtYXRpb24gYWJvdXQgY3VycmVudCBwcm9qZWN0XG4gKiBAcGFyYW0gZGF0YVxuICogQGNvbnN0cnVjdG9yXG4gKi9cbmZhYnJpYy5Qcm9qZWN0ID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgdGhpcy5sb2FkZWQgPSBmYWxzZTtcbiAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG4gIG9wdGlvbnMuYXBwbGljYXRpb24uZmlyZSgnZW50aXR5OmNyZWF0ZWQnLHt0YXJnZXQgOiB0aGlzLCBvcHRpb25zIDogb3B0aW9ucyB9KTtcbiAgdGhpcy5pbml0aWFsaXplKGZhYnJpYy51dGlsLm9iamVjdC5kZWVwRXh0ZW5kKHt9LG9wdGlvbnMpKTtcblxufTtcblxuZmFicmljLlByb2plY3QucHJvdG90eXBlID0ge1xuICB0eXBlOiBcInByb2plY3RcIixcbiAgYWN0aXZlU2xpZGU6IG51bGwsXG4gIHJlbW92ZVNsaWRlOiBmdW5jdGlvbiAoc2xpZGUpIHtcbiAgICB2YXIgX3MgPSB0aGlzLnNsaWRlcztcbiAgICB2YXIgX2N1clBvcyA9IF9zLmluZGV4T2Yoc2xpZGUpO1xuICAgIF9zLnNwbGljZShfY3VyUG9zLCAxKTtcblxuICAgIGlmKHNsaWRlID09IHRoaXMuYWN0aXZlU2xpZGUpe1xuICAgICAgZGVsZXRlIHRoaXMuYWN0aXZlU2xpZGUgO1xuICAgIH1cbiAgfSxcbiAgLyoqXG4gICAqIG1vdmUgc2xpZGUgdG8gYW5vdGhlciBwb3NpdGlvblxuICAgKiBAcGFyYW0gc2xpZGVcbiAgICogQHBhcmFtIG5ld1Bvc2l0aW9uXG4gICAqL1xuICBtb3ZlU2xpZGU6IGZ1bmN0aW9uIChzbGlkZSxuZXdQb3NpdGlvbikge1xuICAgIHZhciBfcyA9IHRoaXMuc2xpZGVzO1xuXG4gICAgdmFyIF9jdXJQb3MgPSBfcy5pbmRleE9mKHNsaWRlKTtcbiAgICBuZXdQb3NpdGlvbiA9IHBhcnNlSW50KG5ld1Bvc2l0aW9uKTtcblxuICAgIGlmIChfY3VyUG9zIDwgbmV3UG9zaXRpb24pIHtcbiAgICAgIF9zLnNwbGljZShfY3VyUG9zLCAxKTtcbiAgICAgIF9zLnNwbGljZShuZXdQb3NpdGlvbiwwLCBzbGlkZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIF9zLnNwbGljZShfY3VyUG9zLCAxKTtcbiAgICAgIF9zLnNwbGljZShuZXdQb3NpdGlvbiwgMCwgc2xpZGUpO1xuICAgIH1cbiAgfSxcbiAgLyoqXG4gICAqIHJlcGxhY2Ugc2xpZGVcbiAgICogQHBhcmFtIHNsaWRlXG4gICAqIEBwYXJhbSBuZXdQb3NpdGlvbiAtIHBvc2l0aW9uIG9mIHRoZSBzZWNvbmQgc2xpZGVcbiAgICovXG4gIHJlcGxhY2VTbGlkZTogZnVuY3Rpb24gKHNsaWRlLG5ld1Bvc2l0aW9uKSB7XG4gICAgdmFyIF9zID0gdGhpcy5zbGlkZXM7XG4gICAgdmFyIF9yZXBsYWNlZFNsaWRlID0gX3NbbmV3UG9zaXRpb25dO1xuICAgIHZhciBfY3VyUG9zID0gX3MuaW5kZXhPZihzbGlkZSk7XG4gICAgaWYgKF9jdXJQb3MgPCBuZXdQb3NpdGlvbikge1xuICAgICAgX3Muc3BsaWNlKG5ld1Bvc2l0aW9uLCAxLCBzbGlkZSk7XG4gICAgICBfcy5zcGxpY2UoX2N1clBvcywgMSwgX3JlcGxhY2VkU2xpZGUpO1xuICAgIH0gZWxzZSB7XG4gICAgICBfcy5zcGxpY2UoX2N1clBvcywgMSwgX3JlcGxhY2VkU2xpZGUpO1xuICAgICAgX3Muc3BsaWNlKG5ld1Bvc2l0aW9uLCAxLCBzbGlkZSk7XG4gICAgfVxuICB9LFxuICBzdG9yZVByb3BlcnRpZXM6IFtcInRpdGxlXCIsIFwibWFuaWZlc3RcIiwgXCJsaW1pdHNcIiwgXCJ0ZW1wbGF0ZXNcIl0sXG4gIHRvT2JqZWN0OiBmdW5jdGlvbihwcm9wZXJ0aWVzVG9JbmNsdWRlLGNhbnZhc1Byb3BlcnRpZXNUb0luY2x1ZGUpIHtcbiAgICB2YXIgX3NsaWRlc0RhdGEgPSBbXTtcbiAgICBmb3IodmFyIGkgaW4gdGhpcy5zbGlkZXMpe1xuICAgICAgX3NsaWRlc0RhdGEucHVzaCh0aGlzLnNsaWRlc1tpXS5jYW52YXMudG9PYmplY3QoY2FudmFzUHJvcGVydGllc1RvSW5jbHVkZSkpO1xuICAgICAgLy9kZWxldGUgX3NsaWRlc0RhdGFbaV0udGh1bWI7XG4gICAgfVxuICAgIHZhciBvYmplY3QgPSB7fTtcblxuICAgIGZvcih2YXIgaSBpbiB0aGlzLnN0b3JlUHJvcGVydGllcyl7XG4gICAgICB2YXIgX3Byb3AgPSB0aGlzLnN0b3JlUHJvcGVydGllc1tpXTtcbiAgICAgIG9iamVjdFtfcHJvcF0gPSB0aGlzW19wcm9wXVxuICAgIH1cblxuICAgIGZvcih2YXIgaSBpbiBwcm9wZXJ0aWVzVG9JbmNsdWRlKXtcbiAgICAgIHZhciBfcHJvcCA9IHByb3BlcnRpZXNUb0luY2x1ZGVbaV07XG4gICAgICBvYmplY3RbX3Byb3BdID0gdGhpc1tfcHJvcF07XG4gICAgfVxuXG4gICAgb2JqZWN0LnNsaWRlcyA9IF9zbGlkZXNEYXRhO1xuXG4gICAgcmV0dXJuIG9iamVjdDtcbiAgfSxcbiAgdXBkYXRlU2xpZGVUZW1wbGF0ZTogZnVuY3Rpb24oc2xpZGUpIHtcbiAgICBzbGlkZS5jYW52YXMuc2V0VGVtcGxhdGUoc2xpZGUuY2FudmFzLnRlbXBsYXRlKTtcbiAgICB0aGlzLmNhbnZhcy50ZW1wbGF0ZSA9IHNsaWRlLmNhbnZhcy50ZW1wbGF0ZTtcbiAgICBpZih0aGlzLmFjdGl2ZVNsaWRlICA9PSBzbGlkZSl7XG4gICAgICB0aGlzLmNhbnZhcy5zZXRUZW1wbGF0ZShzbGlkZS5jYW52YXMudGVtcGxhdGUpO1xuICAgIH1cbiAgfSxcbiAgdXBkYXRlVGVtcGxhdGU6IGZ1bmN0aW9uKHRlbXBsYXRlKSB7XG4gICAgZm9yKHZhciBpIGluIHRoaXMuc2xpZGVzKXtcbiAgICAgIGlmKHRoaXMuc2xpZGVzW2ldLmNhbnZhcy50ZW1wbGF0ZSA9PSB0ZW1wbGF0ZSl7XG4gICAgICAgIHRoaXMudXBkYXRlU2xpZGVUZW1wbGF0ZSh0aGlzLnNsaWRlc1tpXSk7XG4gICAgICB9XG4gICAgfVxuICB9LFxuICBkZWZhdWx0VGVtcGxhdGU6ICBcIlwiLFxuICBzbGlkZXM6IFtdLFxuICB1cmw6IFwiXCIsXG4gIHRpdGxlOiBcIlwiLFxuICBtYW5pZmVzdDoge1xuICAgIGZvcm1hdDogXCJcIlxuICB9LFxuICBsaW1pdHM6IHtcbiAgICBtYXg6IDEwLFxuICAgIG1pbjogMlxuICB9LFxuICB0ZW1wbGF0ZXM6IFtdLFxuICBkcGk6IDIwMCxcbiAgX2lkX2NvdW50ZXI6IDAsXG4gIHNldENhbnZhczogZnVuY3Rpb24gKGNhbnZhcykge1xuICAgIHRoaXMuY2FudmFzID0gY2FudmFzO1xuICAgIHRoaXMuY2FudmFzLnByb2plY3QgPSB0aGlzO1xuICAgIGlmKHRoaXMuaGlzdG9yeSkge1xuICAgICAgY2FudmFzLmluaXRIaXN0b3J5KHRoaXMuaGlzdG9yeSk7XG4gICAgfVxuICAgIHRoaXMuZmlyZShcImNhbnZhczppbml0aWxpemVkXCIpO1xuICAgIC8vIGNhbnZhcy5vbignYWZ0ZXI6cmVuZGVyJywgdGhpcy5taXJyb3JNb2RpZmllZC5iaW5kKHRoaXMpICk7XG4gIH0sXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uIChvcHRpb25zKSB7XG5cbiAgICBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKHRoaXMsIHtcbiAgICAgIGxhc3RfaWQ6IDEsXG4gICAgICBzY2FsZVZhbHVlOiAxLFxuICAgICAgYWN0aXZlU2xpZGU6IG51bGwsXG4gICAgICBoaXN0b3J5OiBudWxsLFxuICAgICAgc2xpZGVzOiBbXSxcbiAgICAgIGNhbnZhczogbnVsbFxuICAgIH0pO1xuXG4gICAgdGhpcy5hbGlnbWVudExpbmVYID0gZmFsc2U7XG4gICAgdGhpcy5hbGlnbWVudExpbmVZID0gZmFsc2U7XG5cbiAgICBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKHRoaXMsb3B0aW9ucyk7XG4gICAgZmFicmljLnV0aWwub2JqZWN0LmRlZmF1bHRzKG9wdGlvbnMsdGhpcy5kZWZ1bHRPcHRpb25zKTtcblxuICAgIC8vIHRoaXMuc2V0QWNjZXNzKHRoaXMuYWNjZXNzKTtcblxuICAgIGlmKG9wdGlvbnMuZ3JpZHNuYXBwZXIgIT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhpcy5ncmlkc25hcHBlciA9IG9wdGlvbnMuZ3JpZHNuYXBwZXJcbiAgICB9XG4gICAgaWYob3B0aW9ucy5oaXN0b3J5ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHRoaXMuaGlzdG9yeSA9IG9wdGlvbnMuaGlzdG9yeTtcbiAgICB9XG4gICAgaWYob3B0aW9ucy5kYXRhKXtcbiAgICAgIHRoaXMuZGF0YSA9IG9wdGlvbnMuZGF0YTtcbiAgICB9XG4gICAgaWYodGhpcy5oaXN0b3J5KSB7XG4gICAgICB0aGlzLmhpc3RvcnkgPSBuZXcgSGlzdG9yeSh0aGlzKTtcbiAgICAgIHRoaXMuaGlzdG9yeS5hcHBsaWNhdGlvbiA9IHRoaXMuYXBwbGljYXRpb247XG4gICAgfVxuXG5cbiAgICBpZihvcHRpb25zLmNhbnZhcyl7XG4gICAgICB2YXIgX2NhbnZhcyA9IG5ldyBmYWJyaWMuU2xpZGVDYW52YXMoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQob3B0aW9ucy5jYW52YXMpKTtcbiAgICAgIF9jYW52YXMuYXBwbGljYXRpb24gPSB0aGlzLmFwcGxpY2F0aW9uO1xuICAgICAgX2NhbnZhcy5wcm9qZWN0ID0gdGhpcztcbiAgICAgIHRoaXMuc2V0Q2FudmFzKF9jYW52YXMpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzO1xuICB9LFxuICBsb2FkOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgIHRoaXMuZmlyZShcImxvYWRpbmdcIix7dHlwZTogXCJwcm9qZWN0XCJ9KTtcblxuICAgIGRhdGEgPSBkYXRhICYmIGZhYnJpYy51dGlsLm9iamVjdC5jbG9uZURlZXAoZGF0YSkgfHwgdGhpcy5kYXRhO1xuICAgIC8vIHRoaXMuaGlzdG9yeSAmJiB0aGlzLmhpc3RvcnkuZGlzYWJsZSgpO1xuICAgIHRoaXMuYWN0aXZlU2xpZGUgPSBudWxsO1xuICAgIHRoaXMuc2xpZGVzID0gW107XG5cbiAgICBpZiAodGhpcy5jYW52YXMpIHtcbiAgICAgIHRoaXMuY2FudmFzLl9vYmplY3RzLmxlbmd0aCA9IDA7XG4gICAgfVxuICAgIGRlbGV0ZSB0aGlzLmFjdGl2ZVNsaWRlO1xuXG4gICAgaWYoZGF0YS50ZW1wbGF0ZXMgIT09IHVuZGVmaW5lZCl7XG4gICAgICB0aGlzLnRlbXBsYXRlcyA9IGRhdGEudGVtcGxhdGVzO1xuICAgIH1cblxuICAgIGZvcih2YXIgaSBpbiBkYXRhLnNsaWRlcyl7XG4gICAgICB0aGlzLmFkZFNsaWRlKGRhdGEuc2xpZGVzW2ldKTtcbiAgICB9XG4gICAgZGVsZXRlIGRhdGEuc2xpZGVzO1xuICAgIGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQodGhpcyxkYXRhKTtcblxuICAgIHRoaXMucHJlbG9hZCgpO1xuICAgIGlmKHRoaXMuY2FudmFzKXtcbiAgICAgIHRoaXMuc2V0QWN0aXZlU2xpZGVCeUluZGV4KDApO1xuICAgIH1lbHNle1xuICAgICAgdGhpcy5sYXp5TG9hZCgpO1xuICAgIH1cbiAgfSxcbiAgdW5sb2FkVW5hY3RpdmVTbGlkZXM6IGZhbHNlLFxuICBsYXp5TG9hZEVuYWJsZWQ6IHRydWUsXG4gIHNldEFjdGl2ZVNsaWRlOiBmdW5jdGlvbihzbGlkZSl7XG4gICAgaWYodGhpcy5jYW52YXMucHJvY2Vzc2luZylyZXR1cm47XG4gICAgaWYodGhpcy5hY3RpdmVTbGlkZSA9PT0gc2xpZGUpcmV0dXJuO1xuXG4gICAgdGhpcy5maXJlKFwic2xpZGU6Y2hhbmdlOmJlZ2luXCIsIHtjYW52YXM6IHRoaXMuY2FudmFzfSk7XG4gICAgaWYodGhpcy5hY3RpdmVTbGlkZSkge1xuICAgICAgZGVsZXRlIHRoaXMuYWN0aXZlU2xpZGUuY2FudmFzLm1pcnJvclNsaWRlO1xuICAgIH1cblxuICAgIHRoaXMucHJvY2Vzc2luZyA9dHJ1ZTtcbiAgICBpZiAodGhpcy51bmxvYWRVbmFjdGl2ZVNsaWRlcyAmJiB0aGlzLmNhbnZhcyAmJiB0aGlzLmFjdGl2ZVNsaWRlKSB7XG4gICAgICBkZWxldGUgdGhpcy5hY3RpdmVTbGlkZS5jYW52YXM7XG4gICAgICB0aGlzLmFjdGl2ZVNsaWRlLmZpcmUoXCJjYW52YXM6Y2hhbmdlZFwiLHtjYW52YXM6IG51bGx9KTtcbiAgICAgIHRoaXMuYWN0aXZlU2xpZGUuZGF0YSA9IHRoaXMuY2FudmFzLnRvT2JqZWN0KCk7XG4gICAgICB0aGlzLmNhbnZhcy5jbGVhcigpO1xuICAgIH1cbiAgICB0aGlzLmFjdGl2ZVNsaWRlID0gc2xpZGU7XG4gICAgdGhpcy5hY3RpdmVTbGlkZS5jYW52YXMubWlycm9yU2xpZGUgPSB0aGlzLmNhbnZhcztcblxuXG5cbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgIHRoaXMuY2FudmFzLnByb2Nlc3NpbmcgPSB0cnVlO1xuXG4gICAgaWYodGhpcy5hY3RpdmVTbGlkZS5jYW52YXMubG9hZGVkKXtcbiAgICAgIF90aGlzLmNhbnZhcy5taXJyb3IoX3RoaXMuYWN0aXZlU2xpZGUuY2FudmFzKTtcbiAgICAgIF90aGlzLmNhbnZhcy5wcm9jZXNzaW5nID0gZmFsc2U7XG4gICAgICBfdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gICAgICBfdGhpcy5maXJlKFwic2xpZGU6Y2hhbmdlZFwiLCB7Y2FudmFzOiBfdGhpcy5jYW52YXN9KTtcbiAgICAgIF90aGlzLmxhenlMb2FkKCk7XG4gICAgfWVsc2V7XG5cbiAgICAgIC8vIF90aGlzLmNhbnZhcy5maXJlKFwibG9hZGluZzpiZWdpblwiLHt0eXBlOlwiY3VycmVudFwiICwgdGFyZ2V0OiBfdGhpcy5jYW52YXN9KTtcbiAgICAgIHRoaXMuYWN0aXZlU2xpZGUuY2FudmFzLmxvYWQoc2xpZGUub2JqZWN0LCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIF90aGlzLmNhbnZhcy5taXJyb3IoX3RoaXMuYWN0aXZlU2xpZGUuY2FudmFzKTtcbiAgICAgICAgX3RoaXMuY2FudmFzLnByb2Nlc3NpbmcgPSBmYWxzZTtcbiAgICAgICAgX3RoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgICAgICBfdGhpcy5maXJlKFwic2xpZGU6Y2hhbmdlZFwiLCB7Y2FudmFzOiBfdGhpcy5jYW52YXN9KTtcbiAgICAgICAgLy8gX3RoaXMuY2FudmFzLmZpcmUoXCJsb2FkaW5nOmVuZFwiLHt0eXBlOlwiY3VycmVudFwiICwgdGFyZ2V0OiBfdGhpcy5jYW52YXN9KTtcbiAgICAgICAgX3RoaXMubGF6eUxvYWQoKTtcbiAgICAgIH0pO1xuICAgIH07XG4gIH0sXG4gIHByZWxvYWQ6IGZ1bmN0aW9uKCl7XG4gICAgZm9yKHZhciBpIGluIHRoaXMuc2xpZGVzKSB7XG4gICAgICB2YXIgX3NsaWRlID0gdGhpcy5zbGlkZXNbaV07XG4gICAgICAvLyBfc2xpZGUuY2FudmFzLnByZWxvYWQoX3NsaWRlLm9iamVjdCwgZnVuY3Rpb24gKCkge1xuICAgICAgLy8gICBfc2xpZGUuZmlyZShcIm1vZGlmaWVkXCIpO1xuICAgICAgLy8gfSk7XG4gICAgfVxuICB9LFxuICBsYXp5TG9hZDogZnVuY3Rpb24oKXtcblxuICAgIHZhciBfcHJvaiA9IHRoaXM7XG4gICAgaWYodGhpcy5sYXp5TG9hZEVuYWJsZWQpe1xuICAgICAgZm9yKHZhciBpIGluIHRoaXMuc2xpZGVzKXtcbiAgICAgICAgdmFyIF9zbGlkZSA9IHRoaXMuc2xpZGVzW2ldO1xuICAgICAgICBpZighX3NsaWRlLmNhbnZhcy5sb2FkZWQgJiYgIV9zbGlkZS5jYW52YXMucHJvY2Vzc2luZyl7XG4gICAgICAgICAgX3NsaWRlLmNhbnZhcy5sb2FkKF9zbGlkZS5vYmplY3QsZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIC8vIHRoaXMuZmlyZShcIm1vZGlmaWVkXCIpO1xuICAgICAgICAgICAgX3Byb2ouZmlyZShcInNpbGRlOmxvYWRpbmc6ZW5kXCIsIHt0YXJnZXQ6IHRoaXN9KTtcbiAgICAgICAgICAgIGZvcih2YXIgX3MgaW4gX3Byb2ouc2xpZGVzKXtcbiAgICAgICAgICAgICAgaWYoIV9wcm9qLnNsaWRlc1tfc10uY2FudmFzLmxvYWRlZCl7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBfcHJvai5maXJlKFwibG9hZGluZzplbmRcIiwge30pO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfWVsc2V7XG4gICAgICBfcHJvai5maXJlKFwibG9hZGluZzplbmRcIix7fSk7XG4gICAgfVxuICB9LFxuICBtaXJyb3JNb2RpZmllZDogZnVuY3Rpb24oKXtcbiAgICB0aGlzLmFjdGl2ZVNsaWRlICYmIHRoaXMuYWN0aXZlU2xpZGUuZmlyZShcIm1vZGlmaWVkXCIpO1xuICB9LFxuICBzZXRBY3RpdmVTbGlkZUJ5SW5kZXg6IGZ1bmN0aW9uKGluZGV4KXtcbiAgICB0aGlzLnNldEFjdGl2ZVNsaWRlKHRoaXMuc2xpZGVzW2luZGV4XSlcbiAgfSxcbiAgc2V0QWN0aXZlU2xpZGVCeUlkOiBmdW5jdGlvbihpZCl7XG4gICAgdGhpcy5zZXRBY3RpdmVTbGlkZSggIGZhYnJpYy51dGlsLm9iamVjdC5maW5kV2hlcmUodGhpcy5zbGlkZXMse2lkOiBpZH0pKTtcbiAgfSxcbiAgZ2V0VGVtcGxhdGU6IGZ1bmN0aW9uKGlkKXtcbiAgICBpZCA9IGlkIHx8IHRoaXMuZGVmYXVsdFRlbXBsYXRlO1xuICAgIGZvcih2YXIgaSBpbiB0aGlzLnRlbXBsYXRlcyl7XG4gICAgICBpZih0aGlzLnRlbXBsYXRlc1tpXS5pZCA9PSBpZClcbiAgICAgICAgcmV0dXJuIHRoaXMudGVtcGxhdGVzW2ldO1xuICAgIH1cbiAgfSxcbiAgaW5pdEhpc3Rvcnk6IGZ1bmN0aW9uKCl7XG4gICAgdGhpcy5oaXN0b3J5ID0gbmV3IEhpc3RvcnkodGhpcyk7XG4gICAgdGhpcy5oaXN0b3J5LmFwcGxpY2F0aW9uID0gdGhpcy5hcHBsaWNhdGlvbjtcblxuICB9LFxuICBkdXBsaWNhdGVTbGlkZTogZnVuY3Rpb24gKHNsaWRlRGF0YSkge1xuXG4gICAgc2xpZGVEYXRhID0gc2xpZGVEYXRhLmNhbnZhcy50b09iamVjdCgpO1xuICAgIHZhciBfc2xpZGUgPSB0aGlzLmFkZFNsaWRlKHNsaWRlRGF0YSk7XG4gICAgX3NsaWRlLmNhbnZhcy5sb2FkKF9zbGlkZS5vYmplY3QpO1xuICB9LFxuICBhZGRTbGlkZTogZnVuY3Rpb24gKHNsaWRlKSB7XG5cbiAgICBzbGlkZSA9IHNsaWRlIHx8IHtcbiAgICAgICAgdGl0bGUgOiAn0J3QvtCy0YvQuSDQodC70LDQudC0J1xuICAgICAgfTtcbiAgICBzbGlkZS50ZW1wbGF0ZSA9IHNsaWRlLnRlbXBsYXRlIHx8IHRoaXMuZGVmYXVsdFRlbXBsYXRlO1xuICAgIGlmKHNsaWRlLnRlbXBsYXRlKSB7XG4gICAgICBzbGlkZS50ZW1wbGF0ZSA9IHRoaXMuZ2V0VGVtcGxhdGUoc2xpZGUudGVtcGxhdGUpO1xuICAgIH1cblxuICAgIGlmKGZhYnJpYy5pc0xpa2VseU5vZGUpe1xuICAgICAgLy8gZmFicmljLkNhbnZhcyA9IGZhYnJpYy5TbGlkZUNhbnZhcztcbiAgICAgIHZhciB3ID0gc2xpZGUuc2xpZGVXaWR0aCB8fCBzbGlkZS50ZW1wbGF0ZS53aWR0aDtcbiAgICAgIHZhciBoID0gc2xpZGUuc2xpZGVIZWlnaHQgfHwgc2xpZGUudGVtcGxhdGUuaGVpZ2h0O1xuICAgICAgdmFyIHpvb20gPSBmYWJyaWMuU2xpZGVDYW52YXMucHJvdG90eXBlLnpvb20gfHwgMTtcbiAgICAgIHZhciBfY2FudmFzID0gZmFicmljLmNyZWF0ZUNhbnZhc0Zvck5vZGUodyAqIHpvb20saCAqIHpvb20pO1xuICAgIH1lbHNle1xuICAgICAgdmFyIF9jYW52YXMgPSAgbmV3IGZhYnJpYy5TbGlkZUNhbnZhcyh7cHJvamVjdDogdGhpcywgaW50ZXJhY3RpdmU6IGZhbHNlfSk7XG4gICAgfVxuXG4gICAgdmFyIF9vYmplY3QgPSB7XG4gICAgICBvYmplY3Q6IHNsaWRlLFxuICAgICAgZGF0YTogc2xpZGUuZGF0YSxcbiAgICAgIHByb2plY3Q6IHRoaXMsXG4gICAgICBpZDogICArK3RoaXMuX2lkX2NvdW50ZXIsXG4gICAgICBjYW52YXMgOiBfY2FudmFzXG4gICAgfTtcblxuICAgIGZhYnJpYy51dGlsLm9ic2VydmFibGUoX29iamVjdCk7XG5cbiAgICB0aGlzLnNsaWRlcy5wdXNoKF9vYmplY3QpO1xuICAgIHJldHVybiBfb2JqZWN0O1xuICB9LFxuICBnZXRQcmljZTogZnVuY3Rpb24gKCkge1xuICAgIHZhciBfcHJpY2UgPSAwO1xuICAgIGZvciAodmFyIGkgaW4gdGhpcy5zbGlkZXMpIHtcbiAgICAgIF9wcmljZSArPSBwYXJzZUZsb2F0KHRoaXMuc2xpZGVzW2ldLmRhdGEucHJpY2UpIHx8IDA7XG4gICAgfVxuICAgIHJldHVybiBfcHJpY2U7XG4gIH0sXG4gIG5leHRTbGlkZTogZnVuY3Rpb24gKCkge1xuICAgIHZhciBpID0gdGhpcy5zbGlkZXMuaW5kZXhPZih0aGlzLmFjdGl2ZVNsaWRlKTtcbiAgICBpZiAoaSA8IHRoaXMuc2xpZGVzLmxlbmd0aCAtIDEpIHtcbiAgICAgIHRoaXMuc2V0QWN0aXZlU2xpZGUoaSArIDEpO1xuICAgIH1cbiAgfSxcbiAgcHJldlNsaWRlOiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGkgPSB0aGlzLnNsaWRlcy5pbmRleE9mKHRoaXMuYWN0aXZlU2xpZGUpO1xuICAgIGlmIChpID4gMCkge1xuICAgICAgdGhpcy5zZXRBY3RpdmVTbGlkZShpIC0gMSk7XG4gICAgfVxuICB9LFxuICBnb3RvU2xpZGU6IGZ1bmN0aW9uIChzbGlkZSkge1xuICAgIHRoaXMuc2V0QWN0aXZlU2xpZGUoc2xpZGUgLSAxKTtcbiAgfSxcbiAgbmV4dFNsaWRlQXZhaWxhYmxlOiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGkgPSB0aGlzLnNsaWRlcy5pbmRleE9mKHRoaXMuYWN0aXZlU2xpZGUpO1xuICAgIHJldHVybiBpIDwgdGhpcy5zbGlkZXMubGVuZ3RoIC0gMVxuICB9LFxuICBwcmV2U2xpZGVBdmFpbGFibGU6IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgaSA9IHRoaXMuc2xpZGVzLmluZGV4T2YodGhpcy5hY3RpdmVTbGlkZSk7XG4gICAgcmV0dXJuIGkgPiAwXG4gIH0sXG4gIGFjdGlvbnM6IHtcbiAgICBzYXZlOiB7XG4gICAgICB0aXRsZTogXCJzYXZlIHByb2plY3RcIixcbiAgICAgIGNsYXNzTmFtZTogJ2ZhIGZhLWZsb3BweS1vJyxcbiAgICAgIGFjdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgZGF0YSA9IHRoaXMudG9PYmplY3QoKTtcbiAgICAgICAgdGhpcy5hcHBsaWNhdGlvbi5hcGkuc2F2ZShkYXRhKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn07XG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5Qcm9qZWN0LnByb3RvdHlwZSxmYWJyaWMuT2JzZXJ2YWJsZSk7XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLlNsaWRlQ2FudmFzLnByb3RvdHlwZSwge1xuICAvKipcbiAgICogQ29weSB0aGUgY29udGVudCBvZiBhY3RpdmUgc2xpZGUgdG8gbWFpbiBjYW52YXMuXG4gICAqIEBwYXJhbSBzbGlkZVxuICAgKi9cbiAgbWlycm9yOiBmdW5jdGlvbiAoc2xpZGUpIHtcbiAgICB0aGlzLmRpc2NhcmRBY3RpdmVHcm91cCgpO1xuICAgIHRoaXMuZGlzY2FyZEFjdGl2ZU9iamVjdCgpO1xuICAgIC8vIHRoaXMuc2xpZGVXaWR0aCA9IHNsaWRlLnNsaWRlV2lkdGg7XG4gICAgLy8gdGhpcy5zbGlkZUhlaWdodCA9IHNsaWRlLnNsaWRlSGVpZ2h0O1xuICAgIHRoaXMuc2V0T3JpZ2luYWxTaXplKHt3aWR0aDogc2xpZGUub3JpZ2luYWxXaWR0aCB8fCBzbGlkZS53aWR0aCwgaGVpZ2h0OiBzbGlkZS5vcmlnaW5hbEhlaWdodCB8fCBzbGlkZS5oZWlnaHR9KVxuICAgIHRoaXMuYmFja2dyb3VuZEltYWdlID0gc2xpZGUuYmFja2dyb3VuZEltYWdlO1xuICAgIHRoaXMuc2V0V2lkdGgoKHNsaWRlLm9yaWdpbmFsV2lkdGggfHwgc2xpZGUud2lkdGgpKiB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzBdKTtcbiAgICB0aGlzLnNldEhlaWdodCgoc2xpZGUub3JpZ2luYWxIZWlnaHQgfHwgc2xpZGUuaGVpZ2h0KSAgKiB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzBdKTtcbiAgICB0aGlzLl9vblJlc2l6ZSgpO1xuICAgIHRoaXMuYWN0aXZlQXJlYSA9IHNsaWRlLmFjdGl2ZUFyZWE7XG4gICAgdGhpcy5vcmlnaW5hbFNsaWRlID0gc2xpZGU7XG5cbiAgICB0aGlzLnRlbXBsYXRlID0gc2xpZGUudGVtcGxhdGU7XG4gICAgdGhpcy5vZmZzZXRzID0gc2xpZGUub2Zmc2V0cztcbiAgICAvLyB0aGlzLl9vYmplY3RzID0gW107XG4gICAgLy8gdGhpcy5sYXllcnMgPSBzbGlkZS5sYXllcnM7XG5cbiAgICBpZih0aGlzLmJhY2tncm91bmRJbWFnZSl7XG4gICAgICB0aGlzLmJhY2tncm91bmRJbWFnZS5jYW52YXMgPSB0aGlzO1xuICAgIH1cbiAgICAvL3RvZG9cbiAgICAvLyBpZih0aGlzLl9iYWNrZ3JvdW5kTGF5ZXIpIHtcbiAgICAvLyAgIGZvciAodmFyIGkgaW4gdGhpcy5fYmFja2dyb3VuZExheWVyKSB7XG4gICAgLy8gICAgIHRoaXMuX2JhY2tncm91bmRMYXllcltpXS5jYW52YXMgPSB0aGlzO1xuICAgIC8vICAgICB0aGlzLl9iYWNrZ3JvdW5kTGF5ZXJbaV0uc2V0Q29vcmRzKCk7XG4gICAgLy8gICB9XG4gICAgLy8gICB0aGlzLnNldEFjdGl2ZUFyZWEodHJ1ZSk7XG4gICAgLy8gfWNkIGZpZXJcblxuICAgIGZvcih2YXIgbGF5ZXJOYW1lIGluIHNsaWRlLmxheWVycykge1xuICAgICAgdGhpcy5sYXllcnNbbGF5ZXJOYW1lXS5vYmplY3RzID0gW107XG4gICAgfVxuICAgIHRoaXMuX29iamVjdHMgPSB0aGlzLmxheWVycy5sb3dlci5vYmplY3RzO1xuXG4gICAgaWYoc2xpZGUubGF5ZXJzKSB7XG4gICAgICBmb3IodmFyIGxheWVyTmFtZSBpbiBzbGlkZS5sYXllcnMpe1xuICAgICAgICBmb3IgKHZhciBpIGluIHNsaWRlLmxheWVyc1tsYXllck5hbWVdLm9iamVjdHMpIHtcbiAgICAgICAgICB0aGlzLmFkZChzbGlkZS5sYXllcnNbbGF5ZXJOYW1lXS5vYmplY3RzW2ldKTtcbiAgICAgICAgfVxuICAgICAgICBzbGlkZS5sYXllcnNbbGF5ZXJOYW1lXS5vYmplY3RzID0gdGhpcy5sYXllcnNbbGF5ZXJOYW1lXS5vYmplY3RzO1xuICAgICAgfVxuICAgICAgc2xpZGUuX29iamVjdHMgPSB0aGlzLl9vYmplY3RzO1xuICAgIH1lbHNle1xuICAgICAgaWYoc2xpZGUuX29iamVjdHMpIHtcbiAgICAgICAgZm9yICh2YXIgaSBpbiBzbGlkZS5fb2JqZWN0cykge1xuICAgICAgICAgIHRoaXMuYWRkKHNsaWRlLl9vYmplY3RzW2ldKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgc2xpZGUuX29iamVjdHMgPSB0aGlzLl9vYmplY3RzO1xuICAgIH1cbiAgICB0aGlzLmZpcmUoJ2NoYW5nZWQnLCB7dGFyZ2V0OiBzbGlkZX0pXG4gIH0sXG4gIHByb2plY3Q6IG51bGwsXG4gIHVuaXF1ZTogZmFsc2UsXG4gIHJlcXVpcmVkOiBmYWxzZSxcbiAgc3RhdGVQcm9wZXJ0aWVzOiBbXCJ1bmlxdWVcIixcInJlcXVpcmVkXCJdLFxuICByZW1vdmVTbGlkZTogZnVuY3Rpb24oKXtcbiAgICB0aGlzLnByb2plY3QucmVtb3ZlU2xpZGUodGhpcylcbiAgfSxcbiAgZHVwbGljYXRlU2xpZGU6IGZ1bmN0aW9uKCl7XG4gICAgdGhpcy5wcm9qZWN0LmR1cGxpY2F0ZVNsaWRlKHRoaXMpXG4gIH1cbn0pO1xuXG5mYWJyaWMudXRpbC5jcmVhdGVBY2Nlc3NvcnMoZmFicmljLkNhbnZhcyk7XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL2NvcmUvcHJvamVjdC5qc1xuLy8gbW9kdWxlIGlkID0gNDJcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiXG5mYWJyaWMuQXBwbGljYXRpb24ucHJvdG90eXBlLmV2ZW50TGlzdGVuZXJzW1wiZW50aXR5OmNyZWF0ZWRcIl0ucHVzaChmdW5jdGlvbihlKXtcbiAgdmFyIHRhcmdldCA9IGUudGFyZ2V0O1xuXG4gIHRhcmdldC5hcHBsaWNhdGlvbiA9IHRoaXM7XG4gIGZhYnJpYy51dGlsLm9iamVjdC5kZWZhdWx0cyhlLm9wdGlvbnMsIHRoaXMuZ2V0RGVmYXVsdFByb3BlcnRpZXModGFyZ2V0LGUub3B0aW9ucykpO1xuXG4gIGZvcih2YXIga2V5IGluIGUub3B0aW9ucyl7XG4gICAgdmFyIHZhbHVlID0gZS5vcHRpb25zW2tleV07XG4gICAgaWYoa2V5WzBdID09IFwiK1wiKXtcbiAgICAgIHZhciBfa2V5ID0ga2V5LnN1YnN0cigxKTtcbiAgICAgIHZhciBfYXJyID0gdGFyZ2V0LmdldChfa2V5KTtcbiAgICAgIGlmKF9hcnIgaW5zdGFuY2VvZiBBcnJheSl7XG4gICAgICAgIF9hcnIgPSBfYXJyLnNsaWNlKCkuY29uY2F0KHZhbHVlKTtcbiAgICAgIH1lbHNle1xuICAgICAgICBfYXJyID0gZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCh7fSxfYXJyLHZhbHVlKTtcbiAgICAgIH1cbiAgICAgIGUub3B0aW9uc1tfa2V5XSA9IF9hcnI7XG4gICAgICBkZWxldGUgZS5vcHRpb25zW2tleV07XG4gICAgfVxuICB9XG5cbiAgZGVsZXRlIGUub3B0aW9ucy50eXBlO1xuICBkZWxldGUgZS5vcHRpb25zLmFwcGxpY2F0aW9uO1xufSk7XG5cblxuXG5cblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuQXBwbGljYXRpb24ucHJvdG90eXBlLCB7XG4gIGdldERlZmF1bHRQcm9wZXJ0aWVzOiBmdW5jdGlvbihwcm90byl7XG4gICAgaWYoIXRoaXMucHJvdG90eXBlcylyZXR1cm47XG5cbiAgICB2YXIga2xhc3NuYW1lID0gZmFicmljLnV0aWwuc3RyaW5nLmNhcGl0YWxpemUoZmFicmljLnV0aWwuc3RyaW5nLmNhbWVsaXplKHByb3RvLnR5cGUpLHRydWUpO1xuXG4gICAgdmFyIF9wcm90b1Byb3BlcnRpZXMgPSBwcm90by5fX3Byb3RvX18gJiYgcHJvdG8uX19wcm90b19fLnR5cGUgJiYgdGhpcy5nZXREZWZhdWx0UHJvcGVydGllcyhwcm90by5fX3Byb3RvX18pIHx8IHt9O1xuICAgIHZhciBfZGVmYXVsdFByb3BlcnRpZXMgPSBmYWJyaWMudXRpbC5vYmplY3QuY2xvbmUodGhpcy5wcm90b3R5cGVzW2tsYXNzbmFtZV0pO1xuXG4gICAgZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChfcHJvdG9Qcm9wZXJ0aWVzLF9kZWZhdWx0UHJvcGVydGllcyk7XG5cbiAgICByZXR1cm4gX3Byb3RvUHJvcGVydGllcztcbiAgfSxcbiAgLyoqXG4gICAqIGRlZmF1bHQgcHJvdG90eXBlcyBwcm9wZXJ0ZXMgZm9yIG9iamVjdHNcbiAgICovXG4gIHByb3RvdHlwZXM6IHtcbiAgICBPYmplY3Q6IHtcbiAgICAgIGluY2x1ZGVEZWZhdWx0VmFsdWVzOiBmYWxzZVxuICAgIH0sXG4gICAgQ2FudmFzOiB7XG4gICAgICBpbmNsdWRlRGVmYXVsdFZhbHVlczogZmFsc2VcbiAgICB9XG4gIH0sXG4gIGluaXRVdGlsczogZnVuY3Rpb24gKCkge1xuXG4gICAgaWYoIXRoaXMub3B0aW9ucy51dGlsKXtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCh0aGlzLnV0aWwgfHwge30sdGhpcy5vcHRpb25zLnV0aWwpO1xuXG4gICAgdmFyIF9tZWRpYVJvb3QgPSB0aGlzLm9wdGlvbnMudXRpbC5tZWRpYVJvb3Q7XG4gICAgaWYoX21lZGlhUm9vdCl7XG4gICAgICBpZigoX21lZGlhUm9vdC5pbmRleE9mKFwiLi9cIikgPT0gMCkpe1xuICAgICAgICB2YXIgX2Rpcm5hbWU7XG4gICAgICAgIGlmKGZhYnJpYy5pc0xpa2VseU5vZGUpe1xuICAgICAgICAgIF9kaXJuYW1lID0gX19kaXJuYW1lO1xuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICBfZGlybmFtZSA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmICsgXCIvLi4vXCJcbiAgICAgICAgfVxuICAgICAgICBfbWVkaWFSb290ID0gZmFicmljLnV0aWwucGF0aC5yZXNvbHZlKF9kaXJuYW1lICsgX21lZGlhUm9vdCk7XG4gICAgICB9XG4gICAgICB2YXIgX2xhc3QgPSBfbWVkaWFSb290W19tZWRpYVJvb3QubGVuZ3RoIC0gMV07XG4gICAgICBpZihfbGFzdCAhPSBcIi9cIiAmJiBfbGFzdCAhPSBcIlxcXFxcIil7XG4gICAgICAgIF9tZWRpYVJvb3QgKz1cIi9cIlxuICAgICAgfVxuICAgICAgX21lZGlhUm9vdCA9IGZhYnJpYy51dGlsLnBhdGgucmVzb2x2ZShfZGlybmFtZSArIF9tZWRpYVJvb3QpO1xuICAgICAgZmFicmljLnV0aWwubWVkaWFSb290ID0gX21lZGlhUm9vdDtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5vcHRpb25zWyd1dGlsJ10pIHtcbiAgICAgIGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLnV0aWwsIHRoaXMub3B0aW9uc1sndXRpbCddKTtcbiAgICB9XG4gICAgaWYgKHRoaXMub3B0aW9uc1snZmFicmljJ10pIHtcbiAgICAgIGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLCB0aGlzLm9wdGlvbnNbJ2ZhYnJpYyddKTtcbiAgICB9XG4gICAgZGVsZXRlIHRoaXMub3B0aW9uc1snZmFicmljJ107XG4gICAgZGVsZXRlIHRoaXMub3B0aW9uc1sndXRpbCddO1xuICB9LFxuICBpbml0UHJvdG90eXBlczogZnVuY3Rpb24gKCkge1xuXG4gICAgdmFyIF9wcm90b3R5cGVzID0gZmFicmljLnV0aWwub2JqZWN0LmRlZXBFeHRlbmQoe30sIHRoaXMucHJvdG90eXBlcyAsdGhpcy5vcHRpb25zLnByb3RvdHlwZXMpO1xuXG4gICAgdGhpcy5wcm90b3R5cGVzID0gX3Byb3RvdHlwZXM7XG4gICAgdGhpcy5rbGFzc2VzID0ge307XG5cblxuICAgIGlmKF9wcm90b3R5cGVzLmV2ZW50TGlzdGVuZXJzKXtcbiAgICAgIF9wcm90b3R5cGVzLmV2ZW50TGlzdGVuZXJzLiRleHRlbmQgPSAnYXJyYXknO1xuICAgIH1cblxuICAgIGZvciAodmFyIGtsYXNzTmFtZSBpbiBfcHJvdG90eXBlcykge1xuICAgICAgdmFyIF9wcm90byA9IF9wcm90b3R5cGVzW2tsYXNzTmFtZV07XG5cbiAgICAgIGZvciAodmFyIGogaW4gX3Byb3RvKSB7XG4gICAgICAgIGlmIChfcHJvdG9bal0gJiYgX3Byb3RvW2pdW1wiJGV4dGVuZFwiXSkge1xuICAgICAgICAgIHZhciBfZXh0ZW5kID0gX3Byb3RvW2pdW1wiJGV4dGVuZFwiXTtcbiAgICAgICAgICBpZiggX2V4dGVuZCA9PSBcImFycmF5XCIpe1xuICAgICAgICAgICAgX3Byb3RvW2pdID0gZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZEFycmF5c09iamVjdChmYWJyaWNba2xhc3NOYW1lXS5wcm90b3R5cGVbal0sX3Byb3RvW2pdKTtcbiAgICAgICAgICB9IGVsc2UgaWYoIF9leHRlbmQgPT0gXCJkZWVwXCIpe1xuICAgICAgICAgICAgX3Byb3RvW2pdID0gZmFicmljLnV0aWwub2JqZWN0LmRlZXBFeHRlbmQoZmFicmljW2tsYXNzTmFtZV0ucHJvdG90eXBlW2pdLF9wcm90b1tqXSk7XG4gICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICBfcHJvdG9bal0gPSBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpY1trbGFzc05hbWVdLnByb3RvdHlwZVtqXSxfcHJvdG9bal0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBkZWxldGUgX3Byb3RvW2pdW1wiJGV4dGVuZFwiXTtcbiAgICAgICAgfVxuICAgICAgfVxuXG5cbiAgICAgIGlmKF9wcm90b1tcIiRzdXBlclwiXSl7XG4gICAgICAgIHZhciBfc3VwZXJrbGFzcyA9IGZhYnJpY1tfcHJvdG9bXCIkc3VwZXJcIl0gfHwga2xhc3NOYW1lXSA7XG4gICAgICAgIGRlbGV0ZSBfcHJvdG9bXCIkc3VwZXJcIl07XG5cbiAgICAgICAgdmFyIF9mcm9tT2JqZWN0ID0gX3Byb3RvLmZyb21PYmplY3QgfHwgX3N1cGVya2xhc3MuZnJvbU9iamVjdCA7XG4gICAgICAgIGRlbGV0ZSBfcHJvdG8uZnJvbU9iamVjdDtcbiAgICAgICAgdmFyIF9rbGFzcyA9IHRoaXMua2xhc3Nlc1trbGFzc05hbWVdID0gZmFicmljLnV0aWwuY3JlYXRlQ2xhc3MoX3N1cGVya2xhc3MsIF9wcm90byk7XG4gICAgICAgIF9rbGFzcy5mcm9tT2JqZWN0ID0gX2Zyb21PYmplY3QuYmluZChfa2xhc3MpO1xuICAgICAgfVxuXG4gICAgLy8gICBpZiAoa2xhc3NOYW1lLmFjdGlvbnMgJiYgX3Byb3RvLmFjdGlvbnMuY29uc3RydWN0b3IgPT0gRnVuY3Rpb24pIHtcbiAgICAvLyAgICAgZmFicmljW2tsYXNzTmFtZV0ucHJvdG90eXBlLmFjdGlvbnMgPSBfcHJvdG8uYWN0aW9ucy5jYWxsKGZhYnJpY1trbGFzc05hbWVdLnByb3RvdHlwZSlcbiAgICAvLyAgIH1cbiAgICB9XG5cbiAgICBpZiAoX3Byb3RvdHlwZXMuQXBwbGljYXRpb24pIHtcbiAgICAgIGZhYnJpYy51dGlsLm9iamVjdC5kZWVwRXh0ZW5kKHRoaXMsIF9wcm90b3R5cGVzLkFwcGxpY2F0aW9uKTtcbiAgICB9XG5cbiAgICAvLyBkZWxldGUgdGhpcy5vcHRpb25zWydwcm90b3R5cGVzJ107XG5cbiAgICBpZiAodGhpcy5hY3Rpb25zICYmIHRoaXMuYWN0aW9ucy5jb25zdHJ1Y3RvciA9PSBGdW5jdGlvbikge1xuICAgICAgdGhpcy5hY3Rpb25zID0gdGhpcy5hY3Rpb25zLmNhbGwodGhpcylcbiAgICB9XG4gIH1cbn0pO1xuXG5mYWJyaWMuQXBwbGljYXRpb25cbiAgLmFkZFBsdWdpbihcImNvbmZpZ3VyYXRpb25cIixcImluaXRVdGlsc1wiKVxuICAuYWRkUGx1Z2luKFwiY29uZmlndXJhdGlvblwiLFwiaW5pdFByb3RvdHlwZXNcIik7XG5cblxuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9jb3JlL3Byb3RvdHlwZXMuanNcbi8vIG1vZHVsZSBpZCA9IDQzXG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIid1c2Ugc3RyaWN0JztcblxuZmFicmljLlNsaWRlQ2FudmFzID0gZmFicmljLnV0aWwuY3JlYXRlQ2xhc3MoZmFicmljLkNhbnZhcyxmYWJyaWMuUGx1Z2luc01peGluLCB7XG4gIHR5cGU6ICdzbGlkZS1jYW52YXMnLFxuICBfY3JlYXRlVXBwZXJDYW52YXNOYXRpdmU6IGZhYnJpYy5DYW52YXMucHJvdG90eXBlLl9jcmVhdGVVcHBlckNhbnZhcyxcbiAgd2lkdGg6IDE2MCAsXG4gIGhlaWdodDogOTAsXG4gIGRvdHNQZXJVbml0OiAxLFxuICBzY2FsZTogMSxcbiAgbG9hZGVkOiBmYWxzZSxcbiAgaW5zZXJ0QmFja2dyb3VuZENvbG9yOiBmYWxzZSxcbiAgcGx1Z2luczoge1xuICAgIGluaXRpYWxpemU6IFtcbiAgICAgIGZ1bmN0aW9uIGluaXRab29taW5nKG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5lbmFibGVDbGlwQXJlYVpvb21pbmcgJiYgdGhpcy5lbmFibGVDbGlwQXJlYVpvb21pbmcoKTtcbiAgICAgIH1cbiAgICBdLFxuICAgIHByZWxvYWRlcnM6IFtcbiAgICAgIGZ1bmN0aW9uIGluaXRUZW1wbGF0ZShvcHRpb25zKXtcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSAmJiB0aGlzLnNldFRlbXBsYXRlKHRoaXMudGVtcGxhdGUpO1xuICAgICAgfVxuICAgIF0sXG4gICAgbG9hZGVyczogW10sXG4gICAgc2F2ZXJzIDogW1xuICAgICAgZnVuY3Rpb24gc2VyaWFsaXplVGh1bWIocHJvcGVydGllc1RvSW5jbHVkZSwgX2RhdGEpe1xuICAgICAgICBpZihwcm9wZXJ0aWVzVG9JbmNsdWRlLmluZGV4T2YoJ3RodW1iJykgIT09IC0xKXtcbiAgICAgICAgICB2YXIgc2l6ZSA9IGZhYnJpYy51dGlsLmdldFByb3BvcnRpb25zKHRoaXMuZ2V0T3JpZ2luYWxTaXplKCksIHRoaXMudGh1bWJTaXplLCAnZml0Jyk7XG4gICAgICAgICAgdmFyIGNhbnZhcyA9IGZhYnJpYy51dGlsLmNyZWF0ZUNhbnZhc0VsZW1lbnQoKTtcbiAgICAgICAgICBjYW52YXMud2lkdGggPSBzaXplLndpZHRoO1xuICAgICAgICAgIGNhbnZhcy5oZWlnaHQgPSBzaXplLmhlaWdodDtcbiAgICAgICAgICB0aGlzLnJlbmRlclRodW1iKGNhbnZhcyk7XG4gICAgICAgICAgX2RhdGEudGh1bWIgPSBjYW52YXMudG9EYXRhVVJMKCk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBmdW5jdGlvbiBzZXJpYWxpemVUZW1wbGF0ZShwcm9wZXJ0aWVzVG9JbmNsdWRlLCBfZGF0YSkge1xuICAgICAgICBpZiAocHJvcGVydGllc1RvSW5jbHVkZS5pbmRleE9mKCd0ZW1wbGF0ZScpICE9PSAtMSkge1xuICAgICAgICAgIGlmICh0aGlzLnRlbXBsYXRlKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBpIGluIF9kYXRhLnRlbXBsYXRlKSB7XG4gICAgICAgICAgICAgIGlmIChKU09OLnN0cmluZ2lmeShfZGF0YVtpXSkgPT0gSlNPTi5zdHJpbmdpZnkoX2RhdGEudGVtcGxhdGVbaV0pKSB7XG4gICAgICAgICAgICAgICAgZGVsZXRlIF9kYXRhW2ldO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBfZGF0YS50ZW1wbGF0ZSA9IHRoaXMudGVtcGxhdGUuaWQ7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgXVxuICB9LFxuICBzZXRJbnRlcmFjdGl2ZTogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgdGhpcy5pbnRlcmFjdGl2ZSA9IHZhbHVlO1xuICB9LCAvKipcbiAgICogQHByaXZhdGVcbiAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXSBPcHRpb25zIG9iamVjdFxuICAgKi9cbiAgX2luaXRPcHRpb25zOiBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgIHRoaXMud2lkdGggPSB0aGlzLndpZHRoIHx8IHBhcnNlSW50KHRoaXMubG93ZXJDYW52YXNFbC53aWR0aCwgMTApIHx8IDA7XG4gICAgdGhpcy5oZWlnaHQgPSB0aGlzLmhlaWdodCB8fCBwYXJzZUludCh0aGlzLmxvd2VyQ2FudmFzRWwuaGVpZ2h0LCAxMCkgfHwgMDtcblxuICAgIGlmICghdGhpcy5sb3dlckNhbnZhc0VsLnN0eWxlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5sb3dlckNhbnZhc0VsLndpZHRoID0gdGhpcy53aWR0aDtcbiAgICB0aGlzLmxvd2VyQ2FudmFzRWwuaGVpZ2h0ID0gdGhpcy5oZWlnaHQ7XG5cbiAgICB0aGlzLmxvd2VyQ2FudmFzRWwuc3R5bGUud2lkdGggPSB0aGlzLndpZHRoICsgJ3B4JztcbiAgICB0aGlzLmxvd2VyQ2FudmFzRWwuc3R5bGUuaGVpZ2h0ID0gdGhpcy5oZWlnaHQgKyAncHgnO1xuXG4gICAgdGhpcy52aWV3cG9ydFRyYW5zZm9ybSA9IHRoaXMudmlld3BvcnRUcmFuc2Zvcm0uc2xpY2UoKTtcbiAgfSxcbiAgY29udGV4dFRvcEltYWdlU21vb3RoaW5nRW5hYmxlZDogdHJ1ZSxcbiAgX2NyZWF0ZVVwcGVyQ2FudmFzOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5fY3JlYXRlVXBwZXJDYW52YXNOYXRpdmUoKTtcbiAgICB2YXIgY3R4ID0gdGhpcy5jb250ZXh0VG9wO1xuXG4gICAgaWYoY3R4LmltYWdlU21vb3RoaW5nRW5hYmxlZCl7XG4gICAgICBjdHguaW1hZ2VTbW9vdGhpbmdFbmFibGVkID0gdGhpcy5jb250ZXh0VG9wSW1hZ2VTbW9vdGhpbmdFbmFibGVkO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjdHgud2Via2l0SW1hZ2VTbW9vdGhpbmdFbmFibGVkID0gdGhpcy5jb250ZXh0VG9wSW1hZ2VTbW9vdGhpbmdFbmFibGVkO1xuICAgIGN0eC5tb3pJbWFnZVNtb290aGluZ0VuYWJsZWQgICAgPSB0aGlzLmNvbnRleHRUb3BJbWFnZVNtb290aGluZ0VuYWJsZWQ7XG4gICAgY3R4Lm1zSW1hZ2VTbW9vdGhpbmdFbmFibGVkICAgICA9IHRoaXMuY29udGV4dFRvcEltYWdlU21vb3RoaW5nRW5hYmxlZDtcbiAgICBjdHgub0ltYWdlU21vb3RoaW5nRW5hYmxlZCAgICAgID0gdGhpcy5jb250ZXh0VG9wSW1hZ2VTbW9vdGhpbmdFbmFibGVkO1xuICB9LFxuICAvKipcbiAgICogQHByaXZhdGVcbiAgICogQHBhcmFtIHtFdmVudH0gZSBFdmVudCBvYmplY3QgZmlyZWQgb24gbW91c2V1cFxuICAgKi9cbiAgX29uTW91c2VVcEluRHJhd2luZ01vZGU6IGZ1bmN0aW9uKGUpIHtcbiAgICB0aGlzLl9pc0N1cnJlbnRseURyYXdpbmcgPSBmYWxzZTtcbiAgICBpZiAodGhpcy5jbGlwVG8pIHtcbiAgICAgIHRoaXMuY29udGV4dFRvcC5yZXN0b3JlKCk7XG4gICAgfVxuICAgIHZhciBwb2ludGVyID0gdGhpcy5nZXRQb2ludGVyKGUpO1xuICAgIHRoaXMuZnJlZURyYXdpbmdCcnVzaC5vbk1vdXNlVXAocG9pbnRlcik7XG4gICAgdGhpcy5faGFuZGxlRXZlbnQoZSwgJ3VwJyk7XG4gIH0sXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uIChlbCwgb3B0aW9ucyxjYWxsYmFjaykge1xuICAgIGlmKGVsICYmIGVsLmNvbnN0cnVjdG9yID09IE9iamVjdCl7XG4gICAgICBjYWxsYmFjaz0gb3B0aW9ucztcbiAgICAgIG9wdGlvbnMgPSBlbDtcbiAgICAgIGVsID0gbnVsbDtcbiAgICB9XG4gICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG5cblxuICAgIGlmKG9wdGlvbnMucHJvamVjdCl7XG4gICAgICBpZighb3B0aW9ucy5hcHBsaWNhdGlvbil7XG4gICAgICAgIG9wdGlvbnMuYXBwbGljYXRpb24gPSBvcHRpb25zLnByb2plY3QuYXBwbGljYXRpb247XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYob3B0aW9ucy5hcHBsaWNhdGlvbil7XG4gICAgICBvcHRpb25zLmFwcGxpY2F0aW9uLmZpcmUoXCJlbnRpdHk6Y3JlYXRlZFwiLHt0YXJnZXQgOiB0aGlzICwgb3B0aW9ucyA6IG9wdGlvbnN9KTtcbiAgICB9XG5cbiAgICB0aGlzLmlkID0gZmFicmljLlNsaWRlQ2FudmFzLl9faWRjb3VudGVyKys7XG5cbiAgICB0aGlzLl9vYmplY3RzID0gW107XG4gICAgdGhpcy5fY3JlYXRlTG93ZXJDYW52YXMoZWwpO1xuXG5cbiAgICBpZighdGhpcy52aXJ0dWFsKXtcbiAgICAgIHRoaXMuY3JlYXRlZCA9IHRydWU7XG5cblxuICAgICAgdGhpcy5fY3VycmVudFRyYW5zZm9ybSA9IG51bGw7XG4gICAgICB0aGlzLl9ncm91cFNlbGVjdG9yID0gbnVsbDtcbiAgICAgIHRoaXMuX2luaXRXcmFwcGVyRWxlbWVudCgpO1xuICAgICAgdGhpcy5fY3JlYXRlVXBwZXJDYW52YXMoKTtcbiAgICAgIHRoaXMuX2luaXRFdmVudExpc3RlbmVycygpO1xuICAgICAgdGhpcy5faW5pdFJldGluYVNjYWxpbmcoKTtcbiAgICAgIHRoaXMuY2FsY09mZnNldCgpO1xuICAgICAgdGhpcy5pbml0TGF5ZXJzKCk7XG5cbiAgICAgIC8vdG9kbyBmcm9tIGxheWVycyBtb2R1bGVcbiAgICAgIHRoaXMubGF5ZXJzLnVwcGVyID0ge1xuICAgICAgICB6aW5kZXg6ICAgICA5OSxcbiAgICAgICAgdHJhbnNmb3JtOiAgZmFsc2UsXG4gICAgICAgIG9iamVjdHM6ICAgIFtdLFxuICAgICAgICBjYW52YXM6ICAgICB0aGlzLnVwcGVyQ2FudmFzRWwsXG4gICAgICAgIGNvbnRleHQ6ICAgIHRoaXMuY29udGV4dFRvcFxuICAgICAgfTtcblxuXG5cbiAgICAgIHRoaXMuX2NyZWF0ZUNhY2hlQ2FudmFzKCk7XG4gICAgICB0aGlzLl9zZXRJbWFnZVNtb290aGluZygpO1xuICAgICAgdGhpcy5faW5pdFJldGluYVNjYWxpbmcoKTtcbiAgICB9ZWxzZXtcbiAgICAgIHRoaXMuaW5pdExheWVycygpO1xuICAgIH1cblxuICAgIHRoaXMucGx1Z2lucy5pbml0aWFsaXplLmZvckVhY2goZnVuY3Rpb24oaW5pdGlhbGl6ZXIpe1xuICAgICAgaW5pdGlhbGl6ZXIuY2FsbCh0aGlzLCBvcHRpb25zKTtcbiAgICB9LmJpbmQodGhpcykpO1xuXG4gICAgaWYob3B0aW9uc1tcIithY3Rpb25zXCJdKSB7XG4gICAgICB0aGlzLnNldChcIithY3Rpb25zXCIsIG9wdGlvbnNbXCIrYWN0aW9uc1wiXSlcbiAgICB9XG4gICAgaWYob3B0aW9ucy5hY3Rpb25zKXtcbiAgICAgIHRoaXMuc2V0KFwiYWN0aW9uc1wiLG9wdGlvbnMuYWN0aW9ucylcbiAgICB9XG5cblxuICAgIGlmKG9wdGlvbnMgJiYgb3B0aW9ucy5vblJlc2l6ZSl7XG4gICAgICB0aGlzLm9uUmVzaXplID0gb3B0aW9ucy5vblJlc2l6ZTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5yZXF1ZXN0QW5pbUZyYW1lKSB7XG4gICAgICB0aGlzLmFkZFZpZGVvc1N1cHBvcnQoKTtcbiAgICB9XG5cbiAgICB0aGlzLl9pbml0T3B0aW9ucygpO1xuXG4gICAgdGhpcy5fc2V0T2JqZWN0KG9wdGlvbnMpO1xuXG4gICAgdGhpcy5jYWxjT2Zmc2V0KCk7XG5cbiAgICB0aGlzLm9uKHtcbiAgICAgICdvYmplY3Q6bW92aW5nJzogZnVuY3Rpb24gKG9iaikge1xuICAgICAgICB0aGlzLmZpcmUoJ3RhcmdldDptb2RpZmllZCcsIHRoaXMsIG9iailcbiAgICAgIH0sXG4gICAgICAnc2VsZWN0aW9uOmNsZWFyZWQnOiBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgdGhpcy50YXJnZXQuZmlyZSgnZGVzZWxlY3RlZCcsIGV2ZW50KTtcbiAgICAgICAgdGhpcy50YXJnZXQgPSBudWxsO1xuICAgICAgICB0aGlzLmZpcmUoJ3RhcmdldDpjbGVhcmVkJywgZXZlbnQpO1xuICAgICAgfSxcbiAgICAgICdvYmplY3Q6c2VsZWN0ZWQnOiBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgZXZlbnQucHJldmlvdXMgPSB0aGlzLnRhcmdldDtcbiAgICAgICAgdGhpcy50YXJnZXQgPSBldmVudC50YXJnZXQ7XG4gICAgICAgIGlmKGV2ZW50LnByZXZpb3VzKXtcbiAgICAgICAgICBldmVudC5wcmV2aW91cy5maXJlKCdkZXNlbGVjdGVkJywgZXZlbnQpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZmlyZSgndGFyZ2V0OmNoYW5nZWQnLCBldmVudCk7XG4gICAgICB9LFxuICAgICAgJ2dyb3VwOnNlbGVjdGVkJzogZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIHRoaXMudGFyZ2V0ID0gZXZlbnQudGFyZ2V0O1xuICAgICAgICB0aGlzLmZpcmUoJ3RhcmdldDpjaGFuZ2VkJywgZXZlbnQpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gdGhpcy5sb2FkKG9wdGlvbnMsY2FsbGJhY2spO1xuXG4gICAgdGhpcy5maXJlKFwiY3JlYXRlZFwiKTtcbiAgICAvLyBpZih0aGlzLmFwcGxpY2F0aW9uKXtcbiAgICAvLyAgIHRoaXMuYXBwbGljYXRpb24uZmlyZShcImNhbnZhczpjcmVhdGVkXCIse3RhcmdldCA6IHRoaXN9KTtcbiAgICAvLyB9XG4gIH0sXG4gIGNyZWF0ZTogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuY3JlYXRlZCA9IHRydWU7XG4gICAgdGhpcy5faW5pdEludGVyYWN0aXZlKCk7XG4gICAgdGhpcy5fY3JlYXRlQ2FjaGVDYW52YXMoKTtcbiAgfSxcbiAgc3RvcmVQcm9wZXJ0aWVzOiBbJyonLCdiYWNrZ3JvdW5kSW1hZ2UnLCd3aWR0aCcsJ2hlaWdodCddLFxuICB0b09iamVjdDogZnVuY3Rpb24gKHByb3BlcnRpZXNUb0luY2x1ZGUpIHtcblxuICAgIHByb3BlcnRpZXNUb0luY2x1ZGUgPSAocHJvcGVydGllc1RvSW5jbHVkZSB8fCBbXSkuY29uY2F0KHRoaXMuc3RvcmVQcm9wZXJ0aWVzKTtcblxuICAgIHZhciBfc2VsZiA9ICB0aGlzO1xuICAgIHZhciBfb2JqcyA9IHRoaXMuZ2V0T2JqZWN0cygpO1xuXG4gICAgX29ianMgPSBmYWJyaWMudXRpbC5vYmplY3QuZmlsdGVyKF9vYmpzLHtzdG9yZWQ6IHRydWV9KTtcbiAgICBfb2JqcyA9IF9vYmpzLm1hcChmdW5jdGlvbihpbnN0YW5jZSkge1xuICAgICAgcmV0dXJuIGluc3RhbmNlLnRvT2JqZWN0KF9zZWxmLm9iamVjdHNQcm9wZXJ0aWVzVG9JbmNsdWRlKTtcbiAgICB9KTtcblxuICAgIHZhciBfZGF0YSA9IHtcbiAgICAgIG9iamVjdHM6IF9vYmpzXG4gICAgfTtcblxuICAgIGZhYnJpYy51dGlsLnBvcHVsYXRlV2l0aFByb3BlcnRpZXModGhpcywgX2RhdGEsIHRoaXMucHJvcGVydGllc1RvSW5jbHVkZSk7XG4gICAgLy9cbiAgICAvLyBmb3IodmFyIGkgaW4gcHJvcGVydGllc1RvSW5jbHVkZSl7XG4gICAgLy8gICB2YXIgX3Byb3AgPSBwcm9wZXJ0aWVzVG9JbmNsdWRlW2ldO1xuICAgIC8vICAgX2RhdGFbX3Byb3BdID0gdGhpc1tfcHJvcF07XG4gICAgLy8gfVxuXG4gICAgaWYocHJvcGVydGllc1RvSW5jbHVkZS5pbmRleE9mKCdiYWNrZ3JvdW5kSW1hZ2UnKSAhPT0gLTEpe1xuICAgICAgZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChfZGF0YSwgdGhpcy5fX3NlcmlhbGl6ZUJnT3ZlcmxheSgpKTtcbiAgICB9XG5cbiAgICBpZihwcm9wZXJ0aWVzVG9JbmNsdWRlLmluZGV4T2YoJ3dpZHRoJykgIT09IC0xICYmIHRoaXMub3JpZ2luYWxXaWR0aCl7XG4gICAgICBfZGF0YS53aWR0aCA9IHRoaXMub3JpZ2luYWxXaWR0aDtcbiAgICB9XG4gICAgaWYocHJvcGVydGllc1RvSW5jbHVkZS5pbmRleE9mKCdoZWlnaHQnKSAhPT0gLTEgJiYgdGhpcy5vcmlnaW5hbEhlaWdodCl7XG4gICAgICBfZGF0YS5oZWlnaHQgPSB0aGlzLm9yaWdpbmFsSGVpZ2h0O1xuICAgIH1cblxuICAgIHRoaXMucGx1Z2lucy5zYXZlcnMuZm9yRWFjaChmdW5jdGlvbihzYXZlcil7XG4gICAgICBzYXZlci5jYWxsKHRoaXMsIHByb3BlcnRpZXNUb0luY2x1ZGUsIF9kYXRhKTtcbiAgICB9LmJpbmQodGhpcykpO1xuICAgIHRoaXMuZmlyZShcImJlZm9yZTpvYmplY3RcIix7b2JqZWN0OiBfZGF0YX0pO1xuXG4gICAgcmV0dXJuIF9kYXRhO1xuICB9LFxuICBkZWZhdWx0VGV4dDogXCJ0ZXh0XCIsXG4gIGRlZmF1bHRUZXh0VHlwZTogXCJ0ZXh0XCIsXG4gIHRodW1iU2l6ZToge1xuICAgIHdpZHRoOiA1MCxcbiAgICBoZWlnaHQ6IDEwMFxuICB9LFxuICBzZXRUZW1wbGF0ZTogZnVuY3Rpb24odGVtcGxhdGUpe1xuXG4gICAgdGhpcy50ZW1wbGF0ZSA9IHRlbXBsYXRlO1xuICAgIGlmKCF0ZW1wbGF0ZSlyZXR1cm47XG5cbiAgICB0aGlzLnNldFdpZHRoKHRoaXMuc2xpZGVXaWR0aCB8fCB0ZW1wbGF0ZS53aWR0aCk7XG4gICAgdGhpcy5zZXRIZWlnaHQodGhpcy5zbGlkZUhlaWdodCB8fCB0ZW1wbGF0ZS5oZWlnaHQpO1xuICAgIHRoaXMub3JpZ2luYWxIZWlnaHQgPSB0aGlzLmhlaWdodDtcbiAgICB0aGlzLm9yaWdpbmFsV2lkdGggPSB0aGlzLndpZHRoO1xuXG4gICAgdGhpcy5zZXQoZmFicmljLnV0aWwub2JqZWN0LnJlYXJyYW5nZSh0ZW1wbGF0ZSxbXCJhcmVhc1wiLFwiaGVscGVyc1wiLFwib2Zmc2V0c1wiXSkpO1xuXG4gICAgdGhpcy5fdXBkYXRlX2NsaXBfcmVjdCgpO1xuICAgIHRoaXMuX3VwZGF0ZV9iYWNrZ3JvdW5kX2ltYWdlKCk7XG4gICAgdGhpcy5maXJlKFwibW9kaWZpZWRcIix7dHlwZTogXCJ0ZW1wbGF0ZVwifSk7XG4gICAgdGhpcy5yZW5kZXJBbGwoKTtcbiAgfSxcbiAgYWRkVGV4dDogZnVuY3Rpb24gKHRleHQsIG9wdGlvbnMpIHtcbiAgICB0aGlzLmNyZWF0ZU9iamVjdCh7XG4gICAgICBwb3NpdGlvbjogXCJjZW50ZXJcIixcbiAgICAgIHRleHQ6IHRleHQsXG4gICAgICB0eXBlOiAgIHRoaXMuZGVmYXVsdFRleHRUeXBlLFxuICAgICAgY2xpcFRvOiB0aGlzLmFjdGl2ZUFyZWEsXG4gICAgICBtb3ZlbWVudExpbWl0cyA6IHRoaXMuYWN0aXZlQXJlYVxuICAgIH0pO1xuICB9LFxuICB1cGxvYWRBY3Rpb246IGZ1bmN0aW9uIChpbWcpIHtcbiAgICBpZiAoIWltZylyZXR1cm47XG4gICAgdGhpcy5jcmVhdGVPYmplY3Qoe1xuICAgICAgcG9zaXRpb246IFwiY2VudGVyXCIsXG4gICAgICBhY3RpdmU6IHRydWUsXG4gICAgICB0eXBlOiAgIHRoaXMudXBsb2FkQ2xhc3MsXG4gICAgICBpbWFnZTogIGltZyxcbiAgICAgIGNsaXBUbzogdGhpcy5hY3RpdmVBcmVhLFxuICAgICAgbW92ZW1lbnRMaW1pdHMgOiB0aGlzLmFjdGl2ZUFyZWFcbiAgICB9KTtcbiAgfSxcbiAgdXBsb2FkQ2xhc3M6ICdJbWFnZScsXG4gIHVwbG9hZEltYWdlVG9vbDogZmFsc2UsXG4gIGFkZFRleHRUb29sOiBmYWxzZVxufSk7XG5mYWJyaWMuU2xpZGVDYW52YXMuX19pZGNvdW50ZXIgPSAwO1xuZmFicmljLlNsaWRlQ2FudmFzLmZyb21Kc29uID0gZnVuY3Rpb24odXJsLGNhbGxiYWNrICwgZWxlbWVudCl7XG4gIGZhYnJpYy51dGlsLmRhdGEubG9hZEpzb24odXJsLGZ1bmN0aW9uKGRhdGEpe1xuICAgIG5ldyBmYWJyaWMuU2xpZGVDYW52YXMoZWxlbWVudCxkYXRhLGNhbGxiYWNrKVxuICB9KVxufTtcblxuZmFicmljLlNsaWRlQ2FudmFzLnByb3RvdHlwZS5hY3Rpb25zID0gZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCh7fSwge1xuICAvL3NlbGVjdEFsbDoge1xuICAvLyAgdGl0bGU6ICdzZWxlY3RBbGwnLFxuICAvLyAgdHlwZTogJ2tleSdcbiAgLy99LFxuICBiYWNrZ3JvdW5kQ29sb3IgOiB7XG4gICAgdHlwZTogXCJjb2xvclwiXG4gIH0sXG4gIGFkZFRleHQ6IHtcbiAgICBpbnNlcnQ6ICdhZGRUZXh0VG9vbCcsXG4gICAgY2xhc3NOYW1lOiAgJ2ZhIGZhLWZvbnQnLFxuICAgIHRpdGxlOiAndGV4dCcsXG4gICAgYWN0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLmFkZFRleHQodGhpcy5kZWZhdWx0VGV4dCx7fSk7XG4gICAgfVxuICB9LFxuICB1cGxvYWQ6IHtcbiAgICBpbnNlcnQ6ICd1cGxvYWRJbWFnZVRvb2wnLFxuICAgIGNsYXNzTmFtZTogICdmYSBmYS11cGxvYWQnLFxuICAgIGtleTogJ1UnLFxuICAgIHRpdGxlOiAndXBsb2FkIGltYWdlJyxcbiAgICBhY3Rpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgIGZhYnJpYy51dGlsLnVwbG9hZEltYWdlKHRoaXMudXBsb2FkQWN0aW9uLmJpbmQodGhpcykpXG4gICAgfVxuICB9XG59KTtcblxuZmFicmljLlNsaWRlQ2FudmFzLmFkZFBsdWdpbiA9IGZhYnJpYy5QbHVnaW5zTWl4aW4uYWRkUGx1Z2luLmJpbmQoZmFicmljLlNsaWRlQ2FudmFzKTtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vY29yZS9zbGlkZS5qc1xuLy8gbW9kdWxlIGlkID0gNDRcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5TdGF0aWNDYW52YXMucHJvdG90eXBlLHtcbiAgLyoqXG4gICAqIHJlcXVpcmVkIHRvIHNob3cgdmlkZW9cbiAgICovXG4gIGFkZFZpZGVvc1N1cHBvcnQ6IGZ1bmN0aW9uICgpIHtcbiAgICBmYWJyaWMudXRpbC5yZXF1ZXN0QW5pbUZyYW1lKGZ1bmN0aW9uIHJlbmRlcigpIHtcbiAgICAgIHRoaXMucmVuZGVyQWxsKCk7XG4gICAgICBmYWJyaWMudXRpbC5yZXF1ZXN0QW5pbUZyYW1lKHJlbmRlcik7XG4gICAgfS5iaW5kKHRoaXMpKTtcbiAgfSxcbiAgZmluZDogZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICBpZiAodHlwZW9mIG9wdGlvbnMgPT0gXCJzdHJpbmdcIil7XG4gICAgICBvcHRpb25zID0ge1xuICAgICAgICB0eXBlOiBvcHRpb25zXG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmYWJyaWMudXRpbC5vYmplY3Qud2hlcmUodGhpcy5fb2JqZWN0cyxvcHRpb25zKTtcbiAgfSxcblxuICBjb2xsZWN0aW9uOiBmdW5jdGlvbiAodHlwZSxvcHRpb25zKSB7XG4gICAgdmFyIGNsYXNzUHJvdG90eXBlO1xuICAgIHZhciBfYXBwbGljYXRpb25Qcm90b3R5cGU7XG4gICAgaWYodHlwZW9mIHR5cGUgPT0gXCJmdW5jdGlvblwiKXtcbiAgICAgIGNsYXNzUHJvdG90eXBlID0gIHR5cGUucHJvdG90eXBlO1xuICAgIH1lbHNlIGlmICh0eXBlb2YgdHlwZSA9PSBcInN0cmluZ1wiKXtcbiAgICAgIGNsYXNzUHJvdG90eXBlID0gZmFicmljW3R5cGVdLnByb3RvdHlwZVxuICAgIH1lbHNlIGlmKHR5cGUudHlwZSl7XG4gICAgICBjbGFzc1Byb3RvdHlwZSA9IGZhYnJpY1t0eXBlLnR5cGVdLnByb3RvdHlwZTtcbiAgICAgIG9wdGlvbnMgPSB0eXBlO1xuICAgIH1lbHNle1xuICAgICAgb3B0aW9ucyA9IHR5cGU7XG4gICAgfVxuICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt0eXBlOiBjbGFzc1Byb3RvdHlwZS50eXBlfTtcblxuICAgIGZ1bmN0aW9uIG1ha2VGdW5jdGlvbihmb28pe1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uKCl7XG4gICAgICAgIHZhciBvcHRpb25zID0gYXJndW1lbnRzO1xuICAgICAgICB0aGlzLmZvckVhY2goZnVuY3Rpb24ob2JqKXtcbiAgICAgICAgICBmb28uYXBwbHkob2JqLG9wdGlvbnMpXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgIH1cbiAgICB9XG5cbiAgICB2YXIgY29sbGVjdGlvblByb3RvO1xuICAgIHZhciBfYXJyYXkgPSB0aGlzLmZpbmQob3B0aW9ucyk7XG4gICAgX2FycmF5LmNhbnZhcyA9IHRoaXM7XG4gICAgX2FycmF5Lm9wdGlvbnMgPSBvcHRpb25zO1xuXG4gICAgaWYoY2xhc3NQcm90b3R5cGUpIHtcbiAgICAgIGlmKHRoaXMuYXBwbGljYXRpb24pe1xuICAgICAgICBfYXBwbGljYXRpb25Qcm90b3R5cGUgPSB0aGlzLmFwcGxpY2F0aW9uLmdldERlZmF1bHRQcm9wZXJ0aWVzKGNsYXNzUHJvdG90eXBlLHt9KTtcbiAgICAgIH1cbiAgICAgIGNvbGxlY3Rpb25Qcm90byA9IFtdO1xuICAgICAgZm9yKHZhciBpIGluIGNsYXNzUHJvdG90eXBlKXtcbiAgICAgICAgaWYgKHR5cGVvZiBjbGFzc1Byb3RvdHlwZVtpXSA9PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICBjb2xsZWN0aW9uUHJvdG9baV0gPSBjbGFzc1Byb3RvdHlwZVtpXTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgZm9yKHZhciBpIGluIF9hcHBsaWNhdGlvblByb3RvdHlwZSl7XG4gICAgICAgIGlmICh0eXBlb2YgX2FwcGxpY2F0aW9uUHJvdG90eXBlW2ldID09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICAgIGNvbGxlY3Rpb25Qcm90b1tpXSA9IF9hcHBsaWNhdGlvblByb3RvdHlwZVtpXTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1lbHNle1xuICAgICAgX2FycmF5LmZvckVhY2goZnVuY3Rpb24oX29iail7XG4gICAgICAgIGlmKCFjb2xsZWN0aW9uUHJvdG8pIHtcbiAgICAgICAgICBjb2xsZWN0aW9uUHJvdG8gPSBbXTtcbiAgICAgICAgICBmb3IodmFyIGkgaW4gX29iaikge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBfb2JqW2ldID09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICAgICAgICBjb2xsZWN0aW9uUHJvdG9baV0gPSBfb2JqW2ldO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgZm9yKHZhciBpIGluIGNvbGxlY3Rpb25Qcm90byl7XG4gICAgICAgICAgICBpZighX29ialtpXSB8fCB0eXBlb2YgX29ialtpXSAhPT0gXCJmdW5jdGlvblwiKXtcbiAgICAgICAgICAgICAgZGVsZXRlIGNvbGxlY3Rpb25Qcm90b1tpXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfVxuXG4gICAgZm9yKHZhciBpIGluIGNvbGxlY3Rpb25Qcm90byl7XG4gICAgICBjb2xsZWN0aW9uUHJvdG9baV0gPSBtYWtlRnVuY3Rpb24oIGNvbGxlY3Rpb25Qcm90b1tpXSApO1xuICAgIH1cbiAgICBjb2xsZWN0aW9uUHJvdG8uX19wcm90byA9IF9hcnJheS5fX3Byb3RvX187XG4gICAgX2FycmF5Ll9fcHJvdG9fXyA9IGNvbGxlY3Rpb25Qcm90bztcblxuXG4gICAgX2FycmF5LnNldENvbGxlY3Rpb24gPSBmdW5jdGlvbihfYXJyKXtcbiAgICAgIHRoaXMubGVuZ3RoID0gMDtcbiAgICAgIGZvcih2YXIgaSBpbiBfYXJyKXtcbiAgICAgICAgdGhpcy5wdXNoKF9hcnJbaV0pO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIF9hcnJheS51cGRhdGVDb2xsZWN0aW9uID0gZnVuY3Rpb24oKXtcbiAgICAgIHZhciBfYXJyID0gdGhpcy5jYW52YXMuZmluZCh0aGlzLm9wdGlvbnMpO1xuICAgICAgdGhpcy5zZXRDb2xsZWN0aW9uKF9hcnIpXG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG4gICAgX2FycmF5LmZpbHRlciA9IGZ1bmN0aW9uKCl7XG4gICAgICB2YXIgX2FyciA9IHRoaXMuX19wcm90b19fLmZpbHRlci5hcHBseSh0aGlzLGFyZ3VtZW50cyk7XG4gICAgICB0aGlzLnNldENvbGxlY3Rpb24oX2FycilcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG5cbiAgICByZXR1cm4gX2FycmF5O1xuICB9LFxuICBfdXBkYXRlX2JhY2tncm91bmRfaW1hZ2U6IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgcGhvdG8gPSB0aGlzLmJhY2tncm91bmRJbWFnZTtcbiAgICBpZiAoIXBob3RvIHx8IHBob3RvLmNvbnN0cnVjdG9yID09IE9iamVjdCB8fCBwaG90by5jb25zdHJ1Y3RvciA9PSBTdHJpbmcpIHJldHVybjtcblxuICAgIGlmICh0aGlzLmJhY2tncm91bmRQb3NpdGlvbiA9PSAncmVzaXplJykge1xuICAgICAgdGhpcy5vcmlnaW5hbFdpZHRoID0gcGhvdG8ud2lkdGg7XG4gICAgICB0aGlzLm9yaWdpbmFsSGVpZ2h0ID0gcGhvdG8uaGVpZ2h0O1xuXG4gICAgfWVsc2UgaWYgKHRoaXMuYmFja2dyb3VuZFBvc2l0aW9uICE9ICdtYW51YWwnKSB7XG5cbiAgICAgIHZhciBfdyAgPSAgdGhpcy5vcmlnaW5hbFdpZHRoIHx8IHRoaXMud2lkdGgsICBfaCA9IHRoaXMub3JpZ2luYWxIZWlnaHQgfHwgdGhpcy5oZWlnaHQ7XG5cblxuICAgICAgaWYocGhvdG8uX29yaWdpbmFsRWxlbWVudCl7XG4gICAgICAgIHZhciBzaXplID0gZmFicmljLnV0aWwuZ2V0UHJvcG9ydGlvbnMocGhvdG8uX29yaWdpbmFsRWxlbWVudCwge1xuICAgICAgICAgIHdpZHRoOiBfdyxcbiAgICAgICAgICBoZWlnaHQ6IF9oXG4gICAgICAgIH0sIHRoaXMuYmFja2dyb3VuZFBvc2l0aW9uKTtcbiAgICAgIH1lbHNle1xuICAgICAgICBzaXplID0ge1xuICAgICAgICAgIHdpZHRoOiBfdyxcbiAgICAgICAgICBoZWlnaHQ6IF9oXG4gICAgICAgIH1cbiAgICAgIH1cblxuXG4gICAgICB2YXIgX2wgO1xuICAgICAgaWYodGhpcy5iYWNrZ3JvdW5kSW1hZ2Uub3JpZ2luWCA9PSAnY2VudGVyJyl7XG4gICAgICAgIF9sID0gX3cgLyAyO1xuICAgICAgfWVsc2V7XG4gICAgICAgIF9sID0gKF93IC0gc2l6ZS53aWR0aCkgLyAyIDtcbiAgICAgIH1cbiAgICAgIHZhciBfdCA7XG4gICAgICBpZih0aGlzLmJhY2tncm91bmRJbWFnZS5vcmlnaW5ZID09ICdjZW50ZXInKXtcbiAgICAgICAgX3QgPSBfaCAvIDI7XG4gICAgICB9ZWxzZXtcbiAgICAgICAgX3QgPSAoX2ggLSBzaXplLmhlaWdodCkgLyAyIDtcbiAgICAgIH1cblxuXG4gICAgICB0aGlzLmJhY2tncm91bmRJbWFnZS5zZXQoe1xuICAgICAgICBsZWZ0OiBfbCArIHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bNF0sXG4gICAgICAgIHRvcDogIF90ICsgdGhpcy52aWV3cG9ydFRyYW5zZm9ybVs1XSxcbiAgICAgICAgd2lkdGg6IHNpemUud2lkdGgsXG4gICAgICAgIGhlaWdodDogc2l6ZS5oZWlnaHRcbiAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyB2YXIgX29yaWcgPSB0aGlzLmJhY2tncm91bmRJbWFnZS5nZXRPcmlnaW5hbFNpemUoKTtcbiAgICAgIC8vIHRoaXMuYmFja2dyb3VuZEltYWdlLnNldCh7XG4gICAgICAvLyAgIG9yaWdpblg6ICdsZWZ0JyxcbiAgICAgIC8vICAgb3JpZ2luWTogJ3RvcCcsXG4gICAgICAvLyAgIGxlZnQ6IDAsIC8vdGhpcy52aWV3cG9ydFRyYW5zZm9ybVs0XSxcbiAgICAgIC8vICAgdG9wOiAwLCAvL3RoaXMudmlld3BvcnRUcmFuc2Zvcm1bNV0sXG4gICAgICAvLyAgIHdpZHRoOiBfb3JpZy53aWR0aCxcbiAgICAgIC8vICAgaGVpZ2h0OiBfb3JpZy5oZWlnaHRcbiAgICAgIC8vIH0pO1xuICAgIH1cbiAgfSxcbiAgc2V0QmFja2dyb3VuZEltYWdlOiBmdW5jdGlvbiAoYmcsIGNhbGxiYWNrKSB7XG4gICAgdmFyIF9iZ2ltYWdlTG9hZGVkID0gZnVuY3Rpb24gKGVsKXtcblxuICAgICAgdGhpcy5iYWNrZ3JvdW5kSW1hZ2UgPSBlbDtcbiAgICAgIHRoaXMuYmFja2dyb3VuZEltYWdlLmNhbnZhcyA9IHRoaXM7XG4gICAgICB0aGlzLl91cGRhdGVfYmFja2dyb3VuZF9pbWFnZSgpO1xuICAgICAgaWYoIXRoaXMub3JpZ2luYWxXaWR0aCAmJiAhdGhpcy5vcmlnaW5hbEhlaWdodCl7XG4gICAgICAgIHRoaXMub3JpZ2luYWxXaWR0aCA9IGVsLndpZHRoO1xuICAgICAgICB0aGlzLm9yaWdpbmFsSGVpZ2h0ID0gZWwuaGVpZ2h0O1xuICAgICAgfVxuICAgICAgdGhpcy5maXJlKFwiYmFja2dyb3VuZC1pbWFnZTpsb2FkZWRcIix7dGFyZ2V0OiBlbH0pO1xuICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2soKTtcbiAgICB9XG5cblxuICAgIGlmICghYmcpIHtcbiAgICAgIHRoaXMuYmFja2dyb3VuZEltYWdlID0gbnVsbDtcbiAgICAgIHJldHVybiBjYWxsYmFjaygpO1xuICAgIH1cbiAgICBpZiAoYmcgaW5zdGFuY2VvZiBIVE1MSW1hZ2VFbGVtZW50IHx8IGJnIGluc3RhbmNlb2YgSW1hZ2Upe1xuXG4gICAgICB2YXIgZWwgPSBuZXcgZmFicmljLkltYWdlKGJnLHtcbiAgICAgICAgd2lkdGg6IGJnLm5hdHVyYWxXaWR0aCxcbiAgICAgICAgaGVpZ2h0OiBiZy5uYXR1cmFsSGVpZ2h0XG4gICAgICB9KTtcblxuICAgICAgX2JnaW1hZ2VMb2FkZWQuY2FsbCh0aGlzLGVsKTtcbiAgICB9XG4gICAgaWYgKGJnLmNvbnN0cnVjdG9yID09IFN0cmluZykge1xuICAgICAgYmcgPSB7XG4gICAgICAgIHNyYzogYmdcbiAgICAgIH1cbiAgICB9XG4gICAgdmFyIF9wcm90byA9IHRoaXMuYXBwbGljYXRpb24ucHJvdG90eXBlcztcbiAgICBpZihfcHJvdG8gJiYgX3Byb3RvLlNsaWRlQ2FudmFzICYmIF9wcm90by5TbGlkZUNhbnZhcy5iYWNrZ3JvdW5kSW1hZ2VQcm9wZXJ0aWVzKXtcbiAgICAgIGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoYmcsX3Byb3RvLlNsaWRlQ2FudmFzLmJhY2tncm91bmRJbWFnZVByb3BlcnRpZXMpO1xuICAgIH1cbiAgICBiZy5hcHBsaWNhdGlvbiA9IHRoaXMuYXBwbGljYXRpb247XG4gICAgYmcudHlwZSA9IGJnLnR5cGUgfHwgXCJpbWFnZVwiO1xuICAgIC8vIGJnLndpZHRoID0gYmcubmF0dXJhbFdpZHRoO1xuICAgIC8vIGJnLmhlaWdodCA9IGJnLm5hdHVyYWxIZWlnaHQ7XG4gICAgLy9cbiAgICBmYWJyaWMudXRpbC5jcmVhdGVPYmplY3QoYmcsX2JnaW1hZ2VMb2FkZWQuYmluZCh0aGlzKSk7XG4gIH0sXG4gICAgY3JlYXRlT2JqZWN0czogZnVuY3Rpb24ob2JqZWN0cyxjYWxsYmFjayl7XG5cbiAgICBpZih0aGlzLmFwcGxpY2F0aW9uKXtcbiAgICAgIGZvcih2YXIgaSBpbiBvYmplY3RzKXtcbiAgICAgICAgaWYob2JqZWN0c1tpXS5jb25zdHJ1Y3RvciA9PSBTdHJpbmcpe1xuICAgICAgICAgIG9iamVjdHNbaV0gPSB0aGlzLmFwcGxpY2F0aW9uLm9iamVjdHNbb2JqZWN0c1tpXV07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICB2YXIgX2NhbnZhcyA9IHRoaXM7XG5cbiAgICBmdW5jdGlvbiBzdWNjZXNzKF9vYmplY3RzKSB7XG4gICAgICBfY2FudmFzLmZpcmUoXCJwcm9ncmVzczpjb21wbGV0ZVwiLCB7b2JqZWN0czogb2JqZWN0c30pO1xuICAgICAgZm9yICh2YXIgaSBpbiBfb2JqZWN0cykge1xuICAgICAgICBfY2FudmFzLmFkZChfb2JqZWN0c1tpXS5vYmplY3QpO1xuICAgICAgfVxuICAgICAgX2NhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrLmNhbGwoX2NhbnZhcylcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBwcm9ncmVzcyhsLCB0KSB7XG4gICAgICBfY2FudmFzLmZpcmUoXCJwcm9ncmVzc1wiLCB7IGxvYWRlZCA6IGwsIHRvdGFsIDogdCB9KTtcbiAgICAgIGlmIChmYWJyaWMudXRpbC5sb2FkZXJEZWJ1Zykge1xuICAgICAgICBjb25zb2xlLmxvZyhcImxvYWRlZCBcIiArIGwgKyBcIiAvIFwiICsgdCk7XG4gICAgICB9XG4gICAgfVxuXG5cbiAgICB2YXIgX29iamVjdHMgPSBbXTtcbiAgICBpZiAoIW9iamVjdHMgfHwgIW9iamVjdHMubGVuZ3RoKSB7XG4gICAgICB0aGlzLmZpcmUoXCJwcm9ncmVzczpjb21wbGV0ZVwiLCAwKTtcbiAgICAgIHN1Y2Nlc3MoX29iamVjdHMpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHZhciBxdWV1ZUxvYWRDYWxsYmFjayA9IGZhYnJpYy51dGlsLnF1ZXVlTG9hZChvYmplY3RzLmxlbmd0aCwgZnVuY3Rpb24oKXtcbiAgICAgIHN1Y2Nlc3MoX29iamVjdHMpXG4gICAgfSwgcHJvZ3Jlc3MpO1xuXG4gICAgcXVldWVMb2FkQ2FsbGJhY2suZGF0YSA9ICh0aGlzLnRpdGxlIHx8IFwiXCIpICsgXCJvYmplY3RzXCI7XG5cbiAgICBmb3IgKHZhciBpIGluIG9iamVjdHMpIHtcbiAgICAgIChmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICB2YXIgX29iamVjdF9zbG90ID0ge29iamVjdDogbnVsbCwgb3B0aW9uczogb3B0aW9uc307XG4gICAgICAgIF9vYmplY3RzLnB1c2goX29iamVjdF9zbG90KTtcblxuICAgICAgICBvcHRpb25zLmFwcGxpY2F0aW9uID0gX2NhbnZhcy5hcHBsaWNhdGlvbjtcbiAgICAgICAgZmFicmljLnV0aWwuY3JlYXRlT2JqZWN0KG9wdGlvbnMsIGZ1bmN0aW9uIChlbCkge1xuICAgICAgICAgIF9vYmplY3Rfc2xvdC5vYmplY3QgPSBlbDtcbiAgICAgICAgICBxdWV1ZUxvYWRDYWxsYmFjaygpO1xuICAgICAgICB9KTtcbiAgICAgIH0pLmNhbGwodGhpcywgb2JqZWN0c1tpXSk7XG4gICAgfVxuICB9LFxuICBhcHBseU9wdGlvbnM6IGZ1bmN0aW9uKGZpbHRlcixvcHRpb25zKXtcbiAgICB0aGlzLl9vYmplY3RzLmZvckVhY2goZnVuY3Rpb24oX29iail7XG4gICAgICBmb3IodmFyIHByb3AgaW4gZmlsdGVyKXtcbiAgICAgICAgaWYoX29ialtwcm9wXSAhPT0gIGZpbHRlcltwcm9wXSlyZXR1cm47XG4gICAgICB9XG4gICAgICBfb2JqLnNldE9wdGlvbnMob3B0aW9ucyk7XG4gICAgfSlcbiAgfSxcbiAgY3JlYXRlT2JqZWN0OiBmdW5jdGlvbiAodHlwZSwgb3B0aW9ucyxjYWxsYmFjaykge1xuICAgIGlmKHR5cGVvZiB0eXBlICE9PSBcInN0cmluZ1wiKXtcbiAgICAgIGNhbGxiYWNrID0gb3B0aW9ucztcbiAgICAgIG9wdGlvbnMgPSBmYWJyaWMudXRpbC5vYmplY3QuY2xvbmUodHlwZSk7XG4gICAgICB0eXBlID0gbnVsbDtcbiAgICB9ZWxzZXtcbiAgICAgIG9wdGlvbnMgPSBmYWJyaWMudXRpbC5vYmplY3QuY2xvbmUob3B0aW9ucyk7XG4gICAgICBvcHRpb25zLnR5cGUgPSB0eXBlO1xuICAgIH1cblxuICAgIHZhciBfc2VsZiA9IHRoaXM7XG4gICAgb3B0aW9ucy5hcHBsaWNhdGlvbiA9IHRoaXMuYXBwbGljYXRpb247XG4gICAgdmFyIF9hY3RpdmUgPSBvcHRpb25zLmFjdGl2ZTtcbiAgICB2YXIgX3Bvc2l0aW9uID0gb3B0aW9ucy5wb3NpdGlvbjtcbiAgICBkZWxldGUgb3B0aW9ucy5hY3RpdmU7XG4gICAgZGVsZXRlIG9wdGlvbnMucG9zaXRpb247XG5cblxuICAgIGZ1bmN0aW9uIF9hZGQoZWwpIHtcbiAgICAgIGlmKGVsLmNhbnZhcylyZXR1cm47XG4gICAgICBpZihfcG9zaXRpb24gPT0gXCJjZW50ZXJcIikge1xuICAgICAgICBfc2VsZi5jZW50ZXIoZWwpO1xuICAgICAgfVxuICAgICAgX3NlbGYuYWRkKGVsKTtcblxuICAgICAgaWYoX2FjdGl2ZSl7XG4gICAgICAgIF9zZWxmLnNldEFjdGl2ZU9iamVjdChlbCk7XG4gICAgICB9XG4gICAgICBjYWxsYmFjayAmJiBjYWxsYmFjayhlbCk7XG4gICAgfVxuXG4gICAgdmFyIGVsID0gZmFicmljLnV0aWwuY3JlYXRlT2JqZWN0KG9wdGlvbnMsX2FkZCApO1xuICAgIGVsICYmIF9hZGQoZWwpO1xuICAgIHJldHVybiBlbDtcbiAgfSxcbiAgb25Mb2FkOiBmdW5jdGlvbiAoY2FsbGJhY2spIHtcbiAgICB0aGlzLnByb2Nlc3NpbmcgPWZhbHNlO1xuICAgIHRoaXMubG9hZGVkID0gdHJ1ZTtcbiAgICB0aGlzLmZpcmUoXCJsb2FkaW5nOmVuZFwiLHt0eXBlOiBcInNsaWRlXCIsIHRhcmdldDogdGhpc30pO1xuICAgIHRoaXMucmVuZGVyQWxsKCk7XG4gICAgY2FsbGJhY2sgJiYgY2FsbGJhY2suY2FsbCh0aGlzKTtcbiAgfSxcbiAgbG9hZDogZnVuY3Rpb24gKG9wdGlvbnMsY2FsbGJhY2spIHtcbiAgICB0aGlzLm9yaWdpbmFsV2lkdGggPSAwO1xuICAgIHRoaXMub3JpZ2luYWxIZWlnaHQgPSAwO1xuICAgIGlmICghb3B0aW9ucylyZXR1cm47XG5cbiAgICBpZighdGhpcy52aXJ0dWFsKXtcbiAgICAgIHRoaXMuY2xlYXIoKTtcbiAgICB9XG5cbiAgICBpZihvcHRpb25zLndpZHRoKXtcbiAgICAgIG9wdGlvbnMub3JpZ2luYWxXaWR0aCA9IG9wdGlvbnMud2lkdGg7XG4gICAgICBvcHRpb25zLm9yaWdpbmFsSGVpZ2h0ID0gb3B0aW9ucy5oZWlnaHQ7XG4gICAgfVxuXG4gICAgdGhpcy5wcm9jZXNzaW5nID0gdHJ1ZTtcbiAgICB0aGlzLmZpcmUoXCJsb2FkaW5nOmJlZ2luXCIse3R5cGU6IFwic2xpZGVcIiwgdGFyZ2V0OiB0aGlzfSk7XG5cbiAgICB0aGlzLnNldChvcHRpb25zLHRoaXMub25Mb2FkLmJpbmQodGhpcyxjYWxsYmFjaykpO1xuXG5cbiAgICB0aGlzLnBsdWdpbnMucHJlbG9hZGVycy5mb3JFYWNoKGZ1bmN0aW9uKHByZWxvYWRlcil7XG4gICAgICBwcmVsb2FkZXIuY2FsbCh0aGlzLCBvcHRpb25zKTtcbiAgICAgIHRoaXMub25SZXNpemUoKTtcbiAgICB9LmJpbmQodGhpcykpO1xuXG4gIH0sXG4gIHNldE9iamVjdHM6IGZ1bmN0aW9uKG9iamVjdHMsY2FsbGJhY2spe1xuXG4gICAgdGhpcy5jcmVhdGVPYmplY3RzKG9iamVjdHMsZnVuY3Rpb24oKXtcbiAgICAgIGZvcih2YXIgaSBpbiB0aGlzLl9vYmplY3RzKXtcbiAgICAgICAgdGhpcy5fb2JqZWN0c1tpXS5zZXRDb29yZHMoKTtcbiAgICAgIH1cbiAgICAgIGNhbGxiYWNrKCk7XG4gICAgfSk7XG4gIH0sXG4gIG9wdGlvbnNPcmRlcjogW1wib3JpZ2luYWxXaWR0aFwiLFwib3JpZ2luYWxIZWlnaHRcIixcIndpZHRoXCIsXCJoZWlnaHRcIl0sXG4gIG9uUmVzaXplOiBmdW5jdGlvbigpe1xuICAgIHZhciBfc2NhbGUgPSBNYXRoLm1pbigxLDgwMCAvdGhpcy53aWR0aCApO1xuICAgIC8vIHRoaXMuc2V0Wm9vbShfc2NhbGUpO1xuICAgIHRoaXMuc2V0RGltZW5zaW9ucyh7d2lkdGg6IHRoaXMud2lkdGgsaGVpZ2h0OiB0aGlzLmhlaWdodH0pO1xuICB9LFxuICBjZW50ZXI6IGZ1bmN0aW9uIChlbCkge1xuICAgIHZhciBfcmVjdCwgbWF4U2l6ZSwgb2Zmc2V0cztcblxuICAgIGlmKGVsLm1vdmVtZW50TGltaXRzICYmIGVsLm1vdmVtZW50TGltaXRzLmNvbnN0cnVjdG9yICE9PSBGdW5jdGlvbil7XG4gICAgICB2YXIgbGltID0gZWwubW92ZW1lbnRMaW1pdHM7XG4gICAgICBfcmVjdCA9IHtcbiAgICAgICAgbGVmdDogICBsaW0ubGVmdCAqIGxpbS5zY2FsZVgsXG4gICAgICAgIHdpZHRoOiAgbGltLndpZHRoICogbGltLnNjYWxlWCAsXG4gICAgICAgIHRvcDogICAgbGltLnRvcCAqIGxpbS5zY2FsZVksXG4gICAgICAgIGhlaWdodDogbGltLmhlaWdodCAqIGxpbS5zY2FsZVlcbiAgICAgIH07XG4gICAgICBtYXhTaXplID0gX3JlY3Q7XG4gICAgICBvZmZzZXRzID0gbGltO1xuICAgIH1lbHNle1xuICAgICAgdmFyIF96b29tID0gdGhpcy5nZXRab29tKCk7XG4gICAgICB2YXIgX3cgPSB0aGlzLm9yaWdpbmFsV2lkdGggfHwgdGhpcy53aWR0aCAvIF96b29tO1xuICAgICAgdmFyIF9oID0gdGhpcy5vcmlnaW5hbEhlaWdodCB8fCB0aGlzLmhlaWdodCAvIF96b29tO1xuICAgICAgX3JlY3QgPSB7XG4gICAgICAgIHdpZHRoOiB0aGlzLm9mZnNldHMgPyAoX3cgLSB0aGlzLm9mZnNldHMubGVmdCAtIHRoaXMub2Zmc2V0cy5yaWdodCkgOiBfdyxcbiAgICAgICAgaGVpZ2h0OiB0aGlzLm9mZnNldHMgPyhfaCAtIHRoaXMub2Zmc2V0cy50b3AgLSB0aGlzLm9mZnNldHMuYm90dG9tKSA6IF9oXG4gICAgICB9O1xuICAgICAgb2Zmc2V0cyA9IHtcbiAgICAgICAgbGVmdDogdGhpcy5vZmZzZXRzICYmIHRoaXMub2Zmc2V0cy50b3AgfHwwICxcbiAgICAgICAgdG9wOiAgdGhpcy5vZmZzZXRzICYmICB0aGlzLm9mZnNldHMubGVmdCB8fDBcbiAgICAgIH1cbiAgICB9XG4gICAgbWF4U2l6ZSA9IHtcbiAgICAgIHdpZHRoOiBfcmVjdC53aWR0aCAqIHRoaXMuZml0SW5kZXgsXG4gICAgICBoZWlnaHQ6IF9yZWN0LmhlaWdodCAqIHRoaXMuZml0SW5kZXhcbiAgICB9O1xuICAgIHZhciBzaXplID0gZmFicmljLnV0aWwuZ2V0UHJvcG9ydGlvbnMoZWwsIG1heFNpemUsICdmaXQnKTtcblxuICAgIGVsLnNldE9wdGlvbnMoe1xuICAgICAgc2NhbGVYOiBzaXplLnNjYWxlLFxuICAgICAgc2NhbGVZOiBzaXplLnNjYWxlLFxuICAgICAgdG9wOiBvZmZzZXRzLnRvcCAgKyBfcmVjdC5oZWlnaHQgLyAyIC0gc2l6ZS5oZWlnaHQgLyAyLFxuICAgICAgbGVmdDpvZmZzZXRzLmxlZnQgKyBfcmVjdC53aWR0aCAvIDIgIC0gc2l6ZS53aWR0aCAvIDJcbiAgICB9KTtcbiAgICBlbC5zZXRDb29yZHMoKTtcbiAgfSxcbiAgZml0SW5kZXg6IDAuOCxcbiAgc2V0T3JpZ2luYWxTaXplOiBmdW5jdGlvbiAodywgaCkge1xuICAgIHRoaXMub3JpZ2luYWxXaWR0aCA9IGggPyB3IDogKHcubmF0dXJhbFdpZHRoIHx8IHcud2lkdGgpO1xuICAgIHRoaXMub3JpZ2luYWxIZWlnaHQgPSBoID8gaCA6ICh3Lm5hdHVyYWxIZWlnaHQgfHwgdy5oZWlnaHQpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG59KTtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vY29yZS9zdGF0aWNDYW52YXMuanNcbi8vIG1vZHVsZSBpZCA9IDQ1XG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIlxuZmFicmljLmRlYnVnID0gREVWRUxPUE1FTlQ7XG5cbmZhYnJpYy51dGlsLmRhdGEgPSByZXF1aXJlKCcuL3V0aWwvZGF0YS5qcycpO1xuZmFicmljLnV0aWwucGF0aCA9IHJlcXVpcmUoJy4vdXRpbC9wYXRoLmpzJyk7XG5mYWJyaWMudXRpbC5jb21waWxlID0gcmVxdWlyZSgnLi91dGlsL2NvbXBpbGUuanMnKTtcbmZhYnJpYy51dGlsLmxvYWRlciA9IHJlcXVpcmUoJy4vdXRpbC9sb2FkZXIuanMnKTtcbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLnV0aWwub2JqZWN0LHJlcXVpcmUoJy4vdXRpbC9vYmplY3QuanMnKSk7XG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy51dGlsLHJlcXVpcmUoJy4vdXRpbC91dGlsLmpzJykpO1xuXG5yZXF1aXJlKCcuL21vZHVsZXMnKTtcblxuXG5pZighZmFicmljLmlzTGlrZWx5Tm9kZSl7XG4gIC8qKlxuICAgKiBpbmxpbmUgc2NyaXB0IGltYWdlc1xuICAgKiBAdHlwZSB7e2Vycm9yOiBzdHJpbmd9fVxuICAgKi9cbiAgZmFicmljLm1lZGlhID0ge1xuICAgIC8qKlxuICAgICAqIHJlcGxhY2UgaW1hZ2VzIGxvYWRlZCB3aXRoIGVycm9yc1xuICAgICAqL1xuICAgIGVycm9yOiAnZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCwnICsgcmVxdWlyZSgnYmFzZTY0LWxvYWRlciEuL21lZGlhL2Vycm9yLWJ1dHRvbi5zdmcnKVxuICB9O1xufVxuXG5tb2R1bGUuZXhwb3J0cyAgPSBmYWJyaWM7XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL2ZpZXJhLmpzXG4vLyBtb2R1bGUgaWQgPSA0NlxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCIndXNlIHN0cmljdCc7XG5cblxuZmFicmljLlJlbW92ZVdoaXRlRFAgPSBmYWJyaWMuSW1hZ2UuZmlsdGVycy5SZW1vdmVXaGl0ZURQID0gIGZhYnJpYy51dGlsLmNyZWF0ZUNsYXNzKGZhYnJpYy5JbWFnZS5maWx0ZXJzLkJhc2VGaWx0ZXIse1xuICAgIHR5cGU6ICdSZW1vdmVXaGl0ZURQJyxcbiAgICBpbml0aWFsaXplOiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICAgIGlmKG9wdGlvbnMpZGVsZXRlIG9wdGlvbnMudHlwZTtcbiAgICAgICAgdGhpcy5vcHRpb25zID0gZmFicmljLnV0aWwub2JqZWN0LmRlZmF1bHRzKG9wdGlvbnMgfHwge30se1xuICAgICAgICAgICAgICAgIGZyb21Db3JuZXJzIDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBibHVyUmFkaXVzOiAyLFxuICAgICAgICAgICAgICAgIGNvbG9yVGhyZXNob2xkOiAzMlxuICAgICAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucGF0aGZpbmRlciA9IG5ldyBmYWJyaWMuUGF0aGZpbmRlcih0aGlzLm9wdGlvbnMpO1xuICAgIH0sXG4gICAgYXBwbHlUbzogZnVuY3Rpb24oY2FudmFzRWwpIHtcblxuICAgICAgICB2YXIgcGF0aGZpbmRlciA9IHRoaXMucGF0aGZpbmRlcjtcblxuICAgICAgICBwYXRoZmluZGVyLmNvbG9yVGhyZXNob2xkID0gdGhpcy5vcHRpb25zLmNvbG9yVGhyZXNob2xkO1xuICAgICAgICBwYXRoZmluZGVyLnNldFBpY3R1cmUoY2FudmFzRWwpO1xuICAgICAgICBwYXRoZmluZGVyLnNlbGVjdEJhY2tncm91bmQodGhpcy5vcHRpb25zLmZyb21Db3JuZXJzKTtcbiAgICAgICAgaWYocGF0aGZpbmRlci5tYXNrLmNvdW50ICkge1xuICAgICAgICAgIHBhdGhmaW5kZXIuX2ZpbGwoWzAsIDAsIDAsIDBdKTtcbiAgICAgICAgICBwYXRoZmluZGVyLm1hc2sgPSBmYWJyaWMuTWFnaWNXYW5kLmludmVydE1hc2socGF0aGZpbmRlci5tYXNrKTtcbiAgICAgICAgICAvL3RvZG8gaW52ZXJ0aW5nIG1hc2tcblxuICAgICAgICAgIGlmKHBhdGhmaW5kZXIubWFzay5jb3VudCl7XG4gICAgICAgICAgICB2YXIgX3dpZHRoID0gcGF0aGZpbmRlci5tYXNrLmJvdW5kcy5tYXhYIC0gcGF0aGZpbmRlci5tYXNrLmJvdW5kcy5taW5YICsgMTtcbiAgICAgICAgICAgIHZhciBfaGVpZ2h0ID0gcGF0aGZpbmRlci5tYXNrLmJvdW5kcy5tYXhZIC0gcGF0aGZpbmRlci5tYXNrLmJvdW5kcy5taW5ZICsgMTtcbiAgICAgICAgICAgIHZhciBjdHggPSBjYW52YXNFbC5nZXRDb250ZXh0KCcyZCcpO1xuICAgICAgICAgICAgdmFyIGltYWdlRGF0YSA9IHBhdGhmaW5kZXIuZWRpdGVkSW1hZ2VDYW52YXMuZ2V0Q29udGV4dCgnMmQnKS5nZXRJbWFnZURhdGEocGF0aGZpbmRlci5tYXNrLmJvdW5kcy5taW5YLCBwYXRoZmluZGVyLm1hc2suYm91bmRzLm1pblksIF93aWR0aCwgX2hlaWdodCk7XG4gICAgICAgICAgICBjYW52YXNFbC53aWR0aCAgPSBfd2lkdGg7XG4gICAgICAgICAgICBjYW52YXNFbC5oZWlnaHQgPSBfaGVpZ2h0O1xuICAgICAgICAgICAgY3R4LnB1dEltYWdlRGF0YShpbWFnZURhdGEsIDAsIDApO1xuICAgICAgICAgICAgdGhpcy5ib3VuZHMgPSBwYXRoZmluZGVyLm1hc2suYm91bmRzO1xuICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgdmFyIGN0eCA9IGNhbnZhc0VsLmdldENvbnRleHQoJzJkJyk7XG4gICAgICAgICAgICBjYW52YXNFbC53aWR0aCAgPSAxO1xuICAgICAgICAgICAgY2FudmFzRWwuaGVpZ2h0ID0gMTtcbiAgICAgICAgICAgIGN0eC5jbGVhclJlY3QoMCwwLDEsMSk7XG4gICAgICAgICAgICB0aGlzLmJvdW5kcyA9IHtcbiAgICAgICAgICAgICAgbWF4WDogMCxcbiAgICAgICAgICAgICAgbWF4WTogMCxcbiAgICAgICAgICAgICAgbWluWDogMCxcbiAgICAgICAgICAgICAgbWluWTogMFxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG5cblxuICAgICAgICAgICAgLy9jbGlwIHRoZSBpbWFnZVxuICAgICAgICBwYXRoZmluZGVyLmNsZWFyTWVtb3J5KCk7XG5cbiAgICB9LFxuICAgIHRvT2JqZWN0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQodGhpcy5jYWxsU3VwZXIoJ3RvT2JqZWN0JyksIHRoaXMub3B0aW9ucyk7XG4gICAgfVxufSk7XG5cbmZhYnJpYy5JbWFnZS5maWx0ZXJzLlJlbW92ZVdoaXRlRFAuZnJvbU9iamVjdCA9IGZ1bmN0aW9uKG9iamVjdCkge1xuICAgIHJldHVybiBuZXcgZmFicmljLkltYWdlLmZpbHRlcnMuUmVtb3ZlV2hpdGVEUChvYmplY3QpO1xufTtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vZmlsdGVycy9SZW1vdmVXaGl0ZURQLmpzXG4vLyBtb2R1bGUgaWQgPSA0N1xuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCIndXNlIHN0cmljdCc7XG5cblxuZmFicmljLlJlc2l6ZURQID1mYWJyaWMuSW1hZ2UuZmlsdGVycy5SZXNpemVEUCA9IGZhYnJpYy51dGlsLmNyZWF0ZUNsYXNzKGZhYnJpYy5JbWFnZS5maWx0ZXJzLlJlc2l6ZSwgLyoqIEBsZW5kcyBmYWJyaWMuSW1hZ2UuZmlsdGVycy5SZXNpemUucHJvdG90eXBlICovIHtcbiAgYXBwbHlUbzogZnVuY3Rpb24gKGNhbnZhc0VsLCBkVywgZEgpIHtcblxuXG4gICAgdmFyIG9XID0gY2FudmFzRWwud2lkdGgsIG9IID0gY2FudmFzRWwuaGVpZ2h0LCAgIGltYWdlRGF0YTtcblxuICAgIHZhciBzY2FsZVggPSBkVyAvIG9XO1xuICAgIHZhciBzY2FsZVkgPSBkSCAvIG9IO1xuICAgIHRoaXMucmNwU2NhbGVYID0gMSAvICBzY2FsZVg7XG4gICAgdGhpcy5yY3BTY2FsZVkgPSAxIC8gc2NhbGVZO1xuICAgIGlmICh0aGlzLnJlc2l6ZVR5cGUgPT09ICdzbGljZUhhY2snKSB7XG4gICAgICBpbWFnZURhdGEgPSB0aGlzLnNsaWNlQnlUd28oY2FudmFzRWwsIG9XLCBvSCwgZFcsIGRIKTtcbiAgICB9XG4gICAgaWYgKHRoaXMucmVzaXplVHlwZSA9PT0gJ2hlcm1pdGUnKSB7XG4gICAgICBpbWFnZURhdGEgPSB0aGlzLmhlcm1pdGVGYXN0UmVzaXplKGNhbnZhc0VsLCBvVywgb0gsIGRXLCBkSCk7XG4gICAgfVxuICAgIGlmICh0aGlzLnJlc2l6ZVR5cGUgPT09ICdiaWxpbmVhcicpIHtcbiAgICAgIGltYWdlRGF0YSA9IHRoaXMuYmlsaW5lYXJGaWx0ZXJpbmcoY2FudmFzRWwsIG9XLCBvSCwgZFcsIGRIKTtcbiAgICB9XG4gICAgaWYgKHRoaXMucmVzaXplVHlwZSA9PT0gJ2xhbmN6b3MnKSB7XG4gICAgICBpbWFnZURhdGEgPSB0aGlzLmxhbmN6b3NSZXNpemUoY2FudmFzRWwsIG9XLCBvSCwgZFcsIGRIKTtcbiAgICB9XG4gICAgY2FudmFzRWwud2lkdGggPSBkVztcbiAgICBjYW52YXNFbC5oZWlnaHQgPSBkSDtcbiAgICBjYW52YXNFbC5nZXRDb250ZXh0KCcyZCcpLnB1dEltYWdlRGF0YShpbWFnZURhdGEsIDAsIDApO1xuICB9XG59KTtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vZmlsdGVycy9SZXNpemVEUC5qc1xuLy8gbW9kdWxlIGlkID0gNDhcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiJC5mbi5hYnNvbHV0ZVBvc2l0aW9uID0gZnVuY3Rpb24oKSB7XG5cbiAgdmFyIG9mZiA9IHRoaXMub2Zmc2V0KCksICBwb3MgPSB0aGlzLnBvc2l0aW9uKCk7XG4gIHZhciBzY3JvbGwgPSB7dG9wOiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wIHx8IGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wIHx8IHdpbmRvdy5zY3JvbGxZIHx8IDAsIGxlZnQ6ZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbExlZnQgfHwgZG9jdW1lbnQuYm9keS5zY3JvbGxMZWZ0IHx8IHdpbmRvdy5zY3JvbGxYIHx8IDAsIGJvdHRvbSA6IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxIZWlnaHQgLSAkKHdpbmRvdykuaGVpZ2h0KCksIHJpZ2h0OiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsV2lkdGggLSAkKHdpbmRvdykud2lkdGgoKX1cbiAgdmFyIG1hcmdpbiA9IHt0b3A6IGdldFZhbHVlKHRoaXMuY3NzKFwibWFyZ2luLXRvcFwiKSksIGxlZnQ6IGdldFZhbHVlKHRoaXMuY3NzKFwibWFyZ2luLWxlZnRcIikpICxib3R0b206IGdldFZhbHVlKHRoaXMuY3NzKFwibWFyZ2luLWJvdHRvbVwiKSksIHJpZ2h0OiBnZXRWYWx1ZSh0aGlzLmNzcyhcIm1hcmdpbi1yaWdodFwiKSl9O1xuXG4gIGZ1bmN0aW9uIGdldFZhbHVlKHZhbCl7aWYodmFsID09IFwiYXV0b1wiKSByZXR1cm4gMCA7dmFyIG51bSA9ICBwYXJzZUludCh2YWwpO3JldHVybiBpc05hTihudW0pID8gMCA6IG51bTt9XG5cbiAgdmFyIGJvcmRlcl9vZmZzZXQgPSBnZXRWYWx1ZSh0aGlzLmNzcyhcImJvcmRlci13aWR0aFwiKSkgKiAyO1xuXG4gIHJldHVybiB7IHRvcDogICAgIG9mZi50b3AsIGxlZnQ6ICAgIG9mZi5sZWZ0LCBib3R0b206ICAkKHdpbmRvdykuaGVpZ2h0KCkgLSBvZmYudG9wICAtIG1hcmdpbi5ib3R0b20gKyBzY3JvbGwuYm90dG9tIC0gdGhpcy5oZWlnaHQoKSAtIGJvcmRlcl9vZmZzZXQsIHJpZ2h0OiAgICQod2luZG93KS53aWR0aCgpIC0gb2ZmLmxlZnQgIC0gbWFyZ2luLnJpZ2h0ICsgc2Nyb2xsLnJpZ2h0IC0gdGhpcy53aWR0aCgpfTtcbn07XG5cbiQuZm4uZHBSZXNpemFibGUgPSAkLmZuLnJlc2l6YWJsZSA9IGZ1bmN0aW9uKHNjb3BlKSB7XG4gIHZhciBwID0gdGhpc1swXTtcblxuXG4gIHAuY2xhc3NOYW1lID0gcC5jbGFzc05hbWUgKyAnIHJlc2l6YWJsZSc7XG4gIHZhciByZXNpemVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gIHJlc2l6ZXIuY2xhc3NOYW1lID0gJ3Jlc2l6YWJsZS1zZSc7XG4gIHAuYXBwZW5kQ2hpbGQocmVzaXplcik7XG4gIHJlc2l6ZXIuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgaW5pdERyYWcsIGZhbHNlKTtcblxuXG4gIHZhciBzdGFydFgsIHN0YXJ0WSwgc3RhcnRXaWR0aCwgc3RhcnRIZWlnaHQ7XG5cbiAgZnVuY3Rpb24gaW5pdERyYWcoZSkge1xuICAgIHN0YXJ0WCA9IGUuY2xpZW50WDtcbiAgICBzdGFydFkgPSBlLmNsaWVudFk7XG4gICAgc3RhcnRXaWR0aCA9IHBhcnNlSW50KGRvY3VtZW50LmRlZmF1bHRWaWV3LmdldENvbXB1dGVkU3R5bGUocCkud2lkdGgsIDEwKTtcbiAgICBzdGFydEhlaWdodCA9IHBhcnNlSW50KGRvY3VtZW50LmRlZmF1bHRWaWV3LmdldENvbXB1dGVkU3R5bGUocCkuaGVpZ2h0LCAxMCk7XG4gICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIGRvRHJhZywgZmFsc2UpO1xuICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgc3RvcERyYWcsIGZhbHNlKTtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGRvRHJhZyhlKSB7XG4gICAgcC5zdHlsZS53aWR0aCA9IChzdGFydFdpZHRoICsgZS5jbGllbnRYIC0gc3RhcnRYKSArICdweCc7XG4gICAgcC5zdHlsZS5oZWlnaHQgPSAoc3RhcnRIZWlnaHQgKyBlLmNsaWVudFkgLSBzdGFydFkpICsgJ3B4JztcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHN0b3BEcmFnKGUpIHtcbiAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgZG9EcmFnLCBmYWxzZSk7XG4gICAgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCBzdG9wRHJhZywgZmFsc2UpO1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICB9XG59O1xuXG4kLmZuLmRwRHJhZ2dhYmxlID0gJC5mbi5kcmFnZ2FibGUgPSBmdW5jdGlvbihzY29wZSkge1xuICB2YXIgZWxlbWVudCA9IHRoaXM7XG4gIHNjb3BlID0gc2NvcGUgfHwge1xuICAgICAgYnV0dG9uOiAwLFxuICAgICAgb25DaGFuZ2U6ICAgbnVsbCxcbiAgICAgIG5nTW9kZWw6ICAgIG51bGwsXG4gICAgICBvbk1vdmU6ICAgICBudWxsLFxuICAgICAgb25DYW5jZWw6ICAgbnVsbCxcbiAgICAgIG9uRHJvcDogICAgIG51bGwsXG4gICAgICBkcmFnZ2FibGU6ICBcInNlbGZcIiwvL1wiaGVscGVyXCIsXG4gICAgICBkcmFnZ2FibGVBcmVhOiBudWxsLFxuICAgICAgZHJvcHBhYmxlOiAgXCJbZHJvcHBhYmxlXVwiXG4gICAgfTtcblxuXG5cblxuICBzY29wZS5leGNsdWRlRWxlbWVudHMgPSBzY29wZS5leGNsdWRlRWxlbWVudHMgfHwgXCIubm8tZHJhZ1wiO1xuICBzY29wZS5pbmNsdWRlRWxlbWVudHMgPSBzY29wZS5pbmNsdWRlRWxlbWVudHMgfHwgXCIuZHJhZy1vblwiO1xuICBzY29wZS5kcmFnZ2FibGUgPSBzY29wZS5kcmFnZ2FibGUgfHwgXCJzZWxmXCI7XG4gIHNjb3BlLmRyb3BwYWJsZSA9IHNjb3BlLmRyb3BwYWJsZSB8fCBcIltkcm9wcGFibGVdXCI7XG5cbiAgLyoqXG4gICAqINC/0YDQuCDQvdCw0LbQsNGC0LjQuNC60LvQsNCy0LjRiNC4INC80YvRiNC4INC90LAg0L7QsdGK0LXQutGC0LUgLSDQv9C+0LTQs9C+0YLQvtCy0LvQuNCy0LDQtdC80YHRjyDQuiDQv9C10YDQtdGC0LDRgdC60LjQstCw0L3QuNGOLlxuICAgKi9cbiAgZnVuY3Rpb24gcHJlcGFyZUZvckRyYWcoZXZlbnQpe1xuXG4gICAgdmFyIF90YWdzID0gXCJJTlBVVHxTRUxFQ1R8VEVYVEFSRUF8QlVUVE9OXCI7XG4gICAgaWYoX3RhZ3MuaW5kZXhPZihldmVudC50YXJnZXQudGFnTmFtZSkhPSAtMSApe1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmKHNjb3BlLmJ1dHRvbiAmJiAoZXZlbnQuYnV0dG9uICE9IHNjb3BlLmJ1dHRvbikpe1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuXG4gICAgdmFyIF90b3VjaCA9IGV2ZW50LnR5cGUgPT0gXCJ0b3VjaHN0YXJ0XCI7XG4gICAgb3B0aW9ucyA9IHtcbiAgICAgIHRhcmdldEVsOiBldmVudC50YXJnZXQsXG4gICAgICBob3ZlckVsOiBudWxsLFxuICAgICAgX2xhc3RfZXZlbnQ6ICBfdG91Y2g/IGV2ZW50Lm9yaWdpbmFsRXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0gOiBldmVudCxcbiAgICAgIHRvdWNoOiBfdG91Y2hcbiAgICB9O1xuXG4gICAgaWYoc2NvcGUuZHJhZ2dhYmxlID09IFwiZmFsc2VcIil7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdmFyIF9wYXJlbnRzID0gJChvcHRpb25zLnRhcmdldEVsKS5wYXJlbnRzKCk7XG4gICAgX3BhcmVudHMuc3BsaWNlKDAsMCxvcHRpb25zLnRhcmdldEVsKTtcbiAgICBmb3IodmFyIGkgPSAwOyBpIDwgX3BhcmVudHMubGVuZ3RoOyBpKyspe1xuICAgICAgaWYoJChfcGFyZW50c1tpXSkuaXMoc2NvcGUuaW5jbHVkZUVsZW1lbnRzKSl7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgaWYoJChfcGFyZW50c1tpXSkuaXMoc2NvcGUuZXhjbHVkZUVsZW1lbnRzKSl7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGlmKF9wYXJlbnRzW2ldID09IGVsZW1lbnRbMF0pe1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG5cbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuXG4gICAgJChkb2N1bWVudCkub24oJ21vdXNlbW92ZSB0b3VjaG1vdmUnLCBoYW5kbGVEcmFnU3RhcnQpO1xuICAgICQoZG9jdW1lbnQpLm9uKCdtb3VzZXVwIHRvdWNoZW5kJywgaGFuZGxlRHJhZ0NhbmNlbCk7XG4gIH1cblxuICAvKipcbiAgICog0LjQt9C80LXQvdC10L3QuNC1INC00LDQvdC90YvRhSDQvtCx0YrQtdC60YLQsCBkcm9wcGFibGVcbiAgICogQHBhcmFtIGVcbiAgICovXG4gIGZ1bmN0aW9uIG9uQ2hhbmdlKGUpe1xuXG4gICAgb3B0aW9ucy52YWx1ZSA9IG9wdGlvbnMuaG92ZXJFbCAmJiBvcHRpb25zLmhvdmVyRWwuYXR0cihcInZhbHVlXCIpIHx8IGZhbHNlO1xuXG4gICAgc2NvcGUub25DaGFuZ2UgJiYgc2NvcGUub25DaGFuZ2Uoe1xuICAgICAgJGV2ZW50OiBlLFxuICAgICAgJGRhdGE6ICBzY29wZS5uZ01vZGVsLFxuICAgICAgJHZhbHVlOiAgb3B0aW9ucy52YWx1ZVxuICAgIH0pO1xuICB9XG4gIC8qKlxuICAgKiDQv9C+0LjRgdC6INGN0LvQtdC80L3QtdGC0LAgZHJvcHBhYmxlINC/0L7QtCDQutGD0YDRgdC+0YDQvtC8XG4gICAqIEBwYXJhbSBlXG4gICAqL1xuICBmdW5jdGlvbiBob3ZlckRyb3BwYWJsZShlKSB7XG4gICAgaWYoIW9wdGlvbnMuYXJlYUVsKXJldHVybjtcbiAgICB2YXIgX2Ryb3AgPSBzY29wZS5kcm9wcGFibGUgfHwgXCJbZHJvcHBhYmxlXVwiO1xuXG4gICAgdmFyIF9ob3ZlcmVkID0gZmFsc2U7XG4gICAgdmFyIGVscyA9IG9wdGlvbnMuYXJlYUVsLmZpbmQoX2Ryb3ApO1xuXG4gICAgaWYob3B0aW9ucy5hcmVhRWwuaXMoX2Ryb3ApKXtcbiAgICAgIGVscy5wdXNoKG9wdGlvbnMuYXJlYUVsWzBdKVxuICAgIH07XG5cbiAgICBlbHMuZWFjaCggZnVuY3Rpb24gKCkge1xuXG4gICAgICB2YXIgZWwgPSAkKHRoaXMpO1xuICAgICAgdmFyIHBvcyA9IGVsLmFic29sdXRlUG9zaXRpb24oKTtcblxuICAgICAgaWYgKGUucGFnZVggPiBwb3MubGVmdCAmJiBlLnBhZ2VYIDwgcG9zLmxlZnQgKyBlbC53aWR0aCgpICYmXG4gICAgICAgIGUucGFnZVkgPiBwb3MudG9wICAmJiBlLnBhZ2VZIDwgcG9zLnRvcCAgKyBlbC5oZWlnaHQoKSl7XG5cbiAgICAgICAgX2hvdmVyZWQgPSB0cnVlO1xuXG4gICAgICAgIGlmKCFvcHRpb25zLmhvdmVyRWwgfHwgb3B0aW9ucy5ob3ZlckVsWzBdICE9IGVsWzBdKXtcbiAgICAgICAgICBlbC5hZGRDbGFzcyhcImhvdmVyXCIpO1xuICAgICAgICAgIG9wdGlvbnMuaG92ZXJFbCA9IGVsO1xuICAgICAgICAgIG9uQ2hhbmdlKGUpO1xuICAgICAgICB9XG4gICAgICAgIG9wdGlvbnMuaG92ZXJYID0gZS5wYWdlWCAtIHBvcy5sZWZ0O1xuICAgICAgICBvcHRpb25zLmhvdmVyWSA9IGUucGFnZVkgLSBwb3MudG9wO1xuICAgICAgfWVsc2V7XG4gICAgICAgIGVsLnJlbW92ZUNsYXNzKFwiaG92ZXJcIik7XG4gICAgICB9XG5cbiAgICB9KTtcblxuICAgIGlmKCFfaG92ZXJlZCl7XG4gICAgICBvcHRpb25zLmhvdmVyRWwgPSBudWxsO1xuICAgICAgZGVsZXRlIG9wdGlvbnMuaG92ZXJYO1xuICAgICAgZGVsZXRlIG9wdGlvbnMuaG92ZXJZO1xuICAgICAgb25DaGFuZ2UoZSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqINC/0LXRgNC10LzQtdC10L3QuNC1INGN0LvQtdC80LXQvdGC0LBcbiAgICogQHBhcmFtIGV2ZW50XG4gICAqL1xuICBmdW5jdGlvbiBoYW5kbGVEcmFnTW92ZShldmVudCkge1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICB2YXIgZSA9ICBvcHRpb25zLnRvdWNoPyBldmVudC5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdIDogZXZlbnQ7XG5cbiAgICBpZihvcHRpb25zLmFyZWFFbCl7XG4gICAgICB2YXIgcG9zX2FyZWEgPSAgb3B0aW9ucy5hcmVhRWwuYWJzb2x1dGVQb3NpdGlvbigpO1xuXG4gICAgICB2YXIgX3RvcCA9IGUucGFnZVkgLSBvcHRpb25zLmhlbHBlclN0YXJ0T2Zmc2V0WSAtIHBvc19hcmVhLnRvcCArIG9wdGlvbnMubWFyZ2luVG9wICsgb3B0aW9ucy5hcmVhRWxbMF0uc2Nyb2xsVG9wO1xuICAgICAgdmFyIF9sZWZ0ID0gIGUucGFnZVggLSBvcHRpb25zLmhlbHBlclN0YXJ0T2Zmc2V0WCAtIHBvc19hcmVhLmxlZnQgKyBvcHRpb25zLm1hcmdpbkxlZnQgKyBvcHRpb25zLmFyZWFFbFswXS5zY3JvbGxMZWZ0O1xuXG4gICAgfWVsc2V7XG4gICAgICB2YXIgX3RvcCA9IGUucGFnZVkgLSBvcHRpb25zLmhlbHBlclN0YXJ0T2Zmc2V0WSArIG9wdGlvbnMubWFyZ2luVG9wIDtcbiAgICAgIHZhciBfbGVmdCA9IGUucGFnZVggLSBvcHRpb25zLmhlbHBlclN0YXJ0T2Zmc2V0WCArIG9wdGlvbnMubWFyZ2luTGVmdDtcbiAgICB9XG5cbiAgICBpZihlbGVtZW50Lmhhc0NsYXNzKFwiZHJhZ2dhYmxlLWxpbWl0ZWRcIikpe1xuICAgICAgdmFyIF93ID0gZWxlbWVudC5vdXRlcldpZHRoKCksIF9oID0gZWxlbWVudC5vdXRlckhlaWdodCgpO1xuICAgICAgaWYoX3RvcCA8IG9wdGlvbnMubWFyZ2luVG9wKXtcbiAgICAgICAgX3RvcCA9IG9wdGlvbnMubWFyZ2luVG9wO1xuICAgICAgfVxuICAgICAgaWYoX2xlZnQgPCBvcHRpb25zLm1hcmdpbkxlZnQpe1xuICAgICAgICBfbGVmdCA9IG9wdGlvbnMubWFyZ2luTGVmdDtcbiAgICAgIH1cbiAgICAgIGlmKF9sZWZ0ID4gb3B0aW9ucy5hcmVhRWwub3V0ZXJXaWR0aCgpIC0gX3cgKyBvcHRpb25zLm1hcmdpbkxlZnQpe1xuICAgICAgICBfbGVmdCA9IG9wdGlvbnMuYXJlYUVsLm91dGVyV2lkdGgoKSAtIF93ICsgb3B0aW9ucy5tYXJnaW5MZWZ0O1xuICAgICAgfVxuICAgICAgaWYoX3RvcCA+IG9wdGlvbnMuYXJlYUVsLm91dGVySGVpZ2h0KCkgLSBfaCArIG9wdGlvbnMubWFyZ2luVG9wKXtcbiAgICAgICAgX3RvcCA9IG9wdGlvbnMuYXJlYUVsLm91dGVySGVpZ2h0KCkgLSBfaCArIG9wdGlvbnMubWFyZ2luVG9wO1xuICAgICAgfVxuICAgIH1cblxuXG4gICAgaWYob3B0aW9ucy5faGVscGVyKXtcblxuICAgICAgb3B0aW9ucy5faGVscGVyLmNzcyh7XG4gICAgICAgIHRvcDogICBfdG9wLFxuICAgICAgICBsZWZ0OiAgIF9sZWZ0XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBob3ZlckRyb3BwYWJsZShlKTtcblxuICAgIHZhciAkb3B0aW9ucyA9IHtcbiAgICAgIG9yaWdpbmFsRXZlbnQ6IGUsXG4gICAgICBlbGVtZW50OiBlbGVtZW50LFxuICAgICAgZXZlbnQ6IGUsXG4gICAgICBkYXRhOiBzY29wZS5uZ01vZGVsLFxuICAgICAgaGVscGVyOiBvcHRpb25zLl9oZWxwZXIsXG4gICAgICB4OiBfbGVmdCxcbiAgICAgIHk6IF90b3AgLFxuICAgICAgZHJvcEVsOiAgb3B0aW9ucy5ob3ZlckVsLFxuICAgICAgZHJhZ0VsOiBvcHRpb25zLmRyYWdFbCxcbiAgICAgIGFyZWFFbDogb3B0aW9ucy5hcmVhRWwsXG4gICAgICBvZmZzZXRYOiBvcHRpb25zLmhlbHBlclN0YXJ0T2Zmc2V0WCxcbiAgICAgIG9mZnNldFk6IG9wdGlvbnMuaGVscGVyU3RhcnRPZmZzZXRZXG4gICAgfTtcblxuICAgIGUuZGF0YSA9IHNjb3BlLm5nTW9kZWw7XG5cbiAgICBpZihvcHRpb25zLmhvdmVyRWwpe1xuXG4gICAgICBzY29wZS5vbk1vdmUgJiYgc2NvcGUub25Nb3ZlKHtcbiAgICAgICAgJGV2ZW50OiAkb3B0aW9ucyxcbiAgICAgICAgJGRhdGE6IHNjb3BlLm5nTW9kZWxcbiAgICAgIH0pXG4gICAgfVxuICB9XG5cblxuICAvKipcbiAgICog0LfQsNCy0LXRgNGI0LDQtdC8INC/0LXRgNC10YLQsNGB0LrQuNCy0LDQvdC40LVcbiAgICogQHBhcmFtIGVcbiAgICovXG4gIGZ1bmN0aW9uIGhhbmRsZURyYWdFbmQoZSkge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIGVsZW1lbnQucmVtb3ZlQ2xhc3MoXCJkcmFnZ2FibGVcIik7XG4gICAgJChkb2N1bWVudCkub2ZmKCdtb3VzZW1vdmUgdG91Y2htb3ZlJywgaGFuZGxlRHJhZ01vdmUpO1xuICAgICQoZG9jdW1lbnQpLm9mZignbW91c2V1cCB0b3VjaGVuZCcsIGhhbmRsZURyYWdFbmQpO1xuXG4gICAgaWYob3B0aW9ucy5ob3ZlckVsKXtcbiAgICAgIG9wdGlvbnMuaG92ZXJFbC5yZW1vdmVDbGFzcyhcImhvdmVyXCIpO1xuICAgIH1cblxuICAgIGlmKCFvcHRpb25zLmhvdmVyRWwgfHwgIW9wdGlvbnMuaG92ZXJFbC5sZW5ndGggKXtcblxuICAgICAgc2NvcGUub25DYW5jZWwgJiYgc2NvcGUub25DYW5jZWwoe1xuICAgICAgICAkZXZlbnQ6IGUsXG4gICAgICAgICRkYXRhOiBzY29wZS5uZ01vZGVsLFxuICAgICAgICBoZWxwZXI6IG9wdGlvbnMuX2hlbHBlcixcbiAgICAgICAgZHJhZ0VsOiBvcHRpb25zLmRyYWdFbCxcbiAgICAgICAgYXJlYUVsOiBvcHRpb25zLmFyZWFFbFxuICAgICAgfSk7XG5cbiAgICAgIGlmKHNjb3BlLmRyYWdnYWJsZSA9PSBcImhlbHBlclwiKXtcbiAgICAgICAgb3B0aW9ucy5faGVscGVyLnJlbW92ZSgpO1xuICAgICAgfWVsc2V7XG4gICAgICAgIC8vZWxlbWVudC5jc3Moe1xuICAgICAgICAvLyAgICB0b3A6IDAsXG4gICAgICAgIC8vICAgIGxlZnQ6IDBcbiAgICAgICAgLy99KTtcbiAgICAgIH1cblxuICAgIH1lbHNle1xuXG5cbiAgICAgIC8vIHZhciBmb28gPSBzY29wZS5vbkRyb3AgJiYgc2NvcGUub25Ecm9wIHx8IG9wdGlvbnMuaG92ZXJFbFswXS5vbkRyb3A7XG5cbiAgICAgIHZhciAkb3B0aW9ucyA9IHtcbiAgICAgICAgb3JpZ2luYWxFdmVudDogZSxcbiAgICAgICAgZGF0YTogc2NvcGUubmdNb2RlbCxcbiAgICAgICAgaGVscGVyOiBvcHRpb25zLl9oZWxwZXIsXG4gICAgICAgIHg6IG9wdGlvbnMuaG92ZXJYLFxuICAgICAgICB5OiBvcHRpb25zLmhvdmVyWSxcbiAgICAgICAgdmFsdWU6IG9wdGlvbnMudmFsdWUsXG4gICAgICAgIGRyb3BFbDogIG9wdGlvbnMuaG92ZXJFbCxcbiAgICAgICAgZHJhZ0VsOiBvcHRpb25zLmRyYWdFbCxcbiAgICAgICAgYXJlYUVsOiBvcHRpb25zLmFyZWFFbCxcbiAgICAgICAgb2Zmc2V0WDogb3B0aW9ucy5oZWxwZXJTdGFydE9mZnNldFgsXG4gICAgICAgIG9mZnNldFk6IG9wdGlvbnMuaGVscGVyU3RhcnRPZmZzZXRZLFxuICAgICAgICBjYWxsYmFjazogZnVuY3Rpb24oKXtcbiAgICAgICAgICBpZihzY29wZS5kcmFnZ2FibGUgPT0gXCJoZWxwZXJcIikge1xuICAgICAgICAgICAgb3B0aW9ucy5faGVscGVyLnJlbW92ZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgdmFyIF9yZW1vdmUgPSBzY29wZS5vbkRyb3Aoe1xuICAgICAgICAkZXZlbnQ6ICAgICAkb3B0aW9ucyxcbiAgICAgICAgJHZhbHVlOiAgICAgb3B0aW9ucy52YWx1ZSxcbiAgICAgICAgJGNhbGxiYWNrOiAgb3B0aW9ucy5jYWxsYmFja1xuICAgICAgfSk7XG4gICAgICBpZihfcmVtb3ZlICE9PSBmYWxzZSAmJiBzY29wZS5kcmFnZ2FibGUgPT0gXCJoZWxwZXJcIil7XG4gICAgICAgIG9wdGlvbnMuX2hlbHBlci5yZW1vdmUoKTtcbiAgICAgIH1lbHNle1xuICAgICAgICAvL2VsZW1lbnQuY3NzKHtcbiAgICAgICAgLy8gICAgdG9wOiAwLFxuICAgICAgICAvLyAgICBsZWZ0OiAwXG4gICAgICAgIC8vfSk7XG4gICAgICB9XG4gICAgfVxuICAgIC8vc2NvcGUuJGFwcGx5KCk7XG4gIH1cblxuXG4gIC8qKlxuICAgKiDRgdC+0LfQtNCw0LXQvCDQutC+0L/QuNGOINC/0LXRgNC10YLQsNGB0LrQuNCy0LDQtdC80L7Qs9C+INGN0LvQtdC80LXQvdGC0LBcbiAgICogQHBhcmFtIGVcbiAgICovXG4gIGZ1bmN0aW9uIGNyZWF0ZUhlbHBlcihlKXtcbiAgICBvcHRpb25zLl9oZWxwZXIgPSBlbGVtZW50LmNsb25lKCk7XG4gICAgdmFyIHBvcyA9ICBlbGVtZW50LmFic29sdXRlUG9zaXRpb24oKTtcbiAgICB2YXIgcG9zX2FyZWEgPSAgb3B0aW9ucy5hcmVhRWwuYWJzb2x1dGVQb3NpdGlvbigpO1xuXG5cbiAgICBvcHRpb25zLl9oZWxwZXIuZmluZChcIi5uby1oZWxwZXJcIikucmVtb3ZlKCk7XG5cbiAgICBvcHRpb25zLl9oZWxwZXIuY3NzKHtcbiAgICAgIGhlaWdodDogICAgICAgICAgICAgZWxlbWVudC5vdXRlckhlaWdodCgpLFxuICAgICAgZGlzcGxheTogICAgICAgICAgICBcImlubGluZS1ibG9ja1wiLFxuICAgICAgXCJ6LWluZGV4XCI6ICAgICAgICAgIGUucGFnZVggPyAxMDAwMCA6IDk5OTksXG4gICAgICAvL1wicG9pbnRlci1ldmVudHNcIjogICBcIm5vbmVcIixcbiAgICAgIHBvc2l0aW9uOiAgICAgICAgICAgXCJhYnNvbHV0ZVwiLFxuICAgICAgbGVmdDogICAgICAgICAgICAgICBwb3MubGVmdCAtIHBvc19hcmVhLmxlZnQsXG4gICAgICB0b3A6ICAgICAgICAgICAgICAgIHBvcy50b3AgLSBwb3NfYXJlYS50b3BcbiAgICB9KVxuICAgICAgLmF0dHIoXCJkcmFnZ2FibGVcIixcImZhbHNlXCIpXG4gICAgICAuYXBwZW5kVG8ob3B0aW9ucy5hcmVhRWwpO1xuXG4gICAgb3B0aW9ucy5kcmFnRWwgPSBlbGVtZW50O1xuXG4gICAgb3B0aW9ucy5faGVscGVyLmFkZENsYXNzKFwiZHJhZ2dhYmxlLWhlbHBlclwiKTtcblxuICB9XG5cbiAgLyoqXG4gICAqINCd0LDRh9C40L3QsNC10Lwg0L/QtdGA0LXRgtCw0YHQutC40LLQsNC90LjQtVxuICAgKiBAcGFyYW0gZVxuICAgKi9cbiAgZnVuY3Rpb24gaGFuZGxlRHJhZ1N0YXJ0KGV2ZW50KSB7XG4gICAgdmFyIGUgPSAgb3B0aW9ucy50b3VjaD8gZXZlbnQub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlc1swXSA6IGV2ZW50O1xuXG4gICAgaWYoTWF0aC5hYnMob3B0aW9ucy5fbGFzdF9ldmVudC5wYWdlWCAtIGUucGFnZVgpIDwgMSAmJiBNYXRoLmFicyhvcHRpb25zLl9sYXN0X2V2ZW50LnBhZ2VZIC0gZS5wYWdlWSkgPCAxKXtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAkKGRvY3VtZW50KS5vZmYoJ3RvdWNobW92ZSBtb3VzZW1vdmUnLCBoYW5kbGVEcmFnU3RhcnQpO1xuICAgICQoZG9jdW1lbnQpLm9mZigndG91Y2hlbmQgbW91c2V1cCcsIGhhbmRsZURyYWdDYW5jZWwpO1xuXG5cbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGVsZW1lbnQuYWRkQ2xhc3MoXCJkcmFnZ2FibGVcIik7XG5cbiAgICB2YXIgX3BhcmVudCA9ICAkKGVsZW1lbnQucGFyZW50cygpWzBdKTtcbiAgICBpZihzY29wZS5kcmFnZ2FibGVBcmVhKXtcbiAgICAgIG9wdGlvbnMuYXJlYUVsID0gJChzY29wZS5kcmFnZ2FibGVBcmVhKTtcbiAgICB9ZWxzZXtcbiAgICAgIG9wdGlvbnMuYXJlYUVsID0gX3BhcmVudDtcbiAgICB9XG5cbiAgICB2YXIgcG9zID0gIGVsZW1lbnQuYWJzb2x1dGVQb3NpdGlvbigpO1xuICAgIG9wdGlvbnMuaGVscGVyU3RhcnRPZmZzZXRYID0gZS5wYWdlWCAtIHBvcy5sZWZ0IDtcbiAgICBvcHRpb25zLmhlbHBlclN0YXJ0T2Zmc2V0WSA9IGUucGFnZVkgLSBwb3MudG9wO1xuXG5cbiAgICBvcHRpb25zLm1hcmdpbkxlZnQgPSAwO1xuICAgIG9wdGlvbnMubWFyZ2luVG9wID0gMDtcbiAgICBpZihzY29wZS5kcmFnZ2FibGUgPT0gXCJoZWxwZXJcIil7XG4gICAgICBjcmVhdGVIZWxwZXIoZSk7XG4gICAgICBvcHRpb25zLmRyYWdEYXRhID0gc2NvcGUubmdNb2RlbDtcbiAgICB9ZWxzZSBpZihzY29wZS5kcmFnZ2FibGUgPT0gXCJzZWxmXCIpe1xuICAgICAgb3B0aW9ucy5faGVscGVyID0gZWxlbWVudDtcbiAgICAgIG9wdGlvbnMubWFyZ2luTGVmdCA9IDA7XG4gICAgICBvcHRpb25zLm1hcmdpblRvcCA9IDA7XG4gICAgICAvL2lmKF9wYXJlbnQgIT0gb3B0aW9ucy5hcmVhRWwpe1xuICAgICAgLy8gICAgb3B0aW9ucy5tYXJnaW5MZWZ0ID0gICsgb3B0aW9ucy5hcmVhRWwub2Zmc2V0KCkubGVmdDtcbiAgICAgIC8vICAgIG9wdGlvbnMubWFyZ2luVG9wID0gKyBvcHRpb25zLmFyZWFFbC5vZmZzZXQoKS50b3A7XG4gICAgICAvL31cbiAgICB9XG5cbiAgICBzY29wZS5vbkRyYWcgJiYgc2NvcGUub25EcmFnKHtcbiAgICAgICRldmVudDogZSxcbiAgICAgICRkYXRhOiBzY29wZS5uZ01vZGVsXG4gICAgfSk7XG5cblxuICAgICQoZG9jdW1lbnQpLm9uKCdtb3VzZW1vdmUgdG91Y2htb3ZlJywgaGFuZGxlRHJhZ01vdmUpO1xuICAgICQoZG9jdW1lbnQpLm9uKCdtb3VzZXVwIHRvdWNoZW5kJywgaGFuZGxlRHJhZ0VuZCk7XG4gIH1cblxuICAvKipcbiAgICogZHJhZyDQvdC1INC/0YDQvtC40YHRhdC+0LTQuNGCXG4gICAqL1xuICBmdW5jdGlvbiBoYW5kbGVEcmFnQ2FuY2VsKCl7XG5cbiAgICAkKGRvY3VtZW50KS5vZmYoJ21vdXNlbW92ZSB0b3VjaG1vdmUnLCBoYW5kbGVEcmFnU3RhcnQpO1xuICAgICQoZG9jdW1lbnQpLm9mZignbW91c2V1cCB0b3VjaGVuZCcsIGhhbmRsZURyYWdDYW5jZWwpO1xuXG4gIH1cblxuICB0aGlzLm9uKCdtb3VzZWRvd24gdG91Y2hzdGFydCcsIHByZXBhcmVGb3JEcmFnKTtcbiAgcmV0dXJuIHRoaXM7XG59O1xuXG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL2pxdWVyeS9kcmFnZ2FibGUuanNcbi8vIG1vZHVsZSBpZCA9IDQ5XG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIi8qKlxuICogRm9udCBTZWxlY3RvciAtIGpRdWVyeSBwbHVnaW4gMC4xXG4gKlxuICogQ29weXJpZ2h0IChjKSAyMDEyIENocmlzIER5ZXJcbiAqXG4gKiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICpcbiAqIFJlZGlzdHJpYnV0aW9uIGFuZCB1c2UgaW4gc291cmNlIGFuZCBiaW5hcnkgZm9ybXMsIHdpdGggb3Igd2l0aG91dCBtb2RpZmljYXRpb24sIGFyZSBwZXJtaXR0ZWQgcHJvdmlkZWQgdGhhdCB0aGUgZm9sbG93aW5nXG4gKiBjb25kaXRpb25zIGFyZSBtZXQ6XG4gKlxuICogUmVkaXN0cmlidXRpb25zIG9mIHNvdXJjZSBjb2RlIG11c3QgcmV0YWluIHRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlLCB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZ1xuICogZGlzY2xhaW1lci4gUmVkaXN0cmlidXRpb25zIGluIGJpbmFyeSBmb3JtIG11c3QgcmVwcm9kdWNlIHRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlLCB0aGlzIGxpc3Qgb2YgY29uZGl0aW9uc1xuICogYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lciBpbiB0aGUgZG9jdW1lbnRhdGlvbiBhbmQvb3Igb3RoZXIgbWF0ZXJpYWxzIHByb3ZpZGVkIHdpdGggdGhlIGRpc3RyaWJ1dGlvbi5cbiAqXG4gKiBUSElTIFNPRlRXQVJFIElTIFBST1ZJREVEIEJZIFRIRSBDT1BZUklHSFQgSE9MREVSUyBBTkQgQ09OVFJJQlVUT1JTIFwiQVMgSVNcIiBBTkQgQU5ZIEVYUFJFU1MgT1IgSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsXG4gKiBCVVQgTk9UIExJTUlURUQgVE8sIFRIRSBJTVBMSUVEIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZIEFORCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBUkUgRElTQ0xBSU1FRC4gSU4gTk9cbiAqIEVWRU5UIFNIQUxMIFRIRSBDT1BZUklHSFQgSE9MREVSIE9SIENPTlRSSUJVVE9SUyBCRSBMSUFCTEUgRk9SIEFOWSBESVJFQ1QsIElORElSRUNULCBJTkNJREVOVEFMLCBTUEVDSUFMLCBFWEVNUExBUlksIE9SXG4gKiBDT05TRVFVRU5USUFMIERBTUFHRVMgKElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBQUk9DVVJFTUVOVCBPRiBTVUJTVElUVVRFIEdPT0RTIE9SIFNFUlZJQ0VTOyBMT1NTIE9GIFVTRSwgREFUQSwgT1IgUFJPRklUUztcbiAqIE9SIEJVU0lORVNTIElOVEVSUlVQVElPTikgSE9XRVZFUiBDQVVTRUQgQU5EIE9OIEFOWSBUSEVPUlkgT0YgTElBQklMSVRZLCBXSEVUSEVSIElOIENPTlRSQUNULCBTVFJJQ1QgTElBQklMSVRZLCBPUiBUT1JUXG4gKiAoSU5DTFVESU5HIE5FR0xJR0VOQ0UgT1IgT1RIRVJXSVNFKSBBUklTSU5HIElOIEFOWSBXQVkgT1VUIE9GIFRIRSBVU0UgT0YgVEhJUyBTT0ZUV0FSRSwgRVZFTiBJRiBBRFZJU0VEIE9GIFRIRSBQT1NTSUJJTElUWSBPRlxuICogU1VDSCBEQU1BR0UuXG4gKlxuICovXG5cblxuXG4oZnVuY3Rpb24gKGZhY3RvcnkpIHtcbiAgaWYgKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0Jykge1xuICAgIG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeShyZXF1aXJlKCdqcXVlcnknKSk7XG4gIH0gZWxzZSB7XG4gICAgZmFjdG9yeShqUXVlcnkpO1xuICB9XG59KFxuICAgIGZ1bmN0aW9uKCAkICkge1xuXG4gICd1c2Ugc3RyaWN0JztcbiAgLy9pZihfICYmIF8uc3R5bGVTaGVldENvbnRhaW5zICYmICFfLnN0eWxlU2hlZXRDb250YWlucygnLmZvbnRTZWxlY3QnKSl7XG4gIC8vICBfLmxpbmtDU1MoXy5zY3JpcHRVUkwoKSArIFwiLy4uLy4uL2Nzcy9qcXVlcnkuZm9udFNlbGVjdG9yLmNzc1wiKTtcbiAgLy99XG5cbiAgdmFyIHNldHRpbmdzO1xuXG4gIHZhciBtZXRob2RzID0ge1xuICAgIGluaXQgOiBmdW5jdGlvbihvcHRpb25zKSB7XG5cbiAgICAgIHNldHRpbmdzID0gJC5leHRlbmQoIHtcbiAgICAgICAgJ2hpZGVfZmFsbGJhY2tzJyA6IGZhbHNlLFxuICAgICAgICAnc2VsZWN0ZWQnIDogZnVuY3Rpb24oc3R5bGUpIHt9LFxuICAgICAgICAnb3BlbmVkJyA6IGZ1bmN0aW9uKCkge30sXG4gICAgICAgICdjbG9zZWQnIDogZnVuY3Rpb24oKSB7fSxcbiAgICAgICAgJ2luaXRpYWwnIDogJycsXG4gICAgICAgICdmb250cycgOiBbXVxuICAgICAgfSwgb3B0aW9ucyk7XG5cbiAgICAgIHZhciByb290ID0gdGhpcztcbiAgICAgIHZhciAkcm9vdCA9ICQodGhpcyk7XG4gICAgICByb290LnNlbGVjdGVkQ2FsbGJhY2sgPSBzZXR0aW5nc1snc2VsZWN0ZWQnXTtcbiAgICAgIHJvb3Qub3BlbmVkQ2FsbGJhY2sgPSBzZXR0aW5nc1snb3BlbmVkJ107XG4gICAgICByb290LmNsb3NlZENhbGxiYWNrID0gc2V0dGluZ3NbJ2Nsb3NlZCddO1xuICAgICAgdmFyIHZpc2libGUgPSBmYWxzZTtcbiAgICAgIHZhciBzZWxlY3RlZCA9IGZhbHNlO1xuICAgICAgdmFyIG9wZW5lZENsYXNzID0gJ2ZvbnRTZWxlY3RPcGVuJztcblxuICAgICAgdmFyIGRpc3BsYXlOYW1lID0gZnVuY3Rpb24oZm9udCkge1xuICAgICAgICBpZiAoc2V0dGluZ3NbJ2hpZGVfZmFsbGJhY2tzJ10pe1xuICAgICAgICAgIHZhciBpbmRleCA9IGZvbnQuaW5kZXhPZignLCcpO1xuICAgICAgICAgIGlmKGluZGV4ID09IC0xIClyZXR1cm4gZm9udDtcbiAgICAgICAgICByZXR1cm4gZm9udC5zdWJzdHIoMCwgaW5kZXgpO1xuICAgICAgICB9ZWxzZVxuICAgICAgICAgIHJldHVybiBmb250O1xuICAgICAgfVxuXG5cbiAgICAgIHZhciBzZWxlY3QgPSBmdW5jdGlvbihmb250LGluaXRpYWwpIHtcbiAgICAgICAgcm9vdC5maW5kKCdzcGFuJykuaHRtbChkaXNwbGF5TmFtZShmb250KS5yZXBsYWNlKC9bXCInXXsxfS9naSxcIlwiKSk7XG4gICAgICAgIHJvb3QuY3NzKCdmb250LWZhbWlseScsIGZvbnQpO1xuICAgICAgICBzZWxlY3RlZCA9IGZvbnQ7XG5cbiAgICAgICAgaWYoIWluaXRpYWwpcm9vdC5zZWxlY3RlZENhbGxiYWNrKHNlbGVjdGVkKTtcbiAgICAgIH1cblxuICAgICAgdmFyIHBvc2l0aW9uVWwgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGxlZnQsIHRvcDtcbiAgICAgICAgbGVmdCA9ICQocm9vdCkub2Zmc2V0KCkubGVmdDtcbiAgICAgICAgdG9wID0gJChyb290KS5vZmZzZXQoKS50b3AgKyAkKHJvb3QpLm91dGVySGVpZ2h0KCk7XG5cbiAgICAgICAgJCh1bCkuY3NzKHtcbiAgICAgICAgICAncG9zaXRpb24nOiAnYWJzb2x1dGUnLFxuICAgICAgICAgICdsZWZ0JzogbGVmdCArICdweCcsXG4gICAgICAgICAgJ3RvcCc6IHRvcCArICdweCcsXG4gICAgICAgICAgJ3dpZHRoJzogJChyb290KS5vdXRlcldpZHRoKCkgKyAncHgnXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICB2YXIgY2xvc2VVbCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB1bC5zbGlkZVVwKCdmYXN0JywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgdmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICB9KTtcblxuICAgICAgICAkcm9vdC5yZW1vdmVDbGFzcyhvcGVuZWRDbGFzcyk7XG5cbiAgICAgICAgcm9vdC5jbG9zZWRDYWxsYmFjaygpO1xuICAgICAgfVxuXG4gICAgICB2YXIgb3BlblVpID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHVsLnNsaWRlRG93bignZmFzdCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHZpc2libGUgPSB0cnVlO1xuICAgICAgICB9KTtcblxuICAgICAgICAkcm9vdC5hZGRDbGFzcyhvcGVuZWRDbGFzcyk7XG5cbiAgICAgICAgcm9vdC5vcGVuZWRDYWxsYmFjaygpO1xuICAgICAgfVxuXG4gICAgICAvLyBTZXR1cCBtYXJrdXBcbiAgICAgICRyb290LnByZXBlbmQoJzxzcGFuPicgKyBzZXR0aW5nc1snaW5pdGlhbCddLnJlcGxhY2UoLycvZywnJiMwMzk7JykgKyAnPC9zcGFuPicpO1xuICAgICAgdmFyIHVsID0gJCgnPHVsIGNsYXNzPVwiZm9udFNlbGVjdFVsXCI+PC91bD4nKS5hcHBlbmRUbygnYm9keScpO1xuICAgICAgdWwuaGlkZSgpO1xuICAgICAgcG9zaXRpb25VbCgpO1xuXG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNldHRpbmdzWydmb250cyddLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHZhciBpdGVtID0gJCgnPGxpPicgKyBkaXNwbGF5TmFtZShzZXR0aW5nc1snZm9udHMnXVtpXSkgKyAnPC9saT4nKS5hcHBlbmRUbyh1bCk7XG4gICAgICAgIGl0ZW0uY3NzKCdmb250LWZhbWlseScsIHNldHRpbmdzWydmb250cyddW2ldKTtcbiAgICAgICAgaXRlbVswXS5kYXRhID0gc2V0dGluZ3NbJ2ZvbnRzJ11baV07XG4gICAgICB9XG5cbiAgICAgIGlmIChzZXR0aW5nc1snaW5pdGlhbCddICE9ICcnKVxuICAgICAgICBzZWxlY3Qoc2V0dGluZ3NbJ2luaXRpYWwnXSx0cnVlKTtcblxuICAgICAgdWwuZmluZCgnbGknKS5jbGljayhmdW5jdGlvbigpIHtcblxuICAgICAgICBpZiAoIXZpc2libGUpXG4gICAgICAgICAgcmV0dXJuO1xuXG4gICAgICAgIHBvc2l0aW9uVWwoKTtcbiAgICAgICAgY2xvc2VVbCgpO1xuXG4gICAgICAgIHNlbGVjdCh0aGlzLmRhdGEpO1xuICAgICAgfSk7XG5cbiAgICAgICRyb290LmNsaWNrKGZ1bmN0aW9uKGV2ZW50KSB7XG5cbiAgICAgICAgaWYgKHZpc2libGUpXG4gICAgICAgICAgcmV0dXJuO1xuXG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuXG4gICAgICAgIHBvc2l0aW9uVWwoKTtcbiAgICAgICAgb3BlblVpKCk7XG4gICAgICB9KTtcblxuICAgICAgJCgnaHRtbCcpLmNsaWNrKGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAodmlzaWJsZSlcbiAgICAgICAge1xuICAgICAgICAgIGNsb3NlVWwoKTtcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9LFxuICAgIHNlbGVjdGVkIDogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gdGhpcy5kYXRhO1xuICAgIH0sXG4gICAgc2VsZWN0IDogZnVuY3Rpb24oZm9udCkge1xuICAgICAgdGhpcy5maW5kKCdzcGFuJykuaHRtbChmb250LnN1YnN0cigwLCBmb250LmluZGV4T2YoJywnKSkucmVwbGFjZSgvW1wiJ117MX0vZ2ksXCJcIikpO1xuICAgICAgdGhpcy5jc3MoJ2ZvbnQtZmFtaWx5JywgZm9udCk7XG4gICAgICB2YXIgc2VsZWN0ZWQgPSBmYWxzZTtcbiAgICAgIHNlbGVjdGVkID0gZm9udDtcbiAgICB9XG4gIH07XG4gICQuZm9udFNlbGVjdG9yID0ge1xuXG4gIH07XG5cbiAgJC5mbi5mb250U2VsZWN0b3IgPSBmdW5jdGlvbihtZXRob2QpIHtcbiAgICBpZiAoIG1ldGhvZHNbbWV0aG9kXSApIHtcbiAgICAgIHJldHVybiBtZXRob2RzWyBtZXRob2QgXS5hcHBseSggdGhpcywgQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoIGFyZ3VtZW50cywgMSApKTtcbiAgICB9IGVsc2UgaWYgKCB0eXBlb2YgbWV0aG9kID09PSAnb2JqZWN0JyB8fCAhIG1ldGhvZCApIHtcbiAgICAgIHJldHVybiBtZXRob2RzLmluaXQuYXBwbHkoIHRoaXMsIGFyZ3VtZW50cyApO1xuICAgIH0gZWxzZSB7XG4gICAgICAkLmVycm9yKCAnTWV0aG9kICcgKyAgbWV0aG9kICsgJyBkb2VzIG5vdCBleGlzdCBvbiBqUXVlcnkuZm9udFNlbGVjdG9yJyApO1xuICAgIH1cbiAgfVxufSkpO1xuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9qcXVlcnkvZm9udFNlbGVjdG9yLmpzXG4vLyBtb2R1bGUgaWQgPSA1MFxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCIvKlxuICogalF1ZXJ5IE1pbmlDb2xvcnM6IEEgdGlueSBjb2xvciBwaWNrZXIgYnVpbHQgb24galF1ZXJ5XG4gKlxuICogQ29weXJpZ2h0OiBDb3J5IExhVmlza2EgZm9yIEEgQmVhdXRpZnVsIFNpdGUsIExMQzogaHR0cDovL3d3dy5hYmVhdXRpZnVsc2l0ZS5uZXQvXG4gKlxuICogQ29udHJpYnV0ZTogaHR0cHM6Ly9naXRodWIuY29tL2NsYXZpc2thL2pxdWVyeS1taW5pY29sb3JzXG4gKlxuICogQGxpY2Vuc2U6IGh0dHA6Ly9vcGVuc291cmNlLm9yZy9saWNlbnNlcy9NSVRcbiAqXG4gKi9cblxuXG5cbihmdW5jdGlvbiAoZmFjdG9yeSkge1xuICBpZiAodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KHJlcXVpcmUoJ2pxdWVyeScpKTtcbiAgfSBlbHNlIHtcbiAgICBmYWN0b3J5KGpRdWVyeSk7XG4gIH1cbn0oXG4gIGZ1bmN0aW9uICgkKSB7XG5cbiAgICAndXNlIHN0cmljdCc7XG4gICAgLy9pZihfICYmIF8uc3R5bGVTaGVldENvbnRhaW5zICYmICFfLnN0eWxlU2hlZXRDb250YWlucygnLm1pbmljb2xvcnMnKSl7XG4gICAgLy8gIF8ubGlua0NTUyhfLnNjcmlwdFVSTCgpICsgXCIvLi4vLi4vY3NzL2pxdWVyeS5taW5pY29sb3JzLmNzc1wiKTtcbiAgICAvL31cblxuICAgIC8vIERlZmF1bHRzXG4gICAgJC5taW5pY29sb3JzID0ge1xuICAgICAgZGVmYXVsdHM6IHtcbiAgICAgICAgYW5pbWF0aW9uU3BlZWQ6IDUwLFxuICAgICAgICBhbmltYXRpb25FYXNpbmc6ICdzd2luZycsXG4gICAgICAgIGNoYW5nZTogbnVsbCxcbiAgICAgICAgY2hhbmdlRGVsYXk6IDAsXG4gICAgICAgIGNvbnRyb2w6ICdodWUnLFxuICAgICAgICBkYXRhVXJpczogdHJ1ZSxcbiAgICAgICAgZGVmYXVsdFZhbHVlOiAnJyxcbiAgICAgICAgZm9ybWF0OiAnaGV4JyxcbiAgICAgICAgaGlkZTogbnVsbCxcbiAgICAgICAgaGlkZVNwZWVkOiAxMDAsXG4gICAgICAgIGlubGluZTogZmFsc2UsXG4gICAgICAgIGtleXdvcmRzOiAnJyxcbiAgICAgICAgbGV0dGVyQ2FzZTogJ2xvd2VyY2FzZScsXG4gICAgICAgIG9wYWNpdHk6IGZhbHNlLFxuICAgICAgICBwb3NpdGlvbjogJ2JvdHRvbSBsZWZ0JyxcbiAgICAgICAgc2hvdzogbnVsbCxcbiAgICAgICAgc2hvd1NwZWVkOiAxMDAsXG4gICAgICAgIHRoZW1lOiAnZGVmYXVsdCcsXG4gICAgICAgIHN3YXRjaGVzOiBbXVxuICAgICAgfVxuICAgIH07XG5cbiAgICAvLyBQdWJsaWMgbWV0aG9kc1xuICAgICQuZXh0ZW5kKCQuZm4sIHtcbiAgICAgIG1pbmljb2xvcnM6IGZ1bmN0aW9uKG1ldGhvZCwgZGF0YSkge1xuXG4gICAgICAgIHN3aXRjaChtZXRob2QpIHtcblxuICAgICAgICAgIC8vIERlc3Ryb3kgdGhlIGNvbnRyb2xcbiAgICAgICAgICBjYXNlICdkZXN0cm95JzpcbiAgICAgICAgICAgICQodGhpcykuZWFjaCggZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgIGRlc3Ryb3koJCh0aGlzKSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiAkKHRoaXMpO1xuXG4gICAgICAgICAgLy8gSGlkZSB0aGUgY29sb3IgcGlja2VyXG4gICAgICAgICAgY2FzZSAnaGlkZSc6XG4gICAgICAgICAgICBoaWRlKCk7XG4gICAgICAgICAgICByZXR1cm4gJCh0aGlzKTtcblxuICAgICAgICAgIC8vIEdldC9zZXQgb3BhY2l0eVxuICAgICAgICAgIGNhc2UgJ29wYWNpdHknOlxuICAgICAgICAgICAgLy8gR2V0dGVyXG4gICAgICAgICAgICBpZiggZGF0YSA9PT0gdW5kZWZpbmVkICkge1xuICAgICAgICAgICAgICAvLyBHZXR0ZXJcbiAgICAgICAgICAgICAgcmV0dXJuICQodGhpcykuYXR0cignZGF0YS1vcGFjaXR5Jyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAvLyBTZXR0ZXJcbiAgICAgICAgICAgICAgJCh0aGlzKS5lYWNoKCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB1cGRhdGVGcm9tSW5wdXQoJCh0aGlzKS5hdHRyKCdkYXRhLW9wYWNpdHknLCBkYXRhKSk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuICQodGhpcyk7XG5cbiAgICAgICAgICAvLyBHZXQgYW4gUkdCKEEpIG9iamVjdCBiYXNlZCBvbiB0aGUgY3VycmVudCBjb2xvci9vcGFjaXR5XG4gICAgICAgICAgY2FzZSAncmdiT2JqZWN0JzpcbiAgICAgICAgICAgIHJldHVybiByZ2JPYmplY3QoJCh0aGlzKSwgbWV0aG9kID09PSAncmdiYU9iamVjdCcpO1xuXG4gICAgICAgICAgLy8gR2V0IGFuIFJHQihBKSBzdHJpbmcgYmFzZWQgb24gdGhlIGN1cnJlbnQgY29sb3Ivb3BhY2l0eVxuICAgICAgICAgIGNhc2UgJ3JnYlN0cmluZyc6XG4gICAgICAgICAgY2FzZSAncmdiYVN0cmluZyc6XG4gICAgICAgICAgICByZXR1cm4gcmdiU3RyaW5nKCQodGhpcyksIG1ldGhvZCA9PT0gJ3JnYmFTdHJpbmcnKTtcblxuICAgICAgICAgIC8vIEdldC9zZXQgc2V0dGluZ3Mgb24gdGhlIGZseVxuICAgICAgICAgIGNhc2UgJ3NldHRpbmdzJzpcbiAgICAgICAgICAgIGlmKCBkYXRhID09PSB1bmRlZmluZWQgKSB7XG4gICAgICAgICAgICAgIHJldHVybiAkKHRoaXMpLmRhdGEoJ21pbmljb2xvcnMtc2V0dGluZ3MnKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIC8vIFNldHRlclxuICAgICAgICAgICAgICAkKHRoaXMpLmVhY2goIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBzZXR0aW5ncyA9ICQodGhpcykuZGF0YSgnbWluaWNvbG9ycy1zZXR0aW5ncycpIHx8IHt9O1xuICAgICAgICAgICAgICAgIGRlc3Ryb3koJCh0aGlzKSk7XG4gICAgICAgICAgICAgICAgJCh0aGlzKS5taW5pY29sb3JzKCQuZXh0ZW5kKHRydWUsIHNldHRpbmdzLCBkYXRhKSk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuICQodGhpcyk7XG5cbiAgICAgICAgICAvLyBTaG93IHRoZSBjb2xvciBwaWNrZXJcbiAgICAgICAgICBjYXNlICdzaG93JzpcbiAgICAgICAgICAgIHNob3coICQodGhpcykuZXEoMCkgKTtcbiAgICAgICAgICAgIHJldHVybiAkKHRoaXMpO1xuXG4gICAgICAgICAgLy8gR2V0L3NldCB0aGUgaGV4IGNvbG9yIHZhbHVlXG4gICAgICAgICAgY2FzZSAndmFsdWUnOlxuICAgICAgICAgICAgaWYoIGRhdGEgPT09IHVuZGVmaW5lZCApIHtcbiAgICAgICAgICAgICAgLy8gR2V0dGVyXG4gICAgICAgICAgICAgIHJldHVybiAkKHRoaXMpLnZhbCgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgLy8gU2V0dGVyXG4gICAgICAgICAgICAgICQodGhpcykuZWFjaCggZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgaWYoIHR5cGVvZihkYXRhKSA9PT0gJ29iamVjdCcgKSB7XG4gICAgICAgICAgICAgICAgICBpZiggZGF0YS5vcGFjaXR5ICkge1xuICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmF0dHIoJ2RhdGEtb3BhY2l0eScsIGtlZXBXaXRoaW4oZGF0YS5vcGFjaXR5LCAwLCAxKSk7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICBpZiggZGF0YS5jb2xvciApIHtcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS52YWwoZGF0YS5jb2xvcik7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICQodGhpcykudmFsKGRhdGEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB1cGRhdGVGcm9tSW5wdXQoJCh0aGlzKSk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuICQodGhpcyk7XG5cbiAgICAgICAgICAvLyBJbml0aWFsaXplcyB0aGUgY29udHJvbFxuICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICBpZiggbWV0aG9kICE9PSAnY3JlYXRlJyApIGRhdGEgPSBtZXRob2Q7XG4gICAgICAgICAgICAkKHRoaXMpLmVhY2goIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICBpbml0KCQodGhpcyksIGRhdGEpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gJCh0aGlzKTtcblxuICAgICAgICB9XG5cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHZhciBpbnB1dFRleHQsIGdsb2JhbFNldHRpbmdzLCBnbG9iYWxUYXJnZXQgLCBnbG9iYWxJbnB1dCA7XG4gICAgLy8gSW5pdGlhbGl6ZSBpbnB1dCBlbGVtZW50c1xuICAgIGZ1bmN0aW9uIGluaXQoaW5wdXQsIHNldHRpbmdzKSB7XG5cbiAgICAgIHZhciBtaW5pY29sb3JzID0gJCgnPGRpdiBjbGFzcz1cIm1pbmljb2xvcnNcIiAvPicpLFxuICAgICAgICBkZWZhdWx0cyA9ICQubWluaWNvbG9ycy5kZWZhdWx0cyxcbiAgICAgICAgc2l6ZSxcbiAgICAgICAgc3dhdGNoZXMsXG4gICAgICAgIHRleHRQYW5lbCxcbiAgICAgICAgc3dhdGNoLFxuICAgICAgICBwYW5lbCxcbiAgICAgICAgZ2xvYmFsVGFyZ2V0ID0gaW5wdXQsXG4gICAgICAgIGk7XG5cbiAgICAgIC8vIERvIG5vdGhpbmcgaWYgYWxyZWFkeSBpbml0aWFsaXplZFxuICAgICAgaWYoIGlucHV0LmRhdGEoJ21pbmljb2xvcnMtaW5pdGlhbGl6ZWQnKSApIHJldHVybjtcblxuICAgICAgLy8gSGFuZGxlIHNldHRpbmdzXG4gICAgICBnbG9iYWxTZXR0aW5ncyA9IHNldHRpbmdzID0gJC5leHRlbmQodHJ1ZSwge30sIGRlZmF1bHRzLCBzZXR0aW5ncyk7XG5cbiAgICAgIC8vIFRoZSB3cmFwcGVyXG4gICAgICBtaW5pY29sb3JzXG4gICAgICAgIC5hZGRDbGFzcygnbWluaWNvbG9ycy10aGVtZS0nICsgc2V0dGluZ3MudGhlbWUpXG4gICAgICAgIC50b2dnbGVDbGFzcygnbWluaWNvbG9ycy13aXRoLW9wYWNpdHknLCBzZXR0aW5ncy5vcGFjaXR5KVxuICAgICAgICAudG9nZ2xlQ2xhc3MoJ21pbmljb2xvcnMtbm8tZGF0YS11cmlzJywgc2V0dGluZ3MuZGF0YVVyaXMgIT09IHRydWUpO1xuXG4gICAgICAvLyBDdXN0b20gcG9zaXRpb25pbmdcbiAgICAgIGlmKCBzZXR0aW5ncy5wb3NpdGlvbiAhPT0gdW5kZWZpbmVkICkge1xuICAgICAgICAkLmVhY2goc2V0dGluZ3MucG9zaXRpb24uc3BsaXQoJyAnKSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgbWluaWNvbG9ycy5hZGRDbGFzcygnbWluaWNvbG9ycy1wb3NpdGlvbi0nICsgdGhpcyk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBJbnB1dCBzaXplXG4gICAgICBpZiggc2V0dGluZ3MuZm9ybWF0ID09PSAncmdiJyApIHtcbiAgICAgICAgc2l6ZSA9IHNldHRpbmdzLm9wYWNpdHkgPyAnMjUnIDogJzIwJztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHNpemUgPSBzZXR0aW5ncy5rZXl3b3JkcyA/ICcxMScgOiAnNyc7XG4gICAgICB9XG4gICAgICAgZ2xvYmFsSW5wdXQgPSBpbnB1dDtcbiAgICAgIC8vIFRoZSBpbnB1dFxuICAgICAgaW5wdXRcbiAgICAgICAgLmFkZENsYXNzKCdtaW5pY29sb3JzLWlucHV0JylcbiAgICAgICAgLmRhdGEoJ21pbmljb2xvcnMtaW5pdGlhbGl6ZWQnLCBmYWxzZSlcbiAgICAgICAgLmRhdGEoJ21pbmljb2xvcnMtc2V0dGluZ3MnLCBzZXR0aW5ncylcbiAgICAgICAgLnByb3AoJ3NpemUnLCBzaXplKVxuICAgICAgICAud3JhcChtaW5pY29sb3JzKVxuICAgICAgICAuYWZ0ZXIoXG4gICAgICAgICc8ZGl2IGNsYXNzPVwibWluaWNvbG9ycy1wYW5lbCBtaW5pY29sb3JzLXNsaWRlci0nICsgc2V0dGluZ3MuY29udHJvbCArICdcIj4nICtcbiAgICAgICAgJzxkaXYgY2xhc3M9XCJtaW5pY29sb3JzLXNsaWRlciBtaW5pY29sb3JzLXNwcml0ZVwiPicgK1xuICAgICAgICAnPGRpdiBjbGFzcz1cIm1pbmljb2xvcnMtcGlja2VyXCI+PC9kaXY+JyArXG4gICAgICAgICc8L2Rpdj4nICtcbiAgICAgICAgJzxkaXYgY2xhc3M9XCJtaW5pY29sb3JzLW9wYWNpdHktc2xpZGVyIG1pbmljb2xvcnMtc3ByaXRlXCI+JyArXG4gICAgICAgICc8ZGl2IGNsYXNzPVwibWluaWNvbG9ycy1waWNrZXJcIj48L2Rpdj4nICtcbiAgICAgICAgJzwvZGl2PicgK1xuICAgICAgICAnPGRpdiBjbGFzcz1cIm1pbmljb2xvcnMtZ3JpZCBtaW5pY29sb3JzLXNwcml0ZVwiPicgK1xuICAgICAgICAnPGRpdiBjbGFzcz1cIm1pbmljb2xvcnMtZ3JpZC1pbm5lclwiPjwvZGl2PicgK1xuICAgICAgICAnPGRpdiBjbGFzcz1cIm1pbmljb2xvcnMtcGlja2VyXCI+PGRpdj48L2Rpdj48L2Rpdj4nICtcbiAgICAgICAgJzwvZGl2PicgK1xuICAgICAgICAnPC9kaXY+J1xuICAgICAgKTtcblxuICAgICAgLy8gVGhlIHN3YXRjaFxuICAgICAgaWYoICFzZXR0aW5ncy5pbmxpbmUgKSB7XG4gICAgICAgIGlucHV0LmFmdGVyKCc8c3BhbiBjbGFzcz1cIm1pbmljb2xvcnMtc3dhdGNoIG1pbmljb2xvcnMtc3ByaXRlIG1pbmljb2xvcnMtaW5wdXQtc3dhdGNoXCI+PHNwYW4gY2xhc3M9XCJtaW5pY29sb3JzLXN3YXRjaC1jb2xvclwiPjwvc3Bhbj48L3NwYW4+Jyk7XG4gICAgICAgIGlucHV0Lm5leHQoJy5taW5pY29sb3JzLWlucHV0LXN3YXRjaCcpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICBpbnB1dC5mb2N1cygpO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gUHJldmVudCB0ZXh0IHNlbGVjdGlvbiBpbiBJRVxuICAgICAgcGFuZWwgPSBpbnB1dC5wYXJlbnQoKS5maW5kKCcubWluaWNvbG9ycy1wYW5lbCcpO1xuICAgICAgcGFuZWwub24oJ3NlbGVjdHN0YXJ0JywgZnVuY3Rpb24oKSB7IHJldHVybiBmYWxzZTsgfSkuZW5kKCk7XG5cbiAgICAgIC8vIFN3YXRjaGVzXG4gICAgICBpZiAoc2V0dGluZ3Muc3dhdGNoZXMgJiYgc2V0dGluZ3Muc3dhdGNoZXMubGVuZ3RoICE9PSAwKSB7XG4gICAgICAgIGlmIChzZXR0aW5ncy5zd2F0Y2hlcy5sZW5ndGggPiA3KSB7XG4gICAgICAgICAgc2V0dGluZ3Muc3dhdGNoZXMubGVuZ3RoID0gNztcbiAgICAgICAgfVxuICAgICAgICBwYW5lbC5hZGRDbGFzcygnbWluaWNvbG9ycy13aXRoLXN3YXRjaGVzJyk7XG4gICAgICAgIHN3YXRjaGVzID0gJCgnPHVsIGNsYXNzPVwibWluaWNvbG9ycy1zd2F0Y2hlc1wiPjwvdWw+JylcbiAgICAgICAgICAuYXBwZW5kVG8ocGFuZWwpO1xuICAgICAgICBmb3IoaSA9IDA7IGkgPCBzZXR0aW5ncy5zd2F0Y2hlcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgIHN3YXRjaCA9IHNldHRpbmdzLnN3YXRjaGVzW2ldO1xuICAgICAgICAgIHN3YXRjaCA9IGlzUmdiKHN3YXRjaCkgPyBwYXJzZVJnYihzd2F0Y2gsIHRydWUpIDogaGV4MnJnYihwYXJzZUhleChzd2F0Y2gsIHRydWUpKTtcbiAgICAgICAgICAkKCc8bGkgY2xhc3M9XCJtaW5pY29sb3JzLXN3YXRjaCBtaW5pY29sb3JzLXNwcml0ZVwiPjxzcGFuIGNsYXNzPVwibWluaWNvbG9ycy1zd2F0Y2gtY29sb3JcIj48L3NwYW4+PC9saT4nKVxuICAgICAgICAgICAgLmFwcGVuZFRvKHN3YXRjaGVzKVxuICAgICAgICAgICAgLmRhdGEoJ3N3YXRjaC1jb2xvcicsIHNldHRpbmdzLnN3YXRjaGVzW2ldKVxuICAgICAgICAgICAgLmZpbmQoJy5taW5pY29sb3JzLXN3YXRjaC1jb2xvcicpXG4gICAgICAgICAgICAuY3NzKHtcbiAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiByZ2IyaGV4KHN3YXRjaCksXG4gICAgICAgICAgICAgIG9wYWNpdHk6IHN3YXRjaC5hXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICBzZXR0aW5ncy5zd2F0Y2hlc1tpXSA9IHN3YXRjaDtcbiAgICAgICAgfVxuXG4gICAgICB9XG5cblxuICAgICAgLy8gU3dhdGNoZXNcbiAgICAgIGlmIChzZXR0aW5ncy50ZXh0KSB7XG4gICAgICAgIHBhbmVsLmFkZENsYXNzKCdtaW5pY29sb3JzLXdpdGgtdGV4dCcpO1xuICAgICAgICB0ZXh0UGFuZWwgPSAkKCc8ZGl2IGNsYXNzPVwibWluaWNvbG9ycy10ZXh0XCI+PC9kaXY+JylcbiAgICAgICAgICAuYXBwZW5kVG8ocGFuZWwpO1xuICAgICAgICBpbnB1dFRleHQgPSAkKCc8aW5wdXQgdHlwZT1cInRleHRcIj4nKVxuICAgICAgICAgIC5hcHBlbmRUbyh0ZXh0UGFuZWwpO1xuXG4gICAgICAgICQoaW5wdXRUZXh0KS5jaGFuZ2UoZnVuY3Rpb24oKXtcbiAgICAgICAgICBpbnB1dC52YWwoaW5wdXRUZXh0LnZhbCgpKTtcbiAgICAgICAgICB1cGRhdGVGcm9tSW5wdXQoaW5wdXQsIHRydWUpO1xuICAgICAgICB9KVxuXG4gICAgICB9XG5cbiAgICAgIC8vIElubGluZSBjb250cm9sc1xuICAgICAgaWYoIHNldHRpbmdzLmlubGluZSApIGlucHV0LnBhcmVudCgpLmFkZENsYXNzKCdtaW5pY29sb3JzLWlubGluZScpO1xuXG4gICAgICB1cGRhdGVGcm9tSW5wdXQoaW5wdXQsIGZhbHNlKTtcblxuICAgICAgaW5wdXQuZGF0YSgnbWluaWNvbG9ycy1pbml0aWFsaXplZCcsIHRydWUpO1xuXG4gICAgfVxuXG4gICAgLy8gUmV0dXJucyB0aGUgaW5wdXQgYmFjayB0byBpdHMgb3JpZ2luYWwgc3RhdGVcbiAgICBmdW5jdGlvbiBkZXN0cm95KGlucHV0KSB7XG5cbiAgICAgIHZhciBtaW5pY29sb3JzID0gaW5wdXQucGFyZW50KCk7XG5cbiAgICAgIC8vIFJldmVydCB0aGUgaW5wdXQgZWxlbWVudFxuICAgICAgaW5wdXRcbiAgICAgICAgLnJlbW92ZURhdGEoJ21pbmljb2xvcnMtaW5pdGlhbGl6ZWQnKVxuICAgICAgICAucmVtb3ZlRGF0YSgnbWluaWNvbG9ycy1zZXR0aW5ncycpXG4gICAgICAgIC5yZW1vdmVQcm9wKCdzaXplJylcbiAgICAgICAgLnJlbW92ZUNsYXNzKCdtaW5pY29sb3JzLWlucHV0Jyk7XG5cbiAgICAgIC8vIFJlbW92ZSB0aGUgd3JhcCBhbmQgZGVzdHJveSB3aGF0ZXZlciByZW1haW5zXG4gICAgICBtaW5pY29sb3JzLmJlZm9yZShpbnB1dCkucmVtb3ZlKCk7XG5cbiAgICB9XG5cbiAgICAvLyBTaG93cyB0aGUgc3BlY2lmaWVkIGRyb3Bkb3duIHBhbmVsXG4gICAgZnVuY3Rpb24gc2hvdyhpbnB1dCkge1xuXG4gICAgICB2YXIgbWluaWNvbG9ycyA9IGlucHV0LnBhcmVudCgpLFxuICAgICAgICBwYW5lbCA9IG1pbmljb2xvcnMuZmluZCgnLm1pbmljb2xvcnMtcGFuZWwnKSxcbiAgICAgICAgc2V0dGluZ3MgPSBpbnB1dC5kYXRhKCdtaW5pY29sb3JzLXNldHRpbmdzJyk7XG5cbiAgICAgIC8vIERvIG5vdGhpbmcgaWYgdW5pbml0aWFsaXplZCwgZGlzYWJsZWQsIGlubGluZSwgb3IgYWxyZWFkeSBvcGVuXG4gICAgICBpZiggIWlucHV0LmRhdGEoJ21pbmljb2xvcnMtaW5pdGlhbGl6ZWQnKSB8fFxuICAgICAgICBpbnB1dC5wcm9wKCdkaXNhYmxlZCcpIHx8XG4gICAgICAgIG1pbmljb2xvcnMuaGFzQ2xhc3MoJ21pbmljb2xvcnMtaW5saW5lJykgfHxcbiAgICAgICAgbWluaWNvbG9ycy5oYXNDbGFzcygnbWluaWNvbG9ycy1mb2N1cycpXG4gICAgICApIHJldHVybjtcblxuICAgICAgaGlkZSgpO1xuXG4gICAgICBtaW5pY29sb3JzLmFkZENsYXNzKCdtaW5pY29sb3JzLWZvY3VzJyk7XG4gICAgICBwYW5lbFxuICAgICAgICAuc3RvcCh0cnVlLCB0cnVlKVxuICAgICAgICAuZmFkZUluKHNldHRpbmdzLnNob3dTcGVlZCwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaWYoIHNldHRpbmdzLnNob3cgKSBzZXR0aW5ncy5zaG93LmNhbGwoaW5wdXQuZ2V0KDApKTtcbiAgICAgICAgfSk7XG5cbiAgICB9XG5cbiAgICAvLyBIaWRlcyBhbGwgZHJvcGRvd24gcGFuZWxzXG4gICAgZnVuY3Rpb24gaGlkZSgpIHtcblxuICAgICAgJCgnLm1pbmljb2xvcnMtZm9jdXMnKS5lYWNoKCBmdW5jdGlvbigpIHtcblxuICAgICAgICB2YXIgbWluaWNvbG9ycyA9ICQodGhpcyksXG4gICAgICAgICAgaW5wdXQgPSBtaW5pY29sb3JzLmZpbmQoJy5taW5pY29sb3JzLWlucHV0JyksXG4gICAgICAgICAgcGFuZWwgPSBtaW5pY29sb3JzLmZpbmQoJy5taW5pY29sb3JzLXBhbmVsJyksXG4gICAgICAgICAgc2V0dGluZ3MgPSBpbnB1dC5kYXRhKCdtaW5pY29sb3JzLXNldHRpbmdzJyk7XG5cbiAgICAgICAgcGFuZWwuZmFkZU91dChzZXR0aW5ncy5oaWRlU3BlZWQsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGlmKCBzZXR0aW5ncy5oaWRlICkgc2V0dGluZ3MuaGlkZS5jYWxsKGlucHV0LmdldCgwKSk7XG4gICAgICAgICAgbWluaWNvbG9ycy5yZW1vdmVDbGFzcygnbWluaWNvbG9ycy1mb2N1cycpO1xuICAgICAgICB9KTtcblxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gTW92ZXMgdGhlIHNlbGVjdGVkIHBpY2tlclxuICAgIGZ1bmN0aW9uIG1vdmUodGFyZ2V0LCBldmVudCwgYW5pbWF0ZSkge1xuXG4gICAgICB2YXIgaW5wdXQgPSAgdGFyZ2V0LnBhcmVudHMoJy5taW5pY29sb3JzJykuZmluZCgnLm1pbmljb2xvcnMtaW5wdXQnKSxcbiAgICAgICAgc2V0dGluZ3MgPSBpbnB1dC5kYXRhKCdtaW5pY29sb3JzLXNldHRpbmdzJyksXG4gICAgICAgIHBpY2tlciA9IHRhcmdldC5maW5kKCdbY2xhc3MkPS1waWNrZXJdJyksXG4gICAgICAgIG9mZnNldFggPSB0YXJnZXQub2Zmc2V0KCkubGVmdCxcbiAgICAgICAgb2Zmc2V0WSA9IHRhcmdldC5vZmZzZXQoKS50b3AsXG4gICAgICAgIHggPSBNYXRoLnJvdW5kKGV2ZW50LnBhZ2VYIC0gb2Zmc2V0WCksXG4gICAgICAgIHkgPSBNYXRoLnJvdW5kKGV2ZW50LnBhZ2VZIC0gb2Zmc2V0WSksXG4gICAgICAgIGR1cmF0aW9uID0gYW5pbWF0ZSA/IHNldHRpbmdzLmFuaW1hdGlvblNwZWVkIDogMCxcbiAgICAgICAgd3gsIHd5LCByLCBwaGk7XG5cbiAgICAgIC8vIFRvdWNoIHN1cHBvcnRcbiAgICAgIGlmKCBldmVudC5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzICkge1xuICAgICAgICB4ID0gZXZlbnQub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlc1swXS5wYWdlWCAtIG9mZnNldFg7XG4gICAgICAgIHkgPSBldmVudC5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzWzBdLnBhZ2VZIC0gb2Zmc2V0WTtcbiAgICAgIH1cblxuICAgICAgLy8gQ29uc3RyYWluIHBpY2tlciB0byBpdHMgY29udGFpbmVyXG4gICAgICBpZiggeCA8IDAgKSB4ID0gMDtcbiAgICAgIGlmKCB5IDwgMCApIHkgPSAwO1xuICAgICAgaWYoIHggPiB0YXJnZXQud2lkdGgoKSApIHggPSB0YXJnZXQud2lkdGgoKTtcbiAgICAgIGlmKCB5ID4gdGFyZ2V0LmhlaWdodCgpICkgeSA9IHRhcmdldC5oZWlnaHQoKTtcblxuICAgICAgLy8gQ29uc3RyYWluIGNvbG9yIHdoZWVsIHZhbHVlcyB0byB0aGUgd2hlZWxcbiAgICAgIGlmKCB0YXJnZXQucGFyZW50KCkuaXMoJy5taW5pY29sb3JzLXNsaWRlci13aGVlbCcpICYmIHBpY2tlci5wYXJlbnQoKS5pcygnLm1pbmljb2xvcnMtZ3JpZCcpICkge1xuICAgICAgICB3eCA9IDc1IC0geDtcbiAgICAgICAgd3kgPSA3NSAtIHk7XG4gICAgICAgIHIgPSBNYXRoLnNxcnQod3ggKiB3eCArIHd5ICogd3kpO1xuICAgICAgICBwaGkgPSBNYXRoLmF0YW4yKHd5LCB3eCk7XG4gICAgICAgIGlmKCBwaGkgPCAwICkgcGhpICs9IE1hdGguUEkgKiAyO1xuICAgICAgICBpZiggciA+IDc1ICkge1xuICAgICAgICAgIHIgPSA3NTtcbiAgICAgICAgICB4ID0gNzUgLSAoNzUgKiBNYXRoLmNvcyhwaGkpKTtcbiAgICAgICAgICB5ID0gNzUgLSAoNzUgKiBNYXRoLnNpbihwaGkpKTtcbiAgICAgICAgfVxuICAgICAgICB4ID0gTWF0aC5yb3VuZCh4KTtcbiAgICAgICAgeSA9IE1hdGgucm91bmQoeSk7XG4gICAgICB9XG5cbiAgICAgIC8vIE1vdmUgdGhlIHBpY2tlclxuICAgICAgaWYoIHRhcmdldC5pcygnLm1pbmljb2xvcnMtZ3JpZCcpICkge1xuICAgICAgICBwaWNrZXJcbiAgICAgICAgICAuc3RvcCh0cnVlKVxuICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgIHRvcDogeSArICdweCcsXG4gICAgICAgICAgICBsZWZ0OiB4ICsgJ3B4J1xuICAgICAgICAgIH0sIGR1cmF0aW9uLCBzZXR0aW5ncy5hbmltYXRpb25FYXNpbmcsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdXBkYXRlRnJvbUNvbnRyb2woaW5wdXQsIHRhcmdldCk7XG4gICAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBwaWNrZXJcbiAgICAgICAgICAuc3RvcCh0cnVlKVxuICAgICAgICAgIC5hbmltYXRlKHtcbiAgICAgICAgICAgIHRvcDogeSArICdweCdcbiAgICAgICAgICB9LCBkdXJhdGlvbiwgc2V0dGluZ3MuYW5pbWF0aW9uRWFzaW5nLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHVwZGF0ZUZyb21Db250cm9sKGlucHV0LCB0YXJnZXQpO1xuICAgICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgfVxuXG4gICAgLy8gU2V0cyB0aGUgaW5wdXQgYmFzZWQgb24gdGhlIGNvbG9yIHBpY2tlciB2YWx1ZXNcbiAgICBmdW5jdGlvbiB1cGRhdGVGcm9tQ29udHJvbChpbnB1dCwgdGFyZ2V0KSB7XG5cbiAgICAgIGZ1bmN0aW9uIGdldENvb3JkcyhwaWNrZXIsIGNvbnRhaW5lcikge1xuXG4gICAgICAgIHZhciBsZWZ0LCB0b3A7XG4gICAgICAgIGlmKCAhcGlja2VyLmxlbmd0aCB8fCAhY29udGFpbmVyICkgcmV0dXJuIG51bGw7XG4gICAgICAgIGxlZnQgPSBwaWNrZXIub2Zmc2V0KCkubGVmdDtcbiAgICAgICAgdG9wID0gcGlja2VyLm9mZnNldCgpLnRvcDtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHg6IGxlZnQgLSBjb250YWluZXIub2Zmc2V0KCkubGVmdCArIChwaWNrZXIub3V0ZXJXaWR0aCgpIC8gMiksXG4gICAgICAgICAgeTogdG9wIC0gY29udGFpbmVyLm9mZnNldCgpLnRvcCArIChwaWNrZXIub3V0ZXJIZWlnaHQoKSAvIDIpXG4gICAgICAgIH07XG5cbiAgICAgIH1cblxuICAgICAgdmFyIGh1ZSwgc2F0dXJhdGlvbiwgYnJpZ2h0bmVzcywgeCwgeSwgciwgcGhpLFxuXG4gICAgICAgIGhleCA9IGlucHV0LnZhbCgpLFxuICAgICAgICBvcGFjaXR5ID0gaW5wdXQuYXR0cignZGF0YS1vcGFjaXR5JyksXG5cbiAgICAgIC8vIEhlbHBmdWwgcmVmZXJlbmNlc1xuICAgICAgICBtaW5pY29sb3JzID0gaW5wdXQucGFyZW50KCksXG4gICAgICAgIHNldHRpbmdzID0gaW5wdXQuZGF0YSgnbWluaWNvbG9ycy1zZXR0aW5ncycpLFxuICAgICAgICBzd2F0Y2ggPSBtaW5pY29sb3JzLmZpbmQoJy5taW5pY29sb3JzLWlucHV0LXN3YXRjaCcpLFxuXG4gICAgICAvLyBQYW5lbCBvYmplY3RzXG4gICAgICAgIGdyaWQgPSBtaW5pY29sb3JzLmZpbmQoJy5taW5pY29sb3JzLWdyaWQnKSxcbiAgICAgICAgc2xpZGVyID0gbWluaWNvbG9ycy5maW5kKCcubWluaWNvbG9ycy1zbGlkZXInKSxcbiAgICAgICAgb3BhY2l0eVNsaWRlciA9IG1pbmljb2xvcnMuZmluZCgnLm1pbmljb2xvcnMtb3BhY2l0eS1zbGlkZXInKSxcblxuICAgICAgLy8gUGlja2VyIG9iamVjdHNcbiAgICAgICAgZ3JpZFBpY2tlciA9IGdyaWQuZmluZCgnW2NsYXNzJD0tcGlja2VyXScpLFxuICAgICAgICBzbGlkZXJQaWNrZXIgPSBzbGlkZXIuZmluZCgnW2NsYXNzJD0tcGlja2VyXScpLFxuICAgICAgICBvcGFjaXR5UGlja2VyID0gb3BhY2l0eVNsaWRlci5maW5kKCdbY2xhc3MkPS1waWNrZXJdJyksXG5cbiAgICAgIC8vIFBpY2tlciBwb3NpdGlvbnNcbiAgICAgICAgZ3JpZFBvcyA9IGdldENvb3JkcyhncmlkUGlja2VyLCBncmlkKSxcbiAgICAgICAgc2xpZGVyUG9zID0gZ2V0Q29vcmRzKHNsaWRlclBpY2tlciwgc2xpZGVyKSxcbiAgICAgICAgb3BhY2l0eVBvcyA9IGdldENvb3JkcyhvcGFjaXR5UGlja2VyLCBvcGFjaXR5U2xpZGVyKTtcblxuICAgICAgLy8gSGFuZGxlIGNvbG9yc1xuICAgICAgaWYoIHRhcmdldC5pcygnLm1pbmljb2xvcnMtZ3JpZCwgLm1pbmljb2xvcnMtc2xpZGVyLCAubWluaWNvbG9ycy1vcGFjaXR5LXNsaWRlcicpICkge1xuXG4gICAgICAgIC8vIERldGVybWluZSBIU0IgdmFsdWVzXG4gICAgICAgIHN3aXRjaChzZXR0aW5ncy5jb250cm9sKSB7XG5cbiAgICAgICAgICBjYXNlICd3aGVlbCc6XG4gICAgICAgICAgICAvLyBDYWxjdWxhdGUgaHVlLCBzYXR1cmF0aW9uLCBhbmQgYnJpZ2h0bmVzc1xuICAgICAgICAgICAgeCA9IChncmlkLndpZHRoKCkgLyAyKSAtIGdyaWRQb3MueDtcbiAgICAgICAgICAgIHkgPSAoZ3JpZC5oZWlnaHQoKSAvIDIpIC0gZ3JpZFBvcy55O1xuICAgICAgICAgICAgciA9IE1hdGguc3FydCh4ICogeCArIHkgKiB5KTtcbiAgICAgICAgICAgIHBoaSA9IE1hdGguYXRhbjIoeSwgeCk7XG4gICAgICAgICAgICBpZiggcGhpIDwgMCApIHBoaSArPSBNYXRoLlBJICogMjtcbiAgICAgICAgICAgIGlmKCByID4gNzUgKSB7XG4gICAgICAgICAgICAgIHIgPSA3NTtcbiAgICAgICAgICAgICAgZ3JpZFBvcy54ID0gNjkgLSAoNzUgKiBNYXRoLmNvcyhwaGkpKTtcbiAgICAgICAgICAgICAgZ3JpZFBvcy55ID0gNjkgLSAoNzUgKiBNYXRoLnNpbihwaGkpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHNhdHVyYXRpb24gPSBrZWVwV2l0aGluKHIgLyAwLjc1LCAwLCAxMDApO1xuICAgICAgICAgICAgaHVlID0ga2VlcFdpdGhpbihwaGkgKiAxODAgLyBNYXRoLlBJLCAwLCAzNjApO1xuICAgICAgICAgICAgYnJpZ2h0bmVzcyA9IGtlZXBXaXRoaW4oMTAwIC0gTWF0aC5mbG9vcihzbGlkZXJQb3MueSAqICgxMDAgLyBzbGlkZXIuaGVpZ2h0KCkpKSwgMCwgMTAwKTtcbiAgICAgICAgICAgIGhleCA9IGhzYjJoZXgoe1xuICAgICAgICAgICAgICBoOiBodWUsXG4gICAgICAgICAgICAgIHM6IHNhdHVyYXRpb24sXG4gICAgICAgICAgICAgIGI6IGJyaWdodG5lc3NcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBVcGRhdGUgVUlcbiAgICAgICAgICAgIHNsaWRlci5jc3MoJ2JhY2tncm91bmRDb2xvcicsIGhzYjJoZXgoeyBoOiBodWUsIHM6IHNhdHVyYXRpb24sIGI6IDEwMCB9KSk7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGNhc2UgJ3NhdHVyYXRpb24nOlxuICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIGh1ZSwgc2F0dXJhdGlvbiwgYW5kIGJyaWdodG5lc3NcbiAgICAgICAgICAgIGh1ZSA9IGtlZXBXaXRoaW4ocGFyc2VJbnQoZ3JpZFBvcy54ICogKDM2MCAvIGdyaWQud2lkdGgoKSksIDEwKSwgMCwgMzYwKTtcbiAgICAgICAgICAgIHNhdHVyYXRpb24gPSBrZWVwV2l0aGluKDEwMCAtIE1hdGguZmxvb3Ioc2xpZGVyUG9zLnkgKiAoMTAwIC8gc2xpZGVyLmhlaWdodCgpKSksIDAsIDEwMCk7XG4gICAgICAgICAgICBicmlnaHRuZXNzID0ga2VlcFdpdGhpbigxMDAgLSBNYXRoLmZsb29yKGdyaWRQb3MueSAqICgxMDAgLyBncmlkLmhlaWdodCgpKSksIDAsIDEwMCk7XG4gICAgICAgICAgICBoZXggPSBoc2IyaGV4KHtcbiAgICAgICAgICAgICAgaDogaHVlLFxuICAgICAgICAgICAgICBzOiBzYXR1cmF0aW9uLFxuICAgICAgICAgICAgICBiOiBicmlnaHRuZXNzXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gVXBkYXRlIFVJXG4gICAgICAgICAgICBzbGlkZXIuY3NzKCdiYWNrZ3JvdW5kQ29sb3InLCBoc2IyaGV4KHsgaDogaHVlLCBzOiAxMDAsIGI6IGJyaWdodG5lc3MgfSkpO1xuICAgICAgICAgICAgbWluaWNvbG9ycy5maW5kKCcubWluaWNvbG9ycy1ncmlkLWlubmVyJykuY3NzKCdvcGFjaXR5Jywgc2F0dXJhdGlvbiAvIDEwMCk7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGNhc2UgJ2JyaWdodG5lc3MnOlxuICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIGh1ZSwgc2F0dXJhdGlvbiwgYW5kIGJyaWdodG5lc3NcbiAgICAgICAgICAgIGh1ZSA9IGtlZXBXaXRoaW4ocGFyc2VJbnQoZ3JpZFBvcy54ICogKDM2MCAvIGdyaWQud2lkdGgoKSksIDEwKSwgMCwgMzYwKTtcbiAgICAgICAgICAgIHNhdHVyYXRpb24gPSBrZWVwV2l0aGluKDEwMCAtIE1hdGguZmxvb3IoZ3JpZFBvcy55ICogKDEwMCAvIGdyaWQuaGVpZ2h0KCkpKSwgMCwgMTAwKTtcbiAgICAgICAgICAgIGJyaWdodG5lc3MgPSBrZWVwV2l0aGluKDEwMCAtIE1hdGguZmxvb3Ioc2xpZGVyUG9zLnkgKiAoMTAwIC8gc2xpZGVyLmhlaWdodCgpKSksIDAsIDEwMCk7XG4gICAgICAgICAgICBoZXggPSBoc2IyaGV4KHtcbiAgICAgICAgICAgICAgaDogaHVlLFxuICAgICAgICAgICAgICBzOiBzYXR1cmF0aW9uLFxuICAgICAgICAgICAgICBiOiBicmlnaHRuZXNzXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gVXBkYXRlIFVJXG4gICAgICAgICAgICBzbGlkZXIuY3NzKCdiYWNrZ3JvdW5kQ29sb3InLCBoc2IyaGV4KHsgaDogaHVlLCBzOiBzYXR1cmF0aW9uLCBiOiAxMDAgfSkpO1xuICAgICAgICAgICAgbWluaWNvbG9ycy5maW5kKCcubWluaWNvbG9ycy1ncmlkLWlubmVyJykuY3NzKCdvcGFjaXR5JywgMSAtIChicmlnaHRuZXNzIC8gMTAwKSk7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAvLyBDYWxjdWxhdGUgaHVlLCBzYXR1cmF0aW9uLCBhbmQgYnJpZ2h0bmVzc1xuICAgICAgICAgICAgaHVlID0ga2VlcFdpdGhpbigzNjAgLSBwYXJzZUludChzbGlkZXJQb3MueSAqICgzNjAgLyBzbGlkZXIuaGVpZ2h0KCkpLCAxMCksIDAsIDM2MCk7XG4gICAgICAgICAgICBzYXR1cmF0aW9uID0ga2VlcFdpdGhpbihNYXRoLmZsb29yKGdyaWRQb3MueCAqICgxMDAgLyBncmlkLndpZHRoKCkpKSwgMCwgMTAwKTtcbiAgICAgICAgICAgIGJyaWdodG5lc3MgPSBrZWVwV2l0aGluKDEwMCAtIE1hdGguZmxvb3IoZ3JpZFBvcy55ICogKDEwMCAvIGdyaWQuaGVpZ2h0KCkpKSwgMCwgMTAwKTtcbiAgICAgICAgICAgIGhleCA9IGhzYjJoZXgoe1xuICAgICAgICAgICAgICBoOiBodWUsXG4gICAgICAgICAgICAgIHM6IHNhdHVyYXRpb24sXG4gICAgICAgICAgICAgIGI6IGJyaWdodG5lc3NcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBVcGRhdGUgVUlcbiAgICAgICAgICAgIGdyaWQuY3NzKCdiYWNrZ3JvdW5kQ29sb3InLCBoc2IyaGV4KHsgaDogaHVlLCBzOiAxMDAsIGI6IDEwMCB9KSk7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICB9XG5cbiAgICAgICAgLy8gSGFuZGxlIG9wYWNpdHlcbiAgICAgICAgaWYoIHNldHRpbmdzLm9wYWNpdHkgKSB7XG4gICAgICAgICAgb3BhY2l0eSA9IHBhcnNlRmxvYXQoMSAtIChvcGFjaXR5UG9zLnkgLyBvcGFjaXR5U2xpZGVyLmhlaWdodCgpKSkudG9GaXhlZCgyKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBvcGFjaXR5ID0gMTtcbiAgICAgICAgfVxuXG4gICAgICAgIHVwZGF0ZUlucHV0KGlucHV0LCBoZXgsIG9wYWNpdHkpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIC8vIFNldCBzd2F0Y2ggY29sb3JcbiAgICAgICAgc3dhdGNoLmZpbmQoJ3NwYW4nKS5jc3Moe1xuICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogaGV4LFxuICAgICAgICAgIG9wYWNpdHk6IG9wYWNpdHlcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gSGFuZGxlIGNoYW5nZSBldmVudFxuICAgICAgICBkb0NoYW5nZShpbnB1dCwgaGV4LCBvcGFjaXR5KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBTZXRzIHRoZSB2YWx1ZSBvZiB0aGUgaW5wdXQgYW5kIGRvZXMgdGhlIGFwcHJvcHJpYXRlIGNvbnZlcnNpb25zXG4gICAgLy8gdG8gcmVzcGVjdCBzZXR0aW5ncywgYWxzbyB1cGRhdGVzIHRoZSBzd2F0Y2hcbiAgICBmdW5jdGlvbiB1cGRhdGVJbnB1dChpbnB1dCwgdmFsdWUsIG9wYWNpdHkpIHtcbiAgICAgIHZhciByZ2IsXG5cbiAgICAgIC8vIEhlbHBmdWwgcmVmZXJlbmNlc1xuICAgICAgICBtaW5pY29sb3JzID0gaW5wdXQucGFyZW50KCksXG4gICAgICAgIHNldHRpbmdzID0gaW5wdXQuZGF0YSgnbWluaWNvbG9ycy1zZXR0aW5ncycpLFxuICAgICAgICBzd2F0Y2ggPSBtaW5pY29sb3JzLmZpbmQoJy5taW5pY29sb3JzLWlucHV0LXN3YXRjaCcpO1xuXG4gICAgICBpZiggc2V0dGluZ3Mub3BhY2l0eSApIGlucHV0LmF0dHIoJ2RhdGEtb3BhY2l0eScsIG9wYWNpdHkpO1xuXG4gICAgICAvLyBTZXQgY29sb3Igc3RyaW5nXG4gICAgICBpZiggc2V0dGluZ3MuZm9ybWF0ID09PSAncmdiJyApIHtcbiAgICAgICAgLy8gUmV0dXJucyBSR0IoQSkgc3RyaW5nXG5cbiAgICAgICAgLy8gQ2hlY2tzIGZvciBpbnB1dCBmb3JtYXQgYW5kIGRvZXMgdGhlIGNvbnZlcnNpb25cbiAgICAgICAgaWYgKCBpc1JnYih2YWx1ZSkgKSB7XG4gICAgICAgICAgcmdiID0gcGFyc2VSZ2IodmFsdWUsIHRydWUpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIHJnYiA9IGhleDJyZ2IocGFyc2VIZXgodmFsdWUsIHRydWUpKTtcbiAgICAgICAgfVxuXG5cbiAgICAgICAgb3BhY2l0eSA9IGlucHV0LmF0dHIoJ2RhdGEtb3BhY2l0eScpID09PSAnJyA/IDEgOiBrZWVwV2l0aGluKCBwYXJzZUZsb2F0KCBpbnB1dC5hdHRyKCdkYXRhLW9wYWNpdHknKSApLnRvRml4ZWQoMiksIDAsIDEgKTtcbiAgICAgICAgaWYoIGlzTmFOKCBvcGFjaXR5ICkgfHwgIXNldHRpbmdzLm9wYWNpdHkgKSBvcGFjaXR5ID0gMTtcblxuICAgICAgICBpZiggaW5wdXQubWluaWNvbG9ycygncmdiT2JqZWN0JykuYSA8PSAxICYmIHJnYiAmJiBzZXR0aW5ncy5vcGFjaXR5KSB7XG4gICAgICAgICAgLy8gU2V0IFJHQkEgc3RyaW5nIGlmIGFscGhhXG4gICAgICAgICAgdmFsdWUgPSAncmdiYSgnICsgcmdiLnIgKyAnLCAnICsgcmdiLmcgKyAnLCAnICsgcmdiLmIgKyAnLCAnICsgcGFyc2VGbG9hdCggb3BhY2l0eSApICsgJyknO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIFNldCBSR0Igc3RyaW5nIChhbHBoYSA9IDEpXG4gICAgICAgICAgdmFsdWUgPSAncmdiKCcgKyByZ2IuciArICcsICcgKyByZ2IuZyArICcsICcgKyByZ2IuYiArICcpJztcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gUmV0dXJucyBoZXggY29sb3JcblxuICAgICAgICAvLyBDaGVja3MgZm9yIGlucHV0IGZvcm1hdCBhbmQgZG9lcyB0aGUgY29udmVyc2lvblxuICAgICAgICBpZiAoIGlzUmdiKHZhbHVlKSApIHtcbiAgICAgICAgICB2YWx1ZSA9IHJnYlN0cmluZzJoZXgodmFsdWUpO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFsdWUgPSBjb252ZXJ0Q2FzZSggdmFsdWUsIHNldHRpbmdzLmxldHRlckNhc2UgKTtcbiAgICAgIH1cblxuXG5cblxuICAgICAgLy8gVXBkYXRlIHZhbHVlIGZyb20gcGlja2VyXG4gICAgICAvL2dsb2JhbElucHV0LnZhbCggdmFsdWUgKTtcbiAgICAgIGlucHV0LnZhbCggdmFsdWUgKTtcblxuICAgICAgaWYoaW5wdXRUZXh0KXtcbiAgICAgICAgaW5wdXRUZXh0LnZhbCh2YWx1ZSk7XG4gICAgICB9XG5cblxuICAgICAgLy8gU2V0IHN3YXRjaCBjb2xvclxuICAgICAgc3dhdGNoLmZpbmQoJ3NwYW4nKS5jc3Moe1xuICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IHZhbHVlLFxuICAgICAgICBvcGFjaXR5OiBvcGFjaXR5XG4gICAgICB9KTtcblxuICAgICAgLy8gSGFuZGxlIGNoYW5nZSBldmVudFxuICAgICAgZG9DaGFuZ2UoaW5wdXQsIHZhbHVlLCBvcGFjaXR5KTtcbiAgICB9XG5cbiAgICAvLyBTZXRzIHRoZSBjb2xvciBwaWNrZXIgdmFsdWVzIGZyb20gdGhlIGlucHV0XG4gICAgZnVuY3Rpb24gdXBkYXRlRnJvbUlucHV0KGlucHV0LCBwcmVzZXJ2ZUlucHV0VmFsdWUpIHtcbiAgICAgdmFyICBzZXR0aW5ncyA9IGdsb2JhbFNldHRpbmdzO1xuICAgICAgdmFyIGhleCxcbiAgICAgICAgaHNiLFxuICAgICAgICBvcGFjaXR5LFxuICAgICAgICBrZXl3b3JkcyxcbiAgICAgICAgYWxwaGEsXG4gICAgICAgIHZhbHVlLFxuICAgICAgICB4LCB5LCByLCBwaGksXG5cbiAgICAgIC8vIEhlbHBmdWwgcmVmZXJlbmNlc1xuICAgICAgICBtaW5pY29sb3JzID0gaW5wdXQucGFyZW50KCksXG4gICAgICAvLyAgc2V0dGluZ3MgPSBpbnB1dC5kYXRhKCdtaW5pY29sb3JzLXNldHRpbmdzJyksXG4gICAgICAgIHN3YXRjaCA9IG1pbmljb2xvcnMuZmluZCgnLm1pbmljb2xvcnMtaW5wdXQtc3dhdGNoJyksXG5cbiAgICAgIC8vIFBhbmVsIG9iamVjdHNcbiAgICAgICAgZ3JpZCA9IG1pbmljb2xvcnMuZmluZCgnLm1pbmljb2xvcnMtZ3JpZCcpLFxuICAgICAgICBzbGlkZXIgPSBtaW5pY29sb3JzLmZpbmQoJy5taW5pY29sb3JzLXNsaWRlcicpLFxuICAgICAgICBvcGFjaXR5U2xpZGVyID0gbWluaWNvbG9ycy5maW5kKCcubWluaWNvbG9ycy1vcGFjaXR5LXNsaWRlcicpLFxuXG4gICAgICAvLyBQaWNrZXIgb2JqZWN0c1xuICAgICAgICBncmlkUGlja2VyID0gZ3JpZC5maW5kKCdbY2xhc3MkPS1waWNrZXJdJyksXG4gICAgICAgIHNsaWRlclBpY2tlciA9IHNsaWRlci5maW5kKCdbY2xhc3MkPS1waWNrZXJdJyksXG4gICAgICAgIG9wYWNpdHlQaWNrZXIgPSBvcGFjaXR5U2xpZGVyLmZpbmQoJ1tjbGFzcyQ9LXBpY2tlcl0nKTtcblxuICAgICAgLy8gRGV0ZXJtaW5lIGhleC9IU0IgdmFsdWVzXG4gICAgICBpZiggaXNSZ2IoaW5wdXQudmFsKCkpICkge1xuICAgICAgICAvLyBJZiBpbnB1dCB2YWx1ZSBpcyBhIHJnYihhKSBzdHJpbmcsIGNvbnZlcnQgaXQgdG8gaGV4IGNvbG9yIGFuZCB1cGRhdGUgb3BhY2l0eVxuICAgICAgICBoZXggPSByZ2JTdHJpbmcyaGV4KGlucHV0LnZhbCgpKTtcbiAgICAgICAgYWxwaGEgPSBrZWVwV2l0aGluKHBhcnNlRmxvYXQoZ2V0QWxwaGEoaW5wdXQudmFsKCkpKS50b0ZpeGVkKDIpLCAwLCAxKTtcbiAgICAgICAgaWYoIGFscGhhICkge1xuICAgICAgICAgIGlucHV0LmF0dHIoJ2RhdGEtb3BhY2l0eScsIGFscGhhKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaGV4ID0gY29udmVydENhc2UocGFyc2VIZXgoaW5wdXQudmFsKCksIHRydWUpLCBzZXR0aW5ncy5sZXR0ZXJDYXNlKTtcbiAgICAgIH1cblxuICAgICAgaWYoICFoZXggKXtcbiAgICAgICAgaGV4ID0gY29udmVydENhc2UocGFyc2VJbnB1dChzZXR0aW5ncy5kZWZhdWx0VmFsdWUsIHRydWUpLCBzZXR0aW5ncy5sZXR0ZXJDYXNlKTtcbiAgICAgIH1cbiAgICAgIGhzYiA9IGhleDJoc2IoaGV4KTtcblxuICAgICAgLy8gR2V0IGFycmF5IG9mIGxvd2VyY2FzZSBrZXl3b3Jkc1xuICAgICAga2V5d29yZHMgPSAhc2V0dGluZ3Mua2V5d29yZHMgPyBbXSA6ICQubWFwKHNldHRpbmdzLmtleXdvcmRzLnNwbGl0KCcsJyksIGZ1bmN0aW9uKGEpIHtcbiAgICAgICAgcmV0dXJuICQudHJpbShhLnRvTG93ZXJDYXNlKCkpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIFNldCBjb2xvciBzdHJpbmdcbiAgICAgIGlmKCBpbnB1dC52YWwoKSAhPT0gJycgJiYgJC5pbkFycmF5KGlucHV0LnZhbCgpLnRvTG93ZXJDYXNlKCksIGtleXdvcmRzKSA+IC0xICkge1xuICAgICAgICB2YWx1ZSA9IGNvbnZlcnRDYXNlKGlucHV0LnZhbCgpKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhbHVlID0gaXNSZ2IoaW5wdXQudmFsKCkpID8gcGFyc2VSZ2IoaW5wdXQudmFsKCkpIDogaGV4O1xuICAgICAgfVxuXG4gICAgICAvLyBVcGRhdGUgaW5wdXQgdmFsdWVcbiAgICAgIGlmKCAhcHJlc2VydmVJbnB1dFZhbHVlICl7XG4gICAgICAgIGdsb2JhbElucHV0LnZhbCh2YWx1ZSk7XG5cbiAgICAgICAgaW5wdXRUZXh0ICYmIGlucHV0VGV4dC52YWwodmFsdWUpO1xuICAgICAgfVxuICAgICAgZ2xvYmFsU2V0dGluZ3MgPSBzZXR0aW5nc1xuICAgICAgLy8gRGV0ZXJtaW5lIG9wYWNpdHkgdmFsdWVcbiAgICAgIGlmKCBzZXR0aW5ncy5vcGFjaXR5ICkge1xuICAgICAgICAvLyBHZXQgZnJvbSBkYXRhLW9wYWNpdHkgYXR0cmlidXRlIGFuZCBrZWVwIHdpdGhpbiAwLTEgcmFuZ2VcbiAgICAgICAgb3BhY2l0eSA9IGlucHV0LmF0dHIoJ2RhdGEtb3BhY2l0eScpID09PSAnJyA/IDEgOiBrZWVwV2l0aGluKHBhcnNlRmxvYXQoaW5wdXQuYXR0cignZGF0YS1vcGFjaXR5JykpLnRvRml4ZWQoMiksIDAsIDEpO1xuICAgICAgICBpZiggaXNOYU4ob3BhY2l0eSkgKSBvcGFjaXR5ID0gMTtcbiAgICAgICAgaW5wdXQuYXR0cignZGF0YS1vcGFjaXR5Jywgb3BhY2l0eSk7XG4gICAgICAgIHN3YXRjaC5maW5kKCdzcGFuJykuY3NzKCdvcGFjaXR5Jywgb3BhY2l0eSk7XG5cbiAgICAgICAgLy8gU2V0IG9wYWNpdHkgcGlja2VyIHBvc2l0aW9uXG4gICAgICAgIHkgPSBrZWVwV2l0aGluKG9wYWNpdHlTbGlkZXIuaGVpZ2h0KCkgLSAob3BhY2l0eVNsaWRlci5oZWlnaHQoKSAqIG9wYWNpdHkpLCAwLCBvcGFjaXR5U2xpZGVyLmhlaWdodCgpKTtcbiAgICAgICAgb3BhY2l0eVBpY2tlci5jc3MoJ3RvcCcsIHkgKyAncHgnKTtcbiAgICAgIH1cblxuICAgICAgLy8gU2V0IG9wYWNpdHkgdG8gemVybyBpZiBpbnB1dCB2YWx1ZSBpcyB0cmFuc3BhcmVudFxuICAgICAgaWYoIGlucHV0LnZhbCgpLnRvTG93ZXJDYXNlKCkgPT09ICd0cmFuc3BhcmVudCcgKSB7XG4gICAgICAgIHN3YXRjaC5maW5kKCdzcGFuJykuY3NzKCdvcGFjaXR5JywgMCk7XG4gICAgICB9XG5cbiAgICAgIC8vIFVwZGF0ZSBzd2F0Y2hcbiAgICAgIHN3YXRjaC5maW5kKCdzcGFuJykuY3NzKCdiYWNrZ3JvdW5kQ29sb3InLCBoZXgpO1xuXG4gICAgICAvLyBEZXRlcm1pbmUgcGlja2VyIGxvY2F0aW9uc1xuICAgICAgc3dpdGNoKHNldHRpbmdzLmNvbnRyb2wpIHtcblxuICAgICAgICBjYXNlICd3aGVlbCc6XG4gICAgICAgICAgLy8gU2V0IGdyaWQgcG9zaXRpb25cbiAgICAgICAgICByID0ga2VlcFdpdGhpbihNYXRoLmNlaWwoaHNiLnMgKiAwLjc1KSwgMCwgZ3JpZC5oZWlnaHQoKSAvIDIpO1xuICAgICAgICAgIHBoaSA9IGhzYi5oICogTWF0aC5QSSAvIDE4MDtcbiAgICAgICAgICB4ID0ga2VlcFdpdGhpbig3NSAtIE1hdGguY29zKHBoaSkgKiByLCAwLCBncmlkLndpZHRoKCkpO1xuICAgICAgICAgIHkgPSBrZWVwV2l0aGluKDc1IC0gTWF0aC5zaW4ocGhpKSAqIHIsIDAsIGdyaWQuaGVpZ2h0KCkpO1xuICAgICAgICAgIGdyaWRQaWNrZXIuY3NzKHtcbiAgICAgICAgICAgIHRvcDogeSArICdweCcsXG4gICAgICAgICAgICBsZWZ0OiB4ICsgJ3B4J1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgLy8gU2V0IHNsaWRlciBwb3NpdGlvblxuICAgICAgICAgIHkgPSAxNTAgLSAoaHNiLmIgLyAoMTAwIC8gZ3JpZC5oZWlnaHQoKSkpO1xuICAgICAgICAgIGlmKCBoZXggPT09ICcnICkgeSA9IDA7XG4gICAgICAgICAgc2xpZGVyUGlja2VyLmNzcygndG9wJywgeSArICdweCcpO1xuXG4gICAgICAgICAgLy8gVXBkYXRlIHBhbmVsIGNvbG9yXG4gICAgICAgICAgc2xpZGVyLmNzcygnYmFja2dyb3VuZENvbG9yJywgaHNiMmhleCh7IGg6IGhzYi5oLCBzOiBoc2IucywgYjogMTAwIH0pKTtcbiAgICAgICAgICBicmVhaztcblxuICAgICAgICBjYXNlICdzYXR1cmF0aW9uJzpcbiAgICAgICAgICAvLyBTZXQgZ3JpZCBwb3NpdGlvblxuICAgICAgICAgIHggPSBrZWVwV2l0aGluKCg1ICogaHNiLmgpIC8gMTIsIDAsIDE1MCk7XG4gICAgICAgICAgeSA9IGtlZXBXaXRoaW4oZ3JpZC5oZWlnaHQoKSAtIE1hdGguY2VpbChoc2IuYiAvICgxMDAgLyBncmlkLmhlaWdodCgpKSksIDAsIGdyaWQuaGVpZ2h0KCkpO1xuICAgICAgICAgIGdyaWRQaWNrZXIuY3NzKHtcbiAgICAgICAgICAgIHRvcDogeSArICdweCcsXG4gICAgICAgICAgICBsZWZ0OiB4ICsgJ3B4J1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgLy8gU2V0IHNsaWRlciBwb3NpdGlvblxuICAgICAgICAgIHkgPSBrZWVwV2l0aGluKHNsaWRlci5oZWlnaHQoKSAtIChoc2IucyAqIChzbGlkZXIuaGVpZ2h0KCkgLyAxMDApKSwgMCwgc2xpZGVyLmhlaWdodCgpKTtcbiAgICAgICAgICBzbGlkZXJQaWNrZXIuY3NzKCd0b3AnLCB5ICsgJ3B4Jyk7XG5cbiAgICAgICAgICAvLyBVcGRhdGUgVUlcbiAgICAgICAgICBzbGlkZXIuY3NzKCdiYWNrZ3JvdW5kQ29sb3InLCBoc2IyaGV4KHsgaDogaHNiLmgsIHM6IDEwMCwgYjogaHNiLmIgfSkpO1xuICAgICAgICAgIG1pbmljb2xvcnMuZmluZCgnLm1pbmljb2xvcnMtZ3JpZC1pbm5lcicpLmNzcygnb3BhY2l0eScsIGhzYi5zIC8gMTAwKTtcbiAgICAgICAgICBicmVhaztcblxuICAgICAgICBjYXNlICdicmlnaHRuZXNzJzpcbiAgICAgICAgICAvLyBTZXQgZ3JpZCBwb3NpdGlvblxuICAgICAgICAgIHggPSBrZWVwV2l0aGluKCg1ICogaHNiLmgpIC8gMTIsIDAsIDE1MCk7XG4gICAgICAgICAgeSA9IGtlZXBXaXRoaW4oZ3JpZC5oZWlnaHQoKSAtIE1hdGguY2VpbChoc2IucyAvICgxMDAgLyBncmlkLmhlaWdodCgpKSksIDAsIGdyaWQuaGVpZ2h0KCkpO1xuICAgICAgICAgIGdyaWRQaWNrZXIuY3NzKHtcbiAgICAgICAgICAgIHRvcDogeSArICdweCcsXG4gICAgICAgICAgICBsZWZ0OiB4ICsgJ3B4J1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgLy8gU2V0IHNsaWRlciBwb3NpdGlvblxuICAgICAgICAgIHkgPSBrZWVwV2l0aGluKHNsaWRlci5oZWlnaHQoKSAtIChoc2IuYiAqIChzbGlkZXIuaGVpZ2h0KCkgLyAxMDApKSwgMCwgc2xpZGVyLmhlaWdodCgpKTtcbiAgICAgICAgICBzbGlkZXJQaWNrZXIuY3NzKCd0b3AnLCB5ICsgJ3B4Jyk7XG5cbiAgICAgICAgICAvLyBVcGRhdGUgVUlcbiAgICAgICAgICBzbGlkZXIuY3NzKCdiYWNrZ3JvdW5kQ29sb3InLCBoc2IyaGV4KHsgaDogaHNiLmgsIHM6IGhzYi5zLCBiOiAxMDAgfSkpO1xuICAgICAgICAgIG1pbmljb2xvcnMuZmluZCgnLm1pbmljb2xvcnMtZ3JpZC1pbm5lcicpLmNzcygnb3BhY2l0eScsIDEgLSAoaHNiLmIgLyAxMDApKTtcbiAgICAgICAgICBicmVhaztcblxuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgIC8vIFNldCBncmlkIHBvc2l0aW9uXG4gICAgICAgICAgeCA9IGtlZXBXaXRoaW4oTWF0aC5jZWlsKGhzYi5zIC8gKDEwMCAvIGdyaWQud2lkdGgoKSkpLCAwLCBncmlkLndpZHRoKCkpO1xuICAgICAgICAgIHkgPSBrZWVwV2l0aGluKGdyaWQuaGVpZ2h0KCkgLSBNYXRoLmNlaWwoaHNiLmIgLyAoMTAwIC8gZ3JpZC5oZWlnaHQoKSkpLCAwLCBncmlkLmhlaWdodCgpKTtcbiAgICAgICAgICBncmlkUGlja2VyLmNzcyh7XG4gICAgICAgICAgICB0b3A6IHkgKyAncHgnLFxuICAgICAgICAgICAgbGVmdDogeCArICdweCdcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIC8vIFNldCBzbGlkZXIgcG9zaXRpb25cbiAgICAgICAgICB5ID0ga2VlcFdpdGhpbihzbGlkZXIuaGVpZ2h0KCkgLSAoaHNiLmggLyAoMzYwIC8gc2xpZGVyLmhlaWdodCgpKSksIDAsIHNsaWRlci5oZWlnaHQoKSk7XG4gICAgICAgICAgc2xpZGVyUGlja2VyLmNzcygndG9wJywgeSArICdweCcpO1xuXG4gICAgICAgICAgLy8gVXBkYXRlIHBhbmVsIGNvbG9yXG4gICAgICAgICAgZ3JpZC5jc3MoJ2JhY2tncm91bmRDb2xvcicsIGhzYjJoZXgoeyBoOiBoc2IuaCwgczogMTAwLCBiOiAxMDAgfSkpO1xuICAgICAgICAgIGJyZWFrO1xuXG4gICAgICB9XG5cbiAgICAgIC8vIEZpcmUgY2hhbmdlIGV2ZW50LCBidXQgb25seSBpZiBtaW5pY29sb3JzIGlzIGZ1bGx5IGluaXRpYWxpemVkXG4gICAgICBpZiggaW5wdXQuZGF0YSgnbWluaWNvbG9ycy1pbml0aWFsaXplZCcpICkge1xuICAgICAgICBkb0NoYW5nZShpbnB1dCwgdmFsdWUsIG9wYWNpdHkpO1xuICAgICAgfVxuXG4gICAgfVxuXG4gICAgLy8gUnVucyB0aGUgY2hhbmdlIGFuZCBjaGFuZ2VEZWxheSBjYWxsYmFja3NcbiAgICBmdW5jdGlvbiBkb0NoYW5nZShpbnB1dCwgdmFsdWUsIG9wYWNpdHkpIHtcblxuICAgICAgdmFyIHNldHRpbmdzID0gaW5wdXQuZGF0YSgnbWluaWNvbG9ycy1zZXR0aW5ncycpLFxuICAgICAgICBsYXN0Q2hhbmdlID0gaW5wdXQuZGF0YSgnbWluaWNvbG9ycy1sYXN0Q2hhbmdlJyksXG4gICAgICAgIG9iaixcbiAgICAgICAgc2VsLFxuICAgICAgICBpO1xuXG4gICAgICAvLyBPbmx5IHJ1biBpZiBpdCBhY3R1YWxseSBjaGFuZ2VkXG4gICAgICBpZiggIWxhc3RDaGFuZ2UgfHwgbGFzdENoYW5nZS52YWx1ZSAhPT0gdmFsdWUgfHwgbGFzdENoYW5nZS5vcGFjaXR5ICE9PSBvcGFjaXR5ICkge1xuXG4gICAgICAgIC8vIFJlbWVtYmVyIGxhc3QtY2hhbmdlZCB2YWx1ZVxuICAgICAgICBpbnB1dC5kYXRhKCdtaW5pY29sb3JzLWxhc3RDaGFuZ2UnLCB7XG4gICAgICAgICAgdmFsdWU6IHZhbHVlLFxuICAgICAgICAgIG9wYWNpdHk6IG9wYWNpdHlcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gQ2hlY2sgYW5kIHNlbGVjdCBhcHBsaWNhYmxlIHN3YXRjaFxuICAgICAgICBpZiAoc2V0dGluZ3Muc3dhdGNoZXMgJiYgc2V0dGluZ3Muc3dhdGNoZXMubGVuZ3RoICE9PSAwKSB7XG4gICAgICAgICAgaWYoIWlzUmdiKHZhbHVlKSkge1xuICAgICAgICAgICAgb2JqID0gaGV4MnJnYih2YWx1ZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgb2JqID0gcGFyc2VSZ2IodmFsdWUsIHRydWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBzZWwgPSAtMTtcbiAgICAgICAgICBmb3IoaSA9IDA7IGkgPCBzZXR0aW5ncy5zd2F0Y2hlcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgaWYgKG9iai5yID09PSBzZXR0aW5ncy5zd2F0Y2hlc1tpXS5yICYmIG9iai5nID09PSBzZXR0aW5ncy5zd2F0Y2hlc1tpXS5nICYmIG9iai5iID09PSBzZXR0aW5ncy5zd2F0Y2hlc1tpXS5iICYmIG9iai5hID09PSBzZXR0aW5ncy5zd2F0Y2hlc1tpXS5hKSB7XG4gICAgICAgICAgICAgIHNlbCA9IGk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuICAgICAgICAgIGlucHV0LnBhcmVudCgpLmZpbmQoJy5taW5pY29sb3JzLXN3YXRjaGVzIC5taW5pY29sb3JzLXN3YXRjaCcpLnJlbW92ZUNsYXNzKCdzZWxlY3RlZCcpO1xuICAgICAgICAgIGlmIChpICE9PSAtMSkge1xuICAgICAgICAgICAgaW5wdXQucGFyZW50KCkuZmluZCgnLm1pbmljb2xvcnMtc3dhdGNoZXMgLm1pbmljb2xvcnMtc3dhdGNoJykuZXEoaSkuYWRkQ2xhc3MoJ3NlbGVjdGVkJyk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gRmlyZSBjaGFuZ2UgZXZlbnRcbiAgICAgICAgaWYoIHNldHRpbmdzLmNoYW5nZSApIHtcbiAgICAgICAgICBpZiggc2V0dGluZ3MuY2hhbmdlRGVsYXkgKSB7XG4gICAgICAgICAgICAvLyBDYWxsIGFmdGVyIGEgZGVsYXlcbiAgICAgICAgICAgIGNsZWFyVGltZW91dChpbnB1dC5kYXRhKCdtaW5pY29sb3JzLWNoYW5nZVRpbWVvdXQnKSk7XG4gICAgICAgICAgICBpbnB1dC5kYXRhKCdtaW5pY29sb3JzLWNoYW5nZVRpbWVvdXQnLCBzZXRUaW1lb3V0KCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgc2V0dGluZ3MuY2hhbmdlLmNhbGwoaW5wdXQuZ2V0KDApLCB2YWx1ZSwgb3BhY2l0eSk7XG4gICAgICAgICAgICB9LCBzZXR0aW5ncy5jaGFuZ2VEZWxheSkpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBDYWxsIGltbWVkaWF0ZWx5XG4gICAgICAgICAgICBzZXR0aW5ncy5jaGFuZ2UuY2FsbChpbnB1dC5nZXQoMCksIHZhbHVlLCBvcGFjaXR5KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaW5wdXQudHJpZ2dlcignY2hhbmdlJykudHJpZ2dlcignaW5wdXQnKTtcbiAgICAgIH1cblxuICAgIH1cblxuICAgIC8vIEdlbmVyYXRlcyBhbiBSR0IoQSkgb2JqZWN0IGJhc2VkIG9uIHRoZSBpbnB1dCdzIHZhbHVlXG4gICAgZnVuY3Rpb24gcmdiT2JqZWN0KGlucHV0KSB7XG4gICAgICB2YXIgaGV4ID0gcGFyc2VIZXgoJChpbnB1dCkudmFsKCksIHRydWUpLFxuICAgICAgICByZ2IgPSBoZXgycmdiKGhleCksXG4gICAgICAgIG9wYWNpdHkgPSAkKGlucHV0KS5hdHRyKCdkYXRhLW9wYWNpdHknKTtcbiAgICAgIGlmKCAhcmdiICkgcmV0dXJuIG51bGw7XG4gICAgICBpZiggb3BhY2l0eSAhPT0gdW5kZWZpbmVkICkgJC5leHRlbmQocmdiLCB7IGE6IHBhcnNlRmxvYXQob3BhY2l0eSkgfSk7XG4gICAgICByZXR1cm4gcmdiO1xuICAgIH1cblxuICAgIC8vIEdlbmVyYXRlcyBhbiBSR0IoQSkgc3RyaW5nIGJhc2VkIG9uIHRoZSBpbnB1dCdzIHZhbHVlXG4gICAgZnVuY3Rpb24gcmdiU3RyaW5nKGlucHV0LCBhbHBoYSkge1xuICAgICAgdmFyIGhleCA9IHBhcnNlSGV4KCQoaW5wdXQpLnZhbCgpLCB0cnVlKSxcbiAgICAgICAgcmdiID0gaGV4MnJnYihoZXgpLFxuICAgICAgICBvcGFjaXR5ID0gJChpbnB1dCkuYXR0cignZGF0YS1vcGFjaXR5Jyk7XG4gICAgICBpZiggIXJnYiApIHJldHVybiBudWxsO1xuICAgICAgaWYoIG9wYWNpdHkgPT09IHVuZGVmaW5lZCApIG9wYWNpdHkgPSAxO1xuICAgICAgaWYoIGFscGhhICkge1xuICAgICAgICByZXR1cm4gJ3JnYmEoJyArIHJnYi5yICsgJywgJyArIHJnYi5nICsgJywgJyArIHJnYi5iICsgJywgJyArIHBhcnNlRmxvYXQob3BhY2l0eSkgKyAnKSc7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gJ3JnYignICsgcmdiLnIgKyAnLCAnICsgcmdiLmcgKyAnLCAnICsgcmdiLmIgKyAnKSc7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQ29udmVydHMgdG8gdGhlIGxldHRlciBjYXNlIHNwZWNpZmllZCBpbiBzZXR0aW5nc1xuICAgIGZ1bmN0aW9uIGNvbnZlcnRDYXNlKHN0cmluZywgbGV0dGVyQ2FzZSkge1xuICAgICAgcmV0dXJuIGxldHRlckNhc2UgPT09ICd1cHBlcmNhc2UnID8gc3RyaW5nLnRvVXBwZXJDYXNlKCkgOiBzdHJpbmcudG9Mb3dlckNhc2UoKTtcbiAgICB9XG5cbiAgICAvLyBQYXJzZXMgYSBzdHJpbmcgYW5kIHJldHVybnMgYSB2YWxpZCBoZXggc3RyaW5nIHdoZW4gcG9zc2libGVcbiAgICBmdW5jdGlvbiBwYXJzZUhleChzdHJpbmcsIGV4cGFuZCkge1xuICAgICAgc3RyaW5nID0gc3RyaW5nLnJlcGxhY2UoL14jL2csICcnKTtcbiAgICAgIGlmKCAhc3RyaW5nLm1hdGNoKC9eW0EtRjAtOV17Myw2fS9pZykgKSByZXR1cm4gJyc7XG4gICAgICBpZiggc3RyaW5nLmxlbmd0aCAhPT0gMyAmJiBzdHJpbmcubGVuZ3RoICE9PSA2ICkgcmV0dXJuICcnO1xuICAgICAgaWYoIHN0cmluZy5sZW5ndGggPT09IDMgJiYgZXhwYW5kICkge1xuICAgICAgICBzdHJpbmcgPSBzdHJpbmdbMF0gKyBzdHJpbmdbMF0gKyBzdHJpbmdbMV0gKyBzdHJpbmdbMV0gKyBzdHJpbmdbMl0gKyBzdHJpbmdbMl07XG4gICAgICB9XG4gICAgICByZXR1cm4gJyMnICsgc3RyaW5nO1xuICAgIH1cblxuICAgIC8vIFBhcnNlcyBhIHN0cmluZyBhbmQgcmV0dXJucyBhIHZhbGlkIFJHQihBKSBzdHJpbmcgd2hlbiBwb3NzaWJsZVxuICAgIGZ1bmN0aW9uIHBhcnNlUmdiKHN0cmluZywgb2JqKSB7XG5cbiAgICAgIHZhciB2YWx1ZXMgPSBzdHJpbmcucmVwbGFjZSgvW15cXGQsLl0vZywgJycpLFxuICAgICAgICByZ2JhID0gdmFsdWVzLnNwbGl0KCcsJyk7XG5cbiAgICAgIHJnYmFbMF0gPSBrZWVwV2l0aGluKHBhcnNlSW50KHJnYmFbMF0sIDEwKSwgMCwgMjU1KTtcbiAgICAgIHJnYmFbMV0gPSBrZWVwV2l0aGluKHBhcnNlSW50KHJnYmFbMV0sIDEwKSwgMCwgMjU1KTtcbiAgICAgIHJnYmFbMl0gPSBrZWVwV2l0aGluKHBhcnNlSW50KHJnYmFbMl0sIDEwKSwgMCwgMjU1KTtcbiAgICAgIGlmKCByZ2JhWzNdICkge1xuICAgICAgICByZ2JhWzNdID0ga2VlcFdpdGhpbihwYXJzZUZsb2F0KHJnYmFbM10sIDEwKSwgMCwgMSk7XG4gICAgICB9XG5cbiAgICAgIC8vIFJldHVybiBSR0JBIG9iamVjdFxuICAgICAgaWYoIG9iaiApIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICByOiByZ2JhWzBdLFxuICAgICAgICAgIGc6IHJnYmFbMV0sXG4gICAgICAgICAgYjogcmdiYVsyXSxcbiAgICAgICAgICBhOiByZ2JhWzNdID8gcmdiYVszXSA6IG51bGxcbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgLy8gUmV0dXJuIFJHQkEgc3RyaW5nXG4gICAgICBpZiggdHlwZW9mKHJnYmFbM10pICE9PSAndW5kZWZpbmVkJyAmJiByZ2JhWzNdIDw9IDEgKSB7XG4gICAgICAgIHJldHVybiAncmdiYSgnICsgcmdiYVswXSArICcsICcgKyByZ2JhWzFdICsgJywgJyArIHJnYmFbMl0gKyAnLCAnICsgcmdiYVszXSArICcpJztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiAncmdiKCcgKyByZ2JhWzBdICsgJywgJyArIHJnYmFbMV0gKyAnLCAnICsgcmdiYVsyXSArICcpJztcbiAgICAgIH1cblxuICAgIH1cblxuICAgIC8vIFBhcnNlcyBhIHN0cmluZyBhbmQgcmV0dXJucyBhIHZhbGlkIGNvbG9yIHN0cmluZyB3aGVuIHBvc3NpYmxlXG4gICAgZnVuY3Rpb24gcGFyc2VJbnB1dChzdHJpbmcsIGV4cGFuZCkge1xuICAgICAgaWYoIGlzUmdiKHN0cmluZykgKSB7XG4gICAgICAgIC8vIFJldHVybnMgYSB2YWxpZCByZ2IoYSkgc3RyaW5nXG4gICAgICAgIHJldHVybiBwYXJzZVJnYihzdHJpbmcpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHBhcnNlSGV4KHN0cmluZywgZXhwYW5kKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBLZWVwcyB2YWx1ZSB3aXRoaW4gbWluIGFuZCBtYXhcbiAgICBmdW5jdGlvbiBrZWVwV2l0aGluKHZhbHVlLCBtaW4sIG1heCkge1xuICAgICAgaWYoIHZhbHVlIDwgbWluICkgdmFsdWUgPSBtaW47XG4gICAgICBpZiggdmFsdWUgPiBtYXggKSB2YWx1ZSA9IG1heDtcbiAgICAgIHJldHVybiB2YWx1ZTtcbiAgICB9XG5cbiAgICAvLyBDaGVja3MgaWYgYSBzdHJpbmcgaXMgYSB2YWxpZCBSR0IoQSkgc3RyaW5nXG4gICAgZnVuY3Rpb24gaXNSZ2Ioc3RyaW5nKSB7XG4gICAgICB2YXIgcmdiID0gc3RyaW5nLm1hdGNoKC9ecmdiYT9bXFxzK10/XFwoW1xccytdPyhcXGQrKVtcXHMrXT8sW1xccytdPyhcXGQrKVtcXHMrXT8sW1xccytdPyhcXGQrKVtcXHMrXT8vaSk7XG4gICAgICByZXR1cm4gKHJnYiAmJiByZ2IubGVuZ3RoID09PSA0KSA/IHRydWUgOiBmYWxzZTtcbiAgICB9XG5cbiAgICAvLyBGdW5jdGlvbiB0byBnZXQgYWxwaGEgZnJvbSBhIFJHQihBKSBzdHJpbmdcbiAgICBmdW5jdGlvbiBnZXRBbHBoYShyZ2JhKSB7XG4gICAgICByZ2JhID0gcmdiYS5tYXRjaCgvXnJnYmE/W1xccytdP1xcKFtcXHMrXT8oXFxkKylbXFxzK10/LFtcXHMrXT8oXFxkKylbXFxzK10/LFtcXHMrXT8oXFxkKylbXFxzK10/LFtcXHMrXT8oXFxkKyhcXC5cXGR7MSwyfSk/fFxcLlxcZHsxLDJ9KVtcXHMrXT8vaSk7XG4gICAgICByZXR1cm4gKHJnYmEgJiYgcmdiYS5sZW5ndGggPT09IDYpID8gcmdiYVs0XSA6ICcxJztcbiAgICB9XG5cbiAgICAvLyBDb252ZXJ0cyBhbiBIU0Igb2JqZWN0IHRvIGFuIFJHQiBvYmplY3RcbiAgICBmdW5jdGlvbiBoc2IycmdiKGhzYikge1xuICAgICAgdmFyIHJnYiA9IHt9O1xuICAgICAgdmFyIGggPSBNYXRoLnJvdW5kKGhzYi5oKTtcbiAgICAgIHZhciBzID0gTWF0aC5yb3VuZChoc2IucyAqIDI1NSAvIDEwMCk7XG4gICAgICB2YXIgdiA9IE1hdGgucm91bmQoaHNiLmIgKiAyNTUgLyAxMDApO1xuICAgICAgaWYocyA9PT0gMCkge1xuICAgICAgICByZ2IuciA9IHJnYi5nID0gcmdiLmIgPSB2O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIHQxID0gdjtcbiAgICAgICAgdmFyIHQyID0gKDI1NSAtIHMpICogdiAvIDI1NTtcbiAgICAgICAgdmFyIHQzID0gKHQxIC0gdDIpICogKGggJSA2MCkgLyA2MDtcbiAgICAgICAgaWYoIGggPT09IDM2MCApIGggPSAwO1xuICAgICAgICBpZiggaCA8IDYwICkgeyByZ2IuciA9IHQxOyByZ2IuYiA9IHQyOyByZ2IuZyA9IHQyICsgdDM7IH1cbiAgICAgICAgZWxzZSBpZiggaCA8IDEyMCApIHtyZ2IuZyA9IHQxOyByZ2IuYiA9IHQyOyByZ2IuciA9IHQxIC0gdDM7IH1cbiAgICAgICAgZWxzZSBpZiggaCA8IDE4MCApIHtyZ2IuZyA9IHQxOyByZ2IuciA9IHQyOyByZ2IuYiA9IHQyICsgdDM7IH1cbiAgICAgICAgZWxzZSBpZiggaCA8IDI0MCApIHtyZ2IuYiA9IHQxOyByZ2IuciA9IHQyOyByZ2IuZyA9IHQxIC0gdDM7IH1cbiAgICAgICAgZWxzZSBpZiggaCA8IDMwMCApIHtyZ2IuYiA9IHQxOyByZ2IuZyA9IHQyOyByZ2IuciA9IHQyICsgdDM7IH1cbiAgICAgICAgZWxzZSBpZiggaCA8IDM2MCApIHtyZ2IuciA9IHQxOyByZ2IuZyA9IHQyOyByZ2IuYiA9IHQxIC0gdDM7IH1cbiAgICAgICAgZWxzZSB7IHJnYi5yID0gMDsgcmdiLmcgPSAwOyByZ2IuYiA9IDA7IH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHI6IE1hdGgucm91bmQocmdiLnIpLFxuICAgICAgICBnOiBNYXRoLnJvdW5kKHJnYi5nKSxcbiAgICAgICAgYjogTWF0aC5yb3VuZChyZ2IuYilcbiAgICAgIH07XG4gICAgfVxuXG4gICAgLy8gQ29udmVydHMgYW4gUkdCIHN0cmluZyB0byBhIGhleCBzdHJpbmdcbiAgICBmdW5jdGlvbiByZ2JTdHJpbmcyaGV4KHJnYil7XG4gICAgICByZ2IgPSByZ2IubWF0Y2goL15yZ2JhP1tcXHMrXT9cXChbXFxzK10/KFxcZCspW1xccytdPyxbXFxzK10/KFxcZCspW1xccytdPyxbXFxzK10/KFxcZCspW1xccytdPy9pKTtcbiAgICAgIHJldHVybiAocmdiICYmIHJnYi5sZW5ndGggPT09IDQpID8gJyMnICtcbiAgICAgICgnMCcgKyBwYXJzZUludChyZ2JbMV0sMTApLnRvU3RyaW5nKDE2KSkuc2xpY2UoLTIpICtcbiAgICAgICgnMCcgKyBwYXJzZUludChyZ2JbMl0sMTApLnRvU3RyaW5nKDE2KSkuc2xpY2UoLTIpICtcbiAgICAgICgnMCcgKyBwYXJzZUludChyZ2JbM10sMTApLnRvU3RyaW5nKDE2KSkuc2xpY2UoLTIpIDogJyc7XG4gICAgfVxuXG4gICAgLy8gQ29udmVydHMgYW4gUkdCIG9iamVjdCB0byBhIGhleCBzdHJpbmdcbiAgICBmdW5jdGlvbiByZ2IyaGV4KHJnYikge1xuICAgICAgdmFyIGhleCA9IFtcbiAgICAgICAgcmdiLnIudG9TdHJpbmcoMTYpLFxuICAgICAgICByZ2IuZy50b1N0cmluZygxNiksXG4gICAgICAgIHJnYi5iLnRvU3RyaW5nKDE2KVxuICAgICAgXTtcbiAgICAgICQuZWFjaChoZXgsIGZ1bmN0aW9uKG5yLCB2YWwpIHtcbiAgICAgICAgaWYgKHZhbC5sZW5ndGggPT09IDEpIGhleFtucl0gPSAnMCcgKyB2YWw7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiAnIycgKyBoZXguam9pbignJyk7XG4gICAgfVxuXG4gICAgLy8gQ29udmVydHMgYW4gSFNCIG9iamVjdCB0byBhIGhleCBzdHJpbmdcbiAgICBmdW5jdGlvbiBoc2IyaGV4KGhzYikge1xuICAgICAgcmV0dXJuIHJnYjJoZXgoaHNiMnJnYihoc2IpKTtcbiAgICB9XG5cbiAgICAvLyBDb252ZXJ0cyBhIGhleCBzdHJpbmcgdG8gYW4gSFNCIG9iamVjdFxuICAgIGZ1bmN0aW9uIGhleDJoc2IoaGV4KSB7XG4gICAgICB2YXIgaHNiID0gcmdiMmhzYihoZXgycmdiKGhleCkpO1xuICAgICAgaWYoIGhzYi5zID09PSAwICkgaHNiLmggPSAzNjA7XG4gICAgICByZXR1cm4gaHNiO1xuICAgIH1cblxuICAgIC8vIENvbnZlcnRzIGFuIFJHQiBvYmplY3QgdG8gYW4gSFNCIG9iamVjdFxuICAgIGZ1bmN0aW9uIHJnYjJoc2IocmdiKSB7XG4gICAgICB2YXIgaHNiID0geyBoOiAwLCBzOiAwLCBiOiAwIH07XG4gICAgICB2YXIgbWluID0gTWF0aC5taW4ocmdiLnIsIHJnYi5nLCByZ2IuYik7XG4gICAgICB2YXIgbWF4ID0gTWF0aC5tYXgocmdiLnIsIHJnYi5nLCByZ2IuYik7XG4gICAgICB2YXIgZGVsdGEgPSBtYXggLSBtaW47XG4gICAgICBoc2IuYiA9IG1heDtcbiAgICAgIGhzYi5zID0gbWF4ICE9PSAwID8gMjU1ICogZGVsdGEgLyBtYXggOiAwO1xuICAgICAgaWYoIGhzYi5zICE9PSAwICkge1xuICAgICAgICBpZiggcmdiLnIgPT09IG1heCApIHtcbiAgICAgICAgICBoc2IuaCA9IChyZ2IuZyAtIHJnYi5iKSAvIGRlbHRhO1xuICAgICAgICB9IGVsc2UgaWYoIHJnYi5nID09PSBtYXggKSB7XG4gICAgICAgICAgaHNiLmggPSAyICsgKHJnYi5iIC0gcmdiLnIpIC8gZGVsdGE7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaHNiLmggPSA0ICsgKHJnYi5yIC0gcmdiLmcpIC8gZGVsdGE7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGhzYi5oID0gLTE7XG4gICAgICB9XG4gICAgICBoc2IuaCAqPSA2MDtcbiAgICAgIGlmKCBoc2IuaCA8IDAgKSB7XG4gICAgICAgIGhzYi5oICs9IDM2MDtcbiAgICAgIH1cbiAgICAgIGhzYi5zICo9IDEwMC8yNTU7XG4gICAgICBoc2IuYiAqPSAxMDAvMjU1O1xuICAgICAgcmV0dXJuIGhzYjtcbiAgICB9XG5cbiAgICAvLyBDb252ZXJ0cyBhIGhleCBzdHJpbmcgdG8gYW4gUkdCIG9iamVjdFxuICAgIGZ1bmN0aW9uIGhleDJyZ2IoaGV4KSB7XG4gICAgICBoZXggPSBwYXJzZUludCgoKGhleC5pbmRleE9mKCcjJykgPiAtMSkgPyBoZXguc3Vic3RyaW5nKDEpIDogaGV4KSwgMTYpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgLyoganNoaW50IGlnbm9yZTpzdGFydCAqL1xuICAgICAgICByOiBoZXggPj4gMTYsXG4gICAgICAgIGc6IChoZXggJiAweDAwRkYwMCkgPj4gOCxcbiAgICAgICAgYjogKGhleCAmIDB4MDAwMEZGKVxuICAgICAgICAvKiBqc2hpbnQgaWdub3JlOmVuZCAqL1xuICAgICAgfTtcbiAgICB9XG5cbiAgICAvLyBIYW5kbGUgZXZlbnRzXG4gICAgJChkb2N1bWVudClcbiAgICAgIC8vIEhpZGUgb24gY2xpY2tzIG91dHNpZGUgb2YgdGhlIGNvbnRyb2xcbiAgICAgIC5vbignbW91c2Vkb3duLm1pbmljb2xvcnMgdG91Y2hzdGFydC5taW5pY29sb3JzJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgaWYoICEkKGV2ZW50LnRhcmdldCkucGFyZW50cygpLmFkZChldmVudC50YXJnZXQpLmhhc0NsYXNzKCdtaW5pY29sb3JzJykgKSB7XG4gICAgICAgICAgaGlkZSgpO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgICAgLy8gU3RhcnQgbW92aW5nXG4gICAgICAub24oJ21vdXNlZG93bi5taW5pY29sb3JzIHRvdWNoc3RhcnQubWluaWNvbG9ycycsICcubWluaWNvbG9ycy1ncmlkLCAubWluaWNvbG9ycy1zbGlkZXIsIC5taW5pY29sb3JzLW9wYWNpdHktc2xpZGVyJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgdmFyIHRhcmdldCA9ICQodGhpcyk7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICQoZG9jdW1lbnQpLmRhdGEoJ21pbmljb2xvcnMtdGFyZ2V0JywgdGFyZ2V0KTtcbiAgICAgICAgbW92ZSh0YXJnZXQsIGV2ZW50LCB0cnVlKTtcbiAgICAgIH0pXG4gICAgICAvLyBNb3ZlIHBpY2tlcnNcbiAgICAgIC5vbignbW91c2Vtb3ZlLm1pbmljb2xvcnMgdG91Y2htb3ZlLm1pbmljb2xvcnMnLCBmdW5jdGlvbihldmVudCkge1xuICAgICAgICB2YXIgdGFyZ2V0ID0gJChkb2N1bWVudCkuZGF0YSgnbWluaWNvbG9ycy10YXJnZXQnKTtcbiAgICAgICAgaWYoIHRhcmdldCApIG1vdmUodGFyZ2V0LCBldmVudCk7XG4gICAgICB9KVxuICAgICAgLy8gU3RvcCBtb3ZpbmdcbiAgICAgIC5vbignbW91c2V1cC5taW5pY29sb3JzIHRvdWNoZW5kLm1pbmljb2xvcnMnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgJCh0aGlzKS5yZW1vdmVEYXRhKCdtaW5pY29sb3JzLXRhcmdldCcpO1xuICAgICAgfSlcbiAgICAgIC8vIFNlbGVjdGVkIGEgc3dhdGNoXG4gICAgICAub24oJ2NsaWNrLm1pbmljb2xvcnMnLCAnLm1pbmljb2xvcnMtc3dhdGNoZXMgbGknLCBmdW5jdGlvbihldmVudCkge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB2YXIgdGFyZ2V0ID0gJCh0aGlzKSwgaW5wdXQgPSB0YXJnZXQucGFyZW50cygnLm1pbmljb2xvcnMnKS5maW5kKCcubWluaWNvbG9ycy1pbnB1dCcpLCBjb2xvciA9IHRhcmdldC5kYXRhKCdzd2F0Y2gtY29sb3InKTtcbiAgICAgICAgdXBkYXRlSW5wdXQoaW5wdXQsIGNvbG9yLCBnZXRBbHBoYShjb2xvcikpO1xuICAgICAgICB1cGRhdGVGcm9tSW5wdXQoaW5wdXQpO1xuICAgICAgfSlcbiAgICAgIC8vIFNob3cgcGFuZWwgd2hlbiBzd2F0Y2ggaXMgY2xpY2tlZFxuICAgICAgLm9uKCdtb3VzZWRvd24ubWluaWNvbG9ycyB0b3VjaHN0YXJ0Lm1pbmljb2xvcnMnLCAnLm1pbmljb2xvcnMtaW5wdXQtc3dhdGNoJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgdmFyIGlucHV0ID0gJCh0aGlzKS5wYXJlbnQoKS5maW5kKCcubWluaWNvbG9ycy1pbnB1dCcpO1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBpZiggaW5wdXQucGFyZW50KCkuZmluZCgnLm1pbmljb2xvcnMtcGFuZWwnKS5jc3MoXCJkaXNwbGF5XCIpICE9PSBcIm5vbmVcIil7XG4gICAgICAgICAgLy90b2RvXG4gICAgICAgICAgLy9oaWRlKCk7XG4gICAgICAgIH1lbHNle1xuICAgICAgICAgIHNob3coaW5wdXQpO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgICAgLy8gU2hvdyBvbiBmb2N1c1xuICAgICAgLm9uKCdmb2N1cy5taW5pY29sb3JzJywgJy5taW5pY29sb3JzLWlucHV0JywgZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBpbnB1dCA9ICQodGhpcyk7XG4gICAgICAgIGlmKCAhaW5wdXQuZGF0YSgnbWluaWNvbG9ycy1pbml0aWFsaXplZCcpICkgcmV0dXJuO1xuICAgICAgICBzaG93KGlucHV0KTtcbiAgICAgIH0pXG4gICAgICAvLyBVcGRhdGUgdmFsdWUgb24gYmx1clxuICAgICAgLm9uKCdibHVyLm1pbmljb2xvcnMnLCAnLm1pbmljb2xvcnMtaW5wdXQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGlucHV0ID0gJCh0aGlzKSxcbiAgICAgICAgICBzZXR0aW5ncyA9IGlucHV0LmRhdGEoJ21pbmljb2xvcnMtc2V0dGluZ3MnKSxcbiAgICAgICAgICBrZXl3b3JkcyxcbiAgICAgICAgICBoZXgsXG4gICAgICAgICAgcmdiYSxcbiAgICAgICAgICBzd2F0Y2hPcGFjaXR5LFxuICAgICAgICAgIHZhbHVlO1xuXG4gICAgICAgIGlmKCAhaW5wdXQuZGF0YSgnbWluaWNvbG9ycy1pbml0aWFsaXplZCcpICkgcmV0dXJuO1xuXG4gICAgICAgIC8vIEdldCBhcnJheSBvZiBsb3dlcmNhc2Uga2V5d29yZHNcbiAgICAgICAga2V5d29yZHMgPSAhc2V0dGluZ3Mua2V5d29yZHMgPyBbXSA6ICQubWFwKHNldHRpbmdzLmtleXdvcmRzLnNwbGl0KCcsJyksIGZ1bmN0aW9uKGEpIHtcbiAgICAgICAgICByZXR1cm4gJC50cmltKGEudG9Mb3dlckNhc2UoKSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFNldCBjb2xvciBzdHJpbmdcbiAgICAgICAgaWYoIGlucHV0LnZhbCgpICE9PSAnJyAmJiAkLmluQXJyYXkoaW5wdXQudmFsKCkudG9Mb3dlckNhc2UoKSwga2V5d29yZHMpID4gLTEgKSB7XG4gICAgICAgICAgdmFsdWUgPSBpbnB1dC52YWwoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBHZXQgUkdCQSB2YWx1ZXMgZm9yIGVhc3kgY29udmVyc2lvblxuICAgICAgICAgIGlmKCBpc1JnYihpbnB1dC52YWwoKSkgKSB7XG4gICAgICAgICAgICByZ2JhID0gcGFyc2VSZ2IoaW5wdXQudmFsKCksIHRydWUpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBoZXggPSBwYXJzZUhleChpbnB1dC52YWwoKSwgdHJ1ZSk7XG4gICAgICAgICAgICByZ2JhID0gaGV4ID8gaGV4MnJnYihoZXgpIDogbnVsbDtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBDb252ZXJ0IHRvIGZvcm1hdFxuICAgICAgICAgIGlmKCByZ2JhID09PSBudWxsICkge1xuICAgICAgICAgICAgdmFsdWUgPSBzZXR0aW5ncy5kZWZhdWx0VmFsdWU7XG4gICAgICAgICAgfSBlbHNlIGlmKCBzZXR0aW5ncy5mb3JtYXQgPT09ICdyZ2InICkge1xuICAgICAgICAgICAgdmFsdWUgPSBzZXR0aW5ncy5vcGFjaXR5ID9cbiAgICAgICAgICAgICAgcGFyc2VSZ2IoJ3JnYmEoJyArIHJnYmEuciArICcsJyArIHJnYmEuZyArICcsJyArIHJnYmEuYiArICcsJyArIGlucHV0LmF0dHIoJ2RhdGEtb3BhY2l0eScpICsgJyknKSA6XG4gICAgICAgICAgICAgIHBhcnNlUmdiKCdyZ2IoJyArIHJnYmEuciArICcsJyArIHJnYmEuZyArICcsJyArIHJnYmEuYiArICcpJyk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhbHVlID0gcmdiMmhleChyZ2JhKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBVcGRhdGUgc3dhdGNoIG9wYWNpdHlcbiAgICAgICAgc3dhdGNoT3BhY2l0eSA9IHNldHRpbmdzLm9wYWNpdHkgPyBpbnB1dC5hdHRyKCdkYXRhLW9wYWNpdHknKSA6IDE7XG4gICAgICAgIGlmKCB2YWx1ZS50b0xvd2VyQ2FzZSgpID09PSAndHJhbnNwYXJlbnQnICkgc3dhdGNoT3BhY2l0eSA9IDA7XG4gICAgICAgIGlucHV0XG4gICAgICAgICAgLmNsb3Nlc3QoJy5taW5pY29sb3JzJylcbiAgICAgICAgICAuZmluZCgnLm1pbmljb2xvcnMtaW5wdXQtc3dhdGNoID4gc3BhbicpXG4gICAgICAgICAgLmNzcygnb3BhY2l0eScsIHN3YXRjaE9wYWNpdHkpO1xuXG4gICAgICAgIC8vIFNldCBpbnB1dCB2YWx1ZVxuICAgICAgICBpbnB1dC52YWwodmFsdWUpO1xuXG4gICAgICAgIC8vIElzIGl0IGJsYW5rP1xuICAgICAgICBpZiggaW5wdXQudmFsKCkgPT09ICcnICkgaW5wdXQudmFsKHBhcnNlSW5wdXQoc2V0dGluZ3MuZGVmYXVsdFZhbHVlLCB0cnVlKSk7XG5cbiAgICAgICAgLy8gQWRqdXN0IGNhc2VcbiAgICAgICAgaW5wdXQudmFsKCBjb252ZXJ0Q2FzZShpbnB1dC52YWwoKSwgc2V0dGluZ3MubGV0dGVyQ2FzZSkgKTtcblxuICAgICAgfSlcbiAgICAgIC8vIEhhbmRsZSBrZXlwcmVzc2VzXG4gICAgICAub24oJ2tleWRvd24ubWluaWNvbG9ycycsICcubWluaWNvbG9ycy1pbnB1dCcsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgIHZhciBpbnB1dCA9ICQodGhpcyk7XG4gICAgICAgIGlmKCAhaW5wdXQuZGF0YSgnbWluaWNvbG9ycy1pbml0aWFsaXplZCcpICkgcmV0dXJuO1xuICAgICAgICBzd2l0Y2goZXZlbnQua2V5Q29kZSkge1xuICAgICAgICAgIGNhc2UgOTogLy8gdGFiXG4gICAgICAgICAgICBoaWRlKCk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIDEzOiAvLyBlbnRlclxuICAgICAgICAgIGNhc2UgMjc6IC8vIGVzY1xuICAgICAgICAgICAgaGlkZSgpO1xuICAgICAgICAgICAgaW5wdXQuYmx1cigpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgICAvLyBVcGRhdGUgb24ga2V5dXBcbiAgICAgIC5vbigna2V5dXAubWluaWNvbG9ycycsICcubWluaWNvbG9ycy1pbnB1dCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgaW5wdXQgPSAkKHRoaXMpO1xuICAgICAgICBpZiggIWlucHV0LmRhdGEoJ21pbmljb2xvcnMtaW5pdGlhbGl6ZWQnKSApIHJldHVybjtcbiAgICAgICAgdXBkYXRlRnJvbUlucHV0KGlucHV0LCB0cnVlKTtcbiAgICAgIH0pXG4gICAgICAvLyBVcGRhdGUgb24gcGFzdGVcbiAgICAgIC5vbigncGFzdGUubWluaWNvbG9ycycsICcubWluaWNvbG9ycy1pbnB1dCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgaW5wdXQgPSAkKHRoaXMpO1xuICAgICAgICBpZiggIWlucHV0LmRhdGEoJ21pbmljb2xvcnMtaW5pdGlhbGl6ZWQnKSApIHJldHVybjtcbiAgICAgICAgc2V0VGltZW91dCggZnVuY3Rpb24oKSB7XG4gICAgICAgICAgdXBkYXRlRnJvbUlucHV0KGlucHV0LCB0cnVlKTtcbiAgICAgICAgfSwgMSk7XG4gICAgICB9KTtcblxuICB9KSk7XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL2pxdWVyeS9taW5pY29sb3JzLmpzXG4vLyBtb2R1bGUgaWQgPSA1MVxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCIndXNlIHN0cmljdCc7XG5cblxuICBmYWJyaWMuU2hhcGVNaXhpbiA9IHtcbiAgICBzdG9yZVByb3BlcnRpZXM6IGZhYnJpYy5PYmplY3QucHJvdG90eXBlLnN0b3JlUHJvcGVydGllcy5jb25jYXQoW1wicG9pbnRzXCJdKSxcbiAgICBzdGF0ZVByb3BlcnRpZXM6IGZhYnJpYy5PYmplY3QucHJvdG90eXBlLnN0YXRlUHJvcGVydGllcy5jb25jYXQoW1wicG9pbnRzXCJdKSxcbiAgICBzcGVjaWFsUHJvcGVydGllczogW1wicG9pbnRzXCJdLFxuICAgIGdldFBvaW50czogZnVuY3Rpb24oKXtcbiAgICAgIHJldHVybiBmYWJyaWMudXRpbC5vYmplY3QuZmlsdGVyVmFsdWVzKHRoaXMucG9pbnRzLFtcInhcIixcInlcIixcImNcIixcImMyXCJdKTtcbiAgICB9LFxuICAgIGFkZFBvaW50OiBmdW5jdGlvbiAoX3BvaW50KSB7XG4gICAgICB0aGlzLnBvaW50cy5wdXNoKHtcbiAgICAgICAgeCA6IF9wb2ludC54LFxuICAgICAgICB5IDogX3BvaW50LnlcbiAgICAgIH0pO1xuICAgICAgaWYodGhpcy5jbG9zZU9uRnVsbCAmJiB0aGlzLnBvaW50cy5sZW5ndGggPT0gdGhpcy5tYXhpbXVtUG9pbnRzICl7XG4gICAgICAgIHRoaXMuY2xvc2VkID0gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIHRoaXMudXBkYXRlQmJveCgpO1xuICAgIH0sXG4gICAgZ2V0TGVuZ3RoOiBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgX2wgPSAwO1xuICAgICAgZm9yKHZhciBpID0gMCA7IGkgPCB0aGlzLnBvaW50cy5sZW5ndGggLSAxOyBpKyspe1xuICAgICAgICBpZih0aGlzLnBvaW50c1tpXS5jdXJ2ZSl7XG4gICAgICAgICAgX2wgKz0gdGhpcy5wb2ludHNbaV0uY3VydmUubGVuZ3RoKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiBfbDtcbiAgICB9LFxuICAgIHVwZGF0ZUJib3g6IGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmICh0aGlzLnBvaW50cy5sZW5ndGggPT0gMCkge1xuICAgICAgICB0aGlzLmxlZnQgPSAwO1xuICAgICAgICB0aGlzLnRvcCA9IDA7XG4gICAgICAgIHRoaXMud2lkdGggPSAxO1xuICAgICAgICB0aGlzLmhlaWdodCA9IDE7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHZhciBtaW5YID0gSW5maW5pdHksIG1heFggPSAtSW5maW5pdHksIG1pblkgPSBJbmZpbml0eSwgbWF4WSA9IC1JbmZpbml0eSwgaTtcbiAgICAgIGZvciAoaSBpbiB0aGlzLnBvaW50cykge1xuICAgICAgICB2YXIgX3AgPSB0aGlzLnBvaW50c1tpXTtcbiAgICAgICAgaWYgKF9wLm91dGxpbmUpIHtcbiAgICAgICAgICB2YXIgYmJveCA9IF9wLm91dGxpbmUuYmJveCgpO1xuICAgICAgICAgIG1pblggPSBNYXRoLm1pbihtaW5YLCBiYm94LngubWluKTtcbiAgICAgICAgICBtYXhYID0gTWF0aC5tYXgobWF4WCwgYmJveC54Lm1heCk7XG4gICAgICAgICAgbWluWSA9IE1hdGgubWluKG1pblksIGJib3gueS5taW4pO1xuICAgICAgICAgIG1heFkgPSBNYXRoLm1heChtYXhZLCBiYm94LnkubWF4KTtcbiAgICAgICAgfWVsc2UgaWYgKF9wLmN1cnZlKSB7XG4gICAgICAgICAgdmFyIGJib3ggPSBfcC5jdXJ2ZS5iYm94KCk7XG4gICAgICAgICAgbWluWCA9IE1hdGgubWluKG1pblgsIGJib3gueC5taW4pO1xuICAgICAgICAgIG1heFggPSBNYXRoLm1heChtYXhYLCBiYm94LngubWF4KTtcbiAgICAgICAgICBtaW5ZID0gTWF0aC5taW4obWluWSwgYmJveC55Lm1pbik7XG4gICAgICAgICAgbWF4WSA9IE1hdGgubWF4KG1heFksIGJib3gueS5tYXgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG1pblggPSBNYXRoLm1pbihtaW5YLCBfcC54KTtcbiAgICAgICAgICBtYXhYID0gTWF0aC5tYXgobWF4WCwgX3AueCk7XG4gICAgICAgICAgbWluWSA9IE1hdGgubWluKG1pblksIF9wLnkpO1xuICAgICAgICAgIG1heFkgPSBNYXRoLm1heChtYXhZLCBfcC55KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdGhpcy5fX3RyYW5zbGF0ZWQgPSB7XG4gICAgICAgIHg6IG1pblgsXG4gICAgICAgIHk6IG1pblksXG4gICAgICB9O1xuICAgICAgdGhpcy5sZWZ0ICs9IG1pblg7XG4gICAgICB0aGlzLnRvcCArPSBtaW5ZO1xuICAgICAgdGhpcy53aWR0aCA9IG1heFggLSBtaW5YICsgMTtcbiAgICAgIHRoaXMuaGVpZ2h0ID0gbWF4WSAtIG1pblkgKyAxO1xuXG4gICAgICBmb3IgKGkgaW4gdGhpcy5wb2ludHMpIHtcbiAgICAgICAgdmFyIF9wb2ludCA9IHRoaXMucG9pbnRzW2ldO1xuICAgICAgICBfcG9pbnQueCAtPSBtaW5YO1xuICAgICAgICBfcG9pbnQueSAtPSBtaW5ZO1xuICAgICAgICBpZihfcG9pbnQuYyl7XG4gICAgICAgICAgX3BvaW50LmMueCAtPSBtaW5YO1xuICAgICAgICAgIF9wb2ludC5jLnkgLT0gbWluWTtcbiAgICAgICAgfVxuICAgICAgICBpZihfcG9pbnQuYzIpe1xuICAgICAgICAgIF9wb2ludC5jMi54IC09IG1pblg7XG4gICAgICAgICAgX3BvaW50LmMyLnkgLT0gbWluWTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdGhpcy5jYW52YXMgJiYgdGhpcy5zZXRDb29yZHMoKTtcblxuICAgICAgLy/QvdGD0LbQvdC+INC+0L/RgtC40LzQuNC30LjRgNC+0LLQsNGC0Ywo0L/QtdGA0LXQuNGB0L7QstGL0LLQsNGC0Ywg0YLQvtC70YzQutC+IDEg0LjQu9C4IDIg0LrRgNC40LLRi9GFINC30LAg0YDQsNC3XG4gICAgICAvL3RvZG8g0L3Rg9C20L3QviDQv9C10YDQtdGA0LjRgdC+0LLRi9Cy0LDRgtGMINC/0YDQuCDQuNC30LzQtdC90LXQvdC40Lgg0YDQsNC30LzQtdGA0LBcbiAgICAgIGlmKHRoaXMuX190cmFuc2xhdGVkLnggfHwgdGhpcy5fX3RyYW5zbGF0ZWQueSl7XG4gICAgICAgIGZvcihpIGluIHRoaXMucG9pbnRzKXtcbiAgICAgICAgICB0aGlzLnBvaW50c1tpXS5jICYmIHRoaXMuX3VwZGF0ZV9jdXJ2ZSgraSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuICAgIF9wZXJmb3JtU2hhcGVBY3Rpb246IGZ1bmN0aW9uIChlLCB0cmFuc2Zvcm0sIHBvaW50ZXIpIHtcbiAgICAgIHRyYW5zZm9ybS5jb3JuZXIuc3Vic3RyKDEpXG4gICAgICB0aGlzLnNldFBvaW50KHRyYW5zZm9ybS5jb3JuZXIsIHRyYW5zZm9ybS5wb2ludCk7XG4gICAgICB0cmFuc2Zvcm0uYWN0aW9uUGVyZm9ybWVkID0gdHJ1ZTtcbiAgICAgIHRoaXMuZmlyZSgnc2hhcGluZycsIGUpO1xuICAgIH0sXG4gICAgX2luaXRQb2ludHM6IGZ1bmN0aW9uIChwb2ludHMpIHtcblxuICAgICAgaWYgKHBvaW50cykge1xuICAgICAgICB0aGlzLnNldCgncG9pbnRzJywgcG9pbnRzKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5fY29udHJvbHNWaXNpYmlsaXR5ID0ge307XG5cbiAgICAgIHZhciBfcG9pbnRzID0gdGhpcy5wb2ludHMgfHwgdGhpcy5fcG9pbnRzO1xuXG4gICAgICBpZiAoX3BvaW50cykge1xuICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8PSBfcG9pbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgdGhpcy5fY29udHJvbHNWaXNpYmlsaXR5W1wicFwiICsgaV0gPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2NvbnRyb2xzVmlzaWJpbGl0eVtcInBcIl0gPSB0cnVlO1xuICAgICAgfVxuXG5cbiAgICAgIHZhciBfZGVmYXVsdF9jb3JuZXJzID0ge1xuICAgICAgICB0bDogdHJ1ZSxcbiAgICAgICAgdHI6IHRydWUsXG4gICAgICAgIGJyOiB0cnVlLFxuICAgICAgICBibDogdHJ1ZSxcbiAgICAgICAgbWw6IHRydWUsXG4gICAgICAgIG10OiB0cnVlLFxuICAgICAgICBtcjogdHJ1ZSxcbiAgICAgICAgbWI6IHRydWUsXG4gICAgICAgIG10cjogdHJ1ZVxuICAgICAgfTtcbiAgICAgIGZvciAodmFyIGkgaW4gX2RlZmF1bHRfY29ybmVycykge1xuICAgICAgICB0aGlzLl9jb250cm9sc1Zpc2liaWxpdHlbaV0gPSBfZGVmYXVsdF9jb3JuZXJzW2ldO1xuICAgICAgfVxuICAgIH0sXG4gICAgX2RlZmF1bHRfY29ybmVyX2FjdGlvbjogXCJzaGFwZVwiLFxuICAgIF9jb3JuZXJfYWN0aW9uczoge30sXG5cblxuICAgIGRyYXdCb3VuZHNDb250cm9sczpmYWJyaWMuT2JqZWN0LnByb3RvdHlwZS5kcmF3Q29udHJvbHMsXG4gICAgYWRkUG9pbnRzQ29udHJvbHM6IGZ1bmN0aW9uKCl7XG4gICAgICB2YXIgY29udHJvbHMgPSB7fTtcblxuICAgICAgdmFyIHB0cyA9IHRoaXMucG9pbnRzIDtcbiAgICAgIGZvcih2YXIgaSBpbiBwdHMpIHtcbiAgICAgICAgY29udHJvbHNbXCJwXCIgKyAoK2kgKV0gPSB7XG4gICAgICAgICAgeDogcHRzW2ldLngsXG4gICAgICAgICAgeTogcHRzW2ldLnksXG4gICAgICAgICAgc2l6ZTogdGhpcy5jb3JuZXJTaXplLFxuICAgICAgICAgIHN0eWxlOiBcImNpcmNsZVwiXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICByZXR1cm4gY29udHJvbHM7XG4gICAgfSxcbiAgICBkcmF3U2hhcGVCb3JkZXI6IGZ1bmN0aW9uIChjdHgpIHtcbiAgICAgIHZhciBfcG9pbnRzID0gdGhpcy5wb2ludHMgfHwgdGhpcy5fcG9pbnRzO1xuXG4gICAgICB2YXIgeCwgeTtcbiAgICAgIHggPSAtdGhpcy53aWR0aCAvIDI7XG4gICAgICB5ID0gLXRoaXMuaGVpZ2h0IC8gMjtcbiAgICAgIHZhciB6b29tID0gdGhpcy5jYW52YXMudmlld3BvcnRUcmFuc2Zvcm1bMF07XG4gICAgICBjdHguc2F2ZSgpO1xuICAgICAgY3R4LnNjYWxlKHRoaXMuc2NhbGVYICogem9vbSwgdGhpcy5zY2FsZVkgKiB6b29tKTtcbiAgICAgIGN0eC50cmFuc2xhdGUoeCwgeSk7XG5cblxuICAgICAgY3R4LmJlZ2luUGF0aCgpO1xuXG4gICAgICB2YXIgX3AgPSBfcG9pbnRzWzBdOy8vIGZhYnJpYy51dGlsLnRyYW5zZm9ybVBvaW50KF9wb2ludHNbMF0sIHRyYW5zZm9ybU1hdHJpeCk7XG5cbiAgICAgIGN0eC5tb3ZlVG8oX3AueCwgX3AueSk7XG5cbiAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgX3BvaW50cy5sZW5ndGg7IGkrKykge1xuXG4gICAgICAgIHZhciBfcCA9IF9wb2ludHNbaV07Ly9mYWJyaWMudXRpbC50cmFuc2Zvcm1Qb2ludChfcG9pbnRzW2ldLCB0cmFuc2Zvcm1NYXRyaXgpO1xuICAgICAgICBjdHgubGluZVRvKF9wLngsIF9wLnkpO1xuICAgICAgfVxuICAgICAgY3R4LmNsb3NlUGF0aCgpO1xuICAgICAgY3R4LnN0cm9rZSgpO1xuICAgICAgY3R4LnJlc3RvcmUoKTtcbiAgICB9XG4gICAgLy8gc2V0Q29vcmRzOiBmdW5jdGlvbiAoKSB7XG4gICAgLy8gICB0aGlzLnNldEJvdW5kQ29vcmRzKCk7XG4gICAgLy8gICB0aGlzLnNldEV4dHJhQ29vcmRzKCk7XG4gICAgLy8gfVxuICB9O1xuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9taXhpbnMvU2hhcGVNaXhpbi5qc1xuLy8gbW9kdWxlIGlkID0gNTJcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiZmFicmljLlRyYW5zZm9ybWVkSW1hZ2VNaXhpbiA9IHtcblxuICBwZXJzcGVjdGl2ZTogZmFsc2UsXG4gIHZlcnRpY2FsU3ViZGl2aXNpb25zOiA3LCAvLyB2ZXJ0aWNhbCBzdWJkaXZpc2lvbnNcbiAgaG9yaXpvbnRhbFN1YmRpdmlzaW9uczogNyxcbiAgX3VwZGF0ZV9jb250ZW50X29mZnNldHM6IGZ1bmN0aW9uKF9iKXtcblxuICAgIHZhciBfb21YID0gMCwgX29tWSA9IDA7XG4gICAgaWYodGhpcy5jb250ZW50T2Zmc2V0cyl7XG4gICAgICBfb21YID0gdGhpcy5jb250ZW50T2Zmc2V0cy5taW5YO1xuICAgICAgX29tWSA9IHRoaXMuY29udGVudE9mZnNldHMubWluWTtcbiAgICB9XG5cbiAgICBpZihfYil7XG4gICAgICB0aGlzLnBvaW50cyA9IFtcbiAgICAgICAgdGhpcy5fZ2V0UG9pbnRGb3JJbWFnZUNvb3JkaWFuYXRlKF9iLm1pblggLSBfb21YLF9iLm1pblkgLSBfb21ZKSxcbiAgICAgICAgdGhpcy5fZ2V0UG9pbnRGb3JJbWFnZUNvb3JkaWFuYXRlKF9iLm1heFggLSBfb21YLF9iLm1pblkgLSBfb21ZKSxcbiAgICAgICAgdGhpcy5fZ2V0UG9pbnRGb3JJbWFnZUNvb3JkaWFuYXRlKF9iLm1heFggLSBfb21YLF9iLm1heFkgLSBfb21ZKSxcbiAgICAgICAgdGhpcy5fZ2V0UG9pbnRGb3JJbWFnZUNvb3JkaWFuYXRlKF9iLm1pblggLSBfb21YLF9iLm1heFkgLSBfb21ZKVxuICAgICAgXTtcbiAgICAgIHRoaXMuZGlydHkgPSB0cnVlO1xuICAgIH1cblxuICAgIHRoaXMuY29udGVudE9mZnNldHMgPSBfYjtcbiAgfSxcblxuICBfZ2V0SW1hZ2VDb29yZGlhbmF0ZUZvclBvaW50OiBmdW5jdGlvbihwb2ludGVyLGRvTm90VXNlQ3VydmUpe1xuICAgIHZhciBjdXJSb3cgPSAwLjUsXG4gICAgICBwMSA9IHRoaXMucG9pbnRzWzBdLFxuICAgICAgcDIgPSB0aGlzLnBvaW50c1sxXSxcbiAgICAgIHAzID0gdGhpcy5wb2ludHNbMl0sXG4gICAgICBwNCA9IHRoaXMucG9pbnRzWzNdO1xuXG4gICAgZnVuY3Rpb24gY2hlY2tUKHQpe1xuXG4gICAgICB2YXIgYXggPSBwMS54ICsgKHAyLnggLSBwMS54KSAqIHQgLCBheSA9IHAxLnkgKyAocDIueSAtIHAxLnkpICogdCxcbiAgICAgICAgYnggPSBwNC54ICsgKHAzLnggLSBwNC54KSAqIHQgLCBieSA9IHA0LnkgKyAocDMueSAtIHA0LnkpICogdDtcbiAgICAgIHZhciBfc2lnbiA9ICAoYnggLSBheCkgKiAocG9pbnRlci55IC0gYXkpIC0gKGJ5IC0gYXkpICogKHBvaW50ZXIueCAtIGF4KTtcbiAgICAgIHJldHVybiBfc2lnbiA+IDA7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ2V0WCgpe1xuICAgICAgLy90cnVlINGB0LvQtdCy0LBcbiAgICAgIHZhciBlbGVtZW50ID0gLTE7XG4gICAgICB2YXIgaSA9IDA7XG5cbiAgICAgIGlmKGNoZWNrVChpKSl7XG4gICAgICAgIGktLTtcbiAgICAgICAgd2hpbGUoY2hlY2tUKGkpKXtcbiAgICAgICAgICBpLS07XG4gICAgICAgICAgaWYoaSA8IC01KSB7XG4gICAgICAgICAgICByZXR1cm4gLTU7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsZW1lbnQgPSBpO1xuICAgICAgfWVsc2V7XG4gICAgICAgIGkrKztcbiAgICAgICAgd2hpbGUoIWNoZWNrVChpKSl7XG4gICAgICAgICAgaSsrO1xuICAgICAgICAgIGlmKGkgPiA1KXtcbiAgICAgICAgICAgIHJldHVybiA1O1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbGVtZW50ID0gaSAtIDE7XG4gICAgICB9XG5cbiAgICAgIHZhciBwcmVjaXNpb24gPSAwLjU7XG4gICAgICBlbGVtZW50ICs9IHByZWNpc2lvbjtcbiAgICAgIHdoaWxlKHByZWNpc2lvbiA+IDAuMDUpe1xuICAgICAgICBwcmVjaXNpb24vPTI7XG4gICAgICAgIGlmKGNoZWNrVChlbGVtZW50KSl7XG4gICAgICAgICAgZWxlbWVudCAtPXByZWNpc2lvbjtcbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgZWxlbWVudCArPXByZWNpc2lvbjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIGVsZW1lbnQ7XG5cblxuICAgIH1cbiAgICB2YXIgdCA9IGdldFgoKTtcblxuICAgIHZhciBheCA9IHAxLnggKyAocDIueCAtIHAxLngpICogdCAsIGF5ID0gcDEueSArIChwMi55IC0gcDEueSkgKiB0LFxuICAgICAgYnggPSBwNC54ICsgKHAzLnggLSBwNC54KSAqIHQgLCBieSA9IHA0LnkgKyAocDMueSAtIHA0LnkpICogdDtcblxuICAgIHZhciAgX3kgPSAocG9pbnRlci55IC1heSkgLyAoYnkgLSBheSkgO1xuXG4gICAgcmV0dXJuIHt4OiB0LCB5IDogX3kgfTtcbiAgfSxcbiAgX2dldFBvaW50Rm9ySW1hZ2VDb29yZGlhbmF0ZTogZnVuY3Rpb24oeCx5LGRvTm90VXNlQ3VydmUpe1xuICAgIHZhciBjdXJSb3cgPSB5IC8gdGhpcy5oZWlnaHQsXG4gICAgICBjdXJDb2wgPSB4IC8gdGhpcy53aWR0aDtcbiAgICB2YXIgcDEgPSB0aGlzLnBvaW50c1swXSxcbiAgICAgIHAyID0gdGhpcy5wb2ludHNbMV0sXG4gICAgICBwMyA9IHRoaXMucG9pbnRzWzJdLFxuICAgICAgcDQgPSB0aGlzLnBvaW50c1szXSxcbiAgICAgIGN1clJvd1gxID0gcDEueCArIChwNC54IC0gcDEueCkgKiBjdXJSb3csXG4gICAgICBjdXJSb3dZMSA9IHAxLnkgKyAocDQueSAtIHAxLnkpICogY3VyUm93LFxuICAgICAgY3VyUm93WDIgPSBwMi54ICsgKHAzLnggLSBwMi54KSAqIGN1clJvdyxcbiAgICAgIGN1clJvd1kyID0gcDIueSArIChwMy55IC0gcDIueSkgKiBjdXJSb3csXG4gICAgICBwMXggPSBjdXJSb3dYMSArIChjdXJSb3dYMiAtIGN1clJvd1gxKSAqIGN1ckNvbCxcbiAgICAgIHAxeSA9IGN1clJvd1kxICsgKGN1clJvd1kyIC0gY3VyUm93WTEpICogY3VyQ29sO1xuXG5cbiAgICBpZighZG9Ob3RVc2VDdXJ2ZSl7XG4gICAgICBwMXkgKz0gdGhpcy5fZ2V0Q3VydmVPZmZzZXQoY3VyQ29sKS55O1xuICAgIH1lbHNle1xuXG4gICAgICB2YXIgcDEgPSB0aGlzLnBvaW50c1swXSxcbiAgICAgICAgcDIgPSB0aGlzLnBvaW50c1sxXSxcbiAgICAgICAgcDMgPSB0aGlzLnBvaW50c1syXSxcbiAgICAgICAgcDQgPSB0aGlzLnBvaW50c1szXTtcblxuICAgICAgaWYocDIueSA9PSBwMS55ICYmIHA0LnkgPT0gcDMueSkge1xuICAgICAgICB5ID0gcDF5O1xuICAgICAgfVxuICAgICAgaWYocDMueCA9PSBwMi54ICYmIHA0LnggPT0gcDEueCkge1xuICAgICAgICB4ID0gcDF4O1xuICAgICAgfVxuICAgICAgaWYoY3VyUm93WTIgPT0gY3VyUm93WTEpIHtcbiAgICAgICAgY3VyUm93WTEgPSBwMXk7XG4gICAgICB9XG4gICAgfVxuXG5cbiAgICByZXR1cm4ge3g6IHAxeCAsIHkgOiBwMXl9O1xuICB9LFxuICBkcmF3VHJpYW5nbGU6IGZ1bmN0aW9uKGN0eCwgaW0sIHgwLCB5MCwgeDEsIHkxLCB4MiwgeTIsIHN4MCwgc3kwLCBzeDEsIHN5MSwgc3gyLCBzeTIpIHtcbiAgICBjdHguc2F2ZSgpO1xuXG4gICAgLy8gQ2xpcCB0aGUgb3V0cHV0IHRvIHRoZSBvbi1zY3JlZW4gdHJpYW5nbGUgYm91bmRhcmllcy5cbiAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgY3R4Lm1vdmVUbyh4MCwgeTApO1xuICAgIGN0eC5saW5lVG8oeDEsIHkxKTtcbiAgICBjdHgubGluZVRvKHgyLCB5Mik7XG4gICAgY3R4LmNsb3NlUGF0aCgpO1xuICAgIGlmKHRoaXMud2lyZWZyYW1lKXtcbiAgICAgIGN0eC5zdHJva2UoKTsvL3h4eHh4eHggZm9yIHdpcmVmcmFtZVxuICAgIH1cbiAgICBjdHguY2xpcCgpO1xuXG4gICAgLypcbiAgICAgY3R4LnRyYW5zZm9ybShtMTEsIG0xMiwgbTIxLCBtMjIsIGR4LCBkeSkgc2V0cyB0aGUgY29udGV4dCB0cmFuc2Zvcm0gbWF0cml4LlxuXG4gICAgIFRoZSBjb250ZXh0IG1hdHJpeCBpczpcblxuICAgICBbIG0xMSBtMjEgZHggXVxuICAgICBbIG0xMiBtMjIgZHkgXVxuICAgICBbICAwICAgMCAgIDEgXVxuXG4gICAgIENvb3JkcyBhcmUgY29sdW1uIHZlY3RvcnMgd2l0aCBhIDEgaW4gdGhlIHogY29vcmQsIHNvIHRoZSB0cmFuc2Zvcm0gaXM6XG4gICAgIHhfb3V0ID0gbTExICogeCArIG0yMSAqIHkgKyBkeDtcbiAgICAgeV9vdXQgPSBtMTIgKiB4ICsgbTIyICogeSArIGR5O1xuXG4gICAgIEZyb20gTWF4aW1hLCB0aGVzZSBhcmUgdGhlIHRyYW5zZm9ybSB2YWx1ZXMgdGhhdCBtYXAgdGhlIHNvdXJjZVxuICAgICBjb29yZHMgdG8gdGhlIGRlc3QgY29vcmRzOlxuXG4gICAgIHN5MCAoeDIgLSB4MSkgLSBzeTEgeDIgKyBzeTIgeDEgKyAoc3kxIC0gc3kyKSB4MFxuICAgICBbbTExID0gLSAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSxcbiAgICAgc3gwIChzeTIgLSBzeTEpIC0gc3gxIHN5MiArIHN4MiBzeTEgKyAoc3gxIC0gc3gyKSBzeTBcblxuICAgICBzeTEgeTIgKyBzeTAgKHkxIC0geTIpIC0gc3kyIHkxICsgKHN5MiAtIHN5MSkgeTBcbiAgICAgbTEyID0gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0sXG4gICAgIHN4MCAoc3kyIC0gc3kxKSAtIHN4MSBzeTIgKyBzeDIgc3kxICsgKHN4MSAtIHN4Mikgc3kwXG5cbiAgICAgc3gwICh4MiAtIHgxKSAtIHN4MSB4MiArIHN4MiB4MSArIChzeDEgLSBzeDIpIHgwXG4gICAgIG0yMSA9IC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLFxuICAgICBzeDAgKHN5MiAtIHN5MSkgLSBzeDEgc3kyICsgc3gyIHN5MSArIChzeDEgLSBzeDIpIHN5MFxuXG4gICAgIHN4MSB5MiArIHN4MCAoeTEgLSB5MikgLSBzeDIgeTEgKyAoc3gyIC0gc3gxKSB5MFxuICAgICBtMjIgPSAtIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLFxuICAgICBzeDAgKHN5MiAtIHN5MSkgLSBzeDEgc3kyICsgc3gyIHN5MSArIChzeDEgLSBzeDIpIHN5MFxuXG4gICAgIHN4MCAoc3kyIHgxIC0gc3kxIHgyKSArIHN5MCAoc3gxIHgyIC0gc3gyIHgxKSArIChzeDIgc3kxIC0gc3gxIHN5MikgeDBcbiAgICAgZHggPSAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLFxuICAgICBzeDAgKHN5MiAtIHN5MSkgLSBzeDEgc3kyICsgc3gyIHN5MSArIChzeDEgLSBzeDIpIHN5MFxuXG4gICAgIHN4MCAoc3kyIHkxIC0gc3kxIHkyKSArIHN5MCAoc3gxIHkyIC0gc3gyIHkxKSArIChzeDIgc3kxIC0gc3gxIHN5MikgeTBcbiAgICAgZHkgPSAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXVxuICAgICBzeDAgKHN5MiAtIHN5MSkgLSBzeDEgc3kyICsgc3gyIHN5MSArIChzeDEgLSBzeDIpIHN5MFxuICAgICAqL1xuXG4gICAgLy8gVE9ETzogZWxpbWluYXRlIGNvbW1vbiBzdWJleHByZXNzaW9ucy5cbiAgICB2YXIgZGVub20gPSBzeDAgKiAoc3kyIC0gc3kxKSAtIHN4MSAqIHN5MiArIHN4MiAqIHN5MSArIChzeDEgLSBzeDIpICogc3kwO1xuICAgIGlmIChkZW5vbSA9PSAwKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHZhciBtMTEgPSAtKHN5MCAqICh4MiAtIHgxKSAtIHN5MSAqIHgyICsgc3kyICogeDEgKyAoc3kxIC0gc3kyKSAqIHgwKSAvIGRlbm9tO1xuICAgIHZhciBtMTIgPSAoc3kxICogeTIgKyBzeTAgKiAoeTEgLSB5MikgLSBzeTIgKiB5MSArIChzeTIgLSBzeTEpICogeTApIC8gZGVub207XG4gICAgdmFyIG0yMSA9IChzeDAgKiAoeDIgLSB4MSkgLSBzeDEgKiB4MiArIHN4MiAqIHgxICsgKHN4MSAtIHN4MikgKiB4MCkgLyBkZW5vbTtcbiAgICB2YXIgbTIyID0gLShzeDEgKiB5MiArIHN4MCAqICh5MSAtIHkyKSAtIHN4MiAqIHkxICsgKHN4MiAtIHN4MSkgKiB5MCkgLyBkZW5vbTtcbiAgICB2YXIgZHggPSAoc3gwICogKHN5MiAqIHgxIC0gc3kxICogeDIpICsgc3kwICogKHN4MSAqIHgyIC0gc3gyICogeDEpICsgKHN4MiAqIHN5MSAtIHN4MSAqIHN5MikgKiB4MCkgLyBkZW5vbTtcbiAgICB2YXIgZHkgPSAoc3gwICogKHN5MiAqIHkxIC0gc3kxICogeTIpICsgc3kwICogKHN4MSAqIHkyIC0gc3gyICogeTEpICsgKHN4MiAqIHN5MSAtIHN4MSAqIHN5MikgKiB5MCkgLyBkZW5vbTtcblxuICAgIGN0eC50cmFuc2Zvcm0obTExLCBtMTIsIG0yMSwgbTIyLCBkeCwgZHkpO1xuXG4gICAgLy8gRHJhdyB0aGUgd2hvbGUgaW1hZ2UuICBUcmFuc2Zvcm0gYW5kIGNsaXAgd2lsbCBtYXAgaXQgb250byB0aGVcbiAgICAvLyBjb3JyZWN0IG91dHB1dCB0cmlhbmdsZS5cbiAgICAvL1xuICAgIC8vIFRPRE86IGZpZ3VyZSBvdXQgaWYgZHJhd0ltYWdlIGdvZXMgZmFzdGVyIGlmIHdlIHNwZWNpZnkgdGhlIHJlY3RhbmdsZSB0aGF0XG4gICAgLy8gYm91bmRzIHRoZSBzb3VyY2UgY29vcmRzLlxuICAgIGN0eC5kcmF3SW1hZ2UoaW0sIDAsIDApO1xuICAgIGN0eC5yZXN0b3JlKCk7XG4gIH0sXG4gIGRyYXdXaXJlZnJhbWU6IGZ1bmN0aW9uKGN0eCl7XG5cbiAgICBjdHguc3Ryb2tlU3R5bGUgPSBcImJsYWNrXCI7XG4gICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgIHZhciB0cmk7XG4gICAgZm9yICh2YXIgaSBpbiB0aGlzLl90cmlhbmdsZXMpIHtcbiAgICAgIHRyaSA9IHRoaXMuX3RyaWFuZ2xlc1tpXTtcbiAgICAgIGN0eC5tb3ZlVG8odHJpLnAwLngsIHRyaS5wMC55KTtcbiAgICAgIGN0eC5saW5lVG8odHJpLnAxLngsIHRyaS5wMS55KTtcbiAgICAgIGN0eC5saW5lVG8odHJpLnAyLngsIHRyaS5wMi55KTtcbiAgICAgIGN0eC5saW5lVG8odHJpLnAwLngsIHRyaS5wMC55KTtcbiAgICB9XG4gICAgY3R4LnN0cm9rZSgpO1xuICAgIGN0eC5jbG9zZVBhdGgoKTtcbiAgfSxcbiAgZml4U2VtaVRyYW5zcGFyZW50UGl4ZWxzOiBmdW5jdGlvbihjdHgpe1xuXG4gICAgdmFyIGltZ0RhdGEgPSBjdHguZ2V0SW1hZ2VEYXRhKDAsMCxjdHguY2FudmFzLndpZHRoLGN0eC5jYW52YXMuaGVpZ2h0KTtcbiAgICBmb3IodmFyIGkgPSAzOyBpIDwgaW1nRGF0YS5kYXRhLmxlbmd0aDsgaSs9NCl7XG4gICAgICBpZihpbWdEYXRhLmRhdGFbaV0gPiAwKXtcbiAgICAgICAgaW1nRGF0YS5kYXRhW2ldID0gMjU1O1xuICAgICAgfVxuICAgIH1cbiAgICBjdHgucHV0SW1hZ2VEYXRhKGltZ0RhdGEsMCwwKTtcbiAgfSxcbiAgZHJhd0VsZW1lbnQ6IGZ1bmN0aW9uKGN0eCl7XG4gICAgdmFyIHRyaTtcbiAgICBmb3IgKHZhciBpIGluIHRoaXMuX3RyaWFuZ2xlcykge1xuICAgICAgdHJpID0gdGhpcy5fdHJpYW5nbGVzW2ldO1xuXG4gICAgICB0aGlzLmRyYXdUcmlhbmdsZShjdHgsIHRoaXMuX2VsZW1lbnQsXG4gICAgICAgICt0cmkucDAueCwgdHJpLnAwLnksXG4gICAgICAgIHRyaS5wMS54LCB0cmkucDEueSxcbiAgICAgICAgdHJpLnAyLngsIHRyaS5wMi55LFxuICAgICAgICB0cmkudDAudSwgdHJpLnQwLnYsXG4gICAgICAgIHRyaS50MS51LCB0cmkudDEudixcbiAgICAgICAgdHJpLnQyLnUsIHRyaS50Mi52KTtcbiAgICB9XG4gIH0sXG4gIGNhbGN1bGF0ZUdlb21ldHJ5IDogZnVuY3Rpb24oKSB7XG4gICAgLy8gY2xlYXIgX3RyaWFuZ2xlcyBvdXRcbiAgICB0aGlzLl90cmlhbmdsZXMgPSBbXTtcblxuICAgIC8vIGdlbmVyYXRlIHN1YmRpdmlzaW9uXG4gICAgdmFyIHN1YnMgPSB0aGlzLnZlcnRpY2FsU3ViZGl2aXNpb25zOyAvLyB2ZXJ0aWNhbCBzdWJkaXZpc2lvbnNcbiAgICB2YXIgZGl2cyA9IHRoaXMuaG9yaXpvbnRhbFN1YmRpdmlzaW9uczsgLy8gaG9yaXpvbnRhbCBzdWJkaXZpc2lvbnNcblxuICAgIHZhciBwMSA9IG5ldyBmYWJyaWMuUG9pbnQodGhpcy5wb2ludHNbMF0ueCx0aGlzLnBvaW50c1swXS55KTtcbiAgICB2YXIgcDIgPSBuZXcgZmFicmljLlBvaW50KHRoaXMucG9pbnRzWzFdLngsdGhpcy5wb2ludHNbMV0ueSk7XG4gICAgdmFyIHAzID0gbmV3IGZhYnJpYy5Qb2ludCh0aGlzLnBvaW50c1syXS54LHRoaXMucG9pbnRzWzJdLnkpO1xuICAgIHZhciBwNCA9IG5ldyBmYWJyaWMuUG9pbnQodGhpcy5wb2ludHNbM10ueCx0aGlzLnBvaW50c1szXS55KTtcblxuICAgIHZhciBkeDEgPSBwNC54IC0gcDEueDtcbiAgICB2YXIgZHkxID0gcDQueSAtIHAxLnk7XG4gICAgdmFyIGR4MiA9IHAzLnggLSBwMi54O1xuICAgIHZhciBkeTIgPSBwMy55IC0gcDIueTtcblxuICAgIHZhciBpbWdXID0gdGhpcy5fZWxlbWVudC5uYXR1cmFsV2lkdGg7XG4gICAgdmFyIGltZ0ggPSB0aGlzLl9lbGVtZW50Lm5hdHVyYWxIZWlnaHQ7XG5cbiAgICBpZih0aGlzLnBlcnNwZWN0aXZlKSB7XG4gICAgICAvLzEvMlxuICAgICAgdmFyIF9wZXJzcGVjdGl2ZVkgPSBwMi5kaXN0YW5jZUZyb20ocDMpIC8gcDEuZGlzdGFuY2VGcm9tKHA0KSA7XG4gICAgICB2YXIgX3BlcnNwZWN0aXZlWCA9IHAxLmRpc3RhbmNlRnJvbShwMikgLyBwNC5kaXN0YW5jZUZyb20ocDMpO1xuICAgICAgdmFyIF90b3RhbERpc3RhbmNlWCA9IDAsIF90b3RhbERpc3RhbmNlWSA9IDA7XG4gICAgICBpZiAoX3BlcnNwZWN0aXZlWCA8IDEpIF9wZXJzcGVjdGl2ZVggPSAxIC8gX3BlcnNwZWN0aXZlWDtcbiAgICAgIGlmIChfcGVyc3BlY3RpdmVZIDwgMSkgX3BlcnNwZWN0aXZlWSA9IDEgLyBfcGVyc3BlY3RpdmVZO1xuXG4gICAgICBfcGVyc3BlY3RpdmVYID0gTWF0aC5zcXJ0KF9wZXJzcGVjdGl2ZVgpO1xuICAgICAgX3BlcnNwZWN0aXZlWSA9IE1hdGguc3FydChfcGVyc3BlY3RpdmVZKTtcblxuICAgICAgdmFyIGxhc3RYID0gMTtcbiAgICAgIGZvciAodmFyIHN1YiA9IDA7IHN1YiA8IHN1YnM7ICsrc3ViKSB7XG4gICAgICAgIF90b3RhbERpc3RhbmNlWCArPSBsYXN0WDtcbiAgICAgICAgbGFzdFggKj0gX3BlcnNwZWN0aXZlWDtcbiAgICAgIH1cbiAgICAgIHZhciBsYXN0WSA9IDE7XG4gICAgICBmb3IgKHZhciBzdWIgPSAwOyBzdWIgPCBzdWJzOyArK3N1Yikge1xuICAgICAgICBfdG90YWxEaXN0YW5jZVkgKz0gbGFzdFk7XG4gICAgICAgIGxhc3RZICo9IF9wZXJzcGVjdGl2ZVk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5faW5pdEN1cnZlT2Zmc2V0KCk7XG5cbiAgICB2YXIgY3VyUm93LCBuZXh0Um93ID0gMCwgY3VyUm93VGV4LCBuZXh0Um93VGV4ID0gMDtcbiAgICBsYXN0WCA9IDE7XG4gICAgZm9yICh2YXIgc3ViID0gMDsgc3ViIDwgc3ViczsgKytzdWIpIHtcbiAgICAgIGN1clJvdyA9IG5leHRSb3c7XG4gICAgICBjdXJSb3dUZXggPSBuZXh0Um93VGV4O1xuXG4gICAgICBuZXh0Um93VGV4ID0gKHN1YiArIDEpIC8gc3VicztcblxuICAgICAgaWYodGhpcy5wZXJzcGVjdGl2ZSl7XG4gICAgICAgIG5leHRSb3cgPSBjdXJSb3cgKyBsYXN0WCAvIF90b3RhbERpc3RhbmNlWDtcbiAgICAgICAgbGFzdFggKj0gX3BlcnNwZWN0aXZlWDtcbiAgICAgIH1lbHNle1xuICAgICAgICBuZXh0Um93ID0gbmV4dFJvd1RleDtcbiAgICAgIH1cblxuICAgICAgdmFyIGN1clJvd1gxID0gcDEueCArIGR4MSAqIGN1clJvdztcbiAgICAgIHZhciBjdXJSb3dZMSA9IHAxLnkgKyBkeTEgKiBjdXJSb3c7XG5cbiAgICAgIHZhciBjdXJSb3dYMiA9IHAyLnggKyBkeDIgKiBjdXJSb3c7XG4gICAgICB2YXIgY3VyUm93WTIgPSBwMi55ICsgZHkyICogY3VyUm93O1xuXG4gICAgICB2YXIgbmV4dFJvd1gxID0gcDEueCArIGR4MSAqIG5leHRSb3c7XG4gICAgICB2YXIgbmV4dFJvd1kxID0gcDEueSArIGR5MSAqIG5leHRSb3c7XG5cbiAgICAgIHZhciBuZXh0Um93WDIgPSBwMi54ICsgZHgyICogbmV4dFJvdztcbiAgICAgIHZhciBuZXh0Um93WTIgPSBwMi55ICsgZHkyICogbmV4dFJvdztcblxuICAgICAgdmFyIGN1ckNvbCwgbmV4dENvbCA9IDAsIGN1ckNvbFRleCwgbmV4dENvbFRleCA9IDA7XG4gICAgICBsYXN0WSA9IDE7XG4gICAgICBmb3IgKHZhciBkaXYgPSAwOyBkaXYgPCBkaXZzOyArK2Rpdikge1xuXG4gICAgICAgIGN1ckNvbCA9IG5leHRDb2w7XG4gICAgICAgIGN1ckNvbFRleCAgPSBuZXh0Q29sVGV4O1xuXG4gICAgICAgIG5leHRDb2xUZXggPSAoZGl2ICsgMSkgLyBkaXZzO1xuXG4gICAgICAgIGlmKHRoaXMucGVyc3BlY3RpdmUpe1xuICAgICAgICAgIG5leHRDb2wgPSBjdXJDb2wgKyBsYXN0WSAvIF90b3RhbERpc3RhbmNlWTtcbiAgICAgICAgICBsYXN0WSAqPSBfcGVyc3BlY3RpdmVZO1xuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICBuZXh0Q29sID0gbmV4dENvbFRleDtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBkQ3VyWCA9IGN1clJvd1gyIC0gY3VyUm93WDE7XG4gICAgICAgIHZhciBkQ3VyWSA9IGN1clJvd1kyIC0gY3VyUm93WTE7XG4gICAgICAgIHZhciBkTmV4dFggPSBuZXh0Um93WDIgLSBuZXh0Um93WDE7XG4gICAgICAgIHZhciBkTmV4dFkgPSBuZXh0Um93WTIgLSBuZXh0Um93WTE7XG5cbiAgICAgICAgdmFyIHAxeCA9IGN1clJvd1gxICsgZEN1clggKiBjdXJDb2wgO1xuICAgICAgICB2YXIgcDF5ID0gY3VyUm93WTEgKyBkQ3VyWSAqIGN1ckNvbCArIHRoaXMuX2dldEN1cnZlT2Zmc2V0KGN1ckNvbCkueTtcblxuICAgICAgICB2YXIgcDJ4ID0gY3VyUm93WDEgKyAoY3VyUm93WDIgLSBjdXJSb3dYMSkgKiBuZXh0Q29sO1xuICAgICAgICB2YXIgcDJ5ID0gY3VyUm93WTEgKyAoY3VyUm93WTIgLSBjdXJSb3dZMSkgKiBuZXh0Q29sICsgdGhpcy5fZ2V0Q3VydmVPZmZzZXQobmV4dENvbCkueTtcblxuICAgICAgICB2YXIgcDN4ID0gbmV4dFJvd1gxICsgZE5leHRYICogbmV4dENvbDtcbiAgICAgICAgdmFyIHAzeSA9IG5leHRSb3dZMSArIGROZXh0WSAqIG5leHRDb2wgICsgdGhpcy5fZ2V0Q3VydmVPZmZzZXQobmV4dENvbCkueTtcblxuICAgICAgICB2YXIgcDR4ID0gbmV4dFJvd1gxICsgZE5leHRYICogY3VyQ29sO1xuICAgICAgICB2YXIgcDR5ID0gbmV4dFJvd1kxICsgZE5leHRZICogY3VyQ29sICArIHRoaXMuX2dldEN1cnZlT2Zmc2V0KGN1ckNvbCkueTtcblxuICAgICAgICB2YXIgdTEgPSBjdXJDb2xUZXggKiBpbWdXO1xuICAgICAgICB2YXIgdTIgPSBuZXh0Q29sVGV4ICogaW1nVztcbiAgICAgICAgdmFyIHYxID0gY3VyUm93VGV4ICogaW1nSDtcbiAgICAgICAgdmFyIHYyID0gbmV4dFJvd1RleCAqIGltZ0g7XG5cbiAgICAgICAgdmFyIHRyaWFuZ2xlMSA9IHtcbiAgICAgICAgICBwMDoge3g6IHAxeCwgeTogcDF5fSxcbiAgICAgICAgICBwMToge3g6IHAzeCwgeTogcDN5fSxcbiAgICAgICAgICBwMjoge3g6IHA0eCwgeTogcDR5fSxcbiAgICAgICAgICB0MDoge3U6IHUxLCB2OiB2MX0sXG4gICAgICAgICAgdDE6IHt1OiB1MiwgdjogdjJ9LFxuICAgICAgICAgIHQyOiB7dTogdTEsIHY6IHYyfVxuICAgICAgICB9O1xuXG4gICAgICAgIHZhciB0cmlhbmdsZTIgPSB7XG4gICAgICAgICAgcDA6IHt4OiBwMXggLCB5OiBwMXl9LFxuICAgICAgICAgIHAxOiB7eDogcDJ4ICwgeTogcDJ5fSxcbiAgICAgICAgICBwMjoge3g6IHAzeCAsIHk6IHAzeX0sXG4gICAgICAgICAgdDA6IHt1OiB1MSAgLHY6IHYxfSxcbiAgICAgICAgICB0MToge3U6IHUyICAsdjogdjF9LFxuICAgICAgICAgIHQyOiB7dTogdTIgICx2OiB2Mn1cbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLl90cmlhbmdsZXMucHVzaCh0cmlhbmdsZTEpO1xuICAgICAgICB0aGlzLl90cmlhbmdsZXMucHVzaCh0cmlhbmdsZTIpO1xuICAgICAgfVxuICAgIH1cbiAgfVxufTtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vbWl4aW5zL1RyYW5zZm9ybWVkSW1hZ2VNaXhpbi5qc1xuLy8gbW9kdWxlIGlkID0gNTNcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiLyoqXG4gKlxuICovXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5PYmplY3QucHJvdG90eXBlLCB7XG4gIGluYWN0aXZlT3B0aW9uczogbnVsbCxcbiAgYWN0aXZlT3B0aW9uczogbnVsbCxcbiAgZXZlbnRMaXN0ZW5lcnM6IGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmRBcnJheXNPYmplY3QoZmFicmljLk9iamVjdC5wcm90b3R5cGUuZXZlbnRMaXN0ZW5lcnMsIHtcbiAgICBhZGRlZDogZnVuY3Rpb24gKCkge1xuICAgICAgaWYodGhpcy5hY3RpdmUpe1xuICAgICAgICB0aGlzLmFjdGl2ZU9wdGlvbnMgJiYgdGhpcy5zZXQodGhpcy5hY3RpdmVPcHRpb25zKTtcbiAgICAgIH1lbHNle1xuICAgICAgICB0aGlzLmluYWN0aXZlT3B0aW9ucyAmJiB0aGlzLnNldCh0aGlzLmluYWN0aXZlT3B0aW9ucyk7XG4gICAgICB9XG4gICAgfSxcbiAgICBkZXNlbGVjdGVkOiBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLmluYWN0aXZlT3B0aW9ucyAmJiB0aGlzLnNldCh0aGlzLmluYWN0aXZlT3B0aW9ucyk7XG4gICAgfSxcbiAgICBzZWxlY3RlZDogZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5hY3RpdmVPcHRpb25zICYmIHRoaXMuc2V0KHRoaXMuYWN0aXZlT3B0aW9ucyk7XG4gICAgfVxuICB9KVxufSk7XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL21vZHVsZXMvYWN0aXZhdGUuanNcbi8vIG1vZHVsZSBpZCA9IDU0XG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIid1c2Ugc3RyaWN0JztcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuU2xpZGVDYW52YXMucHJvdG90eXBlLCB7XG4gIF91cGRhdGVfY2xpcF9yZWN0OiBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKHRoaXMuYXJlYXMgfHwgIXRoaXMubGF5ZXJzLmJhY2tncm91bmQub2JqZWN0c1swXSkgcmV0dXJuO1xuICAgIHZhciBnZW9tZXRyeSA9IHRoaXMuZ2V0UmVjdCh0aGlzLm9mZnNldHMpO1xuICAgIHRoaXMubGF5ZXJzLmJhY2tncm91bmQub2JqZWN0c1swXS5zZXQoZ2VvbWV0cnkpO1xuICB9LFxuICBvZmZzZXRzOiB7bGVmdCA6IDAsdG9wIDogMCwgcmlnaHQ6IDAsIGJvdHRvbTowfSxcbiAgc2V0SGVscGVyczogZnVuY3Rpb24gKGhlbHBlcnMsIGNhbGxiYWNrKSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIGlmKGhlbHBlcnMpe1xuICAgICAgZm9yICh2YXIgaSBpbiBoZWxwZXJzKXtcbiAgICAgICAgZmFicmljLnV0aWwuY3JlYXRlT2JqZWN0KGhlbHBlcnNbaV0sZnVuY3Rpb24oaGVscGVyKXtcbiAgICAgICAgICBzZWxmLmxheWVycy5iYWNrZ3JvdW5kLm9iamVjdHMucHVzaChoZWxwZXIpO1xuICAgICAgICAgIHNlbGYucmVuZGVyQWxsKCk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgICBjYWxsYmFjayAmJiBjYWxsYmFjaygpO1xuICB9LFxuICBhcmVhQWN0aXZhdGluZzogZmFsc2UsXG4gIGFkZEVsZW1lbnRzSW5zaWRlQWN0aXZlQXJlYTogZmFsc2UsXG4gIGFyZWFQcm9wZXJ0aWVzOiB7XG4gICAgb3JpZ2luWDogJ2xlZnQnLFxuICAgIG9yaWdpblk6ICd0b3AnLFxuICAgIGZpbGw6ICd0cmFuc3BhcmVudCcsXG4gICAgc3Ryb2tlRGFzaEFycmF5OiBbNSwgNV0sXG4gICAgc3Ryb2tlV2lkdGg6IDEsXG4gICAgc3Ryb2tlOiAnYmxhY2snLFxuICAgIHJlc2l6YWJsZTogdHJ1ZVxuICAgIC8vc2VsZWN0YWJsZTogZmFsc2VcbiAgfSxcbiAgc2V0QXJlYVByb3BlcnR5OiBmdW5jdGlvbiAocHJvcGVydHksIHZhbHVlKSB7XG4gICAgdGhpc1tcImFyZWFfXCIgKyBwcm9wZXJ0eV0gPSB2YWx1ZTtcbiAgICBmb3IgKHZhciBpIGluIHRoaXMubGF5ZXJzLmJhY2tncm91bmQub2JqZWN0cykge1xuICAgICAgdGhpcy5sYXllcnMuYmFja2dyb3VuZC5vYmplY3RzW2ldW3Byb3BlcnR5XSA9IHZhbHVlO1xuICAgIH1cbiAgICB0aGlzLnJlbmRlckFsbCgpO1xuICB9LFxuICBzZXRBY3RpdmVBcmVhOiBmdW5jdGlvbiAoYXJlYSkge1xuICAgIGlmIChhcmVhID09PSB0cnVlKSB7XG4gICAgICBhcmVhID0gdGhpcy5sYXllcnMuYmFja2dyb3VuZC5vYmplY3RzWzBdIHx8IG51bGw7XG4gICAgfVxuICAgIGlmICh0aGlzLmFjdGl2ZUFyZWEpIHtcbiAgICAgIHRoaXMuYWN0aXZlQXJlYS5zZXRTdHJva2UoXCIjMDAwXCIpO1xuICAgIH1cbiAgICB0aGlzLmFjdGl2ZUFyZWEgPSBhcmVhO1xuICAgIGlmIChhcmVhKSB7XG4gICAgICBhcmVhLnNldFN0cm9rZShcIiNCN0YxRURcIik7XG4gICAgfVxuICB9LFxuICBzZXRBcmVhQWN0aXZhdGluZzogZnVuY3Rpb24gKHZhbHVlLyosIGZvcmNlKi8pIHtcbiAgICAvL3RvZG8gZm9yY2VcbiAgICB2YXIgZm9yY2UgPSB0cnVlO1xuICAgIGlmIChmb3JjZSB8fCAodmFsdWUgJiYgIXRoaXMuYXJlYUFjdGl2YXRpbmcpKSB7XG4gICAgICB0aGlzLmFyZWFBY3RpdmF0aW5nID0gdHJ1ZTtcbiAgICAgIHRoaXMub24oXCJvYmplY3Q6bW9kaWZpZWRcIiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgaWYodGhpcy5lZGl0aW5nT2JqZWN0KXtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgLy90b2RvIGV2ZW50ISDQvdC1INGK0L7RgtC10Lsg0LHRiyDRjdGC0L4g0YLRg9GCINC40YHQv9C+0LvRjNC+0LLQsNGC0Yws0L3QviDRgNCw0LHQvtGC0LDQtdGCXG4gICAgICAgIHZhciBwb2ludGVyID0gdGhpcy5nZXRQb2ludGVyKGV2ZW50LCB0cnVlKTtcbiAgICAgICAgdmFyIHRhcmdldCA9IHRoaXMuX3NlYXJjaFBvc3NpYmxlVGFyZ2V0cyh0aGlzLmxheWVycy5iYWNrZ3JvdW5kLm9iamVjdHMsIHBvaW50ZXIpO1xuICAgICAgICBpZih0aGlzLl9jdXJyZW50VHJhbnNmb3JtICYmIHRhcmdldCAmJiB0aGlzLnRhcmdldC5tb3ZlbWVudExpbWl0cyAhPSB0YXJnZXQpe1xuICAgICAgICAgIHRoaXMudGFyZ2V0Lm1vdmVtZW50TGltaXRzID0gdGhpcy50YXJnZXQuY2xpcFRvID0gdGFyZ2V0O1xuICAgICAgICAgIHRoaXMuc2V0QWN0aXZlQXJlYSh0YXJnZXQpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHRoaXMub24oXCJtb3VzZTpkb3duXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHZhciBwb2ludGVyID0gdGhpcy5nZXRQb2ludGVyKGUuZSwgdHJ1ZSk7XG4gICAgICAgIHZhciB0YXJnZXQgPSB0aGlzLl9zZWFyY2hQb3NzaWJsZVRhcmdldHModGhpcy5sYXllcnMuYmFja2dyb3VuZC5vYmplY3RzLCBwb2ludGVyKTtcbiAgICAgICAgaWYgKHRhcmdldCkge1xuICAgICAgICAgIHRoaXMuc2V0QWN0aXZlQXJlYSh0YXJnZXQpO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgIH1cbiAgfSxcbiAgX3VwZGF0ZV9hcmVhX2dlb21ldHJ5OiBmdW5jdGlvbihlbCxvcHRpb25zKXtcbiAgICBpZiAob3B0aW9ucy5wYXRoKSB7XG5cbiAgICAgIG9wdGlvbnMud2lkdGggPSBvcHRpb25zLndpZHRoIHx8IGVsLndpZHRoO1xuICAgICAgdmFyIGdlb21ldHJ5ID0gdGhpcy5nZXRSZWN0KG9wdGlvbnMpO1xuICAgICAgdmFyIF9zY2FsZSA9IGVsLndpZHRoIC8gZ2VvbWV0cnkud2lkdGg7XG4gICAgICBlbC5zZXQoe1xuICAgICAgICBsZWZ0OiBnZW9tZXRyeS5sZWZ0ICwvLy8qIGVsLmxlZnQgKiBfc2NhbGUqLyxcbiAgICAgICAgdG9wOiBnZW9tZXRyeS50b3AgLC8vKyBlbC50b3AgKiBfc2NhbGUsXG4gICAgICAgIHNjYWxlWDogX3NjYWxlLFxuICAgICAgICBzY2FsZVk6IF9zY2FsZVxuICAgICAgfSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHZhciBnZW9tZXRyeSA9IHRoaXMuZ2V0UmVjdChvcHRpb25zKTtcblxuICAgIGlmKG9wdGlvbnMuc3JjKXtcbiAgICAgIHZhciBfc2NhbGUgPSBnZW9tZXRyeS53aWR0aCAvIGltZy53aWR0aDtcbiAgICAgIGVsLnNldCh7XG4gICAgICAgIGxlZnQ6IGdlb21ldHJ5LmxlZnQsLy8gKyBlbC5sZWZ0ICogX3NjYWxlLFxuICAgICAgICB0b3A6IGdlb21ldHJ5LnRvcCAsLy8rIGVsLnRvcCAqIF9zY2FsZSxcbiAgICAgICAgc3Ryb2tlV2lkdGg6IHRoaXMuYXJlYVByb3BlcnRpZXMuc3Ryb2tlV2lkdGggLyBfc2NhbGUsXG4gICAgICAgIHNjYWxlWDogX3NjYWxlLFxuICAgICAgICBzY2FsZVk6IF9zY2FsZVxuICAgICAgfSk7XG4gICAgfWVsc2V7XG4gICAgICBlbC5zZXQoZ2VvbWV0cnkpO1xuICAgIH1cbiAgfSxcbiAgY3JlYXRlQXJlYTogZnVuY3Rpb24gKGFyZWEsIGNhbGxiYWNrKSB7XG5cbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgdmFyIF9maW5hbGl6ZSA9IGZ1bmN0aW9uIChwYXRoKSB7XG4gICAgICBwYXRoLmlkID0gYXJlYS5pZDtcbiAgICAgIGFyZWEuaW5zdGFuY2UgPSBwYXRoO1xuICAgICAgcGF0aC5sYXllciA9IFwiYmFja2dyb3VuZFwiO1xuICAgICAgX3RoaXMuYWRkKHBhdGgpO1xuICAgICAgdGhpcy5fdXBkYXRlX2FyZWFfZ2VvbWV0cnkocGF0aCxhcmVhKTtcbiAgICAgIC8vIF90aGlzLl9iYWNrZ3JvdW5kTGF5ZXIucHVzaChwYXRoKTtcbiAgICAgIC8vIHBhdGguY2FudmFzID0gX3RoaXM7XG4gICAgICBjYWxsYmFjaygpO1xuICAgIH0uYmluZCh0aGlzKTtcblxuICAgIHZhciBjcmVhdGVDbGlwUGF0aCA9IGZ1bmN0aW9uIChpbWcpIHtcbiAgICAgIGNsaXBGaWxsZXIuc2V0SW1hZ2UoaW1nKTtcbiAgICAgIGNsaXBGaWxsZXIubWFzayA9IE1hZ2ljV2FuZC5zZWxlY3RCYWNrZ3JvdW5kKGNsaXBGaWxsZXIuZ2V0SW5mbygpLCBudWxsLCAxNSk7XG5cbiAgICAgIHZhciBjb250b3VycyA9IGNsaXBGaWxsZXIuZ2V0Q29udG91cnMoKTtcbiAgICAgIHZhciBjbGlwUG9pbnRzID0gY29udG91cnNbMV0ucG9pbnRzO1xuICAgICAgdmFyIHBhdGhEYXRhID0gZmFicmljLlBlbmNpbEJydXNoLnByb3RvdHlwZS5jb252ZXJ0UG9pbnRzVG9TVkdQYXRoKGNsaXBQb2ludHMpLmpvaW4oJycpOy8vdG9kb1xuICAgICAgdmFyIHBhdGggPSBuZXcgZmFicmljLlBhdGgocGF0aERhdGEsIF90aGlzLmFyZWFQcm9wZXJ0aWVzKTtcblxuICAgICAgLy9wYXRoLnBvaW50cyA9IGNsaXBQb2ludHM7XG4gICAgICByZXR1cm4gcGF0aDtcbiAgICB9O1xuXG4gICAgaWYgKGFyZWEucGF0aCkge1xuICAgICAgdmFyIHBhdGggPSBuZXcgZmFicmljLlBhdGgoYXJlYS5wYXRoLCB0aGlzLmFyZWFQcm9wZXJ0aWVzKTtcbiAgICAgIGFyZWEudG9wID0gcGF0aC50b3A7XG4gICAgICBhcmVhLmxlZnQgPSBwYXRoLmxlZnQ7XG4gICAgICBhcmVhLndpZHRoID0gcGF0aC53aWR0aDtcbiAgICAgIGFyZWEuaGVpZ2h0ID0gcGF0aC5oZWlnaHQ7XG4gICAgICBfZmluYWxpemUocGF0aCk7ICBcbiAgICB9IGVsc2UgaWYgKGFyZWEuc3JjKSB7XG4gICAgICB2YXIgY2xpcEZpbGxlciA9IG5ldyBmYWJyaWMuUGF0aGZpbmRlcih7fSk7XG4gICAgICBmYWJyaWMudXRpbC5sb2FkSW1hZ2UoYXJlYS5zcmMsIGZ1bmN0aW9uIChpbWcpIHtcbiAgICAgICAgdmFyIHBhdGggPSBjcmVhdGVDbGlwUGF0aChpbWcpO1xuICAgICAgICBfZmluYWxpemUocGF0aCk7XG4gICAgICB9KTtcblxuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgcGF0aCA9IG5ldyBmYWJyaWMuUmVjdCh0aGlzLmFyZWFQcm9wZXJ0aWVzKTtcbiAgICAgIF9maW5hbGl6ZShwYXRoKTtcbiAgICB9XG5cblxuXG4gICAgaWYoKCBhcmVhLnJpZ2h0IHx8IGFyZWEuYm90dG9tIHx8IGFyZWEucGF0aCApICYmICghdGhpcy5vcmlnaW5hbFdpZHRoICB8fCAhdGhpcy5vcmlnaW5hbEhlaWdodCkgKXtcbiAgICAgIHRoaXMub24oXCJiYWNrZ3JvdW5kLWltYWdlOmxvYWRlZFwiLGZ1bmN0aW9uKCl7XG4gICAgICAgIHRoaXMuX3VwZGF0ZV9hcmVhX2dlb21ldHJ5KHBhdGgsYXJlYSk7XG4gICAgICB0aGlzLnJlbmRlckFsbCgpO1xuICAgICAgfS5iaW5kKHRoaXMpKVxuICAgIH1cblxuICAgIC8qXG4gICAgIGFwcC5jYW52YXMuc2V0T2Zmc2V0cyh7XG4gICAgIHJpZ2h0OiAgMSxcbiAgICAgbGVmdDogICAxLFxuICAgICB0b3A6ICAgIDEsXG4gICAgIGJvdHRvbTogMVxuICAgICB9KTtcblxuXG4gICAgIGFwcC5jYW52YXMuY2xpcFRvID0gZnVuY3Rpb24gKGN0eCkge1xuICAgICB2YXIgem9vbSA9IGFwcC5jYW52YXNfY29uZmlnLndpZHRoIC8gYXBwLmNhbnZhcy5iYWNrZ3JvdW5kSW1hZ2UuZmlsdGVyc1swXS5wYXRoZmluZGVyLm1hc2sud2lkdGg7XG4gICAgIGN0eC5zYXZlKCk7XG4gICAgIGN0eC5zY2FsZSh6b29tLCB6b29tKTtcbiAgICAgYXBwLmNsaXBGaWxsZXIudHJhY2VJbm5lcihjdHgpO1xuICAgICBjdHgucmVzdG9yZSgpO1xuICAgICB9OyovXG4gIH0sXG4gIHJlbW92ZUFyZWE6IGZ1bmN0aW9uIChhcmVhLCBjYWxsYmFjaykge1xuXG4gICAgdmFyIG9ianMgPSB0aGlzLmdldE9iamVjdHMoKTtcbiAgICBmb3IgKHZhciBpIGluIG9ianMpIHtcbiAgICAgIGlmIChvYmpzW2ldLm1vdmVtZW50TGltaXRzID09IGFyZWEpIHtcbiAgICAgICAgZGVsZXRlIG9ianNbaV0ubW92ZW1lbnRMaW1pdHM7XG4gICAgICB9XG4gICAgICBpZiAob2Jqc1tpXS5jbGlwVG8gPT0gYXJlYSkge1xuICAgICAgICAvL2lmKG9ianNbaV0ub2xjQ2xpcFRvSUQpe1xuICAgICAgICAvLyAgICBvYmpzW2ldLmNsaXBUb0lEID0gb2Jqc1tpXS5vbGRDbGlwVG9JRDtcbiAgICAgICAgLy99XG4gICAgICAgIGRlbGV0ZSBvYmpzW2ldLmNsaXBUbztcbiAgICAgICAgLy9vYmpzW2ldLm9sY0NsaXBUb0lEID0gYXJlYS5pZDtcbiAgICAgIH1cbiAgICB9XG4gICAgYXJlYS5yZW1vdmUoKTtcbiAgfSxcbiAgc2V0T2Zmc2V0czogZnVuY3Rpb24gKG9mZnNldHMsIGNhbGxiYWNrKSB7XG4gICAgaWYob2Zmc2V0cyl7XG4gICAgICB0aGlzLm9mZnNldHMgPSBvZmZzZXRzO1xuICAgICAgdGhpcy5zZXRBcmVhcyhbb2Zmc2V0c10sIGNhbGxiYWNrKTtcbiAgICB9ZWxzZXtcbiAgICAgIGNhbGxiYWNrKClcbiAgICB9XG4gIH0sXG4gIHNldEFyZWFzOiBmdW5jdGlvbiAoYXJlYXMsIGNhbGxiYWNrKSB7XG4gICAgYXJlYXMgPSBhcmVhcyB8fCBbXTtcbiAgICBpZiAodGhpcy5hcmVhcykge1xuICAgICAgZm9yICh2YXIgaSA9IHRoaXMuYXJlYXMubGVuZ3RoOyBpLS07KSB7XG4gICAgICAgIHRoaXMucmVtb3ZlQXJlYSh0aGlzLmFyZWFzW2ldLmluc3RhbmNlKTtcbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy5hcmVhcyA9IGFyZWFzO1xuXG4gICAgdmFyIGNiID0gZmFicmljLnV0aWwucXVldWVMb2FkKGFyZWFzLmxlbmd0aCArIDEsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmICh0aGlzLmFyZWFBY3RpdmF0aW5nKSB7XG4gICAgICAgIGlmICh0aGlzLmxheWVycy5iYWNrZ3JvdW5kLm9iamVjdHNbMF0pIHtcbiAgICAgICAgICB0aGlzLnNldEFjdGl2ZUFyZWEodHJ1ZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5hY3RpdmVBcmVhID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICB2YXIgb2JqcyA9IHRoaXMuZ2V0T2JqZWN0cygpO1xuLy93b3JrIHdpdGggb2JqZWN0XG4gICAgICBpZiAoIWFyZWFzLmxlbmd0aCkge1xuICAgICAgICBvYmpzLmxlbmd0aCAmJiB0aGlzLmNsZWFyKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgX2FyZWEgPSB0aGlzLmFjdGl2ZUFyZWEgfHwgdGhpcy5sYXllcnMuYmFja2dyb3VuZC5vYmplY3RzWzBdO1xuICAgICAgICBmb3IgKHZhciBpIGluIG9ianMpIHtcbiAgICAgICAgICB2YXIgb2JqID0gb2Jqc1tpXTtcbiAgICAgICAgICBvYmouY2xpcFRvID0gX2FyZWE7XG4gICAgICAgICAgb2JqLnNldE1vdmVtZW50TGltaXRzKF9hcmVhKTtcbiAgICAgICAgICBvYmouc2V0Q29vcmRzKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrLmNhbGwodGhpcyk7XG4gICAgfS5iaW5kKHRoaXMpKTtcblxuICAgIGZvciAodmFyIGkgaW4gYXJlYXMpIHtcbiAgICAgIGlmICghYXJlYXNbaV0uaWQpIHtcbiAgICAgICAgYXJlYXNbaV0uaWQgPSBcIl9fXCIgKyBpO1xuICAgICAgfVxuICAgICAgdGhpcy5jcmVhdGVBcmVhKGFyZWFzW2ldLCBjYik7XG4gICAgfVxuICAgIGNiKCk7XG5cbiAgICB0aGlzLnJlbmRlckFsbCgpO1xuICB9LFxuICBzcGVjaWFsUHJvcGVydGllczogZmFicmljLlNsaWRlQ2FudmFzLnByb3RvdHlwZS5zcGVjaWFsUHJvcGVydGllcy5jb25jYXQoW1wib2Zmc2V0c1wiLFwiYXJlYXNcIixcImhlbHBlcnNcIixcImFyZWFBY3RpdmF0aW5nXCJdKVxufSlcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vbW9kdWxlcy9hcmVhcy5qc1xuLy8gbW9kdWxlIGlkID0gNTVcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiJ3VzZSBzdHJpY3QnO1xuXG5cblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuT2JqZWN0LnByb3RvdHlwZSwge1xuICAvLyBzcGVjaWFsUHJvcGVydGllczogZmFicmljLk9iamVjdC5wcm90b3R5cGUuc3BlY2lhbFByb3BlcnRpZXMuY29uY2F0KFtcInJlbGF0aXZlT2JqZWN0XCIsXCJyZWxhdGl2ZVRvcFwiLFwicmVsYXRpdmVMZWZ0XCIsXCJyb3RhdGluZ1N0ZXBcIl0pLFxuICAvKipcbiAgICog77+977+977+977+977+977+977+977+977+977+977+9IO+/ve+/ve+/ve+/ve+/ve+/ve+/ve+/vSDvv73vv73vv73vv73vv73vv70gNDUg77+977+977+977+977+977+977+977+9XG4gICAqL1xuICBfc3RlcF9Sb3RhdGluZzogZnVuY3Rpb24gKGFuZ2xlKSB7XG4gICAgdmFyIF9hID0gdGhpcy5nZXRBbmdsZSgpO1xuXG4gICAgdmFyIHggPSBwYXJzZUludChfYSAvIGFuZ2xlKSAqIGFuZ2xlO1xuICAgIGlmIChfYSAtIHggPCBhbmdsZSAvIGFuZ2xlKSB7XG4gICAgICB0aGlzLnNldEFuZ2xlKHgpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnNldEFuZ2xlKHggKyBhbmdsZSk7XG4gICAgfVxuICB9LFxuICBzZXRSb3RhdGluZ1N0ZXA6IGZ1bmN0aW9uKHZhbHVlKXtcbiAgICB0aGlzLnJvdGF0aW5nU3RlcCA9IHZhbHVlO1xuICAgIHRoaXMub24oXCJyb3RhdGluZ1wiLCBmdW5jdGlvbihlKXtcbiAgICAgIGlmKCFlLmUuc2hpZnRLZXkpe1xuICAgICAgICB0aGlzLl9zdGVwX1JvdGF0aW5nKHZhbHVlKVxuICAgICAgfVxuICAgIH0pO1xuICB9LFxuICB1cGRhdGVSZWxhdGl2ZUNvb3JkaW5hdGVzOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5zZXRDb29yZHMoKTtcbiAgICB2YXIgX2MgPSB0aGlzLnJlbGF0aXZlT2JqZWN0LmdldENlbnRlclBvaW50KCk7XG4gICAgdGhpcy5yZWxhdGl2ZUxlZnQgPSB0aGlzLmxlZnQgLSBfYy54O1xuICAgIHRoaXMucmVsYXRpdmVUb3AgPSB0aGlzLnRvcCAtIF9jLnk7XG4gIH0sXG4gIHNldFJlbGF0aXZlVG9wOiBmdW5jdGlvbih2YWwpIHtcbiAgICB0aGlzLnJlbGF0aXZlVG9wID0gdmFsO1xuICAgIGlmKHRoaXMucmVsYXRpdmVPYmplY3Qpe1xuICAgICAgdGhpcy5yZWxhdGl2ZU9iamVjdC51cGRhdGVCaW5kZWRPYmplY3QodGhpcyk7XG4gICAgfVxuICB9LFxuICBzZXRSZWxhdGl2ZUxlZnQ6IGZ1bmN0aW9uKHZhbCkge1xuICAgIHRoaXMucmVsYXRpdmVMZWZ0ID0gdmFsO1xuICAgIGlmKHRoaXMucmVsYXRpdmVPYmplY3Qpe1xuICAgICAgdGhpcy5yZWxhdGl2ZU9iamVjdC51cGRhdGVCaW5kZWRPYmplY3QodGhpcyk7XG4gICAgfVxuICB9LFxuICB1cGRhdGVCaW5kZWRPYmplY3Q6IGZ1bmN0aW9uKHRhZykge1xuICAgIHZhciBfYyA9IHRoaXMuZ2V0Q2VudGVyUG9pbnQoKTtcbiAgICB0YWcubGVmdCA9IF9jLnggKyB0YWcucmVsYXRpdmVMZWZ0O1xuICAgIHRhZy50b3AgPSBfYy55ICAgKyB0YWcucmVsYXRpdmVUb3A7XG4gICAgdGFnLnNldENvb3JkcygpO1xuICB9LFxuICBzZXRSZWxhdGl2ZU9iamVjdDogZnVuY3Rpb24ob2JqKXtcbiAgICB2YXIgdGFnID0gdGhpcztcblxuXG4gICAgaWYgKG9iai5jb25zdHJ1Y3RvciA9PT0gU3RyaW5nKSB7XG4gICAgICB0aGlzLm9uKFwiYWRkZWRcIixmdW5jdGlvbigpe1xuICAgICAgICBvYmogPSB0aGlzLmNhbnZhcy5nZXRPYmplY3RCeUlEKG9iai5zdWJzdHJpbmcoMSkpO1xuICAgICAgICB0aGlzLnNldFJlbGF0aXZlT2JqZWN0KG9iaik7XG4gICAgICB9KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB2YXIgX2ZvbyA9IG9iai51cGRhdGVCaW5kZWRPYmplY3QuYmluZChvYmosdGFnKTtcblxuICAgIHRoaXMucmVsYXRpdmVPYmplY3QgPSBvYmo7XG5cblxuICAgIGlmKCF0aGlzLnJlbGF0aXZlTGVmdCB8fCAhdGhpcy5yZWxhdGl2ZVRvcCkge1xuICAgICAgdmFyIF9ib3VuZFJlY3QgPSBvYmouZ2V0Qm91bmRpbmdSZWN0KCk7XG4gICAgfVxuICAgIGlmKCF0aGlzLnJlbGF0aXZlTGVmdCkge1xuICAgICAgdGhpcy5yZWxhdGl2ZUxlZnQgPSB0aGlzLmxlZnQgPyBvYmoubGVmdCAtIHRoaXMubGVmdCA6IF9ib3VuZFJlY3Qud2lkdGgvMiAvIG9iai5jYW52YXMuZ2V0Wm9vbSgpICsgMjA7XG4gICAgfVxuICAgIGlmKCF0aGlzLnJlbGF0aXZlVG9wKXtcbiAgICAgIHRoaXMucmVsYXRpdmVUb3AgPSB0aGlzLnRvcCA/IG9iai50b3AgLSB0aGlzLnRvcCA6IF9ib3VuZFJlY3QuaGVpZ2h0LzIgLyBvYmouY2FudmFzLmdldFpvb20oKSArIDIwO1xuICAgIH07XG5cbiAgICB0YWcub24oJ3JlbW92ZWQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgX3Byb2MgPSB0aGlzLmNhbnZhcy5wcm9jZXNzaW5nO1xuICAgICAgaWYoIV9wcm9jKXRoaXMuY2FudmFzLnByb2Nlc3NpbmcgPSB0cnVlO1xuICAgICAgb2JqLnJlbW92ZSgpO1xuICAgICAgaWYoIV9wcm9jKXRoaXMuY2FudmFzLnByb2Nlc3NpbmcgPSBmYWxzZTtcbiAgICAgIC8vIG9iai5vZmYoJ21vdmluZycsIF9mb28pO1xuICAgICAgLy8gb2JqLm9mZignc2NhbGluZycsIF9mb28pO1xuICAgICAgLy8gb2JqLm9mZigncm90YXRpbmcnLCBfZm9vKTtcbiAgICB9KTtcbiAgICBvYmoub24oJ2FkZGVkJywgZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIF9wcm9jID0gdGhpcy5jYW52YXMucHJvY2Vzc2luZztcbiAgICAgIGlmKCFfcHJvYyl0aGlzLmNhbnZhcy5wcm9jZXNzaW5nID0gdHJ1ZTtcbiAgICAgIHRoaXMuY2FudmFzLmFkZCh0YWcpO1xuICAgICAgaWYoIV9wcm9jKXRoaXMuY2FudmFzLnByb2Nlc3NpbmcgPSBmYWxzZTtcbiAgICB9KTtcbiAgICBvYmoub24oJ3JlbW92ZWQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgX3Byb2MgPSB0aGlzLmNhbnZhcy5wcm9jZXNzaW5nO1xuICAgICAgaWYoIV9wcm9jKXRoaXMuY2FudmFzLnByb2Nlc3NpbmcgPSB0cnVlO1xuICAgICAgdGFnLnJlbW92ZSgpO1xuICAgICAgaWYoIV9wcm9jKXRoaXMuY2FudmFzLnByb2Nlc3NpbmcgPSBmYWxzZTtcbiAgICB9KTtcbiAgICBvYmoub24oJ21vdmluZyByb3RhdGluZyBzY2FsaW5nIG1vZGlmaWVkJywgX2Zvbyk7XG4gICAgdGFnLm9uKCdtb3Zpbmcgcm90YXRpbmcgc2NhbGluZyBtb2RpZmllZCcsIHRhZy51cGRhdGVSZWxhdGl2ZUNvb3JkaW5hdGVzKTtcblxuICAgIG9iai51cGRhdGVCaW5kZWRPYmplY3QodGFnKTtcbiAgfVxufSk7XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL21vZHVsZXMvYmluZC5qc1xuLy8gbW9kdWxlIGlkID0gNTZcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiJ3VzZSBzdHJpY3QnO1xuXG5cbi8qKlxuICAgKiBEcmF3IENTUzMgYm9yZGVyIGltYWdlIG9uIGNhbnZhcy5cbiAgICogQHBhcmFtIGNhbnZhcyAgICB7SFRNTENhbnZhc0VsZW1lbnR9XG4gICAqIEBwYXJhbSBpbWcgICAgICAge0hUTUxJbWFnZUVsZW1lbnR9IGJvcmRlci1pbWFnZS1zb3VyY2UgaW1hZ2VcbiAgICogQHBhcmFtIG9wdGlvbnMgICB7T2JqZWN0fVxuICAgKiAgICAgIHNsaWNlIHtBcnJheX0gYm9yZGVyLWltYWdlLXNsaWNlIHZhbHVlc1xuICAgKiAgICAgIHdpZHRoIHtBcnJheX0gYm9yZGVyLWltYWdlLXdpZHRoIHZhbHVlc1xuICAgKiAgICAgIG91dHNldCB7QXJyYXl9IGJvcmRlci1pbWFnZS1vdXRzZXQgdmFsdWVzXG4gICAqICAgICAgcmVwZWF0IHtBcnJheX0gYm9yZGVyLWltYWdlLXJlcGVhdCB2YWx1ZXNcbiAgICogQHBhcmFtIHNpemUgICAgICB7T2JqZWN0fVxuICAgKi9cbiAgIGZhYnJpYy51dGlsLmRyYXdCb3JkZXJJbWFnZSAgPSBmdW5jdGlvbihjYW52YXMsIGltZywgb3B0aW9ucyl7XG5cblxuICAgIHZhciBvcHRpb25zID0gZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCh7XG4gICAgICBcInNsaWNlXCI6ICAgICAgICBbMjUsMjUsMjUsMjVdLFxuICAgICAgXCJ3aWR0aFwiOiAgICAgICAgWzI1LDI1LDI1LDI1XSxcbiAgICAgIFwiZmlsbFwiOiAgICAgICAgIGZhbHNlLFxuICAgICAgXCJyZXBlYXRcIjogICAgICAgW1wicm91bmRcIixcInJvdW5kXCJdLFxuICAgICAgXCJvdXRzZXRfdmFsdWVzXCJcdDogWzAsIDAsIDAsIDBdLFxuICAgICAgXCJzbGljZV91bml0c1wiICAgOiBbMCwgMCwgMCwgMF0sXG4gICAgICBcIndpZHRoX3VuaXRzXCJcdDogWzAsIDAsIDAsIDBdLFxuICAgICAgXCJvdXRzZXRfdW5pdHNcIlx0OiBbMCwgMCwgMCwgMF0sXG4gICAgICBcInNpemVcIlx0XHRcdDogW2NhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodF1cbiAgICB9LG9wdGlvbnMpXG5cblxuICAgIHZhciB3ID0gaW1nLndpZHRoO1xuICAgIHZhciBoID0gaW1nLmhlaWdodDtcblxuICAgIHZhciBjdHggPSBjYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpO1xuICAgIHZhciBzbGljZSA9IG9wdGlvbnMuc2xpY2U7XG4gICAgdmFyIHdpZHRoID0gb3B0aW9ucy53aWR0aDtcblxuICAgIHZhciB3MiA9IG9wdGlvbnMuc2l6ZVswXTtcbiAgICB2YXIgaDIgPSBvcHRpb25zLnNpemVbMV07XG5cblxuICAgIGlmKG9wdGlvbnMuc2xpY2VfdW5pdHNbMF0gPT0gMSlzbGljZVswXSAqPSAgaCAvIDEwMDtcbiAgICBpZihvcHRpb25zLnNsaWNlX3VuaXRzWzFdID09IDEpc2xpY2VbMV0gKj0gIHcgLyAxMDA7XG4gICAgaWYob3B0aW9ucy5zbGljZV91bml0c1syXSA9PSAxKXNsaWNlWzJdICo9ICBoIC8gMTAwO1xuICAgIGlmKG9wdGlvbnMuc2xpY2VfdW5pdHNbM10gPT0gMSlzbGljZVszXSAqPSAgdyAvIDEwMDtcblxuICAgIGlmKG9wdGlvbnMud2lkdGhfdW5pdHNbMF0gPT0gMSl3aWR0aFswXSAqPSBoMiAvIDEwMDtcbiAgICBpZihvcHRpb25zLndpZHRoX3VuaXRzWzFdID09IDEpd2lkdGhbMV0gKj0gdzIgLyAxMDA7XG4gICAgaWYob3B0aW9ucy53aWR0aF91bml0c1syXSA9PSAxKXdpZHRoWzJdICo9IGgyIC8gMTAwO1xuICAgIGlmKG9wdGlvbnMud2lkdGhfdW5pdHNbM10gPT0gMSl3aWR0aFszXSAqPSB3MiAvIDEwMDtcblxuXG4gICAgZnVuY3Rpb24gZHJhd1NpZGUoc2lkZSxzbGljZU9mZnNldCxzbGljZVdpZHRoLCBkcmF3T2Zmc2V0LGRyYXdXaWR0aCl7XG4gICAgICB2YXIgZDtcbiAgICAgIGlmKHNpZGUgPT0gMCkge1xuICAgICAgICBkID0gW3NsaWNlWzNdICsgc2xpY2VPZmZzZXQsIDAsIHNsaWNlV2lkdGgsICBzbGljZVswXSxcbiAgICAgICAgICB3aWR0aFszXSArIGRyYXdPZmZzZXQsIDAsIGRyYXdXaWR0aCwgIHdpZHRoWzBdXVxuICAgICAgfVxuICAgICAgaWYoc2lkZSA9PSAyKXtcbiAgICAgICAgZCA9IFtzbGljZVszXSArIHNsaWNlT2Zmc2V0LCBoIC0gc2xpY2VbMl0gLHNsaWNlV2lkdGgsICBzbGljZVsyXSxcbiAgICAgICAgICB3aWR0aFszXSArIGRyYXdPZmZzZXQsIGgyIC0gd2lkdGhbMl0sZHJhd1dpZHRoLCB3aWR0aFsyXV1cbiAgICAgIH1cbiAgICAgIGlmKHNpZGUgPT0gMSkge1xuICAgICAgICBkID0gWyB3IC0gc2xpY2VbMV0sIHNsaWNlWzBdICsgc2xpY2VPZmZzZXQsICBzbGljZVsxXSwgc2xpY2VXaWR0aCxcbiAgICAgICAgICB3MiAtIHdpZHRoWzFdLCB3aWR0aFswXSArIGRyYXdPZmZzZXQsd2lkdGhbMV0sIGRyYXdXaWR0aF07XG4gICAgICB9XG4gICAgICBpZihzaWRlID09IDMpIHtcbiAgICAgICAgZCA9IFsgMCwgc2xpY2VbMF0gKyBzbGljZU9mZnNldCwgIHNsaWNlWzNdLCBzbGljZVdpZHRoLFxuICAgICAgICAgIDAsIHdpZHRoWzBdICsgZHJhd09mZnNldCwgd2lkdGhbM10sZHJhd1dpZHRoXTtcbiAgICAgIH1cbiAgICAgIGN0eC5kcmF3SW1hZ2UoaW1nLGRbMF0sZFsxXSxkWzJdLGRbM10sZFs0XSxkWzVdLGRbNl0sZFs3XSlcbiAgICB9XG5cblxuICAgIGZ1bmN0aW9uIF9kcmF3X2JvcmRlcl9zaWRlKHNpZGUpe1xuICAgICAgdmFyIF90b3Bfd2lkdGgsIF90b3Bfc2xpY2UsIHJlcGVhdDtcbiAgICAgIGlmKHNpZGUgPT0gMCB8fCBzaWRlID09IDIpe1xuICAgICAgICBfdG9wX3dpZHRoID0gdzIgLSB3aWR0aFsxXS0gd2lkdGhbM107XG4gICAgICAgIF90b3Bfc2xpY2UgID0gIHcgLSBzbGljZVsxXSAtIHNsaWNlWzNdO1xuICAgICAgICByZXBlYXQgPSBvcHRpb25zLnJlcGVhdFswXTtcbiAgICAgIH1lbHNle1xuICAgICAgICBfdG9wX3dpZHRoID0gaDIgLSB3aWR0aFswXS0gd2lkdGhbMl07XG4gICAgICAgIF90b3Bfc2xpY2UgID0gIGggLSBzbGljZVswXSAtIHNsaWNlWzJdO1xuICAgICAgICByZXBlYXQgPSBvcHRpb25zLnJlcGVhdFsxXTtcbiAgICAgIH1cblxuXG4gICAgICBpZihyZXBlYXQgPT0gXCJzdHJldGNoXCIpe1xuICAgICAgICByZXR1cm4gZHJhd1NpZGUoc2lkZSwgMCwgIF90b3Bfc2xpY2UgLCAgMCwgICAgIF90b3Bfd2lkdGgpO1xuICAgICAgfVxuXG4gICAgICB2YXIgX2FzcGVjdCA9ICAgc2xpY2Vbc2lkZV0gLyB3aWR0aFtzaWRlXTtcbiAgICAgIHZhciBfb25lX3dpZHRoID0gIF90b3Bfc2xpY2UgKiAgd2lkdGhbc2lkZV0gLyBzbGljZVtzaWRlXSA7XG4gICAgICB2YXIgY291bnQgPSAxO1xuICAgICAgdmFyIF9sZWZ0ID0gMDtcblxuICAgICAgaWYocmVwZWF0ID09IFwicmVwZWF0XCIpe1xuXG4gICAgICAgIHZhciBfcmVzdCA9IF9vbmVfd2lkdGggLSBfdG9wX3dpZHRoICUgX29uZV93aWR0aCAvIDI7XG4gICAgICAgIHZhciBfcmVzdF9hc3BlY3QgID0gX2FzcGVjdCAqIF9yZXN0O1xuICAgICAgICBjb3VudCA9ICBNYXRoLmZsb29yKF90b3Bfd2lkdGggLyBfb25lX3dpZHRoKTtcblxuXG4gICAgICAgIGlmKF9yZXN0ID4gMCl7XG4gICAgICAgICAgZHJhd1NpZGUoc2lkZSwgX3Jlc3RfYXNwZWN0ICwgIF90b3Bfc2xpY2UgLSBfcmVzdF9hc3BlY3QsICAwLCAgICAgX29uZV93aWR0aCAtIF9yZXN0KVxuICAgICAgICB9XG5cbiAgICAgICAgX2xlZnQgPSAgX29uZV93aWR0aCAtIF9yZXN0O1xuXG4gICAgICAgIGZvcih2YXIgaSA9IDAgOyBpPCBjb3VudDtpICsrKXtcbiAgICAgICAgICBkcmF3U2lkZSggc2lkZSwwLCAgIF90b3Bfc2xpY2UgLCAgX2xlZnQsICAgICBfb25lX3dpZHRoKTtcbiAgICAgICAgICBfbGVmdCArPV9vbmVfd2lkdGg7XG4gICAgICAgIH1cblxuICAgICAgICBpZihfcmVzdCA+IDApe1xuICAgICAgICAgIGRyYXdTaWRlKHNpZGUsICAwICwgICAgX3RvcF9zbGljZSAtIF9yZXN0X2FzcGVjdCwgIF9sZWZ0LCAgICBfb25lX3dpZHRoIC0gX3Jlc3QgKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYocmVwZWF0ID09IFwicm91bmRcIil7XG5cbiAgICAgICAgX2xlZnQgPSAwO1xuICAgICAgICBjb3VudCA9ICBNYXRoLm1heCgxLE1hdGgucm91bmQoX3RvcF93aWR0aCAvIF9vbmVfd2lkdGgpKTtcbiAgICAgICAgX29uZV93aWR0aCA9IF90b3Bfd2lkdGggLyBjb3VudDtcblxuICAgICAgICB3aGlsZShfbGVmdCA8IF90b3Bfd2lkdGgpe1xuICAgICAgICAgIGRyYXdTaWRlKHNpZGUsMCwgICAgIF90b3Bfc2xpY2UgLCAgX2xlZnQsICAgICBfb25lX3dpZHRoICk7XG4gICAgICAgICAgX2xlZnQgKz1fb25lX3dpZHRoO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgX2RyYXdfYm9yZGVyX3NpZGUoMCk7XG4gICAgX2RyYXdfYm9yZGVyX3NpZGUoMik7XG4gICAgX2RyYXdfYm9yZGVyX3NpZGUoMSk7XG4gICAgX2RyYXdfYm9yZGVyX3NpZGUoMyk7XG5cbiAgLy90b3AgbGVmdFxuICAgIGN0eC5kcmF3SW1hZ2UoaW1nLCAwLCAwLCBzbGljZVszXSwgc2xpY2VbMF0sIDAsIDAsIHdpZHRoWzNdLCB3aWR0aFswXSk7XG4gIC8vdG9wIHJpZ2h0XG4gICAgY3R4LmRyYXdJbWFnZShpbWcsIHcgLSBzbGljZVsxXSwgMCwgc2xpY2VbMV0sIHNsaWNlWzBdLFxuICAgICAgdzIgLSB3aWR0aFsxXSwgMCwgd2lkdGhbMV0sIHdpZHRoWzBdKTtcbiAgLy9ib3R0b20gbGVmdFxuICAgIGN0eC5kcmF3SW1hZ2UoaW1nLCAwLCBoIC0gc2xpY2VbMl0sIHNsaWNlWzNdLCBzbGljZVsyXSxcbiAgICAgIDAsIGgyIC0gd2lkdGhbMl0sIHdpZHRoWzNdLCB3aWR0aFsyXSk7XG5cbiAgLy9ib3R0b20gcmlnaHRcbiAgICBjdHguZHJhd0ltYWdlKGltZywgdyAtIHNsaWNlWzFdLCBoIC0gc2xpY2VbMl0sIHNsaWNlWzFdLCBzbGljZVsyXSxcbiAgICAgIHcyIC0gd2lkdGhbMV0sIGgyIC0gd2lkdGhbMl0sIHdpZHRoWzFdLCB3aWR0aFsyXSk7XG5cbiAgfVxuXG4gIC8qXG4gICB2YXIgRnJhbWUgPSBmdW5jdGlvbihwcm9qZWN0LGRhdGEpe1xuXG4gICBpZihkYXRhLmJvcmRlcl9pbWFnZSl7XG4gICBkYXRhLmJvcmRlcl9pbWFnZSA9IG1peGluKCB7XG4gICBcInNsaWNlXCI6ICAgICAgICAgIFsyNSwyNSwyNSwyNV0sXG4gICBcIndpZHRoXCI6ICAgICAgICAgIFsyNSwyNSwyNSwyNV0sXG4gICBcImZpbGxcIjogICAgICAgICAgIGZhbHNlLFxuICAgXCJyZXBlYXRcIjogICAgICAgICBbXCJyb3VuZFwiLFwicm91bmRcIl0sXG4gICBcIm91dHNldFwiXHQ6ICAgICBbMCwgMCwgMCwgMF0sXG4gICBcInNsaWNlX3VuaXRzXCIgICA6IFswLCAwLCAwLCAwXSxcbiAgIFwid2lkdGhfdW5pdHNcIlx0OiBbMCwgMCwgMCwgMF0sXG4gICBcIm91dHNldF91bml0c1wiXHQ6IFswLCAwLCAwLCAwXVxuICAgfSwgZGF0YS5ib3JkZXJfaW1hZ2UpXG4gICB9XG5cblxuICAgdGhpcy5zdXBlcmNsYXNzLmNvbnN0cnVjdG9yLmNhbGwodGhpcyxwcm9qZWN0LGRhdGEpO1xuICAgdGhpcy5fYWRkX3Jvb3QoXCJtYXNrXCIpO1xuICAgdGhpcy5fYWRkX3Jvb3QoXCJpbWFnZVwiKTtcbiAgIHRoaXMuZXhhbXBsZSA9IHRoaXMuX2dldF9leGFtcGxlKCk7XG5cbiAgIH07Ki9cbiAgZmFicmljLnV0aWwuZ2V0T2Zmc2V0c0NsaXBQYXRoID0gZnVuY3Rpb24obykge1xuXG4gICAgcmV0dXJuIFsnTScsIG9bM10sIG9bMF0sICdMJywgMTAwIC0gb1sxXSwgb1swXSwgJ0wnLCAxMDAgLSBvWzFdLCAxMDAgLSBvWzJdLCAnTCcsIG9bM10sIDEwMCAtIG9bMl0sICd6J10uam9pbihcIiBcIik7XG4gIH07XG5cbiAgZmFicmljLnV0aWwuZ2V0UmFkaXVzQ2xpcFBhdGggPSBmdW5jdGlvbihyYWRpdXMscmFkaXVzX3VuaXRzLCB3aWR0aCxoZWlnaHQpIHtcblxuICB2YXIgYnIgID0gcmFkaXVzO1xuICB2YXIgYnJ1ID0gcmFkaXVzX3VuaXRzIHx8IFsxLDEsMSwxLDEsMSwxLDFdO1xuXG5cblxuICB2YXIgcyA9IHtcbiAgICBcInRvcC1sZWZ0LWhcIjogICAgIGJyWzBdICogKGJydVswXSA/IGhlaWdodCAvIDEwMCA6IDEpLFxuICAgIFwidG9wLWxlZnQtd1wiOiAgICAgYnJbMV0gKiAoYnJ1WzFdID8gd2lkdGggLyAxMDAgOiAxKSxcbiAgICBcInRvcC1yaWdodC1oXCI6ICAgIGJyWzJdICogKGJydVsyXSA/IGhlaWdodCAvIDEwMCA6IDEpLFxuICAgIFwidG9wLXJpZ2h0LXdcIjogICAgYnJbM10gKiAoYnJ1WzNdID8gd2lkdGggLyAxMDAgOiAxKSxcbiAgICBcImJvdHRvbS1yaWdodC13XCI6IGJyWzRdICogKGJydVs0XSA/IHdpZHRoIC8gMTAwIDogMSksXG4gICAgXCJib3R0b20tcmlnaHQtaFwiOiBicls1XSAqIChicnVbNV0gPyBoZWlnaHQgLyAxMDAgOiAxKSxcbiAgICBcImJvdHRvbS1sZWZ0LXdcIjogIGJyWzZdICogKGJydVs2XSA/IHdpZHRoIC8gMTAwIDogMSksXG4gICAgXCJib3R0b20tbGVmdC1oXCI6ICBicls3XSAqIChicnVbN10gPyBoZWlnaHQgLyAxMDAgOiAxKVxuICB9O1xuXG4gIHJldHVybiBbXG4gICAgXCJNXCIsIDAsIHNbXCJ0b3AtbGVmdC1oXCJdLFxuICAgIFwiQ1wiLCAwLCBzW1widG9wLWxlZnQtaFwiXSwgMCwgMCwgc1tcInRvcC1sZWZ0LXdcIl0sIDAsXG4gICAgXCJIXCIsIHdpZHRoIC0gc1tcInRvcC1yaWdodC13XCJdLFxuICAgIFwiQ1wiLCB3aWR0aCAtIHNbXCJ0b3AtcmlnaHQtd1wiXSwgMCwgd2lkdGgsIDAsIHdpZHRoLCBzW1widG9wLXJpZ2h0LWhcIl0sXG4gICAgXCJWXCIsIGhlaWdodCAtIHNbXCJib3R0b20tcmlnaHQtaFwiXSxcbiAgICBcIkNcIiwgd2lkdGgsIGhlaWdodCAtIHNbXCJib3R0b20tcmlnaHQtaFwiXSwgd2lkdGgsIGhlaWdodCwgd2lkdGggLSBzW1wiYm90dG9tLXJpZ2h0LXdcIl0sIGhlaWdodCxcbiAgICBcIkhcIiwgc1tcImJvdHRvbS1sZWZ0LXdcIl0sXG4gICAgXCJDXCIsIHNbXCJib3R0b20tbGVmdC13XCJdLCBoZWlnaHQsIDAsIGhlaWdodCwgMCwgaGVpZ2h0IC0gc1tcImJvdHRvbS1sZWZ0LWhcIl0sXG4gICAgXCJaXCJcbiAgXS5qb2luKFwiIFwiKTtcbn07XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL21vZHVsZXMvYm9yZGVySW1hZ2UuanNcbi8vIG1vZHVsZSBpZCA9IDU3XG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIid1c2Ugc3RyaWN0JztcblxuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5DYW52YXMucHJvdG90eXBlLCB7XG4gICAgZW5hYmxlQ2xpcEFyZWFab29taW5nOiBmdW5jdGlvbigpe1xuICAgICAgLy90b2RvXG4gICAgICAvLyB0aGlzLm9uKCd2aWV3cG9ydDpzY2FsZWQnLCBmdW5jdGlvbigpe1xuICAgICAgLy8gICBpZiAoIXRoaXMubGF5ZXIoXCJiYWNrZ3JvdW5kXCIpLm9iamVjdHMpIHJldHVybjtcbiAgICAgIC8vICAgdGhpcy5fYmFja2dyb3VuZExheWVyWzBdLnNldENvb3JkcygpO1xuICAgICAgLy8gfSk7XG4gICAgfSxcbiAgICBfZmFicmljX2NsaXBfZnVuY3Rpb246IGZ1bmN0aW9uIChjdHgyKSB7XG5cbiAgICAgIHZhciBjbGlwUmVjdCA9IHRoaXMuY2xpcFJlY3Q7XG4gICAgICBjdHgyLnNhdmUoKTtcbiAgICAgIGNsaXBSZWN0LnJlbmRlcihjdHgyKTtcbiAgICAgIGN0eDIucmVzdG9yZSgpO1xuXG4gICAgfVxuICB9KTtcblxuZmFicmljLk9iamVjdC5wcm90b3R5cGUuc2V0Q2xpcFRvID0gZnVuY3Rpb24odmFsKSB7XG4gIGlmICh0eXBlb2YgdmFsICE9PSAnc3RyaW5nJykge1xuICAgIHRoaXMuY2xpcFRvID0gdmFsO1xuICB9XG5cbiAgdmFyIGZ1bmN0aW9uQm9keSA9IGZhYnJpYy51dGlsLmdldEZ1bmN0aW9uQm9keSh2YWwpO1xuICBpZiAodHlwZW9mIGZ1bmN0aW9uQm9keSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICB0aGlzLmNsaXBUbyA9IG5ldyBGdW5jdGlvbignY3R4JywgZnVuY3Rpb25Cb2R5KTtcbiAgfVxufTtcblxuLyoqXG4gKiBAcHJpdmF0ZVxuICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXSBPcHRpb25zIG9iamVjdFxuICovXG5mYWJyaWMuT2JqZWN0LnByb3RvdHlwZS5faW5pdENsaXBwaW5nID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgaWYgKCFvcHRpb25zLmNsaXBUbyB8fCB0eXBlb2Ygb3B0aW9ucy5jbGlwVG8gIT09ICdzdHJpbmcnKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIGlmIChvcHRpb25zLmNsaXBUb1swXSA9PSAnIycpIHtcbiAgICAvLyAgdmFyIF9pZCA9IG9wdGlvbnMuY2xpcFRvWzBdLnN1YnN0cmluZygxKTtcbiAgICB0aGlzLmNsaXBUbyA9IG9wdGlvbnMuY2xpcFRvO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHZhciBmdW5jdGlvbkJvZHkgPSBmYWJyaWMudXRpbC5nZXRGdW5jdGlvbkJvZHkob3B0aW9ucy5jbGlwVG8pO1xuICBpZiAodHlwZW9mIGZ1bmN0aW9uQm9keSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICB0aGlzLmNsaXBUbyA9IG5ldyBGdW5jdGlvbignY3R4JywgZnVuY3Rpb25Cb2R5KTtcbiAgfVxufTtcbmZhYnJpYy5PYmplY3QucHJvdG90eXBlLmdldENsaXBUbyA9IGZ1bmN0aW9uICgpIHtcbiAgcmV0dXJuIFwiI1wiICsgdGhpcy5jbGlwVG8uaWQ7XG59XG5cbmZhYnJpYy51dGlsLmNsaXBDb250ZXh0ID0gZnVuY3Rpb24gKHJlY2VpdmVyLCBjdHgpIHtcbiAgY3R4LnNhdmUoKTtcbiAgY3R4LmJlZ2luUGF0aCgpO1xuXG4gIGlmIChyZWNlaXZlci5jbGlwVG8uY29uc3RydWN0b3IgPT09IFN0cmluZykge1xuICAgIHZhciBfaWQgPSByZWNlaXZlci5jbGlwVG8uc3Vic3RyaW5nKDEpO1xuXG4gICAgdmFyIF9jbGlwQ3R4ID0gcmVjZWl2ZXIuY2FudmFzLmdldE9iamVjdEJ5SUQoX2lkKTtcbiAgICBpZihfY2xpcEN0eCl7XG4gICAgICByZWNlaXZlci5jbGlwVG8gPSBfY2xpcEN0eDtcbiAgICB9ZWxzZXtcbiAgICAgIGNvbnNvbGUud2FybihcImVycm9yOiBjbGlwVG8gbm90IGZvdW5kXCIgKyByZWNlaXZlci5jbGlwVG8pO1xuICAgICAgZGVsZXRlIHJlY2VpdmVyLmNsaXBUbztcbiAgICB9XG4gIH1cblxuICBpZiAocmVjZWl2ZXIuY2xpcFRvLmNvbnN0cnVjdG9yID09PSBGdW5jdGlvbikge1xuICAgIHJlY2VpdmVyLmNsaXBUbyhjdHgpO1xuICB9IGVsc2Uge1xuICAgIGZhYnJpYy51dGlsLl9jbGlwVG9PYmplY3QocmVjZWl2ZXIsIGN0eClcbiAgICBjdHguY2xpcCgpO1xuICB9XG5cbn07XG5cbmZhYnJpYy51dGlsLl9jbGlwVG9PYmplY3QgPSBmdW5jdGlvbiAocmVjZWl2ZXIsIGN0eCkge1xuICBjdHguc2F2ZSgpO1xuICBjdHguYmVnaW5QYXRoKCk7XG5cbiAgdmFyIGZyb21MZWZ0ID0gZmFsc2U7XG4gIHZhciBjZW50ZXIgPSBmcm9tTGVmdCA/IHJlY2VpdmVyLl9nZXRMZWZ0VG9wQ29vcmRzKCkgOiByZWNlaXZlci5nZXRDZW50ZXJQb2ludCgpO1xuICBjdHgudHJhbnNmb3JtKDEsIE1hdGgudGFuKGZhYnJpYy51dGlsLmRlZ3JlZXNUb1JhZGlhbnMoLXJlY2VpdmVyLnNrZXdZKSksIDAsIDEsIDAsIDApO1xuICBjdHgudHJhbnNmb3JtKDEsIDAsIE1hdGgudGFuKGZhYnJpYy51dGlsLmRlZ3JlZXNUb1JhZGlhbnMoLXJlY2VpdmVyLnNrZXdYKSksIDEsIDAsIDApO1xuICBjdHguc2NhbGUoXG4gICAgKDEgLyByZWNlaXZlci5zY2FsZVgpICogKHJlY2VpdmVyLmZsaXBYID8gLTEgOiAxKSxcbiAgICAoMSAvIHJlY2VpdmVyLnNjYWxlWSkgKiAocmVjZWl2ZXIuZmxpcFkgPyAtMSA6IDEpXG4gICk7XG4gIGN0eC5yb3RhdGUoZmFicmljLnV0aWwuZGVncmVlc1RvUmFkaWFucygtcmVjZWl2ZXIuYW5nbGUpKTtcbiAgY3R4LnRyYW5zbGF0ZSgtY2VudGVyLngsIC1jZW50ZXIueSk7XG5cblxuICBpZiAocmVjZWl2ZXIuY2xpcFRvLnBvaW50cykge1xuICAgIHZhciBwcyA9IHJlY2VpdmVyLmNsaXBUby5wb2ludHM7XG4gICAgY3R4Lm1vdmVUbyhwc1swXS54LCBwc1swXS55KTtcbiAgICBmb3IgKHZhciBqID0gMTsgaiA8IHBzLmxlbmd0aDsgaisrKSB7XG4gICAgICBjdHgubGluZVRvKHBzW2pdLngsIHBzW2pdLnkpO1xuICAgIH1cbiAgICAvL2N0eC5zdHJva2UoKTtcbiAgfSBlbHNlIGlmIChyZWNlaXZlci5jbGlwVG8udHlwZSA9PSBcInBhdGhcIikge1xuXG4gICAgY3R4Lmdsb2JhbEFscGhhID0gMDtcbiAgICByZWNlaXZlci5jbGlwVG8udHJhbnNmb3JtKGN0eCk7XG4gICAgcmVjZWl2ZXIuY2xpcFRvLl9yZW5kZXIoY3R4KTtcbiAgfSBlbHNlIGlmIChyZWNlaXZlci5jbGlwVG8udHlwZSA9PSBcInBhdGgtZ3JvdXBcIikge1xuICAgIGN0eC5nbG9iYWxBbHBoYSA9IDA7XG4gICAgcmVjZWl2ZXIuY2xpcFRvLnRyYW5zZm9ybShjdHgpO1xuICAgIGN0eC50cmFuc2xhdGUoLXJlY2VpdmVyLmNsaXBUby53aWR0aC8yLCAtcmVjZWl2ZXIuY2xpcFRvLmhlaWdodC8yKTtcbiAgICBmb3IgKHZhciBpID0gMCwgbCA9IHJlY2VpdmVyLmNsaXBUby5wYXRocy5sZW5ndGg7IGkgPCBsOyArK2kpIHtcbiAgICAgIHJlY2VpdmVyLmNsaXBUby5wYXRoc1tpXS5yZW5kZXIoY3R4LCB0cnVlKTtcbiAgICB9XG4gIH1lbHNlIHtcbiAgICBjdHgudHJhbnNsYXRlKHJlY2VpdmVyLmNsaXBUby5sZWZ0LCByZWNlaXZlci5jbGlwVG8udG9wKTtcbiAgICBjdHgucm90YXRlKC0ocmVjZWl2ZXIuY2xpcFRvLmFuZ2xlICogLTEpICogTWF0aC5QSSAvIDE4MCk7XG4gICAgY3R4LnJlY3QoMCwwLCByZWNlaXZlci5jbGlwVG8ud2lkdGgsIHJlY2VpdmVyLmNsaXBUby5oZWlnaHQpO1xuICB9XG5cbiAgY3R4LmNsb3NlUGF0aCgpO1xuICBjdHgucmVzdG9yZSgpO1xufTtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vbW9kdWxlcy9jbGlwVG8uanNcbi8vIG1vZHVsZSBpZCA9IDU4XG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsImZhYnJpYy5Db2xvck5hbWVNYXAgPSB7fTtcblxuZmFicmljLkNvbG9yTmFtZU1hcC5wcm90b3R5cGUgPSBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5Db2xvci5jb2xvck5hbWVNYXAsIHtcbiAgICBcImFsaWNlYmx1ZVwiOiBcIiNmMGY4ZmZcIixcbiAgICBcImFudGlxdWV3aGl0ZVwiOiBcIiNmYWViZDdcIixcbiAgICBcImFxdWFcIjogXCIjMDBmZmZmXCIsXG4gICAgXCJhcXVhbWFyaW5lXCI6IFwiIzdmZmZkNFwiLFxuICAgIFwiYXp1cmVcIjogXCIjZjBmZmZmXCIsXG4gICAgXCJiZWlnZVwiOiBcIiNmNWY1ZGNcIixcbiAgICBcImJpc3F1ZVwiOiBcIiNmZmU0YzRcIixcbiAgICBcImJsYWNrXCI6IFwiIzAwMDAwMFwiLFxuICAgIFwiYmxhbmNoZWRhbG1vbmRcIjogXCIjZmZlYmNkXCIsXG4gICAgXCJibHVlXCI6IFwiIzAwMDBmZlwiLFxuICAgIFwiYmx1ZXZpb2xldFwiOiBcIiM4YTJiZTJcIixcbiAgICBcImJyb3duXCI6IFwiI2E1MmEyYVwiLFxuICAgIFwiYnVybHl3b29kXCI6IFwiI2RlYjg4N1wiLFxuICAgIFwiY2FkZXRibHVlXCI6IFwiIzVmOWVhMFwiLFxuICAgIFwiY2hhcnRyZXVzZVwiOiBcIiM3ZmZmMDBcIixcbiAgICBcImNob2NvbGF0ZVwiOiBcIiNkMjY5MWVcIixcbiAgICBcImNvcmFsXCI6IFwiI2ZmN2Y1MFwiLFxuICAgIFwiY29ybmZsb3dlcmJsdWVcIjogXCIjNjQ5NWVkXCIsXG4gICAgXCJjb3Juc2lsa1wiOiBcIiNmZmY4ZGNcIixcbiAgICBcImNyaW1zb25cIjogXCIjZGMxNDNjXCIsXG4gICAgXCJjeWFuXCI6IFwiIzAwZmZmZlwiLFxuICAgIFwiZGFya2JsdWVcIjogXCIjMDAwMDhiXCIsXG4gICAgXCJkYXJrY3lhblwiOiBcIiMwMDhiOGJcIixcbiAgICBcImRhcmtnb2xkZW5yb2RcIjogXCIjYjg4NjBiXCIsXG4gICAgXCJkYXJrZ3JheVwiOiBcIiNhOWE5YTlcIixcbiAgICBcImRhcmtncmVlblwiOiBcIiMwMDY0MDBcIixcbiAgICBcImRhcmtraGFraVwiOiBcIiNiZGI3NmJcIixcbiAgICBcImRhcmttYWdlbnRhXCI6IFwiIzhiMDA4YlwiLFxuICAgIFwiZGFya29saXZlZ3JlZW5cIjogXCIjNTU2YjJmXCIsXG4gICAgXCJkYXJrb3JhbmdlXCI6IFwiI2ZmOGMwMFwiLFxuICAgIFwiZGFya29yY2hpZFwiOiBcIiM5OTMyY2NcIixcbiAgICBcImRhcmtyZWRcIjogXCIjOGIwMDAwXCIsXG4gICAgXCJkYXJrc2FsbW9uXCI6IFwiI2U5OTY3YVwiLFxuICAgIFwiZGFya3NlYWdyZWVuXCI6IFwiIzhmYmM4ZlwiLFxuICAgIFwiZGFya3NsYXRlYmx1ZVwiOiBcIiM0ODNkOGJcIixcbiAgICBcImRhcmtzbGF0ZWdyYXlcIjogXCIjMmY0ZjRmXCIsXG4gICAgXCJkYXJrdHVycXVvaXNlXCI6IFwiIzAwY2VkMVwiLFxuICAgIFwiZGFya3Zpb2xldFwiOiBcIiM5NDAwZDNcIixcbiAgICBcImRlZXBwaW5rXCI6IFwiI2ZmMTQ5M1wiLFxuICAgIFwiZGVlcHNreWJsdWVcIjogXCIjMDBiZmZmXCIsXG4gICAgXCJkaW1ncmF5XCI6IFwiIzY5Njk2OVwiLFxuICAgIFwiZG9kZ2VyYmx1ZVwiOiBcIiMxZTkwZmZcIixcbiAgICBcImZpcmVicmlja1wiOiBcIiNiMjIyMjJcIixcbiAgICBcImZsb3JhbHdoaXRlXCI6IFwiI2ZmZmFmMFwiLFxuICAgIFwiZm9yZXN0Z3JlZW5cIjogXCIjMjI4YjIyXCIsXG4gICAgXCJmdWNoc2lhXCI6IFwiI2ZmMDBmZlwiLFxuICAgIFwiZ2FpbnNib3JvXCI6IFwiI2RjZGNkY1wiLFxuICAgIFwiZ2hvc3R3aGl0ZVwiOiBcIiNmOGY4ZmZcIixcbiAgICBcImdvbGRcIjogXCIjZmZkNzAwXCIsXG4gICAgXCJnb2xkZW5yb2RcIjogXCIjZGFhNTIwXCIsXG4gICAgXCJncmF5XCI6IFwiIzgwODA4MFwiLFxuICAgIFwiZ3JlZW5cIjogXCIjMDA4MDAwXCIsXG4gICAgXCJncmVlbnllbGxvd1wiOiBcIiNhZGZmMmZcIixcbiAgICBcImhvbmV5ZGV3XCI6IFwiI2YwZmZmMFwiLFxuICAgIFwiaG90cGlua1wiOiBcIiNmZjY5YjRcIixcbiAgICBcImluZGlhbnJlZFwiOiBcIiNjZDVjNWNcIixcbiAgICBcImluZGlnb1wiOiBcIiM0YjAwODJcIixcbiAgICBcIml2b3J5XCI6IFwiI2ZmZmZmMFwiLFxuICAgIFwia2hha2lcIjogXCIjZjBlNjhjXCIsXG4gICAgXCJsYXZlbmRlclwiOiBcIiNlNmU2ZmFcIixcbiAgICBcImxhdmVuZGVyYmx1c2hcIjogXCIjZmZmMGY1XCIsXG4gICAgXCJsYXduZ3JlZW5cIjogXCIjN2NmYzAwXCIsXG4gICAgXCJsZW1vbmNoaWZmb25cIjogXCIjZmZmYWNkXCIsXG4gICAgXCJsaWdodGJsdWVcIjogXCIjYWRkOGU2XCIsXG4gICAgXCJsaWdodGNvcmFsXCI6IFwiI2YwODA4MFwiLFxuICAgIFwibGlnaHRjeWFuXCI6IFwiI2UwZmZmZlwiLFxuICAgIFwibGlnaHRnb2xkZW5yb2R5ZWxsb3dcIjogXCIjZmFmYWQyXCIsXG4gICAgXCJsaWdodGdyZXlcIjogXCIjZDNkM2QzXCIsXG4gICAgXCJsaWdodGdyZWVuXCI6IFwiIzkwZWU5MFwiLFxuICAgIFwibGlnaHRwaW5rXCI6IFwiI2ZmYjZjMVwiLFxuICAgIFwibGlnaHRzYWxtb25cIjogXCIjZmZhMDdhXCIsXG4gICAgXCJsaWdodHNlYWdyZWVuXCI6IFwiIzIwYjJhYVwiLFxuICAgIFwibGlnaHRza3libHVlXCI6IFwiIzg3Y2VmYVwiLFxuICAgIFwibGlnaHRzbGF0ZWdyYXlcIjogXCIjNzc4ODk5XCIsXG4gICAgXCJsaWdodHN0ZWVsYmx1ZVwiOiBcIiNiMGM0ZGVcIixcbiAgICBcImxpZ2h0eWVsbG93XCI6IFwiI2ZmZmZlMFwiLFxuICAgIFwibGltZVwiOiBcIiM3RkJBMDBcIixcbiAgICBcImxpbWVncmVlblwiOiBcIiMzMmNkMzJcIixcbiAgICBcImxpbmVuXCI6IFwiI2ZhZjBlNlwiLFxuICAgIFwibWFnZW50YVwiOiBcIiNmZjAwZmZcIixcbiAgICBcIm1hcm9vblwiOiBcIiM4MDAwMDBcIixcbiAgICBcIm1lZGl1bWFxdWFtYXJpbmVcIjogXCIjNjZjZGFhXCIsXG4gICAgXCJtZWRpdW1ibHVlXCI6IFwiIzAwMDBjZFwiLFxuICAgIFwibWVkaXVtb3JjaGlkXCI6IFwiI2JhNTVkM1wiLFxuICAgIFwibWVkaXVtcHVycGxlXCI6IFwiIzkzNzBkOFwiLFxuICAgIFwibWVkaXVtc2VhZ3JlZW5cIjogXCIjM2NiMzcxXCIsXG4gICAgXCJtZWRpdW1zbGF0ZWJsdWVcIjogXCIjN2I2OGVlXCIsXG4gICAgXCJtZWRpdW1zcHJpbmdncmVlblwiOiBcIiMwMGZhOWFcIixcbiAgICBcIm1lZGl1bXR1cnF1b2lzZVwiOiBcIiM0OGQxY2NcIixcbiAgICBcIm1lZGl1bXZpb2xldHJlZFwiOiBcIiNjNzE1ODVcIixcbiAgICBcIm1pZG5pZ2h0Ymx1ZVwiOiBcIiMxOTE5NzBcIixcbiAgICBcIm1pbnRjcmVhbVwiOiBcIiNmNWZmZmFcIixcbiAgICBcIm1pc3R5cm9zZVwiOiBcIiNmZmU0ZTFcIixcbiAgICBcIm1vY2Nhc2luXCI6IFwiI2ZmZTRiNVwiLFxuICAgIFwibmF2YWpvd2hpdGVcIjogXCIjZmZkZWFkXCIsXG4gICAgXCJuYXZ5XCI6IFwiIzAwMDA4MFwiLFxuICAgIFwib2xkbGFjZVwiOiBcIiNmZGY1ZTZcIixcbiAgICBcIm9saXZlXCI6IFwiIzgwODAwMFwiLFxuICAgIFwib2xpdmVkcmFiXCI6IFwiIzZiOGUyM1wiLFxuICAgIFwib3JhbmdlXCI6IFwiI2ZmYTUwMFwiLFxuICAgIFwib3JhbmdlcmVkXCI6IFwiI2ZmNDUwMFwiLFxuICAgIFwib3JjaGlkXCI6IFwiI2RhNzBkNlwiLFxuICAgIFwicGFsZWdvbGRlbnJvZFwiOiBcIiNlZWU4YWFcIixcbiAgICBcInBhbGVncmVlblwiOiBcIiM5OGZiOThcIixcbiAgICBcInBhbGV0dXJxdW9pc2VcIjogXCIjYWZlZWVlXCIsXG4gICAgXCJwYWxldmlvbGV0cmVkXCI6IFwiI2Q4NzA5M1wiLFxuICAgIFwicGFwYXlhd2hpcFwiOiBcIiNmZmVmZDVcIixcbiAgICBcInBlYWNocHVmZlwiOiBcIiNmZmRhYjlcIixcbiAgICBcInBlcnVcIjogXCIjY2Q4NTNmXCIsXG4gICAgXCJwaW5rXCI6IFwiI2ZmYzBjYlwiLFxuICAgIFwicGx1bVwiOiBcIiNkZGEwZGRcIixcbiAgICBcInBvd2RlcmJsdWVcIjogXCIjYjBlMGU2XCIsXG4gICAgXCJwdXJwbGVcIjogXCIjODAwMDgwXCIsXG4gICAgXCJyZWRcIjogXCIjZmYwMDAwXCIsXG4gICAgXCJyb3N5YnJvd25cIjogXCIjYmM4ZjhmXCIsXG4gICAgXCJyb3lhbGJsdWVcIjogXCIjNDE2OWUxXCIsXG4gICAgXCJzYWRkbGVicm93blwiOiBcIiM4YjQ1MTNcIixcbiAgICBcInNhbG1vblwiOiBcIiNmYTgwNzJcIixcbiAgICBcInNhbmR5YnJvd25cIjogXCIjZjRhNDYwXCIsXG4gICAgXCJzZWFncmVlblwiOiBcIiMyZThiNTdcIixcbiAgICBcInNlYXNoZWxsXCI6IFwiI2ZmZjVlZVwiLFxuICAgIFwic2llbm5hXCI6IFwiI2EwNTIyZFwiLFxuICAgIFwic2lsdmVyXCI6IFwiI2MwYzBjMFwiLFxuICAgIFwic2t5Ymx1ZVwiOiBcIiM4N2NlZWJcIixcbiAgICBcInNsYXRlYmx1ZVwiOiBcIiM2YTVhY2RcIixcbiAgICBcInNsYXRlZ3JheVwiOiBcIiM3MDgwOTBcIixcbiAgICBcInNub3dcIjogXCIjZmZmYWZhXCIsXG4gICAgXCJzcHJpbmdncmVlblwiOiBcIiMwMGZmN2ZcIixcbiAgICBcInN0ZWVsYmx1ZVwiOiBcIiM0NjgyYjRcIixcbiAgICBcInRhblwiOiBcIiNkMmI0OGNcIixcbiAgICBcInRlYWxcIjogXCIjMDA4MDgwXCIsXG4gICAgXCJ0aGlzdGxlXCI6IFwiI2Q4YmZkOFwiLFxuICAgIFwidG9tYXRvXCI6IFwiI2ZmNjM0N1wiLFxuICAgIFwidHVycXVvaXNlXCI6IFwiIzQwZTBkMFwiLFxuICAgIFwidmlvbGV0XCI6IFwiI2VlODJlZVwiLFxuICAgIFwid2hlYXRcIjogXCIjZjVkZWIzXCIsXG4gICAgXCJ3aGl0ZVwiOiBcIiNmZmZmZmZcIixcbiAgICBcIndoaXRlc21va2VcIjogXCIjZjVmNWY1XCIsXG4gICAgXCJ5ZWxsb3dcIjogXCIjZmZmZjAwXCIsXG4gICAgXCJ5ZWxsb3dncmVlblwiOiBcIiM5YWNkMzJcIlxufSk7XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL21vZHVsZXMvY29sb3JOYW1lTWFwLmpzXG4vLyBtb2R1bGUgaWQgPSA1OVxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCJ2YXIgX3BlcmZvcm1UcmFuc2Zvcm1BY3Rpb25fb3ZlcndyaXR0ZW4gPSBmYWJyaWMuQ2FudmFzLnByb3RvdHlwZS5fcGVyZm9ybVRyYW5zZm9ybUFjdGlvbjtcblxudmFyIGlzVk1MID0gZnVuY3Rpb24oKSB7IHJldHVybiB0eXBlb2YgR192bWxDYW52YXNNYW5hZ2VyICE9PSAndW5kZWZpbmVkJzsgfTtcblxuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUsIHtcbiAgLyoqXG4gICAqIEFkZCBjdXN0b20gcG9pbnRlcnNcbiAgICogQHBhcmFtIGNvcm5lclxuICAgKiBAcGFyYW0gdGFyZ2V0XG4gICAqIEBwYXJhbSBlXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBfc2V0Q29ybmVyQ3Vyc29yOiBmdW5jdGlvbiAoY29ybmVyLCB0YXJnZXQsIGUpIHtcbiAgICB2YXIgX2N1cnNvciA9IHRhcmdldC5fY29udHJvbHNbY29ybmVyXS5jdXJzb3I7XG4gICAgaWYoIV9jdXJzb3IgfHwgX2N1cnNvciA9PSBcInJlc2l6ZVwiKXtcbiAgICAgIHRoaXMuc2V0Q3Vyc29yKHRoaXMuX2dldFJvdGF0ZWRDb3JuZXJDdXJzb3IoY29ybmVyLCB0YXJnZXQsIGUpKTtcbiAgICB9ZWxzZXtcbiAgICAgIHRoaXMuc2V0Q3Vyc29yKHRoaXNbX2N1cnNvcl0pO1xuICAgIH1cbiAgfSxcbiAgLyoqXG4gICAqIGN1c3RvbSB0cmFuc2Zvcm0gYWN0aW9uc1xuICAgKiBAcGFyYW0gZVxuICAgKiBAcGFyYW0gdHJhbnNmb3JtXG4gICAqIEBwYXJhbSBwb2ludGVyXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBfcGVyZm9ybVRyYW5zZm9ybUFjdGlvbjogZnVuY3Rpb24gKGUsIHRyYW5zZm9ybSwgcG9pbnRlcikge1xuXG4gICAgaWYoIXRyYW5zZm9ybS5hY3Rpb24pcmV0dXJuO1xuICAgIHZhciB0ID0gdHJhbnNmb3JtLnRhcmdldDtcbiAgICB2YXIgZm9vID0gdFtcIl9wZXJmb3JtXCIgKyBmYWJyaWMudXRpbC5zdHJpbmcuY2FwaXRhbGl6ZSh0cmFuc2Zvcm0uYWN0aW9uKSArIFwiQWN0aW9uXCJdO1xuICAgIGlmIChmb28pIHtcbiAgICAgIHZhciBfcCA9IHQudG9Mb2NhbFBvaW50KHBvaW50ZXIsIHRyYW5zZm9ybS5vcmlnaW5YLCB0cmFuc2Zvcm0ub3JpZ2luWSk7XG4gICAgICBfcC54IC89IHQuc2NhbGVYO1xuICAgICAgX3AueSAvPSB0LnNjYWxlWTtcbiAgICAgIGlmICh0LmZsaXBYKSBfcC54ICo9IC0xO1xuICAgICAgaWYgKHQuZmxpcFkpIF9wLnkgKj0gLTE7XG4gICAgICB0cmFuc2Zvcm0ucG9pbnQgPSBfcDtcbiAgICAgIGZvby5jYWxsKHQsIGUsIHRyYW5zZm9ybSwgcG9pbnRlcik7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIF9wZXJmb3JtVHJhbnNmb3JtQWN0aW9uX292ZXJ3cml0dGVuLmNhbGwodGhpcywgZSwgdHJhbnNmb3JtLCBwb2ludGVyKTtcbiAgfSxcbiAgLyoqXG4gICAqIGN1c3RvbSBwb2ludGVyc1xuICAgKiBAcGFyYW0gdGFyZ2V0XG4gICAqIEBwYXJhbSBjb3JuZXJcbiAgICogQHBhcmFtIGVcbiAgICogQHJldHVybnMge3N0cmluZ31cbiAgICogQHByaXZhdGVcbiAgICovXG4gIF9nZXRBY3Rpb25Gcm9tQ29ybmVyOiBmdW5jdGlvbiAodGFyZ2V0LCBjb3JuZXIsIGUpIHtcbiAgICBpZiAoY29ybmVyKSB7XG4gICAgICB2YXIgX2Nvcm5lciA9IHRhcmdldC5fY29udHJvbHNbY29ybmVyXTtcbiAgICAgIHJldHVybiBlW3RoaXMuYWx0QWN0aW9uS2V5XSAmJiBfY29ybmVyLmFsdEFjdGlvbiB8fCBfY29ybmVyLmFjdGlvbjtcbiAgICB9XG4gICAgcmV0dXJuICdkcmFnJztcbiAgfVxufSk7XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLk9iamVjdC5wcm90b3R5cGUsIHtcbiAgc2V0Q29udHJvbHM6IGZ1bmN0aW9uKCl7XG4gICAgdmFyIF9jb250cm9scyA9ICB0aGlzLmdldEJvdW5kc0NvbnRyb2xzKCk7XG4gICAgdGhpcy5zZXRFeHRyYUNvbnRyb2xzICYmIHRoaXMuc2V0RXh0cmFDb250cm9scyhfY29udHJvbHMpO1xuXG4gICAgZm9yKHZhciBpIGluIF9jb250cm9scyl7XG4gICAgICB2YXIgX2NvbnRyb2wgPSBfY29udHJvbHNbaV07XG4gICAgICBpZighX2NvbnRyb2wuc3R5bGUpe1xuICAgICAgICBfY29udHJvbC5zdHlsZSA9IHRoaXMuY29ybmVyU3R5bGU7XG4gICAgICB9XG4gICAgICBpZighX2NvbnRyb2wuc2l6ZSl7XG4gICAgICAgIF9jb250cm9sLnNpemUgPSB0aGlzLmdldENvcm5lclNpemUoaSk7XG4gICAgICB9XG4gICAgfVxuICAgIHRoaXMuX2NvbnRyb2xzID0gX2NvbnRyb2xzO1xuICB9LFxuICAvKipcbiAgICogU29sdmVkIHRoZSBwcm9ibGVtIHdoZW4gaXQgaXMgaW1wb3NzaWJsZSB0byBtb3ZlIHBvaW50IHdoZW4gaXQgaXMgdW5kZXIgYW5vdGhlciBuYXRpdmUgY29udHJvbCBzdWNoIGFzIFwibXRyXCIsIFwidGxcIiBldGMuXG4gICAqIERldGVybWluZXMgd2hpY2ggY29ybmVyIGhhcyBiZWVuIGNsaWNrZWRcbiAgICogQHByaXZhdGVcbiAgICogQHBhcmFtIHtPYmplY3R9IHBvaW50ZXIgVGhlIHBvaW50ZXIgaW5kaWNhdGluZyB0aGUgbW91c2UgcG9zaXRpb25cbiAgICogQHJldHVybiB7U3RyaW5nfEJvb2xlYW59IGNvcm5lciBjb2RlICh0bCwgdHIsIGJsLCBiciwgZXRjLiksIG9yIGZhbHNlIGlmIG5vdGhpbmcgaXMgZm91bmRcbiAgICovXG4gIF9maW5kVGFyZ2V0Q29ybmVyOiBmdW5jdGlvbiAocG9pbnRlcikge1xuICAgIGlmICghdGhpcy5oYXNDb250cm9scyB8fCAhdGhpcy5hY3RpdmUpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgdmFyIGV4ID0gcG9pbnRlci54LFxuICAgICAgZXkgPSBwb2ludGVyLnksXG4gICAgICB4UG9pbnRzLFxuICAgICAgbGluZXM7XG4gICAgdGhpcy5fX2Nvcm5lciA9IDA7XG5cbiAgICBmb3IgKHZhciBpIGluIHRoaXMub0Nvb3Jkcykge1xuICAgICAgaWYoIXRoaXMuX2NvbnRyb2xzW2ldLnZpc2libGUpe1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIGxpbmVzID0gdGhpcy5fZ2V0SW1hZ2VMaW5lcyh0aGlzLm9Db29yZHNbaV0uY29ybmVyKTtcbiAgICAgIHhQb2ludHMgPSB0aGlzLl9maW5kQ3Jvc3NQb2ludHMoe3g6IGV4LCB5OiBleX0sIGxpbmVzKTtcbiAgICAgIGlmICh4UG9pbnRzICE9PSAwICYmIHhQb2ludHMgJSAyID09PSAxKSB7XG4gICAgICAgIHRoaXMuX19jb3JuZXIgPSBpO1xuICAgICAgICByZXR1cm4gaTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9LFxuICBjb250cm9sczoge1xuICAgIHRsOiB7eDogMCwgeTogMCwgYWN0aW9uOiBcInNjYWxlXCJ9LFxuICAgIHRyOiB7eDogXCJ7d2lkdGh9XCIsIHk6IDAsIGFjdGlvbjogXCJzY2FsZVwifSxcbiAgICBibDoge3g6IDAsIHk6IFwie2hlaWdodH1cIiwgYWN0aW9uOiBcInNjYWxlXCJ9LFxuICAgIGJyOiB7eDogXCJ7d2lkdGh9XCIsIHk6IFwie2hlaWdodH1cIiwgYWN0aW9uOiBcInNjYWxlXCJ9LFxuICAgIG1sOiB7dmlzaWJsZTogXCIhe2xvY2tVbmlTY2FsaW5nfVwiICwgeDogMCwgICAgICAgICAgICAgeTogXCJ7aGVpZ2h0fS8yXCIsIGFjdGlvbjogICBcInNjYWxlWFwiICwgYWx0QWN0aW9uOiBcInNrZXdZXCJ9LFxuICAgIG1yOiB7dmlzaWJsZTogXCIhe2xvY2tVbmlTY2FsaW5nfVwiICwgeDogXCJ7d2lkdGh9XCIsICAgICB5OiBcIntoZWlnaHR9LzJcIiwgYWN0aW9uOiAgIFwic2NhbGVYXCIgLCBhbHRBY3Rpb246IFwic2tld1lcIn0sXG4gICAgbXQ6IHt2aXNpYmxlOiBcIiF7bG9ja1VuaVNjYWxpbmd9XCIgLCB4OiBcInt3aWR0aH0vMlwiLCAgIHk6IDAsICAgICAgICAgICAgYWN0aW9uOiAgIFwic2NhbGVZXCIgLCBhbHRBY3Rpb246IFwic2tld1hcIn0sXG4gICAgbWI6IHt2aXNpYmxlOiBcIiF7bG9ja1VuaVNjYWxpbmd9XCIgLCB4OiBcInt3aWR0aH0vMlwiLCAgIHk6IFwie2hlaWdodH1cIiwgICBhY3Rpb246ICAgXCJzY2FsZVlcIiAsIGFsdEFjdGlvbjogXCJza2V3WFwifSxcbiAgICBtdHI6e3Zpc2libGU6IFwie2hhc1JvdGF0aW5nUG9pbnR9XCIsIHg6IFwie3dpZHRofS8yXCIsICAgeTogXCIte3JvdGF0aW5nUG9pbnRPZmZzZXR9L3t6b29tfS97c2NhbGVZfVwiLCBhY3Rpb246IFwicm90YXRlXCIsIGN1cnNvcjogXCJyb3RhdGlvbkN1cnNvclwifSxcbiAgfSxcbiAgZ2V0Qm91bmRzQ29udHJvbHM6IGZ1bmN0aW9uKCl7XG4gICAgLy8gaWYoIXRoaXMuaGFzQm91bmRzQ29udHJvbHMpcmV0dXJuIHt9O1xuICAgIHZhciB6b29tID0gdGhpcy5jYW52YXMudmlld3BvcnRUcmFuc2Zvcm1bMF07XG5cbiAgICAvL3RvZG8gZXZhbCDRgtGP0LbQtdC70LDRjyDRhNGD0L3QutGG0LjRj1xuICAgIHZhciBfcmVwbGFjZSA9IGZ1bmN0aW9uICh2YWwpe1xuICAgICAgaWYodmFsICYmIHZhbC5jb25zdHJ1Y3RvciA9PSBTdHJpbmcpe1xuICAgICAgICB2YWwgPSB2YWwucmVwbGFjZSgvXFx7em9vbVxcfS9nLHpvb20pXG4gICAgICAgICAgIC5yZXBsYWNlKC9cXHsoW159XSopXFx9L2csZnVuY3Rpb24oYSxiKXtcbiAgICAgICAgICAgICByZXR1cm4gXCJ0aGlzLlwiICtiXG4gICAgICAgICAgIH0pO1xuICAgICAgICB2YWwgPSBldmFsKHZhbCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gdmFsO1xuICAgIH0uYmluZCh0aGlzKTtcblxuICAgIHZhciBjb250cm9scyA9IHt9O1xuICAgIGZvcih2YXIgaSBpbiB0aGlzLmNvbnRyb2xzKXtcbiAgICAgIHZhciBjb250cm9sID0gdGhpcy5jb250cm9sc1tpXTtcblxuICAgICAgdmFyIF92aXNpYmxlID0gdGhpcy5oYXNCb3VuZHNDb250cm9scyAmJiAoY29udHJvbC52aXNpYmxlID09PSB1bmRlZmluZWQgfHwgX3JlcGxhY2UoY29udHJvbC52aXNpYmxlKSk7XG5cbiAgICAgIC8vIGlmKF92aXNpYmxlKXtcbiAgICAgICAgdmFyIF9uZXdDb250cm9sID0gZmFicmljLnV0aWwub2JqZWN0LmNsb25lKGNvbnRyb2wpO1xuICAgICAgICBkZWxldGUgX25ld0NvbnRyb2wudmlzaWJsZTtcbiAgICAgICAgX25ld0NvbnRyb2wueCA9IF9yZXBsYWNlKF9uZXdDb250cm9sLngpO1xuICAgICAgICBfbmV3Q29udHJvbC55ID0gX3JlcGxhY2UoX25ld0NvbnRyb2wueSk7XG4gICAgICAgIF9uZXdDb250cm9sLnZpc2libGUgPSBfdmlzaWJsZTtcbiAgICAgICAgY29udHJvbHNbaV0gPSBfbmV3Q29udHJvbDtcbiAgICAgIC8vIH1cbiAgICB9XG5cbiAgICAvLyB0aGlzLl9nZXRDb250cm9sc0Z1bmN0aW9uID0gZXZhbChcInJldHVybiBcIilcbiAgICAvLyAvL1xuICAgIC8vIHZhciBjb250cm9scyA9IHtcbiAgICAvLyAgIHRsOiB7eDogMCwgeTogMCwgYWN0aW9uOiBcInNjYWxlXCJ9LFxuICAgIC8vICAgdHI6IHt4OiB0aGlzLndpZHRoLCB5OiAwLCBhY3Rpb246IFwic2NhbGVcIn0sXG4gICAgLy8gICBibDoge3g6IDAsIHk6IHRoaXMuaGVpZ2h0LCBhY3Rpb246IFwic2NhbGVcIn0sXG4gICAgLy8gICBicjoge3g6IHRoaXMud2lkdGgsIHk6IHRoaXMuaGVpZ2h0LCBhY3Rpb246IFwic2NhbGVcIn1cbiAgICAvLyB9O1xuICAgIC8vIGlmKCF0aGlzLmxvY2tVbmlTY2FsaW5nKSB7XG4gICAgLy8gICBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGNvbnRyb2xzLHtcbiAgICAvLyAgICAgbWw6IHt4OiAwLCAgICAgICAgICAgIHk6IHRoaXMuaGVpZ2h0LzIsIGFjdGlvbjogICBcInNjYWxlWFwiICwgYWx0QWN0aW9uOiBcInNrZXdZXCJ9LFxuICAgIC8vICAgICBtcjoge3g6IHRoaXMud2lkdGgsICAgeTogdGhpcy5oZWlnaHQvMiwgYWN0aW9uOiAgIFwic2NhbGVYXCIgLCBhbHRBY3Rpb246IFwic2tld1lcIn0sXG4gICAgLy8gICAgIG10OiB7eDogdGhpcy53aWR0aC8yLCB5OiAwLCAgICAgICAgICAgICBhY3Rpb246ICAgXCJzY2FsZVwiICAsIGFsdEFjdGlvbjogXCJza2V3WFwifSxcbiAgICAvLyAgICAgbWI6IHt4OiB0aGlzLndpZHRoLzIsIHk6IHRoaXMuaGVpZ2h0LCAgIGFjdGlvbjogICBcInNjYWxlXCIgICwgYWx0QWN0aW9uOiBcInNrZXdYXCJ9LFxuICAgIC8vICAgfSlcbiAgICAvLyB9XG4gICAgLy8gaWYodGhpcy5oYXNSb3RhdGluZ1BvaW50KXtcbiAgICAvLyAgIGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoY29udHJvbHMsIHtcbiAgICAvLyAgICAgbXRyOiB0aGlzLmhhc1JvdGF0aW5nUG9pbnQgJiYge3g6IHRoaXMud2lkdGggLyAyLCB5OiAtdGhpcy5yb3RhdGluZ1BvaW50T2Zmc2V0IC8gem9vbSwgYWN0aW9uOiBcInJvdGF0ZVwiLCBjdXJzb3I6IFwicm90YXRpb25DdXJzb3JcIn0sXG4gICAgLy8gICAgIG10cjI6IHt4OiB0aGlzLndpZHRoIC8gMiwgeTogdGhpcy5oZWlnaHQgKyB0aGlzLnJvdGF0aW5nUG9pbnRPZmZzZXQgLyB6b29tLCBhY3Rpb246IFwicm90YXRlXCIsIGN1cnNvcjogXCJyb3RhdGlvbkN1cnNvclwifVxuICAgIC8vICAgfSk7XG4gICAgLy8gfTtcbiAgICAvLyByZXR1cm4gdGFyZ2V0Ll9jb3JuZXJfYWN0aW9uc1tjb3JuZXIuc3Vic3RyKDEpXSB8fCB0YXJnZXQuX2RlZmF1bHRfY29ybmVyX2FjdGlvbjtcbiAgICByZXR1cm4gY29udHJvbHM7XG4gIH0sXG4gIC8qKlxuICAgKiBTZXRzIGNvcm5lciBwb3NpdGlvbiBjb29yZGluYXRlcyBiYXNlZCBvbiBjdXJyZW50IGFuZ2xlLCB3aWR0aCBhbmQgaGVpZ2h0XG4gICAqIFNlZSBodHRwczovL2dpdGh1Yi5jb20va2FuZ2F4L2ZhYnJpYy5qcy93aWtpL1doZW4tdG8tY2FsbC1zZXRDb29yZHNcbiAgICogQHJldHVybiB7ZmFicmljLk9iamVjdH0gdGhpc0FyZ1xuICAgKiBAY2hhaW5hYmxlXG4gICAqL1xuICBzZXRDb29yZHM6IGZ1bmN0aW9uICgpIHtcbiAgICBpZighdGhpcy5jYW52YXMpcmV0dXJuO1xuXG4gICAgdmFyIGksIF9wLCBfYywgX3gsIF95LFxuICAgICAgem9vbSA9IHRoaXMuY2FudmFzLnZpZXdwb3J0VHJhbnNmb3JtWzBdLFxuICAgICAgdGhldGEgPSBmYWJyaWMudXRpbC5kZWdyZWVzVG9SYWRpYW5zKHRoaXMuYW5nbGUpLFxuICAgICAgdnB0ID0gdGhpcy5nZXRWaWV3cG9ydFRyYW5zZm9ybSgpLFxuICAgICAgZGltID0gdGhpcy5fY2FsY3VsYXRlQ3VycmVudERpbWVuc2lvbnMoKSxcbiAgICAgIGN1cnJlbnRXaWR0aCA9IGRpbS54LCBjdXJyZW50SGVpZ2h0ID0gZGltLnk7XG5cbiAgICAvLyBJZiB3aWR0aCBpcyBuZWdhdGl2ZSwgbWFrZSBwb3N0aXZlLiBGaXhlcyBwYXRoIHNlbGVjdGlvbiBpc3N1ZVxuICAgIGlmIChjdXJyZW50V2lkdGggPCAwKSB7XG4gICAgICBjdXJyZW50V2lkdGggPSBNYXRoLmFicyhjdXJyZW50V2lkdGgpO1xuICAgIH1cblxuICAgIHZhciBzaW5UaCA9IE1hdGguc2luKHRoZXRhKSxcbiAgICAgIGNvc1RoID0gTWF0aC5jb3ModGhldGEpLFxuICAgICAgX2FuZ2xlID0gY3VycmVudFdpZHRoID4gMCA/IE1hdGguYXRhbihjdXJyZW50SGVpZ2h0IC8gY3VycmVudFdpZHRoKSA6IDAsXG4gICAgICBfaHlwb3RlbnVzZSA9IChjdXJyZW50V2lkdGggLyBNYXRoLmNvcyhfYW5nbGUpKSAvIDIsXG4gICAgICBvZmZzZXRYID0gTWF0aC5jb3MoX2FuZ2xlICsgdGhldGEpICogX2h5cG90ZW51c2UsXG4gICAgICBvZmZzZXRZID0gTWF0aC5zaW4oX2FuZ2xlICsgdGhldGEpICogX2h5cG90ZW51c2UsXG4gICAgICBjb29yZHMgPSBmYWJyaWMudXRpbC50cmFuc2Zvcm1Qb2ludCh0aGlzLmdldENlbnRlclBvaW50KCksIHZwdCk7XG5cbiAgICB2YXIgVEwgPSB7eDogY29vcmRzLnggLSBvZmZzZXRYLCB5OiBjb29yZHMueSAtIG9mZnNldFl9O1xuXG4gICAgdGhpcy5zZXRDb250cm9scygpO1xuICAgIHRoaXMub0Nvb3JkcyA9IHt9O1xuXG4gICAgZm9yIChpIGluIHRoaXMuX2NvbnRyb2xzKSB7XG4gICAgICBfcCA9IHt4OiB0aGlzLl9jb250cm9sc1tpXS54ICogdGhpcy5zY2FsZVgsIHk6IHRoaXMuX2NvbnRyb2xzW2ldLnkgKiB0aGlzLnNjYWxlWX07XG4gICAgICAvLyBfYyA9IHRoaXMuZmxpcFggPyAodGhpcy5mbGlwWSA/IFwiYnJcIiA6IFwidHJcIikgOiAodGhpcy5mbGlwWSA/IFwiYmxcIiA6IFwidGxcIik7XG4gICAgICB0aGlzLm9Db29yZHNbaV0gPSB7XG4gICAgICAgIHg6IFRMLnggKyAoKC1zaW5UaCAqIF9wLnkgKyBjb3NUaCAqIF9wLngpICogKHRoaXMuZmxpcFggPyAtMSA6IDEpKSAqIHpvb20sXG4gICAgICAgIHk6IFRMLnkgKyAoKCBjb3NUaCAqIF9wLnkgKyBzaW5UaCAqIF9wLngpICogKHRoaXMuZmxpcFkgPyAtMSA6IDEpKSAqIHpvb21cbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLl9zZXRDb3JuZXJDb29yZHMgJiYgdGhpcy5fc2V0Q29ybmVyQ29vcmRzKCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG4gIGRyYXdDb250cm9sczogZnVuY3Rpb24gKGN0eCkge1xuXG4gICAgaWYgKCF0aGlzLmhhc0NvbnRyb2xzKSB7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICB2YXIgdHJhbnNmb3JtTWF0cml4ID0gdGhpcy5fY2FsY0RpbWVuc2lvbnNUcmFuc2Zvcm1NYXRyaXgodGhpcy5za2V3WCwgdGhpcy5za2V3WSwgZmFsc2UpO1xuICAgIHZhciB3aCA9IHRoaXMuX2NhbGN1bGF0ZUN1cnJlbnREaW1lbnNpb25zKCksXG4gICAgICB3aWR0aCA9IHdoLngsXG4gICAgICBoZWlnaHQgPSB3aC55LFxuICAgICAgem9vbSA9IHRoaXMuY2FudmFzLnZpZXdwb3J0VHJhbnNmb3JtWzBdLFxuICAgICAgbWV0aG9kTmFtZSA9IHRoaXMudHJhbnNwYXJlbnRDb3JuZXJzID8gJ3N0cm9rZScgOiAnZmlsbCcsXG4gICAgICBpLCBjb3JuZXIsIF9wLCBsZWZ0LCB0b3AsIF94LCBfeSwgc3Ryb2tlLCBzY2FsZU9mZnNldDtcblxuICAgIGN0eC5zYXZlKCk7XG4gICAgY3R4LmxpbmVXaWR0aCA9IDE7XG4gICAgdmFyIF9jb3JuZXJfYWxwaGEgPSAgdGhpcy5pc01vdmluZyA/IHRoaXMuYm9yZGVyT3BhY2l0eVdoZW5Nb3ZpbmcgOiAxO1xuICAgIGN0eC5zdHJva2VTdHlsZSA9IGN0eC5maWxsU3R5bGUgPSB0aGlzLmNvcm5lckNvbG9yO1xuXG4gICAgZm9yICh2YXIgY29ybmVyTmFtZSBpbiB0aGlzLl9jb250cm9scykge1xuICAgICAgY29ybmVyID0gdGhpcy5fY29udHJvbHNbY29ybmVyTmFtZV07XG4gICAgICBpZighY29ybmVyLnZpc2libGUgfHwgY29ybmVyLmludHJhbnNmb3JtYWJsZSAmJiB0aGlzLmNhbnZhcy5fY3VycmVudFRyYW5zZm9ybSl7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgX3AgPSBmYWJyaWMudXRpbC50cmFuc2Zvcm1Qb2ludChjb3JuZXIsIHRyYW5zZm9ybU1hdHJpeCk7XG4gICAgICBsZWZ0ID0gKHRoaXMuZmxpcFggPyAoIHdpZHRoIC0gX3AueCkgOiBfcC54KSAqIHpvb207XG4gICAgICB0b3AgPSAodGhpcy5mbGlwWSA/IChoZWlnaHQgLSBfcC55KSA6IF9wLnkpICogem9vbTtcbiAgICAgIHN0cm9rZSA9ICF0aGlzLnRyYW5zcGFyZW50Q29ybmVycyAmJiB0aGlzLmNvcm5lclN0cm9rZUNvbG9yO1xuXG4gICAgICB2YXIgX2ZvbyA9IGNvcm5lci5zdHlsZUZ1bmN0aW9uIHx8IHRoaXMuY29ybmVyU3R5bGVzW2Nvcm5lci5zdHlsZV07XG4gICAgICBpZihjb3JuZXIuc2l6ZSkge1xuICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSBfY29ybmVyX2FscGhhO1xuICAgICAgICBfZm9vLmNhbGwodGhpcywgY29ybmVyTmFtZSwgY3R4LCBtZXRob2ROYW1lLCBsZWZ0IC0gKHdpZHRoICsgY29ybmVyLnNpemUpIC8gMiwgdG9wIC0gKGhlaWdodCArIGNvcm5lci5zaXplKSAvIDIsIGNvcm5lci5zaXplLCBzdHJva2UpO1xuICAgICAgfVxuICAgICAgaWYoY29ybmVyLmFyZWEpe1xuICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSAwLjAwODtcbiAgICAgICAgLy8gY3R4Lmdsb2JhbEFscGhhID0gMC4zO1xuICAgICAgICB0aGlzLmNvcm5lclN0eWxlcy5jaXJjbGUuY2FsbCh0aGlzLCBjb3JuZXJOYW1lLCBjdHgsIG1ldGhvZE5hbWUsIGxlZnQgLSh3aWR0aCArIGNvcm5lci5hcmVhKSAvIDIgLCB0b3AgLShoZWlnaHQgKyBjb3JuZXIuYXJlYSkgLyAyLCBjb3JuZXIuYXJlYSwgc3Ryb2tlKTtcblxuICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSAxO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIGlmICh0aGlzLmV4dHJhQ29udHJvbHMpIHtcbiAgICAvLyAgIGZvciAoaSBpbiB0aGlzLmV4dHJhQ29udHJvbHMpIHtcbiAgICAvLyAgICAgX3AgPSBmYWJyaWMudXRpbC50cmFuc2Zvcm1Qb2ludCh0aGlzLmV4dHJhQ29udHJvbHNbaV0sIHRyYW5zZm9ybU1hdHJpeCk7XG4gICAgLy8gICAgIHNjYWxlT2Zmc2V0ID0gdGhpcy5jb3JuZXJTaXplO1xuICAgIC8vICAgICBsZWZ0ID0gLSh3aWR0aCArIHNjYWxlT2Zmc2V0KSAvIDI7XG4gICAgLy8gICAgIHRvcCA9IC0oaGVpZ2h0ICsgc2NhbGVPZmZzZXQpIC8gMjtcbiAgICAvLyAgICAgX3ggPSBsZWZ0ICsgKHRoaXMuZmxpcFggPyAoIHdpZHRoIC0gX3AueCkgOiBfcC54KSAqIHpvb207XG4gICAgLy8gICAgIF95ID0gdG9wICsgKHRoaXMuZmxpcFkgPyAoaGVpZ2h0IC0gX3AueSkgOiBfcC55KSAqIHpvb207XG4gICAgLy8gICAgIHRoaXMuX2RyYXdDb250cm9sKCBpLCBjdHgsIG1ldGhvZE5hbWUsIF94LCBfeSk7XG4gICAgLy8gICB9XG4gICAgLy8gfVxuXG4gICAgdGhpcy5kcmF3Q29udHJvbHNJbnRlcmZhY2UgJiYgdGhpcy5kcmF3Q29udHJvbHNJbnRlcmZhY2UoY3R4KTtcbiAgICB0aGlzLmRyYXdCb3JkZXIgJiYgdGhpcy5kcmF3Qm9yZGVyKGN0eCk7XG4gICAgY3R4LnJlc3RvcmUoKTtcblxuICAgIHJldHVybiB0aGlzO1xuICB9LFxuXG4gIGNvcm5lclN0eWxlczoge1xuICAgIGFyYzogZnVuY3Rpb24gKGNvbnRyb2wsIGN0eCwgbWV0aG9kTmFtZSwgbGVmdCwgdG9wLCBzaXplLCBzdHJva2UpIHtcbiAgICAgIGN0eC5zYXZlKCk7XG4gICAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgICBjdHgudHJhbnNsYXRlKGxlZnQsIHRvcCk7XG5cbiAgICAgIGlmIChjb250cm9sWzBdICE9PSBcIm1cIikge1xuICAgICAgICBjdHgudHJhbnNsYXRlKHNpemUsIDApO1xuICAgICAgICBjdHgucm90YXRlKE1hdGguUEkgLyAyKTtcbiAgICAgIH1cbiAgICAgIHN3aXRjaCAoY29udHJvbCkge1xuICAgICAgICBjYXNlIFwidHJcIjpcbiAgICAgICAgICBjdHguYXJjKHNpemUgLyAyLCBzaXplIC8gMiwgc2l6ZSAvIDIsIDIgKiBNYXRoLlBJLCAwLjUgKiBNYXRoLlBJLCB0cnVlKTtcbiAgICAgICAgICBjdHgubGluZVRvKHNpemUgLyAyLCBzaXplIC8gMik7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJiclwiOlxuICAgICAgICAgIGN0eC5hcmMoc2l6ZSAvIDIsIHNpemUgLyAyLCBzaXplIC8gMiwgMC41ICogTWF0aC5QSSwgIE1hdGguUEksIHRydWUpO1xuICAgICAgICAgIGN0eC5saW5lVG8oc2l6ZSAvIDIsIHNpemUgLyAyKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImJsXCI6XG4gICAgICAgICAgY3R4LmFyYyhzaXplIC8gMiwgc2l6ZSAvIDIsIHNpemUgLyAyLCBNYXRoLlBJLCAxLjUgKiBNYXRoLlBJLCB0cnVlKTtcbiAgICAgICAgICBjdHgubGluZVRvKHNpemUgLyAyLCBzaXplIC8gMik7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJ0bFwiOlxuICAgICAgICAgIGN0eC5hcmMoc2l6ZSAvIDIsIHNpemUgLyAyLCBzaXplIC8gMiwgMS41ICogTWF0aC5QSSwgMiAqIE1hdGguUEksIHRydWUpO1xuICAgICAgICAgIGN0eC5saW5lVG8oc2l6ZSAvIDIsIHNpemUgLyAyKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcIm10XCI6XG4gICAgICAgICAgY3R4LmFyYyhzaXplIC8gMiwgc2l6ZSAvIDIsIHNpemUgLyAyLCAwLCBNYXRoLlBJLCB0cnVlKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcIm1iXCI6XG4gICAgICAgICAgY3R4LmFyYyhzaXplIC8gMiwgc2l6ZSAvIDIsIHNpemUgLyAyLCAwLCBNYXRoLlBJLCBmYWxzZSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJtbFwiOlxuICAgICAgICAgIGN0eC50cmFuc2xhdGUoMCwgc2l6ZSk7XG4gICAgICAgICAgY3R4LnJvdGF0ZSgtTWF0aC5QSSAvIDIpO1xuICAgICAgICAgIGN0eC5hcmMoc2l6ZSAvIDIsIHNpemUgLyAyLCBzaXplIC8gMiwgMCwgTWF0aC5QSSwgdHJ1ZSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJtclwiOlxuICAgICAgICAgIGN0eC50cmFuc2xhdGUoIC0xLCBzaXplKTtcbiAgICAgICAgICBjdHgucm90YXRlKC1NYXRoLlBJIC8gMik7XG4gICAgICAgICAgY3R4LmFyYyhzaXplIC8gMiwgc2l6ZSAvIDIsIHNpemUgLyAyLCAwLCBNYXRoLlBJLCBmYWxzZSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgY3R4LmFyYyhzaXplIC8gMiwgc2l6ZSAvIDIsIHNpemUgLyAyLCAwLCAyICogTWF0aC5QSSwgZmFsc2UpO1xuICAgICAgfVxuICAgICAgLy8gY3R4Lm1vdmVUbygwLCAwKTtcbiAgICAgIC8vIGN0eC5saW5lVG8oc2l6ZSwgMCk7XG4gICAgICAvLyBjdHgubGluZVRvKHNpemUsIHNpemUgLyAyKTtcbiAgICAgIC8vXG4gICAgICAvLyBpZiAoY29udHJvbFswXSA9PSBcIm1cIikge1xuICAgICAgLy8gICBjdHgubGluZVRvKDAsIHNpemUgLyAyKTtcbiAgICAgIC8vIH0gZWxzZSB7XG4gICAgICAvLyAgIGN0eC5saW5lVG8oc2l6ZSAvIDIsIHNpemUgLyAyKTtcbiAgICAgIC8vICAgY3R4LmxpbmVUbyhzaXplIC8gMiwgc2l6ZSk7XG4gICAgICAvLyAgIGN0eC5saW5lVG8oMCwgc2l6ZSk7XG4gICAgICAvLyB9XG5cbiAgICAgIC8vIGlmIChjb250cm9sICE9PSBcIm10clwiKSB7XG4gICAgICAvLyAgIGlmIChjb250cm9sWzBdICE9PSBcIm1cIikge1xuICAgICAgLy8gICAgIGN0eC5hcmMoc2l6ZSAvIDIsIHNpemUgLyAyLCBzaXplIC8gMiwgMCwgMS41ICogTWF0aC5QSSwgZmFsc2UpO1xuICAgICAgLy8gICAgIGN0eC5saW5lVG8oc2l6ZSAvIDIsIHNpemUgLyAyKVxuICAgICAgLy8gICB9XG4gICAgICAvLyB9XG4gICAgICBjdHguY2xvc2VQYXRoKCk7XG4gICAgICBjdHhbbWV0aG9kTmFtZV0oKTtcbiAgICAgIGlmIChzdHJva2UpIHtcbiAgICAgICAgY3R4LnN0cm9rZSgpO1xuICAgICAgfVxuICAgICAgY3R4LnJlc3RvcmUoKTtcbiAgICB9LFxuICAgIGZyYW1lOiBmdW5jdGlvbiAoY29udHJvbCwgY3R4LCBtZXRob2ROYW1lLCBsZWZ0LCB0b3AsIHNpemUsIHN0cm9rZSkge1xuICAgICAgaWYgKGNvbnRyb2wgPT0gXCJtdHJcIikge1xuICAgICAgICAvLyB0aGlzLnRyYW5zcGFyZW50Q29ybmVycyB8fCBjdHguY2xlYXJSZWN0KGxlZnQsIHRvcCwgc2l6ZSwgc2l6ZSk7XG4gICAgICAgIGN0eFttZXRob2ROYW1lICsgJ1JlY3QnXShsZWZ0LCB0b3AsIHNpemUsIHNpemUpO1xuICAgICAgICBpZiAoc3Ryb2tlKSB7XG4gICAgICAgICAgY3R4LnN0cm9rZVJlY3QobGVmdCwgdG9wLCBzaXplLCBzaXplKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGN0eC5zYXZlKCk7XG4gICAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgICBjdHgudHJhbnNsYXRlKGxlZnQsIHRvcCk7XG4gICAgICBzd2l0Y2ggKGNvbnRyb2wpIHtcbiAgICAgICAgY2FzZSBcInRyXCI6XG4gICAgICAgICAgY3R4LnRyYW5zbGF0ZShzaXplLCAwKTtcbiAgICAgICAgICBjdHgucm90YXRlKE1hdGguUEkgLyAyKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImJyXCI6XG4gICAgICAgICAgY3R4LnRyYW5zbGF0ZShzaXplLCBzaXplKTtcbiAgICAgICAgICBjdHgucm90YXRlKE1hdGguUEkpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiYmxcIjpcbiAgICAgICAgICBjdHgudHJhbnNsYXRlKDAsIHNpemUpO1xuICAgICAgICAgIGN0eC5yb3RhdGUoLU1hdGguUEkgLyAyKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcIm1yXCI6XG4gICAgICAgICAgY3R4LnRyYW5zbGF0ZShzaXplLCAwKTtcbiAgICAgICAgICBjdHgucm90YXRlKE1hdGguUEkgLyAyKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcIm1sXCI6XG4gICAgICAgICAgY3R4LnRyYW5zbGF0ZShzaXplIC8gMiwgMCk7XG4gICAgICAgICAgY3R4LnJvdGF0ZShNYXRoLlBJIC8gMik7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJtYlwiOlxuICAgICAgICAgIGN0eC50cmFuc2xhdGUoMCwgc2l6ZSAvIDIpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgY3R4Lm1vdmVUbygwLCAwKTtcbiAgICAgIGN0eC5saW5lVG8oc2l6ZSwgMCk7XG4gICAgICBjdHgubGluZVRvKHNpemUsIHNpemUgLyAyKTtcblxuICAgICAgaWYgKGNvbnRyb2xbMF0gPT0gXCJtXCIpIHtcbiAgICAgICAgY3R4LmxpbmVUbygwLCBzaXplIC8gMik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjdHgubGluZVRvKHNpemUgLyAyLCBzaXplIC8gMik7XG4gICAgICAgIGN0eC5saW5lVG8oc2l6ZSAvIDIsIHNpemUpO1xuICAgICAgICBjdHgubGluZVRvKDAsIHNpemUpO1xuICAgICAgfVxuICAgICAgY3R4LmNsb3NlUGF0aCgpO1xuICAgICAgY3R4W21ldGhvZE5hbWVdKCk7XG4gICAgICBpZiAoc3Ryb2tlKSB7XG4gICAgICAgIGN0eC5zdHJva2UoKTtcbiAgICAgIH1cbiAgICAgIGN0eC5yZXN0b3JlKCk7XG4gICAgfSxcbiAgICBjaXJjbGU6IGZ1bmN0aW9uIChjb250cm9sLCBjdHgsIG1ldGhvZE5hbWUsIGxlZnQsIHRvcCwgc2l6ZSwgc3Ryb2tlKSB7XG4gICAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgICBjdHguYXJjKGxlZnQgKyBzaXplIC8gMiwgdG9wICsgc2l6ZSAvIDIsIHNpemUgLyAyLCAwLCAyICogTWF0aC5QSSwgZmFsc2UpO1xuICAgICAgY3R4W21ldGhvZE5hbWVdKCk7XG4gICAgICBpZiAoc3Ryb2tlKSB7XG4gICAgICAgIGN0eC5zdHJva2UoKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIHJlY3Q6IGZ1bmN0aW9uIChjb250cm9sLCBjdHgsIG1ldGhvZE5hbWUsIGxlZnQsIHRvcCwgc2l6ZSwgc3Ryb2tlKSB7XG4gICAgICB0aGlzLnRyYW5zcGFyZW50Q29ybmVycyAmJiBjdHguY2xlYXJSZWN0KGxlZnQsIHRvcCwgc2l6ZSwgc2l6ZSk7XG4gICAgICBjdHhbbWV0aG9kTmFtZSArICdSZWN0J10obGVmdCwgdG9wLCBzaXplLCBzaXplKTtcbiAgICAgIGlmIChzdHJva2UpIHtcbiAgICAgICAgY3R4LnN0cm9rZVJlY3QobGVmdCwgdG9wLCBzaXplLCBzaXplKTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIHJlc2l6YWJsZUVkZ2U6IGZhbHNlLFxuICAvKipcbiAgICogU2V0cyB0aGUgY29vcmRpbmF0ZXMgb2YgdGhlIGRyYWdnYWJsZSBib3hlcyBpbiB0aGUgY29ybmVycyBvZlxuICAgKiB0aGUgaW1hZ2UgdXNlZCB0byBzY2FsZS9yb3RhdGUgaXQuXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBfc2V0Q29ybmVyQ29vcmRzOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgY29vcmRzID0gdGhpcy5vQ29vcmRzLFxuICAgICAgbmV3VGhldGEgPSBmYWJyaWMudXRpbC5kZWdyZWVzVG9SYWRpYW5zKDQ1IC0gdGhpcy5hbmdsZSksXG4gICAgICBjb3JuZXJIeXBvdGVudXNlLFxuICAgICAgY29zSGFsZk9mZnNldCxcbiAgICAgIHNpbkhhbGZPZmZzZXQgLFxuICAgICAgeCwgeTtcblxuICAgIGZvciAodmFyIHBvaW50IGluIGNvb3Jkcykge1xuICAgICAgdmFyIHNpemUgPSB0aGlzLl9jb250cm9sc1twb2ludF0uYXJlYSB8fCB0aGlzLl9jb250cm9sc1twb2ludF0uc2l6ZTtcbiAgICAgIGNvcm5lckh5cG90ZW51c2UgPSBzaXplICogMC43MDcxMDY7XG4gICAgICBjb3NIYWxmT2Zmc2V0ID0gY29ybmVySHlwb3RlbnVzZSAqIE1hdGguY29zKG5ld1RoZXRhKTtcbiAgICAgIHNpbkhhbGZPZmZzZXQgPSBjb3JuZXJIeXBvdGVudXNlICogTWF0aC5zaW4obmV3VGhldGEpO1xuXG4gICAgICB2YXIgX2Nvcm5lcnMgPSB7dGw6IHBvaW50LCB0cjogcG9pbnQsIGJsOiBwb2ludCwgYnI6IHBvaW50fTtcblxuICAgICAgaWYodGhpcy5yZXNpemFibGVFZGdlKXtcbiAgICAgICAgc3dpdGNoKHBvaW50KXtcbiAgICAgICAgICBjYXNlIFwibWxcIjpcbiAgICAgICAgICAgIF9jb3JuZXJzID0ge3RsOiBcInRsXCIsIHRyOiBcInRsXCIsIGJsOiBcImJsXCIsIGJyOiBcImJsXCJ9O1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSBcIm10XCI6XG4gICAgICAgICAgICBfY29ybmVycyA9IHt0bDogXCJ0bFwiLCB0cjogXCJ0clwiLCBibDogXCJ0bFwiLCBicjogXCJ0clwifTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIGNhc2UgXCJtclwiOlxuICAgICAgICAgICAgX2Nvcm5lcnMgPSB7dGw6IFwidHJcIiwgdHI6IFwidHJcIiwgYmw6IFwiYnJcIiwgYnI6IFwiYnJcIn07XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlIFwibWJcIjpcbiAgICAgICAgICAgIF9jb3JuZXJzID0ge3RsOiBcImJsXCIsIHRyOiBcImJyXCIsIGJsOiBcImJsXCIsIGJyOiBcImJyXCJ9O1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgY29vcmRzW3BvaW50XS5jb3JuZXIgPSB7XG4gICAgICAgIHRsOiB7XG4gICAgICAgICAgeDogY29vcmRzW19jb3JuZXJzLnRsXS54IC0gc2luSGFsZk9mZnNldCxcbiAgICAgICAgICB5OiBjb29yZHNbX2Nvcm5lcnMudGxdLnkgLSBjb3NIYWxmT2Zmc2V0XG4gICAgICAgIH0sXG4gICAgICAgIHRyOiB7XG4gICAgICAgICAgeDogY29vcmRzW19jb3JuZXJzLnRyXS54ICsgY29zSGFsZk9mZnNldCxcbiAgICAgICAgICB5OiBjb29yZHNbX2Nvcm5lcnMudHJdLnkgLSBzaW5IYWxmT2Zmc2V0XG4gICAgICAgIH0sXG4gICAgICAgIGJsOiB7XG4gICAgICAgICAgeDogY29vcmRzW19jb3JuZXJzLmJsXS54IC0gY29zSGFsZk9mZnNldCxcbiAgICAgICAgICB5OiBjb29yZHNbX2Nvcm5lcnMuYmxdLnkgKyBzaW5IYWxmT2Zmc2V0XG4gICAgICAgIH0sXG4gICAgICAgIGJyOiB7XG4gICAgICAgICAgeDogY29vcmRzW19jb3JuZXJzLmJyXS54ICsgc2luSGFsZk9mZnNldCxcbiAgICAgICAgICB5OiBjb29yZHNbX2Nvcm5lcnMuYnJdLnkgKyBjb3NIYWxmT2Zmc2V0XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfVxuICB9LFxuICBnZXRDb3JuZXJBcmVhU2l6ZTogZnVuY3Rpb24oY29udHJvbCl7XG4gICAgaWYodGhpcy5jb3JuZXJBcmVhU2l6ZSl7XG4gICAgICByZXR1cm4gdGhpcy5jb3JuZXJBcmVhU2l6ZTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuY29ybmVyU2l6ZVtjb250cm9sXSB8fCB0aGlzLmNvcm5lclNpemUuYWxsIHx8IHRoaXMuY29ybmVyU2l6ZVxuICB9LFxuICBnZXRDb3JuZXJTaXplOiBmdW5jdGlvbihjb250cm9sKXtcbiAgICByZXR1cm4gdGhpcy5jb3JuZXJTaXplW2NvbnRyb2xdIHx8IHRoaXMuY29ybmVyU2l6ZS5hbGwgfHwgdGhpcy5jb3JuZXJTaXplXG4gIH0sXG4gIC8qKlxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgX2RyYXdDb250cm9sOiBmdW5jdGlvbiAoY29udHJvbCwgY3R4LCBtZXRob2ROYW1lLCBsZWZ0LCB0b3ApIHtcbiAgICBpZiAoIXRoaXMuaXNDb250cm9sVmlzaWJsZShjb250cm9sKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB2YXIgX2Nvcm5lclN0eWxlID0gdGhpcy5jb3JuZXJTdHlsZVtjb250cm9sXSB8fCB0aGlzLmNvcm5lclN0eWxlLmFsbCB8fCB0aGlzLmNvcm5lclN0eWxlO1xuICAgIHZhciBzaXplID0gdGhpcy5nZXRDb3JuZXJTaXplKGNvbnRyb2wpO1xuICAgIHZhciBzdHJva2UgPSAhdGhpcy50cmFuc3BhcmVudENvcm5lcnMgJiYgdGhpcy5jb3JuZXJTdHJva2VDb2xvcjtcbiAgICB0aGlzLmNvcm5lclN0eWxlc1tfY29ybmVyU3R5bGVdLmNhbGwodGhpcywgY29udHJvbCwgY3R4LCBtZXRob2ROYW1lLCBsZWZ0LCB0b3AsIHNpemUsIHN0cm9rZSk7XG4gIH1cbiAgLy8gX2dldENvbnRyb2xzVmlzaWJpbGl0eTogZnVuY3Rpb24oKSB7XG4gIC8vICAgaWYgKCF0aGlzLl9jb250cm9sc1Zpc2liaWxpdHkpIHtcbiAgLy8gICAgIHRoaXMuX2NvbnRyb2xzVmlzaWJpbGl0eSA9IHtcbiAgLy8gICAgICAgdGw6IHRydWUsXG4gIC8vICAgICAgIHRyOiB0cnVlLFxuICAvLyAgICAgICBicjogdHJ1ZSxcbiAgLy8gICAgICAgYmw6IHRydWUsXG4gIC8vICAgICAgIG1sOiB0cnVlLFxuICAvLyAgICAgICBtdDogdHJ1ZSxcbiAgLy8gICAgICAgbXI6IHRydWUsXG4gIC8vICAgICAgIG1iOiB0cnVlLFxuICAvLyAgICAgICBtdHI6IHRydWUsXG4gIC8vICAgICAgIHA6IHRydWVcbiAgLy8gICAgIH07XG4gIC8vICAgfVxuICAvLyAgIHJldHVybiB0aGlzLl9jb250cm9sc1Zpc2liaWxpdHk7XG4gIC8vIH0sXG4gIC8vIGlzQ29udHJvbFZpc2libGU6IGZ1bmN0aW9uKGNvbnRyb2xOYW1lKSB7XG4gIC8vICAgdmFyIF9tdHIgPSBjb250cm9sTmFtZSA9PT0gJ210cic7XG4gIC8vICAgdmFyIF9jdiA9IHRoaXMuX2dldENvbnRyb2xzVmlzaWJpbGl0eSgpO1xuICAvLyAgIHZhciBfbWlkZGxlID0gIV9tdHIgJiYgY29udHJvbE5hbWVbMF0gPT0gXCJtXCI7XG4gIC8vICAgdmFyIF9jb3JuZXIgPSBjb250cm9sTmFtZSA9PT0gJ3RsJyB8fCBjb250cm9sTmFtZSA9PT0gJ3RyJyB8fCBjb250cm9sTmFtZSA9PT0gJ2JsJyB8fCBjb250cm9sTmFtZSA9PT0gJ2JyJztcbiAgLy9cbiAgLy8gICBpZiAoIXRoaXMuaGFzQm91bmRzQ29udHJvbHMgJiYgKF9tdHIgfHwgX2Nvcm5lciB8fCBfbWlkZGxlKSlyZXR1cm4gZmFsc2U7XG4gIC8vICAgaWYgKCF0aGlzLmhhc1JvdGF0aW5nUG9pbnQgJiYgX210ciApcmV0dXJuIGZhbHNlO1xuICAvLyAgIGlmICh0aGlzLmxvY2tVbmlTY2FsaW5nICYmIF9taWRkbGUpcmV0dXJuIGZhbHNlO1xuICAvL1xuICAvLyAgIGlmKF9jdltjb250cm9sTmFtZV0pIHJldHVybiB0cnVlO1xuICAvL1xuICAvLyAgIGlmKCFfY29ybmVyICYmICFfbWlkZGxlICYmICFfbXRyKXtcbiAgLy8gICAgIHJldHVybiBfY3YucFxuICAvLyAgIH1cbiAgLy9cbiAgLy8gICByZXR1cm4gZmFsc2U7XG4gIC8vIH1cbn0pO1xuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9tb2R1bGVzL2NvbnRyb2xzLmpzXG4vLyBtb2R1bGUgaWQgPSA2MFxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCIndXNlIHN0cmljdCc7XG5cblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuU2xpZGVDYW52YXMucHJvdG90eXBlLCB7XG4gIGJ1dHRvbkN1cnNvcjogICAgICAgICAgICAgJ3BvaW50ZXInLFxuICByb3RhdGlvbkN1cnNvcjogICAgICAgICAgICd1cmwoZGF0YTppbWFnZS9wbmc7YmFzZTY0LCcgKyByZXF1aXJlKCdiYXNlNjQtbG9hZGVyIS4vLi4vbWVkaWEvcm90YXRlLnBuZycpICsgJykgOCA4LGF1dG8nLFxuICBleWVkcm9wcGVyQ3Vyc29yOiAgICAgICAgICd1cmwoZGF0YTppbWFnZS9zdmcreG1sO3V0Zjg7YmFzZTY0LCcgKyByZXF1aXJlKCdiYXNlNjQtbG9hZGVyIS4vLi4vbWVkaWEvZXllZHJvcHBlci5zdmcnKSArICcpIDAgMTYsZGVmYXVsdCcsXG4gIHRhcmdldEN1cnNvcjogICAgICAgICAgICAgJ3VybChkYXRhOmltYWdlL3N2Zyt4bWw7dXRmODtiYXNlNjQsJysgcmVxdWlyZSgnYmFzZTY0LWxvYWRlciEuLy4uL21lZGlhL3RhcmdldC5zdmcnKSArICAnKSA4IDgsZGVmYXVsdCcsXG4gIHNwZWNpYWxQcm9wZXJ0aWVzOiBmYWJyaWMuU2xpZGVDYW52YXMucHJvdG90eXBlLnNwZWNpYWxQcm9wZXJ0aWVzLmNvbmNhdChbXCJjdXJzb3JMaW5lc1wiXSksXG4gIGN1cnNvckxpbmVzOiBmYWxzZSxcbiAgc2V0Q3Vyc29yTGluZXM6IGZ1bmN0aW9uKHZhbCl7XG4gICAgdGhpcy5jdXJzb3JMaW5lcyA9IHZhbDtcbiAgICBpZighdmFsKXJldHVybjtcblxuICAgIHRoaXMuX3ZDdXJzb3JMaW5lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XG4gICAgdGhpcy5fdkN1cnNvckxpbmUuY2xhc3NOYW1lID0gXCJ2ZXJ0aWNhbC1jdXJzb3ItbGluZVwiO1xuICAgIHRoaXMuX2hDdXJzb3JMaW5lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIik7XG4gICAgdGhpcy5faEN1cnNvckxpbmUuY2xhc3NOYW1lID0gXCJob3Jpem9udGFsLWN1cnNvci1saW5lXCI7XG4gICAgdGhpcy5fdkN1cnNvckxpbmUuc3R5bGUucG9zaXRpb24gPSBcImFic29sdXRlXCI7XG4gICAgdGhpcy5fdkN1cnNvckxpbmUuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgIHRoaXMuX3ZDdXJzb3JMaW5lLnN0eWxlLmhlaWdodCA9IFwiMTAwJVwiO1xuICAgIHRoaXMuX3ZDdXJzb3JMaW5lLnN0eWxlLndpZHRoID0gXCIxcHhcIjtcbiAgICB0aGlzLl92Q3Vyc29yTGluZS5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xuICAgIHRoaXMuX3ZDdXJzb3JMaW5lLnN0eWxlLmJhY2tncm91bmQgPSB0aGlzLmN1cnNvckxpbmVzO1xuICAgIHRoaXMuX2hDdXJzb3JMaW5lLnN0eWxlLnBvc2l0aW9uID0gXCJhYnNvbHV0ZVwiO1xuICAgIHRoaXMuX2hDdXJzb3JMaW5lLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICB0aGlzLl9oQ3Vyc29yTGluZS5zdHlsZS53aWR0aCA9IFwiMTAwJVwiO1xuICAgIHRoaXMuX2hDdXJzb3JMaW5lLnN0eWxlLmhlaWdodCA9IFwiMXB4XCI7XG4gICAgdGhpcy5faEN1cnNvckxpbmUuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcbiAgICB0aGlzLl9oQ3Vyc29yTGluZS5zdHlsZS5iYWNrZ3JvdW5kID0gdGhpcy5jdXJzb3JMaW5lcztcblxuXG4gICAgdGhpcy5vbignbW91c2U6b3V0JywgZnVuY3Rpb24oZSl7XG4gICAgICB0aGlzLmhpZGVMaW5lcygpO1xuICAgIH0pO1xuICAgIHRoaXMub24oJ21vdXNlOm1vdmUnLCBmdW5jdGlvbihlKXtcbiAgICAgIGlmKCF0aGlzLl9saW5lc0FkZGVkKXtcbiAgICAgICAgdGhpcy53cmFwcGVyRWwuaW5zZXJ0QmVmb3JlKHRoaXMuX2hDdXJzb3JMaW5lLHRoaXMudXBwZXJDYW52YXNFbCk7XG4gICAgICAgIHRoaXMud3JhcHBlckVsLmluc2VydEJlZm9yZSh0aGlzLl92Q3Vyc29yTGluZSx0aGlzLnVwcGVyQ2FudmFzRWwpO1xuICAgICAgICB0aGlzLl9saW5lc0FkZGVkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5fbGluZXNWaXNpYmxlID0gZmFsc2U7XG4gICAgICB9XG4gICAgICB0aGlzLmRyYXdDdXJzb3JMaW5lcyhlLmUpO1xuICAgIH0pXG4gIH0sXG4gIGhpZGVMaW5lczogZnVuY3Rpb24oKSB7XG5cbiAgICBpZiAodGhpcy5fbGluZXNWaXNpYmxlKSB7XG4gICAgICB0aGlzLl9saW5lc1Zpc2libGUgPSBmYWxzZTtcbiAgICAgIHRoaXMuX2hDdXJzb3JMaW5lLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICAgIHRoaXMuX3ZDdXJzb3JMaW5lLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcblxuICAgIH1cbiAgfSxcbiAgZHJhd0N1cnNvckxpbmVzOiBmdW5jdGlvbihlKXtcblxuICAgIGlmKHRoaXMuaXNEcmF3aW5nTW9kZSAmJiAhdGhpcy5faXNDdXJyZW50bHlEcmF3aW5nKXtcbiAgICAgIGlmKCF0aGlzLl9saW5lc1Zpc2libGUpe1xuICAgICAgICB0aGlzLl9saW5lc1Zpc2libGUgPSB0cnVlO1xuICAgICAgICB0aGlzLl9oQ3Vyc29yTGluZS5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xuICAgICAgICB0aGlzLl92Q3Vyc29yTGluZS5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xuICAgICAgfVxuICAgICAgdmFyIHBvaW50ID0gdGhpcy5nZXRQb2ludGVyKGUpO1xuICAgICAgdGhpcy5fdkN1cnNvckxpbmUuc3R5bGUubGVmdCA9IHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bNF0gICsgcG9pbnQueCAqIHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bM10gICsgXCJweFwiO1xuICAgICAgdGhpcy5faEN1cnNvckxpbmUuc3R5bGUudG9wID0gdGhpcy52aWV3cG9ydFRyYW5zZm9ybVs1XSArIHBvaW50LnkgKiB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzBdICsgXCJweFwiO1xuICAgIH1lbHNle1xuICAgICAgdGhpcy5oaWRlTGluZXMoKTtcbiAgICB9XG4gIH1cbn0pO1xuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9tb2R1bGVzL2N1cnNvcnMuanNcbi8vIG1vZHVsZSBpZCA9IDYxXG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIlxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuQ2FudmFzLnByb3RvdHlwZSwge1xuICAvKipcbiAgIH1cbiAgICog0L3QtSDQv9C+0LfQstC+0LvRj9C10YIg0YHQvdC40LzQsNGC0Ywg0LLRi9C00LXQu9C10L3QuNC1INGBINC+0LHRitC10LrRgtC+0LJcbiAgICovXG4gIGRlYWN0aXZhdGlvbkRpc2FibGVkOiBmYWxzZSxcbiAgLyoqXG4gICAqIERpc2NhcmRzIGN1cnJlbnRseSBhY3RpdmUgb2JqZWN0IGFuZCBmaXJlIGV2ZW50c1xuICAgKiBAcGFyYW0ge2V2ZW50fSBlXG4gICAqIEByZXR1cm4ge2ZhYnJpYy5DYW52YXN9IHRoaXNBcmdcbiAgICogQGNoYWluYWJsZVxuICAgKi9cbiAgZGlzY2FyZEFjdGl2ZU9iamVjdDogZnVuY3Rpb24gKGUpIHtcbiAgICB2YXIgYWN0aXZlT2JqZWN0ID0gdGhpcy5fYWN0aXZlT2JqZWN0O1xuICAgIGlmKCFhY3RpdmVPYmplY3QpcmV0dXJuIHRoaXM7XG5cbiAgICB0aGlzLmZpcmUoJ2JlZm9yZTpzZWxlY3Rpb246Y2xlYXJlZCcsIHsgdGFyZ2V0OiBhY3RpdmVPYmplY3QsIGU6IGUgfSk7XG5cbiAgICB0aGlzLl9kaXNjYXJkQWN0aXZlT2JqZWN0KCk7XG5cbiAgICB0aGlzLmZpcmUoJ3NlbGVjdGlvbjpjbGVhcmVkJywgeyBlOiBlIH0pO1xuICAgIGFjdGl2ZU9iamVjdCAmJiBhY3RpdmVPYmplY3QuZmlyZSgnZGVzZWxlY3RlZCcsIHsgZTogZSB9KTtcbiAgICByZXR1cm4gdGhpcztcbiAgfSxcbiAgX2Rpc2NhcmRBY3RpdmVPYmplY3Q6IGZ1bmN0aW9uKCl7XG4gICAgaWYgKHRoaXMuX2FjdGl2ZU9iamVjdCAmJiAhdGhpcy5kZWFjdGl2YXRpb25EaXNhYmxlZCAmJiAhdGhpcy5fYWN0aXZlT2JqZWN0LmRlYWN0aXZhdGlvbkRpc2FibGVkKSB7XG4gICAgICB0aGlzLl9hY3RpdmVPYmplY3Quc2V0KCdhY3RpdmUnLCBmYWxzZSk7XG4gICAgfVxuICAgIHRoaXMuX2FjdGl2ZU9iamVjdCA9IG51bGw7XG4gIH0sXG5cbiAgLyoqXG4gICAqIERpc2NhcmRzIGN1cnJlbnRseSBhY3RpdmUgZ3JvdXAgYW5kIGZpcmUgZXZlbnRzXG4gICAqIEByZXR1cm4ge2ZhYnJpYy5DYW52YXN9IHRoaXNBcmdcbiAgICogQGNoYWluYWJsZVxuICAgKi9cbiAgZGlzY2FyZEFjdGl2ZUdyb3VwOiBmdW5jdGlvbiAoZSkge1xuICAgIHZhciBnID0gdGhpcy5nZXRBY3RpdmVHcm91cCgpO1xuICAgIGlmKCFnKXJldHVybiB0aGlzO1xuICAgIHRoaXMuZmlyZSgnYmVmb3JlOnNlbGVjdGlvbjpjbGVhcmVkJywgeyBlOiBlLCB0YXJnZXQ6IGcgfSk7XG5cbiAgICBpZiAodGhpcy5kZWFjdGl2YXRpb25EaXNhYmxlZCB8fCBnLmRlYWN0aXZhdGlvbkRpc2FibGVkKSB7XG4gICAgICB0aGlzLl9hY3RpdmVHcm91cCA9IG51bGw7XG4gICAgfWVsc2V7XG4gICAgICB0aGlzLl9kaXNjYXJkQWN0aXZlR3JvdXAoKTtcbiAgICB9XG5cbiAgICB0aGlzLmZpcmUoJ3NlbGVjdGlvbjpjbGVhcmVkJywgeyBlOiBlIH0pO1xuICAgIHJldHVybiB0aGlzO1xuICB9LFxuXG4gIC8qKlxuICAgKiBEZWFjdGl2YXRlcyBhbGwgb2JqZWN0cyBvbiBjYW52YXMsIHJlbW92aW5nIGFueSBhY3RpdmUgZ3JvdXAgb3Igb2JqZWN0XG4gICAqIEByZXR1cm4ge2ZhYnJpYy5DYW52YXN9IHRoaXNBcmdcbiAgICogQGNoYWluYWJsZVxuICAgKi9cbiAgZGVhY3RpdmF0ZUFsbDogZnVuY3Rpb24gKCkge1xuICAgIGlmICghdGhpcy5kZWFjdGl2YXRpb25EaXNhYmxlZCkge1xuICAgICAgdmFyIGFsbE9iamVjdHMgPSB0aGlzLmdldE9iamVjdHMoKSxcbiAgICAgICAgaSA9IDAsXG4gICAgICAgIGxlbiA9IGFsbE9iamVjdHMubGVuZ3RoO1xuICAgICAgZm9yICg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAhYWxsT2JqZWN0c1tpXS5kZWFjdGl2YXRpb25EaXNhYmxlZCAmJiBhbGxPYmplY3RzW2ldLnNldCgnYWN0aXZlJywgZmFsc2UpO1xuICAgICAgfVxuICAgICAgdmFyIGcgPSB0aGlzLmdldEFjdGl2ZUdyb3VwKCk7XG4gICAgICBnICYmICFnLmRlYWN0aXZhdGlvbkRpc2FibGVkICYmICB0aGlzLl9kaXNjYXJkQWN0aXZlR3JvdXAoKTtcbiAgICAgIHRoaXMuX2FjdGl2ZU9iamVjdCAmJiAhdGhpcy5fYWN0aXZlT2JqZWN0LmRlYWN0aXZhdGlvbkRpc2FibGVkICYmIHRoaXMuX2Rpc2NhcmRBY3RpdmVPYmplY3QoKTtcbiAgICB9ZWxzZXtcbiAgICAgIHRoaXMuX2FjdGl2ZUdyb3VwID0gbnVsbDtcbiAgICAgIHRoaXMuX2FjdGl2ZU9iamVjdCA9IG51bGw7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9LFxuICBzZXRBY3RpdmVPYmplY3Q6IGZ1bmN0aW9uIChvYmplY3QsIGUpIHtcbiAgICBpZihvYmplY3Qpe1xuICAgICAgdGhpcy5fc2V0QWN0aXZlT2JqZWN0KG9iamVjdCk7XG4gICAgICB0aGlzLnJlbmRlckFsbCgpO1xuICAgICAgdGhpcy5maXJlKCdvYmplY3Q6c2VsZWN0ZWQnLCB7IHRhcmdldDogb2JqZWN0LCBlOiBlIH0pO1xuICAgICAgb2JqZWN0LmZpcmUoJ3NlbGVjdGVkJywgeyBlOiBlIH0pO1xuICAgIH1lbHNle1xuICAgICAgdGhpcy5kaXNjYXJkQWN0aXZlT2JqZWN0KCk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9LFxuICAvKipcbiAgICogQHByaXZhdGVcbiAgICogQHBhcmFtIHtPYmplY3R9IG9iamVjdFxuICAgKi9cbiAgX3NldEFjdGl2ZU9iamVjdDogZnVuY3Rpb24ob2JqZWN0KSB7XG4gICAgaWYgKCF0aGlzLmRlYWN0aXZhdGlvbkRpc2FibGVkKSB7XG4gICAgICBpZiAodGhpcy5fYWN0aXZlT2JqZWN0ICYmICF0aGlzLl9hY3RpdmVPYmplY3QuZGVhY3RpdmF0aW9uRGlzYWJsZWQpIHtcbiAgICAgICAgdGhpcy5fYWN0aXZlT2JqZWN0LnNldCgnYWN0aXZlJywgZmFsc2UpO1xuICAgICAgfVxuICAgIH1cbiAgICB0aGlzLl9hY3RpdmVPYmplY3QgPSBvYmplY3Q7XG5cbiAgICBpZihvYmplY3Qpe1xuICAgICAgb2JqZWN0LnNldCgnYWN0aXZlJywgdHJ1ZSk7XG4gICAgfVxuICB9XG59KTtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vbW9kdWxlcy9kZWFjdGl2YXRpb24uanNcbi8vIG1vZHVsZSBpZCA9IDYyXG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIid1c2Ugc3RyaWN0JztcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuU2xpZGVDYW52YXMucHJvdG90eXBlLCB7XG4gIHNldERyb3BwYWJsZTogZnVuY3Rpb24odmFsKXtcbiAgICB0aGlzLmRyb3BwYWJsZSA9IHZhbDtcbiAgICBpZih0aGlzLmRyb3BwYWJsZSl7XG4gICAgICB0aGlzLmluaXREcmFnQW5kRHJvcCgpO1xuICAgIH1cbiAgfSxcbiAgZHJvcHBhYmxlOiBmYWxzZSwgLy97fVxuICBpc0Ryb3BBdmFpbGFibGU6IGZ1bmN0aW9uIChkcm9wcGFibGUsIGRhdGEpIHtcblxuICAgIGZvciAodmFyIGkgaW4gZHJvcHBhYmxlKSB7XG4gICAgICBpZiAoZHJvcHBhYmxlW2ldLmNvbnN0cnVjdG9yID09IEFycmF5KSB7XG4gICAgICAgIGlmIChkcm9wcGFibGVbaV0uaW5kZXhPZihkYXRhW2ldKSA9PSAtMSlyZXR1cm4gZmFsc2U7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZihkcm9wcGFibGVbaV0gPT0gXCIqXCIpY29udGludWU7XG4gICAgICAgIGlmIChkcm9wcGFibGVbaV0gIT0gZGF0YVtpXSkgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgICAvL3JldHVybiAodGhpcy5zdXBwb3J0ZWRUeXBlcyA9PSBcIipcIiB8fCB0aGlzLnN1cHBvcnRlZFR5cGVzLmluZGV4T2YodHlwZSkhPSAtMSlcbiAgfSxcbiAgZHJvcDogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgIGRhdGEgPSBmYWJyaWMudXRpbC5vYmplY3QuY2xvbmUoZGF0YSk7XG5cbiAgICBpZiAoZGF0YS5jYXRlZ29yeSA9PSBcImJhY2tncm91bmRcIikge1xuICAgICAgdGhpcy5zZXRCYWNrZ3JvdW5kSW1hZ2UoZGF0YS5zcmMsIHRoaXMucmVuZGVyQWxsLmJpbmQodGhpcykpXG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgZGF0YS5hY3RpdmUgPSB0cnVlO1xuICAgICAgX3RoaXMuY3JlYXRlT2JqZWN0KGRhdGEpO1xuICAgIH1cblxuXG4gICAgLy9mYWJyaWMudXRpbC5jcmVhdGVPYmplY3QoZGF0YSwgZnVuY3Rpb24gKGVsKSB7XG4gICAgLy8gIGFwcC5jYW52YXMuYWRkKGVsKTtcbiAgICAvLyAgYXBwLmNhbnZhcy5zZXRBY3RpdmVPYmplY3QoZWwpO1xuICAgIC8vfSk7XG4gIH0sXG4gIGluaXREcmFnQW5kRHJvcDogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMub24oXCJtb3VzZTpkcm9wXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICB2YXIgX3ggPSAoZS54IC0gZS5vZmZzZXRYKTtcbiAgICAgIHZhciBfeSA9IChlLnkgLSBlLm9mZnNldFkpXG4gICAgICB2YXIgX3cgPSAoZS5kYXRhLndpZHRoIHx8IGUud2lkdGggICk7XG4gICAgICB2YXIgX2ggPSAoZS5kYXRhLmhlaWdodCB8fCBlLmhlaWdodCApO1xuICAgICAgaWYgKGUuZGF0YS5zY2FsZVgpIHtcbiAgICAgICAgdmFyIF9zY2FsZVggPSBlLmRhdGEuc2NhbGVYIC8gdGhpcy52aWV3cG9ydFRyYW5zZm9ybVswXVxuXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBfc2NhbGVYID0gMTtcbiAgICAgICAgX3cgLz0gdGhpcy52aWV3cG9ydFRyYW5zZm9ybVswXVxuICAgICAgfVxuXG4gICAgICBpZiAoZS5kYXRhLnNjYWxlWSkge1xuICAgICAgICB2YXIgX3NjYWxlWSA9IGUuZGF0YS5zY2FsZVkgLyB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzNdO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgX3NjYWxlWSA9IDE7XG4gICAgICAgIF9oIC89IHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bM11cbiAgICAgIH1cblxuICAgICAgaWYgKGUuZGF0YS5sZWZ0KSB7XG4gICAgICAgIF94ICs9IChlLmRhdGEubGVmdCArIGUuZGF0YS5zdHJva2VXaWR0aCkgLyB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzBdO1xuICAgICAgfVxuICAgICAgaWYgKGUuZGF0YS50b3ApIHtcbiAgICAgICAgX3kgKz0gKGUuZGF0YS50b3AgKyBlLmRhdGEuc3Ryb2tlV2lkdGgpIC8gdGhpcy52aWV3cG9ydFRyYW5zZm9ybVszXTtcbiAgICAgIH1cbiAgICAgIHZhciBkYXRhID0gZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCh7fSwgZS5kYXRhLCB7XG4gICAgICAgIHNjYWxlWDogX3NjYWxlWCxcbiAgICAgICAgc2NhbGVZOiBfc2NhbGVZLFxuICAgICAgICBsZWZ0OiBfeCxcbiAgICAgICAgdG9wOiBfeSxcbiAgICAgICAgd2lkdGg6IF93LFxuICAgICAgICBoZWlnaHQ6IF9oLFxuICAgICAgICBvcmlnaW5hbFdpZHRoOiBlLmRhdGEud2lkdGgsXG4gICAgICAgIG9yaWdpbmFsSGVpZ2h0OiBlLmRhdGEuaGVpZ2h0XG4gICAgICB9KTtcblxuICAgICAgdmFyIGV2ZW50ID0gZS5vcmlnaW5hbEV2ZW50O1xuICAgICAgdmFyIHBvaW50ZXIgPSB0aGlzLmdldFBvaW50ZXIoZXZlbnQsIHRydWUpO1xuXG4gICAgICB2YXIgdGFyZ2V0ID0gdGhpcy5fc2VhcmNoUG9zc2libGVUYXJnZXRzKHRoaXMuX2JhY2tncm91bmRMYXllciwgcG9pbnRlcik7XG4gICAgICBpZiAodGFyZ2V0KSB7XG4gICAgICAgIHRoaXMuc2V0QWN0aXZlQXJlYSh0YXJnZXQpO1xuICAgICAgICBkYXRhLmNsaXBUbyA9IFwiI1wiICsgdGFyZ2V0LmlkO1xuICAgICAgICBkYXRhLm1vdmVtZW50TGltaXRzID0gXCIjXCIgKyB0YXJnZXQuaWQ7XG4gICAgICB9XG5cblxuICAgICAgaWYgKGUudGFyZ2V0ICYmIGUudGFyZ2V0LmRyb3BwYWJsZSkge1xuICAgICAgICBpZiAodGhpcy5pc0Ryb3BBdmFpbGFibGUoZS50YXJnZXQuZHJvcHBhYmxlLCBlLmRhdGEpKSB7XG4gICAgICAgICAgZS50YXJnZXQuZGVhY3RpdmF0ZSgpO1xuICAgICAgICAgIGUudGFyZ2V0LmRyb3AoZGF0YSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmICh0aGlzLmRyb3BwYWJsZSAmJiB0aGlzLmlzRHJvcEF2YWlsYWJsZSh0aGlzLmRyb3BwYWJsZSwgZS5kYXRhKSkge1xuICAgICAgICAgIHRoaXMuZHJvcChkYXRhKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICAgIHRoaXMub24oXCJtb3VzZTpkcmFnZW50ZXJcIiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgIGlmIChlLnRhcmdldCAmJiBlLnRhcmdldC5kcm9wcGFibGUpIHtcbiAgICAgICAgaWYgKHRoaXMuaXNEcm9wQXZhaWxhYmxlKGUudGFyZ2V0LmRyb3BwYWJsZSwgZS5kYXRhKSkge1xuICAgICAgICAgIGUudGFyZ2V0LmFjdGl2YXRlKCk7XG4gICAgICAgICAgZS5lLmhlbHBlci5jc3MoXCJjdXJzb3JcIiwgXCJhbGlhc1wiKTtcbiAgICAgICAgICB0aGlzLnNldEN1cnNvcihcImFsaWFzXCIpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGUuZS5oZWxwZXIuY3NzKFwiY3Vyc29yXCIsIFwibm90LWFsbG93ZWRcIik7XG4gICAgICAgICAgdGhpcy5zZXRDdXJzb3IoXCJub3QtYWxsb3dlZFwiKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICAgIHRoaXMub24oXCJtb3VzZTpkcmFnbGVhdmVcIiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgIGlmIChlLnRhcmdldCAmJiBlLnRhcmdldC5kcm9wcGFibGUpIHtcbiAgICAgICAgaWYgKHRoaXMuaXNEcm9wQXZhaWxhYmxlKGUudGFyZ2V0LmRyb3BwYWJsZSwgZS5kYXRhKSkge1xuICAgICAgICAgIHRoaXMuX2FjdGl2YXRlZCA9IGZhbHNlO1xuICAgICAgICAgIGUudGFyZ2V0LmRlYWN0aXZhdGUoKVxuICAgICAgICB9XG4gICAgICAgIGUuZS5oZWxwZXIuY3NzKFwiY3Vyc29yXCIsIFwicG9pbnRlclwiKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxufSk7XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL21vZHVsZXMvZHJvcHBhYmxlLmpzXG4vLyBtb2R1bGUgaWQgPSA2M1xuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCJcbmZhYnJpYy5TbGlkZUNhbnZhcy5hZGRQbHVnaW4oXCJpbml0aWFsaXplXCIsZnVuY3Rpb24oKXtcbiAgaWYodHlwZW9mIHRoaXMuZnJlZURyYXdpbmdCcnVzaCA9PSBcInN0cmluZ1wiICl7XG4gICAgdGhpcy5zZXRGcmVlRHJhd2luZ0JydXNoKHRoaXMuZnJlZURyYXdpbmdCcnVzaCk7XG4gIH1cbn0pO1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUse1xuICAvKipcbiAgICogWydQZW5jaWxCcnVzaCcsJ1JlY3RhbmdsZUJydXNoJ11cbiAgICovXG4gIGFjdGl2ZURyYXdpbmdUb29sczogW10sXG4gIC8qKlxuICAgKlxuICAgICB7XG4gICAgICBCcnVzaENsYXNzTmFtZToge1xuICAgICAgICBjbGFzc05hbWU6ICdicnVzaCBjbGFzc05hbWUnLFxuICAgICAgICB0aXRsZTogJ2JydXNoIHRpdGxlJ1xuICAgICAgfVxuICAgIH1cbiAgICovXG4gIGRyYXdpbmdUb29sczoge30sXG4gIGluc2VydERyYXdpbmdUb29sOiBmYWxzZSxcbiAgYWN0aW9uczogZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuU2xpZGVDYW52YXMucHJvdG90eXBlLmFjdGlvbnMse1xuICAgIGRyYXdpbmdUb29sOiB7XG4gICAgICB0aXRsZTogJ2RyYXdpbmctdG9vbCcsXG4gICAgICB0eXBlOiAnb3B0aW9ucycsXG4gICAgICB2YWx1ZTogJ2ZyZWVEcmF3aW5nQnJ1c2gnLFxuICAgICAgbWVudTogZnVuY3Rpb24oKXtcbiAgICAgICAgdmFyIF90b29scyA9IHt9O1xuICAgICAgICBmb3IodmFyIGkgaW4gdGhpcy5hY3RpdmVEcmF3aW5nVG9vbHMpe1xuICAgICAgICAgIHZhciBfdG9vbCA9IHRoaXMuYWN0aXZlRHJhd2luZ1Rvb2xzW2ldO1xuICAgICAgICAgIF90b29sc1tfdG9vbF0gPSBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKHtvcHRpb246IF90b29sfSx0aGlzLmRyYXdpbmdUb29sc1tfdG9vbF0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBfdG9vbHM7XG4gICAgICB9XG4gICAgfVxuICB9KSxcbiAgZnJlZURyYXdpbmdCcnVzaDogJ1BlbmNpbEJydXNoJyxcbiAgZHJhd2luZ0NvbG9yOiBbMCwwLDAsMjU1XSxcbiAgX29uTW91c2VEb3duSW5EcmF3aW5nTW9kZTogZnVuY3Rpb24oZSkge1xuICAgIHRoaXMuX2lzQ3VycmVudGx5RHJhd2luZyA9IHRydWU7XG4gICAgaWYoIXRoaXMuZnJlZURyYXdpbmdCcnVzaC50YXJnZXQpe1xuICAgICAgdGhpcy5kaXNjYXJkQWN0aXZlT2JqZWN0KGUpLnJlbmRlckFsbCgpO1xuICAgIH1cbiAgICBpZiAodGhpcy5jbGlwVG8pIHtcbiAgICAgIGZhYnJpYy51dGlsLmNsaXBDb250ZXh0KHRoaXMsIHRoaXMuY29udGV4dFRvcCk7XG4gICAgfVxuICAgIHZhciBwb2ludGVyID0gdGhpcy5nZXRQb2ludGVyKGUpO1xuICAgIHRoaXMuZnJlZURyYXdpbmdCcnVzaC5vbk1vdXNlRG93bihwb2ludGVyKTtcbiAgICB0aGlzLl9oYW5kbGVFdmVudChlLCAnZG93bicpO1xuICB9LFxuICBnZXRGcmVlRHJhd2luZ0JydXNoOiBmdW5jdGlvbigpIHtcbiAgICBpZighdGhpcy5mcmVlRHJhd2luZ0JydXNoKXtcbiAgICAgIHJldHVybiBcIlNlbGVjdGlvblwiO1xuICAgIH1cbiAgICByZXR1cm4gIGZhYnJpYy51dGlsLnN0cmluZy5jYXBpdGFsaXplKGZhYnJpYy51dGlsLnN0cmluZy5jYW1lbGl6ZSh0aGlzLmZyZWVEcmF3aW5nQnJ1c2gudHlwZSksdHJ1ZSk7XG4gIH0sXG4gIHNldEZyZWVEcmF3aW5nQnJ1c2g6IGZ1bmN0aW9uKGJydXNoKSB7XG5cbiAgICBpZihicnVzaCA9PSAnU2VsZWN0aW9uJyl7XG4gICAgICB0aGlzLmlzRHJhd2luZ01vZGUgPSBmYWxzZTtcbiAgICAgIHRoaXMuZnJlZURyYXdpbmdCcnVzaCA9IFwiXCI7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHZhciBjbGFzc05hbWUgPSBmYWJyaWMudXRpbC5zdHJpbmcuY2FwaXRhbGl6ZShmYWJyaWMudXRpbC5zdHJpbmcuY2FtZWxpemUoYnJ1c2gpLHRydWUpO1xuICAgIGlmKHRoaXNbXCJfX1wiICsgY2xhc3NOYW1lXSl7XG4gICAgICB0aGlzLmZyZWVEcmF3aW5nQnJ1c2ggPSB0aGlzW1wiX19cIiArIGNsYXNzTmFtZV0gO1xuICAgIH1lbHNle1xuICAgICAgdGhpcy5mcmVlRHJhd2luZ0JydXNoID0gdGhpc1tcIl9fXCIgKyBjbGFzc05hbWVdID0gbmV3ICBmYWJyaWNbY2xhc3NOYW1lXSh0aGlzKTtcbiAgICB9XG4gICAgdGhpcy5maXJlKFwiYnJ1c2g6Y2hhbmdlZFwiLHticnVzaDogdGhpcy5mcmVlRHJhd2luZ0JydXNofSk7XG4gIH0sXG4gIGRyYXdab29tZWRBcmVhIDogZnVuY3Rpb24oY3R4LGxlZnQsIHRvcCAsd2lkdGgsIGhlaWdodCAsIHBvaW50ZXIgKSB7XG5cbiAgICB3aWR0aCA9IHdpZHRoIHx8IDkwO1xuICAgIGhlaWdodCA9IGhlaWdodCB8fCA5MDtcblxuICAgIGN0eC5zYXZlKCk7XG4gICAgY3R4LnRyYW5zbGF0ZShsZWZ0IHx8IDAsIHRvcCB8fCAwKTtcblxuICAgIGN0eC5maWxsU3R5bGUgPSAnYmxhY2snO1xuICAgIGN0eC5zdHJva2VTdHlsZSA9IFwiI2ZmZlwiO1xuICAgIGN0eC5zdHJva2VXaWR0aCA9IDE7XG4gICAgY3R4LnNldExpbmVEYXNoKFsyLCAyXSk7XG4gICAgY3R4LmRyYXdJbWFnZSh0aGlzLmJhY2tncm91bmRJbWFnZS5fZWxlbWVudCxNYXRoLmZsb29yKHBvaW50ZXIueCkgLSA0LCBNYXRoLmZsb29yKHBvaW50ZXIueSkgLSA0ICwgOSAsIDksIDAsMCAsIHdpZHRoLCB3aWR0aCApO1xuICAgIGN0eC5zdHJva2VSZWN0KDAsMCAsIHdpZHRoLCB3aWR0aCk7XG4gICAgY3R4LnN0cm9rZVJlY3QoNDAgLCA0MCAsIDEwLCAxMCk7XG4gICAgY3R4LnJlc3RvcmUoKTtcbiAgfVxufSk7XG5cbmZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUuZHJhd2luZ1Rvb2xzLlNlbGVjdGlvbiA9IHtcbiAgY2xhc3NOYW1lOiAnZmEgZmEtbW91c2UtcG9pbnRlcicsXG4gIHRpdGxlOiAnU2VsZWN0aW9uJ1xufTtcbmZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUuYWN0aXZlRHJhd2luZ1Rvb2xzLnB1c2goXCJTZWxlY3Rpb25cIik7XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL21vZHVsZXMvZWRpdG9yLmpzXG4vLyBtb2R1bGUgaWQgPSA2NFxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCJcbmZhYnJpYy5BcHBsaWNhdGlvbi5wcm90b3R5cGUuZXZlbnRMaXN0ZW5lcnNbXCJlbnRpdHk6Y3JlYXRlZFwiXS5wdXNoKGZ1bmN0aW9uKGUpe1xuICAgIGlmKGUudGFyZ2V0LmV2ZW50TGlzdGVuZXJzKXtcbiAgICAgIGZvcih2YXIgaSBpbiBlLnRhcmdldC5ldmVudExpc3RlbmVycykge1xuICAgICAgICB2YXIgX2xpc3RlbmVycyA9IGUudGFyZ2V0LmV2ZW50TGlzdGVuZXJzW2ldO1xuICAgICAgICBpZihfbGlzdGVuZXJzLmNvbnN0cnVjdG9yID09IEFycmF5KXtcbiAgICAgICAgICBmb3IgKHZhciBqIGluIF9saXN0ZW5lcnMpIHtcbiAgICAgICAgICAgIGUudGFyZ2V0Lm9uKGksIF9saXN0ZW5lcnNbal0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgZS50YXJnZXQub24oaSwgX2xpc3RlbmVycyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZihlLm9wdGlvbnMuZXZlbnRMaXN0ZW5lcnMpe1xuICAgICAgZm9yKHZhciBpIGluIGUub3B0aW9ucy5ldmVudExpc3RlbmVycyl7XG4gICAgICAgIGUudGFyZ2V0Lm9uKGksZS5vcHRpb25zLmV2ZW50TGlzdGVuZXJzW2ldKTtcbiAgICAgIH1cbiAgICB9XG4gICAgZGVsZXRlIGUub3B0aW9ucy5ldmVudExpc3RlbmVycztcblxuICBpZihlLnRhcmdldC5fZGVmYXVsdF9ldmVudF9saXN0ZW5lcnMpe1xuICAgIGZvcih2YXIgaSBpbiBlLnRhcmdldC5fZGVmYXVsdF9ldmVudF9saXN0ZW5lcnMpe1xuICAgICAgZS50YXJnZXQub24oaSxlLnRhcmdldC5fZGVmYXVsdF9ldmVudF9saXN0ZW5lcnNbaV0pO1xuICAgIH1cbiAgfVxufSk7XG5cbi8vXG4vLyBmYWJyaWMub24oXCJjYW52YXM6Y3JlYXRlZFwiLGZ1bmN0aW9uKCl7XG4vLyAgIGlmKHRoaXMuX2RlZmF1bHRfZXZlbnRfbGlzdGVuZXJzKXtcbi8vICAgICBmb3IodmFyIGkgaW4gdGhpcy5fZGVmYXVsdF9ldmVudF9saXN0ZW5lcnMpe1xuLy8gICAgICAgdGhpcy5vbihpLHRoaXMuX2RlZmF1bHRfZXZlbnRfbGlzdGVuZXJzW2ldKTtcbi8vICAgICB9XG4vLyAgIH1cbi8vIH0pO1xuXG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLkFwcGxpY2F0aW9uLnByb3RvdHlwZSwge1xuICBpbml0RXZlbnRMaXN0ZW5lcnM6IGZ1bmN0aW9uKCl7XG4gICAgaWYoIXRoaXMuX19ldmVudExpc3RlbmVycyl7XG4gICAgICB0aGlzLl9fZXZlbnRMaXN0ZW5lcnMgPSB7fTtcbiAgICB9XG4gICAgZm9yICh2YXIgZXZlbnQgaW4gdGhpcy5ldmVudExpc3RlbmVycykge1xuICAgICAgaWYoIXRoaXMuX19ldmVudExpc3RlbmVyc1tldmVudF0pe1xuICAgICAgICB0aGlzLl9fZXZlbnRMaXN0ZW5lcnNbZXZlbnRdID0gW11cbiAgICAgIH1cbiAgICAgIHRoaXMuX19ldmVudExpc3RlbmVyc1tldmVudF0gPSB0aGlzLl9fZXZlbnRMaXN0ZW5lcnNbZXZlbnRdLmNvbmNhdCAodGhpcy5ldmVudExpc3RlbmVyc1tldmVudF0pO1xuICAgIH1cblxuICAgIGlmKHRoaXMub3B0aW9ucy5ldmVudExpc3RlbmVycyl7XG4gICAgICB0aGlzLm9uKHRoaXMub3B0aW9ucy5ldmVudExpc3RlbmVycyk7XG4gICAgfVxuXG5cbiAgICAvLyBmb3IgKHZhciBrbGFzc05hbWUgaW4gdGhpcy5vcHRpb25zLmV2ZW50TGlzdGVuZXJzKSB7XG4gICAgLy8gICB2YXIgX3Byb3RvID0gdGhpcy5vcHRpb25zLmV2ZW50TGlzdGVuZXJzW2tsYXNzTmFtZV07XG4gICAgLy8gICBpZiAoZmFicmljW2tsYXNzTmFtZV0ucHJvdG90eXBlLl9kZWZhdWx0X2V2ZW50X2xpc3RlbmVycykge1xuICAgIC8vICAgICBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpY1trbGFzc05hbWVdLnByb3RvdHlwZS5fZGVmYXVsdF9ldmVudF9saXN0ZW5lcnMsIF9wcm90bylcbiAgICAvLyAgIH0gZWxzZSB7XG4gICAgLy8gICAgIGZhYnJpY1trbGFzc05hbWVdLnByb3RvdHlwZS5fZGVmYXVsdF9ldmVudF9saXN0ZW5lcnMgPSBfcHJvdG87XG4gICAgLy8gICB9XG4gICAgLy8gfVxuICAgIC8vIGRlbGV0ZSB0aGlzLm9wdGlvbnNbJ2V2ZW50TGlzdGVuZXJzJ107XG4gIH1cbn0pO1xuXG5cbi8vIGZhYnJpYy5BcHBsaWNhdGlvblxuLy8gICAuYWRkUGx1Z2luKFwiY29uZmlndXJhdGlvblwiLFwiaW5pdEV2ZW50TGlzdGVuZXJzXCIpO1xuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9tb2R1bGVzL2V2ZW50TGlzdGVuZXJzLmpzXG4vLyBtb2R1bGUgaWQgPSA2NVxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCIndXNlIHN0cmljdCc7XG5cblxuLypcbiBmYWJyaWMuSW1hZ2UuZmlsdGVycy5SZWRpZnkgPSBmYWJyaWMudXRpbC5jcmVhdGVDbGFzcyhmYWJyaWMuSW1hZ2UuZmlsdGVycy5CYXNlRmlsdGVyLCB7XG4gdHlwZTogJ1JlZGlmeScsXG4gYXBwbHlUbzogZnVuY3Rpb24gKGNhbnZhc0VsKSB7XG4gdmFyIGNvbnRleHQgPSBjYW52YXNFbC5nZXRDb250ZXh0KCcyZCcpLFxuIGltYWdlRGF0YSA9IGNvbnRleHQuZ2V0SW1hZ2VEYXRhKDAsIDAsXG4gY2FudmFzRWwud2lkdGgsIGNhbnZhc0VsLmhlaWdodCksXG4gZGF0YSA9IGltYWdlRGF0YS5kYXRhO1xuIGZvciAodmFyIGkgPSAwLCBsZW4gPSBkYXRhLmxlbmd0aDsgaSA8IGxlbjsgaSArPSA0KSB7XG4gZGF0YVtpICsgMV0gPSAwO1xuIGRhdGFbaSArIDJdID0gMDtcbiB9XG4gY29udGV4dC5wdXRJbWFnZURhdGEoaW1hZ2VEYXRhLCAwLCAwKTtcbiB9XG4gfSk7XG4gZmFicmljLkltYWdlLmZpbHRlcnMuUmVkaWZ5LmZyb21PYmplY3QgPSBmdW5jdGlvbiAob2JqZWN0KSB7XG4gcmV0dXJuIG5ldyBmYWJyaWMuSW1hZ2UuZmlsdGVycy5SZWRpZnkob2JqZWN0KTtcbiB9O1xuICovXG5cbmZhYnJpYy5JbWFnZS5maWx0ZXJzLlNoYXJwZW4gPSBmYWJyaWMudXRpbC5jcmVhdGVDbGFzcyhmYWJyaWMuSW1hZ2UuZmlsdGVycy5Db252b2x1dGUsIHtcbiAgdHlwZTogJ1NoYXJwZW4nLFxuICBpbml0aWFsaXplOiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwgeyB9O1xuXG4gICAgdGhpcy5vcGFxdWUgPSBvcHRpb25zLm9wYXF1ZTtcbiAgICB0aGlzLm1hdHJpeCA9IG9wdGlvbnMubWF0cml4IHx8IFtcbiAgICAgICAgMCwgLTEsIDAsXG4gICAgICAgIC0xLCA1LCAtMSxcbiAgICAgICAgMCwgLTEsIDBcbiAgICAgIF07XG4gIH1cbn0pO1xuZmFicmljLkltYWdlLmZpbHRlcnMuU2hhcnBlbi5mcm9tT2JqZWN0ID0gZnVuY3Rpb24gKG9iamVjdCkge1xuICByZXR1cm4gbmV3IGZhYnJpYy5JbWFnZS5maWx0ZXJzLlNoYXJwZW4ob2JqZWN0KTtcbn07XG5cbmZhYnJpYy5JbWFnZS5maWx0ZXJzLkJsdXIgPSBmYWJyaWMudXRpbC5jcmVhdGVDbGFzcyhmYWJyaWMuSW1hZ2UuZmlsdGVycy5Db252b2x1dGUsIHtcbiAgdHlwZTogJ0JsdXInLFxuICBpbml0aWFsaXplOiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwgeyB9O1xuXG4gICAgdmFyIF92ID0gMSAvIDk7XG4gICAgdGhpcy5vcGFxdWUgPSBvcHRpb25zLm9wYXF1ZTtcbiAgICB0aGlzLm1hdHJpeCA9IG9wdGlvbnMubWF0cml4IHx8IFtcbiAgICAgICAgX3YsIF92LCBfdixcbiAgICAgICAgX3YsIF92LCBfdixcbiAgICAgICAgX3YsIF92LCBfdlxuICAgICAgXTtcbiAgfVxufSk7XG5mYWJyaWMuSW1hZ2UuZmlsdGVycy5CbHVyLmZyb21PYmplY3QgPSBmdW5jdGlvbiAob2JqZWN0KSB7XG4gIHJldHVybiBuZXcgZmFicmljLkltYWdlLmZpbHRlcnMuQmx1cihvYmplY3QpO1xufTtcblxuZmFicmljLkltYWdlLmZpbHRlcnMuRW1ib3NzID0gZmFicmljLnV0aWwuY3JlYXRlQ2xhc3MoZmFicmljLkltYWdlLmZpbHRlcnMuQ29udm9sdXRlLCB7XG4gIHR5cGU6ICdFbWJvc3MnLFxuICBpbml0aWFsaXplOiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwgeyB9O1xuXG4gICAgdGhpcy5vcGFxdWUgPSBvcHRpb25zLm9wYXF1ZTtcbiAgICB0aGlzLm1hdHJpeCA9IG9wdGlvbnMubWF0cml4IHx8IFtcbiAgICAgICAgMSwgICAxLCAgIDEsXG4gICAgICAgIDEsIDAuNywgIC0xLFxuICAgICAgICAtMSwgIC0xLCAgLTFcbiAgICAgIF07XG4gIH1cbn0pO1xuZmFicmljLkltYWdlLmZpbHRlcnMuRW1ib3NzLmZyb21PYmplY3QgPSBmdW5jdGlvbiAob2JqZWN0KSB7XG4gIHJldHVybiBuZXcgZmFicmljLkltYWdlLmZpbHRlcnMuRW1ib3NzKG9iamVjdCk7XG59O1xuXG5cblxuZmFicmljLkltYWdlLnByb3RvdHlwZS5nZXRGaWx0ZXIgPSBmdW5jdGlvbiAoZmlsdGVyTmFtZSkge1xuICBmaWx0ZXJOYW1lID0gZmFicmljLnV0aWwuc3RyaW5nLnVuY2FwaXRhbGl6ZShmaWx0ZXJOYW1lKTtcbiAgZm9yKHZhciBpIGluIHRoaXMuZmlsdGVycyl7XG4gICAgaWYoZmFicmljLnV0aWwuc3RyaW5nLnVuY2FwaXRhbGl6ZSh0aGlzLmZpbHRlcnNbaV0udHlwZSkgPT09IGZpbHRlck5hbWUpe1xuICAgICAgcmV0dXJuIHRoaXMuZmlsdGVyc1tpXTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufTtcblxuZmFicmljLkltYWdlLnByb3RvdHlwZS5zZXRGaWx0ZXIgPSBmdW5jdGlvbiAoZmlsdGVyKSB7XG5cbiAgdmFyIF9vbGRfZmlsdGVyID0gZmFsc2U7XG4gIGlmKGZpbHRlci5yZXBsYWNlKXtcbiAgICB0aGlzLmZpbHRlcnMgPSBbXTtcbiAgfWVsc2V7XG4gICAgX29sZF9maWx0ZXIgPSBmYWJyaWMudXRpbC5vYmplY3QuZmluZFdoZXJlKHRoaXMuZmlsdGVycywge3R5cGU6IGZpbHRlci50eXBlfSk7XG4gICAgX29sZF9maWx0ZXIgPSBfb2xkX2ZpbHRlciAmJiBfb2xkX2ZpbHRlci50b09iamVjdCgpIHx8IGZhbHNlO1xuICB9XG5cblxuICBpZihmaWx0ZXIudHlwZSl7XG4gICAgdmFyIF90eXBlID0gZmFicmljLnV0aWwuc3RyaW5nLmNhcGl0YWxpemUoZmlsdGVyLnR5cGUsdHJ1ZSk7XG4gICAgdmFyIF9uZXdfZmlsdGVyID0gZmlsdGVyLm9wdGlvbnMgJiYgZmFicmljLnV0aWwub2JqZWN0LmNsb25lKGZpbHRlci5vcHRpb25zKTtcblxuXG4gIH1lbHNle1xuICAgIF90eXBlID0gZmFsc2U7XG4gICAgX25ld19maWx0ZXIgPSBmYWxzZTtcbiAgfVxuXG4gIC8qIHRoaXMucHJvamVjdC5oaXN0b3J5LmFkZCh7XG4gICBkYXRhOiAgIFskLmV4dGVuZCh0cnVlLCB7fSwgdGhpcy5kYXRhKV0sXG4gICBzbGlkZTogIHRoaXMuc2xpZGUsXG4gICBvYmplY3Q6IHRoaXMsXG4gICByZWRvOiAgIGZpbHRlcixcbiAgIHVuZG86ICAgX29sZF9maWx0ZXIgLFxuICAgdHlwZTogICBcImZpbHRlclwiLFxuICAgdW5kb0ZuOiBmdW5jdGlvbihhY3Rpb24pe1xuICAgYWN0aW9uLm9iamVjdC5fc2V0X2ZpbHRlcihhY3Rpb24udW5kbyk7XG4gICB9LFxuICAgcmVkb0ZuOiAgZnVuY3Rpb24oYWN0aW9uKXtcbiAgIGFjdGlvbi5vYmplY3QuX3NldF9maWx0ZXIoYWN0aW9uLnJlZG8pO1xuICAgfVxuICAgfSk7XG4gICAqL1xuICB0aGlzLl9zZXRfZmlsdGVyKF90eXBlLCBfbmV3X2ZpbHRlciwgX29sZF9maWx0ZXIpO1xuXG59O1xuXG5mYWJyaWMuSW1hZ2UucHJvdG90eXBlLl9zZXRfZmlsdGVyID0gZnVuY3Rpb24gKF90eXBlLCBfbmV3X2ZpbHRlcikge1xuXG4gIGlmKF90eXBlKXtcbiAgICB2YXIgX29sZF9maWx0ZXIgPSB0aGlzLmdldEZpbHRlcihfdHlwZSk7XG4gIH1cblxuICBpZiAoX29sZF9maWx0ZXIgJiYgX25ld19maWx0ZXIpIHtcbiAgICBmb3IgKHZhciBpIGluIF9uZXdfZmlsdGVyKSB7XG4gICAgICBfb2xkX2ZpbHRlcltpXSA9IF9uZXdfZmlsdGVyW2ldO1xuICAgIH1cbiAgfSBlbHNlIGlmIChfb2xkX2ZpbHRlciAmJiAhX25ld19maWx0ZXIpIHtcbiAgICB0aGlzLmZpbHRlcnMuc3BsaWNlKHRoaXMuZmlsdGVycy5pbmRleE9mKF9vbGRfZmlsdGVyKSwgMSk7XG4gIH1cbiAgaWYgKCFfb2xkX2ZpbHRlciAmJiBfbmV3X2ZpbHRlcikge1xuICAgIHRoaXMuZmlsdGVycy5wdXNoKG5ldyBmYWJyaWMuSW1hZ2UuZmlsdGVyc1tfdHlwZV0oX25ld19maWx0ZXIpKTtcbiAgfVxuICB0aGlzLmFwcGx5RmlsdGVycyh0aGlzLmNhbnZhcy5yZW5kZXJBbGwuYmluZCh0aGlzLmNhbnZhcykpO1xufTtcblxudmFyIF9JTUcgPSBmYWJyaWMuSW1hZ2UucHJvdG90eXBlO1xuXG5cblxuZmFicmljLkltYWdlLmdldEZpbHRlcnNMaXN0ID0gZnVuY3Rpb24oZWwpe1xuXG4gIGVsID0gZWwgfHwgZmFicmljLkltYWdlLnByb3RvdHlwZTtcbiAgdmFyIGZpbHRlckxpc3QgPSBbXTtcbiAgZm9yKHZhciBpIGluIGVsLmF2YWlsYWJsZUZpbHRlcnMpe1xuICAgIHZhciBfZiA9IGZhYnJpYy5JbWFnZS5maWx0ZXJzW2VsLmF2YWlsYWJsZUZpbHRlcnNbaV1dO1xuXG4gICAgdmFyIF9kYXRhID0ge1xuICAgICAgdHlwZTogICAgIGVsLmF2YWlsYWJsZUZpbHRlcnNbaV1cbiAgICB9O1xuICAgIGlmKF9mLnByb3RvdHlwZS5jdXN0b20pe1xuICAgICAgaWYoIWVsLmN1c3RvbUZpbHRlcnMpe1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYoX2YucHJvdG90eXBlLm1hc2tGaWx0ZXIpe1xuICAgICAgaWYoIWVsLm1hc2tGaWx0ZXIpe1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYoX2YucHJvdG90eXBlLmNhbWFuKXtcbiAgICAgIGlmKCFlbC5jYW1hbkZpbHRlcnMpe1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIF9kYXRhLmNhbWFuID0gdHJ1ZTtcbiAgICB9ZWxzZXtcbiAgICAgIGlmKCFlbC5mYWJyaWNGaWx0ZXJzKXtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgfVxuICAgIGlmKF9mLnByb3RvdHlwZS5vcHRpb25zKXtcbiAgICAgIF9kYXRhLm9wdGlvbnMgPSBmYWJyaWMudXRpbC5vYmplY3QuY2xvbmUoX2YucHJvdG90eXBlLm9wdGlvbnMpO1xuICAgIH1cbiAgICBfZGF0YS50ZXh0ID0gX2YucHJvdG90eXBlLnRpdGxlIHx8IGVsLmF2YWlsYWJsZUZpbHRlcnNbaV07XG5cbiAgICBmaWx0ZXJMaXN0LnB1c2goX2RhdGEpXG4gIH1cbiAgcmV0dXJuIGZpbHRlckxpc3Q7XG59O1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5JbWFnZS5wcm90b3R5cGUsIHtcbiAgZmlsdGVyVG9vbDogICBmYWxzZSxcbiAgY2FtYW5GaWx0ZXJzOiBmYWxzZSxcbiAgZmFicmljRmlsdGVyczogdHJ1ZSxcbiAgY3VzdG9tRmlsdGVyczogZmFsc2UsXG4gIG1hc2tGaWx0ZXI6IGZhbHNlLFxuICBnZXRGaWx0ZXJzRGF0YSA6IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgX2ZpbHRlcnMgPSBmYWJyaWMuSW1hZ2UuZ2V0RmlsdGVyc0xpc3QodGhpcyk7XG4gICAgZm9yICh2YXIgaSBpbiB0aGlzLmZpbHRlcnMpIHtcbiAgICAgIHZhciBfZiA9IGZhYnJpYy51dGlsLm9iamVjdC5maW5kV2hlcmUoX2ZpbHRlcnMse3R5cGU6IGZhYnJpYy51dGlsLnN0cmluZy5jYXBpdGFsaXplKHRoaXMuZmlsdGVyc1tpXS50eXBlKX0pXG4gICAgICBpZihfZil7XG4gICAgICAgIF9mLmVuYWJsZWQgPSB0cnVlO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gX2ZpbHRlcnM7XG4gIH0sXG4gIGF2YWlsYWJsZUZpbHRlcnM6IFtcbiAgICAvL2ZhYnJpY0pTXG4gICAgXCJHcmF5c2NhbGVcIixcbiAgICBcIlNlcGlhXCIsXG4gICAgXCJTZXBpYTJcIixcbiAgICBcIkludmVydFwiLFxuICAgIFwiQmx1clwiLFxuICAgIFwiU2hhcnBlblwiLFxuICAgIFwiRW1ib3NzXCIsXG4gICAgXCJCbGVuZFwiLFxuICAgIFwiVGludFwiLFxuICAgIFwiTXVsdGlwbHlcIixcbiAgICAvL1wiQ29udm9sdXRlXCIsXG4gICAgXCJOb2lzZVwiLFxuICAgIFwiQnJpZ2h0bmVzc1wiLFxuICAgIFwiUGl4ZWxhdGVcIixcbiAgICBcIkdyYWRpZW50VHJhbnNwYXJlbmN5XCIsXG4gICAgXCJNYXNrXCJcbiAgXVxufSk7XG5cblxuZmFicmljLkltYWdlLmZpbHRlck1hbmFnZXIgPSB7XG5cbiAgLy9oaWRlOiBmdW5jdGlvbihvYmplY3Qpe1xuICAvL1xuICAvL30sXG4gIHNob3c6IGZ1bmN0aW9uIChvYmplY3QpIHtcbiAgICB0aGlzLmFjdGl2ZU9iamVjdCA9IG9iamVjdDtcbiAgICB0aGlzLmZpcmUoJ3Nob3cnLCBvYmplY3QpO1xuICAgIHRoaXMub24oJ3RhcmdldDpjaGFuZ2VkJywgb2JqZWN0KVxuICB9XG59O1xuXG5cbmZhYnJpYy5JbWFnZS5maWx0ZXJzLkJyaWdodG5lc3MucHJvdG90eXBlLm9wdGlvbnMgPSB7XG4gIFwiYnJpZ2h0bmVzc1wiOiB7dmFsdWU6IDEwMCwgbWluOiAwLCBtYXg6IDI1NX1cbn07XG5cbmZhYnJpYy5JbWFnZS5maWx0ZXJzLk5vaXNlLnByb3RvdHlwZS5vcHRpb25zID0ge1xuICBcIm5vaXNlXCI6IHt2YWx1ZTogMTAwLCBtaW46IDAsIG1heDogMTAwMH1cbn07XG5mYWJyaWMuSW1hZ2UuZmlsdGVycy5Db252b2x1dGUucHJvdG90eXBlLm9wdGlvbnMgPSB7XG4gIFwib3BhcXVlXCI6IHt2YWx1ZTogdHJ1ZSwgdHlwZTogXCJib29sZWFuXCIgfSxcbiAgXCJtYXRyaXhcIjoge3ZhbHVlOiBbMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMV0sIHR5cGU6IFwibWF0cml4XCIgfVxufTtcbmZhYnJpYy5JbWFnZS5maWx0ZXJzLkJsdXIucHJvdG90eXBlLm9wdGlvbnMgPSB7fTtcbmZhYnJpYy5JbWFnZS5maWx0ZXJzLlNoYXJwZW4ucHJvdG90eXBlLm9wdGlvbnMgPSB7fTtcbmZhYnJpYy5JbWFnZS5maWx0ZXJzLkVtYm9zcy5wcm90b3R5cGUub3B0aW9ucyA9IHt9O1xuZmFicmljLkltYWdlLmZpbHRlcnMuTXVsdGlwbHkucHJvdG90eXBlLm9wdGlvbnMgPSB7XG4gIFwiY29sb3JcIjoge3R5cGU6ICdjb2xvcicsIHZhbHVlOiBcIiNGMEZcIn1cbn07XG5mYWJyaWMuSW1hZ2UuZmlsdGVycy5QaXhlbGF0ZS5wcm90b3R5cGUub3B0aW9ucyA9IHtcbiAgXCJibG9ja3NpemVcIjoge3ZhbHVlOiA0LCBtaW46IDIsIG1heDogMjB9XG59O1xuZmFicmljLkltYWdlLmZpbHRlcnMuVGludC5wcm90b3R5cGUub3B0aW9ucyA9IHtcbiAgXCJjb2xvclwiOiAge3R5cGU6ICdjb2xvcicsIHZhbHVlOiBcIiMzNTEzQjBcIn0sXG4gIFwib3BhY2l0eVwiOiB7dmFsdWU6IDEsIG1pbjogMCwgbWF4OiAxLCBzdGVwOiAwLjF9XG59O1xuZmFicmljLkltYWdlLmZpbHRlcnMuTWFzay5wcm90b3R5cGUubWFza0ZpbHRlciA9IHRydWU7XG5mYWJyaWMuSW1hZ2UuZmlsdGVycy5NYXNrLnByb3RvdHlwZS5vcHRpb25zID0ge1xuICBtYXNrOiB7XG4gICAgdHlwZTogJ2ltYWdlJyxcbiAgICB2YWx1ZToge1xuICAgICAgc3JjOiAgXCJwaG90b3MvZXhwbG9zaW9uLnBuZ1wiXG4gICAgfVxuICB9LFxuICBjaGFubmVsOiB7IHZhbHVlOiAwfVxufTtcblxuZmFicmljLkltYWdlLmZpbHRlcnMuQmxlbmQucHJvdG90eXBlLm9wdGlvbnMgPSB7XG4gIFwiY29sb3JcIjoge3R5cGU6ICdjb2xvcicsIHZhbHVlOiBcIiMzNTEzQjBcIn0sXG4gIFwibW9kZVwiOiB7XG4gICAgdmFsdWU6IFwiYWRkXCIsXG4gICAgb3B0aW9uczogW1xuICAgICAge3ZhbHVlOiBcImFkZFwiLCB0aXRsZTogXCJBZGRcIn0sXG4gICAgICB7dmFsdWU6IFwiZGlmZlwiLCB0aXRsZTogXCJEaWZmXCJ9LFxuICAgICAge3ZhbHVlOiBcInN1YnRyYWN0XCIsIHRpdGxlOiBcIlN1YnRyYWN0XCJ9LFxuICAgICAge3ZhbHVlOiBcIm11bHRpcGx5XCIsIHRpdGxlOiBcIk11bHRpcGx5XCJ9LFxuICAgICAge3ZhbHVlOiBcInNjcmVlblwiLCB0aXRsZTogXCJTY3JlZW5cIn0sXG4gICAgICB7dmFsdWU6IFwibGlnaHRlblwiLCB0aXRsZTogXCJMaWdodGVuXCJ9LFxuICAgICAge3ZhbHVlOiBcImRhcmtlblwiLCB0aXRsZTogXCJEYXJrZW5cIn1cbiAgICBdXG4gIH1cbn07XG5cblxuXG5mYWJyaWMudXRpbC5vYnNlcnZhYmxlKGZhYnJpYy5JbWFnZS5maWx0ZXJNYW5hZ2VyKTtcblxuZmFicmljLnV0aWwuZHJhd0ZpbHRlciA9IGZ1bmN0aW9uKGVsZW1lbnQsc3JjLCBmaWx0ZXJOYW1lICxvcHRpb25zKXtcbiAgdmFyIGN0eCA9ZWxlbWVudC5nZXRDb250ZXh0KFwiMmRcIik7XG4gIGZhYnJpYy51dGlsLmxvYWRJbWFnZShzcmMsZnVuY3Rpb24oZWwpe1xuXG4gICAgaWYob3B0aW9ucyl7XG4gICAgICBpZihvcHRpb25zLndpZHRoICYmIG9wdGlvbnMuaGVpZ2h0KXtcbiAgICAgICAgZWxlbWVudC53aWR0aCA9IG9wdGlvbnMud2lkdGg7XG4gICAgICAgIGVsZW1lbnQuaGVpZ2h0ID0gb3B0aW9ucy5oZWlnaHQ7XG4gICAgICB9ZWxzZSBpZihvcHRpb25zLndpZHRoKXtcbiAgICAgICAgZWxlbWVudC53aWR0aCA9IG9wdGlvbnMud2lkdGg7XG4gICAgICAgIGVsZW1lbnQuaGVpZ2h0ID0gb3B0aW9ucy53aWR0aCAqIChlbC5oZWlnaHQgLyBlbC53aWR0aCk7XG4gICAgICB9ZWxzZSBpZihvcHRpb25zLmhlaWdodCl7XG4gICAgICAgIGVsZW1lbnQuaGVpZ2h0ID0gb3B0aW9ucy5oZWlnaHQ7XG4gICAgICAgIGVsZW1lbnQud2lkdGggPSBvcHRpb25zLmhlaWdodCAqIChlbC53aWR0aCAvIGVsLmhlaWdodCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgY3R4LmRyYXdJbWFnZShlbCwwLDAsZWxlbWVudC53aWR0aCxlbGVtZW50LmhlaWdodCk7XG4gICAgaWYoIWZpbHRlck5hbWUpcmV0dXJuO1xuICAgIGZpbHRlck5hbWUgPSBmYWJyaWMudXRpbC5zdHJpbmcuY2FwaXRhbGl6ZShmaWx0ZXJOYW1lLHRydWUpO1xuXG4gICAgaWYoZmFicmljLkltYWdlLmZpbHRlcnNbZmlsdGVyTmFtZV0pe1xuICAgICAgdmFyIF9maWx0ZXIgPSBuZXcgZmFicmljLkltYWdlLmZpbHRlcnNbZmlsdGVyTmFtZV0oKVxuICAgIH1lbHNle1xuICAgICAgdmFyIF9maWx0ZXIgPWZhYnJpYy5JbWFnZS5maWx0ZXJzW2ZpbHRlck5hbWVdLmNyZWF0ZSh7fSk7XG4gICAgfVxuXG4gICAgLy92YXIgX2ZpbHRlciA9IG5ldyBmYWJyaWMuSW1hZ2UuZmlsdGVyc1tmaWx0ZXJOYW1lXTtcbiAgICBpZihfZmlsdGVyKXtcbiAgICAgIHZhciBfZm8gPSBmYWJyaWMuSW1hZ2UuZmlsdGVyc1tmaWx0ZXJOYW1lXS5wcm90b3R5cGUub3B0aW9ucztcbiAgICAgIHZhciBmaWx0ZXJPcHRpb25zID0ge307XG4gICAgICBmb3IodmFyIGkgaW4gX2ZvKXtcbiAgICAgICAgZmlsdGVyT3B0aW9uc1tpXSA9IF9mb1tpXS52YWx1ZTtcblxuICAgICAgfVxuICAgICAgZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChfZmlsdGVyLGZpbHRlck9wdGlvbnMpO1xuICAgICAgX2ZpbHRlci5pbWFnZURhdGEgPSBjdHguZ2V0SW1hZ2VEYXRhKDAsMCxlbGVtZW50LndpZHRoLGVsZW1lbnQuaGVpZ2h0KTtcbiAgICAgIF9maWx0ZXIuYXBwbHlUbyhlbGVtZW50KTtcbiAgICB9XG4gIH0pXG59O1xuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9tb2R1bGVzL2ZpbHRlcnMuanNcbi8vIG1vZHVsZSBpZCA9IDY2XG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsImZhYnJpYy53ZWJGb250c0xvYWRlciA9IHJlcXVpcmUoXCIuLy4uL3BsdWdpbnMvd2ViZm9udC5qc1wiKTtcblxuLy/QuNC90YLQtdGA0LXRgdC90LDRjyDQsdC40LHQu9C40L7RgtC10LrQsFxuLy8gaHR0cDovL29wZW50eXBlLmpzLm9yZy9pbmRleC5odG1sXG4vL3RvZG8gYWRkIHN0ZXBcbi8vXG4vLyBmYWJyaWMuQXBwbGljYXRpb24ucHJvdG90eXBlLnN0ZXBzLnNwbGljZSgzLDAsXCJsb2FkV2ViZm9udHNcIik7XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLkFwcGxpY2F0aW9uLnByb3RvdHlwZSwge1xuICBsb2FkV2ViZm9udHM6IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgIGlmKGZhYnJpYy5pc0xpa2VseU5vZGUpe1xuICAgICAgLy90b2RvINGI0YDQuNGE0YLRiyDQvdC1INCz0YDRg9C30Y/RgtGB0Y8g0L3QsCDRgdC10YDQstC10YDQtVxuICAgICAgcmV0dXJuIGNhbGxiYWNrKCk7XG4gICAgfVxuICAgIGlmKHRoaXMub3B0aW9ucy5mb250cyl7XG4gICAgICBpZighdGhpcy5mb250cyl0aGlzLmZvbnRzID0ge307XG4gICAgICB0aGlzLmZvbnRzID0gZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCh0aGlzLmZvbnRzLHRoaXMub3B0aW9ucy5mb250cyk7XG4gICAgfVxuICAgIGlmKCF0aGlzLmZvbnRzKXtcbiAgICAgIHJldHVybiBjYWxsYmFjaygpO1xuICAgIH1cblxuXG4gICAgdGhpcy5maXJlKFwibG9hZGluZ1wiLHt0eXBlOiBcIndlYmZvbnRzXCJ9KTtcblxuICAgIHRoaXMuX2ZvbnRzID0gW107XG5cbiAgICBmb3IodmFyIGkgaW4gdGhpcy5mb250cyl7XG4gICAgICB0aGlzLl9mb250cyA9IHRoaXMuX2ZvbnRzLmNvbmNhdCh0aGlzLmZvbnRzW2ldKTtcbiAgICB9XG4gICAgdGhpcy5fZm9udHMgPSBmYWJyaWMudXRpbC5vYmplY3Quc29ydEJ5KHRoaXMuX2ZvbnRzLCBmdW5jdGlvbihmb250KXsgcmV0dXJuIGZvbnQ7IH0pO1xuXG4gICAgaWYoZmFicmljLndlYkZvbnRzTG9hZGVyICYmICh0aGlzLmZvbnRzLmdvb2dsZSAmJiB0aGlzLmZvbnRzLmdvb2dsZS5sZW5ndGggfHwgdGhpcy5mb250cy5jdXN0b20gJiYgdGhpcy5mb250cy5jdXN0b20ubGVuZ3RoKSApe1xuICAgICAgdmFyIGZvbnRzX29wdGlvbnMgPSB7XG4gICAgICAgIGFjdGl2ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICBpZih0aGlzLmZvbnRzLmdvb2dsZSAmJiB0aGlzLmZvbnRzLmdvb2dsZS5sZW5ndGgpe1xuICAgICAgICBmb250c19vcHRpb25zLmdvb2dsZSA9ICB7XG4gICAgICAgICAgZmFtaWxpZXM6IHRoaXMuZm9udHMuZ29vZ2xlXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgICBpZih0aGlzLmZvbnRzLmN1c3RvbSAmJiB0aGlzLmZvbnRzLmN1c3RvbS5sZW5ndGgpe1xuICAgICAgICBmb250c19vcHRpb25zLmN1c3RvbSA9ICB7XG4gICAgICAgICAgZmFtaWxpZXM6IHRoaXMuZm9udHMuY3VzdG9tXG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIGZhYnJpYy53ZWJGb250c0xvYWRlci5sb2FkKGZvbnRzX29wdGlvbnMpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjYWxsYmFjaygpO1xuICAgIH1cbiAgICBpZiAodGhpcy53YWl0Rm9yV2ViZm9udHMpIHtcbiAgICAgIGZhYnJpYy51dGlsLmZvbnRzLndhaXRGb3IodGhpcy53YWl0Rm9yV2ViZm9udHMsIGNhbGxiYWNrKVxuICAgIH1cbiAgfSxcbiAgZm9udHM6IHtcbiAgICBzdGFuZGFydDogW1xuICAgICAgJ0FyaWFsJyxcbiAgICAgICdBcmlhbCBCbGFjaycsXG4gICAgICAnQ29taWMgU2FucyBNUycsXG4gICAgICAnQ291cmllciBOZXcnLFxuICAgICAgJ0dlb3JnaWEnLFxuICAgICAgJ0ltcGFjdCcsXG4gICAgICAnTHVjaWRhIENvbnNvbGUnLFxuICAgICAgJ1RhaG9tYScsXG4gICAgICAnVGltZXMgTmV3IFJvbWFuJyxcbiAgICAgICdHZW5ldmEnLFxuICAgICAgJ3NhbnMtc2VyaWYnLFxuICAgICAgJ3NlcmlmJyxcbiAgICAgICdtb25vc3BhY2UnLFxuICAgICAgJ2N1cnNpdmUnXG4gICAgXSxcbiAgICBnb29nbGU6IFtdLFxuICAgIGN1c3RvbTogW11cbiAgfVxufSk7XG5cblxuZmFicmljLnV0aWwuZm9udHMgPSB7XG4gIHdhaXRGb3I6IGZ1bmN0aW9uIChmb250cywgY2FsbGJhY2spIHtcbiAgICB2YXIgbG9hZGVkRm9udHMgPSAwO1xuICAgIGZvciAodmFyIGkgPSAwLCBsID0gZm9udHMubGVuZ3RoOyBpIDwgbDsgKytpKSB7XG4gICAgICAoZnVuY3Rpb24gKGZvbnQpIHtcbiAgICAgICAgdmFyIG5vZGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XG4gICAgICAgIC8vIENoYXJhY3RlcnMgdGhhdCB2YXJ5IHNpZ25pZmljYW50bHkgYW1vbmcgZGlmZmVyZW50IGZvbnRzXG4gICAgICAgIG5vZGUuaW5uZXJIVE1MID0gJ2dpSXRUMVdReUAhLS8jJztcbiAgICAgICAgLy8gVmlzaWJsZSAtIHNvIHdlIGNhbiBtZWFzdXJlIGl0IC0gYnV0IG5vdCBvbiB0aGUgc2NyZWVuXG4gICAgICAgIG5vZGUuc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnO1xuICAgICAgICBub2RlLnN0eWxlLmxlZnQgPSAnLTEwMDAwcHgnO1xuICAgICAgICBub2RlLnN0eWxlLnRvcCA9ICctMTAwMDBweCc7XG4gICAgICAgIC8vIExhcmdlIGZvbnQgc2l6ZSBtYWtlcyBldmVuIHN1YnRsZSBjaGFuZ2VzIG9idmlvdXNcbiAgICAgICAgbm9kZS5zdHlsZS5mb250U2l6ZSA9ICczMDBweCc7XG4gICAgICAgIC8vIFJlc2V0IGFueSBmb250IHByb3BlcnRpZXNcbiAgICAgICAgbm9kZS5zdHlsZS5mb250RmFtaWx5ID0gJ3NhbnMtc2VyaWYnO1xuICAgICAgICBub2RlLnN0eWxlLmZvbnRWYXJpYW50ID0gJ25vcm1hbCc7XG4gICAgICAgIG5vZGUuc3R5bGUuZm9udFN0eWxlID0gJ25vcm1hbCc7XG4gICAgICAgIG5vZGUuc3R5bGUuZm9udFdlaWdodCA9ICdub3JtYWwnO1xuICAgICAgICBub2RlLnN0eWxlLmxldHRlclNwYWNpbmcgPSAnMCc7XG4gICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobm9kZSk7XG5cbiAgICAgICAgLy8gUmVtZW1iZXIgd2lkdGggd2l0aCBubyBhcHBsaWVkIHdlYiBmb250XG4gICAgICAgIHZhciB3aWR0aCA9IG5vZGUub2Zmc2V0V2lkdGg7XG5cbiAgICAgICAgbm9kZS5zdHlsZS5mb250RmFtaWx5ID0gZm9udDtcblxuICAgICAgICB2YXIgaW50ZXJ2YWw7XG5cbiAgICAgICAgZnVuY3Rpb24gY2hlY2tGb250KCkge1xuICAgICAgICAgIC8vIENvbXBhcmUgY3VycmVudCB3aWR0aCB3aXRoIG9yaWdpbmFsIHdpZHRoXG4gICAgICAgICAgaWYgKG5vZGUgJiYgbm9kZS5vZmZzZXRXaWR0aCAhPSB3aWR0aCkge1xuICAgICAgICAgICAgKytsb2FkZWRGb250cztcbiAgICAgICAgICAgIG5vZGUucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChub2RlKTtcbiAgICAgICAgICAgIG5vZGUgPSBudWxsO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIElmIGFsbCBmb250cyBoYXZlIGJlZW4gbG9hZGVkXG4gICAgICAgICAgaWYgKGxvYWRlZEZvbnRzID49IGZvbnRzLmxlbmd0aCkge1xuICAgICAgICAgICAgaWYgKGludGVydmFsKSB7XG4gICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoaW50ZXJ2YWwpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGxvYWRlZEZvbnRzID09IGZvbnRzLmxlbmd0aCkge1xuICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgICB9LCA1MClcbiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFjaGVja0ZvbnQoKSkge1xuICAgICAgICAgIGludGVydmFsID0gc2V0SW50ZXJ2YWwoY2hlY2tGb250LCA1MCk7XG4gICAgICAgIH1cbiAgICAgIH0pKGZvbnRzW2ldKTtcbiAgICB9XG4gIH1cbn1cblxuZmFicmljLkFwcGxpY2F0aW9uLmFkZFBsdWdpbihcInBvc3Rsb2FkZXJzXCIsXCJsb2FkV2ViZm9udHNcIik7XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL21vZHVsZXMvZm9udHMuanNcbi8vIG1vZHVsZSBpZCA9IDY3XG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIid1c2Ugc3RyaWN0JztcblxuXG5mYWJyaWMudXRpbC5tZWRpYVJvb3QgPSBcIlwiO1xuZmFicmljLnV0aWwuYWRkTm9DYWNoZSA9IGZhbHNlO1xuXG5mYWJyaWMudXRpbC5fbG9hZEltYWdlX292ZXJ3cml0dGVuID0gZmFicmljLnV0aWwubG9hZEltYWdlO1xuXG5cbi8vIGlmKCFmYWJyaWMuaXNMaWtlbHlOb2RlKXtcbi8vXG4vLyAgIHZhciBVUkwgPSByZXF1aXJlKCd1cmwnKSxcbi8vICAgICBIVFRQID0gcmVxdWlyZSgnaHR0cCcpLFxuLy8gICAgIEhUVFBTID0gcmVxdWlyZSgnaHR0cHMnKSxcbi8vICAgICBJbWFnZSA9IHJlcXVpcmUoJ2NhbnZhcycpLkltYWdlO1xuLy9cbi8vICAgLyoqIEBwcml2YXRlICovXG4vLyAgIHZhciByZXF1ZXN0ID0gZnVuY3Rpb24gKHVybCwgZW5jb2RpbmcsIGNhbGxiYWNrKSB7XG4vLyAgICAgdmFyIG9VUkwgPSBVUkwucGFyc2UodXJsKTtcbi8vXG4vLyAgICAgLy8gZGV0ZWN0IGlmIGh0dHAgb3IgaHR0cHMgaXMgdXNlZFxuLy8gICAgIGlmICggIW9VUkwucG9ydCApIHtcbi8vICAgICAgIG9VUkwucG9ydCA9ICggb1VSTC5wcm90b2NvbC5pbmRleE9mKCdodHRwczonKSA9PT0gMCApID8gNDQzIDogODA7XG4vLyAgICAgfVxuLy9cbi8vICAgICAvLyBhc3NpZ24gcmVxdWVzdCBoYW5kbGVyIGJhc2VkIG9uIHByb3RvY29sXG4vLyAgICAgdmFyIHJlcUhhbmRsZXIgPSAob1VSTC5wcm90b2NvbC5pbmRleE9mKCdodHRwczonKSA9PT0gMCApID8gSFRUUFMgOiBIVFRQLFxuLy8gICAgICAgcmVxID0gcmVxSGFuZGxlci5yZXF1ZXN0KHtcbi8vICAgICAgICAgaG9zdG5hbWU6IG9VUkwuaG9zdG5hbWUsXG4vLyAgICAgICAgIHBvcnQ6IG9VUkwucG9ydCxcbi8vICAgICAgICAgcGF0aDogb1VSTC5wYXRoLFxuLy8gICAgICAgICBtZXRob2Q6ICdHRVQnXG4vLyAgICAgICB9LCBmdW5jdGlvbihyZXNwb25zZSkge1xuLy8gICAgICAgICB2YXIgYm9keSA9ICcnO1xuLy8gICAgICAgICBpZiAoZW5jb2RpbmcpIHtcbi8vICAgICAgICAgICByZXNwb25zZS5zZXRFbmNvZGluZyhlbmNvZGluZyk7XG4vLyAgICAgICAgIH1cbi8vICAgICAgICAgcmVzcG9uc2Uub24oJ2VuZCcsIGZ1bmN0aW9uICgpIHtcbi8vICAgICAgICAgICBjYWxsYmFjayhib2R5KTtcbi8vICAgICAgICAgfSk7XG4vLyAgICAgICAgIHJlc3BvbnNlLm9uKCdkYXRhJywgZnVuY3Rpb24gKGNodW5rKSB7XG4vLyAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1c0NvZGUgPT09IDIwMCkge1xuLy8gICAgICAgICAgICAgYm9keSArPSBjaHVuaztcbi8vICAgICAgICAgICB9XG4vLyAgICAgICAgIH0pO1xuLy8gICAgICAgfSk7XG4vL1xuLy8gICAgIHJlcS5vbignZXJyb3InLCBmdW5jdGlvbihlcnIpIHtcbi8vICAgICAgIGlmIChlcnIuZXJybm8gPT09IHByb2Nlc3MuRUNPTk5SRUZVU0VEKSB7XG4vLyAgICAgICAgIGZhYnJpYy5sb2coJ0VDT05OUkVGVVNFRDogY29ubmVjdGlvbiByZWZ1c2VkIHRvICcgKyBvVVJMLmhvc3RuYW1lICsgJzonICsgb1VSTC5wb3J0KTtcbi8vICAgICAgIH1cbi8vICAgICAgIGVsc2Uge1xuLy8gICAgICAgICBmYWJyaWMubG9nKGVyci5tZXNzYWdlKTtcbi8vICAgICAgIH1cbi8vICAgICAgIGNhbGxiYWNrKG51bGwpO1xuLy8gICAgIH0pO1xuLy9cbi8vICAgICByZXEuZW5kKCk7XG4vLyAgIH1cbi8vXG4vLyAgIC8qKiBAcHJpdmF0ZSAqL1xuLy8gICB2YXIgcmVxdWVzdEZzID0gZnVuY3Rpb24gKHBhdGgsIGNhbGxiYWNrKSB7XG4vLyAgICAgdmFyIGZzID0gcmVxdWlyZSgnZnMnKTtcbi8vICAgICBmcy5yZWFkRmlsZShwYXRoLCBmdW5jdGlvbiAoZXJyLCBkYXRhKSB7XG4vLyAgICAgICBpZiAoZXJyKSB7XG4vLyAgICAgICAgIGZhYnJpYy5sb2coZXJyKTtcbi8vICAgICAgICAgdGhyb3cgZXJyO1xuLy8gICAgICAgfVxuLy8gICAgICAgZWxzZSB7XG4vLyAgICAgICAgIGNhbGxiYWNrKGRhdGEpO1xuLy8gICAgICAgfVxuLy8gICAgIH0pO1xuLy8gICB9O1xuLy9cbi8vICAgZmFicmljLnV0aWwubG9hZEltYWdlID0gZnVuY3Rpb24odXJsLCBjYWxsYmFjaywgY29udGV4dCkge1xuLy9cbi8vXG4vLyAgICAgdmFyIGltZyA9IG5ldyBJbWFnZSgpO1xuLy8gICAgIGltZy5vbmVycm9yID0gZnVuY3Rpb24oKXtcbi8vICAgICAgIGNvbnNvbGUubG9nKFwiZXJyb3JcIik7XG4vLyAgICAgICBjYWxsYmFjayAmJiBjYWxsYmFjay5jYWxsKGNvbnRleHQsIG51bGwsIHRydWUpO1xuLy8gICAgIH07XG4vLyAgICAgaW1nLm9ubG9hZCA9IGZ1bmN0aW9uKCl7XG4vLyAgICAgICBjb25zb2xlLmxvZyhcInN1Y2Nlc3NcIik7XG4vLyAgICAgICBjYWxsYmFjayAmJiBjYWxsYmFjay5jYWxsKGNvbnRleHQsIGltZyk7XG4vLyAgICAgfTtcbi8vXG4vLyAgICAgZnVuY3Rpb24gY3JlYXRlSW1hZ2VBbmRDYWxsQmFjayhkYXRhKSB7XG4vLyAgICAgICBpZiAoZGF0YSkge1xuLy8gICAgICAgICBpbWcuc3JjID0gZGF0YTtcbi8vICAgICAgICAgLy8gcHJlc2VydmluZyBvcmlnaW5hbCB1cmwsIHdoaWNoIHNlZW1zIHRvIGJlIGxvc3QgaW4gbm9kZS1jYW52YXNcbi8vICAgICAgICAgaW1nLl9zcmMgPSB1cmw7XG4vLyAgICAgICB9XG4vLyAgICAgICBlbHNlIHtcbi8vICAgICAgICAgaW1nID0gbnVsbDtcbi8vICAgICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2suY2FsbChjb250ZXh0LCBudWxsLCB0cnVlKTtcbi8vICAgICAgIH1cbi8vICAgICB9XG4vL1xuLy8gICAgIGlmICh1cmwgJiYgKHVybCBpbnN0YW5jZW9mIEJ1ZmZlciB8fCB1cmwuaW5kZXhPZignZGF0YScpID09PSAwKSkge1xuLy8gICAgICAgaW1nLnNyYyA9IGltZy5fc3JjID0gdXJsO1xuLy8gICAgIH1cbi8vICAgICBlbHNlIGlmICh1cmwgJiYgdXJsLmluZGV4T2YoJ2h0dHAnKSAhPT0gMCkge1xuLy8gICAgICAgdmFyIHBhdGggPSByZXF1aXJlKFwicGF0aFwiKTtcbi8vICAgICAgIHVybCA9IGZhYnJpYy51dGlsLmdldFVSTCh1cmwpO1xuLy8gICAgICAgdXJsID0gICBwYXRoLnJlc29sdmUoZmFicmljLnV0aWwubWVkaWFSb290LCB1cmwpO1xuLy8gICAgICAgaW1nLnNyYyA9ICB1cmw7XG4vLyAgICAgICAvLyByZXF1ZXN0RnModXJsLCBjcmVhdGVJbWFnZUFuZENhbGxCYWNrKTtcbi8vICAgICB9XG4vLyAgICAgZWxzZSBpZiAodXJsKSB7XG4vLyAgICAgICByZXF1ZXN0KHVybCwgJ2JpbmFyeScsIGNyZWF0ZUltYWdlQW5kQ2FsbEJhY2spO1xuLy8gICAgIH1cbi8vICAgICBlbHNlIHtcbi8vICAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrLmNhbGwoY29udGV4dCwgdXJsKTtcbi8vICAgICB9XG4vLyAgIH07XG4vLyB9ZWxzZXtcbiAgZmFicmljLnV0aWwubG9hZFJlc291cmNlcyA9IGZ1bmN0aW9uIChyZXNvdXJjZXMsIGNhbGxiYWNrLCBjb250ZXh0LCBjcm9zc09yaWdpbikge1xuXG4gICAgdmFyIGxvYWRlZFJlc291cmNlcyA9IHt9O1xuICAgIHZhciBsb2FkZXIgPSBmYWJyaWMudXRpbC5xdWV1ZUxvYWQoT2JqZWN0LmtleXMocmVzb3VyY2VzKS5sZW5ndGgsZnVuY3Rpb24oKXtcbiAgICAgIGNhbGxiYWNrKGxvYWRlZFJlc291cmNlcyk7XG4gICAgfSk7XG4gICAgZm9yKHZhciBpIGluIHJlc291cmNlcyl7XG4gICAgICAoZnVuY3Rpb24oaSl7XG4gICAgICAgIGZhYnJpYy51dGlsLmxvYWRJbWFnZShyZXNvdXJjZXNbaV0sIGZ1bmN0aW9uKGltYWdlKXtcbiAgICAgICAgICBsb2FkZWRSZXNvdXJjZXNbaV0gPSBpbWFnZTtcbiAgICAgICAgICBsb2FkZXIoKTtcbiAgICAgICAgfSwgY29udGV4dCwgY3Jvc3NPcmlnaW4pO1xuICAgICAgfShpKSk7XG4gICAgfVxuICB9O1xuXG4gIGZhYnJpYy51dGlsLmxvYWRJbWFnZSA9IGZ1bmN0aW9uICh1cmwsIGNhbGxiYWNrLCBjb250ZXh0LCBjcm9zc09yaWdpbikge1xuICAgIHVybCA9IGZhYnJpYy51dGlsLmdldFVSTCh1cmwpO1xuICAgIGZ1bmN0aW9uIF9jaGVja19lcnJvcnMoaW1nKXtcbiAgICAgIC8v0LjQt9C+0LHRgNCw0LbQtdC90LjQtSDQvdC1INCx0YvQu9C+INC30LDQs9GA0YPQttC10L3QvlxuICAgICAgaWYgKGltZykge1xuICAgICAgICBjYWxsYmFjay5jYWxsKHRoaXMsaW1nKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGZhYnJpYy5lcnJvcnMucHVzaCh7dHlwZTogXCJpbWFnZVwiLCBtZXNzYWdlOiBcIkltYWdlIHdhcyBub3QgbG9hZGVkXCJ9KTtcbiAgICAgICAgZmFicmljLnV0aWwuX2xvYWRJbWFnZV9vdmVyd3JpdHRlbihmYWJyaWMubWVkaWEuZXJyb3IsIGNhbGxiYWNrLCBjb250ZXh0LCBjcm9zc09yaWdpbiB8fCAnQW5vbnltb3VzJyk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYoZmFicmljLmRlYnVnVGltZW91dCl7XG4gICAgICBzZXRUaW1lb3V0KGZhYnJpYy51dGlsLl9sb2FkSW1hZ2Vfb3ZlcndyaXR0ZW4uYmluZCh0aGlzLHVybCwgX2NoZWNrX2Vycm9ycyAsIGNvbnRleHQsIGNyb3NzT3JpZ2luIHx8ICdBbm9ueW1vdXMnKSxmYWJyaWMuZGVidWdUaW1lb3V0KVxuICAgIH1lbHNle1xuICAgICAgZmFicmljLnV0aWwuX2xvYWRJbWFnZV9vdmVyd3JpdHRlbih1cmwsIF9jaGVja19lcnJvcnMgLCBjb250ZXh0LCBjcm9zc09yaWdpbiB8fCAnQW5vbnltb3VzJyk7XG4gICAgfVxuICB9O1xuXG5cbmZhYnJpYy51dGlsLmdldFVSTCA9IGZ1bmN0aW9uKHVybCl7XG4gIGlmICh1cmwuaW5kZXhPZignYmxvYicpICE9PSAwICYmIHVybC5pbmRleE9mKCdkYXRhJykgIT09IDAgJiYgdXJsLmluZGV4T2YoJzovLycpID09IC0xKSB7XG4gICAgdXJsID0gZmFicmljLnV0aWwubWVkaWFSb290ICsgdXJsO1xuICB9XG4gIGlmIChmYWJyaWMudXRpbC5hZGROb0NhY2hlICYmIC9eKGh0dHB8aHR0cHMpXFw6XFwvXFwvLy50ZXN0KHVybCkpIHtcbiAgICB1cmwgKz0gJz9uby1jYWNoZT0nICsgbmV3IERhdGUoKS5nZXRUaW1lKClcbiAgfVxuICByZXR1cm4gdXJsO1xufTtcblxuXG5mYWJyaWMudXRpbC5sb2FkVmlkZW8gPSBmdW5jdGlvbiAoc291cmNlcywgY2FsbGJhY2ssIGNvbnRleHQsIGNyb3NzT3JpZ2luKSB7XG5cbiAgZnVuY3Rpb24gbG9hZEl0KHVybCl7XG4gICAgdmlkZW8uc3JjID0gZmFicmljLnV0aWwuZ2V0VVJMKHVybCk7XG4gICAgdmlkZW8uYWRkRXZlbnRMaXN0ZW5lcihcImxvYWRlZGRhdGFcIiwgZnVuY3Rpb24oKXtcbiAgICAgIGNhbGxiYWNrKHZpZGVvKTtcbiAgICB9LCB0cnVlKTtcbiAgICB2aWRlby5sb2FkKCk7XG4gIH1cblxuXG5cblxuICB2YXIgdmlkZW8gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd2aWRlbycpO1xuXG5cbiAgLy90cnlpbmcgdG8gZmluZCB0aGUgbW9zdCBzdWl0YWJsZSBzb3VyY2UgZm9yIGN1cnJlbnQgYnJvd3NlclxuICBmb3IgKHZhciB0eXBlIGluIHNvdXJjZXMpIHtcbiAgICBpZih2aWRlby5jYW5QbGF5VHlwZSh0eXBlKSA9PSBcInllc1wiKXtcbiAgICAgIHRoaXMubWVkaWFUeXBlID0gdHlwZTtcbiAgICAgIGxvYWRJdChzb3VyY2VzW3R5cGVdKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gIH1cbiAgZm9yICh2YXIgdHlwZSBpbiBzb3VyY2VzKSB7XG4gICAgaWYodmlkZW8uY2FuUGxheVR5cGUodHlwZSkgPT0gXCJtYXliZVwiKXtcbiAgICAgIHRoaXMubWVkaWFUeXBlID0gdHlwZTtcbiAgICAgIGxvYWRJdChzb3VyY2VzW3R5cGVdKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gIH1cbiAgY29uc29sZS53YXJuKFwidmlkZW8gc291cmNlcyBmb3JtYXRzIGlzIG5vdCBzdXBwb3J0ZWRcIilcblxuXG59O1xuXG5mYWJyaWMudXRpbC5fbG9hZFNWR0Zyb21VUkxfb3ZlcndyaXR0ZW4gPSBmYWJyaWMubG9hZFNWR0Zyb21VUkw7XG5mYWJyaWMubG9hZFNWR0Zyb21VUkwgPSBmdW5jdGlvbiAodXJsLCBjYWxsYmFjaywgcmV2aXZlcikge1xuICBpZiAodXJsLmluZGV4T2YoJ2RhdGEnKSAhPT0gMCAmJiB1cmwuaW5kZXhPZignOi8vJykgPT0gLTEpIHtcbiAgICB1cmwgPSBmYWJyaWMudXRpbC5tZWRpYVJvb3QgKyB1cmw7XG4gIH1cbiAgaWYgKGZhYnJpYy51dGlsLmFkZE5vQ2FjaGUgJiYgL14oaHR0cHxodHRwcylcXDpcXC9cXC8vLnRlc3QodXJsKSkge1xuICAgIHVybCArPSAnP25vLWNhY2hlPScgKyBtb21lbnQoKS5mb3JtYXQoJ3gnKTtcbiAgfVxuICBmYWJyaWMudXRpbC5fbG9hZFNWR0Zyb21VUkxfb3ZlcndyaXR0ZW4odXJsLCBmdW5jdGlvbihkYXRhKXtcbiAgICAgaWYoZGF0YSl7XG4gICAgICAgcmV0dXJuIGNhbGxiYWNrKGRhdGEpO1xuICAgICB9XG5cbiAgICB2YXIgeG1sID0galF1ZXJ5LnBhcnNlWE1MKGF0b2IoZmFicmljLm1lZGlhLmVycm9yLnN1YnN0cigyNikpKTtcblxuICAgIGZhYnJpYy5wYXJzZVNWR0RvY3VtZW50KHhtbC5kb2N1bWVudEVsZW1lbnQsIGZ1bmN0aW9uIChyZXN1bHRzLCBvcHRpb25zKSB7XG4gICAgICBjYWxsYmFjayAmJiBjYWxsYmFjayhyZXN1bHRzLCBvcHRpb25zKTtcbiAgICB9LCByZXZpdmVyKTtcblxuICB9LCByZXZpdmVyKTtcbn07XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL21vZHVsZXMvZnJvbVVSTC5qc1xuLy8gbW9kdWxlIGlkID0gNjhcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiJ3VzZSBzdHJpY3QnO1xuXG4vKipcbiAqIEFsaWdtZW50IGxpYnJhcnkgZm9yIEZhYnJpY0pTXG4gKlxuICpcbiAqXG4gKiBAYXV0aG9yIERlbmlzIFBvbm9tYXJldlxuICogQGVtYWlsIGRlbi5wb25vbWFyZXZAZ21haWwuY29tXG4gKi9cbmZhYnJpYy5HcmlkU25hcHBlciA9IGZ1bmN0aW9uIChjYW52YXMsb3B0aW9ucyl7XG4gIHRoaXMuY2FudmFzID0gY2FudmFzO1xuXG4gIGZvcih2YXIgcHJvcCBpbiBvcHRpb25zKXtcbiAgICB0aGlzW3Byb3BdID0gb3B0aW9uc1twcm9wXTtcbiAgfVxuXG4gIHRoaXMuY3JlYXRlQWxpZ21lbnRMaW5lcyhjYW52YXMpO1xuXG4gIGZvcih2YXIgaSBpbiB0aGlzLmNhbnZhcy5fb2JqZWN0cyl7XG4gICAgdGhpcy5hcHBseVNuYXAodGhpcy5jYW52YXMuX29iamVjdHNbaV0pO1xuICB9XG5cbiAgdmFyIF9ncyA9IHRoaXM7XG5cbiAgKHRoaXMuY2FudmFzLndyYXBwZXJFbCB8fCB0aGlzLmNhbnZhcy5sb3dlckNhbnZhc0VsKS5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsZnVuY3Rpb24oKXtcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNldXBcIixfZ3MuX3dpbmRvd19tb3VzZV91cC5iaW5kKF9ncykpO1xuICB9KTtcbn07XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLk9iamVjdC5wcm90b3R5cGUsIHtcbiAgZ3JpZGRhYmxlOiB0cnVlXG59KTtcblxuZmFicmljLkNhbnZhcy5wcm90b3R5cGUuYXBwbHlHcmlkID0gZnVuY3Rpb24oKXtcbiAgdmFyIGNhbnZhcyA9IHRoaXM7XG4gIHRoaXMuZ3JpZCA9IG5ldyBmYWJyaWMuR3JpZFNuYXBwZXIodGhpcyk7XG4gIHRoaXMub24oXCJvYmplY3Q6bW92aW5nXCIsZnVuY3Rpb24ob3B0aW9ucyl7XG4gICAgaWYoIW9wdGlvbnMuZS5zaGlmdEtleSAmJiBjYW52YXMuZ3JpZC5lbmFibGVkICYmIG9wdGlvbnMudGFyZ2V0LmdyaWRkYWJsZSl7XG4gICAgICBjYW52YXMuZ3JpZC5ncmlkU25hcE1vdmUob3B0aW9ucy50YXJnZXQpO1xuICAgIH1cbiAgfSk7XG4gIHRoaXMub24oJ21vdXNlOnVwJyxmdW5jdGlvbigpe1xuICAgIGNhbnZhcy5jbGVhckNvbnRleHQoY2FudmFzLmNvbnRleHRUb3ApXG4gICAgY2FudmFzLmdyaWQuc25hcFRvID0gbnVsbDtcbiAgfSk7XG4gIHRoaXMub24oJ2FmdGVyOnJlbmRlcicsZnVuY3Rpb24oKXtcbiAgICB2YXIgY3R4ID0gY2FudmFzLmNvbnRleHRUb3AsXG4gICAgICBzbmFwVG8gPSBjYW52YXMuZ3JpZC5zbmFwVG87XG4gICAgY3R4LnN0cm9rZVN0eWxlID0gXCIjZmZhYWFhXCI7XG5cblxuICAgIGlmKCFzbmFwVG8pcmV0dXJuO1xuICAgIGlmKHNuYXBUby54KSB7XG4gICAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgICBpZihzbmFwVG8ueC5vYmplY3QyKXtcbiAgICAgICAgdmFyIF9pYyAsIF9jIDtcbiAgICAgICAgX2MgPSBzbmFwVG8ueC5vYmplY3QyLm9Db29yZHM7XG4gICAgICAgIGlmKHNuYXBUby54LmxpbmUpe1xuICAgICAgICAgIGN0eC5tb3ZlVG8oX2MubXQueCwgMClcbiAgICAgICAgICBjdHgubGluZVRvKF9jLm10LngsIHRoaXMuaGVpZ2h0KVxuICAgICAgICB9ZWxzZXtcblxuICAgICAgICAgIGN0eC5tb3ZlVG8oX2MudGwueCwgX2MudGwueSk7XG4gICAgICAgICAgY3R4LmxpbmVUbyhfYy50ci54LCBfYy50ci55KTtcbiAgICAgICAgICBjdHgubGluZVRvKF9jLmJyLngsIF9jLmJyLnkpO1xuICAgICAgICAgIGN0eC5saW5lVG8oX2MuYmwueCwgX2MuYmwueSk7XG4gICAgICAgICAgY3R4LmxpbmVUbyhfYy50bC54LCBfYy50bC55KTtcblxuICAgICAgICAgIGlmKHNuYXBUby54LmNvcm5lcjIgPT0gXCJjXCIpe1xuICAgICAgICAgICAgX2ljID0gc25hcFRvLngub2JqZWN0Mi5nZXRDZW50ZXJQb2ludCgpO1xuICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgX2ljID0gX2Nbc25hcFRvLnguY29ybmVyMl07XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmKF9pYyl7XG4gICAgICAgICAgICBjdHgubW92ZVRvKF9pYy54LCBfaWMueSlcbiAgICAgICAgICAgIGN0eC5hcmMoX2ljLngsIF9pYy55LCAyLCAwLCAyICogTWF0aC5QSSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgIH1cblxuXG4gICAgICAgIHZhciBfYWN0aXZlID0gdGhpcy5fYWN0aXZlT2JqZWN0IHx8IHRoaXMuX2FjdGl2ZUdyb3VwO1xuICAgICAgICBfYyA9IF9hY3RpdmUub0Nvb3JkcztcbiAgICAgICAgaWYoc25hcFRvLnguY29ybmVyID09IFwiY1wiKXtcbiAgICAgICAgICBfaWMgPSBzbmFwVG8ueC5vYmplY3QyLmdldENlbnRlclBvaW50KCk7XG4gICAgICAgIH1lbHNle1xuICAgICAgICAgIF9pYyA9IF9jW3NuYXBUby54LmNvcm5lcl07XG4gICAgICAgIH1cbiAgICAgICAgY3R4Lm1vdmVUbyhfaWMueCwgX2ljLnkpXG4gICAgICAgIGN0eC5hcmMoX2ljLngsIF9pYy55LCAyLCAwLCAyICogTWF0aC5QSSk7XG4gICAgICB9XG4gICAgICBjdHgubW92ZVRvKHNuYXBUby54LnZhbHVlLDApO1xuICAgICAgY3R4LmxpbmVUbyhzbmFwVG8ueC52YWx1ZSxjYW52YXMuaGVpZ2h0KTtcbiAgICAgIGN0eC5zdHJva2UoKTtcbiAgICB9XG4gICAgaWYoc25hcFRvLnkpIHtcbiAgICAgIGN0eC5iZWdpblBhdGgoKTtcblxuICAgICAgaWYoc25hcFRvLnkub2JqZWN0Mil7XG4gICAgICAgIHZhciBfaWMgLCBfYyA7XG4gICAgICAgIF9jID0gc25hcFRvLnkub2JqZWN0Mi5vQ29vcmRzO1xuICAgICAgICBpZihzbmFwVG8ueS5saW5lKXtcbiAgICAgICAgICBjdHgubW92ZVRvKDAsX2MubWwueSlcbiAgICAgICAgICBjdHgubGluZVRvKHRoaXMud2lkdGgsX2MubWwueSlcbiAgICAgICAgfWVsc2Uge1xuICAgICAgICAgIGN0eC5tb3ZlVG8oX2MudGwueCwgX2MudGwueSk7XG4gICAgICAgICAgY3R4LmxpbmVUbyhfYy50ci54LCBfYy50ci55KTtcbiAgICAgICAgICBjdHgubGluZVRvKF9jLmJyLngsIF9jLmJyLnkpO1xuICAgICAgICAgIGN0eC5saW5lVG8oX2MuYmwueCwgX2MuYmwueSk7XG4gICAgICAgICAgY3R4LmxpbmVUbyhfYy50bC54LCBfYy50bC55KTtcbiAgICAgICAgICBpZiAoc25hcFRvLnkuY29ybmVyMiA9PSBcImNcIikge1xuICAgICAgICAgICAgX2ljID0gc25hcFRvLnkub2JqZWN0Mi5nZXRDZW50ZXJQb2ludCgpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBfaWMgPSBfY1tzbmFwVG8ueS5jb3JuZXIyXTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYoX2ljKSB7XG4gICAgICAgICAgICBjdHgubW92ZVRvKF9pYy54LCBfaWMueSlcbiAgICAgICAgICAgIGN0eC5hcmMoX2ljLngsIF9pYy55LCAyLCAwLCAyICogTWF0aC5QSSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdmFyIF9hY3RpdmUgPSB0aGlzLl9hY3RpdmVPYmplY3QgfHwgdGhpcy5fYWN0aXZlR3JvdXA7XG4gICAgICAgICAgX2MgPSBfYWN0aXZlLm9Db29yZHM7XG4gICAgICAgICAgaWYgKHNuYXBUby55LmNvcm5lciA9PSBcImNcIikge1xuICAgICAgICAgICAgX2ljID0gc25hcFRvLnkub2JqZWN0Mi5nZXRDZW50ZXJQb2ludCgpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBfaWMgPSBfY1tzbmFwVG8ueS5jb3JuZXJdO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjdHgubW92ZVRvKF9pYy54LCBfaWMueSlcbiAgICAgICAgICBjdHguYXJjKF9pYy54LCBfaWMueSwgMiwgMCwgMiAqIE1hdGguUEkpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGN0eC5tb3ZlVG8oMCxzbmFwVG8ueS52YWx1ZSk7XG4gICAgICBjdHgubGluZVRvKGNhbnZhcy53aWR0aCxzbmFwVG8ueS52YWx1ZSk7XG4gICAgICBjdHguc3Ryb2tlKCk7XG4gICAgfVxuICB9KVxuXG59O1xuXG5mYWJyaWMuR3JpZFNuYXBwZXIucHJvdG90eXBlID0ge1xuICAvL29mZnNldHMgYW5kIHNpemUgb2YgdGhlIGdyaWRcbiAgcmVjdDoge1xuICAgIHRvcDogNTAsXG4gICAgbGVmdDogNTAsXG4gICAgd2lkdGg6IDYwMCxcbiAgICBoZWlnaHQ6IDYwMFxuICB9LFxuICAvKipcbiAgICogc3VwcG9ydCBsaW5lc1xuICAgKiBAdmFsdWUgW3tcbiAgICAgKiAgW3g6IGludGVnZXJdLFxuICAgICAqICBbeTogaW50ZWdlcl1cbiAgICAgKiB9XVxuICAgKi9cbiAgc3VwcG9ydExpbmVzOiBbXSxcbiAgLyoqXG4gICAqIGZhYnJjIG9iamVjdHMuXG4gICAqIEB2YWx1ZSBba2xhc3NdXG4gICAqL1xuICBvYmplY3RzIDogW10sXG4gIC8vdGhlIGFyZWEgaW4gcGl4ZWxzLCB3aGVyZSBvYmplY3Qgd2lsbCBiZSBzbmFwcGVkIHRvIHRoZSBncmlkXG4gIGFyZWE6IDMsXG4gIC8vZmxhZ1xuICBlbmFibGVkOiB0cnVlLFxuICAvL1xuICBncmlkRW5hYmxlZDogdHJ1ZSxcbiAgYm9yZGVyRW5hYmxlZDogdHJ1ZSxcbiAgZ3JpZEJvcmRlciA6IGZhbHNlLFxuICAvL3NpemUgb2YgdGhlIGdyaWRcbiAgZ3JpZFNpemU6IDI1LFxuICAvKipcbiAgICogY29ybmVycyB0aGF0IHdpbGwgYmUgc25hcHBlZCB0byB0aGUgZ3JpZC4gVGhpcyBpcyB0aGUgbmFtZSBmcm9tIGZhYnJpYyBvYmplY3Qgb0Nvb3JkcyBwcm9wZXJ0eS4gKCBpdCBpcyBwb3NzaWJsZSB0byBtb3JlIG9yIGxlc3MgcG9pbnRzIClcbiAgICovXG4gIHNuYXBDb3JuZXJzOiB7XG4gICAgdGw6IFtcInRsXCIsXCJibFwiLFwiYnJcIixcInRyXCJdLFxuICAgIGJsOiBbXCJ0bFwiLFwiYmxcIixcImJyXCIsXCJ0clwiXSxcbiAgICB0cjogW1widGxcIixcImJsXCIsXCJiclwiLFwidHJcIl0sXG4gICAgYnI6IFtcInRsXCIsXCJibFwiLFwiYnJcIixcInRyXCJdLFxuICAgIGMgOiBbXCJjXCJdXG4gIH0sXG4gIF93aW5kb3dfbW91c2VfdXAgIDogZnVuY3Rpb24oKXtcbiAgICB0aGlzLmhpZGVBbGlnbWVudExpbmVzKCk7XG4gICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCB0aGlzLl93aW5kb3dfbW91c2VfdXApO1xuICB9LFxuICBhcHBseVNuYXAgOiBmdW5jdGlvbihvYmope1xuICAgIHZhciBfZ3MgPSB0aGlzO1xuXG4gICAgdGhpcy5jYW52YXMub24oXCJvYmplY3Q6cmVtb3ZlZFwiLGZ1bmN0aW9uKGUpe1xuICAgICAgdmFyIGkgPSBfZ3MuY2FudmFzLl9vYmplY3RzLmluZGV4T2YoZS50YXJnZXQpO1xuICAgICAgaWYoaSA9PSAtMSlyZXR1cm47XG4gICAgICBfZ3MuY2FudmFzLl9vYmplY3RzLnNwbGljZShpLDEpO1xuICAgIH0pO1xuXG4gICAgb2JqLm9uKFwibW92aW5nXCIsZnVuY3Rpb24oKXtcbiAgICAgIGlmKF9ncy5lbmFibGVkKXtcbiAgICAgICAgX2dzLmdyaWRTbmFwTW92ZSh0aGlzKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSxcblxuICBjcmV0ZVN1cHBvcnRMaW5lcyA6IGZ1bmN0aW9uKCl7XG4gICAgdmFyIHJlY3QgPSB0aGlzLnJlY3Q7XG5cbiAgICB2YXIgb2JqcyA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5zdXBwb3J0TGluZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciBsID0gdGhpcy5zdXBwb3J0TGluZXNbaV07XG4gICAgICBvYmpzLnB1c2gobmV3IGZhYnJpYy5MaW5lKFxuICAgICAgICAobC54ID8gW2wueCwgMCwgbC54LCByZWN0LmhlaWdodF0gOiBbMCwgbC55LCByZWN0LndpZHRoLCBsLnldKSxcbiAgICAgICAgeyBzdHJva2U6ICdyZWQnIH0pKTtcbiAgICB9XG5cbiAgICB2YXIgc3VwcG9ydCA9IG5ldyBmYWJyaWMuR3JvdXAob2Jqcyx7XG4gICAgICBsZWZ0OiByZWN0LmxlZnQsXG4gICAgICB0b3A6IHJlY3QudG9wLFxuICAgICAgc2VsZWN0YWJsZTogZmFsc2UsXG4gICAgICBldmVudGVkOiBmYWxzZVxuICAgIH0pO1xuICAgIHRoaXMuY2FudmFzLmFkZChzdXBwb3J0KTtcbiAgICByZXR1cm4gc3VwcG9ydDtcbiAgfSxcbiAgcmVtb3ZlR3JpZEZyYW1lOiBmdW5jdGlvbigpe1xuICAgIHRoaXMuY2FudmFzLnJlbW92ZSh0aGlzLmdyaWRGcmFtZSk7XG4gICAgZGVsZXRlIHRoaXMuZ3JpZEZyYW1lO1xuICB9LFxuICByZW1vdmVHcmlkOiBmdW5jdGlvbigpe1xuXG4gICAgdGhpcy5jYW52YXMucmVtb3ZlKHRoaXMuZ3JpZCk7XG4gICAgZGVsZXRlIHRoaXMuZ3JpZDtcblxuICB9LFxuICB1cGRhdGVHcmlkU2l6ZTogZnVuY3Rpb24oKXtcblxuICAgIHRoaXMucmVtb3ZlR3JpZEZyYW1lKCk7XG4gICAgdGhpcy5jcmVhdGVHcmlkRnJhbWUoKTtcblxuICAgIGlmKHRoaXMuZ3JpZCl7XG4gICAgICB0aGlzLnJlbW92ZUdyaWQoKTtcbiAgICAgIHRoaXMuY3JlYXRlR3JpZCgpO1xuICAgIH1cblxuICAgIC8vdGhpcy54TGluZS55MiA9IHRoaXMuY2FudmFzLmhlaWdodDtcbiAgICAvL3RoaXMueUxpbmUueDIgPSB0aGlzLmNhbnZhcy53aWR0aDtcbiAgfSxcbiAgY3JlYXRlR3JpZEZyYW1lOiBmdW5jdGlvbigpe1xuICAgIC8qICAgdGhpcy5ncmlkRnJhbWUgPSBuZXcgZmFicmljLlJlY3Qoe1xuICAgICBsZWZ0OiB0aGlzLnJlY3QubGVmdCxcbiAgICAgdG9wOiB0aGlzLnJlY3QudG9wLFxuICAgICB3aWR0aDogdGhpcy5yZWN0LndpZHRoLFxuICAgICBoZWlnaHQ6IHRoaXMucmVjdC5oZWlnaHQsXG4gICAgIHN0cm9rZTogJyM1RjhFNzAnLFxuICAgICBmaWxsOiBcInRyYW5zcGFyZW50XCIsXG4gICAgIHNlbGVjdGFibGU6IGZhbHNlLFxuICAgICBldmVudGVkOiBmYWxzZVxuICAgICB9KTsqL1xuXG4gICAgdmFyIHJlY3QgPSB0aGlzLnJlY3Q7XG4gICAgdmFyIG9ianMgPSBbXTtcblxuICAgIG9ianMucHVzaChuZXcgZmFicmljLkxpbmUoWzAsIHRoaXMucmVjdC50b3AsIHRoaXMuY2FudmFzLndpZHRoLCB0aGlzLnJlY3QudG9wXSwge1xuICAgICAgc3Ryb2tlOiAnIzVGOEU3MCdcbiAgICB9KSk7XG4gICAgb2Jqcy5wdXNoKG5ldyBmYWJyaWMuTGluZShbMCwgdGhpcy5yZWN0LnRvcCArIHRoaXMucmVjdC5oZWlnaHQsIHRoaXMuY2FudmFzLndpZHRoLCB0aGlzLnJlY3QudG9wICsgdGhpcy5yZWN0LmhlaWdodF0sIHtcbiAgICAgIHN0cm9rZTogJyM1RjhFNzAnXG4gICAgfSkpO1xuICAgIG9ianMucHVzaChuZXcgZmFicmljLkxpbmUoW3RoaXMucmVjdC5sZWZ0LCAwLCB0aGlzLnJlY3QubGVmdCwgdGhpcy5jYW52YXMuaGVpZ2h0XSwge1xuICAgICAgc3Ryb2tlOiAnIzVGOEU3MCdcbiAgICB9KSk7XG4gICAgb2Jqcy5wdXNoKG5ldyBmYWJyaWMuTGluZShbdGhpcy5yZWN0LmxlZnQgKyB0aGlzLnJlY3Qud2lkdGgsIDAsIHRoaXMucmVjdC5sZWZ0KyB0aGlzLnJlY3Qud2lkdGgsIHRoaXMuY2FudmFzLmhlaWdodF0sIHtcbiAgICAgIHN0cm9rZTogJyM1RjhFNzAnXG4gICAgfSkpO1xuXG4gICAgdGhpcy5ncmlkRnJhbWUgPSBuZXcgZmFicmljLkdyb3VwKG9ianMse1xuICAgICAgc2VsZWN0YWJsZTogZmFsc2UsXG4gICAgICBldmVudGVkOiBmYWxzZVxuICAgIH0pO1xuICAgIHRoaXMuY2FudmFzLmFkZCh0aGlzLmdyaWRGcmFtZSk7XG4gICAgcmV0dXJuIHRoaXMuZ3JpZEZyYW1lO1xuXG4gIH0sXG4gIC8qKlxuICAgKiBjcmVhdGUgYSBzZXQgb2YgbGluZXMgb24gdGhlIGNhbnZhc1xuICAgKiBAcmV0dXJucyB7Kn1cbiAgICovXG4gIGNyZWF0ZUdyaWQ6IGZ1bmN0aW9uKCl7XG4gICAgdmFyIHJlY3QgPSB0aGlzLnJlY3Q7XG4gICAgdmFyIG9ianMgPSBbXTtcblxuXG5cbiAgICBmb3IgKHZhciB5ID0gdGhpcy5ncmlkU2l6ZTsgeSAgPD0gcmVjdC5oZWlnaHQgLSAxOyB5ICs9IHRoaXMuZ3JpZFNpemUpIHtcbiAgICAgIG9ianMucHVzaChuZXcgZmFicmljLkxpbmUoWzAsIHksIHJlY3Qud2lkdGgsIHldLCB7XG4gICAgICAgIHN0cm9rZTogJyM1RjhFNzAnXG4gICAgICB9KSk7XG4gICAgfVxuXG4gICAgZm9yICh2YXIgeCA9IHRoaXMuZ3JpZFNpemU7IHggPD0gcmVjdC53aWR0aCAtIDE7IHggKz0gdGhpcy5ncmlkU2l6ZSkge1xuICAgICAgb2Jqcy5wdXNoKG5ldyBmYWJyaWMuTGluZShbeCwgMCwgeCwgcmVjdC5oZWlnaHRdLCB7XG4gICAgICAgIHN0cm9rZTogJyM1RjhFNzAnXG4gICAgICB9KSk7XG4gICAgfVxuXG4gICAgdGhpcy5ncmlkID0gbmV3IGZhYnJpYy5Hcm91cChvYmpzLHtcbiAgICAgIGxlZnQ6IHJlY3QubGVmdCxcbiAgICAgIHRvcDogcmVjdC50b3AsXG4gICAgICBzZWxlY3RhYmxlOiBmYWxzZSxcbiAgICAgIGV2ZW50ZWQ6IGZhbHNlXG4gICAgfSk7XG5cblxuICAgIHRoaXMuY2FudmFzLmFkZCh0aGlzLmdyaWQpO1xuICAgIHJldHVybiB0aGlzLmdyaWQ7XG5cbiAgfSxcbiAgc25hcENhbGxiYWNrIDpmdW5jdGlvbihzbmFwVG8pe1xuICAgIHRoaXMuc25hcFRvID0gc25hcFRvO1xuICB9LFxuICBoaWRlQWxpZ21lbnRMaW5lczogIGZ1bmN0aW9uKGNhbnZhcykge1xuXG4gICAgaWYodGhpcy54TGluZSl7XG4gICAgICB0aGlzLnhMaW5lLnNldFZpc2libGUoZmFsc2UpO1xuICAgICAgdGhpcy54TGluZS5jYW52YXMucmVuZGVyQWxsKCk7XG4gICAgfVxuICAgIGlmKHRoaXMueUxpbmUpIHtcbiAgICAgIHRoaXMueUxpbmUuc2V0VmlzaWJsZShmYWxzZSk7XG4gICAgICB0aGlzLnhMaW5lLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICB9XG4gIH0sXG4gIGNyZWF0ZUFsaWdtZW50TGluZXM6ICBmdW5jdGlvbigpIHtcbiAgICAvL3RoaXMueExpbmUgPSBuZXcgZmFicmljLkxpbmUoWzEsIDAsIDEsIHRoaXMuY2FudmFzLmhlaWdodF0sIHtcbiAgICAvLyAgICBsZWZ0OjAsXG4gICAgLy8gICAgc3Ryb2tlOiAnIzQwRDBGRicsXG4gICAgLy8gICAgc2VsZWN0YWJsZTogZmFsc2UsXG4gICAgLy8gICAgZXZlbnRlZDogZmFsc2UsXG4gICAgLy8gICAgdmlzaWJsZTogZmFsc2VcbiAgICAvL30pO1xuICAgIC8vdGhpcy55TGluZSA9IG5ldyBmYWJyaWMuTGluZShbMCwgMSwgdGhpcy5jYW52YXMud2lkdGgsIDFdLCB7XG4gICAgLy8gICAgdG9wOjAsXG4gICAgLy8gICAgc3Ryb2tlOiAnIzQwRDBGRicsXG4gICAgLy8gICAgc2VsZWN0YWJsZTogZmFsc2UsXG4gICAgLy8gICAgZXZlbnRlZDogZmFsc2UsXG4gICAgLy8gICAgdmlzaWJsZTogZmFsc2VcbiAgICAvL30pO1xuICAgIC8vXG4gICAgLy90aGlzLmNhbnZhcy5hZGQodGhpcy54TGluZSk7XG4gICAgLy90aGlzLmNhbnZhcy5hZGQodGhpcy55TGluZSk7XG5cbiAgfSxcbiAgLyoqXG4gICAqXG4gICAqIEBwYXJhbSBvYmplY3RcbiAgICogQHJldHVybnMge3t4OiAoZmFsc2V8e3ZhbHVlLCBjb3JuZXJ9fHt2YWx1ZSwgY29ybmVyLCBvYmplY3QyLCBjb3JuZXIyfSksIHk6IChmYWxzZXx7dmFsdWUsIGNvcm5lcn18e3ZhbHVlLCBjb3JuZXIsIG9iamVjdDIsIGNvcm5lcjJ9KX19XG4gICAqL1xuICBncmlkU25hcE1vdmU6ICBmdW5jdGlvbihvYmplY3QpIHtcblxuICAgIG9iamVjdC5zZXRDb29yZHMoKTtcblxuICAgIHZhciB4ID0gdGhpcy5ncmlkU25hcE1vdmVCeUF4ZShvYmplY3QsXCJ4XCIpLFxuICAgICAgeSA9IHRoaXMuZ3JpZFNuYXBNb3ZlQnlBeGUob2JqZWN0LFwieVwiKTtcblxuICAgIHZhciB2YWx1ZSA9IHt4OiB4LCB5IDogeX07XG4gICAgdGhpcy5zbmFwQ2FsbGJhY2sgJiYgdGhpcy5zbmFwQ2FsbGJhY2sodmFsdWUpO1xuXG4gICAgcmV0dXJuIHZhbHVlO1xuICB9LFxuXG5cbiAgX2dldF9jb3JuZXIgOiBmdW5jdGlvbihvYmplY3QsY29ybmVyX25hbWUpIHtcblxuICAgIGlmKGNvcm5lcl9uYW1lID09IFwiY1wiKXtcbiAgICAgIHZhciBwID0gb2JqZWN0LmdldENlbnRlclBvaW50KCk7XG4gICAgICB2YXIgX3NjYWxlID0gdGhpcy5jYW52YXMuZ2V0Wm9vbSgpO1xuICAgICAgcC54ICo9IF9zY2FsZTtcbiAgICAgIHAueSAqPSBfc2NhbGU7XG4gICAgICByZXR1cm4gcDtcbiAgICB9XG4gICAgcmV0dXJuIG9iamVjdC5vQ29vcmRzW2Nvcm5lcl9uYW1lXTtcbiAgfSxcbi8vc25hcCB0byBncmlkIGJ5IHggY29vcmRpbmF0ZXNcbiAgZ3JpZFNuYXBNb3ZlQnlBeGUgOiBmdW5jdGlvbihvYmplY3QsYXhlKSB7XG5cbiAgICB2YXIgX3NjYWxlID0gdGhpcy5jYW52YXMuZ2V0Wm9vbSgpO1xuICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgIGlmKCBheGUgPT0gXCJ4XCIgKXtcbiAgICAgIHZhciBfbCA9IHNlbGYuY2FudmFzLm9mZnNldHMubGVmdCxcbiAgICAgICAgX3cgPSB0aGlzLmNhbnZhcy5vcmlnaW5hbFdpZHRoIC0gc2VsZi5jYW52YXMub2Zmc2V0cy5yaWdodCAgLSBfbCxcbiAgICAgICAgX2MgPSBvYmplY3QubGVmdCxcbiAgICAgICAgX3AgPSBcImxlZnRcIlxuICAgIH1lbHNle1xuICAgICAgX2wgPSBzZWxmLmNhbnZhcy5vZmZzZXRzLnRvcDtcbiAgICAgIF93ID0gdGhpcy5jYW52YXMub3JpZ2luYWxIZWlnaHQgLSBzZWxmLmNhbnZhcy5vZmZzZXRzLmJvdHRvbSAgLSBfbDtcbiAgICAgIF9jID0gb2JqZWN0LnRvcDtcbiAgICAgIF9wID0gXCJ0b3BcIjtcbiAgICB9XG5cblxuXG4gICAgLy9zdXBwb3J0bGluZXNcbiAgICBmb3IodmFyIGNvcm5lcl9uYW1lIGluIHRoaXMuc25hcENvcm5lcnMpIHtcbiAgICAgIHZhciBjb3JuZXIgPSB0aGlzLl9nZXRfY29ybmVyKG9iamVjdCxjb3JuZXJfbmFtZSk7XG4gICAgICBmb3IgKHZhciBpIGluIHRoaXMuc3VwcG9ydExpbmVzKSB7XG4gICAgICAgIHZhciBsID0gdGhpcy5zdXBwb3J0TGluZXNbaV07XG4gICAgICAgIHZhciBfdmFsID0gbFtheGVdICsgdGhpcy5yZWN0W19wXTtcbiAgICAgICAgaWYgKGxbYXhlXSAmJiBNYXRoLmFicyhfdmFsIC0gY29ybmVyW2F4ZV0pIDwgc2VsZi5hcmVhKSB7XG4gICAgICAgICAgb2JqZWN0W19wXSA9IChfdmFsIC0gKGNvcm5lcltheGVdIC0gb2JqZWN0Lm9Db29yZHMudGxbYXhlXSkpIC8gKG9iamVjdC5jYW52YXMudmlld3BvcnRUcmFuc2Zvcm1bMF0pIDtcbiAgICAgICAgICB2YXIgVkFMID0ge3ZhbHVlOiBfdmFsLCBjb3JuZXI6IGNvcm5lcl9uYW1lLCBvYmplY3QyIDogbCwgbGluZTogdHJ1ZX07XG4gICAgICAgICAgLy8vL2NvbnNvbGUubG9nKFZBTCk7XG4gICAgICAgICAgcmV0dXJuIFZBTDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vZ3VpZGxpbmVzXG4gICAgZm9yKHZhciBjb3JuZXJfbmFtZSBpbiB0aGlzLnNuYXBDb3JuZXJzKSB7XG4gICAgICB2YXIgY29ybmVyID0gdGhpcy5fZ2V0X2Nvcm5lcihvYmplY3QsY29ybmVyX25hbWUpO1xuICAgICAgZm9yICh2YXIgaSBpbiB0aGlzLmNhbnZhcy5ndWlkbGluZXMpIHtcbiAgICAgICAgdmFyIGwgPSB0aGlzLmNhbnZhcy5ndWlkbGluZXNbaV07XG4gICAgICAgIHZhciBfdmFsID0gbFtheGVdICogX3NjYWxlO1xuICAgICAgICBpZiAobFtheGVdICYmIE1hdGguYWJzKF92YWwgLSBjb3JuZXJbYXhlXSkgPCBzZWxmLmFyZWEpIHtcbiAgICAgICAgICBvYmplY3RbX3BdID0gKF92YWwgLSAoY29ybmVyW2F4ZV0gLSBvYmplY3Qub0Nvb3Jkcy50bFtheGVdKSkgLyAob2JqZWN0LmNhbnZhcy52aWV3cG9ydFRyYW5zZm9ybVswXSkgO1xuICAgICAgICAgIFZBTCA9IHt2YWx1ZTogX3ZhbCwgY29ybmVyOiBjb3JuZXJfbmFtZSwgb2JqZWN0MiA6IGwsIGxpbmU6IHRydWV9O1xuICAgICAgICAgIC8vY29uc29sZS5sb2coVkFMKTtcbiAgICAgICAgICByZXR1cm4gVkFMO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy9ncmlkXG5cbiAgICBmb3IodmFyIGNvcm5lcl9uYW1lIGluIHRoaXMuc25hcENvcm5lcnMpIHtcbiAgICAgIHZhciBjb3JuZXIgPSB0aGlzLl9nZXRfY29ybmVyKG9iamVjdCxjb3JuZXJfbmFtZSk7XG5cbiAgICAgIGlmICh0aGlzLmdyaWRFbmFibGVkKSB7XG4gICAgICAgIHZhciB4ID0gKGNvcm5lcltheGVdIC0gX2wgKyBzZWxmLmFyZWEpICUgc2VsZi5ncmlkU2l6ZTtcbiAgICAgICAgaWYgKHggPCAtc2VsZi5ncmlkU2l6ZSlyZXR1cm4gZmFsc2U7XG4gICAgICAgIGlmICh4IDwgc2VsZi5hcmVhICogMikge1xuICAgICAgICAgIHZhciBfeHh4ID0gX2MgKyAoY29ybmVyW2F4ZV0gLSBvYmplY3Qub0Nvb3Jkcy50bFtheGVdKTtcbiAgICAgICAgICBpZiAoX3h4eCA+IF9sICYmIF94eHggPCBfdyArIF9sKSB7XG4gICAgICAgICAgICBvYmplY3RbX3BdIC09IHggLSBzZWxmLmFyZWE7XG4gICAgICAgICAgICBWQUwgPSB7dmFsdWU6IGNvcm5lcltheGVdIC0geCArIHNlbGYuYXJlYSwgY29ybmVyOiBjb3JuZXJfbmFtZSwgZ3JpZDogdHJ1ZX07XG4gICAgICAgICAgICAvL2NvbnNvbGUubG9nKFZBTCk7XG4gICAgICAgICAgICByZXR1cm4gVkFMO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICB9XG5cblxuICAgICAgaWYgKHRoaXMuYm9yZGVyRW5hYmxlZCkge1xuICAgICAgICAvL2dyaWQgd2lkdGgvaGVpZ2h0XG4gICAgICAgIHZhciBfdmFsID0gKF93ICsgdGhpcy5jYW52YXMub2Zmc2V0c1tfcF0pICogX3NjYWxlO1xuICAgICAgICBpZiAoTWF0aC5hYnMoX3ZhbCAtIGNvcm5lcltheGVdKSA8IHNlbGYuYXJlYSkge1xuICAgICAgICAgIG9iamVjdFtfcF0gPSAoX3ZhbCAtIChjb3JuZXJbYXhlXSAtIG9iamVjdC5vQ29vcmRzLnRsW2F4ZV0pKSAvIF9zY2FsZTtcbiAgICAgICAgICBWQUwgPSB7dmFsdWU6IF92YWwsIGNvcm5lcjogY29ybmVyX25hbWUsIGdyaWQ6IHRydWUsIGNvcm5lcjI6IGF4ZSA9PSBcInhcIiA/IFwid2lkdGhcIiA6IFwiaGVpZ2h0XCJ9O1xuICAgICAgICAgIC8vY29uc29sZS5sb2coVkFMKTtcbiAgICAgICAgICByZXR1cm4gVkFMO1xuICAgICAgICB9XG4gICAgICAgIC8vZ3JpZCB0b3AvbGVmdFxuICAgICAgICB2YXIgX3ZhbCA9IHRoaXMuY2FudmFzLm9mZnNldHNbX3BdICogdGhpcy5jYW52YXMuZ2V0Wm9vbSgpO1xuICAgICAgICBpZiAoTWF0aC5hYnMoX3ZhbCAtIGNvcm5lcltheGVdKSA8IHNlbGYuYXJlYSkge1xuICAgICAgICAgIG9iamVjdFtfcF0gPSAoX3ZhbCAtIChjb3JuZXJbYXhlXSAtIG9iamVjdC5vQ29vcmRzLnRsW2F4ZV0pICkgLyAob2JqZWN0LmNhbnZhcy52aWV3cG9ydFRyYW5zZm9ybVswXSkgO1xuICAgICAgICAgIFZBTCA9IHt2YWx1ZTogX3ZhbCwgY29ybmVyOiBjb3JuZXJfbmFtZSwgZ3JpZDogdHJ1ZSwgY29ybmVyMjogX3B9O1xuICAgICAgICAgIC8vY29uc29sZS5sb2coVkFMKTtcbiAgICAgICAgICByZXR1cm4gVkFMO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG5cbiAgICAvL290aGVyIG9iamVjdHNcbiAgICBmb3IgKHZhciBfb2JqX2luZGV4IGluIHRoaXMuY2FudmFzLl9vYmplY3RzKSB7XG4gICAgICB2YXIgX29iaiA9IHRoaXMuY2FudmFzLl9vYmplY3RzW19vYmpfaW5kZXhdO1xuICAgICAgaWYoIV9vYmouZ3JpZGRhYmxlIHx8IF9vYmogPT0gb2JqZWN0IHx8ICFfb2JqLnZpc2libGUgfHwgX29iai5oaWRkZW5BY3RpdmUpY29udGludWU7XG5cbiAgICAgIGZvcih2YXIgY29ybmVyX25hbWUgaW4gdGhpcy5zbmFwQ29ybmVycykge1xuICAgICAgICB2YXIgY29ybmVyID0gdGhpcy5fZ2V0X2Nvcm5lcihvYmplY3QsY29ybmVyX25hbWUpO1xuXG4gICAgICAgIGZvciAodmFyIGogaW4gdGhpcy5zbmFwQ29ybmVyc1tjb3JuZXJfbmFtZV0pIHtcbiAgICAgICAgICB2YXIgY29ybmVyX25hbWVfMiA9ICB0aGlzLnNuYXBDb3JuZXJzW2Nvcm5lcl9uYW1lXVtqXTtcbiAgICAgICAgICB2YXIgY29ybmVyXzIgPSB0aGlzLl9nZXRfY29ybmVyKF9vYmosY29ybmVyX25hbWVfMik7XG5cbiAgICAgICAgICBpZihNYXRoLmFicyggY29ybmVyW2F4ZV0gLSBjb3JuZXJfMltheGVdKSA8IHNlbGYuYXJlYSl7XG4gICAgICAgICAgICBvYmplY3RbX3BdID0gKGNvcm5lcl8yW2F4ZV0gLSAgKGNvcm5lcltheGVdIC0gb2JqZWN0Lm9Db29yZHMudGxbYXhlXSkpIC8gKG9iamVjdC5jYW52YXMudmlld3BvcnRUcmFuc2Zvcm1bMF0pIDtcbiAgICAgICAgICAgIFZBTCA9IHt2YWx1ZTogY29ybmVyXzJbYXhlXSxjb3JuZXI6IGNvcm5lcl9uYW1lLCBvYmplY3QyOiBfb2JqLCBjb3JuZXIyOiBjb3JuZXJfbmFtZV8yfTtcbiAgICAgICAgICAgIC8vY29uc29sZS5sb2coVkFMKTtcbiAgICAgICAgICAgIHJldHVybiBWQUw7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfSxcblxuXG4gIC8vc25hcCB0byBncmlkIGJ5IHggY29vcmRpbmF0ZXNcbiAgZ3JpZFNuYXBSZXNpemU6ICBmdW5jdGlvbihvYmplY3QpIHtcblxuICAgIHRoaXMuc2V0Q29vcmRzKCk7XG4gICAgdmFyIHggPSB0aGlzLmdyaWRTbmFwWFJlc2l6ZShvYmplY3QpLFxuICAgICAgeSA9IHRoaXMuZ3JpZFNuYXBZUmVzaXplKG9iamVjdCk7XG4gICAgdmFyIHZhbHVlID0ge3g6IHgsIHkgOiB5fTtcbiAgICB0aGlzLnNuYXBDYWxsYmFjayAmJiB0aGlzLnNuYXBDYWxsYmFjayh2YWx1ZSk7XG4gICAgcmV0dXJuIHZhbHVlXG4gIH0sXG5cbiAgZ3JpZFNuYXBYUmVzaXplOiAgZnVuY3Rpb24ob2JqZWN0KSB7XG5cbiAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICB2YXIgX2wgPSBzZWxmLnJlY3QubGVmdCxcbiAgICAgIF93ID0gc2VsZi5yZWN0LndpZHRoO1xuXG4gICAgdmFyIGFjdGl2ZV9jb3JuZXIgPSBjYW52YXMuX2N1cnJlbnRUcmFuc2Zvcm0uY29ybmVyO1xuXG4gICAgdmFyIGNvb3JkcyA9IFtdO1xuICAgIHZhciBpc19yaWdodCA9IGZhbHNlO1xuICAgIHN3aXRjaChhY3RpdmVfY29ybmVyKXtcbiAgICAgIGNhc2UgXCJ0clwiOlxuICAgICAgY2FzZSBcImJyXCI6XG4gICAgICBjYXNlIFwibXJcIjpcbiAgICAgICAgaXNfcmlnaHQgPSB0cnVlO1xuICAgICAgICBjb29yZHMgPSBbXCJ0clwiLFwiYnJcIl07XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcInRsXCI6XG4gICAgICBjYXNlIFwiYmxcIjpcbiAgICAgIGNhc2UgXCJtbFwiOlxuICAgICAgICBjb29yZHMgPSBbXCJibFwiLFwidGxcIl07XG4gICAgICAgIGJyZWFrO1xuICAgIH1cblxuICAgIHZhciB0b19yYWRpYW5zID0gTWF0aC5QSSAvIDE4MDtcbiAgICBmb3IodmFyIGkgaW4gdGhpcy5zbmFwQ29ybmVycykge1xuICAgICAgdmFyIF9jb3JuZXJfbmFtZSA9IHRoaXMuc25hcENvcm5lcnNbaV07XG4gICAgICBpZihjb29yZHMuaW5kZXhPZihfY29ybmVyX25hbWUpPT0gLTEpY29udGludWU7XG4gICAgICB2YXIgY29ybmVyID0gb2JqZWN0Lm9Db29yZHNbdGhpcy5zbmFwQ29ybmVyc1tpXV07XG5cbiAgICAgIHZhciB4ID0gKGNvcm5lci54IC0gX2wgKyBzZWxmLmFyZWEpJXNlbGYuZ3JpZFNpemU7XG4gICAgICB2YXIgX2xpbmUgPSAgTWF0aC5mbG9vcigoY29ybmVyLnggLSBfbCArIHNlbGYuYXJlYSkvIHNlbGYuZ3JpZFNpemUpICsgMTtcbiAgICAgIGlmKHggPCAtc2VsZi5ncmlkU2l6ZSApcmV0dXJuIGZhbHNlO1xuICAgICAgaWYoeCA8IHNlbGYuYXJlYSAqIDIpe1xuICAgICAgICBpZihjb3JuZXIueCA+IF9sICYmIGNvcm5lci54IDwgX3cgKyBfbCApe1xuXG4gICAgICAgICAgaWYoaXNfcmlnaHQpe1xuICAgICAgICAgICAgaWYoX2Nvcm5lcl9uYW1lID09IFwidHJcIil7XG4gICAgICAgICAgICAgIHZhciBvcHQgPSB7XG4gICAgICAgICAgICAgICAgc2NhbGVYOiBvYmplY3Quc2NhbGVYICogIChfbGluZSAqIHNlbGYuZ3JpZFNpemUgLSBvYmplY3Qub0Nvb3Jkcy50bC54IC0gX2wpLyhjb3JuZXIueCAtIG9iamVjdC5vQ29vcmRzLnRsLngpXG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZihfY29ybmVyX25hbWUgPT0gXCJiclwiKXtcbiAgICAgICAgICAgICAgdmFyIG9wdCA9IHtcbiAgICAgICAgICAgICAgICBzY2FsZVg6IG9iamVjdC5zY2FsZVggKiAgKF9saW5lICogc2VsZi5ncmlkU2l6ZSAtIG9iamVjdC5vQ29vcmRzLmJsLnggLSBfbCkvKGNvcm5lci54IC0gb2JqZWN0Lm9Db29yZHMuYmwueClcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vaWYoX2Nvcm5lcl9uYW1lID09IFwibXJcIil7XG4gICAgICAgICAgICAvLyAgICB2YXIgb3B0ID0ge1xuICAgICAgICAgICAgLy8gICAgICAgIHNjYWxlWDogb2JqZWN0LnNjYWxlWCAqICAoX2xpbmUgKiBzZWxmLmdyaWRTaXplIC0gb2JqZWN0Lm9Db29yZHMubWwueCAtIF9sKS8oY29ybmVyLnggLSBvYmplY3Qub0Nvb3Jkcy5tbC54KVxuICAgICAgICAgICAgLy8gICAgfTtcbiAgICAgICAgICAgIC8vfVxuICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgdmFyIHNjYWxlMiA9ICggY29ybmVyLnggKyBvYmplY3Qud2lkdGggKiBvYmplY3Quc2NhbGVYIC0gKChfbGluZSAtIDEpICogc2VsZi5ncmlkU2l6ZSArIF9sKSkgLyBvYmplY3Qud2lkdGg7XG4gICAgICAgICAgICAvL2lmKF9jb3JuZXJfbmFtZSA9PSBcInRsXCIpe1xuICAgICAgICAgICAgLy8gICAgdmFyIF9sID0gKF9saW5lIC0gMSkgKiBzZWxmLmdyaWRTaXplICsgX2w7XG4gICAgICAgICAgICAvLyAgICB2YXIgX3IgPSBvYmplY3Qub0Nvb3Jkcy50ci54O1xuICAgICAgICAgICAgLy8gICAgdmFyIF93ID0gX3IgLSBfbDtcbiAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAvLyAgIHZhciBfc2NhbGUgICA9IF93IC8gKG9iamVjdC53aWR0aCAqTWF0aC5zaW4ob2JqZWN0LmFuZ2xlICogIHRvX3JhZGlhbnMgKSk7XG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgLy8gICAgb3B0ID0ge1xuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIC8vICAgICAgICBzY2FsZVg6IHNjYWxlMlxuICAgICAgICAgICAgLy8gICAgfTtcbiAgICAgICAgICAgIC8vfVxuICAgICAgICAgICAgLy9lbHNle1xuXG4gICAgICAgICAgICB2YXIgb3B0ID0ge1xuICAgICAgICAgICAgICBsZWZ0OiAgb2JqZWN0Lm9Db29yZHMudHIueCAtIChvYmplY3Qub0Nvb3Jkcy50ci54IC0gb2JqZWN0LmxlZnQpL29iamVjdC5zY2FsZVggKiBzY2FsZTIsXG4gICAgICAgICAgICAgIHNjYWxlWDogc2NhbGUyXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgaWYoX2Nvcm5lcl9uYW1lICE9IFwibWxcIil7XG4gICAgICAgICAgICAgIG9wdC50b3AgPSBvYmplY3Qub0Nvb3Jkcy50ci55IC0gKG9iamVjdC5vQ29vcmRzLnRyLnkgLSBvYmplY3QudG9wKS9vYmplY3Quc2NhbGVYICogc2NhbGUyO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy99XG5cblxuXG4gICAgICAgICAgfVxuICAgICAgICAgIG9iamVjdC5zZXQob3B0KTtcbiAgICAgICAgICByZXR1cm4ge3ZhbHVlOiBvYmplY3QubGVmdCArIChjb3JuZXIueCAtIG9iamVjdC5vQ29vcmRzLnRsLngpLCBjb3JuZXI6IF9jb3JuZXJfbmFtZX07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9LFxuXG5cbiAgLy9zbmFwIHRvIGdyaWQgYnkgeCBjb29yZGluYXRlc1xuICBncmlkU25hcFlSZXNpemU6ICBmdW5jdGlvbihvYmplY3QpIHtcblxuICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgIHZhciBfbCA9IHNlbGYucmVjdC50b3AsXG4gICAgICBfdyA9IHNlbGYucmVjdC5oZWlnaHQ7XG5cbiAgICB2YXIgYWN0aXZlX2Nvcm5lciA9IGNhbnZhcy5fY3VycmVudFRyYW5zZm9ybS5jb3JuZXI7XG5cbiAgICB2YXIgY29vcmRzID0gW107XG4gICAgdmFyIGlzX3JpZ2h0ID0gZmFsc2U7XG4gICAgc3dpdGNoKGFjdGl2ZV9jb3JuZXIpe1xuLy8gICAgICAgICAgICAgY2FzZSBcIm1sXCI6XG4vLyAgICAgICAgICAgICAgICAgY29vcmRzID0gW1widGxcIixcImJsXCJdO1xuLy8gICAgICAgICAgICAgICAgIGJyZWFrO1xuLy8gICAgICAgICAgICAgY2FzZSBcIm1yXCI6XG4vLyAgICAgICAgICAgICAgICAgaXNfcmlnaHQgPSB0cnVlO1xuLy8gICAgICAgICAgICAgICAgIGNvb3JkcyA9IFtcInRyXCIsXCJiclwiXTtcbi8vICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJ0clwiOlxuICAgICAgY2FzZSBcInRsXCI6XG4gICAgICBjYXNlIFwibXRcIjpcbiAgICAgICAgY29vcmRzID0gW1widGxcIixcInRyXCJdO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJibFwiOlxuICAgICAgY2FzZSBcIm1iXCI6XG4gICAgICBjYXNlIFwiYnJcIjpcbiAgICAgICAgaXNfcmlnaHQgPSB0cnVlO1xuICAgICAgICBjb29yZHMgPSBbXCJibFwiLFwiYnJcIl07XG4gICAgICAgIGJyZWFrO1xuICAgIH1cblxuICAgIGZvcih2YXIgaSBpbiB0aGlzLnNuYXBDb3JuZXJzKSB7XG4gICAgICB2YXIgX2Nvcm5lcl9uYW1lID0gdGhpcy5zbmFwQ29ybmVyc1tpXTtcbiAgICAgIGlmKGNvb3Jkcy5pbmRleE9mKF9jb3JuZXJfbmFtZSk9PSAtMSljb250aW51ZTtcbiAgICAgIHZhciBjb3JuZXIgPSBvYmplY3Qub0Nvb3Jkc1t0aGlzLnNuYXBDb3JuZXJzW2ldXTtcblxuICAgICAgdmFyIHkgPSAoY29ybmVyLnkgLSBfbCArIHNlbGYuYXJlYSklc2VsZi5ncmlkU2l6ZTtcbiAgICAgIHZhciBfbGluZSA9ICBNYXRoLmZsb29yKChjb3JuZXIueSAtIF9sICsgc2VsZi5hcmVhKS8gc2VsZi5ncmlkU2l6ZSkgKyAxO1xuICAgICAgaWYoeSA8IC1zZWxmLmdyaWRTaXplIClyZXR1cm4gZmFsc2U7XG4gICAgICBpZih5IDwgc2VsZi5hcmVhICogMil7XG4gICAgICAgIGlmKGNvcm5lci55ID4gX2wgJiYgY29ybmVyLnkgPCBfdyArIF9sICl7XG5cbiAgICAgICAgICBpZihpc19yaWdodCl7XG4gICAgICAgICAgICBpZihfY29ybmVyX25hbWUgPT0gXCJibFwiKXtcbiAgICAgICAgICAgICAgdmFyIG9wdCA9IHtcbiAgICAgICAgICAgICAgICBzY2FsZVk6IG9iamVjdC5zY2FsZVkgKiAgKF9saW5lICogc2VsZi5ncmlkU2l6ZSAtIG9iamVjdC5vQ29vcmRzLnRsLnkgLSBfbCkvKGNvcm5lci55IC0gb2JqZWN0Lm9Db29yZHMudGwueSlcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKF9jb3JuZXJfbmFtZSA9PSBcImJyXCIpe1xuICAgICAgICAgICAgICB2YXIgb3B0ID0ge1xuICAgICAgICAgICAgICAgIHNjYWxlWTogb2JqZWN0LnNjYWxlWSAqICAoX2xpbmUgKiBzZWxmLmdyaWRTaXplIC0gb2JqZWN0Lm9Db29yZHMudHIueSAtIF9sKS8oY29ybmVyLnkgLSBvYmplY3Qub0Nvb3Jkcy50ci55KVxuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy9pZihfY29ybmVyX25hbWUgPT0gXCJtYlwiKXtcbiAgICAgICAgICAgIC8vICAgIHZhciBvcHQgPSB7XG4gICAgICAgICAgICAvLyAgICAgICAgc2NhbGVZOiBvYmplY3Quc2NhbGVZICogIChfbGluZSAqIHNlbGYuZ3JpZFNpemUgLSBvYmplY3Qub0Nvb3Jkcy50ci55IC0gX2wpLyhjb3JuZXIueSAtIG9iamVjdC5vQ29vcmRzLm10LnkpXG4gICAgICAgICAgICAvLyAgICB9O1xuICAgICAgICAgICAgLy99XG4gICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICB2YXIgc2NhbGUyID0gKCBjb3JuZXIueSArIG9iamVjdC53aWR0aCAqIG9iamVjdC5zY2FsZVkgLSAoKF9saW5lIC0gMSkgKiBzZWxmLmdyaWRTaXplICsgX2wpKSAvIG9iamVjdC53aWR0aDtcbiAgICAgICAgICAgIHZhciBvcHQgPSB7XG4gICAgICAgICAgICAgIHRvcDogICBvYmplY3Qub0Nvb3Jkcy5ibC55IC0gKG9iamVjdC5vQ29vcmRzLmJsLnkgLSBvYmplY3QudG9wKS9vYmplY3Quc2NhbGVZICogc2NhbGUyLFxuICAgICAgICAgICAgICBzY2FsZVk6IHNjYWxlMlxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIC8vaWYoX2Nvcm5lcl9uYW1lICE9IFwibXRcIil7XG4gICAgICAgICAgICAvLyAgICBvcHQubGVmdCA9ICBvYmplY3Qub0Nvb3Jkcy5ibC55IC0gKG9iamVjdC5vQ29vcmRzLmJsLnkgLSBvYmplY3QubGVmdCkvb2JqZWN0LnNjYWxlWSAqIHNjYWxlMjtcbiAgICAgICAgICAgIC8vfVxuICAgICAgICAgIH1cbiAgICAgICAgICBvYmplY3Quc2V0KG9wdCk7XG4gICAgICAgICAgcmV0dXJuIHt2YWx1ZTogb2JqZWN0LmxlZnQgKyAoY29ybmVyLnkgLSBvYmplY3Qub0Nvb3Jkcy50bC55KSwgY29ybmVyOiBfY29ybmVyX25hbWV9O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG59O1xuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9tb2R1bGVzL2dyaWQuanNcbi8vIG1vZHVsZSBpZCA9IDY5XG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIid1c2Ugc3RyaWN0JztcblxuXG4vLyBmYWJyaWMucmVxdWlyZSgnU2xpZGVHcm91cCcsWydTbGlkZU9iamVjdCddLCBmdW5jdGlvbigpIHtcbnZhciBfT0JKID0gZmFicmljLk9iamVjdC5wcm90b3R5cGU7XG52YXIgX2hhbmRsZUdyb3VwaW5nX292ZXJ3cml0dGVuID0gZmFicmljLkNhbnZhcy5wcm90b3R5cGUuX2hhbmRsZUdyb3VwaW5nO1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5DYW52YXMucHJvdG90eXBlLCB7XG4gIC8qKlxuICAgKiBEZWFjdGl2YXRlcyBhbGwgb2JqZWN0cyBhbmQgZGlzcGF0Y2hlcyBhcHByb3ByaWF0ZSBldmVudHNcbiAgICogQHJldHVybiB7ZmFicmljLkNhbnZhc30gdGhpc0FyZ1xuICAgKiBAY2hhaW5hYmxlXG4gICAqL1xuICBkZWFjdGl2YXRlQWxsV2l0aERpc3BhdGNoOiBmdW5jdGlvbiAoZSkge1xuICAgIHZhciBhY3RpdmVHcm91cCA9IHRoaXMuZ2V0QWN0aXZlR3JvdXAoKSxcbiAgICAgIGFjdGl2ZU9iamVjdCA9IHRoaXMuZ2V0QWN0aXZlT2JqZWN0KCk7XG4gICAgdmFyIF90YXJnZXQgPSBhY3RpdmVPYmplY3QgfHwgYWN0aXZlR3JvdXA7XG4gICAgaWYgKF90YXJnZXQpIHtcbiAgICAgIHRoaXMuZmlyZSgnYmVmb3JlOnNlbGVjdGlvbjpjbGVhcmVkJywgeyB0YXJnZXQ6IF90YXJnZXQsIGU6IGUgfSk7XG4gICAgfVxuICAgIHRoaXMuZGVhY3RpdmF0ZUFsbCgpO1xuICAgIGlmIChfdGFyZ2V0KSB7XG4gICAgICB0aGlzLmZpcmUoJ3NlbGVjdGlvbjpjbGVhcmVkJywgeyBlOiBlLCB0YXJnZXQ6IF90YXJnZXQgfSk7XG4gICAgICBfdGFyZ2V0LmZpcmUoJ2Rlc2VsZWN0ZWQnKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG5cbiAgLyoqXG4gICAqIERpdmlkZXMgb2JqZWN0cyBpbiB0d28gZ3JvdXBzLCBvbmUgdG8gcmVuZGVyIGltbWVkaWF0ZWx5XG4gICAqIGFuZCBvbmUgdG8gcmVuZGVyIGFzIGFjdGl2ZUdyb3VwLlxuICAgKiByZXR1cm4gb2JqZWN0cyB0byByZW5kZXIgaW1tZWRpYXRlbHkgYW5kIHB1c2hlcyB0aGUgb3RoZXIgaW4gdGhlIGFjdGl2ZUdyb3VwLlxuICAgKi9cbiAgX2Nob29zZU9iamVjdHNUb1JlbmRlcjogZnVuY3Rpb24oKSB7XG4gICAgdmFyIGFjdGl2ZUdyb3VwID0gdGhpcy5nZXRBY3RpdmVHcm91cCgpLFxuICAgICAgYWN0aXZlT2JqZWN0ID0gdGhpcy5nZXRBY3RpdmVPYmplY3QoKSxcbiAgICAgIG9iamVjdCwgb2Jqc1RvUmVuZGVyID0gWyBdLCBhY3RpdmVHcm91cE9iamVjdHMgPSBbIF07XG5cbiAgICBpZiAoYWN0aXZlR3JvdXAgJiYgIXRoaXMucHJlc2VydmVPYmplY3RTdGFja2luZykge1xuICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IHRoaXMuX29iamVjdHMubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgICAgb2JqZWN0ID0gdGhpcy5fb2JqZWN0c1tpXTtcbiAgICAgICAgaWYgKCFhY3RpdmVHcm91cC5jb250YWlucyhvYmplY3QpKSB7XG4gICAgICAgICAgaWYoIW9iamVjdC5oaWRkZW5BY3RpdmUpe1xuICAgICAgICAgICAgb2Jqc1RvUmVuZGVyLnB1c2gob2JqZWN0KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgYWN0aXZlR3JvdXBPYmplY3RzLnB1c2gob2JqZWN0KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKGFjdGl2ZUdyb3VwKSB7XG4gICAgICAgIC8vIGFjdGl2ZUdyb3VwLl9zZXQoJ19vYmplY3RzJywgYWN0aXZlR3JvdXBPYmplY3RzKTtcbiAgICAgICAgb2Jqc1RvUmVuZGVyLnB1c2goYWN0aXZlR3JvdXApO1xuICAgICAgfVxuICAgICAgYWN0aXZlT2JqZWN0ICYmIG9ianNUb1JlbmRlci5wdXNoKGFjdGl2ZU9iamVjdCk7XG4gICAgICAvLyBhY3RpdmVHcm91cC5fc2V0KCdfb2JqZWN0cycsIGFjdGl2ZUdyb3VwT2JqZWN0cyk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgb2Jqc1RvUmVuZGVyID0gdGhpcy5fb2JqZWN0cztcbiAgICB9XG4gICAgcmV0dXJuIG9ianNUb1JlbmRlcjtcbiAgfSxcbiAgLyoqXG4gICAqIGFkZGluZyBiZWZvcmU6c2VsZWN0aW9uOmNyZWF0ZWQgZXZlbnRcbiAgICogQHByaXZhdGVcbiAgICogQHBhcmFtIHtFdmVudH0gZSBFdmVudCBvYmplY3RcbiAgICogQHBhcmFtIHtmYWJyaWMuT2JqZWN0fSB0YXJnZXRcbiAgICovXG4gIF9oYW5kbGVHcm91cGluZzogZnVuY3Rpb24gKGUsIHRhcmdldCkge1xuICAgIHRoaXMuZmlyZShcImJlZm9yZTpzZWxlY3Rpb246Y3JlYXRlZFwiKTtcbiAgICBfaGFuZGxlR3JvdXBpbmdfb3ZlcndyaXR0ZW4uY2FsbCh0aGlzLCBlLCB0YXJnZXQpO1xuICB9LFxuICAvKipcbiAgICogQHByaXZhdGVcbiAgICogQHBhcmFtIHtFdmVudH0gZSBtb3VzZSBldmVudFxuICAgKi9cbiAgX2dyb3VwU2VsZWN0ZWRPYmplY3RzOiBmdW5jdGlvbiAoZSkge1xuXG4gICAgdmFyIGdyb3VwID0gdGhpcy5fY29sbGVjdE9iamVjdHMoKTtcblxuICAgIGdyb3VwID0gZmFicmljLnV0aWwub2JqZWN0LmZpbHRlcihncm91cCx7Z3JvdXBTZWxlY3RhYmxlOiB0cnVlfSk7XG5cbiAgICAvLyBkbyBub3QgY3JlYXRlIGdyb3VwIGZvciAxIGVsZW1lbnQgb25seVxuICAgIGlmIChncm91cC5sZW5ndGggPT09IDEpIHtcbiAgICAgIHRoaXMuc2V0QWN0aXZlT2JqZWN0KGdyb3VwWzBdLCBlKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoZ3JvdXAubGVuZ3RoID4gMSkge1xuICAgICAgZ3JvdXAgPSBuZXcgZmFicmljLkdyb3VwKGdyb3VwLnJldmVyc2UoKSwge1xuICAgICAgICBjYW52YXM6IHRoaXNcbiAgICAgIH0pO1xuICAgICAgZ3JvdXAuYWRkV2l0aFVwZGF0ZSgpO1xuICAgICAgdGhpcy5zZXRBY3RpdmVHcm91cChncm91cCwgZSk7XG4gICAgICBncm91cC5zYXZlQ29vcmRzKCk7XG4gICAgICB0aGlzLmZpcmUoJ3NlbGVjdGlvbjpjcmVhdGVkJywgeyB0YXJnZXQ6IGdyb3VwIH0pO1xuICAgICAgdGhpcy5yZW5kZXJBbGwoKTtcbiAgICB9XG4gIH1cbn0pO1xuXG5mYWJyaWMuT2JqZWN0LnByb3RvdHlwZS5ncm91cFNlbGVjdGFibGUgPSB0cnVlO1xuXG5mYWJyaWMuR3JvdXAucHJvdG90eXBlLmNsb25lU3luYyA9IGZ1bmN0aW9uKCkge1xuICB2YXIgX2Nsb25lZE9iamVjdHMgPSB0aGlzLl9vYmplY3RzLm1hcChmdW5jdGlvbihvYmplY3Qpe1xuICAgIHJldHVybiBvYmplY3QuY2xvbmVTeW5jKCk7XG4gIH0pO1xuXG5cbiAgdmFyIG9iamVjdCA9IHRoaXMudG9PYmplY3QoKTtcbiAgZGVsZXRlIG9iamVjdC5vYmplY3RzO1xuXG4gIHJldHVybiBuZXcgZmFicmljLkdyb3VwKF9jbG9uZWRPYmplY3RzLCBvYmplY3QsIHRydWUpO1xuXG4gIC8vIGZhYnJpYy51dGlsLmVubGl2ZW5PYmplY3RzKG9iamVjdC5vYmplY3RzLCBmdW5jdGlvbiAoZW5saXZlbmVkT2JqZWN0cykge1xuICAvLyAgIGRlbGV0ZSBvYmplY3Qub2JqZWN0cztcbiAgLy8gICBjYWxsYmFjayAmJiBjYWxsYmFjayhuZXcgZmFicmljLkdyb3VwKGVubGl2ZW5lZE9iamVjdHMsIG9iamVjdCwgdHJ1ZSkpO1xuICAvLyB9KTtcbn1cblxuX09CSi5jbG9uZVN5bmMgPSBmdW5jdGlvbigpe1xuICB2YXIgX2tsYXNzID0gZmFicmljW2ZhYnJpYy51dGlsLnN0cmluZy5jYW1lbGl6ZShmYWJyaWMudXRpbC5zdHJpbmcuY2FwaXRhbGl6ZSh0aGlzLnR5cGUpKV07XG5cbiAgaWYoX2tsYXNzLmFzeW5jKXtcbiAgICB2YXIgX29iaiA9IG5ldyBfa2xhc3MuZnJvbU9iamVjdCh0aGlzKTtcbiAgfWVsc2V7XG4gICAgdmFyIF9vYmogPSB0aGlzLmNsb25lKCk7XG4gIH1cbiAgX29iai5jYW52YXMgPSB0aGlzLmNhbnZhcztcbiAgcmV0dXJuIF9vYmo7XG59O1xuXG5cbmZhYnJpYy5Hcm91cC5wcm90b3R5cGUuaXNQb3NzaWJsZVRhcmdldCA9IGZ1bmN0aW9uIChlLCBvYmplY3QpIHtcbiAgcmV0dXJuIHRoaXMuc2VhcmNoUG9zc2libGVUYXJnZXRzKGUsIFtvYmplY3RdKS50YXJnZXQgIT09IG51bGw7XG59O1xuLyoqXG4gKiByZXR1cm4gaW5uZXIgdGFyZ2V0IGFuZCBncm91cCBvZiB0YXJnZXRzIHVuZGVyIHRoZSBjdXJzb3JcbiAqIEBwYXJhbSBlXG4gKiBAcGFyYW0gb2JqZWN0c1xuICogQHJldHVybnMge3t0YXJnZXQ6IG51bGwsIGdyb3VwOiBBcnJheX19XG4gKi9cbmZhYnJpYy5Hcm91cC5wcm90b3R5cGUuc2VhcmNoUG9zc2libGVUYXJnZXRzID0gZnVuY3Rpb24gKGUsIG9iamVjdHMpIHtcblxuICBpZiAoIW9iamVjdHMpb2JqZWN0cyA9IHRoaXMuX29iamVjdHM7XG4gIHZhciBwb2ludGVyID0gdGhpcy5jYW52YXMuZ2V0UG9pbnRlcihlLCB0cnVlKTtcbiAgdmFyIGkgPSBvYmplY3RzLmxlbmd0aCxcbiAgICBub3JtYWxpemVkUG9pbnRlciA9IHRoaXMuY2FudmFzLl9ub3JtYWxpemVQb2ludGVyKHRoaXMsIHBvaW50ZXIpO1xuXG4gIHZhciB0YXJnZXRzID0ge1xuICAgIHRhcmdldDogbnVsbCxcbiAgICBncm91cDogW11cbiAgfTtcbiAgd2hpbGUgKGktLSkge1xuICAgIGlmICh0aGlzLmNhbnZhcy5fY2hlY2tUYXJnZXQobm9ybWFsaXplZFBvaW50ZXIsIG9iamVjdHNbaV0pKSB7XG4gICAgICBpZiAoIXRhcmdldHMudGFyZ2V0KXRhcmdldHMudGFyZ2V0ID0gb2JqZWN0c1tpXTtcbiAgICAgIHRhcmdldHMuZ3JvdXAucHVzaChvYmplY3RzW2ldKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHRhcmdldHM7XG59O1xuXG5mYWJyaWMuR3JvdXAucHJvdG90eXBlLl9jYWxjQm91bmRzID0gZnVuY3Rpb24gKG9ubHlXaWR0aEhlaWdodCkge1xuICB2YXIgYVggPSBbXSxcbiAgICBhWSA9IFtdLFxuICAgIG8sIHByb3AsXG4gICAgcHJvcHMgPSBbJ3RyJywgJ2JyJywgJ2JsJywgJ3RsJ107XG5cbiAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHRoaXMuX29iamVjdHMubGVuZ3RoOyBpIDwgbGVuOyArK2kpIHtcbiAgICBvID0gdGhpcy5fb2JqZWN0c1tpXTtcbiAgICBpZiAoby5ub3RTZWxlY3RhYmxlSW5UaGVHcm91cCkge1xuICAgICAgY29udGludWU7XG4gICAgfVxuICAgIG8uc2V0Q29vcmRzKCk7XG4gICAgZm9yICh2YXIgaiA9IDA7IGogPCBwcm9wcy5sZW5ndGg7IGorKykge1xuICAgICAgcHJvcCA9IHByb3BzW2pdO1xuICAgICAgYVgucHVzaChvLm9Db29yZHNbcHJvcF0ueCk7XG4gICAgICBhWS5wdXNoKG8ub0Nvb3Jkc1twcm9wXS55KTtcbiAgICB9XG4gIH1cblxuICB0aGlzLnNldCh0aGlzLl9nZXRCb3VuZHMoYVgsIGFZLCBvbmx5V2lkdGhIZWlnaHQpKTtcbn07XG5cblxuZmFicmljLlNsaWRlR3JvdXAgPSB7XG4gIGluaXRpYWxpemVfb3ZlcndyaXR0ZW46IGZhYnJpYy5Hcm91cC5wcm90b3R5cGUuaW5pdGlhbGl6ZSxcbiAgaXNTZWxlY3Rpb25Hcm91cDogZnVuY3Rpb24oKXtcbiAgICByZXR1cm4gdGhpcy5jYW52YXMuX29iamVjdHMuaW5kZXhPZih0aGlzKSA9PT0gLTFcbiAgfSxcbiAgLy9jbG9uZTogZnVuY3Rpb24oY2FsbGJhY2spe1xuICAvLyAgaWYoY2FsbGJhY2sgPT09IHRydWUgfHwgY2FsbGJhY2suY29uc3RydWN0b3IgPT09IE9iamVjdCl7XG4gIC8vICAgIHZhciBfZnJhbWUgPSBuZXcgZmFicmljLkdyb3VwKHRoaXMpO1xuICAvLyAgICBpZihjYWxsYmFjay5jb25zdHJ1Y3RvciA9PT0gT2JqZWN0KXtcbiAgLy8gICAgICBfZnJhbWUuc2V0KGNhbGxiYWNrKTtcbiAgLy8gICAgICByZXR1cm4gX2ZyYW1lO1xuICAvLyAgICB9XG4gIC8vICB9XG4gIC8vICByZXR1cm4gdGhpcy5jYWxsU3VwZXIoJ2Nsb25lJyxjYWxsYmFjayk7XG4gIC8vfSxcbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24ob2JqZWN0cyxvcHRpb25zKXtcbiAgICBpZihvYmplY3RzLmNvbnN0cnVjdG9yICE9IEFycmF5KXtcbiAgICAgIHZhciBlbCA9IG9iamVjdHM7XG4gICAgICBvcHRpb25zID0gZWwudG9PYmplY3QoKTtcbiAgICAgIG9iamVjdHMgPSBbXTtcbiAgICAgIGZvcih2YXIgaSBpbiBlbC5fb2JqZWN0cyl7XG4gICAgICAgIG9iamVjdHMucHVzaChlbC5fb2JqZWN0c1tpXS5jbG9uZVN5bmMoKSlcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLmluaXRpYWxpemVfb3ZlcndyaXR0ZW4ob2JqZWN0cyxvcHRpb25zKTtcbiAgICBpZih0aGlzLnR5cGUgPT0gJ2dyb3VwJyl7XG4gICAgICB0aGlzLm9uKFwiZGJsY2xpY2tcIiwgZnVuY3Rpb24oKXtcbiAgICAgICAgaWYodGhpcy5jYW52YXMuX29iamVjdHMuaW5kZXhPZih0aGlzKSA9PT0gLTEpe1xuICAgICAgICAgIHRoaXMuZ3JvdXBTZWxlY3RlZEVsZW1lbnRzKCk7XG4gICAgICAgIH1lbHNle1xuICAgICAgICAgIHRoaXMudW5ncm91cCgpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH0sXG4gIHVuZ3JvdXAgOiBmdW5jdGlvbigpIHtcbiAgICB0aGlzLmNhbnZhcy5kaXNjYXJkQWN0aXZlR3JvdXAoKTtcbiAgICB0aGlzLl9yZXN0b3JlT2JqZWN0c1N0YXRlKCk7XG4gICAgdGhpcy5jYW52YXMucmVtb3ZlKHRoaXMpO1xuICAgIGZvcih2YXIgaSBpbiB0aGlzLl9vYmplY3RzKXtcbiAgICAgIHRoaXMuY2FudmFzLmFkZCh0aGlzLl9vYmplY3RzW2ldKTtcbiAgICAgIHRoaXMuX29iamVjdHNbaV0uY2xpcFRvID0gdGhpcy5jbGlwVG87XG4gICAgICAvL3RoaXMuX29iamVjdHNbaV0uYWN0aXZlID0gdHJ1ZTtcbiAgICB9XG4gICAgdmFyIGdyb3VwID0gbmV3IGZhYnJpYy5Hcm91cCh0aGlzLl9vYmplY3RzLCB7XG4gICAgICBjYW52YXM6IHRoaXMuY2FudmFzXG4gICAgfSk7XG4gICAgZ3JvdXAuYWRkV2l0aFVwZGF0ZSgpO1xuICAgIHRoaXMuY2FudmFzLnNldEFjdGl2ZUdyb3VwKGdyb3VwKTtcbiAgICBncm91cC5zYXZlQ29vcmRzKCk7XG4gICAgdGhpcy5jYW52YXMuZmlyZSgnc2VsZWN0aW9uOmNyZWF0ZWQnLCB7IHRhcmdldDogZ3JvdXAgfSk7XG4gICAgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG5cbiAgICAvL3ZhciBfZ3JvdXAgPSBuZXcgZmFicmljLkdyb3VwKHRoaXMuX29iamVjdHMpO1xuICAgIC8vX2dyb3VwLmNhbnZhcyA9IHRoaXMuY2FudmFzO1xuICAgIC8vdGhpcy5jYW52YXMuc2V0QWN0aXZlT2JqZWN0KF9ncm91cCk7XG4gIH0sXG5cbiAgZ3JvdXBTZWxlY3RlZEVsZW1lbnRzOiBmdW5jdGlvbigpe1xuXG5cblxuICAgIHZhciBlbCA9IHRoaXMuY2xvbmVTeW5jKCk7XG4gICAgdGhpcy5jYW52YXMuYWRkKGVsKTtcbiAgICB0aGlzLmNhbnZhcy5kaXNjYXJkQWN0aXZlR3JvdXAoKTtcbiAgICB0aGlzLmNhbnZhcy5zZXRBY3RpdmVPYmplY3QoZWwpO1xuXG4gICAgZm9yKHZhciBpIGluIHRoaXMuX29iamVjdHMpe1xuICAgICAgdGhpcy5jYW52YXMucmVtb3ZlKHRoaXMuX29iamVjdHNbaV0ub3JpZ2luYWxPYmplY3QpO1xuICAgIH1cblxuXG4gIH0sXG4gIGFjdGlvbnM6IHtcblxuICAgIG9iamVjdFJlbW92ZToge1xuICAgICAgY2xhc3NOYW1lOiAgJ2ZhIGZhLXRyYXNoJyxcbiAgICAgIHRpdGxlOiAgICAgICdEZWxldGUnLFxuICAgICAga2V5OiAgICAgICAgXCJEZWxldGVcIixcbiAgICAgIGFjdGlvbjogICAgIGZ1bmN0aW9uKCl7XG4gICAgICAgIGlmKHRoaXMuaXNTZWxlY3Rpb25Hcm91cCgpKXtcbiAgICAgICAgICBmb3IodmFyIGkgaW4gdGhpcy5fb2JqZWN0cyl7XG4gICAgICAgICAgICB2YXIgX29iaiA9IHRoaXMuX29iamVjdHNbaV07XG4gICAgICAgICAgICB0aGlzLmNhbnZhcy5yZW1vdmUoX29iai5vcmlnaW5hbE9iamVjdCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHRoaXMuY2FudmFzLmRpc2NhcmRBY3RpdmVHcm91cCgpO1xuICAgICAgICAgIHRoaXMuY2FudmFzLmRpc2NhcmRBY3RpdmVPYmplY3QoKTtcbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgdGhpcy5jYW52YXMucmVtb3ZlKHRoaXMpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgICAgfVxuICAgIH0sXG4gICAgb2JqZWN0RHVwbGljYXRlOiB7XG4gICAgICBjbGFzc05hbWU6ICAnZmEgZmEtY2xvbmUnLFxuICAgICAgaW5zZXJ0OiAgICAgJ2R1cGxpY2F0ZVRvb2wnLFxuICAgICAgdGl0bGU6ICAgICAgJ0R1cGxpY2F0ZScsXG4gICAgICBhY3Rpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYodGhpcy5pc1NlbGVjdGlvbkdyb3VwKCkpe1xuICAgICAgICAgIHRoaXMuY2FudmFzLmZpcmUoJ2JlZm9yZTpzZWxlY3Rpb246Y2xlYXJlZCcsIHsgdGFyZ2V0OiB0aGlzLCBlOiBudWxsIH0pO1xuICAgICAgICAgIHRoaXMuY2FudmFzLmRpc2NhcmRBY3RpdmVHcm91cCgpO1xuICAgICAgICAgIHRoaXMuZHVwbGljYXRlKGZ1bmN0aW9uKGVsKXtcbiAgICAgICAgICAgIGVsLnVuZ3JvdXAoKTtcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICB0aGlzLmR1cGxpY2F0ZSgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcbiAgICBzZWxlY3RHcm91cDoge1xuICAgICAgdGl0bGU6ICfQs9GA0YPQv9C/0LAnLFxuICAgICAgY2xhc3NOYW1lOiAnZmEgZmEtb2JqZWN0LWdyb3VwJyxcbiAgICAgIHZpc2libGU6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiB0aGlzLmlzU2VsZWN0aW9uR3JvdXAoKTtcbiAgICAgIH0sXG4gICAgICBhY3Rpb246IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5ncm91cFNlbGVjdGVkRWxlbWVudHMoKTtcbiAgICAgICAgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gICAgICB9XG4gICAgICAvL3Zpc2libGU6IElERS5ncm91cEF2YWlsYWJsZVxuICAgIH0sXG4gICAgdW5zZWxlY3RHcm91cDoge1xuICAgICAgdGl0bGU6ICfQs9GA0YPQv9C/0LAnLFxuICAgICAgY2xhc3NOYW1lOiAnZmEgZmEtb2JqZWN0LXVuZ3JvdXAnLFxuICAgICAgdmlzaWJsZTogZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2FudmFzLl9vYmplY3RzLmluZGV4T2YodGhpcykgIT09IC0xXG4gICAgICB9LFxuICAgICAgYWN0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMudW5ncm91cCgpO1xuICAgICAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLkdyb3VwLnByb3RvdHlwZSwgZmFicmljLlNsaWRlR3JvdXApO1xuXG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLlNsaWRlQ2FudmFzLnByb3RvdHlwZSx7XG4gIGV2ZW50TGlzdGVuZXJzOiBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kQXJyYXlzT2JqZWN0KGZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUuZXZlbnRMaXN0ZW5lcnMsIHtcbiAgICAnc2VsZWN0aW9uOmNyZWF0ZWQnOiBmdW5jdGlvbihldmVudCl7XG4gICAgICB0aGlzLl9vblNlbGVjdGlvbkNyZWF0ZWQoZXZlbnQpO1xuICAgIH1cbiAgfSksXG4gIF9vblNlbGVjdGlvbk1vZGlmaWVkOiBmdW5jdGlvbiAoKSB7XG4gICAgZm9yICh2YXIgaSBpbiB0aGlzLl9vYmplY3RzKSB7XG4gICAgICB2YXIgY29weSA9IHRoaXMuX29iamVjdHNbaV0uY2xvbmVTeW5jKCk7XG4gICAgICBjb3B5Lmdyb3VwID0gdGhpcztcbiAgICAgIHRoaXMuX3Jlc3RvcmVPYmplY3RTdGF0ZShjb3B5KTtcbiAgICAgIHRoaXMuX29iamVjdHNbaV0ub3JpZ2luYWxPYmplY3Quc2V0KHtcbiAgICAgICAgbGVmdDogY29weS5sZWZ0LFxuICAgICAgICB0b3A6IGNvcHkudG9wLFxuICAgICAgICBhbmdsZTogY29weS5hbmdsZSxcbiAgICAgICAgc2NhbGVYOiBjb3B5LnNjYWxlWCxcbiAgICAgICAgc2NhbGVZOiBjb3B5LnNjYWxlWSxcbiAgICAgICAgc2tld1g6IGNvcHkuc2tld1gsXG4gICAgICAgIHNrZXdZOiBjb3B5LnNrZXdZLFxuICAgICAgICB3aWR0aDogY29weS53aWR0aCxcbiAgICAgICAgaGVpZ2h0OiBjb3B5LmhlaWdodFxuICAgICAgfSk7XG4gICAgfVxuICB9LFxuICBfb25TZWxlY3Rpb25EZXNlbGVjdGVkOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgIGZvciAodmFyIGkgaW4gdGhpcy5fb2JqZWN0cykge1xuICAgICAgdmFyIF9vYmogPSB0aGlzLl9vYmplY3RzW2ldO1xuICAgICAgX29iai5vcmlnaW5hbE9iamVjdC5zZXRDb29yZHMoKTtcbiAgICAgIF9vYmoub3JpZ2luYWxPYmplY3QuZXZlbnRlZCA9IHRydWU7XG4gICAgICBkZWxldGUgX29iai5vcmlnaW5hbE9iamVjdC5oaWRkZW5BY3RpdmU7XG4gICAgfVxuICB9LFxuICBfb25TZWxlY3Rpb25DcmVhdGVkOiBmdW5jdGlvbiAoZWwpIHtcblxuICAgIHZhciBncm91cCAgPSBlbC50YXJnZXQ7XG5cbiAgICB2YXIgb3JpZ2luYWxPYmplY3RzID0gW11cbiAgICBmb3IodmFyIGkgaW4gZ3JvdXAuX29iamVjdHMpe1xuICAgICAgdmFyIF9vYmogPSBncm91cC5fb2JqZWN0c1tpXTtcbiAgICAgIG9yaWdpbmFsT2JqZWN0cy5wdXNoKF9vYmoub3JpZ2luYWxPYmplY3QgfHwgX29iailcbiAgICB9XG5cbiAgICBncm91cC5kZXN0cm95KCk7XG4gICAgZ3JvdXAuX29iamVjdHMgPSBbXTtcblxuICAgIHZhciBfY2xpcFRvID0gb3JpZ2luYWxPYmplY3RzWzBdLmNsaXBUbztcblxuICAgIGZvciAodmFyIGkgaW4gb3JpZ2luYWxPYmplY3RzKSB7XG4gICAgICB2YXIgb3JpZ2luYWwgPSBvcmlnaW5hbE9iamVjdHNbaV07XG5cbiAgICAgIGlmIChfY2xpcFRvICE9IG9yaWdpbmFsLmNsaXBUbykge1xuICAgICAgICBfY2xpcFRvID0gZmFsc2U7XG4gICAgICB9XG5cbiAgICAgIHZhciBfb2JqID0gb3JpZ2luYWwuY2xvbmVTeW5jKCk7XG5cbiAgICAgIF9vYmouc2V0KHtcbiAgICAgICAgY2xpcFRvOiBudWxsLFxuICAgICAgICBvcmlnaW5hbE9iamVjdDogb3JpZ2luYWxcbiAgICAgIH0pO1xuICAgICAgb3JpZ2luYWwuc2V0KHtcbiAgICAgICAgYWN0aXZlOmZhbHNlLFxuICAgICAgICBldmVudGVkOiBmYWxzZSxcbiAgICAgICAgaGlkZGVuQWN0aXZlOiB0cnVlXG4gICAgICB9KTtcblxuICAgICAgZ3JvdXAuYWRkV2l0aFVwZGF0ZShfb2JqKTtcbiAgICAgIGdyb3VwLnNldENvb3JkcygpO1xuICAgIH1cblxuICAgIGdyb3VwLmNsaXBUbyA9ICBfY2xpcFRvO1xuXG4gICAgZ3JvdXAub24oe1xuICAgICAgXCJtb2RpZmllZFwiOiB0aGlzLl9vblNlbGVjdGlvbk1vZGlmaWVkLFxuICAgICAgJ2Rlc2VsZWN0ZWQnOiB0aGlzLl9vblNlbGVjdGlvbkRlc2VsZWN0ZWRcbiAgICB9KTtcblxuICB9XG59KTtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vbW9kdWxlcy9ncm91cHMuanNcbi8vIG1vZHVsZSBpZCA9IDcwXG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIid1c2Ugc3RyaWN0JztcblxudmFyIEhpc3RvcnkgPSByZXF1aXJlKCcuLy4uL3BsdWdpbnMvaGlzdG9yeScpO1xuXG5IaXN0b3J5LnByb3RvdHlwZS5pbnNlcnRSZWNvcmRzID0gZmFsc2U7XG5IaXN0b3J5LnByb3RvdHlwZS5hY3Rpb25zID0ge1xuICB1bmRvOiB7XG4gICAga2V5Q29kZTogJ3onLFxuICAgIGN0cmxLZXk6ICB0cnVlLFxuICAgIG9ic2VydmU6ICdjaGFuZ2VkJyxcbiAgICBjbGFzc05hbWU6ICdmYSBmYS11bmRvJyxcbiAgICB0aXRsZTogJ3VuZG8nLFxuICAgIGVuYWJsZWQ6ICdjYW5VbmRvJyxcbiAgICBhY3Rpb246IGZ1bmN0aW9uKCl7XG4gICAgICB0aGlzLnVuZG8oKTtcbiAgICB9XG4gIH0sXG4gIHJlY29yZHM6IHtcbiAgICB0aXRsZTogICAgICAgICAgXCJyZWNvcmRzXCIsXG4gICAgaXRlbUNsYXNzTmFtZTogIFwiZmlsdGVycy1zZWxlY3RvclwiLFxuICAgIGNsYXNzTmFtZTogICAgICBcImZhIGZhLWhpc3RvcnlcIixcbiAgICB0eXBlOiAgICAgICAgICAgXCJzZWxlY3RcIixcbiAgICB0ZW1wbGF0ZVNlbGVjdGlvbjogZnVuY3Rpb24oc3RhdGUsIGNvbnRhaW5lcikge1xuICAgICAgaWYgKHN0YXRlLmFueSkge1xuICAgICAgICByZXR1cm4gc3RhdGUudGV4dDtcbiAgICAgIH1cbiAgICAgIHJldHVybiAkKCc8c3Bhbj4nICsgc3RhdGUuaWQgKyBcIjpcIiArIHN0YXRlLnR5cGUgKyAnPC9zcGFuPicpO1xuICAgIH0sXG4gICAgdGVtcGxhdGVSZXN1bHQ6IGZ1bmN0aW9uKHN0YXRlLCBjb250YWluZXIsZGF0YSkge1xuICAgICAgaWYoIXN0YXRlLnR5cGUpcmV0dXJuO1xuICAgICAgdmFyIF9rZXlzID0gc3RhdGUub3JpZ2luYWxTdGF0ZSAmJiBPYmplY3Qua2V5cyhzdGF0ZS5vcmlnaW5hbFN0YXRlKS5qb2luKCcsJykgfHwgJyc7XG4gICAgICB2YXIgdHlwZSA9IHN0YXRlLm9iamVjdCAmJiBzdGF0ZS5vYmplY3QudHlwZSB8fCAnJztcbiAgICAgIHJldHVybiAkKFwiPHNwYW4+e2lkfTp7dHlwZX0oe290eXBlfSB7a2V5c30pPC9zcGFuPlwiLmZvcm1hdChmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKHtrZXlzIDogX2tleXMsIG90eXBlOiB0eXBlfSxzdGF0ZSkpKTtcbiAgICAgIC8vIGlmKHN0YXRlLmlkICE9IFwibm9uZVwiKXtcbiAgICAgIC8vICAgdmFyICRjYW52YXMgPSAkKCc8Y2FudmFzPicpO1xuICAgICAgLy8gICAkZWwucHJlcGVuZCgkY2FudmFzKTtcbiAgICAgIC8vIH1cbiAgICAgIC8vIHJldHVybiAkZWw7XG4gICAgfSxcbiAgICB2YWx1ZTogICAgICB7XG4gICAgICBvYnNlcnZlOiAnY2hhbmdlZCcsXG4gICAgICBzZXQgOiBmdW5jdGlvbih2YWwsZmlsdGVyc0RhdGEpe1xuICAgICAgICB0aGlzLmdvdG8odmFsKTtcbiAgICAgIH0sXG4gICAgICBnZXQ6IGZ1bmN0aW9uKCl7XG4gICAgICAgIHJldHVybiB0aGlzLnJlY29yZHNbdGhpcy5jdXJyZW50XS5pZDtcbiAgICAgIH0sXG4gICAgICBvcHRpb25zOiBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gdGhpcy5yZWNvcmRzO1xuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgcmVkbzoge1xuICAgIGtleUNvZGU6ICd5JyxcbiAgICBjdHJsS2V5OiAgdHJ1ZSxcbiAgICBvYnNlcnZlOiAnY2hhbmdlZCcsXG4gICAgY2xhc3NOYW1lOiAnZmEgZmEtcmVwZWF0JyxcbiAgICB0aXRsZTogJ3JlZG8nLFxuICAgIGVuYWJsZWQ6ICdjYW5SZWRvJyxcbiAgICBhY3Rpb246IGZ1bmN0aW9uKCl7XG4gICAgICB0aGlzLnJlZG8oKTtcbiAgICB9XG4gIH1cbn07XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLlNsaWRlQ2FudmFzLnByb3RvdHlwZS5hY3Rpb25zLCB7XG4gIGhpc3Rvcnk6IHtcbiAgICB0aXRsZTogJ2hpc3RvcnknLFxuICAgIHR5cGU6ICdtZW51JyxcbiAgICB0YXJnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLmhpc3Rvcnk7XG4gICAgfSxcbiAgICBtZW51OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5hY3Rpb25zO1xuICAgIH1cbiAgfVxufSk7XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLkNhbnZhcy5wcm90b3R5cGUsIHtcbiAgaW5zZXJ0SGlzdG9yeTogZmFsc2UsXG4gIG9uT2JqZWN0TW9kaWZpZWQ6IGZ1bmN0aW9uIChlKSB7XG4gICAgaWYgKCF0aGlzLmhpc3RvcnkuZW5hYmxlZCB8fCB0aGlzLnByb2Nlc3NpbmcgfHwgdGhpcy5oaXN0b3J5LnByb2Nlc3NpbmcpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgdmFyIF9jYW52YXMgPSBlLnRhcmdldC5jYW52YXMgfHwgZS50YXJnZXQud3JhcHBlckVsICYmIGUudGFyZ2V0O1xuXG4gICAgdGhpcy5oaXN0b3J5LmFkZCh7XG4gICAgICBjYW52YXM6ICBlLnRhcmdldC5jYW52YXMub3JpZ2luYWxTbGlkZSB8fCBlLnRhcmdldC5jYW52YXMsXG4gICAgICBvcmlnaW5hbFN0YXRlOiAgZS5zdGF0ZXMub3JpZ2luYWwsXG4gICAgICBtb2RpZmllZFN0YXRlOiAgZS5zdGF0ZXMubW9kaWZpZWQsXG4gICAgICBvYmplY3Q6IGUudGFyZ2V0LFxuICAgICAgdHlwZTogJ29iamVjdDptb2RpZmllZCcsXG4gICAgICB1bmRvOiBmdW5jdGlvbiAoX2FjdGlvbikge1xuICAgICAgICBfYWN0aW9uLm9iamVjdC5zZXQoX2FjdGlvbi5vcmlnaW5hbFN0YXRlKTtcbiAgICAgICAgaWYoX2FjdGlvbi5jYW52YXMubWlycm9yU2xpZGUgPT0gdGhpcy5jYW52YXMpe1xuICAgICAgICAgIF9hY3Rpb24ub2JqZWN0LnNldENvb3JkcygpO1xuICAgICAgICAgIHZhciBfY2FudmFzID0gdGhpcy5jYW52YXMgfHwgdGhpcztcbiAgICAgICAgICBfY2FudmFzLnJlbmRlckFsbCgpO1xuICAgICAgICB9XG4gICAgICAgIF9hY3Rpb24uY2FudmFzLmZpcmUoJ29iamVjdDptb2RpZmllZCcsIHsgdGFyZ2V0OiBfYWN0aW9uLm9iamVjdCB9KTtcbiAgICAgICAgX2FjdGlvbi5vYmplY3QuZmlyZSgnbW9kaWZpZWQnKTtcbiAgICAgICAgX2FjdGlvbi5jYW52YXMucmVuZGVyQWxsKCk7XG4gICAgICB9LFxuICAgICAgcmVkbzogZnVuY3Rpb24gKF9hY3Rpb24pIHtcbiAgICAgICAgX2FjdGlvbi5vYmplY3Quc2V0KF9hY3Rpb24ubW9kaWZpZWRTdGF0ZSk7XG4gICAgICAgIF9hY3Rpb24ub2JqZWN0LnNldENvb3JkcygpO1xuICAgICAgICBpZihfYWN0aW9uLmNhbnZhcy5taXJyb3JTbGlkZSA9PSB0aGlzLmNhbnZhcyl7XG4gICAgICAgICAgX2FjdGlvbi5vYmplY3Quc2V0Q29vcmRzKCk7XG4gICAgICAgICAgdmFyIF9jYW52YXMgPSB0aGlzLmNhbnZhcyB8fCB0aGlzO1xuICAgICAgICAgIF9jYW52YXMucmVuZGVyQWxsKCk7XG4gICAgICAgIH1cbiAgICAgICAgX2FjdGlvbi5jYW52YXMuZmlyZSgnb2JqZWN0Om1vZGlmaWVkJywgeyB0YXJnZXQ6IF9hY3Rpb24ub2JqZWN0IH0pO1xuICAgICAgICBfYWN0aW9uLm9iamVjdC5maXJlKCdtb2RpZmllZCcpO1xuICAgICAgICBfYWN0aW9uLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSxcbiAgY2xlYXJIaXN0b3J5OiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5oaXN0b3J5LmNsZWFyKCk7XG4gIH0sXG4gIGRpc2FibGVIaXN0b3J5OiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5oaXN0b3J5LmVuYWJsZWQgPSBmYWxzZTtcbiAgfSxcbiAgX2FkZF9vYmplY3RfaGlzdG9yeV9hY3Rpb246IGZ1bmN0aW9uIChfYWN0aW9uKSB7XG4gICAgdmFyIF9jYW52YXMgPSB0aGlzLmNhbnZhcyB8fCB0aGlzO1xuICAgIGlmKHRoaXMuY2FudmFzICYmIF9hY3Rpb24uY2FudmFzLm1pcnJvclNsaWRlID09IHRoaXMuY2FudmFzKXtcbiAgICAgIF9jYW52YXMuYWRkKF9hY3Rpb24ub2JqZWN0KTtcbiAgICAgIF9jYW52YXMuc2V0QWN0aXZlT2JqZWN0KF9hY3Rpb24ub2JqZWN0KTtcbiAgICAgIF9jYW52YXMucmVuZGVyQWxsKCk7XG4gICAgfWVsc2V7XG4gICAgICBfYWN0aW9uLmNhbnZhcy5hZGQoX2FjdGlvbi5vYmplY3QpO1xuICAgIH1cbiAgICBfYWN0aW9uLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgfSxcblxuICBfcmVtb3ZlX29iamVjdF9oaXN0b3J5X2FjdGlvbjogZnVuY3Rpb24gKF9hY3Rpb24pIHtcbiAgICBfYWN0aW9uLmNhbnZhcy5yZW1vdmUoX2FjdGlvbi5vYmplY3QpO1xuICAgIF9hY3Rpb24uY2FudmFzLnJlbmRlckFsbCgpO1xuICAgIGlmKHRoaXMuY2FudmFzICYmIF9hY3Rpb24uY2FudmFzLm1pcnJvclNsaWRlID09IHRoaXMuY2FudmFzKXtcbiAgICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgIH1cbiAgfSxcblxuICBvbk9iamVjdFJlbW92ZWQ6IGZ1bmN0aW9uIChlKSB7XG4gICAgaWYgKCF0aGlzLmhpc3RvcnkuZW5hYmxlZCB8fCB0aGlzLnByb2Nlc3NpbmcgfHwgdGhpcy5oaXN0b3J5LnByb2Nlc3NpbmcpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgdGhpcy5oaXN0b3J5LmFkZCh7XG4gICAgICBjYW52YXM6IGUudGFyZ2V0LmNhbnZhcy5vcmlnaW5hbFNsaWRlIHx8IGUudGFyZ2V0LmNhbnZhcyxcbiAgICAgIG9iamVjdDogZS50YXJnZXQsXG4gICAgICB0eXBlOiAnb2JqZWN0OnJlbW92ZWQnLFxuICAgICAgcmVkbzogdGhpcy5fcmVtb3ZlX29iamVjdF9oaXN0b3J5X2FjdGlvbixcbiAgICAgIHVuZG86IHRoaXMuX2FkZF9vYmplY3RfaGlzdG9yeV9hY3Rpb25cbiAgICB9KTtcbiAgfSxcbiAgb25EcmF3QWZ0ZXI6IGZ1bmN0aW9uKGV2ZW50KXtcbiAgICBpZiAoIXRoaXMuaGlzdG9yeS5lbmFibGVkIHx8IHRoaXMucHJvY2Vzc2luZyB8fCB0aGlzLmhpc3RvcnkucHJvY2Vzc2luZykge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICB0aGlzLmhpc3RvcnkuYWRkKHRoaXMuZnJlZURyYXdpbmdCcnVzaC5nZXRIaXN0b3J5UmVjb3JkKGV2ZW50KSlcbiAgfSxcbiAgb25PYmplY3RBZGRlZDogZnVuY3Rpb24gKGUpIHtcbiAgICBpZiAoIXRoaXMuaGlzdG9yeS5lbmFibGVkIHx8IHRoaXMucHJvY2Vzc2luZyB8fCB0aGlzLmhpc3RvcnkucHJvY2Vzc2luZykge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICB0aGlzLmhpc3RvcnkuYWRkKHtcbiAgICAgIGNhbnZhczogIGUudGFyZ2V0LmNhbnZhcy5vcmlnaW5hbFNsaWRlIHx8IGUudGFyZ2V0LmNhbnZhcyxcbiAgICAgIG9iamVjdDogZS50YXJnZXQsXG4gICAgICB0eXBlOiAnb2JqZWN0OmFkZGVkJyxcbiAgICAgIHVuZG86IHRoaXMuX3JlbW92ZV9vYmplY3RfaGlzdG9yeV9hY3Rpb24sXG4gICAgICByZWRvOiB0aGlzLl9hZGRfb2JqZWN0X2hpc3RvcnlfYWN0aW9uXG4gICAgfSk7XG4gIH0sXG4gIGluaXRIaXN0b3J5OiBmdW5jdGlvbiAoaGlzdG9yeSkge1xuICAgIGlmKCFoaXN0b3J5KXtcbiAgICAgIGhpc3RvcnkgPSBuZXcgSGlzdG9yeSh0aGlzKTtcbiAgICAgIGhpc3RvcnkuYXBwbGljYXRpb24gPSB0aGlzLmFwcGxpY2F0aW9uO1xuICAgIH1cblxuICAgIHRoaXMuaGlzdG9yeSA9IGhpc3Rvcnk7XG4gICAgdGhpcy5vbih7XG4gICAgICAnbG9hZGluZzpiZWdpbic6ICAgIHRoaXMuY2xlYXJIaXN0b3J5LFxuICAgICAgJ2RyYXc6YWZ0ZXInOiAgICAgICB0aGlzLm9uRHJhd0FmdGVyLFxuICAgICAgJ29iamVjdDptb2RpZmllZCc6ICB0aGlzLm9uT2JqZWN0TW9kaWZpZWQsXG4gICAgICAnb2JqZWN0OmFkZGVkJzogICAgIHRoaXMub25PYmplY3RBZGRlZCxcbiAgICAgICdvYmplY3Q6cmVtb3ZlZCc6ICAgdGhpcy5vbk9iamVjdFJlbW92ZWRcbiAgICB9KTtcblxuICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgdGhpcy5oaXN0b3J5Lm9uKCdjaGFuZ2VkJywgZnVuY3Rpb24oZSl7XG4gICAgICBpZih0aGlzLmFjdGl2ZUFjdGlvbi5jYW52YXMpe1xuICAgICAgICB0aGlzLmFjdGl2ZUFjdGlvbi5jYW52YXMubW9tZW50ID0gZS5hY3Rpb24ubW9tZW50O1xuICAgICAgfVxuICAgIH0pO1xuICAgIHZhciBwcm90byA9IHRoaXMuYXBwbGljYXRpb24ucHJvdG90eXBlcy5IaXN0b3J5O1xuICAgIGlmKHByb3RvKXtcbiAgICAgIGlmKHByb3RvLmV2ZW50TGlzdGVuZXJzKXtcbiAgICAgICAgaGlzdG9yeS5vbihwcm90by5ldmVudExpc3RlbmVycyk7XG4gICAgICB9XG4gICAgfVxuICB9LFxuICBlbmFibGVIaXN0b3J5OiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5oaXN0b3J5LmVuYWJsZWQgPSB0cnVlO1xuICB9XG59KTtcblxuaWYoZmFicmljLlByb2plY3Qpe1xuICBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5Qcm9qZWN0LnByb3RvdHlwZS5hY3Rpb25zLCB7XG4gICAgaGlzdG9yeToge1xuICAgICAgaW5zZXJ0OiAnaGlzdG9yeVRvb2xzJyxcbiAgICAgIHRpdGxlOiAnaGlzdG9yeScsXG4gICAgICB0eXBlOiAnbWVudScsXG4gICAgICB0YXJnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaGlzdG9yeTtcbiAgICAgIH0sXG4gICAgICBtZW51OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmFjdGlvbnM7XG4gICAgICB9XG4gICAgfVxuICB9KTtcblxuICBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5Qcm9qZWN0LnByb3RvdHlwZSwge1xuICAgIF9kZWZhdWx0X2V2ZW50X2xpc3RlbmVycyA6IHtcbiAgICAgIFwic2xpZGU6Y2hhbmdlOmJlZ2luXCIgOiBmdW5jdGlvbigpe1xuICAgICAgICB0aGlzLnByb2Nlc3NpbmcgPSB0cnVlIDtcbiAgICAgICAgaWYodGhpcy5oaXN0b3J5KXtcbiAgICAgICAgICB0aGlzLmhpc3RvcnkucHJvY2Vzc2luZyA9IHRydWUgO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgXCJzbGlkZTpjaGFuZ2VkXCIgOiBmdW5jdGlvbigpe1xuICAgICAgICB0aGlzLnByb2Nlc3NpbmcgPSBmYWxzZTtcbiAgICAgICAgaWYodGhpcy5oaXN0b3J5KXtcbiAgICAgICAgICB0aGlzLmhpc3RvcnkucHJvY2Vzc2luZyA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcbiAgICBoaXN0b3J5VG9vbHM6IGZhbHNlLFxuICAgIGVuYWJsZUhpc3Rvcnk6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuaGlzdG9yeS5lbmFibGVkID0gdHJ1ZTtcbiAgICB9XG4gIH0pO1xufVxuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9tb2R1bGVzL2hpc3RvcnkuanNcbi8vIG1vZHVsZSBpZCA9IDcxXG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIi8qKlxuKiBJbnRlcmFjdGl2ZU1vZGUgbWl4aW4uIEFsbG93IHRvIHN3aXRjaCBiZXR3ZWVuIHBhbi9lZGl0L2RyYXdpbmcgY2FudmFzIG1vZGVzLlxuKi9cblxuJ3VzZSBzdHJpY3QnO1xuXG5cbnZhciBfbW91c2VfZG93bl9vdmVyd3JpdHRlbiA9IGZhYnJpYy5DYW52YXMucHJvdG90eXBlLl9vbk1vdXNlRG93bjtcbnZhciBfbW91c2VfdXBfb3ZlcndyaXR0ZW4gPSBmYWJyaWMuQ2FudmFzLnByb3RvdHlwZS5fb25Nb3VzZVVwO1xudmFyIF9tb3VzZV9tb3ZlX292ZXJ3cml0dGVuID0gZmFicmljLkNhbnZhcy5wcm90b3R5cGUuX29uTW91c2VNb3ZlO1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUsIHtcbiAgc3BlY2lhbFByb3BlcnRpZXM6IGZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUuc3BlY2lhbFByb3BlcnRpZXMuY29uY2F0KFtcImludGVyYWN0aXZlTW9kZVwiXSksXG4gIF9pbml0RXZlbnRMaXN0ZW5lcnNfb3ZlcndyaXR0ZW46IGZhYnJpYy5DYW52YXMucHJvdG90eXBlLl9pbml0RXZlbnRMaXN0ZW5lcnMsXG4gIF9pbml0RXZlbnRMaXN0ZW5lcnM6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLl9pbml0RXZlbnRMaXN0ZW5lcnNfb3ZlcndyaXR0ZW4oKTtcbiAgICB0aGlzLl9fX29uS2V5RG93biA9IHRoaXMuX29uS2V5RG93bi5iaW5kKHRoaXMpO1xuICAgIGZhYnJpYy51dGlsLmFkZExpc3RlbmVyKGZhYnJpYy53aW5kb3csICdrZXlkb3duJywgdGhpcy5fX19vbktleURvd24pO1xuICB9LFxuICBfcmVtb3ZlTGlzdGVuZXJzX292ZXJ3cml0dGVuOiBmYWJyaWMuQ2FudmFzLnByb3RvdHlwZS5yZW1vdmVMaXN0ZW5lcnMsXG4gIHJlbW92ZUxpc3RlbmVyczogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuX3JlbW92ZUxpc3RlbmVyc19vdmVyd3JpdHRlbigpO1xuICAgIGZhYnJpYy51dGlsLnJlbW92ZUxpc3RlbmVyKGZhYnJpYy53aW5kb3csICdrZXlkb3duJywgdGhpcy5fX19vbktleURvd24pO1xuICB9LFxuICBfb25LZXlEb3duOiBmdW5jdGlvbiAoZSkge1xuICAgIHJldHVybiB0aGlzLl9hcHBseU1peGVkTW9kZShlKTtcbiAgfSxcbiAgZ2V0SW50ZXJhY3RpdmVNb2RlOiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMuaW50ZXJhY3RpdmVNb2RlO1xuICB9LFxuICBzZXRJbnRlcmFjdGl2ZU1vZGU6IGZ1bmN0aW9uICh0b29sKSB7XG4gICAgLy90b2RvIGNoZWNrdGhpcyBvdXRcbiAgICAvLyBpZiAodG9vbCA9PT0gJ2hhbmQnKSB7XG4gICAgLy8gICB0aGlzLnNldEN1cnNvcigncG9pbnRlcicpO1xuICAgIC8vIH1cbiAgICB0aGlzLmlzRHJhd2luZ01vZGUgPSAodG9vbCA9PT0gJ2RyYXcnKTtcbiAgICB0aGlzLmlzSGFuZE1vZGUgPSAodG9vbCA9PT0gJ2hhbmQnKTtcbiAgICB0aGlzLmludGVyYWN0aXZlID0gKHRvb2wgIT09ICdkaXNhYmxlZCcpO1xuICAgIHRoaXMuaXNNaXhlZE1vZGUgPSAodG9vbCA9PT0gJ21peGVkJyk7XG5cbiAgICBpZiAoIXRoaXMuaW50ZXJhY3RpdmUpIHtcbiAgICAgIHRoaXMudXBwZXJDYW52YXNFbC5zdHlsZS5jdXJzb3IgPSAnZGVmYXVsdCc7XG4gICAgfVxuICAgIHRoaXMuaW50ZXJhY3RpdmVNb2RlID0gdG9vbDtcbiAgfSxcblxuICAvKipcbiAgICogIGN1cnJlbnQgbW9kZVxuICAgKiAgQHZhbHVlcyBkZWZhdWx0IHwgaGFuZCB8IHNlbGVjdGlvblxuICAgKiAgQGNvbW1lbnRcbiAgICogICAgICBoYW5kICAgICAgLSBtb3ZpbmcgY2FudmFzXG4gICAqICAgICAgZHJhdyAtIGRyYXdpbmcgcmVhY3RhbmdsZXNcbiAgICogICAgICBzZWxlY3Rpb24gLSBkZWZhdWx0IGJlaGF2aW9yXG4gICAqL1xuICBpbnRlcmFjdGl2ZU1vZGU6ICdkZWZhdWx0JyxcblxuICBpc0hhbmRNb2RlOiBmYWxzZSxcbiAgX2hhbmRNb2RlQ3Vyc29yTW92ZTogZmFsc2UsXG4gIF9oYW5kTW9kZUN1cnNvckRvd246IGZhbHNlLFxuICBfaGFuZE1vZGVDdXJzb3JQb3NpdGlvbjoge3g6IDAsIHk6IDB9LFxuICBfaGFuZE1vZGVNb3VzZU1vdmU6IGZ1bmN0aW9uIChlKSB7XG4gICAgaWYgKHRoaXMuX2hhbmRNb2RlQ3Vyc29yRG93biA9PT0gdHJ1ZSkge1xuXG4gICAgICBpZiAoZS5wYWdlWSA9PT0gdGhpcy5faGFuZE1vZGVDdXJzb3JQb3NpdGlvbi55ICYmIGUucGFnZVggPT09IHRoaXMuX2hhbmRNb2RlQ3Vyc29yUG9zaXRpb24ueCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHRoaXMuX2hhbmRNb2RlQ3Vyc29yTW92ZSA9IHRydWU7XG5cbiAgICAgIHZhciBzY3JvbGwgPSB7eDogdGhpcy52aWV3cG9ydFRyYW5zZm9ybVs0XSwgeTogdGhpcy52aWV3cG9ydFRyYW5zZm9ybVs1XX07XG5cbiAgICAgIHZhciBuZXdTY3JvbGwgPSB7XG4gICAgICAgIHg6IHNjcm9sbC54IC0gKHRoaXMuX2hhbmRNb2RlQ3Vyc29yUG9zaXRpb24ueCAtIGUucGFnZVgpLFxuICAgICAgICB5OiBzY3JvbGwueSAtICh0aGlzLl9oYW5kTW9kZUN1cnNvclBvc2l0aW9uLnkgLSBlLnBhZ2VZKVxuICAgICAgfTtcblxuICAgICAgdmFyIGRpbXMgPSB7XG4gICAgICAgIHdpZHRoOiB0aGlzLnNpemUud2lkdGggKiB0aGlzLnpvb20gLSB0aGlzLmxvd2VyQ2FudmFzRWwud2lkdGgsXG4gICAgICAgIGhlaWdodDogdGhpcy5zaXplLmhlaWdodCAqIHRoaXMuem9vbSAtIHRoaXMubG93ZXJDYW52YXNFbC5oZWlnaHRcbiAgICAgIH07XG4gICAgICAvKiAgdG9kbyBuZWVkIHRvIGFkZCBzb21lIHJlc3RyaWN0aW9ucyBsYXRlclxuICAgICAgIC8vTWF0aC5tYXgoTWF0aC5taW4oMCxuZXdTY3JvbGwueCksLWRpbXMud2lkdGgpO1xuICAgICAgIC8vTWF0aC5tYXgoTWF0aC5taW4oMCxuZXdTY3JvbGwueSksLWRpbXMuaGVpZ2h0KTtcbiAgICAgICAqL1xuICAgICAgdGhpcy52aWV3cG9ydFRyYW5zZm9ybVs0XSA9IG5ld1Njcm9sbC54O1xuICAgICAgdGhpcy52aWV3cG9ydFRyYW5zZm9ybVs1XSA9IG5ld1Njcm9sbC55O1xuXG4gICAgICB0aGlzLmZpcmUoJ3ZpZXdwb3J0OnRyYW5zbGF0ZScpO1xuXG4gICAgICB0aGlzLnJlbmRlckFsbCgpO1xuICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IHRoaXMuX29iamVjdHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgdGhpcy5fb2JqZWN0c1tpXS5zZXRDb29yZHMoKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5faGFuZE1vZGVDdXJzb3JQb3NpdGlvbi55ID0gZS5wYWdlWTtcbiAgICAgIHRoaXMuX2hhbmRNb2RlQ3Vyc29yUG9zaXRpb24ueCA9IGUucGFnZVg7XG4gICAgfVxuICB9LFxuICBfaGFuZE1vZGVNb3VzZVVwOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5faGFuZE1vZGVDdXJzb3JEb3duID0gZmFsc2U7XG4gICAgaWYgKCF0aGlzLl9oYW5kTW9kZUN1cnNvck1vdmUpIHtcblxuICAgIH1cbiAgfSxcbiAgX2hhbmRNb2RlTW91c2VEb3duOiBmdW5jdGlvbiAoZSkge1xuXG4gICAgdGhpcy5faGFuZE1vZGVDdXJzb3JNb3ZlID0gZmFsc2U7XG4gICAgdGhpcy5faGFuZE1vZGVDdXJzb3JEb3duID0gdHJ1ZTtcbiAgICB0aGlzLl9oYW5kTW9kZUN1cnNvclBvc2l0aW9uID0ge1xuICAgICAgeTogZS5wYWdlWSxcbiAgICAgIHg6IGUucGFnZVhcbiAgICB9O1xuICB9LFxuICBoYW5kTW9kZUVuYWJsZWQ6IGZhbHNlLFxuICBoYW5kTW9kZUtleTogXCJBbHRcIixcbiAgX2FwcGx5TWl4ZWRNb2RlOiBmdW5jdGlvbiAoZSkge1xuICAgIHRoaXMuX2N1cnJlbnRfdGFyZ2V0ID0gdGhpcy5maW5kVGFyZ2V0KGUpO1xuXG4gICAgaWYgKHRoaXMuaGFuZE1vZGVFbmFibGVkICYmIGUuYWx0S2V5IHx8IGUua2V5ID09PSB0aGlzLmhhbmRNb2RlS2V5KSB7XG4gICAgICAvL2lmIHNoaWZ0IHVzZSBoYW5kIG1vZGVcbiAgICAgIGlmICghdGhpcy5pc0hhbmRNb2RlKSB7XG4gICAgICAgIHRoaXMuaXNIYW5kTW9kZSA9IHRydWU7XG4gICAgICAgIHRoaXMuaXNEcmF3aW5nTW9kZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLnNldEN1cnNvcigncG9pbnRlcicpO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAodGhpcy5pc01peGVkTW9kZSAmJiAhdGhpcy5faXNDdXJyZW50bHlEcmF3aW5nICYmICF0aGlzLl9jdXJyZW50VHJhbnNmb3JtKSB7XG5cbiAgICAgIHRoaXMuaXNIYW5kTW9kZSA9IGZhbHNlO1xuXG4gICAgICBpZiAodGhpcy5fY3VycmVudF90YXJnZXQpIHtcbiAgICAgICAgaWYgKHRoaXMuZnJlZURyYXdpbmdCcnVzaCAmJiB0aGlzLl9jdXJyZW50X3RhcmdldC5hbGxvd0RyYXdpbmcpIHtcbiAgICAgICAgICB2YXIgY29ybmVyID0gdGhpcy5fY3VycmVudF90YXJnZXQuX2ZpbmRUYXJnZXRDb3JuZXIodGhpcy5nZXRQb2ludGVyKGUsIHRydWUpKTtcbiAgICAgICAgICBpZiAoIWNvcm5lcikge1xuICAgICAgICAgICAgdGhpcy5pc0RyYXdpbmdNb2RlID0gdHJ1ZTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5pc0RyYXdpbmdNb2RlID0gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuaXNEcmF3aW5nTW9kZSkge1xuICAgICAgICAgIHRoaXMuaXNEcmF3aW5nTW9kZSA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAodGhpcy5mcmVlRHJhd2luZ0JydXNoICYmICF0aGlzLmlzRHJhd2luZ01vZGUpIHtcbiAgICAgICAgICB0aGlzLnNldEN1cnNvcih0aGlzLmZyZWVEcmF3aW5nQ3Vyc29yKTtcbiAgICAgICAgICB0aGlzLmlzRHJhd2luZ01vZGUgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuaXNIYW5kTW9kZSA9IGZhbHNlO1xuICAgIH1cblxuICB9LFxuICBfb25Nb3VzZU1vdmU6IGZ1bmN0aW9uIChlKSB7XG4gICAgaWYgKCF0aGlzLmludGVyYWN0aXZlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5fYXBwbHlNaXhlZE1vZGUoZSk7XG5cbiAgICBpZiAodGhpcy5pc0hhbmRNb2RlKSB7XG5cbiAgICAgIGlmICh0aGlzLl9jdXJyZW50X3RhcmdldCAmJiB0aGlzLl9jdXJyZW50X3RhcmdldC5zZWxlY3RhYmxlX292ZXJ3cml0dGVuKSB7XG4gICAgICAgIHRoaXMuX2N1cnJlbnRfdGFyZ2V0LnNlbGVjdGFibGUgPSB0cnVlO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5faGFuZE1vZGVBY3RpdmUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2hhbmRNb2RlTW91c2VNb3ZlKGUpO1xuICAgICAgfVxuICAgICAgdGhpcy5maXJlKCdtb3VzZTptb3ZlJywge3RhcmdldDogdGhpcy5fY3VycmVudF90YXJnZXQsIGU6IGV9KTtcbiAgICAgIHRoaXMuX2N1cnJlbnRfdGFyZ2V0ICYmIHRoaXMuX2N1cnJlbnRfdGFyZ2V0LmZpcmUoJ21vdXNlbW92ZScsIHtlOiBlfSk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIF9tb3VzZV9tb3ZlX292ZXJ3cml0dGVuLmNhbGwodGhpcywgZSk7XG4gICAgfVxuICB9LCAvKipcbiAgICogQHByaXZhdGVcbiAgICovXG4gIF9vblNjYWxlOiBmdW5jdGlvbiAoZSwgdHJhbnNmb3JtLCB4LCB5KSB7XG5cbiAgICB2YXIgdXNlVW5pU2NhbGUgPSBlLnNoaWZ0S2V5IF4gdGhpcy5zaGlmdEludmVydGVkO1xuICAgIC8vIHJvdGF0ZSBvYmplY3Qgb25seSBpZiBzaGlmdCBrZXkgaXMgbm90IHByZXNzZWRcbiAgICAvLyBhbmQgaWYgaXQgaXMgbm90IGEgZ3JvdXAgd2UgYXJlIHRyYW5zZm9ybWluZ1xuICAgIGlmICgodXNlVW5pU2NhbGUgfHwgdGhpcy51bmlTY2FsZVRyYW5zZm9ybSkgJiYgIXRyYW5zZm9ybS50YXJnZXQuZ2V0KCdsb2NrVW5pU2NhbGluZycpKSB7XG4gICAgICB0cmFuc2Zvcm0uY3VycmVudEFjdGlvbiA9ICdzY2FsZSc7XG4gICAgICByZXR1cm4gdGhpcy5fc2NhbGVPYmplY3QoeCwgeSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgLy8gU3dpdGNoIGZyb20gYSBub3JtYWwgcmVzaXplIHRvIHByb3BvcnRpb25hbFxuICAgICAgaWYgKCF0cmFuc2Zvcm0ucmVzZXQgJiYgdHJhbnNmb3JtLmN1cnJlbnRBY3Rpb24gPT09ICdzY2FsZScpIHtcbiAgICAgICAgdGhpcy5fcmVzZXRDdXJyZW50VHJhbnNmb3JtKGUpO1xuICAgICAgfVxuXG4gICAgICB0cmFuc2Zvcm0uY3VycmVudEFjdGlvbiA9ICdzY2FsZUVxdWFsbHknO1xuICAgICAgcmV0dXJuIHRoaXMuX3NjYWxlT2JqZWN0KHgsIHksICdlcXVhbGx5Jyk7XG4gICAgfVxuICB9LFxuICBzaGlmdEludmVydGVkOiBmYWxzZSxcbiAgX3NldEN1cnNvckZyb21FdmVudF9vdmVyd3JpdHRlbjogZmFicmljLkNhbnZhcy5wcm90b3R5cGUuX3NldEN1cnNvckZyb21FdmVudCxcbiAgX3NldEN1cnNvckZyb21FdmVudDogZnVuY3Rpb24gKGUsIHRhcmdldCkge1xuICAgIGlmICh0aGlzLmlzSGFuZE1vZGUpIHtcbiAgICAgIHRoaXMuc2V0Q3Vyc29yKCdwb2ludGVyJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX3NldEN1cnNvckZyb21FdmVudF9vdmVyd3JpdHRlbihlLCB0YXJnZXQpO1xuICAgIH1cbiAgfSxcbiAgX29uTW91c2VEb3duOiBmdW5jdGlvbiAoZSkge1xuICAgIGlmICghdGhpcy5pbnRlcmFjdGl2ZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuXG4gICAgdGhpcy5fYXBwbHlNaXhlZE1vZGUoZSk7XG4gICAgaWYgKHRoaXMuaXNIYW5kTW9kZSAmJiB0aGlzLl9jdXJyZW50X3RhcmdldCkge1xuICAgICAgdGhpcy5fY3VycmVudF90YXJnZXQuc2VsZWN0YWJsZV9vdmVyd3JpdHRlbiA9IHRoaXMuX2N1cnJlbnRfdGFyZ2V0LnNlbGVjdGFibGU7XG4gICAgICB0aGlzLl9jdXJyZW50X3RhcmdldC5zZWxlY3RhYmxlID0gZmFsc2U7XG4gICAgfVxuXG4gICAgX21vdXNlX2Rvd25fb3ZlcndyaXR0ZW4uY2FsbCh0aGlzLCBlKTtcblxuXG4gICAgaWYgKHRoaXMuaXNIYW5kTW9kZSkge1xuXG4gICAgICBpZiAodGhpcy5fY3VycmVudF90YXJnZXQgJiYgdGhpcy5fY3VycmVudF90YXJnZXQuc2VsZWN0YWJsZV9vdmVyd3JpdHRlbikge1xuICAgICAgICB0aGlzLl9jdXJyZW50X3RhcmdldC5zZWxlY3RhYmxlID0gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIHRoaXMuX2hhbmRNb2RlQWN0aXZlID0gdHJ1ZTtcbiAgICAgIHRoaXMuX2hhbmRNb2RlTW91c2VEb3duKGUpO1xuICAgIH1cbiAgfSxcblxuICBfb25Nb3VzZVVwOiBmdW5jdGlvbiAoZSkge1xuICAgIGlmICghdGhpcy5pbnRlcmFjdGl2ZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICBfbW91c2VfdXBfb3ZlcndyaXR0ZW4uY2FsbCh0aGlzLCBlKTtcblxuICAgIGlmICh0aGlzLmlzSGFuZE1vZGUpIHtcbiAgICAgIHRoaXMuX2hhbmRNb2RlQWN0aXZlID0gZmFsc2U7XG4gICAgfVxuICB9XG59KTtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vbW9kdWxlcy9pbnRlcmFjdGl2ZU1vZGUuanNcbi8vIG1vZHVsZSBpZCA9IDcyXG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIid1c2Ugc3RyaWN0JztcblxuXG52YXIgX29uUmVzaXplX292ZXJ3cml0dGVuID0gZmFicmljLkNhbnZhcy5wcm90b3R5cGUuX29uUmVzaXplO1xuXG52YXIgX3NldF9kaW1lbnNpb25zX292ZXJ3cml0dGVuID0gZmFicmljLkNhbnZhcy5wcm90b3R5cGUuc2V0RGltZW5zaW9ucztcbnZhciBfcmVuZGVyQWxsTmF0aXZlID0gZmFicmljLlNsaWRlQ2FudmFzLnByb3RvdHlwZS5yZW5kZXJBbGw7XG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUsIHtcbiAgX3JlbmRlckFsbE5hdGl2ZTogX3JlbmRlckFsbE5hdGl2ZSxcbiAgX29uUmVzaXplTmF0aXZlOiBfb25SZXNpemVfb3ZlcndyaXR0ZW4sXG5cbiAgc2V0SW1hZ2VTbW9vdGhpbmdFbmFibGVkOiBmdW5jdGlvbih2YWx1ZSl7XG4gICAgdGhpcy5pbWFnZVNtb290aGluZ0VuYWJsZWQgPSB2YWx1ZTtcbiAgICB0aGlzLl9zZXRJbWFnZVNtb290aGluZygpO1xuICB9LFxuICAvKipcbiAgICogQHByaXZhdGVcbiAgICogQHNlZSB7QGxpbmsgaHR0cDovL3d3dy53aGF0d2cub3JnL3NwZWNzL3dlYi1hcHBzL2N1cnJlbnQtd29yay9tdWx0aXBhZ2UvdGhlLWNhbnZhcy1lbGVtZW50Lmh0bWwjZG9tLWNvbnRleHQtMmQtaW1hZ2VzbW9vdGhpbmdlbmFibGVkfFdoYXRXRyBDYW52YXMgU3RhbmRhcmR9XG4gICAqL1xuICBfc2V0SW1hZ2VTbW9vdGhpbmc6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBjdHggPSB0aGlzLmdldENvbnRleHQoKTtcblxuICAgIC8vIGN0eC5pbWFnZVNtb290aGluZ0VuYWJsZWQgPSBjdHguaW1hZ2VTbW9vdGhpbmdFbmFibGVkIHx8IGN0eC53ZWJraXRJbWFnZVNtb290aGluZ0VuYWJsZWRcbiAgICAvLyAgIHx8IGN0eC5tb3pJbWFnZVNtb290aGluZ0VuYWJsZWQgfHwgY3R4Lm1zSW1hZ2VTbW9vdGhpbmdFbmFibGVkIHx8IGN0eC5vSW1hZ2VTbW9vdGhpbmdFbmFibGVkO1xuICAgIGN0eC5pbWFnZVNtb290aGluZ0VuYWJsZWQgPSB0aGlzLmltYWdlU21vb3RoaW5nRW5hYmxlZDtcblxuICAgIGlmKHRoaXMubGF5ZXJzICYmIHRoaXMubGF5ZXJzLmJhY2tncm91bmQpe1xuICAgICAgdGhpcy5sYXllcnMuYmFja2dyb3VuZC5jb250ZXh0LmltYWdlU21vb3RoaW5nRW5hYmxlZCA9IHRoaXMuaW1hZ2VTbW9vdGhpbmdFbmFibGVkO1xuICAgIH1cbiAgfSxcblxuICBfb25SZXNpemU6IGZ1bmN0aW9uKCl7XG4gICAgdGhpcy5fb25SZXNpemVOYXRpdmUoKTtcbiAgICBpZih0aGlzLm9uUmVzaXplKXtcbiAgICAgIHRoaXMub25SZXNpemUoKTtcbiAgICB9XG4gICAgdGhpcy5maXJlKFwicmVzaXplXCIpO1xuICB9LFxuICBjcmVhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmNyZWF0ZWQgPSB0cnVlO1xuICAgIHRoaXMuX2luaXRJbnRlcmFjdGl2ZSgpO1xuICAgIHRoaXMuX2NyZWF0ZUNhY2hlQ2FudmFzKCk7XG4gICAgdGhpcy5pbml0TGF5ZXJzKCk7XG4gIH0sXG4gIGNyZWF0ZUxheWVyOiBmdW5jdGlvbih6aW5kZXgpe1xuICAgIHZhciBfY2FudmFzRWxlbWVudCA9IGZhYnJpYy51dGlsLmNyZWF0ZUNhbnZhc0VsZW1lbnRXaXRoU2l6ZSh0aGlzKTtcbiAgICBfY2FudmFzRWxlbWVudC5zdHlsZS5sZWZ0ID0gMDtcbiAgICBfY2FudmFzRWxlbWVudC5zdHlsZS50b3AgPSAwO1xuICAgIF9jYW52YXNFbGVtZW50LnN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJztcbiAgICB2YXIgX2N0eCA9IF9jYW52YXNFbGVtZW50LmdldENvbnRleHQoJzJkJyk7XG4gICAgX2N0eC5pbWFnZVNtb290aGluZ0VuYWJsZWQgPSB0aGlzLmltYWdlU21vb3RoaW5nRW5hYmxlZDtcblxuXG4gICAgdmFyIGxheWVyQWZ0ZXIgPSBudWxsO1xuICAgIGZvcih2YXIgaSBpbiB0aGlzLmxheWVycyl7XG5cbiAgICAgIGlmKHRoaXMubGF5ZXJzW2ldLnppbmRleCA+IHppbmRleCAmJiAhbGF5ZXJBZnRlciB8fCBsYXllckFmdGVyLnppbmRleCA+IHRoaXMubGF5ZXJzW2ldLnppbmRleCl7XG4gICAgICAgIGxheWVyQWZ0ZXIgID0gdGhpcy5sYXllcnNbaV07XG4gICAgICB9XG4gICAgfVxuICAgIGlmKHRoaXMud3JhcHBlckVsKXtcbiAgICAgIGlmKGxheWVyQWZ0ZXIpe1xuICAgICAgICB0aGlzLndyYXBwZXJFbC5pbnNlcnRCZWZvcmUoX2NhbnZhc0VsZW1lbnQsbGF5ZXJBZnRlci5jYW52YXMpO1xuICAgICAgfWVsc2V7XG4gICAgICAgIHRoaXMud3JhcHBlckVsLmFwcGVuZENoaWxkKF9jYW52YXNFbGVtZW50KTtcbiAgICAgIH1cbiAgICB9XG5cblxuICAgIHJldHVybiB7XG4gICAgICB0cmFuc2Zvcm06IHRydWUsXG4gICAgICBjYW52YXM6IF9jYW52YXNFbGVtZW50LFxuICAgICAgY29udGV4dDogX2N0eCxcbiAgICAgIG9iamVjdHM6IFtdXG4gICAgfVxuICB9LFxuICBsYXllcnNPcmRlcjogW1wiYmFja2dyb3VuZFwiLFwib2JqZWN0c1wiLFwic2VsZWN0aW9uXCIsXCJjb250cm9sc1wiLFwiaW50ZXJhY3Rpb25cIixcImludGVyZmFjZVwiXSxcbiAgaW5pdExheWVyczogZnVuY3Rpb24oKXtcblxuICAgIHRoaXMubGF5ZXJzID0ge1xuICAgICAgbG93ZXI6IHtcbiAgICAgICAgemluZGV4OiA1LFxuICAgICAgICB0cmFuc2Zvcm06IHRydWUsXG4gICAgICAgIG9iamVjdHM6IHRoaXMuX29iamVjdHMsXG4gICAgICAgIGNhbnZhczogdGhpcy5sb3dlckNhbnZhc0VsLFxuICAgICAgICBjb250ZXh0OiB0aGlzLmNvbnRleHRDb250YWluZXJcbiAgICAgIH1cbiAgICAgIC8vIHNlbGVjdGlvbjogdGhpcy5jcmVhdGVMYXllcigpLFxuICAgICAgLy8gaW50ZXJhY3Rpb246IHRoaXMuY3JlYXRlTGF5ZXIoKSxcbiAgICAgIC8vIG92ZXJsYTogdGhpcy5jcmVhdGVMYXllcigpLFxuXG4gICAgfTtcblxuICAgIHRoaXMubGF5ZXJzLmJhY2tncm91bmQgPSB0aGlzLmNyZWF0ZUxheWVyKDApO1xuXG5cblxuICAgIGlmKHRoaXMudXBwZXJDYW52YXNFbCl7XG4gICAgICB0aGlzLndyYXBwZXJFbC5hcHBlbmRDaGlsZCh0aGlzLnVwcGVyQ2FudmFzRWwpO1xuICAgIH1cbiAgICB2YXIgbGF5ZXJzID0gdGhpcy5sYXllcnM7XG4gICAgdGhpcy5sYXllcnNPcmRlciA9IHRoaXMubGF5ZXJzT3JkZXIubWFwKGZ1bmN0aW9uKGkpe1xuICAgICAgcmV0dXJuIGxheWVyc1tpXTtcbiAgICB9KTtcblxuICAgIHRoaXMub24oXCJyZXNpemVcIixmdW5jdGlvbigpe1xuICAgICAgZm9yKHZhciBpIGluIHRoaXMuX2JhY2tncm91bmRMYXllcil7XG4gICAgICAgIHRoaXMuX2JhY2tncm91bmRMYXllcltpXS5zZXRDb29yZHMoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSxcbiAgLyoqXG4gICAqIEhlbHBlciBmb3Igc2V0dGluZyB3aWR0aC9oZWlnaHRcbiAgICogQHByaXZhdGVcbiAgICogQHBhcmFtIHtTdHJpbmd9IHByb3AgcHJvcGVydHkgKHdpZHRofGhlaWdodClcbiAgICogQHBhcmFtIHtOdW1iZXJ9IHZhbHVlIHZhbHVlIHRvIHNldCBwcm9wZXJ0eSB0b1xuICAgKiBAcmV0dXJuIHtmYWJyaWMuQ2FudmFzfSBpbnN0YW5jZVxuICAgKiBAY2hhaW5hYmxlIHRydWVcbiAgICovXG4gIF9zZXRCYWNrc3RvcmVEaW1lbnNpb246IGZ1bmN0aW9uIChwcm9wLCB2YWx1ZSkge1xuXG4gICAgZm9yKHZhciBpIGluIHRoaXMubGF5ZXJzKXtcbiAgICAgIHRoaXMubGF5ZXJzW2ldLmNhbnZhc1twcm9wXSA9IHZhbHVlO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmNhY2hlQ2FudmFzRWwpIHtcbiAgICAgIHRoaXMuY2FjaGVDYW52YXNFbFtwcm9wXSA9IHZhbHVlO1xuICAgIH1cblxuICAgIHRoaXNbcHJvcF0gPSB2YWx1ZTtcblxuICAgIHJldHVybiB0aGlzO1xuICB9LFxuXG4gIC8qKlxuICAgKiBIZWxwZXIgZm9yIHNldHRpbmcgY3NzIHdpZHRoL2hlaWdodFxuICAgKiBAcHJpdmF0ZVxuICAgKiBAcGFyYW0ge1N0cmluZ30gcHJvcCBwcm9wZXJ0eSAod2lkdGh8aGVpZ2h0KVxuICAgKiBAcGFyYW0ge1N0cmluZ30gdmFsdWUgdmFsdWUgdG8gc2V0IHByb3BlcnR5IHRvXG4gICAqIEByZXR1cm4ge2ZhYnJpYy5DYW52YXN9IGluc3RhbmNlXG4gICAqIEBjaGFpbmFibGUgdHJ1ZVxuICAgKi9cbiAgX3NldENzc0RpbWVuc2lvbjogZnVuY3Rpb24gKHByb3AsIHZhbHVlKSB7XG5cbiAgICBmb3IodmFyIGkgaW4gdGhpcy5sYXllcnMpe1xuICAgICAgdGhpcy5sYXllcnNbaV0uY2FudmFzLnN0eWxlW3Byb3BdID0gdmFsdWU7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMud3JhcHBlckVsKSB7XG4gICAgICB0aGlzLndyYXBwZXJFbC5zdHlsZVtwcm9wXSA9IHZhbHVlO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzO1xuICB9LFxuICBzZXREaW1lbnNpb25zOiBmdW5jdGlvbiAoZGltZW5zaW9ucywgb3B0aW9ucykge1xuICAgIF9zZXRfZGltZW5zaW9uc19vdmVyd3JpdHRlbi5jYWxsKHRoaXMsIGRpbWVuc2lvbnMsIG9wdGlvbnMpO1xuXG4gICAgaWYodGhpcy5iYWNrZ3JvdW5kSW1hZ2UgJiYgdGhpcy5iYWNrZ3JvdW5kSW1hZ2UuY29uc3RydWN0b3IgIT09IFN0cmluZyl7XG4gICAgICB0aGlzLl91cGRhdGVfYmFja2dyb3VuZF9pbWFnZSgpO1xuICAgIH1cbiAgICAvL3RoaXMuX3VwZGF0ZV9jbGlwX3JlY3QoKTtcbiAgICB0aGlzLmZpcmUoXCJkaW1lbnNpb25zOm1vZGlmaWVkXCIpO1xuICAgIHRoaXMucmVuZGVyQWxsKCk7XG4gIH0sXG4gIGFkZDogZnVuY3Rpb24gKC8qLCBpc05ld0VsZW1lbnQqLykge1xuICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBhcmd1bWVudHMubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciBvYmogPSBhcmd1bWVudHNbaV07XG4gICAgICBmYWJyaWMudXRpbC5vYmplY3QuZGVmYXVsdHMob2JqLCBmYWJyaWMuU2xpZGVPYmplY3QpO1xuXG4gICAgICBpZihvYmoubGF5ZXIpIHtcbiAgICAgICAgdmFyIF9sYXllciA9IHRoaXMubGF5ZXJzW29iai5sYXllcl07XG4gICAgICAgIGlmKCFfbGF5ZXIpe1xuICAgICAgICAgIF9sYXllciA9IHRoaXMubGF5ZXJzW29iai5sYXllcl0gPSB0aGlzLmNyZWF0ZUxheWVyKCk7XG4gICAgICAgIH1cbiAgICAgICAgX2xheWVyLm9iamVjdHMucHVzaChvYmopXG4gICAgICB9ZWxzZXtcbiAgICAgICAgdGhpcy5fb2JqZWN0cy5wdXNoKG9iaik7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5fb25PYmplY3RBZGRlZCkge1xuICAgICAgICB0aGlzLl9vbk9iamVjdEFkZGVkKG9iaik7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy90b2RvXG4gICAgLy8gaWYoaXNOZXdFbGVtZW50KXtcbiAgICAvLyAgIHRoaXMuYWRkQWxlbWVudEluVGhlTWlkZGxlKGVsKTtcbiAgICAvLyAgIHRoaXMuc2V0QWN0aXZlT2JqZWN0KGVsKTtcbiAgICAvLyB9XG5cbiAgICB0aGlzLnJlbmRlck9uQWRkUmVtb3ZlICYmIHRoaXMucmVuZGVyQWxsKCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG4gIHJlbW92ZTogZnVuY3Rpb24gKCkge1xuICAgIHZhciBfb2JqZWN0cyA9IHRoaXMuZ2V0T2JqZWN0cygpLFxuICAgICAgaW5kZXg7XG4gICAgdmFyIG9iamVjdHM7XG4gICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgaWYgKGFyZ3VtZW50c1tpXS5sYXllcikge1xuICAgICAgICBvYmplY3RzID0gYXJndW1lbnRzW2ldLmxheWVyO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgb2JqZWN0cyA9IF9vYmplY3RzO1xuICAgICAgfVxuXG4gICAgICBpbmRleCA9IG9iamVjdHMuaW5kZXhPZihhcmd1bWVudHNbaV0pO1xuICAgICAgLy8gb25seSBjYWxsIG9uT2JqZWN0UmVtb3ZlZCBpZiBhbiBvYmplY3Qgd2FzIGFjdHVhbGx5IHJlbW92ZWRcbiAgICAgIGlmIChpbmRleCAhPT0gLTEpIHtcbiAgICAgICAgb2JqZWN0cy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICB0aGlzLl9vbk9iamVjdFJlbW92ZWQoYXJndW1lbnRzW2ldKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLnJlbmRlck9uQWRkUmVtb3ZlICYmIHRoaXMucmVuZGVyQWxsKCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG4gIHJlbmRlckxheWVyOiBmdW5jdGlvbiAobGF5ZXIpIHtcbiAgICBsYXllciA9IHRoaXMubGF5ZXJzW2xheWVyXTtcbiAgICBpZih0aGlzLnByb2Nlc3NpbmcpcmV0dXJuIGZhbHNlO1xuICAgIHZhciBjdHggPSBsYXllci5jb250ZXh0O1xuICAgIGN0eC5zYXZlKCk7XG4gICAgdGhpcy5jbGVhckNvbnRleHQoY3R4KTtcbiAgICB0aGlzLmNsaXBUbyAmJiBmYWJyaWMudXRpbC5jbGlwQ29udGV4dCh0aGlzLCBjdHgpO1xuICAgIGxheWVyLnRyYW5zZm9ybSAmJiAgY3R4LnRyYW5zZm9ybS5hcHBseShjdHgsIHRoaXMudmlld3BvcnRUcmFuc2Zvcm0pO1xuICAgIHRoaXMuX3JlbmRlck9iamVjdHMobGF5ZXIuY29udGV4dCxsYXllci5vYmplY3RzKTtcbiAgICBjdHgucmVzdG9yZSgpO1xuICB9LFxuICByZW5kZXJBbGw6IGZ1bmN0aW9uICgpIHtcbiAgICBpZih0aGlzLnByb2Nlc3NpbmcpcmV0dXJuIGZhbHNlO1xuICAgIGlmICghdGhpcy52aXJ0dWFsICYmIHRoaXMuc2VsZWN0aW9uICYmICF0aGlzLl9ncm91cFNlbGVjdG9yICYmICF0aGlzLmlzRHJhd2luZ01vZGUpIHtcbiAgICAgIHRoaXMuY2xlYXJDb250ZXh0KHRoaXMuY29udGV4dFRvcCk7XG4gICAgfVxuXG4gICAgdGhpcy5maXJlKCdiZWZvcmU6cmVuZGVyJyk7XG5cbiAgICBmb3IodmFyIGkgaW4gdGhpcy5sYXllcnMpe1xuICAgICAgdmFyIGN0eCA9IHRoaXMubGF5ZXJzW2ldLmNvbnRleHQ7XG4gICAgICB0aGlzLmNsZWFyQ29udGV4dChjdHgpO1xuICAgICAgY3R4LnNhdmUoKTtcbiAgICAgIGlmICh0aGlzLmNsaXBUbykge1xuICAgICAgICBmYWJyaWMudXRpbC5jbGlwQ29udGV4dCh0aGlzLCBjdHgpO1xuICAgICAgfVxuICAgICAgaWYodGhpcy5sYXllcnNbaV0udHJhbnNmb3JtKXtcbiAgICAgICAgY3R4LnRyYW5zZm9ybS5hcHBseShjdHgsIHRoaXMudmlld3BvcnRUcmFuc2Zvcm0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMuX3JlbmRlckJhY2tncm91bmQodGhpcy5sYXllcnMuYmFja2dyb3VuZC5jb250ZXh0KTtcblxuXG4gICAgdGhpcy5sYXllcnMubG93ZXIuX29iamVjdHMgPSB0aGlzLmxheWVycy5sb3dlci5vYmplY3RzO1xuICAgIHRoaXMubGF5ZXJzLmxvd2VyLm9iamVjdHMgPSB0aGlzLl9jaG9vc2VPYmplY3RzVG9SZW5kZXIoKTtcblxuICAgIGZvcih2YXIgaSBpbiB0aGlzLmxheWVycyl7XG4gICAgICB0aGlzLl9yZW5kZXJPYmplY3RzKHRoaXMubGF5ZXJzW2ldLmNvbnRleHQsdGhpcy5sYXllcnNbaV0ub2JqZWN0cyk7XG4gICAgfVxuICAgIHRoaXMubGF5ZXJzLmxvd2VyLm9iamVjdHMgPSB0aGlzLmxheWVycy5sb3dlci5fb2JqZWN0cztcblxuICAgIHRoaXMuZmlyZSgncmVuZGVyJyk7XG5cbiAgICBpZighdGhpcy52aXJ0dWFsKXtcbiAgICAgIGlmICghdGhpcy5jb250cm9sc0Fib3ZlT3ZlcmxheSAmJiB0aGlzLmludGVyYWN0aXZlICkge1xuICAgICAgICB0aGlzLmRyYXdDb250cm9scyh0aGlzLmxheWVycy51cHBlci5jb250ZXh0KTtcbiAgICAgIH1cbiAgICAgIHRoaXMuX3JlbmRlck92ZXJsYXkodGhpcy5sYXllcnMudXBwZXIuY29udGV4dCk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuY29udHJvbHNBYm92ZU92ZXJsYXkgJiYgdGhpcy5pbnRlcmFjdGl2ZSAmJiAhdGhpcy5faXNDdXJyZW50bHlEcmF3aW5nICkge1xuXG4gICAgICBpZih0aGlzLmJvcmRlck9wYWNpdHlXaGVuTW92aW5nIHx8ICF0aGlzLmlzTW92aW5nKXtcbiAgICAgICAgdGhpcy5kcmF3Q29udHJvbHModGhpcy5sYXllcnMudXBwZXIuY29udGV4dCk7XG4gICAgICB9XG4gICAgfVxuXG5cbiAgICBmb3IodmFyIGkgaW4gdGhpcy5sYXllcnMpIHtcbiAgICAgIHZhciBjdHggPSB0aGlzLmxheWVyc1tpXS5jb250ZXh0O1xuICAgICAgY3R4LnJlc3RvcmUoKTtcbiAgICB9XG5cbiAgICB0aGlzLmZpcmUoJ2FmdGVyOnJlbmRlcicpO1xuICB9LFxuICBfcmVuZGVyQmFja2dyb3VuZDogZnVuY3Rpb24oY3R4KSB7XG4gICAgdGhpcy5fcmVuZGVyQmFja2dyb3VuZE9yT3ZlcmxheShjdHgsICdiYWNrZ3JvdW5kJyk7XG4gIH0sXG4gIF9yZW5kZXJPdmVybGF5OiBmdW5jdGlvbihjdHgpIHtcbiAgICB0aGlzLl9yZW5kZXJCYWNrZ3JvdW5kT3JPdmVybGF5KGN0eCwgJ292ZXJsYXknKTtcblxuICAgIC8vIGlmICh0aGlzLl9pbnRlcmZhY2VMYXllcikge1xuICAgIC8vICAgdGhpcy5fcmVuZGVyT2JqZWN0cyhjdHgsIHRoaXMuX2ludGVyZmFjZUxheWVyKTtcbiAgICAvLyB9XG4gIH0sXG4gIHN0b3JlUHJvcGVydGllczogZmFicmljLk9iamVjdC5wcm90b3R5cGUuc3RvcmVQcm9wZXJ0aWVzLmNvbmNhdChbXCJsYXllclwiXSlcbn0pO1xuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9tb2R1bGVzL2xheWVycy5qc1xuLy8gbW9kdWxlIGlkID0gNzNcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiJ3VzZSBzdHJpY3QnO1xuXG5mYWJyaWMub2JqZWN0c0xpYnJhcnkgPSB7XG4gIHRleHQ6IHtcbiAgICB0aXRsZTogXCJUZXh0XCIsXG4gICAgdHlwZTogXCJpLXRleHRcIixcbiAgICB0ZXh0OiBcItCi0LXQutGB0YJcIlxuICB9LFxuICBsaW5lOiB7XG4gICAgdHlwZTogXCJsaW5lXCIsXG4gICAgc3Ryb2tlV2lkdGg6IDUsXG4gICAgc3Ryb2tlOiBcImJsYWNrXCIsXG4gICAgc2NhbGVYOiAxLFxuICAgIHNjYWxlWTogMSxcbiAgICB4MTogMCxcbiAgICB4MjogMTAwLFxuICAgIHkxOiAwLFxuICAgIHkyOiA1MFxuICB9LFxuICB0cmlhbmdsZToge1xuICAgIHR5cGU6IFwidHJpYW5nbGVcIixcbiAgICB3aWR0aDogZnVuY3Rpb24odyxoKXsgcmV0dXJuIE1hdGgubWluKHcsaCkgLSA0fSxcbiAgICBoZWlnaHQ6IGZ1bmN0aW9uKHcsaCl7IHJldHVybiBNYXRoLm1pbih3LGgpIC0gNH1cbiAgfSxcbiAgcmVjdGFuZ2xlOiB7XG4gICAgdHlwZTogXCJyZWN0XCIsXG4gICAgd2lkdGg6IGZ1bmN0aW9uKHcsaCl7IHJldHVybiBNYXRoLm1pbih3LGgpIC0gNH0sXG4gICAgaGVpZ2h0OiBmdW5jdGlvbih3LGgpeyByZXR1cm4gTWF0aC5taW4odyxoKSAtIDR9XG4gIH0sXG4gIHBvbHlnb246IHtcbiAgICBzY2FsZVg6IDEsXG4gICAgc2NhbGVZOiAxLFxuICAgIHR5cGU6IFwicG9seWdvblwiLFxuICAgIHBvaW50czogZnVuY3Rpb24odyxoKSB7XG4gICAgICByZXR1cm4gW1xuICAgICAgICB7eDogMjUsIHk6IDF9LFxuICAgICAgICB7eDogMzEsIHk6IDE4fSxcbiAgICAgICAge3g6IDQ5LCB5OiAxOH0sXG4gICAgICAgIHt4OiAzNSwgeTogMjl9LFxuICAgICAgICB7eDogNDAsIHk6IDQ2fSxcbiAgICAgICAge3g6IDI1LCB5OiAzNn0sXG4gICAgICAgIHt4OiAxMCwgeTogNDZ9LFxuICAgICAgICB7eDogMTUsIHk6IDI5fSxcbiAgICAgICAge3g6ICAxLCB5OiAxOH0sXG4gICAgICAgIHt4OiAxOSwgeTogMTh9XG4gICAgICBdO1xuICAgIH1cbiAgfSxcbiAgcGF0aDoge1xuICAgIFwidHlwZVwiOiBcInBhdGhcIixcbiAgICBcInBhdGhcIjogIFwibTU4MS4wNzc5NDIsMi41MzczNTljLTIuMDUzMjIzLDAuMDQ3MDcxIC00LjA0MDcxLDAuMTg4MzQ4IC02LjEwODA5MywwLjM1MjkwN2MtMzMuMDU1NDIsMi42NjM5MTggLTYyLjIzNTkwMSwxOS42NDA1NDEgLTc3LjA1NzY3OCw0NC45MjU5NTNsLTcuODU3MywxOS4xMzUzMTljMS42OTg4MjIsLTYuNjMzMTQ0IDQuMzAyOTc5LC0xMy4wNjUzODQgNy44NTczLC0xOS4xMzUzMTljLTI2LjQzMDY5NSwtMjIuMTYyOTMgLTYzLjUzMTY3NywtMzIuMzg4NDQ1IC0xMDAuMTkyMzgzLC0yNy41NzQzNzNjLTM2LjY2MTQ2OSw0Ljc4ODM1MyAtNjguNTAzMDgyLDI0LjA0MTc1OCAtODUuOTAxOTc4LDUxLjkzNTIyNWMtNDkuMTE2NDg2LC0yNC40OTAwMTMgLTExMC4zNDI4OCwtMjIuOTk5NDU0IC0xNTcuNzExODA3LDMuODYwMDkyYy00Ny4zNjkxNjQsMjYuODYwNjggLTcyLjYxNjczLDc0LjQwNTUxIC02NC45NDExNjIsMTIyLjM4MzA4bDUuMDIxMzU1LDE5LjQ5OTY4Yy0yLjI2MzMyOSwtNi4zODUwMSAtMy45NjA3OTMsLTEyLjg4NzY5NSAtNS4wMjEzNTUsLTE5LjQ5OTY4bC0wLjc2MTk0OCwxLjc5ODU2OWMtNDEuMTc5MTY1LDMuNjI1MjQ0IC03NC45NDUzNzUsMjkuNDY1MTM0IC04My43MTYzOTgsNjQuMDU5MjM1Yy04Ljc3MTgwNSwzNC41OTc3NDggOS40NjcwMSw3MC4wODU4NzYgNDUuMTg1NjIxLDg3Ljk2NzAxbDU1Ljc3NjU1OCwxMC45NzMxMTRjLTE5LjQ4MDIxNywxLjI5MTk2MiAtMzguOTE1NTQzLC0yLjUzNDUxNSAtNTUuNzc2NTU4LC0xMC45NzMxMTRjLTI3LjU0NzgsMjQuOTY4MTcgLTMzLjg4ODUxNiw2MS45MzUzMDMgLTE1LjcxNDkyLDkyLjQ2NzgzNGMxOC4xNzM3MzMsMzAuNTI0NzE5IDU2Ljk4ODg5OSw0OC4xMTA2ODcgOTcuMDMwNDU3LDQ0LjExNzM0bDI0LjMzOTcyMiwtNS4yMTEwOWMtNy44Mjc0OTksMi42NTE2MTEgLTE1Ljk2MDk4Myw0LjM3OTA1OSAtMjQuMzM5NzIyLDUuMjExMDljMjIuNzMwMDQyLDMzLjg1NzI2OSA2MC40MjgxOTIsNTguNTU2MjQ0IDEwNC42Njg5Myw2OC4zODM1MTRjNDQuMjQ5MSw5LjgxMzY2IDkxLjI0MDk1Miw0LjAxNDc3MSAxMzAuNDI1OTQ5LC0xNi4wOTQ2MDRjMzEuOTY3MDEsNDAuNzkzODIzIDg4LjcwNzY0Miw2Mi4yMTc0NjggMTQ1LjU5NjMxMyw1NC45OTcwN2M1Ni45MDI0NjYsLTcuMjE5NjY2IDEwMy44MzM5ODQsLTQxLjgxNDI3IDEyMC41MDEzNDMsLTg4Ljc3MDk5Nmw1Ljc4MTQzMywtMjYuMjM5NTMyYy0wLjg2MzcwOCw4LjkwOTU0NiAtMi43NDIyNDksMTcuNjgxMzY2IC01Ljc4MTQzMywyNi4yMzk1MzJjMzkuMTMzMzAxLDIwLjc1MzY2MiA4OC4zNTMzMzMsMjEuOTI3MzA3IDEyOC43ODUwOTUsMy4wNDkzMTZjNDAuNDM5ODE5LC0xOC44NzQwODQgNjUuNjY1NzcxLC01NC44NjkwNDkgNjYuMDM2MTMzLC05NC4wNzgyNDdsLTE0LjQ5NTYwNSwtNTguNTgwNTk3bC01Ny4xMDU3MTMsLTM5LjYzMDc2OGM0NC4xNjM0NTIsMjIuMzc0NTczIDcxLjk5MjYxNSw1Ni40NjcyNTUgNzEuNjAxMzE4LDk4LjIxMTM2NWM1Mi40OTcwNywwLjQ0ODE4MSA5Ny4xMDMzOTQsLTM1Ljk1NjU3MyAxMTcuMTEyNDI3LC03Ny43MjYyODhjMjAuMDExNTk3LC00MS43Njk4MzYgMTIuNDQzNjA0LC04OS4zOTY3NTkgLTE5Ljg2NDkyOSwtMTI1LjE2NDY0MmMxMy40MDExODQsLTI2LjYzNzY5NSAxMi42MDk5ODUsLTU2LjkzNzMzMiAtMi4xODM0NzIsLTgzLjAzNDA4OGMtMTQuNzg2MTk0LC0yNi4wOTc4OTMgLTQyLjA2NTQ5MSwtNDUuNDc2ODkxIC03NC44NzMwNDcsLTUzLjA5ODMzNWMtNy4zNDE0MzEsLTM0LjU4MDkyOSAtMzcuNjAyNjYxLC02Mi40MDQ0ODIgLTc3LjYwMDcwOCwtNzEuNTI2MjkzYy0zOS45OTg0NzQsLTkuMTIxMzY4IC04Mi41ODQ4MzksMi4xMjM5OTIgLTEwOS4zNjQ4MDcsMjguOTI2MTIzbC0xNi4yNTgxNzksMjIuMTk4MTdjNC4xNTc5NTksLTguMDE4NjEyIDkuNTgzOTIzLC0xNS40OTUyMTMgMTYuMjU4MTc5LC0yMi4xOTgxN2MtMTguODc2OTUzLC0yMS4wNjA3MTMgLTQ4LjQ4NjAyMywtMzIuOTU0MDYxIC03OS4zNDg5MzgsLTMyLjE1NTQwMWwwLDB6XCIsXG4gICAgXCJ3aWR0aFwiOiBmdW5jdGlvbih3LGgpe3JldHVybiB3IC0gNCB9LFxuICAgIFwiaGVpZ2h0XCI6IGZ1bmN0aW9uKHcsaCl7cmV0dXJuIGggLSA0fVxuICB9LFxuICBlbGxpcHNlOiB7XG4gICAgXCJ0eXBlXCI6IFwiZWxsaXBzZVwiLFxuICAgIFwicnhcIjogZnVuY3Rpb24odyxoKXtyZXR1cm4gdyAvMiAtIDR9LFxuICAgIFwicnlcIjogZnVuY3Rpb24odyxoKXtyZXR1cm4gaC8gMiAtIDR9XG4gIH0sXG4gIGNpcmNsZToge1xuICAgIHR5cGU6IFwiY2lyY2xlXCIsXG4gICAgcmFkaXVzOiBmdW5jdGlvbih3LGgpeyByZXR1cm4gTWF0aC5taW4odyxoKS8yIC0gNH1cbiAgfVxufTtcblxuZmFicmljLmdldE9iamVjdHNMaXN0ID0gZnVuY3Rpb24odyxoKXtcbiAgdmFyIF9saWIgPSBbXTtcbiAgZm9yKHZhciBpIGluIHRoaXMub2JqZWN0c0xpYnJhcnkpe1xuICAgIHZhciBvID0gX2xpYltpXSA9IGZhYnJpYy51dGlsLm9iamVjdC5jbG9uZURlZXAodGhpcy5vYmplY3RzTGlicmFyeVtpXSk7XG4gICAgby50aXRsZSA9IG8udGl0bGUgfHwgby50eXBlO1xuICAgIGlmKG8ud2lkdGggPT09IDAgKSBvLndpZHRoID0gdztcbiAgICBpZihvLmhlaWdodCA9PT0gMCApIG8uaGVpZ2h0ID0gaDtcbiAgICBmb3IodmFyIGogaW4gbyl7XG4gICAgICBpZihvW2pdLmNvbnN0cnVjdG9yID09IEZ1bmN0aW9uKXtcbiAgICAgICAgb1tqXSA9IG9bal0uY2FsbChvLHcsaCk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJldHVybiBfbGliO1xufTtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vbW9kdWxlcy9saWJyYXJ5LmpzXG4vLyBtb2R1bGUgaWQgPSA3NFxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCJcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuQXBwbGljYXRpb24ucHJvdG90eXBlLCB7XG4gIC8vIGxvYWRlclRlbXBsYXRlOiBcIjxzcGFuIGNsYXNzPSdmYSBmYS1wdWxzZSBmYS1zcGlubmVyIGNhbnZhcy1sb2FkLXNwaW5uZXInPjwvc3Bhbj5cIixcbiAgbG9hZGVySWNvbjogICAnZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCwnICsgcmVxdWlyZSgnYmFzZTY0LWxvYWRlciEuLy4uL21lZGlhL2xvYWRlci5zdmcnKSxcbiAgbG9hZGVyQ29udGFpbmVyOiBudWxsLFxuICBfc2hvd01haW5Mb2FkZXJJbmRpY2F0b3I6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmxvYWRlckVsLnNob3coKTtcbiAgICB0aGlzLmxvYWRlckNvbnRhaW5lci5hZGRDbGFzcyhcInByb2Nlc3NpbmdcIik7XG4gIH0sXG4gIF9oaWRlTWFpbkxvYWRlckluZGljYXRvcjogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMubG9hZGVyRWwuaGlkZSgpO1xuICAgIHRoaXMubG9hZGVyQ29udGFpbmVyLnJlbW92ZUNsYXNzKFwicHJvY2Vzc2luZ1wiKTtcbiAgfSxcbiAgc2V0TG9hZGVyVGVtcGxhdGU6IGZ1bmN0aW9uICh2YWwpIHtcbiAgICBpZih0aGlzLnZpcnR1YWwpIHJldHVybiBmYWxzZTtcbiAgICB0aGlzLmxvYWRlclRlbXBsYXRlID0gdmFsLnJlcGxhY2UoXCJ7bG9hZGVySWNvbn1cIix0aGlzLmxvYWRlckljb24pO1xuICAgIGlmKHZhbCkge1xuICAgICAgdGhpcy5sb2FkZXJDb250YWluZXIgPSAkKHRoaXMubG9hZGVyQ29udGFpbmVyKTtcbiAgICAgIHRoaXMubG9hZGVyRWwgPSAkKHRoaXMubG9hZGVyVGVtcGxhdGUpLmhpZGUoKTtcbiAgICAgIHRoaXMubG9hZGVyQ29udGFpbmVyLmFwcGVuZCh0aGlzLmxvYWRlckVsKTtcbiAgICAgIC8vIHRoaXMub24oXCJsb2FkaW5nOmJlZ2luXCIsIHRoaXMuX3Nob3dNYWluTG9hZGVySW5kaWNhdG9yKTtcbiAgICAgIC8vIHRoaXMub24oXCJsb2FkaW5nOmVuZFwiLCB0aGlzLl9oaWRlTWFpbkxvYWRlckluZGljYXRvcik7XG5cblxuICAgICAgdGhpcy5vbihcInByb2plY3Q6Y2hhbmdlZFwiLGZ1bmN0aW9uKCl7XG4gICAgICAgIHRoaXMucHJvamVjdC5vbihcInNsaWRlOmNoYW5nZTpiZWdpblwiLCB0aGlzLl9zaG93TWFpbkxvYWRlckluZGljYXRvci5iaW5kKHRoaXMpKTtcbiAgICAgICAgdGhpcy5wcm9qZWN0Lm9uKFwic2xpZGU6Y2hhbmdlZFwiLCB0aGlzLl9oaWRlTWFpbkxvYWRlckluZGljYXRvci5iaW5kKHRoaXMpKTtcbiAgICAgIH0pXG5cbiAgICB9XG4gIH1cbn0pO1xuXG5cbi8vIGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLlNsaWRlQ2FudmFzLnByb3RvdHlwZSwge1xuLy8gICAvLyBsb2FkZXJUZW1wbGF0ZTogXCI8c3BhbiBjbGFzcz0nZmEgZmEtcHVsc2UgZmEtc3Bpbm5lciBjYW52YXMtbG9hZC1zcGlubmVyJz48L3NwYW4+XCIsXG4vLyAgIHNldExvYWRlclRlbXBsYXRlOiBmdW5jdGlvbiAodmFsKSB7XG4vLyAgICAgaWYodGhpcy52aXJ0dWFsKSByZXR1cm4gZmFsc2U7XG4vLyAgICAgdGhpcy5sb2FkZXJUZW1wbGF0ZSA9IHZhbDtcbi8vICAgICBpZih2YWwpIHtcbi8vICAgICAgIHRoaXMubG9hZGVyRWwgPSAkKHRoaXMubG9hZGVyVGVtcGxhdGUpLmhpZGUoKTtcbi8vICAgICAgICQodGhpcy53cmFwcGVyRWwpLmFwcGVuZCh0aGlzLmxvYWRlckVsKTtcbi8vICAgICAgIHRoaXMub24oXCJsb2FkaW5nOmJlZ2luXCIsIGZ1bmN0aW9uICgpIHtcbi8vICAgICAgICAgdGhpcy5sb2FkZXJFbC5zaG93KCk7XG4vLyAgICAgICAgICQodGhpcy53cmFwcGVyRWwpLmFkZENsYXNzKFwicHJvY2Vzc2luZ1wiKTtcbi8vICAgICAgIH0pO1xuLy8gICAgICAgdGhpcy5vbihcImxvYWRpbmc6ZW5kXCIsIGZ1bmN0aW9uICgpIHtcbi8vICAgICAgICAgdGhpcy5sb2FkZXJFbC5oaWRlKCk7XG4vLyAgICAgICAgICQodGhpcy53cmFwcGVyRWwpLnJlbW92ZUNsYXNzKFwicHJvY2Vzc2luZ1wiKTtcbi8vICAgICAgIH0pO1xuLy8gICAgIH1cbi8vICAgfVxuLy8gfSk7XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL21vZHVsZXMvbG9hZGVyLmpzXG4vLyBtb2R1bGUgaWQgPSA3NVxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCIndXNlIHN0cmljdCc7XG5cblxuXG4vLyB0b2RvINGN0YLQviDRg9Cx0YDQsNGC0YxcbmZhYnJpYy5tb3ZlbWVudHNMaW1pdHNFYXN5ID0gZmFsc2U7XG52YXIgX3RvT2JqZWN0X292ZXJ3cml0dGVuID0gZmFicmljLk9iamVjdC5wcm90b3R5cGUudG9PYmplY3Q7XG4vL3RvZG8gdXNlIGV2ZW50IFwiYmVmb3JlOm9iamVjdFwiO1xuZmFicmljLk9iamVjdC5wcm90b3R5cGUudG9PYmplY3QgPSBmdW5jdGlvbiAocHJvcGVydGllc1RvSW5jbHVkZSkge1xuICB2YXIgb2JqID0gX3RvT2JqZWN0X292ZXJ3cml0dGVuLmNhbGwodGhpcyxwcm9wZXJ0aWVzVG9JbmNsdWRlKTtcbiAgdmFyIF9zdG9yZUFsbCA9IHRoaXMuc3RvcmVQcm9wZXJ0aWVzLmluZGV4T2YoXCIqXCIpICE9IC0xO1xuICBpZiAodGhpcy5jbGlwVG8gJiYgdGhpcy5jbGlwVG8uaWQgJiYgKF9zdG9yZUFsbCB8fCB0aGlzLnN0b3JlUHJvcGVydGllcy5pbmRleE9mKFwiY2xpcFRvXCIpICE9IC0xKSkge1xuICAgIG9iai5jbGlwVG8gPSAnIycgKyB0aGlzLmNsaXBUby5pZFxuICB9XG4gIGlmICggdGhpcy5tb3ZlbWVudExpbWl0cyAmJiAgKF9zdG9yZUFsbCB8fCB0aGlzLnN0b3JlUHJvcGVydGllcy5pbmRleE9mKFwibW92ZW1lbnRMaW1pdHNcIikgIT0gLTEpKSB7XG4gICAgb2JqLm1vdmVtZW50TGltaXRzID0gdGhpcy5tb3ZlbWVudExpbWl0cy5pZCA/ICcjJyArIHRoaXMubW92ZW1lbnRMaW1pdHMuaWQgOiB0aGlzLm1vdmVtZW50TGltaXRzO1xuICB9XG4gIHJldHVybiBvYmo7XG59O1xuXG52YXIgX3NjYWxlT2JqZWN0X292ZXJ3cml0dGVuID0gZmFicmljLkNhbnZhcy5wcm90b3R5cGUuX3NjYWxlT2JqZWN0O1xuXG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLk9iamVjdC5wcm90b3R5cGUsIHtcbiAgc2V0V2hvbGVDb29yZGluYXRlczogZnVuY3Rpb24odmFsKXtcbiAgICB0aGlzLndob2xlQ29vcmRpbmF0ZXMgPSB2YWw7XG4gICAgdGhpcy5vbihcImFkZGVkIG1vZGlmaWVkXCIsZnVuY3Rpb24oKXtcbiAgICAgIGlmKHRoaXMud2hvbGVDb29yZGluYXRlcyl7XG4gICAgICAgIHRoaXMuc2V0KHtcbiAgICAgICAgICBsZWZ0OiBNYXRoLnJvdW5kKHRoaXMubGVmdCksXG4gICAgICAgICAgdG9wOiBNYXRoLnJvdW5kKHRoaXMudG9wKSxcbiAgICAgICAgICB3aWR0aDogTWF0aC5yb3VuZCh0aGlzLndpZHRoKSxcbiAgICAgICAgICBoZWlnaHQ6IE1hdGgucm91bmQodGhpcy5oZWlnaHQpXG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgfSx0cnVlKVxuICB9LFxuICAvLyBzZXRUb3A6IGZ1bmN0aW9uKHZhbCl7XG4gIC8vICAgaWYodGhpcy53aG9sZUNvb3JkaW5hdGVzKXtcbiAgLy8gICAgIHZhbCA9IE1hdGgucm91bmQodmFsKTtcbiAgLy8gICB9XG4gIC8vICAgdGhpcy50b3AgPSB2YWw7XG4gIC8vIH0sXG4gIC8vIHNldExlZnQ6IGZ1bmN0aW9uKHZhbCl7XG4gIC8vICAgaWYodGhpcy53aG9sZUNvb3JkaW5hdGVzKXtcbiAgLy8gICAgIHZhbCA9IE1hdGgucm91bmQodmFsKTtcbiAgLy8gICB9XG4gIC8vICAgdGhpcy5sZWZ0ID0gdmFsO1xuICAvLyB9LFxuICAvLyBzZXRXaWR0aDogZnVuY3Rpb24odyl7XG4gIC8vICAgaWYodGhpcy53aG9sZUNvb3JkaW5hdGVzKXtcbiAgLy8gICAgIHcgPSBNYXRoLnJvdW5kKHcpO1xuICAvLyAgIH1cbiAgLy8gICB0aGlzLndpZHRoID0gdztcbiAgLy8gfSxcbiAgLy8gc2V0SGVpZ2h0OiBmdW5jdGlvbihoKXtcbiAgLy8gICBpZih0aGlzLndob2xlQ29vcmRpbmF0ZXMpe1xuICAvLyAgICAgaCA9IE1hdGgucm91bmQoaCk7XG4gIC8vICAgfVxuICAvLyAgIHRoaXMuaGVpZ2h0ID0gaDtcbiAgLy8gfSxcbiAgLy8gc3BlY2lhbFByb3BlcnRpZXM6IGZhYnJpYy5PYmplY3QucHJvdG90eXBlLnNwZWNpYWxQcm9wZXJ0aWVzLmNvbmNhdChbXCJtb3ZlbWVudExpbWl0c1wiXSksXG4gIF9zZXRNb3ZlbWVudExpbWl0c1N0cmluZzogZnVuY3Rpb24gKCkge1xuICAgIHZhciB2YWwgPSB0aGlzLm1vdmVtZW50TGltaXRzO1xuICAgIGlmICh2YWwgJiYgdmFsLmNvbnN0cnVjdG9yID09PSBTdHJpbmcpIHtcbiAgICAgIHZhciB2YWwgPSB0aGlzLm1vdmVtZW50TGltaXRzO1xuICAgICAgaWYgKHZhbCA9PSAnY2FudmFzJykge1xuXG4gICAgICAgIHZhbCA9IHRoaXMuY2FudmFzO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIF9pZCA9IHRoaXMubW92ZW1lbnRMaW1pdHMuc3Vic3RyaW5nKDEpO1xuICAgICAgICB2YWwgPSB0aGlzLmNhbnZhcy5nZXRPYmplY3RCeUlEKF9pZCk7XG4gICAgICB9XG4gICAgICB0aGlzLm1vdmVtZW50TGltaXRzID0gdmFsO1xuICAgIH1cbiAgICB0aGlzLmNhbnZhcy5fY2hlY2tfb2JqZWN0X3Bvc2l0aW9uKHRoaXMpO1xuICAgIC8vIHRoaXMuY2FudmFzLl9jaGVja19vYmplY3RfcG9zaXRpb24odGhpcyk7XG4gICAgLy8gdGhpcy5zZXRDb29yZHMoKTtcblxuICB9LFxuICBzZXRNb3ZlbWVudExpbWl0czogZnVuY3Rpb24gKHZhbCkge1xuXG5cbiAgICBpZighdGhpcy5tb3ZlbWVudExpbWl0cyl7XG4gICAgICB0aGlzLm9uKHtcbiAgICAgICAgYWRkZWQ6IHRoaXMuX3NldE1vdmVtZW50TGltaXRzU3RyaW5nLFxuICAgICAgICByb3RhdGVkOiBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICB2YXIgdGFyZ2V0ID0gdGhpcztcblxuICAgICAgICAgIGlmICh0YXJnZXQucmVzaXphYmxlKSB7XG4gICAgICAgICAgICBpZiAocG9zLmxlZnQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICBpZiAodGFyZ2V0LmxlZnQgPCBwb3MubGVmdCkge1xuICAgICAgICAgICAgICAgIHRhcmdldC53aWR0aCArPSB0YXJnZXQubGVmdCAtIHBvcy5sZWZ0O1xuICAgICAgICAgICAgICAgIHRhcmdldC5sZWZ0ID0gcG9zLmxlZnQ7XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGFyZ2V0LndpZHRoIC09IHRhcmdldC5sZWZ0IC0gcG9zLmxlZnQ7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChwb3MudG9wICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgaWYgKHRhcmdldC50b3AgPCBwb3MudG9wKSB7XG4gICAgICAgICAgICAgICAgdGFyZ2V0LmhlaWdodCArPSB0YXJnZXQudG9wIC0gcG9zLnRvcDtcbiAgICAgICAgICAgICAgICB0YXJnZXQudG9wID0gcG9zLnRvcDtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0YXJnZXQuaGVpZ2h0IC09IHRhcmdldC50b3AgLSBwb3MudG9wO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIHRoaXMuY2FudmFzLl9jaGVja19vYmplY3RfcG9zaXRpb24odGhpcylcbiAgICAgICAgfSxcbiAgICAgICAgbW9kaWZpZWQ6IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgIHRoaXMuY2FudmFzLl9jaGVja19vYmplY3RfYWZ0ZXJfbW9kaWZpZWQodGhpcylcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICAgIHRoaXMubW92ZW1lbnRMaW1pdHMgPSB2YWw7XG5cbiAgICBpZih0aGlzLmNhbnZhcyl7XG4gICAgICB0aGlzLl9zZXRNb3ZlbWVudExpbWl0c1N0cmluZygpO1xuICAgIH1cblxuICB9XG59KTtcblxudmFyIF90cmFuc2xhdGVPYmplY3Rfb3ZlcndyaXR0ZW4gPSBmYWJyaWMuQ2FudmFzLnByb3RvdHlwZS5fdHJhbnNsYXRlT2JqZWN0O1xudmFyIF9iZWZvcmVTY2FsZVRyYW5zZm9ybV9vdmVyd3JpdHRlbiA9IGZhYnJpYy5DYW52YXMucHJvdG90eXBlLl9iZWZvcmVTY2FsZVRyYW5zZm9ybTtcbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLlNsaWRlQ2FudmFzLnByb3RvdHlwZSwge1xuICBzcGVjaWFsUHJvcGVydGllczogZmFicmljLlNsaWRlQ2FudmFzLnByb3RvdHlwZS5zcGVjaWFsUHJvcGVydGllcy5jb25jYXQoW1wibW92ZW1lbnRMaW1pdHNcIl0pLFxuICBfYmVmb3JlU2NhbGVUcmFuc2Zvcm1fb3ZlcndyaXR0ZW46IF9iZWZvcmVTY2FsZVRyYW5zZm9ybV9vdmVyd3JpdHRlbixcbiAgX2JlZm9yZVNjYWxlVHJhbnNmb3JtOiBmdW5jdGlvbiAoZSwgdHJhbnNmb3JtKSB7XG4gICAgdGhpcy5fYmVmb3JlU2NhbGVUcmFuc2Zvcm1fb3ZlcndyaXR0ZW4oZSwgdHJhbnNmb3JtKTtcbiAgICBpZiAoIXRoaXMuX2N1cnJlbnRUcmFuc2Zvcm0ub3JpZ2luYWwub0Nvb3Jkcykge1xuICAgICAgdGhpcy5fY3VycmVudFRyYW5zZm9ybS5vcmlnaW5hbC5vQ29vcmRzID0gZmFicmljLnV0aWwub2JqZWN0LmNsb25lRGVlcCh0aGlzLl9jdXJyZW50VHJhbnNmb3JtLnRhcmdldC5vQ29vcmRzKTtcbiAgICB9XG4gIH0sXG4gIC8vZml4IGdldGNlbnRlciBmdW5jdGlvblxuICBjZW50ZXJPYmplY3Q6IGZ1bmN0aW9uIChvYmplY3QpIHtcbiAgICB2YXIgY2VudGVyO1xuICAgIGlmIChvYmplY3QubW92ZW1lbnRMaW1pdHMpIHtcbiAgICAgIHZhciBfeHkgPSBvYmplY3QubW92ZW1lbnRMaW1pdHMuZ2V0Q2VudGVyUG9pbnQoKTtcbiAgICAgIGNlbnRlciA9IHt0b3A6IF94eS55LCBsZWZ0OiBfeHkueH07XG4gICAgfSBlbHNlIHtcbiAgICAgIGNlbnRlciA9IHRoaXMuZ2V0Q2VudGVyKCk7XG4gICAgfVxuICAgIHRoaXMuX2NlbnRlck9iamVjdChvYmplY3QsIG5ldyBmYWJyaWMuUG9pbnQoY2VudGVyLmxlZnQsIGNlbnRlci50b3ApKTtcbiAgICB0aGlzLnJlbmRlckFsbCgpO1xuICAgIHJldHVybiB0aGlzO1xuICB9LFxuICBnZXRDZW50ZXI6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4ge1xuICAgICAgdG9wOiB0aGlzLm9yaWdpbmFsSGVpZ2h0IC8gMiAvIHRoaXMuZ2V0Wm9vbSgpLFxuICAgICAgbGVmdDogdGhpcy5vcmlnaW5hbFdpZHRoIC8gMiAvIHRoaXMuZ2V0Wm9vbSgpXG4gICAgfTtcbiAgfSxcbiAgc2V0TW92ZW1lbnRMaW1pdHM6IGZ1bmN0aW9uIChfb2Zmc2V0cykge1xuICAgIHRoaXMubW92ZW1lbnRMaW1pdHMgPSBfb2Zmc2V0cztcblxuICAgIHJldHVybiB0aGlzO1xuICB9LFxuICBtb3ZlbWVudExpbWl0czoge1xuICAgIGxlZnQ6IGZhbHNlLFxuICAgIHRvcDogZmFsc2UsXG4gICAgcmlnaHQ6IGZhbHNlLFxuICAgIGJvdHRvbTogZmFsc2VcbiAgfSxcbiAgLy9jb250ZW50INGF0L7RgtGPINCx0YsgINC/0LjQutGB0LXQu9GMINC+0LHRitC10LrRgtCwINC00L7Qu9C20LXQvSDQsdGL0YLRjCDQstC90YPRgtGA0Lgg0LfQvtC90YtcbiAgLy9maXQg0LfQvtC90LAg0LTQvtC70LbQvdC+INC/0L7Qu9C90L7RgdGC0YzRjiDQvdCw0YXQvtC00LjRgtGB0Y8g0LLQvdGD0YLRgNC4INC+0LHRitC10LrRgtCwXG4gIG1vdmVtZW50TGltaXRNb2RlOiBcImZpdFwiLFxuICBnZXRGaXhlZFBvc2l0aW9uRWFzeTogZnVuY3Rpb24gKHRhcmdldCwgeCwgeSkge1xuICAgIHZhciBfdyA9IHRoaXMub3JpZ2luYWxXaWR0aCB8fCB0aGlzLndpZHRoO1xuICAgIHZhciBfaCA9IHRoaXMub3JpZ2luYWxIZWlnaHQgfHwgdGhpcy5oZWlnaHQ7XG5cbiAgICBpZiAoeCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICB4ID0gdGFyZ2V0LmxlZnQ7XG4gICAgfVxuICAgIGlmICh5ID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHkgPSB0YXJnZXQudG9wO1xuICAgIH1cbiAgICB2YXIgc2NhbGUgPSB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzBdO1xuICAgIHRhcmdldC5zZXRDb29yZHMoKTtcbiAgICB0YXJnZXQucmlnaHQgPSBfdyAtICh0YXJnZXQubGVmdCArIHRhcmdldC53aWR0aCk7XG4gICAgdGFyZ2V0LmJvdHRvbSA9IF9oIC0gKHRhcmdldC50b3AgKyB0YXJnZXQuaGVpZ2h0KTtcblxuICAgIHZhciBfZGlmZiwgX2FzcCwgcmVjdDtcbiAgICB2YXIgbmV3UG9zID0ge1xuICAgICAgbGVmdDogeCxcbiAgICAgIHRvcDogeSxcbiAgICAgIHdpZHRoOiB0YXJnZXQud2lkdGgsXG4gICAgICBoZWlnaHQ6IHRhcmdldC5oZWlnaHRcbiAgICB9XG5cbiAgICBpZiAodGFyZ2V0LndpZHRoID4gX3cpIHtcbiAgICAgIG5ld1Bvcy53aWR0aCA9IF93O1xuICAgIH1cbiAgICBpZiAodGFyZ2V0LmhlaWdodCA+IF9oKSB7XG4gICAgICBuZXdQb3MuaGVpZ2h0ID0gX2g7XG4gICAgfVxuICAgIGlmICh0YXJnZXQubGVmdCA8IDApIHtcbiAgICAgIG5ld1Bvcy53aWR0aCArPSB0YXJnZXQubGVmdDtcbiAgICAgIG5ld1Bvcy5sZWZ0IC09IHRhcmdldC5sZWZ0O1xuICAgIH1cbiAgICBpZiAodGFyZ2V0LnJpZ2h0IDwgMCkge1xuICAgICAgbmV3UG9zLndpZHRoICs9IHRhcmdldC5yaWdodDtcbiAgICB9XG4gICAgaWYgKHRhcmdldC50b3AgPCAwKSB7XG4gICAgICBuZXdQb3MuaGVpZ2h0ICs9IHRhcmdldC50b3A7XG4gICAgfVxuICAgIGlmICh0YXJnZXQuYm90dG9tIDwgMCkge1xuICAgICAgbmV3UG9zLmhlaWdodCArPSB0YXJnZXQuYm90dG9tO1xuICAgIH1cbiAgICByZXR1cm4gbmV3UG9zO1xuICB9LFxuICBnZXRNb3ZlbWVudHNMaW1pdHNSZWN0OiBmdW5jdGlvbih0YXJnZXQpe1xuXG4gICAgdmFyIF93ID0gdGhpcy5vcmlnaW5hbFdpZHRoIHx8IHRoaXMud2lkdGg7XG4gICAgdmFyIF9oID0gdGhpcy5vcmlnaW5hbEhlaWdodCB8fCB0aGlzLmhlaWdodDtcblxuICAgIGlmICh0YXJnZXQubW92ZW1lbnRMaW1pdHMgPT0gdGhpcykge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbGVmdDogMCxcbiAgICAgICAgdG9wOiAwLFxuICAgICAgICB3aWR0aDogX3csXG4gICAgICAgIGhlaWdodDogX2gsXG4gICAgICAgIHJpZ2h0OiAwLFxuICAgICAgICBib3R0b206IDBcbiAgICAgIH1cbiAgICB9ZWxzZXtcbiAgICAgIHZhciBfc3Ryb2tlX3dpZHRoID0gdGFyZ2V0Lm1vdmVtZW50TGltaXRzLnN0cm9rZVdpZHRoO1xuICAgICAgdGFyZ2V0Lm1vdmVtZW50TGltaXRzLnN0cm9rZVdpZHRoID0gMDtcblxuICAgICAgdGFyZ2V0Lm1vdmVtZW50TGltaXRzLnNldENvb3JkcygpO1xuICAgICAgdmFyIHJlY3QgPSB0YXJnZXQubW92ZW1lbnRMaW1pdHMuZ2V0Qm91bmRpbmdSZWN0KCk7XG5cbiAgICAgIHRhcmdldC5tb3ZlbWVudExpbWl0cy5zdHJva2VXaWR0aCA9IF9zdHJva2Vfd2lkdGg7XG4gICAgICByZXR1cm4gcmVjdDtcbiAgICB9XG4gIH0sXG4gIGNvbnRlbnRPZmZzZXRzIDogNSxcbiAgZ2V0Rml4ZWRQb3NpdGlvbjogZnVuY3Rpb24gKHRhcmdldCwgeCwgeSkge1xuXG5cbiAgICB2YXIgX3cgPSB0aGlzLm9yaWdpbmFsV2lkdGggfHwgdGhpcy53aWR0aDtcbiAgICB2YXIgX2ggPSB0aGlzLm9yaWdpbmFsSGVpZ2h0IHx8IHRoaXMuaGVpZ2h0O1xuXG5cbiAgICBpZiAoeCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICB4ID0gdGFyZ2V0LmxlZnQ7XG4gICAgfVxuICAgIGlmICh5ID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHkgPSB0YXJnZXQudG9wO1xuICAgIH1cbiAgICB2YXIgc2NhbGUgPSB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzBdO1xuICAgIHRhcmdldC5zZXRDb29yZHMoKTtcbiAgICB2YXIgYm91bmRzID0gdGFyZ2V0LmdldEJvdW5kaW5nUmVjdCgpO1xuICAgIGJvdW5kcy5sZWZ0IC89IHNjYWxlO1xuICAgIGJvdW5kcy50b3AgLz0gc2NhbGU7XG4gICAgYm91bmRzLndpZHRoIC89IHNjYWxlO1xuICAgIGJvdW5kcy5oZWlnaHQgLz0gc2NhbGU7XG5cbiAgICBib3VuZHMubGVmdCAtPSB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzRdIC8gc2NhbGU7XG4gICAgYm91bmRzLnRvcCAtPSB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzVdIC8gc2NhbGU7XG4gICAgYm91bmRzLnJpZ2h0ID0gX3cgLSAoYm91bmRzLmxlZnQgKyBib3VuZHMud2lkdGgpO1xuICAgIGJvdW5kcy5ib3R0b20gPSBfaCAtIChib3VuZHMudG9wICsgYm91bmRzLmhlaWdodCk7XG5cblxuXG4gICAgaWYgKHRhcmdldC5tb3ZlbWVudExpbWl0cykge1xuICAgICAgdmFyIHJlY3QgPSB0aGlzLmdldE1vdmVtZW50c0xpbWl0c1JlY3QodGFyZ2V0KTtcblxuXG4gICAgICBpZiAodGFyZ2V0Lm1vdmVtZW50TGltaXRzID09IHRoaXMpIHtcblxuICAgICAgICByZWN0LndpZHRoICo9IHNjYWxlO1xuICAgICAgICByZWN0LmhlaWdodCAqPSBzY2FsZTtcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKHRhcmdldC5tb3ZlbWVudExpbWl0cy5nZXRCb3VuZGluZ1JlY3QpIHtcblxuXG4gICAgICAgIC8vdmFyIHN3ID0gdGFyZ2V0Lm1vdmVtZW50TGltaXRzLnN0cm9rZVdpZHRoO1xuXG4gICAgICAgIHJlY3QubGVmdCAvPSBzY2FsZTtcbiAgICAgICAgcmVjdC50b3AgLz0gc2NhbGU7XG4gICAgICAgIHJlY3Qud2lkdGggLz0gc2NhbGU7XG4gICAgICAgIHJlY3QuaGVpZ2h0IC89IHNjYWxlO1xuICAgICAgICByZWN0LmxlZnQgLT0gdGhpcy52aWV3cG9ydFRyYW5zZm9ybVs0XSAvIHNjYWxlO1xuICAgICAgICByZWN0LnRvcCAtPSB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzVdIC8gc2NhbGU7XG5cbiAgICAgICAgLy9yZWN0LmxlZnQgICArPSBzdyAvMjtcbiAgICAgICAgLy9yZWN0LnRvcCAgICArPSBzdyAvMjtcbiAgICAgICAgLy9yZWN0LndpZHRoICAtPSBzdztcbiAgICAgICAgLy9yZWN0LmhlaWdodCAtPSBzdztcblxuICAgICAgICByZWN0LnJpZ2h0ID0gX3cgLSAocmVjdC5sZWZ0ICsgcmVjdC53aWR0aCk7XG4gICAgICAgIHJlY3QuYm90dG9tID0gX2ggLSAocmVjdC50b3AgKyByZWN0LmhlaWdodCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZWN0ID0gdGFyZ2V0Lm1vdmVtZW50TGltaXRzO1xuICAgICAgfVxuICAgIH1cblxuICAgIHZhciBsaW1pdHMgPSByZWN0IHx8IHRoaXMubW92ZW1lbnRMaW1pdHM7XG5cbiAgICB2YXIgbmV3UG9zID0ge307XG4gICAgdmFyIF9sID0gbGltaXRzLmxlZnQsIF9yID0gbGltaXRzLnJpZ2h0O1xuICAgIHZhciBfdCA9IGxpbWl0cy50b3AsIF9iID0gbGltaXRzLmJvdHRvbTtcblxuICAgIGlmICh0YXJnZXQubW92ZW1lbnRMaW1pdE1vZGUgPT0gXCJjb250ZW50XCIpIHtcbiAgICAgIF9sIC09IGJvdW5kcy53aWR0aCAtIHRoaXMuY29udGVudE9mZnNldHMsIF9yIC09IGJvdW5kcy53aWR0aCAtIHRoaXMuY29udGVudE9mZnNldHM7XG4gICAgICBfdCAtPSBib3VuZHMuaGVpZ2h0IC0gdGhpcy5jb250ZW50T2Zmc2V0cywgX2IgLT0gYm91bmRzLmhlaWdodCAtIHRoaXMuY29udGVudE9mZnNldHM7XG4gICAgfVxuXG4gICAgaWYgKHRhcmdldC5tb3ZlbWVudExpbWl0TW9kZSA9PSBcImZpdFwiICYmICF0YXJnZXQucmVzaXphYmxlKSB7XG4gICAgICBpZiAoX2wgIT09IGZhbHNlICYmIF9yICE9PSBmYWxzZSkge1xuICAgICAgICB2YXIgX3cgPSBfdyAtIF9sIC0gX3I7XG4gICAgICAgIGlmIChib3VuZHMud2lkdGggPiBfdykge1xuICAgICAgICAgIHZhciBfYXNwID0gX3cgLyBib3VuZHMud2lkdGg7XG4gICAgICAgICAgbmV3UG9zLnNjYWxlWCA9IF9hc3A7XG4gICAgICAgICAgbmV3UG9zLnNjYWxlWSA9IF9hc3A7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKF90ICE9PSBmYWxzZSAmJiBfYiAhPT0gZmFsc2UpIHtcbiAgICAgICAgdmFyIF9oID0gX2ggLSBfdCAtIF9iO1xuICAgICAgICBpZiAoYm91bmRzLmhlaWdodCA+IF9oKSB7XG4gICAgICAgICAgdmFyIF9hc3AgPSBfaCAvIGJvdW5kcy5oZWlnaHQ7XG4gICAgICAgICAgdGFyZ2V0LnNjYWxlWCAqPSBfYXNwO1xuICAgICAgICAgIHRhcmdldC5zY2FsZVkgKj0gX2FzcDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmICh0YXJnZXQubW92ZW1lbnRMaW1pdE1vZGUgPT0gXCJmaXRcIiB8fCB0YXJnZXQubW92ZW1lbnRMaW1pdE1vZGUgPT0gXCJjb250ZW50XCIpIHtcblxuICAgICAgaWYgKF9sICE9PSBmYWxzZSkge1xuICAgICAgICB2YXIgX2RpZmYgPSBfbCAtIGJvdW5kcy5sZWZ0O1xuICAgICAgICBpZiAoX2RpZmYgPiAwKSB7XG4gICAgICAgICAgbmV3UG9zLmxlZnQgPSB4ICsgX2RpZmY7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKCFuZXdQb3MubGVmdCAmJiBfciAhPT0gZmFsc2UpIHtcbiAgICAgICAgdmFyIF9kaWZmID0gX3IgLSBib3VuZHMucmlnaHQ7XG4gICAgICAgIGlmIChfZGlmZiA+IDApIHtcbiAgICAgICAgICBuZXdQb3MubGVmdCA9IHggLSBfZGlmZjtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAoX3QgIT09IGZhbHNlKSB7XG4gICAgICAgIHZhciBfZGlmZiA9IF90IC0gYm91bmRzLnRvcDtcbiAgICAgICAgaWYgKF9kaWZmID4gMCkge1xuICAgICAgICAgIG5ld1Bvcy50b3AgPSB5ICsgX2RpZmY7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKCFuZXdQb3MudG9wICYmIF9iICE9PSBmYWxzZSkge1xuICAgICAgICB2YXIgX2RpZmYgPSBfYiAtIGJvdW5kcy5ib3R0b207XG4gICAgICAgIGlmIChfZGlmZiA+IDApIHtcbiAgICAgICAgICBuZXdQb3MudG9wID0geSAtIF9kaWZmO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICB9XG5cbiAgICByZXR1cm4gbmV3UG9zO1xuICB9LFxuICAvKipcbiAgICog0YTRg9C90LrRhtC40Y4g0LzQvtC20L3QviDQstGL0LfQstCw0YLRjCDRgSDQtdCy0LXQvdGC0L7QvCAgJ2FmdGVyOnJlbmRlcicuINCf0L7Qt9Cy0L7Qu9GP0LXRgiDQvtGC0L7QsdGA0LDQttCw0YLRjCDQstGL0YfQuNGB0LvQtdC90LjRjyDQv9C10YDQtdGB0LXRh9C10L3QuNC5INC40LfQvNC10L3Rj9C10LzQvtCz0L4g0L7QsdGK0LXQutGC0LAg0YEg0YDQsNC80LrQvtC5LiDQstGL0LTQtdC70Y/QtdGCINC60YDQsNGB0L3Ri9C80Lgg0LvQuNC40L3QuNGP0LhcbiAgICogQHByaXZhdGVcbiAgICogQGV4YW1wbGVcbiAgICogIGV2ZW50TGlzdGVuZXJzIDoge1xuICAgIENhbnZhczoge1xuICAgICAgJ2JlZm9yZTpyZW5kZXInOiBmdW5jdGlvbigpe1xuICAgICAgICB0aGlzLmNsZWFyQ29udGV4dCh0aGlzLmNvbnRleHRUb3ApO1xuICAgICAgfSxcbiAgICAgICdhZnRlcjpyZW5kZXInOiBmdW5jdGlvbigpe1xuICAgICAgICB0aGlzLl9kZWJ1Z19pbnRlcnNlY3Rpb25zKClcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgICovXG4gIGRyYXdJbnRlcmVzdGlvbkxpbmVzOiBmdW5jdGlvbigpe1xuICAgIHZhciB0ciA9IHRoaXMuX2N1cnJlbnRUcmFuc2Zvcm07XG4gICAgaWYgKHRyICYmIHRyLl9pbnRlcnNlY3Rpb25zKSB7XG4gICAgICB2YXIgY3R4ID0gdGhpcy5jb250ZXh0VG9wO1xuICAgICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgICAgY3R4LnN0cm9rZVN0eWxlID0gXCJyZWRcIjtcbiAgICAgIGZvcih2YXIgaSBpbiB0ci5faW50ZXJzZWN0aW9ucyl7XG4gICAgICAgIHZhciBfY29vcmQgPSB0ci5faW50ZXJzZWN0aW9uc1tpXTtcbiAgICAgICAgY3R4Lm1vdmVUbyhfY29vcmQueCArIDUsIF9jb29yZC55KTtcbiAgICAgICAgY3R4LmFyYyhfY29vcmQueCwgX2Nvb3JkLnksIDUsIDAsIDIgKiBNYXRoLlBJKTtcbiAgICAgIH1cbiAgICAgIGZvcih2YXIgaSBpbiB0ci5saW5lcyl7XG4gICAgICAgIHZhciBfbCA9IHRyLmxpbmVzW2ldO1xuICAgICAgICBjdHgubW92ZVRvKF9sWzBdLngsX2xbMF0ueSk7XG4gICAgICAgIGN0eC5saW5lVG8oX2xbMV0ueCxfbFsxXS55KTtcbiAgICAgIH1cbiAgICAgIGZvcih2YXIgaSBpbiB0ci5tbExpbmVzKXtcbiAgICAgICAgdmFyIF9sID0gdHIubWxMaW5lc1tpXTtcbiAgICAgICAgY3R4Lm1vdmVUbyhfbFswXS54LF9sWzBdLnkpO1xuICAgICAgICBjdHgubGluZVRvKF9sWzFdLngsX2xbMV0ueSk7XG4gICAgICB9XG4gICAgICBjdHguc3Ryb2tlKCk7XG4gICAgfVxuICB9LFxuICBfc2NhbGVPYmplY3RFYXN5OiBmdW5jdGlvbiAoeCwgeSwgYnkpIHtcbiAgICAvL19zY2FsZU9iamVjdF9vdmVyd3JpdHRlbi5jYWxsKHRoaXMsIHgsIHksIGJ5KTtcbiAgICB2YXIgdHIgPSB0aGlzLl9jdXJyZW50VHJhbnNmb3JtLFxuICAgICAgdGFyZ2V0ID0gdHIudGFyZ2V0LFxuICAgICAgY29ybmVyID0gdHIuY29ybmVyO1xuICAgIGlmKCF0YXJnZXQubW92ZW1lbnRMaW1pdHMpe1xuICAgICAgcmV0dXJuIF9zY2FsZU9iamVjdF9vdmVyd3JpdHRlbi5jYWxsKHRoaXMsIHgseSwgYnkpO1xuICAgIH1cblxuXG4gICAgaWYgKHRhcmdldC5tb3ZlbWVudExpbWl0TW9kZSAhPT0gJ2ZpdCcpcmV0dXJuO1xuICAgIHggPSBNYXRoLm1pbih0YXJnZXQubW92ZW1lbnRMaW1pdHMud2lkdGgsIE1hdGgubWF4KDAseCkpO1xuICAgIHkgPSBNYXRoLm1pbih0YXJnZXQubW92ZW1lbnRMaW1pdHMuaGVpZ2h0LCBNYXRoLm1heCgwLHkpKTtcbiAgICBfc2NhbGVPYmplY3Rfb3ZlcndyaXR0ZW4uY2FsbCh0aGlzLCB4LHksIGJ5KTtcbiAgfSxcbiAgLyoqXG4gICAqIFNjYWxlcyBvYmplY3QgYnkgaW52b2tpbmcgaXRzIHNjYWxlWC9zY2FsZVkgbWV0aG9kc1xuICAgKiBAcHJpdmF0ZVxuICAgKiBAcGFyYW0ge051bWJlcn0geCBwb2ludGVyJ3MgeCBjb29yZGluYXRlXG4gICAqIEBwYXJhbSB7TnVtYmVyfSB5IHBvaW50ZXIncyB5IGNvb3JkaW5hdGVcbiAgICogQHBhcmFtIHtTdHJpbmd9IGJ5IEVpdGhlciAneCcgb3IgJ3knIC0gc3BlY2lmaWVzIGRpbWVuc2lvbiBjb25zdHJhaW50IGJ5IHdoaWNoIHRvIHNjYWxlIGFuIG9iamVjdC5cbiAgICogICAgICAgICAgICAgICAgICAgIFdoZW4gbm90IHByb3ZpZGVkLCBhbiBvYmplY3QgaXMgc2NhbGVkIGJ5IGJvdGggZGltZW5zaW9ucyBlcXVhbGx5XG4gICAqL1xuICBfc2NhbGVPYmplY3Q6IGZ1bmN0aW9uICh4LCB5LCBieSkge1xuICAgIHZhciBfc2NhbGVkID0gX3NjYWxlT2JqZWN0X292ZXJ3cml0dGVuLmNhbGwodGhpcywgeCwgeSwgYnkpO1xuXG4gICAgdmFyIHRyID0gdGhpcy5fY3VycmVudFRyYW5zZm9ybSxcbiAgICAgIHRhcmdldCA9IHRyLnRhcmdldCxcbiAgICAgIGNvcm5lciA9IHRyLmNvcm5lcjtcbiAgICB2YXIgX3YgPSB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtO1xuXG4gICAgaWYgKCF0YXJnZXQubW92ZW1lbnRMaW1pdHMgfHwgdGFyZ2V0Lm1vdmVtZW50TGltaXRNb2RlICE9PSBcImZpdFwiKXtcbiAgICAgIHJldHVybiBfc2NhbGVkO1xuICAgIH1cbiAgICB0YXJnZXQuc2V0Q29vcmRzKCk7XG5cbiAgICB2YXIgX3NjYWxlID0gdGhpcy5nZXRab29tKCk7XG5cbiAgICBpZih0YXJnZXQubW92ZW1lbnRMaW1pdHMgPT0gdGhpcyl7XG4gICAgICB2YXIgX3cgPSB0aGlzLm9yaWdpbmFsV2lkdGggfHwgdGhpcy53aWR0aDtcbiAgICAgIHZhciBfaCA9IHRoaXMub3JpZ2luYWxIZWlnaHQgfHwgdGhpcy5oZWlnaHQ7XG4gICAgICB2YXIgX2wgPSB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzRdIDtcbiAgICAgIHZhciBfdCA9IHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bNV0gO1xuICAgICAgX3cgKj0gX3NjYWxlO1xuICAgICAgX2ggKj0gX3NjYWxlO1xuICAgICAgdmFyIF9yYyA9IHtcbiAgICAgICAgdGw6IHt4OiBfbCwgeTogX3R9LFxuICAgICAgICB0cjoge3g6IF9sICsgX3csIHk6IF90fSxcbiAgICAgICAgYmw6IHt4OiBfbCwgeTogX3QgKyBfaH0sXG4gICAgICAgIGJyOiB7eDogX2wgKyBfdywgeTogX3QgKyBfaH1cbiAgICAgIH1cbiAgICB9ZWxzZXtcbiAgICAgIHRhcmdldC5tb3ZlbWVudExpbWl0cy5zZXRDb29yZHMoKTtcbiAgICAgIHZhciBfcmMgPSB0YXJnZXQubW92ZW1lbnRMaW1pdHMub0Nvb3JkcztcbiAgICB9XG5cblxuICAgIGlmICghdHIucG9pbnRlck9mZnNldCkge1xuICAgICAgdHIucG9pbnRlck9mZnNldCA9IHtcbiAgICAgICAgeDogeCAqIF92WzBdIC0gdGFyZ2V0Lm9Db29yZHNbY29ybmVyXS54LFxuICAgICAgICB5OiB5ICogX3ZbM10gLSB0YXJnZXQub0Nvb3Jkc1tjb3JuZXJdLnlcbiAgICAgIH1cblxuICAgICAgdHIucG9pbnRDZW50ZXIgPSB0YXJnZXQuZ2V0Q2VudGVyUG9pbnQoKTtcbiAgICAgIHRyLnBvaW50Q2VudGVyLnggKj0gX3NjYWxlO1xuICAgICAgdHIucG9pbnRDZW50ZXIueSAqPSBfc2NhbGU7XG4gICAgICB0ci5wb2ludE9yaWdpbmFsID0gdHIub3JpZ2luYWwub0Nvb3Jkc1tjb3JuZXJdO1xuICAgIH1cblxuICAgIHRyLnBvaW50VHJhbmZvcm1lZCA9IHRhcmdldC5vQ29vcmRzW2Nvcm5lcl07XG5cbiAgICB0ci5tbExpbmVzID0gW107XG4gICAgdHIubGluZXMgPSBbXTtcbiAgICBmdW5jdGlvbiBfaW50ZXJzZWN0aW9uKGNvcm5lciwgY29vcmRpbmF0ZSkge1xuICAgICAgdmFyIF9vYztcbiAgICAgIGlmIChjb29yZGluYXRlID09IFwieFwiICYmIGNvcm5lclswXSAhPSBcIm1cIikge1xuICAgICAgICBfb2MgPSB0ci5vcmlnaW5hbC5vQ29vcmRzW1wibVwiICsgY29ybmVyWzBdXTtcbiAgICAgIH0gZWxzZSBpZiAoY29vcmRpbmF0ZSA9PSBcInlcIiAmJiBjb3JuZXJbMF0gIT0gXCJtXCIpIHtcbiAgICAgICAgX29jID0gdHIub3JpZ2luYWwub0Nvb3Jkc1tcIm1cIiArIGNvcm5lclsxXV07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBfb2MgPSB0ci5wb2ludENlbnRlcjtcbiAgICAgICAgX29jID0ge1xuICAgICAgICAgIHg6IF9vYy54ICsgX3ZbNF0sXG4gICAgICAgICAgeTogX29jLnkgKyBfdls1XVxuICAgICAgICB9O1xuICAgICAgfVxuICAgICAgdmFyIF90YyA9IHRhcmdldC5vQ29vcmRzW2Nvcm5lcl07XG5cbiAgICAgIHRyLmxpbmVzLnB1c2goW19vYywgX3RjXSk7XG4gICAgICB0ci5tbExpbmVzLnB1c2goW19yYy50bCwgX3JjLnRyXSk7XG4gICAgICB0ci5tbExpbmVzLnB1c2goW19yYy50ciwgX3JjLmJyXSk7XG4gICAgICB0ci5tbExpbmVzLnB1c2goW19yYy5iciwgX3JjLmJsXSk7XG4gICAgICB0ci5tbExpbmVzLnB1c2goW19yYy5ibCwgX3JjLnRsXSk7XG5cbiAgICAgIHZhciBpbnRlcnMgPSBmYWJyaWMuSW50ZXJzZWN0aW9uLmludGVyc2VjdExpbmVQb2x5Z29uKF9vYywgX3RjLCBbX3JjLnRsLCBfcmMudHIsIF9yYy5iciwgX3JjLmJsXSk7XG4gICAgICBpZiAoIWludGVycy5wb2ludHMubGVuZ3RoKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGludGVycy5wb2ludHNbMF0uY29vcmRpbmF0ZSA9IGNvb3JkaW5hdGU7XG4gICAgICB0ci5faW50ZXJzZWN0aW9ucy5wdXNoKGludGVycy5wb2ludHNbMF0pXG5cbi8vICAgICAgICAgaWYgKGNvb3JkaW5hdGUpIHtcbi8vICAgICAgICAgICB2YXIgcDEgPSBpbnRlcnMucG9pbnRzWzBdO1xuXG4vLyAgICAgICAgICAgdmFyIGNvcm5lcjI7XG4vLyAgICAgICAgICAgaWYgKGNvb3JkaW5hdGUgPT0gXCJ4XCIpIHtcbi8vICAgICAgICAgICAgIGNvcm5lcjIgPSAoY29ybmVyWzBdID09IFwidFwiID8gXCJiXCIgOiBcInRcIikgKyBjb3JuZXJbMV07XG4vLyAgICAgICAgICAgfSBlbHNlIHtcbi8vICAgICAgICAgICAgIGNvcm5lcjIgPSBjb3JuZXJbMF0gKyAoY29ybmVyWzFdID09IFwibFwiID8gXCJyXCIgOiBcImxcIik7XG4vLyAgICAgICAgICAgfVxuLy8gICAgICAgICAgIHZhciBfcDIgPSB0YXJnZXQub0Nvb3Jkc1tjb3JuZXIyXTtcbi8vICAgICAgICAgICB2YXIgX2RpZmYgPSB7eDogX3RjLnggLSBwMS54LCB5OiBfdGMueSAtIHAxLnl9O1xuXG4vLyAgICAgICAgICAgdmFyIHAyID0ge1xuLy8gICAgICAgICAgICAgeDogX3AyLnggLSBfZGlmZi54LFxuLy8gICAgICAgICAgICAgeTogX3AyLnkgLSBfZGlmZi55XG4vLyAgICAgICAgICAgfTtcblxuLy8gICAgICAgICAgIHZhciBpdHMgPSBmYWJyaWMuSW50ZXJzZWN0aW9uLmludGVyc2VjdExpbmVMaW5lKHRyLnBvaW50Q2VudGVyLCB0ci5wb2ludFRyYW5mb3JtZWQsIHAxLCBwMik7XG4vLyAgICAgICAgICAgaWYgKCFpdHMucG9pbnRzWzBdKSB7XG4vLyAgICAgICAgICAgICByZXR1cm47XG4vLyAgICAgICAgICAgfVxuLy8gICAgICAgICAgIHRyLl9pbnRlcnNlY3Rpb25zLnB1c2goaXRzLnBvaW50c1swXSk7XG4vLyAgICAgICAgIH0gZWxzZSB7XG4vLyAgICAgICAgICAgdHIuX2ludGVyc2VjdGlvbnMucHVzaChpbnRlcnMucG9pbnRzWzBdKTtcbi8vICAgICAgICAgfVxuXG5cbiAgICAgIC8vXG4gICAgICAvL2lmKGludGVycy5wb2ludHMubGVuZ3RoKXtcbiAgICAgIC8vICBfc2NhbGVPYmplY3Rfb3ZlcndyaXR0ZW4uY2FsbCh0aGlzLCBpbnRlcnMucG9pbnRzWzBdLngsICBpbnRlcnMucG9pbnRzWzBdLnksIGJ5KTtcbiAgICAgIC8vICB0YXJnZXQuc2V0Q29vcmRzKCk7XG4gICAgICAvL31lbHNle1xuICAgICAgLy8gIF9zY2FsZU9iamVjdF9vdmVyd3JpdHRlbi5jYWxsKHRoaXMsIHgsIHksIGJ5KTtcbiAgICAgIC8vfVxuICAgIH1cblxuXG4gICAgdHIuX2ludGVyc2VjdGlvbiA9IG51bGw7XG4gICAgdHIuX2ludGVyc2VjdGlvbnMgPSBbXTtcbiAgICBzd2l0Y2ggKGNvcm5lcikge1xuICAgICAgY2FzZSBcInRsXCI6XG4gICAgICAgIF9pbnRlcnNlY3Rpb24oXCJ0bFwiKTtcbiAgICAgICAgX2ludGVyc2VjdGlvbihcImJsXCIsIFwieFwiKTtcbiAgICAgICAgX2ludGVyc2VjdGlvbihcInRyXCIsIFwieVwiKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwidHJcIjpcbiAgICAgICAgX2ludGVyc2VjdGlvbihcInRyXCIpO1xuICAgICAgICBfaW50ZXJzZWN0aW9uKFwidGxcIiwgXCJ5XCIpO1xuICAgICAgICBfaW50ZXJzZWN0aW9uKFwiYnJcIiwgXCJ4XCIpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJiclwiOlxuICAgICAgICBfaW50ZXJzZWN0aW9uKFwiYnJcIik7XG4gICAgICAgIF9pbnRlcnNlY3Rpb24oXCJ0clwiLCBcInhcIik7XG4gICAgICAgIF9pbnRlcnNlY3Rpb24oXCJibFwiLCBcInlcIik7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcImJsXCI6XG4gICAgICAgIF9pbnRlcnNlY3Rpb24oXCJibFwiKTtcbiAgICAgICAgX2ludGVyc2VjdGlvbihcInRsXCIsIFwieFwiKTtcbiAgICAgICAgX2ludGVyc2VjdGlvbihcImJyXCIsIFwieVwiKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwibXRcIjpcbiAgICAgICAgX2ludGVyc2VjdGlvbihcIm10XCIpO1xuICAgICAgICBfaW50ZXJzZWN0aW9uKFwidGxcIiwgXCJ5XCIpO1xuICAgICAgICBfaW50ZXJzZWN0aW9uKFwidHJcIiwgXCJ5XCIpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJtYlwiOlxuICAgICAgICBfaW50ZXJzZWN0aW9uKFwibWJcIik7XG4gICAgICAgIF9pbnRlcnNlY3Rpb24oXCJibFwiLCBcInlcIik7XG4gICAgICAgIF9pbnRlcnNlY3Rpb24oXCJiclwiLCBcInlcIik7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcIm1yXCI6XG4gICAgICAgIF9pbnRlcnNlY3Rpb24oXCJtclwiKTtcbiAgICAgICAgX2ludGVyc2VjdGlvbihcInRyXCIsIFwieFwiKTtcbiAgICAgICAgX2ludGVyc2VjdGlvbihcImJyXCIsIFwieFwiKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwibWxcIjpcbiAgICAgICAgX2ludGVyc2VjdGlvbihcIm1sXCIpO1xuICAgICAgICBfaW50ZXJzZWN0aW9uKFwidGxcIiwgXCJ4XCIpO1xuICAgICAgICBfaW50ZXJzZWN0aW9uKFwiYmxcIiwgXCJ4XCIpO1xuICAgIH1cblxuICAgIGlmICghdHIuX2ludGVyc2VjdGlvbnMubGVuZ3RoKSB7XG4gICAgICByZXR1cm4gX3NjYWxlZDtcbiAgICB9XG5cblxuICAgIHZhciBfbmV3WFkgPSB0ci5faW50ZXJzZWN0aW9uc1swXTtcbiAgICB2YXIgX2wgPSB0ci5faW50ZXJzZWN0aW9uc1swXS5kaXN0YW5jZUZyb20odHIucG9pbnRPcmlnaW5hbCk7XG5cbiAgICBmb3IgKHZhciBpID0gMTsgaSA8IHRyLl9pbnRlcnNlY3Rpb25zLmxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgX2wyID0gdHIuX2ludGVyc2VjdGlvbnNbaV0uZGlzdGFuY2VGcm9tKHRyLnBvaW50T3JpZ2luYWwpO1xuICAgICAgaWYgKF9sMiA8IF9sKSB7XG4gICAgICAgIF9uZXdYWSA9IHRyLl9pbnRlcnNlY3Rpb25zW2ldO1xuICAgICAgICBfbCA9IF9sMjtcbiAgICAgIH1cbiAgICB9XG4gICAgdHIuX2ludGVyc2VjdGlvbiA9IF9uZXdYWTtcblxuXG4gICAgaWYgKGJ5ID09IFwiZXF1YWxseVwiKSB7XG4gICAgICAvL2J5ID0gZmFsc2U7XG5cbiAgICAgIHZhciBfZGlmZjIgPSB7eDogX25ld1hZLnggLSB0ci5wb2ludENlbnRlci54LCB5OiBfbmV3WFkueSAtIHRyLnBvaW50Q2VudGVyLnl9O1xuICAgICAgdmFyIF9sID0gTWF0aC5zcXJ0KF9kaWZmMi54ICogX2RpZmYyLnggKyBfZGlmZjIueSAqIF9kaWZmMi55KTtcblxuICAgICAgX25ld1hZLnggLT0gX2RpZmYyLnggLyBfbCAqIHRhcmdldC5zdHJva2VXaWR0aDtcbiAgICAgIF9uZXdYWS55IC09IF9kaWZmMi55IC8gX2wgKiB0YXJnZXQuc3Ryb2tlV2lkdGg7XG4gICAgICAvLyBzY3J0KHgqeCArIHkqeSkgPSBhdHJva2V3aWR0aFxuICAgICAgdmFyIGEgPSAxO1xuICAgIH1cbiAgICAvL3JldHVybiBfc2NhbGVPYmplY3Rfb3ZlcndyaXR0ZW4uY2FsbCh0aGlzLCB4LCB5LCBieSk7XG4gICAgdmFyIF9feCA9IChfbmV3WFkueCArIHRyLnBvaW50ZXJPZmZzZXQueCApIC8gX3ZbMF07XG4gICAgdmFyIF9feSA9IChfbmV3WFkueSArIHRyLnBvaW50ZXJPZmZzZXQueSApIC8gX3ZbM107XG4gICAgcmV0dXJuIF9zY2FsZU9iamVjdF9vdmVyd3JpdHRlbi5jYWxsKHRoaXMsIF9feCwgX195LCBieSk7XG5cbiAgICAvL1xuICAgIC8vaWYgKGNvcm5lciA9PSBcImJyXCIgfHwgY29ybmVyID09IFwidHJcIiB8fCBjb3JuZXIgPT0gXCJtclwiKSB7XG4gICAgLy8gIGlmICh4IDwgdGFyZ2V0Lm1vdmVtZW50WE1heExpbWl0KSB7XG4gICAgLy8gICAgeCA9IHRhcmdldC5tb3ZlbWVudFhNYXhMaW1pdDtcbiAgICAvLyAgfVxuICAgIC8vfVxuICAgIC8vaWYgKGNvcm5lciA9PSBcImJsXCIgfHwgY29ybmVyID09IFwidGxcIiB8fCBjb3JuZXIgPT0gXCJtbFwiKSB7XG4gICAgLy8gIGlmICh4ID4gdGFyZ2V0Lm1vdmVtZW50WE1pbkxpbWl0KSB7XG4gICAgLy8gICAgeCA9IHRhcmdldC5tb3ZlbWVudFhNaW5MaW1pdDtcbiAgICAvLyAgfVxuICAgIC8vfVxuICAgIC8vaWYgKGNvcm5lciA9PSBcImJsXCIgfHwgY29ybmVyID09IFwiYnJcIiB8fCBjb3JuZXIgPT0gXCJtYlwiKSB7XG4gICAgLy8gIGlmICh5IDwgdGFyZ2V0Lm1vdmVtZW50WU1heExpbWl0KSB7XG4gICAgLy8gICAgeSA9IHRhcmdldC5tb3ZlbWVudFlNYXhMaW1pdDtcbiAgICAvLyAgfVxuICAgIC8vfVxuICAgIC8vaWYgKGNvcm5lciA9PSBcInRsXCIgfHwgY29ybmVyID09IFwidHJcIiB8fCBjb3JuZXIgPT0gXCJtdFwiKSB7XG4gICAgLy8gIGlmICh5ID4gdGFyZ2V0Lm1vdmVtZW50WU1pbkxpbWl0KSB7XG4gICAgLy8gICAgeSA9IHRhcmdldC5tb3ZlbWVudFlNaW5MaW1pdDtcbiAgICAvLyAgfVxuICAgIC8vfVxuICAgIC8vXG4gICAgLy9fc2NhbGVPYmplY3Rfb3ZlcndyaXR0ZW4uY2FsbCh0aGlzLCB4LCB5LCBieSk7XG4gIH0sXG4gIG1vdmVtZW50TGltaXRzT25BZGRBY3Rpb246ICd0cmFuc2xhdGUnLFxuICBfY2hlY2tfb2JqZWN0X2FmdGVyX21vZGlmaWVkOiBmdW5jdGlvbiAodGFyZ2V0KSB7XG4gICAgaWYgKCF0aGlzLl9jdXJyZW50VHJhbnNmb3JtKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHZhciBwb3MgPSB0aGlzLmdldEZpeGVkUG9zaXRpb24odGFyZ2V0LCB0YXJnZXQubGVmdCwgdGFyZ2V0LnRvcCk7XG5cbiAgICBzd2l0Y2ggKHRoaXMuX2N1cnJlbnRUcmFuc2Zvcm0uY29ybmVyKSB7XG4gICAgICBjYXNlIFwibXRyXCI6XG4gICAgICAgIGlmIChwb3MubGVmdCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgdGFyZ2V0LnNldCgnbGVmdCcsIHBvcy5sZWZ0KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocG9zLnRvcCkge1xuICAgICAgICAgIHRhcmdldC5zZXQoJ3RvcCcsIHBvcy50b3ApO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcIm1yXCI6XG4gICAgICBjYXNlIFwiYnJcIjpcbiAgICAgICAgaWYgKHBvcy5sZWZ0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICB2YXIgX2xkaWZmID0gdGFyZ2V0LmxlZnQgLSBwb3MubGVmdDtcblxuICAgICAgICB9XG4gICAgICAgIGlmIChwb3MudG9wICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICB2YXIgX3RkaWZmID0gdGFyZ2V0LnRvcCAtIHBvcy50b3A7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoX2xkaWZmICYmICghX3RkaWZmIHx8IE1hdGguYWJzKF9sZGlmZikgPiBNYXRoLmFicyhfdGRpZmYpKSkge1xuICAgICAgICAgIGlmIChfbGRpZmYgPCAwKSB7XG4gICAgICAgICAgICB0YXJnZXQud2lkdGggKz0gX2xkaWZmO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0YXJnZXQud2lkdGggLT0gX2xkaWZmO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmIChfdGRpZmYpIHtcbiAgICAgICAgICBpZiAoX3RkaWZmIDwgMCkge1xuICAgICAgICAgICAgdGFyZ2V0LndpZHRoICs9IF90ZGlmZjtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGFyZ2V0LndpZHRoIC09IF90ZGlmZjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIC8vY29uc29sZS5sb2cocG9zLF9sZGlmZixfdGRpZmYpXG4gICAgfVxuICAgIC8vIHRoaXMuX2NoZWNrX29iamVjdF9wb3NpdGlvbih0YXJnZXQpXG4gIH0sXG4gIF9jaGVja19vYmplY3RfcG9zaXRpb246IGZ1bmN0aW9uICh0YXJnZXQpIHtcblxuICAgIHZhciBwb3MgPSB0aGlzLmdldEZpeGVkUG9zaXRpb24odGFyZ2V0LCB0YXJnZXQubGVmdCwgdGFyZ2V0LnRvcCk7XG4gICAgaWYgKHRoaXMubW92ZW1lbnRMaW1pdHNPbkFkZEFjdGlvbiA9PSAndHJhbnNsYXRlJykge1xuICAgICAgaWYgKHBvcy5sZWZ0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdGFyZ2V0LnNldCgnbGVmdCcsIHBvcy5sZWZ0KTtcbiAgICAgIH1cbiAgICAgIGlmIChwb3MudG9wICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdGFyZ2V0LnNldCgndG9wJywgcG9zLnRvcCk7XG4gICAgICB9XG4gICAgfWVsc2V7XG5cbiAgICAgIGlmIChwb3MubGVmdCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGlmICh0YXJnZXQubGVmdCA8IHBvcy5sZWZ0KSB7XG4gICAgICAgICAgdGFyZ2V0LndpZHRoICs9IHRhcmdldC5sZWZ0IC0gcG9zLmxlZnQ7XG4gICAgICAgICAgdGFyZ2V0LmxlZnQgPSBwb3MubGVmdDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0YXJnZXQud2lkdGggLT0gdGFyZ2V0LmxlZnQgLSBwb3MubGVmdDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKHBvcy50b3AgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBpZiAodGFyZ2V0LnRvcCA8IHBvcy50b3ApIHtcbiAgICAgICAgICB0YXJnZXQuaGVpZ2h0ICs9IHRhcmdldC50b3AgLSBwb3MudG9wO1xuICAgICAgICAgIHRhcmdldC50b3AgPSBwb3MudG9wO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRhcmdldC5oZWlnaHQgLT0gdGFyZ2V0LnRvcCAtIHBvcy50b3A7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cblxuICAgIGlmIChwb3Muc2NhbGVYKSB7XG4gICAgICB0YXJnZXQuc2NhbGVYID0gdGFyZ2V0LnNjYWxlWCAqPSBwb3Muc2NhbGVYO1xuICAgIH1cbiAgICBpZiAocG9zLnNjYWxlWSkge1xuICAgICAgdGFyZ2V0LnNjYWxlWSA9IHRhcmdldC5zY2FsZVkgKj0gcG9zLnNjYWxlWTtcbiAgICB9XG5cbiAgICB0YXJnZXQuc2V0Q29vcmRzKCk7XG5cbiAgICB0aGlzLnJlbmRlckFsbCgpO1xuICAgIC8vIGlmKHRhcmdldC53aG9sZUNvb3JkaW5hdGVzKXtcbiAgICAvLyAgIHRhcmdldC50b3AgPSBNYXRoLnJvdW5kKHRhcmdldC50b3ApO1xuICAgIC8vICAgdGFyZ2V0LmxlZnQgPSBNYXRoLnJvdW5kKHRhcmdldC5sZWZ0KTtcbiAgICAvLyAgIHRhcmdldC5oZWlnaHQgPSBNYXRoLnJvdW5kKHRhcmdldC5oZWlnaHQpO1xuICAgIC8vICAgdGFyZ2V0LndpZHRoID0gTWF0aC5yb3VuZCh0YXJnZXQud2lkdGgpO1xuICAgIC8vIH1cbiAgfSxcbiAgX3RyYW5zbGF0ZU9iamVjdDogZnVuY3Rpb24gKHgsIHksIGxpbWl0cykge1xuICAgIHZhciB0YXJnZXQgPSB0aGlzLl9jdXJyZW50VHJhbnNmb3JtLnRhcmdldDtcbiAgICBpZih0YXJnZXQuYmVmb3JlVHJhbnNsYXRlKXtcbiAgICAgIHZhciBfcG9pbnQgPSB0YXJnZXQuYmVmb3JlVHJhbnNsYXRlKHgsIHkpO1xuICAgICAgaWYoIV9wb2ludClyZXR1cm4gZmFsc2U7XG4gICAgICB4ID0gX3BvaW50Lng7XG4gICAgICB5ID0gX3BvaW50Lnk7XG4gICAgfVxuICAgIHZhciBfdHJhbnNsYXRlZCA9IF90cmFuc2xhdGVPYmplY3Rfb3ZlcndyaXR0ZW4uY2FsbCh0aGlzLCB4LCB5LCBsaW1pdHMpO1xuXG4gICAgdmFyIHBvcyA9IHRoaXMuZ2V0Rml4ZWRQb3NpdGlvbih0YXJnZXQsIHgsIHkpO1xuXG4gICAgaWYgKHBvcy5zY2FsZVgpIHtcbiAgICAgIHRhcmdldC5zY2FsZVggPSB0aGlzLl9jdXJyZW50VHJhbnNmb3JtLnNjYWxlWCAqPSBwb3Muc2NhbGVYO1xuICAgIH1cbiAgICBpZiAocG9zLnNjYWxlWSkge1xuICAgICAgdGFyZ2V0LnNjYWxlWSA9IHRoaXMuX2N1cnJlbnRUcmFuc2Zvcm0uc2NhbGVZICo9IHBvcy5zY2FsZVk7XG4gICAgfVxuXG4gICAgaWYgKHBvcy50b3AgIT09IHVuZGVmaW5lZCB8fCBwb3MubGVmdCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBfdHJhbnNsYXRlZCA9IF90cmFuc2xhdGVPYmplY3Rfb3ZlcndyaXR0ZW4uY2FsbCh0aGlzLFxuICAgICAgICBwb3MubGVmdCAhPT0gdW5kZWZpbmVkID8gcG9zLmxlZnQgOiB4LFxuICAgICAgICBwb3MudG9wICE9PSB1bmRlZmluZWQgPyBwb3MudG9wIDogeSk7XG4gICAgfVxuICAgIHJldHVybiBfdHJhbnNsYXRlZCB8fCBwb3Muc2NhbGVYIHx8IHBvcy5zY2FsZVk7XG5cblxuXG4gICAgLyogaWYgKCF0YXJnZXQuZ2V0KCdsb2NrTW92ZW1lbnRYJykpIHtcbiAgICAgdmFyIF92YWwgPSB4IC0gdGhpcy5fY3VycmVudFRyYW5zZm9ybS5vZmZzZXRYO1xuXG4gICAgIC8vbGVmdCBvZmZzZXRcbiAgICAgdmFyIGxpbSA9IHRoaXMubW92ZW1lbnRMaW1pdHMubWluWC5jb25zdHJ1Y3RvciA9PSBOdW1iZXIgPyB0aGlzLm1vdmVtZW50TGltaXRzLm1pblggOiAtYm91bmRzLndpZHRoICsgMTtcbiAgICAgaWYodGFyZ2V0Lm1vdmVtZW50WE1pbkxpbWl0ICYmIHRhcmdldC5tb3ZlbWVudFhNaW5MaW1pdC5jb25zdHJ1Y3RvciA9PSBOdW1iZXIgJiYgdGFyZ2V0Lm1vdmVtZW50WE1pbkxpbWl0ID4gbGltICl7XG4gICAgIGxpbSA9IHRhcmdldC5tb3ZlbWVudFhNaW5MaW1pdCA7XG4gICAgIH1cblxuICAgICBfdmFsID0gTWF0aC5taW4obGltLCBfdmFsKTtcblxuICAgICAvL3JpZ2h0IG9mZnNldFxuICAgICB2YXIgbGltID0gdGhpcy5tb3ZlbWVudExpbWl0cy5tYXhYLmNvbnN0cnVjdG9yID09IE51bWJlciA/IHRoaXMubW92ZW1lbnRMaW1pdHMubWF4WCA6IHRoaXMud2lkdGggKyBib3VuZHMud2lkdGggLSAxO1xuICAgICBpZih0YXJnZXQubW92ZW1lbnRYTWF4TGltaXQgJiYgdGFyZ2V0Lm1vdmVtZW50WE1heExpbWl0LmNvbnN0cnVjdG9yID09IE51bWJlciAmJiB0YXJnZXQubW92ZW1lbnRYTWF4TGltaXQgPiBsaW0gKXtcbiAgICAgbGltID0gdGFyZ2V0Lm1vdmVtZW50WE1heExpbWl0IDtcbiAgICAgfVxuICAgICBfdmFsID0gTWF0aC5tYXgobGltICAtIHRhcmdldC53aWR0aCAqIHRhcmdldC5zY2FsZVgsIF92YWwpO1xuICAgICB0YXJnZXQuc2V0KCdsZWZ0JywgX3ZhbCk7XG4gICAgIH1cbiAgICAgaWYgKCF0YXJnZXQuZ2V0KCdsb2NrTW92ZW1lbnRZJykpIHtcbiAgICAgdmFyIF92YWwgPSB5IC0gdGhpcy5fY3VycmVudFRyYW5zZm9ybS5vZmZzZXRZO1xuICAgICBpZih0YXJnZXQubW92ZW1lbnRZTWluTGltaXQgIT09IHVuZGVmaW5lZClcbiAgICAgX3ZhbCA9IE1hdGgubWluKHRhcmdldC5tb3ZlbWVudFlNaW5MaW1pdCwgX3ZhbCk7XG4gICAgIGlmKHRhcmdldC5tb3ZlbWVudFlNYXhMaW1pdCAhPT0gdW5kZWZpbmVkKVxuICAgICBfdmFsID0gTWF0aC5tYXgodGFyZ2V0Lm1vdmVtZW50WU1heExpbWl0ICAtIHRhcmdldC5oZWlnaHQsIF92YWwpO1xuXG4gICAgIHRhcmdldC5zZXQoJ3RvcCcsIF92YWwpO1xuICAgICB9XG4gICAgICovXG4gICAgLy9tb3ZlbWVudExpbWl0cyA9e1xuICAgIC8vICAgIHhtaW46IDAsXG4gICAgLy8gICAgeG1heDogMCxcbiAgICAvLyAgICB5bWluOiAwLFxuICAgIC8vICAgIHltYXg6IDBcbiAgICAvL307XG5cbiAgfVxuXG59KTtcblxuLy9mYWJyaWMuU2xpZGVDYW52YXMuYWRkUGx1Z2luKFwibG9hZGVyc1wiLGZ1bmN0aW9uKCl7XG4vLyAgICB0aGlzLmluaXRNb3ZlbWVudExpbWl0cygpO1xuLy99KTtcblxuLy90b2RvXG5mYWJyaWMuUmVjdC5wcm90b3R5cGUuc3RhdGVQcm9wZXJ0aWVzICAgPSBmYWJyaWMuUmVjdC5wcm90b3R5cGUuc3RhdGVQcm9wZXJ0aWVzLmNvbmNhdChbXCJtb3ZlbWVudExpbWl0c1wiLFwiY2xpcFRvXCJdKTtcbmZhYnJpYy5PYmplY3QucHJvdG90eXBlLnN0YXRlUHJvcGVydGllcyA9IGZhYnJpYy5PYmplY3QucHJvdG90eXBlLnN0YXRlUHJvcGVydGllcy5jb25jYXQoW1wibW92ZW1lbnRMaW1pdHNcIixcImNsaXBUb1wiXSk7XG5mYWJyaWMuSVRleHQucHJvdG90eXBlLnN0YXRlUHJvcGVydGllcyAgPSBmYWJyaWMuSVRleHQucHJvdG90eXBlLnN0YXRlUHJvcGVydGllcy5jb25jYXQoW1wibW92ZW1lbnRMaW1pdHNcIixcImNsaXBUb1wiXSk7XG5mYWJyaWMuSW1hZ2UucHJvdG90eXBlLnN0YXRlUHJvcGVydGllcyAgPSBmYWJyaWMuSW1hZ2UucHJvdG90eXBlLnN0YXRlUHJvcGVydGllcy5jb25jYXQoW1wibW92ZW1lbnRMaW1pdHNcIixcImNsaXBUb1wiXSk7XG5cblxudmFyIF9iZWZvcmVUcmFuc2Zvcm1fb3ZlcndyaXR0ZW4gPSBmYWJyaWMuQ2FudmFzLnByb3RvdHlwZS5fYmVmb3JlVHJhbnNmb3JtO1xudmFyIF9maW5hbGl6ZV9jdXJyZW50X3RyYW5zZm9ybV9vdmVyd3JpdHRlbiA9IGZhYnJpYy5DYW52YXMucHJvdG90eXBlLl9maW5hbGl6ZUN1cnJlbnRUcmFuc2Zvcm07XG52YXIgX3Jlc3RvcmVPcmlnaW5YWU5hdGl2ZSA9IGZhYnJpYy5DYW52YXMucHJvdG90eXBlLl9yZXN0b3JlT3JpZ2luWFk7XG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5DYW52YXMucHJvdG90eXBlLCB7XG5cbiAgX2ZpbmFsaXplQ3VycmVudFRyYW5zZm9ybU5hdGl2ZTogZmFicmljLkNhbnZhcy5wcm90b3R5cGUuX2ZpbmFsaXplQ3VycmVudFRyYW5zZm9ybSxcbiAgX2ZpbmFsaXplQ3VycmVudFRyYW5zZm9ybTogZnVuY3Rpb24gKCkge1xuXG4gICAgdmFyIHRyYW5zZm9ybSA9IHRoaXMuX2N1cnJlbnRUcmFuc2Zvcm0sXG4gICAgICB0YXJnZXQgPSB0cmFuc2Zvcm0udGFyZ2V0O1xuXG4gICAgaWYgKHRhcmdldC5fc2NhbGluZykge1xuICAgICAgdGFyZ2V0Ll9zY2FsaW5nID0gZmFsc2U7XG4gICAgfVxuXG4gICAgdGFyZ2V0LnNldENvb3JkcygpO1xuXG4gICAgdGhpcy5fcmVzdG9yZU9yaWdpblhZKHRhcmdldCk7XG4gICAgLy8gb25seSBmaXJlIDptb2RpZmllZCBldmVudCBpZiB0YXJnZXQgY29vcmRpbmF0ZXMgd2VyZSBjaGFuZ2VkIGR1cmluZyBtb3VzZWRvd24tbW91c2V1cFxuICAgIHRoaXMuZmlyZU1vZGlmaWVkSWZDaGFuZ2VkKHRhcmdldCk7XG5cbiAgICAvLyB0YXJnZXQuX2ZpbmFsaXplQ3VycmVudFRyYW5zZm9ybSA/XG4gICAgLy8gICB0YXJnZXQuX2ZpbmFsaXplQ3VycmVudFRyYW5zZm9ybSgpIDpcbiAgICAvLyAgIHRoaXMuX2ZpbmFsaXplQ3VycmVudFRyYW5zZm9ybU5hdGl2ZSh0aGlzKTtcbiAgfSxcbiAgX2JlZm9yZVRyYW5zZm9ybTogZnVuY3Rpb24gKGUsIHRhcmdldCkge1xuICAgIHRhcmdldCAmJiB0YXJnZXQuX2JlZm9yZVRyYW5zZm9ybSA/XG4gICAgICB0YXJnZXQuX2JlZm9yZVRyYW5zZm9ybShlKSA6XG4gICAgICBfYmVmb3JlVHJhbnNmb3JtX292ZXJ3cml0dGVuLmNhbGwodGhpcywgZSwgdGFyZ2V0KTtcbiAgfSxcbiAgX2JlZm9yZVRyYW5zZm9ybU5hdGl2ZTogX2JlZm9yZVRyYW5zZm9ybV9vdmVyd3JpdHRlbixcbiAgLyoqXG4gICAqIFRyYW5zbGF0ZXMgb2JqZWN0IGJ5IFwic2V0dGluZ1wiIGl0cyBsZWZ0L3RvcFxuICAgKiBAcHJpdmF0ZVxuICAgKiBAcGFyYW0ge051bWJlcn0geCBwb2ludGVyJ3MgeCBjb29yZGluYXRlXG4gICAqIEBwYXJhbSB7TnVtYmVyfSB5IHBvaW50ZXIncyB5IGNvb3JkaW5hdGVcbiAgICogQHJldHVybiB7Qm9vbGVhbn0gdHJ1ZSBpZiB0aGUgdHJhbnNsYXRpb24gb2NjdXJyZWRcbiAgICovXG4gIF90cmFuc2xhdGVPYmplY3Q6IGZ1bmN0aW9uICh4LCB5KSB7XG4gICAgdmFyIHRyYW5zZm9ybSA9IHRoaXMuX2N1cnJlbnRUcmFuc2Zvcm0sXG4gICAgICB0YXJnZXQgPSB0cmFuc2Zvcm0udGFyZ2V0LFxuICAgICAgbmV3TGVmdCA9IHggLSB0cmFuc2Zvcm0ub2Zmc2V0WCxcbiAgICAgIG5ld1RvcCA9IHkgLSB0cmFuc2Zvcm0ub2Zmc2V0WSxcbiAgICAgIG1vdmVYID0gIXRhcmdldC5nZXQoJ2xvY2tNb3ZlbWVudFgnKSAmJiB0YXJnZXQubGVmdCAhPT0gbmV3TGVmdCxcbiAgICAgIG1vdmVZID0gIXRhcmdldC5nZXQoJ2xvY2tNb3ZlbWVudFknKSAmJiB0YXJnZXQudG9wICE9PSBuZXdUb3A7XG5cblxuICAgIC8vcm91bmQgY29vcmRpbmF0ZXNcbiAgICAvLyBpZiAodGFyZ2V0Lndob2xlQ29vcmRpbmF0ZXMpIHtcbiAgICAvLyAgIG5ld0xlZnQgPSBNYXRoLnJvdW5kKG5ld0xlZnQpO1xuICAgIC8vICAgbmV3VG9wID0gTWF0aC5yb3VuZChuZXdUb3ApO1xuICAgIC8vIH1cblxuICAgIG1vdmVYICYmIHRhcmdldC5zZXQoJ2xlZnQnLCBuZXdMZWZ0KTtcbiAgICBtb3ZlWSAmJiB0YXJnZXQuc2V0KCd0b3AnLCBuZXdUb3ApO1xuICAgIHJldHVybiBtb3ZlWCB8fCBtb3ZlWTtcbiAgfSxcblxuICAvLyBfcmVzdG9yZU9yaWdpblhZTmF0aXZlOiBfcmVzdG9yZU9yaWdpblhZTmF0aXZlLFxuICAvLyBfcmVzdG9yZU9yaWdpblhZOiBmdW5jdGlvbiAodGFyZ2V0KSB7XG4gIC8vICAgdGhpcy5fcmVzdG9yZU9yaWdpblhZTmF0aXZlKHRhcmdldCk7XG4gIC8vXG4gIC8vICAgLy8gaWYgKHRhcmdldC53aG9sZUNvb3JkaW5hdGVzKSB7XG4gIC8vICAgLy8gICB0YXJnZXQubGVmdCA9IE1hdGgucm91bmQodGFyZ2V0LmxlZnQpO1xuICAvLyAgIC8vICAgdGFyZ2V0LnRvcCA9IE1hdGgucm91bmQodGFyZ2V0LnRvcCk7XG4gIC8vICAgLy8gfVxuICAvLyB9LFxuXG4gIC8qKlxuICAgKiBTZXRzIHRoZSBwb3NpdGlvbiBvZiB0aGUgb2JqZWN0IHRha2luZyBpbnRvIGNvbnNpZGVyYXRpb24gdGhlIG9iamVjdCdzIG9yaWdpblxuICAgKiBAcGFyYW0ge2ZhYnJpYy5Qb2ludH0gcG9zIFRoZSBuZXcgcG9zaXRpb24gb2YgdGhlIG9iamVjdFxuICAgKiBAcGFyYW0ge1N0cmluZ30gb3JpZ2luWCBIb3Jpem9udGFsIG9yaWdpbjogJ2xlZnQnLCAnY2VudGVyJyBvciAncmlnaHQnXG4gICAqIEBwYXJhbSB7U3RyaW5nfSBvcmlnaW5ZIFZlcnRpY2FsIG9yaWdpbjogJ3RvcCcsICdjZW50ZXInIG9yICdib3R0b20nXG4gICAqIEByZXR1cm4ge3ZvaWR9XG4gICAqL1xuICBzZXRQb3NpdGlvbkJ5T3JpZ2luOiBmdW5jdGlvbiAocG9zLCBvcmlnaW5YLCBvcmlnaW5ZKSB7XG4gICAgdmFyIGNlbnRlciA9IHRoaXMudHJhbnNsYXRlVG9DZW50ZXJQb2ludChwb3MsIG9yaWdpblgsIG9yaWdpblkpLFxuICAgICAgcG9zaXRpb24gPSB0aGlzLnRyYW5zbGF0ZVRvT3JpZ2luUG9pbnQoY2VudGVyLCB0aGlzLm9yaWdpblgsIHRoaXMub3JpZ2luWSk7XG5cbiAgICAvLyBpZiAodGhpcy53aG9sZUNvb3JkaW5hdGVzKSB7XG4gICAgLy8gICBwb3NpdGlvbi54ID0gTWF0aC5yb3VuZChwb3NpdGlvbi54KTtcbiAgICAvLyAgIHBvc2l0aW9uLnkgPSBNYXRoLnJvdW5kKHBvc2l0aW9uLnkpO1xuICAgIC8vIH1cbiAgICB0aGlzLnNldCgnbGVmdCcsIHBvc2l0aW9uLngpO1xuICAgIHRoaXMuc2V0KCd0b3AnLCBwb3NpdGlvbi55KTtcbiAgfVxufSk7XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL21vZHVsZXMvbW92ZW1lbnRMaW1pdHMuanNcbi8vIG1vZHVsZSBpZCA9IDc2XG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIid1c2Ugc3RyaWN0JztcblxudmFyIE1hZ2ljV2FuZCA9IGZhYnJpYy5NYWdpY1dhbmQgO1xuXG4vKipcbiAqIFBhdGhmaW5kZXIgKFBhdGhmaW5kZXIpIEludGVyZmFjZSBmb3IgTWFnaWNXYW5kIHNlbGVjdGlvbiB0b29sXG4gKiBAcGFyYW0gb3B0aW9uc1xuICogQGNvbnN0cnVjdG9yXG4gKi9cbmZ1bmN0aW9uIFBhdGhmaW5kZXIob3B0aW9ucykge1xuICB0aGlzLmluaXRpYWxpemUob3B0aW9ucyk7XG59XG5cblBhdGhmaW5kZXIucHJvdG90eXBlID0ge1xuICB0eXBlOiAncGF0aGZpbmRlcicsXG4gIGtlZXBPbGRTZWxlY3Rpb246IHRydWUsXG4gIGFscGhhQ2hhbm5lbDogdHJ1ZSxcbiAgcGF0aGZpbmRlck1vZGU6ICduZXcnLFxuICBzZWxlY3Rpb25Ub29sOiAnbWFnaWMnLFxuICBhZGphY2VudFBpeGVsczogdHJ1ZSxcbiAgYXN5bmM6IGZhbHNlLFxuICBkcmF3aW5nVG9vbHM6IGZhbHNlLFxuICBwYXRoZmluZGVyVG9vbHM6IGZhbHNlLFxuICBibHVyUmFkaXVzOiAwLFxuICBoYXRjaExlbmd0aDogNCxcbiAgY29sb3JUaHJlc2hvbGQ6IDE1LFxuICBzaW1wbGlmeVRvbGVyYW50OiAwLFxuICBzaW1wbGlmeUNvdW50OiAzMCxcbiAgaGF0Y2hPZmZzZXQ6IDAsXG4gIGltYWdlSW5mbzogbnVsbCxcbiAgbWFzazogbnVsbCxcbiAgZG93blBvaW50OiBudWxsLFxuICBhbGxvd0RyYXc6IGZhbHNlLFxuICBzaGFwZVNlbGVjdGlvblRvb2xzOiBmYWxzZSxcbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICBvcHRpb25zLmFwcGxpY2F0aW9uLmZpcmUoJ2VudGl0eTpjcmVhdGVkJyx7dGFyZ2V0IDogdGhpcyxvcHRpb25zIDogb3B0aW9uc30pXG5cbiAgICBmb3IgKHZhciBpIGluIG9wdGlvbnMpIHtcbiAgICAgIHRoaXNbaV0gPSBvcHRpb25zW2ldO1xuICAgIH1cbiAgfSxcbiAgYXN5bmNyb25vdXM6IGZ1bmN0aW9uIChjYikge1xuICAgIGlmICh0aGlzLmFzeW5jKSB7XG4gICAgICBzZXRUaW1lb3V0KGNiKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY2IoKTtcbiAgICB9XG4gIH0sXG4gIGZpbGxXaXRoQ3VycmVudENvbG9yOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5maWxsKHRoaXMuY29sb3IpO1xuICB9LFxuICBjbGVhck1lbW9yeTogZnVuY3Rpb24gKCkge1xuICAgIGRlbGV0ZSB0aGlzLnJlc3VsdENhbnZhcztcbiAgICBkZWxldGUgdGhpcy5lZGl0ZWRJbWFnZUNhbnZhcztcbiAgICBkZWxldGUgdGhpcy50ZXN0X3BpY3R1cmU7XG4gICAgZGVsZXRlIHRoaXMubWFzaztcbiAgfSxcbiAgaGlkZTogZnVuY3Rpb24gKCkge1xuICAgIGlmICh0aGlzLmVkaXRlZEltYWdlQ2FudmFzKSB7XG4gICAgICB0aGlzLmVkaXRlZEltYWdlQ2FudmFzLnJlbW92ZSgpO1xuICAgICAgdGhpcy5yZXN1bHRDYW52YXMucmVtb3ZlKCk7XG4gICAgICBjbGVhckludGVydmFsKHRoaXMuaW50ZXJ2YWwpO1xuICAgICAgdGhpcy5jbGVhck1lbW9yeSgpO1xuICAgICAgdGhpcy5maXJlKCdoaWRkZW4nKTtcbiAgICB9XG4gIH0sXG4gIHNldENvbnRhaW5lcjogZnVuY3Rpb24gKGNvbnRhaW5lcikge1xuICAgIGlmIChjb250YWluZXIuY29uc3RydWN0b3IgPT09IFN0cmluZykge1xuICAgICAgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoY29udGFpbmVyKTtcbiAgICB9XG4gICAgdGhpcy5jb250YWluZXIgPSBjb250YWluZXI7XG5cbiAgICB0aGlzLnRlc3RfcGljdHVyZSA9IG5ldyBJbWFnZSgpO1xuICAgIHRoaXMudGVzdF9waWN0dXJlLm9ubG9hZCA9IHRoaXMuaW5pdENhbnZhcy5iaW5kKHRoaXMpO1xuICAgIHJldHVybiB0aGlzO1xuICB9LFxuICBnZXRTZWxlY3Rpb25Ub29sOiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMuc2VsZWN0aW9uVG9vbDtcbiAgfSxcbiAgc2V0U2VsZWN0aW9uVG9vbDogZnVuY3Rpb24gKHRvb2wpIHtcbiAgICB0aGlzLnNlbGVjdGlvblRvb2wgPSB0b29sO1xuICAgIHRoaXMuZG93blBvaW50ID0gZmFsc2UgO1xuICAgIHRoaXMuZmlyZSgndG9vbDpjaGFuZ2VkJywgdG9vbCk7XG4gIH0sXG4gIGdldFRocmVzaG9sZDogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLmNvbG9yVGhyZXNob2xkO1xuICB9LFxuICBzZXRUaHJlc2hvbGQ6IGZ1bmN0aW9uICh0aHJlcykge1xuICAgIGlmKHRocmVzICE9PSB1bmRlZmluZWQpe1xuICAgICAgdGhpcy5jb2xvclRocmVzaG9sZCA9IHRocmVzO1xuICAgIH1cbiAgICBpZiAodGhpcy5kb3duUG9pbnQpIHtcbiAgICAgIHRoaXMuZHJhd01hc2sodGhpcy5kb3duUG9pbnQueCwgdGhpcy5kb3duUG9pbnQueSwgdGhpcy5hZGphY2VudFBpeGVscyk7XG4gICAgfVxuICAgIHRoaXMuZmlyZSgndGhyZXNob2xkOmNoYW5nZWQnLCB7dGhyZXNob2xkOiB0aGlzLmNvbG9yVGhyZXNob2xkfSk7XG4gIH0sXG4gIHNldFBpY3R1cmU6IGZ1bmN0aW9uIChpbWcpIHtcbiAgICB0aGlzLnNldEltYWdlKGltZyk7XG4gICAgdmFyIGN2cyA9IGZhYnJpYy51dGlsLmNyZWF0ZUNhbnZhc0VsZW1lbnQoKTtcblxuICAgIGN2cy5vbm1vdXNldXAgPSB0aGlzLm9uTW91c2VVcC5iaW5kKHRoaXMpO1xuICAgIGN2cy5vbm1vdXNlZG93biA9IHRoaXMub25Nb3VzZURvd24uYmluZCh0aGlzKTtcbiAgICBjdnMub25tb3VzZW1vdmUgPSB0aGlzLm9uTW91c2VNb3ZlLmJpbmQodGhpcyk7XG4gICAgY3ZzLm9uY29udGV4dG1lbnUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfTtcbiAgICB0aGlzLmluaXRDYW52YXMoY3ZzKTtcbiAgfSxcbiAgbG9hZDogZnVuY3Rpb24gKGZpbGUpIHtcbiAgICBpZiAoIWZpbGUpcmV0dXJuO1xuXG4gICAgaWYgKGZpbGUuY29uc3RydWN0b3IgPT09IFN0cmluZykge1xuICAgICAgUGF0aGZpbmRlci50ZXN0X3BpY3R1cmUuc2V0QXR0cmlidXRlKCdzcmMnLGZpbGUpO1xuICAgIH0gZWxzZSB7XG4gICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcbiAgICAgIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICB0aGlzLnRlc3RfcGljdHVyZS5zZXRBdHRyaWJ1dGUoJ3NyYycsIGUudGFyZ2V0LnJlc3VsdCk7XG4gICAgICB9LmJpbmQodGhpcyk7XG4gICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlKTtcbiAgICB9XG4gIH0sXG4gIGluaXRDYW52YXM6IGZ1bmN0aW9uIChjdnMpIHtcbiAgICB2YXIgaW1nID0gdGhpcy5lZGl0ZWRJbWFnZUNhbnZhcztcbiAgICBpZih0aGlzLnJlc3VsdENhbnZhcyl7XG4gICAgICAkKHRoaXMucmVzdWx0Q2FudmFzKS5yZW1vdmUoKVxuICAgIH1cbiAgICB0aGlzLnJlc3VsdENhbnZhcyA9IGN2cztcbiAgICB0aGlzLmNyZWF0ZVNlbGVjdGlvbkRyYXdDYW52YXMoKTtcblxuXG4gICAgdGhpcy5jb250ZXh0ID0gY3ZzLmdldENvbnRleHQoJzJkJyk7XG4gICAgY3ZzLndpZHRoID0gaW1nLndpZHRoO1xuICAgIGN2cy5oZWlnaHQgPSBpbWcuaGVpZ2h0O1xuICAgIC8vdGhpcy5zZXRJbWFnZShpbWcpO1xuICB9LFxuICBzZXRJbWFnZTogZnVuY3Rpb24gKGltZykge1xuICAgIHRoaXMuX3Rlc3RfdG9kb19pbWcgPSBpbWc7XG4gICAgLy90aGlzLm1hc2sgPSBudWxsOy8vTWFnaWNXYW5kLmNyZWF0ZU1hc2soaW1nLndpZHRoLGltZy5oZWlnaHQpO1xuICAgIHRoaXMuZWRpdGVkSW1hZ2VDYW52YXMgPSBmYWJyaWMudXRpbC5jcmVhdGVDYW52YXNFbGVtZW50KCk7XG4gICAgdGhpcy5lZGl0ZWRJbWFnZUNhbnZhcy53aWR0aCA9IGltZy53aWR0aDtcbiAgICB0aGlzLmVkaXRlZEltYWdlQ2FudmFzLmhlaWdodCA9IGltZy5oZWlnaHQ7XG4gICAgdGhpcy5lZGl0ZWRJbWFnZUNhbnZhcy5nZXRDb250ZXh0KCcyZCcpLmRyYXdJbWFnZShpbWcsIDAsIDApO1xuICAgIHRoaXMuaW5pdENhbnZhcyhmYWJyaWMudXRpbC5jcmVhdGVDYW52YXNFbGVtZW50KCkpXG4gIH0sXG4gIGdldEluZm86IGZ1bmN0aW9uICgpIHtcblxuICAgIHZhciBjdHggPSB0aGlzLmVkaXRlZEltYWdlQ2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gICAgdmFyIGltYWdlSW5mbyA9IGN0eC5nZXRJbWFnZURhdGEoMCwgMCwgdGhpcy5lZGl0ZWRJbWFnZUNhbnZhcy53aWR0aCwgdGhpcy5lZGl0ZWRJbWFnZUNhbnZhcy5oZWlnaHQpO1xuICAgIGltYWdlSW5mby5ieXRlcyA9IDQ7XG4gICAgcmV0dXJuIGltYWdlSW5mbztcbiAgfSxcbiAgZ2V0TW91c2VQb3NpdGlvbjogZnVuY3Rpb24gKGUpIHtcbiAgICB2YXIgc2NhbGUgPSB0aGlzLnJlc3VsdENhbnZhcy53aWR0aCAvICQodGhpcy5yZXN1bHRDYW52YXMpLndpZHRoKCk7XG4gICAgdmFyIHRhcmdldCA9IGUudGFyZ2V0IHx8IGUuc3JjRWxlbWVudCxcbiAgICAgIHJlY3QgPSB0YXJnZXQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksXG4gICAgICBvZmZzZXRYID0gZS5jbGllbnRYIC0gcmVjdC5sZWZ0LFxuICAgICAgb2Zmc2V0WSA9IGUuY2xpZW50WSAtIHJlY3QudG9wO1xuICAgIHJldHVybiB7eDogTWF0aC5yb3VuZChvZmZzZXRYICogc2NhbGUpLCB5OiBNYXRoLnJvdW5kKG9mZnNldFkgKiBzY2FsZSl9O1xuICB9LFxuICByYWRpdXM6IDIwLFxuICByZXNldFNlbGVjdGlvbkRyYXdDYW52YXM6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLnNlbGVjdGlvbkRyYXdDb250ZXh0LmZpbGxTdHlsZSA9IFwiYmxhY2tcIjtcbiAgICAvL3RoaXMuc2VsZWN0aW9uRHJhd0NvbnRleHQoMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTtcbiAgICB0aGlzLnNlbGVjdGlvbkRyYXdDb250ZXh0LmZpbGxSZWN0KDAsMCx0aGlzLnNlbGVjdGlvbkRyYXdDYW52YXMud2lkdGgsdGhpcy5zZWxlY3Rpb25EcmF3Q2FudmFzLmhlaWdodCk7XG4gICAgdGhpcy5zZWxlY3Rpb25EcmF3Q29udGV4dC5maWxsU3R5bGUgPSBcIndoaXRlXCI7XG4gICAgdGhpcy5zZWxlY3Rpb25EcmF3Q29udGV4dC5zdHJva2VTdHlsZSA9IFwid2hpdGVcIjtcbiAgfSxcbiAgY3JlYXRlU2VsZWN0aW9uRHJhd0NhbnZhczogZnVuY3Rpb24gKCkge1xuXG4gICAgaWYodGhpcy5zZWxlY3Rpb25EcmF3Q2FudmFzICl7XG4gICAgICAkKHRoaXMuc2VsZWN0aW9uRHJhd0NhbnZhcyApLnJlbW92ZSgpO1xuICAgIH1cbiAgICB0aGlzLnNlbGVjdGlvbkRyYXdDYW52YXMgPSBmYWJyaWMudXRpbC5jcmVhdGVDYW52YXNFbGVtZW50KCk7XG4gICAgdGhpcy5zZWxlY3Rpb25EcmF3Q2FudmFzLndpZHRoICA9IHRoaXMucmVzdWx0Q2FudmFzLndpZHRoO1xuICAgIHRoaXMuc2VsZWN0aW9uRHJhd0NhbnZhcy5oZWlnaHQgPSB0aGlzLnJlc3VsdENhbnZhcy5oZWlnaHQ7XG4gICAgdGhpcy5zZWxlY3Rpb25EcmF3Q29udGV4dCA9IHRoaXMuc2VsZWN0aW9uRHJhd0NhbnZhcy5nZXRDb250ZXh0KFwiMmRcIik7XG4gICAgdGhpcy5yZXNldFNlbGVjdGlvbkRyYXdDYW52YXMoKTtcbiAgfSxcbiAgX29uTW91c2VEb3duOiBmdW5jdGlvbiAocG9pbnQpIHtcbiAgICBwb2ludC54ID0gTWF0aC5taW4oTWF0aC5tYXgoMCwgcGFyc2VJbnQocG9pbnQueCkpLCB0aGlzLnJlc3VsdENhbnZhcy53aWR0aCAtIDEpO1xuICAgIHBvaW50LnkgPSBNYXRoLm1pbihNYXRoLm1heCgwLCBwYXJzZUludChwb2ludC55KSksIHRoaXMucmVzdWx0Q2FudmFzLmhlaWdodCAtIDEpO1xuICAgIHRoaXMuYWxsb3dEcmF3ID0gdHJ1ZTtcbiAgICB0aGlzLnRvb2xzW3RoaXMuc2VsZWN0aW9uVG9vbF0ubW91c2VEb3duLmNhbGwodGhpcyxwb2ludCk7XG4gIH0sXG4gIG9uTW91c2VEb3duOiBmdW5jdGlvbiAoZSkge1xuICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIHRoaXMuX29uTW91c2VEb3duKHRoaXMuZ2V0TW91c2VQb3NpdGlvbihlKSk7XG5cbiAgfSxcbiAgX29uTW91c2VNb3ZlOiBmdW5jdGlvbiAocCkge1xuICAgIHAueCA9IE1hdGgubWluKE1hdGgubWF4KDAsIHBhcnNlSW50KHAueCkpLCB0aGlzLnJlc3VsdENhbnZhcy53aWR0aCAtIDEpO1xuICAgIHAueSA9IE1hdGgubWluKE1hdGgubWF4KDAsIHBhcnNlSW50KHAueSkpLCB0aGlzLnJlc3VsdENhbnZhcy5oZWlnaHQgLSAxKTtcbiAgICB0aGlzLnRvb2xzW3RoaXMuc2VsZWN0aW9uVG9vbF0ubW91c2VNb3ZlLmNhbGwodGhpcyxwKTtcbiAgfSxcbiAgb25Nb3VzZU1vdmU6IGZ1bmN0aW9uIChlKSB7XG4gICAgdmFyIHAgPSB0aGlzLmdldE1vdXNlUG9zaXRpb24oZSk7XG4gICAgdGhpcy5fb25Nb3VzZU1vdmUocCk7XG4gIH0sXG4gIGNvbG9yOiBbMjU1LCAwLCAwLCAyNTVdLFxuICBvbk1vdXNlVXA6IGZ1bmN0aW9uIChlKSB7XG4gICAgdGhpcy5hbGxvd0RyYXcgPSBmYWxzZTtcbiAgICB0aGlzLnRvb2xzW3RoaXMuc2VsZWN0aW9uVG9vbF0ubW91c2VVcC5jYWxsKHRoaXMsZSk7XG4gIH0sXG4gIGFwcGx5TWFzazogZnVuY3Rpb24gKGNhbnZhcywgbGVmdCwgdG9wKSB7XG4gICAgaWYgKGNhbnZhcy53aWR0aCA9PT0gMCB8fCBjYW52YXMuaGVpZ2h0ID09PSAwKSB7XG4gICAgICBkZWxldGUgdGhpcy5tYXNrO1xuICAgICAgdGhpcy5yZW5kZXIoKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdmFyIGluZm8gPSB0aGlzLmdldEluZm8oKSxcbiAgICAgIG1hc2sgPSBNYWdpY1dhbmQubWFza1NlbGVjdGlvbihjYW52YXMsbGVmdCx0b3ApIDtcblxuICAgIHRoaXMubWFzayA9IG1hc2s7XG4gICAgdGhpcy5maXJlKCdzZWxlY3Rpb246Y2hhbmdlZCcsIHttYXNrOiBtYXNrLCB0YXJnZXQ6IHRoaXMudGFyZ2V0fSk7XG4gIH0sXG4gIHNldFBhdGhmaW5kZXJNb2RlOiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICB0aGlzLnBhdGhmaW5kZXJNb2RlID0gdmFsdWU7XG4gIH0sXG4gIGdldFBhdGhmaW5kZXJNb2RlOiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMucGF0aGZpbmRlck1vZGU7XG4gIH0sXG4gIG1vZGlmeVNlbGVjdGlvbjogZnVuY3Rpb24gKG1hc2ssIHBhdGhmaW5kZXJNb2RlLCBub0V2ZW50cykge1xuICAgIHRoaXMuc2hvdWxkTW9kaWZ5ID0gZmFsc2U7XG4gICAgaWYodGhpcy5zZWxlY3Rpb25PYmplY3Qpe1xuICAgICAgdGhpcy5zZWxlY3Rpb25PYmplY3QucmVtb3ZlKCk7XG4gICAgfVxuICAgIHRoaXMuZG93blBvaW50ID0gZmFsc2U7XG4gICAgaWYgKG1hc2sgPT09IHVuZGVmaW5lZCkge1xuICAgICAgbWFzayA9IHRoaXMubWFzaztcbiAgICB9XG4gICAgaWYgKHBhdGhmaW5kZXJNb2RlID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHBhdGhmaW5kZXJNb2RlID0gdGhpcy5wYXRoZmluZGVyTW9kZTtcbiAgICB9XG4gICAgaWYgKHBhdGhmaW5kZXJNb2RlICE9PSAnbmV3JyAmJiB0aGlzLm9sZE1hc2spIHtcbiAgICAgIG1hc2sgPSBNYWdpY1dhbmRbcGF0aGZpbmRlck1vZGVdKG1hc2ssIHRoaXMub2xkTWFzayk7XG4gICAgfVxuICAgIGlmICh0aGlzLmJsdXJSYWRpdXMpIHtcbiAgICAgIG1hc2sgPSBNYWdpY1dhbmQuZ2F1c3NCbHVyT25seUJvcmRlcihtYXNrLCB0aGlzLmJsdXJSYWRpdXMpO1xuICAgIH1cbiAgICAvL2lmIChwYXRoZmluZGVyTW9kZSAhPT0gJ25ldycgJiYgdGhpcy5vbGRNYXNrIHx8IHRoaXMuYmx1clJhZGl1cykge1xuICAgIC8vICBtYXNrLmNhY2hlSW5kID0gTWFnaWNXYW5kLmdldEJvcmRlckluZGljZXMobWFzayk7XG4gICAgLy99XG5cbiAgICBpZihtYXNrICYmIG1hc2suY291bnQgJiYgdGhpcy5rZWVwT2xkU2VsZWN0aW9uKXtcbiAgICAgIG1hc2subWFrZUNhY2hlKCk7XG4gICAgICB0aGlzLm9sZE1hc2sgPSBtYXNrO1xuICAgIH1lbHNle1xuICAgICAgZGVsZXRlIHRoaXMub2xkTWFzayA7XG4gICAgfVxuXG5cbiAgICB0aGlzLm1hc2sgPSBNYWdpY1dhbmQuY3JlYXRlTWFzayh0aGlzLmVkaXRlZEltYWdlQ2FudmFzLndpZHRoLCB0aGlzLmVkaXRlZEltYWdlQ2FudmFzLmhlaWdodCk7XG4gICAgaWYgKCFub0V2ZW50cykge1xuICAgICAgdGhpcy5maXJlKCdzZWxlY3Rpb246Y2hhbmdlZCcsIHttYXNrOiBtYXNrLCB0YXJnZXQ6IHRoaXMudGFyZ2V0fSk7XG4gICAgfVxuICAgIHRoaXMucmVuZGVyKCk7XG4gIH0sXG4gIGNyZWF0ZVNlbGVjdGlvbjogZnVuY3Rpb24gKG1hc2spIHtcbiAgICBpZiAodGhpcy5zaG91bGRNb2RpZnkpIHtcbiAgICAgIHRoaXMubW9kaWZ5U2VsZWN0aW9uKCk7XG4gICAgfVxuXG4gICAgdGhpcy5tYXNrID0gbWFzayB8fCBNYWdpY1dhbmQuY3JlYXRlTWFzayh0aGlzLmVkaXRlZEltYWdlQ2FudmFzLndpZHRoLCB0aGlzLmVkaXRlZEltYWdlQ2FudmFzLmhlaWdodCk7XG4gICAgdGhpcy5yZW5kZXIoKTtcbiAgfSxcbiAgc2V0U2VsZWN0aW9uOiBmdW5jdGlvbiAobWFzaykge1xuICAgIHRoaXMubWFzayA9IG1hc2s7XG4gICAgdGhpcy5yZW5kZXIoKTtcbiAgICB0aGlzLmZpcmUoJ3NlbGVjdGlvbjpjaGFuZ2VkJywge21hc2s6IG1hc2ssIHRhcmdldDogdGhpcy50YXJnZXR9KTtcbiAgfSxcbiAgZmlsbDogZnVuY3Rpb24gKGNvbG9yLCBjYWxsYmFjaykge1xuICAgIHRoaXMuYXN5bmNyb25vdXMoZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5fZmlsbChjb2xvciwgZmFsc2UpO1xuICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2suY2FsbCh0aGlzKTtcbiAgICB9LmJpbmQodGhpcyksIDApO1xuICB9LFxuICBfZmlsbDogZnVuY3Rpb24gKGNvbG9yLCBpbnZlcnQsIGNhbnZhcykge1xuXG5cbiAgICBpZiAoIXRoaXMubWFzaykgcmV0dXJuO1xuXG5cbiAgICBjYW52YXMgPSBjYW52YXMgfHwgdGhpcy5lZGl0ZWRJbWFnZUNhbnZhcztcbiAgICB2YXIgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7Ly9iLm1pblgsIGIubWluWSwgYi5tYXhYIC0gYi5taW5YLCBiLm1heFkgLSBiLm1pblkpO1xuXG4gICAgTWFnaWNXYW5kLmZpbGxNYXNrKGN0eCwgdGhpcy5tYXNrLCBjb2xvcik7XG5cbiAgICB0aGlzLmZpcmUoJ2ltYWdlOmNoYW5nZWQnLCB0aGlzLmVkaXRlZEltYWdlQ2FudmFzKTtcbiAgfSxcbiAgaGF0Y2hUaWNrOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5oYXRjaE9mZnNldCA9ICh0aGlzLmhhdGNoT2Zmc2V0ICsgMSkgJSAodGhpcy5oYXRjaExlbmd0aCAqIDIpO1xuICAgIHRoaXMucmVuZGVyKHRydWUpO1xuICB9LFxuICBzaG93OiBmdW5jdGlvbiAoKSB7XG4gICAgd2hpbGUgKHRoaXMuY29udGFpbmVyLmxhc3RDaGlsZCkge1xuICAgICAgdGhpcy5jb250YWluZXIucmVtb3ZlQ2hpbGQodGhpcy5jb250YWluZXIubGFzdENoaWxkKTtcbiAgICB9XG4gICAgdGhpcy5jb250YWluZXIuYXBwZW5kQ2hpbGQodGhpcy5lZGl0ZWRJbWFnZUNhbnZhcyk7XG4gICAgdGhpcy5jb250YWluZXIuYXBwZW5kQ2hpbGQodGhpcy5yZXN1bHRDYW52YXMpO1xuICAgIHRoaXMuaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCh0aGlzLmhhdGNoVGljay5iaW5kKHRoaXMpLCAzMDApO1xuXG4gICAgdGhpcy5maXJlKCdzaG93Jyk7XG4gIH0sXG4gIGNsZWFyOiBmdW5jdGlvbiAoaW52ZXJ0LCBjYW52YXMsIGNhbGxiYWNrKSB7XG4gICAgdGhpcy5hc3luY3Jvbm91cyhmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLl9maWxsKFswLCAwLCAwLCAwXSwgaW52ZXJ0LCBjYW52YXMpO1xuICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2suY2FsbCh0aGlzKTtcbiAgICB9LmJpbmQodGhpcyksIDApO1xuICB9LFxuICByZW5kZXI6IGZ1bmN0aW9uIChub0JvcmRlcikge1xuICAgIGlmICghdGhpcy5jb250ZXh0IHx8ICF0aGlzLm1hc2spcmV0dXJuO1xuXG4gICAgdmFyIGN0eCA9IHRoaXMuY29udGV4dDtcbiAgICBpZiAoIW5vQm9yZGVyKSB7XG4gICAgICB0aGlzLm1hc2suY2FjaGVJbmQgPSBNYWdpY1dhbmQuZ2V0Qm9yZGVySW5kaWNlcyh0aGlzLm1hc2spO1xuICAgIH1cbiAgICBjdHguY2xlYXJSZWN0KDAsIDAsIHRoaXMubWFzay53aWR0aCwgdGhpcy5tYXNrLmhlaWdodCk7XG5cbiAgICB2YXIgX25ld19jb2xvciA9ICghdGhpcy5vbGRNYXNrIHx8IHRoaXMucGF0aGZpbmRlck1vZGUgPT0gXCJuZXdcIiB8fCB0aGlzLnBhdGhmaW5kZXJNb2RlID09IFwiYWRkXCJ8fCB0aGlzLnBhdGhmaW5kZXJNb2RlID09IFwiZXhjbHVkZVwiKVxuICAgICAgPyB0aGlzLm5ld01hc2tDb2xvciA6IHRoaXMucmVtb3ZlZE1hc2tDb2xvcjtcblxuICAgIHZhciBfaW50ZXJzZWN0aW9uX2NvbG9yO1xuICAgIGlmKHRoaXMucGF0aGZpbmRlck1vZGUgPT0gXCJhZGRcIiB8fCB0aGlzLnBhdGhmaW5kZXJNb2RlID09IFwibmV3XCJ8fCB0aGlzLnBhdGhmaW5kZXJNb2RlID09IFwiaW50ZXJzZWN0XCIpe1xuICAgICAgX2ludGVyc2VjdGlvbl9jb2xvciA9IHRoaXMubmV3TWFza0NvbG9yO1xuICAgIH1lbHNle1xuICAgICAgX2ludGVyc2VjdGlvbl9jb2xvciA9IHRoaXMucmVtb3ZlZE1hc2tDb2xvciA7Ly9pbnRlcnNlY3Rpb25SZW1vdmVkTWFza0NvbG9yO1xuICAgIH1cbiAgICB2YXIgX29sZF9jb2xvcjtcbiAgICBpZih0aGlzLnBhdGhmaW5kZXJNb2RlID09IFwiZXhjbHVkZVwiIHx8IHRoaXMucGF0aGZpbmRlck1vZGUgPT0gXCJzdWJzdHJhY3RcInx8IHRoaXMucGF0aGZpbmRlck1vZGUgPT0gXCJhZGRcIil7XG4gICAgICBfb2xkX2NvbG9yID0gdGhpcy5uZXdNYXNrQ29sb3I7XG4gICAgfWVsc2V7XG4gICAgICBfb2xkX2NvbG9yID0gdGhpcy5yZW1vdmVkTWFza0NvbG9yO1xuICAgIH1cblxuICAgIHRoaXMub2xkTWFzayAmJiB0aGlzLm9sZE1hc2sucmVuZGVyKGN0eCx7XG4gICAgICBmaWxsOiBfb2xkX2NvbG9yXG4gICAgfSk7XG5cblxuICAgIHRoaXMubWFzay5yZW5kZXIoY3R4LHtcbiAgICAgIGZpbGw6IF9uZXdfY29sb3IsXG4gICAgICBpbnRlcnNlY3Rpb25Db2xvciA6IF9pbnRlcnNlY3Rpb25fY29sb3IsXG4gICAgICBvdXRlckludGVyc2VjdGlvbkNvbG9yIDogX29sZF9jb2xvcixcbiAgICAgIC8vIG91dGVyRmlsbCA6IFwicmdiYSgwLDAsMCwwLjUpXCJcbiAgICB9KTtcblxuICAgIGlmKHRoaXMucmVuZGVyQm9yZGVyKXtcbiAgICAgIHRoaXMub2xkTWFzayAmJiB0aGlzLm9sZE1hc2sucmVuZGVyQm9yZGVyKGN0eCx7fSk7XG5cbiAgICAgIHRoaXMubWFzay5yZW5kZXJCb3JkZXIoY3R4LHtcbiAgICAgICAgaGF0Y2hPZmZzZXQ6IHRoaXMuaGF0Y2hPZmZzZXRcbiAgICAgIH0pO1xuICAgIH1cblxuICB9LFxuICByZW5kZXJCb3JkZXI6IHRydWUsXG4gIGludGVyc2VjdGlvblJlbW92ZWRNYXNrQ29sb3I6ICcjZmZhYWFhJyxcbiAgcmVtb3ZlZE1hc2tDb2xvcjogJyNhYWFhZmYnLFxuICBuZXdNYXNrQ29sb3I6ICAnI2FhRkZhYScgLFxuICByZW5kZXJNYXNrOiBmdW5jdGlvbiAoY3R4LCBtYXNrLCBjb2xvciwgbGVmdCwgdG9wKSB7XG4gICAgbWFzayA9IG1hc2sgfHwgdGhpcy5tYXNrO1xuICAgIG1hc2sgJiYgbWFzay5yZW5kZXIoY3R4LHtcbiAgICAgIGludGVyc2VjdGlvbkNvbG9yOiAnI2ZmZicsXG4gICAgICBvdXRlckludGVyc2VjdGlvbkNvbG9yOiAnIzAwMCcsXG4gICAgICBmaWxsIDpjb2xvciB8fCAnI2ZmZicsXG4gICAgICBsZWZ0IDogbGVmdCxcbiAgICAgIHRvcCA6IHRvcFxuICAgIH0pXG4gIH0sXG4gIGdldENvbnRvdXJzOiBmdW5jdGlvbiAoKSB7XG4gICAgaWYgKCF0aGlzLl9fY3MpIHtcbiAgICAgIHRoaXMuX19jcyA9IE1hZ2ljV2FuZC50cmFjZUNvbnRvdXJzKHRoaXMubWFzayk7XG4gICAgICB0aGlzLl9fY3MgPSBNYWdpY1dhbmQuc2ltcGxpZnlDb250b3Vycyh0aGlzLl9fY3MsIHRoaXMuc2ltcGxpZnlUb2xlcmFudCwgdGhpcy5zaW1wbGlmeUNvdW50KTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuX19jcztcbiAgfSxcbiAgdHJhY2VJbm5lcjogZnVuY3Rpb24gKGN0eCkge1xuXG4gICAgdmFyIGNzID0gdGhpcy5nZXRDb250b3VycygpO1xuICAgIHZhciBjdHggPSBjdHggfHwgdGhpcy5jb250ZXh0O1xuICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAoIWNzW2ldLmlubmVyKSBjb250aW51ZTtcbiAgICAgIHZhciBwcyA9IGNzW2ldLnBvaW50cztcbiAgICAgIGN0eC5tb3ZlVG8ocHNbMF0ueCwgcHNbMF0ueSk7XG4gICAgICBmb3IgKHZhciBqID0gMTsgaiA8IHBzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgIGN0eC5saW5lVG8ocHNbal0ueCwgcHNbal0ueSk7XG4gICAgICB9XG4gICAgfVxuICAgIGN0eC5zdHJva2UoKTtcbiAgfSxcbiAgZ2V0Q29sb3I6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gJ3JnYmEoJyArIHRoaXMuY29sb3Iuam9pbignLCAnKSArICcpJztcbiAgfSxcbiAgc2V0Q29sb3I6IGZ1bmN0aW9uIChjb2xvcikge1xuICAgIHZhciBfYXJyID0gY29sb3Iuc3Vic3RyaW5nKGNvbG9yLmluZGV4T2YoJygnKSArIDEsIGNvbG9yLmxlbmd0aCAtIDEpLnNwbGl0KCcsICcpO1xuICAgIGZvciAodmFyIGkgaW4gX2Fycikge1xuICAgICAgX2FycltpXSA9IHBhcnNlRmxvYXQoX2FycltpXSk7XG4gICAgfVxuICAgIF9hcnJbM10gPSBNYXRoLnJvdW5kKF9hcnJbM10gKiAyNTUpO1xuICAgIHRoaXMuY29sb3IgPSBfYXJyO1xuICB9LFxuICB0cmFjZTogZnVuY3Rpb24gKGN0eCkge1xuICAgIHZhciBpbmZvID0gdGhpcy5nZXRJbmZvKCk7XG4gICAgdmFyIGNzID0gTWFnaWNXYW5kLnRyYWNlQ29udG91cnModGhpcy5tYXNrKTtcbiAgICBjcyA9IE1hZ2ljV2FuZC5zaW1wbGlmeUNvbnRvdXJzKGNzLCB0aGlzLnNpbXBsaWZ5VG9sZXJhbnQsIHRoaXMuc2ltcGxpZnlDb3VudCk7XG5cbiAgICAvLyBkcmF3IGNvbnRvdXJzXG4gICAgdmFyIGN0eCA9IGN0eCB8fCB0aGlzLmNvbnRleHQ7XG4gICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBpbmZvLndpZHRoLCBpbmZvLmhlaWdodCk7XG4gICAgLy9pbm5lclxuICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBpZiAoIWNzW2ldLmlubmVyKSBjb250aW51ZTtcbiAgICAgIHZhciBwcyA9IGNzW2ldLnBvaW50cztcbiAgICAgIGN0eC5tb3ZlVG8ocHNbMF0ueCwgcHNbMF0ueSk7XG4gICAgICBmb3IgKHZhciBqID0gMTsgaiA8IHBzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgIGN0eC5saW5lVG8ocHNbal0ueCwgcHNbal0ueSk7XG4gICAgICB9XG4gICAgfVxuICAgIGN0eC5zdHJva2VTdHlsZSA9ICdyZWQnO1xuICAgIGN0eC5zdHJva2UoKTtcbiAgICAvL291dGVyXG4gICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY3MubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmIChjc1tpXS5pbm5lcikgY29udGludWU7XG4gICAgICB2YXIgcHMgPSBjc1tpXS5wb2ludHM7XG4gICAgICBjdHgubW92ZVRvKHBzWzBdLngsIHBzWzBdLnkpO1xuICAgICAgZm9yICh2YXIgaiA9IDE7IGogPCBwcy5sZW5ndGg7IGorKykge1xuICAgICAgICBjdHgubGluZVRvKHBzW2pdLngsIHBzW2pdLnkpO1xuICAgICAgfVxuICAgIH1cbiAgICBjdHguc3Ryb2tlU3R5bGUgPSAnYmx1ZSc7XG4gICAgY3R4LnN0cm9rZSgpO1xuICB9LFxuICByZW1vdmVOb2lzZTogZnVuY3Rpb24gKHRocmVzaG9sZCkge1xuXG4gICAgaWYoIXRoaXMubWFzayB8fCAhdGhpcy5tYXNrLmNvdW50KXJldHVybjtcbiAgICB0aGlzLmNyZWF0ZVNlbGVjdGlvbkRyYXdDYW52YXMoKTtcbiAgICAvL3RoaXMucmVuZGVyTWFzayh0aGlzLnNlbGVjdGlvbkRyYXdDb250ZXh0LCB0aGlzLm1hc2spO1xuXG4gICAgdmFyIGNzID0gTWFnaWNXYW5kLnRyYWNlQ29udG91cnModGhpcy5tYXNrKTtcbiAgICBjcyA9IE1hZ2ljV2FuZC5zaW1wbGlmeUNvbnRvdXJzKGNzLCB0aGlzLnNpbXBsaWZ5VG9sZXJhbnQsIHRoaXMuc2ltcGxpZnlDb3VudCk7XG5cbiAgICB2YXIgY3R4ID0gdGhpcy5zZWxlY3Rpb25EcmF3Q29udGV4dCwgdiA9IHRoaXMuY2FudmFzLnZpZXdwb3J0VHJhbnNmb3JtO1xuXG4gICAgLy8gIGNzID0gTWFnaWNXYW5kLnNpbXBsaWZ5Q29udG91cnMoY3MsIHRoaXMuc2ltcGxpZnlUb2xlcmFudCwgdGhpcy5zaW1wbGlmeUNvdW50KTtcblxuICAgIGN0eC5zYXZlKCk7XG4gICAgY3R4LnRyYW5zbGF0ZSgwLjUsMC41KTtcbiAgICBjdHguZmlsbFN0eWxlPSBcIiNmZmZcIjtcbiAgICAvL2N0eC5maWxsU3R5bGU9IFwiIzBmMFwiO1xuICAgIGN0eC5zdHJva2VTdHlsZT0gXCIjZmZmXCI7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjcy5sZW5ndGg7IGkrKykge1xuICAgICAgaWYgKCFjc1tpXS5pbm5lciAmJiBjc1tpXS5wb2ludHMubGVuZ3RoID4gdGhyZXNob2xkKSB7XG4gICAgICAgIHZhciBwcyA9IGNzW2ldLnBvaW50cztcbiAgICAgICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgICAgICBjdHgubW92ZVRvKHBzWzBdLngsIHBzWzBdLnkpO1xuICAgICAgICBmb3IgKHZhciBqID0gMTsgaiA8IHBzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgY3R4LmxpbmVUbyhwc1tqXS54LCBwc1tqXS55KTtcbiAgICAgICAgfVxuICAgICAgICBjdHguY2xvc2VQYXRoKCk7XG4gICAgICAgIGN0eC5maWxsKCk7XG4gICAgICB9XG5cbiAgICB9XG4gICAgdGhpcy5tYXNrID0gTWFnaWNXYW5kLm1hc2tTZWxlY3Rpb24oIHRoaXMuc2VsZWN0aW9uRHJhd0NhbnZhcyk7XG4gICAgdGhpcy5zZXRTZWxlY3Rpb24odGhpcy5tYXNrKTtcblxuICAgIGN0eC5yZXN0b3JlKCk7XG4gIH1cbn07XG5cbmZhYnJpYy51dGlsLm9ic2VydmFibGUoUGF0aGZpbmRlci5wcm90b3R5cGUpO1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKFBhdGhmaW5kZXIucHJvdG90eXBlLCB7XG4gIHNlbGVjdEJhY2tncm91bmQ6IGZ1bmN0aW9uIChmcm9tQ29ybmVycykge1xuICAgIHZhciBpbmZvID0gdGhpcy5nZXRJbmZvKCksIG1hc2s7XG5cbiAgICBpZiAoZnJvbUNvcm5lcnMpIHtcbiAgICAgIHZhciBtYXNrMSA9IE1hZ2ljV2FuZC5zZWxlY3RCYWNrZ3JvdW5kKGluZm8sIFsyNTUsIDI1NSwgMjU1LCBmYWxzZV0sIHRoaXMuY29sb3JUaHJlc2hvbGQpO1xuICAgICAgdmFyIG1hc2syID0gTWFnaWNXYW5kLnNlbGVjdEJhY2tncm91bmQoaW5mbywgW2ZhbHNlLCBmYWxzZSwgZmFsc2UsIDBdLCB0aGlzLmNvbG9yVGhyZXNob2xkKTtcbiAgICAgIG1hc2sgPSBNYWdpY1dhbmQuYWRkKG1hc2sxLCBtYXNrMik7XG4gICAgfSBlbHNlIHtcbiAgICAgIG1hc2sgPSBNYWdpY1dhbmQuc2VsZWN0QWxsQnlDb2xvcihpbmZvLCBbMjU1LCAyNTUsIDI1NSwgMjU1XSwgdGhpcy5jb2xvclRocmVzaG9sZCk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuYmx1clJhZGl1cykge1xuICAgICAgbWFzayA9IE1hZ2ljV2FuZC5nYXVzc0JsdXJPbmx5Qm9yZGVyKG1hc2ssIHRoaXMuYmx1clJhZGl1cyk7XG4gICAgfVxuICAgIHRoaXMuc2V0U2VsZWN0aW9uKG1hc2spO1xuICB9LFxuICBjb2xvclNlbGVjdGlvbjogZnVuY3Rpb24gKGNvbG9ycywgdGhyZXNob2xkKSB7XG4gICAgdmFyIGluZm8gPSB0aGlzLmdldEluZm8oKSwgbWFzazIsXG4gICAgICBtYXNrID0gTWFnaWNXYW5kLmNyZWF0ZU1hc2soaW5mby53aWR0aCwgaW5mby5oZWlnaHQpO1xuICAgIGZvciAodmFyIGkgaW4gY29sb3JzKSB7XG4gICAgICB2YXIgX2NvbG9yID0gbmV3IGZhYnJpYy5Db2xvcihjb2xvcnNbaV0pLl9zb3VyY2U7XG4gICAgICBfY29sb3JbM10gPSBNYXRoLnJvdW5kKF9jb2xvclszXSAqIDI1NSk7XG4gICAgICBtYXNrMiA9IE1hZ2ljV2FuZC5zZWxlY3RBbGxCeUNvbG9yKGluZm8sIF9jb2xvciwgdGhyZXNob2xkW2ldKVxuICAgICAgbWFzayA9IE1hZ2ljV2FuZC5hZGQobWFzaywgbWFzazIpO1xuICAgIH1cbiAgICBkZWxldGUgdGhpcy5vbGRNYXNrO1xuICAgIHRoaXMubW9kaWZ5U2VsZWN0aW9uKG1hc2spO1xuICB9LFxuICBzbWFydFNlbGVjdGlvbjogZnVuY3Rpb24gKHRocmVzaG9sZCkge1xuICAgIHZhciBpbmZvID0gdGhpcy5nZXRJbmZvKCksIG1hc2s7XG4gICAgbWFzayA9IE1hZ2ljV2FuZC5zZWxlY3RCYWNrZ3JvdW5kKGluZm8sIG51bGwsIHRocmVzaG9sZCB8fCB0aGlzLmNvbG9yVGhyZXNob2xkKTtcbiAgICBtYXNrID0gTWFnaWNXYW5kLmludmVydE1hc2sobWFzayk7XG4gICAgZGVsZXRlIHRoaXMub2xkTWFzaztcbiAgICB0aGlzLm1vZGlmeVNlbGVjdGlvbihtYXNrKTtcbiAgfVxufSk7XG5cblxuUGF0aGZpbmRlci5wcm90b3R5cGUudG9vbHMgPSB7XG5cbiAgYnJ1c2g6IHtcbiAgICBtb3VzZVVwOiBmdW5jdGlvbigpe1xuICAgICAgdGhpcy5tb2RpZnlTZWxlY3Rpb24oKTtcbiAgICAgIHRoaXMucmVzZXRTZWxlY3Rpb25EcmF3Q2FudmFzKCk7XG4gICAgfSxcbiAgICBtb3VzZU1vdmU6IGZ1bmN0aW9uKHApe1xuICAgICAgaWYgKCF0aGlzLmFsbG93RHJhdykgcmV0dXJuO1xuICAgICAgdGhpcy5kcmF3Q2lyY2xlKHAueCwgcC55LCB0aGlzLnJhZGl1cyk7XG4gICAgfSxcbiAgICBtb3VzZURvd246IGZ1bmN0aW9uKHBvaW50KXtcbiAgICAgIHRoaXMuY3JlYXRlU2VsZWN0aW9uKCk7XG4gICAgICB0aGlzLmRvd25Qb2ludCA9IHBvaW50O1xuICAgICAgdGhpcy5jcmVhdGVTZWxlY3Rpb25EcmF3Q2FudmFzKCk7XG4gICAgICB0aGlzLmRyYXdDaXJjbGUocG9pbnQueCwgcG9pbnQueSwgdGhpcy5yYWRpdXMpO1xuICAgIH0sXG4gICAgdXRpbHM6IHtcbiAgICAgIGRyYXdDaXJjbGU6IGZ1bmN0aW9uICh4LCB5LCByKSB7XG4gICAgICAgIHZhciBjdHggPSB0aGlzLnNlbGVjdGlvbkRyYXdDb250ZXh0LFxuICAgICAgICAgIHYgPSB0aGlzLmNhbnZhcy52aWV3cG9ydFRyYW5zZm9ybTtcbiAgICAgICAgY3R4LnNhdmUoKTtcbiAgICAgICAgLy8gIGN0eC50cmFuc2Zvcm0odlswXSwgdlsxXSwgdlsyXSwgdlszXSwgdls0XSwgdls1XSk7XG4gICAgICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICAgICAgY3R4LmFyYyh4LCB5LCB0aGlzLnJhZGl1cywgMCwgTWF0aC5QSSAqIDIsIGZhbHNlKTtcbiAgICAgICAgY3R4LmNsb3NlUGF0aCgpO1xuICAgICAgICBjdHguZmlsbCgpO1xuICAgICAgICBjdHgucmVzdG9yZSgpO1xuICAgICAgICBNYWdpY1dhbmQubWFza1NlbGVjdGlvbiggdGhpcy5zZWxlY3Rpb25EcmF3Q2FudmFzLCAwLDAsIHRoaXMubWFzaywgJ2FkZCcpO1xuICAgICAgICB0aGlzLnNldFNlbGVjdGlvbih0aGlzLm1hc2spO1xuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgbWFnaWM6IHtcbiAgICBtb3VzZVVwOiBmdW5jdGlvbigpe1xuICAgICAgdGhpcy5zaG91bGRNb2RpZnkgPSB0cnVlO1xuICAgIH0sXG4gICAgbW91c2VNb3ZlOiBmdW5jdGlvbiAocCl7XG4gICAgICBpZiAoIXRoaXMuYWxsb3dEcmF3KSByZXR1cm47XG4gICAgICB2YXIgZGlzdCA9IHAueCAtIHRoaXMuZG93blBvaW50Lng7XG5cbiAgICAgIHZhciB2YWwgPSB0aGlzLl9pbml0X3RocmVzICsgZGlzdDtcbiAgICAgIHZhciB0aHJlcyA9IE1hdGgubWluKE1hdGgubWF4KHZhbCwgMSksIDI1NSk7XG4gICAgICBpZiAodGhyZXMgIT0gdGhpcy5jb2xvclRocmVzaG9sZCkge1xuICAgICAgICB0aGlzLnNldFRocmVzaG9sZCh0aHJlcyk7XG4gICAgICB9XG4gICAgfSxcbiAgICBtb3VzZURvd246IGZ1bmN0aW9uIChwb2ludCl7XG4gICAgICBpZiAodGhpcy5zaG91bGRNb2RpZnkpIHtcbiAgICAgICAgdGhpcy5tb2RpZnlTZWxlY3Rpb24oKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuZG93blBvaW50ID0gcG9pbnQ7XG4gICAgICB0aGlzLmNvbG9yVGhyZXNob2xkID0gMTU7XG4gICAgICB0aGlzLmZpcmUoJ3RocmVzaG9sZDpjaGFuZ2VkJywge3RocmVzaG9sZDogdGhpcy5jb2xvclRocmVzaG9sZH0pO1xuICAgICAgdGhpcy5faW5pdF90aHJlcyA9IHRoaXMuY29sb3JUaHJlc2hvbGQ7XG4gICAgICB0aGlzLmRyYXdNYXNrKHRoaXMuZG93blBvaW50LngsIHRoaXMuZG93blBvaW50LnksIHRoaXMuYWRqYWNlbnRQaXhlbHMpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0sXG4gICAgdXRpbHM6e1xuICAgICAgZHJhd01hc2s6IGZ1bmN0aW9uICh4LCB5LCBhZGphY2VudFBpeGVscykge1xuICAgICAgICB0aGlzLmFzeW5jcm9ub3VzKHRoaXMuX2RyYXdNYXNrLmJpbmQodGhpcywgeCwgeSwgYWRqYWNlbnRQaXhlbHMpLCAwKTtcbiAgICAgIH0sXG4gICAgICBfZHJhd01hc2s6IGZ1bmN0aW9uICh4LCB5LCBhZGphY2VudFBpeGVscykge1xuICAgICAgICBNYWdpY1dhbmQuYWxwaGFDaGFubmVsID0gdGhpcy5hbHBoYUNoYW5uZWw7XG4gICAgICAgIHZhciBpbmZvID0gdGhpcy5nZXRJbmZvKCksIG1hc2s7XG4gICAgICAgIGlmIChhZGphY2VudFBpeGVscykge1xuICAgICAgICAgIE1hZ2ljV2FuZC5mbG9vZEZpbGwoaW5mbywgeCwgeSwgdGhpcy5jb2xvclRocmVzaG9sZCx7fSxudWxsLGZ1bmN0aW9uKG1hc2spe1xuICAgICAgICAgICAgdGhpcy5zZXRTZWxlY3Rpb24obWFzayk7XG4gICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBtYXNrID0gTWFnaWNXYW5kLnNlbGVjdEFsbChpbmZvLCB4LCB5LCB0aGlzLmNvbG9yVGhyZXNob2xkKTtcbiAgICAgICAgICB0aGlzLnNldFNlbGVjdGlvbihtYXNrKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgcmVjdGFuZ2xlOiB7XG4gICAgbW91c2VEb3duOiBmdW5jdGlvbihwb2ludCkge1xuICAgICAgaWYgKHRoaXMuc2hvdWxkTW9kaWZ5KSB7XG4gICAgICAgIHRoaXMubW9kaWZ5U2VsZWN0aW9uKCk7XG4gICAgICB9XG4gICAgICB0aGlzLmRvd25Qb2ludCA9IHBvaW50O1xuICAgICAgdGhpcy5zaG91bGRNb2RpZnkgPSB0cnVlO1xuICAgIH0sXG4gICAgbW91c2VVcDogZnVuY3Rpb24oKXtcbiAgICAgIC8vdGhpcy5tb2RpZnlTZWxlY3Rpb24oKTtcbiAgICAgIC8vdGhpcy5yZXNldFNlbGVjdGlvbkRyYXdDYW52YXMoKTtcbiAgICB9LFxuICAgIG1vdXNlTW92ZTogZnVuY3Rpb24ocCl7XG4gICAgICBpZiAoIXRoaXMuYWxsb3dEcmF3KSByZXR1cm47XG4gICAgICB0aGlzLmRyYXdSZWN0YW5nbGUodGhpcy5kb3duUG9pbnQueCwgdGhpcy5kb3duUG9pbnQueSwgcC54LCBwLnkpO1xuICAgIH0sXG4gICAgdXRpbHM6e1xuICAgICAgZHJhd1JlY3RhbmdsZTogZnVuY3Rpb24gKHgsIHksIHgyLCB5Mikge1xuICAgICAgICB2YXIgaW5mbyA9IHRoaXMuZ2V0SW5mbygpLFxuICAgICAgICAgIG1hc2sgPSBNYWdpY1dhbmQuc2VsZWN0UmVjdGFuZ2xlKGluZm8sIHgsIHksIHgyLCB5Mik7XG4gICAgICAgIHRoaXMuc2V0U2VsZWN0aW9uKG1hc2spO1xuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgY2lyY2xlOiB7XG4gICAgbW91c2VEb3duOiBmdW5jdGlvbihwb2ludCkge1xuICAgICAgaWYgKHRoaXMuc2hvdWxkTW9kaWZ5KSB7XG4gICAgICAgIHRoaXMubW9kaWZ5U2VsZWN0aW9uKCk7XG4gICAgICB9XG4gICAgICB0aGlzLmRvd25Qb2ludCA9IHBvaW50O1xuICAgICAgdGhpcy5jcmVhdGVTZWxlY3Rpb25EcmF3Q2FudmFzKCk7XG4gICAgICB0aGlzLnNlbGVjdGlvbk9iamVjdCA9IG5ldyBmYWJyaWMuRWxsaXBzZSh7XG4gICAgICAgIGxlZnQ6IHBvaW50LnggKyB0aGlzLnRhcmdldC5sZWZ0LFxuICAgICAgICB0b3A6ICBwb2ludC55ICsgdGhpcy50YXJnZXQudG9wLFxuICAgICAgICByeDoxLFxuICAgICAgICByeToxLFxuICAgICAgICBoYXNCb3JkZXJzOiBmYWxzZSxcbiAgICAgICAgb3JpZ2luWDogJ2NlbnRlcicsXG4gICAgICAgIG9yaWdpblk6ICdjZW50ZXInLFxuICAgICAgICBzdHJva2VXaWR0aDogMSxcbiAgICAgICAgZmlsbDogJ3RyYW5zcGFyZW50JyxcbiAgICAgICAgc3Ryb2tlOiAndHJhbnNwYXJlbnQnXG4gICAgICB9KTtcbiAgICAgIHRoaXMuY2FudmFzLmFkZCh0aGlzLnNlbGVjdGlvbk9iamVjdCk7XG4gICAgICB0aGlzLnVwZGF0ZVNoYXBlKCk7XG4gICAgfSxcbiAgICBtb3VzZVVwOiBmdW5jdGlvbigpe1xuICAgICAgdGhpcy5jYW52YXMuc2V0SW50ZXJhY3RpdmVNb2RlKFwibWl4ZWRcIik7XG4gICAgICB0aGlzLnNlbGVjdGlvbk9iamVjdC5zZXRDb29yZHMoKTtcbiAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICB0aGlzLnNlbGVjdGlvbk9iamVjdC5vbignc2NhbGluZyBtb3Zpbmcgcm90YXRpbmcnLGZ1bmN0aW9uKCl7XG4gICAgICAgIF90aGlzLnVwZGF0ZVNoYXBlKCk7XG4gICAgICB9KTtcbiAgICAgIHRoaXMuY2FudmFzLnNldEFjdGl2ZU9iamVjdCh0aGlzLnNlbGVjdGlvbk9iamVjdCk7XG4gICAgICB0aGlzLnNob3VsZE1vZGlmeSA9IHRydWU7XG4gICAgICAvLyAgdGhpcy5tb2RpZnlTZWxlY3Rpb24oKTtcbiAgICAgIC8vICB0aGlzLnJlc2V0U2VsZWN0aW9uRHJhd0NhbnZhcygpO1xuICAgIH0sXG4gICAgbW91c2VNb3ZlOiBmdW5jdGlvbihwKXtcbiAgICAgIGlmICghdGhpcy5hbGxvd0RyYXcpIHJldHVybjtcbiAgICAgIHRoaXMuc2VsZWN0aW9uT2JqZWN0LnNldCh7XG4gICAgICAgIHJ4OiBNYXRoLmFicygocC54ICsgdGhpcy50YXJnZXQubGVmdCAtICB0aGlzLnNlbGVjdGlvbk9iamVjdC5nZXQoJ2xlZnQnKSkpICxcbiAgICAgICAgcnk6IE1hdGguYWJzKChwLnkgKyB0aGlzLnRhcmdldC50b3AgIC0gdGhpcy5zZWxlY3Rpb25PYmplY3QuZ2V0KCd0b3AnKSkpXG4gICAgICB9KTtcblxuICAgICAgdGhpcy51cGRhdGVTaGFwZSgpO1xuXG4gICAgfSxcbiAgICB1dGlsczp7XG4gICAgICB1cGRhdGVTaGFwZTogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnJlc2V0U2VsZWN0aW9uRHJhd0NhbnZhcygpO1xuICAgICAgICB0aGlzLnNlbGVjdGlvbk9iamVjdC5maWxsID0gJ3doaXRlJztcbiAgICAgICAgdGhpcy5zZWxlY3Rpb25EcmF3Q29udGV4dC5zYXZlKCk7XG4gICAgICAgIHRoaXMuc2VsZWN0aW9uRHJhd0NvbnRleHQudHJhbnNsYXRlKC10aGlzLnRhcmdldC5sZWZ0LCAtIHRoaXMudGFyZ2V0LnRvcCk7XG4gICAgICAgIHRoaXMuc2VsZWN0aW9uT2JqZWN0LnJlbmRlcih0aGlzLnNlbGVjdGlvbkRyYXdDb250ZXh0KTtcbiAgICAgICAgdGhpcy5zZWxlY3Rpb25EcmF3Q29udGV4dC5yZXN0b3JlKCk7XG4gICAgICAgIHRoaXMuc2VsZWN0aW9uT2JqZWN0LmZpbGwgPSAndHJhbnNwYXJlbnQnO1xuICAgICAgICB0aGlzLm1hc2sgPSBNYWdpY1dhbmQubWFza1NlbGVjdGlvbiggdGhpcy5zZWxlY3Rpb25EcmF3Q2FudmFzKTtcbiAgICAgICAgdGhpcy5zZXRTZWxlY3Rpb24odGhpcy5tYXNrKTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIGxhc3NvOiB7XG4gICAgbW91c2VVcDogZnVuY3Rpb24oKXtcbiAgICAgIGlmKHRoaXMucmVhZHlUb0Nsb3NlUGF0aCkge1xuICAgICAgICB0aGlzLl9jbG9zZVBhdGgoKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIG1vdXNlTW92ZTogZnVuY3Rpb24ocCl7XG4gICAgICBpZiAoIXRoaXMuYWxsb3dEcmF3KSByZXR1cm47XG4gICAgICB0aGlzLmRyYXdMaW5lKHRoaXMuX2xhc3RfcG9pbnQsIHApXG4gICAgICB0aGlzLl9wb2ludHMucHVzaChwKTtcbiAgICAgIHRoaXMuX2xhc3RfcG9pbnQgPSBwO1xuICAgIH0sXG4gICAgbW91c2VEb3duOiBmdW5jdGlvbihwb2ludCl7XG4gICAgICBpZighdGhpcy5kb3duUG9pbnQpe1xuICAgICAgICB0aGlzLmNyZWF0ZVNlbGVjdGlvbigpO1xuICAgICAgICB0aGlzLmNyZWF0ZVNlbGVjdGlvbkRyYXdDYW52YXMoKTtcbiAgICAgICAgdGhpcy5fcGF0aF9vdXQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5kb3duUG9pbnQgPSBwb2ludDtcbiAgICAgICAgdGhpcy5fcG9pbnRzID0gW107XG4gICAgICAgIHRoaXMuc2VsZWN0aW9uRHJhd0NvbnRleHQuYmVnaW5QYXRoKCk7XG4gICAgICAgIHRoaXMuY2FudmFzLm9uKCdtb3VzZTptb3ZlJywgdGhpcy5fY2hhbmdlQ3Vyc29yT3ZlckNsb3NlUG9pbnQpO1xuICAgICAgfVxuICAgICAgaWYodGhpcy5fbGFzdF9wb2ludCl7XG4gICAgICAgIGlmKHRoaXMucmVhZHlUb0Nsb3NlUGF0aCl7XG4gICAgICAgICAgdGhpcy5fY2xvc2VQYXRoKCk7XG4gICAgICAgIH1lbHNle1xuICAgICAgICAgIHRoaXMuZHJhd0xpbmUodGhpcy5fbGFzdF9wb2ludCwgcG9pbnQpXG4gICAgICAgICAgdGhpcy5fbGFzdF9wb2ludCA9IHBvaW50O1xuICAgICAgICAgIHRoaXMuX3BvaW50cy5wdXNoKHBvaW50KTtcbiAgICAgICAgfVxuICAgICAgfWVsc2V7XG5cbiAgICAgICAgdGhpcy5kcmF3TGluZSh7eDpwb2ludC54IC0gMC41LHk6IHBvaW50Lnl9LCB7eDpwb2ludC54ICsgMC41LHk6IHBvaW50LnkgfSlcbiAgICAgICAgdGhpcy5fbGFzdF9wb2ludCA9IHt4OnBvaW50LnggKyAwLjUseTogcG9pbnQueSB9O1xuICAgICAgICB0aGlzLl9wb2ludHMucHVzaChwb2ludCk7XG4gICAgICAgIHRoaXMuc2hvdWxkTW9kaWZ5ID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9LFxuICAgIHV0aWxzOiB7XG4gICAgICBkcmF3TGluZTogZnVuY3Rpb24gKHAxICxwMiApIHtcbiAgICAgICAgdmFyIGN0eCA9IHRoaXMuc2VsZWN0aW9uRHJhd0NvbnRleHQsXG4gICAgICAgICAgdiA9IHRoaXMuY2FudmFzLnZpZXdwb3J0VHJhbnNmb3JtO1xuICAgICAgICBjdHguc2F2ZSgpO1xuICAgICAgICAvL2N0eC50cmFuc2Zvcm0odlswXSwgdlsxXSwgdlsyXSwgdlszXSwgdls0XSwgdls1XSk7XG4gICAgICAgIGN0eC5tb3ZlVG8ocDEueCxwMS55KTtcbiAgICAgICAgY3R4LmxpbmVUbyhwMi54LHAyLnkpO1xuICAgICAgICBjdHguc3Ryb2tlKCk7XG4gICAgICAgIGN0eC5yZXN0b3JlKCk7XG4gICAgICAgIE1hZ2ljV2FuZC5tYXNrU2VsZWN0aW9uKHRoaXMuc2VsZWN0aW9uRHJhd0NhbnZhcywwLDAsdGhpcy5tYXNrLCdhZGQnKTtcbiAgICAgICAgdGhpcy5zZXRTZWxlY3Rpb24odGhpcy5tYXNrKTtcbiAgICAgIH0sXG4gICAgICBfY2xvc2VQYXRoOiAgZnVuY3Rpb24gKGUpIHtcblxuICAgICAgICB0aGlzLmFsbG93RHJhdyA9IGZhbHNlO1xuICAgICAgICB2YXIgY3R4ID0gdGhpcy5zZWxlY3Rpb25EcmF3Q29udGV4dDtcbiAgICAgICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgICAgICBjdHgubW92ZVRvKHRoaXMuX3BvaW50c1swXS54LHRoaXMuX3BvaW50c1swXS55KVxuICAgICAgICBmb3IodmFyIGkgPSAxIDsgaSA8IHRoaXMuX3BvaW50cy5sZW5ndGg7aSArKyl7XG4gICAgICAgICAgY3R4LmxpbmVUbyh0aGlzLl9wb2ludHNbaV0ueCx0aGlzLl9wb2ludHNbaV0ueSlcbiAgICAgICAgfVxuICAgICAgICBjdHguY2xvc2VQYXRoKCk7XG4gICAgICAgIGN0eC5maWxsKCk7XG4gICAgICAgIE1hZ2ljV2FuZC5tYXNrU2VsZWN0aW9uKHRoaXMuc2VsZWN0aW9uRHJhd0NhbnZhcywwLDAsdGhpcy5tYXNrLCdhZGQnKTtcbiAgICAgICAgdGhpcy5zZXRTZWxlY3Rpb24odGhpcy5tYXNrKTtcbiAgICAgICAgdGhpcy5yZXNldFNlbGVjdGlvbkRyYXdDYW52YXMoKTtcbiAgICAgICAgdGhpcy5fcG9pbnRzID0gW107XG4gICAgICAgIGRlbGV0ZSB0aGlzLmRvd25Qb2ludDtcbiAgICAgICAgZGVsZXRlIHRoaXMucmVhZHlUb0Nsb3NlUGF0aDtcbiAgICAgICAgZGVsZXRlIHRoaXMuX2xhc3RfcG9pbnQ7XG4gICAgICAgIHRoaXMuY2FudmFzLm9mZignbW91c2U6bW92ZScsIHRoaXMuX2NoYW5nZUN1cnNvck92ZXJDbG9zZVBvaW50KTtcbiAgICAgICAgdGhpcy5jYW52YXMuZnJlZURyYXdpbmdDdXJzb3IgPSAnY3Jvc3NoYWlyJztcbiAgICAgICAgdGhpcy5jYW52YXMuc2V0Q3Vyc29yKHRoaXMuY2FudmFzLmZyZWVEcmF3aW5nQ3Vyc29yKTtcbiAgICAgICAgLy8gdGhpcy5kcmF3TGluZSh0aGlzLl9sYXN0X3BvaW50LCB0aGlzLmRvd25Qb2ludCk7XG4gICAgICB9LFxuICAgICAgX2NoYW5nZUN1cnNvck92ZXJDbG9zZVBvaW50OiAgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgdmFyIGNhbnZhcyA9IHRoaXMsXG4gICAgICAgICAgcGF0aGZpbmRlciA9IGNhbnZhcy5wYXRoZmluZGVyO1xuICAgICAgICBpZighcGF0aGZpbmRlci50YXJnZXQpcmV0dXJuO1xuICAgICAgICB2YXIgaXZ0ID0gZmFicmljLnV0aWwuaW52ZXJ0VHJhbnNmb3JtKGNhbnZhcy52aWV3cG9ydFRyYW5zZm9ybSksXG4gICAgICAgICAgcCA9IGZhYnJpYy51dGlsLnRyYW5zZm9ybVBvaW50KGNhbnZhcy5nZXRQb2ludGVyKGUuZSwgdHJ1ZSksIGl2dCk7XG4gICAgICAgIHAueCAtPSBwYXRoZmluZGVyLnRhcmdldC5sZWZ0O1xuICAgICAgICBwLnkgLT0gcGF0aGZpbmRlci50YXJnZXQudG9wO1xuICAgICAgICBpZiAoIHBhdGhmaW5kZXIuZG93blBvaW50ICYmIHBhdGhmaW5kZXIuZG93blBvaW50LmRpc3RhbmNlRnJvbShwKSA8IDEwKSB7XG4gICAgICAgICAgaWYoIXBhdGhmaW5kZXIuX3BhdGhfb3V0KXtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgcGF0aGZpbmRlci5yZWFkeVRvQ2xvc2VQYXRoID0gdHJ1ZTtcbiAgICAgICAgICBjYW52YXMuZnJlZURyYXdpbmdDdXJzb3IgPSBjYW52YXMudGFyZ2V0Q3Vyc29yO1xuICAgICAgICAgIGNhbnZhcy5zZXRDdXJzb3IoY2FudmFzLmZyZWVEcmF3aW5nQ3Vyc29yKTtcbiAgICAgICAgICAvL2NvbnNvbGUubG9nKGNhbnZhcy5mcmVlRHJhd2luZ0N1cnNvcik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcGF0aGZpbmRlci5fcGF0aF9vdXQgPSB0cnVlO1xuICAgICAgICAgIHBhdGhmaW5kZXIucmVhZHlUb0Nsb3NlUGF0aCA9IGZhbHNlO1xuICAgICAgICAgIGNhbnZhcy5mcmVlRHJhd2luZ0N1cnNvciA9ICdjcm9zc2hhaXInO1xuICAgICAgICAgIGNhbnZhcy5zZXRDdXJzb3IoY2FudmFzLmZyZWVEcmF3aW5nQ3Vyc29yKTtcbiAgICAgICAgICAvLyBjb25zb2xlLmxvZyhjYW52YXMuZnJlZURyYXdpbmdDdXJzb3IpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG59O1xuZm9yKHZhciBpIGluIFBhdGhmaW5kZXIucHJvdG90eXBlLnRvb2xzKXtcbiAgZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChQYXRoZmluZGVyLnByb3RvdHlwZSwgUGF0aGZpbmRlci5wcm90b3R5cGUudG9vbHNbaV0udXRpbHMpXG59XG5mYWJyaWMuUGF0aGZpbmRlciA9IFBhdGhmaW5kZXI7XG5cblxuXG5cbnZhciBfRklMID0gZmFicmljLlBhdGhmaW5kZXIucHJvdG90eXBlO1xuX0ZJTC5hY3Rpb25zID0ge1xuXG4gIGNhbmNlbFNlbGVjdGlvbjoge1xuICAgIHZpc2libGU6IGZhbHNlLFxuICAgIGtleTogICdFc2NhcGUnLFxuICAgIGFjdGlvbjogZnVuY3Rpb24oKXtcbiAgICAgIGRlbGV0ZSB0aGlzLnNob3VsZE1vZGlmeTtcbiAgICAgIHRoaXMubWFzayA9IE1hZ2ljV2FuZC5jcmVhdGVNYXNrKHRoaXMuZWRpdGVkSW1hZ2VDYW52YXMud2lkdGgsIHRoaXMuZWRpdGVkSW1hZ2VDYW52YXMuaGVpZ2h0KTtcbiAgICB9XG4gIH0sXG4gIG1vZGlmeVNlbGVjdGlvbjoge1xuICAgIHZpc2libGU6IGZhbHNlLFxuICAgIGtleTogICdFbnRlcicsXG4gICAgYWN0aW9uOiBmdW5jdGlvbigpe1xuICAgICAgaWYodGhpcy5zaG91bGRNb2RpZnkpe1xuICAgICAgICB0aGlzLm1vZGlmeVNlbGVjdGlvbigpO1xuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgYWRqYWNlbnRQaXhlbHM6IHtcbiAgICBjbGFzc05hbWU6ICdidXR0b24tYWRqYWNlbnQnLFxuICAgIHRpdGxlOiAnc2VsZXQgYWxsJyxcbiAgICB0eXBlOiAnY2hlY2tib3gnLFxuICAgIHZhbHVlOiAnYWRqYWNlbnRQaXhlbHMnLFxuICAgIHZpc2libGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLnNlbGVjdGlvblRvb2wgPT09ICdtYWdpYyc7XG4gICAgfSxcbiAgICBvYnNlcnZlOiAndG9vbDpjaGFuZ2VkJ1xuICB9LFxuICBwYXRoZmluZGVyUmFkaXVzOiB7XG4gICAgdGl0bGU6ICdyYWRpdXMnLFxuICAgIHR5cGU6ICdyYW5nZScsXG4gICAgdmFsdWU6IHtcbiAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yYWRpdXNcbiAgICAgIH0sXG4gICAgICBzZXQ6IGZ1bmN0aW9uICh2YWwpIHtcbiAgICAgICAgdGhpcy5yYWRpdXMgPSB2YWw7XG4gICAgICB9LFxuICAgICAgbWluOiAxLFxuICAgICAgbWF4OiAyNTVcbiAgICB9LFxuICAgIHZpc2libGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLnNlbGVjdGlvblRvb2wgPT09ICdicnVzaCc7XG4gICAgfSxcbiAgICBvYnNlcnZlOiAndG9vbDpjaGFuZ2VkJ1xuICB9LFxuICBwYXRoZmluZGVyVGhyZXNob2xkOiB7XG4gICAgdGl0bGU6ICdUaHJlc2hvbGQnLFxuICAgIHR5cGU6ICdyYW5nZScsXG4gICAgdmFsdWU6IHtcbiAgICAgIG9ic2VydmU6ICd0aHJlc2hvbGQ6Y2hhbmdlZCcsXG4gICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29sb3JUaHJlc2hvbGRcbiAgICAgIH0sXG4gICAgICBzZXQ6IGZ1bmN0aW9uICh2YWwpIHtcbiAgICAgICAgdGhpcy5zZXRUaHJlc2hvbGQodmFsKTtcbiAgICAgIH0sXG4gICAgICBtaW46IDAsXG4gICAgICBtYXg6IDI1NVxuICAgIH0sXG4gICAgdmlzaWJsZTogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuc2VsZWN0aW9uVG9vbCA9PT0gJ21hZ2ljJztcbiAgICB9LFxuICAgIG9ic2VydmU6ICd0b29sOmNoYW5nZWQnXG4gIH0sXG4gIHNlbGVjdGlvblRvb2w6IHtcbiAgICB0aXRsZTogJ3NlbGVjdGlvbi10b29sJyxcbiAgICB0eXBlOiAnb3B0aW9ucycsXG4gICAgdmFsdWU6ICdzZWxlY3Rpb25Ub29sJyxcbiAgICBtZW51OiB7XG4gICAgICBzZWxlY3Rpb25Ub29sQnJ1c2g6IHtcbiAgICAgICAgY2xhc3NOYW1lOiAnZmEgZmEtcGFpbnQtYnJ1c2gnLFxuICAgICAgICB0aXRsZTogJ3NlbGVjdC1icnVzaCcsXG4gICAgICAgIG9wdGlvbjogJ2JydXNoJ1xuICAgICAgfSxcbiAgICAgIHNlbGVjdGlvblRvb2xSZWN0YW5nbGU6IHtcbiAgICAgICAgY2xhc3NOYW1lOiAnZmEgZmEtc3F1YXJlJyxcbiAgICAgICAgdGl0bGU6ICdzZWxlY3QtcmVjdGFuZ2xlJyxcbiAgICAgICAgb3B0aW9uOiAncmVjdGFuZ2xlJ1xuICAgICAgfSxcbiAgICAgIHNlbGVjdGlvbkVsbGlwdGljYWw6IHtcbiAgICAgICAgY2xhc3NOYW1lOiAnZmEgZmEtY2lyY2xlJyxcbiAgICAgICAgdGl0bGU6ICdzZWxlY3QtY2lyY2xlJyxcbiAgICAgICAgb3B0aW9uOiAnY2lyY2xlJ1xuICAgICAgfSxcbiAgICAgIHNlbGVjdGlvblRvb2xNYWdpYzoge1xuICAgICAgICBjbGFzc05hbWU6ICdmYSBmYS1tYWdpYycsXG4gICAgICAgIHRpdGxlOiAnc2VsZWN0LW1hZ2ljJyxcbiAgICAgICAgb3B0aW9uOiAnbWFnaWMnXG4gICAgICB9LFxuICAgICAgc2VsZWN0aW9uVG9vbExhc3NvOiB7XG4gICAgICAgIHVzZTogJ3NoYXBlU2VsZWN0aW9uVG9vbHMnLFxuICAgICAgICB0aXRsZTogJ3NlbGVjdC1sYXNzbycsXG4gICAgICAgIG9wdGlvbjogJ2xhc3NvJyxcbiAgICAgICAgaWNvbjogJ2RhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsJysgcmVxdWlyZSgnYmFzZTY0LWxvYWRlciEuLy4uL21lZGlhL2xhc3NvLnN2ZycpXG5cbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIHBhdGhmaW5kZXI6IHtcbiAgICB0aXRsZTogJ3BhdGhmaW5kZXInLFxuICAgIHR5cGU6ICdvcHRpb25zJyxcbiAgICBpbnNlcnQ6ICdwYXRoZmluZGVyVG9vbHMnLFxuICAgIHZhbHVlOiAncGF0aGZpbmRlck1vZGUnLFxuICAgIG1lbnU6IHtcbiAgICAgIHBhdGhmaW5kZXJOZXc6IHtcbiAgICAgICAgdGl0bGU6ICdwYXRoZmluZGVyLW5ldycsXG4gICAgICAgIG9wdGlvbjogJ25ldydcbiAgICAgIH0sXG4gICAgICBwYXRoZmluZGVyRXhjbHVkZToge1xuICAgICAgICB0aXRsZTogJ3BhdGhmaW5kZXItZXhjbHVkZScsXG4gICAgICAgIG9wdGlvbjogJ2V4Y2x1ZGUnXG4gICAgICB9LFxuICAgICAgcGF0aGZpbmRlclN1YnN0cmFjdDoge1xuICAgICAgICB0aXRsZTogJ3BhdGhmaW5kZXItc3Vic3RyYWN0JyxcbiAgICAgICAgb3B0aW9uOiAnc3Vic3RyYWN0J1xuICAgICAgfSxcbiAgICAgIHBhdGhmaW5kZXJBZGQ6IHtcbiAgICAgICAgdGl0bGU6ICdwYXRoZmluZGVyLWFkZCcsXG4gICAgICAgIG9wdGlvbjogJ2FkZCdcbiAgICAgIH0sXG4gICAgICBwYXRoZmluZGVySW50ZXJzZWN0OiB7XG4gICAgICAgIHRpdGxlOiAncGF0aGZpbmRlci1pbnRlcnNlY3QnLFxuICAgICAgICBvcHRpb246ICdpbnRlcnNlY3QnXG4gICAgICB9XG4gICAgfVxuICB9LFxuICBwYXRoZmluZGVyRmlsbDoge1xuICAgIGluc2VydDogJ2RyYXdpbmdUb29scycsXG4gICAgdGl0bGU6ICdmaWxsV2l0aEN1cnJlbnRDb2xvcicsXG4gICAgYWN0aW9uOiBfRklMLmZpbGxXaXRoQ3VycmVudENvbG9yLFxuICAgIGNsYXNzTmFtZTogJ2ZhIGZhLXBhaW50LWJydXNoJ1xuICB9LFxuICBwYXRoZmluZGVyQ2xlYXI6IHtcbiAgICBpbnNlcnQ6ICdkcmF3aW5nVG9vbHMnLFxuICAgIGNsYXNzTmFtZTogJ2ZhIGZhLWVyYXNlcicsXG4gICAgaWQ6ICAgICAnUGF0aGZpbmRlci1jbGVhcicsXG4gICAgdGl0bGU6ICAnY2xlYXInLFxuICAgIGFjdGlvbjogX0ZJTC5jbGVhclxuICB9LFxuICBwYXRoZmluZGVyQ29sb3I6IHtcbiAgICBpbnNlcnQ6ICdkcmF3aW5nVG9vbHMnLFxuICAgIHRpdGxlOiAgJ2NvbG9yJyxcbiAgICB0eXBlOiAgICdjb2xvcicsXG4gICAgdmFsdWU6ICAnY29sb3InXG4gIH1cbn07XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLlNsaWRlQ2FudmFzLnByb3RvdHlwZSwge1xuICBzcGVjaWFsUHJvcGVydGllczogZmFicmljLlNsaWRlQ2FudmFzLnByb3RvdHlwZS5zcGVjaWFsUHJvcGVydGllcy5jb25jYXQoW1wicGF0aGZpbmRlclwiXSksXG4gIHBhdGhmaW5kZXI6IGZhbHNlLFxuICBzZXRQYXRoZmluZGVyOiBmdW5jdGlvbiAodmFsKSB7XG4gICAgaWYgKHZhbCkge1xuICAgICAgdGhpcy5wYXRoZmluZGVyID0gbmV3IGZhYnJpYy5QYXRoZmluZGVyKCdwYXRoZmluZGVyJyk7XG4gICAgICB0aGlzLnBhdGhmaW5kZXIuY2FudmFzID0gdGhpcztcbiAgICB9XG4gIH0sXG4gIGdldFBhdGhmaW5kZXI6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5wYXRoZmluZGVyIHx8IHRoaXMuYXBwbGljYXRpb24gJiYgdGhpcy5hcHBsaWNhdGlvbi5wYXRoZmluZGVyO1xuICB9XG59KTtcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuQXBwbGljYXRpb24ucHJvdG90eXBlLCB7XG4gIGluaXRQYXRoZmluZGVyOiBmdW5jdGlvbiAoKSB7XG4gICAgaWYodGhpcy5wYXRoZmluZGVyKXtcblxuICAgICAgdGhpcy5wYXRoZmluZGVyID0gbmV3IGZhYnJpYy5QYXRoZmluZGVyKHtcbiAgICAgICAgYXBwbGljYXRpb246IHRoaXNcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLnBhdGhmaW5kZXIub24oXCJpbWFnZTpjaGFuZ2VkXCIsIGZ1bmN0aW9uIChpbWcpIHtcbiAgICAgICAgdmFyIGRhdGFVcmwgPSBpbWcudG9EYXRhVVJMKCk7XG4gICAgICAgIGlmICghdGhpcy50YXJnZXQuX29yaWdpbmFsRWxlbWVudCkge1xuICAgICAgICAgIHRoaXMudGFyZ2V0Ll9vcmlnaW5hbEVsZW1lbnQgPSB0aGlzLnRhcmdldC5fZWxlbWVudDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnRhcmdldC5fZWxlbWVudCA9IG5ldyBJbWFnZSgpO1xuICAgICAgICB0aGlzLnRhcmdldC5fZWxlbWVudC5zcmMgPSBkYXRhVXJsO1xuICAgICAgICB0aGlzLnRhcmdldC5fZWRpdGVkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy50YXJnZXQuY2FudmFzICYmIHRoaXMudGFyZ2V0LmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICAgICAgdGhpcy50YXJnZXQuZmlyZShcImNvbnRlbnQ6bW9kaWZpZWRcIik7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgfVxufSk7XG5cbmZhYnJpYy5BcHBsaWNhdGlvblxuICAuYWRkUGx1Z2luKFwicG9zdGxvYWRlcnNcIixcImluaXRQYXRoZmluZGVyXCIpO1xuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9tb2R1bGVzL3BhdGhmaW5kZXIuanNcbi8vIG1vZHVsZSBpZCA9IDc3XG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIid1c2Ugc3RyaWN0JztcblxuXG52YXIgX3NldF9zYmFja2dyb3VuZF9pbWFnZV9vdmVyd3JpdHRlbiA9IGZhYnJpYy5DYW52YXMucHJvdG90eXBlLnNldEJhY2tncm91bmRJbWFnZTtcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuQ2FudmFzLnByb3RvdHlwZSwge1xuICAvKipcbiAgICogYmFja2dyb3VuZFBvc2l0aW9uXG4gICAqIEB2YWx1ZXMgbWFudWFsIHwgY292ZXIgfCBmaXRcbiAgICovXG4gIGJhY2tncm91bmRQb3NpdGlvbjogJ21hbnVhbCcsXG4gIHNldEJhY2tncm91bmRQb3NpdGlvbjogZnVuY3Rpb24gKHNyYykge1xuICAgIHRoaXMuYmFja2dyb3VuZFBvc2l0aW9uID0gc3JjO1xuICAgIHRoaXMuX3VwZGF0ZV9iYWNrZ3JvdW5kX2ltYWdlKCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG4gIG9mZnNldHM6IHtcbiAgICBsZWZ0OiAwLFxuICAgIHJpZ2h0OiAwLFxuICAgIGJvdHRvbTogMCxcbiAgICB0b3A6IDBcbiAgfSxcblxuICAvLyBzZXRCYWNrZ3JvdW5kSW1hZ2U6IGZ1bmN0aW9uIChzcmMsIGNhbGxiYWNrLCBvcHRpb25zKSB7XG4gIC8vXG4gIC8vICAgX3NldF9zYmFja2dyb3VuZF9pbWFnZV9vdmVyd3JpdHRlbi5jYWxsKHRoaXMsIHNyYywgZnVuY3Rpb24gKCkge1xuICAvLyAgICAgdGhpcy5fdXBkYXRlX2JhY2tncm91bmRfaW1hZ2UoKTtcbiAgLy8gICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKHRoaXMuYmFja2dyb3VuZEltYWdlKTtcbiAgLy8gICB9LmJpbmQodGhpcyksIG9wdGlvbnMpO1xuICAvLyAgIHJldHVybiB0aGlzO1xuICAvLyB9LFxuICBmaWxsQmFja2dyb3VuZENvbG9yT3ZlckNhbnZhczogZmFsc2UsXG4gIF9yZW5kZXJCYWNrZ3JvdW5kT3JPdmVybGF5OiBmdW5jdGlvbihjdHgsIHByb3BlcnR5KSB7XG4gICAgdmFyIG9iamVjdCA9IHRoaXNbcHJvcGVydHkgKyAnQ29sb3InXTtcbiAgICBpZiAob2JqZWN0KSB7XG4gICAgICBjdHguZmlsbFN0eWxlID0gb2JqZWN0LnRvTGl2ZVxuICAgICAgICA/IG9iamVjdC50b0xpdmUoY3R4KVxuICAgICAgICA6IG9iamVjdDtcblxuICAgICAgaWYodGhpcy5maWxsQmFja2dyb3VuZENvbG9yT3ZlckNhbnZhcyl7XG4gICAgICAgIGN0eC5maWxsUmVjdChcbiAgICAgICAgICBvYmplY3Qub2Zmc2V0WCB8fCAtdGhpcy52aWV3cG9ydFRyYW5zZm9ybVs0XS8gdGhpcy52aWV3cG9ydFRyYW5zZm9ybVswXSxcbiAgICAgICAgICBvYmplY3Qub2Zmc2V0WSB8fCAtdGhpcy52aWV3cG9ydFRyYW5zZm9ybVs1XS8gdGhpcy52aWV3cG9ydFRyYW5zZm9ybVswXSxcbiAgICAgICAgICB0aGlzLndpZHRoIC8gdGhpcy52aWV3cG9ydFRyYW5zZm9ybVswXSxcbiAgICAgICAgICB0aGlzLmhlaWdodCAgLyB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzBdKTtcbiAgICAgIH1lbHNle1xuICAgICAgICBjdHguZmlsbFJlY3QoXG4gICAgICAgICAgb2JqZWN0Lm9mZnNldFggfHwgMCxcbiAgICAgICAgICBvYmplY3Qub2Zmc2V0WSB8fCAwLFxuICAgICAgICAgIHRoaXMub3JpZ2luYWxXaWR0aCAsXG4gICAgICAgICAgdGhpcy5vcmlnaW5hbEhlaWdodCk7XG4gICAgICB9XG4gICAgfVxuICAgIG9iamVjdCA9IHRoaXNbcHJvcGVydHkgKyAnSW1hZ2UnXTtcbiAgICBpZihvYmplY3QgJiYgb2JqZWN0LmNvbnN0cnVjdG9yICE9PSBTdHJpbmcgJiYgIG9iamVjdC5jb25zdHJ1Y3RvciAhPT0gT2JqZWN0KXtcbiAgICAgICAgb2JqZWN0LnJlbmRlcihjdHgpO1xuICAgIH1cbiAgfSxcbiAgZ2V0SW1hZ2VEYXRhOiBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgIG9wdGlvbnMgPSBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKHtcbiAgICAgIGNsaXBwZWRfYXJlYTogZmFsc2UsXG4gICAgICBjbGlwcGVkX2FyZWFfb25seTogZmFsc2UsXG4gICAgICBkcmF3X2JhY2tncm91bmQ6IHRydWUsXG4gICAgICBmb3JtYXQ6ICdwbmcnLFxuICAgICAgcXVhbGl0eTogMC44XG4gICAgfSwgb3B0aW9ucyB8fCB7fSk7XG5cbiAgICB2YXIgc2l6ZTtcbiAgICBpZiAob3B0aW9ucy5jbGlwcGVkX2FyZWEpIHtcbiAgICAgIHNpemUgPSBvcHRpb25zLmNsaXBwZWRfYXJlYS5nZXRCb3VuZGluZ1JlY3QoKTtcbiAgICAgIHZhciBfem9vbSA9IHRoaXMuZ2V0Wm9vbSgpO1xuICAgICAgc2l6ZS5sZWZ0ICAgLz0gX3pvb207XG4gICAgICBzaXplLnRvcCAgICAvPSBfem9vbTtcbiAgICAgIHNpemUud2lkdGggIC89IF96b29tO1xuICAgICAgc2l6ZS5oZWlnaHQgLz0gX3pvb207XG4gICAgICBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKG9wdGlvbnMsIHNpemUpO1xuICAgIH0gZWxzZSB7XG4gICAgICBzaXplID0ge1xuICAgICAgICB3aWR0aDogb3B0aW9ucy53aWR0aCB8fCB0aGlzLm9yaWdpbmFsV2lkdGggfHwgdGhpcy53aWR0aCxcbiAgICAgICAgaGVpZ2h0OiBvcHRpb25zLmhlaWdodCB8fCB0aGlzLm9yaWdpbmFsSGVpZ2h0IHx8IHRoaXMuaGVpZ2h0LFxuICAgICAgfTtcblxuICAgICAgaWYgKG9wdGlvbnMuY2xpcHBlZF9hcmVhX29ubHkpIHtcbiAgICAgICAgc2l6ZS53aWR0aCAtPSB0aGlzLm9mZnNldHMubGVmdCArIHRoaXMub2Zmc2V0cy5yaWdodDtcbiAgICAgICAgc2l6ZS5oZWlnaHQgLT0gdGhpcy5vZmZzZXRzLnRvcCArIHRoaXMub2Zmc2V0cy5ib3R0b207XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChvcHRpb25zLnpvb20pIHtcbiAgICAgIHNpemUud2lkdGggKj0gb3B0aW9ucy56b29tO1xuICAgICAgc2l6ZS5oZWlnaHQgKj0gb3B0aW9ucy56b29tO1xuICAgIH1cblxuICAgIHZhciBjYW52YXMgPSBmYWJyaWMudXRpbC5jcmVhdGVDYW52YXNFbGVtZW50KCk7XG4gICAgY2FudmFzLndpZHRoID0gc2l6ZS53aWR0aDtcbiAgICBjYW52YXMuaGVpZ2h0ID0gc2l6ZS5oZWlnaHQ7XG5cbiAgICBvcHRpb25zLmxlZnQgPSBNYXRoLmZsb29yKG9wdGlvbnMubGVmdCk7XG4gICAgb3B0aW9ucy50b3AgPSBNYXRoLmZsb29yKG9wdGlvbnMudG9wKTtcbiAgICBvcHRpb25zLmhlaWdodCA9IE1hdGguY2VpbChvcHRpb25zLmhlaWdodCk7XG4gICAgb3B0aW9ucy53aWR0aCA9IE1hdGguY2VpbChvcHRpb25zLndpZHRoKTtcblxuICAgIHRoaXMucmVuZGVyVGh1bWIoY2FudmFzLCBvcHRpb25zKTtcblxuICAgIHZhciBzcmMgPSBjYW52YXMudG9EYXRhVVJMKG9wdGlvbnMpO1xuXG4gICAgdmFyIGJsb2IgPSBmYWJyaWMudXRpbC5kYXRhVVJJdG9CbG9iKHNyYywgJ2ltYWdlLycgKyBvcHRpb25zLmZvcm1hdCk7XG4gICAgdmFyIG9iamVjdFVSTCA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7XG4gICAgcmV0dXJuIHtcbiAgICAgIGRhdGFVUkw6IHNyYyxcbiAgICAgIGJsb2I6IGJsb2IsXG4gICAgICB1cmw6IG9iamVjdFVSTCxcbiAgICAgIGNhbnZhczogY2FudmFzXG4gICAgfTtcbiAgfSxcbiAgZ2V0T3JpZ2luYWxTaXplOiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHdpZHRoOiB0aGlzLm9yaWdpbmFsV2lkdGgsXG4gICAgICBoZWlnaHQ6IHRoaXMub3JpZ2luYWxIZWlnaHRcbiAgICB9XG4gIH0sXG5cbiAgcmVuZGVyVGh1bWI6IGZ1bmN0aW9uIChjYW52YXMsIG9wdGlvbnMpIHtcblxuICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHtcbiAgICAgICAgb2JqZWN0czogdHJ1ZSxcbiAgICAgICAgY2xpcHBlZF9hcmVhX29ubHk6IGZhbHNlLFxuICAgICAgICBkcmF3X2JhY2tncm91bmQ6IHRydWVcbiAgICAgIH07XG5cbiAgICBpZiAob3B0aW9ucy56b29tKSB7XG4gICAgICB2YXIgX3pvb20gPSBvcHRpb25zLnpvb207XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChjYW52YXMud2lkdGgpIHtcbiAgICAgICAgdmFyIF96b29tID0gY2FudmFzLndpZHRoIC8gKHRoaXMub3JpZ2luYWxXaWR0aCB8fCB0aGlzLndpZHRoKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIF96b29tID0gMTtcbiAgICAgIH1cbiAgICB9XG4gICAgdmFyIF9vbGRfU2NhbGUgPSB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzBdO1xuICAgIHZhciBvbGRfeCA9IHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bNF07XG4gICAgdmFyIG9sZF95ID0gdGhpcy52aWV3cG9ydFRyYW5zZm9ybVs1XTtcbiAgICB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzRdID0gdGhpcy52aWV3cG9ydFRyYW5zZm9ybVs1XSA9IDA7XG4gICAgdGhpcy52aWV3cG9ydFRyYW5zZm9ybVswXSA9IHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bM10gPSAxO1xuXG4gICAgdGhpcy52aWV3cG9ydFRyYW5zZm9ybVswXSA9IHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bM10gPSBfem9vbTtcbiAgICAvL3RoaXMuX3VwZGF0ZV9jbGlwX3JlY3QoKTtcblxuICAgIGlmICh0aGlzLmNsaXBSZWN0KSB7XG4gICAgICB0aGlzLmNsaXBSZWN0LnNldE9wYWNpdHkoMCk7XG4gICAgfVxuXG4gICAgdmFyIHNpemUgPSB7XG4gICAgICB3aWR0aDogdGhpcy5vcmlnaW5hbFdpZHRoIHx8IHRoaXMud2lkdGgsXG4gICAgICBoZWlnaHQ6IHRoaXMub3JpZ2luYWxIZWlnaHQgfHwgdGhpcy5oZWlnaHRcbiAgICB9O1xuICAgIHNpemUud2lkdGggPSBNYXRoLmNlaWwoc2l6ZS53aWR0aCAqIF96b29tKTtcbiAgICBzaXplLmhlaWdodCA9IE1hdGguY2VpbChzaXplLmhlaWdodCAqIF96b29tKTtcblxuICAgIHZhciBfY2FudmFzID0gZmFicmljLnV0aWwuY3JlYXRlQ2FudmFzRWxlbWVudCgpO1xuICAgIF9jYW52YXMud2lkdGggPSBzaXplLndpZHRoO1xuICAgIF9jYW52YXMuaGVpZ2h0ID0gc2l6ZS5oZWlnaHQ7XG5cbiAgICB2YXIgY2FudmFzVG9EcmF3T24gPSBfY2FudmFzLmdldENvbnRleHQoJzJkJyksIG9ianNUb1JlbmRlcjtcblxuICAgIHRoaXMuY2xlYXJDb250ZXh0KGNhbnZhc1RvRHJhd09uKTtcbiAgICBjYW52YXNUb0RyYXdPbi5zYXZlKCk7XG4gICAgY2FudmFzVG9EcmF3T24udHJhbnNmb3JtLmFwcGx5KGNhbnZhc1RvRHJhd09uLCB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtKTtcblxuICAgIGlmIChvcHRpb25zLmRyYXdfYmFja2dyb3VuZCkge1xuICAgICAgdGhpcy5fcmVuZGVyQmFja2dyb3VuZChjYW52YXNUb0RyYXdPbik7XG4gICAgICAvL2lmICh0aGlzLl9iYWNrZ3JvdW5kTGF5ZXIpIHtcbiAgICAgIC8vICB0aGlzLl9yZW5kZXJPYmplY3RzKGNhbnZhc1RvRHJhd09uLCB0aGlzLl9iYWNrZ3JvdW5kTGF5ZXIpO1xuICAgICAgLy99XG4gICAgfVxuXG4gICAgaWYgKCFvcHRpb25zLmNsaXBwZWRfYXJlYV9vbmx5ICYmIHRoaXMuY2xpcFRvKSB7XG4gICAgICBmYWJyaWMudXRpbC5jbGlwQ29udGV4dCh0aGlzLCBjYW52YXNUb0RyYXdPbik7XG4gICAgfVxuXG4gICAgdmFyIF9vYmplY3RzO1xuICAgIGlmIChvcHRpb25zLm9iamVjdHMgJiYgb3B0aW9ucy5vYmplY3RzLmNvbnN0cnVjdG9yID09PSBBcnJheSkge1xuICAgICAgX29iamVjdHMgPSBvcHRpb25zLm9iamVjdHM7XG4gICAgfSBlbHNlIHtcbiAgICAgIF9vYmplY3RzID0gb3B0aW9ucy5vYmplY3RzICE9PSBmYWxzZSA/IHRoaXMuX29iamVjdHMgOiBbXTtcbiAgICB9XG4gICAgaWYgKG9wdGlvbnMuY2xpcHBlZF9hcmVhKSB7XG4gICAgICBfb2JqZWN0cyA9IGZhYnJpYy51dGlsLm9iamVjdC5jbG9uZShfb2JqZWN0cyk7XG4gICAgICBmb3IgKHZhciBpID0gX29iamVjdHMubGVuZ3RoOyBpLS07KSB7XG4gICAgICAgIGlmIChfb2JqZWN0c1tpXS5jbGlwVG8gIT09IG9wdGlvbnMuY2xpcHBlZF9hcmVhKSB7XG4gICAgICAgICAgX29iamVjdHMuc3BsaWNlKGksIDEpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIC8vIGlmIChmYWJyaWMudmVyc2lvbiA+PSAxLjYpIHtcbiAgICAgIHRoaXMuX3JlbmRlck9iamVjdHMoY2FudmFzVG9EcmF3T24sIF9vYmplY3RzKTtcbiAgICAvLyB9IGVsc2Uge1xuICAgIC8vICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IF9vYmplY3RzLmxlbmd0aDsgaSA8IGxlbmd0aDsgKytpKSB7XG4gICAgLy8gICAgIHRoaXMuX2RyYXcoY2FudmFzVG9EcmF3T24sIF9vYmplY3RzW2ldKTtcbiAgICAvLyAgIH1cbiAgICAvLyB9XG5cblxuICAgIGNhbnZhc1RvRHJhd09uLnJlc3RvcmUoKTtcbiAgICBpZiAoIW9wdGlvbnMuY2xpcHBlZF9hcmVhX29ubHkgJiYgdGhpcy5jbGlwVG8pIHtcbiAgICAgIGNhbnZhc1RvRHJhd09uLnJlc3RvcmUoKTtcbiAgICB9XG4gICAgdGhpcy5fcmVuZGVyT3ZlcmxheShjYW52YXNUb0RyYXdPbik7XG4gICAgY2FudmFzVG9EcmF3T24ucmVzdG9yZSgpO1xuICAgIGlmICh0aGlzLmNsaXBSZWN0KSB7XG4gICAgICB0aGlzLmNsaXBSZWN0LnNldE9wYWNpdHkoMSk7XG4gICAgfVxuICAgIHZhciBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICBjdHguY2xlYXJSZWN0KDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7XG4gICAgaWYgKG9wdGlvbnMuY2xpcHBlZF9hcmVhX29ubHkgJiYgdGhpcy5jbGlwUmVjdCkge1xuICAgICAgdmFyIF9yZWN0ID0ge1xuICAgICAgICBsZWZ0OiB0aGlzLmNsaXBSZWN0LmxlZnQgKiBfem9vbSxcbiAgICAgICAgdG9wOiB0aGlzLmNsaXBSZWN0LnRvcCAqIF96b29tLFxuICAgICAgICB3aWR0aDogdGhpcy5jbGlwUmVjdC53aWR0aCAqIF96b29tLFxuICAgICAgICBoZWlnaHQ6IHRoaXMuY2xpcFJlY3QuaGVpZ2h0ICogX3pvb21cbiAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIHZhciBfcmVjdCA9IHtcbiAgICAgICAgbGVmdDogb3B0aW9ucy5sZWZ0ICogX3pvb20gfHwgMCxcbiAgICAgICAgdG9wOiBvcHRpb25zLnRvcCAqIF96b29tIHx8IDAsXG4gICAgICAgIHdpZHRoOiBvcHRpb25zLndpZHRoICogX3pvb20gfHwgc2l6ZS53aWR0aCxcbiAgICAgICAgaGVpZ2h0OiBvcHRpb25zLmhlaWdodCAqIF96b29tIHx8IHNpemUuaGVpZ2h0XG4gICAgICB9O1xuICAgIH1cbiAgICBpZiAob3B0aW9ucy5hbmdsZSkge1xuICAgICAgY3R4LnJvdGF0ZSgtb3B0aW9ucy5hbmdsZSAqIE1hdGguUEkgLyAxODApO1xuICAgICAgY3R4LmRyYXdJbWFnZShfY2FudmFzLFxuICAgICAgICAwLCAwLCBfcmVjdC53aWR0aCArIF9yZWN0LmxlZnQgKyBfY2FudmFzLndpZHRoLCBfcmVjdC5oZWlnaHQgKyBfcmVjdC50b3AgKyBfY2FudmFzLmhlaWdodCxcbiAgICAgICAgLV9yZWN0LmxlZnQsIC1fcmVjdC50b3AsIGNhbnZhcy53aWR0aCArIF9yZWN0LmxlZnQgKyBfY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0ICsgX3JlY3QudG9wICsgX2NhbnZhcy5oZWlnaHQpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjdHguZHJhd0ltYWdlKF9jYW52YXMsIF9yZWN0LmxlZnQsIF9yZWN0LnRvcCwgX3JlY3Qud2lkdGgsIF9yZWN0LmhlaWdodCwgMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTtcbiAgICB9XG5cbiAgICB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzBdID0gdGhpcy52aWV3cG9ydFRyYW5zZm9ybVszXSA9IF9vbGRfU2NhbGU7XG4gICAgLy8gdGhpcy5fdXBkYXRlX2JhY2tncm91bmRfaW1hZ2UoKTtcbiAgICAvL3RoaXMuX3VwZGF0ZV9jbGlwX3JlY3QoKTtcblxuICAgIHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bNF0gPSBvbGRfeDtcbiAgICB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzVdID0gb2xkX3k7XG5cblxuICAgIHJldHVybiBjYW52YXM7XG4gIH0sXG5cbiAgLy8gc2V0T2Zmc2V0czogZnVuY3Rpb24gKF9vZmZzZXRzKSB7XG4gIC8vICAgdGhpcy5vZmZzZXRzID0gX29mZnNldHMgfHwgZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCh7fSwgZmFicmljLlNsaWRlQ2FudmFzLnByb3RvdHlwZS5vZmZzZXRzKTtcbiAgLy8gICAvL3RoaXMuX3VwZGF0ZV9jbGlwX3JlY3QoKTtcbiAgLy8gICByZXR1cm4gdGhpcztcbiAgLy8gfSxcbiAgZ2V0UmVjdDogZnVuY3Rpb24gKG9wdGlvbnMpIHtcblxuXG4gICAgdmFyIHJlY3QgPSB7fTtcblxuICAgIHZhciBfdyA9IHRoaXMub3JpZ2luYWxXaWR0aCB8fCB0aGlzLndpZHRoOyAvL3RoaXMub3JpZ2luYWxXaWR0aFxuICAgIHZhciBfZmxleEFycmF5ID0gZmFicmljLnV0aWwuZmxleChfdyAsIFt7dmFsdWU6IG9wdGlvbnMubGVmdCwgZmxleDogMH0se3ZhbHVlOiBvcHRpb25zLndpZHRoLCBmbGV4OiAxfSx7dmFsdWU6IG9wdGlvbnMucmlnaHQsIGZsZXg6IDB9XSApO1xuICAgIHJlY3QubGVmdCA9IF9mbGV4QXJyYXlbMF07XG4gICAgcmVjdC53aWR0aCA9IF9mbGV4QXJyYXlbMV07XG4gICAgcmVjdC5yaWdodCA9IF9mbGV4QXJyYXlbMl07XG5cbiAgICB2YXIgX2ggPSB0aGlzLm9yaWdpbmFsSGVpZ2h0fHwgdGhpcy5oZWlnaHQ7ICAgLy90aGlzLm9yaWdpbmFsSGVpZ2h0XG4gICAgdmFyIF9mbGV4QXJyYXkgPSBmYWJyaWMudXRpbC5mbGV4KF9oICwgW3t2YWx1ZTogb3B0aW9ucy50b3AsIGZsZXg6IDB9LHt2YWx1ZTogb3B0aW9ucy5oZWlnaHQsIGZsZXg6IDF9LHt2YWx1ZTogb3B0aW9ucy5ib3R0b20sIGZsZXg6IDB9XSApO1xuICAgIHJlY3QudG9wID0gX2ZsZXhBcnJheVswXTtcbiAgICByZWN0LmhlaWdodCA9IF9mbGV4QXJyYXlbMV07XG4gICAgcmVjdC5ib3R0b20gPSBfZmxleEFycmF5WzJdO1xuXG4gICAgcmV0dXJuIHJlY3Q7XG4gIH0sXG59KTtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vbW9kdWxlcy9yZW5kZXIuanNcbi8vIG1vZHVsZSBpZCA9IDc4XG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIid1c2Ugc3RyaWN0JztcblxuXG52YXIgX3NldF9vYmplY3Rfc2NhbGVfb3ZlcndyaXR0ZW4gPSBmYWJyaWMuQ2FudmFzLnByb3RvdHlwZS5fc2V0T2JqZWN0U2NhbGU7XG52YXIgX3NldHVwX2N1cnJlbnRfdHJhbnNmb3JtID0gZmFicmljLkNhbnZhcy5wcm90b3R5cGUuX3NldHVwQ3VycmVudFRyYW5zZm9ybTtcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuQ2FudmFzLnByb3RvdHlwZSwge1xuICBfc2V0dXBDdXJyZW50U2NhbGVUcmFuc2Zvcm06IF9zZXR1cF9jdXJyZW50X3RyYW5zZm9ybSxcbiAgX3NldHVwQ3VycmVudFRyYW5zZm9ybTogZnVuY3Rpb24gKGUsIHRhcmdldCkge1xuICAgIGlmICghdGFyZ2V0KXJldHVybjtcbiAgICBpZiAodGFyZ2V0LnNldHVwQ3VycmVudFRyYW5zZm9ybSkge1xuICAgICAgcmV0dXJuIHRhcmdldC5zZXR1cEN1cnJlbnRUcmFuc2Zvcm0oZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICh0YXJnZXQucmVzaXphYmxlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9zZXR1cEN1cnJlbnRSZXNpemVUcmFuc2Zvcm0oZSwgdGFyZ2V0KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9zZXR1cEN1cnJlbnRTY2FsZVRyYW5zZm9ybS5jYWxsKHRoaXMsIGUsIHRhcmdldCk7XG4gICAgICB9XG4gICAgfVxuICB9LFxuICBfc2V0T2JqZWN0U2NhbGU6IGZ1bmN0aW9uIChsb2NhbE1vdXNlLCB0cmFuc2Zvcm0sIGxvY2tTY2FsaW5nWCwgbG9ja1NjYWxpbmdZLCBieSwgbG9ja1NjYWxpbmdGbGlwLCBfZGltKSB7XG5cbiAgICB2YXIgdCA9IHRyYW5zZm9ybS50YXJnZXQ7XG5cbiAgICBpZiAoIV9kaW0pIHtcbiAgICAgIHZhciBzdHJva2VXaWR0aCA9IHQuc3Ryb2tlID8gdC5zdHJva2VXaWR0aCA6IDA7XG4gICAgICBfZGltID0ge1xuICAgICAgICB4OiAodC53aWR0aCArIChzdHJva2VXaWR0aCAvIDIpKSxcbiAgICAgICAgeTogKHQuaGVpZ2h0ICsgKHN0cm9rZVdpZHRoIC8gMikpXG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHQuc2V0T2JqZWN0U2NhbGUpIHtcbiAgICAgIHJldHVybiB0LnNldE9iamVjdFNjYWxlKGxvY2FsTW91c2UsIHRyYW5zZm9ybSxcbiAgICAgICAgbG9ja1NjYWxpbmdYLCBsb2NrU2NhbGluZ1ksIGJ5LCBsb2NrU2NhbGluZ0ZsaXAsIF9kaW0pO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIGlmICh0LnJlc2l6YWJsZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5fc2V0T2JqZWN0U2l6ZShsb2NhbE1vdXNlLCB0cmFuc2Zvcm0sXG4gICAgICAgICAgbG9ja1NjYWxpbmdYLCBsb2NrU2NhbGluZ1ksIGJ5LCBsb2NrU2NhbGluZ0ZsaXAsIF9kaW0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIF9zZXRfb2JqZWN0X3NjYWxlX292ZXJ3cml0dGVuLmNhbGwodGhpcywgbG9jYWxNb3VzZSwgdHJhbnNmb3JtLFxuICAgICAgICAgIGxvY2tTY2FsaW5nWCwgbG9ja1NjYWxpbmdZLCBieSwgbG9ja1NjYWxpbmdGbGlwLCBfZGltKTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIF9zZXRPYmplY3RTaXplOiBmdW5jdGlvbiAobG9jYWxNb3VzZSwgdHJhbnNmb3JtLCBsb2NrU2NhbGluZ1gsIGxvY2tTY2FsaW5nWSwgYnksIGxvY2tTY2FsaW5nRmxpcCwgX2RpbSkge1xuXG4gICAgdmFyIHRhcmdldCA9IHRyYW5zZm9ybS50YXJnZXQsIGZvcmJpZFNjYWxpbmdYID0gZmFsc2UsIGZvcmJpZFNjYWxpbmdZID0gZmFsc2U7XG4gICAgdmFyIF9zdHJva2UgPSB0cmFuc2Zvcm0udGFyZ2V0LnN0cm9rZVdpZHRoIHx8IDA7XG4gICAgdHJhbnNmb3JtLm5ld1dpZHRoID0gdGhpcy53aWR0aCAqICgobG9jYWxNb3VzZS54IC8gdHJhbnNmb3JtLnNjYWxlWCkgLyAodGhpcy53aWR0aCArIF9zdHJva2UpKTtcbiAgICB0cmFuc2Zvcm0ubmV3SGVpZ2h0ID0gdGhpcy5oZWlnaHQgKiAoKGxvY2FsTW91c2UueSAvIHRyYW5zZm9ybS5zY2FsZVkpIC8gKHRoaXMuaGVpZ2h0ICsgX3N0cm9rZSkpO1xuXG4gICAgaWYodGhpcy53aG9sZUNvb3JkaW5hdGVzIHx8IHRhcmdldC53aG9sZUNvb3JkaW5hdGVzKXtcbiAgICAgIHRyYW5zZm9ybS5uZXdXaWR0aCA9IE1hdGgucm91bmQodHJhbnNmb3JtLm5ld1dpZHRoKTtcbiAgICAgIHRyYW5zZm9ybS5uZXdIZWlnaHQgPSBNYXRoLnJvdW5kKHRyYW5zZm9ybS5uZXdIZWlnaHQpO1xuICAgIH1cbiAgICBpZih0cmFuc2Zvcm0ubmV3SGVpZ2h0IDwgMCApe1xuICAgICAgdGFyZ2V0LnRvcCA9IHRyYW5zZm9ybS50b3AgLSB0cmFuc2Zvcm0ubmV3SGVpZ2h0O1xuICAgIH1cbiAgICBpZiAodGFyZ2V0Lm1pbldpZHRoICYmIHRyYW5zZm9ybS5uZXdXaWR0aCA8PSB0YXJnZXQubWluV2lkdGgpIHtcbiAgICAgIHRyYW5zZm9ybS5uZXdXaWR0aCA9IHRhcmdldC5taW5XaWR0aDtcbiAgICB9XG4gICAgaWYgKHRhcmdldC5taW5IZWlnaHQgJiYgdHJhbnNmb3JtLm5ld0hlaWdodCA8PSB0YXJnZXQubWluSGVpZ2h0KSB7XG4gICAgICB0cmFuc2Zvcm0ubmV3SGVpZ2h0ID0gdGFyZ2V0Lm1pbkhlaWdodDtcbiAgICB9XG4gICAgaWYgKGxvY2tTY2FsaW5nRmxpcCAmJiB0cmFuc2Zvcm0ubmV3V2lkdGggPCB0YXJnZXQud2lkdGgpIHtcbiAgICAgIGZvcmJpZFNjYWxpbmdYID0gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKGxvY2tTY2FsaW5nRmxpcCAmJiB0cmFuc2Zvcm0ubmV3SGVpZ2h0IDwgdGFyZ2V0LmhlaWdodCkge1xuICAgICAgZm9yYmlkU2NhbGluZ1kgPSB0cnVlO1xuICAgIH1cblxuICAgIGlmIChieSA9PT0gJ2VxdWFsbHknKSB7XG4gICAgICBmb3JiaWRTY2FsaW5nWCB8fCBmb3JiaWRTY2FsaW5nWSB8fCB0aGlzLl9yZXNpemVPYmplY3RFcXVhbGx5KGxvY2FsTW91c2UsIHRhcmdldCwgdHJhbnNmb3JtLCBfZGltKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoIWJ5KSB7XG4gICAgICBmb3JiaWRTY2FsaW5nWCB8fCB0YXJnZXQuc2V0V2lkdGgodHJhbnNmb3JtLm5ld1dpZHRoKTtcbiAgICAgIGZvcmJpZFNjYWxpbmdZIHx8IHRhcmdldC5zZXRIZWlnaHQodHJhbnNmb3JtLm5ld0hlaWdodCk7XG4gICAgfVxuICAgIGVsc2UgaWYgKGJ5ID09PSAneCcgJiYgIXRhcmdldC5nZXQoJ2xvY2tVbmlTY2FsaW5nJykpIHtcbiAgICAgIGZvcmJpZFNjYWxpbmdYIHx8IHRhcmdldC5zZXRXaWR0aCh0cmFuc2Zvcm0ubmV3V2lkdGgpO1xuICAgIH1cbiAgICBlbHNlIGlmIChieSA9PT0gJ3knICYmICF0YXJnZXQuZ2V0KCdsb2NrVW5pU2NhbGluZycpKSB7XG4gICAgICBmb3JiaWRTY2FsaW5nWSB8fCB0YXJnZXQuc2V0SGVpZ2h0KHRyYW5zZm9ybS5uZXdIZWlnaHQpO1xuICAgIH1cbiAgICByZXR1cm4gIWZvcmJpZFNjYWxpbmdYICYmICFmb3JiaWRTY2FsaW5nWTtcbiAgICAvL3RyYW5zZm9ybS5uZXdXaWR0aCAtPSBfc3Ryb2tlO1xuICAgIC8vdHJhbnNmb3JtLm5ld0hlaWdodCAtPSBfc3Ryb2tlO1xuICB9LFxuICBfc2V0dXBDdXJyZW50UmVzaXplVHJhbnNmb3JtOiBmdW5jdGlvbiAoZSwgdGFyZ2V0KSB7XG4gICAgdGhpcy5fc2V0dXBDdXJyZW50U2NhbGVUcmFuc2Zvcm0oZSwgdGFyZ2V0KTtcbiAgICB0aGlzLl9jdXJyZW50VHJhbnNmb3JtLm9yaWdpbmFsLmhlaWdodCA9IHRhcmdldC5oZWlnaHQ7XG4gICAgdGhpcy5fY3VycmVudFRyYW5zZm9ybS5vcmlnaW5hbC53aWR0aCA9IHRhcmdldC53aWR0aDtcbiAgfSxcbiAgX3Jlc2l6ZU9iamVjdEVxdWFsbHk6IGZ1bmN0aW9uIChsb2NhbE1vdXNlLCB0YXJnZXQsIHRyYW5zZm9ybSwgX2RpbSkge1xuXG4gICAgdmFyIGRpc3QgPSBsb2NhbE1vdXNlLnkgKyBsb2NhbE1vdXNlLngsXG4gICAgICBsYXN0RGlzdCA9IF9kaW0ueSAqIHRyYW5zZm9ybS5vcmlnaW5hbC5oZWlnaHQgLyB0YXJnZXQuaGVpZ2h0ICtcbiAgICAgICAgX2RpbS54ICogdHJhbnNmb3JtLm9yaWdpbmFsLndpZHRoIC8gdGFyZ2V0LndpZHRoO1xuXG4gICAgdHJhbnNmb3JtLm5ld1dpZHRoID0gdHJhbnNmb3JtLm9yaWdpbmFsLndpZHRoICogZGlzdCAvIGxhc3REaXN0O1xuICAgIHRyYW5zZm9ybS5uZXdIZWlnaHQgPSB0cmFuc2Zvcm0ub3JpZ2luYWwuaGVpZ2h0ICogZGlzdCAvIGxhc3REaXN0O1xuXG4gICAgdmFyIHJhdGlvID0gdHJhbnNmb3JtLm9yaWdpbmFsLmhlaWdodCAvIHRyYW5zZm9ybS5vcmlnaW5hbC53aWR0aDtcbiAgICBpZiAocmF0aW8gPiAxKSB7XG4gICAgICBpZiAodGFyZ2V0Lm1pbldpZHRoICYmIHRyYW5zZm9ybS5uZXdXaWR0aCA8PSB0YXJnZXQubWluV2lkdGgpIHtcbiAgICAgICAgdHJhbnNmb3JtLm5ld1dpZHRoID0gdGFyZ2V0Lm1pbldpZHRoO1xuICAgICAgICB0cmFuc2Zvcm0ubmV3SGVpZ2h0ID0gdGFyZ2V0Lm1pbkhlaWdodCAqIHJhdGlvO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBpZiAodGFyZ2V0Lm1pbkhlaWdodCAmJiB0cmFuc2Zvcm0ubmV3SGVpZ2h0IDw9IHRhcmdldC5taW5IZWlnaHQpIHtcbiAgICAgICAgdHJhbnNmb3JtLm5ld0hlaWdodCA9IHRhcmdldC5taW5IZWlnaHQ7XG4gICAgICAgIHRyYW5zZm9ybS5uZXdXaWR0aCA9IHRhcmdldC5taW5XaWR0aCAvIHJhdGlvO1xuICAgICAgfVxuICAgIH1cblxuICAgIHRhcmdldC5zZXRXaWR0aCh0cmFuc2Zvcm0ubmV3V2lkdGgpO1xuICAgIHRhcmdldC5zZXRIZWlnaHQodHJhbnNmb3JtLm5ld0hlaWdodCk7XG4gIH1cbn0pO1xuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9tb2R1bGVzL3Jlc2l6YWJsZS5qc1xuLy8gbW9kdWxlIGlkID0gNzlcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiJ3VzZSBzdHJpY3QnO1xuXG5cbmZhYnJpYy5HdWlkbGluZSA9IGZhYnJpYy51dGlsLmNyZWF0ZUNsYXNzKGZhYnJpYy5PYmplY3Qse1xuICB0b3AgOiAwLFxuICBsZWZ0IDogMCxcbiAgaGVpZ2h0IDogMSxcbiAgd2lkdGggOiAxLFxuICBncmlkZGFibGU6IGZhbHNlLFxuICByZXNwb25zaXZlQm9yZGVycyA6IHRydWUsXG4gIGdyb3VwU2VsZWN0YWJsZSA6IGZhbHNlLFxuICBoYXNDb250cm9scyA6IGZhbHNlLFxuICBoYXNCb3JkZXJzIDogZmFsc2UsXG4gIHdob2xlQ29vcmRpbmF0ZXMgOiB0cnVlLFxuICBzdG9yZWQ6IGZhbHNlLFxuICBtb3ZlbWVudExpbWl0czogXCIjX18wXCIsXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uKG9wdGlvbnMpe1xuICAgIHRoaXMueCA9IE1hdGgucm91bmQob3B0aW9ucy54KTtcbiAgICB0aGlzLnkgPSBNYXRoLnJvdW5kKG9wdGlvbnMueSk7XG5cbiAgICBpZih0aGlzLngpe1xuICAgICAgdGhpcy5sb2NrTW92ZW1lbnRZID0gdHJ1ZTtcbiAgICAgIHRoaXMuaG92ZXJDdXJzb3IgPSBcImV3LXJlc2l6ZVwiO1xuICAgIH1cblxuICAgIGlmKHRoaXMueSl7XG4gICAgICB0aGlzLmxvY2tNb3ZlbWVudFggPSB0cnVlO1xuICAgICAgdGhpcy5ob3ZlckN1cnNvciA9IFwibnMtcmVzaXplXCI7XG4gICAgfVxuXG4gICAgdGhpcy5vbih7XG4gICAgICBcInJlbW92ZWRcIjogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgaSA9IHRoaXMuY2FudmFzLmd1aWRsaW5lcy5pbmRleE9mKHRoaXMpO1xuICAgICAgICB0aGlzLmNhbnZhcy5ndWlkbGluZXMuc3BsaWNlKGksMSlcbiAgICAgIH0sXG4gICAgICBcIm1vZGlmaWVkXCI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYodGhpcy54KXtcbiAgICAgICAgICB0aGlzLnggPSB0aGlzLmxlZnQgKyB0aGlzLndpZHRoIC8gMjtcbiAgICAgICAgfVxuICAgICAgICBpZih0aGlzLnkpe1xuICAgICAgICAgIHRoaXMueSA9IHRoaXMudG9wICsgdGhpcy5oZWlnaHQgLyAyO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgXCJkYmxjbGlja1wiOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMucmVtb3ZlKCk7XG4gICAgICB9LFxuICAgICAgXCJhZGRlZFwiOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLngpIHtcbiAgICAgICAgICB0aGlzLmhlaWdodCA9IHRoaXMuY2FudmFzLmhlaWdodDtcbiAgICAgICAgICB0aGlzLndpZHRoID0gTWF0aC5jZWlsKDEwIC8gdGhpcy5jYW52YXMudmlld3BvcnRUcmFuc2Zvcm1bMF0pO1xuICAgICAgICAgIGlmKHRoaXMud2lkdGggJSAyKXtcbiAgICAgICAgICAgIHRoaXMud2lkdGgrKztcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy5sZWZ0ID0gdGhpcy54IC0gdGhpcy53aWR0aCAvMjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy55KSB7XG4gICAgICAgICAgdGhpcy53aWR0aCA9IHRoaXMuY2FudmFzLndpZHRoO1xuICAgICAgICAgIHRoaXMuaGVpZ2h0ID0gTWF0aC5jZWlsKDEwIC8gdGhpcy5jYW52YXMudmlld3BvcnRUcmFuc2Zvcm1bMF0pO1xuICAgICAgICAgIGlmKHRoaXMuaGVpZ2h0ICUgMil7XG4gICAgICAgICAgICB0aGlzLmhlaWdodCsrO1xuICAgICAgICAgIH1cbiAgICAgICAgICB0aGlzLnRvcCA9IHRoaXMueSAtIHRoaXMuaGVpZ2h0IC8yO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2V0Q29vcmRzKCk7XG4gICAgICAgIGlmKHRoaXMuY2FudmFzLmd1aWRsaW5lcyl7XG4gICAgICAgICAgdGhpcy5jYW52YXMuZ3VpZGxpbmVzLnB1c2godGhpcyk7XG4gICAgICAgIH1lbHNle1xuICAgICAgICAgIHRoaXMudmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbiAgfSxcbiAgcmVuZGVyOiBmdW5jdGlvbihjdHgpe1xuICAgIGN0eC5zYXZlKCk7XG5cbiAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgY3R4LnN0cm9rZVN0eWxlID0gXCIjMDAwMDAwXCI7XG4gICAgaWYodGhpcy54KXtcbiAgICAgIGN0eC50cmFuc2xhdGUodGhpcy5sZWZ0ICsgdGhpcy53aWR0aCAvIDIsMCk7XG4gICAgICBjdHguc2NhbGUoMSAvIHRoaXMuY2FudmFzLmdldFpvb20oKSwgMSAvIHRoaXMuY2FudmFzLmdldFpvb20oKSk7XG4gICAgICBjdHgubW92ZVRvKDAsMCk7XG4gICAgICBjdHgubGluZVRvKDAsdGhpcy5jYW52YXMuaGVpZ2h0KTtcbiAgICB9XG4gICAgaWYodGhpcy55KSB7XG4gICAgICBjdHgudHJhbnNsYXRlKDAsIHRoaXMudG9wICsgdGhpcy5oZWlnaHQgLyAyKTtcbiAgICAgIGN0eC5zY2FsZSgxIC8gdGhpcy5jYW52YXMuZ2V0Wm9vbSgpLCAxIC8gdGhpcy5jYW52YXMuZ2V0Wm9vbSgpKTtcbiAgICAgIGN0eC5tb3ZlVG8oMCwgMCk7XG4gICAgICBjdHgubGluZVRvKHRoaXMuY2FudmFzLndpZHRoLCAwKTtcbiAgICB9XG4gICAgY3R4LnN0cm9rZSgpO1xuICAgIGN0eC5yZXN0b3JlKCk7XG4gIH1cbn0pO1xuXG5mYWJyaWMuUnVsZXIgPSBmYWJyaWMudXRpbC5jcmVhdGVDbGFzcyh7XG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uIChvcHRpb25zKSB7XG5cbiAgICB0aGlzLmNhbnZhcyA9b3B0aW9ucy5jYW52YXM7XG4gICAgdGhpcy50eXBlID0gb3B0aW9ucy50eXBlO1xuICAgIGlmKG9wdGlvbnMuc2l6ZSl0aGlzLnNpemUgPSBvcHRpb25zLnNpemU7XG4gICAgdmFyIHNpemU7XG4gICAgaWYgKG9wdGlvbnMudHlwZSA9PSBcInZlcnRpY2FsXCIpIHtcbiAgICAgIHNpemUgPSB7XG4gICAgICAgIHdpZHRoOiB0aGlzLnNpemUsXG4gICAgICAgIGhlaWdodDogdGhpcy5jYW52YXMuaGVpZ2h0XG4gICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICBzaXplID0ge1xuICAgICAgICB3aWR0aDogdGhpcy5jYW52YXMud2lkdGgsXG4gICAgICAgIGhlaWdodDogdGhpcy5zaXplXG4gICAgICB9O1xuICAgIH1cblxuICAgIHRoaXMuY2FudmFzRWxlbWVudCA9IGZhYnJpYy51dGlsLmNyZWF0ZUNhbnZhc0VsZW1lbnRXaXRoU2l6ZShzaXplKTtcbiAgICB0aGlzLmNhbnZhcy53cmFwcGVyRWwuYXBwZW5kQ2hpbGQodGhpcy5jYW52YXNFbGVtZW50KTtcbiAgICB0aGlzLnJ1bGVyQ29udGV4dCA9IHRoaXMuY2FudmFzRWxlbWVudC5nZXRDb250ZXh0KCcyZCcpO1xuICAgIC8vIHRoaXMucnVsZXJDb250ZXh0LnRyYW5zbGF0ZSgtMC41LC0wLjUpO1xuICAgIHdpbmRvdy5ydWxlckNvbnRleHQgPSB0aGlzLnJ1bGVyQ29udGV4dDtcbiAgICB0aGlzLnJ1bGVyQ29udGV4dC5pbWFnZVNtb290aGluZ0VuYWJsZWQgPSBmYWxzZTtcbiAgICB0aGlzLnJlbmRlcigpO1xuICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgdGhpcy5jYW52YXMub24oe1xuICAgICAgJ3ZpZXdwb3J0OnNjYWxlZCBjaGFuZ2VkIG1vZGlmaWVkJyA6IGZ1bmN0aW9uKCl7XG4gICAgICAgIF90aGlzLnJlbmRlcigpO1xuICAgICAgfVxuICAgIH0pXG5cbiAgfSxcbiAgc2l6ZTogMzAsXG4gIG9yaWVudGF0aW9uOiBcInJldmVydFwiLFxuICBmb250OiBcIjEwcHggT3BlbiBTYW5zXCIsXG4gIGRlbGltZXRlcnM6IFs1MCwgMTAsIDUsIDFdLFxuICByZW5kZXI6IGZ1bmN0aW9uICgpIHtcblxuXG4gICAgdmFyIHYgPSB0aGlzLnR5cGUgPT0gXCJ2ZXJ0aWNhbFwiO1xuICAgIHZhciBzY2FsZSA9IHRoaXMuY2FudmFzLmdldFpvb20oKTtcbiAgICB2YXIgX2N0eCA9IHRoaXMucnVsZXJDb250ZXh0O1xuXG4gICAgX2N0eC5tb3pJbWFnZVNtb290aGluZ0VuYWJsZWQgPSBmYWxzZTtcblxuICAgIF9jdHguY2xlYXJSZWN0KDAsIDAsIHRoaXMuY2FudmFzRWxlbWVudC53aWR0aCwgdGhpcy5jYW52YXNFbGVtZW50LmhlaWdodCk7XG4gICAgaWYodikge1xuICAgICAgdGhpcy5jYW52YXNFbGVtZW50LmhlaWdodCA9IHRoaXMuY2FudmFzLmhlaWdodDtcbiAgICAgIF9jdHgudGV4dEFsaWduID0gJ2VuZCc7XG4gICAgfWVsc2V7XG4gICAgICB0aGlzLmNhbnZhc0VsZW1lbnQud2lkdGggPSB0aGlzLmNhbnZhcy53aWR0aDtcbiAgICB9XG5cbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgIGZ1bmN0aW9uIHB1c2goaCl7XG4gICAgICB2YXIgX3ggPSBNYXRoLnJvdW5kKCBsICogc2NhbGUpO1xuICAgICAgaWYoZmFsc2Upe1xuICAgICAgICB2YXIgeDEgPSAwO1xuICAgICAgICB2YXIgeDIgPSBoO1xuICAgICAgfWVsc2V7XG4gICAgICAgIHZhciB4MSA9IF90aGlzLnNpemU7XG4gICAgICAgIHZhciB4MiA9IF90aGlzLnNpemUgLSBoO1xuICAgICAgfVxuICAgICAgaWYodil7XG4gICAgICAgIF9jdHgubW92ZVRvKHgxLF94KTtcbiAgICAgICAgX2N0eC5saW5lVG8oeDIsIF94KTtcbiAgICAgIH0gZWxzZXtcbiAgICAgICAgX2N0eC5tb3ZlVG8oX3gseDEpO1xuICAgICAgICBfY3R4LmxpbmVUbyhfeCx4Mik7XG4gICAgICB9XG4gICAgICBfY3R4LnN0cm9rZSgpO1xuICAgIH1cbiAgICB2YXIgdyA9ICggdiA/IHRoaXMuY2FudmFzLmhlaWdodCA6IHRoaXMuY2FudmFzLndpZHRoKSAvIHNjYWxlO1xuICAgIHZhciBfZGVsID0gW10sIF9sYWJlbHMgPSBbXTtcbiAgICB2YXIgaSA9IDAsIGogPSAwLCBrID0gMCwgbCA9IDAsIGQgPSB0aGlzLmRlbGltZXRlcnMsIG07XG5cbiAgICBmb3IgKGkgPSAwOyBpIDwgdyAvIGRbMF07IGkrKykge1xuICAgICAgayA9IDA7XG4gICAgICBqID0gMDtcbiAgICAgIGwgPSBpICogZFswXSArIGogKiBkWzFdICsgayAqIGRbMl07XG4gICAgICBpZiAobCA+PSB3KWJyZWFrO1xuICAgICAgcHVzaCgxMCk7XG5cbiAgICAgIF9jdHguZm9udCA9IHRoaXMuZm9udDtcbiAgICAgIGlmICh2KSB7XG4gICAgICAgIF9jdHguc3Ryb2tlVGV4dChsLF90aGlzLnNpemUgLSA2LGwgKiBzY2FsZSArIDEyKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIF9jdHguc3Ryb2tlVGV4dChsLGwgKiBzY2FsZSArIDIsX3RoaXMuc2l6ZSAtIDggKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHNjYWxlID4gMSkge1xuXG4gICAgICAgIGZvciAoaiA9IDA7IGogPCBkWzBdIC8gZFsxXTsgaisrKSB7XG4gICAgICAgICAgayA9IDA7XG4gICAgICAgICAgbCA9IGkgKiBkWzBdICsgaiAqIGRbMV0gKyBrICogZFsyXTtcbiAgICAgICAgICBpZiAobCA+PSB3KWJyZWFrO1xuICAgICAgICAgIHB1c2goNyk7XG5cblxuICAgICAgICAgIGlmIChzY2FsZSA+IDIpIHtcbiAgICAgICAgICAgIGZvciAoayA9IDA7IGsgPCBkWzFdIC8gZFsyXTsgaysrKSB7XG4gICAgICAgICAgICAgIGwgPSBpICogZFswXSArIGogKiBkWzFdICsgayAqIGRbMl07XG4gICAgICAgICAgICAgIGlmIChsID49IHcpYnJlYWs7XG4gICAgICAgICAgICAgIHB1c2goNCk7XG4gICAgICAgICAgICB9XG5cblxuICAgICAgICAgICAgaWYgKHNjYWxlID4gNSkge1xuXG4gICAgICAgICAgICAgIGZvciAobSA9IDA7IG0gPCBkWzJdIC8gZFszXTsgbSsrKSB7XG4gICAgICAgICAgICAgICAgZm9yIChrID0gMDsgayA8IGRbMV0gLyBkWzJdOyBrKyspIHtcbiAgICAgICAgICAgICAgICAgIGwgPSBpICogZFswXSArIGogKiBkWzFdICsgayAqIGRbMl0gKyBtICogZFszXTtcbiAgICAgICAgICAgICAgICAgIGlmIChsID49IHcpYnJlYWs7XG4gICAgICAgICAgICAgICAgICBwdXNoKDIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLl9lbGVtZW50cyA9IF9kZWw7XG4gICAgdGhpcy5fbGFiZWxzID0gX2xhYmVscztcbiAgICBfY3R4LnN0cm9rZSgpO1xuICB9XG59KTtcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuU2xpZGVDYW52YXMucHJvdG90eXBlLHtcbiAgZ3VpZGxpbmVzRW5hYmxlZDogZmFsc2UsXG4gIGNyZWF0ZUd1aWRsaW5lOiBmdW5jdGlvbihkYXRhKXtcbiAgICBpZihkYXRhLnkgIT09IHVuZGVmaW5lZCl7XG4gICAgICBpZihmYWJyaWMuR3VpZGxpbmUucHJvdG90eXBlLndob2xlQ29vcmRpbmF0ZXMpe1xuICAgICAgICBkYXRhLnkgPSBkYXRhLnkgJiYgTWF0aC5yb3VuZChkYXRhLnkpO1xuICAgICAgfVxuICAgICAgaWYoIWZhYnJpYy51dGlsLm9iamVjdC5maW5kV2hlcmUodGhpcy5ndWlkbGluZXMse3k6IGRhdGEueX0pKXtcbiAgICAgICAgdmFyIGdsID0gbmV3IGZhYnJpYy5HdWlkbGluZSh7eTogZGF0YS55fSk7XG4gICAgICAgIHRoaXMuYWRkKGdsKTtcbiAgICAgIH1cbiAgICB9ZWxzZSBpZihkYXRhLnggIT09IHVuZGVmaW5lZCl7XG4gICAgICBpZihmYWJyaWMuR3VpZGxpbmUucHJvdG90eXBlLndob2xlQ29vcmRpbmF0ZXMpe1xuICAgICAgICBkYXRhLnggPSBkYXRhLnggJiYgTWF0aC5yb3VuZChkYXRhLngpO1xuICAgICAgfVxuICAgICAgaWYoIWZhYnJpYy51dGlsLm9iamVjdC5maW5kV2hlcmUodGhpcy5ndWlkbGluZXMse3g6IGRhdGEueH0pKXtcbiAgICAgICAgdmFyIGdsID0gbmV3IGZhYnJpYy5HdWlkbGluZSh7eDogZGF0YS54fSk7XG4gICAgICAgIHRoaXMuYWRkKGdsKTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIHNldEd1aWRsaW5lczogZnVuY3Rpb24oZ3VpZGxpbmVzKXtcbiAgICB0aGlzLmd1aWRsaW5lcyA9IGd1aWRsaW5lcztcbiAgICBpZihndWlkbGluZXMgJiYgdGhpcy5ndWlkbGluZXNFbmFibGVkKXtcbiAgICAgIC8vIHRoaXMuZ3VpZGxpbmVzID0gW107XG4gICAgICBmb3IodmFyIGkgaW4gZ3VpZGxpbmVzKXtcbiAgICAgICAgdGhpcy5jcmVhdGVHdWlkbGluZShndWlkbGluZXNbaV0pXG4gICAgICB9XG4gICAgfVxuICB9LFxuICBjcmVhdGVSdWxlcnM6IGZ1bmN0aW9uKCl7XG4gICAgdGhpcy52UnVsZXIgPSBuZXcgZmFicmljLlJ1bGVyKHtcbiAgICAgIGNhbnZhczogdGhpcyxcbiAgICAgIHR5cGU6IFwidmVydGljYWxcIlxuICAgIH0pO1xuICAgIHRoaXMuaFJ1bGVyID0gbmV3IGZhYnJpYy5SdWxlcih7XG4gICAgICBjYW52YXM6IHRoaXMsXG4gICAgICB0eXBlOiBcImhvcml6b250YWxcIlxuICAgIH0pO1xuXG4gICAgdGhpcy5oUnVsZXIuY2FudmFzRWxlbWVudC5zdHlsZS5wb3NpdGlvbiA9IFwiYWJzb2x1dGVcIjtcbiAgICB0aGlzLmhSdWxlci5jYW52YXNFbGVtZW50LnN0eWxlLmxlZnQgPSAwO1xuICAgIHRoaXMuaFJ1bGVyLmNhbnZhc0VsZW1lbnQuc3R5bGUuYm90dG9tID0gXCIxMDAlXCI7XG4gICAgdGhpcy52UnVsZXIuY2FudmFzRWxlbWVudC5zdHlsZS5wb3NpdGlvbiA9IFwiYWJzb2x1dGVcIjtcbiAgICB0aGlzLnZSdWxlci5jYW52YXNFbGVtZW50LnN0eWxlLnRvcCA9IDA7XG4gICAgdGhpcy52UnVsZXIuY2FudmFzRWxlbWVudC5zdHlsZS5yaWdodCA9IFwiMTAwJVwiO1xuXG5cbiAgICB0aGlzLmd1aWRsaW5lcyA9IFtdO1xuXG5cbiAgICB2YXIgX2NhbnZhcyA9IHRoaXM7XG5cbiAgICB0aGlzLm9uKCd2aWV3cG9ydDpzY2FsZWQnLCBmdW5jdGlvbigpe1xuXG4gICAgICB0aGlzLmd1aWRsaW5lcy5mb3JFYWNoKGZ1bmN0aW9uKGdsKXtcbiAgICAgICAgaWYoZ2wueCl7XG4gICAgICAgICAgZ2wud2lkdGggPSBNYXRoLmNlaWwoMTAgLyBnbC5jYW52YXMudmlld3BvcnRUcmFuc2Zvcm1bMF0pO1xuICAgICAgICAgIGlmKGdsLndpZHRoICUgMil7XG4gICAgICAgICAgICBnbC53aWR0aCsrO1xuICAgICAgICAgIH1cbiAgICAgICAgICBnbC5sZWZ0ID0gZ2wueCAtIGdsLndpZHRoLzI7XG4gICAgICAgIH1cbiAgICAgICAgaWYoZ2wueSl7XG4gICAgICAgICAgZ2wuaGVpZ2h0ID0gTWF0aC5jZWlsKDEwIC8gZ2wuY2FudmFzLnZpZXdwb3J0VHJhbnNmb3JtWzBdKTtcbiAgICAgICAgICBpZihnbC5oZWlnaHQgJSAyKXtcbiAgICAgICAgICAgIGdsLmhlaWdodCsrO1xuICAgICAgICAgIH1cbiAgICAgICAgICBnbC50b3AgPSBnbC55IC0gZ2wuaGVpZ2h0LzI7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfSk7XG5cblxuICAgIHRoaXMuaFJ1bGVyLmNhbnZhc0VsZW1lbnQub25jbGljayAgPSBmdW5jdGlvbihlKXtcbiAgICAgIHZhciBwb2ludGVyID0gX2NhbnZhcy5nZXRQb2ludGVyKGUpO1xuICAgICAgX2NhbnZhcy5jcmVhdGVHdWlkbGluZSh7eCA6IHBvaW50ZXIueCB9KVxuICAgIH07XG5cblxuICAgIHRoaXMudlJ1bGVyLmNhbnZhc0VsZW1lbnQub25jbGljayAgPSBmdW5jdGlvbihlKXtcbiAgICAgIHZhciBwb2ludGVyID0gX2NhbnZhcy5nZXRQb2ludGVyKGUpO1xuXG4gICAgICBfY2FudmFzLmNyZWF0ZUd1aWRsaW5lKHt5IDogcG9pbnRlci55IH0pXG4gICAgfTtcbiAgfVxufSlcblxuXG5mYWJyaWMuU2xpZGVDYW52YXMuYWRkUGx1Z2luKFwic2F2ZXJzXCIsZnVuY3Rpb24ocHJvcGVydGllc1RvSW5jbHVkZSwgX2RhdGEpe1xuICBpZihwcm9wZXJ0aWVzVG9JbmNsdWRlLmluZGV4T2YoJ2d1aWRsaW5lcycpICE9PSAtMSAmJiB0aGlzLmd1aWRsaW5lcykge1xuICAgIF9kYXRhLmd1aWRsaW5lcyA9IFtdO1xuICAgIHRoaXMuZ3VpZGxpbmVzLmZvckVhY2goZnVuY3Rpb24oX2dsKXtcbiAgICAgIGlmKF9nbC54KXtcbiAgICAgICAgX2RhdGEuZ3VpZGxpbmVzLnB1c2goe3ggOiBfZ2wueCB9KVxuICAgICAgfVxuICAgICAgaWYoX2dsLnkpe1xuICAgICAgICBfZGF0YS5ndWlkbGluZXMucHVzaCh7eSA6IF9nbC55IH0pXG4gICAgICB9XG4gICAgfSlcbiAgfVxufSk7XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL21vZHVsZXMvcnVsZXIuanNcbi8vIG1vZHVsZSBpZCA9IDgwXG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIlxuZmFicmljLnNhdmVBcyAgPSByZXF1aXJlKFwiLi8uLi9wbHVnaW5zL3NhdmVBcy5qc1wiKS5zYXZlQXM7XG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLlNsaWRlQ2FudmFzLnByb3RvdHlwZSwge1xuICBpbnNlcnRSZW5kZXJBcmVhOiBmYWxzZSxcbiAgaW5zZXJ0UmVuZGVyRnVsbDogZmFsc2UsXG59KTtcblxuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUuYWN0aW9ucywge1xuICByZW5kZXJBcmVhOiB7XG4gICAgY2xhc3NOYW1lOiAnZmEgZmEtZG93bmxvYWQnLFxuICAgIHRpdGxlOiAnUmVuZGVyIEFyZWEnLFxuICAgIGFjdGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgZmFicmljLnNhdmVBcyh0aGlzLmdldEltYWdlRGF0YSh7XG4gICAgICAgIGNsaXBwZWRfYXJlYTogdGhpcy5hY3RpdmVBcmVhLFxuICAgICAgICB6b29tOiB0aGlzLmRvdHNQZXJVbml0LFxuICAgICAgICBjbGlwcGVkX2FyZWFfb25seTogdHJ1ZSxcbiAgICAgICAgZHJhd19iYWNrZ3JvdW5kOiBmYWxzZVxuICAgICAgfSkuYmxvYiwgdGhpcy50aXRsZSk7XG4gICAgfVxuICB9LFxuICByZW5kZXJGdWxsOiB7XG4gICAgdGl0bGU6ICdSZW5kZXIgZnVsbCcsXG4gICAgYWN0aW9uOiBmdW5jdGlvbiAoKSB7XG4gICAgICBmYWJyaWMuc2F2ZUFzKHRoaXMuZ2V0SW1hZ2VEYXRhKHtcbiAgICAgICAgem9vbTogdGhpcy5kb3RzUGVyVW5pdCxcbiAgICAgICAgY2xpcHBlZF9hcmVhX29ubHk6IGZhbHNlLFxuICAgICAgICBkcmF3X2JhY2tncm91bmQ6IHRydWVcbiAgICAgIH0pLmJsb2IsIHRoaXMudGl0bGUpO1xuICAgIH1cbiAgfVxufSk7XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL21vZHVsZXMvc2F2ZUFzLmpzXG4vLyBtb2R1bGUgaWQgPSA4MVxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCJmYWJyaWMudXRpbC5zdHlsZXMgPSB7XG4gIHN0eWxlU2hlZXRDb250YWluczogZnVuY3Rpb24gKGYpIHtcbiAgICB2YXIgaGFzc3R5bGUgPSBmYWxzZTtcbiAgICB2YXIgZnVsbHN0eWxlc2hlZXRzID0gZG9jdW1lbnQuc3R5bGVTaGVldHM7XG4gICAgZm9yICh2YXIgc3ggPSAwOyBzeCA8IGZ1bGxzdHlsZXNoZWV0cy5sZW5ndGg7IHN4KyspIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHZhciBzaGVldGNsYXNzZXMgPSBmdWxsc3R5bGVzaGVldHNbc3hdLnJ1bGVzIHx8IGRvY3VtZW50LnN0eWxlU2hlZXRzW3N4XS5jc3NSdWxlcztcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBpZiAoIXNoZWV0Y2xhc3Nlcyljb250aW51ZTtcbiAgICAgIGZvciAodmFyIGN4ID0gMDsgY3ggPCBzaGVldGNsYXNzZXMubGVuZ3RoOyBjeCsrKSB7XG4gICAgICAgIGlmIChzaGVldGNsYXNzZXNbY3hdLnNlbGVjdG9yVGV4dCA9PSBmKSB7XG4gICAgICAgICAgaGFzc3R5bGUgPSB0cnVlO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIC8vcmV0dXJuIGNsYXNzZXNbeF0uc3R5bGU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGhhc3N0eWxlO1xuICB9LFxuICBsaW5rQ1NTOiBmdW5jdGlvbiAoZmlsZW5hbWUpIHtcbiAgICB2YXIgZmlsZXJlZiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJsaW5rXCIpXG4gICAgZmlsZXJlZi5zZXRBdHRyaWJ1dGUoXCJyZWxcIiwgXCJzdHlsZXNoZWV0XCIpXG4gICAgZmlsZXJlZi5zZXRBdHRyaWJ1dGUoXCJ0eXBlXCIsIFwidGV4dC9jc3NcIilcbiAgICBmaWxlcmVmLnNldEF0dHJpYnV0ZShcImhyZWZcIiwgZmlsZW5hbWUpXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJoZWFkXCIpWzBdLmFwcGVuZENoaWxkKGZpbGVyZWYpXG4gIH1cbn07XG5cbmZhYnJpYy5BcHBsaWNhdGlvbi5wcm90b3R5cGUubGlua0NTUyA9IGZ1bmN0aW9uICgpIHtcbiAgZm9yKHZhciBpIGluIHRoaXMuY3NzKXtcbiAgICBmYWJyaWMudXRpbC5zdHlsZXMubGlua0NTUyh0aGlzLmNzc1tpXSlcbiAgfVxuICByZXR1cm4gdHJ1ZTtcbn07XG5cbmZhYnJpYy5BcHBsaWNhdGlvbi5hZGRQbHVnaW4oXCJwb3N0bG9hZGVyc1wiLFwibGlua0NTU1wiKTtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vbW9kdWxlcy9zdHlsZXMuanNcbi8vIG1vZHVsZSBpZCA9IDgyXG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsImZhYnJpYy51dGlsLmNyZWF0ZVRodW1iID0gZnVuY3Rpb24oc2xpZGUsICRlbCl7XG5cbiAgdmFyIF9jYW52YXMgPSBzbGlkZS5jYW52YXMsXG4gICAgICBmaXJzdERyYXcgPSB0cnVlLFxuICAgICAgbW9kaWZpZWQsXG4gICAgICBfdyA9ICskZWwuZ2V0QXR0cmlidXRlKFwid2lkdGhcIiksXG4gICAgICBfaCA9ICskZWwuZ2V0QXR0cmlidXRlKFwiaGVpZ2h0XCIpO1xuXG4gIGlmIChfaCkge1xuICAgICRlbC5zdHlsZS5oZWlnaHQgPSAkZWwuaGVpZ2h0O1xuICB9XG5cbiAgZnVuY3Rpb24gcmVuZGVyVGh1bWIoKSB7XG4gICAgaWYgKF9jYW52YXMucHJvY2Vzc2luZyB8fCAhX2NhbnZhcy5sb2FkZWQpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgX2NhbnZhcy5yZW5kZXJUaHVtYigkZWwpO1xuICAgIG1vZGlmaWVkID0gX2NhbnZhcy5tb2RpZmllZDtcbiAgfVxuXG4gIGZ1bmN0aW9uIGZvcmNlUmVuZGVyVGh1bWIoKSB7XG4gICAgaWYgKHRoaXMuY2FudmFzKSB7XG4gICAgICBpZiAodGhpcy5jYW52YXMubG9hZGVkKSB7XG4gICAgICAgIHRoaXMuY2FudmFzLnJlbmRlclRodW1iKCRlbCk7XG4gICAgICB9XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChmaXJzdERyYXcgJiYgdGhpcy5kYXRhLnRodW1iKSB7XG4gICAgICB2YXIgaW1nID0gbmV3IEltYWdlKCk7XG4gICAgICBpbWcub25sb2FkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgY3R4ID0gJGVsLmdldENvbnRleHQoXCIyZFwiKTtcbiAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCAkZWwud2lkdGgsICRlbC5oZWlnaHQpO1xuICAgICAgICBjdHguZHJhd0ltYWdlKGltZywgMCwgMCwgJGVsLndpZHRoLCAkZWwuaGVpZ2h0KTtcbiAgICAgICAgbW9kaWZpZWQgPSB0aGlzLm1vZGlmaWVkO1xuICAgICAgfTtcbiAgICAgIGltZy5zcmMgPSB0aGlzLmRhdGEudGh1bWI7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKGF0dHJzLmZvcmNlICE9PSBcInRydWVcIikgcmV0dXJuO1xuICAgIHZhciBjYW52YXMgPSBuZXcgZmFicmljLlNsaWRlQ2FudmFzKG51bGwsIHRoaXMuZGF0YSwgZnVuY3Rpb24gKCkge1xuICAgICAgY2FudmFzLnJlbmRlclRodW1iKCRlbCk7XG4gICAgICAvL21vZGlmaWVkID0gc2xpZGUubW9kaWZpZWQ7XG4gICAgfSk7XG4gIH1cblxuXG4gIGZ1bmN0aW9uIHNjYWxlVGh1bWIoKSB7XG5cbiAgICB2YXIgX2NvbnRhaW5lciA9IHtcbiAgICAgIHdpZHRoOiBfdyxcbiAgICAgIGhlaWdodDogX2gsXG4gICAgfTtcblxuICAgIHZhciBzaXplID0ge1xuICAgICAgd2lkdGg6IHNsaWRlLmNhbnZhcy5vcmlnaW5hbFdpZHRoIHx8IHNsaWRlLmNhbnZhcy53aWR0aCxcbiAgICAgIGhlaWdodDogc2xpZGUuY2FudmFzLm9yaWdpbmFsSGVpZ2h0IHx8IHNsaWRlLmNhbnZhcy5oZWlnaHRcbiAgICB9O1xuXG4gICAgdmFyIF9maXRTaXplID0gZmFicmljLnV0aWwuZ2V0UHJvcG9ydGlvbnMoIHNpemUsX2NvbnRhaW5lcixcImZpdFwiKTtcblxuICAgICRlbC53aWR0aCA9IF9maXRTaXplLndpZHRoO1xuICAgICRlbC5oZWlnaHQgPSBfZml0U2l6ZS5oZWlnaHQ7XG5cblxuICAgICRlbC5zdHlsZS53aWR0aCA9IF9maXRTaXplLndpZHRoICsgJ3B4JztcbiAgICAkZWwuc3R5bGUuaGVpZ2h0ID0gX2ZpdFNpemUuaGVpZ2h0ICArICdweCc7XG4gICAgcmVuZGVyVGh1bWIoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGNhbnZhc0NoYW5nZWQoKSB7XG4gICAgLy8gX2NhbnZhcyAmJiBfY2FudmFzLm9mZignYWZ0ZXI6cmVuZGVyJywgcmVuZGVyVGh1bWIpO1xuICAgIC8vIGlmICh0aGlzLmNhbnZhcykge1xuICAgICAgLy8gX2NhbnZhcyA9IHNjb3BlLmZmVGh1bWIuY2FudmFzO1xuICAgICAgdGhpcy5jYW52YXMub24oJ2FmdGVyOnJlbmRlcicsIHJlbmRlclRodW1iKTtcbiAgICAgIHRoaXMuY2FudmFzLm9uKFwiZGltZW5zaW9uczptb2RpZmllZFwiLCBzY2FsZVRodW1iKTtcbiAgICAgIHRoaXMuY2FudmFzLm9uKFwibG9hZGluZzplbmRcIiwgc2NhbGVUaHVtYik7XG4gICAgLy8gfVxuICB9XG5cblxuICAkZWwuc2V0QXR0cmlidXRlKFwidGl0bGVcIiwgc2xpZGUudGl0bGUpO1xuICBzbGlkZS5vbignY2FudmFzOmNoYW5nZWQnLCBjYW52YXNDaGFuZ2VkKTtcbiAgc2xpZGUub24oJ21vZGlmaWVkJywgZm9yY2VSZW5kZXJUaHVtYik7XG5cbiAgc2NhbGVUaHVtYi5jYWxsKHNsaWRlKTtcbiAgZm9yY2VSZW5kZXJUaHVtYi5jYWxsKHNsaWRlKTtcbiAgY2FudmFzQ2hhbmdlZC5jYWxsKHNsaWRlKTtcblxufTtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vbW9kdWxlcy90aHVtYi5qc1xuLy8gbW9kdWxlIGlkID0gODNcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiJ3VzZSBzdHJpY3QnO1xuXG52YXIgVG9vbGJhciA9IHJlcXVpcmUoJy4vLi4vcGx1Z2lucy90b29sYmFyJyk7XG5cblxuVG9vbGJhci5wcm90b3R5cGUuc2V0RnVuY3Rpb25DYWxsYmFjayA9IGZ1bmN0aW9uKHRhcmdldCl7XG4gIGlmKHRhcmdldC5jYW52YXMpe1xuICAgIHJldHVybiB0YXJnZXQuY2FudmFzLnJlbmRlckFsbCgpO1xuICB9XG4gIGlmKHRhcmdldC5yZW5kZXJBbGwpe1xuICAgIHJldHVybiB0YXJnZXQucmVuZGVyQWxsKClcbiAgfVxufTtcblxuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5BcHBsaWNhdGlvbi5wcm90b3R5cGUse1xuICB0b29sYmFyOiBmYWxzZSxcbiAgY3JlYXRlVG9vbGJhcnM6IGZ1bmN0aW9uKCl7XG4gICAgaWYoIXRoaXMudG9vbGJhcil7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYodGhpcy50b29sYmFyLmFwcGxpY2F0aW9uKSB7XG4gICAgICBuZXcgVG9vbGJhcih0aGlzLCB0aGlzLnRvb2xiYXIuYXBwbGljYXRpb24pXG4gICAgfVxuXG4gICAgaWYodGhpcy5jYW52YXMgJiYgdGhpcy50b29sYmFyLmNhbnZhcyl7XG4gICAgICBuZXcgVG9vbGJhcih0aGlzLmNhbnZhcywgdGhpcy50b29sYmFyLmNhbnZhcyk7XG4gICAgfVxuICAgIGlmKHRoaXMucHJvamVjdCAmJiAgdGhpcy50b29sYmFyLnByb2plY3Qpe1xuICAgICAgbmV3IFRvb2xiYXIodGhpcy5wcm9qZWN0LCB0aGlzLnRvb2xiYXIucHJvamVjdCk7XG4gICAgfVxuXG4gICAgaWYodGhpcy50b29sYmFyLm9iamVjdHMpe1xuICAgICAgaWYodGhpcy50b29sYmFyLm9iamVjdHMuY29uc3RydWN0b3IgPT0gT2JqZWN0KXtcbiAgICAgICAgdGhpcy5jYW52YXMgJiYgdGhpcy5jYW52YXMuaW5pdE1lbnVFdmVudHModGhpcy50b29sYmFyLm9iamVjdHMuY29udGFpbmVyLHRoaXMudG9vbGJhci5vYmplY3RzKTtcbiAgICAgIH1lbHNle1xuICAgICAgICB0aGlzLmNhbnZhcyAmJiB0aGlzLmNhbnZhcy5pbml0TWVudUV2ZW50cyh0aGlzLnRvb2xiYXIub2JqZWN0cyk7XG4gICAgICB9XG4gICAgfVxuICB9LFxuICBpbml0VG9vbHM6IGZ1bmN0aW9uKCl7XG4gICAgaWYodGhpcy5vcHRpb25zLnRvb2xiYXIpe1xuICAgICAgaWYoIXRoaXMudG9vbGJhcil7XG4gICAgICAgIHRoaXMudG9vbGJhciA9IHRoaXMub3B0aW9ucy50b29sYmFyO1xuICAgICAgfWVsc2V7XG4gICAgICAgIGZhYnJpYy51dGlsLm9iamVjdC5kZWVwRXh0ZW5kKHRoaXMudG9vbGJhcix0aGlzLm9wdGlvbnMudG9vbGJhcilcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHRoaXMudG9vbGJhcikge1xuICAgICAgZmFicmljLnV0aWwub2JqZWN0LmRlZXBFeHRlbmQoVG9vbGJhci50b29scywgdGhpcy50b29sYmFyLnRvb2xzKTtcbiAgICAgIGZvciAodmFyIGtsYXNzTmFtZSBpbiB0aGlzLnRvb2xiYXIuYWN0aW9ucykge1xuICAgICAgICB2YXIgYWN0aW9ucyA9IHRoaXMudG9vbGJhci5hY3Rpb25zW2tsYXNzTmFtZV07XG4gICAgICAgIGlmKCFmYWJyaWNba2xhc3NOYW1lXS5wcm90b3R5cGUuYWN0aW9ucyl7XG4gICAgICAgICAgZmFicmljW2tsYXNzTmFtZV0ucHJvdG90eXBlLmFjdGlvbnMgPSB7fVxuICAgICAgICB9XG4gICAgICAgIHZhciBwcm90b0FjdGlvbnMgPSBmYWJyaWNba2xhc3NOYW1lXS5wcm90b3R5cGUuYWN0aW9ucztcblxuICAgICAgICBpZiAoYWN0aW9ucy5jb25zdHJ1Y3RvciA9PSBGdW5jdGlvbikge1xuICAgICAgICAgIGFjdGlvbnMgPSBhY3Rpb25zLmNhbGwoZmFicmljW2tsYXNzTmFtZV0ucHJvdG90eXBlKVxuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICBhY3Rpb25zID0gZmFicmljLnV0aWwub2JqZWN0LmNsb25lRGVlcChhY3Rpb25zKTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgJG9yZGVyID0gYWN0aW9uc1tcIiRvcmRlclwiXTtcbiAgICAgICAgZGVsZXRlIGFjdGlvbnNbXCIkb3JkZXJcIl07XG5cbiAgICAgICAgZm9yICh2YXIgaiBpbiBhY3Rpb25zKSB7XG4gICAgICAgICAgaWYocHJvdG9BY3Rpb25zW2pdKXtcbiAgICAgICAgICAgIGlmIChhY3Rpb25zW2pdW1wiJGNsb25lXCJdKSB7XG4gICAgICAgICAgICAgIHByb3RvQWN0aW9uc1tqXSA9IGZhYnJpYy51dGlsLm9iamVjdC5kZWVwRXh0ZW5kKHt9LCBwcm90b0FjdGlvbnNbal0pO1xuICAgICAgICAgICAgICBkZWxldGUgYWN0aW9uc1tqXVtcIiRjbG9uZVwiXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZhYnJpYy51dGlsLm9iamVjdC5kZWVwRXh0ZW5kKHByb3RvQWN0aW9uc1tqXSwgYWN0aW9uc1tqXSk7XG4gICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICBwcm90b0FjdGlvbnNbal0gPSBhY3Rpb25zW2pdO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZigkb3JkZXIpe1xuICAgICAgICAgIGZhYnJpY1trbGFzc05hbWVdLnByb3RvdHlwZS5hY3Rpb25zID0gZmFicmljLnV0aWwub2JqZWN0LnJlYXJyYW5nZShwcm90b0FjdGlvbnMsICRvcmRlcik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGRlbGV0ZSB0aGlzLnRvb2xiYXJbJ3Rvb2xzJ107XG4gICAgICBkZWxldGUgdGhpcy50b29sYmFyWydhY3Rpb25zJ107XG4gICAgICBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKFRvb2xiYXIsIHRoaXMudG9vbGJhcik7XG4gICAgICBkZWxldGUgdGhpcy5vcHRpb25zLnRvb2xiYXI7XG4gICAgfVxuICB9XG59KTtcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuQXBwbGljYXRpb24ucHJvdG90eXBlLHtcbiAgZXZlbnRMaXN0ZW5lcnM6IGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmRBcnJheXNPYmplY3QoZmFicmljLkFwcGxpY2F0aW9uLnByb3RvdHlwZS5ldmVudExpc3RlbmVycywge1xuICAgIFwiY2FudmFzOmNyZWF0ZWRcIiA6IGZ1bmN0aW9uKCl7XG4gICAgICB0aGlzLmluaXRUb29scygpO1xuICAgIH1cbiAgfSlcbn0pO1xuXG5mYWJyaWMuQXBwbGljYXRpb25cbiAgLy8gLmFkZFBsdWdpbihcImNhbnZhc1wiLFwiaW5pdFRvb2xzXCIpXG4gIC5hZGRQbHVnaW4oXCJwb3N0bG9hZGVyc1wiLFwiY3JlYXRlVG9vbGJhcnNcIik7XG5cblxuZmFicmljLlRvb2xiYXIgPSBUb29sYmFyO1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5DYW52YXMucHJvdG90eXBlLCB7XG4gIG1lbnVPcmlnaW5YOiBcImxlZnRcIixcbiAgbWVudU9yaWdpblk6IFwidG9wXCIsXG4gIG1lbnVNYXJnaW5YOiAwLFxuICBtZW51TWFyZ2luWTogMCxcbiAgc2V0VG9vbGJhckNvb3JkczogZnVuY3Rpb24gKCRtZW51LCB0YXJnZXQsIG9wdGlvbnMpIHtcblxuICAgIG9wdGlvbnMgPSBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKHtcbiAgICAgIG9yaWdpblg6IFwibGVmdFwiLFxuICAgICAgb3JpZ2luWTogXCJ0b3BcIixcbiAgICAgIG1hcmdpblg6IDAsXG4gICAgICBtYXJnaW5ZOiAwXG4gICAgfSwgb3B0aW9ucyk7XG5cbiAgICB0YXJnZXQuc2V0Q29vcmRzKCk7XG4gICAgdmFyIHIgPSB0YXJnZXQuZ2V0Qm91bmRpbmdSZWN0KCk7XG5cbiAgICB2YXIgX2xlZnQ7XG4gICAgc3dpdGNoIChvcHRpb25zLm9yaWdpblgpIHtcbiAgICAgIGNhc2UgXCJsZWZ0XCI6XG4gICAgICAgIF9sZWZ0ID0gci5sZWZ0O1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJyaWdodFwiOlxuICAgICAgICBfbGVmdCA9IHIubGVmdCArIHIud2lkdGg7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcImNlbnRlclwiOlxuICAgICAgICBfbGVmdCA9IHIubGVmdCArIHIud2lkdGggLyAyO1xuICAgICAgICBicmVhaztcbiAgICB9XG4gICAgO1xuICAgIHZhciBfdG9wO1xuICAgIHN3aXRjaCAob3B0aW9ucy5vcmlnaW5ZKSB7XG4gICAgICBjYXNlIFwidG9wXCI6XG4gICAgICAgIF90b3AgPSByLnRvcCAtICRtZW51LmhlaWdodCgpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJib3R0b21cIjpcbiAgICAgICAgX3RvcCA9IHIudG9wICsgci5oZWlnaHQ7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcImNlbnRlclwiOlxuICAgICAgICBfdG9wID0gci50b3AgKyByLmhlaWdodCAvIDIgLSAkbWVudS5oZWlnaHQoKSAvIDI7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgICA7XG5cblxuICAgIF90b3AgKz0gb3B0aW9ucy5tYXJnaW5ZO1xuICAgIF9sZWZ0ICs9IG9wdGlvbnMubWFyZ2luWFxuXG4gICAgdmFyIF9tZW51Q29udGFpbmVyT2Zmc2V0ID0gJCgkbWVudS5wYXJlbnRzKClbMF0pLm9mZnNldCgpO1xuICAgIHZhciBfY2FudmFzT2Zmc2V0ID0gJCh0aGlzLndyYXBwZXJFbCkub2Zmc2V0KCk7XG5cbiAgICBfdG9wICs9IF9jYW52YXNPZmZzZXQudG9wIC0gX21lbnVDb250YWluZXJPZmZzZXQudG9wO1xuICAgIF9sZWZ0ICs9IF9jYW52YXNPZmZzZXQubGVmdCAtIF9tZW51Q29udGFpbmVyT2Zmc2V0LmxlZnQ7XG5cbiAgICB2YXIgY29vcmRzID0ge1xuICAgICAgdG9wOiBNYXRoLm1heCgzLCBfdG9wKSxcbiAgICAgIGxlZnQ6IE1hdGgubWluKE1hdGgubWF4KDMsIF9sZWZ0KSwgJCh0aGlzLndyYXBwZXJFbCkud2lkdGgoKSAtICRtZW51LndpZHRoKCkgLSA1KVxuICAgIH07XG5cblxuICAgICQodGhpcy53cmFwcGVyRWwpLm9mZnNldCgpO1xuXG4gICAgJG1lbnUuY3NzKGNvb3Jkcyk7XG4gICAgcmV0dXJuIGNvb3JkcztcbiAgfSxcbiAgZ2V0VG9vbGJhckNvbnRhaW5lcjogZnVuY3Rpb24gKGlkLCBvcHRpb25zKSB7XG4gICAgcmV0dXJuICQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy5hcHBsaWNhdGlvbi50b29sYmFyLm9iamVjdHMuY29udGFpbmVyKSk7XG4gIH0sXG4gIGluaXRNZW51RXZlbnRzOiBmdW5jdGlvbiAoaWQsIG9wdGlvbnMpIHtcblxuICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICAgIG9wdGlvbnMub3JpZ2luWCA9IG9wdGlvbnMub3JpZ2luWCB8fCB0aGlzLm1lbnVPcmlnaW5YO1xuICAgIG9wdGlvbnMub3JpZ2luWSA9IG9wdGlvbnMub3JpZ2luWSB8fCB0aGlzLm1lbnVPcmlnaW5ZO1xuICAgIG9wdGlvbnMubWFyZ2luWCA9IG9wdGlvbnMubWFyZ2luWCB8fCB0aGlzLm1lbnVNYXJnaW5YO1xuICAgIG9wdGlvbnMubWFyZ2luWSA9IG9wdGlvbnMubWFyZ2luWSB8fCB0aGlzLm1lbnVNYXJnaW5ZO1xuICAgIHRoaXMuZmxvYXRlZFRvb2xiYXJPcHRpb25zID0gb3B0aW9ucztcbiAgICB2YXIgY2FudmFzID0gdGhpcztcblxuICAgIGlmIChpZCkge1xuICAgICAgdGhpcy4kbWVudSA9ICQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpKS5oaWRlKCk7XG4gICAgfSBlbHNlIHtcblxuICAgICAgdGhpcy4kbWVudSA9IHRoaXMuJG1lbnUgfHwgJCgnPGRpdj4nKTtcbiAgICAgICQodGhpcy53cmFwcGVyRWwpLnByZXBlbmQodGhpcy4kbWVudSk7XG4gICAgfVxuICAgIHRoaXMuJG1lbnUuaGlkZSgpO1xuXG4gICAgdmFyIF9sYXN0X3RhcmdldCA9IGNhbnZhcy50YXJnZXQ7XG4gICAgY2FudmFzXG4gICAgICAub24oJ29iamVjdDptb3ZpbmcnLCBmdW5jdGlvbiAoZXZlbnQpIHtcblxuICAgICAgICB2YXIgJG1lbnUgPSB0aGlzLmdldFRvb2xiYXJDb250YWluZXIoKTtcbiAgICAgICAgY2FudmFzLnNldFRvb2xiYXJDb29yZHMoJG1lbnUsIGNhbnZhcy50YXJnZXQsIGNhbnZhcy5mbG9hdGVkVG9vbGJhck9wdGlvbnMpO1xuICAgICAgfSlcbiAgICAgIC5vbigndGFyZ2V0OmNsZWFyZWQnLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgaWYgKF9sYXN0X3RhcmdldCkge1xuICAgICAgICAgIHZhciAkbWVudSA9IHRoaXMuZ2V0VG9vbGJhckNvbnRhaW5lcigpO1xuICAgICAgICAgICRtZW51LmhpZGUoKTtcbiAgICAgICAgICBjYW52YXMub2JqZWN0VG9vbGJhci5kZXN0cm95KCk7XG4gICAgICAgICAgZGVsZXRlIGNhbnZhcy5vYmplY3RUb29sYmFyO1xuICAgICAgICAgIF9sYXN0X3RhcmdldCA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgICAub24oJ3RhcmdldDpjaGFuZ2VkJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIGlmIChfbGFzdF90YXJnZXQpIHtcbiAgICAgICAgICBjYW52YXMub2JqZWN0VG9vbGJhci5kZXN0cm95KCk7XG4gICAgICAgIH1cbiAgICAgICAgY2FudmFzLmNyZWF0ZUZsb2F0ZWRNZW51KG9wdGlvbnMpO1xuICAgICAgICBfbGFzdF90YXJnZXQgPSBldmVudC50YXJnZXQ7XG4gICAgICB9KVxuICB9LFxuXG4gIGNyZWF0ZUZsb2F0ZWRNZW51OiBmdW5jdGlvbiAob3B0aW9ucykge1xuXG4gICAgdmFyICRtZW51ID0gdGhpcy5nZXRUb29sYmFyQ29udGFpbmVyKCk7XG5cbiAgICAkbWVudS5zaG93KCk7XG4gICAgLy90aGlzLnRvb2xzQ29udGFpbmVyID0gdGhpcy4kbWVudTtcbiAgIC8qIHZhciBfdGMgPSAkbWVudS5maW5kKFwiLnRvb2xiYXItdG9vbHMtY29udGFpbmVyXCIpO1xuICAgIGlmIChfdGMubGVuZ3RoKSB7XG4gICAgICB0aGlzLnRvb2xzQ29udGFpbmVyID0gX3RjO1xuICAgIH0qL1xuICAgLy8gdGhpcy50b29sc0NvbnRhaW5lci5lbXB0eSgpO1xuICAgIGlmICh0aGlzLnRhcmdldC5hY3Rpb25zKSB7XG4gICAgICB0aGlzLm9iamVjdFRvb2xiYXIgPSBuZXcgVG9vbGJhciAodGhpcy50YXJnZXQsICRtZW51LCBvcHRpb25zKTtcbiAgICB9XG4gICAgdGhpcy5zZXRUb29sYmFyQ29vcmRzKCRtZW51LCB0aGlzLnRhcmdldCwgdGhpcy5mbG9hdGVkVG9vbGJhck9wdGlvbnMpO1xuICB9XG59KTtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vbW9kdWxlcy90b29sYmFyLmpzXG4vLyBtb2R1bGUgaWQgPSA4NFxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCIndXNlIHN0cmljdCc7XG5cblxuZmFicmljLnV0aWwudXBsb2FkSW1hZ2VNYXhTaXplID0ge1xuICB3aWR0aDogNDAwLFxuICBoZWlnaHQ6IDQwMFxufTtcblxuZmFicmljLnV0aWwudXBsb2FkSW1hZ2VNaW5TaXplID0ge1xuICB3aWR0aDogMTAwLFxuICBoZWlnaHQ6IDEwMFxufTtcblxuZmFicmljLnV0aWwubXVsdGlVcGxvYWQgPSBmYWxzZTtcblxuZmFicmljLnV0aWwucmVhZEZpbGUgPSBmdW5jdGlvbihmaWxlLGNhbGxiYWNrKXtcblxuICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcbiAgcmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uIChlKSB7XG4gICAgdmFyIHJlc3VsdCA9IGUudGFyZ2V0LnJlc3VsdDtcbiAgICB2YXIgdHlwZSA9IHJlc3VsdC5zdWJzdHIoMTEsIHJlc3VsdC5pbmRleE9mKFwiO1wiKSAtIDExKTtcbiAgICB2YXIgaW1nID0gbmV3IEltYWdlKCk7XG4gICAgaW1nLnR5cGUgPSB0eXBlO1xuICAgIGltZy5uYW1lID0gZmlsZS5uYW1lO1xuICAgIGltZy5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XG5cbiAgICAgIGlmKCFmYWJyaWMudXRpbC5tdWx0aVVwbG9hZCl7XG4gICAgICAgIGlmIChmYWJyaWMudXRpbC51cGxvYWRQcmVwcm9jZXNzb3IpIHtcbiAgICAgICAgICBmYWJyaWMudXRpbC51cGxvYWRQcmVwcm9jZXNzb3IoW3RoaXNdLCBmdW5jdGlvbiAodmFsKSB7XG4gICAgICAgICAgICBjYWxsYmFjayh2YWwpO1xuICAgICAgICAgIH0sb3B0aW9ucylcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjYWxsYmFjayh0aGlzKTtcbiAgICAgICAgfVxuICAgICAgfWVsc2V7XG4gICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICB9XG4gICAgfTtcbiAgICBpbWcuc3JjID0gcmVzdWx0O1xuICB9O1xuICByZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlICk7XG59O1xuXG5cbmZhYnJpYy51dGlsLmNyZWF0ZVVwbG9hZElucHV0ID0gZnVuY3Rpb24gKG9wdGlvbnMsIGNvbXBsZXRlLCBwcm9ncmVzcykge1xuXG4gIHZhciBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpbnB1dFwiKTtcbiAgaW5wdXQuc2V0QXR0cmlidXRlKFwidHlwZVwiLCBcImZpbGVcIik7XG4gIGlucHV0LnNldEF0dHJpYnV0ZShcIm11bHRpcGxlXCIsIHRydWUpO1xuICBpbnB1dC5jbGFzc05hbWUgPSBcImhpZGRlblwiO1xuXG4gICQoaW5wdXQpLmNoYW5nZShmdW5jdGlvbiAoKSB7XG5cbiAgICBpZihpbnB1dC5maWxlcyAmJiBpbnB1dC5maWxlcy5sZW5ndGgpe1xuXG4gICAgICB2YXIgX2xvYWRlciA9IGZhYnJpYy51dGlsLnF1ZXVlTG9hZChpbnB1dC5maWxlcy5sZW5ndGgsZnVuY3Rpb24obG9hZGVkKXtcblxuICAgICAgICBpZihmYWJyaWMudXRpbC5tdWx0aVVwbG9hZCl7XG4gICAgICAgICAgaWYgKGZhYnJpYy51dGlsLnVwbG9hZFByZXByb2Nlc3Nvcikge1xuICAgICAgICAgICAgZmFicmljLnV0aWwudXBsb2FkUHJlcHJvY2Vzc29yKGxvYWRlZCwgZnVuY3Rpb24gKHZhbCkge1xuICAgICAgICAgICAgICBjb21wbGV0ZSh2YWwsb3B0aW9ucyk7XG4gICAgICAgICAgICB9LG9wdGlvbnMpXG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbXBsZXRlKGxvYWRlZCxvcHRpb25zKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1lbHNle1xuICAgICAgICAgIGNvbXBsZXRlKGxvYWRlZFswXSxvcHRpb25zKTtcblxuICAgICAgICB9XG4gICAgICB9LGZ1bmN0aW9uKHRvdGFsLCBjdXJyZW50LCBpbWFnZSl7XG4gICAgICAgIGlmKGZhYnJpYy51dGlsLm11bHRpVXBsb2FkKSB7XG4gICAgICAgICAgaWYgKHByb2dyZXNzKSB7XG4gICAgICAgICAgICBwcm9ncmVzcyh0b3RhbCwgY3VycmVudCwgaW1hZ2UpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG5cblxuXG4gICAgICBmb3IodmFyIGkgPTA7IGk8IGlucHV0LmZpbGVzLmxlbmd0aDsgaSsrKXtcbiAgICAgICAgZmFicmljLnV0aWwucmVhZEZpbGUoaW5wdXQuZmlsZXNbaV0sX2xvYWRlcik7XG4gICAgICB9XG5cblxuXG4gICAgfVxuXG4gIH0pO1xuXG4gIGZhYnJpYy51dGlsLnVwbG9hZElucHV0ID0gaW5wdXQ7XG59O1xuXG5cbi8vZmFicmljLnV0aWwucmVzaXplSW1hZ2UoaW1nLCBjYWxsYmFjayk7XG5mYWJyaWMudXRpbC51cGxvYWRQcmVwcm9jZXNzb3IgPSBudWxsO1xuXG5cbmZhYnJpYy51dGlsLnVwbG9hZEltYWdlID0gZnVuY3Rpb24gKGNiLHByb2dyZXNzLG9wdGlvbnMpIHtcbiAgZmFicmljLnV0aWwuY3JlYXRlVXBsb2FkSW5wdXQob3B0aW9ucyxjYixwcm9ncmVzcyk7XG4gICQoZmFicmljLnV0aWwudXBsb2FkSW5wdXQpLnRyaWdnZXIoJ2NsaWNrJyk7XG59O1xuXG5cbmZhYnJpYy51dGlsLnJlc2l6ZVVwbG9hZGVkSW1hZ2UgPSBmdW5jdGlvbiAoaW1nLCBjYWxsYmFjaykge1xuXG4gIGlmIChpbWcudHlwZSA9PT0gXCJzdmcreG1sXCIpIHtcbiAgICBjYWxsYmFjayhpbWcpO1xuICAgIHJldHVybjtcbiAgfVxuICAvL0hlcmUgd2UgY2FuIHB1dCBhIHJlc3RyaWN0aW9uIHRvIHVwbG9hZCBhIG1pbmltIHNpemVkIGxvZ29cbiAgaWYgKGltZy53aWR0aCA8IGZhYnJpYy51dGlsLnVwbG9hZEltYWdlTWluU2l6ZS53aWR0aCB8fCBpbWcuaGVpZ2h0IDwgZmFicmljLnV0aWwudXBsb2FkSW1hZ2VNaW5TaXplLmhlaWdodCkge1xuICAgIGFsZXJ0KFwiTG9nbyBpcyB0b28gc21hbGwuIE1JbmltdW0gc2l6ZSBpcyBcIiArIGZhYnJpYy51dGlsLnVwbG9hZEltYWdlTWluU2l6ZS53aWR0aCArIFwieFwiICsgZmFicmljLnV0aWwudXBsb2FkSW1hZ2VNaW5TaXplLmhlaWdodCk7XG4gICAgY2FsbGJhY2soZmFsc2UpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGlmIChpbWcud2lkdGggPiBmYWJyaWMudXRpbC51cGxvYWRJbWFnZU1heFNpemUud2lkdGggfHwgaW1nLmhlaWdodCA+IGZhYnJpYy51dGlsLnVwbG9hZEltYWdlTWF4U2l6ZS5oZWlnaHQpIHtcblxuICAgIHZhciBzaXplID0gZmFicmljLnV0aWwuZ2V0UHJvcG9ydGlvbnMoaW1nLCBmYWJyaWMudXRpbC51cGxvYWRJbWFnZU1heFNpemUsIFwiZml0XCIpO1xuXG4gICAgdmFyIGZpbHRlciA9IG5ldyBmYWJyaWMuSW1hZ2UuZmlsdGVycy5SZXNpemVEUCgpO1xuXG4gICAgdmFyIGNhbnZhcyA9IGZhYnJpYy51dGlsLmNyZWF0ZUNhbnZhc0VsZW1lbnRXaXRoU2l6ZShpbWcpO1xuICAgIHZhciBjdHggPSBjYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpO1xuICAgIGN0eC5kcmF3SW1hZ2UoaW1nLCAwLCAwKTtcbiAgICBmaWx0ZXIuYXBwbHlUbyhjYW52YXMsIHNpemUud2lkdGgsIHNpemUuaGVpZ2h0KTtcbiAgICBjYWxsYmFjayhjYW52YXMpO1xuICB9IGVsc2Uge1xuICAgIGNhbGxiYWNrKGltZyk7XG4gIH1cbn07XG5cblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vbW9kdWxlcy91cGxvYWQuanNcbi8vIG1vZHVsZSBpZCA9IDg1XG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIid1c2Ugc3RyaWN0JztcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vbW9kdWxlIHJlc3BvbnNpdmUgYm9yZGVycy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG5mYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5PYmplY3QucHJvdG90eXBlLCB7XG4gIHJlc3BvbnNpdmVCb3JkZXJzOiBmYWxzZVxufSk7XG5cbmlmKCFmYWJyaWMuU2xpZGVDYW52YXMucHJvdG90eXBlLl9kZWZhdWx0X2V2ZW50X2xpc3RlbmVycyl7XG4gIGZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUuX2RlZmF1bHRfZXZlbnRfbGlzdGVuZXJzID0ge307XG59O1xuXG5mYWJyaWMuT2JqZWN0LnByb3RvdHlwZS51cGRhdGVSZXNwb25zaXZlQm9yZGVyID0gZnVuY3Rpb24oKXtcbiAgaWYodGhpcy5yZXNwb25zaXZlQm9yZGVycyl7XG4gICAgaWYoIXRoaXMub3JpZ2luYWxTdHJva2VXaWR0aCl7XG4gICAgICB0aGlzLm9yaWdpbmFsU3Ryb2tlV2lkdGggPSB0aGlzLnN0cm9rZVdpZHRoO1xuICAgIH1cbiAgICB0aGlzLnN0cm9rZVdpZHRoID0gdGhpcy5jYW52YXMgPyB0aGlzLm9yaWdpbmFsU3Ryb2tlV2lkdGggLyB0aGlzLmNhbnZhcy52aWV3cG9ydFRyYW5zZm9ybVswXSA6IDA7XG4gIH1cbn07XG5cbmZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUuX2RlZmF1bHRfZXZlbnRfbGlzdGVuZXJzWyd2aWV3cG9ydDpzY2FsZWQnXSA9IGZ1bmN0aW9uKCl7XG5cbiAgaWYodGhpcy5iYWNrZ3JvdW5kSW1hZ2Upe1xuICAgIHRoaXMuYmFja2dyb3VuZEltYWdlLnVwZGF0ZVJlc3BvbnNpdmVCb3JkZXIoKTtcbiAgfVxuICBmb3IodmFyIGkgaW4gdGhpcy5fb2JqZWN0cyl7XG4gICAgdGhpcy5fb2JqZWN0c1tpXS51cGRhdGVSZXNwb25zaXZlQm9yZGVyKCk7XG4gIH1cbn07XG5cbmZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUuX2RlZmF1bHRfZXZlbnRfbGlzdGVuZXJzW1wiYmFja2dyb3VuZC1pbWFnZTpsb2FkZWRcIl0gPSBmdW5jdGlvbihldmVudCl7XG4gIGlmKHRoaXMuYXV0b0NlbnRlckFuZFpvb21PdXRFbmFibGVkKSB7XG4gICAgdGhpcy5jZW50ZXJBbmRab29tT3V0KCk7XG4gIH1cbn07XG5cbmZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUuX2RlZmF1bHRfZXZlbnRfbGlzdGVuZXJzW1wibG9hZGluZzplbmRcIl0gPSBmdW5jdGlvbihldmVudCl7XG4gIGlmKHRoaXMuYXV0b0NlbnRlckFuZFpvb21PdXRFbmFibGVkICYmICh0aGlzLm9yaWdpbmFsSGVpZ2h0IHx8IHRoaXMub3JpZ2luYWxXaWR0aCkgKXtcbiAgICB0aGlzLmNlbnRlckFuZFpvb21PdXQoKTtcbiAgfVxufTtcblxuXG5cbmZhYnJpYy5TbGlkZUNhbnZhcy5wcm90b3R5cGUuX2RlZmF1bHRfZXZlbnRfbGlzdGVuZXJzW1wib2JqZWN0OmFkZGVkXCJdID0gZnVuY3Rpb24oZXZlbnQpe1xuICBldmVudC50YXJnZXQudXBkYXRlUmVzcG9uc2l2ZUJvcmRlcigpXG59O1xuXG5cbi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG5cblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuU2xpZGVDYW52YXMucHJvdG90eXBlLCB7XG4gIHpvb21DdHJsS2V5OiB0cnVlLFxuICBtb3VzZVdoZWVsRW5hYmxlZCA6IGZhbHNlLFxuICBfc2V0Wm9vbU5hdGl2ZSAgOiBmYWJyaWMuQ2FudmFzLnByb3RvdHlwZS5zZXRab29tLFxuICBfem9vbVRvUG9pbnROYXRpdmUgIDogZmFicmljLkNhbnZhcy5wcm90b3R5cGUuem9vbVRvUG9pbnQsXG4gIGluc2VydFpvb21Ub29sczogZmFsc2UsXG4gIGluc2VydFpvb21OdW1iZXI6IGZhbHNlLFxuICBjaGFuZ2VEaW1lbnNpb25Pblpvb206IGZhbHNlLFxuICBkcmF3Wm9vbUFyZWEgOiBmdW5jdGlvbihfY3R4LGxlZnQsIHRvcCAsd2lkdGgsIGhlaWdodCApe1xuICAgIF9jdHguc2F2ZSgpO1xuICAgIF9jdHgudHJhbnNsYXRlKGxlZnQgfHwgMCwgdG9wIHx8IDApO1xuICAgIHZhciBfc2NhbGUgPSB0aGlzLmdldFpvb20oKTtcbiAgICB2YXIgX3NpemUgPSBmYWJyaWMudXRpbC5nZXRQcm9wb3J0aW9ucyh0aGlzLmJhY2tncm91bmRJbWFnZSwge3dpZHRoOiB3aWR0aCB8fCAxMDAsIGhlaWdodDogaGVpZ2h0IHx8IDEwMH0pO1xuICAgIF9jdHguZ2xvYmFsQWxwaGEgPSAwLjU7XG4gICAgX2N0eC5maWxsUmVjdCgwLDAsX3NpemUud2lkdGgsIF9zaXplLmhlaWdodCk7XG4gICAgX2N0eC5zdHJva2VTdHlsZSA9IFwicmVkXCI7XG5cbiAgICB2YXIgdiA9IHRoaXMudmlld3BvcnRUcmFuc2Zvcm07XG5cbiAgICB2YXIgeDEgPSAtdls0XSAqIF9zaXplLnNjYWxlIC8gX3NjYWxlO1xuICAgIHZhciB5MSA9IC12WzVdICogX3NpemUuc2NhbGUgLyBfc2NhbGU7XG4gICAgdmFyIHgyID0geDEgKyB0aGlzLndpZHRoICogX3NpemUuc2NhbGUgLyBfc2NhbGU7XG4gICAgdmFyIHkyID0geTEgKyB0aGlzLmhlaWdodCAqIF9zaXplLnNjYWxlIC8gX3NjYWxlO1xuXG4gICAgeDEgPSBNYXRoLm1heCh4MSwwKTtcbiAgICB5MSA9IE1hdGgubWF4KHkxLDApO1xuICAgIHgyID0gTWF0aC5taW4oeDIsX3NpemUud2lkdGgpO1xuICAgIHkyID0gTWF0aC5taW4oeTIsX3NpemUuaGVpZ2h0KTtcblxuICAgIF9jdHguZ2xvYmFsQWxwaGEgPSAxO1xuICAgIF9jdHguYmVnaW5QYXRoKCk7XG4gICAgX2N0eC5tb3ZlVG8oeDEseTEpO1xuICAgIF9jdHgubGluZVRvKHgyLHkxKTtcbiAgICBfY3R4LmxpbmVUbyh4Mix5Mik7XG4gICAgX2N0eC5saW5lVG8oeDEseTIpO1xuICAgIF9jdHgubGluZVRvKHgxLHkxKTtcblxuICAgIF9jdHguZmlsbCgpO1xuICAgIF9jdHguY2xpcCgpO1xuICAgIC8vIF9jdHguZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gXCJzb3VyY2UtaW5cIjtcbiAgICBfY3R4LmRyYXdJbWFnZSh0aGlzLmJhY2tncm91bmRJbWFnZS5fZWxlbWVudCwwLDAsX3NpemUud2lkdGgsIF9zaXplLmhlaWdodClcbiAgICAvLyBfY3R4Lmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9IFwic291cmNlLW92ZXJcIjtcbiAgICAvLyBfY3R4LmRyYXdJbWFnZSh0aGlzLmJhY2tncm91bmRJbWFnZS5fZWxlbWVudCwwLDAsX3NpemUud2lkdGgsIF9zaXplLmhlaWdodClcbiAgICBfY3R4LnN0cm9rZSgpO1xuICAgIF9jdHguc3Ryb2tlUmVjdCgwLDAsX3NpemUud2lkdGgsIF9zaXplLmhlaWdodCk7XG4gICAgX2N0eC5yZXN0b3JlKCk7XG4gIH0sXG4gIHNldFpvb206IGZ1bmN0aW9uIChfc2NhbGUpe1xuICAgIGlmKHRoaXMuY2hhbmdlRGltZW5zaW9uT25ab29tKXtcbiAgICAgIHZhciBfdyA9IE1hdGgucm91bmQodGhpcy5vcmlnaW5hbFdpZHRoICogX3NjYWxlKTtcbiAgICAgIHZhciBfaCA9IE1hdGgucm91bmQodGhpcy5vcmlnaW5hbEhlaWdodCAqIF9zY2FsZSk7XG4gICAgICB0aGlzLnNldERpbWVuc2lvbnMoe1xuICAgICAgICB3aWR0aDogX3csXG4gICAgICAgIGhlaWdodDogX2hcbiAgICAgIH0pO1xuICAgIH1cbiAgICB0aGlzLl96b29tVG9Qb2ludE5hdGl2ZSggbmV3IGZhYnJpYy5Qb2ludCgwLCAwKSwgX3NjYWxlKVxuICAgIC8vICB0aGlzLl9zZXRab29tTmF0aXZlKF9zY2FsZSk7XG4gICAgdGhpcy5maXJlKCd2aWV3cG9ydDpzY2FsZWQnLCB7c2NhbGU6IF9zY2FsZX0pO1xuICB9LFxuICB6b29tVG9Qb2ludDogZnVuY3Rpb24ocG9pbnQsIG5ld1pvb20pe1xuICAgIHZhciBfbWF4ID0gIHRoaXMuZ2V0TWF4Wm9vbSgpO1xuICAgIHZhciBfbWluID0gIHRoaXMuZ2V0TWluWm9vbSgpLnNjYWxlO1xuICAgIGlmKG5ld1pvb20gPiBfbWF4KXtcbiAgICAgIG5ld1pvb20gPSBfbWF4O1xuICAgIH1cbiAgICBpZihuZXdab29tIDwgX21pbil7XG4gICAgICBuZXdab29tID0gX21pbjtcbiAgICB9XG4gICAgdGhpcy5fem9vbVRvUG9pbnROYXRpdmUoIHBvaW50LCBuZXdab29tKTtcbiAgICBmb3IgKHZhciBpIGluIHRoaXMuX29iamVjdHMpIHtcbiAgICAgIHRoaXMuX29iamVjdHNbaV0uc2V0Q29vcmRzKCk7XG4gICAgfVxuICAgIHRoaXMuZmlyZSgndmlld3BvcnQ6c2NhbGVkJywge3NjYWxlOiBuZXdab29tfSk7XG4gIH0sXG4gIHJlc2V0Vmlld3BvcnQ6IGZ1bmN0aW9uICgpIHtcbiAgICBfY2FudmFzLnZpZXdwb3J0VHJhbnNmb3JtWzBdID0gMTtcbiAgICBfY2FudmFzLnZpZXdwb3J0VHJhbnNmb3JtWzNdID0gMTtcbiAgICBfY2FudmFzLnZpZXdwb3J0VHJhbnNmb3JtWzRdID0gMDtcbiAgICBfY2FudmFzLnZpZXdwb3J0VHJhbnNmb3JtWzVdID0gMDtcbiAgICBfY2FudmFzLnJlbmRlckFsbCgpO1xuICAgIGZvciAodmFyIGkgaW4gdGhpcy5fb2JqZWN0cykge1xuICAgICAgdGhpcy5fb2JqZWN0c1tpXS5zZXRDb29yZHMoKTtcbiAgICB9XG4gIH0sXG4gIHpvb21Ub1BvaW50RW5hYmxlZDogdHJ1ZSxcbiAgbWluWm9vbUZhY3RvcjogMSxcbiAgbWF4Wm9vbTogMjAsXG4gIGF1dG9DZW50ZXJBbmRab29tT3V0RW5hYmxlZDogZmFsc2UsXG4gIGdldE1heFpvb206IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5tYXhab29tO1xuICB9LFxuICBnZXRNaW5ab29tOiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIF9jb250YWluZXJTaXplID0ge1xuICAgICAgd2lkdGg6ICQodGhpcy53cmFwcGVyRWwpLndpZHRoKCksXG4gICAgICBoZWlnaHQ6ICQodGhpcy53cmFwcGVyRWwpLmhlaWdodCgpXG4gICAgfTtcbiAgICB2YXIgX2JnU2l6ZSA9IHtcbiAgICAgIHdpZHRoOiB0aGlzLm9yaWdpbmFsV2lkdGgsXG4gICAgICBoZWlnaHQ6IHRoaXMub3JpZ2luYWxIZWlnaHRcbiAgICB9O1xuICAgIHZhciBfbWF4U2l6ZSA9IHtcbiAgICAgIHdpZHRoOiBfY29udGFpbmVyU2l6ZS53aWR0aCAqIHRoaXMubWluWm9vbUZhY3RvcixcbiAgICAgIGhlaWdodDogX2NvbnRhaW5lclNpemUuaGVpZ2h0ICogdGhpcy5taW5ab29tRmFjdG9yXG4gICAgfTtcblxuICAgIHJldHVybiBmYWJyaWMudXRpbC5nZXRQcm9wb3J0aW9ucyhfYmdTaXplLCBfbWF4U2l6ZSwgJ2ZpdCcpO1xuICB9LFxuICBjZW50ZXJBbmRab29tT3V0OiBmdW5jdGlvbiAoKSB7XG5cbiAgICB2YXIgb3B0aW9ucyA9IHRoaXMuZ2V0TWluWm9vbSgpO1xuXG4gICAgdmFyIF9jb250YWluZXJTaXplID0ge1xuICAgICAgd2lkdGg6ICQodGhpcy53cmFwcGVyRWwpLndpZHRoKCksXG4gICAgICBoZWlnaHQ6ICQodGhpcy53cmFwcGVyRWwpLmhlaWdodCgpXG4gICAgfTtcbiAgICB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzRdID0gKF9jb250YWluZXJTaXplLndpZHRoIC0gb3B0aW9ucy53aWR0aCApIC8gMjtcbiAgICB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzVdID0gKF9jb250YWluZXJTaXplLmhlaWdodCAtIG9wdGlvbnMuaGVpZ2h0KSAvIDI7XG4gICAgdGhpcy5zZXRab29tKG9wdGlvbnMuc2NhbGUpO1xuICAgIHRoaXMuX3VwZGF0ZV9iYWNrZ3JvdW5kX2ltYWdlKCk7XG4gICAgLy8gdGhpcy5maXJlKFwidmlld3BvcnQ6c2NhbGVkXCIse3NjYWxlOiBvcHRpb25zLnNjYWxlfSlcbiAgICAvL3RoaXMucmVuZGVyQWxsKCk7XG4gIH0sXG4gIGNlbnRlck9uT2JqZWN0OiBmdW5jdGlvbih0YWcpe1xuICAgIHZhciBiciA9IHRhZy5nZXRCb3VuZGluZ1JlY3QoKTtcbiAgICB2YXIgY3QgPSB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtO1xuICAgIGJyLndpZHRoIC89IGN0WzBdO1xuICAgIGJyLmhlaWdodCAvPSBjdFszXTtcbiAgICB2YXIgc2l6ZSA9IHtcbiAgICAgIHdpZHRoOiBici53aWR0aCAqIDEuMSxcbiAgICAgIGhlaWdodDogYnIuaGVpZ2h0ICogMS4xXG4gICAgfTtcblxuICAgIHZhciBwcm9wID0gZmFicmljLnV0aWwuZ2V0UHJvcG9ydGlvbnMoc2l6ZSx0aGlzKTtcbiAgICB2YXIgX3cgPSAodGhpcy53aWR0aCAvIHByb3Auc2NhbGUgLSBzaXplLndpZHRoICkgLyAyO1xuICAgIHZhciBfaCA9ICh0aGlzLmhlaWdodCAvIHByb3Auc2NhbGUgLSBzaXplLmhlaWdodCkgLyAyO1xuICAgIHZhciBfbCA9IChici5sZWZ0ICAtIGN0WzRdKSAvIGN0WzBdO1xuICAgIHZhciBfdCA9IChici50b3AgLSBjdFs1XSkgLyBjdFszXTtcblxuICAgIHZhciB4MSA9IFtcbiAgICAgIHByb3Auc2NhbGUsXG4gICAgICAwLDAsXG4gICAgICBwcm9wLnNjYWxlLFxuICAgICAgLSB0YWcubGVmdCAqIHByb3Auc2NhbGUgKyAodGFnLndpZHRoICogMC4wNSArIF93KSAqIHByb3Auc2NhbGUsXG4gICAgICAtIHRhZy50b3AgKiBwcm9wLnNjYWxlICsgKHRhZy5oZWlnaHQgKiAwLjA1ICsgX2ggKSogcHJvcC5zY2FsZVxuICAgIF07XG4gICAgdmFyIHgyID0gW1xuICAgICAgcHJvcC5zY2FsZSxcbiAgICAgIDAsMCxcbiAgICAgIHByb3Auc2NhbGUsXG4gICAgICAtIF9sICAqIHByb3Auc2NhbGUgKyAoYnIud2lkdGggKiAwLjA1ICsgX3cpICogcHJvcC5zY2FsZSxcbiAgICAgIC0gX3QgICogcHJvcC5zY2FsZSArIChici5oZWlnaHQgKiAwLjA1ICsgX2ggKSogcHJvcC5zY2FsZVxuICAgIF07XG5cbiAgICB0aGlzLnNldFZpZXdwb3J0VHJhbnNmb3JtKHgyKTtcbiAgICB0aGlzLmZpcmUoXCJ2aWV3cG9ydDpzY2FsZWRcIix7c2NhbGU6IHByb3Auc2NhbGV9KVxuICAgIHRoaXMucmVuZGVyQWxsKCk7XG4gIH0sXG5cbiAgX19vbk1vdXNlV2hlZWw6IGZ1bmN0aW9uIChldmVudCkge1xuXG4gICAgaWYoIXRoaXMubW91c2VXaGVlbEVuYWJsZWQgfHwgdGhpcy56b29tQ3RybEtleSAmJiAhZXZlbnQuY3RybEtleSl7XG4gICAgICByZXR1cm47XG4gICAgfVxuLy9GaW5kIG5lYXJlc3QgcG9pbnQsIHRoYXQgaXMgaW5zaWRlIGltYWdlIEVORFxuICAgIHZhciB6b29tU3RlcDsvLyA9IDAuMSAqIGV2ZW50LmRlbHRhWTtcbiAgICBpZiAoZXZlbnQuZGVsdGFZIDwgMCkge1xuICAgICAgem9vbVN0ZXAgPSAxLjE7XG4gICAgfSBlbHNlIHtcbiAgICAgIHpvb21TdGVwID0gMC45O1xuICAgIH1cblxuICAgIHZhciBuZXdab29tID0gdGhpcy5nZXRab29tKCkgKiB6b29tU3RlcDtcbiAgICB2YXIgbWluWm9vbSA9IHRoaXMuZ2V0TWluWm9vbSgpLnNjYWxlO1xuXG5cbiAgICBpZih0aGlzLnpvb21Ub1BvaW50RW5hYmxlZCl7XG4gICAgICB2YXIgcG9pbnQgPSBuZXcgZmFicmljLlBvaW50KGV2ZW50Lm9mZnNldFgsIGV2ZW50Lm9mZnNldFkpO1xuICAgICAgdmFyIF94ID0gdGhpcy52aWV3cG9ydFRyYW5zZm9ybVs0XTtcbiAgICAgIHZhciBfeSA9IHRoaXMudmlld3BvcnRUcmFuc2Zvcm1bNV07XG5cbiAgICAgIC8vIEZpbmQgbmVhcmVzdCBwb2ludCwgdGhhdCBpcyBpbnNpZGUgaW1hZ2UgQkVHSU5cbiAgICAgIC8vIEl0IGlzIG5lZWRlZCB0byBwcmV2ZW50IGNhbnZhcyB0byB6b29tIG91dHNpZGUgaW1hZ2VcbiAgICAgIHZhciBfdyA9IHRoaXMub3JpZ2luYWxXaWR0aCAqIHRoaXMuZ2V0Wm9vbSgpICsgX3g7XG4gICAgICB2YXIgX2ggPSB0aGlzLm9yaWdpbmFsSGVpZ2h0ICogdGhpcy5nZXRab29tKCkgKyBfeTtcblxuXG4gICAgICBpZiAocG9pbnQueCA8IF94KSB7XG4gICAgICAgIHBvaW50LnggPSBfeDtcbiAgICAgIH1cbiAgICAgIGlmIChwb2ludC55IDwgX3kpIHtcbiAgICAgICAgcG9pbnQueSA9IF95O1xuICAgICAgfVxuICAgICAgaWYgKHBvaW50LnggPiBfdykge1xuICAgICAgICBwb2ludC54ID0gX3c7XG4gICAgICB9XG4gICAgICBpZiAocG9pbnQueSA+IF9oKSB7XG4gICAgICAgIHBvaW50LnkgPSBfaDtcbiAgICAgIH1cbiAgICAgIGlmIChtaW5ab29tID4gbmV3Wm9vbSkge1xuICAgICAgICBpZih0aGlzLmF1dG9DZW50ZXJBbmRab29tT3V0RW5hYmxlZCl7XG4gICAgICAgICAgdGhpcy5jZW50ZXJBbmRab29tT3V0KCk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuem9vbVRvUG9pbnQocG9pbnQsIG5ld1pvb20pO1xuICAgICAgfVxuICAgIH1lbHNle1xuICAgICAgdGhpcy5zZXRab29tKG5ld1pvb20pO1xuICAgIH1cblxuXG5cblxuICAgIGZvciAodmFyIGkgaW4gdGhpcy5fb2JqZWN0cykge1xuICAgICAgdGhpcy5fb2JqZWN0c1tpXS5zZXRDb29yZHMoKTtcbiAgICB9XG4gICAgdGhpcy5yZW5kZXJBbGwoKTtcbiAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIHJldHVybiBmYWxzZTsgLy9wcmV2ZW50aW5nIHNjcm9sbCBwYWdlXG4gIH0sXG4gIHNjYWxlRmFjdG9yOiAxLjEsXG4gIGdldE9yaWduYWxDZW50ZXIgOiBmdW5jdGlvbigpe1xuICAgIHZhciBwb2ludCA9IHRoaXMuZ2V0Q2VudGVyKCk7XG4gICAgcG9pbnQubGVmdCArPSB0aGlzLnZpZXdwb3J0VHJhbnNmb3JtWzRdIDtcbiAgICBwb2ludC50b3AgKz0gdGhpcy52aWV3cG9ydFRyYW5zZm9ybVs1XTtcbiAgICByZXR1cm4gcG9pbnQ7XG4gIH1cbn0pO1xuXG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLlNsaWRlQ2FudmFzLnByb3RvdHlwZS5hY3Rpb25zLCB7XG4gIHpvb206IHtcbiAgICB0aXRsZTogXCJ6b29tXCIsXG4gICAgbWVudToge1xuICAgICAgem9vbU91dDoge1xuICAgICAgICBjbGFzc05hbWU6ICdmYSBmYS1zZWFyY2gtbWludXMnLFxuICAgICAgICBpbnNlcnQ6IFwiaW5zZXJ0Wm9vbVRvb2xzXCIsXG4gICAgICAgIHRpdGxlOiAnem9vbS1vdXQnLFxuICAgICAgICBhY3Rpb246IGZ1bmN0aW9uIChtKSB7XG4gICAgICAgICAgdmFyIHBvaW50ID0gdGhpcy5nZXRPcmlnbmFsQ2VudGVyKCk7XG4gICAgICAgICAgdmFyIHNjYWxlVmFsdWUgPSB0aGlzLmdldFpvb20oKSAvIHRoaXMuc2NhbGVGYWN0b3I7XG4gICAgICAgICAgdGhpcy56b29tVG9Qb2ludCh7eDogcG9pbnQubGVmdCwgeTogcG9pbnQudG9wfSxzY2FsZVZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHpvb21OdW1iZXI6IHtcbiAgICAgICAgdHlwZTogJ251bWJlcicsXG4gICAgICAgIHZhbHVlOiB7XG4gICAgICAgICAgbWluOiAgZnVuY3Rpb24oKXtyZXR1cm4gMC4wMX0sXG4gICAgICAgICAgbWF4OiAgZnVuY3Rpb24oKXtyZXR1cm4gMTB9LFxuICAgICAgICAgIHNldDogZnVuY3Rpb24gKHZhbCkge1xuICAgICAgICAgICAgdGhpcy5zZXRab29tKHZhbClcbiAgICAgICAgICB9LFxuICAgICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0Wm9vbSgpXG4gICAgICAgICAgfSxcbiAgICAgICAgICBvYnNlcnZlOiBcInZpZXdwb3J0OnNjYWxlZFwiXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB6b29tSW46IHtcbiAgICAgICAgY2xhc3NOYW1lOiAnZmEgZmEtc2VhcmNoLXBsdXMnLFxuICAgICAgICBpbnNlcnQ6IFwiaW5zZXJ0Wm9vbVRvb2xzXCIsXG4gICAgICAgIHRpdGxlOiAnem9vbS1pbicsXG4gICAgICAgIGFjdGlvbjogZnVuY3Rpb24gKG0pIHtcbiAgICAgICAgICB2YXIgcG9pbnQgPSB0aGlzLmdldE9yaWduYWxDZW50ZXIoKTtcbiAgICAgICAgICB2YXIgc2NhbGVWYWx1ZSA9IHRoaXMuZ2V0Wm9vbSgpICogdGhpcy5zY2FsZUZhY3RvcjtcbiAgICAgICAgICB0aGlzLnpvb21Ub1BvaW50KHt4OiBwb2ludC5sZWZ0LCB5OiBwb2ludC50b3B9LHNjYWxlVmFsdWUpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG59KTtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vbW9kdWxlcy96b29tLmpzXG4vLyBtb2R1bGUgaWQgPSA4NlxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCIndXNlIHN0cmljdCc7XG5cbi8vZmFicmljLnJlcXVpcmUoXCJCZXppZXJUZXh0XCIsW1wiQmV6aWVyTWl4aW5cIl0sIGZ1bmN0aW9uKCkge1xuICAvL2ZhYnJpYy5JVGV4dCxcbiAgZmFicmljLkJlemllclRleHQgPSBmYWJyaWMudXRpbC5jcmVhdGVDbGFzcyhmYWJyaWMuSVRleHQsZmFicmljLkJlemllck1peGluLCB7XG4gICAgdHlwZTogJ2Jlemllci10ZXh0JyxcbiAgICBiZXppZXJDb250cm9sczogdHJ1ZSxcbiAgICBiYWNrZ3JvdW5kQ29sb3I6IGZhbHNlLFxuICAgIGJhY2tncm91bmRTdHJva2U6IGZhbHNlLFxuICAgIG91dGxpbmVUb3A6IDAsXG4gICAgb3V0bGluZUJvdHRvbTogMCxcbiAgICAvLyBvdXRsaW5lVG9wOiA0MCxcbiAgICAvLyBvdXRsaW5lQm90dG9tOiAwLFxuICAgIHN0YXRlUHJvcGVydGllczogZmFicmljLklUZXh0LnByb3RvdHlwZS5zdGF0ZVByb3BlcnRpZXMuY29uY2F0KFtcInBvaW50c1wiICwgXCJiYWNrZ3JvdW5kU3Ryb2tlXCIgXSksXG4gICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKHRleHQsIG9wdGlvbnMpIHtcbiAgICAgIHRoaXMuY3R4ID0gZmFicmljLnV0aWwuY3JlYXRlQ2FudmFzRWxlbWVudCgpLmdldENvbnRleHQoJzJkJyk7XG4gICAgICB0aGlzLnRleHQgPSB0ZXh0O1xuICAgICAgaWYoIXRoaXMub3V0bGluZVRvcCl7XG4gICAgICAgIG9wdGlvbnMub3V0bGluZVRvcCA9IG9wdGlvbnMub3V0bGluZVRvcCB8fCBvcHRpb25zLmZvbnRTaXplIHx8IHRoaXMuZm9udFNpemU7XG4gICAgICB9XG4gICAgICBpZighdGhpcy5vdXRsaW5lQm90dG9tKXtcbiAgICAgICAgb3B0aW9ucy5vdXRsaW5lQm90dG9tID0gb3B0aW9ucy5vdXRsaW5lQm90dG9tIHx8ICgob3B0aW9ucy5mb250U2l6ZSB8fCB0aGlzLmZvbnRTaXplKSAvIDQpO1xuICAgICAgfVxuICAgICAgb3B0aW9ucyB8fCAoIG9wdGlvbnMgPSB7fSk7XG4gICAgICB0aGlzLmNhbGxTdXBlcignaW5pdGlhbGl6ZScsdGV4dCwgIG9wdGlvbnMpO1xuICAgICAgLy90aGlzLmN1cnZlID0gbmV3IChGdW5jdGlvbi5wcm90b3R5cGUuYmluZC5hcHBseShCZXppZXIsIG9wdGlvbnMucG9pbnRzKSk7XG5cbi8vdG9kb1xuLy8gICAgICBpZighdGhpcy5zdHlsZXMgfHwgXy5pc0VtcHR5KHRoaXMuc3R5bGVzKSl7XG4vLyAgICAgICAgdmFyIHN0eWxlID0gdGhpcy5nZXRDdXJyZW50Q2hhclN0eWxlKDAsMCk7XG4vLyAgICAgICAgc3R5bGUuc3Ryb2tlV2lkdGgrKztcbi8vICAgICAgICB0aGlzLnN0eWxlcyA9IHswOiB7MDogc3R5bGV9fTtcbi8vICAgICAgfVxuLy8gICAgICAgdGhpcy5pbml0QmV6aWVyKCk7XG5cblxuXG5cbiAgICAgIG9wdGlvbnMucG9pbnRzID0gb3B0aW9ucy5wb2ludHMgfHwgW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIHg6IDAsXG4gICAgICAgICAgICB5OiB0aGlzLmZvbnRTaXplLFxuICAgICAgICAgICAgYzoge1xuICAgICAgICAgICAgICB4OiBvcHRpb25zLndpZHRoICogMC4zLFxuICAgICAgICAgICAgICB5OiB0aGlzLmZvbnRTaXplICsgMC41XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYzI6IHtcbiAgICAgICAgICAgICAgeDogb3B0aW9ucy53aWR0aCAqIDAuNyxcbiAgICAgICAgICAgICAgeTogdGhpcy5mb250U2l6ZSArIDAuNVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgeDogb3B0aW9ucy53aWR0aCxcbiAgICAgICAgICAgIHk6IHRoaXMuZm9udFNpemVcbiAgICAgICAgICB9LFxuICAgICAgICBdO1xuXG4gICAgICB0aGlzLnNldFBvaW50cyhvcHRpb25zLnBvaW50cyk7XG4gICAgICB0aGlzLm9uKFwiYWRkZWRcIixmdW5jdGlvbigpe1xuICAgICAgICB0aGlzLnVwZGF0ZUJib3goKTtcbiAgICAgIH0pXG4gICAgfSxcbiAgICBfZ2V0VGV4dFdpZHRoOiBmdW5jdGlvbihjdHgpe1xuICAgICAgcmV0dXJuIHRoaXMud2lkdGg7XG4gICAgfSxcbiAgICBfZ2V0VGV4dEhlaWdodDogZnVuY3Rpb24oY3R4KXtcbiAgICAgIHJldHVybiB0aGlzLmhlaWdodDtcbiAgICB9LFxuICAgIF9nZXRUb3BPZmZzZXQ6IGZ1bmN0aW9uKCl7XG4gICAgICByZXR1cm4gMDtcbiAgICB9LFxuICAgIF9nZXRMZWZ0T2Zmc2V0OiBmdW5jdGlvbigpe1xuICAgICAgcmV0dXJuIDA7XG4gICAgfSxcblxuICAgIF9jbGVhclRleHRBcmVhOiBmdW5jdGlvbihjdHgpIHtcbiAgICAgIC8vIHdlIGFkZCA0IHBpeGVsLCB0byBiZSBzdXJlIHRvIGRvIG5vdCBsZWF2ZSBhbnkgcGl4ZWwgb3V0XG4gICAgICB2YXIgd2lkdGggPSB0aGlzLndpZHRoICsgNCwgaGVpZ2h0ID0gdGhpcy5oZWlnaHQgKyA0O1xuICAgICAgY3R4LmNsZWFyUmVjdCgtd2lkdGggLyAyLCAtaGVpZ2h0IC8gMiwgd2lkdGgsIGhlaWdodCk7XG4gICAgfSxcbiAgICAvKipcbiAgICAgKiBSZW5kZXJzIHRleHQgc2VsZWN0aW9uXG4gICAgICogQHBhcmFtIHtBcnJheX0gY2hhcnMgQXJyYXkgb2YgY2hhcmFjdGVyc1xuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBib3VuZGFyaWVzIE9iamVjdCB3aXRoIGxlZnQvdG9wL2xlZnRPZmZzZXQvdG9wT2Zmc2V0XG4gICAgICogQHBhcmFtIHtDYW52YXNSZW5kZXJpbmdDb250ZXh0MkR9IGN0eCB0cmFuc2Zvcm1lZCBjb250ZXh0IHRvIGRyYXcgb25cbiAgICAgKi9cbiAgICByZW5kZXJTZWxlY3Rpb246IGZ1bmN0aW9uKGNoYXJzLCBib3VuZGFyaWVzLCBjdHgpIHtcblxuICAgICAgY3R4LmZpbGxTdHlsZSA9IHRoaXMuc2VsZWN0aW9uQ29sb3I7XG5cbiAgICAgIHZhciBzdGFydCA9IHRoaXMuZ2V0MkRDdXJzb3JMb2NhdGlvbih0aGlzLnNlbGVjdGlvblN0YXJ0KSxcbiAgICAgICAgZW5kID0gdGhpcy5nZXQyREN1cnNvckxvY2F0aW9uKHRoaXMuc2VsZWN0aW9uRW5kKSxcbiAgICAgICAgc3RhcnRMaW5lID0gc3RhcnQubGluZUluZGV4LFxuICAgICAgICBlbmRMaW5lID0gZW5kLmxpbmVJbmRleDtcblxuICAgICAgZm9yICh2YXIgaSA9IHN0YXJ0LmNoYXJJbmRleDsgaSA8PSBlbmQuY2hhckluZGV4OyBpKyspIHtcblxuXG4gICAgICAgIHZhciB0LCBwdCwgbnYsIGFuZ2xlO1xuICAgICAgICB0ID0gdGhpcy5fY2hhclBvaW50c1tpXTtcbiAgICAgICAgcHQgPSB0aGlzLnBvaW50c1twYXJzZUludCh0KV0uY3VydmUuZ2V0KHQpO1xuICAgICAgICBudiA9IHRoaXMucG9pbnRzW3BhcnNlSW50KHQpXS5jdXJ2ZS5ub3JtYWwodCk7XG4gICAgICAgIGFuZ2xlID0gLSBNYXRoLmF0YW4yKG52LngsIG52LnkpIDtcbiAgICAgICAgdmFyIGNoYXJIZWlnaHQgPSB0aGlzLmdldEN1cnJlbnRDaGFyRm9udFNpemUoMCwgaSk7XG4gICAgICAgIHZhciBib3hXaWR0aCA9IHRoaXMuX2dldFdpZHRoT2ZDaGFyKGN0eCwgY2hhcnNbaV0sIDAsIGkpO1xuXG4gICAgICAgIGN0eC5zYXZlKCk7XG4gICAgICAgIGN0eC50cmFuc2xhdGUoLSB0aGlzLndpZHRoLzIsIC0gdGhpcy5oZWlnaHQvMik7XG4gICAgICAgIGN0eC50cmFuc2xhdGUocHQueCArIHRoaXMuY3VydmVUZXh0T2Zmc2V0Km52LnggLHB0LnkgKyAgdGhpcy5jdXJ2ZVRleHRPZmZzZXQqbnYueSk7XG4gICAgICAgIGN0eC5yb3RhdGUoYW5nbGUpO1xuICAgICAgICBjdHguZmlsbFJlY3QoMCwgMCxcbiAgICAgICAgICBib3hXaWR0aCxcbiAgICAgICAgICAtY2hhckhlaWdodCk7XG5cbiAgICAgICAgY3R4LnJlc3RvcmUoKTtcbiAgICAgIH1cbiAgICAgIC8vXG4gICAgICAvL2N0eC5maWxsUmVjdChcbiAgICAgIC8vICBib3VuZGFyaWVzLmxlZnQgKyBsaW5lT2Zmc2V0LFxuICAgICAgLy8gIGJvdW5kYXJpZXMudG9wICsgYm91bmRhcmllcy50b3BPZmZzZXQsXG4gICAgICAvLyAgYm94V2lkdGgsXG4gICAgICAvLyAgbGluZUhlaWdodCk7XG5cbiAgICB9LFxuICAgIGRyYXdDb250cm9sc0ludGVyZmFjZTogZnVuY3Rpb24gKGN0eCkge1xuICAgICAgdGhpcy5kcmF3QmV6aWVyU2hhcGVDb250cm9scyhjdHgpO1xuICAgIH0sXG4gICAgLyoqXG4gICAgICogQHByaXZhdGVcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gbWV0aG9kIE1ldGhvZCBuYW1lIChcImZpbGxUZXh0XCIgb3IgXCJzdHJva2VUZXh0XCIpXG4gICAgICogQHBhcmFtIHtDYW52YXNSZW5kZXJpbmdDb250ZXh0MkR9IGN0eCBDb250ZXh0IHRvIHJlbmRlciBvblxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBsaW5lIFRleHQgdG8gcmVuZGVyXG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IGxlZnQgTGVmdCBwb3NpdGlvbiBvZiB0ZXh0XG4gICAgICogQHBhcmFtIHtOdW1iZXJ9IHRvcCBUb3AgcG9zaXRpb24gb2YgdGV4dFxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSBsaW5lSW5kZXggSW5kZXggb2YgYSBsaW5lIGluIGEgdGV4dFxuICAgICAqL1xuICAgIF9yZW5kZXJUZXh0TGluZTogZnVuY3Rpb24obWV0aG9kLCBjdHgsIGxpbmUsIGxlZnQsIHRvcCwgbGluZUluZGV4KSB7XG4gICAgICAvLyBsaWZ0IHRoZSBsaW5lIGJ5IHF1YXJ0ZXIgb2YgZm9udFNpemVcbiAgICAgIHRvcCAtPSB0aGlzLmZvbnRTaXplICogdGhpcy5fZm9udFNpemVGcmFjdGlvbjtcblxuICAgICAgLy8gc2hvcnQtY2lyY3VpdFxuICAgICAgdmFyIGxpbmVXaWR0aCA9IHRoaXMuX2dldExpbmVXaWR0aChjdHgsIGxpbmVJbmRleCk7XG4gICAgICB0aGlzLl9yZW5kZXJDaGFycyhtZXRob2QsIGN0eCwgbGluZSwgbGVmdCwgdG9wLCBsaW5lSW5kZXgpO1xuICAgICAgLypcbiAgICAgICAvL2p1c3RpZnlcbiAgICAgICB2YXIgd29yZHMgPSBsaW5lLnNwbGl0KC9cXHMrLyksXG4gICAgICAgY2hhck9mZnNldCA9IDAsXG4gICAgICAgd29yZHNXaWR0aCA9IHRoaXMuX2dldFdpZHRoT2ZXb3JkcyhjdHgsIGxpbmUsIGxpbmVJbmRleCwgMCksXG4gICAgICAgd2lkdGhEaWZmID0gdGhpcy53aWR0aCAtIHdvcmRzV2lkdGgsXG4gICAgICAgbnVtU3BhY2VzID0gd29yZHMubGVuZ3RoIC0gMSxcbiAgICAgICBzcGFjZVdpZHRoID0gbnVtU3BhY2VzID4gMCA/IHdpZHRoRGlmZiAvIG51bVNwYWNlcyA6IDAsXG4gICAgICAgbGVmdE9mZnNldCA9IDAsIHdvcmQ7XG5cbiAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gd29yZHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICB3aGlsZSAobGluZVtjaGFyT2Zmc2V0XSA9PT0gJyAnICYmIGNoYXJPZmZzZXQgPCBsaW5lLmxlbmd0aCkge1xuICAgICAgIGNoYXJPZmZzZXQrKztcbiAgICAgICB9XG4gICAgICAgd29yZCA9IHdvcmRzW2ldO1xuICAgICAgIHRoaXMuX3JlbmRlckNoYXJzKG1ldGhvZCwgY3R4LCB3b3JkLCBsZWZ0ICsgbGVmdE9mZnNldCwgdG9wLCBsaW5lSW5kZXgsIGNoYXJPZmZzZXQpO1xuICAgICAgIGxlZnRPZmZzZXQgKz0gdGhpcy5fZ2V0V2lkdGhPZldvcmRzKGN0eCwgd29yZCwgbGluZUluZGV4LCBjaGFyT2Zmc2V0KSArIHNwYWNlV2lkdGg7XG4gICAgICAgY2hhck9mZnNldCArPSB3b3JkLmxlbmd0aDtcbiAgICAgICB9Ki9cbiAgICB9LFxuICAgIGN1cnZlVGV4dE9mZnNldDogLTMsXG4gICAgLy90b2RvXG5cblxuICAgIC8qKlxuICAgICAqIFJldHVybnMgaW5kZXggb2YgYSBjaGFyYWN0ZXIgY29ycmVzcG9uZGluZyB0byB3aGVyZSBhbiBvYmplY3Qgd2FzIGNsaWNrZWRcbiAgICAgKiBAcGFyYW0ge0V2ZW50fSBlIEV2ZW50IG9iamVjdFxuICAgICAqIEByZXR1cm4ge051bWJlcn0gSW5kZXggb2YgYSBjaGFyYWN0ZXJcbiAgICAgKi9cbiAgICBnZXRTZWxlY3Rpb25TdGFydEZyb21Qb2ludGVyOiBmdW5jdGlvbihlKSB7XG4gICAgICB2YXIgbW91c2VPZmZzZXQgPSB0aGlzLmdldExvY2FsUG9pbnRlcihlKSxcbiAgICAgICAgcHJldldpZHRoID0gMCxcbiAgICAgICAgd2lkdGggPSAwLFxuICAgICAgICBoZWlnaHQgPSAwLFxuICAgICAgICBjaGFySW5kZXggPSAwLFxuICAgICAgICBuZXdTZWxlY3Rpb25TdGFydCxcbiAgICAgICAgbGluZTtcblxuICAgICAgbW91c2VPZmZzZXQueCAvPSB0aGlzLnNjYWxlWDtcbiAgICAgIG1vdXNlT2Zmc2V0LnkgLz0gdGhpcy5zY2FsZVk7XG5cbiAgICAgIC8vdG9kb1xuXG4gICAgICB2YXIgcCA9IHRoaXMucG9pbnRzWzBdLmN1cnZlLnByb2plY3QobW91c2VPZmZzZXQpO1xuXG4gICAgICBmb3IodmFyIGkgaW4gdGhpcy5fY2hhclBvaW50cyl7XG4gICAgICAgIGlmKHRoaXMuX2NoYXJQb2ludHNbaV0gPiBwLnQpe1xuICAgICAgICAgIHJldHVybiBpIC0gMTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXMudGV4dC5sZW5ndGg7XG4gICAgfSxcbiAgICBpc0VtcHR5U3R5bGVzOiBmdW5jdGlvbigpe1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0sXG4gICAgX3JlbmRlckNoYXI6IGZ1bmN0aW9uKG1ldGhvZCwgY3R4LCBsaW5lSW5kZXgsIGksIF9jaGFyLCBsZWZ0LCB0b3AsIGxpbmVIZWlnaHQpIHtcbiAgICAgIHZhciBjaGFyV2lkdGgsIGNoYXJIZWlnaHQsIHNob3VsZEZpbGwsIHNob3VsZFN0cm9rZSxcbiAgICAgICAgZGVjbCA9IHRoaXMuZ2V0Q3VycmVudENoYXJTdHlsZShsaW5lSW5kZXgsIGkgKyAxKSxcbiAgICAgICAgb2Zmc2V0LCB0ZXh0RGVjb3JhdGlvbjtcblxuICAgICAgaWYgKGRlY2wpIHtcbiAgICAgICAgY2hhckhlaWdodCA9IHRoaXMuX2dldEhlaWdodE9mQ2hhcihjdHgsIF9jaGFyLCBsaW5lSW5kZXgsIGkpO1xuICAgICAgICBzaG91bGRTdHJva2UgPSBkZWNsLnN0cm9rZTtcbiAgICAgICAgc2hvdWxkRmlsbCA9IGRlY2wuZmlsbDtcbiAgICAgICAgdGV4dERlY29yYXRpb24gPSBkZWNsLnRleHREZWNvcmF0aW9uO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIGNoYXJIZWlnaHQgPSB0aGlzLmZvbnRTaXplO1xuICAgICAgfVxuXG4gICAgICBzaG91bGRTdHJva2UgPSAoc2hvdWxkU3Ryb2tlIHx8IHRoaXMuc3Ryb2tlKSAmJiBtZXRob2QgPT09ICdzdHJva2VUZXh0JztcbiAgICAgIHNob3VsZEZpbGwgPSAoc2hvdWxkRmlsbCB8fCB0aGlzLmZpbGwpICYmIG1ldGhvZCA9PT0gJ2ZpbGxUZXh0JztcblxuICAgICAgY2hhcldpZHRoID0gdGhpcy5fYXBwbHlDaGFyU3R5bGVzR2V0V2lkdGgoY3R4LCBfY2hhciwgbGluZUluZGV4LCBpKTtcbiAgICAgIHRleHREZWNvcmF0aW9uID0gdGV4dERlY29yYXRpb24gfHwgdGhpcy50ZXh0RGVjb3JhdGlvbjtcblxuICAgICAgdmFyIGxlZnQgPSAwLCB0b3AgPSAwO1xuICAgICAgdmFyIHQyLCBwdDIgLG52MiAsIGFuZ2xlMjtcblxuICAgICAgLy90b2RvIHRoaXMucG9pbnRzWzBdLmN1cnZlINGN0YLQviDQvdC10LrQvtGA0YDQtdC60YLQvdC+IVxuICAgICAgdmFyIF9jdXJ2ZSA9IHRoaXMucG9pbnRzWzBdLmN1cnZlO1xuXG4gICAgICBmb3IodmFyIGluZGV4ID0gMDsgaW5kZXggPCBfY2hhci5sZW5ndGg7IGluZGV4Kyspe1xuICAgICAgICB2YXIgY2hhckluZGV4ID0gaW5kZXggKyBpIC0gX2NoYXIubGVuZ3RoICsgMTtcblxuICAgICAgICB0MiA9IHRoaXMuX2NoYXJQb2ludHNbY2hhckluZGV4XTtcbiAgICAgICAgLy9kbyBub3QgcmVuZGVyIGNoYXJzIHRoYXQgbm90IGZpdCBpbnRvIHRoZSB0ZXh0IGFyZWFcbiAgICAgICAgaWYodDIgPiAxKXtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBwdDIgPSBfY3VydmUuZ2V0KHQyKTtcbiAgICAgICAgbnYyID0gX2N1cnZlLm5vcm1hbCh0Mik7XG4gICAgICAgIGFuZ2xlMiA9IC1NYXRoLmF0YW4yKG52Mi54LG52Mi55KSA7XG5cbiAgICAgICAgY3R4LnNhdmUoKTtcbiAgICAgICAgY3R4LnRyYW5zbGF0ZShwdDIueCArIHRoaXMuY3VydmVUZXh0T2Zmc2V0Km52Mi54LCBwdDIueSArICB0aGlzLmN1cnZlVGV4dE9mZnNldCpudjIueSk7XG4gICAgICAgIGN0eC5yb3RhdGUoYW5nbGUyKTtcbiAgICAgICAgc2hvdWxkRmlsbCAmJiBjdHguZmlsbFRleHQoX2NoYXJbaW5kZXhdLCAwLCAwKTtcbiAgICAgICAgc2hvdWxkU3Ryb2tlICYmIGN0eC5zdHJva2VUZXh0KF9jaGFyW2luZGV4XSwgMCwgMCk7XG4gICAgICAgIGN0eC5yZXN0b3JlKCk7XG4gICAgICB9XG5cbiAgICAgIGlmICh0ZXh0RGVjb3JhdGlvbiB8fCB0ZXh0RGVjb3JhdGlvbiAhPT0gJycpIHtcbiAgICAgICAgb2Zmc2V0ID0gdGhpcy5fZm9udFNpemVGcmFjdGlvbiAqIGxpbmVIZWlnaHQgLyB0aGlzLmxpbmVIZWlnaHQ7XG4gICAgICAgIHRoaXMuX3JlbmRlckNoYXJEZWNvcmF0aW9uKGN0eCwgdGV4dERlY29yYXRpb24sIGxlZnQsIHRvcCwgb2Zmc2V0LCBjaGFyV2lkdGgsIGNoYXJIZWlnaHQpO1xuICAgICAgfVxuXG4gICAgfSxcbiAgICBfcmVuZGVyQ2hhckRlY29yYXRpb246IGZ1bmN0aW9uIChjdHgpe1xuXG4gICAgfSxcbiAgICBfcmVuZGVyVGV4dEJveEJhY2tncm91bmQ6IGZ1bmN0aW9uIChjdHgpe1xuICAgICAgY3R4LnRyYW5zbGF0ZSgtdGhpcy53aWR0aC8yICwtdGhpcy5oZWlnaHQvMik7XG4gICAgICBpZiAoIXRoaXMuYmFja2dyb3VuZENvbG9yICYmICF0aGlzLmJhY2tncm91bmRTdHJva2Upe1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5iYWNrZ3JvdW5kQ29sb3IpIHtcbiAgICAgICAgdGhpcy5fX2ZpbGwgPSB0aGlzLmZpbGw7XG4gICAgICAgIHRoaXMuZmlsbCA9IHRoaXMuYmFja2dyb3VuZENvbG9yO1xuICAgICAgICB0aGlzLl9zZXRGaWxsU3R5bGVzKGN0eCk7XG4gICAgICAgIHRoaXMuZmlsbCA9IHRoaXMuX19maWxsO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMuYmFja2dyb3VuZFN0cm9rZSkge1xuICAgICAgICB0aGlzLl9fc3Ryb2tlID0gdGhpcy5zdHJva2U7XG4gICAgICAgIHRoaXMuc3Ryb2tlID0gdGhpcy5iYWNrZ3JvdW5kU3Ryb2tlO1xuICAgICAgICB0aGlzLl9zZXRTdHJva2VTdHlsZXMoY3R4KTtcbiAgICAgIH1cbiAgICAgIGZhYnJpYy5Qb2x5bGluZS5wcm90b3R5cGUuX3JlbmRlci5jYWxsKHRoaXMsY3R4KTtcblxuICAgICAgaWYgKHRoaXMuYmFja2dyb3VuZFN0cm9rZSkge1xuICAgICAgICB0aGlzLnN0cm9rZSA9IHRoaXMuX19zdHJva2U7XG4gICAgICB9XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtDYW52YXNSZW5kZXJpbmdDb250ZXh0MkR9IGN0eCBDb250ZXh0IHRvIHJlbmRlciBvblxuICAgICAqL1xuICAgIF9yZW5kZXJUZXh0OiBmdW5jdGlvbihjdHgpIHtcbiAgICAgIC8vdGhpcy5fdHJhbnNsYXRlRm9yVGV4dEFsaWduKGN0eCk7XG4gICAgICB0aGlzLl9yZW5kZXJUZXh0RmlsbChjdHgpO1xuICAgICAgdGhpcy5fcmVuZGVyVGV4dFN0cm9rZShjdHgpO1xuICAgICAgLy90aGlzLl90cmFuc2xhdGVGb3JUZXh0QWxpZ24oY3R4LCB0cnVlKTtcbiAgICB9LFxuICAgIF9nZXRQb2ludDogZnVuY3Rpb24odCl7XG4gICAgICB2YXIgX25vcm1hbCA9IHRoaXMucG9pbnRzWzBdLmN1cnZlLm5vcm1hbCh0KTtcbiAgICAgIHZhciBpbmZvID0ge1xuICAgICAgICBwb2ludDogIHRoaXMucG9pbnRzWzBdLmN1cnZlLmdldCh0KSxcbiAgICAgICAgbm9ybWFsOiAgX25vcm1hbCxcbiAgICAgICAgYW5nbGU6IC1NYXRoLmF0YW4yKF9ub3JtYWwueCxfbm9ybWFsLnkpXG4gICAgICB9O1xuICAgICAgcmV0dXJuIGluZm87XG4gICAgfSxcbiAgICAvKipcbiAgICAgKiBSZW5kZXJzIGN1cnNvclxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSBib3VuZGFyaWVzXG4gICAgICogQHBhcmFtIHtDYW52YXNSZW5kZXJpbmdDb250ZXh0MkR9IGN0eCB0cmFuc2Zvcm1lZCBjb250ZXh0IHRvIGRyYXcgb25cbiAgICAgKi9cbiAgICByZW5kZXJDdXJzb3I6IGZ1bmN0aW9uKGJvdW5kYXJpZXMsIGN0eCkge1xuXG4gICAgICB2YXIgY3Vyc29yTG9jYXRpb24gPSB0aGlzLmdldDJEQ3Vyc29yTG9jYXRpb24oKSxcbiAgICAgICAgbGluZUluZGV4ID0gY3Vyc29yTG9jYXRpb24ubGluZUluZGV4LFxuICAgICAgICBjaGFySW5kZXggPSBjdXJzb3JMb2NhdGlvbi5jaGFySW5kZXgsXG4gICAgICAgIGNoYXJIZWlnaHQgPSB0aGlzLmdldEN1cnJlbnRDaGFyRm9udFNpemUobGluZUluZGV4LCBjaGFySW5kZXgpO1xuICAgICAgLy9sZWZ0T2Zmc2V0ID0gKGxpbmVJbmRleCA9PT0gMCAmJiBjaGFySW5kZXggPT09IDApXG4gICAgICAvLyAgPyB0aGlzLl9nZXRMaW5lTGVmdE9mZnNldCh0aGlzLl9nZXRMaW5lV2lkdGgoY3R4LCBsaW5lSW5kZXgpKVxuICAgICAgLy8gIDogYm91bmRhcmllcy5sZWZ0T2Zmc2V0O1xuXG5cbiAgICAgIHZhciB0ICwgcHQsbnYgLCBhbmdsZTtcbiAgICAgIHQgPSB0aGlzLl9jaGFyUG9pbnRzW2NoYXJJbmRleF07XG4gICAgICB2YXIgaW5mbyA9IHRoaXMuX2dldFBvaW50KHQpO1xuICAgICAgY3R4LnNhdmUoKTtcbiAgICAgIGN0eC50cmFuc2xhdGUoLSB0aGlzLndpZHRoLzIsIC0gdGhpcy5oZWlnaHQvMik7XG4gICAgICBjdHgudHJhbnNsYXRlKGluZm8ucG9pbnQueCArIHRoaXMuY3VydmVUZXh0T2Zmc2V0KmluZm8ubm9ybWFsLnggLGluZm8ucG9pbnQueSArICB0aGlzLmN1cnZlVGV4dE9mZnNldCppbmZvLm5vcm1hbC55KTtcbiAgICAgIGN0eC5yb3RhdGUoaW5mby5hbmdsZSk7XG5cbiAgICAgIGN0eC5maWxsU3R5bGUgPSB0aGlzLmdldEN1cnJlbnRDaGFyQ29sb3IobGluZUluZGV4LCBjaGFySW5kZXgpO1xuICAgICAgY3R4Lmdsb2JhbEFscGhhID0gdGhpcy5fX2lzTW91c2Vkb3duID8gMSA6IHRoaXMuX2N1cnJlbnRDdXJzb3JPcGFjaXR5O1xuXG4gICAgICBjdHguZmlsbFJlY3QoMCwgMCxcbiAgICAgICAgdGhpcy5jdXJzb3JXaWR0aCAvIHRoaXMuc2NhbGVYLFxuICAgICAgICAtY2hhckhlaWdodCk7XG5cbiAgICAgIGN0eC5yZXN0b3JlKCk7XG5cbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogUmVuZGVyIFNoYXBlIE9iamVjdFxuICAgICAqIEBwcml2YXRlXG4gICAgICogQHBhcmFtIHtDYW52YXNSZW5kZXJpbmdjdHgyRH0gY3R4IGN0eCB0byByZW5kZXIgb25cbiAgICAgKi9cbiAgICBfcmVuZGVyOiBmdW5jdGlvbiAoY3R4LCBub1RyYW5zZm9ybSl7XG4gICAgICB2YXIgeCA9IG5vVHJhbnNmb3JtID8gdGhpcy5sZWZ0IDogLXRoaXMud2lkdGggLyAyICxcbiAgICAgICAgeSA9IG5vVHJhbnNmb3JtID8gdGhpcy50b3AgOiAtdGhpcy5oZWlnaHQgLyAyO1xuXG4gICAgICBjdHguc2F2ZSgpO1xuXG4gICAgICB0aGlzLmNsaXBUbyAmJiBmYWJyaWMudXRpbC5jbGlwQ29udGV4dCh0aGlzLCBjdHgpO1xuICAgICAgY3R4LnRyYW5zbGF0ZSgteCwteSk7XG4gICAgICB0aGlzLl9zZXRPcGFjaXR5KGN0eCk7XG4gICAgICB0aGlzLl9zZXRTaGFkb3coY3R4KTtcbiAgICAgIHRoaXMuX3NldHVwQ29tcG9zaXRlT3BlcmF0aW9uKGN0eCk7XG4gICAgICB0aGlzLl9yZW5kZXJUZXh0QmFja2dyb3VuZChjdHgpO1xuICAgICAgdGhpcy5fc2V0U3Ryb2tlU3R5bGVzKGN0eCk7XG4gICAgICB0aGlzLl9zZXRGaWxsU3R5bGVzKGN0eCk7XG5cbiAgICAgIHRoaXMuX2NoYXJQb2ludHMgPSBbMF07XG4gICAgICB0aGlzLl9jaGFyV2lkdGggPSBbXTtcblxuICAgICAgdmFyIGN1cnZlV2lkdGggPSB0aGlzLmdldExlbmd0aCgpO1xuICAgICAgdmFyIGxpbmVJbmRleCA9IDAsIGNoYXJJbmRleCA9IDAsIF9jaGFyV2lkdGgsIHRleHRXaWR0aCA9IDA7XG4gICAgICBpZiAodGhpcy50ZXh0QWxpZ24gPT0gJ2p1c3RpZnknKSB7XG4gICAgICAgIHZhciBfbCA9IGN1cnZlV2lkdGggLyB0aGlzLnRleHQubGVuZ3RoO1xuICAgICAgICBmb3IgKDsgY2hhckluZGV4IDwgdGhpcy50ZXh0Lmxlbmd0aDsgY2hhckluZGV4KyspIHtcbiAgICAgICAgICB0aGlzLl9jaGFyV2lkdGgucHVzaChfbCk7XG4gICAgICAgIH1cbiAgICAgIH1lbHNle1xuICAgICAgICBmb3IgKDsgY2hhckluZGV4IDwgdGhpcy50ZXh0Lmxlbmd0aDsgY2hhckluZGV4KyspIHtcbiAgICAgICAgICBfY2hhcldpZHRoID0gdGhpcy5fZ2V0V2lkdGhPZkNoYXIoY3R4LCB0aGlzLnRleHRbY2hhckluZGV4XSwgbGluZUluZGV4LCBjaGFySW5kZXgpO1xuICAgICAgICAgIHRoaXMuX2NoYXJXaWR0aC5wdXNoKF9jaGFyV2lkdGgpO1xuICAgICAgICAgIHRleHRXaWR0aCArPSBfY2hhcldpZHRoO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHRoaXMuX2NoYXJQb2ludHMgPSBbXTtcbiAgICAgIHZhciBsYXN0X3QgID0gMDtcbiAgICAgIGZvcihjaGFySW5kZXggPSAwOyBjaGFySW5kZXggPCB0aGlzLnRleHQubGVuZ3RoOyBjaGFySW5kZXgrKyl7XG4gICAgICAgIC8vdG9kbyB0aGlzLnBvaW50c1swXSDRjdGC0L4g0YLQvtC70YzQutC+INC00LvRjyDQutGA0LjQstGL0YUg0LjQtyDQtNCy0YPRhSDRgtC+0YfQtdC6XG4gICAgICAgIHZhciBfbmV3X3QgPSAgdGhpcy5wb2ludHNbMF0uY3VydmUuZ2V0VGJ5TGVuZ3RoKHRoaXMuX2NoYXJXaWR0aFtjaGFySW5kZXhdLDAuMDAwMSxsYXN0X3QpO1xuICAgICAgICB0aGlzLl9jaGFyUG9pbnRzLnB1c2goKF9uZXdfdCArIGxhc3RfdCkgLyAyKTtcbiAgICAgICAgbGFzdF90ID0gX25ld190O1xuICAgICAgfVxuXG4gICAgICB2YXIgdF9vZmZzZXQ7XG4gICAgICBsYXN0X3QgID0gTWF0aC5taW4oMSxsYXN0X3QpO1xuICAgICAgaWYgKHRoaXMudGV4dEFsaWduID09ICdyaWdodCcpIHtcbiAgICAgICAgdF9vZmZzZXQgPSAxIC0gbGFzdF90O1xuICAgICAgfWVsc2UgaWYgKHRoaXMudGV4dEFsaWduID09ICdjZW50ZXInKSB7XG4gICAgICAgIHRfb2Zmc2V0ID0gKDEgLSBsYXN0X3QpLyAyO1xuICAgICAgfVxuICAgICAgaWYodF9vZmZzZXQpe1xuICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgdGhpcy5fY2hhclBvaW50cy5sZW5ndGg7IGkrKyl7XG4gICAgICAgICAgdGhpcy5fY2hhclBvaW50c1tpXSArPSB0X29mZnNldDtcbiAgICAgICAgfVxuICAgICAgfVxuXG5cbiAgICAgIGN0eC50cmFuc2xhdGUoeCx5KTtcblxuICAgICAgY3R4LnRleHRBbGlnbiA9IFwiY2VudGVyXCI7XG4gICAgICB0aGlzLl9yZW5kZXJUZXh0KGN0eCk7XG4gICAgICB0aGlzLl9yZW5kZXJUZXh0RGVjb3JhdGlvbihjdHgpO1xuICAgICAgdGhpcy5jbGlwVG8gJiYgY3R4LnJlc3RvcmUoKTtcbiAgICAgIHRoaXMucmVuZGVyQ3Vyc29yT3JTZWxlY3Rpb24oKTtcblxuXG4gICAgICBjdHgucmVzdG9yZSgpO1xuXG4gICAgfSxcbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIG9iamVjdCByZXByZXNlbnRhdGlvbiBvZiBhbiBpbnN0YW5jZVxuICAgICAqIEBwYXJhbSB7QXJyYXl9IFtwcm9wZXJ0aWVzVG9JbmNsdWRlXSBBbnkgcHJvcGVydGllcyB0aGF0IHlvdSBtaWdodCB3YW50IHRvIGFkZGl0aW9uYWxseSBpbmNsdWRlIGluIHRoZSBvdXRwdXRcbiAgICAgKiBAcmV0dXJuIHtPYmplY3R9IG9iamVjdCByZXByZXNlbnRhdGlvbiBvZiBhbiBpbnN0YW5jZVxuICAgIC8vICAqL1xuICAgIC8vIHRvT2JqZWN0OiBmdW5jdGlvbiAocHJvcGVydGllc1RvSW5jbHVkZSkge1xuICAgIC8vXG4gICAgLy8gICB2YXIgX3BvaW50cyA9IFtdO1xuICAgIC8vICAgZm9yKHZhciBpIGluIHRoaXMucG9pbnRzKXtcbiAgICAvLyAgICAgX3BvaW50cy5wdXNoKHRoaXMucG9pbnRzW2ldLngsdGhpcy5wb2ludHNbaV0ueSk7XG4gICAgLy8gICB9XG4gICAgLy8gICB2YXIgb2JqZWN0ID0gZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCh0aGlzLmNhbGxTdXBlcigndG9PYmplY3QnLCBwcm9wZXJ0aWVzVG9JbmNsdWRlKSwge1xuICAgIC8vICAgICBwb2ludHM6IF9wb2ludHMsXG4gICAgLy8gICAgIGJhY2tncm91bmRDb2xvcjogdGhpcy5iYWNrZ3JvdW5kQ29sb3IsXG4gICAgLy8gICAgIGJhY2tncm91bmRTdHJva2U6IHRoaXMuYmFja2dyb3VuZFN0cm9rZSxcbiAgICAvLyAgIH0pO1xuICAgIC8vICAgaWYgKCF0aGlzLmluY2x1ZGVEZWZhdWx0VmFsdWVzKSB7XG4gICAgLy8gICAgIHRoaXMuX3JlbW92ZURlZmF1bHRWYWx1ZXMob2JqZWN0KTtcbiAgICAvLyAgIH1cbiAgICAvLyAgIHJldHVybiBvYmplY3Q7XG4gICAgLy8gfVxuICB9KTtcblxuICBmYWJyaWMuQmV6aWVyVGV4dC5mcm9tT2JqZWN0ID0gZnVuY3Rpb24gKG9iamVjdCkge1xuICAgIHJldHVybiBuZXcgZmFicmljLkJlemllclRleHQob2JqZWN0LnRleHQsb2JqZWN0KTtcbiAgfTtcbiAgZmFicmljLnV0aWwuY3JlYXRlQWNjZXNzb3JzKGZhYnJpYy5CZXppZXJUZXh0KTtcblxuXG5cbiAgaWYoZmFicmljLm9iamVjdHNMaWJyYXJ5KXtcbiAgICBmYWJyaWMub2JqZWN0c0xpYnJhcnkuYmV6aWVyVGV4dEN1cnZlZCA9IHtcbiAgICAgIFwidGl0bGVcIjogXCJiZXppZXJUZXh0Q3VydmVkXCIsXG4gICAgICBcInR5cGVcIjpcImJlemllci10ZXh0XCIsXG4gICAgICBcIndpZHRoXCI6IDIwMCxcbiAgICAgIFwiZGVmYXVsdFNoYXBlXCI6IFwiY3VydmVcIixcbiAgICAgIFwidGV4dFwiOlwiQWRkIHNvbWUgdGV4dCBoZXJlXCJcbiAgICB9O1xuICB9XG5cblxuXG4gIGZhYnJpYy5CZXppZXJUZXh0LnByb3RvdHlwZS5hY3Rpb25zID0gZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCh7fSwgZmFicmljLklUZXh0LnByb3RvdHlwZS5hY3Rpb25zLCB7fSk7XG5cbiAgZmFicmljLlRleHQucHJvdG90eXBlLmN1cnZlVG9vbCA9IGZhbHNlO1xuICBmYWJyaWMuVGV4dC5wcm90b3R5cGUuY3VydmVUZXh0ID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBvYmogPSB0aGlzLnRvT2JqZWN0KCk7XG4gICAgb2JqLnJhc3Rlcml6ZWRUeXBlID0gb2JqLnR5cGU7XG4gICAgb2JqLnR5cGUgPSBcImJlemllci10ZXh0XCI7XG4gICAgb2JqLm1vdmVtZW50TGltaXRzID0gdGhpcy5tb3ZlbWVudExpbWl0cztcbiAgICBvYmouY2xpcFRvID0gdGhpcy5jbGlwVG87XG4gICAgb2JqLmFjdGl2ZSA9IHRydWU7XG5cbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgIF90aGlzLmNhbnZhcy5jcmVhdGVPYmplY3Qob2JqLCBmdW5jdGlvbiAoKSB7XG4gICAgICBfdGhpcy5jYW52YXMucmVtb3ZlKF90aGlzKTtcbiAgICAgIF90aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICB9KTtcbiAgfTtcbiAgZmFicmljLklUZXh0LnByb3RvdHlwZS5hY3Rpb25zLmN1cnZlVGV4dCA9XG4gICAgZmFicmljLlRleHQucHJvdG90eXBlLmFjdGlvbnMuY3VydmVUZXh0ID0ge1xuICAgIGluc2VydDogJ2N1cnZlVG9vbCcsXG4gICAgY2xhc3NOYW1lOiAnYnV0dG9uLWVhc2VsJyxcbiAgICB0aXRsZTogJ2N1cnZlVGV4dCcsXG4gICAgYWN0aW9uOiBmYWJyaWMuVGV4dC5wcm90b3R5cGUuY3VydmVUZXh0XG4gIH07XG5cbi8vfSk7XG5cbi8v0LzQsNGC0LXRgNC40LDQu9GLINC00LvRjyDQstC00L7RhdC90L7QstC10L3QuNGPXG4vL2h0dHA6Ly9qc2ZpZGRsZS5uZXQvYXNoaXNoYmhhdHQvWFI3ajYvMTAvXG4vL2h0dHA6Ly9qc2ZpZGRsZS5uZXQvRWZmRVBpL3FwSlR6L1xuLy9odHRwOi8vdHltcGFudXMubmV0L0RldmVsb3BtZW50L0FyY3RleHQvXG4vL2h0dHA6Ly9qc2ZpZGRsZS5uZXQvRTV2blUvKGZ1bmN0aW9uIChnbG9iYWwpe1xuXG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL29iamVjdHMvQmV6aWVyVGV4dC5qc1xuLy8gbW9kdWxlIGlkID0gODdcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiLyoqXG4gKiBCdWJibGUgT2JqZWN0IGxpYnJhcnkgZm9yIEZhYnJpY0pTXG4gKlxuICpcbiAqXG4gKiBAZXhhbXBsZVxuIG5uZXcgZmFicmljLkJ1YmJsZSh7XG4gICAgICAgICBsZWZ0OiAxMDAsXG4gICAgICAgICB0b3A6IDEwMCxcbiAgICAgICAgIHdpZHRoOiA4MDAsXG4gICAgICAgICBoZWlnaHQ6IDYwMFxuICAgICB9KVxuICpcbiAqIEBhdXRob3IgRGVuaXMgUG9ub21hcmV2XG4gKiBAZW1haWwgZGVuLnBvbm9tYXJldkBnbWFpbC5jb21cbiAqL1xuJ3VzZSBzdHJpY3QnO1xuXG4vL2ZhYnJpYy5yZXF1aXJlKFwiQnViYmxlXCIsW1wiU2hhcGVNaXhpblwiXSwgZnVuY3Rpb24oKSB7XG4gIGZhYnJpYy5CdWJibGUgPSBmYWJyaWMudXRpbC5jcmVhdGVDbGFzcyhmYWJyaWMuUmVjdCwge1xuICAgIHR5cGU6ICdidWJibGUnLFxuXG5cbiAgICBzdGF0ZVByb3BlcnRpZXM6IGZhYnJpYy5Hcm91cC5wcm90b3R5cGUuc3RhdGVQcm9wZXJ0aWVzLmNvbmNhdChbXCJzcGVlY2hYXCIsIFwic3BlZWNoWVwiLCBcImJ1YmJsZU9mZnNldFhcIiwgXCJidWJibGVPZmZzZXRZXCIsIFwiYnViYmxlU2l6ZVwiXSksXG5cbiAgICAvKipcbiAgICAgKiBzcGVlY2hQb2ludFxuICAgICAqIEB0eXBlIE51bWJlclxuICAgICAqIEBkZWZhdWx0XG4gICAgICovXG4gICAgc3BlZWNoWDogMCxcblxuICAgIC8qKlxuICAgICAqIHNwZWVjaFBvaW50XG4gICAgICogQHR5cGUgTnVtYmVyXG4gICAgICogQGRlZmF1bHRcbiAgICAgKi9cbiAgICBzcGVlY2hZOiAwLFxuXG4gICAgLyoqXG4gICAgICogZGlzdGFuY2UgYmV0d2VlbiBjb3JuZXIgYW5kIGJ1YmJsZVxuICAgICAqIEB0eXBlIE51bWJlclxuICAgICAqIEBkZWZhdWx0XG4gICAgICovXG4gICAgYnViYmxlT2Zmc2V0WDogMCxcbiAgICAvKipcbiAgICAgKiBkaXN0YW5jZSBiZXR3ZWVuIGNvcm5lciBhbmQgYnViYmxlXG4gICAgICogQHR5cGUgTnVtYmVyXG4gICAgICogQGRlZmF1bHRcbiAgICAgKi9cbiAgICBidWJibGVTaXplOiAzMCxcblxuXG4gICAgd2lkdGg6IDE1MCxcblxuICAgIGhlaWdodDogMTAwLFxuXG5cbiAgICB0ZXh0OiB7XG4gICAgICBmb250U2l6ZTogMjAsXG4gICAgICBmb250RmFtaWx5OiAnQ29taWMgU2FucydcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogZGlzdGFuY2UgYmV0d2VlbiBjb3JuZXIgYW5kIGJ1YmJsZVxuICAgICAqIEB0eXBlIE51bWJlclxuICAgICAqIEBkZWZhdWx0XG4gICAgICovXG4gICAgYnViYmxlT2Zmc2V0WTogMCxcblxuICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICBvcHRpb25zIHx8ICggb3B0aW9ucyA9IHt9KTtcblxuICAgICAgdGhpcy5jYWxsU3VwZXIoJ2luaXRpYWxpemUnLCBvcHRpb25zKTtcblxuICAgICAgdGhpcy5zZXQoXCJidWJibGVPZmZzZXRYXCIsIG9wdGlvbnMuYnViYmxlT2Zmc2V0WCB8fCAwKTtcbiAgICAgIHRoaXMuc2V0KFwiYnViYmxlT2Zmc2V0WVwiLCBvcHRpb25zLmJ1YmJsZU9mZnNldFkgfHwgMCk7XG4gICAgICBpZiAob3B0aW9ucy5idWJibGVTaXplKSB7XG4gICAgICAgIHRoaXMuc2V0KFwiYnViYmxlU2l6ZVwiLCBvcHRpb25zLmJ1YmJsZVNpemUpO1xuICAgICAgfVxuICAgICAgdGhpcy5faW5pdFJ4UnkoKTtcblxuICAgICAgdGhpcy5zZXRQb2ludCgwLCB7XG4gICAgICAgIHg6IG9wdGlvbnMuc3BlZWNoWCB8fCAtMjUsXG4gICAgICAgIHk6IG9wdGlvbnMuc3BlZWNoWSB8fCAyNVxuICAgICAgfSk7XG5cblxuICAgICAgdGhpcy5faW5pdFBvaW50cyhvcHRpb25zLnBvaW50cyk7XG4gICAgfSxcblxuICAgIHNldFBvaW50OiBmdW5jdGlvbiAob3JkZXIsIF9wb2ludCkge1xuXG4gICAgICBpZiAoIXRoaXMuX3BvaW50cyl0aGlzLl9wb2ludHMgPSBbXTtcbiAgICAgIGlmICghdGhpcy5fcG9pbnRzW29yZGVyXSkge1xuICAgICAgICB0aGlzLl9wb2ludHNbb3JkZXJdID0gX3BvaW50O1xuICAgICAgfVxuXG5cbiAgICAgIC8vICAgMSB8IDJcbiAgICAgIC8vIDggICB8ICAgM1xuICAgICAgLy8tLS0tLS0tLS0tXG4gICAgICAvLyA3ICAgfCAgIDRcbiAgICAgIC8vICAgNiB8IDVcblxuXG4gICAgICB2YXIgdyA9IDEgLyAyLCBoID0gMSAvIDIsIHggPSBfcG9pbnQueCAvIHRoaXMud2lkdGgsIHkgPSBfcG9pbnQueSAvIHRoaXMuaGVpZ2h0O1xuXG4gICAgICBpZiAoeCA8IHcpIHtcbiAgICAgICAgaWYgKHkgPCBoKSB7XG4gICAgICAgICAgdGhpcy5fYnViYmxlX3BhcnQgPSB4IDwgeSA/IDggOiAxO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMuX2J1YmJsZV9wYXJ0ID0gdyAtIHggPCB5IC0gaCA/IDYgOiA3O1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoeSA8IGgpIHtcbiAgICAgICAgICB0aGlzLl9idWJibGVfcGFydCA9IHcgKyB3IC0geCA+IHkgPyAyIDogMztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLl9idWJibGVfcGFydCA9IHcgLSB4IDwgaCAtIHkgPyA0IDogNTtcbiAgICAgICAgfVxuICAgICAgfVxuXG5cbiAgICAgIGlmIChfcG9pbnQueCA+IDAgJiYgX3BvaW50LnggPCB0aGlzLndpZHRoKSB7XG4gICAgICAgIGlmIChfcG9pbnQueSA+IDAgJiYgX3BvaW50LnkgPD0gdGhpcy5oZWlnaHQgLyAyKSB7XG4gICAgICAgICAgaWYgKHRoaXMuX2J1YmJsZV9wYXJ0ID09IDEgfHwgdGhpcy5fYnViYmxlX3BhcnQgPT0gMikge1xuICAgICAgICAgICAgX3BvaW50LnkgPSAwO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAodGhpcy5fYnViYmxlX3BhcnQgPT0gOCkge1xuICAgICAgICAgICAgX3BvaW50LnggPSAwO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAodGhpcy5fYnViYmxlX3BhcnQgPT0gMykge1xuICAgICAgICAgICAgX3BvaW50LnggPSB0aGlzLndpZHRoO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoX3BvaW50LnkgPCB0aGlzLmhlaWdodCAmJiBfcG9pbnQueSA+PSB0aGlzLmhlaWdodCAvIDIpIHtcbiAgICAgICAgICBpZiAodGhpcy5fYnViYmxlX3BhcnQgPT0gNSB8fCB0aGlzLl9idWJibGVfcGFydCA9PSA2KSB7XG4gICAgICAgICAgICBfcG9pbnQueSA9IHRoaXMuaGVpZ2h0O1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAodGhpcy5fYnViYmxlX3BhcnQgPT0gNykge1xuICAgICAgICAgICAgX3BvaW50LnggPSAwO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAodGhpcy5fYnViYmxlX3BhcnQgPT0gNCkge1xuICAgICAgICAgICAgX3BvaW50LnggPSB0aGlzLndpZHRoO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdGhpcy5zcGVlY2hYID0gdGhpcy5fcG9pbnRzW29yZGVyXS54ID0gX3BvaW50Lng7XG4gICAgICB0aGlzLnNwZWVjaFkgPSB0aGlzLl9wb2ludHNbb3JkZXJdLnkgPSBfcG9pbnQueTtcbiAgICAgIHRoaXMuY2FudmFzICYmIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgIH0sXG4gICAgLyoqXG4gICAgICogSW5pdGlhbGl6ZXMgcngvcnkgYXR0cmlidXRlc1xuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX2luaXRSeFJ5OiBmYWJyaWMuUmVjdC5wcm90b3R5cGUuX2luaXRSeFJ5LFxuICAgIGRyYXdDb250cm9sczogZnVuY3Rpb24gKGN0eCkge1xuICAgICAgaWYgKCF0aGlzLmhhc0NvbnRyb2xzKSB7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgfVxuICAgICAgZmFicmljLk9iamVjdC5wcm90b3R5cGUuZHJhd0NvbnRyb2xzLmNhbGwodGhpcywgY3R4KTtcblxuICAgICAgdGhpcy5kcmF3U2hhcGVDb250cm9scyhjdHgpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBwYXJhbSB7Q2FudmFzUmVuZGVyaW5nQ29udGV4dDJEfSBjdHggQ29udGV4dCB0byByZW5kZXIgb25cbiAgICAgKi9cbiAgICBfcmVuZGVyOiBmdW5jdGlvbiAoY3R4LCBub1RyYW5zZm9ybSkge1xuICAgICAgLy8gICAgdGhpcy5jYWxsU3VwZXIoJ19yZW5kZXInLCBjdHgsIG5vVHJhbnNmb3JtKTtcblxuICAgICAgLy8gb3B0aW1pemUgMXgxIGNhc2UgKHVzZWQgaW4gc3ByYXkgYnJ1c2gpXG4gICAgICBpZiAodGhpcy53aWR0aCA9PT0gMSAmJiB0aGlzLmhlaWdodCA9PT0gMSkge1xuICAgICAgICBjdHguZmlsbFJlY3QoMCwgMCwgMSwgMSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgdmFyIHJ4ID0gdGhpcy5yeCA/IE1hdGgubWluKHRoaXMucngsIHRoaXMud2lkdGggLyAyKSA6IDAsXG4gICAgICAgIHJ5ID0gdGhpcy5yeSA/IE1hdGgubWluKHRoaXMucnksIHRoaXMuaGVpZ2h0IC8gMikgOiAwLFxuICAgICAgICB3ID0gdGhpcy53aWR0aCxcbiAgICAgICAgaCA9IHRoaXMuaGVpZ2h0LFxuICAgICAgICB4ID0gbm9UcmFuc2Zvcm0gPyB0aGlzLmxlZnQgOiAtdGhpcy53aWR0aCAvIDIsXG4gICAgICAgIHkgPSBub1RyYW5zZm9ybSA/IHRoaXMudG9wIDogLXRoaXMuaGVpZ2h0IC8gMixcbiAgICAgICAgaXNSb3VuZGVkID0gcnggIT09IDAgfHwgcnkgIT09IDAsXG4gICAgICAgIGsgPSAxIC0gMC41NTIyODQ3NDk4IC8qIFwibWFnaWMgbnVtYmVyXCIgZm9yIGJlemllciBhcHByb3hpbWF0aW9ucyBvZiBhcmNzIChodHRwOi8vaXRjLmt0dS5sdC9pdGMzNTQvUmlza3VzMzU0LnBkZikgKi87XG5cbiAgICAgIGN0eC5iZWdpblBhdGgoKTtcblxuICAgICAgY3R4Lm1vdmVUbyh4ICsgcngsIHkpO1xuXG5cbiAgICAgIHZhciBfb2ZYID0gTWF0aC5tYXgocngsIHJ4ICsgdGhpcy5idWJibGVPZmZzZXRYIHx8IHcgLyA2KTtcbiAgICAgIHZhciBfb2ZZID0gTWF0aC5tYXgocnksIHJ5ICsgdGhpcy5idWJibGVPZmZzZXRZIHx8IGggLyA2KTtcblxuICAgICAgdmFyIG1heGJ1YmJsZVNpemUgPSB3IC0gX29mWCAqIDI7XG4gICAgICB2YXIgbWF4QnViYmxlSGVpZ2h0ID0gaCAtIF9vZlkgKiAyO1xuXG4gICAgICBpZiAodGhpcy5fYnViYmxlX3BhcnQgPT0gMSkge1xuICAgICAgICBjdHgubGluZVRvKHggKyBfb2ZYLCB5KTtcbiAgICAgICAgY3R4LmxpbmVUbyh4ICsgdGhpcy5zcGVlY2hYLCB5ICsgdGhpcy5zcGVlY2hZKTtcbiAgICAgICAgY3R4LmxpbmVUbyh4ICsgX29mWCArIE1hdGgubWluKHcgLSBfb2ZYICogMiwgdGhpcy5idWJibGVTaXplKSwgeSk7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLl9idWJibGVfcGFydCA9PSAyKSB7XG4gICAgICAgIGN0eC5saW5lVG8oeCAtIF9vZlggKyB3IC0gTWF0aC5taW4obWF4YnViYmxlU2l6ZSwgdGhpcy5idWJibGVTaXplKSwgeSk7XG4gICAgICAgIGN0eC5saW5lVG8oeCArIHRoaXMuc3BlZWNoWCwgeSArIHRoaXMuc3BlZWNoWSk7XG4gICAgICAgIGN0eC5saW5lVG8oeCAtIF9vZlggKyB3LCB5KTtcbiAgICAgIH1cblxuICAgICAgY3R4LmxpbmVUbyh4ICsgdyAtIHJ4LCB5KTtcbiAgICAgIGlzUm91bmRlZCAmJiBjdHguYmV6aWVyQ3VydmVUbyh4ICsgdyAtIGsgKiByeCwgeSwgeCArIHcsIHkgKyBrICogcnksIHggKyB3LCB5ICsgcnkpO1xuXG5cbiAgICAgIGlmICh0aGlzLl9idWJibGVfcGFydCA9PSAzKSB7XG4gICAgICAgIGN0eC5saW5lVG8oeCArIHcsIHkgKyBfb2ZZKTtcbiAgICAgICAgY3R4LmxpbmVUbyh4ICsgdGhpcy5zcGVlY2hYLCB5ICsgdGhpcy5zcGVlY2hZKTtcbiAgICAgICAgY3R4LmxpbmVUbyh4ICsgdywgeSArIF9vZlkgKyBNYXRoLm1pbihtYXhCdWJibGVIZWlnaHQsIHRoaXMuYnViYmxlU2l6ZSkpO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5fYnViYmxlX3BhcnQgPT0gNCkge1xuICAgICAgICBjdHgubGluZVRvKHggKyB3LCB5ICsgaCAtIF9vZlkgLSBNYXRoLm1pbihtYXhCdWJibGVIZWlnaHQsIHRoaXMuYnViYmxlU2l6ZSkpO1xuICAgICAgICBjdHgubGluZVRvKHggKyB0aGlzLnNwZWVjaFgsIHkgKyB0aGlzLnNwZWVjaFkpO1xuICAgICAgICBjdHgubGluZVRvKHggKyB3LCB5ICsgaCAtIF9vZlkpO1xuICAgICAgfVxuXG4gICAgICBjdHgubGluZVRvKHggKyB3LCB5ICsgaCAtIHJ5KTtcbiAgICAgIGlzUm91bmRlZCAmJiBjdHguYmV6aWVyQ3VydmVUbyh4ICsgdywgeSArIGggLSBrICogcnksIHggKyB3IC0gayAqIHJ4LCB5ICsgaCwgeCArIHcgLSByeCwgeSArIGgpO1xuXG5cbiAgICAgIGlmICh0aGlzLl9idWJibGVfcGFydCA9PSA1KSB7XG4gICAgICAgIGN0eC5saW5lVG8oeCArIHcgLSBfb2ZYLCB5ICsgaCk7XG4gICAgICAgIGN0eC5saW5lVG8oeCArIHRoaXMuc3BlZWNoWCwgeSArIHRoaXMuc3BlZWNoWSk7XG4gICAgICAgIGN0eC5saW5lVG8oeCArIHcgLSBfb2ZYIC0gTWF0aC5taW4odyAtIF9vZlggKiAyLCB0aGlzLmJ1YmJsZVNpemUpLCB5ICsgaCk7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLl9idWJibGVfcGFydCA9PSA2KSB7XG4gICAgICAgIGN0eC5saW5lVG8oeCArIF9vZlggKyBNYXRoLm1pbih3IC0gX29mWCAqIDIsIHRoaXMuYnViYmxlU2l6ZSksIHkgKyBoKTtcbiAgICAgICAgY3R4LmxpbmVUbyh4ICsgdGhpcy5zcGVlY2hYLCB5ICsgdGhpcy5zcGVlY2hZKTtcbiAgICAgICAgY3R4LmxpbmVUbyh4ICsgX29mWCwgeSArIGgpO1xuICAgICAgfVxuXG5cbiAgICAgIGN0eC5saW5lVG8oeCArIHJ4LCB5ICsgaCk7XG4gICAgICBpc1JvdW5kZWQgJiYgY3R4LmJlemllckN1cnZlVG8oeCArIGsgKiByeCwgeSArIGgsIHgsIHkgKyBoIC0gayAqIHJ5LCB4LCB5ICsgaCAtIHJ5KTtcblxuICAgICAgaWYgKHRoaXMuX2J1YmJsZV9wYXJ0ID09IDcpIHtcbiAgICAgICAgY3R4LmxpbmVUbyh4LCB5ICsgaCAtIF9vZlkpO1xuICAgICAgICBjdHgubGluZVRvKHggKyB0aGlzLnNwZWVjaFgsIHkgKyB0aGlzLnNwZWVjaFkpO1xuICAgICAgICBjdHgubGluZVRvKHgsIHkgKyBoIC0gX29mWSAtIE1hdGgubWluKG1heEJ1YmJsZUhlaWdodCwgdGhpcy5idWJibGVTaXplKSk7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLl9idWJibGVfcGFydCA9PSA4KSB7XG4gICAgICAgIGN0eC5saW5lVG8oeCwgeSArIF9vZlkgKyBNYXRoLm1pbihtYXhCdWJibGVIZWlnaHQsIHRoaXMuYnViYmxlU2l6ZSkpO1xuICAgICAgICBjdHgubGluZVRvKHggKyB0aGlzLnNwZWVjaFgsIHkgKyB0aGlzLnNwZWVjaFkpO1xuICAgICAgICBjdHgubGluZVRvKHgsIHkgKyBfb2ZZKTtcbiAgICAgIH1cblxuICAgICAgY3R4LmxpbmVUbyh4LCB5ICsgcnkpO1xuICAgICAgaXNSb3VuZGVkICYmIGN0eC5iZXppZXJDdXJ2ZVRvKHgsIHkgKyBrICogcnksIHggKyBrICogcngsIHksIHggKyByeCwgeSk7XG5cblxuICAgICAgLy9jdHgubW92ZVRvKHggKyB0aGlzLnNwZWVjaFggKyAyMCwgeSArIHRoaXMuc3BlZWNoWSk7XG4gICAgICAvL2N0eC5hcmMoeCArIHRoaXMuc3BlZWNoWCAsIHkgKyB0aGlzLnNwZWVjaFksIDIwLCAwLCAyICogTWF0aC5QSSwgZmFsc2UpO1xuXG4gICAgICBjdHguY2xvc2VQYXRoKCk7XG5cbiAgICAgIHRoaXMuX3JlbmRlckZpbGwoY3R4KTtcblxuICAgICAgdGhpcy5fcmVuZGVyU3Ryb2tlKGN0eCk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIFJldHVybnMgb2JqZWN0IHJlcHJlc2VudGF0aW9uIG9mIGFuIGluc3RhbmNlXG4gICAgICogQHBhcmFtIHtBcnJheX0gW3Byb3BlcnRpZXNUb0luY2x1ZGVdIEFueSBwcm9wZXJ0aWVzIHRoYXQgeW91IG1pZ2h0IHdhbnQgdG8gYWRkaXRpb25hbGx5IGluY2x1ZGUgaW4gdGhlIG91dHB1dFxuICAgICAqIEByZXR1cm4ge09iamVjdH0gb2JqZWN0IHJlcHJlc2VudGF0aW9uIG9mIGFuIGluc3RhbmNlXG4gICAgICovXG4gICAgdG9PYmplY3Q6IGZ1bmN0aW9uIChwcm9wZXJ0aWVzVG9JbmNsdWRlKSB7XG4gICAgICB2YXIgb2JqZWN0ID0gZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCh0aGlzLmNhbGxTdXBlcigndG9PYmplY3QnLCBwcm9wZXJ0aWVzVG9JbmNsdWRlKSwge1xuICAgICAgICBzcGVlY2hYOiB0aGlzLmdldCgnc3BlZWNoWCcpIHx8IDAsXG4gICAgICAgIHNwZWVjaFk6IHRoaXMuZ2V0KCdzcGVlY2hZJykgfHwgMCxcbiAgICAgICAgYnViYmxlT2Zmc2V0WDogdGhpcy5nZXQoJ2J1YmJsZU9mZnNldFgnKSB8fCAwLFxuICAgICAgICBidWJibGVPZmZzZXRZOiB0aGlzLmdldCgnYnViYmxlT2Zmc2V0WScpIHx8IDAsXG4gICAgICAgIGJ1YmJsZVNpemU6IHRoaXMuZ2V0KCdidWJibGVTaXplJykgfHwgMzBcbiAgICAgIH0pO1xuICAgICAgaWYgKCF0aGlzLmluY2x1ZGVEZWZhdWx0VmFsdWVzKSB7XG4gICAgICAgIHRoaXMuX3JlbW92ZURlZmF1bHRWYWx1ZXMob2JqZWN0KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBvYmplY3Q7XG4gICAgfVxuICB9KTtcblxuXG4gIGZhYnJpYy5CdWJibGUuZnJvbU9iamVjdCA9IGZ1bmN0aW9uIChvYmplY3QpIHtcbiAgICByZXR1cm4gbmV3IGZhYnJpYy5CdWJibGUob2JqZWN0KTtcbiAgfTtcblxuICBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5CdWJibGUucHJvdG90eXBlLCBmYWJyaWMuU2hhcGVNaXhpbik7XG4gIGZhYnJpYy51dGlsLmNyZWF0ZUFjY2Vzc29ycyhmYWJyaWMuQnViYmxlKTtcblxuLy99KTtcblxuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9vYmplY3RzL0J1YmJsZS5qc1xuLy8gbW9kdWxlIGlkID0gODhcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiJ3VzZSBzdHJpY3QnO1xuXG5yZXF1aXJlKFwiLi4vbWl4aW5zL1N0cm9rZU1peGluXCIpO1xucmVxdWlyZShcIi4uL21peGlucy9DYWNoZU1peGluXCIpO1xuXG4vKipcbiAqIEBhdXRob3IgRGVuaXMgUG9ub21hcmV2XG4gKiBAZW1haWwgZGVuLnBvbm9tYXJldkBnbWFpbC5jb21cbiAqL1xuZmFicmljLkNsaXBhcnQgPSBmYWJyaWMudXRpbC5jcmVhdGVDbGFzcyhmYWJyaWMuR3JvdXAsZmFicmljLlN0cm9rZU1peGluLGZhYnJpYy5DYWNoZU1peGluLCB7XG4gIHR5cGU6ICdjbGlwYXJ0JyxcbiAgY29sb3JzOiBudWxsLFxuICBmb3JtYXQ6ICdzdmcnLFxuICByZXNpemFibGU6IHRydWUsXG4gIHByb2Nlc3Npbmc6IGZhbHNlLFxuICBzdGF0ZVByb3BlcnRpZXM6IGZhYnJpYy5Hcm91cC5wcm90b3R5cGUuc3RhdGVQcm9wZXJ0aWVzLmNvbmNhdChbXCJjb2xvcnNcIl0pLFxuICBpbml0aWFsaXplOiBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgIG9wdGlvbnMgfHwgKCBvcHRpb25zID0ge30pO1xuXG4gICAgaWYgKG9wdGlvbnMuY29uc3RydWN0b3IgIT0gT2JqZWN0KSB7XG5cbiAgICAgIHZhciBfb2JqID0gb3B0aW9ucy50b09iamVjdCgpO1xuICAgICAgaWYgKG9wdGlvbnMuZWxlbWVudCkge1xuICAgICAgICBfb2JqLmVsZW1lbnQgPSBvcHRpb25zLmVsZW1lbnQuY2xvbmVTeW5jKCk7XG4gICAgICAgIF9vYmouZWxlbWVudC5jbGlwVG8gPSBfb2JqLl9mYWJyaWNfc2hhcGU7XG4gICAgICB9XG4gICAgICBfb2JqLnNoYXBlID0gb3B0aW9ucy5zaGFwZTtcbiAgICAgIG9wdGlvbnMgPSBfb2JqO1xuICAgIH1cblxuICAgIHRoaXMub24oe1xuICAgICAgXCJzY2FsaW5nXCI6IHRoaXMudXBkYXRlRWxlbWVudFxuICAgIH0pO1xuXG5cbiAgICB0aGlzLmluaXRTaGFwZShvcHRpb25zKTtcbiAgICB0aGlzLl9mYWJyaWNfc2hhcGUuc2V0KHtcbiAgICAgIG9wYWNpdHk6IDAsXG4gICAgICBvcmlnaW5YIDogJ2NlbnRlcicsXG4gICAgICBvcmlnaW5ZIDogJ2NlbnRlcicsXG4gICAgfSk7XG5cbiAgICB0aGlzLmNhbGxTdXBlcignaW5pdGlhbGl6ZScsIFt0aGlzLl9mYWJyaWNfc2hhcGVdLCBvcHRpb25zKTtcblxuICAgIHRoaXMucmVzb3VyY2UgPSBvcHRpb25zLnJlc291cmNlO1xuXG4gICAgdGhpcy5jb2xvcnMgPSBvcHRpb25zLmNvbG9ycyB8fCB7fTtcbiAgICB0aGlzLnNldEVsZW1lbnQob3B0aW9ucy5lbGVtZW50KTtcblxuICB9LFxuXG4gIHNldFNoYXBlOiBmdW5jdGlvbihlbCxjYil7XG5cbiAgICBlbCA9ICBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKHtcbiAgICAgIHN0cm9rZVdpZHRoRnVsbDogdGhpcy5zaGFwZS5zdHJva2VXaWR0aEZ1bGwsXG4gICAgICBzdHJva2VXaWR0aEVtcHR5OiB0aGlzLnNoYXBlLnN0cm9rZVdpZHRoRW1wdHksXG4gICAgICBzdHJva2VXaWR0aEFjdGl2ZTogdGhpcy5zaGFwZS5zdHJva2VXaWR0aEFjdGl2ZSxcbiAgICAgIGRhc2hBcnJheSA6IHRoaXMuc2hhcGUuZGFzaEFycmF5LFxuICAgICAgc3Ryb2tlRW1wdHk6ICB0aGlzLnNoYXBlLnN0cm9rZUVtcHR5LFxuICAgICAgc3Ryb2tlRnVsbDogIHRoaXMuc2hhcGUuc3Ryb2tlRnVsbCxcbiAgICAgIHN0cm9rZUFjdGl2ZTp0aGlzLnNoYXBlLnN0cm9rZUFjdGl2ZVxuICAgIH0sZWwpO1xuXG5cbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgIGlmKGVsICYmIGVsLnNyYyAmJiAhZWwucGF0aHMpe1xuICAgICAgZmFicmljLmxvYWRTVkdGcm9tVVJMKGVsLnNyYyxmdW5jdGlvbihwYXRocyxvcHRpb25zKSB7XG4gICAgICAgIGVsLnBhdGhzICA9IHBhdGhzO1xuICAgICAgICBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGVsLG9wdGlvbnMpO1xuICAgICAgICBfdGhpcy5fc2V0X3NoYXBlKGVsKTtcbiAgICAgICAgX3RoaXMuYWRkKF90aGlzLl9mYWJyaWNfc2hhcGUpXG4gICAgICAgIF90aGlzLl9hcHBseV9zaGFwZSgpO1xuICAgICAgICBjYiAmJiBjYigpO1xuICAgICAgfSlcbiAgICB9ZWxzZXtcbiAgICAgIF90aGlzLl9zZXRfc2hhcGUoZWwpO1xuICAgICAgX3RoaXMuYWRkKF90aGlzLl9mYWJyaWNfc2hhcGUpO1xuICAgICAgX3RoaXMuX2FwcGx5X3NoYXBlKCk7XG4gICAgICBjYiAmJiBjYigpO1xuICAgIH1cbiAgfSxcbiAgc2V0RWxlbWVudDogZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICBpZighZWxlbWVudCl7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGVsZW1lbnQuc2V0KHtcbiAgICAgIG9yaWdpblggOiAnY2VudGVyJyxcbiAgICAgIG9yaWdpblkgOiAnY2VudGVyJyxcbiAgICB9KTtcbiAgICB0aGlzLmFkZChlbGVtZW50KTtcbiAgICBpZiAodGhpcy5mb3JtYXQgPT09ICdwbmcnIHx8IHRoaXMuZm9ybWF0ID09PSAnaW1hZ2UvcG5nJyB8fCB0aGlzLmZvcm1hdCA9PT0gJ2pwZWcnIHx8IHRoaXMuZm9ybWF0ID09PSAnaW1hZ2UvanBlZycpIHtcbiAgICAgIHRoaXMuX2NhY2hlID0gdGhpcy5lbGVtZW50Ll9lbGVtZW50O1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9pbml0X2NvbG9yX2FycmF5KCk7XG4gICAgfVxuICB9LFxuICB1cGRhdGVFbGVtZW50OiBmdW5jdGlvbiAoKSB7XG4gICAgaWYodGhpcy5lbGVtZW50KXtcbiAgICAgIHRoaXMuZWxlbWVudC5zY2FsZVggPSB0aGlzLndpZHRoIC8gdGhpcy5lbGVtZW50LndpZHRoO1xuICAgICAgdGhpcy5lbGVtZW50LnNjYWxlWSA9IHRoaXMuaGVpZ2h0IC8gdGhpcy5lbGVtZW50LmhlaWdodDtcbiAgICB9XG4gICAgaWYodGhpcy5fZmFicmljX3NoYXBlKXtcbiAgICAgIHRoaXMuX2ZhYnJpY19zaGFwZS5zZXQoe1xuICAgICAgICB3aWR0aDogdGhpcy53aWR0aCxcbiAgICAgICAgaGVpZ2h0OiB0aGlzLmhlaWdodFxuICAgICAgfSk7XG4gICAgfVxuICAgIHRoaXMuZGlydHkgPSB0cnVlO1xuICB9LFxuICBfcmVuZGVyOiBmdW5jdGlvbiAoY3R4KSB7XG4gICAgY3R4LnNhdmUoKTtcbiAgICBjdHguc2NhbGUodGhpcy5lbGVtZW50LnNjYWxlWCx0aGlzLmVsZW1lbnQuc2NhbGVZKVxuICAgIGZvciAodmFyIGkgPSAwLCBsID0gdGhpcy5lbGVtZW50LnBhdGhzLmxlbmd0aDsgaSA8IGw7ICsraSkge1xuICAgICAgdGhpcy5lbGVtZW50LnBhdGhzW2ldLnJlbmRlcihjdHgsIHRydWUpO1xuICAgIH1cbiAgICBjdHgucmVzdG9yZSgpO1xuICB9LFxuICAvKipcbiAgICog0LrQvtCx0YrQtdC60YIg0LPQvtGC0L7QstC40YLRgdGPINC6INC30LDQvNC10L3RgyDRhNC+0YLQvlxuICAgKi9cbiAgYWN0aXZhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLl9hY3RpdmF0ZWQgPSB0cnVlO1xuICAgIHRoaXMuX2ZhYnJpY19zaGFwZS5zZXRPcGFjaXR5KDEpO1xuICAgIHRoaXMudXBkYXRlU3Ryb2tlKCk7XG4gICAgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gIH0sXG4gIC8qKlxuICAgKiDQutC+0LHRitC10LrRgiDQvdC1INCz0L7RgtC+0LLQuNGC0YHRjyDQuiDQt9Cw0LzQtdC90YMg0YTQvtGC0L5cbiAgICovXG4gIGRlYWN0aXZhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLl9hY3RpdmF0ZWQgPSBmYWxzZTtcbiAgICB0aGlzLnVwZGF0ZVN0cm9rZSgpO1xuICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICB9LFxuICBfaW5pdF9jb2xvcl9hcnJheTogZnVuY3Rpb24gKCkge1xuXG4gICAgdGhpcy5wcm9jZXNzaW5nID0gdHJ1ZTtcbiAgICB0aGlzLl9jb2xvcnMgPSB0aGlzLmVsZW1lbnQuZXh0cmFjdENvbG9ycygpO1xuXG5cbiAgICBmb3IgKHZhciBfY29sb3IgaW4gdGhpcy5jb2xvcnMpIHtcbiAgICAgIHRoaXMuc2V0Q2xpcGFydENvbG9yKF9jb2xvciwgdGhpcy5jb2xvcnNbX2NvbG9yXSx0cnVlKVxuICAgIH1cbiAgfSxcbiAgLy8gcmVuZGVyOiBmdW5jdGlvbiAoY3R4KSB7XG4gIC8vICAgLy8gdmFyIHggPSBub1RyYW5zZm9ybSA/IDAgOiAtIHRoaXMud2lkdGggKiB0aGlzLnNjYWxlWCAvIDIsXG4gIC8vICAgLy8gICB5ID0gbm9UcmFuc2Zvcm0gPyAwIDogLSB0aGlzLmhlaWdodCAqIHRoaXMuc2NhbGVZIC8gMjtcbiAgLy8gICAvL1xuICAvLyAgIC8vIGN0eC5zYXZlKCk7XG4gIC8vICAgLy8gY3R4LnRyYW5zbGF0ZSh4LHkpO1xuICAvLyAgIGZhYnJpYy5Hcm91cC5wcm90b3R5cGUucmVuZGVyLmFwcGx5KHRoaXMsYXJndW1lbnRzKVxuICAvLyAgIC8vIGN0eC5yZXN0b3JlKCk7XG4gIC8vIH0sXG4gIHNldENsaXBhcnRDb2xvcjogZnVuY3Rpb24gKGtleSwgdmFsdWUsIHByZXZlbnRDYWNoZVVwZGF0ZSkge1xuXG4gICAgaWYgKCF2YWx1ZSkge1xuICAgICAgdmFsdWUgPSBrZXk7XG4gICAgICBkZWxldGUgdGhpcy5jb2xvcnNba2V5XTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5jb2xvcnNba2V5XSA9IHZhbHVlO1xuICAgIH1cbiAgICB2YXIgX2NvbG9ycyA9IHRoaXMuX2NvbG9yc1trZXldO1xuICAgIGZvciAodmFyIGkgaW4gX2NvbG9ycykge1xuICAgICAgaWYgKF9jb2xvcnNbaV0uY29sb3IpIHtcbiAgICAgICAgX2NvbG9yc1tpXS5jb2xvci5maWxsID0gdmFsdWU7XG4gICAgICB9XG4gICAgICBpZiAoX2NvbG9yc1tpXS5zdG9wKSB7XG4gICAgICAgIF9jb2xvcnNbaV0uc3RvcC5jb2xvciA9IHZhbHVlO1xuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMuZGlydHkgPSB0cnVlO1xuICAgIHRoaXMuY2FudmFzICYmIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICB9LFxuICB0b09iamVjdDogZnVuY3Rpb24gKHByb3BlcnRpZXNUb0luY2x1ZGUpIHtcbiAgICB2YXIgX29iaiA9IHRoaXMuY2FsbFN1cGVyKCd0b09iamVjdCcsIFsnc3JjJywgJ2NvbG9ycyddLmNvbmNhdChwcm9wZXJ0aWVzVG9JbmNsdWRlKSk7XG4gICAgZGVsZXRlIF9vYmoub2JqZWN0cztcbiAgICByZXR1cm4gX29iajtcbiAgfVxufSk7XG5cbmZhYnJpYy5DbGlwYXJ0LnByb3RvdHlwZS5hY3Rpb25zID0gZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCh7fSxcbiAgZmFicmljLk9iamVjdC5wcm90b3R5cGUuYWN0aW9ucywge1xuICAgIHN3aXRjaENvbnRyb2xzOiB7XG4gICAgICB0eXBlOiAnbWVudScsXG4gICAgICB0aXRsZTogJ2NvbG9yIG1lbnUnLFxuICAgICAgbWVudTogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgX21lbnUgPSBbXTtcbiAgICAgICAgZm9yICh2YXIga2V5IGluIHRoaXMuX2NvbG9ycykge1xuICAgICAgICAgIF9tZW51LnB1c2goe1xuICAgICAgICAgICAgdGl0bGU6IFwi0KbQstC10YIgKFwiICsga2V5ICsgXCIpXCIsXG4gICAgICAgICAgICB2YWx1ZToge1xuICAgICAgICAgICAgICBkZWZhdWx0VmFsdWU6IGtleSxcbiAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuY29sb3JzW2tleV0gfHwga2V5LFxuICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5jb2xvcnNba2V5XTtcbiAgICAgICAgICAgICAgfS5iaW5kKHRoaXMsIGtleSksXG4gICAgICAgICAgICAgIHNldDogdGhpcy5zZXRDbGlwYXJ0Q29sb3IuYmluZCh0aGlzLCBrZXkpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdHlwZTogXCJjb2xvclwiXG4gICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gX21lbnU7XG4gICAgICB9XG4gICAgfVxuICB9KTtcblxuZmFicmljLkNsaXBhcnQuYXN5bmMgPSB0cnVlO1xuLyoqXG4gKiBDcmVhdGVzIGZhYnJpYy5QYXRoR3JvdXAgaW5zdGFuY2UgZnJvbSBhbiBvYmplY3QgcmVwcmVzZW50YXRpb25cbiAqIEBzdGF0aWNcbiAqIEBtZW1iZXJPZiBmYWJyaWMuUGF0aEdyb3VwXG4gKiBAcGFyYW0ge09iamVjdH0gb2JqZWN0IE9iamVjdCB0byBjcmVhdGUgYW4gaW5zdGFuY2UgZnJvbVxuICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgQ2FsbGJhY2sgdG8gaW52b2tlIHdoZW4gYW4gZmFicmljLlBhdGhHcm91cCBpbnN0YW5jZSBpcyBjcmVhdGVkXG4gKi9cbmZhYnJpYy5DbGlwYXJ0LmZyb21PYmplY3QgPSBmdW5jdGlvbiAob2JqZWN0LCBjYWxsYmFjaykge1xuICBpZiAodHlwZW9mIG9iamVjdC5zcmMgPT09ICdzdHJpbmcnKSB7XG4gICAgaWYgKG9iamVjdC5mb3JtYXQgPT09ICdwbmcnIHx8IG9iamVjdC5mb3JtYXQgPT09IFwiaW1hZ2UvcG5nXCIgfHwgb2JqZWN0LmZvcm1hdCA9PT0gJ2pwZWcnIHx8IG9iamVjdC5mb3JtYXQgPT09IFwiaW1hZ2UvanBlZ1wiKSB7XG4gICAgICBmYWJyaWMuSW1hZ2UuZnJvbVVSTChvYmplY3Quc3JjLCBmdW5jdGlvbiAoZWwpIHtcbiAgICAgICAgb2JqZWN0LmVsZW1lbnQgPSBlbDtcbiAgICAgICAgb2JqZWN0LndpZHRoID0gb2JqZWN0LndpZHRoIHx8IGZhYnJpYy5DbGlwYXJ0LnByb3RvdHlwZS53aWR0aCxcbiAgICAgICAgICBvYmplY3QuaGVpZ2h0ID0gb2JqZWN0LmhlaWdodCB8fCBmYWJyaWMuQ2xpcGFydC5wcm90b3R5cGUuaGVpZ2h0XG4gICAgICAgIGNhbGxiYWNrKG5ldyBmYWJyaWMuQ2xpcGFydChvYmplY3QpKTtcbiAgICAgIH0sIHtcbiAgICAgICAgd2lkdGg6IG9iamVjdC53aWR0aCB8fCBmYWJyaWMuQ2xpcGFydC5wcm90b3R5cGUud2lkdGgsXG4gICAgICAgIGhlaWdodDogb2JqZWN0LmhlaWdodCB8fCBmYWJyaWMuQ2xpcGFydC5wcm90b3R5cGUuaGVpZ2h0XG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgZmFicmljLlBhdGhHcm91cC5mcm9tVVJMKG9iamVjdC5zcmMsIGZ1bmN0aW9uIChlbCkge1xuICAgICAgICBvYmplY3QuZWxlbWVudCA9IGVsO1xuICAgICAgICBvYmplY3Qud2lkdGggPSBvYmplY3Qud2lkdGggfHwgZmFicmljLkNsaXBhcnQucHJvdG90eXBlLndpZHRoLFxuICAgICAgICAgIG9iamVjdC5oZWlnaHQgPSBvYmplY3QuaGVpZ2h0IHx8IGZhYnJpYy5DbGlwYXJ0LnByb3RvdHlwZS5oZWlnaHRcbiAgICAgICAgY2FsbGJhY2sobmV3IGZhYnJpYy5DbGlwYXJ0KG9iamVjdCkpO1xuICAgICAgfSwge1xuICAgICAgICB3aWR0aDogb2JqZWN0LndpZHRoIHx8IGZhYnJpYy5DbGlwYXJ0LnByb3RvdHlwZS53aWR0aCxcbiAgICAgICAgaGVpZ2h0OiBvYmplY3QuaGVpZ2h0IHx8IGZhYnJpYy5DbGlwYXJ0LnByb3RvdHlwZS5oZWlnaHRcbiAgICAgIH0pO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gbmV3IGZhYnJpYy5DbGlwYXJ0KG9iamVjdCk7XG4gIH1cbn07XG5cbmZhYnJpYy51dGlsLmNyZWF0ZUFjY2Vzc29ycyhmYWJyaWMuQ2xpcGFydCk7XG5cbmlmIChmYWJyaWMub2JqZWN0c0xpYnJhcnkpIHtcbiAgZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMub2JqZWN0c0xpYnJhcnksIHtcbiAgICBjbGlwYXJ0OiB7XG4gICAgICBcIndpZHRoXCI6IGZ1bmN0aW9uICh3LCBoKSB7XG4gICAgICAgIHZhciBfYXNwID0gTWF0aC5taW4oMjg1IC8gMzY1LCB3IC8gaCk7XG4gICAgICAgIHJldHVybiB3O1xuICAgICAgfSxcbiAgICAgIFwiaGVpZ2h0XCI6IGZ1bmN0aW9uICh3LCBoKSB7XG4gICAgICAgIHZhciBfYXNwID0gTWF0aC5taW4oMjg1IC8gMzY1LCB3IC8gaCk7XG4gICAgICAgIHJldHVybiBoO1xuICAgICAgfSxcbiAgICAgIFwidHlwZVwiOiBcImNsaXBhcnRcIixcbiAgICAgIFwic3JjXCI6IFwiZGF0YTppbWFnZS9zdmcreG1sO3V0Zjg7YmFzZTY0LFBEOTRiV3dnZG1WeWMybHZiajBpTVM0d0lpQmxibU52WkdsdVp6MGlhWE52TFRnNE5Ua3RNU0kvUGdvOElTMHRJRWRsYm1WeVlYUnZjam9nUVdSdlltVWdTV3hzZFhOMGNtRjBiM0lnTVRrdU1DNHdMQ0JUVmtjZ1JYaHdiM0owSUZCc2RXY3RTVzRnTGlCVFZrY2dWbVZ5YzJsdmJqb2dOaTR3TUNCQ2RXbHNaQ0F3S1NBZ0xTMCtDanh6ZG1jZ2VHMXNibk05SW1oMGRIQTZMeTkzZDNjdWR6TXViM0puTHpJd01EQXZjM1puSWlCNGJXeHVjenA0YkdsdWF6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNVGs1T1M5NGJHbHVheUlnZG1WeWMybHZiajBpTVM0eElpQnBaRDBpVEdGNVpYSmZNU0lnZUQwaU1IQjRJaUI1UFNJd2NIZ2lJSFpwWlhkQ2IzZzlJakFnTUNBMU1USWdOVEV5SWlCemRIbHNaVDBpWlc1aFlteGxMV0poWTJ0bmNtOTFibVE2Ym1WM0lEQWdNQ0ExTVRJZ05URXlPeUlnZUcxc09uTndZV05sUFNKd2NtVnpaWEoyWlNJZ2QybGtkR2c5SWpVeE1uQjRJaUJvWldsbmFIUTlJalV4TW5CNElqNEtQR2MrQ2drOGNHRjBhQ0J6ZEhsc1pUMGlabWxzYkRvalJrWTRRelEyT3lJZ1pEMGlUVEUyTXk0eE9Ea3NOamN1TVRRNFF6RXlPUzQyTVRZc05qY3VNVFE0TERFeU1TNHlNaklzTUN3M09TNHlOVFVzTUVNMU1pNDNNVE1zTUN3eU9DNDRPVFFzTVRZdU56ZzNMREk0TGpnNU5DdzFNQzR6TmpFZ0lDQnpOVGd1TnpVMExEVXdMak0yTVN3ME1TNDVOamNzTVRBNUxqRXhOVXd4TmpNdU1UZzVMRFkzTGpFME9Ib2lMejRLQ1R4d1lYUm9JSE4wZVd4bFBTSm1hV3hzT2lOR1JqaERORFk3SWlCa1BTSk5NelEzTGpnME5TdzJOeTR4TkRoRE16Z3hMalF4T1N3Mk55NHhORGdzTXpnNUxqZ3hNaXd3TERRek1TNDNPQ3d3WXpJMkxqVTBNaXd3TERVd0xqTTJNU3d4Tmk0M09EY3NOVEF1TXpZeExEVXdMak0yTVNBZ0lITXROVGd1TnpVMExEVXdMak0yTVMwME1TNDVOamNzTVRBNUxqRXhOVXd6TkRjdU9EUTFMRFkzTGpFME9Ib2lMejRLUEM5blBnbzhaejRLQ1R4d1lYUm9JSE4wZVd4bFBTSm1hV3hzT2lOR1JrVkNSREk3SWlCa1BTSk5Nek14TGpVME1TdzBOakV1TmpNNVF6TXpNUzQxTkRFc05EZzVMalExTXl3ek1URXVOakkyTERVeE1pd3lOVFlzTlRFeWN5MDNOUzQxTkRFdE1qSXVOVFEzTFRjMUxqVTBNUzAxTUM0ek5qRjJMVGd1TXpremFERTFNQzQxT1RrZ0lDQk1Nek14TGpVME1TdzBOakV1TmpNNWVpSXZQZ29KUEhCaGRHZ2djM1I1YkdVOUltWnBiR3c2STBaR1JVSkVNanNpSUdROUlrMDBOVGt1TXpZNExERTRNaTQ1TVdNek5DNDBORFlzTlRZdU16QXpMRFF3TGpBME1pd3hNREl1TkRZM0xEUXdMakEwTWl3eE1ESXVORFkzYUMweE5pNDNPRGNnSUNCak1Dd3dMREUyTGpjNE55dzBNUzQwTkRNc01UWXVOemczTERZM0xqRTBPR3d0TWpVdU1UZ3RPQzR6T1ROak1Dd3dMREUyTGpjNE55d3pOeTQzTnl3eE5pNDNPRGNzTmpjdU1UUTRZekFzTUM0MU1qVXRNalV1TVRndE9DNHpPVE10TWpVdU1UZ3RPQzR6T1RNZ0lDQnpNVEl1TlRrc01qZ3VNekk0TERndU16a3pMRFF4TGprMk4yTXRNQzR4TlRRc01DNDFNREV0TWpVdU1UZ3RPQzR6T1RNdE1qVXVNVGd0T0M0ek9UTnpOeTR6TkRRc01Ua3VOVGcxTERBc016TXVOVGMwYkMwME1TNDVOamN0TVRZdU56ZzNJQ0FnWXpBc01DMDNMamcwTml3eU5TNDJPREV0T0M0ek9UTXNNalV1TVRoakxURTRMak0yTVMweE5pNDNPRGN0TkRFdU9UWTNMVEkxTGpFNExUUXhMamsyTnkweU5TNHhPRWd4TlRVdU1qYzVZekFzTUMweU15NDJNRGNzT0M0ek9UTXROREV1T1RZM0xESTFMakU0SUNBZ1l5MHdMalUwT0N3d0xqVXRPQzR6T1RNdE1qVXVNVGd0T0M0ek9UTXRNalV1TVRoc0xUUXhMamsyTnl3eE5pNDNPRGRqTFRjdU16UTBMVEV6TGprNE9Td3dMVE16TGpVM05Dd3dMVE16TGpVM05ITXRNalV1TURJMkxEZ3VPRGsxTFRJMUxqRTRMRGd1TXpreklDQWdZeTAwTGpFNU55MHhNeTQyTXprc09DNHpPVE10TkRFdU9UWTNMRGd1TXprekxUUXhMamsyTjNNdE1qVXVNVGdzT0M0NU1UZ3RNalV1TVRnc09DNHpPVE5qTUMweU9TNHpOemNzTVRZdU56ZzNMVFkzTGpFME9Dd3hOaTQzT0RjdE5qY3VNVFE0YkMweU5TNHhPQ3c0TGpNNU15QWdJR013TFRJMUxqY3dOU3d4Tmk0M09EY3ROamN1TVRRNExERTJMamM0TnkwMk55NHhORGhJTVRJdU5UbGpNQ3d3TERVdU5UazFMVFEyTGpFMk5DdzBNQzR3TkRJdE1UQXlMalEyTjBnME5Ua3VNelk0ZWlJdlBnbzhMMmMrQ2p4bGJHeHBjSE5sSUhOMGVXeGxQU0ptYVd4c09pTkdSa0UxTkVJN0lpQmplRDBpTWpVMUxqVXhOeUlnWTNrOUlqSXpNQzQ0TWlJZ2NuZzlJakl3T1M0NE16WWlJSEo1UFNJeE9UY3VNalEySWk4K0NqeG5QZ29KQ2drSlBHVnNiR2x3YzJVZ2RISmhibk5tYjNKdFBTSnRZWFJ5YVhnb0xUQXVOakEwTWlBdE1DNDNPVFk0SURBdU56azJPQ0F0TUM0Mk1EUXlJRFl6TGprME56VWdORGs1TGpnNU1qWXBJaUJ6ZEhsc1pUMGlabWxzYkRvalJrWkZRa1F5T3lJZ1kzZzlJakUxTmk0eE1qTWlJR041UFNJeU16UXVNRFkxSWlCeWVEMGlNemN1TnpZNUlpQnllVDBpTkRZdU1UWXpJaTgrQ2drS0NRazhaV3hzYVhCelpTQjBjbUZ1YzJadmNtMDlJbTFoZEhKcGVDZ3RNQzQyTURReUlEQXVOemsyT0NBdE1DNDNPVFk0SUMwd0xqWXdORElnTnpVMUxqa3lNRFFnT1RJdU56QXpNU2tpSUhOMGVXeGxQU0ptYVd4c09pTkdSa1ZDUkRJN0lpQmplRDBpTXpVMExqa3pOeUlnWTNrOUlqSXpOQzR3T0RZaUlISjRQU0l6Tnk0M05qa2lJSEo1UFNJME5pNHhOak1pTHo0S1BDOW5QZ284Y0dGMGFDQnpkSGxzWlQwaVptbHNiRG9qUmtZNFF6UTJPeUlnWkQwaVRUSTFOUzQxTWpRc01qWXdMakU1TjJndE1DNHdNVE5qTFRJNExqY3hNU3d3TFRVMUxqQTBOU3d4T0M0eU5qZ3ROamd1TlRNMkxEUTNMalV4TVNBZ1l5MHhPQzR4TmpNc016a3VNemMwTFRRd0xqVTNNeXc1TVM0NU9UWXROREF1TlRjekxERXhNUzQ1TmpSb01qRTRMakl5T1dNd0xURTVMamsyTnkweU1pNDBNRGt0TnpJdU5Ua3ROREF1TlRjekxURXhNUzQ1TmpRZ0lFTXpNVEF1TlRZNUxESTNPQzQwTmpRc01qZzBMakl6TkN3eU5qQXVNVGszTERJMU5TNDFNalFzTWpZd0xqRTVOM29pTHo0S1BIQmhkR2dnYzNSNWJHVTlJbVpwYkd3NkkwWkdSRVZDTnpzaUlHUTlJazB6TURRdU56azFMRE0yT1M0ek1URmpMVEU1TGpNNU15d3dMVE0yTGpnMU5TdzJMVFE1TGpJM09Dd3hOUzQxT0RoakxURXlMalF5TWkwNUxqVTRPQzB5T1M0NE9EVXRNVFV1TlRnNExUUTVMakkzT0MweE5TNDFPRGdnSUdNdE16Y3VOamd5TERBdE5qZ3VNak1zTWpJdU5UUTNMVFk0TGpJekxEVXdMak0yTVhNek1DNDFORGdzTlRBdU16WXhMRFk0TGpJekxEVXdMak0yTVdNeE5TNDNNamdzTUN3ek1DNHhPRGN0TXk0NU5EY3NOREV1TnpFMkxURXdMalUxTkNBZ1l6UXVOelkwTFRJdU56TXNNVEF1TXpVM0xUSXVOek1zTVRVdU1USXlMREJqTVRFdU5USTVMRFl1TmpBM0xESTFMams0T0N3eE1DNDFOVFFzTkRFdU56RTJMREV3TGpVMU5HTXpOeTQyT0RJc01DdzJPQzR5TXkweU1pNDFORGNzTmpndU1qTXROVEF1TXpZeElDQlRNelF5TGpRM09Dd3pOamt1TXpFeExETXdOQzQzT1RVc016WTVMak14TVhvaUx6NEtQR2MrQ2drOGNHRjBhQ0J6ZEhsc1pUMGlabWxzYkRvak5EWTBOalUxT3lJZ1pEMGlUVEl4TlM0ek5EUXNNemMwTGprNU1Xd3pNeTQwT0N3ME5DNHlNekpqTXk0ek5UZ3NOQzQwTXpjc01UQXVNREkyTERRdU5ETTNMREV6TGpNNE5Dd3diRE16TGpRNExUUTBMakl6TWlBZ0lHTTBMakU0TkMwMUxqVXlPQ3d3TGpJME1TMHhNeTQwTlRrdE5pNDJPVE10TVRNdU5EVTVhQzAwTGpWakxUSXVOVElzTUMwMUxqQXlOaXd3TGpNM09DMDNMalF6TWl3eExqRXlNbXd0TVRRdU1URTJMRFF1TXpZeFl5MDBMamcwTWl3eExqUTVOaTB4TUM0d01qTXNNUzQwT1RZdE1UUXVPRFkxTERBZ0lDQnNMVEUwTGpFeE5pMDBMak0yTVdNdE1pNDBNRGd0TUM0M05EUXROQzQ1TVRNdE1TNHhNakl0Tnk0ME16SXRNUzR4TWpKb0xUUXVORGs1UXpJeE5TNHhNRE1zTXpZeExqVXpNaXd5TVRFdU1UWXNNelk1TGpRMk15d3lNVFV1TXpRMExETTNOQzQ1T1RGNklpOCtDZ2s4WTJseVkyeGxJSE4wZVd4bFBTSm1hV3hzT2lNME5qUTJOVFU3SWlCamVEMGlNVFUwTGpjNU5pSWdZM2s5SWpJek5TNHdNVFlpSUhJOUlqRTJMamM0TnlJdlBnb0pQR05wY21Oc1pTQnpkSGxzWlQwaVptbHNiRG9qTkRZME5qVTFPeUlnWTNnOUlqTTFOaTR5TXpraUlHTjVQU0l5TXpVdU1ERTJJaUJ5UFNJeE5pNDNPRGNpTHo0S0NUeHdZWFJvSUhOMGVXeGxQU0ptYVd4c09pTTBOalEyTlRVN0lpQmtQU0pOTnpjdU16VTRMRE16TlM0d01ERnNORFl1TWpBMkxUTTNMamd3TldNMExqQXhNaTB6TGpJNE15d3hMakV5TXkwNUxqYzJNUzAwTGpBd01TMDRMamsyT1d3dE5qRXVORGM0TERrdU5TQWdJRU0yTXk0eE1qTXNNekV3TGpnMkxEWTVMall4T0N3ek1qTXVNek14TERjM0xqTTFPQ3d6TXpVdU1EQXhlaUl2UGdvSlBIQmhkR2dnYzNSNWJHVTlJbVpwYkd3Nkl6UTJORFkxTlRzaUlHUTlJazB4TWpFdU5Ea3pMRE00TWk0MU56ZHNNalV1TURVeUxUWTJMamd3TjJNeExqa3lNaTAxTGpFeU5TMDBMalE1TkMwNUxqSTFOaTA0TGpNMk5DMDFMak00Tld3dE5EVXVNVGd6TERRMUxqRTRNeUFnSUVNeE1ERXVOVFUxTERNMk5TNDBNRFlzTVRFeExqQTVPQ3d6TnpRdU5EVTFMREV5TVM0ME9UTXNNemd5TGpVM04zb2lMejRLQ1R4d1lYUm9JSE4wZVd4bFBTSm1hV3hzT2lNME5qUTJOVFU3SWlCa1BTSk5NakkyTGpRd05Td3hNRGt1TVRRNWJDMDJMall6TXkwM01pNDJOamRqTFRndU1UQTJMREV1TXpBNExURTJMakExTWl3ekxqQTBOQzB5TXk0NE1URXNOUzR5TURGc01qRXVOVE15TERZNUxqSXpPU0FnSUVNeU1Ua3VNVElzTVRFMkxqRTFOeXd5TWpZdU9UQXpMREV4TkM0Mk1Ea3NNakkyTGpRd05Td3hNRGt1TVRRNWVpSXZQZ29KUEhCaGRHZ2djM1I1YkdVOUltWnBiR3c2SXpRMk5EWTFOVHNpSUdROUlrMHlPVEV1TWpZekxETTJMalE0TW13dE5pNDJNek1zTnpJdU5qWTNZeTB3TGpRNU9DdzFMalEyTERjdU1qZzBMRGN1TURBM0xEZ3VPVEV6TERFdU56Y3liREl4TGpVek1pMDJPUzR5TXprZ0lDQkRNekEzTGpNeE5Td3pPUzQxTWpjc01qazVMak0yT1N3ek55NDNPU3d5T1RFdU1qWXpMRE0yTGpRNE1ub2lMejRLQ1R4d1lYUm9JSE4wZVd4bFBTSm1hV3hzT2lNME5qUTJOVFU3SWlCa1BTSk5Nek0zTGpNNE55dzBPUzR4TlRac0xUSXdMalV3T1N3ME55NDBORGxqTFRJdU1UTTNMRFF1T1RRMkxEUXVOVFE1TERndU9EWTRMRGN1T0RJekxEUXVOVGc0YkRNeUxqY3pMVFF5TGpjNU1TQWdJRU16TlRBdU9UUTJMRFUxTGpBeExETTBOQzR5TnpFc05URXVPU3d6TXpjdU16ZzNMRFE1TGpFMU5ub2lMejRLQ1R4d1lYUm9JSE4wZVd4bFBTSm1hV3hzT2lNME5qUTJOVFU3SWlCa1BTSk5NVGswTGpFMU55dzVOaTQyTURWc0xUSXdMalV3T1MwME55NDBORGxqTFRZdU9EZzBMREl1TnpRMUxURXpMalUxT1N3MUxqZzFNeTB5TUM0d05EUXNPUzR5TkRkc016SXVOek1zTkRJdU56a2dJQ0JETVRnNUxqWXdPQ3d4TURVdU5EY3pMREU1Tmk0eU9UVXNNVEF4TGpVMU1Td3hPVFF1TVRVM0xEazJMall3TlhvaUx6NEtDVHh3WVhSb0lITjBlV3hsUFNKbWFXeHNPaU0wTmpRMk5UVTdJaUJrUFNKTk1qY3lMakl5TkN3ek5DNHlOVE5qTFRVdU5URTRMVEF1TkRBNExURXhMakEzTnkwd0xqWTNPUzB4Tmk0M01EY3RNQzQyTnpsakxUVXVOak1zTUMweE1TNHhPRGtzTUM0eU56RXRNVFl1TnpBM0xEQXVOamM1SUNBZ2JERXlMakUyT1N3eE1ETXVORFJqTUM0Mk16TXNOUzR6T0N3NExqUTBNaXcxTGpNNExEa3VNRGMxTERCTU1qY3lMakl5TkN3ek5DNHlOVE42SWk4K0NnazhjR0YwYUNCemRIbHNaVDBpWm1sc2JEb2pORFkwTmpVMU95SWdaRDBpVFRRek5DNDROamdzTXpNMUxqQXdNV3d0TkRZdU1qQTJMVE0zTGpnd05XTXROQzR3TVRJdE15NHlPRE10TVM0eE1qTXRPUzQzTmpFc05DNHdNREV0T0M0NU5qbHNOakV1TkRjNExEa3VOU0FnSUVNME5Ea3VNVEEwTERNeE1DNDROaXcwTkRJdU5qQTRMRE15TXk0ek16RXNORE0wTGpnMk9Dd3pNelV1TURBeGVpSXZQZ29KUEhCaGRHZ2djM1I1YkdVOUltWnBiR3c2SXpRMk5EWTFOVHNpSUdROUlrMHpPVEF1TnpNekxETTRNaTQxTnpkc0xUSTFMakExTWkwMk5pNDRNRGRqTFRFdU9USXlMVFV1TVRJMUxEUXVORGswTFRrdU1qVTJMRGd1TXpZMExUVXVNemcxYkRRMUxqRTRNeXcwTlM0eE9ETWdJQ0JETkRFd0xqWTNNU3d6TmpVdU5EQTJMRFF3TVM0eE1qa3NNemMwTGpRMU5Td3pPVEF1TnpNekxETTRNaTQxTnpkNklpOCtDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BHYytDand2Wno0S1BDOXpkbWMrQ2c9PVwiXG4gICAgfVxuICB9KTtcbn1cblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vb2JqZWN0cy9DbGlwYXJ0LmpzXG4vLyBtb2R1bGUgaWQgPSA4OVxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCIndXNlIHN0cmljdCc7XG5cblxucmVxdWlyZShcIi4vLi4vbWl4aW5zL1N0cm9rZU1peGluXCIpO1xuICAgIC8qKlxuICAgKiBAYXV0aG9yIERlbmlzIFBvbm9tYXJldlxuICAgKiBAZW1haWwgZGVuLnBvbm9tYXJldkBnbWFpbC5jb21cbiAgICovXG4gIGZhYnJpYy5GcmFtZSA9IGZhYnJpYy51dGlsLmNyZWF0ZUNsYXNzKGZhYnJpYy5Hcm91cCwgZmFicmljLlN0cm9rZU1peGluLCB7XG4gICAgdHlwZTogJ2ZyYW1lJyxcbiAgICAvL3N0cm9rZUFjdGl2ZTogICBcImxpZ2h0Z3JlZW5cIixcbiAgICAvL3N0cm9rZTogXCJyZWRcIixcbiAgICBtaW5XaWR0aDogMzUsXG4gICAgbWluSGVpZ2h0OiAzNSxcbiAgICBmaWxsIDogXCJ0cmFuc3BhcmVudFwiLFxuICAgIHJlc2l6YWJsZTogdHJ1ZSxcbiAgICBjb250ZW50VG9vbHM6IGZhbHNlLFxuICAgIC8vc3RhdGVzIDogRW1wdHkgLyBGdWxsIC8gQWN0aXZlXG4gICAgc3BlY2lhbFByb3BlcnRpZXM6IFtcImVsZW1lbnRcIixcInNoYXBlXCIsXCJjbGlwXCJdLFxuICAgIHN0YXRlUHJvcGVydGllczogZmFicmljLkdyb3VwLnByb3RvdHlwZS5zdGF0ZVByb3BlcnRpZXMuY29uY2F0KFtcImNsaXBcIl0pLFxuICAgIGNsaXA6IHtcbiAgICAgIGxlZnQ6IDAsXG4gICAgICB0b3A6IDAsXG4gICAgICBzY2FsZVg6IDEsXG4gICAgICBzY2FsZVk6IDFcbiAgICB9LFxuICAgIGNsaXBwaW5nQXZhaWxhYmxlOiBmdW5jdGlvbigpe1xuICAgICAgcmV0dXJuIHRoaXMuY2xpcEVuYWJsZWQgJiYgdGhpcy5lbGVtZW50ICYmICF0aGlzLl9jbGlwbW9kZTtcbiAgICB9LFxuICAgIGNsaXBFbmFibGVkOiB0cnVlLFxuICAgIC8qKlxuICAgICAqIGNyZWF0ZSBjbG9uZSB3aXRoIHNhbWUgaW1hZ2UgYW5kIHNoYXBlIGFzIG9yaWdpbmFsIChzeW5jcm9ub3VzKVxuICAgICAqIEBwYXJhbSBjYWxsYmFja1xuICAgICAqIEByZXR1cm5zIHsqfVxuICAgICAqL1xuICAgIGNsb25lU3luYzogZnVuY3Rpb24ob3B0aW9ucyl7XG4gICAgICB2YXIgX2ZyYW1lID0gbmV3IGZhYnJpYy5GcmFtZSh0aGlzKTtcbiAgICAgIG9wdGlvbnMgJiYgX2ZyYW1lLnNldChvcHRpb25zKTtcbiAgICAgIHJldHVybiBfZnJhbWU7XG4gICAgfSxcbiAgICBpbml0aWFsaXplOiBmdW5jdGlvbiAob3B0aW9ucykge1xuXG4gICAgICBvcHRpb25zIHx8ICggb3B0aW9ucyA9IHt9KTtcblxuXG5cbiAgICAgIGlmKG9wdGlvbnMuY29uc3RydWN0b3IgIT0gT2JqZWN0KXtcblxuICAgICAgICB2YXIgX29iaiA9IG9wdGlvbnMudG9PYmplY3QoKTtcbiAgICAgICAgaWYob3B0aW9ucy5lbGVtZW50KXtcbiAgICAgICAgICBfb2JqLmVsZW1lbnQgPSBvcHRpb25zLmVsZW1lbnQuY2xvbmVTeW5jKCk7XG4gICAgICAgICAgX29iai5lbGVtZW50LmNsaXBUbyA9IF9vYmouX2ZhYnJpY19zaGFwZTtcbiAgICAgICAgfVxuICAgICAgICBfb2JqLnNoYXBlID0gb3B0aW9ucy5zaGFwZTtcbiAgICAgICAgb3B0aW9ucyA9IF9vYmo7XG4gICAgICB9XG5cblxuICAgICAgdGhpcy5vbih7XG4gICAgICAgIFwib2JqZWN0OmNsaWNrXCI6dGhpcy5fY2hlY2tfdGV4dF9hc190YXJnZXRfYW5kX2VkaXQsXG4gICAgICAgIFwiZGJsY2xpY2tcIjp0aGlzLnRvZ2dsZUNsaXBNb2RlQnlDbGljayxcbiAgICAgICAgXCJzY2FsaW5nXCI6IHRoaXMuX2FwcGx5X3NoYXBlLFxuICAgICAgICBcImVsZW1lbnQ6bW9kaWZpZWRcIjogZnVuY3Rpb24oZXZlbnQpe1xuICAgICAgICAgIHRoaXMudXBkYXRlU3Ryb2tlKCk7XG4gICAgICAgICAgdGhpcy5fYXBwbHlfc2hhcGUoKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cblxuICAgICAgdGhpcy5pbml0U2hhcGUob3B0aW9ucyk7XG5cbiAgICAgIHRoaXMuY2FsbFN1cGVyKCdpbml0aWFsaXplJywgW1xuICAgICAgICB0aGlzLl9mYWJyaWNfc2hhcGVcbiAgICAgIF0sIG9wdGlvbnMpO1xuICAgICAgdGhpcy5fZWxlbWVudHNfdG9fdXBkYXRlID0gW107XG5cbiAgICB9LFxuICAgIHRvZ2dsZUNsaXBNb2RlQnlDbGljazogZnVuY3Rpb24oZSl7XG4gICAgICBpZih0aGlzLl9pc19jbGlwcGluZ19hdmFpbGFibGUoZS5lKSl7XG4gICAgICAgIGlmKCF0aGlzLl9jbGlwbW9kZSl7XG4gICAgICAgICAgdGhpcy5jbGlwUGhvdG9TdGFydCgpXG4gICAgICAgIH1lbHNle1xuICAgICAgICAgIHRoaXMuY2xpcFBob3RvRW5kKClcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG4gICAgX2NoZWNrX3RleHRfYXNfdGFyZ2V0X2FuZF9lZGl0OiBmdW5jdGlvbihlKXtcbiAgICAgIGlmKCB0aGlzLmlzUG9zc2libGVUYXJnZXQoZS5lLHRoaXMudGV4dCkpe1xuICAgICAgICB0aGlzLnRleHQuc2V0T3BhY2l0eSgxKTtcbiAgICAgICAgdGhpcy5fb25fdGV4dF9lZGl0KGUpO1xuICAgICAgfVxuICAgIH0sXG4gICAgY2xpcFBob3RvRW5kOmZ1bmN0aW9uKCl7XG4gICAgICB0aGlzLmNhbnZhcy5lZGl0aW5nT2JqZWN0ID0gbnVsbDtcbiAgICAgIHRoaXMuY2FudmFzLm9mZihcInRhcmdldDpjaGFuZ2VkIHRhcmdldDpjbGVhcmVkXCIsdGhpcy5fZW5kRm9vKTtcblxuICAgICAgaWYodGhpcy5jYW52YXMuZ3JpZCl7XG4gICAgICAgIHRoaXMuY2FudmFzLmdyaWQuZW5hYmxlZCA9IHRydWU7XG4gICAgICB9XG5cbiAgICAgIC8vdGhpcy5wcm9qZWN0LmNsaXBNb2RlID0gZmFsc2U7XG5cblxuICAgICAgdGhpcy5jYW52YXMucmVtb3ZlKHRoaXMuZWxlbWVudCk7XG4gICAgICB0aGlzLnNldCh7XG4gICAgICAgIGhhc0NvbnRyb2xzOiBmYWxzZSxcbiAgICAgICAgZXZlbnRlZDogdHJ1ZSxcbiAgICAgICAgZmxpcFg6ICAgdGhpcy5lbGVtZW50LmZsaXBYLFxuICAgICAgICBmbGlwWTogICB0aGlzLmVsZW1lbnQuZmxpcFlcbiAgICAgIH0pXG5cbiAgICAgIHZhciB0b19yYWRpYW5zID0gTWF0aC5QSSAvIDE4MDtcbiAgICAgIHZhciBjb3NBID0gTWF0aC5jb3ModGhpcy5hbmdsZSAqIHRvX3JhZGlhbnMpO1xuICAgICAgdmFyIHNpbkEgPSBNYXRoLnNpbih0aGlzLmFuZ2xlICogdG9fcmFkaWFucyk7XG4gICAgICB2YXIgSSA9IHRoaXMuZWxlbWVudCwgRiA9IHRoaXM7XG4gICAgICB2YXIgX25ld0dlb21ldHJ5ID0ge1xuICAgICAgICBhbmdsZTogdGhpcy5lbGVtZW50LmFuZ2xlIC0gdGhpcy5hbmdsZSxcbiAgICAgICAgbGVmdDogKCAoSS5sZWZ0IC0gRi5sZWZ0KSAqIGNvc0EgKyAoSS50b3AgLSBGLnRvcCkqIHNpbkEgIC0gRi53aWR0aC8gMikgKiAoSS5mbGlwWCA/IC0xIDogMSksXG4gICAgICAgIHRvcDogICgtKEkubGVmdCAtIEYubGVmdCkgKiBzaW5BICsgKEkudG9wIC0gRi50b3ApKiBjb3NBICAtIEYuaGVpZ2h0LyAyKSogKEkuZmxpcFkgPyAtMSA6IDEpLFxuICAgICAgICBmbGlwWDogZmFsc2UsXG4gICAgICAgIGZsaXBZOiBmYWxzZVxuICAgICAgfTtcbiAgICAgIHRoaXMuYWRkKHRoaXMuZWxlbWVudCk7XG4gICAgICB0aGlzLmVsZW1lbnQuc2V0KF9uZXdHZW9tZXRyeSk7XG4gICAgICAvL1xuICAgICAgLy9cbiAgICAgIHRoaXMuX2NsaXBtb2RlID1mYWxzZTtcbiAgICAgIC8v0YDQsNC80LrRgyDQtNCy0LjQs9Cw0YLRjCDQvdC10LvRjNC30Y9cbiAgICAgIHRoaXMuc2V0KHtcbiAgICAgICAgaGFzQ29udHJvbHM6IHRydWUsXG4gICAgICAgIGV2ZW50ZWQ6IHRydWVcbiAgICAgIH0pO1xuICAgICAgdGhpcy5jYW52YXMucmVtb3ZlKHRoaXMuX2ZhYnJpY19zaGFwZSk7XG4gICAgICB0aGlzLmFkZCh0aGlzLl9mYWJyaWNfc2hhcGUpO1xuICAgICAgdGhpcy51cGRhdGVTdHJva2UoKTtcbiAgICAgIHRoaXMuX2FwcGx5X3NoYXBlKCk7XG5cbiAgICAgIHRoaXMuZWxlbWVudC5hY3RpdmUgPSBmYWxzZTtcbiAgICAgIHRoaXMuY2FudmFzLnNldEFjdGl2ZU9iamVjdCh0aGlzKTtcbiAgICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuXG4gICAgICB2YXIgdyA9IHRoaXMud2lkdGgsICBoID0gdGhpcy5oZWlnaHQsIGVsID0gdGhpcy5lbGVtZW50O1xuXG4gICAgICB0aGlzLmNsaXAgPSB7XG4gICAgICAgIGxlZnQgICA6IChlbC5sZWZ0KSAvIHcgLFxuICAgICAgICB0b3AgICAgOiAoZWwudG9wKSAvIGggLFxuICAgICAgICBzY2FsZVggOiAoZWwud2lkdGggKSAvIHcsXG4gICAgICAgIHNjYWxlWSA6IChlbC5oZWlnaHQpIC8gaFxuICAgICAgfTtcblxuICAgICAgdGhpcy5maXJlKFwiY2xpcHBpbmc6ZXhpdGVkXCIpO1xuICAgICAgdGhpcy5jYW52YXMuZmlyZSgnZnJhbWU6Y2xpcHBpbmc6ZXhpdGVkJywgeyB0YXJnZXQ6IHRoaXMgfSk7XG4gICAgfSxcblxuICAgIGNsaXBQaG90b1N0YXJ0OmZ1bmN0aW9uKCl7XG4gICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgdGhpcy5fY2xpcG1vZGUgPSB0cnVlO1xuICAgICAgdGhpcy51cGRhdGVTdHJva2UoKTtcbiAgICAgIHRoaXMuX2FwcGx5X3NoYXBlKCk7XG4gICAgICB0aGlzLmNhbnZhcy5kaXNjYXJkQWN0aXZlR3JvdXAoKTtcbiAgICAgIGlmKHRoaXMuY2FudmFzLmdyaWQpe1xuICAgICAgICB0aGlzLmNhbnZhcy5ncmlkLmVuYWJsZWQgPSBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgLyogdGhpcy5mYWJyaWMuc2V0KHtcbiAgICAgICBvcmlnaW5YOiBcImNlbnRlclwiLFxuICAgICAgIG9yaWdpblk6ICBcImNlbnRlclwiLFxuICAgICAgIGxlZnQ6IHRoaXMuZmFicmljLmxlZnQgKyB0aGlzLmZhYnJpYy53aWR0aC8yLFxuICAgICAgIHRvcDogdGhpcy5mYWJyaWMudG9wICsgdGhpcy5mYWJyaWMuaGVpZ2h0LzIsXG4gICAgICAgfSk7Ki9cblxuICAgICAgdGhpcy5lbGVtZW50LnNldCh7XG4gICAgICAgIG1vdmVtZW50TGltaXRzOiB0aGlzLFxuICAgICAgICBtb3ZlbWVudExpbWl0TW9kZTogXCJjb250ZW50XCIsXG4gICAgICAgIC8vY2xpcFRvOiAgICAgICAgIHRoaXMsXG4gICAgICAgIGZsaXBYOiB0aGlzLmZsaXBYLFxuICAgICAgICBmbGlwWTogdGhpcy5mbGlwWSxcbiAgICAgICAgLy9sZWZ0OiB0aGlzLmVsZW1lbnQubGVmdCogKHRoaXMuZmxpcFggPyAtMSA6IDEpLFxuICAgICAgICAvL3RvcDogIHRoaXMuZWxlbWVudC50b3AqICh0aGlzLmZsaXBZID8gLTEgOiAxKVxuICAgICAgfSk7XG5cbiAgICAgIHRoaXMuX3Jlc3RvcmVPYmplY3RTdGF0ZSh0aGlzLmVsZW1lbnQpO1xuICAgICAgdGhpcy5lbGVtZW50LnNldCh7XG4gICAgICAgIGhhc0NvbnRyb2xzOiB0cnVlLFxuICAgICAgICAvL3NlbGVjdGFibGU6IGZhbHNlLFxuICAgICAgICAvL3BlclBpeGVsVGFyZ2V0RmluZDogdHJ1ZSxcbiAgICAgICAgc2VsZWN0YWJsZTogdHJ1ZSxcbiAgICAgICAgcGVyUGl4ZWxUYXJnZXRGaW5kOiBmYWxzZVxuICAgICAgfSk7XG4gICAgICB0aGlzLnJlbW92ZSh0aGlzLmVsZW1lbnQpO1xuICAgICAgdGhpcy5jYW52YXMuYWRkKHRoaXMuZWxlbWVudCk7XG5cbiAgICAgIHRoaXMuX3Jlc3RvcmVPYmplY3RTdGF0ZSh0aGlzLl9mYWJyaWNfc2hhcGUpO1xuICAgICAgdGhpcy5yZW1vdmUodGhpcy5fZmFicmljX3NoYXBlKTtcbiAgICAgIHRoaXMuY2FudmFzLmFkZCh0aGlzLl9mYWJyaWNfc2hhcGUpO1xuXG5cblxuXG4gIC8v0YDQsNC80LrQsCDQtNC+0LvQttC90LAg0YDQuNGB0L7QstCw0YLRjNGB0Y8g0L3QsNC0INC60LDRgNGC0LjQvdC60L7QuSwg0LjQvdCw0YfQtSAg0L3QtdC60YDQsNGB0LjQstC+XG4gIC8vICAgICAgdGhpcy5zbGlkZS5jYW52YXMuYnJpbmdUb0Zyb250KHRoaXMuZmFicmljKTtcblxuICAgICAgLy/RgNCw0LzQutGDINC00LLQuNCz0LDRgtGMINC90LXQu9GM0LfRj1xuICAgICAgdGhpcy5zZXQoe1xuICAgICAgICBoYXNDb250cm9sczogZmFsc2UsXG4gICAgICAgIGV2ZW50ZWQ6IGZhbHNlXG4gICAgICB9KTtcblxuXG4gICAgICB0aGlzLmNhbnZhcy5zZXRBY3RpdmVPYmplY3QodGhpcy5lbGVtZW50KTtcbiAgICAgIHRoaXMuYWN0aXZlID0gdHJ1ZTtcblxuXG4gICAgICB0aGlzLl9lbmRGb28gPSBmdW5jdGlvbigpe1xuICAgICAgICBfdGhpcy5jbGlwUGhvdG9FbmQoKTtcbiAgICAgIH07XG4gICAgICB0aGlzLmNhbnZhcy5vbihcInRhcmdldDpjaGFuZ2VkIHRhcmdldDpjbGVhcmVkXCIsdGhpcy5fZW5kRm9vKTtcblxuICAgICAgdGhpcy5maXJlKFwiY2xpcHBpbmc6ZW50ZXJlZFwiKTtcbiAgICAgIHRoaXMuY2FudmFzLmZpcmUoJ2ZyYW1lOmNsaXBwaW5nOmVudGVyZWQnLCB7IHRhcmdldDogdGhpcyB9KTtcblxuICAgICAgdGhpcy5jYW52YXMuZWRpdGluZ09iamVjdCA9IHRoaXM7XG4gICAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICB9LFxuICAgIHJlbmRlcjogZnVuY3Rpb24oY3R4LCBub1RyYW5zZm9ybSkge1xuICAgICAgaWYodGhpcy5fY2xpcG1vZGUpe1xuICAgICAgICB2YXIgX3pvb20gPSB0aGlzLmNhbnZhcy5nZXRab29tKCk7XG4gICAgICAgIGN0eC5zYXZlKCk7XG4gICAgICAgIC8vICB0aGlzLnRyYW5zZm9ybShjdHgpO1xuICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSAwLjU7XG4gICAgICAgIHZhciBfY2xpcF90byA9IHRoaXMuZWxlbWVudC5jbGlwVG87XG4gICAgICAgIHRoaXMuZWxlbWVudC5jbGlwVG8gPSBudWxsO1xuICAgICAgICB0aGlzLmVsZW1lbnQucmVuZGVyKGN0eCk7XG4gICAgICAgIGN0eC5zY2FsZShfem9vbSxfem9vbSk7XG4gICAgICAgIHRoaXMuZWxlbWVudC5jbGlwVG8gPSBfY2xpcF90bztcbiAgICAgICAgdGhpcy50cmFuc2Zvcm0oY3R4KTtcbiAgICAgICAgY3R4LnN0cm9rZVN0eWxlID0gdGhpcy5ib3JkZXJDb2xvcjtcbiAgICAgICAgY3R4LmxpbmVXaWR0aCA9IDEgLyB0aGlzLmJvcmRlclNjYWxlRmFjdG9yO1xuICAgICAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgICAgIGN0eC5jbG9zZVBhdGgoKTtcbiAgICAgICAgY3R4LnN0cm9rZSgpO1xuICAgICAgICBjdHgucmVzdG9yZSgpO1xuICAgICAgfVxuICAgICAgdGhpcy5jYWxsU3VwZXIoJ3JlbmRlcicsIGN0eCwgbm9UcmFuc2Zvcm0pO1xuICAgIH0sXG4gICAgLy9zdXBwb3J0ZWRUeXBlczogXCIqXCIsIC8vICogb3IgW1wiaW1hZ2VcIixcInZpZGVvXCIsLi4uXVxuICAgIGNsaXBwaW5nU3VwcG9ydGVkVHlwZXM6IFwiKlwiLCAvLyAqIG9yIFtcImltYWdlXCIsXCJ2aWRlb1wiLC4uLl1cbiAgICBfaXNfY2xpcHBpbmdfYXZhaWxhYmxlIDogZnVuY3Rpb24oZSl7XG4gICAgICBpZighdGhpcy5jbGlwRW5hYmxlZClyZXR1cm4gZmFsc2U7XG4gICAgICBpZihlICYmIHRoaXMuaXNQb3NzaWJsZVRhcmdldChlLHRoaXMuYnV0dG9uKSl7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzLmVsZW1lbnQgJiYgKHRoaXMuY2xpcHBpbmdTdXBwb3J0ZWRUeXBlcyA9PSBcIipcIiB8fCB0aGlzLmNsaXBwaW5nU3VwcG9ydGVkVHlwZXMuaW5kZXhPZih0aGlzLmVsZW1lbnQudHlwZSkhPSAtMSk7XG4gICAgfSxcbiAgICBfcmVtb3ZlX2VsZW1lbnQ6IGZ1bmN0aW9uKCl7fSxcbiAgICBkcm9wOiBmdW5jdGlvbihkYXRhKXtcbiAgICAgIGlmKGRhdGEudHlwZSA9PSBcImZyYW1lXCIpe1xuICAgICAgICB0aGlzLnNldEZyYW1lKGRhdGEuZnJhbWUpO1xuICAgICAgICB0aGlzLnNldFNoYXBlKGRhdGEuc2hhcGUpO1xuICAgICAgfWVsc2V7XG4gICAgICAgIHRoaXMuc2V0RWxlbWVudE9iamVjdChkYXRhKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIGRyb3BwYWJsZToge1xuICAgICAgdHlwZTogW1wiaW1hZ2VcIixcInZpZGVvXCIsXCJmcmFtZVwiXVxuICAgIH0sXG4gICAgc2V0RWxlbWVudE9iamVjdDogZnVuY3Rpb24ob3B0aW9ucyxjYWxsYmFjayl7XG4gICAgICB0aGlzLl9zZXRfcGVuZGluZyh0cnVlKTtcbiAgICAgIHRoaXMuZmlyZShcImVsZW1lbnQ6bG9hZGluZ1wiKTtcbiAgICAgIGZhYnJpYy51dGlsLmNyZWF0ZU9iamVjdChvcHRpb25zLGZ1bmN0aW9uKGVsKXtcbiAgICAgICAgdGhpcy5fc2V0X3BlbmRpbmcoZmFsc2UpO1xuICAgICAgICB0aGlzLnNldEVsZW1lbnRLbGFzcyhlbCk7XG4gICAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKGVsKTtcbiAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgfSxcbiAgICBzZXRFbGVtZW50OiBmdW5jdGlvbihlbCxjYil7XG4gICAgICBpZihlbCl7XG4gICAgICAgIGlmKGVsLmNvbnN0cnVjdG9yID09IE9iamVjdCl7XG4gICAgICAgICAgdGhpcy5zZXRFbGVtZW50T2JqZWN0KGVsLGNiKVxuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICB0aGlzLnNldEVsZW1lbnRLbGFzcyhlbCk7XG4gICAgICAgICAgY2IgJiYgY2IoKTtcbiAgICAgICAgfVxuICAgICAgfWVsc2V7XG4gICAgICAgIHRoaXMuc2V0RWxlbWVudEtsYXNzKCk7XG4gICAgICAgIGNiICYmIGNiKClcbiAgICAgIH1cbiAgICB9LFxuICAgIGRyb3BFbGVtZW50TWV0aG9kOiBcImNvdmVyXCIsLy9yZXNpemVcbiAgICAvKipcbiAgICAgKiDQodC+0LfQtNCw0L3QuNC1INGN0LvQtdC80LXQvdGC0LAg0YTQvtGC0L5cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIHNldEVsZW1lbnRLbGFzczogZnVuY3Rpb24oZWwpe1xuICAgICAgaWYodGhpcy5lbGVtZW50ID09PSBlbClyZXR1cm47XG5cbiAgICAgIGlmKHRoaXMuZWxlbWVudCl7XG4gICAgICAgIHRoaXMuX3JlbW92ZV9lbGVtZW50KCk7XG4gICAgICAgIHRoaXMuZWxlbWVudC5kZXN0cnVjdG9yICYmIHRoaXMuZWxlbWVudC5kZXN0cnVjdG9yKCk7XG4gICAgICAgIHRoaXMucmVtb3ZlKHRoaXMuZWxlbWVudCk7XG4gICAgICAgIHRoaXMuY2FudmFzICYmIHRoaXMuY2FudmFzLnJlbW92ZSh0aGlzLmVsZW1lbnQpO1xuICAgICAgfVxuICAgICAgdGhpcy5lbGVtZW50ID0gZWw7XG5cbiAgICAgIGlmKGVsKXtcbiAgICAgICAgZWwub24oXCJkYmxjbGlja1wiLGZ1bmN0aW9uKGUpe1xuICAgICAgICAgIHRoaXMucGFyZW50LnRvZ2dsZUNsaXBNb2RlQnlDbGljayhlKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGVsLnNldHVwU3RhdGUoKTtcblxuICAgICAgICBpZih0aGlzLmRyb3BFbGVtZW50TWV0aG9kICA9PSBcInJlc2l6ZVwiKXtcbiAgICAgICAgICB0aGlzLmNsaXAgPSB7XG4gICAgICAgICAgICBsZWZ0OiAwLFxuICAgICAgICAgICAgdG9wOiAwLFxuICAgICAgICAgICAgc2NhbGVYOiAxLFxuICAgICAgICAgICAgc2NhbGVZOiAxXG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYodGhpcy5kcm9wRWxlbWVudE1ldGhvZCAgPT0gXCJjb3ZlclwiKXtcbiAgICAgICAgICB2YXIgc2l6ZSA9IGZhYnJpYy51dGlsLmdldFByb3BvcnRpb25zKGVsLHRoaXMsJ2NvdmVyJylcbiAgICAgICAgICB0aGlzLmNsaXAgPSB7XG4gICAgICAgICAgICBsZWZ0OiAwLFxuICAgICAgICAgICAgdG9wOiAwLFxuICAgICAgICAgICAgc2NhbGVYOiBzaXplLndpZHRoIC90aGlzLndpZHRoLFxuICAgICAgICAgICAgc2NhbGVZOiBzaXplLmhlaWdodCAvdGhpcy5oZWlnaHRcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBlbC5zZXQoe1xuICAgICAgICAgIGFjdGlvbnM6IHtcbiAgICAgICAgICAgIGNsaXBFbmQ6IHtcbiAgICAgICAgICAgICAgY2xhc3NOYW1lOiAgXCJmYSBmYS1jcm9wXCIsXG4gICAgICAgICAgICAgIHRpdGxlOiAgICAgIFwiY2xpcCBlbmRcIixcbiAgICAgICAgICAgICAgYWN0aW9uOiAgICAgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB0aGlzLnBhcmVudC5jbGlwUGhvdG9FbmQoKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgcGFyZW50OiB0aGlzLFxuICAgICAgICAgIG5vdFNlbGVjdGFibGVJblRoZUdyb3VwIDogdHJ1ZSxcbiAgICAgICAgICBvcmlnaW5YOiBcImNlbnRlclwiLFxuICAgICAgICAgIG9yaWdpblk6IFwiY2VudGVyXCIsXG4gICAgICAgICAgdHJhbnNwYXJlbnRDb3JuZXJzIDogZmFsc2UsXG4gICAgICAgICAgcmVzaXphYmxlOiB0cnVlLFxuICAgICAgICAgIGNsaXBUbzogdGhpcy5fZmFicmljX3NoYXBlXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuYWRkKGVsKTtcblxuICAgICAgICBmb3IodmFyIGkgaW4gdGhpcy5fZWxlbWVudHNfdG9fdXBkYXRlKXtcbiAgICAgICAgICB0aGlzLnJlbW92ZSh0aGlzLl9lbGVtZW50c190b191cGRhdGVbaV0uZWxlbWVudCk7XG4gICAgICAgICAgdGhpcy5hZGQodGhpcy5fZWxlbWVudHNfdG9fdXBkYXRlW2ldLmVsZW1lbnQpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3VwZGF0ZV9lbGVtZW50X3NpemUoKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5maXJlKFwiZWxlbWVudDptb2RpZmllZFwiLHtlbGVtZW50OiBlbH0pO1xuICAgICAgdGhpcy5jYW52YXMgJiYgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqINC+0LPRgNCw0L3QuNGH0LjQstCw0LXQvCDQv9C10YDQtdC80LXRidC10L3QuNC1INGE0L7RgtC+0LPRgNCw0YTQuNC4INCy0L3Rg9GC0YDQuCDRgNCw0LzQutC4XG4gICAgICogQHBhcmFtIGVsXG4gICAgICovXG4gICAgX2xpbWl0X21vdmluZzogZnVuY3Rpb24oZGF0YSl7XG5cbiAgICAgIHZhciByID0gdGhpcy5nZXRCb3VuZGluZ1JlY3QoKTtcbiAgICAgIHZhciBpICAgPSB0aGlzLmVsZW1lbnQ7XG4gICAgICBpLm9uKFwibW92aW5nXCIsIGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgYiA9IHtcbiAgICAgICAgICBsOiAgci5sZWZ0ICArIGkud2lkdGggKiBpLnNjYWxlWC8yLFxuICAgICAgICAgIHI6ICByLmxlZnQgKyByLndpZHRoIC0gaS53aWR0aCAqIGkuc2NhbGVYLzIsXG4gICAgICAgICAgdDogIHIudG9wICArIGkuaGVpZ2h0ICogaS5zY2FsZVkvMixcbiAgICAgICAgICBiOiAgci50b3AgICsgci5oZWlnaHQgLSBpLmhlaWdodCAqIGkuc2NhbGVZLzJcbiAgICAgICAgfTtcbiAgICAgICAgLy8gY2FwcGluZyBsb2dpYyBoZXJlXG4gICAgICAgIGkuc2V0TGVmdChNYXRoLm1heChNYXRoLm1pbihiLmwsIGkubGVmdCksYi5yKSk7XG4gICAgICAgIGkuc2V0VG9wKE1hdGgubWF4KE1hdGgubWluKGIudCwgaS50b3ApLGIuYikpO1xuICAgICAgfSk7XG5cbiAgICAgIGkub24oXCJzY2FsaW5nXCIsIGZ1bmN0aW9uKCkge1xuICAgICAgICBpLnNldCh7XG4gICAgICAgICAgd2lkdGg6IE1hdGgubWF4KHIud2lkdGgsIGkud2lkdGggKiBpLnNjYWxlWCksXG4gICAgICAgICAgaGVpZ2h0OiBNYXRoLm1heChyLmhlaWdodCxpLmhlaWdodCogaS5zY2FsZVkpLFxuICAgICAgICAgIHNjYWxlWCA6IDEsXG4gICAgICAgICAgc2NhbGVZOiAxXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHZhciBiID0ge1xuICAgICAgICAgIGw6ICByLmxlZnQgICsgaS53aWR0aCAqIGkuc2NhbGVYLzIsXG4gICAgICAgICAgcjogIHIubGVmdCArIHIud2lkdGggLSBpLndpZHRoICogaS5zY2FsZVgvMixcbiAgICAgICAgICB0OiAgci50b3AgICsgaS5oZWlnaHQgKiBpLnNjYWxlWS8yLFxuICAgICAgICAgIGIgOiByLnRvcCAgKyByLmhlaWdodCAtIGkuaGVpZ2h0ICogaS5zY2FsZVkvMlxuICAgICAgICB9O1xuICAgICAgICAvLy8vIGNhcHBpbmcgbG9naWMgaGVyZVxuICAgICAgICAvL2kuc2V0TGVmdChNYXRoLm1pbihNYXRoLm1heChiLmwsIGkubGVmdCksYi5yKSk7XG4gICAgICAgIC8vaS5zZXRUb3AoTWF0aC5taW4oTWF0aC5tYXgoYi50LCBpLnRvcCksYi5iKSk7XG4gICAgICB9KTtcbiAgICB9LFxuXG4gICAgX3NldF9wZW5kaW5nOiBmdW5jdGlvbih2YWwpe1xuICAgICAgdGhpcy5fcGVuZGluZyA9IHZhbDtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICog0KHQvtC30LTQsNC90LjQtSDRjdC70LXQvNC10L3RgtCwINGE0L7RgtC+XG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cbiAgICBfY3JlYXRlX3JlbW92ZV9idXR0b246IGZ1bmN0aW9uKG9wdGlvbnMpe1xuXG4gICAgICB0aGlzLmJ1dHRvbiA9IHRoaXMuX2NyZWF0ZV9idXR0b24oe1xuICAgICAgICB0ZXh0OiBcIu+AjVwiLFxuICAgICAgICBvcHRpb25zOiB7XG4gICAgICAgICAgdmlzaWJsZTogZmFsc2VcbiAgICAgICAgfSxcbiAgICAgICAgcG9zaXRpb246e1xuICAgICAgICAgIHRvcDogMCxcbiAgICAgICAgICByaWdodDogMFxuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgdGhpcy5idXR0b24ub24oJ2NsaWNrJywgZnVuY3Rpb24oZSl7XG4gICAgICAgIGlmKCF0aGlzLl9wZW5kaW5nKXtcbiAgICAgICAgICB0aGlzLnNldEVsZW1lbnQoZmFsc2UpO1xuICAgICAgICB9XG4gICAgICB9LmJpbmQodGhpcykpO1xuXG4gICAgfSxcbiAgICBfYWRkX2VsZW1lbnRfdG9fdXBkYXRlOiBmdW5jdGlvbihkYXRhKXtcbiAgICAgIHRoaXMuX2VsZW1lbnRzX3RvX3VwZGF0ZS5wdXNoKGRhdGEpO1xuXG4gICAgICBpZihkYXRhLnJpZ2h0ICE9PSB1bmRlZmluZWQpe1xuICAgICAgICBkYXRhLmVsZW1lbnQuc2V0T3JpZ2luWChcInJpZ2h0XCIpO1xuICAgICAgfVxuICAgICAgaWYoZGF0YS5sZWZ0ICE9PSB1bmRlZmluZWQpe1xuICAgICAgICBkYXRhLmVsZW1lbnQuc2V0T3JpZ2luWChcImxlZnRcIik7XG4gICAgICB9XG4gICAgICBpZihkYXRhLmJvdHRvbSAhPT0gdW5kZWZpbmVkKXtcbiAgICAgICAgZGF0YS5lbGVtZW50LnNldE9yaWdpblkoXCJib3R0b21cIik7XG4gICAgICB9XG4gICAgICBpZihkYXRhLnRvcCAhPT0gdW5kZWZpbmVkKXtcbiAgICAgICAgZGF0YS5lbGVtZW50LnNldE9yaWdpblkoXCJ0b3BcIik7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuX3VwZGF0ZV9pbnRlcmZhY2VfZWxlbWVudF9wb3NpdGlvbihkYXRhLmVsZW1lbnQsZGF0YSk7XG5cbiAgICB9LFxuICAgIHNldENsaXA6IGZ1bmN0aW9uKHZhbCl7XG4gICAgICB0aGlzLmNsaXAgPSB2YWw7XG4gICAgICB0aGlzLl91cGRhdGVfZWxlbWVudF9zaXplKCk7XG4gICAgfSxcbiAgICBfdXBkYXRlX2VsZW1lbnRfc2l6ZTogZnVuY3Rpb24oKXtcbiAgICAgIHRoaXMuX3VwZGF0ZV9lbGVtZW50X3dpZHRoKCk7XG4gICAgICB0aGlzLl91cGRhdGVfZWxlbWVudF9oZWlnaHQoKTtcbiAgICB9LFxuXG4gICAgX3VwZGF0ZV9lbGVtZW50X3dpZHRoOiBmdW5jdGlvbigpe1xuICAgICAgaWYodGhpcy5lbGVtZW50KXtcbiAgICAgICAgaWYodGhpcy5lbGVtZW50LnR5cGUgPT0gXCJlbGxpcHNlXCIpe1xuICAgICAgICAgIHRoaXMuZWxlbWVudC5zZXQoe1xuICAgICAgICAgICAgcng6IHRoaXMud2lkdGgvMiAqIHRoaXMuY2xpcC5zY2FsZVhcbiAgICAgICAgICB9KTtcbiAgICAgICAgfWVsc2UgaWYoIHRoaXMuZWxlbWVudC50eXBlID09XCJ2aWRlb1wiIHx8IHRoaXMuZWxlbWVudC50eXBlID09IFwicGF0aFwiKXtcblxuICAgICAgICAgIHRoaXMuZWxlbWVudC5zZXQoe1xuICAgICAgICAgICAgbGVmdDogMCxcbiAgICAgICAgICAgIHNjYWxlWDogdGhpcy53aWR0aCAvIHRoaXMuZWxlbWVudC53aWR0aFxuICAgICAgICAgIH0pO1xuICAgICAgICB9ZWxzZSB7XG4gICAgICAgICAgdGhpcy5lbGVtZW50LnNldFdpZHRoKHRoaXMud2lkdGggKiB0aGlzLmNsaXAuc2NhbGVYKVxuICAgICAgICAgIHRoaXMuZWxlbWVudC5zZXRMZWZ0KHRoaXMud2lkdGggKiB0aGlzLmNsaXAubGVmdCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuICAgIF91cGRhdGVfZWxlbWVudF9oZWlnaHQ6IGZ1bmN0aW9uKCl7XG4gICAgICBpZih0aGlzLmVsZW1lbnQpe1xuXG4gICAgICAgIGlmKHRoaXMuZWxlbWVudC50eXBlID09IFwiZWxsaXBzZVwiKXtcbiAgICAgICAgICB0aGlzLmVsZW1lbnQuc2V0KHtcbiAgICAgICAgICAgIHJ5OiAgICAgdGhpcy5oZWlnaHQvMiAqIHRoaXMuY2xpcC5zY2FsZVlcbiAgICAgICAgICB9KTtcbiAgICAgICAgfWVsc2UgaWYoIHRoaXMuZWxlbWVudC50eXBlID09XCJ2aWRlb1wiIHx8IHRoaXMuZWxlbWVudC50eXBlID09IFwicGF0aFwiKXtcblxuICAgICAgICAgIHRoaXMuZWxlbWVudC5zZXQoe1xuICAgICAgICAgICAgdG9wOiAwLFxuICAgICAgICAgICAgc2NhbGVZOiB0aGlzLmhlaWdodCAvIHRoaXMuZWxlbWVudC5oZWlnaHRcbiAgICAgICAgICB9KTtcbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgdGhpcy5lbGVtZW50LnNldEhlaWdodCh0aGlzLmhlaWdodCAqIHRoaXMuY2xpcC5zY2FsZVkpXG4gICAgICAgICAgdGhpcy5lbGVtZW50LnNldFRvcCggdGhpcy5oZWlnaHQgKiB0aGlzLmNsaXAudG9wKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG4gICAgX3VwZGF0ZV9pbnRlcmZhY2VfZWxlbWVudF9wb3NpdGlvbjogZnVuY3Rpb24oZWwsZGF0YSwgcHJvcCl7XG4gICAgICBpZighcHJvcCB8fCBwcm9wID09IFwiaGVpZ2h0XCIpe1xuICAgICAgICBpZiAoZGF0YS50b3AgIT09IHVuZGVmaW5lZCAmJiBkYXRhLmJvdHRvbSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgZWwuc2V0VG9wKC10aGlzLmhlaWdodCAvIDIgKyBkYXRhLnRvcCk7XG4gICAgICAgICAgZWwuc2V0SGVpZ2h0KHRoaXMuaGVpZ2h0IC0gZGF0YS50b3AgLSBkYXRhLmJvdHRvbSk7XG4gICAgICAgIH1pZiAoZGF0YS50b3AgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIGVsLnNldFRvcCgtdGhpcy5oZWlnaHQgLyAyICsgZGF0YS50b3ApO1xuICAgICAgICB9IGVsc2UgaWYgKGRhdGEuYm90dG9tICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBlbC5zZXRUb3AodGhpcy5oZWlnaHQgLyAyIC0gZGF0YS5ib3R0b20pO1xuICAgICAgICB9ZWxzZSBpZiAoZGF0YS5oZWlnaHQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIGVsLnNldEhlaWdodChkYXRhLmhlaWdodCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmKCFwcm9wIHx8IHByb3AgPT0gXCJ3aWR0aFwiKSB7XG4gICAgICAgIGlmIChkYXRhLnJpZ2h0ICE9PSB1bmRlZmluZWQgJiYgZGF0YS5sZWZ0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBlbC5zZXRMZWZ0KC10aGlzLndpZHRoIC8gMiArIGRhdGEubGVmdCk7XG4gICAgICAgICAgZWwuc2V0V2lkdGgodGhpcy53aWR0aCAtIGRhdGEubGVmdCAtIGRhdGEucmlnaHQpO1xuXG4gICAgICAgIH1lbHNlIGlmIChkYXRhLnJpZ2h0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBlbC5zZXRMZWZ0KHRoaXMud2lkdGggLyAyIC0gZGF0YS5yaWdodCk7XG4gICAgICAgIH1lbHNlIGlmIChkYXRhLmxlZnQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIGVsLnNldExlZnQoLXRoaXMud2lkdGggLyAyICsgZGF0YS5sZWZ0KTtcbiAgICAgICAgfWVsc2UgaWYgKGRhdGEud2lkdGggIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIGVsLnNldFdpZHRoKGRhdGEud2lkdGgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBlbC5zZXRDb29yZHMoKTtcbiAgICB9LFxuXG5cblxuICAgIHNldEhlaWdodDogZnVuY3Rpb24oaCl7XG4gICAgICB0aGlzLnNldChcImhlaWdodFwiLGgpO1xuICAgICAgZm9yKHZhciBpIGluIHRoaXMuX2VsZW1lbnRzX3RvX3VwZGF0ZSkge1xuICAgICAgICB2YXIgZGF0YSA9IHRoaXMuX2VsZW1lbnRzX3RvX3VwZGF0ZVtpXTtcbiAgICAgICAgdGhpcy5fdXBkYXRlX2ludGVyZmFjZV9lbGVtZW50X3Bvc2l0aW9uKGRhdGEuZWxlbWVudCxkYXRhLFwiaGVpZ2h0XCIpO1xuICAgICAgfVxuICAgICAgdGhpcy5fdXBkYXRlX2VsZW1lbnRfaGVpZ2h0KCk7XG4gICAgICB0aGlzLl9hcHBseV9zaGFwZSgpO1xuICAgIH0sXG4gICAgc2V0V2lkdGg6IGZ1bmN0aW9uKHcpe1xuICAgICAgdGhpcy5zZXQoXCJ3aWR0aFwiLHcpO1xuICAgICAgZm9yKHZhciBpIGluIHRoaXMuX2VsZW1lbnRzX3RvX3VwZGF0ZSl7XG4gICAgICAgIHZhciBkYXRhID0gdGhpcy5fZWxlbWVudHNfdG9fdXBkYXRlW2ldO1xuICAgICAgICB0aGlzLl91cGRhdGVfaW50ZXJmYWNlX2VsZW1lbnRfcG9zaXRpb24oZGF0YS5lbGVtZW50LGRhdGEsXCJ3aWR0aFwiKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuX3VwZGF0ZV9lbGVtZW50X3dpZHRoKCk7XG4gICAgICB0aGlzLl9hcHBseV9zaGFwZSgpO1xuICAgIH0sXG4gICAgdG9PYmplY3Q6IGZ1bmN0aW9uKHByb3BlcnRpZXNUb0luY2x1ZGUpe1xuICAgICAgcHJvcGVydGllc1RvSW5jbHVkZSA9IFtcImNsaXBcIixcImRhdGFcIl0uY29uY2F0KHByb3BlcnRpZXNUb0luY2x1ZGUpO1xuXG4gICAgICB2YXIgb2JqZWN0ID0gdGhpcy5jYWxsU3VwZXIoJ3RvT2JqZWN0JywgcHJvcGVydGllc1RvSW5jbHVkZSk7XG5cblxuICAgICAgaWYodGhpcy5zaGFwZSl7XG4gICAgICAgIG9iamVjdC5zaGFwZSA9IF8uY2xvbmUodGhpcy5zaGFwZSk7XG4gICAgICAgIGlmKG9iamVjdC5zaGFwZS5zcmMpe1xuICAgICAgICAgIGRlbGV0ZSBvYmplY3Quc2hhcGUucGF0aHM7XG4gICAgICAgICAgZGVsZXRlIG9iamVjdC5zaGFwZS5oZWlnaHQ7XG4gICAgICAgICAgZGVsZXRlIG9iamVjdC5zaGFwZS53aWR0aDtcbiAgICAgICAgICBkZWxldGUgb2JqZWN0LnNoYXBlLnN2Z1VpZDtcbiAgICAgICAgICBkZWxldGUgb2JqZWN0LnNoYXBlLnRvQmVQYXJzZWQ7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgZGVsZXRlIG9iamVjdC5vYmplY3RzO1xuXG4gICAgICBpZih0aGlzLmVsZW1lbnQpe1xuICAgICAgICB2YXIgX29iajIgPSB0aGlzLmVsZW1lbnQudG9PYmplY3QoKTtcbiAgICAgICAgb2JqZWN0LmVsZW1lbnQgPSB7XG4gICAgICAgICAgdHlwZTogX29iajIudHlwZSxcbiAgICAgICAgICBzcmM6IF9vYmoyLnNyY1xuICAgICAgICB9XG5cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIG9iamVjdDtcbiAgICB9XG4gIH0pO1xuXG4gIHZhciBfRlJBID0gZmFicmljLkZyYW1lLnByb3RvdHlwZTtcbiAgZmFicmljLkZyYW1lLnByb3RvdHlwZS5hY3Rpb25zID0gZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCh7fSwgZmFicmljLk9iamVjdC5wcm90b3R5cGUuYWN0aW9ucywge1xuXG4gICAgICBjbGVhcjoge1xuICAgICAgICBpbnNlcnQ6ICAgICBcImNvbnRlbnRUb29sc1wiLFxuICAgICAgICB0aXRsZTogICAgICBcIlJlbW92ZSBjb250ZW50XCIsXG4gICAgICAgIGNsYXNzTmFtZTogIFwiZmEgZmEtdGltZXNcIixcbiAgICAgICAgYWN0aW9uOiAgICAgX0ZSQS5zZXRFbGVtZW50LFxuICAgICAgICB2aXNpYmxlOiAgICBcImVsZW1lbnRcIixcbiAgICAgICAgb2JzZXJ2ZTogICAgXCJlbGVtZW50Om1vZGlmaWVkXCJcbiAgICAgIH0sXG4gICAgICBwaG90b0NsaXA6IHtcbiAgICAgICAgdGl0bGU6ICAgICAgXCLQvtCx0YDQtdC30LDRgtGMXCIsXG4gICAgICAgIGNsYXNzTmFtZTogIFwiZmEgZmEtY3JvcFwiLFxuICAgICAgICBhY3Rpb246ICAgICBfRlJBLmNsaXBQaG90b1N0YXJ0LFxuICAgICAgICB2aXNpYmxlOiAgICBfRlJBLmNsaXBwaW5nQXZhaWxhYmxlLFxuICAgICAgICBvYnNlcnZlOiAgXCJjbGlwcGluZzplbnRlcmVkIGNsaXBwaW5nOmV4aXRlZCBlbGVtZW50Om1vZGlmaWVkXCJcbiAgICAgIH1cbiAgICB9XG4gICk7XG5cblxuICBmYWJyaWMuRnJhbWUuZnJvbU9iamVjdCA9IGZ1bmN0aW9uKG9iamVjdCxjYWxsYmFjaykge1xuXG4gICAgb2JqZWN0ID0gZmFicmljLnV0aWwub2JqZWN0LmNsb25lRGVlcChvYmplY3QpO1xuXG5cbiAgICB2YXIgY2IgPSBmYWJyaWMudXRpbC5xdWV1ZUxvYWQoMixmdW5jdGlvbigpe1xuICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2sobmV3IGZhYnJpYy5GcmFtZShvYmplY3QpKTtcbiAgICB9KTtcblxuXG5cbiAgICBpZihvYmplY3QuZWxlbWVudCl7XG4gICAgICBmYWJyaWMudXRpbC5jcmVhdGVPYmplY3Qob2JqZWN0LmVsZW1lbnQsZnVuY3Rpb24oZWwpe1xuICAgICAgICBvYmplY3QuZWxlbWVudCA9IGVsO1xuICAgICAgICBjYigpO1xuICAgICAgfSk7XG4gICAgfWVsc2V7XG4gICAgICBjYigpO1xuICAgIH1cblxuICAgIGlmKG9iamVjdC5zaGFwZSAmJiBvYmplY3Quc2hhcGUuc3JjKXtcbiAgICAgIGZhYnJpYy5sb2FkU1ZHRnJvbVVSTChvYmplY3Quc2hhcGUuc3JjLGZ1bmN0aW9uKHBhdGhzLG9wdGlvbnMpIHtcbiAgICAgICAgb2JqZWN0LnNoYXBlLnBhdGhzICA9IHBhdGhzO1xuICAgICAgICBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKG9iamVjdC5zaGFwZSxvcHRpb25zKTtcbiAgICAgICAgY2IoKTtcbiAgICAgIH0pXG4gICAgfWVsc2Uge1xuICAgICAgY2IoKTtcbiAgICB9XG5cblxuXG4gIH07XG4gIGZhYnJpYy5GcmFtZS5hc3luYyA9IHRydWU7XG5cbiAgZmFicmljLnV0aWwuY3JlYXRlQWNjZXNzb3JzKGZhYnJpYy5GcmFtZSk7XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL29iamVjdHMvRnJhbWUuanNcbi8vIG1vZHVsZSBpZCA9IDkwXG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIid1c2Ugc3RyaWN0JztcblxuXG4vKipcbiAqIE1hc2tSZWN0YW5nbCBrZWVwIHNlbGVjdGlvbiBkYXRhLCBtb25vY2hyb21lIG1hc2sgYW5kIHV0aWxpdHkgZnVuY3Rpb24gdG8gZWRpdCBtYXNrIGRhdGEuXG4gKiBAY2xhc3MgZmFicmljLk1hc2tSZWN0YW5nbGVcbiAqIEBleHRlbmRzIGZhYnJpYy5SZWN0XG4gKi9cbmZhYnJpYy5NYXNrUmVjdGFuZ2xlID0gZmFicmljLnV0aWwuY3JlYXRlQ2xhc3MoZmFicmljLlJlY3QsZmFicmljLlNoYXBlTWl4aW4sIHtcbiAgdHlwZTogXCJtYXNrLXJlY3RhbmdsZVwiLFxuICByZXNpemFibGU6IHRydWUsXG4gIG1vZGU6ICdvcmlnaW5hbCcsXG4gIGZpbGw6IFwid2hpdGVcIixcbiAgdGh1bWJFbGVtZW50OiBudWxsLFxuICBldmVudExpc3RlbmVyczogZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZEFycmF5c09iamVjdChmYWJyaWMuUmVjdC5wcm90b3R5cGUuZXZlbnRMaXN0ZW5lcnMse1xuICAgICdhZGRlZCBtb3Zpbmcgcm90YXRpbmcgc2NhbGluZyBtb2RpZmllZCc6IGZ1bmN0aW9uKCl7XG4gICAgICB0aGlzLnVwZGF0ZSgpO1xuICAgIH1cbiAgfSksXG4gIC8vIGluaXRpYWxpemU6IGZ1bmN0aW9uIChvcHRpb25zLGNhbGxiYWNrKSB7XG4gIC8vICAgLy8gdGhpcy5sb2FkZWQgPSBmYWxzZTtcbiAgLy8gICB0aGlzLmNhbGxTdXBlcignaW5pdGlhbGl6ZScsIG9wdGlvbnMsY2FsbGJhY2spO1xuICAvLyAgIC8vIHRoaXMuc2V0T3JpZ2luYWwob3B0aW9ucy5pbWFnZSk7XG4gIC8vICAgLy8gdGhpcy5zZXRNYXNrKG9wdGlvbnMubWFzayk7XG4gIC8vICAgLy8gdGhpcy5vbignYWRkZWQgbW92aW5nIHJvdGF0aW5nIHNjYWxpbmcgbW9kaWZpZWQnLCB0aGlzLnVwZGF0ZS5iaW5kKHRoaXMpKTtcbiAgLy8gICAvLyBpZighdGhpcy5fbWFza19sb2FkaW5nICYmICF0aGlzLl9vcmlnaW5hbF9sb2FkaW5nKXtcbiAgLy8gICAvLyAgIHRoaXMubG9hZGVkID0gdHJ1ZTtcbiAgLy8gICAvLyB9XG4gIC8vIH0sXG4gIHNldF9vcmlnaW5hbF9pbWFnZTogZnVuY3Rpb24gKGltYWdlLCBjYikge1xuICAgIGlmKCF0aGlzLndpZHRoKXRoaXMud2lkdGggPSBpbWFnZS53aWR0aDtcbiAgICBpZighdGhpcy5oZWlnaHQpdGhpcy5oZWlnaHQgPSBpbWFnZS5oZWlnaHQ7XG4gICAgdGhpcy5fb3JpZ2luYWxFbGVtZW50ID0gdGhpcy5fZWxlbWVudCA9IGltYWdlIHx8IGZhYnJpYy51dGlsLmNyZWF0ZUNhbnZhc0VsZW1lbnQoKTtcbiAgICB0aGlzLmNhbnZhcyAmJiB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICBjYiAmJiBjYigpXG4gIH0sXG4gIHNldEltYWdlOiBmdW5jdGlvbiAoaW1hZ2UsIGNiKSB7XG4gICAgaWYoIWltYWdlKXtcbiAgICAgIGNiICYmIGNiKCk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgaWYodHlwZW9mIGltYWdlID09IFwic3RyaW5nXCIpe1xuICAgICAgdGhpcy5fb3JpZ2luYWxfbG9hZGluZyA9IHRydWU7XG4gICAgICBmYWJyaWMudXRpbC5sb2FkSW1hZ2UoaW1hZ2UsZnVuY3Rpb24oZWwpe1xuICAgICAgICB0aGlzLnNldF9vcmlnaW5hbF9pbWFnZShlbCxjYik7XG4gICAgICB9LmJpbmQodGhpcykpO1xuICAgIH1lbHNle1xuICAgICAgdGhpcy5zZXRfb3JpZ2luYWxfaW1hZ2UoaW1hZ2UsY2IpO1xuICAgIH1cbiAgfSxcbiAgY29udmVydE1hc2s6IGZhbHNlLFxuICBfc2V0X21hc2tfaW1hZ2U6IGZ1bmN0aW9uIChtYXNrLGNiKSB7XG4gICAgaWYgKG1hc2sgJiYgbWFzayBpbnN0YW5jZW9mIEhUTUxDYW52YXNFbGVtZW50KSB7XG4gICAgICB0aGlzLm1hc2tFbGVtZW50ID0gbWFzaztcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5tYXNrRWxlbWVudCA9IGZhYnJpYy51dGlsLmNyZWF0ZUNhbnZhc0VsZW1lbnQoKTtcbiAgICAgIGlmKCF0aGlzLndpZHRoKXRoaXMud2lkdGggPSBtYXNrLndpZHRoO1xuICAgICAgaWYoIXRoaXMuaGVpZ2h0KXRoaXMuaGVpZ2h0ID0gbWFzay5oZWlnaHQ7XG5cbiAgICAgIHRoaXMubWFza0VsZW1lbnQud2lkdGggPSBtYXNrICYmIG1hc2sud2lkdGggfHwgMCA7XG4gICAgICB0aGlzLm1hc2tFbGVtZW50LmhlaWdodCA9IG1hc2sgJiYgbWFzay5oZWlnaHQgfHwgMDtcbiAgICB9XG4gICAgdmFyIGN0eCA9IHRoaXMuc2VsZWN0aW9uQ29udGV4dCA9IHRoaXMubWFza0VsZW1lbnQuZ2V0Q29udGV4dCgnMmQnKTtcblxuICAgIGlmIChtYXNrICYmIG1hc2sgaW5zdGFuY2VvZiBIVE1MSW1hZ2VFbGVtZW50KSB7XG4gICAgICBjdHguZHJhd0ltYWdlKG1hc2ssIDAsIDApO1xuICAgIH1cblxuICAgIGlmKHRoaXMuY29udmVydE1hc2spe1xuICAgICAgdGhpcy5jb252ZXJ0TWFzayA9IGZhbHNlO1xuICAgICAgdmFyIHdvcmtlciA9IGZhYnJpYy51dGlsLndvcmtlcih0aGlzLm1ha2VUcmFuc3BhcmVudE1hc2tXb3JrZXIpO1xuICAgICAgd29ya2VyLm9ubWVzc2FnZSA9IGZ1bmN0aW9uKGUpe1xuICAgICAgICBjdHgucHV0SW1hZ2VEYXRhKGUuZGF0YSwgMCwgMCk7XG4gICAgICAgIGNiICYmIGNiKCk7XG4gICAgICB9XG4gICAgICB3b3JrZXIucG9zdE1lc3NhZ2Uoe1xuICAgICAgICBpbWFnZURhdGE6IGN0eC5nZXRJbWFnZURhdGEoMCwgMCwgbWFzay53aWR0aCwgbWFzay5oZWlnaHQpLFxuICAgICAgICB0cmFuc3BhcmVuY3lDb25zdGFudDogdGhpcy50cmFuc3BhcmVuY3lDb25zdGFudFxuICAgICAgfSk7XG4gICAgfWVsc2V7XG4gICAgICBjYiAmJiBjYigpO1xuICAgIH1cbiAgfSxcbiAgZ3JleVZhbHVlOiAwLFxuICBzd2l0Y2hNYXNrQmFja2dyb3VuZDogZnVuY3Rpb24oKXtcbiAgICB0aGlzLmdyZXlWYWx1ZSA9IHRoaXMuZ3JleVZhbHVlID8gMCA6IDI1NTtcbiAgICB2YXIgd29ya2VyID0gZmFicmljLnV0aWwud29ya2VyKHRoaXMuc3dpdGNoTWFza0JhY2tncm91bmRXb3JrZXIpO1xuICAgIHdvcmtlci5vbm1lc3NhZ2UgPSBmdW5jdGlvbihlKXtcbiAgICAgIHRoaXMuc2VsZWN0aW9uQ29udGV4dC5wdXRJbWFnZURhdGEoZS5kYXRhLCAwLCAwKTtcbiAgICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgIH0uYmluZCh0aGlzKTtcbiAgICB2YXIgX2ltZ0RhdGEgPSB0aGlzLnNlbGVjdGlvbkNvbnRleHQuZ2V0SW1hZ2VEYXRhKDAsIDAsIHRoaXMubWFza0VsZW1lbnQud2lkdGgsIHRoaXMubWFza0VsZW1lbnQuaGVpZ2h0KTtcbiAgICB3b3JrZXIucG9zdE1lc3NhZ2Uoe2RhdGE6IF9pbWdEYXRhLCBjb2xvciA6IHRoaXMuZ3JleVZhbHVlIH0pO1xuICB9LFxuICBzd2l0Y2hNYXNrQmFja2dyb3VuZFdvcmtlcjogZnVuY3Rpb24oZSxwb3N0TWVzc2FnZSl7XG4gICAgdmFyIF9kYXRhID0gZS5kYXRhLmRhdGE7XG4gICAgdmFyIF9jb2xvciA9IGUuZGF0YS5jb2xvcjtcbiAgICBmb3IgKHZhciB4ID0gMDsgeCA8IF9kYXRhLndpZHRoOyB4KyspIHtcbiAgICAgIGZvciAodmFyIHkgPSAwOyB5IDwgX2RhdGEuaGVpZ2h0OyB5KyspIHtcbiAgICAgICAgdmFyIGkgPSAoeCArIHkgKiBfZGF0YS53aWR0aCApICogNDtcbiAgICAgICAgaWYgKF9kYXRhLmRhdGFbaSArIDNdICkge1xuICAgICAgICAgIF9kYXRhLmRhdGFbaV0gPSBfY29sb3I7XG4gICAgICAgICAgX2RhdGEuZGF0YVtpICsgMV0gPSBfY29sb3I7XG4gICAgICAgICAgX2RhdGEuZGF0YVtpICsgMl0gPSBfY29sb3I7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcG9zdE1lc3NhZ2UoX2RhdGEpO1xuICB9LFxuICB0cmFuc3BhcmVuY3lDb25zdGFudDogNTAsXG4gIG1ha2VUcmFuc3BhcmVudE1hc2tXb3JrZXI6ZnVuY3Rpb24oZSxwb3N0TWVzc2FnZSl7XG4gICAgdmFyIF9kYXRhID0gZS5kYXRhLmltYWdlRGF0YTtcbiAgICBmb3IgKHZhciB4ID0gMDsgeCA8IF9kYXRhLndpZHRoOyB4KyspIHtcbiAgICAgIGZvciAodmFyIHkgPSAwOyB5IDwgX2RhdGEuaGVpZ2h0OyB5KyspIHtcbiAgICAgICAgdmFyIGkgPSAoeCArIHkgKiBfZGF0YS53aWR0aCApICogNDtcbiAgICAgICAgaWYgKF9kYXRhLmRhdGFbaV0gPiBlLmRhdGEudHJhbnNwYXJlbmN5Q29uc3RhbnQgfHwgX2RhdGEuZGF0YVtpICsgMV0gPiBlLmRhdGEudHJhbnNwYXJlbmN5Q29uc3RhbnQgfHwgX2RhdGEuZGF0YVtpICsgMl0gPiBlLmRhdGEudHJhbnNwYXJlbmN5Q29uc3RhbnQpIHtcbiAgICAgICAgICBfZGF0YS5kYXRhW2ldID0gMjU1O1xuICAgICAgICAgIF9kYXRhLmRhdGFbaSArIDFdID0gMjU1O1xuICAgICAgICAgIF9kYXRhLmRhdGFbaSArIDJdID0gMjU1O1xuICAgICAgICAgIF9kYXRhLmRhdGFbaSArIDNdID0gMDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBfZGF0YS5kYXRhW2ldID0gMDtcbiAgICAgICAgICBfZGF0YS5kYXRhW2kgKyAxXSA9IDA7XG4gICAgICAgICAgX2RhdGEuZGF0YVtpICsgMl0gPSAwO1xuICAgICAgICAgIF9kYXRhLmRhdGFbaSArIDNdID0gMjU1O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHBvc3RNZXNzYWdlKF9kYXRhKTtcbiAgfSxcbiAgLyoqXG4gICAqIHNldCBtYXNrIGVsZW1lbnQgYW5kIGFwcGx5IG9wYWNpdHkgdXNpbmcgd29ya2Vyc1xuICAgKiBAcGFyYW0gbWFza1xuICAgKi9cbiAgc2V0TWFzazogZnVuY3Rpb24gKG1hc2ssY2IpIHtcbiAgICBpZighbWFzayl7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmKHR5cGVvZiBtYXNrID09IFwic3RyaW5nXCIpe1xuICAgICAgdGhpcy5fbWFza19sb2FkaW5nID0gdHJ1ZTtcbiAgICAgIGZhYnJpYy51dGlsLmxvYWRJbWFnZShtYXNrLGZ1bmN0aW9uKGVsKXtcbiAgICAgICAgdGhpcy5fc2V0X21hc2tfaW1hZ2UoZWwsY2IpO1xuICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICB9ZWxzZXtcbiAgICAgIHRoaXMuX3NldF9tYXNrX2ltYWdlKG1hc2ssY2IpO1xuICAgIH1cbiAgfSxcbiAgX3NlbGVjdF9pbm5lcjogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMucGF0aGZpbmRlci5zbWFydFNlbGVjdGlvbigpO1xuICAgIHRoaXMuY2FudmFzLmZyZWVEcmF3aW5nQnJ1c2guZW5hYmxlKCk7XG4gIH0sXG4gIHNlbGVjdElubmVyOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5fc2VsZWN0X2lubmVyKCk7XG4gICAgdGhpcy5yZW5kZXJNb25vY2hyb21lKCk7XG4gICAgdGhpcy5jYW52YXMuZnJlZURyYXdpbmdCcnVzaC5lbmFibGUoKTtcbiAgfSxcbiAgX3JlbmRlclNlbGVjdGlvbjogZnVuY3Rpb24gKCkge1xuICAgIHZhciBjdHggPSB0aGlzLmNhbnZhcy5jb250ZXh0VG9wLFxuICAgICAgdiA9IHRoaXMuY2FudmFzLnZpZXdwb3J0VHJhbnNmb3JtO1xuICAgIHRoaXMuY2FudmFzLmNsZWFyQ29udGV4dCh0aGlzLmNhbnZhcy5jb250ZXh0VG9wKTtcbiAgICB2YXIgem9vbSA9IHRoaXMuY2FudmFzLmdldFpvb20oKTtcbiAgICBjdHguc2F2ZSgpO1xuICAgIGN0eC50cmFuc2xhdGUodGhpcy5sZWZ0ICogem9vbSwgdGhpcy50b3AgKiB6b29tKTtcbiAgICBjdHgudHJhbnNmb3JtKHZbMF0sIHZbMV0sIHZbMl0sIHZbM10sIHZbNF0sIHZbNV0pO1xuICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICBpZiAodGhpcy5tYXNrKSB7XG4gICAgICBjdHguZHJhd0ltYWdlKHRoaXMubWFza0VsZW1lbnQsIDAsIDApO1xuICAgIH1cbiAgICBjdHgucmVzdG9yZSgpO1xuICB9LFxuICBtYXNrT3BhY2l0eTogMSxcbiAgcmVuZGVyTWFzazogZnVuY3Rpb24gKCkge1xuICAgIHZhciBjdHggPSB0aGlzLmFwZXJ0dXJlQ29udGV4dDtcbiAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgY3R4LnJlY3QoMCwgMCwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpO1xuICAgIGN0eC5maWxsU3R5bGUgPSAnYmxhY2snO1xuICAgIGN0eC5maWxsKCk7XG4gICAgY3R4LnNhdmUoKTtcbiAgICB0aGlzLnBhdGhmaW5kZXIucmVuZGVyTWFzayh0aGlzLmFwZXJ0dXJlQ29udGV4dCwgdGhpcy5tYXNrKTtcbiAgfSxcbiAgcmVuZGVyTW9ub2Nocm9tZTogZnVuY3Rpb24gKCkge1xuICAgIGlmICh0aGlzLnBhdGhmaW5kZXIuc2hvdWxkTW9kaWZ5KSB7XG4gICAgICB0aGlzLnBhdGhmaW5kZXIubW9kaWZ5U2VsZWN0aW9uKCk7XG4gICAgfVxuICAgIHRoaXMucmVuZGVyTWFzaygpO1xuICB9LFxuICBhbGxvd0RyYXdpbmc6IGZhbHNlLFxuICBjYW5jZWxNb2RhbDogZnVuY3Rpb24gKCkge1xuICAgIGlmICh0aGlzLnBhdGhmaW5kZXIuc2hvdWxkTW9kaWZ5KSB7XG4gICAgICB0aGlzLnBhdGhmaW5kZXIubW9kaWZ5U2VsZWN0aW9uKCk7XG4gICAgfVxuICAgIGRlbGV0ZSB0aGlzLnBhdGhmaW5kZXIubWFzaztcbiAgICBkZWxldGUgdGhpcy5wYXRoZmluZGVyLm9sZE1hc2s7XG4gICAgLy90aGlzLm1hc2sgPSBmYWJyaWMudXRpbC5vYmplY3QuY2xvbmVEZWVwKHRoaXMucGF0aGZpbmRlci5tYXNrKTtcbiAgICB0aGlzLnN0cm9rZVdpZHRoID0gMTtcbiAgICB0aGlzLmZpbGwgPSB0aGlzLmluYWN0aXZlT3B0aW9ucy5maWxsO1xuICAgIHRoaXMuYWxsb3dEcmF3aW5nID0gZmFsc2U7XG4gICAgdGhpcy5sb2NrTW92ZW1lbnRYID0gZmFsc2U7XG4gICAgdGhpcy5sb2NrTW92ZW1lbnRZID0gZmFsc2U7XG4gICAgaWYgKHRoaXMubW9kZSA9PT0gJ29yaWdpbmFsJykge1xuICAgICAgdGhpcy5tb2RlID0gJ25vbmUnO1xuICAgIH1cbiAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgfSxcbiAgZWRpdE1vZGFsOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy51cGRhdGUoKTtcblxuICAgIHZhciBfY2FudmFzID0gdGhpcy5jYW52YXM7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBfY2FudmFzLl9vYmplY3RzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBfY2FudmFzLl9vYmplY3RzW2ldLnNldFZpc2libGUoZmFsc2UpO1xuICAgIH1cbiAgICB0aGlzLnNldFZpc2libGUodHJ1ZSk7XG4gICAgLy9fY2FudmFzLmRlYWN0aXZhdGVBbGwoKTtcbiAgICBfY2FudmFzLmJhY2tncm91bmRJbWFnZS5zZXRPcGFjaXR5KDAuMSk7XG4gICAgdGhpcy5zdHJva2VXaWR0aCA9IDA7XG4gICAgaWYgKHRoaXMubW9kZSA9PT0gJ25vbmUnKSB7XG4gICAgICB0aGlzLm1vZGUgPSAnb3JpZ2luYWwnO1xuICAgIH1cbiAgICBfY2FudmFzLnJlbmRlckFsbCgpO1xuXG4gICAgd2luZG93LnJlY3QgPSB0aGlzO1xuICAgIHdpbmRvdy5fY2FudmFzID0gX2NhbnZhcztcblxuICAgIHRoaXMubG9ja01vdmVtZW50WCA9IHRydWU7XG4gICAgdGhpcy5sb2NrTW92ZW1lbnRZID0gdHJ1ZTtcbiAgICB0aGlzLmFsbG93RHJhd2luZyA9IHRydWU7XG4gICAgdGhpcy5jYW52YXMuZnJlZURyYXdpbmdCcnVzaCA9IHRoaXMuY2FudmFzLnBhdGhmaW5kZXJCcnVzaDtcblxuICAgIHZhciBzaXplID0ge1xuICAgICAgd2lkdGg6IGNhbnZhcy53aWR0aCAqIDAuOSxcbiAgICAgIGhlaWdodDogY2FudmFzLmhlaWdodCAqIDAuOVxuICAgIH07XG5cbiAgICB2YXIgcHIgPSBmYWJyaWMudXRpbC5nZXRQcm9wb3J0aW9ucyh0aGlzLCBzaXplLCAnZml0Jyk7XG4gICAgX2NhbnZhcy52aWV3cG9ydFRyYW5zZm9ybSA9IFtwci5zY2FsZSwgMCwgMCwgcHIuc2NhbGUsXG4gICAgICAoX2NhbnZhcy53aWR0aCAtIHByLndpZHRoICkgLyAyIC0gdGhpcy5sZWZ0ICogcHIuc2NhbGUsXG4gICAgICAoX2NhbnZhcy5oZWlnaHQgLSBwci5oZWlnaHQpIC8gMiAtIHRoaXMudG9wICogcHIuc2NhbGVcbiAgICBdO1xuXG4gICAgdGhpcy5zZXRDb29yZHMoKTtcbiAgICBfY2FudmFzLnJlbmRlckFsbCgpO1xuICB9LFxuICB1cGRhdGU6IGZ1bmN0aW9uICgpIHtcblxuICAgIGlmICh0aGlzLnRodW1iRWxlbWVudCkge1xuICAgICAgdGhpcy50aHVtYkVsZW1lbnQud2lkdGggPSB0aGlzLndpZHRoO1xuICAgICAgdGhpcy50aHVtYkVsZW1lbnQuaGVpZ2h0ID0gdGhpcy5oZWlnaHQ7XG4gICAgICB0aGlzLnJlbmRlclRodW1iKHRoaXMudGh1bWJFbGVtZW50KTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5jYW52YXMucGF0aGZpbmRlcikge1xuICAgICAgdGhpcy5tYXNrRWxlbWVudC53aWR0aCA9IHRoaXMud2lkdGg7XG4gICAgICB0aGlzLm1hc2tFbGVtZW50LmhlaWdodCA9IHRoaXMuaGVpZ2h0O1xuICAgICAgLy8gdGhpcy5hcGVydHVyZUVsZW1lbnQud2lkdGggPSB0aGlzLndpZHRoO1xuICAgICAgLy8gdGhpcy5hcGVydHVyZUVsZW1lbnQuaGVpZ2h0ID0gdGhpcy5oZWlnaHQ7XG4gICAgICBpZiAoIXRoaXMucGF0aGZpbmRlcikge1xuXG4gICAgICAgIHRoaXMucGF0aGZpbmRlciA9IHRoaXMuY2FudmFzLnBhdGhmaW5kZXI7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMucGF0aGZpbmRlci5vbihcInNlbGVjdGlvbjpjaGFuZ2VkXCIsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgIGlmIChldmVudC50YXJnZXQgPT0gX3RoaXMpIHtcbiAgICAgICAgICAgIF90aGlzLm1hc2sgPSBldmVudC5tYXNrO1xuICAgICAgICAgICAgX3RoaXMuZmlyZShcInNlbGVjdGlvbjpjaGFuZ2VkXCIsIGV2ZW50KTtcbiAgICAgICAgICAgIC8vdG9kbyBtYXkgaW5mbHVlbmNlIG9uIHVzZXIgZXhwaXJpZW5jZVxuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICAgIHRoaXMucGF0aGZpbmRlci5tYXNrID0gdGhpcy5tYXNrO1xuICAgICAgdGhpcy5wYXRoZmluZGVyLnRhcmdldCA9IHRoaXM7XG4gICAgICB0aGlzLnBhdGhmaW5kZXIuc2V0SW1hZ2UodGhpcy5fb3JpZ2luYWxFbGVtZW50KTtcbiAgICAgIHRoaXMucGF0aGZpbmRlci5pbml0Q2FudmFzKHRoaXMubWFza0VsZW1lbnQpO1xuICAgIH1cbiAgfSxcbiAgcnVuOiBmdW5jdGlvbiAoKSB7XG5cbiAgICB0aGlzLnVwZGF0ZSgpO1xuICAgIHRoaXMucGF0aGZpbmRlci5zbWFydFNlbGVjdGlvbigpO1xuICAgIHRoaXMucmVuZGVyTW9ub2Nocm9tZSgpO1xuICB9LFxuICBnZXRPcmlnaW5hbFNpemU6IGZ1bmN0aW9uKCl7XG4gICAgcmV0dXJuIHtcbiAgICAgIHdpZHRoOiB0aGlzLl9vcmlnaW5hbEVsZW1lbnQubmF0dXJhbFdpZHRoIHx8IHRoaXMuX29yaWdpbmFsRWxlbWVudC53aWR0aCxcbiAgICAgIGhlaWdodDogdGhpcy5fb3JpZ2luYWxFbGVtZW50Lm5hdHVyYWxIZWlnaHQgfHwgdGhpcy5fb3JpZ2luYWxFbGVtZW50LmhlaWdodFxuICAgIH07XG4gIH0sXG4gIF9yZW5kZXI6IGZ1bmN0aW9uIChjdHgsIG5vVHJhbnNmb3JtKSB7XG4gICAgY3R4LnNhdmUoKTtcbiAgICB2YXJcbiAgICAgIHggPSAobm9UcmFuc2Zvcm0gPyB0aGlzLmxlZnQgOiAtdGhpcy53aWR0aCAvIDIpLFxuICAgICAgeSA9IChub1RyYW5zZm9ybSA/IHRoaXMudG9wIDogLXRoaXMuaGVpZ2h0IC8gMiksXG4gICAgICB3ID0gdGhpcy53aWR0aCxcbiAgICAgIGggPSB0aGlzLmhlaWdodDtcblxuICAgIGN0eC5yZXN0b3JlKCk7XG4gICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgIGN0eC5tb3ZlVG8oeCwgeSk7XG4gICAgY3R4LmxpbmVUbyh4ICsgdywgeSk7XG4gICAgY3R4LmxpbmVUbyh4ICsgdywgeSArIGgpO1xuICAgIGN0eC5saW5lVG8oeCwgeSArIGgpO1xuICAgIGN0eC5saW5lVG8oeCwgeSk7XG4gICAgY3R4LmNsb3NlUGF0aCgpO1xuICAgIHRoaXMuX3JlbmRlckZpbGwoY3R4KTtcblxuICAgIGlmICh0aGlzLm1vZGUgPT09ICdvcmlnaW5hbCcpIHtcbiAgICAgIGlmKHRoaXMubWFza09wYWNpdHkgIT0gMSl7XG4gICAgICAgIHRoaXMubWFza0VsZW1lbnQgJiYgY3R4LmRyYXdJbWFnZSh0aGlzLm1hc2tFbGVtZW50LCB4LCB5LCB3LCBoKTtcbiAgICAgIH1cbiAgICAgIGlmKHRoaXMuX29yaWdpbmFsRWxlbWVudCl7XG4gICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IHRoaXMubWFza09wYWNpdHk7XG4gICAgICAgIGN0eC5kcmF3SW1hZ2UodGhpcy5fb3JpZ2luYWxFbGVtZW50LCB4LCB5LCB3LCBoKTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHRoaXMubW9kZSA9PT0gJ21hc2snKSB7XG4gICAgICBpZih0aGlzLm1hc2tPcGFjaXR5ICE9IDEpe1xuICAgICAgICB0aGlzLl9vcmlnaW5hbEVsZW1lbnQgJiYgY3R4LmRyYXdJbWFnZSh0aGlzLl9vcmlnaW5hbEVsZW1lbnQsIHgsIHksIHcsIGgpO1xuICAgICAgfVxuICAgICAgaWYodGhpcy5tYXNrRWxlbWVudCl7XG5cbiAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gdGhpcy5tYXNrT3BhY2l0eTtcbiAgICAgICAgY3R4LmZpbGxTdHlsZSA9IHRoaXMuZmlsbDtcbiAgICAgICAgY3R4LmZpbGxSZWN0KHgsIHksIHcsIGgpXG5cbiAgICAgICAgY3R4LmRyYXdJbWFnZSh0aGlzLm1hc2tFbGVtZW50LCB4LCB5LCB3LCBoKTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHRoaXMubW9kZSA9PT0gJ21peGVkJykge1xuICAgICAgdGhpcy5fb3JpZ2luYWxFbGVtZW50ICYmIGN0eC5kcmF3SW1hZ2UodGhpcy5fb3JpZ2luYWxFbGVtZW50LCB4LCB5LCB3LCBoKTtcbiAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IHRoaXMubWFza09wYWNpdHk7XG4gICAgICB0aGlzLm1hc2tFbGVtZW50ICYmIGN0eC5kcmF3SW1hZ2UodGhpcy5tYXNrRWxlbWVudCwgeCwgeSwgdywgaCk7XG4gICAgfVxuICAgIGN0eC5nbG9iYWxBbHBoYSA9IDE7XG5cbiAgICB0aGlzLl9yZW5kZXJTdHJva2UoY3R4KTtcbiAgfSxcbiAgY29udHJvbHMgOmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoe1xuICAgIG1icjp7dmlzaWJsZTogXCJ7aGFzUm90YXRpbmdQb2ludH1cIiwgeDogXCJ7d2lkdGh9LzJcIiwgICB5OiBcIntoZWlnaHR9K3tyb3RhdGluZ1BvaW50T2Zmc2V0fS97em9vbX1cIiwgYWN0aW9uOiBcInJvdGF0ZVwiLCBjdXJzb3I6IFwicm90YXRpb25DdXJzb3JcIn0sXG4gICAgbWxyOnt2aXNpYmxlOiBcIntoYXNSb3RhdGluZ1BvaW50fVwiLCB4OiBcIi17cm90YXRpbmdQb2ludE9mZnNldH0ve3pvb219XCIsICAgeTogXCJ7aGVpZ2h0LzJ9XCIsIGFjdGlvbjogXCJyb3RhdGVcIiwgY3Vyc29yOiBcInJvdGF0aW9uQ3Vyc29yXCJ9LFxuICAgIG1ycjp7dmlzaWJsZTogXCJ7aGFzUm90YXRpbmdQb2ludH1cIiwgeDogXCJ7d2lkdGh9K3tyb3RhdGluZ1BvaW50T2Zmc2V0fS97em9vbX1cIiwgICB5OiBcIntoZWlnaHQvMn1cIiwgYWN0aW9uOiBcInJvdGF0ZVwiLCBjdXJzb3I6IFwicm90YXRpb25DdXJzb3JcIn1cbiAgfSxmYWJyaWMuT2JqZWN0LnByb3RvdHlwZS5jb250cm9scyksXG4gIC8vIGRyYXdDb250cm9sczogZnVuY3Rpb24gKGN0eCwgc2hhcGUsIG9mZnNldCkge1xuICAvLyAgIGlmICghdGhpcy5oYXNDb250cm9scykge1xuICAvLyAgICAgcmV0dXJuIHRoaXM7XG4gIC8vICAgfVxuICAvLyAgIHRoaXMuZHJhd0JvdW5kc0NvbnRyb2xzKCBjdHgpO1xuICAvLyAgIHRoaXMuZHJhd0V4dHJhQ29udHJvbHMoY3R4KTtcbiAgLy8gfSxcbiAgcmVuZGVyVGh1bWI6IGZ1bmN0aW9uIChfY2FudmFzKSB7XG4gICAgX2NhbnZhcy53aWR0aCA9IHRoaXMud2lkdGg7XG4gICAgX2NhbnZhcy5oZWlnaHQgPSB0aGlzLmhlaWdodDtcbiAgICB2YXIgY3R4ID0gX2NhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xuICAgIGN0eC5zYXZlKCk7XG4gICAgdmFyIF9yID0gdGhpcy5nZXRCb3VuZGluZ1JlY3QoKTtcbiAgICB2YXIgX2xlZnQsIF90b3A7XG4gICAgaWYgKHRoaXMub3JpZ2luWCA9PSAnY2VudGVyJyAmJiB0aGlzLm9yaWdpblkgPT0gJ2NlbnRlcicpIHtcbiAgICAgIHZhciBvcmlnaW5Qb2ludCA9IHRoaXMudHJhbnNsYXRlVG9PcmlnaW5Qb2ludChcbiAgICAgICAgdGhpcy5nZXRDZW50ZXJQb2ludCgpLFxuICAgICAgICB0aGlzLmNhbnZhcy5fcHJldmlvdXNPcmlnaW5YLFxuICAgICAgICB0aGlzLmNhbnZhcy5fcHJldmlvdXNPcmlnaW5ZKTtcbiAgICAgIF9sZWZ0ID0gb3JpZ2luUG9pbnQueDtcbiAgICAgIF90b3AgPSBvcmlnaW5Qb2ludC55O1xuICAgIH0gZWxzZSB7XG4gICAgICBfbGVmdCA9IHRoaXMubGVmdDtcbiAgICAgIF90b3AgPSB0aGlzLnRvcDtcbiAgICB9XG4gICAgY3R4LnJvdGF0ZShmYWJyaWMudXRpbC5kZWdyZWVzVG9SYWRpYW5zKC10aGlzLmFuZ2xlKSk7XG4gICAgaWYgKHRoaXMuX3BvaW50cykge1xuICAgICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgICAgY3R4Lm1vdmVUbyh0aGlzLl9wb2ludHNbMF0ueCwgdGhpcy5fcG9pbnRzWzBdLnkpO1xuICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCB0aGlzLl9wb2ludHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgY3R4LmxpbmVUbyh0aGlzLl9wb2ludHNbaV0ueCwgdGhpcy5fcG9pbnRzW2ldLnkpO1xuICAgICAgfVxuICAgICAgY3R4LmNsb3NlUGF0aCgpO1xuICAgICAgY3R4LmNsaXAoKTtcbiAgICB9XG5cbiAgICBjdHguZHJhd0ltYWdlKHRoaXMuY2FudmFzLmJhY2tncm91bmRJbWFnZS5fZWxlbWVudCwtX2xlZnQsIC1fdG9wKTtcbiAgICBjdHgucmVzdG9yZSgpO1xuICB9XG59KTtcblxuZmFicmljLk1hc2tSZWN0YW5nbGUuZnJvbU9iamVjdCA9IGZ1bmN0aW9uKG9wdGlvbnMsY2FsbGJhY2spe1xuICB2YXIgX3JlY3QgPSBuZXcgdGhpcyhvcHRpb25zKTtcbiAgaWYoX3JlY3QubG9hZGVkKXtcbiAgICAvLyAgLy8gY2FsbGJhY2sgJiYgY2FsbGJhY2soX3JlY3QpO1xuICAgIHJldHVybiBfcmVjdDtcbiAgfWVsc2V7XG4gICAgX3JlY3Qub24oXCJsb2FkZWRcIixmdW5jdGlvbigpe1xuICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2soX3JlY3QpXG4gICAgfSk7XG4gIH1cbn07XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL29iamVjdHMvTWFza1JlY3RhbmdsZS5qc1xuLy8gbW9kdWxlIGlkID0gOTFcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiXG5mYWJyaWMuTWF0ZXJpYWxQb2ludCA9IGZhYnJpYy51dGlsLmNyZWF0ZUNsYXNzKGZhYnJpYy5PYmplY3Qse1xuICBkZWFjdGl2YXRpb25EaXNhYmxlZDogdHJ1ZSxcbiAgdHlwZTogXCJtYXRlcmlhbC1wb2ludFwiLFxuICBjb3JuZXJTaXplOiA1LFxuICB3aWR0aDogMSxcbiAgaGVpZ2h0OiAxLFxuICBzdHJva2VXaWR0aDogMCxcbiAgY29ybmVyU3R5bGU6IFwiY2lyY2xlXCIsXG4gIGNvcm5lckFyZWFTaXplOiAyMCxcbiAgc2V0Q29vcmRzOiBmYWJyaWMuT2JqZWN0LnByb3RvdHlwZS5zZXRFeHRyYUNvb3JkcyxcbiAgaGFzQm91bmRzQ29udHJvbHM6IGZhbHNlLFxuICBoYXNCb3JkZXJzOiBmYWxzZSxcbiAgX3JlbmRlcjogZnVuY3Rpb24oY3R4LG5vVHJhbnNmb3JtKXtcbiAgICB2YXIgeCA9IG5vVHJhbnNmb3JtID8gdGhpcy5sZWZ0IDogLXRoaXMud2lkdGggLyAyICxcbiAgICAgIHkgPSBub1RyYW5zZm9ybSA/IHRoaXMudG9wIDogLXRoaXMuaGVpZ2h0IC8gMjtcblxuICAgIGN0eC5zYXZlKCk7XG4gICAgY3R4LnRyYW5zbGF0ZSh4LHkpO1xuICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICBjdHguYXJjKDAuNSwwLjUsIDAuNSwgMCwgMiAqIE1hdGguUEksIGZhbHNlKTtcbiAgICB0aGlzLl9yZW5kZXJGaWxsKGN0eCk7XG4gICAgdGhpcy5fcmVuZGVyU3Ryb2tlKGN0eCk7XG4gICAgY3R4LnJlc3RvcmUoKTtcbiAgfSxcbiAgZHJhd0NvbnRyb2xzOiBmdW5jdGlvbiAoY3R4KSB7XG4gICAgdGhpcy5kcmF3RXh0cmFDb250cm9scyhjdHgpO1xuICB9LFxuICBzZXRDb250cm9sUG9pbnRzOiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIFtcbiAgICAgIHtcbiAgICAgICAgeDogMC41LFxuICAgICAgICB5OiAwLjUsXG4gICAgICAgIGN1cnNvcjogXCJtb3ZlQ3Vyc29yXCIsXG4gICAgICAgIGFyZWE6ICB0aGlzLmNvcm5lckFyZWFTaXplLFxuICAgICAgICBzaXplIDogdGhpcy5jb3JuZXJTaXplLFxuICAgICAgICBzdHlsZTogdGhpcy5jb3JuZXJTdHlsZSxcbiAgICAgICAgYWN0aW9uOiBcImRyYWdcIixcbiAgICAgICAgaWQ6IFwiZFwiXG4gICAgICB9XG4gICAgXVxuICB9XG59KTtcblxuZmFicmljLk1hdGVyaWFsUG9pbnQuZnJvbU9iamVjdCA9IGZ1bmN0aW9uKG9wdGlvbnMpe1xuICByZXR1cm4gbmV3IGZhYnJpYy5NYXRlcmlhbFBvaW50KG9wdGlvbnMpO1xufTtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vb2JqZWN0cy9NYXRlcmlhbFBvaW50LmpzXG4vLyBtb2R1bGUgaWQgPSA5MlxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCIndXNlIHN0cmljdCc7XG5cbnZhciBwYXRoX2luaXRpYWxpemVfb3ZlcndyaXR0ZW4gPSBmYWJyaWMuUGF0aC5wcm90b3R5cGUuaW5pdGlhbGl6ZTtcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuUGF0aC5wcm90b3R5cGUsIHtcbiAgYWNjdXJhY3k6IDAsXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uIChwYXRoLCBvcHRpb25zKSB7XG4gICAgdGhpcy5jYWxsU3VwZXIoJ2luaXRpYWxpemUnLCBvcHRpb25zKTtcbiAgICBwYXRoX2luaXRpYWxpemVfb3ZlcndyaXR0ZW4uY2FsbCh0aGlzLCBwYXRoLCBvcHRpb25zKTtcbiAgICB0aGlzLl9zZXRfYWNjdXJhY3kodGhpcy5hY2N1cmFjeSwgdGhpcy5wYXRoKTtcbiAgfSxcbiAgdHJhbnNsYXRlOiBmdW5jdGlvbiAocGF0aCwgdHJhbnNsYXRlWCwgdHJhbnNsYXRlWSkge1xuICAgIHZhciBjdXJyZW50O1xuICAgIC8vaWYodGhpcy5wYXRoWzBdWzBdID09PSBcIm1cIil7XG4gICAgLy8gIHJldHVybjtcbiAgICAvL31cbiAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gcGF0aC5sZW5ndGg7IGkgPCBsZW47ICsraSkge1xuXG4gICAgICBjdXJyZW50ID0gcGF0aFtpXTtcblxuICAgICAgc3dpdGNoIChjdXJyZW50WzBdKSB7IC8vIGZpcnN0IGxldHRlclxuICAgICAgICBjYXNlICdMJzogLy8gbGluZXRvLCBhYnNvbHV0ZVxuICAgICAgICAgIGN1cnJlbnRbMV0gKz0gdHJhbnNsYXRlWDtcbiAgICAgICAgICBjdXJyZW50WzJdICs9IHRyYW5zbGF0ZVk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ0gnOlxuICAgICAgICAgIGN1cnJlbnRbMV0gKz0gdHJhbnNsYXRlWDtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnVic6IC8vIHZlcmljYWwgbGluZXRvLCBhYnNvbHV0ZVxuICAgICAgICAgIGN1cnJlbnRbMV0gKz0gdHJhbnNsYXRlWTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnTSc6XG4gICAgICAgICAgY3VycmVudFsxXSArPSB0cmFuc2xhdGVYO1xuICAgICAgICAgIGN1cnJlbnRbMl0gKz0gdHJhbnNsYXRlWTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnQyc6XG4gICAgICAgICAgY3VycmVudFsxXSArPSB0cmFuc2xhdGVYO1xuICAgICAgICAgIGN1cnJlbnRbMl0gKz0gdHJhbnNsYXRlWTtcbiAgICAgICAgICBjdXJyZW50WzNdICs9IHRyYW5zbGF0ZVg7XG4gICAgICAgICAgY3VycmVudFs0XSArPSB0cmFuc2xhdGVZO1xuICAgICAgICAgIGN1cnJlbnRbNV0gKz0gdHJhbnNsYXRlWDtcbiAgICAgICAgICBjdXJyZW50WzZdICs9IHRyYW5zbGF0ZVk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ1MnOlxuICAgICAgICAgIGN1cnJlbnRbMV0gKz0gdHJhbnNsYXRlWDtcbiAgICAgICAgICBjdXJyZW50WzJdICs9IHRyYW5zbGF0ZVk7XG4gICAgICAgICAgY3VycmVudFszXSArPSB0cmFuc2xhdGVYO1xuICAgICAgICAgIGN1cnJlbnRbNF0gKz0gdHJhbnNsYXRlWTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnUSc6IC8vIHF1YWRyYXRpY0N1cnZlVG8sIGFic29sdXRlXG4gICAgICAgICAgY3VycmVudFsxXSArPSB0cmFuc2xhdGVYO1xuICAgICAgICAgIGN1cnJlbnRbMl0gKz0gdHJhbnNsYXRlWTtcbiAgICAgICAgICBjdXJyZW50WzNdICs9IHRyYW5zbGF0ZVg7XG4gICAgICAgICAgY3VycmVudFs0XSArPSB0cmFuc2xhdGVZO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdUJzpcbiAgICAgICAgICBjdXJyZW50WzFdICs9IHRyYW5zbGF0ZVg7XG4gICAgICAgICAgY3VycmVudFsyXSArPSB0cmFuc2xhdGVZO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdBJzpcbiAgICAgICAgICBjdXJyZW50WzFdICs9IHRyYW5zbGF0ZVg7Ly90b2RvPz9cbiAgICAgICAgICBjdXJyZW50WzJdICs9IHRyYW5zbGF0ZVk7Ly90b2RvID8/XG4gICAgICAgICAgY3VycmVudFs2XSArPSB0cmFuc2xhdGVYO1xuICAgICAgICAgIGN1cnJlbnRbN10gKz0gdHJhbnNsYXRlWTtcbiAgICAgIH1cbiAgICB9XG4gIH0sXG4gIHNwZWNpYWxQcm9wZXJ0aWVzOiBbXCJhY2N1cmFjeVwiXSxcbiAgX3NldF9hY2N1cmFjeTogZnVuY3Rpb24gKGFjY3VyYWN5LCBwYXRoKSB7XG4gICAgZm9yICh2YXIgaSA9MCA7IGkgPCBwYXRoLmxlbmd0aDsgaSsrKSB7XG4gICAgICBmb3IgKHZhciBqID0gMTsgaiA8IHBhdGhbaV0ubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgcGF0aFtpXVtqXSA9ICtwYXRoW2ldW2pdLnRvRml4ZWQodGhpcy5hY2N1cmFjeSk7XG4gICAgICB9XG4gICAgfVxuICB9LFxuICBzZXRBY2N1cmFjeTogZnVuY3Rpb24gKGFjY3VyYWN5KSB7XG4gICAgdGhpcy5hY2N1cmFjeSA9IGFjY3VyYWN5O1xuICAgIGlmKCF0aGlzLl9wb2ludHMpcmV0dXJuO1xuICAgIHRoaXMuX3NldF9hY2N1cmFjeShhY2N1cmFjeSwgdGhpcy5wYXRoKTtcbiAgfSxcbiAgc3RvcmVQYXRoQXNTdHJpbmc6IGZhbHNlLFxuICBfdG9PYmplY3Rfb3ZlcndyaXR0ZW46IGZhYnJpYy5QYXRoLnByb3RvdHlwZS50b09iamVjdCxcbi8vdG9kbyB1c2UgZXZlbnQgXCJiZWZvcmU6b2JqZWN0XCI7XG4gIHRvT2JqZWN0OiBmdW5jdGlvbiAocHJvcGVydGllc1RvSW5jbHVkZSkge1xuXG4gICAgaWYodGhpcy5hY2N1cmFjeSl7XG4gICAgICB0aGlzLl9zZXRfYWNjdXJhY3kodGhpcy5hY2N1cmFjeSx0aGlzLnBhdGgpO1xuICAgICAgdGhpcy5sZWZ0ID0gK3RoaXMubGVmdC50b0ZpeGVkKHRoaXMuYWNjdXJhY3kpO1xuICAgICAgdGhpcy50b3AgID0gK3RoaXMudG9wLnRvRml4ZWQodGhpcy5hY2N1cmFjeSk7XG4gICAgICB0aGlzLnBhdGhPZmZzZXQueCA9ICt0aGlzLnBhdGhPZmZzZXQueC50b0ZpeGVkKHRoaXMuYWNjdXJhY3kpO1xuICAgICAgdGhpcy5wYXRoT2Zmc2V0LnkgPSArdGhpcy5wYXRoT2Zmc2V0LnkudG9GaXhlZCh0aGlzLmFjY3VyYWN5KTtcbiAgICB9XG5cbiAgICB2YXIgX29iaiA9IHRoaXMuX3RvT2JqZWN0X292ZXJ3cml0dGVuKHByb3BlcnRpZXNUb0luY2x1ZGUpO1xuXG4gICAgaWYgKHRoaXMuc3RvcmVQcm9wZXJ0aWVzLmluZGV4T2YoXCIqXCIpID09IC0xKSB7XG5cbiAgICAgIGlmIChfb2JqLnBhdGhPZmZzZXQgJiYgdGhpcy5zdG9yZVByb3BlcnRpZXMuaW5kZXhPZihcInBhdGhPZmZzZXRcIikgPT0gLTEpIHtcbiAgICAgICAgdGhpcy50cmFuc2xhdGUoX29iai5wYXRoLCBfb2JqLnBhdGhPZmZzZXQueCwgX29iai5wYXRoT2Zmc2V0LnkpXG4gICAgICAgIHRoaXMuX3NldF9hY2N1cmFjeSh0aGlzLmFjY3VyYWN5LF9vYmoucGF0aCk7XG4gICAgICB9XG5cbiAgICAgIGZvciAodmFyIGkgaW4gX29iaikge1xuICAgICAgICBpZiAodGhpcy5zdG9yZVByb3BlcnRpZXMuaW5kZXhPZihpKSA9PSAtMSkge1xuICAgICAgICAgIGRlbGV0ZSBfb2JqW2ldO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBjb25zb2xlLmxvZyhcIiEhIVwiKVxuICAgIH1cbiAgICBpZiAodGhpcy5zdG9yZVBhdGhBc1N0cmluZykge1xuICAgICAgX29iai5wYXRoID0gX29iai5wYXRoLmpvaW4oJycpXG4gICAgfVxuICAgIHJldHVybiBfb2JqO1xuICB9XG59KTtcblxuLyoqXG4gKiBDcmVhdGVzIGFuIGluc3RhbmNlIG9mIGZhYnJpYy5QYXRoIGZyb20gYW4gb2JqZWN0XG4gKiBAc3RhdGljXG4gKiBAbWVtYmVyT2YgZmFicmljLlBhdGhcbiAqIEBwYXJhbSB7T2JqZWN0fSBvYmplY3RcbiAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIENhbGxiYWNrIHRvIGludm9rZSB3aGVuIGFuIGZhYnJpYy5QYXRoIGluc3RhbmNlIGlzIGNyZWF0ZWRcbiAqL1xuZmFicmljLlBhdGguZnJvbU9iamVjdCA9IGZ1bmN0aW9uIChvYmplY3QsIGNhbGxiYWNrKSB7XG4gIC8qIGlmICh0eXBlb2Ygb2JqZWN0LnBhdGggPT09ICdzdHJpbmcnKSB7XG4gICBmYWJyaWMubG9hZFNWR0Zyb21VUkwob2JqZWN0LnBhdGgsIGZ1bmN0aW9uIChlbGVtZW50cykge1xuICAgdmFyIHBhdGggPSBlbGVtZW50c1swXSxcbiAgIHBhdGhVcmwgPSBvYmplY3QucGF0aDtcblxuICAgZGVsZXRlIG9iamVjdC5wYXRoO1xuXG4gICBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKHBhdGgsIG9iamVjdCk7XG4gICBwYXRoLnNldFNvdXJjZVBhdGgocGF0aFVybCk7XG5cbiAgIGNhbGxiYWNrKHBhdGgpO1xuICAgfSk7XG4gICB9XG4gICBlbHNlIHsqL1xuXG4gIHZhciBfc2NhbGVkID0gb2JqZWN0LnNjYWxlWCB8fCBvYmplY3Quc2NhbGVZO1xuXG4gIHZhciBwYXRoID0gbmV3IGZhYnJpYy5QYXRoKG9iamVjdC5wYXRoLCBvYmplY3QpO1xuXG4gIGlmKCFfc2NhbGVkKXtcbiAgICBpZihvYmplY3Qud2lkdGgpe1xuICAgICAgcGF0aC5zY2FsZVggPSBvYmplY3Qud2lkdGggLyBwYXRoLndpZHRoO1xuICAgIH1cbiAgICBpZihvYmplY3QuaGVpZ2h0KXtcbiAgICAgIHBhdGguc2NhbGVZID0gb2JqZWN0LmhlaWdodCAvIHBhdGguaGVpZ2h0O1xuICAgIH1cbiAgfVxuXG4gIGNhbGxiYWNrICYmIGNhbGxiYWNrKHBhdGgpO1xuICByZXR1cm4gcGF0aDtcbiAgLy8gfVxufTtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vb2JqZWN0cy9QYXRoLmpzXG4vLyBtb2R1bGUgaWQgPSA5M1xuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCJcbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLlBhdGhHcm91cC5wcm90b3R5cGUse1xuICBpbml0aWFsaXplX292ZXJ3cml0dGVuOiBmYWJyaWMuUGF0aEdyb3VwLnByb3RvdHlwZS5pbml0aWFsaXplLFxuICBpbml0aWFsaXplOiBmdW5jdGlvbihwYXRocywgb3B0aW9ucyl7XG5cbiAgICBpZihwYXRocy5jb25zdHJ1Y3RvciAhPSBBcnJheSl7XG4gICAgICBvcHRpb25zID0gcGF0aHMudG9PYmplY3QoKTtcbiAgICAgIGRlbGV0ZSBvcHRpb25zLnBhdGhzO1xuICAgICAgcGF0aHMgPSBwYXRocy5wYXRocztcbiAgICB9XG5cbiAgICB0aGlzLmluaXRpYWxpemVfb3ZlcndyaXR0ZW4ocGF0aHMsIG9wdGlvbnMpO1xuICB9LFxuICBleHRyYWN0Q29sb3JzOiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIF9jb2xvcnMgPSB7fTtcbiAgICB2YXIgX3BhdGhzID0gdGhpcy5wYXRocztcbiAgICBmb3IgKHZhciBpIGluIF9wYXRocykge1xuICAgICAgaWYgKF9wYXRoc1tpXS5maWxsLnR5cGUpIHtcbiAgICAgICAgZm9yICh2YXIgaiBpbiBfcGF0aHNbaV0uZmlsbC5jb2xvclN0b3BzKSB7XG4gICAgICAgICAgdmFyIF9jb2xvciA9IF9wYXRoc1tpXS5maWxsLmNvbG9yU3RvcHNbal0uY29sb3I7XG4gICAgICAgICAgaWYgKCFfY29sb3JzW19jb2xvcl0pIF9jb2xvcnNbX2NvbG9yXSA9IFtdO1xuICAgICAgICAgIF9jb2xvcnNbX2NvbG9yXS5wdXNoKHtvYmplY3Q6IF9wYXRoc1tpXSwgc3RvcDogX3BhdGhzW2ldLmZpbGwuY29sb3JTdG9wc1tqXX0pO1xuICAgICAgICB9XG5cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciBfY29sb3IgPSBfcGF0aHNbaV0uZmlsbDtcbiAgICAgICAgaWYgKCFfY29sb3JzW19jb2xvcl0pIF9jb2xvcnNbX2NvbG9yXSA9IFtdO1xuICAgICAgICBfY29sb3JzW19jb2xvcl0ucHVzaCh7b2JqZWN0OiBfcGF0aHNbaV0sIGNvbG9yOiBfcGF0aHNbaV19KTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIF9jb2xvcnM7XG4gIH1cbn0pXG5cbmZhYnJpYy5QYXRoR3JvdXAuZnJvbUVsZW1lbnRzID0gZnVuY3Rpb24gKGVsZW1lbnRzLCBvYmplY3QsIHVybCkge1xuICB2YXIgX29wdGlvbnMgPSB7XG4gICAgdG9CZVBhcnNlZDogdHJ1ZSxcbiAgICAvL29yaWdpblg6IFwiY2VudGVyXCIsXG4gICAgLy9vcmlnaW5ZOiBcImNlbnRlclwiXG4gIH07XG5cbiAgLy/RgdC80LXRidCw0LXQvCDRjdC70LXQvNC10L3RgtGLINGC0LDQuiwg0YfRgtC+0LHRiyDQuNGFINC60L7QvtGA0LjQvdCw0YLRiyDQvdCw0YfQuNC90LDQu9C40YHRjCDQvtGCIDAuMFxuICBpZiAoZWxlbWVudHMubGVuZ3RoKSB7XG5cbiAgICB2YXIgbWluWCA9IEluZmluaXR5LFxuICAgICAgbWluWSA9IEluZmluaXR5O1xuICAgIGZvciAodmFyIGkgaW4gZWxlbWVudHMpIHtcbiAgICAgIG1pblggPSBNYXRoLm1pbihlbGVtZW50c1tpXS5sZWZ0LCBtaW5YKTtcbiAgICAgIG1pblkgPSBNYXRoLm1pbihlbGVtZW50c1tpXS50b3AsIG1pblkpO1xuICAgIH1cblxuXG4gICAgbWluWCA9IE1hdGgubWF4KG1pblgsIDApO1xuICAgIG1pblkgPSBNYXRoLm1heChtaW5ZLCAwKTtcbiAgICAvKiBmb3IgKHZhciBpIGluIGVsZW1lbnRzKSB7XG4gICAgIGVsZW1lbnRzW2ldLnRyYW5zbGF0ZSgtbWluWCwgLW1pblkpO1xuICAgICBlbGVtZW50c1tpXS5sZWZ0IC09IG1pblg7XG4gICAgIGVsZW1lbnRzW2ldLnBhdGhPZmZzZXQueCAtPSBtaW5YO1xuICAgICBlbGVtZW50c1tpXS50b3AgLT0gbWluWTtcbiAgICAgZWxlbWVudHNbaV0ucGF0aE9mZnNldC55IC09IG1pblk7XG4gICAgIH0qL1xuICB9XG5cbiAgdmFyIGVsID0gZmFicmljLnV0aWwuZ3JvdXBTVkdFbGVtZW50cyhlbGVtZW50cywgX29wdGlvbnMsIHVybCk7XG5cbiAgdmFyIHNjYWxlWCA9IG9iamVjdC53aWR0aCA/IG9iamVjdC53aWR0aCAvIGVsLndpZHRoIDogbnVsbCxcbiAgICBzY2FsZVkgPSBvYmplY3QuaGVpZ2h0ID8gb2JqZWN0LmhlaWdodCAvIGVsLmhlaWdodCA6IG51bGw7XG4gIGlmIChzY2FsZVggJiYgIXNjYWxlWSkge1xuICAgIHNjYWxlWSA9IHNjYWxlWDtcbiAgfVxuICBpZiAoc2NhbGVZICYmICFzY2FsZVgpIHtcbiAgICBzY2FsZVggPSBzY2FsZVk7XG4gIH1cbiAgaWYgKCFzY2FsZVkgJiYgIXNjYWxlWCkge1xuICAgIHNjYWxlWCA9IHNjYWxlWSA9IDE7XG4gIH1cblxuICBkZWxldGUgb2JqZWN0LmhlaWdodDtcbiAgZGVsZXRlIG9iamVjdC53aWR0aDtcbiAgZWwuc2V0KGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQob2JqZWN0LCB7XG4gICAgLy9sZWZ0OiAwLCB0b3A6IDAsXG4gICAgc2NhbGVYOiBzY2FsZVgsXG4gICAgc2NhbGVZOiBzY2FsZVlcbiAgfSkpO1xuICBlbC5zZXRMZWZ0KG9iamVjdC5sZWZ0KTtcbiAgZWwuc2V0VG9wKG9iamVjdC50b3ApO1xuICByZXR1cm4gZWw7XG59O1xuXG4vLyBmYWJyaWMuUGF0aEdyb3VwLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbihjdHgsbm9UcmFuc2Zvcm0pIHtcbi8vICAgaWYgKCF0aGlzLnZpc2libGUpIHtcbi8vICAgICByZXR1cm47XG4vLyAgIH1cbi8vICAgdmFyIHggPSBub1RyYW5zZm9ybSA/IDAgOiAtIHRoaXMud2lkdGggKiB0aGlzLnNjYWxlWCAvIDIsXG4vLyAgICAgeSA9IG5vVHJhbnNmb3JtID8gMCA6IC0gdGhpcy5oZWlnaHQgKiB0aGlzLnNjYWxlWSAvIDI7XG4vL1xuLy8gICBjdHguc2F2ZSgpO1xuLy8gICBjdHgudHJhbnNsYXRlKHgseSk7XG4vL1xuLy8gICBpZiAodGhpcy50cmFuc2Zvcm1NYXRyaXgpIHtcbi8vICAgICBjdHgudHJhbnNmb3JtLmFwcGx5KGN0eCwgdGhpcy50cmFuc2Zvcm1NYXRyaXgpO1xuLy8gICB9XG4vLyAgIHRoaXMudHJhbnNmb3JtKGN0eCk7XG4vL1xuLy8gICB0aGlzLl9zZXRTaGFkb3coY3R4KTtcbi8vICAgdGhpcy5jbGlwVG8gJiYgZmFicmljLnV0aWwuY2xpcENvbnRleHQodGhpcywgY3R4KTtcbi8vICAgY3R4LnRyYW5zbGF0ZSgtdGhpcy53aWR0aC8yLCAtdGhpcy5oZWlnaHQvMik7XG4vLyAgIGZvciAodmFyIGkgPSAwLCBsID0gdGhpcy5wYXRocy5sZW5ndGg7IGkgPCBsOyArK2kpIHtcbi8vICAgICB0aGlzLnBhdGhzW2ldLnJlbmRlcihjdHgsIHRydWUpO1xuLy8gICB9XG4vLyAgIHRoaXMuY2xpcFRvICYmIGN0eC5yZXN0b3JlKCk7XG4vLyAgIGN0eC5yZXN0b3JlKCk7XG4vLyB9XG5cblxuXG5cblxuXG5mYWJyaWMuUGF0aEdyb3VwLmZyb21VUkwgPSBmdW5jdGlvbiAodXJsLCBjYWxsYmFjaywgb2JqZWN0KSB7XG5cbiAgZmFicmljLmxvYWRTVkdGcm9tVVJMKHVybCxmdW5jdGlvbihlbHMpe1xuXG4gICAgdmFyIGVsID0gbmV3IGZhYnJpYy5QYXRoR3JvdXAoZWxzLCB7dG9CZVBhcnNlZDp0cnVlfSk7XG5cbiAgICAvLyAvL9GB0LzQtdGJ0LDQtdC8INGN0LvQtdC80LXQvdGC0Ysg0YLQsNC6LCDRh9GC0L7QsdGLINC40YUg0LrQvtC+0YDQuNC90LDRgtGLINC90LDRh9C40L3QsNC70LjRgdGMINC+0YIgMC4wXG4gICAgLy8gaWYgKGVsLnBhdGhzLmxlbmd0aCkge1xuICAgIC8vXG4gICAgLy8gICB2YXIgbWluWCA9IEluZmluaXR5LFxuICAgIC8vICAgICBtaW5ZID0gSW5maW5pdHk7XG4gICAgLy8gICB2YXIgbWF4WCA9IC1JbmZpbml0eSxcbiAgICAvLyAgICAgbWF4WSA9IC1JbmZpbml0eTtcbiAgICAvL1xuICAgIC8vICAgZm9yICh2YXIgaSBpbiBlbC5wYXRocykge1xuICAgIC8vICAgICB2YXIgX3AgPSBlbC5wYXRoc1tpXTtcbiAgICAvLyAgICAgbWluWCA9IE1hdGgubWluKF9wLmxlZnQsIG1pblgpO1xuICAgIC8vICAgICBtaW5ZID0gTWF0aC5taW4oX3AudG9wLCBtaW5ZKTtcbiAgICAvLyAgICAgbWF4WCA9IE1hdGgubWF4KF9wLmxlZnQgKyBfcC53aWR0aCwgbWF4WCk7XG4gICAgLy8gICAgIG1heFkgPSBNYXRoLm1heChfcC50b3AgKyBfcC5oZWlnaHQsIG1heFkpO1xuICAgIC8vICAgfVxuICAgIC8vXG4gICAgLy8gICB2YXIgX1cgPSBtYXhYIC0gbWluWDtcbiAgICAvLyAgIHZhciBfSCA9IG1heFkgLSBtaW5ZO1xuICAgIC8vICAgLy9cbiAgICAvLyAgIC8vXG4gICAgLy8gICAvLyBtaW5YID0gTWF0aC5tYXgobWluWCwgMCk7XG4gICAgLy8gICAvLyBtaW5ZID0gTWF0aC5tYXgobWluWSwgMCk7XG4gICAgLy8gICAvKiBmb3IgKHZhciBpIGluIGVsZW1lbnRzKSB7XG4gICAgLy8gICAgZWxlbWVudHNbaV0udHJhbnNsYXRlKC1taW5YLCAtbWluWSk7XG4gICAgLy8gICAgZWxlbWVudHNbaV0ubGVmdCAtPSBtaW5YO1xuICAgIC8vICAgIGVsZW1lbnRzW2ldLnBhdGhPZmZzZXQueCAtPSBtaW5YO1xuICAgIC8vICAgIGVsZW1lbnRzW2ldLnRvcCAtPSBtaW5ZO1xuICAgIC8vICAgIGVsZW1lbnRzW2ldLnBhdGhPZmZzZXQueSAtPSBtaW5ZO1xuICAgIC8vICAgIH0qL1xuICAgIC8vIH1lbHNle1xuICAgIC8vICAgX1cgPSAxO1xuICAgIC8vICAgX0ggPSAxO1xuICAgIC8vIH1cblxuICAgIHZhciBzY2FsZVggPSBvYmplY3Qud2lkdGggPyBvYmplY3Qud2lkdGggLyBlbC53aWR0aCA6IG51bGwsXG4gICAgICBzY2FsZVkgPSBvYmplY3QuaGVpZ2h0ID8gb2JqZWN0LmhlaWdodCAvIGVsLmhlaWdodCA6IG51bGw7XG4gICAgaWYgKHNjYWxlWCAmJiAhc2NhbGVZKSB7XG4gICAgICBzY2FsZVkgPSBzY2FsZVg7XG4gICAgfVxuICAgIGlmIChzY2FsZVkgJiYgIXNjYWxlWCkge1xuICAgICAgc2NhbGVYID0gc2NhbGVZO1xuICAgIH1cbiAgICBpZiAoIXNjYWxlWSAmJiAhc2NhbGVYKSB7XG4gICAgICBzY2FsZVggPSBzY2FsZVkgPSAxO1xuICAgIH1cbiAgICAvLyBjb25zb2xlLmxvZyhvYmplY3Qud2lkdGgsZWwud2lkdGgsb2JqZWN0LmhlaWdodCxlbC5oZWlnaHQpXG4gICAgLy8gY29uc29sZS5sb2coZWwpO1xuICAgIGVsLnNldCgge1xuICAgICAgc2NhbGVYOiBzY2FsZVggLFxuICAgICAgc2NhbGVZOiBzY2FsZVlcbiAgICB9KTtcblxuICAgIGNhbGxiYWNrKGVsKTtcbiAgfSk7XG5cbiAgLy8gZmFicmljLmxvYWRTVkdGcm9tVVJMKHVybCxmdW5jdGlvbihlbHMpe1xuICAvLyAgIGNhbGxiYWNrKGZhYnJpYy5QYXRoR3JvdXAuZnJvbUVsZW1lbnRzKGVscywgb2JqZWN0KSk7XG4gIC8vIH0pO1xufTtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vb2JqZWN0cy9QYXRoR3JvdXAuanNcbi8vIG1vZHVsZSBpZCA9IDk0XG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIid1c2Ugc3RyaWN0JztcblxuXG4gIC8vZmFicmljLkRQSSB0b2RvIHdoeSBkbyBub3QgdXNlIGl0P1xuLyoqXG4gKiBAYXV0aG9yIERlbmlzIFBvbm9tYXJldlxuICogQGVtYWlsIGRlbi5wb25vbWFyZXZAZ21haWwuY29tXG4gKi9cbi8vZmFicmljLnJlcXVpcmUoXCJQaG90b1wiLFtcIkZyYW1lXCIsXCJTbGlkZU9iamVjdFwiXSwgZnVuY3Rpb24oKSB7XG4gIGZhYnJpYy5QaG90byA9IGZhYnJpYy51dGlsLmNyZWF0ZUNsYXNzKGZhYnJpYy5GcmFtZSwge1xuICAgIHR5cGU6ICdwaG90bycsXG4gICAgZnJhbWVUb29sOiBmYWxzZSxcbiAgICBpbWFnZVRvb2xzOiBmYWxzZSxcbiAgICBmaWx0ZXJUb29sOiBmYWxzZSxcbiAgICBzdGF0ZVByb3BlcnRpZXM6IGZhYnJpYy5GcmFtZS5wcm90b3R5cGUuc3RhdGVQcm9wZXJ0aWVzLmNvbmNhdChbXCJmcmFtZVwiXSksXG4gICAgX3NjYWxpbmdfZXZlbnRzX2VuYWJsZWQ6IHRydWUsXG5cbiAgICBjbG9uZVN5bmM6IGZ1bmN0aW9uKG9wdGlvbnMpe1xuICAgICAgdmFyIF9mcmFtZSA9IG5ldyBmYWJyaWMuUGhvdG8odGhpcyk7XG4gICAgICBvcHRpb25zICYmIF9mcmFtZS5zZXQob3B0aW9ucyk7XG4gICAgICByZXR1cm4gX2ZyYW1lO1xuICAgIH0sXG4gICAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKG9wdGlvbnMpIHtcblxuICAgICAgb3B0aW9ucyB8fCAoIG9wdGlvbnMgPSB7fSk7XG4gICAgICB0aGlzLmNhbGxTdXBlcignaW5pdGlhbGl6ZScsb3B0aW9ucyk7XG5cbiAgICAgIHRoaXMuZHBpID0gMDtcbiAgICAgIHRoaXMuX2NyZWF0ZV9zaWduKCk7XG4gICAgICB0aGlzLl9zZXRfYm9yZGVyKG9wdGlvbnMuYm9yZGVyICwgXCJib3JkZXJcIik7XG4gICAgICB0aGlzLl9zZXRfYm9yZGVyKG9wdGlvbnMuYm9yZGVyMixcImJvcmRlcjJcIik7XG4gICAgICB0aGlzLl9zZXRfZnJhbWUob3B0aW9ucy5mcmFtZSk7XG5cbiAgICAgIHRoaXMub24oe1xuICAgICAgICBcImFkZGVkXCI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICB0aGlzLl9jaGVja19kcGkoKTtcbiAgICAgICAgfSxcbiAgICAgICAgXCJzY2FsaW5nXCI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICB0aGlzLl9hcHBseV9mcmFtZSgpO1xuICAgICAgICAgIHRoaXMuX3VwZGF0ZV9mcmFtZSgpO1xuICAgICAgICAgIHRoaXMuX2NoZWNrX2RwaSgpO1xuICAgICAgICB9LFxuICAgICAgICBcImNsaXBwaW5nOmVudGVyZWRcIjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGlmICh0aGlzLl9mYWJyaWNfZnJhbWUpIHtcbiAgICAgICAgICAgIGlmKHRoaXMuZnJhbWUucG9zaXRpb24gIT09IFwiYmFja1wiKXtcbiAgICAgICAgICAgICAgdGhpcy5fcmVzdG9yZU9iamVjdFN0YXRlKHRoaXMuX2ZhYnJpY19mcmFtZSk7XG4gICAgICAgICAgICAgIHRoaXMucmVtb3ZlKHRoaXMuX2ZhYnJpY19mcmFtZSk7XG4gICAgICAgICAgICAgIHRoaXMuY2FudmFzLmFkZCh0aGlzLl9mYWJyaWNfZnJhbWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgXCJjbGlwcGluZzpleGl0ZWRcIjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGlmICh0aGlzLl9mYWJyaWNfZnJhbWUpIHtcbiAgICAgICAgICAgIGlmKHRoaXMuZnJhbWUucG9zaXRpb24gIT09IFwiYmFja1wiKSB7XG4gICAgICAgICAgICAgIHRoaXMuY2FudmFzLnJlbW92ZSh0aGlzLl9mYWJyaWNfZnJhbWUpO1xuICAgICAgICAgICAgICB0aGlzLmFkZCh0aGlzLl9mYWJyaWNfZnJhbWUpO1xuICAgICAgICAgICAgICB0aGlzLl9hcHBseV9mcmFtZSgpO1xuICAgICAgICAgICAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBfYXBwbHlfZnJhbWU6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuX2ZhYnJpY19mcmFtZSAmJiB0aGlzLl9mYWJyaWNfZnJhbWUuc2V0KHtcbiAgICAgICAgbGVmdDogMCAsXG4gICAgICAgIHRvcDogMCxcbiAgICAgICAgd2lkdGggOiB0aGlzLndpZHRoLFxuICAgICAgICBoZWlnaHQ6ICB0aGlzLmhlaWdodFxuICAgICAgfSlcbiAgICB9LFxuICAgIF9jcmVhdGVfc2lnbjogZnVuY3Rpb24gKCkge1xuXG5cbiAgICAgIHRoaXMuX2ZhYnJpY19zaWduID0gbmV3IGZhYnJpYy5UZXh0KFwi74GxXCIsIHtcbiAgICAgICAgZmlsbDogXCJ5ZWxsb3dcIixcbiAgICAgICAgc3Ryb2tlOiBcImJsYWNrXCIsXG4gICAgICAgIGV2ZW50ZWQ6IGZhbHNlLFxuICAgICAgICB2aXNpYmxlOiBmYWxzZSxcbiAgICAgICAgaGVpZ2h0OiAyMCxcbiAgICAgICAgZm9udFNpemU6IDI0LFxuICAgICAgICBmb250RmFtaWx5OiBcIkZvbnRBd2Vzb21lXCIsXG4gICAgICAgIGxlZnQ6IHRoaXMud2lkdGggLyAyIC0gMzAsXG4gICAgICAgIHRvcDogdGhpcy5oZWlnaHQgLyAyIC0gMzUsXG4gICAgICAgIHRleHRBbGlnbjogXCJjZW50ZXJcIlxuICAgICAgfSk7XG4gICAgICB0aGlzLl9lbGVtZW50c190b191cGRhdGUucHVzaCh7XG4gICAgICAgIGVsZW1lbnQ6IHRoaXMuX2ZhYnJpY19zaWduLFxuICAgICAgICBib3R0b206IDM1LFxuICAgICAgICByaWdodDogMzBcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLl9mYWJyaWNfc2lnbl90ZXh0ID0gbmV3IGZhYnJpYy5UZXh0KE1hdGguZmxvb3IodGhpcy5kcGkpLnRvU3RyaW5nKCksIHtcbiAgICAgICAgZmlsbDogXCJ5ZWxsb3dcIixcbiAgICAgICAgZXZlbnRlZDogZmFsc2UsXG4gICAgICAgIHZpc2libGU6IGZhbHNlLFxuICAgICAgICBoZWlnaHQ6IDUsXG4gICAgICAgIGZvbnRTaXplOiAxMCxcbiAgICAgICAgbGVmdDogdGhpcy53aWR0aCAvIDIgLSAyNyxcbiAgICAgICAgdG9wOiB0aGlzLmhlaWdodCAvIDIgLSAxMixcbiAgICAgICAgdGV4dEFsaWduOiBcImNlbnRlclwiXG4gICAgICB9KTtcblxuICAgICAgdGhpcy5fZWxlbWVudHNfdG9fdXBkYXRlLnB1c2goe1xuICAgICAgICBlbGVtZW50OiB0aGlzLl9mYWJyaWNfc2lnbl90ZXh0LFxuICAgICAgICBib3R0b206IDEyLFxuICAgICAgICByaWdodDogMjdcbiAgICAgIH0pO1xuICAgICAgdGhpcy5hZGQodGhpcy5fZmFicmljX3NpZ24pO1xuICAgICAgdGhpcy5hZGQodGhpcy5fZmFicmljX3NpZ25fdGV4dCk7XG4gICAgfSxcbiAgICBfY2hlY2tfZHBpOiBmdW5jdGlvbiAoKSB7XG4gICAgICAvL3RoaXMuZHBpX3dhcm5pbmcgPSB0cnVlO1xuICAgICAgdGhpcy5kcGkgPSB0aGlzLmdldERQSSgpO1xuICAgICAgaWYgKCF0aGlzLmNhbnZhcylyZXR1cm47Ly90b2RvXG5cbiAgICAgIGlmICh0aGlzLmNhbnZhcy5kcGkgJiYgdGhpcy5kcGkgPCB0aGlzLmNhbnZhcy5kcGkpIHtcbiAgICAgICAgdGhpcy5fZmFicmljX3NpZ24uc2V0VmlzaWJsZSh0cnVlKTtcbiAgICAgICAgdGhpcy5fZmFicmljX3NpZ25fdGV4dC5zZXRWaXNpYmxlKHRydWUpO1xuICAgICAgICB0aGlzLl9mYWJyaWNfc2lnbl90ZXh0LnNldFRleHQoTWF0aC5mbG9vcih0aGlzLmRwaSkudG9TdHJpbmcoKSk7XG4gICAgICAgIC8vdGhpcy5zbGlkZS5kcGlfd2FybmluZyA9IHRydWU7XG4gICAgICB9IGVsc2Uge1xuXG4gICAgICAgIHRoaXMuX2ZhYnJpY19zaWduLnNldFZpc2libGUoZmFsc2UpO1xuICAgICAgICB0aGlzLl9mYWJyaWNfc2lnbl90ZXh0LnNldFZpc2libGUoZmFsc2UpO1xuICAgICAgICAvL2lmKCF0aGlzLl9mYWJyaWNfc2lnbilyZXR1cm47XG4gICAgICAgIC8vdGhpcy5yZW1vdmUodGhpcy5fZmFicmljX3NpZ24pO1xuICAgICAgICAvL2RlbGV0ZSB0aGlzLl9mYWJyaWNfc2lnbjtcbiAgICAgICAgLy90aGlzLnNsaWRlLmRwaV93YXJuaW5nID0gdGhpcy5zbGlkZS5jaGVja0RQSSgpO1xuICAgICAgfVxuICAgIH0sXG4gICAgZ2V0RFBJOiBmdW5jdGlvbiAoKSB7XG5cbiAgICAgIHJldHVybjtcbiAgICAgIGlmICghdGhpcy5fb3JpZ2luYWwpcmV0dXJuIHRoaXMuY2FudmFzLmRwaTtcblxuICAgICAgdmFyIElOQ0ggPSAyNS40OyAvL21tXG5cbiAgICAgIHZhciBkaW1zID0gW107XG5cbiAgICAgIGRpbXMucHVzaCh0aGlzLl9vcmlnaW5hbC53aWR0aCAvICh0aGlzLndpZHRoIC8gSU5DSCkpO1xuICAgICAgZGltcy5wdXNoKHRoaXMuX29yaWdpbmFsLmhlaWdodCAvICggdGhpcy5oZWlnaHQgLyBJTkNIKSk7XG5cblxuICAgICAgdmFyIF9kcGkgPSBkaW1zWzBdO1xuXG4gICAgICBmb3IgKHZhciBpID0gMTsgaSA8IGRpbXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaWYgKGRpbXNbaV0gPCBfZHBpKSB7XG4gICAgICAgICAgX2RwaSA9IGRpbXNbaV1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdGhpcy5kcGkgPSBfZHBpICogMTsvLy90aGlzLmNhbnZhcy5zY2FsZVg7XG5cbiAgICAgIHJldHVybiBfZHBpO1xuICAgIH0sXG4gICAgc3VwcG9ydGVkVHlwZXM6IFtcImltYWdlXCJdLFxuXG4gICAgX3NldF9lbGVtZW50OiBmdW5jdGlvbiAob3B0aW9ucywgY2FsbGJhY2spIHtcblxuICAgICAgaWYgKG9wdGlvbnMudHlwZSA9PSBcImltYWdlXCIpIHtcbiAgICAgICAgdGhpcy5fb3JpZ2luYWwgPSBvcHRpb25zLm9yaWdpbmFsO1xuICAgICAgICBmYWJyaWMuSW1hZ2UuZnJvbVVSTCgoZmFicmljLmZyYW1lc1BhdGggfHwgXCJcIiApICsgb3B0aW9ucy5zcmMsIGZ1bmN0aW9uIChvKSB7XG4gICAgICAgICAgby5vbihcInJvdGF0aW5nXCIsIGZhYnJpYy51dGlsLnN0ZXBSb3RhdGluZy5iaW5kKG8pKTtcblxuICAgICAgICAgIHRoaXMuX2NoZWNrX2RwaSgpO1xuXG4gICAgICAgICAgY2FsbGJhY2sobyk7XG4gICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICB9XG5cbiAgICB9LFxuXG5cbiAgICAvKipcbiAgICAgKiDvv73vv73vv73vv73vv73vv73vv73vv73vv70g77+977+977+977+977+9XG4gICAgICogQHBhcmFtIGRhdGEgLSDvv73vv73vv73vv73vv70g77+977+977+977+977+9XG4gICAgICovXG4gICAgX3NldF9ib3JkZXI6IGZ1bmN0aW9uIChib3JkZXIsbmFtZSkge1xuICAgICAgdGhpc1tuYW1lXSA9IGJvcmRlcjtcbiAgICAgIGlmKCFib3JkZXIpcmV0dXJuO1xuICAgICAgdGhpc1tcIl9mYWJyaWNcIiArIG5hbWVdID0gbmV3IGZhYnJpYy5QYXRoKHRoaXMuX2ZhYnJpY19zaGFwZS5wYXRoLGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoe1xuICAgICAgICBmaWxsOiBcInRyYW5zcGFyZW50XCIsXG4gICAgICAgIHNlbGVjdGFibGU6IGZhbHNlLFxuICAgICAgICBvcmlnaW5YOiBcImNlbnRlclwiLFxuICAgICAgICBvcmlnaW5ZOiBcImNlbnRlclwiXG4gICAgICB9LGJvcmRlcikpO1xuXG4gICAgICB0aGlzLmFkZCh0aGlzW1wiX2ZhYnJpY1wiICsgbmFtZV0pO1xuICAgICAgaWYoYm9yZGVyLnBvc2l0aW9uID09IFwiYmVmb3JlXCIpe1xuICAgICAgICB0aGlzLl9vYmplY3RzLnVuc2hpZnQodGhpcy5fb2JqZWN0cy5wb3AoKSk7XG4gICAgICB9XG5cbiAgICAgIHZhciBvcHRpb25zID0ge1xuICAgICAgICBsZWZ0OiAgIHRoaXMuX2ZhYnJpY19zaGFwZS5sZWZ0ICsgdGhpcy53aWR0aC8yLFxuICAgICAgICB0b3A6ICAgIHRoaXMuX2ZhYnJpY19zaGFwZS50b3AgKyB0aGlzLmhlaWdodC8yLFxuICAgICAgICBzY2FsZVg6IHRoaXMuX2ZhYnJpY19zaGFwZS5zY2FsZVggKiAoYm9yZGVyLnNjYWxlWCB8fCAxKSxcbiAgICAgICAgc2NhbGVZOiB0aGlzLl9mYWJyaWNfc2hhcGUuc2NhbGVZICogKGJvcmRlci5zY2FsZVkgfHwgMSlcbiAgICAgIH07XG5cbiAgICAgIHRoaXNbXCJfZmFicmljXCIgKyBuYW1lXS5zZXQob3B0aW9ucyk7XG4gICAgfSxcbiAgICBzZXRGcmFtZTogZnVuY3Rpb24gKGZyYW1lLGNiKSB7XG5cbiAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICBpZihmcmFtZSAmJiBmcmFtZS5zcmMpe1xuXG4gICAgICAgIGZhYnJpYy51dGlsLmxvYWRJbWFnZShmcmFtZS5zcmMsIGZ1bmN0aW9uIChpbWcpIHtcbiAgICAgICAgICBmcmFtZS5pbWFnZSA9IGltZztcbiAgICAgICAgICBfdGhpcy5fc2V0X2ZyYW1lKGZyYW1lKTtcbiAgICAgICAgICBfdGhpcy5jYW52YXMgJiYgX3RoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgICAgICAgIGNiICYmIGNiKCk7XG4gICAgICAgIH0pXG4gICAgICB9ZWxzZXtcbiAgICAgICAgX3RoaXMuX3NldF9mcmFtZShmcmFtZSk7XG4gICAgICAgIF90aGlzLmNhbnZhcyAmJiBfdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gICAgICAgIGNiICYmIGNiKCk7XG4gICAgICB9XG4gICAgfSxcbiAgICBfdXBkYXRlX2ZyYW1lOiBmdW5jdGlvbiAoKSB7XG4gICAgICBpZih0aGlzLmZyYW1lICYmIHRoaXMuZnJhbWUuaW1hZ2UgJiYgdGhpcy5mcmFtZS5zbGljZSkge1xuICAgICAgICB2YXIgX2NhbnZhcyA9IHRoaXMuX2ZhYnJpY19mcmFtZS5fZWxlbWVudDtcbiAgICAgICAgX2NhbnZhcy53aWR0aCA9IHRoaXMud2lkdGg7XG4gICAgICAgIF9jYW52YXMuaGVpZ2h0ID0gdGhpcy5oZWlnaHQ7XG4gICAgICAgIGZhYnJpYy51dGlsLmRyYXdCb3JkZXJJbWFnZShfY2FudmFzLCB0aGlzLmZyYW1lLmltYWdlLCB0aGlzLmZyYW1lKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIF9zZXRfZnJhbWU6IGZ1bmN0aW9uIChmcmFtZSkge1xuICAgICAgaWYodGhpcy5fZmFicmljX2ZyYW1lKXtcbiAgICAgICAgdGhpcy5yZW1vdmUodGhpcy5fZmFicmljX2ZyYW1lKTtcbiAgICAgICAgZGVsZXRlIHRoaXMuX2ZhYnJpY19mcmFtZTtcbiAgICAgIH1cbiAgICAgIGlmKGZyYW1lICYmIGZyYW1lLmltYWdlKSB7XG5cbiAgICAgICAgLy9cbiAgICAgICAgLy9pZiAoIWZyYW1lW1wiYm9yZGVyX2ltYWdlXCJdKSB7XG4gICAgICAgIC8vICAgIGltZy53aWR0aCA9IHRoaXMud2lkdGg7XG4gICAgICAgIC8vICAgIGltZy5oZWlnaHQgPSB0aGlzLmhlaWdodDtcbiAgICAgICAgLy99XG5cbiAgICAgICAgaWYgKGZyYW1lLndpZHRoICYmIGZyYW1lLnNsaWNlKSB7XG5cbiAgICAgICAgICAvL0NhbnZhcyBmb3IgTm9kZUpTXG4gICAgICAgICAgdmFyIGNhbnZhcyA9IHR5cGVvZiBDYW52YXMgIT09ICd1bmRlZmluZWQnICYmIG5ldyBDYW52YXMoKSB8fCBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiY2FudmFzXCIpO1xuXG4gICAgICAgICAgY2FudmFzLndpZHRoID0gdGhpcy53aWR0aDtcbiAgICAgICAgICBjYW52YXMuaGVpZ2h0ID0gdGhpcy5oZWlnaHQ7XG4gICAgICAgICAgZmFicmljLnV0aWwuZHJhd0JvcmRlckltYWdlKGNhbnZhcywgZnJhbWUuaW1hZ2UsIGZyYW1lKTtcbiAgICAgICAgICAvL3RvZG9cbiAgICAgICAgICAvL3ZhciBfc3JjID0gY2FudmFzLnRvRGF0YVVSTCgpO1xuICAgICAgICAgIC8vdmFyIGltYWdlID0gbmV3IEltYWdlKCk7XG4gICAgICAgICAgLy9pbWFnZS5zcmMgPSBfc3JjO1xuICAgICAgICAgIHRoaXMuX2ZhYnJpY19mcmFtZSA9IG5ldyBmYWJyaWMuSW1hZ2UoY2FudmFzKTtcbiAgICAgICAgICAvL1xuICAgICAgICAgIC8vdGhpcy5fZmFicmljX2ZyYW1lLndpZHRoID0gdGhpcy53aWR0aDtcbiAgICAgICAgICAvL3RoaXMuX2ZhYnJpY19mcmFtZS5oZWlnaHQgPSB0aGlzLmhlaWdodDtcblxuICAgICAgICAgIC8vdGhpcy5hZGQodGhpcy5fZmFicmljX2ZyYW1lKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLl9mYWJyaWNfZnJhbWUgPSBuZXcgZmFicmljLkltYWdlKGZyYW1lLmltYWdlKTtcbiAgICAgICAgfVxuXG5cbiAgICAgICAgdGhpcy5fZmFicmljX2ZyYW1lLnNldCh7XG4gICAgICAgICAgb3JpZ2luWDogXCJjZW50ZXJcIixcbiAgICAgICAgICBvcmlnaW5ZOiBcImNlbnRlclwiLFxuICAgICAgICAgIGhhc0NvbnRyb2xzOiBmYWxzZSxcbiAgICAgICAgICBldmVudGVkOiBmYWxzZVxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmFkZCh0aGlzLl9mYWJyaWNfZnJhbWUpO1xuICAgICAgICBpZih0aGlzLmZyYW1lICYmIHRoaXMuZnJhbWUucG9zaXRpb24gPT0gXCJiYWNrXCIpe1xuICAgICAgICAgIHRoaXMuX2ZhYnJpY19mcmFtZS5zZW5kVG9CYWNrKCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fYXBwbHlfZnJhbWUoKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuZnJhbWUgPSBmcmFtZTtcbiAgICB9LFxuXG5cbiAgICAvKipcbiAgICAgKiDvv73vv73vv73vv73vv73vv73vv73vv70g77+977+977+977+977+977+977+977+9IO+/ve+/ve+/ve+/ve+/vVxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX2NyZWF0ZV9mcmFtZTogZnVuY3Rpb24gKCkge1xuXG4gICAgICBpZiAodGhpcy5mcmFtZSkge1xuICAgICAgICB0aGlzLmZyYW1lLndpZHRoID0gdGhpcy5fZmFicmljX2ltYWdlLndpZHRoO1xuICAgICAgICB0aGlzLmZyYW1lLmhlaWdodCA9IHRoaXMuX2ZhYnJpY19pbWFnZS5oZWlnaHQ7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuX2ZhYnJpY19mcmFtZSA9IG5ldyBmYWJyaWMuSW1hZ2UodGhpcy5mcmFtZSwge1xuICAgICAgICBvcmlnaW5YOiBcImNlbnRlclwiLFxuICAgICAgICBvcmlnaW5ZOiBcImNlbnRlclwiLFxuICAgICAgICBwZXJQaXhlbFRhcmdldEZpbmQ6IHRydWUsXG4gICAgICAgIHdpZHRoOiB0aGlzLmRhdGEuZ2VvbWV0cnkud2lkdGgsXG4gICAgICAgIGhlaWdodDogdGhpcy5kYXRhLmdlb21ldHJ5LmhlaWdodFxuICAgICAgfSk7XG4gICAgfSxcbiAgICB0b09iamVjdDogZnVuY3Rpb24ocHJvcGVydGllc1RvSW5jbHVkZSl7XG4gICAgICB2YXIgb2JqZWN0ID0gdGhpcy5jYWxsU3VwZXIoJ3RvT2JqZWN0Jyxwcm9wZXJ0aWVzVG9JbmNsdWRlKTtcbiAgICAgIGRlbGV0ZSBvYmplY3QuZWxlbWVudDtcblxuICAgICAgaWYodGhpcy5lbGVtZW50KXtcbiAgICAgICAgdmFyIF9vYmoyID0gdGhpcy5lbGVtZW50LnRvT2JqZWN0KCk7XG4gICAgICAgIG9iamVjdC5zcmMgPSBfb2JqMi5zcmM7XG4gICAgICAgIG9iamVjdC5maWx0ZXJzID0gX29iajIuZmlsdGVycztcbiAgICAgIH1cbiAgICAgIG9iamVjdC5mcmFtZSA9IGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoe30sdGhpcy5mcmFtZSk7XG5cbiAgICAgIGRlbGV0ZSBvYmplY3QuZnJhbWUuaW1hZ2U7XG4gICAgICByZXR1cm4gb2JqZWN0O1xuICAgIH1cbiAgfSk7XG5cblxuICBmYWJyaWMuUGhvdG8uZnJhbWVzTWFuYWdlciA9IHtcbiAgICBhY3RpdmVPYmplY3Q6IG51bGwsXG4gICAgc2hvdzogZnVuY3Rpb24ob2JqZWN0KXtcbiAgICAgIHRoaXMuYWN0aXZlT2JqZWN0ID0gb2JqZWN0O1xuICAgICAgdGhpcy5maXJlKCdzaG93JyxvYmplY3QpO1xuICAgIH1cbiAgfTtcbiAgZmFicmljLnV0aWwub2JzZXJ2YWJsZShmYWJyaWMuUGhvdG8uZnJhbWVzTWFuYWdlcik7XG5cbiAgdmFyIF9PQkpfQUNUID0gZmFicmljLk9iamVjdC5wcm90b3R5cGUuYWN0aW9ucztcbiAgdmFyIF9QSE8gPSBmYWJyaWMuUGhvdG8ucHJvdG90eXBlO1xuICBmYWJyaWMuUGhvdG8ucHJvdG90eXBlLmFjdGlvbnMgPSBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKHt9LCBmYWJyaWMuRnJhbWUucHJvdG90eXBlLmFjdGlvbnMsIHtcbiAgICBwaG90b0ZyYW1lczoge1xuICAgICAgaW5zZXJ0OiAnZnJhbWVUb29sJyxcbiAgICAgIHRpdGxlOiBcItGA0LDQvNC+0YfQutC4XCIsXG4gICAgICBjbGFzc05hbWU6IFwiZmEgZmEtaGVhcnQtb1wiLFxuICAgICAgYWN0aW9uOiBmdW5jdGlvbigpe1xuICAgICAgICBmYWJyaWMuUGhvdG8uZnJhbWVzTWFuYWdlci5zaG93KHRoaXMuZWxlbWVudCk7XG4gICAgICB9XG4gICAgfSxcbiAgICBwaG90b0ZpbHRlcnM6IHtcbiAgICAgIGluc2VydDogJ2ZpbHRlclRvb2wnLFxuICAgICAgdGl0bGU6IFwi0YTQuNC70YzRgtGAXCIsXG4gICAgICBjbGFzc05hbWU6IFwiZmEgZmEtZmlsdGVyXCIsXG4gICAgICBhY3Rpb246IGZ1bmN0aW9uKCl7XG4gICAgICAgIGZhYnJpYy5JbWFnZS5maWx0ZXJNYW5hZ2VyLnNob3codGhpcy5lbGVtZW50KTtcbiAgICAgIH1cbiAgICB9LFxuICAgIHJlbW92ZVdoaXRlRnJvbUJvcmRlcnM6IGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoe30sZmFicmljLkltYWdlLnByb3RvdHlwZS5hY3Rpb25zLnJlbW92ZVdoaXRlRnJvbUJvcmRlcnMse1xuICAgICAgdGFyZ2V0OiBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gdGhpcy5lbGVtZW50O1xuICAgICAgfVxuICAgIH0pLFxuICAgIGhpc3RvcnlCcnVzaDogZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCh7fSxmYWJyaWMuSW1hZ2UucHJvdG90eXBlLmFjdGlvbnMuaGlzdG9yeUJydXNoLHtcbiAgICAgIHRhcmdldDogZnVuY3Rpb24oKXtcbiAgICAgICAgcmV0dXJuIHRoaXMuZWxlbWVudDtcbiAgICAgIH1cbiAgICB9KVxuICB9KTtcblxuXG5cblxuICBmYWJyaWMuUGhvdG8uZnJvbU9iamVjdCA9IGZ1bmN0aW9uKG9iamVjdCxjYWxsYmFjaykge1xuICAgIHZhciBfa2xhc3M9IHRoaXM7XG4gICAgdmFyIF9hcHAgPSBvYmplY3QuYXBwbGljYXRpb247XG4gICAgZGVsZXRlIG9iamVjdC5hcHBsaWNhdGlvbjtcbiAgICBvYmplY3QgPSBmYWJyaWMudXRpbC5vYmplY3QuY2xvbmVEZWVwKG9iamVjdCk7XG4gICAgb2JqZWN0LmFwcGxpY2F0aW9uID0gX2FwcDtcblxuICAgIGlmKG9iamVjdC5zcmMpe1xuICAgICAgb2JqZWN0LmVsZW1lbnQgPSB7XG4gICAgICAgIHR5cGU6IFwiaW1hZ2VcIixcbiAgICAgICAgc3JjOiBvYmplY3Quc3JjLFxuICAgICAgICBmaWx0ZXJzOiBvYmplY3QuZmlsdGVyc1xuICAgICAgfTtcblxuICAgICAgZGVsZXRlIG9iamVjdC5zcmM7XG4gICAgICBkZWxldGUgb2JqZWN0LmZpbHRlcnM7XG4gICAgfVxuXG5cbiAgICB2YXIgY2IgPSBmYWJyaWMudXRpbC5xdWV1ZUxvYWQoMyxmdW5jdGlvbigpe1xuICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2sobmV3IF9rbGFzcyhvYmplY3QpKTtcbiAgICB9KTtcblxuICAgIGlmKG9iamVjdC5lbGVtZW50KXtcbiAgICAgIGZhYnJpYy51dGlsLmNyZWF0ZU9iamVjdChvYmplY3QuZWxlbWVudCxmdW5jdGlvbihlbCl7XG4gICAgICAgIG9iamVjdC5lbGVtZW50ID0gZWw7XG4gICAgICAgIGNiKCk7XG4gICAgICB9KTtcbiAgICB9ZWxzZXtcbiAgICAgIGNiKCk7XG4gICAgfVxuXG5cbiAgICBpZihvYmplY3QuZnJhbWUgJiYgb2JqZWN0LmZyYW1lLnNyYykge1xuXG4gICAgICBmYWJyaWMudXRpbC5sb2FkSW1hZ2Uob2JqZWN0LmZyYW1lLnNyYywgZnVuY3Rpb24gKGltZykge1xuICAgICAgICBvYmplY3QuZnJhbWUuaW1hZ2UgPSBpbWc7XG4gICAgICAgIGNiKCk7XG4gICAgICB9KVxuICAgIH1lbHNlIHtcbiAgICAgIGNiKCk7XG4gICAgfVxuXG4gICAgaWYob2JqZWN0LnNoYXBlICYmIG9iamVjdC5zaGFwZS5zcmMpe1xuICAgICAgZmFicmljLmxvYWRTVkdGcm9tVVJMKG9iamVjdC5zaGFwZS5zcmMsZnVuY3Rpb24ocGF0aHMsb3B0aW9ucykge1xuICAgICAgICBvYmplY3Quc2hhcGUucGF0aHMgID0gcGF0aHM7XG4gICAgICAgIGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQob2JqZWN0LnNoYXBlLG9wdGlvbnMpO1xuICAgICAgICBjYigpO1xuICAgICAgfSlcbiAgICB9ZWxzZSB7XG4gICAgICBjYigpO1xuICAgIH1cblxuICB9O1xuXG4gIC8qKlxuICAgKiBJbmRpY2F0ZXMgdGhhdCBpbnN0YW5jZXMgb2YgdGhpcyB0eXBlIGFyZSBhc3luY1xuICAgKiBAc3RhdGljXG4gICAqIEB0eXBlIEJvb2xlYW5cbiAgICogQGRlZmF1bHRcbiAgICovXG4gIGZhYnJpYy5QaG90by5hc3luYyA9IHRydWU7XG5cbiAgZmFicmljLnV0aWwuY3JlYXRlQWNjZXNzb3JzKGZhYnJpYy5QaG90byk7XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL29iamVjdHMvUGhvdG8uanNcbi8vIG1vZHVsZSBpZCA9IDk1XG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIid1c2Ugc3RyaWN0JztcblxuXG4vL2ZhYnJpYy5EUEkgdG9kbyB3aHkgZG8gbm90IHVzZSBpdD9cblxuLy9mYWJyaWMucmVxdWlyZShcIlBsYWNlaG9sZGVyXCIsW1wiRnJhbWVcIixcIlRleHRGcmFtZVwiLFwiVGV4dEFyZWFNaXhpblwiLFwiVmlkZW9cIl0sIGZ1bmN0aW9uKCl7XG5cbiAgZmFicmljLlBsYWNlaG9sZGVyID0gZmFicmljLnV0aWwuY3JlYXRlQ2xhc3MoZmFicmljLkZyYW1lLCB7XG4gICAgdHlwZTogJ3BsYWNlaG9sZGVyJyxcblxuICAgIC8vc3RhdGVQcm9wZXJ0aWVzOiBmYWJyaWMuR3JvdXAucHJvdG90eXBlLnN0YXRlUHJvcGVydGllcy5jb25jYXQoW1wicG9zdGVyXCJdKSxcbiAgICBfc2NhbGluZ19ldmVudHNfZW5hYmxlZDogdHJ1ZSxcbiAgICBmaXRUZXh0OiB0cnVlLFxuICAgICAgdG9PYmplY3Q6IGZ1bmN0aW9uKHByb3BlcnRpZXNUb0luY2x1ZGUpe1xuICAgICAgICAgIHZhciBvYmplY3QgPSB0aGlzLmNhbGxTdXBlcigndG9PYmplY3QnLCBwcm9wZXJ0aWVzVG9JbmNsdWRlKTtcbiAgICAgICAgICAvL2lmKHRoaXMuY2xpcCl7XG4gICAgICAgICAgLy8gICAgb2JqZWN0LmNsaXAgPSB0aGlzLmNsaXA7XG4gICAgICAgICAgLy99XG5cbiAgICAgICAgICByZXR1cm4gb2JqZWN0O1xuICAgICAgfSxcbiAgICBpbml0aWFsaXplOiBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICBvcHRpb25zIHx8ICggb3B0aW9ucyA9IHt9KTtcblxuICAgICAgICB2YXIgX3RleHQgPSBvcHRpb25zLnRleHQ7XG4gICAgICAgIGRlbGV0ZSBvcHRpb25zLnRleHQ7XG4gICAgICAgIHRoaXMuY2FsbFN1cGVyKCdpbml0aWFsaXplJywgb3B0aW9ucyk7XG5cblxuICAgICAgICB0aGlzLnVwbG9hZEJ1dHRvbiA9IHRoaXMuX2NyZWF0ZV9idXR0b24oe1xuICAgICAgICAgICAgdGV4dDogJ++CkycsXG4gICAgICAgIH0pO1xuICAgICAgICBpZighdGhpcy5lbGVtZW50KXtcbiAgICAgICAgICAgIHRoaXMudXBsb2FkQnV0dG9uLnNldFZpc2libGUodHJ1ZSk7XG4gICAgICAgICAgICB0aGlzLmJ1dHRvbi5zZXRWaXNpYmxlKGZhbHNlKTtcbiAgICAgICAgICAgIHRoaXMuY2xpcEJ1dHRvbi5zZXRWaXNpYmxlKGZhbHNlKTtcbiAgICAgICAgfTtcblxuXG4gICAgICAgIGlmKHRoaXMudXBsb2FkQWN0aW9uKXtcbiAgICAgICAgICAgIHRoaXMudXBsb2FkQnV0dG9uLm9uKFwiY2xpY2tcIix0aGlzLnVwbG9hZEFjdGlvbi5iaW5kKHRoaXMpKTtcbiAgICAgICAgfVxuXG5cbiAgICAgICAgdGhpcy5faW5pdFRleHQoX3RleHQpO1xuXG4gICAgICAgIHRoaXMudGV4dC5zZXRPcHRpb25zKHtcbiAgICAgICAgICAgIGhvdmVyQ3Vyc29yOiBcInRleHRcIixcbiAgICAgICAgICAgIHdpZHRoOiB0aGlzLndpZHRoLFxuICAgICAgICAgICAgaGVpZ2h0OiA2MFxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLm9uKFwiY2xpcHBpbmc6ZW50ZXJlZFwiLGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB0aGlzLnRleHQuZXZlbnRlZCA9IGZhbHNlO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5vbihcImNsaXBwaW5nOmV4aXRlZFwiLGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBpZih0aGlzLnRleHQpdGhpcy50ZXh0LmV2ZW50ZWQgPSB0cnVlO1xuICAgICAgICB9KTtcblxuXG4gICAgICAgIHRoaXMudGV4dC5vbihcImVkaXRpbmc6ZXhpdGVkXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICB0aGlzLnRleHQuc2V0T3BhY2l0eSh0aGlzLnRleHQudGV4dCA/IDEgOiAwKTtcbiAgICAgICAgICAgIHRoaXMudGV4dC5ob3ZlckN1cnNvciA9IFwidGV4dFwiO1xuICAgICAgICAgICAgdGhpcy5fdXBkYXRlX2ludGVyZmFjZV9lbGVtZW50X3Bvc2l0aW9uKHRoaXMudGV4dCx0aGlzLnRleHRQb3NpdGlvbik7XG4gICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgIHRoaXMuX2NyZWF0ZV9wbGF5KCk7XG5cbiAgICAgICAgdGhpcy50ZXh0UG9zaXRpb24gPSBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKHt9LG9wdGlvbnMudGV4dFBvc2l0aW9uIHx8IHRoaXMudGV4dFBvc2l0aW9uKTtcblxuXG5cbiAgICAgICAgdmFyIHBvcyA9IGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoe30sdGhpcy50ZXh0UG9zaXRpb24sIHtlbGVtZW50OiB0aGlzLnRleHR9KTtcbiAgICAgICAgdGhpcy5fYWRkX2VsZW1lbnRfdG9fdXBkYXRlKHBvcyk7XG4gICAgfSxcbiAgICAgIHN0YXRlUHJvcGVydGllczogZmFicmljLkdyb3VwLnByb3RvdHlwZS5zdGF0ZVByb3BlcnRpZXMuY29uY2F0KFtcInBvc3RlclwiXSksXG4gICAgICBfaXNfY2xpcHBpbmdfYXZhaWxhYmxlIDogZnVuY3Rpb24oZSl7XG5cbiAgICAgICAgICBpZihlKXtcbiAgICAgICAgICAgICAgdGhpcy50ZXh0LnNldENvb3JkcygpO1xuICAgICAgICAgICAgICBpZih0aGlzLmlzUG9zc2libGVUYXJnZXQoZSx0aGlzLnRleHQpKXtcbiAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gdGhpcy5lbGVtZW50ICYmICh0aGlzLmNsaXBwaW5nU3VwcG9ydGVkVHlwZXMgPT0gXCIqXCIgfHwgdGhpcy5jbGlwcGluZ1N1cHBvcnRlZFR5cGVzLmluZGV4T2YodGhpcy5lbGVtZW50LnR5cGUpIT0gLTEpO1xuICAgICAgfSxcblxuXG4gICAgY2xpcHBpbmdTdXBwb3J0ZWRUeXBlczogW1wiaW1hZ2VcIl0sIC8vICogb3IgW1wiaW1hZ2VcIixcInZpZGVvXCIsLi4uXVxuICAgIC8qKlxuICAgICAqINCh0L7Qt9C00LDQvdC40LUg0Y3Qu9C10LzQtdC90YLQsCDRhNC+0YLQvlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgX2NyZWF0ZV9wbGF5OiBmdW5jdGlvbigpe1xuXG4gICAgICAgIHRoaXMucGxheUJ1dHRvbiA9IHRoaXMuX2NyZWF0ZV9idXR0b24oe1xuICAgICAgICAgICAgdGV4dDogJ++BiydcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5wbGF5QnV0dG9uLm9uKFwiY2xpY2tcIixmdW5jdGlvbigpe1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50LnRvZ2dsZVBsYXlQYXVzZSgpO1xuICAgICAgICAgICAgdGhpcy5wbGF5QnV0dG9uLnNldFRleHQodGhpcy5lbGVtZW50LnBhdXNlZD8gJ++Biyc6IFwi74GNXCIpO1xuICAgICAgICB9LmJpbmQodGhpcykpXG5cblxuICAgICAgICB2YXIgX3NlbGYgPSB0aGlzO1xuICAgICAgICAvL3Nob3cvaGlkZSBwbGF5L3BhdXNlIGhpbnRcbiAgICAgICAgdGhpcy5vbignbW91c2U6b3ZlcicsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIGlmKHRoaXMucGxheUF2YWlsYWJsZSl7XG4gICAgICAgICAgICAgICAgdGhpcy5wbGF5QnV0dG9uLnNldFZpc2libGUodHJ1ZSk7XG4gICAgICAgICAgICAgICAgX3NlbGYuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5vbignbW91c2U6b3V0JywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgdGhpcy5wbGF5QnV0dG9uLnNldFZpc2libGUoZmFsc2UpO1xuICAgICAgICAgICAgX3NlbGYuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG5cbiAgdXBsb2FkQWN0aW9uOiBmdW5jdGlvbigpe1xuICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgZmFicmljLnV0aWwudXBsb2FkSW1hZ2UoZnVuY3Rpb24oaW1nKXtcbiAgICAgICAgICBzZWxmLnNldEVsZW1lbnQoe1xuICAgICAgICAgICAgICB0eXBlOiBcImltYWdlXCIsXG4gICAgICAgICAgICAgIHNyYzogICB0aGlzLnNyYyxcbiAgICAgICAgICAgICAgb3JpZ2luYWw6IHtcbiAgICAgICAgICAgICAgICAgIHdpZHRoOiB0aGlzLndpZHRoLFxuICAgICAgICAgICAgICAgICAgaGVpZ2h0OiB0aGlzLmhlaWdodFxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgfSlcbiAgICAgIH0pO1xuICB9LFxuXG4gICAgXCJ0ZXh0UG9zaXRpb25cIjoge1xuICAgICAgICBib3R0b206IDAsXG4gICAgICAgIGxlZnQ6IDAgLFxuICAgICAgICByaWdodDogMFxuICAgIH0sXG4gICAgXCJ0ZXh0XCI6IHtcbiAgICAgICAgXCJ0ZXh0XCI6IFwiXCIsXG4gICAgICAgIFwiYmFja2dyb3VuZENvbG9yXCI6IFwicmdiYSgyNTUsMjU1LDI1NSwwLjUpXCJcbiAgICB9LFxuXG4gICAgc3VwcG9ydGVkVHlwZXM6IFtcImltYWdlXCIsXCJ2aWRlb1wiLFwicGF0aFwiXSxcblxuICAgICAgY3JlYXRlQnV0dG9uczpmdW5jdGlvbigpe1xuXG4gICAgICAgICAgdGhpcy5fY2xpcF9lbmRfZnVuY3Rpb24gPSAgZnVuY3Rpb24oZSl7XG4gICAgICAgICAgICAgIGlmKHRoaXMuaXNQb3NzaWJsZVRhcmdldChlLmUsdGhpcy5zdWJtaXQpKXtcbiAgICAgICAgICAgICAgICAgIHRoaXMuY2xpcFBob3RvRW5kKCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICB9LmJpbmQodGhpcyk7XG5cbiAgICAgICAgICB0aGlzLm9uKCdvYmplY3Q6Y2xpY2snLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgIHZhciB0ID0gdGhpcy5zZWFyY2hQb3NzaWJsZVRhcmdldHMoZS5lKTtcbiAgICAgICAgICAgICAgdC50YXJnZXQgJiYgdC50YXJnZXQuZmlyZShcImNsaWNrXCIpO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHRoaXMuc3VibWl0ID0gdGhpcy5fY3JlYXRlX2J1dHRvbih7XG4gICAgICAgICAgICAgIHRleHQ6IFwi74CMXCIsXG4gICAgICAgICAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgICAgICAgICAgIHZpc2libGU6IGZhbHNlXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIHBvc2l0aW9uOntcbiAgICAgICAgICAgICAgICAgIHRvcDogMCxcbiAgICAgICAgICAgICAgICAgIHJpZ2h0OiAyNlxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICB0aGlzLnN1Ym1pdC5vbihcImNsaWNrXCIsdGhpcy5jbGlwUGhvdG9FbmQuYmluZCh0aGlzKSk7XG5cbiAgICAgICAgICB0aGlzLmNsaXBCdXR0b24gPSB0aGlzLl9jcmVhdGVfYnV0dG9uKHtcbiAgICAgICAgICAgICAgdGV4dDogXCLvhKVcIixcbiAgICAgICAgICAgICAgb3B0aW9uczoge1xuICAgICAgICAgICAgICAgICAgdmlzaWJsZTogZmFsc2VcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgcG9zaXRpb246e1xuICAgICAgICAgICAgICAgICAgdG9wOiAwLFxuICAgICAgICAgICAgICAgICAgcmlnaHQ6IDI2XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIHRoaXMuY2xpcEJ1dHRvbi5vbihcImNsaWNrXCIsdGhpcy5jbGlwUGhvdG9TdGFydC5iaW5kKHRoaXMpKTtcblxuICAgICAgICAgIC8vc2hvdy9oaWRlIHBsYXkvcGF1c2UgaGludFxuICAgICAgICAgIHRoaXMub24oJ21vdXNlOm92ZXInLCBmdW5jdGlvbihlKSB7XG4gICAgICAgICAgICAgIGlmKHRoaXMuZWxlbWVudCAmJiAhdGhpcy5lbGVtZW50Ll9lZGl0ZWQgfHwgdGhpcy5fcGVuZGluZyl7XG4gICAgICAgICAgICAgICAgICB0aGlzLmJ1dHRvbi5zZXRPcGFjaXR5KDEpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGlmKHRoaXMuX2lzX2NsaXBwaW5nX2F2YWlsYWJsZSgpKXtcbiAgICAgICAgICAgICAgICAgIHRoaXMuY2xpcEJ1dHRvbi5zZXRPcGFjaXR5KDEpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgdGhpcy5vbignbW91c2U6b3V0JywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICBpZighdGhpcy5fcGVuZGluZyl7XG4gICAgICAgICAgICAgICAgICB0aGlzLmJ1dHRvbi5zZXRPcGFjaXR5KDApO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHRoaXMuY2xpcEJ1dHRvbi5zZXRPcGFjaXR5KDApO1xuICAgICAgICAgICAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIHRoaXMuX2NyZWF0ZV9yZW1vdmVfYnV0dG9uKCk7XG5cbiAgICAgICAgICBpZih0aGlzLmVsZW1lbnQpe1xuICAgICAgICAgICAgICB0aGlzLl9zZXRfZWxlbWVudF9jYWxsYmFjayh0aGlzLmVsZW1lbnQpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHRoaXMub24oJ2FkZGVkJyxmdW5jdGlvbigpe1xuICAgICAgICAgICAgICB0aGlzLmNhbnZhcy5vbignbW91c2U6bW92ZScsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICAgIGlmKGUudGFyZ2V0ID09IHRoaXMgfHwgZS50YXJnZXQgPT0gdGhpcy5lbGVtZW50KXtcbiAgICAgICAgICAgICAgICAgICAgICB2YXIgdGFyZ2V0ID0gdGhpcy5zZWFyY2hQb3NzaWJsZVRhcmdldHMoZS5lKS50YXJnZXQgO1xuXG4gICAgICAgICAgICAgICAgICAgICAgaWYodGFyZ2V0KXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jYW52YXMuaG92ZXJDdXJzb3IgPSB0YXJnZXQuaG92ZXJDdXJzb3IgfHwgXCJtb3ZlXCI7XG4gICAgICAgICAgICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2FudmFzLmhvdmVyQ3Vyc29yID0gJ21vdmUnO1xuICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgICAgICAvL2lmKGUudGFyZ2V0ID09IHRoaXMgfHwgZS50YXJnZXQgPT0gdGhpcy5lbGVtZW50ICYmICB0aGlzLmlzUG9zc2libGVUYXJnZXQoZS5lLHRoaXMuc3VibWl0KSl7XG4gICAgICAgICAgICAgICAgICAvLyAgICB0aGlzLmNhbnZhcy5ob3ZlckN1cnNvciA9ICdwb2ludGVyJztcbiAgICAgICAgICAgICAgICAgIC8vfWVsc2V7XG4gICAgICAgICAgICAgICAgICAvLyAgICB0aGlzLmNhbnZhcy5ob3ZlckN1cnNvciA9ICdtb3ZlJztcbiAgICAgICAgICAgICAgICAgIC8vfVxuICAgICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgdGhpcy5vbihcImNsaXBwaW5nOmVudGVyZWRcIixmdW5jdGlvbigpe1xuICAgICAgICAgICAgICB0aGlzLnN1Ym1pdC5zZXRWaXNpYmxlKHRydWUpO1xuICAgICAgICAgICAgICB0aGlzLmNsaXBCdXR0b24uc2V0VmlzaWJsZShmYWxzZSk7XG4gICAgICAgICAgICAgIHRoaXMuYnV0dG9uLnNldFZpc2libGUoZmFsc2UpO1xuICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG5cbiAgICAgICAgICB0aGlzLm9uKFwiY2xpcHBpbmc6ZXhpdGVkXCIsZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgdGhpcy5zdWJtaXQuc2V0VmlzaWJsZShmYWxzZSk7XG4gICAgICAgICAgICAgIHRoaXMuY2xpcEJ1dHRvbi5zZXRWaXNpYmxlKHRydWUpO1xuICAgICAgICAgICAgICB0aGlzLmJ1dHRvbi5zZXRWaXNpYmxlKHRydWUpO1xuICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG5cblxuICAgICAgICAgIHRoaXMub24oXCJlbGVtZW50OmxvYWRpbmdcIixmdW5jdGlvbigpe1xuICAgICAgICAgICAgICB0aGlzLmJ1dHRvbi5zZXRUZXh0KFwi74CNXCIpO1xuICAgICAgICAgICAgICB0aGlzLmJ1dHRvbi5zZXRWaXNpYmxlKGZhbHNlKTtcbiAgICAgICAgICAgICAgLy90aGlzLmJ1dHRvbi5mYWxzZSh2YWwgPyAyNjogMzIpO1xuICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG5cbiAgICAgICAgICB0aGlzLm9uKFwiZWxlbWVudDpsb2FkZWRcIixmdW5jdGlvbigpe1xuICAgICAgICAgICAgICB0aGlzLmJ1dHRvbi5zZXRUZXh0KFwi74SQXCIpO1xuICAgICAgICAgICAgICB0aGlzLmJ1dHRvbi5zZXRWaXNpYmxlKHRydWUpO1xuICAgICAgICAgICAgICAvL3RoaXMuYnV0dG9uLnNldEZvbnRTaXplKHZhbCA/IDI2OiAzMik7XG4gICAgICAgICAgfS5iaW5kKHRoaXMpKTtcblxuICAgICAgICAgIHRoaXMub24oXCJlbGVtZW50OmxvYWRlZFwiLGZ1bmN0aW9uKCl7XG5cbiAgICAgICAgICAgICAgaWYodGhpcy5faXNfY2xpcHBpbmdfYXZhaWxhYmxlKCkpIHtcbiAgICAgICAgICAgICAgICAgIHRoaXMuY2xpcEJ1dHRvbi5zZXRWaXNpYmxlKHRydWUpO1xuICAgICAgICAgICAgICAgICAgdGhpcy5idXR0b24uc2V0VmlzaWJsZSh0cnVlKTtcbiAgICAgICAgICAgICAgICAgIHRoaXMuZWxlbWVudC5vbihcImRibGNsaWNrXCIsIHRoaXMuY2xpcFBob3RvRW5kLmJpbmQodGhpcykpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgfSlcbiAgICAgIH0sXG5cbiAgICAgIF9jcmVhdGVfYnV0dG9uIDogZnVuY3Rpb24oZGF0YSl7XG4gICAgICAgICAgdmFyIGJ0biA9IG5ldyBmYWJyaWMuVGV4dChkYXRhLnRleHQgfHwgXCLvgIxcIiwgZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCh7XG4gICAgICAgICAgICAgIG9yaWdpblg6IFwiY2VudGVyXCIsXG4gICAgICAgICAgICAgIG9yaWdpblk6IFwiY2VudGVyXCIsXG4gICAgICAgICAgICAgIHZpc2libGU6IGZhbHNlLFxuICAgICAgICAgICAgICB3aWR0aDogMTYsXG4gICAgICAgICAgICAgIGhlaWdodDogMTYsXG4gICAgICAgICAgICAgIGZvbnRTaXplOiAyNixcbiAgICAgICAgICAgICAgZm9udEZhbWlseTogXCJGb250QXdlc29tZVwiLFxuICAgICAgICAgICAgICBmaWxsOiBcIndoaXRlXCIsXG4gICAgICAgICAgICAgIHNoYWRvdzogeyBjb2xvcjogJyMwMDAnLCBvZmZzZXRYOiAxLG9mZnNldFkgOiAxLGJsdXI6IDUgfSxcbiAgICAgICAgICAgICAgaG92ZXJDdXJzb3I6IFwicG9pbnRlclwiXG4gICAgICAgICAgfSxkYXRhLm9wdGlvbnMpKTtcblxuICAgICAgICAgIHRoaXMuX2FkZF9lbGVtZW50X3RvX3VwZGF0ZShmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKHtcbiAgICAgICAgICAgICAgZWxlbWVudDogYnRuXG4gICAgICAgICAgfSxkYXRhLnBvc2l0aW9uKSk7XG5cbiAgICAgICAgICB0aGlzLmFkZChidG4pO1xuXG4gICAgICAgICAgYnRuLnNldENvb3JkcygpO1xuICAgICAgICAgIHJldHVybiBidG47XG4gICAgICB9LFxuXG4gICAgX3JlbW92ZV9lbGVtZW50OiBmdW5jdGlvbigpe1xuXG4gICAgICAgIGlmKHRoaXMuZWxlbWVudCl7XG4gICAgICAgICAgICBpZih0aGlzLmVsZW1lbnQudHlwZSA9PSBcInZpZGVvXCIpe1xuICAgICAgICAgICAgICAgIHRoaXMucGxheUF2YWlsYWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIC8vIHRoaXMuZWxlbWVudC5tZWRpYUVsZW1lbnQucGF1c2UoKTtcbiAgICAgICAgICAgICAgICAvLyB0aGlzLmVsZW1lbnQubWVkaWFFbGVtZW50LmN1cnJlbnRUaW1lID0gMDtcbiAgICAgICAgICAgICAgICB0aGlzLnBhdXNlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgLy8gICAgZGVsZXRlIHRoaXMuZWxlbWVudC5tZWRpYUVsZW1lbnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnVwbG9hZEJ1dHRvbi5zZXRWaXNpYmxlKHRydWUpO1xuICAgICAgICAgICAgdGhpcy50ZXh0LnNldFZpc2libGUoZmFsc2UpO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBfc2V0X2VsZW1lbnQ6IGZ1bmN0aW9uKG9wdGlvbnMsY2FsbGJhY2spe1xuXG4gICAgICAgIHRoaXMudGV4dCAmJiB0aGlzLnRleHQuc2V0VmlzaWJsZSh0cnVlKTtcbiAgICAgICAgdGhpcy51cGxvYWRCdXR0b24gJiYgdGhpcy51cGxvYWRCdXR0b24uc2V0VmlzaWJsZShmYWxzZSk7XG4gICAgICAgIGlmKG9wdGlvbnMudHlwZSA9PSBcImltYWdlXCIpe1xuICAgICAgICAgICAgdGhpcy5fb3JpZ2luYWwgPSBvcHRpb25zLm9yaWdpbmFsO1xuICAgICAgICAgICAgZmFicmljLkltYWdlLmZyb21VUkwob3B0aW9ucy5zcmMsZnVuY3Rpb24obyl7XG4gICAgICAgICAgICAgICAgby5vbihcInJvdGF0aW5nXCIsIGZhYnJpYy51dGlsLnN0ZXBSb3RhdGluZy5iaW5kKG8pKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhvKTtcbiAgICAgICAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYob3B0aW9ucy50eXBlID09IFwidmlkZW9cIil7XG4gICAgICAgICAgICB0aGlzLl9vcmlnaW5hbCA9IG9wdGlvbnMub3JpZ2luYWw7XG4gICAgICAgICAgICBvcHRpb25zLm9yaWdpblggPSBcImNlbnRlclwiO1xuICAgICAgICAgICAgb3B0aW9ucy5vcmlnaW5ZID0gXCJjZW50ZXJcIjtcbiAgICAgICAgICAgIG9wdGlvbnMud2lkdGggPSBvcHRpb25zLndpZHRoIHx8IG9wdGlvbnMub3JpZ2luYWwud2lkdGg7XG4gICAgICAgICAgICBvcHRpb25zLmhlaWdodCA9IG9wdGlvbnMuaGVpZ2h0IHx8IG9wdGlvbnMub3JpZ2luYWwuaGVpZ2h0O1xuXG4gICAgICAgICAgICB2YXIgZWwgPSBmYWJyaWMuVmlkZW8uZnJvbU9iamVjdChvcHRpb25zKTtcblxuXG5cbiAgICAgICAgICAgIGVsLm9uKFwicm90YXRpbmdcIiwgZmFicmljLnV0aWwuc3RlcFJvdGF0aW5nLmJpbmQoZWwpKTtcbiAgICAgICAgICAgIGVsLm9uKFwicmVhZHlcIiwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICB0aGlzLnBsYXlBdmFpbGFibGUgPSB0cnVlO1xuICAgICAgICAgICAgfS5iaW5kKHRoaXMpKTtcbiAgICAgICAgICAgIGNhbGxiYWNrKGVsKTtcbiAgICAgICAgfVxuXG4gICAgfVxuXG59KTtcblxuXG4gICAgZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuUGxhY2Vob2xkZXIucHJvdG90eXBlLGZhYnJpYy5UZXh0QXJlYU1peGluKTtcbiAgICBmYWJyaWMudXRpbC5jcmVhdGVBY2Nlc3NvcnMoZmFicmljLlBsYWNlaG9sZGVyKTtcbiAgICAvKipcbiAgICAgKiBAYXV0aG9yIERlbmlzIFBvbm9tYXJldlxuICAgICAqIEBlbWFpbCBkZW4ucG9ub21hcmV2QGdtYWlsLmNvbVxuICAgICAqL1xuICAgIGZhYnJpYy5QbGFjZWhvbGRlci5mcm9tT2JqZWN0ID0gZnVuY3Rpb24ob2JqZWN0LCBjYWxsYmFjaykge1xuXG4gICAgICAgIHZhciBpbnN0YW5jZSA9IG5ldyBmYWJyaWMuUGxhY2Vob2xkZXIob2JqZWN0KTtcbiAgICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2soaW5zdGFuY2UpO1xuICAgIH07XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL29iamVjdHMvUGxhY2Vob2xkZXIuanNcbi8vIG1vZHVsZSBpZCA9IDk2XG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIid1c2Ugc3RyaWN0JztcbnZhciBCZXppZXIgPSByZXF1aXJlKFwiLi8uLi9wbHVnaW5zL2JlemllclwiKTtcbnJlcXVpcmUoXCIuLy4uL21peGlucy9CZXppZXJNaXhpblwiKTtcblxuZmFicmljLlBvbHlsaW5lID0gZmFicmljLnV0aWwuY3JlYXRlQ2xhc3MoZmFicmljLk9iamVjdCwgZmFicmljLkJlemllck1peGluLHtcbiAgdHlwZTogJ3BvbHlsaW5lJyxcbiAgaGFzUm90YXRpbmdQb2ludDogZmFsc2UsXG4gIHN0cm9rZTogXCJibGFja1wiLFxuICBwb2ludHNMaW1pdHM6IGZhbHNlLFxuICBoYXNCb3VuZHNDb250cm9sczogZmFsc2UsXG4gIGNsb3NlZDogZmFsc2UsXG4gIGNvcm5lclNpemU6IDE2LFxuICBlbmRlckFyZWFTaXplOiA0LFxuICBleHRlbnNpb25BcmVhRW5hYmxlZDogdHJ1ZSxcbiAgY29ybmVyU3R5bGU6IFwicmVjdFwiLFxuICBtYXhpbXVtUG9pbnRzOiA0LFxuICBwb2ludHM6IFtdLFxuICBfY29ybmVyX2N1cnNvcnMgOiB7XG4gICAgeDogICdidXR0b25DdXJzb3InLFxuICAgIHA6ICAnZGVmYXVsdEN1cnNvcicsXG4gICAgZTogICd0YXJnZXRDdXJzb3InXG4gIH0sXG4gIF9jb3JuZXJfYWN0aW9ucyA6IHtcbiAgICB4MTogXCJhZGRcIixcbiAgICB4MjogXCJyZW1vdmVcIixcbiAgICBlMTogXCJ1bnNoaWZ0XCIsXG4gICAgZTI6IFwicHVzaFwiXG4gIH0sXG4gIHN0YXRlUHJvcGVydGllczogW1widG9wXCIsIFwibGVmdFwiLCBcIndpZHRoXCIsIFwiaGVpZ2h0XCIsIFwiYW5nbGVcIiwgXCJwb2ludHNcIl0sXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgb3B0aW9ucyB8fCAoIG9wdGlvbnMgPSB7fSk7XG4gICAgb3B0aW9ucy5wb2ludHMgPSBmYWJyaWMudXRpbC5vYmplY3QuY2xvbmVEZWVwKG9wdGlvbnMucG9pbnRzKTtcblxuICAgIHRoaXMuY2FsbFN1cGVyKCdpbml0aWFsaXplJywgb3B0aW9ucyk7XG5cbiAgICB0aGlzLm9uKHtcbiAgICAgIFwiYWRkZWRcIjogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnNldENvb3JkcygpO1xuICAgICAgfSxcbiAgICAgIFwibW91c2Vkb3duXCI6IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICBpZiAodGhpcy5fX2Nvcm5lci8qICYmIHRoaXMuX19jb3JuZXJbMF0gPT0gXCJlXCIqLykge1xuICAgICAgICAgIHRoaXMuY2FudmFzLl90cmFuc2Zvcm1PYmplY3QoZXZlbnQuZSk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBcIm1vdXNlb3V0XCI6IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICBpZiAodGhpcy5fX21hZ25ldF9wb2ludCB8fCB0aGlzLl9fbWFnbmV0X2Nvb3JkaW5hdGUpIHtcbiAgICAgICAgICBkZWxldGUgdGhpcy5fX21hZ25ldF9jb29yZGluYXRlO1xuICAgICAgICAgIGRlbGV0ZSB0aGlzLl9fbWFnbmV0X3BvaW50O1xuICAgICAgICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgICAgICAgIHRoaXMuc2V0Q29vcmRzKCk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBcIm1vdXNlbW92ZVwiOiBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgdmFyIHBvaW50ZXIgPSB0aGlzLmNhbnZhcy5nZXRQb2ludGVyKGV2ZW50LmUpO1xuICAgICAgICBpZiAodGhpcy5fX2Nvcm5lcikge1xuICAgICAgICAgIGlmKHRoaXMuX19jb3JuZXJbMF0gIT0gXCJ4XCIpe1xuICAgICAgICAgICAgdGhpcy5fX21hZ25ldF9wb2ludCA9IHRoaXMuX2NvbnRyb2xzW3RoaXMuX19jb3JuZXJdO1xuICAgICAgICAgICAgdGhpcy5zZXRDb29yZHMoKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHRoaXMuX19jb3JuZXJbMF0gPT0gXCJlXCIpIHtcbiAgICAgICAgICAgIHRoaXMuX19tYWduZXRfY29vcmRpbmF0ZSA9IHt4OiBwb2ludGVyLnggLSB0aGlzLmxlZnQsIHk6IHBvaW50ZXIueSAtIHRoaXMudG9wfTtcbiAgICAgICAgICAgIC8vIHRoaXMuc2V0Q29udHJvbFBvaW50cygpO1xuICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5fX21hZ25ldF9jb29yZGluYXRlKSB7XG4gICAgICAgICAgICBkZWxldGUgdGhpcy5fX21hZ25ldF9jb29yZGluYXRlO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAodGhpcy5fX21hZ25ldF9jb29yZGluYXRlKSB7XG4gICAgICAgICAgICBkZWxldGUgdGhpcy5fX21hZ25ldF9wb2ludDtcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLl9fbWFnbmV0X2Nvb3JkaW5hdGU7XG4gICAgICAgICAgICB0aGlzLnNldENvb3JkcygpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGlmKHRoaXMuc2hhZG93KXtcbiAgICAgIHRoaXMuc2V0U2hhZG93KHRoaXMuc2hhZG93KTtcbiAgICB9XG4gICAgdGhpcy5zZXRQb2ludHMob3B0aW9ucy5wb2ludHMpO1xuICAgIHRoaXMudXBkYXRlQmJveCgpO1xuICB9LFxuICBfcGVyZm9ybVB1c2hBY3Rpb246IGZ1bmN0aW9uIChlLCB0cmFuc2Zvcm0sIHBvaW50ZXIpIHtcbiAgICBkZWxldGUgdGhpcy5fX21hZ25ldF9jb29yZGluYXRlO1xuICAgIHRoaXMucG9pbnRzLnB1c2goe1xuICAgICAgeDogcG9pbnRlci54IC0gdGhpcy5sZWZ0LFxuICAgICAgeTogcG9pbnRlci55IC0gdGhpcy50b3AsXG4gICAgfSk7XG4gICAgdHJhbnNmb3JtLmFjdGlvbiA9IFwic2hhcGVcIjtcbiAgICB0cmFuc2Zvcm0uY29ybmVyID0gXCJwXCIgKyB0aGlzLnBvaW50cy5sZW5ndGg7XG4gICAgdGhpcy5jYW52YXMuc2V0Q3Vyc29yKHRoaXMuY2FudmFzLmZyZWVEcmF3aW5nQ3Vyc29yKTtcbiAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgfSxcbiAgX3BlcmZvcm1VbnNoaWZ0QWN0aW9uOiBmdW5jdGlvbiAoZSwgdHJhbnNmb3JtLCBwb2ludGVyKSB7XG4gICAgZGVsZXRlIHRoaXMuX19tYWduZXRfY29vcmRpbmF0ZTtcbiAgICB0aGlzLnBvaW50cy51bnNoaWZ0KHtcbiAgICAgIHg6IHBvaW50ZXIueCAtIHRoaXMubGVmdCxcbiAgICAgIHk6IHBvaW50ZXIueSAtIHRoaXMudG9wLFxuICAgIH0pO1xuICAgIHRyYW5zZm9ybS5hY3Rpb24gPSBcInNoYXBlXCI7XG4gICAgdHJhbnNmb3JtLmNvcm5lciA9IFwicDFcIjtcbiAgICB0aGlzLmNhbnZhcy5zZXRDdXJzb3IodGhpcy5jYW52YXMuZnJlZURyYXdpbmdDdXJzb3IpO1xuICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICB9LFxuXG4gIGRyYXdDb250cm9sc0ludGVyZmFjZTogZnVuY3Rpb24gKGN0eCkge1xuICAgIHRoaXMuZHJhd0JlemllclNoYXBlQ29udHJvbHMoY3R4KTtcbiAgICB0aGlzLl9kcmF3TWFnbmV0TGluZShjdHgpO1xuICB9LFxuICBfZHJhd01hZ25ldExpbmU6IGZ1bmN0aW9uKGN0eCl7XG4gICAgaWYodGhpcy5fX21hZ25ldF9wb2ludCAmJiB0aGlzLl9fbWFnbmV0X2Nvb3JkaW5hdGUpe1xuICAgICAgY3R4LnRyYW5zbGF0ZSgtdGhpcy53aWR0aC8yLCAtIHRoaXMuaGVpZ2h0LzIpXG4gICAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgICBjdHgubGluZVdpZHRoID0gMyA7XG4gICAgICBjdHguc3Ryb2tlU3R5bGUgPSBcInJlZFwiO1xuICAgICAgY3R4Lm1vdmVUbyh0aGlzLl9fbWFnbmV0X3BvaW50LngsIHRoaXMuX19tYWduZXRfcG9pbnQueSk7XG4gICAgICBjdHgubGluZVRvKHRoaXMuX19tYWduZXRfY29vcmRpbmF0ZS54LCB0aGlzLl9fbWFnbmV0X2Nvb3JkaW5hdGUueSk7XG4gICAgICBjdHguc3Ryb2tlKCk7XG4gICAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgICBjdHguYXJjKHRoaXMuX19tYWduZXRfY29vcmRpbmF0ZS54LCB0aGlzLl9fbWFnbmV0X2Nvb3JkaW5hdGUueSwgdGhpcy5jb3JuZXJTaXplIC8gMiwgMCwgTWF0aC5QSSAqIDIsIHRydWUpO1xuICAgICAgY3R4LmNsb3NlUGF0aCgpO1xuICAgICAgY3R4LmZpbGwoKTtcbiAgICB9XG4gIH0sXG4gIF9yZW5kZXI6IGZ1bmN0aW9uIChjdHgsIG5vVHJhbnNmb3JtKSB7XG4gICAgdmFyIHggPSBub1RyYW5zZm9ybSA/IHRoaXMubGVmdCA6IC10aGlzLndpZHRoIC8gMiAsXG4gICAgICAgIHkgPSBub1RyYW5zZm9ybSA/IHRoaXMudG9wIDogLXRoaXMuaGVpZ2h0IC8gMixcbiAgICAgICAgX3BjO1xuXG4gICAgY3R4LnNhdmUoKTtcbiAgICBjdHgudHJhbnNsYXRlKHgseSk7XG4gICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgIGN0eC5tb3ZlVG8odGhpcy5wb2ludHNbMF0ueCwgIHRoaXMucG9pbnRzWzBdLnkpO1xuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnBvaW50cy5sZW5ndGggLSAxOyBpKyspIHtcblxuICAgICAgaWYodGhpcy5wb2ludHNbaV0uY3VydmUpIHtcbiAgICAgICAgaWYoIXRoaXMucG9pbnRzW2ldLm91dGxpbmUpe1xuICAgICAgICAgIF9wYyA9IHRoaXMucG9pbnRzW2ldLmN1cnZlLnBvaW50cztcbiAgICAgICAgICBjdHgucXVhZHJhdGljQ3VydmVUbyggX3BjWzFdLngsICBfcGNbMV0ueSxfcGNbMl0ueCxfcGNbMl0ueSk7XG4gICAgICAgIH1cbiAgICAgIH1lbHNle1xuICAgICAgICBjdHgubGluZVRvKCB0aGlzLnBvaW50c1tpICsgMV0ueCwgIHRoaXMucG9pbnRzW2kgKyAxXS55KTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYodGhpcy5jbG9zZWQpe1xuICAgICAgaWYodGhpcy5wb2ludHNbdGhpcy5wb2ludHMubGVuZ3RoIC0gMV0uY3VydmUpIHtcbiAgICAgICAgX3BjID0gdGhpcy5wb2ludHNbaV0uY3VydmUucG9pbnRzO1xuICAgICAgICBjdHgucXVhZHJhdGljQ3VydmVUbyhfcGNbMV0ueCwgIF9wY1sxXS55LCBfcGNbMl0ueCxfcGNbMl0ueSk7XG4gICAgICB9XG4gICAgICBjdHguY2xvc2VQYXRoKCk7XG4gICAgfVxuICAgIHRoaXMuY2xvc2VkICYmIHRoaXMuX3JlbmRlckZpbGwoY3R4KTtcblxuICAgIHRoaXMuX3JlbmRlclN0cm9rZShjdHgpO1xuXG5cbiAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgZm9yIChpID0gMDsgaSA8IHRoaXMucG9pbnRzLmxlbmd0aCAtIDE7IGkrKykge1xuICAgICAgaWYgKHRoaXMucG9pbnRzW2ldLm91dGxpbmUpIHtcbiAgICAgICAgdmFyIF9jaSA9IDA7XG4gICAgICAgIHdoaWxlKCF0aGlzLnBvaW50c1tpXS5vdXRsaW5lLmN1cnZlc1srK19jaV0uX2xpbmVhcil7XG4gICAgICAgICAgdGhpcy5kcmF3Q3VydmUoY3R4LCB0aGlzLnBvaW50c1tpXS5vdXRsaW5lLmN1cnZlc1tfY2ldKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnBvaW50c1tpXS5vdXRsaW5lLl9fbWlkZGxlID0gX2NpO1xuICAgICAgfVxuICAgIH1cbiAgICBmb3IgKGkgPSB0aGlzLnBvaW50cy5sZW5ndGg7IGkgLS07KSB7XG4gICAgICBpZiAodGhpcy5wb2ludHNbaV0ub3V0bGluZSkge1xuICAgICAgICBfY2kgPSB0aGlzLnBvaW50c1tpXS5vdXRsaW5lLl9fbWlkZGxlO1xuICAgICAgICB3aGlsZSh0aGlzLnBvaW50c1tpXS5vdXRsaW5lLmN1cnZlc1srK19jaV0pe1xuICAgICAgICAgIHRoaXMuZHJhd0N1cnZlKGN0eCwgdGhpcy5wb2ludHNbaV0ub3V0bGluZS5jdXJ2ZXNbX2NpXSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgY3R4LmNsb3NlUGF0aCgpO1xuICAgIHRoaXMuX3JlbmRlckZpbGwoY3R4KTtcbiAgICB0aGlzLl9yZW5kZXJTdHJva2UoY3R4KTtcblxuICAgIGN0eC5yZXN0b3JlKCk7XG4gIH0sXG4gIG1lcmdlOiBmdW5jdGlvbiAocG9seWxpbmUscEluZGV4MSxwSW5kZXgyKSB7XG4gICAgdmFyIGksXG4gICAgICAgIF94ID0gcG9seWxpbmUubGVmdCAtIHRoaXMubGVmdCxcbiAgICAgICAgX3kgPSBwb2x5bGluZS50b3AgLSB0aGlzLnRvcCxcbiAgICAgICAgX3BvaW50cyA9IHRoaXMucG9pbnRzLFxuICAgICAgICBfYWN0aW9uLFxuICAgICAgICBfUFAgPSBwb2x5bGluZS5wb2ludHM7XG5cbiAgICBpZihwSW5kZXgxKSB7XG4gICAgICBfYWN0aW9uID0gXCJwdXNoXCI7XG4gICAgICBfcG9pbnRzLnBvcCgpO1xuICAgIH1lbHNle1xuICAgICAgX2FjdGlvbiA9IFwidW5zaGlmdFwiO1xuICAgICAgX3BvaW50cy5zaGlmdCgpO1xuICAgIH1cbiAgICB2YXIgYWRkUG9pbnQgPSBmdW5jdGlvbiAobWFpbl9wb2ludCxyZXZlcnNlUG9pbnQpe1xuICAgICAgdmFyIGN1cnZlX3BvaW50ID0gcmV2ZXJzZVBvaW50ICYmIHJldmVyc2VQb2ludC5jO1xuICAgICAgdmFyIG5ld19wb2ludCA9IHtcbiAgICAgICAgeDogbWFpbl9wb2ludC54ICsgX3gsXG4gICAgICAgIHk6IG1haW5fcG9pbnQueSArIF95LFxuICAgICAgfTtcbiAgICAgIGlmKGN1cnZlX3BvaW50KXtcbiAgICAgICAgbmV3X3BvaW50LmMgPSB7XG4gICAgICAgICAgeDogY3VydmVfcG9pbnQueCArIF94LFxuICAgICAgICAgIHk6IGN1cnZlX3BvaW50LnkgKyBfeSxcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgX3BvaW50c1tfYWN0aW9uXShuZXdfcG9pbnQpO1xuICAgIH07XG4gICAgaWYocEluZGV4MiA9PSAwKXtcbiAgICAgIGZvcihpID0gMCA7IGkgPCBfUFAubGVuZ3RoOyBpKyspe1xuICAgICAgICBhZGRQb2ludChfUFBbaV0gLCBfUFBbcEluZGV4MSA/IGkgOiAgaSAtIDFdKTtcbiAgICAgIH1cbiAgICB9ZWxzZXtcbiAgICAgIGZvcihpID0gX1BQLmxlbmd0aCA7IGktLTspe1xuICAgICAgICBhZGRQb2ludChfUFBbaV0gLCBfUFBbcEluZGV4MSA/IGkgLSAxOiBpXSk7XG4gICAgICB9XG4gICAgfVxuICAgIHBvbHlsaW5lLnJlbW92ZSgpO1xuICAgIGZvcihpID0wOyBpIDwgX3BvaW50cy5sZW5ndGg7IGkrKyl7XG4gICAgICBpZihfcG9pbnRzW2ldLmMgJiYgIV9wb2ludHNbaV0uY3VydmUpe1xuICAgICAgICB0aGlzLl9tYWtlQ3VydmUoX3BvaW50c1tpXSxfcG9pbnRzW2ldLmMsX3BvaW50c1tpICsgMV0pO1xuICAgICAgfVxuICAgIH1cbiAgICB0aGlzLnVwZGF0ZUJib3goKTtcbiAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgfSxcbiAgZ2V0Q29udHJvbFBvaW50OiBmdW5jdGlvbiAoaWQpIHtcbiAgICByZXR1cm4gZmFicmljLnV0aWwub2JqZWN0LmZpbmRXaGVyZSh0aGlzLl9jb250cm9scyx7aWQ6IGlkfSk7XG4gIH0sXG4gIHNldEV4dHJhQ29udHJvbHM6IGZ1bmN0aW9uKGNvbnRyb2xzKXtcbiAgICB0aGlzLmFkZFBvaW50c0NvbnRyb2xzKGNvbnRyb2xzKTtcbiAgICB0aGlzLmFkZEV4dGVuc2lvbkFyZWFDb250cm9scyhjb250cm9scyk7XG4gIH0sXG4gIGFkZEV4dGVuc2lvbkFyZWFDb250cm9sczogZnVuY3Rpb24oY29udHJvbHMpe1xuXG4gICAgdmFyICBwdHMgPSB0aGlzLnBvaW50cztcbiAgICB2YXIgX2xhc3QgPSBwdHMubGVuZ3RoIC0gMTtcbiAgICBpZih0aGlzLmV4dGVuc2lvbkFyZWFFbmFibGVkKXtcbiAgICAgIGNvbnRyb2xzW1wiZTFcIl0gPSB7XG4gICAgICAgIGFjdGlvbjogXCJ1bnNoaWZ0XCIsXG4gICAgICAgIHg6IHB0c1swXS54LFxuICAgICAgICB5OiBwdHNbMF0ueSxcbiAgICAgICAgc3R5bGU6IHRoaXMuY29ybmVyU3R5bGUsXG4gICAgICAgIGFyZWE6ICB0aGlzLmVuZGVyQXJlYVNpemUsXG4gICAgICAgIHZpc2libGU6IHRydWVcbiAgICAgIH07XG4gICAgICBjb250cm9sc1tcImUyXCJdID0ge1xuICAgICAgICBhY3Rpb246IFwicHVzaFwiLFxuICAgICAgICB4OiBwdHNbX2xhc3RdLngsXG4gICAgICAgIHk6IHB0c1tfbGFzdF0ueSxcbiAgICAgICAgc3R5bGU6IHRoaXMuY29ybmVyU3R5bGUsXG4gICAgICAgIGFyZWE6ICB0aGlzLmVuZGVyQXJlYVNpemUsXG4gICAgICAgIHZpc2libGU6IHRydWVcbiAgICAgIH07XG4gICAgfVxuICB9LFxuICBjaGVja01lcmdlOiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIHRhcmdldCA9IHRoaXMsIF90bGFzdCA9IHRoaXMucG9pbnRzLmxlbmd0aCAtIDE7XG4gICAgdmFyIHAxID0gdGhpcy5wb2ludHNbMF0sXG4gICAgICBwMiA9IHRoaXMucG9pbnRzW190bGFzdF0sXG4gICAgICBfZGlzdGFuY2UgPSBmYWJyaWMuUG9pbnQucHJvdG90eXBlLmRpc3RhbmNlRnJvbTtcbiAgICBwMSA9IHtcbiAgICAgIHggOiBwMS54ICsgdGhpcy5sZWZ0LFxuICAgICAgeTogIHAxLnkgKyB0aGlzLnRvcFxuICAgIH07XG4gICAgcDIgPSB7XG4gICAgICB4IDogcDIueCArIHRoaXMubGVmdCxcbiAgICAgIHk6ICBwMi55ICsgdGhpcy50b3BcbiAgICB9O1xuXG4gICAgdmFyIF9kaXN0ID0gMTA7XG5cbiAgICB0aGlzLmNhbnZhcy5fb2JqZWN0cy5zb21lKGZ1bmN0aW9uKG9iaikge1xuICAgICAgaWYgKG9iaiA9PSB0YXJnZXQgfHwgb2JqLnR5cGUgIT09IFwicG9seWxpbmVcIilyZXR1cm4gZmFsc2U7XG4gICAgICB2YXIgX29sYXN0ID0gb2JqLnBvaW50cy5sZW5ndGggLSAxO1xuXG4gICAgICB2YXIgcDMgPSBvYmoucG9pbnRzWzBdO1xuICAgICAgdmFyIHA0ID0gb2JqLnBvaW50c1tfb2xhc3RdO1xuICAgICAgcDMgPSB7XG4gICAgICAgIHggOiBwMy54ICsgb2JqLmxlZnQsXG4gICAgICAgIHk6ICBwMy55ICsgb2JqLnRvcFxuICAgICAgfTtcbiAgICAgIHA0ID0ge1xuICAgICAgICB4IDogcDQueCArIG9iai5sZWZ0LFxuICAgICAgICB5OiAgcDQueSArIG9iai50b3BcbiAgICAgIH07XG5cbiAgICAgIGlmKF9kaXN0YW5jZS5jYWxsKHAxLCBwMykgPCBfZGlzdCl7XG4gICAgICAgIHRhcmdldC5tZXJnZShvYmosMCwwKVxuICAgICAgfVxuICAgICAgaWYoX2Rpc3RhbmNlLmNhbGwocDEsIHA0KSA8IF9kaXN0KXtcbiAgICAgICAgdGFyZ2V0Lm1lcmdlKG9iaiwwLF9vbGFzdClcbiAgICAgIH1cbiAgICAgIGlmKF9kaXN0YW5jZS5jYWxsKHAyLCBwMykgPCBfZGlzdCl7XG4gICAgICAgIHRhcmdldC5tZXJnZShvYmosX3RsYXN0LDApXG4gICAgICB9XG4gICAgICBpZihfZGlzdGFuY2UuY2FsbChwMiwgcDQpIDwgX2Rpc3Qpe1xuICAgICAgICB0YXJnZXQubWVyZ2Uob2JqLF90bGFzdCxfb2xhc3QpXG4gICAgICB9XG4gICAgfSlcbiAgfVxufSk7XG5cbmZhYnJpYy5Qb2x5bGluZS5mcm9tT2JqZWN0ID0gZnVuY3Rpb24gKG9iamVjdCkge1xuICByZXR1cm4gbmV3IHRoaXMob2JqZWN0KTtcbn07XG5cblxuZmFicmljLnV0aWwuY3JlYXRlQWNjZXNzb3JzKGZhYnJpYy5Qb2x5bGluZSk7XG5cbnJlcXVpcmUoXCIuL3BvbHlsaW5lLmNvbnRyb2xzXCIpO1xuXG5cblxuXG5pZiAoZmFicmljLm9iamVjdHNMaWJyYXJ5KSB7XG4gIGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLm9iamVjdHNMaWJyYXJ5LCB7XG4gICAgc2hhcGU6IHtcbiAgICAgIHR5cGU6IFwicG9seWxpbmVcIixcbiAgICAgIHBvaW50czogZnVuY3Rpb24gKHcsIGgpIHtcbiAgICAgICAgICByZXR1cm4gW1xuICAgICAgICAgIHt4OiAyNSwgeTogMX0sXG4gICAgICAgICAge3g6IDMxLCB5OiAxOH0sXG4gICAgICAgICAge3g6IDQ5LCB5OiAxOH0sXG4gICAgICAgICAge3g6IDM1LCB5OiAyOX0sXG4gICAgICAgICAge3g6IDQwLCB5OiA0Nn0sXG4gICAgICAgICAge3g6IDI1LCB5OiAzNn0sXG4gICAgICAgICAge3g6IDEwLCB5OiA0Nn0sXG4gICAgICAgICAge3g6IDE1LCB5OiAyOX0sXG4gICAgICAgICAge3g6IDEsIHk6IDE4fSxcbiAgICAgICAgICB7eDogMTksIHk6IDE4fVxuICAgICAgICBdO1xuICAgICAgfSxcbiAgICAgIFwic3Ryb2tlXCI6IFwiYmxhY2tcIixcbiAgICAgIFwiZmlsbFwiOiBcImJsdWVcIlxuICAgIH1cbiAgfSk7XG59XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL29iamVjdHMvUG9seWxpbmUuanNcbi8vIG1vZHVsZSBpZCA9IDk3XG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIid1c2Ugc3RyaWN0JztcblxuXG5cbi8vZmFicmljLkRQSSB0b2RvIHdoeSBkbyBub3QgdXNlIGl0P1xuLyoqXG4gKiBAYXV0aG9yIERlbmlzIFBvbm9tYXJldlxuICogQGVtYWlsIGRlbi5wb25vbWFyZXZAZ21haWwuY29tXG4gKi9cbi8vZmFicmljLnJlcXVpcmUoXCJSYXN0ZXJcIixbXSwgZnVuY3Rpb24oKSB7XG5mYWJyaWMuUmFzdGVyID0gZmFicmljLnV0aWwuY3JlYXRlQ2xhc3MoZmFicmljLkltYWdlLCB7XG4gIHR5cGU6ICdyYXN0ZXInLFxuICBjb2xvcnM6IG51bGwsXG4gIF9jb2xvcl9hcmVhczogbnVsbCxcbiAgY29sb3JBcmVhczogbnVsbCxcbiAgb3B0aW9uc09yZGVyOiBbXCJjb2xvckFyZWFzXCIsXCJjb2xvcnNcIl0sXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uIChpbWcsIG9wdGlvbnMsY2FsbGJhY2spIHtcblxuICAgIHRoaXMuY29sb3JBcmVhcyA9IFtdO1xuICAgIHRoaXMuX2NvbG9yX2FyZWFzID0gW107XG4gICAgdGhpcy5jb2xvcnMgPSB7fTtcbiAgICB0aGlzLmNhbGxTdXBlcignaW5pdGlhbGl6ZScsIGltZywgb3B0aW9ucywgZnVuY3Rpb24oZWwpe1xuICAgICAgY2FsbGJhY2sodGhpcyk7XG4gICAgfS5iaW5kKHRoaXMpKTtcbiAgfSxcbiAgc2V0Q29sb3JBcmVhczogZnVuY3Rpb24gKHZhbCxjYWxsYmFjaykge1xuXG4gICAgdmFyIGNiID0gZmFicmljLnV0aWwucXVldWVMb2FkKHZhbC5sZW5ndGggKyAxLGZ1bmN0aW9uKCl7XG4gICAgICBjYWxsYmFjayAmJiBjYWxsYmFjayh0aGlzKTtcbiAgICB9LmJpbmQodGhpcykpO1xuXG4gICAgdmFyIF90aGlzID0gdGhpcztcbiAgICBmb3IodmFyIGkgaW4gdmFsKXtcbiAgICAgIHRoaXMuY29sb3JBcmVhc1tpXSA9IHZhbFtpXTtcbiAgICAgIGlmKHZhbFtpXS5zcmMpe1xuICAgICAgICBmYWJyaWMuSW1hZ2UuZnJvbVVSTCh2YWxbaV0uc3JjLGZ1bmN0aW9uKGluZGV4LGVsKXtcbiAgICAgICAgICBlbC53aWR0aCA9IF90aGlzLndpZHRoO1xuICAgICAgICAgIGVsLmhlaWdodCA9IF90aGlzLmhlaWdodDtcbiAgICAgICAgICBfdGhpcy5fY29sb3JfYXJlYXNbaW5kZXhdID0ge1xuICAgICAgICAgICAgaW1hZ2U6IGVsLFxuICAgICAgICAgICAgZmlsdGVyczogW1xuICAgICAgICAgICAgICBuZXcgZmFicmljLkltYWdlLmZpbHRlcnMuTWFzayh7J21hc2snOiBlbH0pXG4gICAgICAgICAgICBdXG4gICAgICAgICAgfTtcbiAgICAgICAgICBpZih0aGlzLmNvbG9yc1tpbmRleF0pe1xuICAgICAgICAgICAgdGhpcy5zZXRDb2xvcihpbmRleCx0aGlzLmNvbG9yc1tpbmRleF0sY2IpXG4gICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICBjYigpO1xuICAgICAgICAgIH1cbiAgICAgICAgfS5iaW5kKHRoaXMsaSkpO1xuICAgICAgfWVsc2V7XG4gICAgICAgIF90aGlzLl9jb2xvcl9hcmVhc1tpXSA9IHtcbiAgICAgICAgfTtcbiAgICAgICAgY2IoKTtcbiAgICAgIH1cbiAgICB9XG4gICAgY2IoKTtcbiAgfSxcbiAgc2V0Q29sb3I6IGZ1bmN0aW9uIChpbmRleCxvcHRpb25zLGNhbGxiYWNrKSB7XG4gICAgdmFyIF90aGlzID0gdGhpcztcbiAgICB2YXIgY29sb3JBcmVhID0gdGhpcy5fY29sb3JfYXJlYXNbaW5kZXhdO1xuICAgIHRoaXMuY29sb3JzW2luZGV4XSA9IG9wdGlvbnM7XG5cbiAgICBpZighY29sb3JBcmVhIHx8ICFjb2xvckFyZWEuaW1hZ2Upe1xuICAgICAgcmV0dXJuIGNhbGxiYWNrKCk7XG4gICAgfVxuXG5cbiAgICB2YXIgX0JsZW5kID0gZmFicmljLkltYWdlLmZpbHRlcnMuQmxlbmQ7XG5cblxuICAgIGlmKCFvcHRpb25zKXtcbiAgICAgIC8vZG8gbm90IGZpbGxcbiAgICAgIGNvbG9yQXJlYS5maWx0ZXJzLmxlbmd0aCA9IDE7XG4gICAgICBjcmVhdGVDb2xvckFyZWEoKTtcbiAgICB9ZWxzZSBpZihvcHRpb25zLmNvbnN0cnVjdG9yID09IFN0cmluZyl7XG5cbiAgICAgIC8vIHZhciBfYyA9IGZhYnJpYy5Db2xvci5jb2xvck5hbWVNYXBbZmFicmljLnV0aWwuc3RyaW5nLnRvRGFzaGVkKGNvbG9yc1tpXS5yZXBsYWNlKC9cXHMvLCBcIlwiKSldO1xuICAgICAgLy8gaWYgKCFfYykge1xuICAgICAgLy8gICBjb25zb2xlLndhcm4oXCJIRVggQ29kZSBvZiAnXCIgKyBjb2xvcnNbaV0gKyBcIicgTm90IEZvdW5kIVwiKTtcbiAgICAgIC8vIH1cblxuICAgICAgLy9maWxsIGEgY29sb3JcbiAgICAgIGlmKCFvcHRpb25zLnN0YXJ0c1dpdGgoXCJyZ2JcIikgJiYgIW9wdGlvbnMuc3RhcnRzV2l0aChcIiNcIikgJiYgIWZhYnJpYy5Db2xvci5jb2xvck5hbWVNYXBbb3B0aW9uc10pe1xuICAgICAgICBjb25zb2xlLmxvZyhcImNvbG9yICdcIiArIG9wdGlvbnMgKyBcIicgbm90IGRlZmluZWRcIik7XG4gICAgICAgIG9wdGlvbnMgPSBcIiMwMDBcIjtcbiAgICAgIH1cbiAgICAgIGNvbG9yQXJlYS5maWx0ZXJzWzFdID0gbmV3IF9CbGVuZCh7XG4gICAgICAgIGNvbG9yOiBvcHRpb25zLFxuICAgICAgICBtb2RlOiBcIm11bHRpcGx5XCJcbiAgICAgIH0pO1xuICAgICAgY3JlYXRlQ29sb3JBcmVhKClcbiAgICB9ZWxzZXtcbiAgICAgIC8vZmlsbCBhIHRleHR1cmVcbiAgICAgIGNvbG9yQXJlYS5vcHRpb25zID0gZmFicmljLnV0aWwub2JqZWN0LmNsb25lRGVlcChvcHRpb25zKTtcbiAgICAgIGZhYnJpYy5JbWFnZS5mcm9tVVJMKGNvbG9yQXJlYS5vcHRpb25zLnNyYyxmdW5jdGlvbihlbCl7XG4gICAgICAgIGNvbG9yQXJlYS5vcHRpb25zLmltYWdlID0gZWw7XG4gICAgICAgIGNvbG9yQXJlYS5maWx0ZXJzWzFdID0gbmV3IF9CbGVuZChjb2xvckFyZWEub3B0aW9ucyk7XG4gICAgICAgIGNyZWF0ZUNvbG9yQXJlYSgpO1xuICAgICAgfSlcbiAgICB9XG5cblxuICAgIGZ1bmN0aW9uIGNyZWF0ZUNvbG9yQXJlYSgpIHtcbiAgICAgIHZhciBfaW1hZ2UgPSBuZXcgZmFicmljLkltYWdlKF90aGlzLl9maWx0ZXJlZEVsIHx8IF90aGlzLl9vcmlnaW5hbEVsZW1lbnQpO1xuICAgICAgY29sb3JBcmVhLmNhbnZhcyA9IF9pbWFnZS5hcHBseUZpbHRlcnMoY2FsbGJhY2ssIGNvbG9yQXJlYS5maWx0ZXJzLCBfdGhpcy5fZmlsdGVyZWRFbCB8fCBfdGhpcy5fb3JpZ2luYWxFbGVtZW50KTtcbiAgICB9XG5cbiAgfSxcbiAgZ2V0Q29sb3I6IGZ1bmN0aW9uIChpbmRleCkge1xuICAgIHJldHVybiB0aGlzLmNvbG9yc1tpbmRleF07XG4gICAgLy9yZXR1cm4gdGhpcy5fY29sb3JfYXJlYXNbaW5kZXhdLmZpbHRlcnNbMV0uY29sb3I7XG4gIH0sXG4gIHNldENvbG9yczogZnVuY3Rpb24gKGNvbG9ycyxjYWxsYmFjaykge1xuXG4gICAgdmFyIGNiID0gZmFicmljLnV0aWwucXVldWVMb2FkKGNvbG9ycy5sZW5ndGgsZnVuY3Rpb24oKXtcblxuICAgICAgdGhpcy5maXJlKFwiY29sb3JzOmNoYW5nZWRcIiwgY29sb3JzKTtcbiAgICAgIHRoaXMuZmlyZShcIm1vZGlmaWVkXCIpO1xuICAgICAgLy90aGlzLmNhbnZhcyAmJiB0aGlzLmNhbnZhcy5maXJlKCdvYmplY3Q6bW9kaWZpZWQnLCB7IHRhcmdldDogdGhpcyB9KTtcbiAgICAgIGNhbGxiYWNrICYmIGNhbGxiYWNrKCk7XG4gICAgfS5iaW5kKHRoaXMpKTtcblxuICAgIGZvcih2YXIgaT0gMDsgaTwgY29sb3JzLmxlbmd0aCA7aSArKyl7XG5cbiAgICAgIHRoaXMuc2V0Q29sb3IoaSxjb2xvcnNbaV0sY2IpXG4gICAgfVxuICB9LFxuICAvKipcbiAgICogQHByaXZhdGVcbiAgICogQHBhcmFtIHtDYW52YXNSZW5kZXJpbmdDb250ZXh0MkR9IGN0eCBDb250ZXh0IHRvIHJlbmRlciBvblxuICAgKi9cbiAgX3JlbmRlcjogZnVuY3Rpb24oY3R4LCBub1RyYW5zZm9ybSkge1xuICAgIHZhciB4LCB5LCBpbWFnZU1hcmdpbnMgPSB0aGlzLl9maW5kTWFyZ2lucygpLCBlbGVtZW50VG9EcmF3O1xuXG4gICAgeCA9IChub1RyYW5zZm9ybSA/IHRoaXMubGVmdCA6IC10aGlzLndpZHRoIC8gMik7XG4gICAgeSA9IChub1RyYW5zZm9ybSA/IHRoaXMudG9wIDogLXRoaXMuaGVpZ2h0IC8gMik7XG5cbiAgICBpZiAodGhpcy5tZWV0T3JTbGljZSA9PT0gJ3NsaWNlJykge1xuICAgICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgICAgY3R4LnJlY3QoeCwgeSwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpO1xuICAgICAgY3R4LmNsaXAoKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5pc01vdmluZyA9PT0gZmFsc2UgJiYgdGhpcy5yZXNpemVGaWx0ZXJzLmxlbmd0aCAmJiB0aGlzLl9uZWVkc1Jlc2l6ZSgpKSB7XG4gICAgICB0aGlzLl9sYXN0U2NhbGVYID0gdGhpcy5zY2FsZVg7XG4gICAgICB0aGlzLl9sYXN0U2NhbGVZID0gdGhpcy5zY2FsZVk7XG4gICAgICBlbGVtZW50VG9EcmF3ID0gdGhpcy5hcHBseUZpbHRlcnMobnVsbCwgdGhpcy5yZXNpemVGaWx0ZXJzLCB0aGlzLl9maWx0ZXJlZEVsIHx8IHRoaXMuX29yaWdpbmFsRWxlbWVudCwgdHJ1ZSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgZWxlbWVudFRvRHJhdyA9IHRoaXMuX2VsZW1lbnQ7XG4gICAgfVxuICAgIGVsZW1lbnRUb0RyYXcgJiYgY3R4LmRyYXdJbWFnZShlbGVtZW50VG9EcmF3LFxuICAgICAgeCArIGltYWdlTWFyZ2lucy5tYXJnaW5YLFxuICAgICAgeSArIGltYWdlTWFyZ2lucy5tYXJnaW5ZLFxuICAgICAgaW1hZ2VNYXJnaW5zLndpZHRoLFxuICAgICAgaW1hZ2VNYXJnaW5zLmhlaWdodFxuICAgICk7XG4gICAgZm9yKHZhciBpIGluIHRoaXMuX2NvbG9yX2FyZWFzKXtcbiAgICAgIGVsZW1lbnRUb0RyYXcgPSB0aGlzLl9jb2xvcl9hcmVhc1tpXS5jYW52YXM7XG4gICAgICBlbGVtZW50VG9EcmF3ICYmIGN0eC5kcmF3SW1hZ2UoZWxlbWVudFRvRHJhdyxcbiAgICAgICAgeCArIGltYWdlTWFyZ2lucy5tYXJnaW5YLFxuICAgICAgICB5ICsgaW1hZ2VNYXJnaW5zLm1hcmdpblksXG4gICAgICAgIGltYWdlTWFyZ2lucy53aWR0aCxcbiAgICAgICAgaW1hZ2VNYXJnaW5zLmhlaWdodFxuICAgICAgKTtcbiAgICB9XG5cbiAgICB0aGlzLl9yZW5kZXJTdHJva2UoY3R4KTtcbiAgfSxcbiAgdG9PYmplY3QgOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgX29iaiA9IHRoaXMuY2FsbFN1cGVyKCd0b09iamVjdCcpO1xuICAgIC8vX29iai5oZWlnaHQgPSB0aGlzLl9vcmlnaW5hbF9oZWlnaHQ7XG4gICAgX29iai5jb2xvcnMgPSB0aGlzLmNvbG9ycztcbiAgICBfb2JqLmNvbG9yQXJlYXMgPSB0aGlzLmNvbG9yQXJlYXM7XG4gICAgcmV0dXJuIF9vYmo7XG4gIH1cbn0pO1xuXG5mYWJyaWMuUmFzdGVyLnByb3RvdHlwZS5hY3Rpb25zID0gZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCh7fSx7XG4gIGNvbG9yczoge1xuICAgIHR5cGU6ICAgJ21lbnUnLFxuICAgIHRpdGxlOiAnY29sb3IgbWVudScsXG4gICAgbWVudTogICBmdW5jdGlvbigpe1xuICAgICAgdmFyIF9tZW51ID0gW107XG4gICAgICBmb3IodmFyIGtleSBpbiB0aGlzLl9jb2xvcl9hcmVhcyl7XG4gICAgICAgIF9tZW51LnB1c2goe1xuICAgICAgICAgIHRpdGxlOiBcItCm0LLQtdGCXCIsXG4gICAgICAgICAgYXJnczogICBrZXksXG4gICAgICAgICAgdmFsdWU6IHtcbiAgICAgICAgICAgIGdldDogICAgZnVuY3Rpb24oa2V5KXtcbiAgICAgICAgICAgICAgdmFyIGNvbG9yID0gdGhpcy5nZXRDb2xvcihrZXkpO1xuICAgICAgICAgICAgICBpZihjb2xvci5jb25zdHJ1Y3RvciAhPT0gU3RyaW5nKXtcbiAgICAgICAgICAgICAgICByZXR1cm4gXCIjMDAwMDAwXCJcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICByZXR1cm4gY29sb3I7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc2V0OiAgICBmdW5jdGlvbihrZXksdmFsdWUpe1xuICAgICAgICAgICAgICB0aGlzLnNldENvbG9yKGtleSx2YWx1ZSk7XG4gICAgICAgICAgICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgdHlwZTogICAgICAgXCJjb2xvclwiXG4gICAgICAgIH0pXG4gICAgICB9XG4gICAgICByZXR1cm4gX21lbnU7XG4gICAgfVxuICB9XG59KTtcblxuXG5mYWJyaWMuUmFzdGVyLmZyb21PYmplY3QgPSBmdW5jdGlvbihvYmplY3QsIGNhbGxiYWNrKSB7XG5cbiAgZmFicmljLnV0aWwuaW5pdEltYWdlQW5kRmlsdGVycyhvYmplY3QsZnVuY3Rpb24oaW1nKXtcbiAgICB2YXIgaW5zdGFuY2UgPSBuZXcgZmFicmljLlJhc3RlcihpbWcsIG9iamVjdCxjYWxsYmFjayk7XG4gIH0pXG59O1xuXG4vKipcbiAqIEluZGljYXRlcyB0aGF0IGluc3RhbmNlcyBvZiB0aGlzIHR5cGUgYXJlIGFzeW5jXG4gKiBAc3RhdGljXG4gKiBAdHlwZSBCb29sZWFuXG4gKiBAZGVmYXVsdFxuICovXG5mYWJyaWMuUmFzdGVyLmFzeW5jID0gdHJ1ZTtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vb2JqZWN0cy9SYXN0ZXIuanNcbi8vIG1vZHVsZSBpZCA9IDk4XG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIlxuLy9mYWJyaWMucmVxdWlyZShcIlNrZXdPYmplY3RcIixbXCJTaGFwZU1peGluXCJdLCBmdW5jdGlvbigpIHtcbid1c2Ugc3RyaWN0JztcblxuXG4gICAgZmFicmljLlNrZXdPYmplY3QgPSB7XG5cbiAgICAgICAgICBkcmF3Q29udHJvbHM6IGZ1bmN0aW9uIChjdHgsIHNoYXBlLCBvZmZzZXQpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy5oYXNDb250cm9scykge1xuICAgICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuZHJhd0JvdW5kc0NvbnRyb2xzKCBjdHgpO1xuICAgICAgICAgICAgdGhpcy5kcmF3U2hhcGVDb250cm9scyhjdHgpO1xuICAgICAgICAgIH0sXG4gICAgICAgIGluaXRTa2V3UG9pbnRzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAvL2ZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQodGhpcywgZmFicmljLlNoYXBlTWl4aW4pO1xuICAgICAgICAgICAgdGhpcy5faW5pdFBvaW50cygpO1xuICAgICAgICAgICAgdGhpcy5leHRyYUNvbnRyb2xzID0gdGhpcy5leHRyYUNvbnRyb2xzIHx8IHt9O1xuICAgICAgICAgICAgdGhpcy5leHRyYUNvbnRyb2xzLnNrZXdUUiA9IHt4OiB0aGlzLndpZHRoIC0gNSwgeTogMH07XG4gICAgICAgICAgICB0aGlzLmV4dHJhQ29udHJvbHMuc2tld0JMID0ge3g6IDUsIHk6IHRoaXMuaGVpZ2h0fTtcblxuICAgICAgICAgICAgdGhpcy5fY29ybmVyX2FjdGlvbnMgPSB0aGlzLl9jb3JuZXJfYWN0aW9ucyB8fCB7fTtcbiAgICAgICAgICAgIHRoaXMuX2Nvcm5lcl9hY3Rpb25zLnNrZXdUUiA9IFwic2tld1wiO1xuICAgICAgICAgICAgdGhpcy5fY29ybmVyX2FjdGlvbnMuc2tld0JMID0gXCJza2V3XCI7XG5cbiAgICAgICAgICAgIHRoaXMuX2NvbnRyb2xzVmlzaWJpbGl0eS5za2V3VFIgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5fY29udHJvbHNWaXNpYmlsaXR5LnNrZXdCTCA9IHRydWU7XG4gICAgICAgICAgICAvL2ZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQodGhpcywgZmFicmljLlNrZXdPYmplY3QpO1xuICAgICAgICB9LFxuXG4gICAgICAgIF9wZXJmb3JtU2tld0FjdGlvbjogZnVuY3Rpb24gKGUsIHRyYW5zZm9ybSwgcG9pbnRlcikge1xuICAgICAgICAgICAgLy90aGlzLmV4dHJhQ29udHJvbHMuY3VydmVcbiAgICAgICAgICAgIC8vdGhpcy5leHRyYUNvbnRyb2xzLmN1cnZlLnkgPSB0cmFuc2Zvcm0ucG9pbnQueTtcblxuICAgICAgICAgICAgaWYgKHRyYW5zZm9ybS5jb3JuZXIgPT0gXCJza2V3QkxcIikge1xuICAgICAgICAgICAgICAgIC8vX3BvaW50c1tvcmRlcl0ueCA9IF9wb2ludC54O1xuICAgICAgICAgICAgICAgIHRoaXMuc2tld1ggPSBNYXRoLmF0YW4yKHRyYW5zZm9ybS5wb2ludC54LCB0aGlzLmhlaWdodCkgLyBNYXRoLlBJICogMTgwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRyYW5zZm9ybS5jb3JuZXIgPT0gXCJza2V3VFJcIikge1xuICAgICAgICAgICAgICAgIC8vX3BvaW50c1tvcmRlcl0ueSA9IF9wb2ludC55O1xuICAgICAgICAgICAgICAgIHRoaXMuc2tld1kgPSBNYXRoLmF0YW4yKHRyYW5zZm9ybS5wb2ludC55LCB0aGlzLndpZHRoKSAvIE1hdGguUEkgKiAxODA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9vYmplY3RzL1NrZXdPYmplY3QuanNcbi8vIG1vZHVsZSBpZCA9IDk5XG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIid1c2Ugc3RyaWN0JztcblxuXG4vL2ZhYnJpYy5yZXF1aXJlKFwiU2xpZGVJbWFnZVwiLFtcIlNsaWRlT2JqZWN0XCIvKixcIlBhdGhmaW5kZXJcIiovXSxmdW5jdGlvbigpIHtcblxudmFyIEltYWdlSW5pdE92ZXJXcml0dGVuID0gZmFicmljLkltYWdlLnByb3RvdHlwZS5pbml0aWFsaXplO1xuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuSW1hZ2UucHJvdG90eXBlLCB7XG5cbiAgYXN5bmM6IHRydWUsXG4gIGNvbnRlbnRPZmZzZXRzOiBudWxsLFxuICBpbml0aWFsaXplOiBmdW5jdGlvbiAoZWxlbWVudCwgb3B0aW9ucywgY2FsbGJhY2spIHtcbiAgICBvcHRpb25zIHx8IChvcHRpb25zID0ge30pO1xuICAgIHRoaXMuZmlsdGVycyA9IFtdO1xuICAgIHRoaXMucmVzaXplRmlsdGVycyA9IFtdO1xuXG5cbiAgICBpZiAob3B0aW9ucy5vcmlnaW5hbFNyYykge1xuICAgICAgdGhpcy5fZWRpdGVkID0gdHJ1ZTtcbiAgICAgIGZhYnJpYy51dGlsLmxvYWRJbWFnZShvcHRpb25zLm9yaWdpbmFsU3JjLCBmdW5jdGlvbiAoaW1nKSB7XG4gICAgICAgIHRoaXMuX29yaWdpbmFsRWxlbWVudCA9IGltZztcbiAgICAgIH0uYmluZCh0aGlzKSk7XG4gICAgfVxuXG4gICAgdGhpcy5faW5pdEVsZW1lbnQoZWxlbWVudCwgb3B0aW9ucywgY2FsbGJhY2sgJiYgZnVuY3Rpb24gKCkge1xuICAgICAgICBmYWJyaWMuT2JqZWN0LnByb3RvdHlwZS5pbml0aWFsaXplLmNhbGwodGhpcywgb3B0aW9ucyxjYWxsYmFjayk7XG4gICAgICB9LmJpbmQodGhpcykpOy8vYWRkaW5nIGNhbGxiYWNrXG4gIH0sXG4gIF9pbml0RWxlbWVudDogZnVuY3Rpb24gKGVsZW1lbnQsIG9wdGlvbnMsIGNhbGxiYWNrKSB7XG4gICAgdGhpcy5zZXRFbGVtZW50KGZhYnJpYy51dGlsLmdldEJ5SWQoZWxlbWVudCksIGNhbGxiYWNrLCBvcHRpb25zKTtcbiAgICBmYWJyaWMudXRpbC5hZGRDbGFzcyh0aGlzLmdldEVsZW1lbnQoKSwgZmFicmljLkltYWdlLkNTU19DQU5WQVMpO1xuICB9LFxuICAvKipcbiAgICogU2V0cyBjcm9zc09yaWdpbiB2YWx1ZSAob24gYW4gaW5zdGFuY2UgYW5kIGNvcnJlc3BvbmRpbmcgaW1hZ2UgZWxlbWVudClcbiAgICogQHJldHVybiB7ZmFicmljLkltYWdlfSB0aGlzQXJnXG4gICAqIEBjaGFpbmFibGVcbiAgICovXG4gIHNldENyb3NzT3JpZ2luOiBmdW5jdGlvbih2YWx1ZSkge1xuICAgIHRoaXMuY3Jvc3NPcmlnaW4gPSB2YWx1ZTtcbiAgICBpZih0aGlzLl9lbGVtZW50KXtcbiAgICAgIHRoaXMuX2VsZW1lbnQuY3Jvc3NPcmlnaW4gPSB2YWx1ZTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG4gIHNldEVsZW1lbnQ6IGZ1bmN0aW9uKGVsZW1lbnQsIGNhbGxiYWNrLCBvcHRpb25zKSB7XG5cbiAgICB2YXIgX2NhbGxiYWNrLCBfdGhpcztcblxuICAgIHRoaXMuX2VsZW1lbnQgPSBlbGVtZW50O1xuICAgIHRoaXMuX29yaWdpbmFsRWxlbWVudCA9IGVsZW1lbnQ7XG4gICAgdGhpcy5faW5pdENvbmZpZyhvcHRpb25zKTtcbiAgICAvLyB0aGlzLnNldE9wdGlvbnMob3B0aW9ucyApO1xuICAgIC8vIHRoaXMuX3NldFdpZHRoSGVpZ2h0KHRoaXMpO1xuICAgIC8vIGlmICh0aGlzLl9lbGVtZW50ICYmIHRoaXMuY3Jvc3NPcmlnaW4pIHtcbiAgICAvLyAgIHRoaXMuX2VsZW1lbnQuY3Jvc3NPcmlnaW4gPSB0aGlzLmNyb3NzT3JpZ2luO1xuICAgIC8vIH1cblxuXG4gICAgaWYgKHRoaXMucmVzaXplRmlsdGVycy5sZW5ndGggPT09IDApIHtcbiAgICAgIF9jYWxsYmFjayA9IGNhbGxiYWNrO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIF90aGlzID0gdGhpcztcbiAgICAgIF9jYWxsYmFjayA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBfdGhpcy5hcHBseUZpbHRlcnMoY2FsbGJhY2ssIF90aGlzLnJlc2l6ZUZpbHRlcnMsIF90aGlzLl9maWx0ZXJlZEVsIHx8IF90aGlzLl9vcmlnaW5hbEVsZW1lbnQsIHRydWUpO1xuICAgICAgfTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5maWx0ZXJzLmxlbmd0aCAhPT0gMCkge1xuICAgICAgdGhpcy5hcHBseUZpbHRlcnMoX2NhbGxiYWNrKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoX2NhbGxiYWNrKSB7XG4gICAgICBfY2FsbGJhY2sodGhpcyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH0sXG4gIC8qKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAcGFyYW0ge0NhbnZhc1JlbmRlcmluZ0NvbnRleHQyRH0gY3R4IENvbnRleHQgdG8gcmVuZGVyIG9uXG4gICAqIEBwYXJhbSB7Qm9vbGVhbn0gbm9UcmFuc2Zvcm1cbiAgICovXG4gIF9yZW5kZXI6IGZ1bmN0aW9uKGN0eCwgbm9UcmFuc2Zvcm0pIHtcbiAgICB2YXIgeCwgeSwgaW1hZ2VNYXJnaW5zID0gdGhpcy5fZmluZE1hcmdpbnMoKSwgZWxlbWVudFRvRHJhdztcblxuICAgIHggPSAobm9UcmFuc2Zvcm0gPyB0aGlzLmxlZnQgOiAtdGhpcy53aWR0aCAvIDIpO1xuICAgIHkgPSAobm9UcmFuc2Zvcm0gPyB0aGlzLnRvcCA6IC10aGlzLmhlaWdodCAvIDIpO1xuXG4gICAgaWYgKHRoaXMubWVldE9yU2xpY2UgPT09ICdzbGljZScpIHtcbiAgICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICAgIGN0eC5yZWN0KHgsIHksIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KTtcbiAgICAgIGN0eC5jbGlwKCk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuaXNNb3ZpbmcgPT09IGZhbHNlICYmIHRoaXMucmVzaXplRmlsdGVycy5sZW5ndGggJiYgdGhpcy5fbmVlZHNSZXNpemUoKSkge1xuICAgICAgdGhpcy5fbGFzdFNjYWxlWCA9IHRoaXMuc2NhbGVYO1xuICAgICAgdGhpcy5fbGFzdFNjYWxlWSA9IHRoaXMuc2NhbGVZO1xuICAgICAgZWxlbWVudFRvRHJhdyA9IHRoaXMuYXBwbHlGaWx0ZXJzKG51bGwsIHRoaXMucmVzaXplRmlsdGVycywgdGhpcy5fZmlsdGVyZWRFbCB8fCB0aGlzLl9vcmlnaW5hbEVsZW1lbnQsIHRydWUpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIGVsZW1lbnRUb0RyYXcgPSB0aGlzLl9lbGVtZW50O1xuICAgIH1cbiAgICB0aGlzLl9yZW5kZXJGaWxsKGN0eCk7XG4gICAgZWxlbWVudFRvRHJhdyAmJiBjdHguZHJhd0ltYWdlKGVsZW1lbnRUb0RyYXcsXG4gICAgICB4ICsgaW1hZ2VNYXJnaW5zLm1hcmdpblgsXG4gICAgICB5ICsgaW1hZ2VNYXJnaW5zLm1hcmdpblksXG4gICAgICBpbWFnZU1hcmdpbnMud2lkdGgsXG4gICAgICBpbWFnZU1hcmdpbnMuaGVpZ2h0XG4gICAgKTtcblxuICAgIHRoaXMuX3N0cm9rZShjdHgpO1xuICAgIHRoaXMuX3JlbmRlclN0cm9rZShjdHgpO1xuICB9LFxuICB0b09iamVjdE5hdGl2ZTogZmFicmljLkltYWdlLnByb3RvdHlwZS50b09iamVjdCxcbiAgdG9PYmplY3Q6ICAgICBmdW5jdGlvbigpe1xuICAgIHZhciBvYmogPSBmYWJyaWMuSW1hZ2UucHJvdG90eXBlLnRvT2JqZWN0TmF0aXZlLmFwcGx5KHRoaXMsYXJndW1lbnRzKTtcbiAgICBpZihvYmouc3JjLmluZGV4T2YoZmFicmljLnV0aWwubWVkaWFSb290KSA9PSAwKXtcbiAgICAgIG9iai5zcmMgPSBvYmouc3JjLnJlcGxhY2UoZmFicmljLnV0aWwubWVkaWFSb290LFwiXCIpO1xuICAgIH1cbiAgICByZXR1cm4gb2JqO1xuICB9LFxuICBpbWFnZVRvb2xzOiAgICAgZmFsc2UsXG4gIHBob3Rvc2hvcFRvb2xzICA6IGZhbHNlLFxuICBjbG9uZVN5bmM6IGZ1bmN0aW9uKCkge1xuICAgIHZhciBfb2JqZWN0ID0gdGhpcy50b09iamVjdCgpO1xuICAgIGRlbGV0ZSBfb2JqZWN0LmZpbHRlcnM7XG4gICAgdmFyIGNsb25lID0gbmV3IGZhYnJpYy5JbWFnZSh0aGlzLl9lbGVtZW50LF9vYmplY3QpO1xuICAgIGNsb25lLl9maWx0ZXJlZEVsID0gdGhpcy5fZmlsdGVyZWRFbDtcbiAgICBjbG9uZS5maWx0ZXJzID0gdGhpcy5maWx0ZXJzO1xuICAgIHJldHVybiBjbG9uZTtcbiAgfSxcbiAgcmV2ZXJ0Q2hhbmdlczogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHBhdGhmaW5kZXIgPSB0aGlzLmNhbnZhcy5nZXRQYXRoZmluZGVyKCk7XG4gICAgaWYgKHBhdGhmaW5kZXIudGFyZ2V0ICYmIHBhdGhmaW5kZXIudGFyZ2V0ID09IHRoaXMpe1xuICAgICAgcGF0aGZpbmRlci5oaWRlKCk7XG4gICAgfVxuXG4gICAgaWYodGhpcy5fZWxlbWVudCA9PSB0aGlzLl9vcmlnaW5hbEVsZW1lbnQpe1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuZmlsdGVycy5sZW5ndGggPSAwO1xuICAgIGlmICh0aGlzLl9maWx0ZXJlZEVsKSB7XG4gICAgICBkZWxldGUgdGhpcy5fZmlsdGVyZWRFbDtcbiAgICB9XG4gICAgZGVsZXRlIHRoaXMuX2VkaXRlZDtcbiAgICB0aGlzLl9lbGVtZW50ID0gdGhpcy5fb3JpZ2luYWxFbGVtZW50O1xuXG4gICAgdGhpcy5maXJlKFwiY29udGVudDptb2RpZmllZFwiLHtcbiAgICAgIGJvdW5kczoge21pblg6IDAsIG1pblk6IDAsIG1heFg6IHRoaXMuX2VsZW1lbnQud2lkdGgsIG1heFk6IHRoaXMuX2VsZW1lbnQuaGVpZ2h0IH1cbiAgICB9KTtcblxuXG4gICAgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gIH0sXG4gIHJlbW92ZVdoaXRlOiBmdW5jdGlvbih0aHJlc2hvbGQscmVtb3ZlQWxsLGNhbGxiYWNrKSB7XG5cblxuICAgIHZhciByd2YgPSBfLmZpbmRXaGVyZSh0aGlzLmZpbHRlcnMsIHt0eXBlOiAnUmVtb3ZlV2hpdGVEUCd9KTtcblxuICAgIGlmKHJ3Zikge1xuICAgICAgcndmLm9wdGlvbnMuY29sb3JUaHJlc2hvbGQgPSB0aHJlc2hvbGQ7XG4gICAgICByd2Yub3B0aW9ucy5mcm9tQ29ybmVycyA9ICFyZW1vdmVBbGw7XG4gICAgfWVsc2V7XG4gICAgICByd2YgPSBuZXcgZmFicmljLkltYWdlLmZpbHRlcnMuUmVtb3ZlV2hpdGVEUCh7XG4gICAgICAgIGZyb21Db3JuZXJzOiAhcmVtb3ZlQWxsLFxuICAgICAgICBibHVyUmFkaXVzOiAyLFxuICAgICAgICBjb2xvclRocmVzaG9sZDogdGhyZXNob2xkXG4gICAgICB9KTtcbiAgICAgIHRoaXMuZmlsdGVycy5wdXNoKHJ3Zik7XG4gICAgfVxuXG4gICAgdmFyIF90aGlzID0gdGhpcztcbiAgICB0aGlzLmFwcGx5RmlsdGVycyhmdW5jdGlvbigpe1xuICAgICAgLy9fdGhpcy53aWR0aCA9IF90aGlzLl9lbGVtZW50LndpZHRoO1xuICAgICAgLy9fdGhpcy5oZWlnaHQgPSBfdGhpcy5fZWxlbWVudC5oZWlnaHQ7XG4gICAgICBfdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gICAgICBfdGhpcy5maXJlKFwiY29udGVudDptb2RpZmllZFwiLHtmaWx0ZXI6IHJ3ZiwgYm91bmRzOiByd2YuYm91bmRzfSk7XG4gICAgICBjYWxsYmFjayAmJiBjYWxsYmFjaygpO1xuICAgIH0pO1xuICB9LFxuICByZW1vdmVXaGl0ZUFsbDogdHJ1ZVxufSk7XG5cbnZhciBfSU1HID0gZmFicmljLkltYWdlLnByb3RvdHlwZTtcblxuXG5pZihfSU1HLmFjdGlvbnMgPT0gZmFicmljLk9iamVjdC5wcm90b3R5cGUuYWN0aW9ucyApe1xuICBfSU1HLmFjdGlvbnMgPSBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKHt9LGZhYnJpYy5PYmplY3QucHJvdG90eXBlLmFjdGlvbnMpO1xufVxuXG5fSU1HLmFjdGlvbnMgPSBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKF9JTUcuYWN0aW9ucyx7XG4gIHJlbW92ZVdoaXRlRnJvbUJvcmRlcnM6IHtcbiAgICB0aXRsZTogJ1JlbW92ZSBCYWNrZ3JvdW5kJyxcbiAgICB0eXBlOiAnZWZmZWN0JyxcbiAgICBjbGFzc05hbWU6ICAgXCJmYSBmYS1kb3QtY2lyY2xlLW9cIixcbiAgICBlZmZlY3RUcGw6XG4gICAgJzxidXR0b24gaWQ9XCJzZWxlY3QtY29sb3JzLWFjdGlvbi1idXR0b25cIiBjbGFzcz1cImZhIGZhLWNoZWNrXCI+PC9idXR0b24+JytcbiAgICAnPGlucHV0IGlkPVwic2VsZWN0LWNvbG9ycy1jaGVja2JveFwiIHR5cGU9XCJjaGVja2JveFwiPicgK1xuICAgICc8aW5wdXQgaWQ9XCJzZWxlY3QtY29sb3JzLXRocmVzaG9sZFwiIHR5cGU9XCJyYW5nZVwiICAgbWluPVwiMVwiIG1heD1cIjI1NVwiPicsXG4gICAgYWN0aW9uUGFyYW1ldGVyczogZnVuY3Rpb24oZWwsZGF0YSl7XG4gICAgICB2YXJcbiAgICAgICAgYWN0aW9uQ2hrID0gZWwuZmluZCgnI3NlbGVjdC1jb2xvcnMtY2hlY2tib3gnKSxcbiAgICAgICAgYWN0aW9uQnRuID0gZWwuZmluZCgnI3NlbGVjdC1jb2xvcnMtYWN0aW9uLWJ1dHRvbicpO1xuICAgICAgZGF0YS50aHJlc2hvbGRFbCA9IGVsLmZpbmQoJyNzZWxlY3QtY29sb3JzLXRocmVzaG9sZCcpO1xuXG4gICAgICBkYXRhLnJlbW92ZVdoaXRlQWxsID0gYWN0aW9uQ2hrLmlzKFwiOmNoZWNrZWRcIik7XG4gICAgICBhY3Rpb25DaGsuY2hhbmdlKGZ1bmN0aW9uKCl7XG4gICAgICAgIGRhdGEucmVtb3ZlV2hpdGVBbGwgPSBhY3Rpb25DaGsuaXMoXCI6Y2hlY2tlZFwiKVxuICAgICAgfSk7XG4gICAgICBhY3Rpb25CdG4uY2xpY2soZnVuY3Rpb24oKXtcbiAgICAgICAgZGF0YS5hY3Rpb24oKTtcbiAgICAgIH0pO1xuICAgICAgaWYoIWRhdGEuX19hY3Rpb24pe1xuXG4gICAgICAgIGRhdGEuX19hY3Rpb24gPSBkYXRhLmFjdGlvbjtcbiAgICAgICAgZGF0YS5hY3Rpb24gPSBmdW5jdGlvbigpe1xuICAgICAgICAgIGRhdGEuX19hY3Rpb24ocGFyc2VJbnQoZGF0YS50aHJlc2hvbGRFbC52YWwoKSksZGF0YS5yZW1vdmVXaGl0ZUFsbClcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9LFxuICAgIGFjdGlvbjogX0lNRy5yZW1vdmVXaGl0ZSxcbiAgICBpbnNlcnQ6ICAgICAnaW1hZ2VUb29scydcbiAgfSxcbiAgYWR2YW5jZWRUb29sczoge1xuICAgIHR5cGU6ICdlZmZlY3QnLFxuICAgIGVmZmVjdFRwbDpcbiAgICAnPGRpdiBpZD1cImVkaXRvci10b29sc1wiIGNsYXNzPVwiaW5saW5lLWFjdGlvbnMgY29tcGFjdFwiPjwvZGl2PicrXG4gICAgJzxkaXYgY2xhc3M9XCJjaGVja2JvYXJkXCIgPjxkaXYgaWQ9XCJwYXRoZmluZGVyXCI+PC9kaXY+PC9kaXY+JyxcbiAgICBjbGFzc05hbWU6ICdmYSBmYS1wZW5jaWwtc3F1YXJlLW8nLFxuICAgIHRpdGxlOiBcImFkdmFuY2VkIHRvb2xzXCIsXG4gICAgYWN0aW9uOiBmdW5jdGlvbigpe1xuICAgICAgdmFyIHBhdGhmaW5kZXIgPSB0aGlzLmNhbnZhcy5nZXRQYXRoZmluZGVyKCk7XG4gICAgICBwYXRoZmluZGVyLnRhcmdldCA9IHRoaXM7XG4gICAgICBwYXRoZmluZGVyLnNldFBpY3R1cmUodGhpcy5fZWxlbWVudCk7XG4gICAgICBwYXRoZmluZGVyLnNob3coKTtcbiAgICB9LFxuICAgIGFjdGlvblBhcmFtZXRlcnM6IGZ1bmN0aW9uKGVsLGRhdGEpe1xuXG4gICAgICB2YXIgcGF0aGZpbmRlciA9IHRoaXMuY2FudmFzLmdldFBhdGhmaW5kZXIoKTtcbiAgICAgIHBhdGhmaW5kZXIuY2FudmFzID0gdGhpcy5jYW52YXM7XG4gICAgICBmYWJyaWMuVG9vbGJhci5jcmVhdGUocGF0aGZpbmRlciwgJ2VkaXRvci10b29scycpO1xuXG4gICAgICBwYXRoZmluZGVyLnNldENvbnRhaW5lcigncGF0aGZpbmRlcicpO1xuXG4gICAgICAvLyBpZiAocGF0aGZpbmRlci50YXJnZXQpcGF0aGZpbmRlci5oaWRlKCk7XG4gICAgICBwYXRoZmluZGVyLnRhcmdldCA9IHRoaXM7XG4gICAgICBwYXRoZmluZGVyLnNldFBpY3R1cmUodGhpcy5fZWxlbWVudCk7XG4gICAgICBwYXRoZmluZGVyLnNob3coKTtcbiAgICB9LFxuICAgIGluc2VydDogICAgICdwaG90b3Nob3BUb29scydcbiAgfSxcbiAgaGlzdG9yeUJydXNoOiB7XG4gICAgY2xhc3NOYW1lOiAnZmEgZmEtaGlzdG9yeScsXG4gICAgdGl0bGU6IFwicmV2ZXJ0IHRvIG9yaWduYWwgaW1hZ2VcIixcbiAgICBhY3Rpb246IF9JTUcucmV2ZXJ0Q2hhbmdlcyxcbiAgICBvYnNlcnZlOiAgXCJjb250ZW50Om1vZGlmaWVkXCIsXG4gICAgdmlzaWJsZTogICAgIGZ1bmN0aW9uKCl7XG4gICAgICByZXR1cm4gISF0aGlzLl9maWx0ZXJlZEVsIHx8IHRoaXMuX2VkaXRlZDtcbiAgICB9LFxuICAgIGluc2VydDogICAgICdpbWFnZVRvb2xzJ1xuICB9LFxuICBmaWx0ZXJzOiB7XG4gICAgaW5zZXJ0OiAgICAgICAgIFwiZmlsdGVyVG9vbFwiLFxuICAgIHRpdGxlOiAgICAgICAgICBcItGE0LjQu9GM0YLRgFwiLFxuICAgIGl0ZW1DbGFzc05hbWU6ICBcImZpbHRlcnMtc2VsZWN0b3JcIixcbiAgICBjbGFzc05hbWU6ICAgICAgXCJmYSBmYS1maWx0ZXJcIixcbiAgICB0eXBlOiAgICAgICAgICAgXCJzZWxlY3RcIixcbiAgICB0ZW1wbGF0ZVNlbGVjdGlvbjogZnVuY3Rpb24oc3RhdGUsIGNvbnRhaW5lcikge1xuICAgICAgaWYgKHN0YXRlLmFueSkge1xuICAgICAgICByZXR1cm4gc3RhdGUudGV4dDtcbiAgICAgIH1cbiAgICAgIHJldHVybiAkKCc8c3Bhbj48c3BhbiBjbGFzcz1cImNvbG9yLXNwYW5cIiBzdHlsZT1cImJhY2tncm91bmQtY29sb3I6JyArIHN0YXRlLnRleHQgKyAnXCI+PC9zcGFuPicgKyBzdGF0ZS50ZXh0ICsgJzwvc3Bhbj4nKTtcbiAgICB9LFxuICAgIHRlbXBsYXRlUmVzdWx0OiBmdW5jdGlvbihzdGF0ZSwgY29udGFpbmVyLGRhdGEpIHtcbiAgICAgIHZhciAkZWwgPSAkKCc8c3Bhbj4nICsgc3RhdGUudGV4dCArICc8L3NwYW4+Jyk7XG4gICAgICBpZihzdGF0ZS5pZCAhPSBcIm5vbmVcIil7XG4gICAgICAgIHZhciAkY2FudmFzID0gJCgnPGNhbnZhcz4nKTtcbiAgICAgICAgZmFicmljLnV0aWwuZHJhd0ZpbHRlcigkY2FudmFzWzBdLGRhdGEudGFyZ2V0LnNyYywgc3RhdGUuaWQgLHtcbiAgICAgICAgICBoZWlnaHQ6IDIyXG4gICAgICAgIH0pO1xuICAgICAgICAkZWwucHJlcGVuZCgkY2FudmFzKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiAkZWw7XG4gICAgfSxcbiAgICB2YWx1ZTogICAgICB7XG4gICAgICBzZXQgOiBmdW5jdGlvbih2YWwsZmlsdGVyc0RhdGEpe1xuICAgICAgICB2YXIgb3B0aW9ucyA9IGZhbHNlO1xuICAgICAgICBpZih2YWwgPT0gXCJub25lXCIpe1xuICAgICAgICAgIHZhbCA9IGZhbHNlO1xuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICB2YXIgX2YgPSBfLmZpbmRXaGVyZShmaWx0ZXJzRGF0YSx7aWQ6IHZhbH0pO1xuICAgICAgICAgIF9mLmVuYWJsZWQgPSAhX2YuZW5hYmxlZDtcbiAgICAgICAgICBmb3IgKHZhciBpIGluIF9mLm9wdGlvbnMpIHtcbiAgICAgICAgICAgIGlmICgkLmlzTnVtZXJpYyhfZi5vcHRpb25zW2ldKSkge1xuICAgICAgICAgICAgICBfZi5vcHRpb25zW2ldID0gcGFyc2VGbG9hdChfZi5vcHRpb25zW2ldKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgaWYoX2YuZW5hYmxlZCl7XG4gICAgICAgICAgICBvcHRpb25zID0ge307XG4gICAgICAgICAgICBmb3IodmFyIGkgaW4gX2Yub3B0aW9ucyl7XG4gICAgICAgICAgICAgIG9wdGlvbnNbaV0gPSBfZi5vcHRpb25zW2ldLnZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuXG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zZXRGaWx0ZXIoe1xuICAgICAgICAgIHR5cGU6ICAgICB2YWwsXG4gICAgICAgICAgb3B0aW9uczogIG9wdGlvbnMsXG4gICAgICAgICAgcmVwbGFjZTogIHRydWVcbiAgICAgICAgfSk7XG4gICAgICB9LFxuICAgICAgZ2V0OiBmdW5jdGlvbigpe1xuICAgICAgICByZXR1cm4gdGhpcy5maWx0ZXJzLmxlbmd0aCA/IGZhYnJpYy51dGlsLnN0cmluZy5jYXBpdGFsaXplKCB0aGlzLmZpbHRlcnNbMF0udHlwZSAsdHJ1ZSkgOiBcIm5vbmVcIlxuICAgICAgfSxcbiAgICAgIG9wdGlvbnM6IGZ1bmN0aW9uKCl7XG5cbiAgICAgICAgdmFyIF9maWx0ZXJzID0gdGhpcy5nZXRGaWx0ZXJzRGF0YSgpO1xuICAgICAgICBmb3IodmFyIGkgaW4gX2ZpbHRlcnMpe1xuICAgICAgICAgIF9maWx0ZXJzW2ldLmlkID0gX2ZpbHRlcnNbaV0udHlwZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gW3tcbiAgICAgICAgICBpZDogICAgICdub25lJyxcbiAgICAgICAgICB0ZXh0OiAgICAgJ29yaWdpbmFsJyxcbiAgICAgICAgICBlbmFibGVkOiAhdGhpcy5maWx0ZXJzIHx8ICF0aGlzLmZpbHRlcnMubGVuZ3RoXG4gICAgICAgIH1dLmNvbmNhdChfZmlsdGVycyk7XG5cbiAgICAgIH1cbiAgICB9XG4gIH1cbn0pO1xuXG5cbmZhYnJpYy51dGlsLmluaXRGaWx0ZXJzID0gZnVuY3Rpb24gKGltZywgb2JqZWN0LCBjYWxsYmFjaykge1xuXG4gIC8vIGlmIChmYWJyaWMudmVyc2lvbiA+PSAxLjYpIHtcbiAgZmFicmljLkltYWdlLnByb3RvdHlwZS5faW5pdEZpbHRlcnMuY2FsbChvYmplY3QsIG9iamVjdC5maWx0ZXJzLCBmdW5jdGlvbiAoZmlsdGVycykge1xuICAgIG9iamVjdC5maWx0ZXJzID0gZmlsdGVycyB8fCBbXTtcbiAgICBmYWJyaWMuSW1hZ2UucHJvdG90eXBlLl9pbml0RmlsdGVycy5jYWxsKG9iamVjdCwgb2JqZWN0LnJlc2l6ZUZpbHRlcnMsIGZ1bmN0aW9uIChyZXNpemVGaWx0ZXJzKSB7XG4gICAgICBvYmplY3QucmVzaXplRmlsdGVycyA9IHJlc2l6ZUZpbHRlcnMgfHwgW107XG4gICAgICBjYWxsYmFjayhpbWcsIG9iamVjdCk7XG4gICAgfSk7XG4gIH0pO1xuICAvLyB9IGVsc2Uge1xuICAvLyAgIGZhYnJpYy5JbWFnZS5wcm90b3R5cGUuX2luaXRGaWx0ZXJzLmNhbGwob2JqZWN0LCBvYmplY3QsIGZ1bmN0aW9uIChmaWx0ZXJzKSB7XG4gIC8vICAgICBvYmplY3QuZmlsdGVycyA9IGZpbHRlcnMgfHwgW107XG4gIC8vICAgICBjYWxsYmFjayhpbWcsIG9iamVjdCk7XG4gIC8vICAgfSk7XG4gIC8vIH1cbn07XG5cbmZhYnJpYy51dGlsLmluaXRJbWFnZUFuZEZpbHRlcnMgPSBmdW5jdGlvbiAob2JqZWN0LCBjYWxsYmFjaykge1xuICBpZiAob2JqZWN0LnNyYykge1xuICAgIGZhYnJpYy51dGlsLmxvYWRJbWFnZShvYmplY3Quc3JjLCBmdW5jdGlvbiAoaW1nKSB7XG4gICAgICBkZWxldGUgb2JqZWN0LnNyYztcbiAgICAgIGZhYnJpYy51dGlsLmluaXRGaWx0ZXJzKGltZywgb2JqZWN0LCBjYWxsYmFjayk7XG4gICAgfSwgbnVsbCwgb2JqZWN0LmNyb3NzT3JpZ2luKTtcbiAgfSBlbHNlIHtcbiAgICBmYWJyaWMudXRpbC5pbml0RmlsdGVycyhudWxsLCBvYmplY3QsIGNhbGxiYWNrKTtcbiAgfVxufTtcblxuXG5mYWJyaWMuSW1hZ2UuZnJvbU9iamVjdCA9IGZ1bmN0aW9uIChvYmplY3QsIGNhbGxiYWNrKSB7XG4gIGZhYnJpYy51dGlsLmluaXRJbWFnZUFuZEZpbHRlcnMob2JqZWN0LCBmdW5jdGlvbiAoaW1nLCBvYmplY3QpIHtcbiAgICB2YXIgaW5zdGFuY2UgPSBuZXcgZmFicmljLkltYWdlKGltZywgb2JqZWN0LCBjYWxsYmFjayk7XG4gIH0pXG59O1xuXG5cbmZhYnJpYy5JbWFnZS5wcm90b3R5cGUuX3RvX29iamVjdF9vdmVyd3JpdHRlbiA9IGZhYnJpYy5JbWFnZS5wcm90b3R5cGUudG9PYmplY3Q7XG5mYWJyaWMuSW1hZ2UucHJvdG90eXBlLnRvT2JqZWN0ID0gZnVuY3Rpb24gKG9wdCkge1xuICB2YXIgb2JqID0gZmFicmljLkltYWdlLnByb3RvdHlwZS5fdG9fb2JqZWN0X292ZXJ3cml0dGVuLmNhbGwodGhpcywgb3B0KTtcblxuXG4gIGlmICh0aGlzLl9lZGl0ZWQpIHtcbiAgICBvYmoub3JpZ2luYWxTcmMgPSB0aGlzLl9vcmlnaW5hbF9zcmMgfHwgdGhpcy5fb3JpZ2luYWxFbGVtZW50LnNyYyB8fCB0aGlzLl9lbGVtZW50LnNyYztcbiAgICBvYmouc3JjID0gdGhpcy5fZWxlbWVudC5zcmM7XG4gIH0gZWxzZSB7XG4gICAgb2JqLnNyYyA9IHRoaXMuX29yaWdpbmFsX3NyYyB8fCB0aGlzLl9vcmlnaW5hbEVsZW1lbnQuc3JjIHx8IHRoaXMuX2VsZW1lbnQuc3JjO1xuICB9XG4gIGlmICh0aGlzLmNvbnRlbnRPZmZzZXRzKSB7XG4gICAgb2JqLmNvbnRlbnRPZmZzZXRzID0gdGhpcy5jb250ZW50T2Zmc2V0cztcbiAgfVxuXG5cbiAgaWYgKCF0aGlzLmluY2x1ZGVEZWZhdWx0VmFsdWVzKSB7XG4gICAgaWYgKCFvYmouZmlsdGVycy5sZW5ndGgpZGVsZXRlIG9iai5maWx0ZXJzO1xuICB9XG4gIC8vaWYodGhpcy5fb3JpZ2luYWxFbGVtZW50KXtcbiAgLy8gICAgb2JqLnRodW1iID0gdGhpcy5fZWxlbWVudC5zcmM7XG4gIC8vfVxuXG4gIHJldHVybiBvYmo7XG59O1xuXG5cblxuXG5mYWJyaWMuSW1hZ2UucHJvdG90eXBlLmV4dHJhY3RDb2xvcnMgPSBmdW5jdGlvbiAoKSB7XG4gIHZhciBfY29sb3JzID0gZmFicmljLk1hZ2ljV2FuZC5leHRyYWN0Q29sb3JzKHRoaXMuX2VsZW1lbnQpO1xuICB2YXIgY29sb3JzID0ge307XG4gIGZvcih2YXIgaSBpbiBfY29sb3JzKXtcbiAgICB2YXIgX3N0ciA9IFwicmdiKFwiICsgX2NvbG9yc1tpXS5qb2luKFwiLFwiKSArIFwiKVwiO1xuICAgIGNvbG9yc1tfc3RyXSA9IHt9O1xuICB9XG4gIHJldHVybiBjb2xvcnM7XG59O1xuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9vYmplY3RzL1NsaWRlSW1hZ2UuanNcbi8vIG1vZHVsZSBpZCA9IDEwMFxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCIndXNlIHN0cmljdCc7XG5cblxuXG4gIC8vZmFicmljLnJlcXVpcmUoJ1NsaWRlVGV4dCcsIFsnU2xpZGVPYmplY3QnXSwgZnVuY3Rpb24gKCkge1xuICB2YXIgdGV4dEluaXRpYWxpemUgPSBmYWJyaWMuVGV4dC5wcm90b3R5cGUuaW5pdGlhbGl6ZTtcblxuZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuVGV4dC5wcm90b3R5cGUse1xuICAgIHRleHRJbml0aWFsaXplOiB0ZXh0SW5pdGlhbGl6ZSxcbiAgICBlZGl0VG9vbDogZmFsc2UsXG4gICAgYWR2YW5jZWRDb2xvcnNUb29sczogZmFsc2UsXG4gICAgdGV4dEZvbnRTaXplVG9vbHM6IGZhbHNlLFxuICAgIHRleHRBbGlnbWVudFRvb2xzOiBmYWxzZSxcbiAgICBhZHZhbmNlZFRleHRTdHlsZVRvb2xzOiBmYWxzZSxcbiAgICByYXN0ZXJpemVUb29sOiBmYWxzZSxcbiAgICByYXN0ZXJpemVLbGFzczogZmFicmljLkltYWdlLFxuXG5cblxuICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uICh0ZXh0LG9wdGlvbnMpIHtcbiAgICAgIHRoaXMuX2luaXRFbnRpdHkob3B0aW9ucyk7XG4gICAgICB0aGlzLnRleHRJbml0aWFsaXplKCB0ZXh0LG9wdGlvbnMpO1xuICAgICAgIC8vIHRoaXMudXBkYXRlQ2FjaGUoKTtcbiAgICB9LFxuICAgIF9yZW5kZXJfY2FjaGU6IGZ1bmN0aW9uIChjdHgpIHtcbiAgICAgIGN0eC5zYXZlKCk7XG4gICAgICBjdHguc2NhbGUoXG4gICAgICAgIHRoaXMuc2NhbGVYICogKHRoaXMuZmxpcFggPyAtMSA6IDEpLFxuICAgICAgICB0aGlzLnNjYWxlWSAqICh0aGlzLmZsaXBZID8gLTEgOiAxKVxuICAgICAgKTtcbiAgICAgIHRoaXMudHJhbnNmb3JtKGN0eCk7XG4gICAgICB0aGlzLl9zZXRTaGFkb3coY3R4KTtcbiAgICAgIGN0eC50cmFuc2xhdGUoLXRoaXMud2lkdGggLyAyLCAtdGhpcy5oZWlnaHQgLyAyKTtcbiAgICAgIGN0eC5kcmF3SW1hZ2UodGhpcy5fY2FjaGUsIDAsIDAsIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KTtcbiAgICAgIGN0eC5yZXN0b3JlKCk7XG4gICAgfSxcbiAgICB1cGRhdGVDYWNoZTogZnVuY3Rpb24gKCkge1xuXG4gICAgICB2YXIgc2l6ZSA9IHtcbiAgICAgICAgd2lkdGg6IHRoaXMud2lkdGggKiB0aGlzLmNhbnZhcy5kb3RzUGVyVW5pdCxcbiAgICAgICAgaGVpZ2h0OiB0aGlzLmhlaWdodCAqIHRoaXMuY2FudmFzLmRvdHNQZXJVbml0XG4gICAgICB9O1xuXG4gICAgICB2YXIgX2NsaXBUbyA9IHRoaXMuY2xpcFRvO1xuICAgICAgZGVsZXRlIHRoaXMuY2xpcFRvO1xuICAgICAgdGhpcy5fY2FjaGUgPSBmYWJyaWMudXRpbC5jcmVhdGVDYW52YXNFbGVtZW50V2l0aFNpemUoc2l6ZSk7XG4gICAgICB2YXIgY3R4ID0gdGhpcy5fY2FjaGUuZ2V0Q29udGV4dChcIjJkXCIpO1xuICAgICAgY3R4LnNjYWxlKFxuICAgICAgICB0aGlzLmNhbnZhcy5kb3RzUGVyVW5pdCxcbiAgICAgICAgdGhpcy5jYW52YXMuZG90c1BlclVuaXQpO1xuICAgICAgY3R4LnRyYW5zbGF0ZSh0aGlzLndpZHRoIC8gMiwgdGhpcy5oZWlnaHQgLyAyKTtcblxuICAgICAgdGhpcy5yZW5kZXIoY3R4LCB0cnVlKTtcbiAgICAgIHRoaXMucmVuZGVyID0gdGhpcy5fcmVuZGVyX2NhY2hlO1xuICAgICAgdGhpcy5jbGlwVG8gPSBfY2xpcFRvO1xuXG4gICAgfSxcbiAgICByYXN0ZXJpemVUZXh0OiBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLnVwZGF0ZUNhY2hlKCk7XG4gICAgICB2YXIgaW1nID0gZmFicmljLnV0aWwuY3JlYXRlSW1hZ2UoKTtcblxuICAgICAgaW1nLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIG9iaiA9IHRoaXMudG9PYmplY3QoKTtcbiAgICAgICAgb2JqLndpZHRoID0gaW1nLndpZHRoO1xuICAgICAgICBvYmouaGVpZ2h0ID0gaW1nLmhlaWdodDtcbiAgICAgICAgb2JqLnNjYWxlWCA9IHRoaXMuc2NhbGVYICogKHRoaXMuaGVpZ2h0IC8gaW1nLmhlaWdodCk7XG4gICAgICAgIG9iai5zY2FsZVkgPSB0aGlzLnNjYWxlWSAqICh0aGlzLndpZHRoIC8gaW1nLndpZHRoICk7XG4gICAgICAgIG9iai5yYXN0ZXJpemVkVHlwZSA9IG9iai50eXBlO1xuICAgICAgICBkZWxldGUgb2JqLnR5cGU7XG5cbiAgICAgICAgdmFyIGVsID0gbmV3IHRoaXMucmFzdGVyaXplS2xhc3MoaW1nLCBvYmopO1xuICAgICAgICB0aGlzLmNhbnZhcy5hZGQoZWwpO1xuICAgICAgICB0aGlzLmNhbnZhcy5yZW1vdmUodGhpcyk7XG4gICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHRoaXMuY2FudmFzLnNldEFjdGl2ZU9iamVjdChlbCk7XG4gICAgICAgICAgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gICAgICAgIH0uYmluZCh0aGlzKSlcbiAgICAgIH0uYmluZCh0aGlzKTtcbiAgICAgIGltZy5zcmMgPSB0aGlzLl9jYWNoZS50b0RhdGFVUkwoKTtcbiAgICAgIC8vdGhpcy5vbignbW9kaWZpZWQnLHRoaXMudXBkYXRlQ2FjaGUuYmluZCh0aGlzKSk7XG4gICAgfSxcbiAgICBnZXRTdHlsZTogZnVuY3Rpb24gKHN0eWxlTmFtZSkge1xuICAgICAgdmFyIG9iamVjdCA9IHRoaXM7XG4gICAgICByZXR1cm4gKG9iamVjdC5nZXRTZWxlY3Rpb25TdHlsZXMgJiYgb2JqZWN0LmlzRWRpdGluZylcbiAgICAgICAgPyAob2JqZWN0LmdldFNlbGVjdGlvblN0eWxlcygpW3N0eWxlTmFtZV0gfHwgb2JqZWN0W3N0eWxlTmFtZV0pXG4gICAgICAgIDogKG9iamVjdFtzdHlsZU5hbWVdIHx8IG9iamVjdFsnX18nICsgc3R5bGVOYW1lXSB8fCAnJyk7XG4gICAgfSxcbiAgICBnZXRQYXR0ZXJuOiBmdW5jdGlvbiAodXJsKSB7XG4gICAgICB2YXIgX2ZpbGwgPSB0aGlzLmdldFN0eWxlKCdmaWxsICcpO1xuICAgICAgcmV0dXJuIF9maWxsICYmIF9maWxsLnNvdXJjZTtcbiAgICB9LFxuICAgIHNldFBhdHRlcm46IGZ1bmN0aW9uICh1cmwpIHtcbiAgICAgIGlmICghdXJsKSB7XG4gICAgICAgIHRoaXMuc2V0U3R5bGUoJ2ZpbGwnKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgLy8gdmFyIF90ZXh0dXJlID0gXy5maW5kV2hlcmUodGhpcy5wcm9qZWN0LnRleHR1cmVzLCB7aWQ6IHVybH0pO1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICBmYWJyaWMudXRpbC5sb2FkSW1hZ2UodXJsLCBmdW5jdGlvbihpbWcpIHtcbiAgICAgICAgICBfdGhpcy5zZXRTdHlsZSgnZmlsbCcsIG5ldyBmYWJyaWMuUGF0dGVybih7XG4gICAgICAgICAgICBzb3VyY2U6IGltZyxcbiAgICAgICAgICAgIHJlcGVhdDogJ3JlcGVhdCdcbiAgICAgICAgICB9KSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0sXG4gICAgZ2V0T3BhY2l0eTogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuZ2V0U3R5bGUoJ29wYWNpdHknKSAqIDEwMDtcbiAgICB9LFxuICAgIHNldE9wYWNpdHk6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgdGhpcy5zZXRTdHlsZSgnb3BhY2l0eScsIHBhcnNlSW50KHZhbHVlLCAxMCkgLyAxMDApO1xuICAgIH0sXG4gICAgZ2V0UmFkaXVzOiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5nZXQoJ3JhZGl1cycpO1xuICAgIH0sXG4gICAgc2V0U2hhZG93OiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICByZXR1cm4gdGhpcy5zZXRQcm9wZXJ0eSgnc2hhZG93Jywgb3B0aW9ucyA/IG5ldyBmYWJyaWMuU2hhZG93KG9wdGlvbnMpIDogbnVsbCk7XG4gICAgfSxcbiAgICBzZXRQcm9wZXJ0eTogZnVuY3Rpb24gKHByb3AsIHZhbHVlKSB7XG4gICAgICB0aGlzW3Byb3BdID0gdmFsdWU7XG4gICAgICB0aGlzLmNhbnZhcyAmJiB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICB9LFxuICAgIHNldFJhZGl1czogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICB0aGlzLnNldFByb3BlcnR5KCdyYWRpdXMnLCB2YWx1ZSk7XG4gICAgfSxcbiAgICBnZXRTcGFjaW5nOiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5nZXQoJ3NwYWNpbmcnKTtcbiAgICB9LFxuICAgIHNldFNwYWNpbmc6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgdGhpcy5zZXRQcm9wZXJ0eSgnc3BhY2luZycsIHZhbHVlKTtcbiAgICB9LFxuICAgIGdldFJldmVydGVkOiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5nZXQoJ3JldmVydGVkJyk7XG4gICAgfSxcbiAgICBzZXRSZXZlcnRlZDogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICB0aGlzLnNldFByb3BlcnR5KCdyZXZlcnRlZCcsIHZhbHVlKTtcbiAgICB9LFxuICAgIGdldEZpbGw6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLmdldFN0eWxlKCdmaWxsJyk7XG4gICAgfSxcbiAgICBzZXRGaWxsOiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgIHRoaXMuc2V0U3R5bGUoJ2ZpbGwnLCB2YWx1ZSk7XG4gICAgfSxcbiAgICBnZXRUZXh0OiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5nZXQoJ3RleHQnKTtcbiAgICB9LFxuICAgIHNldFRleHQ6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgdGhpcy5zZXRQcm9wZXJ0eSgndGV4dCcsIHZhbHVlKTtcbiAgICB9LFxuICAgIGdldFRleHRBbGlnbjogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuZ2V0KCd0ZXh0QWxpZ24nKTtcbiAgICB9LFxuICAgIHNldFRleHRBbGlnbjogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICB0aGlzLnNldFByb3BlcnR5KCd0ZXh0QWxpZ24nLCB2YWx1ZS50b0xvd2VyQ2FzZSgpKTtcbiAgICB9LFxuICAgIGdldEZvbnRGYW1pbHk6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLmdldCgnZm9udEZhbWlseScpO1xuICAgIH0sXG4gICAgc2V0Rm9udEZhbWlseTogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICB0aGlzLnNldFN0eWxlKCdmb250RmFtaWx5JywgdmFsdWUpO1xuICAgIH0sXG4gICAgZ2V0U3R5bGVzOiBmdW5jdGlvbigpe1xuICAgICAgcmV0dXJuIHRoaXMuc3R5bGVzIHx8IHtcbiAgICAgICAgICBmaWxsIDogICAgICAgICAgICAgICAgdGhpcy5maWxsLFxuICAgICAgICAgIGZvbnRTaXplIDogICAgICAgICAgICB0aGlzLmZvbnRTaXplLFxuICAgICAgICAgIHRleHRCYWNrZ3JvdW5kQ29sb3IgOiB0aGlzLnRleHRCYWNrZ3JvdW5kQ29sb3IsXG4gICAgICAgICAgdGV4dERlY29yYXRpb24gOiAgICAgIHRoaXMudGV4dERlY29yYXRpb24sXG4gICAgICAgICAgZm9udEZhbWlseSA6ICAgICAgICAgIHRoaXMuZm9udEZhbWlseSxcbiAgICAgICAgICBmb250V2VpZ2h0IDogICAgICAgICAgdGhpcy5mb250V2VpZ2h0LFxuICAgICAgICAgIGZvbnRTdHlsZSA6ICAgICAgICAgICB0aGlzLmZvbnRTdHlsZSxcbiAgICAgICAgICBzdHJva2UgOiAgICAgICAgICAgICAgdGhpcy5zdHJva2UsXG4gICAgICAgICAgc3Ryb2tlV2lkdGggOiAgICAgICAgIHRoaXMuc3Ryb2tlV2lkdGhcbiAgICAgICAgfTtcbiAgICB9LFxuICAgIGdldEJnQ29sb3I6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLmdldCgnYmFja2dyb3VuZENvbG9yJyk7XG4gICAgfSxcbiAgICBzZXRCZ0NvbG9yOiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgIHRoaXMuc2V0UHJvcGVydHkoJ2JhY2tncm91bmRDb2xvcicsIHZhbHVlKTtcbiAgICB9LFxuICAgIGdldFRleHRCZ0NvbG9yOiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5nZXQoJ3RleHRCYWNrZ3JvdW5kQ29sb3InKTtcbiAgICB9LFxuICAgIHNldFRleHRCZ0NvbG9yOiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgIHRoaXMuc2V0UHJvcGVydHkoJ3RleHRCYWNrZ3JvdW5kQ29sb3InLCB2YWx1ZSk7XG4gICAgfSxcbiAgICBnZXRTdHJva2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLmdldFN0eWxlKCdzdHJva2UnKTtcbiAgICB9LFxuICAgIHNldFN0cm9rZTogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICB0aGlzLnNldFN0eWxlKCdzdHJva2UnLCB2YWx1ZSk7XG4gICAgfSxcbiAgICBnZXRTdHJva2VXaWR0aDogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuZ2V0U3R5bGUoJ3N0cm9rZVdpZHRoJyk7XG4gICAgfSxcbiAgICBzZXRTdHJva2VXaWR0aDogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICB0aGlzLnNldFN0eWxlKCdzdHJva2VXaWR0aCcsIHBhcnNlSW50KHZhbHVlLCAxMCkpO1xuICAgIH0sXG4gICAgZGVjcmVhc2VGb250U2l6ZTogZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5zZXRTdHlsZSgnZm9udFNpemUnLCBwYXJzZUludCh0aGlzLmdldFN0eWxlKCdmb250U2l6ZScpKSAtIDEpO1xuICAgIH0sXG4gICAgaW5jcmVhc2VGb250U2l6ZTogZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5zZXRTdHlsZSgnZm9udFNpemUnLCBwYXJzZUludCh0aGlzLmdldFN0eWxlKCdmb250U2l6ZScpKSArIDEpO1xuICAgIH0sXG4gICAgZ2V0Rm9udFNpemU6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLmdldFN0eWxlKCdmb250U2l6ZScpO1xuICAgIH0sXG4gICAgc2V0Rm9udFNpemU6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgdGhpcy5zZXRTdHlsZSgnZm9udFNpemUnLCBwYXJzZUludCh2YWx1ZSwgMTApKTtcbiAgICB9LFxuICAgIGdldExpbmVIZWlnaHQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLmdldFN0eWxlKCdsaW5lSGVpZ2h0Jyk7XG4gICAgfSxcbiAgICBzZXRMaW5lSGVpZ2h0OiBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgIHRoaXMuc2V0U3R5bGUoJ2xpbmVIZWlnaHQnLCBwYXJzZUZsb2F0KHZhbHVlLCAxMCkpO1xuICAgIH0sXG4gICAgYWRkVGV4dDogZnVuY3Rpb24gKHRleHQsb3B0aW9ucykge1xuXG4gICAgICB2YXIgX21hdGNoID0gdGhpcy50ZXh0Lm1hdGNoKC9cXG4vZyk7XG4gICAgICB2YXIgX2xpbmVJbmRleCA9IF9tYXRjaCAmJiBfbWF0Y2gubGVuZ3RoIHx8IDA7XG4gICAgICB2YXIgY2hhckluZGV4ID0gdGhpcy50ZXh0Lmxlbmd0aCAtIHRoaXMudGV4dC5sYXN0SW5kZXhPZihcIlxcblwiKSAtIDE7XG5cbiAgICAgIGlmKCF0aGlzLnN0eWxlc1tfbGluZUluZGV4XSl7XG4gICAgICAgIHRoaXMuc3R5bGVzW19saW5lSW5kZXhdID0ge31cbiAgICAgIH1cblxuICAgICAgaWYoIXRoaXMuc3R5bGVzW19saW5lSW5kZXhdW2NoYXJJbmRleF0pe1xuICAgICAgICB0aGlzLnN0eWxlc1tfbGluZUluZGV4XVtjaGFySW5kZXhdID0ge31cbiAgICAgIH1cbiAgICAgIGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQodGhpcy5zdHlsZXNbX2xpbmVJbmRleF1bY2hhckluZGV4XSxvcHRpb25zKTtcbiAgICAgIHRoaXMudGV4dCArPXRleHQ7XG4gICAgICAvLyB0aGlzLnN0eWxlcztcbiAgICB9LFxuICAgIGdldEJvbGQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLmdldFN0eWxlKCdmb250V2VpZ2h0JykgPT09IFwiYm9sZFwiO1xuICAgIH0sXG4gICAgc2V0Qm9sZDogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICB0aGlzLnNldFN0eWxlKCdmb250V2VpZ2h0JywgdmFsdWUgPyAnYm9sZCcgOiAnJyk7XG4gICAgfSxcbiAgICBnZXRJdGFsaWM6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLmdldFN0eWxlKCdmb250U3R5bGUnKSA9PT0gJ2l0YWxpYyc7XG4gICAgfSxcbiAgICBzZXRJdGFsaWM6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgdGhpcy5zZXRTdHlsZSgnZm9udFN0eWxlJywgdmFsdWUgPyAnaXRhbGljJyA6ICcnICk7XG4gICAgfSxcbiAgICBnZXRVbmRlcmxpbmU6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLmdldFN0eWxlKCd0ZXh0RGVjb3JhdGlvbicpLmluZGV4T2YoJ3VuZGVybGluZScpID4gLTE7XG4gICAgfSxcbiAgICBzZXRVbmRlcmxpbmU6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgdmFsdWUgPSB2YWx1ZSA/ICh0aGlzLmdldFN0eWxlKCd0ZXh0RGVjb3JhdGlvbicpICsgJyB1bmRlcmxpbmUnKVxuICAgICAgICA6IHRoaXMuZ2V0U3R5bGUoJ3RleHREZWNvcmF0aW9uJykucmVwbGFjZSgndW5kZXJsaW5lJywgJycpO1xuXG4gICAgICB0aGlzLnNldFN0eWxlKCd0ZXh0RGVjb3JhdGlvbicsIHZhbHVlKTtcbiAgICB9LFxuICAgIGdldExpbmV0aHJvdWdoOiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5nZXRTdHlsZSgndGV4dERlY29yYXRpb24nKS5pbmRleE9mKCdsaW5lLXRocm91Z2gnKSA+IC0xO1xuICAgIH0sXG4gICAgc2V0TGluZXRocm91Z2g6IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgdmFsdWUgPSB2YWx1ZSA/ICh0aGlzLmdldFN0eWxlKCd0ZXh0RGVjb3JhdGlvbicpICsgJyBsaW5lLXRocm91Z2gnKVxuICAgICAgICA6IHRoaXMuZ2V0U3R5bGUoJ3RleHREZWNvcmF0aW9uJykucmVwbGFjZSgnbGluZS10aHJvdWdoJywgJycpO1xuXG4gICAgICB0aGlzLnNldFN0eWxlKCd0ZXh0RGVjb3JhdGlvbicsIHZhbHVlKTtcbiAgICB9LFxuICAgIGdldE92ZXJsaW5lOiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpcy5nZXRTdHlsZSgndGV4dERlY29yYXRpb24nKS5pbmRleE9mKCdvdmVybGluZScpID4gLTE7XG4gICAgfSxcbiAgICBzZXRPdmVybGluZTogZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICB2YWx1ZSA9IHZhbHVlID8gKHRoaXMuZ2V0U3R5bGUoJ3RleHREZWNvcmF0aW9uJykgKyAnIG92ZXJsaW5lJylcbiAgICAgICAgOiB0aGlzLmdldFN0eWxlKCd0ZXh0RGVjb3JhdGlvbicpLnJlcGxhY2UoJ292ZXJsaW4nLCAnJyk7XG5cbiAgICAgIHRoaXMuc2V0U3R5bGUoJ3RleHREZWNvcmF0aW9uJywgdmFsdWUpO1xuICAgIH0sXG4gICAgc2V0U3R5bGU6IGZ1bmN0aW9uIChzdHlsZU5hbWUsIHZhbHVlKSB7XG4gICAgICB2YXIgb2JqZWN0ID0gdGhpcztcbiAgICAgIHZhciBfb2xkID0gZmFicmljLnV0aWwub2JqZWN0LmNsb25lRGVlcChvYmplY3QuZ2V0U3R5bGVzKCkpO1xuICAgICAgLy92YXIgX29sZCA9IGZhYnJpYy51dGlsLm9iamVjdC5kZWVwRXh0ZW5kKHt9LCBvYmplY3QuZ2V0U3R5bGVzKTsvL2dldFNlbGVjdGlvblN0eWxlcygpO1xuICAgICAgaWYgKG9iamVjdC5zZXRTZWxlY3Rpb25TdHlsZXMgJiYgb2JqZWN0LmlzRWRpdGluZykge1xuICAgICAgICB2YXIgc3R5bGUgPSB7fTtcbiAgICAgICAgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBzdHlsZVtzdHlsZU5hbWVdID0gdmFsdWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZGVsZXRlIHN0eWxlW3N0eWxlTmFtZV07XG4gICAgICAgIH1cbiAgICAgICAgb2JqZWN0LnNldFNlbGVjdGlvblN0eWxlcyhzdHlsZSk7XG4gICAgICAgIG9iamVjdC5zZXRDb29yZHMoKTtcbiAgICAgIH1cbiAgICAgIGVsc2Uge1xuICAgICAgICBpZiAodmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIG9iamVjdFtzdHlsZU5hbWVdID0gdmFsdWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZGVsZXRlIG9iamVjdFtzdHlsZU5hbWVdO1xuICAgICAgICB9XG4gICAgICAgIGZvciAodmFyIGkgaW4gb2JqZWN0LnN0eWxlcykge1xuICAgICAgICAgIGZvciAodmFyIGogaW4gb2JqZWN0LnN0eWxlc1tpXSkge1xuICAgICAgICAgICAgaWYgKG9iamVjdC5zdHlsZXNbaV1bal1bc3R5bGVOYW1lXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgIGRlbGV0ZSBvYmplY3Quc3R5bGVzW2ldW2pdW3N0eWxlTmFtZV07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHZhciBzdHlsZXNfZGF0YSA9IG9iamVjdC5nZXRTdHlsZXMoKTtcblxuICAgICAgaWYodGhpcy50eXBlICE9IFwidGV4dFwiKXtcbiAgICAgICAgdGhpcy5zdHlsZXMgPSBmYWJyaWMudXRpbC5vYmplY3QuY2xvbmVEZWVwKHN0eWxlc19kYXRhKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5zZXRDb29yZHMoKTtcblxuICAgICAgdGhpcy5maXJlKFwic3R5bGVzOm1vZGlmaWVkXCIsIHtcbiAgICAgICAgb3JpZ2luYWw6IF9vbGQsXG4gICAgICAgIG1vZGlmaWVkOiBzdHlsZXNfZGF0YVxuICAgICAgfSk7XG4gICAgICB0aGlzLmNhbnZhcyAmJiB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICAgIC8qXG4gICAgICAgdGhpcy5wcm9qZWN0Lmhpc3RvcnkuYWRkKHtcbiAgICAgICBzbGlkZTogdGhpcy5zbGlkZSxcbiAgICAgICBvYmplY3Q6IHRoaXMsXG4gICAgICAgdW5kbzogX29sZCxcbiAgICAgICByZWRvOiBzdHlsZXNfZGF0YSxcbiAgICAgICB0eXBlOiAnc3R5bGVkJyxcbiAgICAgICB1bmRvRm46IGZ1bmN0aW9uKCl7XG4gICAgICAgdGhpcy5vYmplY3QuZGF0YS5zdHlsZXMgPSB0aGlzLnVuZG87XG4gICAgICAgdGhpcy5vYmplY3QuZmFicmljLnNldCgnc3R5bGVzJyx0aGlzLnVuZG8pO1xuICAgICAgIHRoaXMub2JqZWN0LmZhYnJpYy5zZXRDb29yZHMoKTtcbiAgICAgICB0aGlzLm9iamVjdC5zbGlkZS5yZW5kZXIoKTtcbiAgICAgICB9LFxuICAgICAgIHJlZG9GbjogIGZ1bmN0aW9uKCl7XG4gICAgICAgdGhpcy5vYmplY3QuZGF0YS5zdHlsZXMgPSB0aGlzLnJlZG87XG4gICAgICAgdGhpcy5vYmplY3QuZmFicmljLnNldCgnc3R5bGVzJyx0aGlzLnJlZG8pO1xuICAgICAgIHRoaXMub2JqZWN0LmZhYnJpYy5zZXRDb29yZHMoKTtcbiAgICAgICB0aGlzLm9iamVjdC5zbGlkZS5yZW5kZXIoKTtcbiAgICAgICB9XG4gICAgICAgfSk7Ki9cbiAgICB9LFxuXG4gICAgZ2VuZXJhdGVUZXh0U3R5bGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgICdmb250LXN0eWxlJzogdGhpcy5pc0l0YWxpYygpID8gJ2l0YWxpYycgOiAnbm9ybWFsJyxcbiAgICAgICAgJ2ZvbnQtd2VpZ2h0JzogdGhpcy5pc0JvbGQoKSA/IDcwMCA6IDQwMCxcbiAgICAgICAgJ3RleHQtZGVjb3JhdGlvbic6ICh0aGlzLmlzTGluZXRocm91Z2goKSA/ICdsaW5lLXRocm91Z2ggJyA6ICcnICkgK1xuICAgICAgICAodGhpcy5pc092ZXJsaW5lKCkgPyAnb3ZlcmxpbmUgJyA6ICcnICkgK1xuICAgICAgICAodGhpcy5pc1VuZGVybGluZSgpID8gJ3VuZGVybGluZSAnIDogJycpXG4gICAgICB9XG4gICAgfVxuICB9KTtcblxuICBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5JVGV4dC5wcm90b3R5cGUsIHtcbiAgICBpbml0SGlkZGVuVGV4dGFyZWFfbmF0aXZlOiBmYWJyaWMuSVRleHQucHJvdG90eXBlLmluaXRIaWRkZW5UZXh0YXJlYSxcbiAgICBpbml0SGlkZGVuVGV4dGFyZWE6IGZ1bmN0aW9uKCl7XG4gICAgICB0aGlzLmluaXRIaWRkZW5UZXh0YXJlYV9uYXRpdmUoKTtcbiAgICAgIHRoaXMuaGlkZGVuVGV4dGFyZWEuc3R5bGUud2lkdGggPSBcIjk5OTlweFwiO1xuICAgIH0sXG4gICAgLyoqXG4gICAgICogRXhpdHMgZnJvbSBlZGl0aW5nIHN0YXRlXG4gICAgICogQHJldHVybiB7ZmFicmljLklUZXh0fSB0aGlzQXJnXG4gICAgICogQGNoYWluYWJsZVxuICAgICAqL1xuICAgIGV4aXRFZGl0aW5nOiBmdW5jdGlvbigpIHtcbiAgICAgIC8vIHZhciBpc1RleHRDaGFuZ2VkID0gKHRoaXMuX3RleHRCZWZvcmVFZGl0ICE9PSB0aGlzLnRleHQpO1xuICAgICAgdGhpcy5zZWxlY3RlZCA9IGZhbHNlO1xuICAgICAgdGhpcy5pc0VkaXRpbmcgPSBmYWxzZTtcbiAgICAgIHRoaXMuc2VsZWN0YWJsZSA9IHRydWU7XG5cbiAgICAgIHRoaXMuc2VsZWN0aW9uRW5kID0gdGhpcy5zZWxlY3Rpb25TdGFydDtcbiAgICAgIHRoaXMuaGlkZGVuVGV4dGFyZWEgJiYgdGhpcy5jYW52YXMgJiYgdGhpcy5oaWRkZW5UZXh0YXJlYS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMuaGlkZGVuVGV4dGFyZWEpO1xuICAgICAgdGhpcy5oaWRkZW5UZXh0YXJlYSA9IG51bGw7XG5cbiAgICAgIHRoaXMuYWJvcnRDdXJzb3JBbmltYXRpb24oKTtcbiAgICAgIHRoaXMuX3Jlc3RvcmVFZGl0aW5nUHJvcHMoKTtcbiAgICAgIHRoaXMuX2N1cnJlbnRDdXJzb3JPcGFjaXR5ID0gMDtcblxuICAgICAgdGhpcy5maXJlKCdlZGl0aW5nOmV4aXRlZCcpO1xuICAgICAgLy8gaXNUZXh0Q2hhbmdlZCAmJiB0aGlzLmZpcmUoJ21vZGlmaWVkJyk7XG4gICAgICBpZiAodGhpcy5jYW52YXMpIHtcbiAgICAgICAgdGhpcy5jYW52YXMub2ZmKCdtb3VzZTptb3ZlJywgdGhpcy5tb3VzZU1vdmVIYW5kbGVyKTtcbiAgICAgICAgdGhpcy5jYW52YXMuZmlyZSgndGV4dDplZGl0aW5nOmV4aXRlZCcsIHsgdGFyZ2V0OiB0aGlzIH0pO1xuICAgICAgICB0aGlzLmNhbnZhcy5maXJlTW9kaWZpZWRJZkNoYW5nZWQodGFyZ2V0KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG4gICAgbWF4U3Ryb2tlV2lkdGg6IGZ1bmN0aW9uKCl7XG4gICAgICByZXR1cm4gTWF0aC5jZWlsKCB0aGlzLmdldEZvbnRTaXplKCkgLyAxMCk7XG4gICAgfVxuICB9KTtcblxuICB2YXIgX1RFWCA9IGZhYnJpYy5JVGV4dC5wcm90b3R5cGU7XG4gIGZhYnJpYy5UZXh0LnByb3RvdHlwZS5hY3Rpb25zID0gZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCh7fSwgZmFicmljLk9iamVjdC5wcm90b3R5cGUuYWN0aW9ucywge1xuICAgICAgcmFzdGVyaXplVGV4dDoge1xuICAgICAgICBpbnNlcnQ6ICdyYXN0ZXJpemVUb29sJyxcbiAgICAgICAgY2xhc3NOYW1lOiAnYnV0dG9uLWVhc2VsJyxcbiAgICAgICAgdGl0bGU6ICdyYXN0ZXJpemVUZXh0JyxcbiAgICAgICAgYWN0aW9uOiBfVEVYLnJhc3Rlcml6ZVRleHRcbiAgICAgIH0sXG4gICAgICBmaWxsOiB7XG4gICAgICAgIHR5cGU6ICdjb2xvcicsXG4gICAgICAgIHRpdGxlOiAnZmlsbCcsXG4gICAgICAgIGluc2VydDogJyFhZHZhbmNlZENvbG9yc1Rvb2xzJyxcbiAgICAgICAgdmFsdWU6ICdmaWxsJ1xuICAgICAgfSxcbiAgICAgIGNvbG9yczoge1xuICAgICAgICBjbGFzc05hbWU6ICdjb2xvcnMnLFxuICAgICAgICB0eXBlOiAnbWVudScsXG4gICAgICAgIHRpdGxlOiAnY29sb3JzJyxcbiAgICAgICAgdG9nZ2xlZDogdHJ1ZSxcbiAgICAgICAgaW5zZXJ0OiAnYWR2YW5jZWRDb2xvcnNUb29scycsXG4gICAgICAgIG1lbnU6IHtcbiAgICAgICAgICB0ZXh0Qmdjb2xvcjoge1xuICAgICAgICAgICAgdHlwZTogJ2NvbG9yJyxcbiAgICAgICAgICAgIHRpdGxlOiAnYmdDb2xvcicsXG4gICAgICAgICAgICB2YWx1ZToge1xuICAgICAgICAgICAgICBnZXQ6IF9URVguZ2V0QmdDb2xvcixcbiAgICAgICAgICAgICAgc2V0OiBfVEVYLnNldEJnQ29sb3JcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIHRleHRUZXh0Ymdjb2xvcjoge1xuICAgICAgICAgICAgdHlwZTogJ2NvbG9yJyxcbiAgICAgICAgICAgIHRpdGxlOiAndGV4dEJnQ29sb3InLFxuICAgICAgICAgICAgdmFsdWU6IHtcbiAgICAgICAgICAgICAgZ2V0OiBfVEVYLmdldFRleHRCZ0NvbG9yLFxuICAgICAgICAgICAgICBzZXQ6IF9URVguc2V0VGV4dEJnQ29sb3JcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIHRleHRGaWxsOiB7XG4gICAgICAgICAgICB0eXBlOiAnY29sb3InLFxuICAgICAgICAgICAgdGl0bGU6ICdmaWxsJyxcbiAgICAgICAgICAgIHZhbHVlOiB7XG4gICAgICAgICAgICAgIGdldDogX1RFWC5nZXRGaWxsLFxuICAgICAgICAgICAgICBzZXQ6IF9URVguc2V0RmlsbFxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIHRleHRTdHlsZToge1xuICAgICAgICB0eXBlOiAnbWVudScsXG4gICAgICAgIHRpdGxlOiAndGV4dCBzdHlsZScsXG4gICAgICAgIHRvZ2dsZWQ6IHRydWUsXG4gICAgICAgIGNsYXNzTmFtZTogJ2ZhIGZhLWZvbnQnLFxuICAgICAgICBzdHlsZTogJ2dlbmVyYXRlVGV4dFN0eWxlJyxcbiAgICAgICAgbWVudToge1xuICAgICAgICAgIHRleHRCb2xkOiB7XG4gICAgICAgICAgICB0eXBlOiBcImNoZWNrYm94XCIsXG4gICAgICAgICAgICB0aXRsZTogJ2JvbGQnLFxuICAgICAgICAgICAgdmFsdWU6ICdib2xkJyxcbiAgICAgICAgICAgIGNsYXNzTmFtZTogJ2ZhIGZhLWJvbGQnXG4gICAgICAgICAgfSxcbiAgICAgICAgICB0ZXh0SXRhbGljOiB7XG4gICAgICAgICAgICB0eXBlOiBcImNoZWNrYm94XCIsXG4gICAgICAgICAgICB0aXRsZTogJ2l0YWxpYycsXG4gICAgICAgICAgICB2YWx1ZTogJ2l0YWxpYycsXG4gICAgICAgICAgICBjbGFzc05hbWU6ICdmYSBmYS1pdGFsaWMnXG4gICAgICAgICAgfSxcbiAgICAgICAgICB0ZXh0VW5kZXJsaW5lOiB7XG4gICAgICAgICAgICB0eXBlOiBcImNoZWNrYm94XCIsXG4gICAgICAgICAgICB0aXRsZTogJ1VuZGVybGluZScsXG4gICAgICAgICAgICB2YWx1ZTogJ3VuZGVybGluZScsXG4gICAgICAgICAgICBjbGFzc05hbWU6ICdmYSBmYS11bmRlcmxpbmUnXG4gICAgICAgICAgfSxcbiAgICAgICAgICB0ZXh0TGluZXRocm91Z2g6IHtcbiAgICAgICAgICAgIHR5cGU6IFwiY2hlY2tib3hcIixcbiAgICAgICAgICAgIGluc2VydDogJ2FkdmFuY2VkVGV4dFN0eWxlVG9vbHMnLFxuICAgICAgICAgICAgdGl0bGU6ICdMaW5ldGhyb3VnaCcsXG4gICAgICAgICAgICB2YWx1ZTogJ2xpbmV0aHJvdWdoJyxcbiAgICAgICAgICAgIGNsYXNzTmFtZTogJ3RleHQtbGluZXRocm91Z2ggZmEgZmEtc3RyaWtldGhyb3VnaCdcbiAgICAgICAgICB9LFxuICAgICAgICAgIHRleHRPdmVybGluZToge1xuICAgICAgICAgICAgdHlwZTogXCJjaGVja2JveFwiLFxuICAgICAgICAgICAgaW5zZXJ0OiAnYWR2YW5jZWRUZXh0U3R5bGVUb29scycsXG4gICAgICAgICAgICB0aXRsZTogJ292ZXJsaW5lJyxcbiAgICAgICAgICAgIHZhbHVlOiAnb3ZlcmxpbmUnLFxuICAgICAgICAgICAgY2xhc3NOYW1lOiAndGV4dC1vdmVybGluZSBmYSBmYS1vdmVybGluZSdcbiAgICAgICAgICB9LFxuICAgICAgICAgIHRleHRBbGlnbjoge1xuICAgICAgICAgICAgdHlwZTogJ29wdGlvbnMnLFxuICAgICAgICAgICAgdGl0bGU6ICd0ZXh0IGFsaWduJyxcbiAgICAgICAgICAgIGluc2VydDogJ3RleHRBbGlnbWVudFRvb2xzJyxcbiAgICAgICAgICAgIHZhbHVlOiBcInRleHRBbGlnblwiLFxuICAgICAgICAgICAgbWVudToge1xuICAgICAgICAgICAgICB0ZXh0QWxpZ25DZW50ZXI6IHtcbiAgICAgICAgICAgICAgICB0aXRsZTogJ2FsaWduIGNlbnRlcicsXG4gICAgICAgICAgICAgICAgb3B0aW9uOiAnY2VudGVyJyxcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICdmYSBmYS1hbGlnbi1jZW50ZXInXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIHRleHRBbGlnbkxlZnQ6IHtcbiAgICAgICAgICAgICAgICB0aXRsZTogJ2FsaWduIGxlZnQnLFxuICAgICAgICAgICAgICAgIG9wdGlvbjogJ2xlZnQnLFxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2ZhIGZhLWFsaWduLWxlZnQnXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIHRleHRBbGlnblJpZ2h0OiB7XG4gICAgICAgICAgICAgICAgdGl0bGU6ICdhbGlnbiByaWdodCcsXG4gICAgICAgICAgICAgICAgb3B0aW9uOiAncmlnaHQnLFxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2ZhIGZhLWFsaWduLXJpZ2h0J1xuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB0ZXh0QWxpZ25KdXN0aWZ5OiB7XG4gICAgICAgICAgICAgICAgdGl0bGU6ICdhbGlnbiBqdXN0aWZ5JyxcbiAgICAgICAgICAgICAgICBvcHRpb246ICdqdXN0aWZ5JyxcbiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICdmYSBmYS1hbGlnbi1qdXN0aWZ5J1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBmb250RmFtaWx5OiB7XG4gICAgICAgICAgICB0eXBlOiAnZm9udEZhbWlseScsXG4gICAgICAgICAgICB0aXRsZTogJ2ZvbnQgZmFtaWx5JyxcbiAgICAgICAgICAgIGNsYXNzTmFtZTogJ2ZhIGZhLXRleHQnLFxuICAgICAgICAgICAgdmFsdWU6ICdmb250RmFtaWx5JyxcbiAgICAgICAgICAgIGRhdGE6IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgIHJldHVybiB0aGlzLmFwcGxpY2F0aW9uLl9mb250c1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgdGV4dEZvbnRTaXplOiB7XG4gICAgICAgICAgICBpbnNlcnQ6ICd0ZXh0Rm9udFNpemVUb29scycsXG4gICAgICAgICAgICB0eXBlOiAnbnVtYmVyJyxcbiAgICAgICAgICAgIHRpdGxlOiAnZm9udFNpemUnLFxuICAgICAgICAgICAgdmFsdWU6ICdmb250U2l6ZSdcbiAgICAgICAgICB9LFxuICAgICAgICAgIC8qdGV4dEZvbnQ6IHtcbiAgICAgICAgICAgIGluc2VydDogJ3RleHRGb250U2l6ZVRvb2xzJyxcbiAgICAgICAgICAgIHR5cGU6ICdtZW51JyxcbiAgICAgICAgICAgIHRpdGxlOiAnZm9udCcsXG4gICAgICAgICAgICBjbGFzc05hbWU6ICdmYSBmYS1mb250JyxcbiAgICAgICAgICAgIG1lbnU6IHtcbiAgICAgICAgICAgICAgdGV4dEZvbnRTaXplRGVjcmVhc2U6IHtcbiAgICAgICAgICAgICAgICB0aXRsZTogJ2RlY3JlYXNlRm9udFNpemUnLFxuICAgICAgICAgICAgICAgIGFjdGlvbjogX1RFWC5kZWNyZWFzZUZvbnRTaXplLFxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogJ2ZhIGZhLWZvbnQgZm9udC1zaXplLWRlY3JlYXNlJ1xuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB0ZXh0Rm9udFNpemVJbmNyZWFzZToge1xuICAgICAgICAgICAgICAgIHRpdGxlOiAnaW5jcmVhc2VGb250U2l6ZScsXG4gICAgICAgICAgICAgICAgYWN0aW9uOiBfVEVYLmluY3JlYXNlRm9udFNpemUsXG4gICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAnZmEgZmEtZm9udCBmb250LXNpemUtaW5jcmVhc2UnXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9Ki9cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgKTtcbiAgZmFicmljLklUZXh0LnByb3RvdHlwZS5hY3Rpb25zID0gZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCh7fSwgZmFicmljLlRleHQucHJvdG90eXBlLmFjdGlvbnMsIHtcbiAgICAgIHRleHRFZGl0OiB7XG4gICAgICAgIGluc2VydDogICAgICdlZGl0VG9vbCcsXG4gICAgICAgIGNsYXNzTmFtZTogICdmYSBmYS1wZW5jaWwtc3F1YXJlLW8nLFxuICAgICAgICB0aXRsZTogICAgICAnZWRpdCcsXG4gICAgICAgIGFjdGlvbjogICAgIF9URVguZW50ZXJFZGl0aW5nXG4gICAgICB9XG4gICAgfVxuICApO1xuLypcbiAgZmFicmljLlRleHQuYXN5bmMgPSB0cnVlO1xuICBmYWJyaWMuVGV4dC5mcm9tT2JqZWN0ID0gZnVuY3Rpb24gKG9iamVjdCwgY2FsbGJhY2spIHtcbiAgICB2YXIgX3RvdGFsID0gMCwgbG9hZGVkID0gMDtcblxuICAgIGZ1bmN0aW9uIGNyZWF0ZSgpIHtcbiAgICAgIGlmIChvYmplY3QuY3VydmUpIHtcbiAgICAgICAgdmFyIGYgPSBuZXcgZmFicmljLkN1cnZlZFRleHQob2JqZWN0LnRleHQsIG9iamVjdCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgZiA9IG5ldyBmYWJyaWMuSVRleHQob2JqZWN0LnRleHQsIG9iamVjdCk7XG4gICAgICB9XG4gICAgICBjYWxsYmFjayAmJiBjYWxsYmFjayhmKTtcbiAgICB9XG4gICAgXy5yZWNvdXJzaXZlKG9iamVjdCxcbiAgICAgIGZ1bmN0aW9uIChwcm9wZXJ0eSwgdmFsdWUsIHBhcmVudCkge1xuXG4gICAgICAgIGlmIChwcm9wZXJ0eSA9PSAncGF0dGVybicpIHtcbiAgICAgICAgICBfdG90YWwrKztcbiAgICAgICAgICAvLyAgdmFyIF90ZXh0dXJlID0gXy5maW5kV2hlcmUoby5wcm9qZWN0LnRleHR1cmVzLHtpZDogcGFyZW50W3Byb3BlcnR5XX0pO1xuXG4gICAgICAgICAgdmFyIF90ZXh0dXJlID0gZmFicmljLnRleHR1cmVzUGF0aCArIHBhcmVudFtwcm9wZXJ0eV07XG5cbiAgICAgICAgICBmYWJyaWMudXRpbC5sb2FkSW1hZ2UoX3RleHR1cmUsIGZ1bmN0aW9uIChpbWcpIHtcbiAgICAgICAgICAgIC8vdGhpc1twcm9wZXJ0eV0gPSBuZXcgZmFicmljLkltYWdlKGltZyk7XG5cbiAgICAgICAgICAgIHBhcmVudFsnZmlsbCddID0gbmV3IGZhYnJpYy5QYXR0ZXJuKHtcbiAgICAgICAgICAgICAgc291cmNlOiBpbWcsXG4gICAgICAgICAgICAgIHJlcGVhdDogJ3JlcGVhdCdcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZGVsZXRlIHBhcmVudFtwcm9wZXJ0eV07XG4gICAgICAgICAgICBsb2FkZWQrKztcbiAgICAgICAgICAgIGlmIChfdG90YWwgPT0gbG9hZGVkKWNyZWF0ZSgpO1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgLy9cbiAgICAgICAgICAvL3BhcmVudFsnZmlsbCddID0gbmV3IGZhYnJpYy5QYXR0ZXJuKHtcbiAgICAgICAgICAvLyAgICBzb3VyY2U6IF90ZXh0dXJlLFxuICAgICAgICAgIC8vICAgIHJlcGVhdDogJ3JlcGVhdCdcbiAgICAgICAgICAvL30pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgKTtcbiAgICBpZiAoX3RvdGFsID09IGxvYWRlZCkge1xuICAgICAgcmV0dXJuIGNyZWF0ZSgpO1xuICAgIH1cbiAgfTsqL1xuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9vYmplY3RzL1NsaWRlVGV4dC5qc1xuLy8gbW9kdWxlIGlkID0gMTAxXG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIid1c2Ugc3RyaWN0JztcblxuLy9mYWJyaWMucmVxdWlyZShcIlNwZWVjaFwiLFtcIlNoYXBlTWl4aW5cIixcIlRleHRBcmVhTWl4aW5cIl0sIGZ1bmN0aW9uKCkge1xuXG4gICAgZmFicmljLlNwZWVjaCA9IGZhYnJpYy51dGlsLmNyZWF0ZUNsYXNzKGZhYnJpYy5Hcm91cCwge1xuICAgICAgICB0eXBlOiAnc3BlZWNoJyxcblxuICAgICAgICBpbml0aWFsaXplOiBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICAgICAgb3B0aW9ucyB8fCAoIG9wdGlvbnMgPSB7fSk7XG5cbiAgICAgICAgICAgIHZhciBfcGF0aCA9IG9wdGlvbnMucGF0aDtcbiAgICAgICAgICAgIGRlbGV0ZSBvcHRpb25zLnBhdGg7XG5cbiAgICAgICAgICAgIHRoaXMuY2FsbFN1cGVyKCdpbml0aWFsaXplJywgW10sIG9wdGlvbnMpO1xuXG5cbiAgICAgICAgICAgIHRoaXMuX2luaXRCdWJibGUob3B0aW9ucyk7XG5cbiAgICAgICAgICAgIHRoaXMuX3BvaW50cyA9IHRoaXMuYnViYmxlICYmIHRoaXMuYnViYmxlLl9wb2ludHM7XG4gICAgICAgICAgICBpZiAodGhpcy5fcG9pbnRzKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRQb2ludCgwLCB7XG4gICAgICAgICAgICAgICAgICAgIHg6IHRoaXMuYnViYmxlLnNwZWVjaFggfHwgLTI1LFxuICAgICAgICAgICAgICAgICAgICB5OiB0aGlzLmJ1YmJsZS5zcGVlY2hZIHx8IDI1XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdGhpcy5faW5pdFBvaW50cyhvcHRpb25zLnBvaW50cyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuc2V0KHtcbiAgICAgICAgICAgICAgICBjZW50ZXJlZFNjYWxpbmc6IHRydWUsXG4gICAgICAgICAgICAgICAgaGFzQ29udHJvbHM6IHRydWUsXG4gICAgICAgICAgICAgICAgbG9ja1NjYWxpbmdGbGlwOiB0cnVlXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdGhpcy5faW5pdFRleHQob3B0aW9ucy50ZXh0KTtcbiAgICAgICAgICAgIHRoaXMub24oXCJkYmxjbGlja1wiLCB0aGlzLl9vbl90ZXh0X2VkaXQpO1xuXG4gICAgICAgICAgICB0aGlzLl9pbml0UGF0aChfcGF0aCk7XG5cbiAgICAgICAgICAgIHRoaXMuc2V0V2lkdGgoTWF0aC5tYXgodGhpcy5nZXRNaW5XaWR0aCgpLCB0aGlzLndpZHRoKSk7XG4gICAgICAgICAgICB0aGlzLnNldEhlaWdodChNYXRoLm1heCh0aGlzLmdldE1pbkhlaWdodCgpLCB0aGlzLmhlaWdodCkpO1xuXG4gICAgICAgICAgICB0aGlzLmluaXRNb3VzZWRvd25IYW5kbGVyKCk7XG5cblxuICAgICAgICB9LFxuICAgICAgICBkcmF3Q29udHJvbHM6IGZ1bmN0aW9uIChjdHgpIHtcbiAgICAgICAgICBpZiAoIXRoaXMuaGFzQ29udHJvbHMpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICAgIH1cbiAgICAgICAgICBmYWJyaWMuT2JqZWN0LnByb3RvdHlwZS5kcmF3Q29udHJvbHMuY2FsbCh0aGlzLCBjdHgpO1xuXG4gICAgICAgICAgdGhpcy5kcmF3U2hhcGVDb250cm9scyhjdHgpO1xuICAgICAgICB9LFxuXG4gICAgICAvKipcbiAgICAgICAgICogQHByaXZhdGVcbiAgICAgICAgICovXG4gICAgICAgIF9vbk9iamVjdEFkZGVkOiBmdW5jdGlvbiAob2JqZWN0KSB7XG4gICAgICAgICAgICBvYmplY3QuZ3JvdXAgPSB0aGlzO1xuICAgICAgICAgICAgb2JqZWN0Ll9zZXQoJ2NhbnZhcycsIHRoaXMuY2FudmFzKTtcbiAgICAgICAgfSxcbiAgICAgICAgX2luaXRQYXRoOiBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICAgICAgaWYgKG9wdGlvbnMpIHtcbiAgICAgICAgICAgICAgICB2YXIgcGF0aCA9IG5ldyBmYWJyaWMuUGF0aChvcHRpb25zLnBhdGgsIG9wdGlvbnMpO1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0UGF0aChwYXRoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgc2V0UGF0aDogZnVuY3Rpb24gKHBhdGgpIHtcbiAgICAgICAgICAgIHRoaXMucGF0aCA9IHBhdGg7XG4gICAgICAgICAgICAvLyAgICB0aGlzLnBhdGggPSBuZXcgZmFicmljLlBhdGgodGhpcy5fcGF0aCwgb3B0aW9ucyk7XG4gICAgICAgICAgICB0aGlzLnBhdGguc2V0KHtcbiAgICAgICAgICAgICAgICBvcmlnaW5YOiBcImNlbnRlclwiLFxuICAgICAgICAgICAgICAgIG9yaWdpblk6IFwiY2VudGVyXCIsXG4gICAgICAgICAgICAgICAgbGVmdDogMCxcbiAgICAgICAgICAgICAgICB0b3A6IDAsXG4gICAgICAgICAgICAgICAgc2NhbGVYOiB0aGlzLndpZHRoIC8gdGhpcy5wYXRoLndpZHRoLFxuICAgICAgICAgICAgICAgIHNjYWxlWTogdGhpcy5oZWlnaHQgLyB0aGlzLnBhdGguaGVpZ2h0XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdGhpcy5hZGQodGhpcy5wYXRoKTtcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlKHRoaXMudGV4dCk7XG4gICAgICAgICAgICB0aGlzLmFkZCh0aGlzLnRleHQpO1xuICAgICAgICAgICAgdGhpcy51cGRhdGVQYXRoU3Ryb2tlV2lkdGgoKTtcbi8v77+977+977+977+977+9IO+/ve+/ve+/ve+/ve+/ve+/vSDvv73vv73vv73vv73vv73vv73vv73vv73vv73vv70g77+977+977+9IO+/ve+/ve+/ve+/ve+/ve+/ve+/ve+/ve+/vSwg77+977+977+977+977+9ICDvv73vv73vv73vv73vv73vv73vv73vv73vv71cbiAgICAgICAgfSxcbiAgICAgICAgc2V0UG9pbnQ6IGZ1bmN0aW9uIChvcmRlciwgX3BvaW50KSB7XG4gICAgICAgICAgICBmYWJyaWMuQnViYmxlLnByb3RvdHlwZS5zZXRQb2ludC5jYWxsKHRoaXMsIG9yZGVyLCBfcG9pbnQpO1xuICAgICAgICAgICAgdGhpcy5idWJibGUuc2V0UG9pbnQob3JkZXIsIF9wb2ludCk7XG4gICAgICAgIH0sXG4gICAgICAgIF9pbml0QnViYmxlOiBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgICAgICAgaWYgKG9wdGlvbnMuYnViYmxlKSB7XG5cblxuICAgICAgICAgICAgICAgIGZhYnJpYy51dGlsLmNyZWF0ZU9iamVjdChvcHRpb25zLmJ1YmJsZSwgZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5idWJibGUgPSBlbGVtZW50O1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmJ1YmJsZS5zZXQoe1xuICAgICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IHRoaXMud2lkdGgsXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IHRoaXMuaGVpZ2h0LFxuICAgICAgICAgICAgICAgICAgICAgICAgb3JpZ2luWDogXCJjZW50ZXJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIG9yaWdpblk6IFwiY2VudGVyXCJcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkKHRoaXMuYnViYmxlKTtcbiAgICAgICAgICAgICAgICB9LmJpbmQodGhpcykpO1xuXG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbml0aWFsaXplcyBcIm1vdXNlZG93blwiIGV2ZW50IGhhbmRsZXJcbiAgICAgICAgICovXG4gICAgICAgIGluaXRNb3VzZWRvd25IYW5kbGVyOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAvL3RoaXMub24oJ21vdXNlZG93bicsIGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgICAgICAgIC8vICAgIHRoaXMudGV4dC5maXJlKFwibW91c2Vkb3duXCIsb3B0aW9ucyk7XG4gICAgICAgICAgICAvL30pO1xuICAgICAgICB9LFxuICAgICAgICB1cGRhdGVQYXRoU3Ryb2tlV2lkdGg6IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICAgICAgdmFyIF9zYyA9IE1hdGgubWluKHRoaXMucGF0aC5zY2FsZVksIHRoaXMucGF0aC5zY2FsZVgpXG4gICAgICAgICAgICB0aGlzLnBhdGguc2V0KFwic3Ryb2tlV2lkdGhcIiwgMSAvIF9zYyk7XG4gICAgICAgIH0sXG4gICAgICAgIHNldEhlaWdodDogZnVuY3Rpb24gKGgpIHtcblxuICAgICAgICAgICAgaWYgKHRoaXMuaGVpZ2h0ICYmIHRoaXMuYnViYmxlICYmIHRoaXMuYnViYmxlLnNldFBvaW50ICYmIHRoaXMuYnViYmxlLnNwZWVjaFkgJiYgdGhpcy5idWJibGUuc3BlZWNoWSA+IHRoaXMuaGVpZ2h0KSB7XG4gICAgICAgICAgICAgICAgdmFyIF95b2ZmID0gdGhpcy5idWJibGUuc3BlZWNoWSAtIHRoaXMuaGVpZ2h0O1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aGlzLmhlaWdodCA9IGg7XG4gICAgICAgICAgICBpZiAodGhpcy5idWJibGUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmJ1YmJsZS5oZWlnaHQgPSB0aGlzLmhlaWdodDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLnBhdGgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnBhdGguc2V0KHtcbiAgICAgICAgICAgICAgICAgICAgc2NhbGVZOiB0aGlzLmhlaWdodCAvIHRoaXMucGF0aC5oZWlnaHRcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVBhdGhTdHJva2VXaWR0aCgpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoX3lvZmYgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0UG9pbnQoMCwge3g6IHRoaXMuYnViYmxlLnNwZWVjaFgsIHk6IHRoaXMuaGVpZ2h0ICsgX3lvZmZ9KTtcbiAgICAgICAgICAgICAgICB0aGlzLmNhbnZhcyAmJiB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgc2V0V2lkdGg6IGZ1bmN0aW9uICh3KSB7XG4gICAgICAgICAgICBpZiAodGhpcy53aWR0aCAmJiB0aGlzLmJ1YmJsZSAmJiB0aGlzLmJ1YmJsZS5zZXRQb2ludCAmJiB0aGlzLmJ1YmJsZS5zcGVlY2hYICYmIHRoaXMuYnViYmxlLnNwZWVjaFggPiB0aGlzLndpZHRoKSB7XG4gICAgICAgICAgICAgICAgdmFyIF94b2ZmID0gdGhpcy5idWJibGUuc3BlZWNoWCAtIHRoaXMud2lkdGg7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLndpZHRoID0gdztcbiAgICAgICAgICAgIGlmICh0aGlzLmJ1YmJsZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuYnViYmxlLndpZHRoID0gdztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLnBhdGgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnBhdGguc2V0KHtcbiAgICAgICAgICAgICAgICAgICAgc2NhbGVYOiB0aGlzLndpZHRoIC8gdGhpcy5wYXRoLndpZHRoXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdGhpcy51cGRhdGVQYXRoU3Ryb2tlV2lkdGgoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChfeG9mZiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRQb2ludCgwLCB7eDogdGhpcy53aWR0aCArIF94b2ZmLCB5OiB0aGlzLmJ1YmJsZS5zcGVlY2hZfSk7XG4gICAgICAgICAgICAgICAgdGhpcy5jYW52YXMgJiYgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIF9zZXQ6IGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7XG4gICAgICAgICAgICBpZiAoa2V5ID09IFwid2lkdGhcIikge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0V2lkdGgodmFsdWUpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChrZXkgPT0gXCJoZWlnaHRcIikge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0SGVpZ2h0KHZhbHVlKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jYWxsU3VwZXIoJ19zZXQnLCBrZXksIHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9LFxuXG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJldHVybnMgb2JqZWN0IHJlcHJlc2VudGF0aW9uIG9mIGFuIGluc3RhbmNlXG4gICAgICAgICAqIEBwYXJhbSB7QXJyYXl9IFtwcm9wZXJ0aWVzVG9JbmNsdWRlXSBBbnkgcHJvcGVydGllcyB0aGF0IHlvdSBtaWdodCB3YW50IHRvIGFkZGl0aW9uYWxseSBpbmNsdWRlIGluIHRoZSBvdXRwdXRcbiAgICAgICAgICogQHJldHVybiB7T2JqZWN0fSBvYmplY3QgcmVwcmVzZW50YXRpb24gb2YgYW4gaW5zdGFuY2VcbiAgICAgICAgICovXG4gICAgICAgIHRvT2JqZWN0OiBmdW5jdGlvbiAocHJvcGVydGllc1RvSW5jbHVkZSkge1xuXG4gICAgICAgICAgICBpZiAodGhpcy5wYXRoKSB7XG4gICAgICAgICAgICAgICAgdmFyIHBhdGggPSB0aGlzLnBhdGgudG9PYmplY3QoKTtcbiAgICAgICAgICAgICAgICBwYXRoLnBhdGggPSB0aGlzLnBhdGgucGF0aC5qb2luKFwiIFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBvYmplY3QgPSBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5PYmplY3QucHJvdG90eXBlLnRvT2JqZWN0LmNhbGwodGhpcywgcHJvcGVydGllc1RvSW5jbHVkZSksIHtcbiAgICAgICAgICAgICAgICBidWJibGU6IHRoaXMuYnViYmxlICYmIHRoaXMuYnViYmxlLnRvT2JqZWN0KCkgfHwgbnVsbCxcbiAgICAgICAgICAgICAgICBwYXRoOiBwYXRoIHx8IG51bGwsXG4gICAgICAgICAgICAgICAgdGV4dDogdGhpcy50ZXh0ICYmIHRoaXMudGV4dC50b09iamVjdCgpIHx8IG51bGxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYgKCF0aGlzLmluY2x1ZGVEZWZhdWx0VmFsdWVzKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fcmVtb3ZlRGVmYXVsdFZhbHVlcyhvYmplY3QpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG9iamVjdDtcbiAgICAgICAgfSxcbiAgICAgICAgc2V0T2JqZWN0U2NhbGU6IGZhYnJpYy51dGlsLnJlc2l6ZU9uU2NhbGluZyxcbiAgICAgICAgbG9ja1NjYWxpbmdZOiBmYWxzZSxcbiAgICAgICAgbG9ja1NjYWxpbmdYOiBmYWxzZSxcbiAgICAgICAgX3NldHVwQ3VycmVudFRyYW5zZm9ybTogZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIHRoaXMuY2FudmFzLmNhbGxTdXBlcignX3NldHVwQ3VycmVudFRyYW5zZm9ybScsIGUsIHRoaXMpO1xuICAgICAgICAgICAgdGhpcy5jYW52YXMuX2N1cnJlbnRUcmFuc2Zvcm0ub3JpZ2luYWwuaGVpZ2h0ID0gdGhpcy5oZWlnaHQ7XG4gICAgICAgICAgICB0aGlzLmNhbnZhcy5fY3VycmVudFRyYW5zZm9ybS5vcmlnaW5hbC53aWR0aCA9IHRoaXMud2lkdGg7XG4gICAgICAgIH0sXG4gICAgICAgIHRleHRQYWRkaW5nWDogMjUsXG4gICAgICAgIHRleHRQYWRkaW5nWTogMTVcbiAgICB9KTtcblxuICAgIGZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLlNwZWVjaC5wcm90b3R5cGUsIGZhYnJpYy5TaGFwZU1peGluKTtcbiAgICBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5TcGVlY2gucHJvdG90eXBlLCBmYWJyaWMuVGV4dEFyZWFNaXhpbik7XG4gICAgZmFicmljLnV0aWwuY3JlYXRlQWNjZXNzb3JzKGZhYnJpYy5TcGVlY2gpO1xuXG4gICAgZmFicmljLlNwZWVjaC5mcm9tT2JqZWN0ID0gZnVuY3Rpb24gKG9iamVjdCkge1xuICAgICAgICByZXR1cm4gbmV3IGZhYnJpYy5TcGVlY2gob2JqZWN0KTtcbiAgICB9O1xuXG5cbmlmIChmYWxzZSAmJiBmYWJyaWMub2JqZWN0c0xpYnJhcnkpIHtcbiAgZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMub2JqZWN0c0xpYnJhcnksIHtcbiAgICBzcGVlY2gyOiB7XG4gICAgICB0aXRsZTogXCJSZWN0IFNwZWVjaFwiLFxuICAgICAgXCJ0eXBlXCI6IFwiU3BlZWNoXCIsXG4gICAgICBcIndpZHRoXCI6IGZ1bmN0aW9uICh3LCBoKSB7XG4gICAgICAgIHJldHVybiB3IC0gNDBcbiAgICAgIH0sXG4gICAgICBcImhlaWdodFwiOiBmdW5jdGlvbiAodywgaCkge1xuICAgICAgICByZXR1cm4gaCAtIDQwXG4gICAgICB9LFxuICAgICAgXCJidWJibGVcIjoge1xuICAgICAgICBcInR5cGVcIjogXCJyZWN0XCIsXG4gICAgICAgIFwib3BhY2l0eVwiOiAwLjUsXG4gICAgICAgIFwic3Ryb2tlXCI6IFwiYmxhY2tcIixcbiAgICAgICAgXCJzdHJva2VXaWR0aFwiOiA1LFxuICAgICAgICBcImZpbGxcIjogXCJibHVlXCIsXG4gICAgICAgIFwicnhcIjogMjAsXG4gICAgICAgIFwicnlcIjogMjAsXG4gICAgICAgIFwiYnViYmxlU2l6ZVwiOiAyMCxcbiAgICAgICAgXCJidWJibGVPZmZzZXRYXCI6IDAsXG4gICAgICAgIFwiYnViYmxlT2Zmc2V0WVwiOiA1LFxuICAgICAgICBcInNwZWVjaFhcIjogMjMsXG4gICAgICAgIFwic3BlZWNoWVwiOiA2NlxuICAgICAgfSxcbiAgICAgIFwidGV4dFwiOiB7XG4gICAgICAgIFwiZm9udFNpemVcIjogMTAsXG4gICAgICAgIFwiZm9udEZhbWlseVwiOiBcIkNvbWljIFNhbnNcIixcbiAgICAgICAgXCJ0ZXh0XCI6IFwiUmVjdFxcblNwZWVjaFwiXG4gICAgICB9XG4gICAgfSxcbiAgICBzcGVlY2gzOiB7XG4gICAgICB0aXRsZTogXCJCdWJibGUgU3BlZWNoXCIsXG4gICAgICBcInR5cGVcIjogXCJTcGVlY2hcIixcbiAgICAgIFwid2lkdGhcIjogZnVuY3Rpb24gKHcsIGgpIHtcbiAgICAgICAgcmV0dXJuIHcgLSA0MFxuICAgICAgfSxcbiAgICAgIFwiaGVpZ2h0XCI6IGZ1bmN0aW9uICh3LCBoKSB7XG4gICAgICAgIHJldHVybiBoIC0gNDBcbiAgICAgIH0sXG4gICAgICBcImJ1YmJsZVwiOiB7XG4gICAgICAgIFwidHlwZVwiOiBcImJ1YmJsZVwiLFxuICAgICAgICBcIm9wYWNpdHlcIjogMC41LFxuICAgICAgICBcInN0cm9rZVwiOiBcImJsYWNrXCIsXG4gICAgICAgIFwic3Ryb2tlV2lkdGhcIjogNSxcbiAgICAgICAgXCJmaWxsXCI6IFwiYmx1ZVwiLFxuICAgICAgICBcInJ4XCI6IDIwLFxuICAgICAgICBcInJ5XCI6IDIwLFxuICAgICAgICBcImJ1YmJsZVNpemVcIjogMjAsXG4gICAgICAgIFwiYnViYmxlT2Zmc2V0WFwiOiAwLFxuICAgICAgICBcImJ1YmJsZU9mZnNldFlcIjogNSxcbiAgICAgICAgXCJzcGVlY2hYXCI6IDIzLFxuICAgICAgICBcInNwZWVjaFlcIjogNjZcbiAgICAgIH0sXG4gICAgICBcInRleHRcIjoge1xuICAgICAgICBcImZvbnRTaXplXCI6IDEwLFxuICAgICAgICBcImZvbnRGYW1pbHlcIjogXCJDb21pYyBTYW5zXCIsXG4gICAgICAgIFwidGV4dFwiOiBcIkknbSBCdWJibGVcXG5TcGVlY2hcIlxuICAgICAgfVxuICAgIH0sXG4gICAgc3BlZWNoNDoge1xuICAgICAgdGl0bGU6IFwiVGhpbmsgU3BlZWNoXCIsXG4gICAgICBcInR5cGVcIjogXCJTcGVlY2hcIixcbiAgICAgIFwibGVmdFwiOiA0NTAsXG4gICAgICBcInRvcFwiOiA0NjAsXG4gICAgICBcImJ1YmJsZVwiOiB7XG4gICAgICAgIFwidHlwZVwiOiBcInRoaW5rXCIsXG4gICAgICAgIFwic3Ryb2tlXCI6IFwiYmxhY2tcIixcbiAgICAgICAgXCJmaWxsXCI6IFwid2hpdGVcIixcbiAgICAgICAgXCJkcmF3RWxsaXBzZVwiOiBmYWxzZSxcbiAgICAgICAgXCJzcGVlY2hYXCI6IDksXG4gICAgICAgIFwic3BlZWNoWVwiOiAxMzNcbiAgICAgIH0sXG4gICAgICBcInBhdGhcIjoge1xuICAgICAgICBcInBhdGhcIjogXCJtNTgxLjA3Nzk0MiwyLjUzNzM1OWMtMi4wNTMyMjMsMC4wNDcwNzEgLTQuMDQwNzEsMC4xODgzNDggLTYuMTA4MDkzLDAuMzUyOTA3Yy0zMy4wNTU0MiwyLjY2MzkxOCAtNjIuMjM1OTAxLDE5LjY0MDU0MSAtNzcuMDU3Njc4LDQ0LjkyNTk1M2wtNy44NTczLDE5LjEzNTMxOWMxLjY5ODgyMiwtNi42MzMxNDQgNC4zMDI5NzksLTEzLjA2NTM4NCA3Ljg1NzMsLTE5LjEzNTMxOWMtMjYuNDMwNjk1LC0yMi4xNjI5MyAtNjMuNTMxNjc3LC0zMi4zODg0NDUgLTEwMC4xOTIzODMsLTI3LjU3NDM3M2MtMzYuNjYxNDY5LDQuNzg4MzUzIC02OC41MDMwODIsMjQuMDQxNzU4IC04NS45MDE5NzgsNTEuOTM1MjI1Yy00OS4xMTY0ODYsLTI0LjQ5MDAxMyAtMTEwLjM0Mjg4LC0yMi45OTk0NTQgLTE1Ny43MTE4MDcsMy44NjAwOTJjLTQ3LjM2OTE2NCwyNi44NjA2OCAtNzIuNjE2NzMsNzQuNDA1NTEgLTY0Ljk0MTE2MiwxMjIuMzgzMDhsNS4wMjEzNTUsMTkuNDk5NjhjLTIuMjYzMzI5LC02LjM4NTAxIC0zLjk2MDc5MywtMTIuODg3Njk1IC01LjAyMTM1NSwtMTkuNDk5NjhsLTAuNzYxOTQ4LDEuNzk4NTY5Yy00MS4xNzkxNjUsMy42MjUyNDQgLTc0Ljk0NTM3NSwyOS40NjUxMzQgLTgzLjcxNjM5OCw2NC4wNTkyMzVjLTguNzcxODA1LDM0LjU5Nzc0OCA5LjQ2NzAxLDcwLjA4NTg3NiA0NS4xODU2MjEsODcuOTY3MDFsNTUuNzc2NTU4LDEwLjk3MzExNGMtMTkuNDgwMjE3LDEuMjkxOTYyIC0zOC45MTU1NDMsLTIuNTM0NTE1IC01NS43NzY1NTgsLTEwLjk3MzExNGMtMjcuNTQ3OCwyNC45NjgxNyAtMzMuODg4NTE2LDYxLjkzNTMwMyAtMTUuNzE0OTIsOTIuNDY3ODM0YzE4LjE3MzczMywzMC41MjQ3MTkgNTYuOTg4ODk5LDQ4LjExMDY4NyA5Ny4wMzA0NTcsNDQuMTE3MzRsMjQuMzM5NzIyLC01LjIxMTA5Yy03LjgyNzQ5OSwyLjY1MTYxMSAtMTUuOTYwOTgzLDQuMzc5MDU5IC0yNC4zMzk3MjIsNS4yMTEwOWMyMi43MzAwNDIsMzMuODU3MjY5IDYwLjQyODE5Miw1OC41NTYyNDQgMTA0LjY2ODkzLDY4LjM4MzUxNGM0NC4yNDkxLDkuODEzNjYgOTEuMjQwOTUyLDQuMDE0NzcxIDEzMC40MjU5NDksLTE2LjA5NDYwNGMzMS45NjcwMSw0MC43OTM4MjMgODguNzA3NjQyLDYyLjIxNzQ2OCAxNDUuNTk2MzEzLDU0Ljk5NzA3YzU2LjkwMjQ2NiwtNy4yMTk2NjYgMTAzLjgzMzk4NCwtNDEuODE0MjcgMTIwLjUwMTM0MywtODguNzcwOTk2bDUuNzgxNDMzLC0yNi4yMzk1MzJjLTAuODYzNzA4LDguOTA5NTQ2IC0yLjc0MjI0OSwxNy42ODEzNjYgLTUuNzgxNDMzLDI2LjIzOTUzMmMzOS4xMzMzMDEsMjAuNzUzNjYyIDg4LjM1MzMzMywyMS45MjczMDcgMTI4Ljc4NTA5NSwzLjA0OTMxNmM0MC40Mzk4MTksLTE4Ljg3NDA4NCA2NS42NjU3NzEsLTU0Ljg2OTA0OSA2Ni4wMzYxMzMsLTk0LjA3ODI0N2wtMTQuNDk1NjA1LC01OC41ODA1OTdsLTU3LjEwNTcxMywtMzkuNjMwNzY4YzQ0LjE2MzQ1MiwyMi4zNzQ1NzMgNzEuOTkyNjE1LDU2LjQ2NzI1NSA3MS42MDEzMTgsOTguMjExMzY1YzUyLjQ5NzA3LDAuNDQ4MTgxIDk3LjEwMzM5NCwtMzUuOTU2NTczIDExNy4xMTI0MjcsLTc3LjcyNjI4OGMyMC4wMTE1OTcsLTQxLjc2OTgzNiAxMi40NDM2MDQsLTg5LjM5Njc1OSAtMTkuODY0OTI5LC0xMjUuMTY0NjQyYzEzLjQwMTE4NCwtMjYuNjM3Njk1IDEyLjYwOTk4NSwtNTYuOTM3MzMyIC0yLjE4MzQ3MiwtODMuMDM0MDg4Yy0xNC43ODYxOTQsLTI2LjA5Nzg5MyAtNDIuMDY1NDkxLC00NS40NzY4OTEgLTc0Ljg3MzA0NywtNTMuMDk4MzM1Yy03LjM0MTQzMSwtMzQuNTgwOTI5IC0zNy42MDI2NjEsLTYyLjQwNDQ4MiAtNzcuNjAwNzA4LC03MS41MjYyOTNjLTM5Ljk5ODQ3NCwtOS4xMjEzNjggLTgyLjU4NDgzOSwyLjEyMzk5MiAtMTA5LjM2NDgwNywyOC45MjYxMjNsLTE2LjI1ODE3OSwyMi4xOTgxN2M0LjE1Nzk1OSwtOC4wMTg2MTIgOS41ODM5MjMsLTE1LjQ5NTIxMyAxNi4yNTgxNzksLTIyLjE5ODE3Yy0xOC44NzY5NTMsLTIxLjA2MDcxMyAtNDguNDg2MDIzLC0zMi45NTQwNjEgLTc5LjM0ODkzOCwtMzIuMTU1NDAxbDAsMHpcIixcbiAgICAgICAgXCJzdHJva2VcIjogXCJibGFja1wiLFxuICAgICAgICBcImZpbGxcIjogXCJ3aGl0ZVwiXG4gICAgICB9LFxuICAgICAgXCJ0ZXh0XCI6IHtcbiAgICAgICAgXCJmb250U2l6ZVwiOiAyMCxcbiAgICAgICAgXCJmb250RmFtaWx5XCI6IFwiQ29taWMgU2Fuc1wiLFxuICAgICAgICBcInRleHRcIjogXCJJJ20gVGhpbmtcXG5TcGVlY2hcIlxuICAgICAgfSxcbiAgICAgIFwid2lkdGhcIjogMTUwLFxuICAgICAgXCJoZWlnaHRcIjogMTAwXG4gICAgfVxuICB9KVxufVxuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9vYmplY3RzL1NwZWVjaC5qc1xuLy8gbW9kdWxlIGlkID0gMTAyXG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIid1c2Ugc3RyaWN0JztcblxuXG5mYWJyaWMuVGV4dEZyYW1lID0gZmFicmljLnV0aWwuY3JlYXRlQ2xhc3MoZmFicmljLlRleHRib3gsIHtcbiAgICB0eXBlOiAnVGV4dEZyYW1lJyxcbiAgICBpbml0aWFsaXplOiBmdW5jdGlvbih0ZXh0LCBvcHRpb25zKSB7XG4gICAgICAgIHRoaXMuY3R4ID0gZmFicmljLnV0aWwuY3JlYXRlQ2FudmFzRWxlbWVudCgpLmdldENvbnRleHQoXCIyZFwiKTtcbiAgICAgICAgdGhpcy5jYWxsU3VwZXIoXCJpbml0aWFsaXplXCIsIHRleHQsIG9wdGlvbnMpO1xuICAgICAgICB0aGlzLnNldCh7XG4gICAgICAgICAgICBsb2NrVW5pU2NhbGluZzogb3B0aW9ucy5sb2NrU2NhbGluZ1kgfHwgZmFsc2UsXG4gICAgICAgICAgICBsb2NrU2NhbGluZ0ZsaXA6IG9wdGlvbnMubG9ja1NjYWxpbmdGbGlwIHx8IGZhbHNlLFxuICAgICAgICAgICAgbG9ja1NjYWxpbmdZOiBvcHRpb25zLmxvY2tTY2FsaW5nWSB8fCBmYWxzZSxcbiAgICAgICAgICAgIGhhc0JvcmRlcnM6IHRydWVcbiAgICAgICAgfSk7XG4gICAgICAgIC8vdGhpcy5zZXRDb250cm9sc1Zpc2liaWxpdHkoZmFicmljLlRleHRib3guZ2V0VGV4dGJveENvbnRyb2xWaXNpYmlsaXR5KCkpO1xuICAgICAgICB0aGlzLl9kaW1lbnNpb25BZmZlY3RpbmdQcm9wcy53aWR0aCA9IHRydWU7XG4gICAgICAgIHRoaXMub24oXCJjaGFuZ2VkXCIsIHRoaXMuZml0VGV4dC5iaW5kKHRoaXMpKTtcbiAgICAgICAgdGhpcy5maXRUZXh0KCk7XG4gICAgfSxcbiAgICBzZXRXaWR0aDogZnVuY3Rpb24odykge1xuICAgICAgICB0aGlzLndpZHRoID0gdztcbiAgICAgICAgdGhpcy5maXRUZXh0KCk7XG4gICAgfSxcbiAgICBzZXRIZWlnaHQ6IGZ1bmN0aW9uKGgpIHtcbiAgICAgICAgdGhpcy5oZWlnaHQgPSBoO1xuICAgICAgICB0aGlzLmZpdFRleHQoKTtcbiAgICB9LFxuICAgIF9pbml0RGltZW5zaW9uczogZnVuY3Rpb24oY3R4KSB7XG4gICAgICAgIGlmICh0aGlzLl9fc2tpcERpbWVuc2lvbikge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICghY3R4KSB7XG4gICAgICAgICAgICBjdHggPSBmYWJyaWMudXRpbC5jcmVhdGVDYW52YXNFbGVtZW50KCkuZ2V0Q29udGV4dChcIjJkXCIpO1xuICAgICAgICAgICAgdGhpcy5fc2V0VGV4dFN0eWxlcyhjdHgpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZHluYW1pY01pbldpZHRoID0gMDtcbiAgICAgICAgdGhpcy5fdGV4dExpbmVzID0gdGhpcy5fc3BsaXRUZXh0SW50b0xpbmVzKCk7XG4gICAgICAgIHRoaXMuX2NsZWFyQ2FjaGUoKTtcbiAgICB9LFxuICAgIGZpdFRleHQgOiBmdW5jdGlvbigpe1xuXG4gICAgICAgIHdoaWxlKHRoaXMuX2dldFRleHRIZWlnaHQoKSA8IHRoaXMuaGVpZ2h0ICl7XG4gICAgICAgICAgICB0aGlzLmZvbnRTaXplKys7XG4gICAgICAgICAgICB0aGlzLl9pbml0RGltZW5zaW9ucyh0aGlzLmN0eCk7XG4gICAgICAgIH1cblxuICAgICAgICB3aGlsZSh0aGlzLl9nZXRUZXh0SGVpZ2h0KCkgPiB0aGlzLmhlaWdodCB8fCB0aGlzLmR5bmFtaWNNaW5XaWR0aCA+IHRoaXMud2lkdGggKXtcbiAgICAgICAgICAgIHRoaXMuZm9udFNpemUtLTtcbiAgICAgICAgICAgIHRoaXMuX2luaXREaW1lbnNpb25zKHRoaXMuY3R4KTtcbiAgICAgICAgfVxuICAgICAgICAvL3RoaXMubGluZUhlaWdodCA9ICh0aGlzLmhlaWdodCAvIHRoaXMuX3RleHRMaW5lcy5sZW5ndGgpIC8gdGhpcy5mb250U2l6ZSAvIHRoaXMuX2ZvbnRTaXplTXVsdDtcbiAgICB9XG59KTtcbi8vXG4vL09iamVjdC5kZWZpbmVQcm9wZXJ0eShmYWJyaWMuVGV4dEZyYW1lLCBcIndpZHRoXCIsIHtcbi8vICAgIGdldDogZnVuY3Rpb24oKSB7XG4vLyAgICAgICAgcmV0dXJuIHRoaXMuX3c7XG4vLyAgICB9LFxuLy8gICAgc2V0OiBmdW5jdGlvbihzbGlkZSkge1xuLy8gICAgICAgIGNvbnNvbGUubG9nKHNsaWRlKTtcbi8vICAgICAgICB0aGlzLl93ID0gc2xpZGU7XG4vLyAgICB9XG4vL30pO1xuXG5cbmZhYnJpYy5UZXh0RnJhbWUuZnJvbU9iamVjdCA9IGZ1bmN0aW9uKG9iamVjdCwgY2FsbGJhY2spIHtcbiAgICB2YXIgX3RvdGFsID0gMCwgbG9hZGVkID0gMDtcbiAgICBmdW5jdGlvbiBjcmVhdGUoKXtcbiAgICAgICAgdmFyIGYgPSBuZXcgZmFicmljLlRleHRGcmFtZShvYmplY3QudGV4dCxvYmplY3QpO1xuICAgICAgICBjYWxsYmFjayAmJiBjYWxsYmFjayhmKTtcbiAgICB9XG4gICAgZmFicmljLnV0aWwuZGF0YS5yZWNvdXJzaXZlKG9iamVjdCxcbiAgICAgICAgZnVuY3Rpb24ocHJvcGVydHksIHZhbHVlLCBwYXJlbnQpIHtcblxuICAgICAgICAgICAgaWYgKHByb3BlcnR5ID09IFwicGF0dGVyblwiKSB7XG4gICAgICAgICAgICAgICAgX3RvdGFsICsrO1xuICAgICAgICAgICAgICAgIC8vICB2YXIgX3RleHR1cmUgPSBfLmZpbmRXaGVyZShvLnByb2plY3QudGV4dHVyZXMse2lkOiBwYXJlbnRbcHJvcGVydHldfSk7XG5cbiAgICAgICAgICAgICAgICB2YXIgX3RleHR1cmUgPSAgZmFicmljLnRleHR1cmVzUGF0aCArIHBhcmVudFtwcm9wZXJ0eV07XG5cbiAgICAgICAgICAgICAgICBmYWJyaWMudXRpbC5sb2FkSW1hZ2UoX3RleHR1cmUsIGZ1bmN0aW9uKGltZykge1xuICAgICAgICAgICAgICAgICAgICAvL3RoaXNbcHJvcGVydHldID0gbmV3IGZhYnJpYy5JbWFnZShpbWcpO1xuXG4gICAgICAgICAgICAgICAgICAgIHBhcmVudFtcImZpbGxcIl0gPSBuZXcgZmFicmljLlBhdHRlcm4oe1xuICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlOiBpbWcsXG4gICAgICAgICAgICAgICAgICAgICAgICByZXBlYXQ6IFwicmVwZWF0XCJcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGRlbGV0ZSBwYXJlbnRbcHJvcGVydHldO1xuICAgICAgICAgICAgICAgICAgICBsb2FkZWQrKztcbiAgICAgICAgICAgICAgICAgICAgaWYoX3RvdGFsID09IGxvYWRlZCljcmVhdGUoKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgICAgLy9wYXJlbnRbXCJmaWxsXCJdID0gbmV3IGZhYnJpYy5QYXR0ZXJuKHtcbiAgICAgICAgICAgICAgICAvLyAgICBzb3VyY2U6IF90ZXh0dXJlLFxuICAgICAgICAgICAgICAgIC8vICAgIHJlcGVhdDogXCJyZXBlYXRcIlxuICAgICAgICAgICAgICAgIC8vfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICApO1xuICAgIGlmKF90b3RhbCA9PSBsb2FkZWQpe1xuICAgICAgICByZXR1cm4gY3JlYXRlKCk7XG4gICAgfVxufTtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vb2JqZWN0cy9UZXh0RnJhbWUuanNcbi8vIG1vZHVsZSBpZCA9IDEwM1xuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCIvKipcbiAqIEJ1YmJsZSBPYmplY3QgbGlicmFyeSBmb3IgRmFicmljSlNcbiAqXG4gKlxuICpcbiAqIEBleGFtcGxlXG4gbm5ldyBmYWJyaWMuQnViYmxlKHtcbiAgICAgICAgIGxlZnQ6IDEwMCxcbiAgICAgICAgIHRvcDogMTAwLFxuICAgICAgICAgd2lkdGg6IDgwMCxcbiAgICAgICAgIGhlaWdodDogNjAwXG4gICAgIH0pXG4gKlxuICogQGF1dGhvciBEZW5pcyBQb25vbWFyZXZcbiAqIEBlbWFpbCBkZW4ucG9ub21hcmV2QGdtYWlsLmNvbVxuICovXG4ndXNlIHN0cmljdCc7XG5cbi8vZmFicmljLnJlcXVpcmUoXCJUaGlua1wiLFtcIlNoYXBlTWl4aW5cIl0sIGZ1bmN0aW9uKCkge1xuICAgIGZhYnJpYy5UaGluayA9IGZhYnJpYy51dGlsLmNyZWF0ZUNsYXNzKGZhYnJpYy5SZWN0LCB7XG4gICAgICAgIHR5cGU6ICd0aGluaycsXG4gICAgICAgIHN0YXRlUHJvcGVydGllczogZmFicmljLkdyb3VwLnByb3RvdHlwZS5zdGF0ZVByb3BlcnRpZXMuY29uY2F0KFtcInNwZWVjaFhcIiwgXCJzcGVlY2hZXCIsIFwiYnViYmxlT2Zmc2V0WFwiLCBcImJ1YmJsZU9mZnNldFlcIiwgXCJidWJibGVTaXplXCIsIFwiZHJhd0VsbGlwc2VcIl0pLFxuICAgICAgICBzcGVlY2hYOiAwLFxuICAgICAgICBzcGVlY2hZOiAwLFxuICAgICAgICBidWJibGVPZmZzZXRYOiAwLFxuICAgICAgICBidWJibGVTaXplOiAzMCxcbiAgICAgICAgYnViYmxlT2Zmc2V0WTogMCxcbiAgICAgICAgZHJhd0VsbGlwc2U6IHRydWUsXG4gICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICAgICAgICBvcHRpb25zIHx8ICggb3B0aW9ucyA9IHt9KTtcblxuICAgICAgICAgICAgdGhpcy5jYWxsU3VwZXIoJ2luaXRpYWxpemUnLCBvcHRpb25zKTtcblxuXG4gICAgICAgICAgICBvcHRpb25zLmJ1YmJsZVNpemUgJiYgdGhpcy5zZXQoXCJidWJibGVTaXplXCIsIG9wdGlvbnMuYnViYmxlU2l6ZSk7XG4gICAgICAgICAgICBvcHRpb25zLmRyYXdFbGxpcHNlICYmIHRoaXMuc2V0KFwiZHJhd0VsbGlwc2VcIiwgb3B0aW9ucy5kcmF3RWxsaXBzZSk7XG5cbiAgICAgICAgICAgIHRoaXMuc2V0UG9pbnQoMCwge1xuICAgICAgICAgICAgICAgIHg6IG9wdGlvbnMuc3BlZWNoWCB8fCAtMjUsXG4gICAgICAgICAgICAgICAgeTogb3B0aW9ucy5zcGVlY2hZIHx8IDI1XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdGhpcy5faW5pdFBvaW50cyhvcHRpb25zLnBvaW50cyk7XG4gICAgICAgIH0sXG4gICAgICAgIGRyYXdDb250cm9sczogZnVuY3Rpb24gKGN0eCkge1xuICAgICAgICAgIGlmICghdGhpcy5oYXNDb250cm9scykge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgICAgfVxuICAgICAgICAgIGZhYnJpYy5PYmplY3QucHJvdG90eXBlLmRyYXdDb250cm9scy5jYWxsKHRoaXMsIGN0eCk7XG5cbiAgICAgICAgICB0aGlzLmRyYXdTaGFwZUNvbnRyb2xzKGN0eCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0UG9pbnQ6IGZ1bmN0aW9uIChvcmRlciwgX3BvaW50KSB7XG5cbiAgICAgICAgICAgIGlmICghdGhpcy5fcG9pbnRzKXRoaXMuX3BvaW50cyA9IFtdO1xuICAgICAgICAgICAgaWYgKCF0aGlzLl9wb2ludHNbb3JkZXJdKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fcG9pbnRzW29yZGVyXSA9IF9wb2ludDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhpcy5zcGVlY2hYID0gdGhpcy5fcG9pbnRzW29yZGVyXS54ID0gX3BvaW50Lng7XG4gICAgICAgICAgICB0aGlzLnNwZWVjaFkgPSB0aGlzLl9wb2ludHNbb3JkZXJdLnkgPSBfcG9pbnQueTtcblxuICAgICAgICAgICAgdmFyIF94ID0gdGhpcy5zcGVlY2hYIC0gdGhpcy53aWR0aCAvIDIsIF95ID0gdGhpcy5zcGVlY2hZIC0gdGhpcy5oZWlnaHQgLyAyO1xuICAgICAgICAgICAgdGhpcy5faHlwbyA9IE1hdGguc3FydChNYXRoLnBvdyhfeCwgMikgKyBNYXRoLnBvdyhfeSwgMikpO1xuICAgICAgICAgICAgdmFyIF9rID0gdGhpcy53aWR0aCAvIHRoaXMuaGVpZ2h0O1xuICAgICAgICAgICAgdGhpcy5fYnViYmxlX2FuZ2xlX3NpbiA9IF94IC8gdGhpcy5faHlwbztcbiAgICAgICAgICAgIHRoaXMuX2J1YmJsZV9hbmdsZV9jb3MgPSBfeSAvIHRoaXMuX2h5cG87XG5cbiAgICAgICAgICAgIHRoaXMuX2J1YmJsZV9hbmdsZSA9IE1hdGguYWNvcyh0aGlzLl9idWJibGVfYW5nbGVfY29zKSAqIDE4MCAvICggTWF0aC5QSSk7XG5cblxuICAgICAgICAgICAgdGhpcy5fYnViYmxlX29mZnNldF94ID0gTWF0aC5zcXJ0KE1hdGgucG93KHRoaXMuX2J1YmJsZV9hbmdsZV9zaW4sIDIpKTtcbiAgICAgICAgICAgIHRoaXMuX2J1YmJsZV9vZmZzZXRfeSA9IE1hdGguc3FydChNYXRoLnBvdyh0aGlzLl9idWJibGVfYW5nbGVfY29zLCAyKSk7XG5cbiAgICAgICAgICAgIGlmIChfeCA+IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9idWJibGVfYW5nbGUgPSAzNjAgLSB0aGlzLl9idWJibGVfYW5nbGU7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuX2J1YmJsZV9vZmZzZXRfeCAqPSAtMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChfeSA+IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9idWJibGVfYW5nbGVfY29zICo9IC0xO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9idWJibGVfb2Zmc2V0X3kgKj0gLTE7XG4gICAgICAgICAgICB9XG5cblxuICAgICAgICAgICAgLy9jb25zb2xlLmxvZyh0aGlzLl9idWJibGVfYW5nbGUsdGhpcy5feF9wb2ludCx0aGlzLl95X3BvaW50KVxuXG4gICAgICAgIH0sXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKiBAcGFyYW0ge0NhbnZhc1JlbmRlcmluZ0NvbnRleHQyRH0gY3R4IENvbnRleHQgdG8gcmVuZGVyIG9uXG4gICAgICAgICAqL1xuICAgICAgICBfcmVuZGVyOiBmdW5jdGlvbiAoY3R4LCBub1RyYW5zZm9ybSkge1xuICAgICAgICAgICAgLy8gICAgdGhpcy5jYWxsU3VwZXIoJ19yZW5kZXInLCBjdHgsIG5vVHJhbnNmb3JtKTtcblxuXG4gICAgICAgICAgICAvLyBvcHRpbWl6ZSAxeDEgY2FzZSAodXNlZCBpbiBzcHJheSBicnVzaClcbiAgICAgICAgICAgIGlmICh0aGlzLndpZHRoID09PSAxICYmIHRoaXMuaGVpZ2h0ID09PSAxKSB7XG4gICAgICAgICAgICAgICAgY3R4LmZpbGxSZWN0KDAsIDAsIDEsIDEpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdmFyIHggPSBub1RyYW5zZm9ybSA/IHRoaXMubGVmdCA6IC10aGlzLndpZHRoIC8gMixcbiAgICAgICAgICAgICAgICB5ID0gbm9UcmFuc2Zvcm0gPyB0aGlzLnRvcCA6IC10aGlzLmhlaWdodCAvIDI7XG5cblxuICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpO1xuXG5cbiAgICAgICAgICAgIGlmICh0aGlzLmRyYXdFbGxpcHNlKSB7XG4gICAgICAgICAgICAgICAgY3R4LmVsbGlwc2UoeCArIHRoaXMud2lkdGggLyAyLCB5ICsgdGhpcy5oZWlnaHQgLyAyLCB0aGlzLndpZHRoIC8gMiwgdGhpcy5oZWlnaHQgLyAyLCAwLCAwLCAyICogTWF0aC5QSSwgZmFsc2UpO1xuICAgICAgICAgICAgfVxuXG5cbiAgICAgICAgICAgIHZhciBhID0ge1xuICAgICAgICAgICAgICAgICAgICB4OiB4ICsgdGhpcy53aWR0aCAvIDIgKyB0aGlzLl9idWJibGVfb2Zmc2V0X3ggKiB0aGlzLndpZHRoIC8gMixcbiAgICAgICAgICAgICAgICAgICAgeTogeSArIHRoaXMuX2J1YmJsZV9vZmZzZXRfeSAqIHRoaXMuaGVpZ2h0IC8gMiArIHRoaXMuaGVpZ2h0IC8gMlxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgYiA9IHtcbiAgICAgICAgICAgICAgICAgICAgeDogeCArIHRoaXMuc3BlZWNoWCxcbiAgICAgICAgICAgICAgICAgICAgeTogeSArIHRoaXMuc3BlZWNoWVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgYyA9IHtcbiAgICAgICAgICAgICAgICAgICAgeDogYS54ICsgKGIueCAtIGEueCkgLyAzICogMixcbiAgICAgICAgICAgICAgICAgICAgeTogYS55ICsgKGIueSAtIGEueSkgLyAzICogMlxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZCA9IHtcbiAgICAgICAgICAgICAgICAgICAgeDogYS54ICsgKGIueCAtIGEueCkgLyA0LFxuICAgICAgICAgICAgICAgICAgICB5OiBhLnkgKyAoYi55IC0gYS55KSAvIDRcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAvL2N0eC5tb3ZlVG8oYS54ICsgNCwgYS55KTtcbiAgICAgICAgICAgIC8vY3R4LmFyYyhhLngsYS55LCA0LCAwLCAyICogTWF0aC5QSSwgZmFsc2UpO1xuXG5cbiAgICAgICAgICAgIGN0eC5tb3ZlVG8oYy54ICsgNiwgYy55KTtcbiAgICAgICAgICAgIGN0eC5hcmMoYy54LCBjLnksIDYsIDAsIDIgKiBNYXRoLlBJLCBmYWxzZSk7XG5cbiAgICAgICAgICAgIGN0eC5tb3ZlVG8oZC54ICsgOCwgZC55KTtcbiAgICAgICAgICAgIGN0eC5hcmMoZC54LCBkLnksIDgsIDAsIDIgKiBNYXRoLlBJLCBmYWxzZSk7XG5cbiAgICAgICAgICAgIGN0eC5tb3ZlVG8oYi54ICsgNCwgYi55KTtcbiAgICAgICAgICAgIGN0eC5hcmMoYi54LCBiLnksIDQsIDAsIDIgKiBNYXRoLlBJLCBmYWxzZSk7XG5cblxuICAgICAgICAgICAgY3R4LmNsb3NlUGF0aCgpO1xuXG4gICAgICAgICAgICB0aGlzLl9yZW5kZXJGaWxsKGN0eCk7XG5cbiAgICAgICAgICAgIHRoaXMuX3JlbmRlclN0cm9rZShjdHgpO1xuICAgICAgICB9LFxuICAgICAgICAvKipcbiAgICAgICAgICogUmV0dXJucyBvYmplY3QgcmVwcmVzZW50YXRpb24gb2YgYW4gaW5zdGFuY2VcbiAgICAgICAgICogQHBhcmFtIHtBcnJheX0gW3Byb3BlcnRpZXNUb0luY2x1ZGVdIEFueSBwcm9wZXJ0aWVzIHRoYXQgeW91IG1pZ2h0IHdhbnQgdG8gYWRkaXRpb25hbGx5IGluY2x1ZGUgaW4gdGhlIG91dHB1dFxuICAgICAgICAgKiBAcmV0dXJuIHtPYmplY3R9IG9iamVjdCByZXByZXNlbnRhdGlvbiBvZiBhbiBpbnN0YW5jZVxuICAgICAgICAgKi9cbiAgICAgICAgdG9PYmplY3Q6IGZ1bmN0aW9uIChwcm9wZXJ0aWVzVG9JbmNsdWRlKSB7XG4gICAgICAgICAgICB2YXIgb2JqZWN0ID0gZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCh0aGlzLmNhbGxTdXBlcigndG9PYmplY3QnLCBwcm9wZXJ0aWVzVG9JbmNsdWRlKSwge1xuICAgICAgICAgICAgICAgIHNwZWVjaFg6IHRoaXMuZ2V0KCdzcGVlY2hYJykgfHwgMCxcbiAgICAgICAgICAgICAgICBzcGVlY2hZOiB0aGlzLmdldCgnc3BlZWNoWScpIHx8IDAsXG4gICAgICAgICAgICAgICAgYnViYmxlT2Zmc2V0WDogdGhpcy5nZXQoJ2J1YmJsZU9mZnNldFgnKSB8fCAwLFxuICAgICAgICAgICAgICAgIGJ1YmJsZU9mZnNldFk6IHRoaXMuZ2V0KCdidWJibGVPZmZzZXRZJykgfHwgMCxcbiAgICAgICAgICAgICAgICBidWJibGVTaXplOiB0aGlzLmdldCgnYnViYmxlU2l6ZScpLFxuICAgICAgICAgICAgICAgIGRyYXdFbGxpcHNlOiB0aGlzLmdldCgnZHJhd0VsbGlwc2UnKVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAoIXRoaXMuaW5jbHVkZURlZmF1bHRWYWx1ZXMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9yZW1vdmVEZWZhdWx0VmFsdWVzKG9iamVjdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gb2JqZWN0O1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgZmFicmljLlRoaW5rLmZyb21PYmplY3QgPSBmdW5jdGlvbiAob2JqZWN0KSB7XG4gICAgICAgIHJldHVybiBuZXcgZmFicmljLlRoaW5rKG9iamVjdCk7XG4gICAgfTtcbiAgICBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKGZhYnJpYy5UaGluay5wcm90b3R5cGUsIGZhYnJpYy5TaGFwZU1peGluKTtcblxuICAgIGZhYnJpYy51dGlsLmNyZWF0ZUFjY2Vzc29ycyhmYWJyaWMuVGhpbmspO1xuXG4gICAgZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZChmYWJyaWMuVGhpbmsucHJvdG90eXBlLCBmYWJyaWMuU2hhcGVNaXhpbik7XG4gICAgZmFicmljLnV0aWwuY3JlYXRlQWNjZXNzb3JzKGZhYnJpYy5UaGluayk7XG5cblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vb2JqZWN0cy9UaGluay5qc1xuLy8gbW9kdWxlIGlkID0gMTA0XG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIi8vaHR0cDovL2pzZmlkZGxlLm5ldC9tcmJlbmRlbC82cmJ0ZGU1dC8xL1xuLy9odHRwOi8vdGhlY29kZXBsYXllci5jb20vd2Fsa3Rocm91Z2gvM2QtcGVyc3BlY3RpdmUtcHJvamVjdGlvbi1jYW52YXMtamF2YXNjcmlwdFxuLy9odHRwOi8vdHVscmljaC5jb20vZ2Vla3N0dWZmL2NhbnZhcy9wZXJzcGVjdGl2ZS5odG1sXG5cblxuJ3VzZSBzdHJpY3QnO1xucmVxdWlyZShcIi4vLi4vbWl4aW5zL0Jlemllck1peGluXCIpO1xucmVxdWlyZShcIi4vLi4vbWl4aW5zL0NhY2hlTWl4aW5cIik7XG5yZXF1aXJlKFwiLi8uLi9taXhpbnMvVHJhbnNmb3JtZWRJbWFnZU1peGluXCIpO1xuXG5mYWJyaWMuVHJhbnNmb3JtZWRJbWFnZSA9IGZhYnJpYy51dGlsLmNyZWF0ZUNsYXNzKFxuZmFicmljLkltYWdlLFxuZmFicmljLkJlemllck1peGluLFxuZmFicmljLkNhY2hlTWl4aW4sXG5mYWJyaWMuVHJhbnNmb3JtZWRJbWFnZU1peGluLCB7XG4gIHR5cGU6ICd0cmFuc2Zvcm1lZC1pbWFnZScsXG4gIHBvaW50czogICAgIG51bGwsXG4gIF90cmlhbmdsZXM6IFtdLFxuICB3aXJlZnJhbWU6ICBmYWxzZSxcbiAgZml4V2lyZUZyYW1lOiB0cnVlLFxuICByZW5kZXJCb3JkZXI6ZmFsc2UsXG4gIC8vIHNwZWNpYWxQcm9wZXJ0aWVzOiBmYWJyaWMuSW1hZ2UucHJvdG90eXBlLnNwZWNpYWxQcm9wZXJ0aWVzLmNvbmNhdChbXCJwb2ludHNcIixcImN1cnZlXCJdICksXG4gIHN0YXRlUHJvcGVydGllczogW1wicG9pbnRzXCJdLmNvbmNhdChmYWJyaWMuSW1hZ2UucHJvdG90eXBlLnN0YXRlUHJvcGVydGllcyksXG4gIF9lZGl0aW5nX21vZGU6ICdzY2FsZScgLC8vJzNkJyxcbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKGVsLG9wdGlvbnMsY2FsbGJhY2spIHtcbiAgICBvcHRpb25zIHx8ICggb3B0aW9ucyA9IHt9KTtcblxuICAgIGZhYnJpYy51dGlsLm9iamVjdC5kZWZhdWx0cyhvcHRpb25zLHtcbiAgICAgIHdpZHRoIDogZWwgJiYgZWwud2lkdGggIHx8IDEwMCxcbiAgICAgIGhlaWdodDogZWwgJiYgZWwuaGVpZ2h0IHx8IDEwMFxuICAgIH0pO1xuXG4gICAgaWYob3B0aW9ucy5wb2ludHMpe1xuICAgICAgdGhpcy53aWR0aCA9IDA7XG4gICAgICB0aGlzLmhlaWdodCA9IDA7XG4gICAgfVxuXG4gICAgdGhpcy5wb2ludHMgPSBvcHRpb25zLnBvaW50cyB8fCBbXG4gICAgICAgIHt4OiAwLCB5OiAwfSxcbiAgICAgICAge3g6IG9wdGlvbnMud2lkdGgsIHk6IDB9LFxuICAgICAgICB7eDogb3B0aW9ucy53aWR0aCwgeTogb3B0aW9ucy5oZWlnaHR9LFxuICAgICAgICB7eDogMCwgeTogb3B0aW9ucy5oZWlnaHR9XG4gICAgICBdO1xuXG4gICAgaWYob3B0aW9ucy5yZW5kZXJCb3JkZXIgIT09IHVuZGVmaW5lZCl7XG4gICAgICB0aGlzLnJlbmRlckJvcmRlciAgICAgPSBvcHRpb25zLnJlbmRlckJvcmRlcjtcbiAgICB9XG4gICAgaWYob3B0aW9ucy53aXJlZnJhbWUgIT09IHVuZGVmaW5lZCl7XG4gICAgICB0aGlzLndpcmVmcmFtZSAgICAgPSBvcHRpb25zLndpcmVmcmFtZTtcbiAgICB9XG4gICAgaWYob3B0aW9ucy5wZXJzcGVjdGl2ZSAhPT0gdW5kZWZpbmVkKXtcbiAgICAgIHRoaXMucGVyc3BlY3RpdmUgICAgID0gb3B0aW9ucy5wZXJzcGVjdGl2ZTtcbiAgICB9XG4gICAgaWYob3B0aW9ucy52ZXJ0aWNhbFN1YmRpdmlzaW9ucyAhPT0gdW5kZWZpbmVkKXtcbiAgICAgIHRoaXMudmVydGljYWxTdWJkaXZpc2lvbnMgICAgID0gb3B0aW9ucy52ZXJ0aWNhbFN1YmRpdmlzaW9ucztcbiAgICB9XG4gICAgaWYob3B0aW9ucy5ob3Jpem9udGFsU3ViZGl2aXNpb25zICE9PSB1bmRlZmluZWQpe1xuICAgICAgdGhpcy5ob3Jpem9udGFsU3ViZGl2aXNpb25zICAgICA9IG9wdGlvbnMuaG9yaXpvbnRhbFN1YmRpdmlzaW9ucztcbiAgICB9XG4gICAgdGhpcy5leHRyYUNvbnRyb2xzID0ge307XG5cbiAgICB0aGlzLl9jb3JuZXJfYWN0aW9ucyA9IHRoaXMuX2Nvcm5lcl9hY3Rpb25zIHx8IHt9O1xuICAgIHRoaXMuX2Nvcm5lcl9hY3Rpb25zLmN1cnZlID0gXCJjdXJ2ZVwiO1xuXG4gICAgdGhpcy5jYWxsU3VwZXIoJ2luaXRpYWxpemUnLGVsLCBvcHRpb25zLGNhbGxiYWNrKTtcblxuXG4gICAgdGhpcy5fdXBkYXRlX2N1cnZlX3BvaW50KCk7XG4gICAgdGhpcy5faW5pdEN1cnZlT2Zmc2V0KCk7XG4gICAgdGhpcy5fc3dpdGNoX2NvbnRyb2xzID0gdGhpcy5zd2l0Y2hDb250cm9scy5iaW5kKHRoaXMpO1xuICAgIHRoaXMub24oJ2RibGNsaWNrJyx0aGlzLl9zd2l0Y2hfY29udHJvbHMpO1xuXG4gICAgaWYob3B0aW9ucy5jb250ZW50T2Zmc2V0cyl7XG4gICAgICB0aGlzLl91cGRhdGVfY29udGVudF9vZmZzZXRzKG9wdGlvbnMuY29udGVudE9mZnNldHMpO1xuICAgIH1cbiAgICB0aGlzLm9uKFwic2hhcGU6bW9kaWZpZWRcIixmdW5jdGlvbihkYXRhKXtcbiAgICAgIHRoaXMuZGlydHkgPSB0cnVlO1xuICAgICAgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gICAgfSk7XG4gICAgdGhpcy5vbihcImNvbnRlbnQ6bW9kaWZpZWRcIixmdW5jdGlvbihkYXRhKXtcbiAgICAgIGlmKGRhdGEuYm91bmRzKXtcbiAgICAgICAgdGhpcy5faW5pdEN1cnZlT2Zmc2V0KCk7XG4gICAgICAgIHZhciBfYiA9ICBkYXRhLmJvdW5kcyB8fCB7XG4gICAgICAgICAgbWluWDogMCxcbiAgICAgICAgICBtYXhYOiB0aGlzLl9vcmlnaW5hbEVsZW1lbnQud2lkdGgsXG4gICAgICAgICAgbWluWTogMCxcbiAgICAgICAgICBtYXhZOiB0aGlzLl9vcmlnaW5hbEVsZW1lbnQuaGVpZ2h0XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuX3VwZGF0ZV9jb250ZW50X29mZnNldHMoX2IpO1xuICAgICAgfVxuICAgICAgdGhpcy5kaXJ0eSA9IHRydWU7XG4gICAgICB0aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICB9KTtcbiAgICB0aGlzLnVwZGF0ZUJib3goKTtcbiAgfSxcbiAgb3B0aW9uc09yZGVyOiBmYWJyaWMuSW1hZ2UucHJvdG90eXBlLm9wdGlvbnNPcmRlci5jb25jYXQoW1wicG9pbnRzXCJdKSxcbiAgY3VydmUgOiAge3g6IDAuNSwgeTogMC41fSxcbiAgLy8gZHJhd0NvbnRyb2xzOiBmdW5jdGlvbiAoY3R4LCBzaGFwZSwgb2Zmc2V0KSB7XG4gIC8vICAgaWYgKCF0aGlzLmhhc0NvbnRyb2xzKSB7XG4gIC8vICAgICByZXR1cm4gdGhpcztcbiAgLy8gICB9XG4gIC8vICAgdGhpcy5kcmF3Qm91bmRzQ29udHJvbHMoIGN0eCk7XG4gIC8vIH0sXG4gIF91cGRhdGVfY3VydmVfcG9pbnQ6IGZ1bmN0aW9uKCl7XG4gICAgdGhpcy5leHRyYUNvbnRyb2xzLmN1cnZlID0gdGhpcy5fZ2V0UG9pbnRGb3JJbWFnZUNvb3JkaWFuYXRlKHRoaXMud2lkdGggKiB0aGlzLmN1cnZlLngsdGhpcy5oZWlnaHQgKiB0aGlzLmN1cnZlLnksdHJ1ZSk7XG4gIH0sXG4gIHNldEN1cnZlOiBmdW5jdGlvbihjdXJ2ZSl7XG4gICAgdGhpcy5jdXJ2ZSA9IGN1cnZlIHx8ICB7eDogMC41LCB5OiAwLjV9O1xuICAgIHRoaXMuZGlydHkgPSB0cnVlO1xuICAgIHRoaXMuc2V0UG9pbnQoXCJjMVwiLHt4OiB0aGlzLnBvaW50c1swXS54IC0gMTAsIHk6IHRoaXMucG9pbnRzWzBdLnkgLSAxMCB9KTtcbiAgfSxcbiAgX3BlcmZvcm1DdXJ2ZUFjdGlvbjogZnVuY3Rpb24gKGUsIHRyYW5zZm9ybSwgcG9pbnRlcikge1xuICAgIHRoaXMuZXh0cmFDb250cm9scy5jdXJ2ZS55ID0gdHJhbnNmb3JtLnBvaW50Lnk7XG4gICAgdGhpcy5leHRyYUNvbnRyb2xzLmN1cnZlLnggPSB0cmFuc2Zvcm0ucG9pbnQueDtcbiAgICB0aGlzLnNldEN1cnZlKHRoaXMuX2dldEltYWdlQ29vcmRpYW5hdGVGb3JQb2ludCh0cmFuc2Zvcm0ucG9pbnQpKTtcbiAgICB0cmFuc2Zvcm0uYWN0aW9uUGVyZm9ybWVkID0gdHJ1ZTtcbiAgfSxcbiAgX2luaXRDdXJ2ZU9mZnNldDogZnVuY3Rpb24oKXtcbiAgICB0aGlzLl9jdXJ2ZV9wb2ludF9sZWZ0ID0gICAgIHt4OiAwLCB5OiB0aGlzLmhlaWdodCAvMn07ICAgICAgICAgICAvLyAgZmFicmljLnV0aWwudHJhbnNmb3JtUG9pbnQoe3g6IDAsIHk6IHRoaXMuaGVpZ2h0IC8yfSwgdHJhbnNmb3JtTWF0cml4KTtcbiAgICB0aGlzLl9jdXJ2ZV9wb2ludF9taWRkbGUgPSAgIHt4OiB0aGlzLndpZHRoIC8gMiwgeTogdGhpcy5oZWlnaHQgKiB0aGlzLmN1cnZlLnl9OyAgICAgICAgICAgLy8gICBmYWJyaWMudXRpbC50cmFuc2Zvcm1Qb2ludCh7eDogdGhpcy53aWR0aCAvIDIsIHk6IF95fSwgdHJhbnNmb3JtTWF0cml4KTtcbiAgICB0aGlzLl9jdXJ2ZV9wb2ludF9yaWdodCA9ICAgIHt4OiB0aGlzLndpZHRoLCB5OiAgdGhpcy5oZWlnaHQgLzJ9ICAgOy8vICAgZmFicmljLnV0aWwudHJhbnNmb3JtUG9pbnQoe3g6IHRoaXMud2lkdGgsIHk6ICB0aGlzLmhlaWdodCAvMn0sIHRyYW5zZm9ybU1hdHJpeCk7XG4gIH0sXG4gIF9nZXRDdXJ2ZU9mZnNldFBvaW50IDpmdW5jdGlvbih0KSB7XG4gICAgdmFyIHggPSAoMSAtIHQpICogKDEgLSB0KSAqIHRoaXMuX2N1cnZlX3BvaW50X2xlZnQueCArIDIgKiAoMSAtIHQpICogdCAqIHRoaXMuX2N1cnZlX3BvaW50X21pZGRsZS54ICsgdCAqIHQgKiB0aGlzLl9jdXJ2ZV9wb2ludF9yaWdodC54O1xuICAgIHZhciB5ID0gKDEgLSB0KSAqICgxIC0gdCkgKiB0aGlzLl9jdXJ2ZV9wb2ludF9sZWZ0LnkgKyAyICogKDEgLSB0KSAqIHQgKiB0aGlzLl9jdXJ2ZV9wb2ludF9taWRkbGUueSArIHQgKiB0ICogdGhpcy5fY3VydmVfcG9pbnRfcmlnaHQueTtcbiAgICByZXR1cm4ge3g6IHgsIHk6IHl9O1xuICB9LFxuICBzZXRDb250cm9sUG9pbnRzOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5fY29udHJvbHMgPSBbXTtcbiAgICB0aGlzLmFkZFBvaW50c0NvbnRyb2xzKHRoaXMuX2NvbnRyb2xzKTtcbiAgICByZXR1cm4gdGhpcy5fY29udHJvbHM7XG4gIH0sXG4gIF9nZXRDdXJ2ZU9mZnNldDogZnVuY3Rpb24odCkge1xuICAgIHZhciBwID0gdGhpcy5fZ2V0Q3VydmVPZmZzZXRQb2ludCh0KTtcbiAgICBwLnkgLT0gdGhpcy5fY3VydmVfcG9pbnRfbGVmdC55O1xuICAgIHJldHVybiBwO1xuICB9LFxuICBfc2hvd19wb2ludGVyczogZnVuY3Rpb24gKCkgIHtcbiAgICBpZih0aGlzLl9lZGl0aW5nX21vZGUgPT0gJzNkJyl7XG5cbiAgICAgIHZhciBfZGVmYXVsdF9jb3JuZXJzID0ge1xuICAgICAgICB0bDogZmFsc2UsXG4gICAgICAgIHRyOiBmYWxzZSxcbiAgICAgICAgYnI6IGZhbHNlLFxuICAgICAgICBibDogZmFsc2UsXG4gICAgICAgIG1sOiBmYWxzZSxcbiAgICAgICAgbXQ6IGZhbHNlLFxuICAgICAgICBtcjogZmFsc2UsXG4gICAgICAgIG1iOiBmYWxzZSxcbiAgICAgICAgbXRyOmZhbHNlLFxuICAgICAgICBwIDogdHJ1ZVxuICAgICAgfTtcbiAgICB9ZWxzZXtcbiAgICAgIHZhciBfZGVmYXVsdF9jb3JuZXJzID0ge1xuICAgICAgICB0bDogdHJ1ZSxcbiAgICAgICAgdHI6IHRydWUsXG4gICAgICAgIGJyOiB0cnVlLFxuICAgICAgICBibDogdHJ1ZSxcbiAgICAgICAgbWw6IHRydWUsXG4gICAgICAgIG10OiB0cnVlLFxuICAgICAgICBtcjogdHJ1ZSxcbiAgICAgICAgbWI6IHRydWUsXG4gICAgICAgIG10cjp0cnVlLFxuICAgICAgICBwIDogZmFsc2VcbiAgICAgIH07XG4gICAgfVxuICAgIGZvcih2YXIgaSBpbiBfZGVmYXVsdF9jb3JuZXJzKXtcbiAgICAgIHRoaXMuX2NvbnRyb2xzVmlzaWJpbGl0eVtpXSA9IF9kZWZhdWx0X2Nvcm5lcnNbaV07XG4gICAgfVxuICAgIHRoaXMuY2FudmFzICYmIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICB9LFxuICBzd2l0Y2hDb250cm9sczogZnVuY3Rpb24gKCkge1xuICAgIGlmKHRoaXMuX2VkaXRpbmdfbW9kZSA9PSAnM2QnKXtcbiAgICAgIHRoaXMuX2VkaXRpbmdfbW9kZSA9ICdzY2FsZSc7XG4gICAgfWVsc2V7XG4gICAgICB0aGlzLl9lZGl0aW5nX21vZGUgPSAnM2QnO1xuICAgIH1cbiAgICB0aGlzLl9zaG93X3BvaW50ZXJzKCk7XG4gICAgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gIH0sXG4gIG5vcm1hbGl6ZTogZnVuY3Rpb24oKXtcbiAgICB0aGlzLm9mZignZGJsY2xpY2snLHRoaXMuX3N3aXRjaF9jb250cm9scyk7XG4gICAgZGVsZXRlIHRoaXMuX3N3aXRjaF9jb250cm9scztcbiAgfSxcbiAgLyoqXG4gICAqIEBwcml2YXRlXG4gICAqIEBwYXJhbSB7Q2FudmFzUmVuZGVyaW5nY3R4MkR9IGN0eCBjdHggdG8gcmVuZGVyIG9uXG4gICAqL1xuICBfcmVuZGVyOiBmdW5jdGlvbiAoY3R4LCBub1RyYW5zZm9ybSkge1xuICAgIGN0eC5zYXZlKCk7XG5cbiAgICB0aGlzLmNhbGN1bGF0ZUdlb21ldHJ5KCk7XG5cbiAgICBpZiAodGhpcy5fZWxlbWVudCkgdGhpcy5kcmF3RWxlbWVudChjdHgpO1xuICAgIGlmICh0aGlzLndpcmVmcmFtZSkgdGhpcy5kcmF3V2lyZWZyYW1lKGN0eCk7XG4gICAgaWYgKHRoaXMuZml4V2lyZUZyYW1lKSB0aGlzLmZpeFNlbWlUcmFuc3BhcmVudFBpeGVscyhjdHgpO1xuXG4gICAgaWYgKHRoaXMucmVuZGVyQm9yZGVyKSB7XG4gICAgICB2YXIgcDEgPSBuZXcgZmFicmljLlBvaW50KHRoaXMucG9pbnRzWzBdLngsdGhpcy5wb2ludHNbMF0ueSk7XG4gICAgICB2YXIgcDIgPSBuZXcgZmFicmljLlBvaW50KHRoaXMucG9pbnRzWzFdLngsdGhpcy5wb2ludHNbMV0ueSk7XG4gICAgICB2YXIgcDMgPSBuZXcgZmFicmljLlBvaW50KHRoaXMucG9pbnRzWzJdLngsdGhpcy5wb2ludHNbMl0ueSk7XG4gICAgICB2YXIgcDQgPSBuZXcgZmFicmljLlBvaW50KHRoaXMucG9pbnRzWzNdLngsdGhpcy5wb2ludHNbM10ueSk7XG4gICAgICBjdHguc3Ryb2tlU3R5bGUgPSBcImJsYWNrXCI7XG4gICAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgICBjdHgubW92ZVRvKHAxLngsIHAxLnkpO1xuICAgICAgY3R4LmxpbmVUbyhwMi54LCBwMi55KTtcbiAgICAgIGN0eC5saW5lVG8ocDMueCwgcDMueSk7XG4gICAgICBjdHgubGluZVRvKHA0LngsIHA0LnkpO1xuICAgICAgY3R4LmxpbmVUbyhwMS54LCBwMS55KTtcbiAgICAgIGN0eC5zdHJva2UoKTtcbiAgICAgIGN0eC5jbG9zZVBhdGgoKTtcbiAgICB9XG4gICAgY3R4LnJlc3RvcmUoKTtcbiAgfSxcbiAgdG9PYmplY3Q6IGZ1bmN0aW9uKHByb3BlcnRpZXNUb0luY2x1ZGUpIHtcbiAgICB2YXIgb2JqZWN0ID0gdGhpcy5jYWxsU3VwZXIoJ3RvT2JqZWN0JywgcHJvcGVydGllc1RvSW5jbHVkZSk7XG5cbiAgICBpZiAoIXRoaXMuaW5jbHVkZURlZmF1bHRWYWx1ZXMpIHtcbiAgICAgIHRoaXMuX3JlbW92ZURlZmF1bHRWYWx1ZXMob2JqZWN0KTtcbiAgICB9XG5cbiAgICB2YXIgcG9pbnRzID0gW11cbiAgICBmb3IodmFyIGkgaW4gdGhpcy5wb2ludHMpe1xuICAgICAgcG9pbnRzLnB1c2godGhpcy5wb2ludHNbaV0ueCk7XG4gICAgICBwb2ludHMucHVzaCh0aGlzLnBvaW50c1tpXS55KTtcbiAgICB9XG4gICAgb2JqZWN0LmN1cnZlID0gdGhpcy5jdXJ2ZTtcbiAgICBvYmplY3QucG9pbnRzID0gcG9pbnRzO1xuICAgIHJldHVybiBvYmplY3Q7XG4gIH0sXG4gIHVwZGF0ZV9jdXJ2ZV9oZWlnaHQ6IGZ1bmN0aW9uICgpIHtcbiAgICBpZih0aGlzLmV4dHJhQ29udHJvbHMuY3VydmUueSA+IHRoaXMuX29yaWdpbmFsX2hlaWdodCl7XG4gICAgICB0aGlzLmhlaWdodCA9IHRoaXMuZXh0cmFDb250cm9scy5jdXJ2ZS55O1xuICAgIH1lbHNlICBpZih0aGlzLmV4dHJhQ29udHJvbHMuY3VydmUueSA8IHRoaXMuX29yaWdpbmFsX2hlaWdodCl7XG4gICAgICB0aGlzLmhlaWdodCA9IE1hdGgubWF4KHRoaXMuZXh0cmFDb250cm9scy5jdXJ2ZS55LCB0aGlzLl9vcmlnaW5hbF9oZWlnaHQpO1xuICAgIH1cbiAgfVxufSk7XG5cbnZhciBfVFJJID0gZmFicmljLlRyYW5zZm9ybWVkSW1hZ2UucHJvdG90eXBlO1xuZmFicmljLlRyYW5zZm9ybWVkSW1hZ2UucHJvdG90eXBlLmFjdGlvbnMgPSBmYWJyaWMudXRpbC5vYmplY3QuZXh0ZW5kKHt9LCBmYWJyaWMuSW1hZ2UucHJvdG90eXBlLmFjdGlvbnMsIHtcbiAgc3dpdGNoQ29udHJvbHM6IHtcbiAgICBjbGFzc05hbWU6ICdmYSBmYS1jdWJlICcsXG4gICAgdGl0bGU6ICd0b2dnbGUgdHJhbnNmb3JtJyxcbiAgICBhY3Rpb246IF9UUkkuc3dpdGNoQ29udHJvbHNcbiAgfVxufSk7XG5cbmZhYnJpYy5UcmFuc2Zvcm1lZEltYWdlLmZyb21PYmplY3QgPSBmdW5jdGlvbihvYmplY3QsY2FsbGJhY2spe1xuXG4gIG9iamVjdCA9IGZhYnJpYy51dGlsLm9iamVjdC5jbG9uZShvYmplY3QpO1xuXG4gIGZ1bmN0aW9uIG9uSW1hZ2VMb2FkZWQoaW1nKXtcbiAgICBmYWJyaWMuSW1hZ2UucHJvdG90eXBlLl9pbml0RmlsdGVycy5jYWxsKG9iamVjdCwgb2JqZWN0LmZpbHRlcnMsIGZ1bmN0aW9uKGZpbHRlcnMpIHtcbiAgICAgIG9iamVjdC5maWx0ZXJzID0gZmlsdGVycyB8fCBbIF07XG4gICAgICBmYWJyaWMuSW1hZ2UucHJvdG90eXBlLl9pbml0RmlsdGVycy5jYWxsKG9iamVjdCwgb2JqZWN0LnJlc2l6ZUZpbHRlcnMsIGZ1bmN0aW9uKHJlc2l6ZUZpbHRlcnMpIHtcbiAgICAgICAgb2JqZWN0LnJlc2l6ZUZpbHRlcnMgPSByZXNpemVGaWx0ZXJzIHx8IFsgXTtcbiAgICAgICAgdmFyIGluc3RhbmNlID0gbmV3IGZhYnJpYy5UcmFuc2Zvcm1lZEltYWdlKGltZywgb2JqZWN0LGNhbGxiYWNrKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cblxuICBpZihvYmplY3QuaW1hZ2Upe1xuICAgIG9uSW1hZ2VMb2FkZWQob2JqZWN0LmltYWdlKTtcbiAgfWVsc2V7XG5cbiAgICBmYWJyaWMudXRpbC5sb2FkSW1hZ2Uob2JqZWN0LnNyYywgb25JbWFnZUxvYWRlZCwgbnVsbCwgb2JqZWN0LmNyb3NzT3JpZ2luKTtcbiAgfVxufTtcblxuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9vYmplY3RzL1RyYW5zZm9ybWVkSW1hZ2UuanNcbi8vIG1vZHVsZSBpZCA9IDEwNVxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCIvKipcbiAqIFZpZGVvIE9iamVjdCBsaWJyYXJ5IGZvciBGYWJyaWNKU1xuICpcbiAqIEV4dGVuc2lvbiBvZiBHcm91cCBvYmplY3QuXG4gKiBBbGxvdyB0byBjcmVhdGUgVmlkZW8gb2JqZWN0cyAsIHBsYXkgdmlkZW8gYnkgY2xpY2tpbmcgb24gdGhlbS5cbiAqIFdvcmtzIHdpdGggb2JqZWN0IGV2ZW50cyBmcm9tIGZhYnJpYy5jYW52YXNFeCBsaWJyYXJ5LlxuICpcbiAqXG4gKiBAZXhhbXBsZVxuIG5uZXcgZmFicmljLlZpZGVvKHtcbiAgICAgICAgIGxlZnQ6IDEwMCxcbiAgICAgICAgIHRvcDogMTAwLFxuICAgICAgICAgd2lkdGg6IDgwMCxcbiAgICAgICAgIGhlaWdodDogNjAwLFxuICAgICAgICAgcG9zdGVyOiBcInBhdGgvdG8vcG9zdGVyLnBuZ1wiLFxuICAgICAgICAgc291cmNlcyA6e1widmlkZW8vbXA0XCI6IFwidmlkZW8ubXA0XCIsICBcInZpZGVvL29nZ1wiOiBcInZpZGVvLm9ndlwifVxuICAgICB9KVxuICpcbiAqIEBhdXRob3IgRGVuaXMgUG9ub21hcmV2XG4gKiBAZW1haWwgZGVuLnBvbm9tYXJldkBnbWFpbC5jb21cbiAqL1xuJ3VzZSBzdHJpY3QnO1xuXG5cblxuZmFicmljLlZpZGVvID0gZmFicmljLnV0aWwuY3JlYXRlQ2xhc3MoZmFicmljLkdyb3VwLCB7XG4gIHR5cGU6ICd2aWRlbycsXG5cbiAgc3RhdGVQcm9wZXJ0aWVzOiBmYWJyaWMuR3JvdXAucHJvdG90eXBlLnN0YXRlUHJvcGVydGllcy5jb25jYXQoW1wicG9zdGVyXCJdKSxcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgIG9wdGlvbnMgfHwgKCBvcHRpb25zID0ge30pO1xuICAgIHRoaXMucGF1c2VkID0gdHJ1ZTtcbiAgICB0aGlzLmNhbGxTdXBlcignaW5pdGlhbGl6ZScsIFtdLCBvcHRpb25zKTtcbiAgICB0aGlzLnNldCgncG9zdGVyJywgb3B0aW9ucy5wb3N0ZXIgfHwgZmFsc2UpO1xuICAgIHRoaXMuc2V0KCdzb3VyY2VzJywgb3B0aW9ucy5zb3VyY2VzIHx8IHt9KTtcbiAgICB0aGlzLmNyZWF0ZVBvc3RlcigpO1xuICAgIHRoaXMubG9hZFZpZGVvKCk7XG4gIH0sXG5cbiAgdG9PYmplY3Q6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gZmFicmljLnV0aWwub2JqZWN0LmV4dGVuZCh0aGlzLmNhbGxTdXBlcigndG9PYmplY3QnKSwge1xuICAgICAgcG9zdGVyOiB0aGlzLmdldCgncG9zdGVyJyksXG4gICAgICBzb3VyY2VzOiB0aGlzLmdldCgnc291cmNlcycpXG4gICAgfSk7XG4gIH0sXG5cbiAgX3JlbmRlcjogZnVuY3Rpb24gKGN0eCkge1xuICAgIHRoaXMuY2FsbFN1cGVyKCdfcmVuZGVyJywgY3R4KTtcbiAgfSxcblxuICBibGFja1NjcmVlbjogXCJkYXRhOmltYWdlL2dpZjtiYXNlNjQsUjBsR09EbGhBUUFCQUlBQUFBVUVCQUFBQUN3QUFBQUFBUUFCQUFBQ0FrUUJBRHM9XCIsXG4gIGNyZWF0ZVBvc3RlcjogZnVuY3Rpb24gKCkge1xuXG4gICAgZmFicmljLnV0aWwubG9hZEltYWdlKHRoaXMucG9zdGVyIHx8IHRoaXMuYmxhY2tTY3JlZW4sIGZ1bmN0aW9uIChpbWcpIHtcbiAgICAgIHZhciBfaW1hZ2UgPSBuZXcgZmFicmljLkltYWdlKGltZywge1xuICAgICAgICB3aWR0aDogdGhpcy53aWR0aCxcbiAgICAgICAgaGVpZ2h0OiB0aGlzLmhlaWdodCxcbiAgICAgICAgb3JpZ2luWDogJ2NlbnRlcicsXG4gICAgICAgIG9yaWdpblk6ICdjZW50ZXInXG4gICAgICB9KTtcbiAgICAgIHRoaXMuaW1hZ2UgPSBfaW1hZ2U7XG4gICAgICB0aGlzLmFkZChfaW1hZ2UpO1xuICAgIH0uYmluZCh0aGlzKSlcblxuICB9LFxuICBjcmVhdGVIaW50OiBmdW5jdGlvbiAoKSB7XG5cbiAgICAvL3BsYXkvcGF1c2UgaGludFxuICAgIHRoaXMudGV4dCA9IG5ldyBmYWJyaWMuVGV4dCgn7oCAJywge1xuICAgICAgZm9udEZhbWlseTogJ3ZpZGVvZ3VsYXInLFxuICAgICAgdGV4dEFsaWduOiBcImNlbnRlclwiLFxuICAgICAgZm9udFNpemU6IDYwLFxuICAgICAgbGVmdDogLTI1LFxuICAgICAgdG9wOiAtMjgsXG4gICAgICB3aWR0aDogNDAsXG4gICAgICBmaWxsOiBcIndoaXRlXCIsXG4gICAgICBzaGFkb3c6IHtjb2xvcjogJyMwMDAnLCBvZmZzZXRYOiAxLCBvZmZzZXRZOiAxLCBibHVyOiA1fSxcbiAgICAgIHZpc2libGU6IGZhbHNlXG4gICAgfSk7XG5cblxuICAgIHZhciBfc2VsZiA9IHRoaXM7XG5cbiAgICB0aGlzLm9uKCdvYmplY3Q6Y2xpY2snLCBmdW5jdGlvbiAoZSkge1xuICAgICAgX3NlbGYudGV4dC5zZXRDb29yZHMoKTtcbiAgICAgIHZhciB0ID0gdGhpcy5zZWFyY2hQb3NzaWJsZVRhcmdldHMoZS5lKTtcbiAgICAgIHQudGFyZ2V0ICYmIHQudGFyZ2V0LmZpcmUoXCJjbGlja1wiKTtcbiAgICB9KTtcblxuXG4gICAgdGhpcy50ZXh0Lm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgX3NlbGYudG9nZ2xlUGxheVBhdXNlKClcbiAgICB9KVxuXG5cbiAgICAvL3Nob3cvaGlkZSBwbGF5L3BhdXNlIGhpbnRcbiAgICB0aGlzLm9uKCdtb3VzZTpvdmVyJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgIF9zZWxmLnRleHQuc2V0VmlzaWJsZSh0cnVlKTtcbiAgICAgIF9zZWxmLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICB9KTtcbiAgICB0aGlzLm9uKCdtb3VzZTpvdXQnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgX3NlbGYudGV4dC5zZXRWaXNpYmxlKGZhbHNlKTtcbiAgICAgIF9zZWxmLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgICB9KTtcblxuICAgIHRoaXMuYWRkKHRoaXMudGV4dCk7XG4gIH0sXG4gIGRlc3RydWN0b3I6IGZ1bmN0aW9uIChlKSB7XG4gICAgdGhpcy5tZWRpYUVsZW1lbnQucGF1c2UoKTtcbiAgICB0aGlzLm1lZGlhRWxlbWVudC5jdXJyZW50VGltZSA9IDA7XG4gICAgdGhpcy5wYXVzZWQgPSB0cnVlO1xuICAgIGRlbGV0ZSB0aGlzLm1lZGlhRWxlbWVudDtcbiAgfSxcbiAgdG9nZ2xlUGxheVBhdXNlOiBmdW5jdGlvbiAoZSkge1xuICAgIHZhciBlbCA9IHRoaXMudmlkZW8uZ2V0RWxlbWVudCgpO1xuICAgIGlmIChlbC5wYXVzZWQpIHtcbiAgICAgIGVsLnBsYXkoKTtcbiAgICAgIHRoaXMucGF1c2VkID0gZmFsc2U7XG4gICAgICB0aGlzLnZpZGVvLnNldFZpc2libGUodHJ1ZSk7XG4gICAgICB0aGlzLnRleHQuc2V0VGV4dChcIu6AgVwiKTtcbiAgICB9IGVsc2Uge1xuICAgICAgZWwucGF1c2UoKTtcbiAgICAgIGVsLmN1cnJlbnRUaW1lID0gMDtcbiAgICAgIHRoaXMucGF1c2VkID0gdHJ1ZTtcbiAgICAgIGlmICh0aGlzLnBvc3Rlcikge1xuICAgICAgICB0aGlzLnZpZGVvLnNldFZpc2libGUoZmFsc2UpO1xuICAgICAgfVxuICAgICAgdGhpcy50ZXh0LnNldFRleHQoXCLugIBcIik7XG4gICAgfVxuICB9LFxuICBjcmVhdGVWaWRlbzogZnVuY3Rpb24gKCkge1xuXG4gICAgdGhpcy52aWRlbyA9IG5ldyBmYWJyaWMuSW1hZ2UodGhpcy5tZWRpYUVsZW1lbnQsIHtcbiAgICAgIHdpZHRoOiB0aGlzLndpZHRoLFxuICAgICAgaGVpZ2h0OiB0aGlzLmhlaWdodCxcbiAgICAgIG9yaWdpblg6ICdjZW50ZXInLFxuICAgICAgb3JpZ2luWTogJ2NlbnRlcidcbiAgICB9KTtcblxuICAgIGlmICh0aGlzLnBvc3Rlcikge1xuICAgICAgdGhpcy52aWRlby5zZXRWaXNpYmxlKGZhbHNlKTtcbiAgICB9XG5cbiAgICB0aGlzLmFkZCh0aGlzLnZpZGVvKTtcblxuICAgIHRoaXMuY3JlYXRlSGludCgpO1xuXG4gICAgdGhpcy5maXJlKFwicmVhZHlcIik7XG4gICAgLy90aGlzLmNhbnZhcy5yZW5kZXJBbGwoKTtcbiAgfSxcbiAgc2V0UG9zdGVyOiBmdW5jdGlvbiAoaW1nKSB7XG5cbiAgICB0aGlzLnBvc3RlciA9IGltZy5zcmM7XG4gICAgdGhpcy5pbWFnZS5zZXRFbGVtZW50KGltZyk7XG4gICAgdGhpcy5pbWFnZS5zZXQoe1xuICAgICAgd2lkdGg6IHRoaXMud2lkdGgsXG4gICAgICBoZWlnaHQ6IHRoaXMuaGVpZ2h0XG4gICAgfSk7XG4gICAgdGhpcy5jYW52YXMucmVuZGVyQWxsKCk7XG4gIH0sXG4gIGxvYWRWaWRlbzogZnVuY3Rpb24gKCkge1xuICAgIGZhYnJpYy51dGlsLmxvYWRWaWRlbyh0aGlzLnNvdXJjZXMsIGZ1bmN0aW9uIChlbCkge1xuICAgICAgdGhpcy5tZWRpYUVsZW1lbnQgPSBlbDtcbiAgICAgIHRoaXMuY3JlYXRlVmlkZW8oKTtcbiAgICB9LmJpbmQodGhpcykpXG4gIH1cbn0pO1xuZmFicmljLlZpZGVvLmZyb21PYmplY3QgPSBmdW5jdGlvbiAob2JqZWN0KSB7XG4gIHJldHVybiBuZXcgZmFicmljLlZpZGVvKG9iamVjdCk7XG59O1xuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9vYmplY3RzL1ZpZGVvLmpzXG4vLyBtb2R1bGUgaWQgPSAxMDZcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiXG5cbmZhYnJpYy51dGlsLm9iamVjdC5leHRlbmQoZmFicmljLlBvbHlsaW5lLnByb3RvdHlwZSx7XG4gIGNvbnRyb2xzQnV0dG9uc0VuYWJsZWQ6IGZhbHNlLFxuICBfY3JlYXRlX2J1dHRvbnNfY29udHJvbHM6IGZ1bmN0aW9uKGNvbnRyb2xzKXtcblxuICAgIGlmKCF0aGlzLmNvbnRyb2xzQnV0dG9uc0VuYWJsZWQpcmV0dXJuO1xuXG4gICAgdmFyIHB0cyA9IHRoaXMucG9pbnRzLFxuICAgICAgX2xhc3QgPSBwdHMubGVuZ3RoIC0gMTtcbiAgICBpZih0aGlzLl9fbWFnbmV0X3BvaW50ICYmIHRoaXMuX19tYWduZXRfcG9pbnQuaWRbMF0gIT0gXCJ4XCIpe1xuICAgICAgdmFyIF9pZCA9IHRoaXMuX19tYWduZXRfcG9pbnQuaWQ7XG4gICAgICB2YXIgX2VuZGVyX2FyZWEgPSAoX2lkID09IFwiZTFcIiB8fCBfaWQgPT0gXCJlMlwiKTtcbiAgICAgIHZhciBfZW5kZXJfcG9pbnRzID0gX2VuZGVyX2FyZWEgfHwgKF9pZCA9PSBcInAxXCIgfHwgX2lkID09IFwicFwiICsgcHRzLmxlbmd0aCk7XG4gICAgICB2YXIgX29mZnNldCA9IF9lbmRlcl9wb2ludHMgPyAxNSA6IDEwO1xuICAgICAgdGhpcy5feGJ1dHRvbnNfcG9pbnQgPSBfZW5kZXJfYXJlYSA/IChfaWRbMV0gPT0gXCIxXCIgPyAwIDogX2xhc3QpIDogX2lkLnN1YnN0cigxKSAtIDE7XG4gICAgICB0aGlzLl94YnV0dG9uc19jdXJ2ZSA9IF9pZFswXSA9PSBcImNcIjtcbiAgICAgIGlmKHRoaXMuX3hidXR0b25zX2N1cnZlKXtcbiAgICAgICAgY29udHJvbHMucHVzaCh7XG4gICAgICAgICAgeDogdGhpcy5fX21hZ25ldF9wb2ludC54ICsgX29mZnNldCxcbiAgICAgICAgICB5OiB0aGlzLl9fbWFnbmV0X3BvaW50LnkgLSBfb2Zmc2V0LFxuICAgICAgICAgIHNpemUgOiAxNixcbiAgICAgICAgICBpbnRyYW5zZm9ybWFibGU6IHRydWUsXG4gICAgICAgICAgc3R5bGVGdW5jdGlvbjogdGhpcy5fZHJhd0luc2VydE5vZGVCdXR0b24sXG4gICAgICAgICAgaWQ6IFwieDFcIlxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIGNvbnRyb2xzLnB1c2goe1xuICAgICAgICB4OiB0aGlzLl9fbWFnbmV0X3BvaW50LnggKyBfb2Zmc2V0LFxuICAgICAgICB5OiB0aGlzLl9fbWFnbmV0X3BvaW50LnkgKyBfb2Zmc2V0LFxuICAgICAgICBzaXplIDogMTYsXG4gICAgICAgIGludHJhbnNmb3JtYWJsZTogdHJ1ZSxcbiAgICAgICAgc3R5bGVGdW5jdGlvbjogdGhpcy5fZHJhd1JlbW92ZU5vZGVCdXR0b24sXG4gICAgICAgIGlkOiBcIngyXCJcbiAgICAgIH0pO1xuICAgIH1lbHNle1xuICAgICAgZGVsZXRlIHRoaXMuX3hidXR0b25zX3BvaW50O1xuICAgICAgZGVsZXRlIHRoaXMuX3hidXR0b25zX2N1cnZlO1xuICAgIH1cbiAgfSxcbiAgX2RyYXdJbnNlcnROb2RlQnV0dG9uOiBmdW5jdGlvbiAoY29udHJvbCwgY3R4LCBtZXRob2ROYW1lLCBsZWZ0LCB0b3AsIHNpemUsIHN0cm9rZSkge1xuICAgIGN0eC5zYXZlKCk7XG4gICAgY3R4LmZpbGxTdHlsZSA9IFwiZ3JlZW5cIjtcbiAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgdmFyIF9zaXplID0gc2l6ZSAvIDQ7XG4gICAgY3R4LmFyYyhsZWZ0ICsgc2l6ZS8yICwgdG9wICsgc2l6ZS8yICwgX3NpemUgKiAyICwgMCwgMiAqIE1hdGguUEksIGZhbHNlKTtcbiAgICBjdHguZmlsbCgpO1xuICAgIGN0eC5zdHJva2VTdHlsZSA9IFwid2hpdGVcIjtcbiAgICBjdHgudHJhbnNsYXRlKE1hdGguZmxvb3Ioc2l6ZS8yKSxNYXRoLmZsb29yKHNpemUvMikpO1xuICAgIGN0eC50cmFuc2xhdGUoMC41LDAuNSApO1xuICAgIGN0eC5tb3ZlVG8obGVmdCAtIF9zaXplICwgdG9wICk7XG4gICAgY3R4LmxpbmVUbyhsZWZ0ICsgX3NpemUgLCB0b3AgKTtcbiAgICBjdHguc3Ryb2tlU3R5bGUgPSBcIndoaXRlXCI7XG4gICAgY3R4Lm1vdmVUbyhsZWZ0ICAsIHRvcCArIF9zaXplICk7XG4gICAgY3R4LmxpbmVUbyhsZWZ0ICAsIHRvcCAtIF9zaXplICk7XG4gICAgY3R4LnN0cm9rZSgpO1xuICAgIGN0eC5yZXN0b3JlKCk7XG4gIH0sXG4gIF9kcmF3UmVtb3ZlTm9kZUJ1dHRvbjogZnVuY3Rpb24gKGNvbnRyb2wsIGN0eCwgbWV0aG9kTmFtZSwgbGVmdCwgdG9wLCBzaXplLCBzdHJva2UpIHtcbiAgICBjdHguc2F2ZSgpO1xuICAgIGN0eC5maWxsU3R5bGUgPSBcInJlZFwiO1xuICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICB2YXIgX3NpemUgPSBzaXplIC8gNDtcbiAgICBjdHguYXJjKGxlZnQgKyBzaXplLzIgLCB0b3AgKyBzaXplLzIgLCBfc2l6ZSAqIDIgLCAwLCAyICogTWF0aC5QSSwgZmFsc2UpO1xuICAgIGN0eC5maWxsKCk7XG4gICAgY3R4LnN0cm9rZVN0eWxlID0gXCJ3aGl0ZVwiO1xuICAgIGN0eC50cmFuc2xhdGUoc2l6ZS8yLHNpemUvMik7XG4gICAgY3R4Lm1vdmVUbyhsZWZ0IC0gX3NpemUgLCB0b3AgLSBfc2l6ZSk7XG4gICAgY3R4LmxpbmVUbyhsZWZ0ICsgX3NpemUgLCB0b3AgKyBfc2l6ZSk7XG4gICAgY3R4LnN0cm9rZVN0eWxlID0gXCJ3aGl0ZVwiO1xuICAgIGN0eC5tb3ZlVG8obGVmdCAtIF9zaXplICwgdG9wICsgX3NpemUgKTtcbiAgICBjdHgubGluZVRvKGxlZnQgKyBfc2l6ZSAsIHRvcCAtIF9zaXplICk7XG4gICAgY3R4LnN0cm9rZSgpO1xuICAgIGN0eC5yZXN0b3JlKCk7XG4gIH0sXG4gIF9wZXJmb3JtQWRkQWN0aW9uOiBmdW5jdGlvbiAoZSwgdHJhbnNmb3JtLCBwb2ludGVyKSB7XG4gICAgdGhpcy5pc01vdmluZyA9IGZhbHNlO1xuICAgIHZhciBwMSA9IHRoaXMucG9pbnRzW3RoaXMuX3hidXR0b25zX3BvaW50XTtcbiAgICB2YXIgcDIgPSB0aGlzLnBvaW50c1t0aGlzLl94YnV0dG9uc19wb2ludCArIDFdO1xuICAgIGlmKHAxLmN1cnZlKXtcbiAgICAgIHZhciBuZXdfcG9pbnQxID0gcDEuY3VydmUuZ2V0KDAuMjUpO1xuICAgICAgdmFyIG5ld19wb2ludDIgPSBwMS5jdXJ2ZS5nZXQoMC43NSk7XG5cbiAgICAgIHRoaXMucG9pbnRzLnNwbGljZSh0aGlzLl94YnV0dG9uc19wb2ludCArIDEsMCx7XG4gICAgICAgIHg6IHAxLmMueCxcbiAgICAgICAgeTogcDEuYy55LFxuICAgICAgICBjOiBuZXdfcG9pbnQyXG4gICAgICB9KVxuICAgICAgcDEuYyA9IG5ld19wb2ludDE7XG4gICAgICB0aGlzLl9tYWtlQ3VydmVCeUluZGV4KHRoaXMuX3hidXR0b25zX3BvaW50KTtcbiAgICAgIHRoaXMuX21ha2VDdXJ2ZUJ5SW5kZXgodGhpcy5feGJ1dHRvbnNfcG9pbnQgKyAxKTtcbiAgICB9ZWxzZXtcbiAgICAgIHZhciBuZXdfcG9pbnQxID0ge3ggOiAocDIueCAtIHAxLngpIC8gNCwgeTogKHAyLnkgLSBwMS55KSAvIDR9O1xuICAgICAgdmFyIG5ld19wb2ludDIgPSB7eCA6IChwMi54IC0gcDEueCkgLyA0KjMsIHk6IChwMi55IC0gcDEueSkgLyA0KjN9O1xuICAgIH1cbiAgICBkZWxldGUgdGhpcy5jYW52YXMuX2N1cnJlbnRUcmFuc2Zvcm07XG4gICAgLy8gZGVsZXRlIHRyYW5zZm9ybS5hY3Rpb247XG4gICAgLy8gZGVsZXRlIHRyYW5zZm9ybS5jb3JuZXI7XG4gIH0sXG4gIF9wZXJmb3JtUmVtb3ZlQWN0aW9uOiBmdW5jdGlvbiAoZSwgdHJhbnNmb3JtLCBwb2ludGVyKSB7XG4gICAgaWYodGhpcy5wb2ludHMubGVuZ3RoID09IDIpe1xuICAgICAgcmV0dXJuIHRoaXMucmVtb3ZlKCk7XG4gICAgfVxuXG4gICAgdmFyIF9jdXJ2ZXBvaW50ZXIgPSB0aGlzLl94YnV0dG9uc19jdXJ2ZSxcbiAgICAgIHBJbmRleDEgPSB0aGlzLl94YnV0dG9uc19wb2ludDtcblxuICAgIGlmKHRoaXMucG9pbnRzW3BJbmRleDEgLSAxIF0gICYmIHRoaXMucG9pbnRzW3BJbmRleDEgKyAxXSl7XG4gICAgICB0aGlzLnBvaW50c1twSW5kZXgxIC0gMSBdLmMgPSB0aGlzLnBvaW50c1twSW5kZXgxXTtcbiAgICAgIHRoaXMucG9pbnRzLnNwbGljZShwSW5kZXgxLDEpO1xuICAgICAgdGhpcy5fbWFrZUN1cnZlQnlJbmRleChwSW5kZXgxIC0gMSk7XG4gICAgfWVsc2V7XG4gICAgICB0aGlzLnBvaW50cy5zcGxpY2UocEluZGV4MSwxKTtcbiAgICB9XG4gICAgdGhpcy5pc01vdmluZyA9IGZhbHNlO1xuICAgIHRoaXMuc2V0U2l6ZSgpO1xuICAgIHRoaXMuY2FudmFzLnJlbmRlckFsbCgpO1xuICAgIGRlbGV0ZSB0aGlzLmNhbnZhcy5fY3VycmVudFRyYW5zZm9ybTtcbiAgICAvLyBkZWxldGUgdHJhbnNmb3JtLmFjdGlvbjtcbiAgICAvLyBkZWxldGUgdHJhbnNmb3JtLmNvcm5lcjtcbiAgfVxufSk7XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL29iamVjdHMvcG9seWxpbmUuY29udHJvbHMuanNcbi8vIG1vZHVsZSBpZCA9IDEwN1xuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCIvLyBNYWdpYyBXYW5kIChGdXp6eSBTZWxlY3Rpb24gVG9vbCkgZm9yIEphdmFzY3JpcHRcbi8vXG4vLyBUaGUgTUlUIExpY2Vuc2UgKE1JVClcbi8vXG4vLyBDb3B5cmlnaHQgKGMpIDIwMTQsIFJ5YXNub3kgUGF1bCAocnlhc25veXBhdWxAZ21haWwuY29tKVxuLy9cbi8vIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHlcbi8vIG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlIFwiU29mdHdhcmVcIiksIHRvIGRlYWxcbi8vIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHNcbi8vIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCwgZGlzdHJpYnV0ZSwgc3VibGljZW5zZSwgYW5kL29yIHNlbGxcbi8vIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpc1xuLy8gZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczpcbi8vXG4vLyBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZSBpbmNsdWRlZCBpblxuLy8gYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuXG4vL1xuLy8gVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUlxuLy8gSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXG4vLyBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVCBTSEFMTCBUSEVcbi8vIEFVVEhPUlMgT1IgQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVJcbi8vIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXG4vLyBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOXG4vLyBUSEUgU09GVFdBUkUuXG5cbnZhciBNYWdpY1dhbmQgPSAoZnVuY3Rpb24gKCkge1xuICB2YXIgbGliID0ge307XG4gIC8vdmFyIGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIik7XG4gIC8vdmFyIGNvbnRleHQgPSBjYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpO1xuXG4gIGZ1bmN0aW9uIGNyZWF0ZUNhbnZhc0VsZW1lbnQoKXtcbiAgICBpZih0eXBlb2YgQ2FudmFzICE9PSBcInVuZGVmaW5lZFwiKXtcbiAgICAgIHJldHVybiBuZXcgQ2FudmFzO1xuICAgIH1cbiAgICByZXR1cm4gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIFNlbGVjdGlvbk1hc2sodyxoLGRhdGEpe1xuICAgIGlmKGFyZ3VtZW50cy5sZW5ndGggPT0gMSl7XG4gICAgICBmb3IodmFyIGkgaW4gYXJndW1lbnRzWzBdICl7XG4gICAgICAgIHRoaXNbaV0gPSBhcmd1bWVudHNbMF1baV07XG4gICAgICB9XG4gICAgfWVsc2V7XG4gICAgICB0aGlzLmRhdGEgPSBuZXcgVWludDhBcnJheShkYXRhIHx8IHcgKiBoKTtcbiAgICAgIHRoaXMud2lkdGggID0gdztcbiAgICAgIHRoaXMuaGVpZ2h0ID0gaDtcbiAgICAgIHRoaXMuY291bnQgID0gMDtcbiAgICAgIHRoaXMuYm91bmRzID0ge1xuICAgICAgIG1pblg6IEluZmluaXR5LFxuICAgICAgIG1pblk6IEluZmluaXR5LFxuICAgICAgIG1heFk6IC0xLFxuICAgICAgIG1heFg6IC0xXG4gICAgICB9O1xuICAgICAgLy8gdGhpcy5ib3VuZHMgPSB7XG4gICAgICAvLyAgIG1pblg6IDAsXG4gICAgICAvLyAgIG1pblk6IDAsXG4gICAgICAvLyAgIG1heFk6IGgsXG4gICAgICAvLyAgIG1heFg6IHdcbiAgICAgIC8vIH07XG4gICAgfVxuICB9XG4gIGxpYi5TZWxlY3Rpb25NYXNrID0gU2VsZWN0aW9uTWFzaztcblxuXG4gIFNlbGVjdGlvbk1hc2sucHJvdG90eXBlLmRlYnVnID0gZnVuY3Rpb24oKXtcbiAgICB2YXIgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKTtcbiAgICBjYW52YXMud2lkdGggPSB0aGlzLndpZHRoO1xuICAgIGNhbnZhcy5oZWlnaHQgPSB0aGlzLmhlaWdodDtcbiAgICB2YXIgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gICAgdGhpcy5yZW5kZXIoY3R4LHtcbiAgICAgIGZpbGwgOiBcIiNmZmZcIixcbiAgICAgIG91dGVyRmlsbCA6IFwiIzAwMFwiXG4gICAgfSk7XG4gICAgY3R4LmRlYnVnKCk7XG4gIH07XG5cbiAgU2VsZWN0aW9uTWFzay5wcm90b3R5cGUubWFrZUNhY2hlID0gZnVuY3Rpb24ob3B0aW9ucyApe1xuICAgIHRoaXMuY2FjaGUgPSBjcmVhdGVDYW52YXNFbGVtZW50KCk7XG4gICAgdGhpcy5jYWNoZS53aWR0aCA9IHRoaXMuYm91bmRzLm1heFgtIHRoaXMuYm91bmRzLm1pblggKyAxO1xuICAgIHRoaXMuY2FjaGUuaGVpZ2h0ID0gdGhpcy5ib3VuZHMubWF4WS0gdGhpcy5ib3VuZHMubWluWSArIDE7XG4gICAgdGhpcy5jb250ZXh0ID0gdGhpcy5jYWNoZS5nZXRDb250ZXh0KCcyZCcpO1xuXG4gICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge31cbiAgICB0aGlzLnJlbmRlcih0aGlzLmNvbnRleHQse1xuICAgICAgZmlsbCA6IFwiI2ZmZlwiLFxuICAgICAgb3V0ZXJGaWxsIDogXCIjMDAwXCIsXG4gICAgICBjYWNoZTogZmFsc2UsXG4gICAgICBsZWZ0IDotdGhpcy5ib3VuZHMubWluWCxcbiAgICAgIHRvcCA6LXRoaXMuYm91bmRzLm1pbllcbiAgICB9KTtcblxuICB9O1xuXG4gIFNlbGVjdGlvbk1hc2sucHJvdG90eXBlLmFkZCA9IGZ1bmN0aW9uIChtYXNrKSB7XG4gICAgdmFyIGluZGV4LCB4LCB5O1xuICAgIGZvciAoeCA9IG1hc2suYm91bmRzLm1pblg7IHggPD0gbWFzay5ib3VuZHMubWF4WDsgeCsrKSB7XG4gICAgICBmb3IgKHkgPSBtYXNrLmJvdW5kcy5taW5ZOyB5IDw9IG1hc2suYm91bmRzLm1heFk7IHkrKykge1xuICAgICAgICBpbmRleCA9IG1hc2sud2lkdGggKiB5ICsgeDtcbiAgICAgICAgaWYgKCBtYXNrLmRhdGFbaW5kZXhdICYmICF0aGlzLmRhdGFbaW5kZXhdKXtcbiAgICAgICAgICB0aGlzLmRhdGFbaW5kZXhdID0gMTtcbiAgICAgICAgICB0aGlzLmNvdW50Kys7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLmJvdW5kcy5taW5YID0gTWF0aC5taW4obWFzay5ib3VuZHMubWluWCwgdGhpcy5ib3VuZHMubWluWCk7XG4gICAgdGhpcy5ib3VuZHMubWF4WCA9IE1hdGgubWF4KG1hc2suYm91bmRzLm1heFgsIHRoaXMuYm91bmRzLm1heFgpO1xuICAgIHRoaXMuYm91bmRzLm1pblkgPSBNYXRoLm1pbihtYXNrLmJvdW5kcy5taW5ZLCB0aGlzLmJvdW5kcy5taW5ZKTtcbiAgICB0aGlzLmJvdW5kcy5tYXhZID0gTWF0aC5tYXgobWFzay5ib3VuZHMubWF4WSwgdGhpcy5ib3VuZHMubWF4WSk7XG4gIH07XG4gIGZ1bmN0aW9uIGhleFRvUmdiKGhleCkge1xuICAgIC8vIEV4cGFuZCBzaG9ydGhhbmQgZm9ybSAoZS5nLiBcIjAzRlwiKSB0byBmdWxsIGZvcm0gKGUuZy4gXCIwMDMzRkZcIilcbiAgICB2YXIgc2hvcnRoYW5kUmVnZXggPSAvXiM/KFthLWZcXGRdKShbYS1mXFxkXSkoW2EtZlxcZF0pJC9pO1xuICAgIGhleCA9IGhleC5yZXBsYWNlKHNob3J0aGFuZFJlZ2V4LCBmdW5jdGlvbihtLCByLCBnLCBiKSB7XG4gICAgICByZXR1cm4gciArIHIgKyBnICsgZyArIGIgKyBiO1xuICAgIH0pO1xuXG4gICAgdmFyIHJlc3VsdCA9IC9eIz8oW2EtZlxcZF17Mn0pKFthLWZcXGRdezJ9KShbYS1mXFxkXXsyfSkkL2kuZXhlYyhoZXgpO1xuICAgIHJldHVybiByZXN1bHQgPyB7XG4gICAgICByOiBwYXJzZUludChyZXN1bHRbMV0sIDE2KSxcbiAgICAgIGc6IHBhcnNlSW50KHJlc3VsdFsyXSwgMTYpLFxuICAgICAgYjogcGFyc2VJbnQocmVzdWx0WzNdLCAxNilcbiAgICB9IDogbnVsbDtcbiAgfVxuXG4gIFNlbGVjdGlvbk1hc2sucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uKGN0eCxvcHRpb25zICl7XG4gICAgaWYoIXRoaXMuY291bnQpcmV0dXJuO1xuXG4gICAgb3B0aW9ucyAgICAgICAgICAgICA9IG9wdGlvbnMgICAgICAgICAgICAgfHwge307XG4gICAgb3B0aW9ucy5sZWZ0ICAgICAgICA9IG9wdGlvbnMubGVmdCAgICAgICAgfHwgMCA7XG4gICAgb3B0aW9ucy50b3AgICAgICAgICA9IG9wdGlvbnMudG9wICAgICAgICAgfHwgMCA7XG4gICAgb3B0aW9ucy5maWxsICAgICAgICA9IG9wdGlvbnMuZmlsbCAgICAgICAgfHwgZmFsc2UgOy8vIFswLDAsMCwwXTtcbiAgICBvcHRpb25zLmludGVyc2VjdGlvbkNvbG9yID0gb3B0aW9ucy5pbnRlcnNlY3Rpb25Db2xvciB8fGZhbHNlIDsvLyAgWzAsMCwwLDBdO1xuXG4gICAgb3B0aW9ucy5vdXRlckZpbGwgICAgICAgID0gb3B0aW9ucy5vdXRlckZpbGwgICAgICAgIHx8IGZhbHNlIDsvLyBbMCwwLDAsMF07XG4gICAgb3B0aW9ucy5vdXRlckludGVyc2VjdGlvbkNvbG9yID0gb3B0aW9ucy5vdXRlckludGVyc2VjdGlvbkNvbG9yIHx8ZmFsc2UgOy8vICBbMCwwLDAsMF07XG5cbiAgICAvL2lmKHRoaXMuY2FjaGUgJiYgb3B0aW9ucy5jYWNoZSAhPT0gZmFsc2Upe1xuICAgIC8vXG4gICAgLy8gIHZhciBfY3R4ID0gdGhpcy5jb250ZXh0O1xuICAgIC8vICBfY3R4LnNhdmUoKTtcbiAgICAvLyAgX2N0eC5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb249XCJzb3VyY2UtaW5cIjtcbiAgICAvLyAgX2N0eC5maWxsU3R5bGU9IG9wdGlvbnMuZmlsbDtcbiAgICAvLyAgX2N0eC5maWxsUmVjdCgwLDAsdGhpcy5jYWNoZS53aWR0aCx0aGlzLmNhY2hlLmhlaWdodCk7XG4gICAgLy8gIF9jdHgucmVzdG9yZSgpO1xuICAgIC8vXG4gICAgLy8gIGN0eC5zYXZlKCk7XG4gICAgLy8gIGN0eC5nbG9iYWxBbHBoYSA9IG9wdGlvbnMub3BhY2l0eTtcbiAgICAvLyAgY3R4LmRyYXdJbWFnZSh0aGlzLmNhY2hlLHRoaXMuYm91bmRzLm1pblgsdGhpcy5ib3VuZHMubWluWSlcbiAgICAvLyAgY3R4LnJlc3RvcmUoKTtcbiAgICAvLyAgcmV0dXJuO1xuICAgIC8vfVxuXG4gICAgLy90b2RvIGRvIG5vdCB1c2UgZmFicmljIGhlcmUhXG4gICAgZnVuY3Rpb24gY29udmVydENvbG9yKGNvbG9yKXtcbiAgICAgIGlmKGNvbG9yLmNvbnN0cnVjdG9yICA9PSBTdHJpbmcgKXtcbiAgICAgICAgaWYoY29sb3JbMF0gPT0gXCIjXCIpe1xuICAgICAgICAgIHZhciBfcmdiID0gaGV4VG9SZ2IoY29sb3IpO1xuICAgICAgICAgIHJldHVybiBbX3JnYi5yLF9yZ2IuZyxfcmdiLmIsMjU1XTtcbiAgICAgICAgfVxuICAgICAgICBjb2xvciA9IG5ldyBmYWJyaWMuQ29sb3IoY29sb3IpLl9zb3VyY2U7XG4gICAgICAgIGNvbG9yWzNdICo9IDI1NTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBjb2xvcjtcbiAgICB9XG5cbiAgICB2YXIgX3cgPSB0aGlzLmJvdW5kcy5tYXhYIC0gdGhpcy5ib3VuZHMubWluWCArIDE7XG4gICAgdmFyIF9oID0gdGhpcy5ib3VuZHMubWF4WSAtIHRoaXMuYm91bmRzLm1pblkgKyAxO1xuXG4gICAgdmFyIGltZ0RhdGEgPSBjdHguZ2V0SW1hZ2VEYXRhKG9wdGlvbnMubGVmdCxvcHRpb25zLnRvcCxfdyxfaCk7XG5cblxuICAgIHZhciBjb2xvciAgPSBjb252ZXJ0Q29sb3Iob3B0aW9ucy5maWxsKTtcbiAgICB2YXIgY29sb3IyID0gY29udmVydENvbG9yKG9wdGlvbnMuaW50ZXJzZWN0aW9uQ29sb3IpO1xuICAgIHZhciBjb2xvcjMgPSBjb252ZXJ0Q29sb3Iob3B0aW9ucy5vdXRlckZpbGwpO1xuICAgIHZhciBjb2xvcjQgPSBjb252ZXJ0Q29sb3Iob3B0aW9ucy5vdXRlckludGVyc2VjdGlvbkNvbG9yKTtcblxuICAgIGZvcih2YXIgeCA9IHRoaXMuYm91bmRzLm1pblggOyB4IDw9IHRoaXMuYm91bmRzLm1heFg7eCsrICl7XG4gICAgICBmb3IodmFyIHkgPSB0aGlzLmJvdW5kcy5taW5ZIDsgeSA8PSB0aGlzLmJvdW5kcy5tYXhZOyB5KysgKXtcbiAgICAgICAgdmFyIGluZGV4ID0gdGhpcy53aWR0aCAqIHkgKyB4O1xuICAgICAgICB2YXIgaW5kZXhfc21hbGwgPSBfdyAqICh5IC0gKHRoaXMuYm91bmRzLm1pblkpKSArIHggLSAodGhpcy5ib3VuZHMubWluWCk7XG5cbiAgICAgICAgaWYodGhpcy5kYXRhW2luZGV4XSApe1xuICAgICAgICAgIHZhciBfY29sb3IgPSBpbWdEYXRhLmRhdGFbaW5kZXhfc21hbGwgKiA0ICsgM10/IGNvbG9yMiA6IGNvbG9yIDtcbiAgICAgICAgICBpZighX2NvbG9yKWNvbnRpbnVlO1xuXG4gICAgICAgICAgaW1nRGF0YS5kYXRhW2luZGV4X3NtYWxsICogNCBdICAgID0gX2NvbG9yWzBdO1xuICAgICAgICAgIGltZ0RhdGEuZGF0YVtpbmRleF9zbWFsbCAqIDQgKyAxXSA9IF9jb2xvclsxXTtcbiAgICAgICAgICBpbWdEYXRhLmRhdGFbaW5kZXhfc21hbGwgKiA0ICsgMl0gPSBfY29sb3JbMl07XG4gICAgICAgICAgaW1nRGF0YS5kYXRhW2luZGV4X3NtYWxsICogNCArIDNdID0gX2NvbG9yWzNdO1xuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICB2YXIgX2NvbG9yID0gaW1nRGF0YS5kYXRhW2luZGV4X3NtYWxsICogNCArIDNdPyBjb2xvcjQgOiBjb2xvcjMgO1xuICAgICAgICAgIGlmKCFfY29sb3IpY29udGludWU7XG5cbiAgICAgICAgICBpbWdEYXRhLmRhdGFbaW5kZXhfc21hbGwgKiA0IF0gICAgPSBfY29sb3JbMF07XG4gICAgICAgICAgaW1nRGF0YS5kYXRhW2luZGV4X3NtYWxsICogNCArIDFdID0gX2NvbG9yWzFdO1xuICAgICAgICAgIGltZ0RhdGEuZGF0YVtpbmRleF9zbWFsbCAqIDQgKyAyXSA9IF9jb2xvclsyXTtcbiAgICAgICAgICBpbWdEYXRhLmRhdGFbaW5kZXhfc21hbGwgKiA0ICsgM10gPSBfY29sb3JbM107XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBjdHgucHV0SW1hZ2VEYXRhKGltZ0RhdGEsIG9wdGlvbnMubGVmdCAgLCBvcHRpb25zLnRvcCAgKTtcbiAgfTtcblxuXG4gIC8qKlxuICAgKiBnZXQgYXJyYXkgd2l0aCBiZWdpbiBhbmQgZW5kIGluZGljZXMgb2YgZmlsbGVkIDEgaW50ZXJ2YWxzXG4gICAqIEBwYXJhbSBjdHhcbiAgICogQHBhcmFtIG9wdGlvbnNcbiAgICogQHJldHVybnMge0FycmF5fVxuICAgKi9cbiAgU2VsZWN0aW9uTWFzay5wcm90b3R5cGUuZ2V0SW50ZXJ2YWxzQXJyYXkgPSBmdW5jdGlvbiAoY3R4LCBvcHRpb25zKSB7XG4gICAgdmFyIF9uZXdEYXRhID0gW107XG4gICAgZm9yICh2YXIgaSA9IDAsIF92YWwgPSAwOyBpIDwgYXJyYXkubGVuZ3RoOyBpKyspIHtcbiAgICAgIGlmIChfdmFsICE9IGFycmF5W2ldKSB7XG4gICAgICAgIF9uZXdEYXRhLnB1c2goaSk7XG4gICAgICAgIF92YWwgPSBhcnJheVtpXTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIF9uZXdEYXRhO1xuICB9O1xuXG4gIFNlbGVjdGlvbk1hc2sucHJvdG90eXBlLnJlbmRlckJvcmRlciA9IGZ1bmN0aW9uIChjdHgsIG9wdGlvbnMpIHtcblxuICAgIG9wdGlvbnMgICAgICAgICAgICAgPSBvcHRpb25zICAgICAgICAgICAgIHx8IHt9O1xuICAgIG9wdGlvbnMubGVmdCAgICAgICAgPSBvcHRpb25zLmxlZnQgICAgICAgIHx8IDAgO1xuICAgIG9wdGlvbnMudG9wICAgICAgICAgPSBvcHRpb25zLnRvcCAgICAgICAgIHx8IDAgO1xuICAgIG9wdGlvbnMuaGF0Y2hPZmZzZXQgPSBvcHRpb25zLmhhdGNoT2Zmc2V0IHx8IDAgO1xuICAgIG9wdGlvbnMuaGF0Y2hMZW5ndGggPSBvcHRpb25zLmhhdGNoTGVuZ3RoIHx8IDQgO1xuICAgIG9wdGlvbnMub3BhY2l0eSA9IG9wdGlvbnMub3BhY2l0eSB8fCAxIDtcblxuICAgIHZhciBpbWdEYXRhID0gY3R4LmdldEltYWdlRGF0YSgwLDAsdGhpcy53aWR0aCx0aGlzLmhlaWdodCk7XG5cbiAgICBpZighdGhpcy5jYWNoZUluZCl7XG4gICAgICB0aGlzLmNhY2hlSW5kID0gTWFnaWNXYW5kLmdldEJvcmRlckluZGljZXModGhpcyk7XG4gICAgfVxuXG4gICAgdmFyIHgsIHksIGksIGosIGssXG4gICAgICB3ID0gaW1nRGF0YS53aWR0aCxcbiAgICAgIGggPSBpbWdEYXRhLmhlaWdodDtcbiAgICB2YXIgcmVzID0gaW1nRGF0YS5kYXRhO1xuXG4gICAgdmFyIGxlbiA9IHRoaXMuY2FjaGVJbmQubGVuZ3RoO1xuICAgIGZvciAoaiA9IDA7IGogPCBsZW47IGorKykge1xuICAgICAgaSA9IHRoaXMuY2FjaGVJbmRbal07XG4gICAgICB4ID0gaSAlIHc7IC8vIGNhbGMgeCBieSBpbmRleFxuICAgICAgeSA9IChpIC0geCkgLyB3OyAvLyBjYWxjIHkgYnkgaW5kZXhcbiAgICAgIGsgPSAoeSAqIHcgKyB4KSAqIDQ7XG5cbiAgICAgIGlmICgoeCArIHkgKyBvcHRpb25zLmhhdGNoT2Zmc2V0KSAlIChvcHRpb25zLmhhdGNoTGVuZ3RoICogMikgPCBvcHRpb25zLmhhdGNoTGVuZ3RoKSB7IC8vIGRldGVjdCBoYXRjaCBjb2xvclxuXG4gICAgICAgIHJlc1trXSA9IDA7XG4gICAgICAgIHJlc1trICsgMV0gPSAwO1xuICAgICAgICByZXNbayArIDJdID0gMDtcbiAgICAgICAgcmVzW2sgKyAzXSA9IDI1NTsgLy8gYmxhY2ssIGNoYW5nZSBvbmx5IGFscGhhXG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXNba10gPSAyNTU7IC8vIHdoaXRlXG4gICAgICAgIHJlc1trICsgMV0gPSAyNTU7XG4gICAgICAgIHJlc1trICsgMl0gPSAyNTU7XG4gICAgICAgIHJlc1trICsgM10gPSAyNTU7XG4gICAgICB9XG4gICAgfVxuICAgIGN0eC5zYXZlKCk7XG4gICAgY3R4Lmdsb2JhbEFscGhhID0gb3B0aW9ucy5vcGFjaXR5O1xuICAgIGN0eC5wdXRJbWFnZURhdGEoaW1nRGF0YSwgb3B0aW9ucy5sZWZ0IHx8IDAgLCBvcHRpb25zLnRvcCB8fCAwICk7XG4gICAgY3R4LnJlc3RvcmUoKTtcbiAgfTtcblxuXG4gIGxpYi5jcmVhdGVNYXNrID0gZnVuY3Rpb24gKHcsIGgsZGF0YSkge1xuICAgIHJldHVybiBuZXcgU2VsZWN0aW9uTWFzayh3LGgsZGF0YSk7XG4gIH07XG5cbiAgbGliLmRpZmZlcmVuY2UgPSBmdW5jdGlvbiAoYSwgYikge1xuICAgIHJldHVybiBNYXRoLm1heChcbiAgICAgIGJbMF0gIT09IGZhbHNlID8gTWF0aC5hYnMoYlswXSAtIGFbMF0pOiAwLFxuICAgICAgYlsxXSAhPT0gZmFsc2UgPyBNYXRoLmFicyhiWzFdIC0gYVsxXSk6IDAsXG4gICAgICBiWzJdICE9PSBmYWxzZSA/IE1hdGguYWJzKGJbMl0gLSBhWzJdKTogMCxcbiAgICAgIGJbM10gIT09IGZhbHNlID8gTWF0aC5hYnMoYlszXSAtIGFbM10pOiAwKTtcbiAgfTtcblxuICBsaWIuYWNjZXB0YWJsZSA9IGZ1bmN0aW9uICh4LCB5LCBpbWFnZSwgdmlzaXRlZCwgc2FtcGxlQ29sb3IsIGNvbG9yVGhyZXNob2xkKSB7XG4vLyBjaGVjayB3aGV0aGVyIHRoZSBwb2ludCBoYXMgYmVlbiB2aXNpdGVkXG4gICAgaWYgKHZpc2l0ZWRbeSAqIGltYWdlLndpZHRoICsgeF0gPT09IDEpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgdmFyIGkgPSAoeSAqIGltYWdlLndpZHRoICsgeCkgKiBsaWIuYnl0ZXMsXG4gICAgICBjb2xvcjIgPSBbaW1hZ2UuZGF0YVtpXSwgaW1hZ2UuZGF0YVtpICsgMV0sIGltYWdlLmRhdGFbaSArIDJdLCBpbWFnZS5kYXRhW2kgKyAzXV07XG5cblxuICAgIGlmIChzYW1wbGVDb2xvclswXSAhPT0gZmFsc2UgJiYgTWF0aC5hYnMoc2FtcGxlQ29sb3JbMF0gLSBjb2xvcjJbMF0pID4gY29sb3JUaHJlc2hvbGQpcmV0dXJuIGZhbHNlO1xuICAgIGlmIChzYW1wbGVDb2xvclsxXSAhPT0gZmFsc2UgJiYgTWF0aC5hYnMoc2FtcGxlQ29sb3JbMV0gLSBjb2xvcjJbMV0pID4gY29sb3JUaHJlc2hvbGQpcmV0dXJuIGZhbHNlO1xuICAgIGlmIChzYW1wbGVDb2xvclsyXSAhPT0gZmFsc2UgJiYgTWF0aC5hYnMoc2FtcGxlQ29sb3JbMl0gLSBjb2xvcjJbMl0pID5jb2xvclRocmVzaG9sZClyZXR1cm4gZmFsc2U7XG4gICAgaWYgKHNhbXBsZUNvbG9yWzNdICE9PSBmYWxzZSAmJiBNYXRoLmFicyhzYW1wbGVDb2xvclszXSAtIGNvbG9yMlszXSkgPiBjb2xvclRocmVzaG9sZClyZXR1cm4gZmFsc2U7XG4gICAgcmV0dXJuIHRydWU7XG4gIH07XG5cbiAgbGliLnNlbGVjdEFsbCA9IGZ1bmN0aW9uIChpbWFnZSwgcHgsIHB5LCBjb2xvclRocmVzaG9sZCkge1xuICAgIHZhciBpID0gKHB5ICogaW1hZ2Uud2lkdGggKyBweCkgKiBsaWIuYnl0ZXMsXG4gICAgICBkYXRhID0gaW1hZ2UuZGF0YSxcbiAgICAgIHNhbXBsZUNvbG9yID0gW2RhdGFbaV0sIGRhdGFbaSArIDFdLCBkYXRhW2kgKyAyXSwgZGF0YVtpICsgM11dOyAvLyBzdGFydCBwb2ludCBjb2xvciAoc2FtcGxlKVxuICAgIHJldHVybiBsaWIuc2VsZWN0QWxsQnlDb2xvcihpbWFnZSwgc2FtcGxlQ29sb3IsIGNvbG9yVGhyZXNob2xkKVxuICB9O1xuXG5cbiAgLyoqXG4gICAqIENvbnZlcnRzIGFuIFJHQiBjb2xvciB2YWx1ZSB0byBIU0wuIENvbnZlcnNpb24gZm9ybXVsYVxuICAgKiBhZGFwdGVkIGZyb20gaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9IU0xfY29sb3Jfc3BhY2UuXG4gICAqIEFzc3VtZXMgciwgZywgYW5kIGIgYXJlIGNvbnRhaW5lZCBpbiB0aGUgc2V0IFswLCAyNTVdIGFuZFxuICAgKiByZXR1cm5zIGgsIHMsIGFuZCBsIGluIHRoZSBzZXQgWzAsIDFdLlxuICAgKlxuICAgKiBAcGFyYW0gICBOdW1iZXIgIHIgICAgICAgVGhlIHJlZCBjb2xvciB2YWx1ZVxuICAgKiBAcGFyYW0gICBOdW1iZXIgIGcgICAgICAgVGhlIGdyZWVuIGNvbG9yIHZhbHVlXG4gICAqIEBwYXJhbSAgIE51bWJlciAgYiAgICAgICBUaGUgYmx1ZSBjb2xvciB2YWx1ZVxuICAgKiBAcmV0dXJuICBBcnJheSAgICAgICAgICAgVGhlIEhTTCByZXByZXNlbnRhdGlvblxuICAgKi9cbiAgbGliLnJnYlRvSHNsID0gZnVuY3Rpb24ociwgZywgYil7XG4gICAgciAvPSAyNTUsIGcgLz0gMjU1LCBiIC89IDI1NTtcbiAgICB2YXIgbWF4ID0gTWF0aC5tYXgociwgZywgYiksIG1pbiA9IE1hdGgubWluKHIsIGcsIGIpO1xuICAgIHZhciBoLCBzLCBsID0gKG1heCArIG1pbikgLyAyO1xuXG4gICAgaWYobWF4ID09IG1pbil7XG4gICAgICBoID0gcyA9IDA7IC8vIGFjaHJvbWF0aWNcbiAgICB9ZWxzZXtcbiAgICAgIHZhciBkID0gbWF4IC0gbWluO1xuICAgICAgcyA9IGwgPiAwLjUgPyBkIC8gKDIgLSBtYXggLSBtaW4pIDogZCAvIChtYXggKyBtaW4pO1xuICAgICAgc3dpdGNoKG1heCl7XG4gICAgICAgIGNhc2UgcjogaCA9IChnIC0gYikgLyBkICsgKGcgPCBiID8gNiA6IDApOyBicmVhaztcbiAgICAgICAgY2FzZSBnOiBoID0gKGIgLSByKSAvIGQgKyAyOyBicmVhaztcbiAgICAgICAgY2FzZSBiOiBoID0gKHIgLSBnKSAvIGQgKyA0OyBicmVhaztcbiAgICAgIH1cbiAgICAgIGggLz0gNjtcbiAgICB9XG5cbiAgICByZXR1cm4gW2gsIHMsIGxdO1xuICB9XG5cbiAgbGliLnNlbGVjdENvbG9yZWQgPSBmdW5jdGlvbiAoaW1hZ2UsIG9wdGlvbnMpIHtcblxuICAgIHZhciBtYXNrID0gbmV3IFNlbGVjdGlvbk1hc2soaW1hZ2Uud2lkdGgsIGltYWdlLmhlaWdodCk7XG5cbiAgICBtYXNrLmJvdW5kcyA9IHtcbiAgICAgIG1pblg6IGltYWdlLndpZHRoLFxuICAgICAgbWluWTogaW1hZ2UuaGVpZ2h0LFxuICAgICAgbWF4WTogLTEsXG4gICAgICBtYXhYOiAtMVxuICAgIH07XG5cbiAgICB2YXIgeCwgeTtcbiAgICBmb3IgKHkgPSAwOyB5IDwgaW1hZ2UuaGVpZ2h0OyB5KyspIHtcbiAgICAgIGZvciAoeCA9IDA7IHggPCBpbWFnZS53aWR0aDsgeCsrKSB7XG4gICAgICAgIHZhciBpbmRleCA9ICh5ICogaW1hZ2Uud2lkdGggKyB4KTtcbiAgICAgICAgdmFyIGkgPSBpbmRleCAqIGxpYi5ieXRlcztcbiAgICAgICAgLy9pZiAoIWltYWdlLmRhdGFbaSArIDNdKSBjb250aW51ZTtcblxuXG4gICAgICAgIGlmIChvcHRpb25zLmFNaW4gJiYgaW1hZ2UuZGF0YVtpICsgM10gPCBvcHRpb25zLmFNaW4pY29udGludWU7XG5cbiAgICAgICAgdmFyIGhzbCA9IHJnYlRvSHNsKGltYWdlLmRhdGFbaV0sIGltYWdlLmRhdGFbaSArIDFdLCBpbWFnZS5kYXRhW2kgKyAyXSk7XG5cblxuICAgICAgICBpZiAob3B0aW9ucy5zTWluICYmIGhzbFsxXSA8IG9wdGlvbnMuc01pbiljb250aW51ZTtcbiAgICAgICAgaWYgKG9wdGlvbnMuc01heCAmJiBoc2xbMV0gPiBvcHRpb25zLnNNYXgpY29udGludWU7XG4gICAgICAgIGlmIChvcHRpb25zLmJNaW4gJiYgaHNsWzJdIDwgb3B0aW9ucy5iTWluKWNvbnRpbnVlO1xuICAgICAgICBpZiAob3B0aW9ucy5iTWF4ICYmIGhzbFsyXSA+IG9wdGlvbnMuYk1heCljb250aW51ZTtcblxuXG4gICAgICAgIG1hc2suZGF0YVtpbmRleF0gPSAxO1xuICAgICAgICBtYXNrLmNvdW50Kys7XG4gICAgICAgIG1hc2suYm91bmRzLm1pblggPSBNYXRoLm1pbihtYXNrLmJvdW5kcy5taW5YLCB4KTtcbiAgICAgICAgbWFzay5ib3VuZHMubWF4WCA9IE1hdGgubWF4KG1hc2suYm91bmRzLm1heFgsIHgpO1xuICAgICAgICBtYXNrLmJvdW5kcy5taW5ZID0gTWF0aC5taW4obWFzay5ib3VuZHMubWluWSwgeSk7XG4gICAgICAgIG1hc2suYm91bmRzLm1heFkgPSBNYXRoLm1heChtYXNrLmJvdW5kcy5tYXhZLCB5KTtcblxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbWFzaztcbiAgfTtcblxuXG5cblxuICBsaWIuc2VsZWN0QWxsQnlDb2xvciA9IGZ1bmN0aW9uIChjdHgsIHNhbXBsZUNvbG9yLCBjb2xvclRocmVzaG9sZCkge1xuICAgIHZhciBpbWFnZSA9IF9nZXRJbWFnZURhdGEoY3R4KTtcblxuICAgIHZhciBtYXNrID0gbmV3IFNlbGVjdGlvbk1hc2soaW1hZ2Uud2lkdGgsIGltYWdlLmhlaWdodCk7XG5cbiAgICBtYXNrLmJvdW5kcyA9IHtcbiAgICAgIG1pblg6IEluZmluaXR5LFxuICAgICAgbWluWTogSW5maW5pdHksXG4gICAgICBtYXhZOiAtMSxcbiAgICAgIG1heFg6IC0xXG4gICAgfTtcblxuXG4gICAgdmFyIHZpc2l0ZWQgPSBuZXcgVWludDhBcnJheSggaW1hZ2Uud2lkdGggKiBpbWFnZS5oZWlnaHQpO1xuICAgIHZhciB4LCB5O1xuICAgIGZvciAoeSA9IDA7IHkgPCBpbWFnZS5oZWlnaHQ7IHkrKykge1xuICAgICAgZm9yICh4ID0gMDsgeCA8IGltYWdlLndpZHRoOyB4KyspIHtcbiAgICAgICAgaWYobGliLmFjY2VwdGFibGUoeCwgeSwgaW1hZ2UsIG1hc2suZGF0YSwgc2FtcGxlQ29sb3IsIGNvbG9yVGhyZXNob2xkKSl7XG4gICAgICAgICAgTWFnaWNXYW5kLmZsb29kRmlsbChpbWFnZSwgeCwgeSwgY29sb3JUaHJlc2hvbGQsIHtcbiAgICAgICAgICAgIHNhbXBsZUNvbG9yOiAgICBzYW1wbGVDb2xvcixcbiAgICAgICAgICAgIGFjdGl2ZU1hc2sgOiAgICBtYXNrLFxuICAgICAgICAgICAgdmlzaXRlZFBvaW50cyA6IHZpc2l0ZWRcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbWFzaztcbiAgfTtcblxuXG5cbiAgbGliLmRyYXdJbWFnZSA9IGZ1bmN0aW9uIChjdHgsY2FudmFzLCBtYXNrICxsZWZ0LCB0b3ApIHtcblxuICAgIHZhciBjdHgyID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG5cblxuICAgIHZhciBpbWdEYXRhID0gY3R4LmdldEltYWdlRGF0YSgwLCAwLCBtYXNrLndpZHRoLCBtYXNrLmhlaWdodCk7XG4gICAgdmFyIGltZ0RhdGFPcmlnaW5hbCA9IGN0eDIuZ2V0SW1hZ2VEYXRhKGxlZnQsIHRvcCwgbWFzay53aWR0aCwgbWFzay5oZWlnaHQpO1xuXG5cbiAgICB2YXIgYiA9IG1hc2suYm91bmRzO1xuICAgIGZvciAodmFyIHggPSBiLm1pblg7IHggPD0gYi5tYXhYOyB4KyspZm9yICh2YXIgeSA9IGIubWluWTsgeSA8PSBiLm1heFk7IHkrKykge1xuICAgICAgdmFyIGkgPSAoeSAqIG1hc2sud2lkdGggKyB4KTsvLyAqIGJ5dGVzOyAvLyBwb2ludCBpbmRleCBpbiB0aGUgaW1hZ2UgZGF0YVxuICAgICAgaWYgKG1hc2suZGF0YVtpXSkge1xuICAgICAgICBpbWdEYXRhLmRhdGFbaSAqIDRdICAgICA9IGltZ0RhdGFPcmlnaW5hbC5kYXRhW2kgKiA0XTtcbiAgICAgICAgaW1nRGF0YS5kYXRhW2kgKiA0ICsgMV0gPSBpbWdEYXRhT3JpZ2luYWwuZGF0YVtpICogNCArIDFdO1xuICAgICAgICBpbWdEYXRhLmRhdGFbaSAqIDQgKyAyXSA9IGltZ0RhdGFPcmlnaW5hbC5kYXRhW2kgKiA0ICsgMl07XG4gICAgICAgIGltZ0RhdGEuZGF0YVtpICogNCArIDNdID0gaW1nRGF0YU9yaWdpbmFsLmRhdGFbaSAqIDQgKyAzXTtcbiAgICAgIH1cbiAgICB9XG4gICAgY3R4LnB1dEltYWdlRGF0YShpbWdEYXRhLDAsIDApO1xuICB9O1xuXG4gIGZ1bmN0aW9uIF9nZXRJbWFnZURhdGEoY3R4KXtcbiAgICBpZihjdHguY29uc3RydWN0b3IubmFtZSA9PSBcIkltYWdlRGF0YVwiKXtcbiAgICAgIHJldHVybiBjdHg7XG4gICAgfWVsc2V7XG4gICAgICByZXR1cm4gY3R4LmdldEltYWdlRGF0YSgwLCAwLCBjdHguY2FudmFzLndpZHRoLCBjdHguY2FudmFzLmhlaWdodCk7XG4gICAgfVxuICB9XG5cbiAgbGliLmZpbGxNYXNrID0gZnVuY3Rpb24gKGN0eCxtYXNrLCBjb2xvcikge1xuICAgIHZhciBpbWdEYXRhID0gX2dldEltYWdlRGF0YShjdHgpO1xuICAgIHZhciBiID0gbWFzay5ib3VuZHM7XG4gICAgdmFyIHcgPSBpbWdEYXRhLndpZHRoLFxuICAgICAgaCA9IGltZ0RhdGEuaGVpZ2h0O1xuXG4gICAgZm9yICh2YXIgeCA9IGIubWluWDsgeCA8PSBiLm1heFg7IHgrKylmb3IgKHZhciB5ID0gYi5taW5ZOyB5IDw9IGIubWF4WTsgeSsrKSB7XG4gICAgICB2YXIgaSA9ICh5ICogdyArIHgpOy8vICogYnl0ZXM7IC8vIHBvaW50IGluZGV4IGluIHRoZSBpbWFnZSBkYXRhXG4gICAgICBpZiAobWFzay5kYXRhW2ldKSB7XG4gICAgICAgIGltZ0RhdGEuZGF0YVtpICogNF0gICAgID0gY29sb3JbMF07XG4gICAgICAgIGltZ0RhdGEuZGF0YVtpICogNCArIDFdID0gY29sb3JbMV07XG4gICAgICAgIGltZ0RhdGEuZGF0YVtpICogNCArIDJdID0gY29sb3JbMl07XG4gICAgICAgIGltZ0RhdGEuZGF0YVtpICogNCArIDNdID0gY29sb3JbM107XG4gICAgICB9XG4gICAgfVxuICAgIGlmKGN0eC5jb25zdHJ1Y3Rvci5uYW1lICE9IFwiSW1hZ2VEYXRhXCIpIHtcbiAgICAgIGN0eC5jbGVhclJlY3QoMCwgMCwgdywgaCk7XG4gICAgICBjdHgucHV0SW1hZ2VEYXRhKGltZ0RhdGEsIDAsIDApO1xuICAgIH1cbiAgfTtcblxuICBsaWIuc2VsZWN0QmFja2dyb3VuZCA9IGZ1bmN0aW9uIChjdHgsIHNhbXBsZUNvbG9yLCBjb2xvclRocmVzaG9sZCkge1xuICAgIHZhciBpbWFnZSA9IF9nZXRJbWFnZURhdGEoY3R4KTtcblxuICAgIGNvbG9yVGhyZXNob2xkID0gY29sb3JUaHJlc2hvbGQgfHwgMTU7XG5cbiAgICB2YXIgbWFzayA9IG5ldyBTZWxlY3Rpb25NYXNrKGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQpO1xuICAgIG1hc2suYm91bmRzID0ge1xuICAgICAgbWluWDogSW5maW5pdHksXG4gICAgICBtaW5ZOiBJbmZpbml0eSxcbiAgICAgIG1heFk6IC0xLFxuICAgICAgbWF4WDogLTFcbiAgICB9O1xuXG4gICAgdmFyIGRhdGEgPSBpbWFnZS5kYXRhO1xuXG4gICAgc2FtcGxlQ29sb3IgPSBzYW1wbGVDb2xvciB8fFtkYXRhWzBdLCBkYXRhWzFdLCBkYXRhWzJdLCBkYXRhWzNdXTsgLy8gc3RhcnQgcG9pbnQgY29sb3IgKHNhbXBsZSlcblxuICAgIHZhciBjb2xvciA9IHNhbXBsZUNvbG9yO1xuXG4gICAgZnVuY3Rpb24gYWRkKHgsIHkpIHtcbiAgICAgIGlmICghbGliLmFjY2VwdGFibGUoeCwgeSwgaW1hZ2UsIG1hc2suZGF0YSwgc2FtcGxlQ29sb3IsIGNvbG9yVGhyZXNob2xkKSlyZXR1cm47XG4gICAgICBpZiAoIXNhbXBsZUNvbG9yKSB7XG4gICAgICAgIHZhciBpbmRleCA9ICh5ICogaW1hZ2Uud2lkdGggKyB4KSAqIDQ7XG4gICAgICAgIGNvbG9yID0gW2RhdGFbaW5kZXhdLCBkYXRhW2luZGV4ICsgMV0sIGRhdGFbaW5kZXggKyAyXSwgZGF0YVtpbmRleCArIDNdXTtcbiAgICAgIH1cbiAgICAgIHZhciBtYXNrMiA9IE1hZ2ljV2FuZC5mbG9vZEZpbGwoaW1hZ2UsIHgsIHksIGNvbG9yVGhyZXNob2xkLCBudWxsLCBjb2xvcik7XG4gICAgICBtYXNrID0gTWFnaWNXYW5kLmFkZChtYXNrLCBtYXNrMik7XG4gICAgfVxuXG4gICAgdmFyIHgsIHk7XG5cbiAgICBmb3IgKHggPSAwOyB4IDwgaW1hZ2Uud2lkdGg7IHgrKykge1xuICAgICAgYWRkKHgsIDApO1xuICAgIH1cbiAgICBmb3IgKHggPSAwOyB4IDwgaW1hZ2Uud2lkdGg7IHgrKykge1xuICAgICAgYWRkKHgsIGltYWdlLmhlaWdodCAtIDEpO1xuICAgIH1cbiAgICBmb3IgKHkgPSAwOyB5IDwgaW1hZ2UuaGVpZ2h0OyB5KyspIHtcbiAgICAgIGFkZChpbWFnZS53aWR0aCAtIDEsIHkpO1xuICAgIH1cbiAgICBmb3IgKHkgPSAwOyB5IDwgaW1hZ2UuaGVpZ2h0OyB5KyspIHtcbiAgICAgIGFkZCgwLCB5KTtcbiAgICB9XG4gICAgcmV0dXJuIG1hc2s7XG5cbiAgfTtcblxuICBsaWIuZXh0cmFjdENvbG9ycyA9IGZ1bmN0aW9uKG1peGVkVHlwZSx0aHJlc2hvbGQpIHtcbiAgICB0aHJlc2hvbGQ9IHRocmVzaG9sZCB8fCA2MDtcbiAgICB2YXIgaW1nRGF0YSA9IGxpYi5nZXRJbWFnZURhdGEobWl4ZWRUeXBlKTtcbiAgICB2YXIgX2NvbG9ycyA9IFtdO1xuICAgIHZhciBjMTtcbiAgICBmb3IodmFyIHggPSAxOyB4IDxpbWdEYXRhLndpZHRoO3grPTMpe1xuICAgICAgZm9yKHZhciB5ID0gMTsgeSA8aW1nRGF0YS5oZWlnaHQ7eSs9Mykge1xuICAgICAgICB2YXIgaWlpID0gKHggKyB5ICogaW1nRGF0YS53aWR0aCkgKiA0O1xuICAgICAgICB2YXIgaWlBID0gKHggLSAxICsgeSAqIGltZ0RhdGEud2lkdGgpICogNDtcbiAgICAgICAgdmFyIGlpQiA9ICh4ICsgMSArIHkgKiBpbWdEYXRhLndpZHRoKSAqIDQ7XG4gICAgICAgIHZhciBpaUMgPSAoeCAtIDEgKyAoeSArIDEpICogaW1nRGF0YS53aWR0aCkgKiA0O1xuICAgICAgICB2YXIgaWlEID0gKHggKyAxICsgKHkgKyAxKSAqIGltZ0RhdGEud2lkdGgpICogNDtcbiAgICAgICAgaWYoaW1nRGF0YS5kYXRhW2lpaSArIDNdIDwgMjU1KWNvbnRpbnVlO1xuXG4gICAgICAgIGMxID0gWyBpbWdEYXRhLmRhdGFbaWlpXSwgaW1nRGF0YS5kYXRhW2lpaSArIDFdLCBpbWdEYXRhLmRhdGFbaWlpICsgMl1dO1xuICAgICAgICB2YXIgY0EgPSBbIGltZ0RhdGEuZGF0YVtpaUFdLCBpbWdEYXRhLmRhdGFbaWlBICsgMV0sIGltZ0RhdGEuZGF0YVtpaUEgKyAyXV07XG4gICAgICAgIHZhciBjQiA9IFsgaW1nRGF0YS5kYXRhW2lpQl0sIGltZ0RhdGEuZGF0YVtpaUIgKyAxXSwgaW1nRGF0YS5kYXRhW2lpQiArIDJdXTtcbiAgICAgICAgdmFyIGNDID0gWyBpbWdEYXRhLmRhdGFbaWlDXSwgaW1nRGF0YS5kYXRhW2lpQyArIDFdLCBpbWdEYXRhLmRhdGFbaWlDICsgMl1dO1xuICAgICAgICB2YXIgY0QgPSBbIGltZ0RhdGEuZGF0YVtpaURdLCBpbWdEYXRhLmRhdGFbaWlEICsgMV0sIGltZ0RhdGEuZGF0YVtpaUQgKyAyXV07XG5cbiAgICAgICAgaWYoXG4gICAgICAgICAgYzFbMF0gIT0gY0FbMF0gfHwgY0FbMF0gIT0gY0JbMF0gfHwgY0JbMF0gIT0gY0NbMF0gfHwgY0NbMF0gIT0gY0RbMF0gfHxcbiAgICAgICAgICBjMVsxXSAhPSBjQVsxXSB8fCBjQVsxXSAhPSBjQlsxXSB8fCBjQlsxXSAhPSBjQ1sxXSB8fCBjQ1sxXSAhPSBjRFsxXSB8fFxuICAgICAgICAgIGMxWzJdICE9IGNBWzJdIHx8IGNBWzJdICE9IGNCWzJdIHx8IGNCWzJdICE9IGNDWzJdIHx8IGNDWzJdICE9IGNEWzJdXG4gICAgICAgICl7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgaXNOZXdDb2xvciA9IHRydWU7XG5cbiAgICAgICAgZm9yKHZhciBpIGluIF9jb2xvcnMpe1xuICAgICAgICAgIGlmKE1hZ2ljV2FuZC5kaWZmZXJlbmNlKF9jb2xvcnNbaV0sIGMxKSA8IHRocmVzaG9sZCl7XG4gICAgICAgICAgICBpc05ld0NvbG9yID0gZmFsc2U7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYoaXNOZXdDb2xvcil7XG4gICAgICAgICAgX2NvbG9ycy5wdXNoKGMxKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gX2NvbG9ycztcbiAgfTtcblxuICAvKipcbiAgICogaW1hZ2VcbiAgICogY2FudmFzIC0g0YfQtdGA0L3QviDQsdC70L7QtSDQuNC30L7QsdGA0LDQttC10L3QuNC1LlxuICAgKlxuICAgKiBtYXNrLSDQv9GA0LXQtNGL0LTRg9GJ0LDRjyDQvNCw0YHQutCwLiDQvdCwINC90LXQtSDQsdGD0LTQtdGCINC90LDQutC70LDQtNGL0LLQsNGC0Ywg0L3QvtCy0LDRj1xuICAgKiBtb2RlIC0g0YHQv9C+0YHQvtCxINC90LDQu9C+0LbQtdC90LjRjy5cbiAgICovXG4gIGxpYi5tYXNrU2VsZWN0aW9uID0gZnVuY3Rpb24gKCBjYW52YXMsIGxlZnQsIHRvcCwgbWFzayAsbW9kZSkge1xuICAgIGxlZnQgPSBsZWZ0IHx8IDA7XG4gICAgdG9wID0gdG9wIHx8IDA7XG4gICAgaWYoY2FudmFzLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJIVE1MSW1hZ2VFbGVtZW50XCIpe1xuXG4gICAgICB2YXIgX19jYW52YXMgPSBjcmVhdGVDYW52YXNFbGVtZW50KCk7XG4gICAgICBfX2NhbnZhcy53aWR0aCA9IGNhbnZhcy53aWR0aDtcbiAgICAgIF9fY2FudmFzLmhlaWdodCA9IGNhbnZhcy5oZWlnaHQ7XG4gICAgICB2YXIgX19jdHggPSBfX2NhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xuICAgICAgX19jdHguZHJhd0ltYWdlKGNhbnZhcywgMCwgMCk7XG4gICAgICBjYW52YXMgPSBfX2NhbnZhcztcbiAgICB9XG5cblxuICAgIHZhciBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKSxcbiAgICAgIGltZ0RhdGEgPSBjdHguZ2V0SW1hZ2VEYXRhKDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCksXG4gICAgICBtYXNrID0gbWFzayB8fCBNYWdpY1dhbmQuY3JlYXRlTWFzayhjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpO1xuXG4gICAgdmFyIF94MSA9IE1hdGgubWF4KDAsIC0gbGVmdCksXG4gICAgICBfeTEgPSBNYXRoLm1heCgwLCAtIHRvcCksXG4gICAgICBfeDIgPSBNYXRoLm1pbihtYXNrLndpZHRoIC0gbGVmdCxjYW52YXMud2lkdGgpO1xuICAgIF95MiA9IE1hdGgubWluKG1hc2suaGVpZ2h0IC0gdG9wLGNhbnZhcy5oZWlnaHQpO1xuXG4gICAgZm9yICh2YXIgeCA9IF94MTsgeCA8IF94MjsgeCsrKSB7XG4gICAgICBmb3IgKHZhciB5ID0gX3kxOyB5IDwgX3kyOyB5KyspIHtcbiAgICAgICAgdmFyIGluZGV4ID0gKGNhbnZhcy53aWR0aCAqIHkgKyB4KSAqIDQ7XG5cbiAgICAgICAgaWYgKGltZ0RhdGEuZGF0YVtpbmRleF0gPiAyMCkge1xuICAgICAgICAgIHZhciBpbmRleDIgPSBtYXNrLndpZHRoICogKHkgKyB0b3ApICsgeCArIGxlZnQ7XG4gICAgICAgICAgbWFzay5kYXRhW2luZGV4Ml0gPSAxO1xuICAgICAgICAgIG1hc2suY291bnQrKztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbWFzaztcbiAgfSxcbiAgbGliLnNlbGVjdFJlY3RhbmdsZSA9IGZ1bmN0aW9uIChpbWFnZSwgeDEsIHkxLCB4MiwgeTIpIHtcblxuICAgICAgdmFyIG1hc2sgPSBuZXcgU2VsZWN0aW9uTWFzayhpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0KTtcbiAgICAgIHZhciBtaW5YID0gTWF0aC5taW4oeDEsIHgyKTtcbiAgICAgIHZhciBtYXhYID0gTWF0aC5tYXgoeDEsIHgyKTtcbiAgICAgIHZhciBtaW5ZID0gTWF0aC5taW4oeTEsIHkyKTtcbiAgICAgIHZhciBtYXhZID0gTWF0aC5tYXgoeTEsIHkyKTtcblxuICAgICAgdmFyIHcgPSBpbWFnZS53aWR0aCwgaCA9IGltYWdlLmhlaWdodDtcblxuICAgICAgdmFyIGRhdGEgPSBpbWFnZS5kYXRhO1xuICAgICAgZm9yICh2YXIgeSA9IG1pblk7IHkgPD0gbWF4WTsgeSsrKSB7XG4gICAgICAgIGZvciAodmFyIHggPSBtaW5YOyB4IDw9IG1heFg7IHgrKykge1xuICAgICAgICAgIGlmIChkYXRhWyh5ICogdyArIHgpICogNCArIDNdKSB7XG4gICAgICAgICAgICBtYXNrLmRhdGFbeSAqIHcgKyB4XSA9IDE7XG4gICAgICAgICAgICBtYXNrLmNvdW50Kys7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIG1hc2suYm91bmRzID0ge1xuICAgICAgICBtaW5YOiBtaW5YLFxuICAgICAgICBtaW5ZOiBtaW5ZLFxuICAgICAgICBtYXhYOiBtYXhYLFxuICAgICAgICBtYXhZOiBtYXhZXG4gICAgICB9O1xuXG4gICAgICByZXR1cm4gbWFzaztcbiAgICB9O1xuXG4gIGxpYi5ieXRlcyA9IDQ7XG5cblxuXG5cblxuXG4gIGxpYi5fX2Zsb29kRmlsbCA9IGZ1bmN0aW9uIChlLHBvc3RNZXNzYWdlKSB7XG5cbiAgICBkYXRhID0gZS5kYXRhO1xuICAgIHZhciBpbWFnZSA9IGRhdGFbMF0sIHB4ID0gZGF0YVsxXSwgcHkgPSBkYXRhWzJdLCBjb2xvclRocmVzaG9sZCA9IGRhdGFbM10sIG9wdGlvbnMgPSBkYXRhWzRdO1xuXG4gICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG4gICAgLyp7XG4gICAgIHZpc2l0ZWRQb2ludHNBcnJheSxcbiAgICAgc2FtcGxlQ29sb3IsXG4gICAgIHJlc3VsdE1hc2tcbiAgICAgfSovXG5cbiAgICB2YXIgYywgeCwgbmV3WSwgZWwsIHhyLCB4bCwgZHksIGR5bCwgZHlyLCBjaGVja1ksXG4gICAgICBkYXRhID0gaW1hZ2UuZGF0YSwgdyA9IGltYWdlLndpZHRoLCBoID0gaW1hZ2UuaGVpZ2h0LCBieXRlcyA9IGxpYi5ieXRlcyxcbiAgICAgIGkgPSBweSAqIHcgKyBweDsgLy8gc3RhcnQgcG9pbnQgaW5kZXggaW4gdGhlIG1hc2sgZGF0YVxuICAgIGkgPSBpICogYnl0ZXM7IC8vIHN0YXJ0IHBvaW50IGluZGV4IGluIHRoZSBpbWFnZSBkYXRhXG5cbiAgICB2YXIgdmlzaXRlZCAgICAgPSBvcHRpb25zLnZpc2l0ZWRQb2ludHMgfHwgbmV3IFVpbnQ4QXJyYXkoIHcgKiBoKSwgLy8gbWFzayBvZiB2aXNpdGVkIHBvaW50c1xuICAgICAgc2FtcGxlQ29sb3IgPSBvcHRpb25zLnNhbXBsZUNvbG9yICAgfHwgW2RhdGFbaV0sIGRhdGFbaSArIDFdLCBkYXRhW2kgKyAyXSwgZGF0YVtpICsgM11dLCAvLyBzdGFydCBwb2ludCBjb2xvciAoc2FtcGxlKVxuICAgICAgcmVzdWx0ICAgICAgPSBvcHRpb25zLmFjdGl2ZU1hc2s7XG5cbiAgICBmdW5jdGlvbiBhY2NlcHRhYmxlKHgsIHkpIHtcbi8vIGNoZWNrIHdoZXRoZXIgdGhlIHBvaW50IGhhcyBiZWVuIHZpc2l0ZWRcbiAgICAgIGlmICh2aXNpdGVkW3kgKiBpbWFnZS53aWR0aCArIHhdID09PSAxKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIHZhciBpID0gKHkgKiBpbWFnZS53aWR0aCArIHgpICogbGliLmJ5dGVzLFxuICAgICAgICBjb2xvcjIgPSBbaW1hZ2UuZGF0YVtpXSwgaW1hZ2UuZGF0YVtpICsgMV0sIGltYWdlLmRhdGFbaSArIDJdLCBpbWFnZS5kYXRhW2kgKyAzXV07XG4gICAgICBpZiAoc2FtcGxlQ29sb3JbMF0gIT09IGZhbHNlICYmIE1hdGguYWJzKHNhbXBsZUNvbG9yWzBdIC0gY29sb3IyWzBdKSA+IGNvbG9yVGhyZXNob2xkKXJldHVybiBmYWxzZTtcbiAgICAgIGlmIChzYW1wbGVDb2xvclsxXSAhPT0gZmFsc2UgJiYgTWF0aC5hYnMoc2FtcGxlQ29sb3JbMV0gLSBjb2xvcjJbMV0pID4gY29sb3JUaHJlc2hvbGQpcmV0dXJuIGZhbHNlO1xuICAgICAgaWYgKHNhbXBsZUNvbG9yWzJdICE9PSBmYWxzZSAmJiBNYXRoLmFicyhzYW1wbGVDb2xvclsyXSAtIGNvbG9yMlsyXSkgPiBjb2xvclRocmVzaG9sZClyZXR1cm4gZmFsc2U7XG4gICAgICBpZiAoc2FtcGxlQ29sb3JbM10gIT09IGZhbHNlICYmIE1hdGguYWJzKHNhbXBsZUNvbG9yWzNdIC0gY29sb3IyWzNdKSA+IGNvbG9yVGhyZXNob2xkKXJldHVybiBmYWxzZTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH07XG5cblxuXG4gICAgaWYgKHZpc2l0ZWRbaV0gPT09IDEpIHJldHVybiBudWxsO1xuXG5cbiAgICB2YXIgZmlyc3QgPSB0cnVlO1xuICAgIHZhciBzdGFjayA9IFt7eTogcHksIGxlZnQ6IHB4IC0gMSwgcmlnaHQ6IHB4ICsgMSwgZGlyOiAxfV07IC8vIGZpcnN0IHNjYW5uaW5nIGxpbmVcblxuICAgIHZhciBtb2RlID0gJ3N0cmljdCc7XG4gICAgdmFyIF9jaTtcbiAgICBkbyB7XG4gICAgICBlbCA9IHN0YWNrLnNoaWZ0KCk7IC8vIGdldCBsaW5lIGZvciBzY2FubmluZ1xuXG4gICAgICBjaGVja1kgPSBmYWxzZTtcbiAgICAgIGZvciAoeCA9IGVsLmxlZnQgKyAxOyB4IDwgZWwucmlnaHQ7IHgrKykge1xuICAgICAgICBkeSA9IGVsLnkgKiB3O1xuXG4gICAgICAgIGlmKG1vZGUgPT0gJ2dyYWRpZW50JyAmJiAhZmlyc3QpIHtcbiAgICAgICAgICBfY2kgPSAoZHkgKyB4ICsgKGVsLmRpciA9PSAtMSA/IHc6IC0gdykpKjQ7XG4gICAgICAgICAgc2FtcGxlQ29sb3IgPSBbZGF0YVtfY2ldLGRhdGFbX2NpKzFdLGRhdGFbX2NpKzJdLGRhdGFbX2NpKzNdXTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWFjY2VwdGFibGUoeCwgZWwueSwgaW1hZ2UsIHZpc2l0ZWQsIHNhbXBsZUNvbG9yLCBjb2xvclRocmVzaG9sZCkpY29udGludWU7XG5cbiAgICAgICAgZmlyc3QgPSBmYWxzZTtcblxuICAgICAgICBjaGVja1kgPSB0cnVlOyAvLyBpZiB0aGUgY29sb3Igb2YgdGhlIG5ldyBwb2ludCh4LHkpIGlzIHNpbWlsYXIgdG8gdGhlIHNhbXBsZSBjb2xvciBuZWVkIHRvIGNoZWNrIG1pbm1heCBmb3IgWVxuXG4gICAgICAgIHJlc3VsdC5jb3VudCsrO1xuXG4gICAgICAgIHJlc3VsdC5kYXRhW2R5ICsgeF0gPSAxOyAvLyBtYXJrIGEgbmV3IHBvaW50IGluIG1hc2tcbiAgICAgICAgdmlzaXRlZFtkeSArIHhdID0gMTsgLy8gbWFyayBhIG5ldyBwb2ludCBhcyB2aXNpdGVkXG5cbiAgICAgICAgeGwgPSB4IC0gMTtcbiAgICAgICAgLy8gd2FsayB0byBsZWZ0IHNpZGUgc3RhcnRpbmcgd2l0aCB0aGUgbGVmdCBuZWlnaGJvclxuICAgICAgICB3aGlsZSAoeGwgPiAtMSkge1xuICAgICAgICAgIGR5bCA9IGR5ICsgeGw7XG5cbiAgICAgICAgICBpZihtb2RlID09ICdncmFkaWVudCcpIHtcbiAgICAgICAgICAgIF9jaSA9IChkeWwgKyAxKSo0O1xuICAgICAgICAgICAgc2FtcGxlQ29sb3IgPSBbZGF0YVtfY2ldLCBkYXRhW19jaSArIDFdLCBkYXRhW19jaSArIDJdLCBkYXRhW19jaSArIDNdXTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKCFhY2NlcHRhYmxlKHhsLCBlbC55LCBpbWFnZSwgdmlzaXRlZCwgc2FtcGxlQ29sb3IsIGNvbG9yVGhyZXNob2xkKSkgYnJlYWs7XG5cbiAgICAgICAgICByZXN1bHQuY291bnQrKztcbiAgICAgICAgICByZXN1bHQuZGF0YVtkeWxdID0gMTtcbiAgICAgICAgICB2aXNpdGVkW2R5bF0gPSAxO1xuXG4gICAgICAgICAgeGwtLTtcbiAgICAgICAgfVxuICAgICAgICB4ciA9IHggKyAxO1xuICAgICAgICAvLyB3YWxrIHRvIHJpZ2h0IHNpZGUgc3RhcnRpbmcgd2l0aCB0aGUgcmlnaHQgbmVpZ2hib3JcbiAgICAgICAgd2hpbGUgKHhyIDwgdykge1xuICAgICAgICAgIGR5ciA9IGR5ICsgeHI7XG5cbiAgICAgICAgICBpZihtb2RlID09ICdncmFkaWVudCcpIHtcbiAgICAgICAgICAgIF9jaSA9IChkeXIgLSAxKSo0O1xuICAgICAgICAgICAgc2FtcGxlQ29sb3IgPSBbZGF0YVtfY2ldLCBkYXRhW19jaSArIDFdLCBkYXRhW19jaSArIDJdLCBkYXRhW19jaSArIDNdXTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKCFhY2NlcHRhYmxlKHhyLCBlbC55LCBpbWFnZSwgdmlzaXRlZCwgc2FtcGxlQ29sb3IsIGNvbG9yVGhyZXNob2xkKSl7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXN1bHQuY291bnQrKztcbiAgICAgICAgICByZXN1bHQuZGF0YVtkeXJdID0gMTtcbiAgICAgICAgICB2aXNpdGVkW2R5cl0gPSAxO1xuICAgICAgICAgIHhyKys7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBjaGVjayBtaW5tYXggZm9yIFhcbiAgICAgICAgaWYgKHhsIDwgcmVzdWx0LmJvdW5kcy5taW5YKSByZXN1bHQuYm91bmRzLm1pblggPSB4bCArIDE7XG4gICAgICAgIGlmICh4ciA+IHJlc3VsdC5ib3VuZHMubWF4WCkgcmVzdWx0LmJvdW5kcy5tYXhYID0geHIgLSAxO1xuXG4gICAgICAgIG5ld1kgPSBlbC55IC0gZWwuZGlyO1xuICAgICAgICBpZiAobmV3WSA+PSAwICYmIG5ld1kgPCBoKSB7XG4gICAgICAgICAgaWYgKHhsIDwgeHIpIHN0YWNrLnB1c2goe3k6IG5ld1ksIGxlZnQ6IHhsLCByaWdodDogeHIsIGRpcjogLWVsLmRpcn0pOyAvLyBmcm9tIFwibmV3IGxlZnRcIiB0byBcIm5ldyByaWdodFwiXG4gICAgICAgICAgLy8gYWRkIHR3byBzY2FubmluZyBsaW5lcyBpbiB0aGUgb3Bwb3NpdGUgZGlyZWN0aW9uICh5IC0gZGlyKSBpZiBuZWNlc3NhcnlcbiAgICAgICAgICAvLyBpZiAoeGwgPD0gZWwubGVmdCkgc3RhY2sucHVzaCh7eTogbmV3WSwgbGVmdDogeGwsIHJpZ2h0OiBlbC5sZWZ0LCBkaXI6IC1lbC5kaXJ9KTsgLy8gZnJvbSBcIm5ldyBsZWZ0XCIgdG8gXCJjdXJyZW50IGxlZnRcIlxuICAgICAgICAgIC8vIGlmIChlbC5yaWdodCA8PSB4cikgc3RhY2sucHVzaCh7eTogbmV3WSwgbGVmdDogZWwucmlnaHQsIHJpZ2h0OiB4ciwgZGlyOiAtZWwuZGlyfSk7IC8vIGZyb20gXCJjdXJyZW50IHJpZ2h0XCIgdG8gXCJuZXcgcmlnaHRcIlxuICAgICAgICB9XG4gICAgICAgIG5ld1kgPSBlbC55ICsgZWwuZGlyO1xuICAgICAgICBpZiAobmV3WSA+PSAwICYmIG5ld1kgPCBoKSB7IC8vIGFkZCB0aGUgc2Nhbm5pbmcgbGluZSBpbiB0aGUgZGlyZWN0aW9uICh5ICsgZGlyKSBpZiBuZWNlc3NhcnlcbiAgICAgICAgICBpZiAoeGwgPCB4cikgc3RhY2sucHVzaCh7eTogbmV3WSwgbGVmdDogeGwsIHJpZ2h0OiB4ciwgZGlyOiBlbC5kaXJ9KTsgLy8gZnJvbSBcIm5ldyBsZWZ0XCIgdG8gXCJuZXcgcmlnaHRcIlxuICAgICAgICB9XG4gICAgICB9XG4gICAgICAvLyBjaGVjayBtaW5tYXggZm9yIFkgaWYgbmVjZXNzYXJ5XG4gICAgICBpZiAoY2hlY2tZKSB7XG4gICAgICAgIGlmIChlbC55IDwgcmVzdWx0LmJvdW5kcy5taW5ZKSByZXN1bHQuYm91bmRzLm1pblkgPSBlbC55O1xuICAgICAgICBpZiAoZWwueSA+IHJlc3VsdC5ib3VuZHMubWF4WSkgcmVzdWx0LmJvdW5kcy5tYXhZID0gZWwueTtcbiAgICAgIH1cbiAgICB9IHdoaWxlIChzdGFjay5sZW5ndGggPiAwKTtcblxuICAgIHBvc3RNZXNzYWdlICYmIHBvc3RNZXNzYWdlKHJlc3VsdCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcblxuICBsaWIuZXh0ZW5kTWFzayA9IGZ1bmN0aW9uIChtYXNrLCB2YWx1ZSkge1xuXG4gICAgdmFyIG1hc2syID0gbmV3IFNlbGVjdGlvbk1hc2sobWFzay53aWR0aCArIDIsIG1hc2suaGVpZ2h0ICsgMik7XG4gICAgaWYodmFsdWUpe1xuICAgICAgbWFzazIuZGF0YS5maWxsKHZhbHVlKTtcbiAgICB9XG5cbiAgICBmb3IodmFyIHkgPSAwO3kgPCBtYXNrLmhlaWdodCA7IHkrKyl7XG4gICAgICBmb3IodmFyIHggPSAwO3ggPCBtYXNrLndpZHRoIDsgeCsrKXtcbiAgICAgICAgbWFzazIuZGF0YVsgKHkgKyAxKSAqIG1hc2syLndpZHRoICsgeCArIDEgXSA9IG1hc2suZGF0YVt5ICogbWFzay53aWR0aCArIHggXTtcbiAgICAgIH1cbiAgICB9XG4gICAgbWFzazIuY291bnQgID0gbWFzay5jb3VudDtcblxuICAgIGlmKCF2YWx1ZSkge1xuICAgICAgbWFzazIuYm91bmRzID0ge1xuICAgICAgICBtaW5YOiBtYXNrLmJvdW5kcy5taW5YICsgMSxcbiAgICAgICAgbWF4WDogbWFzay5ib3VuZHMubWF4WCArIDEsXG4gICAgICAgIG1heFk6IG1hc2suYm91bmRzLm1heFkgKyAxLFxuICAgICAgICBtaW5ZOiBtYXNrLmJvdW5kcy5taW5ZICsgMVxuICAgICAgfTtcbiAgICB9ZWxzZXtcbiAgICAgIG1hc2syLmJvdW5kcyA9IG1hc2suYm91bmRzO1xuICAgIH1cblxuICAgIHJldHVybiBtYXNrMjtcbiAgfTtcblxuICAvKiogQ3JlYXRlIGEgYmluYXJ5IG1hc2sgb24gdGhlIGltYWdlIGJ5IGNvbG9yIHRocmVzaG9sZFxuICAgKiBBbGdvcml0aG06IFNjYW5saW5lIGZsb29kIGZpbGwgKGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvRmxvb2RfZmlsbClcbiAgICogQHBhcmFtIHtPYmplY3R9IGltYWdlOiB7VWludDhBcnJheX0gZGF0YSwge2ludH0gd2lkdGgsIHtpbnR9IGhlaWdodCwge2ludH0gYnl0ZXNcbiAgICogQHBhcmFtIHtpbnR9IHggb2Ygc3RhcnQgcGl4ZWxcbiAgICogQHBhcmFtIHtpbnR9IHkgb2Ygc3RhcnQgcGl4ZWxcbiAgICogQHBhcmFtIHtpbnR9IGNvbG9yIHRocmVzaG9sZFxuICAgKiBAcGFyYW0ge1VpbnQ4QXJyYXl9IG1hc2sgb2YgdmlzaXRlZCBwb2ludHMgKG9wdGlvbmFsKVxuICAgKiBAcmV0dXJuIHtPYmplY3R9IG1hc2s6IHtVaW50OEFycmF5fSBkYXRhLCB7aW50fSB3aWR0aCwge2ludH0gaGVpZ2h0LCB7T2JqZWN0fSBib3VuZHNcbiAgICovXG4gIGxpYi5mbG9vZEZpbGwgPSBmdW5jdGlvbiAoaW1hZ2UsIHB4LCBweSwgY29sb3JUaHJlc2hvbGQsIG9wdGlvbnMsY29sb3IsY2FsbGJhY2spIHtcbiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcbiAgICBvcHRpb25zLmFjdGl2ZU1hc2sgPSBvcHRpb25zLmFjdGl2ZU1hc2sgIHx8IG5ldyBTZWxlY3Rpb25NYXNrKGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQpO1xuXG4gICAgcmV0dXJuIGxpYi5fX2Zsb29kRmlsbCh7ZGF0YTogW2ltYWdlLCBweCwgcHksIGNvbG9yVGhyZXNob2xkLCBvcHRpb25zLCBjb2xvcl19LGNhbGxiYWNrKTtcblxuICAgIC8qXG4gICAgdmFyIHdvcmtlciA9IF8ud29ya2VyKGxpYi5fX2Zsb29kRmlsbCk7XG4gICAgd29ya2VyLm9ubWVzc2FnZSA9IGZ1bmN0aW9uKGUpe1xuICAgICAgdmFyIG1hc2sgPSBuZXcgU2VsZWN0aW9uTWFzayhlLmRhdGEpO1xuICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2sobWFzayk7XG4gICAgfTtcbiAgICB3b3JrZXIucG9zdE1lc3NhZ2UoW2ltYWdlLCBweCwgcHksIGNvbG9yVGhyZXNob2xkLCBvcHRpb25zXSk7XG4qL1xuXG4gIH07XG5cbiAgbGliLnN1YnN0cmFjdCA9IGZ1bmN0aW9uIChtYXNrLCBtYXNrMikge1xuICAgIHZhciBtaW5YLCBtYXhYLCBtaW5ZLCBtYXhZO1xuXG4gICAgdmFyIHJlc3VsdCA9IG5ldyBTZWxlY3Rpb25NYXNrKG1hc2sud2lkdGgsIG1hc2suaGVpZ2h0KTtcbiAgICB2YXIgYm91bmRzID0gbWFzazIuYm91bmRzO1xuXG4gICAgdmFyIG1pblggPSBmYWxzZSwgbWluWSA9IG1hc2suaGVpZ2h0LCBtYXhYID0gZmFsc2UsIG1heFkgPSAtMTtcblxuICAgIGZvciAodmFyIHggPSBib3VuZHMubWluWDsgeCA8PSBib3VuZHMubWF4WDsgeCsrKSB7XG4gICAgICBmb3IgKHZhciB5ID0gYm91bmRzLm1pblk7IHkgPD0gYm91bmRzLm1heFk7IHkrKykge1xuICAgICAgICB2YXIgaW5kZXggPSBtYXNrLndpZHRoICogeSArIHg7XG5cbiAgICAgICAgaWYgKCFtYXNrLmRhdGFbaW5kZXhdICYmIG1hc2syLmRhdGFbaW5kZXhdKSB7XG4gICAgICAgICAgcmVzdWx0LmRhdGFbaW5kZXhdID0gMTtcbiAgICAgICAgICByZXN1bHQuY291bnQrKztcbiAgICAgICAgICBpZiAocmVzdWx0LmJvdW5kcy5taW5ZID4geSlyZXN1bHQuYm91bmRzLm1pblkgPSB5O1xuICAgICAgICAgIGlmIChyZXN1bHQuYm91bmRzLm1heFkgPCB5KXJlc3VsdC5ib3VuZHMubWF4WSA9IHk7XG4gICAgICAgICAgaWYgKHJlc3VsdC5ib3VuZHMubWluWCA+IHgpcmVzdWx0LmJvdW5kcy5taW5YID0geDtcbiAgICAgICAgICBpZiAocmVzdWx0LmJvdW5kcy5tYXhYIDwgeClyZXN1bHQuYm91bmRzLm1heFggPSB4O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIGxpYi5nZXRJbWFnZURhdGEgID0gZnVuY3Rpb24obWl4ZWRUeXBlKXtcbiAgICB2YXIgY2FudmFzO1xuICAgIGlmIChtaXhlZFR5cGUuY29uc3RydWN0b3IubmFtZSA9PSBcIkltYWdlXCIgfHwgbWl4ZWRUeXBlLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJIVE1MSW1hZ2VFbGVtZW50XCIpIHtcbiAgICAgIHZhciBfY2FudmFzID0gY3JlYXRlQ2FudmFzRWxlbWVudCgpO1xuICAgICAgX2NhbnZhcy53aWR0aCA9IG1peGVkVHlwZS53aWR0aDtcbiAgICAgIF9jYW52YXMuaGVpZ2h0ID0gbWl4ZWRUeXBlLmhlaWdodDtcbiAgICAgIHZhciBjdHggPSBfY2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcbiAgICAgIGN0eC5kcmF3SW1hZ2UobWl4ZWRUeXBlLCAwLCAwKTtcbiAgICAgIGNhbnZhcyA9IF9jYW52YXM7XG4gICAgfWVsc2V7XG4gICAgICBjYW52YXMgPSBtaXhlZFR5cGU7XG4gICAgfVxuICAgIGlmIChjYW52YXMuY29uc3RydWN0b3IubmFtZSA9PSBcIkhUTUxDYW52YXNFbGVtZW50XCIgfHwgY2FudmFzLmNvbnN0cnVjdG9yLm5hbWUgPT0gXCJDYW52YXNcIikge1xuICAgICAgdmFyIGltZ0RhdGEgPSBjYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpLmdldEltYWdlRGF0YSgwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpO1xuICAgIH1lbHNle1xuICAgICAgaW1nRGF0YSA9IG1peGVkVHlwZTtcbiAgICB9XG4gICAgcmV0dXJuIGltZ0RhdGE7XG4gIH07XG5cbiAgbGliLmdldENvbG9yZWRQaXhlbHMgPSBmdW5jdGlvbiAobWl4ZWRUeXBlKSB7XG4gICAgdmFyIGltZ0RhdGEgPSBsaWIuZ2V0SW1hZ2VEYXRhKG1peGVkVHlwZSk7XG4gICAgdmFyIGRhdGEgPSBpbWdEYXRhLmRhdGE7XG4gICAgdmFyIHBpeGVscyA9IDA7XG4gICAgZm9yICh2YXIgaSA9IDM7IGkgPCBkYXRhLmxlbmd0aDsgaSArPSA0KSB7XG4gICAgICBpZiAoZGF0YVtpXSkge1xuICAgICAgICBwaXhlbHMrPSBkYXRhW2ldIC8gMjU1O1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcGl4ZWxzO1xuICB9O1xuXG4gIGxpYi5pbnZlcnRNYXNrID0gZnVuY3Rpb24gKG1hc2spIHtcbiAgICB2YXIgcmVzdWx0ID0gbmV3IFNlbGVjdGlvbk1hc2sobWFzay53aWR0aCwgbWFzay5oZWlnaHQpO1xuICAgIHJlc3VsdC5ib3VuZHMgPSB7XG4gICAgICBtaW5YOiBJbmZpbml0eSxcbiAgICAgIG1pblk6IEluZmluaXR5LFxuICAgICAgbWF4WTogLTEsXG4gICAgICBtYXhYOiAtMVxuICAgIH07XG5cblxuICAgIGZvciAodmFyIHggPSAwOyB4IDwgbWFzay53aWR0aDsgeCsrKSB7XG4gICAgICBmb3IgKHZhciB5ID0gMDsgeSA8IG1hc2suaGVpZ2h0OyB5KyspIHtcbiAgICAgICAgdmFyIGluZGV4ID0gbWFzay53aWR0aCAqIHkgKyB4O1xuICAgICAgICBpZiAoIW1hc2suZGF0YVtpbmRleF0pIHtcbiAgICAgICAgICByZXN1bHQuZGF0YVtpbmRleF0gPSAxO1xuICAgICAgICAgIHJlc3VsdC5jb3VudCsrO1xuICAgICAgICAgIGlmIChyZXN1bHQuYm91bmRzLm1pblkgPiB5KXJlc3VsdC5ib3VuZHMubWluWSA9IHk7XG4gICAgICAgICAgaWYgKHJlc3VsdC5ib3VuZHMubWF4WSA8IHkpcmVzdWx0LmJvdW5kcy5tYXhZID0geTtcbiAgICAgICAgICBpZiAocmVzdWx0LmJvdW5kcy5taW5YID4geClyZXN1bHQuYm91bmRzLm1pblggPSB4O1xuICAgICAgICAgIGlmIChyZXN1bHQuYm91bmRzLm1heFggPCB4KXJlc3VsdC5ib3VuZHMubWF4WCA9IHg7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcblxuICBsaWIuZXhjbHVkZSA9IGZ1bmN0aW9uIChtYXNrLCBtYXNrMikge1xuICAgIHZhciByZXN1bHQgPSBuZXcgU2VsZWN0aW9uTWFzayhtYXNrLndpZHRoLCBtYXNrLmhlaWdodCk7XG4gICAgdmFyIGJvdW5kcyA9IHtcbiAgICAgIG1pblg6IE1hdGgubWluKG1hc2suYm91bmRzLm1pblgsIG1hc2syLmJvdW5kcy5taW5YKSxcbiAgICAgIG1heFg6IE1hdGgubWF4KG1hc2suYm91bmRzLm1heFgsIG1hc2syLmJvdW5kcy5tYXhYKSxcbiAgICAgIG1pblk6IE1hdGgubWluKG1hc2suYm91bmRzLm1pblksIG1hc2syLmJvdW5kcy5taW5ZKSxcbiAgICAgIG1heFk6IE1hdGgubWF4KG1hc2suYm91bmRzLm1heFksIG1hc2syLmJvdW5kcy5tYXhZKVxuICAgIH07XG5cbiAgICB2YXIgbWluWCA9IGZhbHNlLCBtaW5ZID0gbWFzay5oZWlnaHQsIG1heFggPSBmYWxzZSwgbWF4WSA9IC0xO1xuXG4gICAgZm9yICh2YXIgeCA9IGJvdW5kcy5taW5YOyB4IDw9IGJvdW5kcy5tYXhYOyB4KyspIHtcbiAgICAgIGZvciAodmFyIHkgPSBib3VuZHMubWluWTsgeSA8PSBib3VuZHMubWF4WTsgeSsrKSB7XG4gICAgICAgIHZhciBpbmRleCA9IG1hc2syLndpZHRoICogeSArIHg7XG5cbiAgICAgICAgaWYgKG1hc2suZGF0YVtpbmRleF0gXiBtYXNrMi5kYXRhW2luZGV4XSkge1xuICAgICAgICAgIHJlc3VsdC5kYXRhW2luZGV4XSA9IDE7XG4gICAgICAgICAgcmVzdWx0LmNvdW50Kys7XG4gICAgICAgICAgbWF4WCA9IHg7XG4gICAgICAgICAgaWYgKG1pblkgPiB5KW1pblkgPSB5O1xuICAgICAgICAgIGlmIChtYXhZIDwgeSltYXhZID0geTtcbiAgICAgICAgICBpZiAobWluWCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgIG1pblggPSB4O1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJlc3VsdC5ib3VuZHMgPSB7XG4gICAgICBtaW5YOiBtaW5YLFxuICAgICAgbWF4WDogbWF4WCxcbiAgICAgIG1pblk6IG1pblksXG4gICAgICBtYXhZOiBtYXhZXG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcblxuICBsaWIuaW50ZXJzZWN0ID0gZnVuY3Rpb24gKG1hc2ssIG1hc2syKSB7XG4gICAgdmFyIG1pblgsIG1heFgsIG1pblksIG1heFk7XG5cbiAgICB2YXIgcmVzdWx0ID0gbmV3IFNlbGVjdGlvbk1hc2sobWFzay53aWR0aCwgbWFzay5oZWlnaHQpO1xuICAgIHZhciBib3VuZHMgPSB7XG4gICAgICBtaW5YOiBNYXRoLm1heChtYXNrLmJvdW5kcy5taW5YLCBtYXNrMi5ib3VuZHMubWluWCksXG4gICAgICBtYXhYOiBNYXRoLm1pbihtYXNrLmJvdW5kcy5tYXhYLCBtYXNrMi5ib3VuZHMubWF4WCksXG4gICAgICBtaW5ZOiBNYXRoLm1heChtYXNrLmJvdW5kcy5taW5ZLCBtYXNrMi5ib3VuZHMubWluWSksXG4gICAgICBtYXhZOiBNYXRoLm1pbihtYXNrLmJvdW5kcy5tYXhZLCBtYXNrMi5ib3VuZHMubWF4WSlcbiAgICB9O1xuXG4gICAgdmFyIG1pblggPSBmYWxzZSwgbWluWSA9IG1hc2suaGVpZ2h0LCBtYXhYID0gZmFsc2UsIG1heFkgPSAtMTtcblxuICAgIGZvciAodmFyIHggPSBib3VuZHMubWluWDsgeCA8PSBib3VuZHMubWF4WDsgeCsrKSB7XG4gICAgICBmb3IgKHZhciB5ID0gYm91bmRzLm1pblk7IHkgPD0gYm91bmRzLm1heFk7IHkrKykge1xuICAgICAgICB2YXIgaW5kZXggPSBtYXNrMi53aWR0aCAqIHkgKyB4O1xuXG4gICAgICAgIGlmIChtYXNrLmRhdGFbaW5kZXhdICYmIG1hc2syLmRhdGFbaW5kZXhdKSB7XG4gICAgICAgICAgcmVzdWx0LmRhdGFbaW5kZXhdID0gMTtcbiAgICAgICAgICByZXN1bHQuY291bnQrKztcbiAgICAgICAgICBtYXhYID0geDtcbiAgICAgICAgICBpZiAobWluWSA+IHkpbWluWSA9IHk7XG4gICAgICAgICAgaWYgKG1heFkgPCB5KW1heFkgPSB5O1xuICAgICAgICAgIGlmIChtaW5YID09PSBmYWxzZSkge1xuICAgICAgICAgICAgbWluWCA9IHg7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmVzdWx0LmJvdW5kcyA9IHtcbiAgICAgIG1pblg6IG1pblgsXG4gICAgICBtYXhYOiBtYXhYLFxuICAgICAgbWluWTogbWluWSxcbiAgICAgIG1heFk6IG1heFlcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuXG4gIGxpYi5hZGQgPSBmdW5jdGlvbiAobWFzaywgbWFzazIpIHtcbiAgICB2YXIgcmVzdWx0ID0gbmV3IFNlbGVjdGlvbk1hc2sobWFzay53aWR0aCwgbWFzay5oZWlnaHQpO1xuXG4gICAgcmVzdWx0LmJvdW5kcyA9IHtcbiAgICAgIG1pblg6IE1hdGgubWluKG1hc2suYm91bmRzLm1pblgsIG1hc2syLmJvdW5kcy5taW5YKSxcbiAgICAgIG1heFg6IE1hdGgubWF4KG1hc2suYm91bmRzLm1heFgsIG1hc2syLmJvdW5kcy5tYXhYKSxcbiAgICAgIG1pblk6IE1hdGgubWluKG1hc2suYm91bmRzLm1pblksIG1hc2syLmJvdW5kcy5taW5ZKSxcbiAgICAgIG1heFk6IE1hdGgubWF4KG1hc2suYm91bmRzLm1heFksIG1hc2syLmJvdW5kcy5tYXhZKVxuICAgIH07XG5cbiAgICBmb3IgKHZhciB4ID0gcmVzdWx0LmJvdW5kcy5taW5YOyB4IDw9IHJlc3VsdC5ib3VuZHMubWF4WDsgeCsrKSB7XG4gICAgICBmb3IgKHZhciB5ID0gcmVzdWx0LmJvdW5kcy5taW5ZOyB5IDw9IHJlc3VsdC5ib3VuZHMubWF4WTsgeSsrKSB7XG4gICAgICAgIHZhciBpbmRleCA9IG1hc2syLndpZHRoICogeSArIHg7XG5cbiAgICAgICAgaWYgKG1hc2suZGF0YVtpbmRleF0gfHwgbWFzazIuZGF0YVtpbmRleF0pIHtcbiAgICAgICAgICByZXN1bHQuZGF0YVtpbmRleF0gPSAxO1xuICAgICAgICAgIHJlc3VsdC5jb3VudCsrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcblxuICAvKiogQXBwbHkgdGhlIGdhdXNzLWJsdXIgZmlsdGVyIHRvIGJpbmFyeSBtYXNrXG4gICAqIEFsZ29yaXRobXM6IGh0dHA6Ly9ibG9nLml2YW5rLm5ldC9mYXN0ZXN0LWdhdXNzaWFuLWJsdXIuaHRtbFxuICAgKiBodHRwOi8vd3d3LmxpYnJvdy5jb20vYXJ0aWNsZXMvYXJ0aWNsZS05XG4gICAqIGh0dHA6Ly9lbHlueHNkay5mcmVlLmZyL2V4dC1kb2NzL0JsdXIvRmFzdF9ib3hfYmx1ci5wZGZcbiAgICogQHBhcmFtIHtPYmplY3R9IG1hc2s6IHtVaW50OEFycmF5fSBkYXRhLCB7aW50fSB3aWR0aCwge2ludH0gaGVpZ2h0LCB7T2JqZWN0fSBib3VuZHNcbiAgICogQHBhcmFtIHtpbnR9IGJsdXIgcmFkaXVzXG4gICAqIEByZXR1cm4ge09iamVjdH0gbWFzazoge1VpbnQ4QXJyYXl9IGRhdGEsIHtpbnR9IHdpZHRoLCB7aW50fSBoZWlnaHQsIHtPYmplY3R9IGJvdW5kc1xuICAgKi9cbiAgbGliLmdhdXNzQmx1ciA9IGZ1bmN0aW9uIChtYXNrLCByYWRpdXMpIHtcblxuICAgIHZhciBpLCBrLCBrMSwgeCwgeSwgdmFsLCBzdGFydCwgZW5kLFxuICAgICAgbiA9IHJhZGl1cyAqIDIgKyAxLCAvLyBzaXplIG9mIHRoZSBwYXR0ZXJuIGZvciByYWRpdXMtbmVpZ2hib3JzIChmcm9tIC1yIHRvICtyIHdpdGggdGhlIGNlbnRlciBwb2ludClcbiAgICAgIHMyID0gcmFkaXVzICogcmFkaXVzLFxuICAgICAgd2cgPSBuZXcgRmxvYXQzMkFycmF5KG4pLCAvLyB3ZWlnaHRzXG4gICAgICB0b3RhbCA9IDAsIC8vIHN1bSBvZiB3ZWlnaHRzKHVzZWQgZm9yIG5vcm1hbGl6YXRpb24pXG4gICAgICB3ID0gbWFzay53aWR0aCxcbiAgICAgIGggPSBtYXNrLmhlaWdodCxcbiAgICAgIGRhdGEgPSBtYXNrLmRhdGEsXG4gICAgICBtaW5YID0gbWFzay5ib3VuZHMubWluWCxcbiAgICAgIG1heFggPSBtYXNrLmJvdW5kcy5tYXhYLFxuICAgICAgbWluWSA9IG1hc2suYm91bmRzLm1pblksXG4gICAgICBtYXhZID0gbWFzay5ib3VuZHMubWF4WSxcbiAgICAgIGNvdW50ID0gMDtcblxuICAgIC8vIGNhbGMgZ2F1c3Mgd2VpZ2h0c1xuICAgIGZvciAoaSA9IDA7IGkgPCByYWRpdXM7IGkrKykge1xuICAgICAgdmFyIGRzcSA9IChyYWRpdXMgLSBpKSAqIChyYWRpdXMgLSBpKTtcbiAgICAgIHZhciB3dyA9IE1hdGguZXhwKC1kc3EgLyAoMi4wICogczIpKSAvICgyICogTWF0aC5QSSAqIHMyKTtcbiAgICAgIHdnW3JhZGl1cyArIGldID0gd2dbcmFkaXVzIC0gaV0gPSB3dztcbiAgICAgIHRvdGFsICs9IDIgKiB3dztcbiAgICB9XG4gICAgLy8gbm9ybWFsaXphdGlvbiB3ZWlnaHRzXG4gICAgZm9yIChpID0gMDsgaSA8IG47IGkrKykge1xuICAgICAgd2dbaV0gLz0gdG90YWw7XG4gICAgfVxuXG4gICAgdmFyIHJlc3VsdCA9IG5ldyBVaW50OEFycmF5KHcgKiBoKSwgLy8gcmVzdWx0IG1hc2tcbiAgICAgIGVuZFggPSByYWRpdXMgKyB3LFxuICAgICAgZW5kWSA9IHJhZGl1cyArIGg7XG5cbiAgICAvL3dhbGsgdGhyb3VnaCBhbGwgc291cmNlIHBvaW50cyBmb3IgYmx1clxuICAgIGZvciAoeSA9IG1pblk7IHkgPCBtYXhZICsgMTsgeSsrKVxuICAgICAgZm9yICh4ID0gbWluWDsgeCA8IG1heFggKyAxOyB4KyspIHtcbiAgICAgICAgdmFsID0gMDtcbiAgICAgICAgayA9IHkgKiB3ICsgeDsgLy8gaW5kZXggb2YgdGhlIHBvaW50XG4gICAgICAgIHN0YXJ0ID0gcmFkaXVzIC0geCA+IDAgPyByYWRpdXMgLSB4IDogMDtcbiAgICAgICAgZW5kID0gZW5kWCAtIHggPCBuID8gZW5kWCAtIHggOiBuOyAvLyBNYXRoLm1pbigoKCh3IC0gMSkgLSB4KSArIHJhZGl1cykgKyAxLCBuKTtcbiAgICAgICAgazEgPSBrIC0gcmFkaXVzO1xuICAgICAgICAvLyB3YWxrIHRocm91Z2ggeC1uZWlnaGJvcnNcbiAgICAgICAgZm9yIChpID0gc3RhcnQ7IGkgPCBlbmQ7IGkrKykge1xuICAgICAgICAgIHZhbCArPSBkYXRhW2sxICsgaV0gKiB3Z1tpXTtcbiAgICAgICAgfVxuICAgICAgICBzdGFydCA9IHJhZGl1cyAtIHkgPiAwID8gcmFkaXVzIC0geSA6IDA7XG4gICAgICAgIGVuZCA9IGVuZFkgLSB5IDwgbiA/IGVuZFkgLSB5IDogbjsgLy8gTWF0aC5taW4oKCgoaCAtIDEpIC0geSkgKyByYWRpdXMpICsgMSwgbik7XG4gICAgICAgIGsxID0gayAtIHJhZGl1cyAqIHc7XG4gICAgICAgIC8vIHdhbGsgdGhyb3VnaCB5LW5laWdoYm9yc1xuICAgICAgICBmb3IgKGkgPSBzdGFydDsgaSA8IGVuZDsgaSsrKSB7XG4gICAgICAgICAgdmFsICs9IGRhdGFbazEgKyBpICogd10gKiB3Z1tpXTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodmFsID4gMC41KSB7XG4gICAgICAgICAgcmVzdWx0W2tdID0gMTtcbiAgICAgICAgICBjb3VudCsrO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlc3VsdFtrXSA9IDA7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICBjb3VudDogY291bnQsXG4gICAgICBkYXRhOiByZXN1bHQsXG4gICAgICB3aWR0aDogdyxcbiAgICAgIGhlaWdodDogaCxcbiAgICAgIGJvdW5kczoge1xuICAgICAgICBtaW5YOiBtaW5YLFxuICAgICAgICBtaW5ZOiBtaW5ZLFxuICAgICAgICBtYXhYOiBtYXhYLFxuICAgICAgICBtYXhZOiBtYXhZXG4gICAgICB9XG4gICAgfTtcbiAgfTtcblxuICAvKiogQ3JlYXRlIGEgYm9yZGVyIGluZGV4IGFycmF5IG9mIGJvdW5kYXJ5IHBvaW50cyBvZiB0aGUgbWFzayB3aXRoIHJhZGl1cy1uZWlnaGJvcnNcbiAgICogQHBhcmFtIHtPYmplY3R9IG1hc2s6IHtVaW50OEFycmF5fSBkYXRhLCB7aW50fSB3aWR0aCwge2ludH0gaGVpZ2h0LCB7T2JqZWN0fSBib3VuZHNcbiAgICogQHBhcmFtIHtpbnR9IHJhZGl1czogYmx1ciByYWRpdXNcbiAgICogQHBhcmFtIHtVaW50OEFycmF5fSB2aXNpdGVkOiBtYXNrIG9mIHZpc2l0ZWQgcG9pbnRzIChvcHRpb25hbClcbiAgICogQHJldHVybiB7QXJyYXl9IGJvcmRlciBpbmRleCBhcnJheSBvZiBib3VuZGFyeSBwb2ludHMgd2l0aCByYWRpdXMtbmVpZ2hib3JzIChvbmx5IHBvaW50cyBuZWVkIGZvciBibHVyKVxuICAgKi9cbiAgZnVuY3Rpb24gY3JlYXRlQm9yZGVyRm9yQmx1cihtYXNrLCByYWRpdXMsIHZpc2l0ZWQpIHtcblxuICAgIHZhciB4LCBpLCBqLCB5LCBrLCBrMSwgazIsXG4gICAgICB3ID0gbWFzay53aWR0aCxcbiAgICAgIGggPSBtYXNrLmhlaWdodCxcbiAgICAgIGRhdGEgPSBtYXNrLmRhdGEsXG4gICAgICB2aXNpdGVkRGF0YSA9IG5ldyBVaW50OEFycmF5KGRhdGEpLFxuICAgICAgbWluWCA9IG1hc2suYm91bmRzLm1pblgsXG4gICAgICBtYXhYID0gbWFzay5ib3VuZHMubWF4WCxcbiAgICAgIG1pblkgPSBtYXNrLmJvdW5kcy5taW5ZLFxuICAgICAgbWF4WSA9IG1hc2suYm91bmRzLm1heFksXG4gICAgICBsZW4gPSB3ICogaCxcbiAgICAgIHRlbXAgPSBuZXcgVWludDhBcnJheShsZW4pLCAvLyBhdXhpbGlhcnkgYXJyYXkgdG8gY2hlY2sgdW5pcXVlbmVzc1xuICAgICAgYm9yZGVyID0gW10sIC8vIG9ubHkgYm9yZGVyIHBvaW50c1xuICAgICAgeDAgPSBNYXRoLm1heChtaW5YLCAxKSxcbiAgICAgIHgxID0gTWF0aC5taW4obWF4WCwgdyAtIDIpLFxuICAgICAgeTAgPSBNYXRoLm1heChtaW5ZLCAxKSxcbiAgICAgIHkxID0gTWF0aC5taW4obWF4WSwgaCAtIDIpO1xuXG4gICAgaWYgKHZpc2l0ZWQgJiYgdmlzaXRlZC5sZW5ndGggPiAwKSB7XG4gICAgICAvLyBjb3B5IHZpc2l0ZWQgcG9pbnRzIChvbmx5IFwiYmxhY2tcIilcbiAgICAgIGZvciAoayA9IDA7IGsgPCBsZW47IGsrKykge1xuICAgICAgICBpZiAodmlzaXRlZFtrXSA9PT0gMSkgdmlzaXRlZERhdGFba10gPSAxO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIHdhbGsgdGhyb3VnaCBpbm5lciB2YWx1ZXMgZXhjZXB0IHBvaW50cyBvbiB0aGUgYm91bmRhcnkgb2YgdGhlIGltYWdlXG4gICAgZm9yICh5ID0geTA7IHkgPCB5MSArIDE7IHkrKylcbiAgICAgIGZvciAoeCA9IHgwOyB4IDwgeDEgKyAxOyB4KyspIHtcbiAgICAgICAgayA9IHkgKiB3ICsgeDtcbiAgICAgICAgaWYgKGRhdGFba10gPT09IDApIGNvbnRpbnVlOyAvLyBcIndoaXRlXCIgcG9pbnQgaXNuJ3QgdGhlIGJvcmRlclxuICAgICAgICBrMSA9IGsgKyB3OyAvLyB5ICsgMVxuICAgICAgICBrMiA9IGsgLSB3OyAvLyB5IC0gMVxuICAgICAgICAvLyBjaGVjayBpZiBhbnkgbmVpZ2hib3Igd2l0aCBhIFwid2hpdGVcIiBjb2xvclxuICAgICAgICBpZiAodmlzaXRlZERhdGFbayArIDFdID09PSAwIHx8IHZpc2l0ZWREYXRhW2sgLSAxXSA9PT0gMCB8fFxuICAgICAgICAgIHZpc2l0ZWREYXRhW2sxXSA9PT0gMCB8fCB2aXNpdGVkRGF0YVtrMSArIDFdID09PSAwIHx8IHZpc2l0ZWREYXRhW2sxIC0gMV0gPT09IDAgfHxcbiAgICAgICAgICB2aXNpdGVkRGF0YVtrMl0gPT09IDAgfHwgdmlzaXRlZERhdGFbazIgKyAxXSA9PT0gMCB8fCB2aXNpdGVkRGF0YVtrMiAtIDFdID09PSAwKSB7XG4gICAgICAgICAgLy9pZiAodmlzaXRlZERhdGFbayArIDFdICsgdmlzaXRlZERhdGFbayAtIDFdICtcbiAgICAgICAgICAvLyAgICB2aXNpdGVkRGF0YVtrMV0gKyB2aXNpdGVkRGF0YVtrMSArIDFdICsgdmlzaXRlZERhdGFbazEgLSAxXSArXG4gICAgICAgICAgLy8gICAgdmlzaXRlZERhdGFbazJdICsgdmlzaXRlZERhdGFbazIgKyAxXSArIHZpc2l0ZWREYXRhW2syIC0gMV0gPT0gOCkgY29udGludWU7XG4gICAgICAgICAgYm9yZGVyLnB1c2goayk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgIC8vIHdhbGsgdGhyb3VnaCBwb2ludHMgb24gdGhlIGJvdW5kYXJ5IG9mIHRoZSBpbWFnZSBpZiBuZWNlc3NhcnlcbiAgICAvLyBpZiB0aGUgXCJibGFja1wiIHBvaW50IGlzIGFkamFjZW50IHRvIHRoZSBib3VuZGFyeSBvZiB0aGUgaW1hZ2UsIGl0IGlzIGEgYm9yZGVyIHBvaW50XG4gICAgaWYgKG1pblggPT0gMClcbiAgICAgIGZvciAoeSA9IG1pblk7IHkgPCBtYXhZICsgMTsgeSsrKVxuICAgICAgICBpZiAoZGF0YVt5ICogd10gPT09IDEpXG4gICAgICAgICAgYm9yZGVyLnB1c2goeSAqIHcpO1xuXG4gICAgaWYgKG1heFggPT0gdyAtIDEpXG4gICAgICBmb3IgKHkgPSBtaW5ZOyB5IDwgbWF4WSArIDE7IHkrKylcbiAgICAgICAgaWYgKGRhdGFbeSAqIHcgKyBtYXhYXSA9PT0gMSlcbiAgICAgICAgICBib3JkZXIucHVzaCh5ICogdyArIG1heFgpO1xuXG4gICAgaWYgKG1pblkgPT0gMClcbiAgICAgIGZvciAoeCA9IG1pblg7IHggPCBtYXhYICsgMTsgeCsrKVxuICAgICAgICBpZiAoZGF0YVt4XSA9PT0gMSlcbiAgICAgICAgICBib3JkZXIucHVzaCh4KTtcblxuICAgIGlmIChtYXhZID09IGggLSAxKVxuICAgICAgZm9yICh4ID0gbWluWDsgeCA8IG1heFggKyAxOyB4KyspXG4gICAgICAgIGlmIChkYXRhW21heFkgKiB3ICsgeF0gPT09IDEpXG4gICAgICAgICAgYm9yZGVyLnB1c2gobWF4WSAqIHcgKyB4KTtcblxuICAgIHZhciByZXN1bHQgPSBbXSwgLy8gYm9yZGVyIHBvaW50cyB3aXRoIHJhZGl1cy1uZWlnaGJvcnNcbiAgICAgIHN0YXJ0LCBlbmQsXG4gICAgICBlbmRYID0gcmFkaXVzICsgdyxcbiAgICAgIGVuZFkgPSByYWRpdXMgKyBoLFxuICAgICAgbiA9IHJhZGl1cyAqIDIgKyAxOyAvLyBzaXplIG9mIHRoZSBwYXR0ZXJuIGZvciByYWRpdXMtbmVpZ2hib3JzIChmcm9tIC1yIHRvICtyIHdpdGggdGhlIGNlbnRlciBwb2ludClcblxuICAgIGxlbiA9IGJvcmRlci5sZW5ndGg7XG4gICAgLy8gd2FsayB0aHJvdWdoIHJhZGl1cy1uZWlnaGJvcnMgb2YgYm9yZGVyIHBvaW50cyBhbmQgYWRkIHRoZW0gdG8gdGhlIHJlc3VsdCBhcnJheVxuICAgIGZvciAoaiA9IDA7IGogPCBsZW47IGorKykge1xuICAgICAgayA9IGJvcmRlcltqXTsgLy8gaW5kZXggb2YgdGhlIGJvcmRlciBwb2ludFxuICAgICAgdGVtcFtrXSA9IDE7IC8vIG1hcmsgYm9yZGVyIHBvaW50XG4gICAgICByZXN1bHQucHVzaChrKTsgLy8gc2F2ZSB0aGUgYm9yZGVyIHBvaW50XG4gICAgICB4ID0gayAlIHc7IC8vIGNhbGMgeCBieSBpbmRleFxuICAgICAgeSA9IChrIC0geCkgLyB3OyAvLyBjYWxjIHkgYnkgaW5kZXhcbiAgICAgIHN0YXJ0ID0gcmFkaXVzIC0geCA+IDAgPyByYWRpdXMgLSB4IDogMDtcbiAgICAgIGVuZCA9IGVuZFggLSB4IDwgbiA/IGVuZFggLSB4IDogbjsgLy8gTWF0aC5taW4oKCgodyAtIDEpIC0geCkgKyByYWRpdXMpICsgMSwgbik7XG4gICAgICBrMSA9IGsgLSByYWRpdXM7XG4gICAgICAvLyB3YWxrIHRocm91Z2ggeC1uZWlnaGJvcnNcbiAgICAgIGZvciAoaSA9IHN0YXJ0OyBpIDwgZW5kOyBpKyspIHtcbiAgICAgICAgazIgPSBrMSArIGk7XG4gICAgICAgIGlmICh0ZW1wW2syXSA9PT0gMCkgeyAvLyBjaGVjayB0aGUgdW5pcXVlbmVzc1xuICAgICAgICAgIHRlbXBbazJdID0gMTtcbiAgICAgICAgICByZXN1bHQucHVzaChrMik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHN0YXJ0ID0gcmFkaXVzIC0geSA+IDAgPyByYWRpdXMgLSB5IDogMDtcbiAgICAgIGVuZCA9IGVuZFkgLSB5IDwgbiA/IGVuZFkgLSB5IDogbjsgLy8gTWF0aC5taW4oKCgoaCAtIDEpIC0geSkgKyByYWRpdXMpICsgMSwgbik7XG4gICAgICBrMSA9IGsgLSByYWRpdXMgKiB3O1xuICAgICAgLy8gd2FsayB0aHJvdWdoIHktbmVpZ2hib3JzXG4gICAgICBmb3IgKGkgPSBzdGFydDsgaSA8IGVuZDsgaSsrKSB7XG4gICAgICAgIGsyID0gazEgKyBpICogdztcbiAgICAgICAgaWYgKHRlbXBbazJdID09PSAwKSB7IC8vIGNoZWNrIHRoZSB1bmlxdWVuZXNzXG4gICAgICAgICAgdGVtcFtrMl0gPSAxO1xuICAgICAgICAgIHJlc3VsdC5wdXNoKGsyKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG5cbiAgLyoqIEFwcGx5IHRoZSBnYXVzcy1ibHVyIGZpbHRlciBPTkxZIHRvIGJvcmRlciBwb2ludHMgd2l0aCByYWRpdXMtbmVpZ2hib3JzXG4gICAqIEFsZ29yaXRobXM6IGh0dHA6Ly9ibG9nLml2YW5rLm5ldC9mYXN0ZXN0LWdhdXNzaWFuLWJsdXIuaHRtbFxuICAgKiBodHRwOi8vd3d3LmxpYnJvdy5jb20vYXJ0aWNsZXMvYXJ0aWNsZS05XG4gICAqIGh0dHA6Ly9lbHlueHNkay5mcmVlLmZyL2V4dC1kb2NzL0JsdXIvRmFzdF9ib3hfYmx1ci5wZGZcbiAgICogQHBhcmFtICB7T2JqZWN0fSAgICAgbWFzazogICAgIHtVaW50OEFycmF5fSBkYXRhLCB7aW50fSB3aWR0aCwge2ludH0gaGVpZ2h0LCB7T2JqZWN0fSBib3VuZHNcbiAgICogQHBhcmFtICB7aW50fSAgICAgICAgcmFkaXVzOiAgIGJsdXIgcmFkaXVzXG4gICAqIEBwYXJhbSAge1VpbnQ4QXJyYXl9IHZpc2l0ZWQ6ICBtYXNrIG9mIHZpc2l0ZWQgcG9pbnRzIChvcHRpb25hbClcbiAgICogQHJldHVybiB7T2JqZWN0fSAgICAgbWFzazogICAgIHtVaW50OEFycmF5fSBkYXRhLCB7aW50fSB3aWR0aCwge2ludH0gaGVpZ2h0LCB7T2JqZWN0fSBib3VuZHNcbiAgICovXG4gIGxpYi5nYXVzc0JsdXJPbmx5Qm9yZGVyID0gZnVuY3Rpb24gKG1hc2ssIHJhZGl1cywgdmlzaXRlZCkge1xuXG4gICAgdmFyIGJvcmRlciA9IGNyZWF0ZUJvcmRlckZvckJsdXIobWFzaywgcmFkaXVzLCB2aXNpdGVkKSwgLy8gZ2V0IGJvcmRlciBwb2ludHMgd2l0aCByYWRpdXMtbmVpZ2hib3JzXG4gICAgICB3dywgZHNxLCBpLCBqLCBrLCBrMSwgeCwgeSwgdmFsLCBzdGFydCwgZW5kLFxuICAgICAgbiA9IHJhZGl1cyAqIDIgKyAxLCAvLyBzaXplIG9mIHRoZSBwYXR0ZXJuIGZvciByYWRpdXMtbmVpZ2hib3JzIChmcm9tIC1yIHRvICtyIHdpdGggY2VudGVyIHBvaW50KVxuICAgICAgczIgPSAyICogcmFkaXVzICogcmFkaXVzLFxuICAgICAgd2cgPSBuZXcgRmxvYXQzMkFycmF5KG4pLCAvLyB3ZWlnaHRzXG4gICAgICB0b3RhbCA9IDAsIC8vIHN1bSBvZiB3ZWlnaHRzKHVzZWQgZm9yIG5vcm1hbGl6YXRpb24pXG4gICAgICB3ID0gbWFzay53aWR0aCxcbiAgICAgIGggPSBtYXNrLmhlaWdodCxcbiAgICAgIGRhdGEgPSBtYXNrLmRhdGEsXG4gICAgICBtaW5YID0gbWFzay5ib3VuZHMubWluWCxcbiAgICAgIG1heFggPSBtYXNrLmJvdW5kcy5tYXhYLFxuICAgICAgbWluWSA9IG1hc2suYm91bmRzLm1pblksXG4gICAgICBtYXhZID0gbWFzay5ib3VuZHMubWF4WSxcbiAgICAgIGxlbiA9IGJvcmRlci5sZW5ndGg7XG5cbiAgICAvLyBjYWxjIGdhdXNzIHdlaWdodHNcbiAgICBmb3IgKGkgPSAwOyBpIDwgcmFkaXVzOyBpKyspIHtcbiAgICAgIGRzcSA9IChyYWRpdXMgLSBpKSAqIChyYWRpdXMgLSBpKTtcbiAgICAgIHd3ID0gTWF0aC5leHAoLWRzcSAvIHMyKSAvIE1hdGguUEk7XG4gICAgICB3Z1tyYWRpdXMgKyBpXSA9IHdnW3JhZGl1cyAtIGldID0gd3c7XG4gICAgICB0b3RhbCArPSAyICogd3c7XG4gICAgfVxuICAgIC8vIG5vcm1hbGl6YXRpb24gd2VpZ2h0c1xuICAgIGZvciAoaSA9IDA7IGkgPCBuOyBpKyspIHtcbiAgICAgIHdnW2ldIC89IHRvdGFsO1xuICAgIH1cblxuICAgIHZhciByZXN1bHQgPSBuZXcgU2VsZWN0aW9uTWFzayh3LGgsZGF0YSksIC8vIGNvcHkgdGhlIHNvdXJjZSBtYXNrXG4gICAgICBlbmRYID0gcmFkaXVzICsgdyxcbiAgICAgIGVuZFkgPSByYWRpdXMgKyBoO1xuXG4gICAgLy93YWxrIHRocm91Z2ggYWxsIGJvcmRlciBwb2ludHMgZm9yIGJsdXJcbiAgICBmb3IgKGkgPSAwOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgIGsgPSBib3JkZXJbaV07IC8vIGluZGV4IG9mIHRoZSBib3JkZXIgcG9pbnRcbiAgICAgIHZhbCA9IDA7XG4gICAgICB4ID0gayAlIHc7IC8vIGNhbGMgeCBieSBpbmRleFxuICAgICAgeSA9IChrIC0geCkgLyB3OyAvLyBjYWxjIHkgYnkgaW5kZXhcbiAgICAgIHN0YXJ0ID0gcmFkaXVzIC0geCA+IDAgPyByYWRpdXMgLSB4IDogMDtcbiAgICAgIGVuZCA9IGVuZFggLSB4IDwgbiA/IGVuZFggLSB4IDogbjsgLy8gTWF0aC5taW4oKCgodyAtIDEpIC0geCkgKyByYWRpdXMpICsgMSwgbik7XG4gICAgICBrMSA9IGsgLSByYWRpdXM7XG4gICAgICAvLyB3YWxrIHRocm91Z2ggeC1uZWlnaGJvcnNcbiAgICAgIGZvciAoaiA9IHN0YXJ0OyBqIDwgZW5kOyBqKyspIHtcbiAgICAgICAgdmFsICs9IGRhdGFbazEgKyBqXSAqIHdnW2pdO1xuICAgICAgfVxuICAgICAgaWYgKHZhbCA+IDAuNSkge1xuICAgICAgICByZXN1bHQuZGF0YVtrXSA9IDE7XG4gICAgICAgIHJlc3VsdC5jb3VudCsrO1xuICAgICAgICAvLyBjaGVjayBtaW5tYXhcbiAgICAgICAgaWYgKHggPCBtaW5YKSBtaW5YID0geDtcbiAgICAgICAgaWYgKHggPiBtYXhYKSBtYXhYID0geDtcbiAgICAgICAgaWYgKHkgPCBtaW5ZKSBtaW5ZID0geTtcbiAgICAgICAgaWYgKHkgPiBtYXhZKSBtYXhZID0geTtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBzdGFydCA9IHJhZGl1cyAtIHkgPiAwID8gcmFkaXVzIC0geSA6IDA7XG4gICAgICBlbmQgPSBlbmRZIC0geSA8IG4gPyBlbmRZIC0geSA6IG47IC8vIE1hdGgubWluKCgoKGggLSAxKSAtIHkpICsgcmFkaXVzKSArIDEsIG4pO1xuICAgICAgazEgPSBrIC0gcmFkaXVzICogdztcbiAgICAgIC8vIHdhbGsgdGhyb3VnaCB5LW5laWdoYm9yc1xuICAgICAgZm9yIChqID0gc3RhcnQ7IGogPCBlbmQ7IGorKykge1xuICAgICAgICB2YWwgKz0gZGF0YVtrMSArIGogKiB3XSAqIHdnW2pdO1xuICAgICAgfVxuICAgICAgaWYgKHZhbCA+IDAuNSkge1xuICAgICAgICByZXN1bHQuZGF0YVtrXSA9IDE7XG4gICAgICAgIHJlc3VsdC5jb3VudCsrO1xuICAgICAgICAvLyBjaGVjayBtaW5tYXhcbiAgICAgICAgaWYgKHggPCBtaW5YKSBtaW5YID0geDtcbiAgICAgICAgaWYgKHggPiBtYXhYKSBtYXhYID0geDtcbiAgICAgICAgaWYgKHkgPCBtaW5ZKSBtaW5ZID0geTtcbiAgICAgICAgaWYgKHkgPiBtYXhZKSBtYXhZID0geTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlc3VsdC5kYXRhW2tdID0gMDtcbiAgICAgIH1cbiAgICB9XG4gICAgcmVzdWx0LmJvdW5kcyA9IHtcbiAgICAgIG1pblg6IG1pblgsXG4gICAgICBtaW5ZOiBtaW5ZLFxuICAgICAgbWF4WDogbWF4WCxcbiAgICAgIG1heFk6IG1heFlcbiAgICB9O1xuXG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcblxuICAvKiogQ3JlYXRlIGEgYm9yZGVyIG1hc2sgKG9ubHkgYm91bmRhcnkgcG9pbnRzKVxuICAgKiBAcGFyYW0ge09iamVjdH0gbWFzazoge1VpbnQ4QXJyYXl9IGRhdGEsIHtpbnR9IHdpZHRoLCB7aW50fSBoZWlnaHQsIHtPYmplY3R9IGJvdW5kc1xuICAgKiBAcmV0dXJuIHtPYmplY3R9IGJvcmRlciBtYXNrOiB7VWludDhBcnJheX0gZGF0YSwge2ludH0gd2lkdGgsIHtpbnR9IGhlaWdodCwge09iamVjdH0gb2Zmc2V0XG4gICAqL1xuICBsaWIuY3JlYXRlQm9yZGVyTWFzayA9IGZ1bmN0aW9uIChtYXNrKSB7XG5cbiAgICB2YXIgeCwgeSwgaywgazEsIGsyLFxuICAgICAgdyA9IG1hc2sud2lkdGgsXG4gICAgICBoID0gbWFzay5oZWlnaHQsXG4gICAgICBkYXRhID0gbWFzay5kYXRhLFxuICAgICAgbWluWCA9IG1hc2suYm91bmRzLm1pblgsXG4gICAgICBtYXhYID0gbWFzay5ib3VuZHMubWF4WCxcbiAgICAgIG1pblkgPSBtYXNrLmJvdW5kcy5taW5ZLFxuICAgICAgbWF4WSA9IG1hc2suYm91bmRzLm1heFksXG4gICAgICBydyA9IG1heFggLSBtaW5YICsgMSwgLy8gYm91bmRzIHNpemVcbiAgICAgIHJoID0gbWF4WSAtIG1pblkgKyAxLFxuICAgICAgcmVzdWx0ID0gbmV3IFVpbnQ4QXJyYXkocncgKiByaCksIC8vIHJlZHVjZWQgbWFzayAoYm91bmRzIHNpemUpXG4gICAgICB4MCA9IE1hdGgubWF4KG1pblgsIDEpLFxuICAgICAgeDEgPSBNYXRoLm1pbihtYXhYLCB3IC0gMiksXG4gICAgICB5MCA9IE1hdGgubWF4KG1pblksIDEpLFxuICAgICAgeTEgPSBNYXRoLm1pbihtYXhZLCBoIC0gMiksXG4gICAgICBjb3VudCA9IDA7XG5cbiAgICAvLyB3YWxrIHRocm91Z2ggaW5uZXIgdmFsdWVzIGV4Y2VwdCBwb2ludHMgb24gdGhlIGJvdW5kYXJ5IG9mIHRoZSBpbWFnZVxuICAgIGZvciAoeSA9IHkwOyB5IDwgeTEgKyAxOyB5KyspXG4gICAgICBmb3IgKHggPSB4MDsgeCA8IHgxICsgMTsgeCsrKSB7XG4gICAgICAgIGsgPSB5ICogdyArIHg7XG4gICAgICAgIGlmIChkYXRhW2tdID09PSAwKSBjb250aW51ZTsgLy8gXCJ3aGl0ZVwiIHBvaW50IGlzbid0IHRoZSBib3JkZXJcbiAgICAgICAgazEgPSBrICsgdzsgLy8geSArIDFcbiAgICAgICAgazIgPSBrIC0gdzsgLy8geSAtIDFcbiAgICAgICAgLy8gY2hlY2sgaWYgYW55IG5laWdoYm9yIHdpdGggYSBcIndoaXRlXCIgY29sb3JcbiAgICAgICAgaWYgKGRhdGFbayArIDFdID09PSAwIHx8IGRhdGFbayAtIDFdID09PSAwIHx8XG4gICAgICAgICAgZGF0YVtrMV0gPT09IDAgfHwgZGF0YVtrMSArIDFdID09PSAwIHx8IGRhdGFbazEgLSAxXSA9PT0gMCB8fFxuICAgICAgICAgIGRhdGFbazJdID09PSAwIHx8IGRhdGFbazIgKyAxXSA9PT0gMCB8fCBkYXRhW2syIC0gMV0gPT09IDApIHtcbiAgICAgICAgICAvL2lmIChkYXRhW2sgKyAxXSArIGRhdGFbayAtIDFdICtcbiAgICAgICAgICAvLyAgICBkYXRhW2sxXSArIGRhdGFbazEgKyAxXSArIGRhdGFbazEgLSAxXSArXG4gICAgICAgICAgLy8gICAgZGF0YVtrMl0gKyBkYXRhW2syICsgMV0gKyBkYXRhW2syIC0gMV0gPT0gOCkgY29udGludWU7XG4gICAgICAgICAgcmVzdWx0Wyh5IC0gbWluWSkgKiBydyArICh4IC0gbWluWCldID0gMTtcbiAgICAgICAgICBjb3VudCsrO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAvLyB3YWxrIHRocm91Z2ggcG9pbnRzIG9uIHRoZSBib3VuZGFyeSBvZiB0aGUgaW1hZ2UgaWYgbmVjZXNzYXJ5XG4gICAgLy8gaWYgdGhlIFwiYmxhY2tcIiBwb2ludCBpcyBhZGphY2VudCB0byB0aGUgYm91bmRhcnkgb2YgdGhlIGltYWdlLCBpdCBpcyBhIGJvcmRlciBwb2ludFxuICAgIGlmIChtaW5YID09IDApXG4gICAgICBmb3IgKHkgPSBtaW5ZOyB5IDwgbWF4WSArIDE7IHkrKylcbiAgICAgICAgaWYgKGRhdGFbeSAqIHddID09PSAxKSB7XG4gICAgICAgICAgcmVzdWx0Wyh5IC0gbWluWSkgKiByd10gPSAxO1xuICAgICAgICAgIGNvdW50Kys7XG4gICAgICAgIH1cblxuICAgIGlmIChtYXhYID09IHcgLSAxKVxuICAgICAgZm9yICh5ID0gbWluWTsgeSA8IG1heFkgKyAxOyB5KyspXG4gICAgICAgIGlmIChkYXRhW3kgKiB3ICsgbWF4WF0gPT09IDEpIHtcbiAgICAgICAgICByZXN1bHRbKHkgLSBtaW5ZKSAqIHJ3ICsgKG1heFggLSBtaW5YKV0gPSAxO1xuICAgICAgICAgIGNvdW50Kys7XG4gICAgICAgIH1cblxuICAgIGlmIChtaW5ZID09IDApXG4gICAgICBmb3IgKHggPSBtaW5YOyB4IDwgbWF4WCArIDE7IHgrKylcbiAgICAgICAgaWYgKGRhdGFbeF0gPT09IDEpIHtcbiAgICAgICAgICByZXN1bHRbeCAtIG1pblhdID0gMTtcbiAgICAgICAgICBjb3VudCsrO1xuICAgICAgICB9XG5cbiAgICBpZiAobWF4WSA9PSBoIC0gMSlcbiAgICAgIGZvciAoeCA9IG1pblg7IHggPCBtYXhYICsgMTsgeCsrKVxuICAgICAgICBpZiAoZGF0YVttYXhZICogdyArIHhdID09PSAxKSB7XG4gICAgICAgICAgcmVzdWx0WyhtYXhZIC0gbWluWSkgKiBydyArICh4IC0gbWluWCldID0gMTtcbiAgICAgICAgICBjb3VudCsrO1xuICAgICAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgY291bnQ6IGNvdW50LFxuICAgICAgZGF0YTogcmVzdWx0LFxuICAgICAgd2lkdGg6IHJ3LFxuICAgICAgaGVpZ2h0OiByaCxcbiAgICAgIG9mZnNldDoge3g6IG1pblgsIHk6IG1pbll9XG4gICAgfTtcbiAgfTtcblxuICAvKiogQ3JlYXRlIGEgYm9yZGVyIGluZGV4IGFycmF5IG9mIGJvdW5kYXJ5IHBvaW50cyBvZiB0aGUgbWFza1xuICAgKiBAcGFyYW0ge09iamVjdH0gbWFzazoge1VpbnQ4QXJyYXl9IGRhdGEsIHtpbnR9IHdpZHRoLCB7aW50fSBoZWlnaHRcbiAgICogQHJldHVybiB7QXJyYXl9IGJvcmRlciBpbmRleCBhcnJheSBib3VuZGFyeSBwb2ludHMgb2YgdGhlIG1hc2tcbiAgICovXG4gIGxpYi5nZXRCb3JkZXJJbmRpY2VzID0gZnVuY3Rpb24gKG1hc2spIHtcblxuICAgIHZhciB4LCB5LCBrLCBrMSwgazIsXG4gICAgICB3ID0gbWFzay53aWR0aCxcbiAgICAgIGggPSBtYXNrLmhlaWdodCxcbiAgICAgIGRhdGEgPSBtYXNrLmRhdGEsXG4gICAgICBib3JkZXIgPSBbXSwgLy8gb25seSBib3JkZXIgcG9pbnRzXG4gICAgICB4MSA9IHcgLSAxLFxuICAgICAgeTEgPSBoIC0gMTtcblxuICAgIC8vIHdhbGsgdGhyb3VnaCBpbm5lciB2YWx1ZXMgZXhjZXB0IHBvaW50cyBvbiB0aGUgYm91bmRhcnkgb2YgdGhlIGltYWdlXG4gICAgZm9yICh5ID0gMTsgeSA8IHkxOyB5KyspXG4gICAgICBmb3IgKHggPSAxOyB4IDwgeDE7IHgrKykge1xuICAgICAgICBrID0geSAqIHcgKyB4O1xuICAgICAgICBpZiAoZGF0YVtrXSA9PT0gMCkgY29udGludWU7IC8vIFwid2hpdGVcIiBwb2ludCBpc24ndCB0aGUgYm9yZGVyXG4gICAgICAgIGsxID0gayArIHc7IC8vIHkgKyAxXG4gICAgICAgIGsyID0gayAtIHc7IC8vIHkgLSAxXG4gICAgICAgIC8vIGNoZWNrIGlmIGFueSBuZWlnaGJvciB3aXRoIGEgXCJ3aGl0ZVwiIGNvbG9yXG4gICAgICAgIGlmIChkYXRhW2sgKyAxXSA9PT0gMCB8fCBkYXRhW2sgLSAxXSA9PT0gMCB8fFxuICAgICAgICAgIGRhdGFbazFdID09PSAwIHx8IGRhdGFbazEgKyAxXSA9PT0gMCB8fCBkYXRhW2sxIC0gMV0gPT09IDAgfHxcbiAgICAgICAgICBkYXRhW2syXSA9PT0gMCB8fCBkYXRhW2syICsgMV0gPT09IDAgfHwgZGF0YVtrMiAtIDFdID09PSAwKSB7XG4gICAgICAgICAgLy9pZiAoZGF0YVtrICsgMV0gKyBkYXRhW2sgLSAxXSArXG4gICAgICAgICAgLy8gICAgZGF0YVtrMV0gKyBkYXRhW2sxICsgMV0gKyBkYXRhW2sxIC0gMV0gK1xuICAgICAgICAgIC8vICAgIGRhdGFbazJdICsgZGF0YVtrMiArIDFdICsgZGF0YVtrMiAtIDFdID09IDgpIGNvbnRpbnVlO1xuICAgICAgICAgIGJvcmRlci5wdXNoKGspO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAvLyB3YWxrIHRocm91Z2ggcG9pbnRzIG9uIHRoZSBib3VuZGFyeSBvZiB0aGUgaW1hZ2UgaWYgbmVjZXNzYXJ5XG4gICAgLy8gaWYgdGhlIFwiYmxhY2tcIiBwb2ludCBpcyBhZGphY2VudCB0byB0aGUgYm91bmRhcnkgb2YgdGhlIGltYWdlLCBpdCBpcyBhIGJvcmRlciBwb2ludFxuICAgIGZvciAoeSA9IDA7IHkgPCBoOyB5KyspXG4gICAgICBpZiAoZGF0YVt5ICogd10gPT09IDEpXG4gICAgICAgIGJvcmRlci5wdXNoKHkgKiB3KTtcblxuICAgIGZvciAoeCA9IDA7IHggPCB3OyB4KyspXG4gICAgICBpZiAoZGF0YVt4XSA9PT0gMSlcbiAgICAgICAgYm9yZGVyLnB1c2goeCk7XG5cbiAgICBrID0gdyAtIDE7XG4gICAgZm9yICh5ID0gMDsgeSA8IGg7IHkrKylcbiAgICAgIGlmIChkYXRhW3kgKiB3ICsga10gPT09IDEpXG4gICAgICAgIGJvcmRlci5wdXNoKHkgKiB3ICsgayk7XG5cbiAgICBrID0gKGggLSAxKSAqIHc7XG4gICAgZm9yICh4ID0gMDsgeCA8IHc7IHgrKylcbiAgICAgIGlmIChkYXRhW2sgKyB4XSA9PT0gMSlcbiAgICAgICAgYm9yZGVyLnB1c2goayArIHgpO1xuXG4gICAgcmV0dXJuIGJvcmRlcjtcbiAgfTtcblxuICAvKiogQ3JlYXRlIGEgY29tcHJlc3NlZCBtYXNrIHdpdGggYSBcIndoaXRlXCIgYm9yZGVyICgxcHggYm9yZGVyIHdpdGggemVybyB2YWx1ZXMpIGZvciB0aGUgY29udG91ciB0cmFjaW5nXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBtYXNrOiB7VWludDhBcnJheX0gZGF0YSwge2ludH0gd2lkdGgsIHtpbnR9IGhlaWdodCwge09iamVjdH0gYm91bmRzXG4gICAqIEByZXR1cm4ge09iamVjdH0gYm9yZGVyIG1hc2s6IHtVaW50OEFycmF5fSBkYXRhLCB7aW50fSB3aWR0aCwge2ludH0gaGVpZ2h0LCB7T2JqZWN0fSBvZmZzZXRcbiAgICovXG4gIGZ1bmN0aW9uIHByZXBhcmVNYXNrKG1hc2spIHtcbiAgICB2YXIgeCwgeSxcbiAgICAgIHcgPSBtYXNrLndpZHRoLFxuICAgICAgZGF0YSA9IG1hc2suZGF0YSxcbiAgICAgIG1pblggPSBtYXNrLmJvdW5kcy5taW5YLFxuICAgICAgbWF4WCA9IG1hc2suYm91bmRzLm1heFgsXG4gICAgICBtaW5ZID0gbWFzay5ib3VuZHMubWluWSxcbiAgICAgIG1heFkgPSBtYXNrLmJvdW5kcy5tYXhZLFxuICAgICAgcncgPSBtYXhYIC0gbWluWCArIDMsIC8vIGJvdW5kcyBzaXplICsxIHB4IG9uIGVhY2ggc2lkZSAoYSBcIndoaXRlXCIgYm9yZGVyKVxuICAgICAgcmggPSBtYXhZIC0gbWluWSArIDMsXG4gICAgICByZXN1bHQgPSBuZXcgVWludDhBcnJheShydyAqIHJoKTsgLy8gcmVkdWNlZCBtYXNrIChib3VuZHMgc2l6ZSlcblxuICAgIC8vIHdhbGsgdGhyb3VnaCBpbm5lciB2YWx1ZXMgYW5kIGNvcHkgb25seSBcImJsYWNrXCIgcG9pbnRzIHRvIHRoZSByZXN1bHQgbWFza1xuICAgIGZvciAoeSA9IG1pblk7IHkgPCBtYXhZICsgMTsgeSsrKVxuICAgICAgZm9yICh4ID0gbWluWDsgeCA8IG1heFggKyAxOyB4KyspIHtcbiAgICAgICAgaWYgKGRhdGFbeSAqIHcgKyB4XSA9PT0gMSlcbiAgICAgICAgICByZXN1bHRbKHkgLSBtaW5ZICsgMSkgKiBydyArICh4IC0gbWluWCArIDEpXSA9IDE7XG4gICAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgZGF0YTogcmVzdWx0LFxuICAgICAgd2lkdGg6IHJ3LFxuICAgICAgaGVpZ2h0OiByaCxcbiAgICAgIG9mZnNldDoge3g6IG1pblggLSAxLCB5OiBtaW5ZIC0gMX1cbiAgICB9O1xuICB9O1xuXG4gIC8qKiBDcmVhdGUgYSBjb250b3VyIGFycmF5IGZvciB0aGUgYmluYXJ5IG1hc2tcbiAgICogQWxnb3JpdGhtOiBodHRwOi8vd3d3LnNjaWVuY2VkaXJlY3QuY29tL3NjaWVuY2UvYXJ0aWNsZS9waWkvUzEwNzczMTQyMDMwMDE0MDFcbiAgICogQHBhcmFtIHtPYmplY3R9IG1hc2s6IHtVaW50OEFycmF5fSBkYXRhLCB7aW50fSB3aWR0aCwge2ludH0gaGVpZ2h0LCB7T2JqZWN0fSBib3VuZHNcbiAgICogQHJldHVybiB7QXJyYXl9IGNvbnRvdXJzOiB7QXJyYXl9IHBvaW50cywge2Jvb2x9IGlubmVyLCB7aW50fSBsYWJlbFxuICAgKi9cbiAgbGliLnRyYWNlQ29udG91cnMgPSBmdW5jdGlvbiAobWFzaykge1xuICAgIHZhciBtID0gcHJlcGFyZU1hc2sobWFzayksXG4gICAgICBjb250b3VycyA9IFtdLFxuICAgICAgbGFiZWwgPSAwLFxuICAgICAgdyA9IG0ud2lkdGgsXG4gICAgICB3MiA9IHcgKiAyLFxuICAgICAgaCA9IG0uaGVpZ2h0LFxuICAgICAgc3JjID0gbS5kYXRhLFxuICAgICAgZHggPSBtLm9mZnNldC54LFxuICAgICAgZHkgPSBtLm9mZnNldC55LFxuICAgICAgYm91bmRzLF9wLFxuICAgICAgZGVzdCA9IG5ldyBVaW50OEFycmF5KHNyYyksIC8vIGxhYmVsIG1hdHJpeFxuICAgICAgaSwgaiwgeCwgeSwgaywgazEsIGMsIGlubmVyLCBkaXIsIGZpcnN0LCBzZWNvbmQsIGN1cnJlbnQsIHByZXZpb3VzLCBuZXh0LCBkO1xuXG4gICAgLy8gYWxsIFtkeCxkeV0gcGFpcnMgKGFycmF5IGluZGV4IGlzIHRoZSBkaXJlY3Rpb24pXG4gICAgLy8gNSA2IDdcbiAgICAvLyA0IFggMFxuICAgIC8vIDMgMiAxXG4gICAgdmFyIGRpcmVjdGlvbnMgPSBbWzEsIDBdLCBbMSwgMV0sIFswLCAxXSwgWy0xLCAxXSwgWy0xLCAwXSwgWy0xLCAtMV0sIFswLCAtMV0sIFsxLCAtMV1dO1xuXG4gICAgZm9yICh5ID0gMTsgeSA8IGggLSAxOyB5KyspXG4gICAgICBmb3IgKHggPSAxOyB4IDwgdyAtIDE7IHgrKykge1xuICAgICAgICBrID0geSAqIHcgKyB4O1xuICAgICAgICBpZiAoc3JjW2tdID09PSAxKSB7XG4gICAgICAgICAgZm9yIChpID0gLXc7IGkgPCB3MjsgaSArPSB3MikgeyAvLyBrIC0gdzogb3V0ZXIgdHJhY2luZyAoeSAtIDEpLCBrICsgdzogaW5uZXIgdHJhY2luZyAoeSArIDEpXG4gICAgICAgICAgICBpZiAoc3JjW2sgKyBpXSA9PT0gMCAmJiBkZXN0W2sgKyBpXSA9PT0gMCkgeyAvLyBuZWVkIGNvbnRvdXIgdHJhY2luZ1xuICAgICAgICAgICAgICBpbm5lciA9IGkgPT09IHc7IC8vIGlzIGlubmVyIGNvbnRvdXIgdHJhY2luZyA/XG4gICAgICAgICAgICAgIGxhYmVsKys7IC8vIGxhYmVsIGZvciB0aGUgbmV4dCBjb250b3VyXG5cbiAgICAgICAgICAgICAgYyA9IFtdO1xuICAgICAgICAgICAgICBib3VuZHMgPSB7XG4gICAgICAgICAgICAgICAgbWluWCA6IHcsXG4gICAgICAgICAgICAgICAgbWluWSA6IGgsXG4gICAgICAgICAgICAgICAgbWF4WCA6IC0xLFxuICAgICAgICAgICAgICAgIG1heFkgOiAtMSxcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgZGlyID0gaW5uZXIgPyAyIDogNjsgLy8gc3RhcnQgZGlyZWN0aW9uXG4gICAgICAgICAgICAgIGN1cnJlbnQgPSBwcmV2aW91cyA9IGZpcnN0ID0ge3g6IHgsIHk6IHl9O1xuICAgICAgICAgICAgICBzZWNvbmQgPSBudWxsO1xuICAgICAgICAgICAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgICAgICAgICAgIGRlc3RbY3VycmVudC55ICogdyArIGN1cnJlbnQueF0gPSBsYWJlbDsgLy8gbWFyayBsYWJlbCBmb3IgdGhlIGN1cnJlbnQgcG9pbnRcbiAgICAgICAgICAgICAgICAvLyBieXBhc3MgYWxsIHRoZSBuZWlnaGJvcnMgYXJvdW5kIHRoZSBjdXJyZW50IHBvaW50IGluIGEgY2xvY2t3aXNlXG4gICAgICAgICAgICAgICAgZm9yIChqID0gMDsgaiA8IDg7IGorKykge1xuICAgICAgICAgICAgICAgICAgZGlyID0gKGRpciArIDEpICUgODtcblxuICAgICAgICAgICAgICAgICAgLy8gZ2V0IHRoZSBuZXh0IHBvaW50IGJ5IG5ldyBkaXJlY3Rpb25cbiAgICAgICAgICAgICAgICAgIGQgPSBkaXJlY3Rpb25zW2Rpcl07IC8vIGluZGV4IGFzIGRpcmVjdGlvblxuICAgICAgICAgICAgICAgICAgbmV4dCA9IHt4OiBjdXJyZW50LnggKyBkWzBdLCB5OiBjdXJyZW50LnkgKyBkWzFdfTtcblxuICAgICAgICAgICAgICAgICAgazEgPSBuZXh0LnkgKiB3ICsgbmV4dC54O1xuICAgICAgICAgICAgICAgICAgaWYgKHNyY1trMV0gPT09IDEpIC8vIGJsYWNrIGJvdW5kYXJ5IHBpeGVsXG4gICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGRlc3RbazFdID0gbGFiZWw7IC8vIG1hcmsgYSBsYWJlbFxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIGRlc3RbazFdID0gLTE7IC8vIG1hcmsgYSB3aGl0ZSBib3VuZGFyeSBwaXhlbFxuICAgICAgICAgICAgICAgICAgbmV4dCA9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChuZXh0ID09PSBudWxsKSBicmVhazsgLy8gbm8gbmVpZ2hib3VycyAob25lLXBvaW50IGNvbnRvdXIpXG4gICAgICAgICAgICAgICAgY3VycmVudCA9IG5leHQ7XG4gICAgICAgICAgICAgICAgaWYgKHNlY29uZCkge1xuICAgICAgICAgICAgICAgICAgaWYgKHByZXZpb3VzLnggPT09IGZpcnN0LnggJiYgcHJldmlvdXMueSA9PT0gZmlyc3QueSAmJiBjdXJyZW50LnggPT09IHNlY29uZC54ICYmIGN1cnJlbnQueSA9PT0gc2Vjb25kLnkpIHtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7IC8vIGNyZWF0aW5nIHRoZSBjb250b3VyIGNvbXBsZXRlZCB3aGVuIHJldHVybmVkIHRvIG9yaWdpbmFsIHBvc2l0aW9uXG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgIHNlY29uZCA9IG5leHQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIF9wID0ge3g6IHByZXZpb3VzLnggKyBkeCwgeTogcHJldmlvdXMueSArIGR5fTtcbiAgICAgICAgICAgICAgICBpZihib3VuZHMubWluWCA+IF9wLngpYm91bmRzLm1pblggPSBfcC54O1xuICAgICAgICAgICAgICAgIGlmKGJvdW5kcy5tYXhYIDwgX3AueClib3VuZHMubWF4WCA9IF9wLng7XG4gICAgICAgICAgICAgICAgaWYoYm91bmRzLm1pblkgPiBfcC55KWJvdW5kcy5taW5ZID0gX3AueTtcbiAgICAgICAgICAgICAgICBpZihib3VuZHMubWF4WSA8IF9wLnkpYm91bmRzLm1heFkgPSBfcC55O1xuICAgICAgICAgICAgICAgIGMucHVzaChfcCk7XG4gICAgICAgICAgICAgICAgcHJldmlvdXMgPSBjdXJyZW50O1xuICAgICAgICAgICAgICAgIGRpciA9IChkaXIgKyA0KSAlIDg7IC8vIG5leHQgZGlyIChzeW1tZXRyaWNhbGx5IHRvIHRoZSBjdXJyZW50IGRpcmVjdGlvbilcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIGlmIChuZXh0ICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBfcCA9IHt4OiBmaXJzdC54ICsgZHgsIHk6IGZpcnN0LnkgKyBkeX07XG4gICAgICAgICAgICAgICAgaWYoYm91bmRzLm1pblggPiAgX3AueClib3VuZHMubWluWCA9ICBfcC54O1xuICAgICAgICAgICAgICAgIGlmKGJvdW5kcy5tYXhYIDwgIF9wLngpYm91bmRzLm1heFggPSAgX3AueDtcbiAgICAgICAgICAgICAgICBpZihib3VuZHMubWluWSA+ICBfcC55KWJvdW5kcy5taW5ZID0gIF9wLnk7XG4gICAgICAgICAgICAgICAgaWYoYm91bmRzLm1heFkgPCAgX3AueSlib3VuZHMubWF4WSA9ICBfcC55O1xuICAgICAgICAgICAgICAgIGMucHVzaChfcCk7IC8vIGNsb3NlIHRoZSBjb250b3VyXG4gICAgICAgICAgICAgICAgY29udG91cnMucHVzaCh7aW5uZXI6IGlubmVyLCBsYWJlbDogbGFiZWwsIHBvaW50czogYyxib3VuZHMgOiBib3VuZHN9KTsgLy8gYWRkIGNvbnRvdXIgdG8gdGhlIGxpc3RcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgcmV0dXJuIGNvbnRvdXJzO1xuICB9O1xuXG4gIGZ1bmN0aW9uIHJnYlRvSHNsKHIsIGcsIGIpe1xuICAgIHIgLz0gMjU1LCBnIC89IDI1NSwgYiAvPSAyNTU7XG4gICAgdmFyIG1heCA9IE1hdGgubWF4KHIsIGcsIGIpLCBtaW4gPSBNYXRoLm1pbihyLCBnLCBiKTtcbiAgICB2YXIgaCwgcywgbCA9IChtYXggKyBtaW4pIC8gMjtcblxuICAgIGlmKG1heCA9PSBtaW4pe1xuICAgICAgaCA9IHMgPSAwOyAvLyBhY2hyb21hdGljXG4gICAgfWVsc2V7XG4gICAgICB2YXIgZCA9IG1heCAtIG1pbjtcbiAgICAgIHMgPSBsID4gMC41ID8gZCAvICgyIC0gbWF4IC0gbWluKSA6IGQgLyAobWF4ICsgbWluKTtcbiAgICAgIHN3aXRjaChtYXgpe1xuICAgICAgICBjYXNlIHI6IGggPSAoZyAtIGIpIC8gZCArIChnIDwgYiA/IDYgOiAwKTsgYnJlYWs7XG4gICAgICAgIGNhc2UgZzogaCA9IChiIC0gcikgLyBkICsgMjsgYnJlYWs7XG4gICAgICAgIGNhc2UgYjogaCA9IChyIC0gZykgLyBkICsgNDsgYnJlYWs7XG4gICAgICB9XG4gICAgICBoIC89IDY7XG4gICAgfVxuXG4gICAgcmV0dXJuIFtoICogMjU1LCBzKiAyNTUsIGwqIDI1NV07XG4gIH1cblxuICBsaWIuc2ltcGxpZnlDb250b3VyID0gZnVuY3Rpb24gKGMsIHNpbXBsaWZ5VG9sZXJhbnQsIHNpbXBsaWZ5Q291bnQpIHtcbiAgICB2YXJcbiAgICAgIGksIGosIGssIGMsIHBvaW50cywgbGVuLCByZXNQb2ludHMsIGxzdCwgc3RhY2ssIGlkcyxcbiAgICAgIG1heGQsIG1heGksIGRpc3QsIHIxLCByMiwgcjEyLCBkeCwgZHksIHBpLCBwZiwgcGw7XG5cbiAgICBwb2ludHMgPSBjLnBvaW50cztcbiAgICBsZW4gPSBjLnBvaW50cy5sZW5ndGg7XG5cbiAgICBpZiAobGVuIDwgc2ltcGxpZnlDb3VudCkgeyAvLyBjb250b3VyIGlzbid0IHNpbXBsaWZpZWRcbiAgICAgIHJlc1BvaW50cyA9IFtdO1xuICAgICAgZm9yIChrID0gMDsgayA8IGxlbjsgaysrKSB7XG4gICAgICAgIHJlc1BvaW50cy5wdXNoKHt4OiBwb2ludHNba10ueCwgeTogcG9pbnRzW2tdLnl9KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGJvdW5kczogYy5ib3VuZHMsIGlubmVyOiBjLmlubmVyLCBsYWJlbDogYy5sYWJlbCwgcG9pbnRzOiByZXNQb2ludHMsIGluaXRpYWxDb3VudDogbGVufTtcbiAgICB9XG5cbiAgICBsc3QgPSBbMCwgbGVuIC0gMV07IC8vIGFsd2F5cyBhZGQgZmlyc3QgYW5kIGxhc3QgcG9pbnRzXG4gICAgc3RhY2sgPSBbe2ZpcnN0OiAwLCBsYXN0OiBsZW4gLSAxfV07IC8vIGZpcnN0IHByb2Nlc3NlZCBlZGdlXG5cbiAgICBkbyB7XG4gICAgICBpZHMgPSBzdGFjay5zaGlmdCgpO1xuICAgICAgaWYgKGlkcy5sYXN0IDw9IGlkcy5maXJzdCArIDEpIC8vIG5vIGludGVybWVkaWF0ZSBwb2ludHNcbiAgICAgIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG5cbiAgICAgIG1heGQgPSAtMS4wOyAvLyBtYXggZGlzdGFuY2UgZnJvbSBwb2ludCB0byBjdXJyZW50IGVkZ2VcbiAgICAgIG1heGkgPSBpZHMuZmlyc3Q7IC8vIGluZGV4IG9mIG1heGltYWxseSBkaXN0YW50IHBvaW50XG5cbiAgICAgIGZvciAoaSA9IGlkcy5maXJzdCArIDE7IGkgPCBpZHMubGFzdDsgaSsrKSAvLyBieXBhc3MgaW50ZXJtZWRpYXRlIHBvaW50cyBpbiBlZGdlXG4gICAgICB7XG4gICAgICAgIC8vIGNhbGMgdGhlIGRpc3RhbmNlIGZyb20gY3VycmVudCBwb2ludCB0byBlZGdlXG4gICAgICAgIHBpID0gcG9pbnRzW2ldO1xuICAgICAgICBwZiA9IHBvaW50c1tpZHMuZmlyc3RdO1xuICAgICAgICBwbCA9IHBvaW50c1tpZHMubGFzdF07XG4gICAgICAgIGR4ID0gcGkueCAtIHBmLng7XG4gICAgICAgIGR5ID0gcGkueSAtIHBmLnk7XG4gICAgICAgIHIxID0gTWF0aC5zcXJ0KGR4ICogZHggKyBkeSAqIGR5KTtcbiAgICAgICAgZHggPSBwaS54IC0gcGwueDtcbiAgICAgICAgZHkgPSBwaS55IC0gcGwueTtcbiAgICAgICAgcjIgPSBNYXRoLnNxcnQoZHggKiBkeCArIGR5ICogZHkpO1xuICAgICAgICBkeCA9IHBmLnggLSBwbC54O1xuICAgICAgICBkeSA9IHBmLnkgLSBwbC55O1xuICAgICAgICByMTIgPSBNYXRoLnNxcnQoZHggKiBkeCArIGR5ICogZHkpO1xuICAgICAgICBpZiAocjEgPj0gTWF0aC5zcXJ0KHIyICogcjIgKyByMTIgKiByMTIpKSBkaXN0ID0gcjI7XG4gICAgICAgIGVsc2UgaWYgKHIyID49IE1hdGguc3FydChyMSAqIHIxICsgcjEyICogcjEyKSkgZGlzdCA9IHIxO1xuICAgICAgICBlbHNlIGRpc3QgPSBNYXRoLmFicygoZHkgKiBwaS54IC0gZHggKiBwaS55ICsgcGYueCAqIHBsLnkgLSBwbC54ICogcGYueSkgLyByMTIpO1xuXG4gICAgICAgIGlmIChkaXN0ID4gbWF4ZCkge1xuICAgICAgICAgIG1heGkgPSBpOyAvLyBzYXZlIHRoZSBpbmRleCBvZiBtYXhpbWFsbHkgZGlzdGFudCBwb2ludFxuICAgICAgICAgIG1heGQgPSBkaXN0O1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmIChtYXhkID4gc2ltcGxpZnlUb2xlcmFudCkgLy8gaWYgdGhlIG1heCBcImRldmlhdGlvblwiIGlzIGxhcmdlciB0aGFuIGFsbG93ZWQgdGhlbi4uLlxuICAgICAge1xuICAgICAgICBsc3QucHVzaChtYXhpKTsgLy8gYWRkIGluZGV4IHRvIHRoZSBzaW1wbGlmaWVkIGxpc3RcbiAgICAgICAgc3RhY2sucHVzaCh7Zmlyc3Q6IGlkcy5maXJzdCwgbGFzdDogbWF4aX0pOyAvLyBhZGQgdGhlIGxlZnQgcGFydCBmb3IgcHJvY2Vzc2luZ1xuICAgICAgICBzdGFjay5wdXNoKHtmaXJzdDogbWF4aSwgbGFzdDogaWRzLmxhc3R9KTsgLy8gYWRkIHRoZSByaWdodCBwYXJ0IGZvciBwcm9jZXNzaW5nXG4gICAgICB9XG5cbiAgICB9IHdoaWxlIChzdGFjay5sZW5ndGggPiAwKTtcblxuICAgIHJlc1BvaW50cyA9IFtdO1xuICAgIGxlbiA9IGxzdC5sZW5ndGg7XG4gICAgbHN0LnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcbiAgICAgIHJldHVybiBhIC0gYjtcbiAgICB9KTsgLy8gcmVzdG9yZSBpbmRleCBvcmRlclxuICAgIGZvciAoayA9IDA7IGsgPCBsZW47IGsrKykge1xuICAgICAgcmVzUG9pbnRzLnB1c2goe3g6IHBvaW50c1tsc3Rba11dLngsIHk6IHBvaW50c1tsc3Rba11dLnl9KTsgLy8gYWRkIHJlc3VsdCBwb2ludHMgdG8gdGhlIGNvcnJlY3Qgb3JkZXJcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgIGJvdW5kczogYy5ib3VuZHMsXG4gICAgICBpbm5lcjogYy5pbm5lciwgbGFiZWw6IGMubGFiZWwsIHBvaW50czogcmVzUG9pbnRzLCBpbml0aWFsQ291bnQ6IGMucG9pbnRzLmxlbmd0aFxuICAgIH07XG4gIH07XG5cbiAgLyoqIFNpbXBsaWZ5IGNvbnRvdXJzXG4gICAqIEFsZ29yaXRobXM6IGh0dHA6Ly9wc2ltcGwuc291cmNlZm9yZ2UubmV0L2RvdWdsYXMtcGV1Y2tlci5odG1sXG4gICAqIGh0dHA6Ly9uZWVyYy5pZm1vLnJ1L3dpa2kvaW5kZXgucGhwP3RpdGxlPSVEMCVBMyVEMCVCRiVEMSU4MCVEMCVCRSVEMSU4OSVEMCVCNSVEMCVCRCVEMCVCOCVEMCVCNV8lRDAlQkYlRDAlQkUlRDAlQkIlRDAlQjglRDAlQjMlRDAlQkUlRDAlQkQlRDAlQjAlRDAlQkIlRDElOEMlRDAlQkQlRDAlQkUlRDAlQjlfJUQxJTg2JUQwJUI1JUQwJUJGJUQwJUI4XG4gICAqIEBwYXJhbSB7QXJyYXl9IGNvbnRvdXJzOiB7QXJyYXl9IHBvaW50cywge2Jvb2x9IGlubmVyLCB7aW50fSBsYWJlbFxuICAgKiBAcGFyYW0ge2Zsb2F0fSBzaW1wbGlmeSB0b2xlcmFudFxuICAgKiBAcGFyYW0ge2ludH0gc2ltcGxpZnkgY291bnQ6IG1pbiBudW1iZXIgb2YgcG9pbnRzIHdoZW4gdGhlIGNvbnRvdXIgaXMgc2ltcGxpZmllZFxuICAgKiBAcmV0dXJuIHtBcnJheX0gY29udG91cnM6IHtBcnJheX0gcG9pbnRzLCB7Ym9vbH0gaW5uZXIsIHtpbnR9IGxhYmVsLCB7aW50fSBpbml0aWFsQ291bnRcbiAgICovXG4gIGxpYi5zaW1wbGlmeUNvbnRvdXJzID0gZnVuY3Rpb24gKGNvbnRvdXJzLCBzaW1wbGlmeVRvbGVyYW50LCBzaW1wbGlmeUNvdW50KSB7XG4gICAgdmFyIGxlbkNvbnRvdXJzID0gY29udG91cnMubGVuZ3RoLFxuICAgICAgcmVzdWx0ID0gW107XG5cbiAgICAvLyB3YWxrIHRocm91Z2ggYWxsIGNvbnRvdXJzXG4gICAgZm9yICh2YXIgaiA9IDA7IGogPCBsZW5Db250b3VyczsgaisrKSB7XG5cbiAgICAgIHJlc3VsdC5wdXNoKGxpYi5zaW1wbGlmeUNvbnRvdXIoY29udG91cnNbal0sIHNpbXBsaWZ5VG9sZXJhbnQsIHNpbXBsaWZ5Q291bnQpKTtcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuXG4gIHJldHVybiBsaWI7XG59KSgpO1xuaWYgKHR5cGVvZiBleHBvcnRzICE9PSAndW5kZWZpbmVkJykge1xuICBtb2R1bGUuZXhwb3J0cyA9IE1hZ2ljV2FuZDtcbn1cblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vcGx1Z2lucy9tYWdpY3dhbmQuanNcbi8vIG1vZHVsZSBpZCA9IDEwOFxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCIvKiBGaWxlU2F2ZXIuanNcbiAqIEEgc2F2ZUFzKCkgRmlsZVNhdmVyIGltcGxlbWVudGF0aW9uLlxuICogMS4xLjIwMTUwNzE2XG4gKlxuICogQnkgRWxpIEdyZXksIGh0dHA6Ly9lbGlncmV5LmNvbVxuICogTGljZW5zZTogWDExL01JVFxuICogICBTZWUgaHR0cHM6Ly9naXRodWIuY29tL2VsaWdyZXkvRmlsZVNhdmVyLmpzL2Jsb2IvbWFzdGVyL0xJQ0VOU0UubWRcbiAqL1xuXG4vKmdsb2JhbCBzZWxmICovXG4vKmpzbGludCBiaXR3aXNlOiB0cnVlLCBpbmRlbnQ6IDQsIGxheGJyZWFrOiB0cnVlLCBsYXhjb21tYTogdHJ1ZSwgc21hcnR0YWJzOiB0cnVlLCBwbHVzcGx1czogdHJ1ZSAqL1xuXG4vKiEgQHNvdXJjZSBodHRwOi8vcHVybC5lbGlncmV5LmNvbS9naXRodWIvRmlsZVNhdmVyLmpzL2Jsb2IvbWFzdGVyL0ZpbGVTYXZlci5qcyAqL1xuXG5cblxudmFyIGlzTGlrZWx5Tm9kZSA9IHR5cGVvZiBCdWZmZXIgIT09ICd1bmRlZmluZWQnICYmIHR5cGVvZiB3aW5kb3cgPT09ICd1bmRlZmluZWQnO1xuXG5cblxudmFyIHNhdmVBcyA9ICFpc0xpa2VseU5vZGUgJiYgIChmdW5jdGlvbih2aWV3KSB7XG4gICAgICAgIFwidXNlIHN0cmljdFwiO1xuICAgICAgICAvLyBJRSA8MTAgaXMgZXhwbGljaXRseSB1bnN1cHBvcnRlZFxuICAgICAgICBpZiAodHlwZW9mIG5hdmlnYXRvciAhPT0gXCJ1bmRlZmluZWRcIiAmJiAvTVNJRSBbMS05XVxcLi8udGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZhclxuICAgICAgICAgICAgZG9jID0gdmlldy5kb2N1bWVudFxuICAgICAgICAvLyBvbmx5IGdldCBVUkwgd2hlbiBuZWNlc3NhcnkgaW4gY2FzZSBCbG9iLmpzIGhhc24ndCBvdmVycmlkZGVuIGl0IHlldFxuICAgICAgICAgICAgLCBnZXRfVVJMID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHZpZXcuVVJMIHx8IHZpZXcud2Via2l0VVJMIHx8IHZpZXc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAsIHNhdmVfbGluayA9IGRvYy5jcmVhdGVFbGVtZW50TlMoXCJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sXCIsIFwiYVwiKVxuICAgICAgICAgICAgLCBjYW5fdXNlX3NhdmVfbGluayA9IFwiZG93bmxvYWRcIiBpbiBzYXZlX2xpbmtcbiAgICAgICAgICAgICwgY2xpY2sgPSBmdW5jdGlvbihub2RlKSB7XG4gICAgICAgICAgICAgICAgdmFyIGV2ZW50ID0gbmV3IE1vdXNlRXZlbnQoXCJjbGlja1wiKTtcbiAgICAgICAgICAgICAgICBub2RlLmRpc3BhdGNoRXZlbnQoZXZlbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLCB3ZWJraXRfcmVxX2ZzID0gdmlldy53ZWJraXRSZXF1ZXN0RmlsZVN5c3RlbVxuICAgICAgICAgICAgLCByZXFfZnMgPSB2aWV3LnJlcXVlc3RGaWxlU3lzdGVtIHx8IHdlYmtpdF9yZXFfZnMgfHwgdmlldy5tb3pSZXF1ZXN0RmlsZVN5c3RlbVxuICAgICAgICAgICAgLCB0aHJvd19vdXRzaWRlID0gZnVuY3Rpb24oZXgpIHtcbiAgICAgICAgICAgICAgICAodmlldy5zZXRJbW1lZGlhdGUgfHwgdmlldy5zZXRUaW1lb3V0KShmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgZXg7XG4gICAgICAgICAgICAgICAgfSwgMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAsIGZvcmNlX3NhdmVhYmxlX3R5cGUgPSBcImFwcGxpY2F0aW9uL29jdGV0LXN0cmVhbVwiXG4gICAgICAgICAgICAsIGZzX21pbl9zaXplID0gMFxuICAgICAgICAvLyBTZWUgaHR0cHM6Ly9jb2RlLmdvb2dsZS5jb20vcC9jaHJvbWl1bS9pc3N1ZXMvZGV0YWlsP2lkPTM3NTI5NyNjNyBhbmRcbiAgICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2VsaWdyZXkvRmlsZVNhdmVyLmpzL2NvbW1pdC80ODU5MzBhI2NvbW1pdGNvbW1lbnQtODc2ODA0N1xuICAgICAgICAvLyBmb3IgdGhlIHJlYXNvbmluZyBiZWhpbmQgdGhlIHRpbWVvdXQgYW5kIHJldm9jYXRpb24gZmxvd1xuICAgICAgICAgICAgLCBhcmJpdHJhcnlfcmV2b2tlX3RpbWVvdXQgPSA1MDAgLy8gaW4gbXNcbiAgICAgICAgICAgICwgcmV2b2tlID0gZnVuY3Rpb24oZmlsZSkge1xuICAgICAgICAgICAgICAgIHZhciByZXZva2VyID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZmlsZSA9PT0gXCJzdHJpbmdcIikgeyAvLyBmaWxlIGlzIGFuIG9iamVjdCBVUkxcbiAgICAgICAgICAgICAgICAgICAgICAgIGdldF9VUkwoKS5yZXZva2VPYmplY3RVUkwoZmlsZSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7IC8vIGZpbGUgaXMgYSBGaWxlXG4gICAgICAgICAgICAgICAgICAgICAgICBmaWxlLnJlbW92ZSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBpZiAodmlldy5jaHJvbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV2b2tlcigpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQocmV2b2tlciwgYXJiaXRyYXJ5X3Jldm9rZV90aW1lb3V0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAsIGRpc3BhdGNoID0gZnVuY3Rpb24oZmlsZXNhdmVyLCBldmVudF90eXBlcywgZXZlbnQpIHtcbiAgICAgICAgICAgICAgICBldmVudF90eXBlcyA9IFtdLmNvbmNhdChldmVudF90eXBlcyk7XG4gICAgICAgICAgICAgICAgdmFyIGkgPSBldmVudF90eXBlcy5sZW5ndGg7XG4gICAgICAgICAgICAgICAgd2hpbGUgKGktLSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbGlzdGVuZXIgPSBmaWxlc2F2ZXJbXCJvblwiICsgZXZlbnRfdHlwZXNbaV1dO1xuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGxpc3RlbmVyID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlzdGVuZXIuY2FsbChmaWxlc2F2ZXIsIGV2ZW50IHx8IGZpbGVzYXZlcik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChleCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93X291dHNpZGUoZXgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLCBhdXRvX2JvbSA9IGZ1bmN0aW9uKGJsb2IpIHtcbiAgICAgICAgICAgICAgICAvLyBwcmVwZW5kIEJPTSBmb3IgVVRGLTggWE1MIGFuZCB0ZXh0LyogdHlwZXMgKGluY2x1ZGluZyBIVE1MKVxuICAgICAgICAgICAgICAgIGlmICgvXlxccyooPzp0ZXh0XFwvXFxTKnxhcHBsaWNhdGlvblxcL3htbHxcXFMqXFwvXFxTKlxcK3htbClcXHMqOy4qY2hhcnNldFxccyo9XFxzKnV0Zi04L2kudGVzdChibG9iLnR5cGUpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgQmxvYihbXCJcXHVmZWZmXCIsIGJsb2JdLCB7dHlwZTogYmxvYi50eXBlfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBibG9iO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLCBGaWxlU2F2ZXIgPSBmdW5jdGlvbihibG9iLCBuYW1lLCBub19hdXRvX2JvbSkge1xuICAgICAgICAgICAgICAgIGlmICghbm9fYXV0b19ib20pIHtcbiAgICAgICAgICAgICAgICAgICAgYmxvYiA9IGF1dG9fYm9tKGJsb2IpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBGaXJzdCB0cnkgYS5kb3dubG9hZCwgdGhlbiB3ZWIgZmlsZXN5c3RlbSwgdGhlbiBvYmplY3QgVVJMc1xuICAgICAgICAgICAgICAgIHZhclxuICAgICAgICAgICAgICAgICAgICBmaWxlc2F2ZXIgPSB0aGlzXG4gICAgICAgICAgICAgICAgICAgICwgdHlwZSA9IGJsb2IudHlwZVxuICAgICAgICAgICAgICAgICAgICAsIGJsb2JfY2hhbmdlZCA9IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgICwgb2JqZWN0X3VybFxuICAgICAgICAgICAgICAgICAgICAsIHRhcmdldF92aWV3XG4gICAgICAgICAgICAgICAgICAgICwgZGlzcGF0Y2hfYWxsID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkaXNwYXRjaChmaWxlc2F2ZXIsIFwid3JpdGVzdGFydCBwcm9ncmVzcyB3cml0ZSB3cml0ZWVuZFwiLnNwbGl0KFwiIFwiKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBvbiBhbnkgZmlsZXN5cyBlcnJvcnMgcmV2ZXJ0IHRvIHNhdmluZyB3aXRoIG9iamVjdCBVUkxzXG4gICAgICAgICAgICAgICAgICAgICwgZnNfZXJyb3IgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRvbid0IGNyZWF0ZSBtb3JlIG9iamVjdCBVUkxzIHRoYW4gbmVlZGVkXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYmxvYl9jaGFuZ2VkIHx8ICFvYmplY3RfdXJsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb2JqZWN0X3VybCA9IGdldF9VUkwoKS5jcmVhdGVPYmplY3RVUkwoYmxvYik7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGFyZ2V0X3ZpZXcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXJnZXRfdmlldy5sb2NhdGlvbi5ocmVmID0gb2JqZWN0X3VybDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG5ld190YWIgPSB2aWV3Lm9wZW4ob2JqZWN0X3VybCwgXCJfYmxhbmtcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5ld190YWIgPT0gdW5kZWZpbmVkICYmIHR5cGVvZiBzYWZhcmkgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9BcHBsZSBkbyBub3QgYWxsb3cgd2luZG93Lm9wZW4sIHNlZSBodHRwOi8vYml0Lmx5LzFrWmZmUklcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlldy5sb2NhdGlvbi5ocmVmID0gb2JqZWN0X3VybFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVzYXZlci5yZWFkeVN0YXRlID0gZmlsZXNhdmVyLkRPTkU7XG4gICAgICAgICAgICAgICAgICAgICAgICBkaXNwYXRjaF9hbGwoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldm9rZShvYmplY3RfdXJsKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAsIGFib3J0YWJsZSA9IGZ1bmN0aW9uKGZ1bmMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmlsZXNhdmVyLnJlYWR5U3RhdGUgIT09IGZpbGVzYXZlci5ET05FKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmdW5jLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAsIGNyZWF0ZV9pZl9ub3RfZm91bmQgPSB7Y3JlYXRlOiB0cnVlLCBleGNsdXNpdmU6IGZhbHNlfVxuICAgICAgICAgICAgICAgICAgICAsIHNsaWNlXG4gICAgICAgICAgICAgICAgICAgIDtcbiAgICAgICAgICAgICAgICBmaWxlc2F2ZXIucmVhZHlTdGF0ZSA9IGZpbGVzYXZlci5JTklUO1xuICAgICAgICAgICAgICAgIGlmICghbmFtZSkge1xuICAgICAgICAgICAgICAgICAgICBuYW1lID0gXCJkb3dubG9hZFwiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoY2FuX3VzZV9zYXZlX2xpbmspIHtcbiAgICAgICAgICAgICAgICAgICAgb2JqZWN0X3VybCA9IGdldF9VUkwoKS5jcmVhdGVPYmplY3RVUkwoYmxvYik7XG4gICAgICAgICAgICAgICAgICAgIHNhdmVfbGluay5ocmVmID0gb2JqZWN0X3VybDtcbiAgICAgICAgICAgICAgICAgICAgc2F2ZV9saW5rLmRvd25sb2FkID0gbmFtZTtcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNsaWNrKHNhdmVfbGluayk7XG4gICAgICAgICAgICAgICAgICAgICAgICBkaXNwYXRjaF9hbGwoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldm9rZShvYmplY3RfdXJsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVzYXZlci5yZWFkeVN0YXRlID0gZmlsZXNhdmVyLkRPTkU7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIE9iamVjdCBhbmQgd2ViIGZpbGVzeXN0ZW0gVVJMcyBoYXZlIGEgcHJvYmxlbSBzYXZpbmcgaW4gR29vZ2xlIENocm9tZSB3aGVuXG4gICAgICAgICAgICAgICAgLy8gdmlld2VkIGluIGEgdGFiLCBzbyBJIGZvcmNlIHNhdmUgd2l0aCBhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW1cbiAgICAgICAgICAgICAgICAvLyBodHRwOi8vY29kZS5nb29nbGUuY29tL3AvY2hyb21pdW0vaXNzdWVzL2RldGFpbD9pZD05MTE1OFxuICAgICAgICAgICAgICAgIC8vIFVwZGF0ZTogR29vZ2xlIGVycmFudGx5IGNsb3NlZCA5MTE1OCwgSSBzdWJtaXR0ZWQgaXQgYWdhaW46XG4gICAgICAgICAgICAgICAgLy8gaHR0cHM6Ly9jb2RlLmdvb2dsZS5jb20vcC9jaHJvbWl1bS9pc3N1ZXMvZGV0YWlsP2lkPTM4OTY0MlxuICAgICAgICAgICAgICAgIGlmICh2aWV3LmNocm9tZSAmJiB0eXBlICYmIHR5cGUgIT09IGZvcmNlX3NhdmVhYmxlX3R5cGUpIHtcbiAgICAgICAgICAgICAgICAgICAgc2xpY2UgPSBibG9iLnNsaWNlIHx8IGJsb2Iud2Via2l0U2xpY2U7XG4gICAgICAgICAgICAgICAgICAgIGJsb2IgPSBzbGljZS5jYWxsKGJsb2IsIDAsIGJsb2Iuc2l6ZSwgZm9yY2Vfc2F2ZWFibGVfdHlwZSk7XG4gICAgICAgICAgICAgICAgICAgIGJsb2JfY2hhbmdlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIFNpbmNlIEkgY2FuJ3QgYmUgc3VyZSB0aGF0IHRoZSBndWVzc2VkIG1lZGlhIHR5cGUgd2lsbCB0cmlnZ2VyIGEgZG93bmxvYWRcbiAgICAgICAgICAgICAgICAvLyBpbiBXZWJLaXQsIEkgYXBwZW5kIC5kb3dubG9hZCB0byB0aGUgZmlsZW5hbWUuXG4gICAgICAgICAgICAgICAgLy8gaHR0cHM6Ly9idWdzLndlYmtpdC5vcmcvc2hvd19idWcuY2dpP2lkPTY1NDQwXG4gICAgICAgICAgICAgICAgaWYgKHdlYmtpdF9yZXFfZnMgJiYgbmFtZSAhPT0gXCJkb3dubG9hZFwiKSB7XG4gICAgICAgICAgICAgICAgICAgIG5hbWUgKz0gXCIuZG93bmxvYWRcIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHR5cGUgPT09IGZvcmNlX3NhdmVhYmxlX3R5cGUgfHwgd2Via2l0X3JlcV9mcykge1xuICAgICAgICAgICAgICAgICAgICB0YXJnZXRfdmlldyA9IHZpZXc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICghcmVxX2ZzKSB7XG4gICAgICAgICAgICAgICAgICAgIGZzX2Vycm9yKCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZnNfbWluX3NpemUgKz0gYmxvYi5zaXplO1xuICAgICAgICAgICAgICAgIHJlcV9mcyh2aWV3LlRFTVBPUkFSWSwgZnNfbWluX3NpemUsIGFib3J0YWJsZShmdW5jdGlvbihmcykge1xuICAgICAgICAgICAgICAgICAgICBmcy5yb290LmdldERpcmVjdG9yeShcInNhdmVkXCIsIGNyZWF0ZV9pZl9ub3RfZm91bmQsIGFib3J0YWJsZShmdW5jdGlvbihkaXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzYXZlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlyLmdldEZpbGUobmFtZSwgY3JlYXRlX2lmX25vdF9mb3VuZCwgYWJvcnRhYmxlKGZ1bmN0aW9uKGZpbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZS5jcmVhdGVXcml0ZXIoYWJvcnRhYmxlKGZ1bmN0aW9uKHdyaXRlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVyLm9ud3JpdGVlbmQgPSBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhcmdldF92aWV3LmxvY2F0aW9uLmhyZWYgPSBmaWxlLnRvVVJMKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZXNhdmVyLnJlYWR5U3RhdGUgPSBmaWxlc2F2ZXIuRE9ORTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwYXRjaChmaWxlc2F2ZXIsIFwid3JpdGVlbmRcIiwgZXZlbnQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldm9rZShmaWxlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3cml0ZXIub25lcnJvciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBlcnJvciA9IHdyaXRlci5lcnJvcjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXJyb3IuY29kZSAhPT0gZXJyb3IuQUJPUlRfRVJSKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZzX2Vycm9yKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwid3JpdGVzdGFydCBwcm9ncmVzcyB3cml0ZSBhYm9ydFwiLnNwbGl0KFwiIFwiKS5mb3JFYWNoKGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVyW1wib25cIiArIGV2ZW50XSA9IGZpbGVzYXZlcltcIm9uXCIgKyBldmVudF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlci53cml0ZShibG9iKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVzYXZlci5hYm9ydCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdyaXRlci5hYm9ydCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVzYXZlci5yZWFkeVN0YXRlID0gZmlsZXNhdmVyLkRPTkU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsZXNhdmVyLnJlYWR5U3RhdGUgPSBmaWxlc2F2ZXIuV1JJVElORztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSksIGZzX2Vycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwgZnNfZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpci5nZXRGaWxlKG5hbWUsIHtjcmVhdGU6IGZhbHNlfSwgYWJvcnRhYmxlKGZ1bmN0aW9uKGZpbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBkZWxldGUgZmlsZSBpZiBpdCBhbHJlYWR5IGV4aXN0c1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZpbGUucmVtb3ZlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2F2ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSksIGFib3J0YWJsZShmdW5jdGlvbihleCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChleC5jb2RlID09PSBleC5OT1RfRk9VTkRfRVJSKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmc19lcnJvcigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgICAgICAgICAgfSksIGZzX2Vycm9yKTtcbiAgICAgICAgICAgICAgICB9KSwgZnNfZXJyb3IpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLCBGU19wcm90byA9IEZpbGVTYXZlci5wcm90b3R5cGVcbiAgICAgICAgICAgICwgc2F2ZUFzID0gZnVuY3Rpb24oYmxvYiwgbmFtZSwgbm9fYXV0b19ib20pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEZpbGVTYXZlcihibG9iLCBuYW1lLCBub19hdXRvX2JvbSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICA7XG4gICAgICAgIC8vIElFIDEwKyAobmF0aXZlIHNhdmVBcylcbiAgICAgICAgaWYgKHR5cGVvZiBuYXZpZ2F0b3IgIT09IFwidW5kZWZpbmVkXCIgJiYgbmF2aWdhdG9yLm1zU2F2ZU9yT3BlbkJsb2IpIHtcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihibG9iLCBuYW1lLCBub19hdXRvX2JvbSkge1xuICAgICAgICAgICAgICAgIGlmICghbm9fYXV0b19ib20pIHtcbiAgICAgICAgICAgICAgICAgICAgYmxvYiA9IGF1dG9fYm9tKGJsb2IpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gbmF2aWdhdG9yLm1zU2F2ZU9yT3BlbkJsb2IoYmxvYiwgbmFtZSB8fCBcImRvd25sb2FkXCIpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIEZTX3Byb3RvLmFib3J0ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgZmlsZXNhdmVyID0gdGhpcztcbiAgICAgICAgICAgIGZpbGVzYXZlci5yZWFkeVN0YXRlID0gZmlsZXNhdmVyLkRPTkU7XG4gICAgICAgICAgICBkaXNwYXRjaChmaWxlc2F2ZXIsIFwiYWJvcnRcIik7XG4gICAgICAgIH07XG4gICAgICAgIEZTX3Byb3RvLnJlYWR5U3RhdGUgPSBGU19wcm90by5JTklUID0gMDtcbiAgICAgICAgRlNfcHJvdG8uV1JJVElORyA9IDE7XG4gICAgICAgIEZTX3Byb3RvLkRPTkUgPSAyO1xuXG4gICAgICAgIEZTX3Byb3RvLmVycm9yID1cbiAgICAgICAgICAgIEZTX3Byb3RvLm9ud3JpdGVzdGFydCA9XG4gICAgICAgICAgICAgICAgRlNfcHJvdG8ub25wcm9ncmVzcyA9XG4gICAgICAgICAgICAgICAgICAgIEZTX3Byb3RvLm9ud3JpdGUgPVxuICAgICAgICAgICAgICAgICAgICAgICAgRlNfcHJvdG8ub25hYm9ydCA9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgRlNfcHJvdG8ub25lcnJvciA9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZTX3Byb3RvLm9ud3JpdGVlbmQgPVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbnVsbDtcblxuICAgICAgICByZXR1cm4gc2F2ZUFzO1xuICAgIH0oXG4gICAgICAgIHR5cGVvZiBzZWxmICE9PSBcInVuZGVmaW5lZFwiICYmIHNlbGZcbiAgICAgICAgfHwgdHlwZW9mIHdpbmRvdyAhPT0gXCJ1bmRlZmluZWRcIiAmJiB3aW5kb3dcbiAgICAgICAgfHwgdGhpcy5jb250ZW50XG4gICAgKSk7XG4vLyBgc2VsZmAgaXMgdW5kZWZpbmVkIGluIEZpcmVmb3ggZm9yIEFuZHJvaWQgY29udGVudCBzY3JpcHQgY29udGV4dFxuLy8gd2hpbGUgYHRoaXNgIGlzIG5zSUNvbnRlbnRGcmFtZU1lc3NhZ2VNYW5hZ2VyXG4vLyB3aXRoIGFuIGF0dHJpYnV0ZSBgY29udGVudGAgdGhhdCBjb3JyZXNwb25kcyB0byB0aGUgd2luZG93XG5cbmlmICh0eXBlb2YgbW9kdWxlICE9PSBcInVuZGVmaW5lZFwiICYmIG1vZHVsZS5leHBvcnRzKSB7XG4gICAgbW9kdWxlLmV4cG9ydHMuc2F2ZUFzID0gc2F2ZUFzO1xufSBlbHNlIGlmICgodHlwZW9mIGRlZmluZSAhPT0gXCJ1bmRlZmluZWRcIiAmJiBkZWZpbmUgIT09IG51bGwpICYmIChkZWZpbmUuYW1kICE9IG51bGwpKSB7XG4gICAgZGVmaW5lKFtdLCBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHNhdmVBcztcbiAgICB9KTtcbn1cblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vcGx1Z2lucy9zYXZlQXMuanNcbi8vIG1vZHVsZSBpZCA9IDEwOVxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCJyZXF1aXJlKFwiLi4vanF1ZXJ5L21pbmljb2xvcnNcIik7XG52YXIgVG9vbGJhciA9IHJlcXVpcmUoXCIuL3Rvb2xiYXJcIik7XG5cblRvb2xiYXIucHJvdG90eXBlLmNvbG9ycGlja2VyID0gZnVuY3Rpb24gKGVsLCBvcHRpb25zKSB7XG4gIG9wdGlvbnMuZm9ybWF0ID0gJ3JnYic7XG4gIG9wdGlvbnMub3BhY2l0eSA9IHRydWU7XG4gIGVsLm1pbmljb2xvcnMob3B0aW9ucyk7XG59O1xuXG5Ub29sYmFyLnByb3RvdHlwZS50b29scy5jb2xvciA9IHtcbiAgdGVtcGxhdGU6XG4gICAgJzxkaXYgY2xhc3M9XCJvYmplY3QtbWVudS1pdGVtXCIgdGl0bGU9XCJ7dGl0bGV9XCI+JyArXG4gICAgJzxkaXYgY2xhc3M9XCJidG4gYnV0dG9uLXtpZH0ge2NsYXNzTmFtZX1cIj4nICtcbiAgICAnPGlucHV0IHR5cGU9XCJ0ZXh0XCIgZGF0YS1mb3JtYXQ9XCJyZ2JhXCIgZGF0YS1vcGFjaXR5PVwidHJ1ZVwiIGRhdGEtdGV4dD1cInRydWVcIiBkYXRhLWNvbnRyb2w9XCJzYXR1cmF0aW9uXCIgZGF0YS1zd2F0Y2hlcz1cIiNmZmZ8IzAwMHwjZjAwfCMwZjB8IzAwZnwjZmYwfCMwZmZcIiAgdmFsdWU9XCJ7dmFsdWVDdXJyZW50fVwiIHRyYW5zY2x1ZGU+JyxcbiAgcG9zdDogZnVuY3Rpb24gKCRpdGVtLCBkYXRhLCBvcHRpb25zLCB0cmFuc2NsdWRlKSB7XG4gICAgdmFyIHRhcmdldCA9IGRhdGEudGFyZ2V0O1xuXG4gICAgdmFyIF92aXNpYmxlID0gZmFsc2U7XG4gICAgdGhpcy5jb2xvcnBpY2tlcih0cmFuc2NsdWRlLCB7XG4gICAgICAvLyB2YWx1ZTogICAgICAgIGRhdGEudmFsdWUuZ2V0KCkgLC8vfHwgZGF0YS52YWx1ZS5nZXQoKSxcbiAgICAgIGRlZmF1bHRWYWx1ZTogJ3JnYigwLDAsMCwxKScsLy9kYXRhLnZhbHVlLmRlZmF1bHRWYWx1ZSB8fCBkYXRhLnZhbHVlLmdldCgpLFxuICAgICAgY29udHJvbDogICAgICB0cmFuc2NsdWRlLmF0dHIoJ2RhdGEtY29udHJvbCcpIHx8ICdodWUnLFxuICAgICAgZm9ybWF0OiAgICAgICB0cmFuc2NsdWRlLmF0dHIoJ2RhdGEtZm9ybWF0JykgfHwgJ2hleCcsXG4gICAgICBrZXl3b3JkczogICAgIHRyYW5zY2x1ZGUuYXR0cignZGF0YS1rZXl3b3JkcycpIHx8ICcnLFxuICAgICAgaW5saW5lOiAgICAgICB0cmFuc2NsdWRlLmF0dHIoJ2RhdGEtaW5saW5lJykgPT09ICd0cnVlJyxcbiAgICAgIGxldHRlckNhc2U6ICAgdHJhbnNjbHVkZS5hdHRyKCdkYXRhLWxldHRlckNhc2UnKSB8fCAnbG93ZXJjYXNlJyxcbiAgICAgIG9wYWNpdHk6ICAgICAgdHJhbnNjbHVkZS5hdHRyKCdkYXRhLW9wYWNpdHknKSxcbiAgICAgIHBvc2l0aW9uOiAgICAgdHJhbnNjbHVkZS5hdHRyKCdkYXRhLXBvc2l0aW9uJykgfHwgdGhpcy50b29scy5jb2xvci5jb2xvcnBpY2tlclBvc2l0aW9uIHx8ICdyaWdodCBib3R0b20nLFxuICAgICAgc3dhdGNoZXM6ICAgICB0cmFuc2NsdWRlLmF0dHIoJ2RhdGEtc3dhdGNoZXMnKSA/IHRyYW5zY2x1ZGUuYXR0cignZGF0YS1zd2F0Y2hlcycpLnNwbGl0KCd8JykgOiBbXSxcbiAgICAgIHRleHQ6ICAgICB0cmFuc2NsdWRlLmF0dHIoJ2RhdGEtdGV4dCcpLFxuICAgICAgaGlkZTogZnVuY3Rpb24gKCkge1xuICAgICAgICBfdmlzaWJsZSA9IGZhbHNlXG4gICAgICB9LFxuICAgICAgc2hvdzogZnVuY3Rpb24gKCkge1xuICAgICAgICBfdmlzaWJsZSA9IHRydWU7XG4gICAgICB9LFxuICAgICAgY2hhbmdlOiBmdW5jdGlvbiAodmFsdWUsIG9wYWNpdHkpIHtcbiAgICAgICAgZGF0YS52YWx1ZS5zZXQodmFsdWUpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgdmFyIF9lbCA9ICQodHJhbnNjbHVkZS5wYXJlbnRzKClbMF0pLmZpbmQoXCIubWluaWNvbG9ycy1wYW5lbFwiKTtcblxuICAgIHZhciBfSElERSA9IGZ1bmN0aW9uKGUpe1xuICAgICAgaWYoX3Zpc2libGUgJiYgJChlLnRhcmdldCkucGFyZW50cygpLmluZGV4KF9lbCkgPT0gLTEpe1xuICAgICAgICB0cmFuc2NsdWRlLm1pbmljb2xvcnMoXCJoaWRlXCIpO1xuICAgICAgfVxuICAgIH07XG4gICAgJChcImJvZHlcIikub24oXCJtb3VzZWRvd25cIixfSElERSlcbiAgfVxufTtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vcGx1Z2lucy90b29sYmFyLmNvbG9ycy5qc1xuLy8gbW9kdWxlIGlkID0gMTEwXG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsInJlcXVpcmUoXCIuLi9qcXVlcnkvZm9udFNlbGVjdG9yXCIpO1xudmFyIFRvb2xiYXIgPSByZXF1aXJlKFwiLi90b29sYmFyXCIpO1xuXG5Ub29sYmFyLnByb3RvdHlwZS5mb250cyA9IFtcbiAgJ0FyaWFsLEhlbHZldGljYSxzYW5zLXNlcmlmJyxcbiAgJ0FyaWFsIEJsYWNrLEdhZGdldCxzYW5zLXNlcmlmJyxcbiAgJ0NvbWljIFNhbnMgTVMsY3Vyc2l2ZScsXG4gICdDb3VyaWVyIE5ldyxDb3VyaWVyLG1vbm9zcGFjZScsXG4gICdHZW9yZ2lhLHNlcmlmJyxcbiAgJ0ltcGFjdCxDaGFyY29hbCxzYW5zLXNlcmlmJyxcbiAgJ0x1Y2lkYSBDb25zb2xlLE1vbmFjbyxtb25vc3BhY2UnLFxuICAnTHVjaWRhIFNhbnMgVW5pY29kZSxMdWNpZGEgR3JhbmRlLHNhbnMtc2VyaWYnLFxuICAnUGFsYXRpbm8gTGlub3R5cGUsQm9vayBBbnRpcXVhLFBhbGF0aW5vLHNlcmlmJyxcbiAgJ1RhaG9tYSxHZW5ldmEsc2Fucy1zZXJpZicsXG4gICdUaW1lcyBOZXcgUm9tYW4sVGltZXMsc2VyaWYnLFxuICAnVHJlYnVjaGV0IE1TLEhlbHZldGljYSxzYW5zLXNlcmlmJyxcbiAgJ1ZlcmRhbmEsR2VuZXZhLHNhbnMtc2VyaWYnLFxuICAnR2lsbCBTYW5zLEdlbmV2YSxzYW5zLXNlcmlmJ1xuXTtcblxuXG5Ub29sYmFyLnByb3RvdHlwZS50b29scy5mb250RmFtaWx5ID0ge1xuICBzY29wZTogZnVuY3Rpb24gKGRhdGEsIG9wdGlvbnMpIHtcbiAgICByZXR1cm4ge1xuICAgICAgLy9jdXJyZW50VmFsdWU6IGRhdGEudmFsdWUuZ2V0KCksXG4gICAgICBvbmNoYW5nZTogZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgZGF0YS52YWx1ZS5zZXQocGFyc2VGbG9hdCgkKGUudGFyZ2V0KS52YWwoKSkpO1xuICAgICAgfVxuICAgIH1cbiAgfSxcbiAgdGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwib2JqZWN0LW1lbnUtaXRlbSBvYmplY3QtbWVudS1mb250LWZhbWlseVwiIHRpdGxlPVwie3RpdGxlfVwiPicgK1xuICAnPGRpdiBjbGFzcz1cImZvbnRTZWxlY3RcIiB0cmFuc2NsdWRlPjxkaXYgY2xhc3M9XCJhcnJvdy1kb3duXCI+JyxcbiAgICBwb3N0OiBmdW5jdGlvbiAoJGl0ZW0sIGRhdGEsIG9wdGlvbnMsIHRyYW5zY2x1ZGUpIHtcblxuICAgIHRyYW5zY2x1ZGUuZm9udFNlbGVjdG9yKHtcbiAgICAgICdoaWRlX2ZhbGxiYWNrcyc6IHRydWUsXG4gICAgICAnaW5pdGlhbCc6IGRhdGEudmFsdWUuZ2V0KCksLy8nQ291cmllciBOZXcsQ291cmllciBOZXcsQ291cmllcixtb25vc3BhY2UnLFxuICAgICAgJ3NlbGVjdGVkJzogZGF0YS52YWx1ZS5zZXQuYmluZChkYXRhLnRhcmdldCksXG4gICAgICAnZm9udHMnOiBkYXRhLmRhdGFcbiAgICB9KTtcbiAgfVxufTtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vcGx1Z2lucy90b29sYmFyLmZvbnRzLmpzXG4vLyBtb2R1bGUgaWQgPSAxMTFcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiXG52YXIgVG9vbGJhciA9IHJlcXVpcmUoXCIuL3Rvb2xiYXJcIik7XG5cblRvb2xiYXIucHJvdG90eXBlLnVwZGF0ZVNlbGVjdGVkT3B0aW9uID0gZnVuY3Rpb24oZGF0YSl7XG4gIHZhciAkY2hlY2tlZCA9IGRhdGEuJGl0ZW0uZmluZChcIjpjaGVja2VkXCIpO1xuICB2YXIgX2h0bWwgPSAkY2hlY2tlZC5wYXJlbnRzKDApLmh0bWwoKTtcbiAgZGF0YS4kaXRlbS5maW5kKCcuYnRuLXNlbGVjdGVkLW9wdGlvbicpLmh0bWwoX2h0bWwpO1xufTtcblxuVG9vbGJhci5wcm90b3R5cGUudG9vbHMub3B0aW9uID0ge1xuICBzY29wZTogZnVuY3Rpb24gKGRhdGEsIG9wdGlvbnMpIHtcbiAgICB2YXIgX3NlbGYgPSB0aGlzO1xuICAgIHJldHVybiB7XG4gICAgICBwYXJlbnRJZDogZGF0YS5wYXJlbnQuaWQsXG4gICAgICB2YWx1ZUN1cnJlbnQ6IGRhdGEucGFyZW50LnZhbHVlLmdldCgpID09PSBkYXRhLm9wdGlvbixcbiAgICAgIG9uY2hhbmdlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8v0L7Qv9GC0LjQvNC40LfQuNGA0L7QstCw0YLRjFxuXG4gICAgICAgIHZhciAkY2hlY2tlZCA9IGRhdGEuJGl0ZW0uZmluZChcIjpjaGVja2VkXCIpO1xuICAgICAgICB2YXIgX3ZhbHVlID0gJGNoZWNrZWQudmFsKCk7XG4gICAgICAgIGlmIChfdmFsdWUgPT0gZGF0YS5vcHRpb24pIHtcbiAgICAgICAgICBkYXRhLnBhcmVudC52YWx1ZS5zZXQoX3ZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgICBfc2VsZi51cGRhdGVTZWxlY3RlZE9wdGlvbihkYXRhLnBhcmVudCk7XG4gICAgICB9XG4gICAgfVxuICB9LFxuICB0ZW1wbGF0ZTpcbiAgICAnPGRpdiBjbGFzcz1cIm9iamVjdC1tZW51LWl0ZW0gb2JqZWN0LW1lbnUtb3B0aW9uIFwiIHRpdGxlPVwie3RpdGxlfVwiID4nICtcbiAgICAnPGlucHV0IHR5cGU9XCJyYWRpb1wiIGlkPVwidG9vbC17aWR9XCIgZHAtY2hlY2tlZD1cInt2YWx1ZUN1cnJlbnR9XCIgbmFtZT1cIntwYXJlbnRJZH1cIiB2YWx1ZT1cIntvcHRpb259XCIgb25jaGFuZ2U9XCJvbmNoYW5nZSgpXCI+JyArXG4gICAgJzxsYWJlbCBjbGFzcz1cImJ0biBidXR0b24te2lkfSB7Y2xhc3NOYW1lfVwiIGZvcj1cInRvb2wte2lkfVwiPicgK1xuICAgICAgJzxpbWcgZHAtaWY9XCJpY29uXCIgZHAtc3JjPVwiaWNvblwiPicgK1xuICAgICAgJzxzcGFuIGRwLWluY2x1ZGU9XCJzdmdcIiBkcC1pZj1cInN2Z1wiPjwvc3Bhbj4nICtcbiAgICAgICc8c3BhbiBkcC1pZj1cInRpdGxlXCIgY2xhc3M9XCJvcHRpb24tdGl0bGVcIj57dGl0bGV9PC9zcGFuPidcbn07XG5cblRvb2xiYXIucHJvdG90eXBlLnRvb2xzLm9wdGlvbnMgPSB7XG4gIHNjb3BlOiBmdW5jdGlvbiAoZGF0YSwgb3B0aW9ucykge1xuICAgIHJldHVybiB7XG4gICAgICBjbGFzc05hbWU6IGRhdGEuY2xhc3NOYW1lIHx8ICdpdGVtcy1jb2x1bW4nLFxuICAgICAgYnV0dG9uc1RpdGxlOiBvcHRpb25zLmJ1dHRvbnMgJiYgb3B0aW9ucy5idXR0b25zLnRpdGxlIHx8IGZhbHNlLFxuICAgICAgYnV0dG9uc0NsYXNzTmFtZTogKG9wdGlvbnMuYnV0dG9ucy5jbGFzc05hbWUgfHwgJycpXG4gICAgfVxuICB9LFxuICB0ZW1wbGF0ZTpcbiAgJzxkaXYgY2xhc3M9XCJvYmplY3QtbWVudS1pdGVtIG9iamVjdC1tZW51LW9wdGlvbnMge2NsYXNzTmFtZX1cIiB0aXRsZT1cInt0aXRsZX1cIj4nICtcbiAgJzxkaXYgY2xhc3M9XCJidG4gYnRuLXNlbGVjdGVkLW9wdGlvblwiPjwvZGl2PicgK1xuICAnPGRpdiBjbGFzcz1cIm9iamVjdC1tZW51LW9wdGlvbnMtY29udGFpbmVyXCIgdHJhbnNjbHVkZT4nLFxuICBwb3N0OiBmdW5jdGlvbiAoJGl0ZW0sIGRhdGEsIG9wdGlvbnMsIHRyYW5zY2x1ZGUpIHtcbiAgICB0aGlzLmdlbmVyYXRlTWVudShkYXRhLnRhcmdldCwgdHJhbnNjbHVkZSwgb3B0aW9ucywgZGF0YS5tZW51KTtcbiAgICB0aGlzLnVwZGF0ZVNlbGVjdGVkT3B0aW9uKGRhdGEpO1xuICB9XG59O1xuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9wbHVnaW5zL3Rvb2xiYXIub3B0aW9ucy5qc1xuLy8gbW9kdWxlIGlkID0gMTEyXG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIi8qIFdlYiBGb250IExvYWRlciB2MS42LjI2IC0gKGMpIEFkb2JlIFN5c3RlbXMsIEdvb2dsZS4gTGljZW5zZTogQXBhY2hlIDIuMCAqLyhmdW5jdGlvbigpe2Z1bmN0aW9uIGFhKGEsYixjKXtyZXR1cm4gYS5jYWxsLmFwcGx5KGEuYmluZCxhcmd1bWVudHMpfWZ1bmN0aW9uIGJhKGEsYixjKXtpZighYSl0aHJvdyBFcnJvcigpO2lmKDI8YXJndW1lbnRzLmxlbmd0aCl7dmFyIGQ9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLDIpO3JldHVybiBmdW5jdGlvbigpe3ZhciBjPUFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cyk7QXJyYXkucHJvdG90eXBlLnVuc2hpZnQuYXBwbHkoYyxkKTtyZXR1cm4gYS5hcHBseShiLGMpfX1yZXR1cm4gZnVuY3Rpb24oKXtyZXR1cm4gYS5hcHBseShiLGFyZ3VtZW50cyl9fWZ1bmN0aW9uIHAoYSxiLGMpe3A9RnVuY3Rpb24ucHJvdG90eXBlLmJpbmQmJi0xIT1GdW5jdGlvbi5wcm90b3R5cGUuYmluZC50b1N0cmluZygpLmluZGV4T2YoXCJuYXRpdmUgY29kZVwiKT9hYTpiYTtyZXR1cm4gcC5hcHBseShudWxsLGFyZ3VtZW50cyl9dmFyIHE9RGF0ZS5ub3d8fGZ1bmN0aW9uKCl7cmV0dXJuK25ldyBEYXRlfTtmdW5jdGlvbiBjYShhLGIpe3RoaXMuYT1hO3RoaXMubT1ifHxhO3RoaXMuYz10aGlzLm0uZG9jdW1lbnR9dmFyIGRhPSEhd2luZG93LkZvbnRGYWNlO2Z1bmN0aW9uIHQoYSxiLGMsZCl7Yj1hLmMuY3JlYXRlRWxlbWVudChiKTtpZihjKWZvcih2YXIgZSBpbiBjKWMuaGFzT3duUHJvcGVydHkoZSkmJihcInN0eWxlXCI9PWU/Yi5zdHlsZS5jc3NUZXh0PWNbZV06Yi5zZXRBdHRyaWJ1dGUoZSxjW2VdKSk7ZCYmYi5hcHBlbmRDaGlsZChhLmMuY3JlYXRlVGV4dE5vZGUoZCkpO3JldHVybiBifWZ1bmN0aW9uIHUoYSxiLGMpe2E9YS5jLmdldEVsZW1lbnRzQnlUYWdOYW1lKGIpWzBdO2F8fChhPWRvY3VtZW50LmRvY3VtZW50RWxlbWVudCk7YS5pbnNlcnRCZWZvcmUoYyxhLmxhc3RDaGlsZCl9ZnVuY3Rpb24gdihhKXthLnBhcmVudE5vZGUmJmEucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChhKX1cbiAgZnVuY3Rpb24gdyhhLGIsYyl7Yj1ifHxbXTtjPWN8fFtdO2Zvcih2YXIgZD1hLmNsYXNzTmFtZS5zcGxpdCgvXFxzKy8pLGU9MDtlPGIubGVuZ3RoO2UrPTEpe2Zvcih2YXIgZj0hMSxnPTA7ZzxkLmxlbmd0aDtnKz0xKWlmKGJbZV09PT1kW2ddKXtmPSEwO2JyZWFrfWZ8fGQucHVzaChiW2VdKX1iPVtdO2ZvcihlPTA7ZTxkLmxlbmd0aDtlKz0xKXtmPSExO2ZvcihnPTA7ZzxjLmxlbmd0aDtnKz0xKWlmKGRbZV09PT1jW2ddKXtmPSEwO2JyZWFrfWZ8fGIucHVzaChkW2VdKX1hLmNsYXNzTmFtZT1iLmpvaW4oXCIgXCIpLnJlcGxhY2UoL1xccysvZyxcIiBcIikucmVwbGFjZSgvXlxccyt8XFxzKyQvLFwiXCIpfWZ1bmN0aW9uIHkoYSxiKXtmb3IodmFyIGM9YS5jbGFzc05hbWUuc3BsaXQoL1xccysvKSxkPTAsZT1jLmxlbmd0aDtkPGU7ZCsrKWlmKGNbZF09PWIpcmV0dXJuITA7cmV0dXJuITF9XG4gIGZ1bmN0aW9uIHooYSl7aWYoXCJzdHJpbmdcIj09PXR5cGVvZiBhLmYpcmV0dXJuIGEuZjt2YXIgYj1hLm0ubG9jYXRpb24ucHJvdG9jb2w7XCJhYm91dDpcIj09YiYmKGI9YS5hLmxvY2F0aW9uLnByb3RvY29sKTtyZXR1cm5cImh0dHBzOlwiPT1iP1wiaHR0cHM6XCI6XCJodHRwOlwifWZ1bmN0aW9uIGVhKGEpe3JldHVybiBhLm0ubG9jYXRpb24uaG9zdG5hbWV8fGEuYS5sb2NhdGlvbi5ob3N0bmFtZX1cbiAgZnVuY3Rpb24gQShhLGIsYyl7ZnVuY3Rpb24gZCgpe2smJmUmJmYmJihrKGcpLGs9bnVsbCl9Yj10KGEsXCJsaW5rXCIse3JlbDpcInN0eWxlc2hlZXRcIixocmVmOmIsbWVkaWE6XCJhbGxcIn0pO3ZhciBlPSExLGY9ITAsZz1udWxsLGs9Y3x8bnVsbDtkYT8oYi5vbmxvYWQ9ZnVuY3Rpb24oKXtlPSEwO2QoKX0sYi5vbmVycm9yPWZ1bmN0aW9uKCl7ZT0hMDtnPUVycm9yKFwiU3R5bGVzaGVldCBmYWlsZWQgdG8gbG9hZFwiKTtkKCl9KTpzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7ZT0hMDtkKCl9LDApO3UoYSxcImhlYWRcIixiKX1cbiAgZnVuY3Rpb24gQihhLGIsYyxkKXt2YXIgZT1hLmMuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJoZWFkXCIpWzBdO2lmKGUpe3ZhciBmPXQoYSxcInNjcmlwdFwiLHtzcmM6Yn0pLGc9ITE7Zi5vbmxvYWQ9Zi5vbnJlYWR5c3RhdGVjaGFuZ2U9ZnVuY3Rpb24oKXtnfHx0aGlzLnJlYWR5U3RhdGUmJlwibG9hZGVkXCIhPXRoaXMucmVhZHlTdGF0ZSYmXCJjb21wbGV0ZVwiIT10aGlzLnJlYWR5U3RhdGV8fChnPSEwLGMmJmMobnVsbCksZi5vbmxvYWQ9Zi5vbnJlYWR5c3RhdGVjaGFuZ2U9bnVsbCxcIkhFQURcIj09Zi5wYXJlbnROb2RlLnRhZ05hbWUmJmUucmVtb3ZlQ2hpbGQoZikpfTtlLmFwcGVuZENoaWxkKGYpO3NldFRpbWVvdXQoZnVuY3Rpb24oKXtnfHwoZz0hMCxjJiZjKEVycm9yKFwiU2NyaXB0IGxvYWQgdGltZW91dFwiKSkpfSxkfHw1RTMpO3JldHVybiBmfXJldHVybiBudWxsfTtmdW5jdGlvbiBDKCl7dGhpcy5hPTA7dGhpcy5jPW51bGx9ZnVuY3Rpb24gRChhKXthLmErKztyZXR1cm4gZnVuY3Rpb24oKXthLmEtLTtFKGEpfX1mdW5jdGlvbiBGKGEsYil7YS5jPWI7RShhKX1mdW5jdGlvbiBFKGEpezA9PWEuYSYmYS5jJiYoYS5jKCksYS5jPW51bGwpfTtmdW5jdGlvbiBHKGEpe3RoaXMuYT1hfHxcIi1cIn1HLnByb3RvdHlwZS5jPWZ1bmN0aW9uKGEpe2Zvcih2YXIgYj1bXSxjPTA7Yzxhcmd1bWVudHMubGVuZ3RoO2MrKyliLnB1c2goYXJndW1lbnRzW2NdLnJlcGxhY2UoL1tcXFdfXSsvZyxcIlwiKS50b0xvd2VyQ2FzZSgpKTtyZXR1cm4gYi5qb2luKHRoaXMuYSl9O2Z1bmN0aW9uIEgoYSxiKXt0aGlzLmM9YTt0aGlzLmY9NDt0aGlzLmE9XCJuXCI7dmFyIGM9KGJ8fFwibjRcIikubWF0Y2goL14oW25pb10pKFsxLTldKSQvaSk7YyYmKHRoaXMuYT1jWzFdLHRoaXMuZj1wYXJzZUludChjWzJdLDEwKSl9ZnVuY3Rpb24gZmEoYSl7cmV0dXJuIEkoYSkrXCIgXCIrKGEuZitcIjAwXCIpK1wiIDMwMHB4IFwiK0ooYS5jKX1mdW5jdGlvbiBKKGEpe3ZhciBiPVtdO2E9YS5zcGxpdCgvLFxccyovKTtmb3IodmFyIGM9MDtjPGEubGVuZ3RoO2MrKyl7dmFyIGQ9YVtjXS5yZXBsYWNlKC9bJ1wiXS9nLFwiXCIpOy0xIT1kLmluZGV4T2YoXCIgXCIpfHwvXlxcZC8udGVzdChkKT9iLnB1c2goXCInXCIrZCtcIidcIik6Yi5wdXNoKGQpfXJldHVybiBiLmpvaW4oXCIsXCIpfWZ1bmN0aW9uIEsoYSl7cmV0dXJuIGEuYSthLmZ9ZnVuY3Rpb24gSShhKXt2YXIgYj1cIm5vcm1hbFwiO1wib1wiPT09YS5hP2I9XCJvYmxpcXVlXCI6XCJpXCI9PT1hLmEmJihiPVwiaXRhbGljXCIpO3JldHVybiBifVxuICBmdW5jdGlvbiBnYShhKXt2YXIgYj00LGM9XCJuXCIsZD1udWxsO2EmJigoZD1hLm1hdGNoKC8obm9ybWFsfG9ibGlxdWV8aXRhbGljKS9pKSkmJmRbMV0mJihjPWRbMV0uc3Vic3RyKDAsMSkudG9Mb3dlckNhc2UoKSksKGQ9YS5tYXRjaCgvKFsxLTldMDB8bm9ybWFsfGJvbGQpL2kpKSYmZFsxXSYmKC9ib2xkL2kudGVzdChkWzFdKT9iPTc6L1sxLTldMDAvLnRlc3QoZFsxXSkmJihiPXBhcnNlSW50KGRbMV0uc3Vic3RyKDAsMSksMTApKSkpO3JldHVybiBjK2J9O2Z1bmN0aW9uIGhhKGEsYil7dGhpcy5jPWE7dGhpcy5mPWEubS5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7dGhpcy5oPWI7dGhpcy5hPW5ldyBHKFwiLVwiKTt0aGlzLmo9ITEhPT1iLmV2ZW50czt0aGlzLmc9ITEhPT1iLmNsYXNzZXN9ZnVuY3Rpb24gaWEoYSl7YS5nJiZ3KGEuZixbYS5hLmMoXCJ3ZlwiLFwibG9hZGluZ1wiKV0pO0woYSxcImxvYWRpbmdcIil9ZnVuY3Rpb24gTShhKXtpZihhLmcpe3ZhciBiPXkoYS5mLGEuYS5jKFwid2ZcIixcImFjdGl2ZVwiKSksYz1bXSxkPVthLmEuYyhcIndmXCIsXCJsb2FkaW5nXCIpXTtifHxjLnB1c2goYS5hLmMoXCJ3ZlwiLFwiaW5hY3RpdmVcIikpO3coYS5mLGMsZCl9TChhLFwiaW5hY3RpdmVcIil9ZnVuY3Rpb24gTChhLGIsYyl7aWYoYS5qJiZhLmhbYl0paWYoYylhLmhbYl0oYy5jLEsoYykpO2Vsc2UgYS5oW2JdKCl9O2Z1bmN0aW9uIGphKCl7dGhpcy5jPXt9fWZ1bmN0aW9uIGthKGEsYixjKXt2YXIgZD1bXSxlO2ZvcihlIGluIGIpaWYoYi5oYXNPd25Qcm9wZXJ0eShlKSl7dmFyIGY9YS5jW2VdO2YmJmQucHVzaChmKGJbZV0sYykpfXJldHVybiBkfTtmdW5jdGlvbiBOKGEsYil7dGhpcy5jPWE7dGhpcy5mPWI7dGhpcy5hPXQodGhpcy5jLFwic3BhblwiLHtcImFyaWEtaGlkZGVuXCI6XCJ0cnVlXCJ9LHRoaXMuZil9ZnVuY3Rpb24gTyhhKXt1KGEuYyxcImJvZHlcIixhLmEpfWZ1bmN0aW9uIFAoYSl7cmV0dXJuXCJkaXNwbGF5OmJsb2NrO3Bvc2l0aW9uOmFic29sdXRlO3RvcDotOTk5OXB4O2xlZnQ6LTk5OTlweDtmb250LXNpemU6MzAwcHg7d2lkdGg6YXV0bztoZWlnaHQ6YXV0bztsaW5lLWhlaWdodDpub3JtYWw7bWFyZ2luOjA7cGFkZGluZzowO2ZvbnQtdmFyaWFudDpub3JtYWw7d2hpdGUtc3BhY2U6bm93cmFwO2ZvbnQtZmFtaWx5OlwiK0ooYS5jKStcIjtcIisoXCJmb250LXN0eWxlOlwiK0koYSkrXCI7Zm9udC13ZWlnaHQ6XCIrKGEuZitcIjAwXCIpK1wiO1wiKX07ZnVuY3Rpb24gUShhLGIsYyxkLGUsZil7dGhpcy5nPWE7dGhpcy5qPWI7dGhpcy5hPWQ7dGhpcy5jPWM7dGhpcy5mPWV8fDNFMzt0aGlzLmg9Znx8dm9pZCAwfVEucHJvdG90eXBlLnN0YXJ0PWZ1bmN0aW9uKCl7dmFyIGE9dGhpcy5jLm0uZG9jdW1lbnQsYj10aGlzLGM9cSgpLGQ9bmV3IFByb21pc2UoZnVuY3Rpb24oZCxlKXtmdW5jdGlvbiBrKCl7cSgpLWM+PWIuZj9lKCk6YS5mb250cy5sb2FkKGZhKGIuYSksYi5oKS50aGVuKGZ1bmN0aW9uKGEpezE8PWEubGVuZ3RoP2QoKTpzZXRUaW1lb3V0KGssMjUpfSxmdW5jdGlvbigpe2UoKX0pfWsoKX0pLGU9bmV3IFByb21pc2UoZnVuY3Rpb24oYSxkKXtzZXRUaW1lb3V0KGQsYi5mKX0pO1Byb21pc2UucmFjZShbZSxkXSkudGhlbihmdW5jdGlvbigpe2IuZyhiLmEpfSxmdW5jdGlvbigpe2IuaihiLmEpfSl9O2Z1bmN0aW9uIFIoYSxiLGMsZCxlLGYsZyl7dGhpcy52PWE7dGhpcy5CPWI7dGhpcy5jPWM7dGhpcy5hPWQ7dGhpcy5zPWd8fFwiQkVTYnN3eVwiO3RoaXMuZj17fTt0aGlzLnc9ZXx8M0UzO3RoaXMudT1mfHxudWxsO3RoaXMubz10aGlzLmo9dGhpcy5oPXRoaXMuZz1udWxsO3RoaXMuZz1uZXcgTih0aGlzLmMsdGhpcy5zKTt0aGlzLmg9bmV3IE4odGhpcy5jLHRoaXMucyk7dGhpcy5qPW5ldyBOKHRoaXMuYyx0aGlzLnMpO3RoaXMubz1uZXcgTih0aGlzLmMsdGhpcy5zKTthPW5ldyBIKHRoaXMuYS5jK1wiLHNlcmlmXCIsSyh0aGlzLmEpKTthPVAoYSk7dGhpcy5nLmEuc3R5bGUuY3NzVGV4dD1hO2E9bmV3IEgodGhpcy5hLmMrXCIsc2Fucy1zZXJpZlwiLEsodGhpcy5hKSk7YT1QKGEpO3RoaXMuaC5hLnN0eWxlLmNzc1RleHQ9YTthPW5ldyBIKFwic2VyaWZcIixLKHRoaXMuYSkpO2E9UChhKTt0aGlzLmouYS5zdHlsZS5jc3NUZXh0PWE7YT1uZXcgSChcInNhbnMtc2VyaWZcIixLKHRoaXMuYSkpO2E9XG4gICAgUChhKTt0aGlzLm8uYS5zdHlsZS5jc3NUZXh0PWE7Tyh0aGlzLmcpO08odGhpcy5oKTtPKHRoaXMuaik7Tyh0aGlzLm8pfXZhciBTPXtEOlwic2VyaWZcIixDOlwic2Fucy1zZXJpZlwifSxUPW51bGw7ZnVuY3Rpb24gVSgpe2lmKG51bGw9PT1UKXt2YXIgYT0vQXBwbGVXZWJLaXRcXC8oWzAtOV0rKSg/OlxcLihbMC05XSspKS8uZXhlYyh3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudCk7VD0hIWEmJig1MzY+cGFyc2VJbnQoYVsxXSwxMCl8fDUzNj09PXBhcnNlSW50KGFbMV0sMTApJiYxMT49cGFyc2VJbnQoYVsyXSwxMCkpfXJldHVybiBUfVIucHJvdG90eXBlLnN0YXJ0PWZ1bmN0aW9uKCl7dGhpcy5mLnNlcmlmPXRoaXMuai5hLm9mZnNldFdpZHRoO3RoaXMuZltcInNhbnMtc2VyaWZcIl09dGhpcy5vLmEub2Zmc2V0V2lkdGg7dGhpcy5BPXEoKTtsYSh0aGlzKX07XG4gIGZ1bmN0aW9uIG1hKGEsYixjKXtmb3IodmFyIGQgaW4gUylpZihTLmhhc093blByb3BlcnR5KGQpJiZiPT09YS5mW1NbZF1dJiZjPT09YS5mW1NbZF1dKXJldHVybiEwO3JldHVybiExfWZ1bmN0aW9uIGxhKGEpe3ZhciBiPWEuZy5hLm9mZnNldFdpZHRoLGM9YS5oLmEub2Zmc2V0V2lkdGgsZDsoZD1iPT09YS5mLnNlcmlmJiZjPT09YS5mW1wic2Fucy1zZXJpZlwiXSl8fChkPVUoKSYmbWEoYSxiLGMpKTtkP3EoKS1hLkE+PWEudz9VKCkmJm1hKGEsYixjKSYmKG51bGw9PT1hLnV8fGEudS5oYXNPd25Qcm9wZXJ0eShhLmEuYykpP1YoYSxhLnYpOlYoYSxhLkIpOm5hKGEpOlYoYSxhLnYpfWZ1bmN0aW9uIG5hKGEpe3NldFRpbWVvdXQocChmdW5jdGlvbigpe2xhKHRoaXMpfSxhKSw1MCl9ZnVuY3Rpb24gVihhLGIpe3NldFRpbWVvdXQocChmdW5jdGlvbigpe3YodGhpcy5nLmEpO3YodGhpcy5oLmEpO3YodGhpcy5qLmEpO3YodGhpcy5vLmEpO2IodGhpcy5hKX0sYSksMCl9O2Z1bmN0aW9uIFcoYSxiLGMpe3RoaXMuYz1hO3RoaXMuYT1iO3RoaXMuZj0wO3RoaXMubz10aGlzLmo9ITE7dGhpcy5zPWN9dmFyIFg9bnVsbDtXLnByb3RvdHlwZS5nPWZ1bmN0aW9uKGEpe3ZhciBiPXRoaXMuYTtiLmcmJncoYi5mLFtiLmEuYyhcIndmXCIsYS5jLEsoYSkudG9TdHJpbmcoKSxcImFjdGl2ZVwiKV0sW2IuYS5jKFwid2ZcIixhLmMsSyhhKS50b1N0cmluZygpLFwibG9hZGluZ1wiKSxiLmEuYyhcIndmXCIsYS5jLEsoYSkudG9TdHJpbmcoKSxcImluYWN0aXZlXCIpXSk7TChiLFwiZm9udGFjdGl2ZVwiLGEpO3RoaXMubz0hMDtvYSh0aGlzKX07XG4gIFcucHJvdG90eXBlLmg9ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5hO2lmKGIuZyl7dmFyIGM9eShiLmYsYi5hLmMoXCJ3ZlwiLGEuYyxLKGEpLnRvU3RyaW5nKCksXCJhY3RpdmVcIikpLGQ9W10sZT1bYi5hLmMoXCJ3ZlwiLGEuYyxLKGEpLnRvU3RyaW5nKCksXCJsb2FkaW5nXCIpXTtjfHxkLnB1c2goYi5hLmMoXCJ3ZlwiLGEuYyxLKGEpLnRvU3RyaW5nKCksXCJpbmFjdGl2ZVwiKSk7dyhiLmYsZCxlKX1MKGIsXCJmb250aW5hY3RpdmVcIixhKTtvYSh0aGlzKX07ZnVuY3Rpb24gb2EoYSl7MD09LS1hLmYmJmEuaiYmKGEubz8oYT1hLmEsYS5nJiZ3KGEuZixbYS5hLmMoXCJ3ZlwiLFwiYWN0aXZlXCIpXSxbYS5hLmMoXCJ3ZlwiLFwibG9hZGluZ1wiKSxhLmEuYyhcIndmXCIsXCJpbmFjdGl2ZVwiKV0pLEwoYSxcImFjdGl2ZVwiKSk6TShhLmEpKX07ZnVuY3Rpb24gcGEoYSl7dGhpcy5qPWE7dGhpcy5hPW5ldyBqYTt0aGlzLmg9MDt0aGlzLmY9dGhpcy5nPSEwfXBhLnByb3RvdHlwZS5sb2FkPWZ1bmN0aW9uKGEpe3RoaXMuYz1uZXcgY2EodGhpcy5qLGEuY29udGV4dHx8dGhpcy5qKTt0aGlzLmc9ITEhPT1hLmV2ZW50czt0aGlzLmY9ITEhPT1hLmNsYXNzZXM7cWEodGhpcyxuZXcgaGEodGhpcy5jLGEpLGEpfTtcbiAgZnVuY3Rpb24gcmEoYSxiLGMsZCxlKXt2YXIgZj0wPT0tLWEuaDsoYS5mfHxhLmcpJiZzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7dmFyIGE9ZXx8bnVsbCxrPWR8fG51bGx8fHt9O2lmKDA9PT1jLmxlbmd0aCYmZilNKGIuYSk7ZWxzZXtiLmYrPWMubGVuZ3RoO2YmJihiLmo9Zik7dmFyIGgsbT1bXTtmb3IoaD0wO2g8Yy5sZW5ndGg7aCsrKXt2YXIgbD1jW2hdLG49a1tsLmNdLHI9Yi5hLHg9bDtyLmcmJncoci5mLFtyLmEuYyhcIndmXCIseC5jLEsoeCkudG9TdHJpbmcoKSxcImxvYWRpbmdcIildKTtMKHIsXCJmb250bG9hZGluZ1wiLHgpO3I9bnVsbDtudWxsPT09WCYmKFg9d2luZG93LkZvbnRGYWNlPyh4PS9HZWNrby4qRmlyZWZveFxcLyhcXGQrKS8uZXhlYyh3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudCkpPzQyPHBhcnNlSW50KHhbMV0sMTApOiEwOiExKTtYP3I9bmV3IFEocChiLmcsYikscChiLmgsYiksYi5jLGwsYi5zLG4pOnI9bmV3IFIocChiLmcsYikscChiLmgsYiksYi5jLGwsYi5zLGEsXG4gICAgbik7bS5wdXNoKHIpfWZvcihoPTA7aDxtLmxlbmd0aDtoKyspbVtoXS5zdGFydCgpfX0sMCl9ZnVuY3Rpb24gcWEoYSxiLGMpe3ZhciBkPVtdLGU9Yy50aW1lb3V0O2lhKGIpO3ZhciBkPWthKGEuYSxjLGEuYyksZj1uZXcgVyhhLmMsYixlKTthLmg9ZC5sZW5ndGg7Yj0wO2ZvcihjPWQubGVuZ3RoO2I8YztiKyspZFtiXS5sb2FkKGZ1bmN0aW9uKGIsZCxjKXtyYShhLGYsYixkLGMpfSl9O2Z1bmN0aW9uIHNhKGEsYil7dGhpcy5jPWE7dGhpcy5hPWJ9ZnVuY3Rpb24gdGEoYSxiLGMpe3ZhciBkPXooYS5jKTthPShhLmEuYXBpfHxcImZhc3QuZm9udHMubmV0L2pzYXBpXCIpLnJlcGxhY2UoL14uKmh0dHAocz8pOihcXC9cXC8pPy8sXCJcIik7cmV0dXJuIGQrXCIvL1wiK2ErXCIvXCIrYitcIi5qc1wiKyhjP1wiP3Y9XCIrYzpcIlwiKX1cbiAgc2EucHJvdG90eXBlLmxvYWQ9ZnVuY3Rpb24oYSl7ZnVuY3Rpb24gYigpe2lmKGZbXCJfX210aV9mbnRMc3RcIitkXSl7dmFyIGM9ZltcIl9fbXRpX2ZudExzdFwiK2RdKCksZT1bXSxoO2lmKGMpZm9yKHZhciBtPTA7bTxjLmxlbmd0aDttKyspe3ZhciBsPWNbbV0uZm9udGZhbWlseTt2b2lkIDAhPWNbbV0uZm9udFN0eWxlJiZ2b2lkIDAhPWNbbV0uZm9udFdlaWdodD8oaD1jW21dLmZvbnRTdHlsZStjW21dLmZvbnRXZWlnaHQsZS5wdXNoKG5ldyBIKGwsaCkpKTplLnB1c2gobmV3IEgobCkpfWEoZSl9ZWxzZSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7YigpfSw1MCl9dmFyIGM9dGhpcyxkPWMuYS5wcm9qZWN0SWQsZT1jLmEudmVyc2lvbjtpZihkKXt2YXIgZj1jLmMubTtCKHRoaXMuYyx0YShjLGQsZSksZnVuY3Rpb24oZSl7ZT9hKFtdKTooZltcIl9fTW9ub3R5cGVDb25maWd1cmF0aW9uX19cIitkXT1mdW5jdGlvbigpe3JldHVybiBjLmF9LGIoKSl9KS5pZD1cIl9fTW9ub3R5cGVBUElTY3JpcHRfX1wiK1xuICAgIGR9ZWxzZSBhKFtdKX07ZnVuY3Rpb24gdWEoYSxiKXt0aGlzLmM9YTt0aGlzLmE9Yn11YS5wcm90b3R5cGUubG9hZD1mdW5jdGlvbihhKXt2YXIgYixjLGQ9dGhpcy5hLnVybHN8fFtdLGU9dGhpcy5hLmZhbWlsaWVzfHxbXSxmPXRoaXMuYS50ZXN0U3RyaW5nc3x8e30sZz1uZXcgQztiPTA7Zm9yKGM9ZC5sZW5ndGg7YjxjO2IrKylBKHRoaXMuYyxkW2JdLEQoZykpO3ZhciBrPVtdO2I9MDtmb3IoYz1lLmxlbmd0aDtiPGM7YisrKWlmKGQ9ZVtiXS5zcGxpdChcIjpcIiksZFsxXSlmb3IodmFyIGg9ZFsxXS5zcGxpdChcIixcIiksbT0wO208aC5sZW5ndGg7bSs9MSlrLnB1c2gobmV3IEgoZFswXSxoW21dKSk7ZWxzZSBrLnB1c2gobmV3IEgoZFswXSkpO0YoZyxmdW5jdGlvbigpe2EoayxmKX0pfTtmdW5jdGlvbiB2YShhLGIsYyl7YT90aGlzLmM9YTp0aGlzLmM9Yit3YTt0aGlzLmE9W107dGhpcy5mPVtdO3RoaXMuZz1jfHxcIlwifXZhciB3YT1cIi8vZm9udHMuZ29vZ2xlYXBpcy5jb20vY3NzXCI7ZnVuY3Rpb24geGEoYSxiKXtmb3IodmFyIGM9Yi5sZW5ndGgsZD0wO2Q8YztkKyspe3ZhciBlPWJbZF0uc3BsaXQoXCI6XCIpOzM9PWUubGVuZ3RoJiZhLmYucHVzaChlLnBvcCgpKTt2YXIgZj1cIlwiOzI9PWUubGVuZ3RoJiZcIlwiIT1lWzFdJiYoZj1cIjpcIik7YS5hLnB1c2goZS5qb2luKGYpKX19XG4gIGZ1bmN0aW9uIHlhKGEpe2lmKDA9PWEuYS5sZW5ndGgpdGhyb3cgRXJyb3IoXCJObyBmb250cyB0byBsb2FkIVwiKTtpZigtMSE9YS5jLmluZGV4T2YoXCJraXQ9XCIpKXJldHVybiBhLmM7Zm9yKHZhciBiPWEuYS5sZW5ndGgsYz1bXSxkPTA7ZDxiO2QrKyljLnB1c2goYS5hW2RdLnJlcGxhY2UoLyAvZyxcIitcIikpO2I9YS5jK1wiP2ZhbWlseT1cIitjLmpvaW4oXCIlN0NcIik7MDxhLmYubGVuZ3RoJiYoYis9XCImc3Vic2V0PVwiK2EuZi5qb2luKFwiLFwiKSk7MDxhLmcubGVuZ3RoJiYoYis9XCImdGV4dD1cIitlbmNvZGVVUklDb21wb25lbnQoYS5nKSk7cmV0dXJuIGJ9O2Z1bmN0aW9uIHphKGEpe3RoaXMuZj1hO3RoaXMuYT1bXTt0aGlzLmM9e319XG4gIHZhciBBYT17bGF0aW46XCJCRVNic3d5XCIsXCJsYXRpbi1leHRcIjpcIlxcdTAwZTdcXHUwMGY2XFx1MDBmY1xcdTAxMWZcXHUwMTVmXCIsY3lyaWxsaWM6XCJcXHUwNDM5XFx1MDQ0ZlxcdTA0MTZcIixncmVlazpcIlxcdTAzYjFcXHUwM2IyXFx1MDNhM1wiLGtobWVyOlwiXFx1MTc4MFxcdTE3ODFcXHUxNzgyXCIsSGFudW1hbjpcIlxcdTE3ODBcXHUxNzgxXFx1MTc4MlwifSxCYT17dGhpbjpcIjFcIixleHRyYWxpZ2h0OlwiMlwiLFwiZXh0cmEtbGlnaHRcIjpcIjJcIix1bHRyYWxpZ2h0OlwiMlwiLFwidWx0cmEtbGlnaHRcIjpcIjJcIixsaWdodDpcIjNcIixyZWd1bGFyOlwiNFwiLGJvb2s6XCI0XCIsbWVkaXVtOlwiNVwiLFwic2VtaS1ib2xkXCI6XCI2XCIsc2VtaWJvbGQ6XCI2XCIsXCJkZW1pLWJvbGRcIjpcIjZcIixkZW1pYm9sZDpcIjZcIixib2xkOlwiN1wiLFwiZXh0cmEtYm9sZFwiOlwiOFwiLGV4dHJhYm9sZDpcIjhcIixcInVsdHJhLWJvbGRcIjpcIjhcIix1bHRyYWJvbGQ6XCI4XCIsYmxhY2s6XCI5XCIsaGVhdnk6XCI5XCIsbDpcIjNcIixyOlwiNFwiLGI6XCI3XCJ9LENhPXtpOlwiaVwiLGl0YWxpYzpcImlcIixuOlwiblwiLG5vcm1hbDpcIm5cIn0sXG4gICAgRGE9L14odGhpbnwoPzooPzpleHRyYXx1bHRyYSktPyk/bGlnaHR8cmVndWxhcnxib29rfG1lZGl1bXwoPzooPzpzZW1pfGRlbWl8ZXh0cmF8dWx0cmEpLT8pP2JvbGR8YmxhY2t8aGVhdnl8bHxyfGJ8WzEtOV0wMCk/KG58aXxub3JtYWx8aXRhbGljKT8kLztcbiAgZnVuY3Rpb24gRWEoYSl7Zm9yKHZhciBiPWEuZi5sZW5ndGgsYz0wO2M8YjtjKyspe3ZhciBkPWEuZltjXS5zcGxpdChcIjpcIiksZT1kWzBdLnJlcGxhY2UoL1xcKy9nLFwiIFwiKSxmPVtcIm40XCJdO2lmKDI8PWQubGVuZ3RoKXt2YXIgZzt2YXIgaz1kWzFdO2c9W107aWYoaylmb3IodmFyIGs9ay5zcGxpdChcIixcIiksaD1rLmxlbmd0aCxtPTA7bTxoO20rKyl7dmFyIGw7bD1rW21dO2lmKGwubWF0Y2goL15bXFx3LV0rJC8pKXt2YXIgbj1EYS5leGVjKGwudG9Mb3dlckNhc2UoKSk7aWYobnVsbD09bilsPVwiXCI7ZWxzZXtsPW5bMl07bD1udWxsPT1sfHxcIlwiPT1sP1wiblwiOkNhW2xdO249blsxXTtpZihudWxsPT1ufHxcIlwiPT1uKW49XCI0XCI7ZWxzZSB2YXIgcj1CYVtuXSxuPXI/cjppc05hTihuKT9cIjRcIjpuLnN1YnN0cigwLDEpO2w9W2wsbl0uam9pbihcIlwiKX19ZWxzZSBsPVwiXCI7bCYmZy5wdXNoKGwpfTA8Zy5sZW5ndGgmJihmPWcpOzM9PWQubGVuZ3RoJiYoZD1kWzJdLGc9W10sZD1kP2Quc3BsaXQoXCIsXCIpOlxuICAgIGcsMDxkLmxlbmd0aCYmKGQ9QWFbZFswXV0pJiYoYS5jW2VdPWQpKX1hLmNbZV18fChkPUFhW2VdKSYmKGEuY1tlXT1kKTtmb3IoZD0wO2Q8Zi5sZW5ndGg7ZCs9MSlhLmEucHVzaChuZXcgSChlLGZbZF0pKX19O2Z1bmN0aW9uIEZhKGEsYil7dGhpcy5jPWE7dGhpcy5hPWJ9dmFyIEdhPXtBcmltbzohMCxDb3VzaW5lOiEwLFRpbm9zOiEwfTtGYS5wcm90b3R5cGUubG9hZD1mdW5jdGlvbihhKXt2YXIgYj1uZXcgQyxjPXRoaXMuYyxkPW5ldyB2YSh0aGlzLmEuYXBpLHooYyksdGhpcy5hLnRleHQpLGU9dGhpcy5hLmZhbWlsaWVzO3hhKGQsZSk7dmFyIGY9bmV3IHphKGUpO0VhKGYpO0EoYyx5YShkKSxEKGIpKTtGKGIsZnVuY3Rpb24oKXthKGYuYSxmLmMsR2EpfSl9O2Z1bmN0aW9uIEhhKGEsYil7dGhpcy5jPWE7dGhpcy5hPWJ9SGEucHJvdG90eXBlLmxvYWQ9ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5hLmlkLGM9dGhpcy5jLm07Yj9CKHRoaXMuYywodGhpcy5hLmFwaXx8XCJodHRwczovL3VzZS50eXBla2l0Lm5ldFwiKStcIi9cIitiK1wiLmpzXCIsZnVuY3Rpb24oYil7aWYoYilhKFtdKTtlbHNlIGlmKGMuVHlwZWtpdCYmYy5UeXBla2l0LmNvbmZpZyYmYy5UeXBla2l0LmNvbmZpZy5mbil7Yj1jLlR5cGVraXQuY29uZmlnLmZuO2Zvcih2YXIgZT1bXSxmPTA7ZjxiLmxlbmd0aDtmKz0yKWZvcih2YXIgZz1iW2ZdLGs9YltmKzFdLGg9MDtoPGsubGVuZ3RoO2grKyllLnB1c2gobmV3IEgoZyxrW2hdKSk7dHJ5e2MuVHlwZWtpdC5sb2FkKHtldmVudHM6ITEsY2xhc3NlczohMSxhc3luYzohMH0pfWNhdGNoKG0pe31hKGUpfX0sMkUzKTphKFtdKX07ZnVuY3Rpb24gSWEoYSxiKXt0aGlzLmM9YTt0aGlzLmY9Yjt0aGlzLmE9W119SWEucHJvdG90eXBlLmxvYWQ9ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcy5mLmlkLGM9dGhpcy5jLm0sZD10aGlzO2I/KGMuX193ZWJmb250Zm9udGRlY2ttb2R1bGVfX3x8KGMuX193ZWJmb250Zm9udGRlY2ttb2R1bGVfXz17fSksYy5fX3dlYmZvbnRmb250ZGVja21vZHVsZV9fW2JdPWZ1bmN0aW9uKGIsYyl7Zm9yKHZhciBnPTAsaz1jLmZvbnRzLmxlbmd0aDtnPGs7KytnKXt2YXIgaD1jLmZvbnRzW2ddO2QuYS5wdXNoKG5ldyBIKGgubmFtZSxnYShcImZvbnQtd2VpZ2h0OlwiK2gud2VpZ2h0K1wiO2ZvbnQtc3R5bGU6XCIraC5zdHlsZSkpKX1hKGQuYSl9LEIodGhpcy5jLHoodGhpcy5jKSsodGhpcy5mLmFwaXx8XCIvL2YuZm9udGRlY2suY29tL3MvY3NzL2pzL1wiKStlYSh0aGlzLmMpK1wiL1wiK2IrXCIuanNcIixmdW5jdGlvbihiKXtiJiZhKFtdKX0pKTphKFtdKX07dmFyIFk9bmV3IHBhKHdpbmRvdyk7WS5hLmMuY3VzdG9tPWZ1bmN0aW9uKGEsYil7cmV0dXJuIG5ldyB1YShiLGEpfTtZLmEuYy5mb250ZGVjaz1mdW5jdGlvbihhLGIpe3JldHVybiBuZXcgSWEoYixhKX07WS5hLmMubW9ub3R5cGU9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gbmV3IHNhKGIsYSl9O1kuYS5jLnR5cGVraXQ9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gbmV3IEhhKGIsYSl9O1kuYS5jLmdvb2dsZT1mdW5jdGlvbihhLGIpe3JldHVybiBuZXcgRmEoYixhKX07dmFyIFo9e2xvYWQ6cChZLmxvYWQsWSl9O1wiZnVuY3Rpb25cIj09PXR5cGVvZiBkZWZpbmUmJmRlZmluZS5hbWQ/ZGVmaW5lKGZ1bmN0aW9uKCl7cmV0dXJuIFp9KTpcInVuZGVmaW5lZFwiIT09dHlwZW9mIG1vZHVsZSYmbW9kdWxlLmV4cG9ydHM/bW9kdWxlLmV4cG9ydHM9Wjood2luZG93LldlYkZvbnQ9Wix3aW5kb3cuV2ViRm9udENvbmZpZyYmWS5sb2FkKHdpbmRvdy5XZWJGb250Q29uZmlnKSk7fSgpKTtcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vcGx1Z2lucy93ZWJmb250LmpzXG4vLyBtb2R1bGUgaWQgPSAxMTNcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwiZmFicmljLnNlbGVjdENvbG9yc1Rvb2wgPSBmdW5jdGlvbigpe1xuICByZXR1cm4ge1xuICAgIGNsYXNzTmFtZTogJ2J1dHRvbi1jb2xvcndoZWVsJyxcbiAgICB0eXBlOiAnZWZmZWN0JyxcbiAgICB2aXNpYmxlOiBmdW5jdGlvbigpe1xuICAgICAgcmV0dXJuICEhdGhpcy5sb2dvU3ZnO1xuICAgIH0sXG4gICAgb2JzZXJ2ZTogXCJ0YXNrOmNoYW5nZWRcIixcbiAgICBlZmZlY3RUcGw6XG4gICAgJzxkaXYgaWQ9XCJzZWxlY3QtY29sb3JzLWNvbG9yLWxpc3RcIj48L2Rpdj4nICtcbiAgICAnPGRpdiBpZD1cInNlbGVjdC1jb2xvcnMtY29sb3J3aGVlbFwiPjwvZGl2PicgK1xuICAgIC8vJzxkaXYgY2xhc3M9XCJidG4gYnRuLWNpcmNsZSBidXR0b24tZXllZHJvcHBlclwiIGlkPVwic2VsZWN0LWNvbG9ycy1leWVkcm9wcGVyXCI+PC9kaXY+JyArXG4gICAgJzxkaXYgY2xhc3M9XCJidG4gYnRuLWNpcmNsZSBidXR0b24tYm9sdFwiIGlkPVwic2VsZWN0LWNvbG9ycy1hY3Rpb24tYnV0dG9uXCI+PC9kaXY+JyArXG4gICAgJzxpbnB1dCBpZD1cInNlbGVjdC1jb2xvcnMtdGhyZXNob2xkXCIgdHlwZT1cInJhbmdlXCIgbWluPVwiMVwiIG1heD1cIjI1NVwiPicsXG4gICAgICBhY3Rpb25QYXJhbWV0ZXJzOiBmdW5jdGlvbihlbCxkYXRhKXtcbiAgICAgICAgdmFyIGFwcCA9IHRoaXM7XG4gICAgJChhcHAuY2FudmFzLndyYXBwZXJFbCkuY2xpY2soZnVuY3Rpb24oZSl7XG4gICAgICB2YXIgZGF0YSA9IGFwcC5jYW52YXMud3JhcHBlckVsLmdldFxuICAgIH0pO1xuXG4gICAgdmFyIGluaXRpYWxUaHJlc2hvbGQgPSA1NTtcbiAgICB2YXIgY29sb3JzID0gYXBwLmxvZ29TdmcuZXh0cmFjdENvbG9ycygpO1xuICAgIHZhciBfa2V5cyA9ICBPYmplY3Qua2V5cyhjb2xvcnMpO1xuXG4gICAgZm9yKHZhciBpID0gMCA7IGkgPCBfa2V5cy5sZW5ndGggLSAxOyBpKyspe1xuICAgICAgZm9yKHZhciBqID0gX2tleXMubGVuZ3RoIDsgai0tID4gaSsxOyApIHtcbiAgICAgICAgdmFyIGNvbG9yMSA9IG5ldyBmYWJyaWMuQ29sb3IoX2tleXNbaV0pLl9zb3VyY2U7XG4gICAgICAgIHZhciBjb2xvcjIgPSBuZXcgZmFicmljLkNvbG9yKF9rZXlzW2pdKS5fc291cmNlO1xuICAgICAgICBpZiAoTWFnaWNXYW5kLmRpZmZlcmVuY2UoY29sb3IxLCBjb2xvcjIpIDwgaW5pdGlhbFRocmVzaG9sZCkge1xuICAgICAgICAgIGRlbGV0ZSBjb2xvcnNbX2tleXNbal1dO1xuICAgICAgICAgIF9rZXlzLnNwbGljZShqKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuXG4gICAgdmFyIGVscyA9IFtdLFxuICAgICAgdmFsdWVzID0gW10sXG4gICAgICBjdXJyZW50SW5kZXggPSAwLFxuICAgICAgdGhyZXNob2xkID0gW10sXG4gICAgICBtaW5pY29sb3JzID0gZWwuZmluZChcIiNzZWxlY3QtY29sb3JzLWNvbG9yd2hlZWxcIiksXG4gICAgICBsaXN0ID0gZWwuZmluZChcIiNzZWxlY3QtY29sb3JzLWNvbG9yLWxpc3RcIiksXG4gICAgICBhY3Rpb25CdG4gPSBlbC5maW5kKCcjc2VsZWN0LWNvbG9ycy1hY3Rpb24tYnV0dG9uJyksXG4gICAgICB0aHJlc2hvbGRFbCA9IGVsLmZpbmQoJyNzZWxlY3QtY29sb3JzLXRocmVzaG9sZCcpO1xuICAgICAgLy9leWVkcm9wcGVyQnRuID0gZWwuZmluZCgnI3NlbGVjdC1jb2xvcnMtZXllZHJvcHBlcicpO1xuXG4gICAgdmFyIF9rZXlzID0gIE9iamVjdC5rZXlzKGNvbG9ycyk7XG5cbiAgICBmb3IodmFyIGkgaW4gX2tleXMpIHtcbiAgICAgIGlmKF9rZXlzW2ldWzBdICE9PSAnIycpIHtcbiAgICAgICAgX2tleXNbaV0gPSAnIycgKyBuZXcgZmFicmljLkNvbG9yKF9rZXlzW2ldKS50b0hleCgpO1xuICAgICAgfVxuICAgIH1cblxuICAgICAgZnVuY3Rpb24gZXllZHJvcChlKXtcbiAgICAgICAgICB2YXIgY3R4ID0gYXBwLmNhbnZhcy5sb3dlckNhbnZhc0VsLmdldENvbnRleHQoXCIyZFwiKTtcbiAgICAgICAgICB2YXIgZGF0YSA9IGN0eC5nZXRJbWFnZURhdGEoZS5vZmZzZXRYLCBlLm9mZnNldFksMSwxKTtcbiAgICAgICAgICBkYXRhLmRhdGFbM10gLz0gMjU1O1xuICAgICAgICAgIHZhciBjb2xvciA9IFwicmdiYShcIiArIGRhdGEuZGF0YS5qb2luKFwiLFwiKSArIFwiKVwiO1xuICAgICAgICAgIHNldENvbG9yKGNvbG9yKTtcbiAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgfVxuXG4gICAvLyBleWVkcm9wcGVyQnRuLmNsaWNrKGZ1bmN0aW9uKCl7XG4gICAgICBhcHAuY2FudmFzLmludGVyYWN0aXZlID0gZmFsc2U7XG4gICAgICBhcHAuY2FudmFzLnNldEN1cnNvcihhcHAuY2FudmFzLmV5ZWRyb3BwZXJDdXJzb3IpO1xuICAgICAgJChhcHAuY2FudmFzLnVwcGVyQ2FudmFzRWwpLm9uKFwiY2xpY2tcIixleWVkcm9wKTtcbiAvLyAgIH0pO1xuXG5cblxuICAgIGFjdGlvbkJ0bi5jbGljayhmdW5jdGlvbigpe1xuICAgICAgZGF0YS5hY3Rpb24odmFsdWVzLHRocmVzaG9sZClcbiAgICB9KTtcblxuICAgIGZ1bmN0aW9uIHNldENvbG9yKHZhbHVlLG9wYWNpdHkpe1xuICAgICAgdmFsdWVzW2N1cnJlbnRJbmRleF0gPSB2YWx1ZTtcbiAgICAgIGVsc1tjdXJyZW50SW5kZXhdLmNzcygnYmFja2dyb3VuZC1jb2xvcicsdmFsdWUpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHNldFZhbHVlKGluZGV4KXtcbiAgICAgIGN1cnJlbnRJbmRleCA9IGluZGV4O1xuICAgICAgbWluaWNvbG9ycy5taW5pY29sb3JzKCdzZXR0aW5ncycse1xuICAgICAgICBkZWZhdWx0VmFsdWU6IF9rZXlzW2N1cnJlbnRJbmRleF1cbiAgICAgIH0pO1xuICAgICAgdGhyZXNob2xkRWwudmFsKHRocmVzaG9sZFtpbmRleF0pO1xuICAgICAgbWluaWNvbG9ycy5taW5pY29sb3JzKCd2YWx1ZScsX2tleXNbaW5kZXhdKTtcbiAgICB9XG5cblxuICAgIGZvcih2YXIgaSBpbiBfa2V5cyl7XG4gICAgICBlbHNbaV0gPSAoZnVuY3Rpb24oY29sb3Ipe1xuICAgICAgICB2YWx1ZXMucHVzaChjb2xvcik7XG4gICAgICAgIHRocmVzaG9sZC5wdXNoKGluaXRpYWxUaHJlc2hvbGQpO1xuXG4gICAgICAgIHZhciAkY29sb3IgPSAkKFwiPHNwYW4+XCIpLmNzcyh7J2JhY2tncm91bmQtY29sb3InOiBjb2xvcn0pO1xuXG4gICAgICAgIHZhciAkcm0gPSAkKFwiPGk+XCIpLmFkZENsYXNzKCdmYSBmYS10cmFzaCcpO1xuXG4gICAgICAgICRybS5jbGljayhmdW5jdGlvbigpe1xuICAgICAgICAgIHZhciBpbmRleCA9IF9rZXlzLmluZGV4T2YoY29sb3IpO1xuICAgICAgICAgIF9rZXlzLnNwbGljZShpbmRleCwxKTtcbiAgICAgICAgICBlbHMuc3BsaWNlKGluZGV4LDEpO1xuICAgICAgICAgIHRocmVzaG9sZC5zcGxpY2UoaW5kZXgsMSk7XG4gICAgICAgICAgdmFsdWVzLnNwbGljZShpbmRleCwxKTtcbiAgICAgICAgICAkY29sb3IucmVtb3ZlKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRjb2xvci5jbGljayhmdW5jdGlvbigpe1xuICAgICAgICAgIHNldFZhbHVlKF9rZXlzLmluZGV4T2YoY29sb3IpKVxuICAgICAgICB9KTtcblxuICAgICAgICAkY29sb3IuYXBwZW5kKCRybSk7XG4gICAgICAgIGxpc3QuYXBwZW5kKCRjb2xvcik7XG4gICAgICAgIHJldHVybiAkY29sb3I7XG4gICAgICB9KShfa2V5c1tpXSk7XG4gICAgfVxuXG4gICAgY29sb3IgPSBfa2V5c1tjdXJyZW50SW5kZXhdO1xuXG4gICAgdGhyZXNob2xkRWwuY2hhbmdlKGZ1bmN0aW9uKCl7XG4gICAgICB0aHJlc2hvbGRbY3VycmVudEluZGV4XSA9IHBhcnNlSW50KHRocmVzaG9sZEVsLnZhbCgpKTtcblxuICAgICAgYXBwLmNhbnZhcy5wYXRoZmluZGVyLmNvbG9yU2VsZWN0aW9uKFt2YWx1ZXNbY3VycmVudEluZGV4XV0sW3RocmVzaG9sZFtjdXJyZW50SW5kZXhdXSk7XG4gICAgICBhcHAuY2FudmFzLnBhdGhmaW5kZXIucmVuZGVyKCk7XG4gICAgICBhcHAuY2FudmFzLmZyZWVEcmF3aW5nQnJ1c2guZW5hYmxlKCk7XG4gICAgfSk7XG4gICAgdGhyZXNob2xkRWwudmFsKHRocmVzaG9sZFtjdXJyZW50SW5kZXhdKTtcblxuICAgIG1pbmljb2xvcnMubWluaWNvbG9ycyh7XG4gICAgICBjaGFuZ2U6IHNldENvbG9yLFxuICAgICAgZm9ybWF0OiAnaGV4JyxcbiAgICAgIGNvbnRyb2w6ICdzYXR1cmF0aW9uJyxcbiAgICAgIGlubGluZTogdHJ1ZVxuICAgIH0pO1xuXG4gICAgc2V0VmFsdWUoMCk7XG5cblxuICAgIHJldHVybiBmdW5jdGlvbigpe1xuICAgICAgJChhcHAuY2FudmFzLnVwcGVyQ2FudmFzRWwpLm9mZihcImNsaWNrXCIsZXllZHJvcCk7XG4gICAgICBhcHAuY2FudmFzLmludGVyYWN0aXZlID0gdHJ1ZTtcbiAgICB9XG4gIH0sXG4gICAgdGl0bGU6ICdyZW1vdmVCYWNrZ3JvdW5kJyxcbiAgICBhY3Rpb246ICBmdW5jdGlvbiAoY29sb3JzLHRocmVzaG9sZCkge1xuICAgICAgdGhpcy5jYW52YXMucGF0aGZpbmRlci5jb2xvclNlbGVjdGlvbihjb2xvcnMsdGhyZXNob2xkKTtcbiAgICAgIHRoaXMuY2FudmFzLnBhdGhmaW5kZXIucmVuZGVyKCk7XG4gICAgICB0aGlzLmNhbnZhcy5mcmVlRHJhd2luZ0JydXNoLmVuYWJsZSgpO1xuICAgIH1cbiAgfVxufVxuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi90b29scy9zZWxlY3RDb2xvcnNUb29scy5qc1xuLy8gbW9kdWxlIGlkID0gMTE0XG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsIlxudmFyIGRlZXBEaWZmTWFwcGVyID0ge1xuICBWQUxVRV9DUkVBVEVEOiAnY3JlYXRlZCcsXG4gIFZBTFVFX1VQREFURUQ6ICd1cGRhdGVkJyxcbiAgVkFMVUVfREVMRVRFRDogJ2RlbGV0ZWQnLFxuICBWQUxVRV9VTkNIQU5HRUQ6ICd1bmNoYW5nZWQnLFxuICBtYXA6IGZ1bmN0aW9uKG9iajEsIG9iajIpIHtcbiAgICBpZiAodGhpcy5pc0Z1bmN0aW9uKG9iajEpIHx8IHRoaXMuaXNGdW5jdGlvbihvYmoyKSkge1xuICAgICAgdGhyb3cgJ0ludmFsaWQgYXJndW1lbnQuIEZ1bmN0aW9uIGdpdmVuLCBvYmplY3QgZXhwZWN0ZWQuJztcbiAgICB9XG4gICAgaWYgKHRoaXMuaXNWYWx1ZShvYmoxKSB8fCB0aGlzLmlzVmFsdWUob2JqMikpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgICdfbWFwX3R5cGUnOiB0aGlzLmNvbXBhcmVWYWx1ZXMob2JqMSwgb2JqMiksXG4gICAgICAgICdfbWFwX2RhdGEnOiAob2JqMiA9PT0gdW5kZWZpbmVkKSA/IG9iajEgOiBvYmoyXG4gICAgICB9O1xuICAgIH1cblxuXG4gICAgaWYoXy5pc0FycmF5KG9iajIpKXtcbiAgICAgIHZhciBfYXJyYXkgPSB0cnVlO1xuICAgICAgdmFyIGRpZmYgPSBbXTtcbiAgICB9ZWxzZXtcbiAgICAgIHZhciBkaWZmID0ge307XG4gICAgfVxuXG5cbiAgICBmb3IgKHZhciBrZXkgaW4gb2JqMSkge1xuICAgICAgaWYgKHRoaXMuaXNGdW5jdGlvbihvYmoxW2tleV0pKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuXG4gICAgICB2YXIgdmFsdWUyID0gdW5kZWZpbmVkO1xuICAgICAgaWYgKCd1bmRlZmluZWQnICE9IHR5cGVvZihvYmoyW2tleV0pKSB7XG4gICAgICAgIHZhbHVlMiA9IG9iajJba2V5XTtcbiAgICAgIH1cblxuICAgICAgZGlmZltrZXldID0gdGhpcy5tYXAob2JqMVtrZXldLCB2YWx1ZTIpO1xuICAgIH1cbiAgICBmb3IgKHZhciBrZXkgaW4gb2JqMikge1xuICAgICAgaWYgKHRoaXMuaXNGdW5jdGlvbihvYmoyW2tleV0pIHx8ICgndW5kZWZpbmVkJyAhPSB0eXBlb2YoZGlmZltrZXldKSkpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG5cbiAgICAgIHZhciBfdmFsID0gdGhpcy5tYXAodW5kZWZpbmVkLCBvYmoyW2tleV0pO1xuICAgICAgaWYoX2FycmF5KXtcbiAgICAgICAgZGlmZi5wdXNoKF92YWwpO1xuICAgICAgfWVsc2V7XG4gICAgICAgIGRpZmZba2V5XSA9IF92YWxcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgJ19tYXBfdHlwZSc6ICcnLFxuICAgICAgJ19tYXBfZGF0YSc6IGRpZmZcbiAgICB9O1xuXG4gIH0sXG4gIGNvbXBhcmVWYWx1ZXM6IGZ1bmN0aW9uKHZhbHVlMSwgdmFsdWUyKSB7XG4gICAgaWYgKHZhbHVlMSA9PT0gdmFsdWUyKSB7XG4gICAgICByZXR1cm4gdGhpcy5WQUxVRV9VTkNIQU5HRUQ7XG4gICAgfVxuICAgIGlmICgndW5kZWZpbmVkJyA9PSB0eXBlb2YodmFsdWUxKSkge1xuICAgICAgcmV0dXJuIHRoaXMuVkFMVUVfQ1JFQVRFRDtcbiAgICB9XG4gICAgaWYgKCd1bmRlZmluZWQnID09IHR5cGVvZih2YWx1ZTIpKSB7XG4gICAgICByZXR1cm4gdGhpcy5WQUxVRV9ERUxFVEVEO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLlZBTFVFX1VQREFURUQ7XG4gIH0sXG4gIGlzRnVuY3Rpb246IGZ1bmN0aW9uKG9iaikge1xuICAgIHJldHVybiB7fS50b1N0cmluZy5hcHBseShvYmopID09PSAnW29iamVjdCBGdW5jdGlvbl0nO1xuICB9LFxuICBpc0FycmF5OiBmdW5jdGlvbihvYmopIHtcbiAgICByZXR1cm4ge30udG9TdHJpbmcuYXBwbHkob2JqKSA9PT0gJ1tvYmplY3QgQXJyYXldJztcbiAgfSxcbiAgaXNPYmplY3Q6IGZ1bmN0aW9uKG9iaikge1xuICAgIHJldHVybiB7fS50b1N0cmluZy5hcHBseShvYmopID09PSAnW29iamVjdCBPYmplY3RdJztcbiAgfSxcbiAgaXNWYWx1ZTogZnVuY3Rpb24ob2JqKSB7XG4gICAgcmV0dXJuICF0aGlzLmlzT2JqZWN0KG9iaikgJiYgIXRoaXMuaXNBcnJheShvYmopO1xuICB9XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgZGlmZmVyZW5jZU1hcDogZGVlcERpZmZNYXBwZXIubWFwLmJpbmQoZGVlcERpZmZNYXBwZXIpLFxuICBzeW50YXhIaWdobGlnaHQ6IGZ1bmN0aW9uIChqc29uKSB7XG4gICAgaWYgKHR5cGVvZiBqc29uICE9ICdzdHJpbmcnKSB7XG4gICAgICBqc29uID0gSlNPTi5zdHJpbmdpZnkoanNvbiwgbnVsbCwgMik7XG4gICAgfVxuICAgIGpzb24gPSBqc29uLnJlcGxhY2UoLyYvZywgJyZhbXA7JykucmVwbGFjZSgvPC9nLCAnJmx0OycpLnJlcGxhY2UoLz4vZywgJyZndDsnKTtcblxuICAgIGpzb24gPSBqc29uLnJlcGxhY2UoLyhcIihcXFxcdVthLXpBLVowLTldezR9fFxcXFxbXnVdfFteXFxcXFwiXSkqXCIoXFxzKjopP3xcXGIodHJ1ZXxmYWxzZXxudWxsKVxcYnwtP1xcZCsoPzpcXC5cXGQqKT8oPzpbZUVdWytcXC1dP1xcZCspPykvZywgZnVuY3Rpb24gKG1hdGNoKSB7XG4gICAgICB2YXIgY2xzID0gJ251bWJlcic7XG4gICAgICBpZiAoL15cIi8udGVzdChtYXRjaCkpIHtcbiAgICAgICAgaWYgKC86JC8udGVzdChtYXRjaCkpIHtcbiAgICAgICAgICBjbHMgPSAna2V5JztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjbHMgPSAnc3RyaW5nJztcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmICgvdHJ1ZXxmYWxzZS8udGVzdChtYXRjaCkpIHtcbiAgICAgICAgY2xzID0gJ2Jvb2xlYW4nO1xuICAgICAgfSBlbHNlIGlmICgvbnVsbC8udGVzdChtYXRjaCkpIHtcbiAgICAgICAgY2xzID0gJ251bGwnO1xuICAgICAgfVxuICAgICAgcmV0dXJuICc8c3BhbiBjbGFzcz1cIicgKyBjbHMgKyAnXCI+JyArIG1hdGNoICsgJzwvc3Bhbj4nO1xuICAgIH0pO1xuICAgIHJldHVybiBqc29uID0ganNvbi5yZXBsYWNlKC9bXixcXG5dW15cXG5dKi9nLCBmdW5jdGlvbiAobWF0Y2gpIHtcbiAgICAgIHJldHVybiAnPHNwYW4+JyArIG1hdGNoICsgJzwvc3Bhbj4nO1xuICAgIH0pO1xuICB9LFxuICBkaWZmZXJlbmNlSGlnaGxpZ2h0OiBmdW5jdGlvbiAgKGpzb24sb3V0cHV0KXtcblxuICAgIGlmKG91dHB1dCl7XG4gICAgICBvdXRwdXQuZW1wdHkoKTtcbiAgICB9ZWxzZXtcbiAgICAgIG91dHB1dCA9ICQoXCI8cHJlPlwiKTtcbiAgICB9XG5cblxuICAgIGZ1bmN0aW9uIHByaW50T2JqZWN0KGpzb24sbGV2ZWwsb3V0cHV0LGNvbW1hLG9iamVjdEluZGV4KXtcbiAgICAgIHZhciBfZWwgPSAkKFwiPHA+XCIpO1xuXG4gICAgICBfZWwuYXBwZW5kKCQoXCI8c3Bhbj5cIikuYWRkQ2xhc3MoXCJvYmplY3Qta2V5XCIpLmFwcGVuZChcbiAgICAgICAgJChcIjxzcGFuPlwiKS50ZXh0KG5ldyBBcnJheShsZXZlbCkuam9pbignICcpIClcbiAgICAgICkpO1xuICAgICAgaWYob2JqZWN0SW5kZXgpe1xuICAgICAgICBfZWwuYXBwZW5kKFxuICAgICAgICAgICQoXCI8c3Bhbj5cIikudGV4dCgnXCInKS5hZGRDbGFzcyhcImludmlzaWJsZVwiKSxcbiAgICAgICAgICAkKFwiPHNwYW4+XCIpLmFkZENsYXNzKFwia2V5XCIpLnRleHQob2JqZWN0SW5kZXgpLFxuICAgICAgICAgICQoXCI8c3Bhbj5cIikudGV4dCgnXCInKS5hZGRDbGFzcyhcImludmlzaWJsZVwiKSxcbiAgICAgICAgICAkKFwiPHNwYW4+XCIpLnRleHQoJzogJylcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgaWYoanNvbiAmJiBqc29uLl9tYXBfdHlwZSAhPT0gdW5kZWZpbmVkKXtcbiAgICAgICAgX2VsLmFkZENsYXNzKGpzb24uX21hcF90eXBlKTtcblxuICAgICAgICBpZihfLmlzQXJyYXkoanNvbi5fbWFwX2RhdGEpKXtcbiAgICAgICAgICBfZWwuYXBwZW5kKCQoXCI8c3Bhbj5cIikudGV4dChcIltcIikpO1xuICAgICAgICAgIHZhciBfbGFzdF9rZXkgPSBqc29uLl9tYXBfZGF0YS5sZW5ndGggLSAxO1xuICAgICAgICAgIGZvcih2YXIgaSBpbiBqc29uLl9tYXBfZGF0YSl7XG4gICAgICAgICAgICBwcmludE9iamVjdChqc29uLl9tYXBfZGF0YVtpXSxsZXZlbCArIDEsX2VsLGkgIT0gX2xhc3Rfa2V5KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgX2VsLmFwcGVuZCgkKFwiPHA+XCIpLnRleHQobmV3IEFycmF5KGxldmVsICkuam9pbignICcpICsgXCJdXCIgKyAoY29tbWEgPyBcIixcIiA6IFwiXCIpKSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZihfLmlzT2JqZWN0KGpzb24uX21hcF9kYXRhKSl7XG4gICAgICAgICAgX2VsLmFwcGVuZCgkKFwiPHNwYW4+XCIpLnRleHQoXCJ7XCIpKTtcbiAgICAgICAgICB2YXIgX2xhc3Rfa2V5ID0gT2JqZWN0LmtleXMoanNvbi5fbWFwX2RhdGEpLnBvcCgpO1xuICAgICAgICAgIGZvcih2YXIgaSBpbiBqc29uLl9tYXBfZGF0YSl7XG4gICAgICAgICAgICBwcmludE9iamVjdChqc29uLl9tYXBfZGF0YVtpXSxsZXZlbCArIDEsX2VsLGkgIT0gX2xhc3Rfa2V5LGkpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBfZWwuYXBwZW5kKCQoXCI8cD5cIikudGV4dChuZXcgQXJyYXkobGV2ZWwgKS5qb2luKCcgJykgKyBcIn1cIiArIChjb21tYSA/IFwiLFwiIDogXCJcIikpKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNle1xuXG4gICAgICAgICAgaWYoXy5pc051bGwoanNvbi5fbWFwX2RhdGEpKXtcbiAgICAgICAgICAgIF9lbC5hcHBlbmQoXG4gICAgICAgICAgICAgICQoXCI8c3Bhbj5cIikudGV4dChKU09OLnN0cmluZ2lmeShqc29uLl9tYXBfZGF0YSwgbnVsbCwgMikpXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNlIGlmKGpzb24uX21hcF9kYXRhLmNvbnN0cnVjdG9yID09PSBTdHJpbmcgKXtcbiAgICAgICAgICAgIF9lbC5hcHBlbmQoXG4gICAgICAgICAgICAgICQoXCI8c3Bhbj5cIikudGV4dCgnXCInKSxcbiAgICAgICAgICAgICAgJChcIjxzcGFuPlwiKS5hZGRDbGFzcygnc3RyaW5nJykudGV4dChqc29uLl9tYXBfZGF0YSksXG4gICAgICAgICAgICAgICQoXCI8c3Bhbj5cIikudGV4dCgnXCInKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZSBpZihqc29uLl9tYXBfZGF0YS5jb25zdHJ1Y3RvciA9PT0gTnVtYmVyIHx8IGpzb24uX21hcF9kYXRhLmNvbnN0cnVjdG9yID09PSBCb29sZWFuKXtcbiAgICAgICAgICAgIF9lbC5hcHBlbmQoXG4gICAgICAgICAgICAgICQoXCI8c3Bhbj5cIikuYWRkQ2xhc3MoJ251bWJlcicpLnRleHQoanNvbi5fbWFwX2RhdGEpXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbHNle1xuICAgICAgICAgICAgX2VsLmFwcGVuZChcbiAgICAgICAgICAgICAgJChcIjxzcGFuPlwiKS50ZXh0KEpTT04uc3RyaW5naWZ5KGpzb24uX21hcF9kYXRhLCBudWxsLCAyKSlcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmKGNvbW1hKXtcbiAgICAgICAgICAgIF9lbC5hcHBlbmQoXG4gICAgICAgICAgICAgICQoXCI8c3Bhbj5cIikudGV4dChcIixcIilcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuXG5cbiAgICAgICAgfVxuICAgICAgfWVsc2V7XG4gICAgICAgIF9lbC5hcHBlbmQoXG4gICAgICAgICAgJChcIjxzcGFuPlwiKS50ZXh0KEpTT04uc3RyaW5naWZ5KGpzb24sIG51bGwsIDIpKVxuICAgICAgICApXG5cbiAgICAgICAgaWYoY29tbWEpe1xuICAgICAgICAgIF9lbC5hcHBlbmQoXG4gICAgICAgICAgICAkKFwiPHNwYW4+XCIpLnRleHQoXCIsXCIpXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICB9XG5cbiAgICAgIG91dHB1dC5hcHBlbmQoX2VsKTtcblxuICAgIH1cbiAgICBwcmludE9iamVjdChqc29uLDEsb3V0cHV0KTtcbiAgICByZXR1cm4gb3V0cHV0O1xuICB9XG59O1xuXG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL3V0aWwvc3ludGF4LmpzXG4vLyBtb2R1bGUgaWQgPSAxMTVcbi8vIG1vZHVsZSBjaHVua3MgPSAwIiwibW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKFwiZnNcIik7XG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gZXh0ZXJuYWwgXCJmc1wiXG4vLyBtb2R1bGUgaWQgPSAxMTZcbi8vIG1vZHVsZSBjaHVua3MgPSAwIl0sIm1hcHBpbmdzIjoiOzs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QTs7OztBQ2hFQTs7Ozs7O0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUM5TkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUNwUkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7QUNoMEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OztBQ3g5Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUNqSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7OztBQ3BCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7OztBQ2piQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7QUN2Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7O0FDOVFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OztBQzU1Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OztBQ3ZKQTs7Ozs7O0FDQUE7Ozs7OztBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7QUM5RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OztBQ2xhQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O0FDbENBO0FBQ0E7QUFDQTs7Ozs7OztBQ0ZBO0FBQ0E7Ozs7Ozs7O0FDREE7Ozs7OztBQ0FBOzs7Ozs7QUNBQTs7Ozs7O0FDQUE7Ozs7OztBQ0FBOzs7Ozs7QUNBQTs7Ozs7O0FDQUE7Ozs7OztBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7O0FDekNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7QUMxRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7O0FDcElBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7OztBQy9FQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7O0FDMUZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7O0FDN05BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7O0FDOVBBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7O0FDOU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7O0FDamZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7OztBQzFEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7OztBQzFyQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7OztBQ2pSQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7OztBQ3BUQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7OztBQzlGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7O0FDNUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7QUN6R0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7O0FDL2JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7QUN0SkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7QUNqVkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7QUN0WkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7QUMxQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7QUM5REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7OztBQzdCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O0FDOWFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUNyTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7OztBQ3BwQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7O0FDcExBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7QUN6WEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7OztBQ3JCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7QUMxUEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7QUN4R0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7O0FDaE5BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7OztBQzNIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7O0FDL0lBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7O0FDOWhCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7QUNyRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7QUNyR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7O0FDM0hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7OztBQ2hHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7QUN0RUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7O0FDaFZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7OztBQzNJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7QUM1TkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7OztBQ25xQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7QUNqWkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7O0FDalBBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7QUNuUEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7OztBQ25TQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7OztBQy9FQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7OztBQ3JEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7QUNsNEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7O0FDMzhCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7OztBQ2hSQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7O0FDeEhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7O0FDeFVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7QUNoQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7QUNyQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7QUN6RkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7O0FDeE9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7O0FDbklBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7QUN2VUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7O0FDOWRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7OztBQzdTQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7OztBQ3BRQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7OztBQ3huQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7QUNwWUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7O0FDOUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7QUMzSkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7OztBQ3ZMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7OztBQ3RhQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7O0FDelZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7QUNuVkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7QUNoT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7O0FDM0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7O0FDdlpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7O0FDOWtCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7QUM3U0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7O0FDdkdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7O0FDdExBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7QUM5UUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7OztBQzFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7OztBQ3pIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7QUNucERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7Ozs7Ozs7QUNyUUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O0FDbERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OztBQ3pDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7O0FDcERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBOzs7Ozs7O0FDakJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7O0FDdkpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OztBQzlNQTs7O0EiLCJzb3VyY2VSb290IjoiIn0=